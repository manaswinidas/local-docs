<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook">Chapter 4. Fixed Issues</title><link rel="stylesheet" type="text/css" href="Common_Content/css/epub.css"/><meta xmlns:d="http://docbook.org/ns/docbook" name="generator" content="publican v4.3.3"/><meta xmlns:d="http://docbook.org/ns/docbook" name="package" content=""/></head><body><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="idm140709004952816">
      ⁠</a>Chapter 4. Fixed Issues</h1></div></div></div><div class="para">
		Issues fixed for Enterprise Application Platform 5.1.1 are listed by component.
	</div><div class="variablelist"><p class="title"><strong>Build</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4621">JBPAPP-4621</a> </span></dt><dd><div class="para">
					The following unnecessary files were included in the installation of Enterprise Web Platform that only pertained to Enterprise Application Platform.
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							<code class="filename">jboss-ewp-5.1/jboss-as-web/server/default/conf/props/messaging-users.properties</code>
						</div></li><li class="listitem"><div class="para">
							<code class="filename">jboss-ewp-5.1/jboss-as-web/server/default/conf/props/messaging-roles.properties</code>
						</div></li></ul></div><div class="para">
					These files have been removed from the installation procedure.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4970">JBPAPP-4970</a> </span></dt><dd><div class="para">
					The version of Seam distributed with JBoss Enterprise Application Platform 5 included a superfluous dependency on the Hyper Structured Query Language Database (HSQLDB). This dependency has been removed.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5155">JBPAPP-5155</a> </span></dt><dd><div class="para">
					JBoss Native Zips did not contain the sha256sum value within the zip archive. The values were included in a separate file, which had to be downloaded separately with the native zip archive. This caused problems with the release process, and maintaining an accurate sha256sum list. The sha256sum values are now included in the zip archive.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>Clustering</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-3549">JBPAPP-3549</a> </span></dt><dd><div class="para">
					When a multicast address (<code class="code">mcast_addr</code>) was incorrectly configured, the warning that appeared in the log included an outdated URL. The URL has been updated.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-3795">JBPAPP-3795</a> </span></dt><dd><div class="para">
					Class <code class="code">org.jboss.system.server.profileservice.repository.clustered.local.file.AbstractFileWriteAction</code> has a member variable <code class="code">tempFile</code>, which is set to a newly created file in <code class="code">getTempFile()</code>. This file is called from <code class="code">getOutputStream()</code>, which is called from <code class="code">writeBytes()</code>. However, <code class="code">writeBytes</code> is only called if there is data in the file.
				</div><div class="para">
					If the file is empty, <code class="code">tempFile</code> is never set, and <code class="code">AbstractFileWriteAction.modifyTarget</code> passes a null <code class="code">File</code> parameter to <code class="code">FileUtil.localMove</code>, where the <code class="code">NullPointerException</code> happens.
				</div><div class="para">
					<code class="code">AbstractFileWriteAction.modifyTarget</code> now calls <code class="code">getTempFile()</code>, which creates the file if needed, instead of using <code class="code">tempFile</code> directly.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4947">JBPAPP-4947</a> </span></dt><dd><div class="para">
					The <code class="classname">encrypt</code> class of JGroups had bugs related to threading in the Cipher routine. These have been addressed.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5171">JBPAPP-5171</a> </span></dt><dd><div class="para">
					A software error resulted in a situation where neither the process of serving the login page nor handling the <code class="code">POST</code> to <code class="code">j_security_check</code> resulted in a call into <code class="code">ClusteredSessionValve</code>, which is the part of the request pipeline that triggers replication of the session by storing it in the database. <code class="code">FormAuthenticator</code> directly dispatched to the login page, and handled <code class="code">j_security_check</code> itself.
				</div><div class="para">
					As a result, the session that was created before serving the login page was not persisted. When the authentication was complete and the request for the original URL came in, the session manager checked with the distributed store to see whether the local session copy was out of date. With <code class="code">DataSourcePersistentManager</code>, that check was made to class <code class="code">VersionBasedOutdatedSessionChecker</code>. <code class="code">VersionBasedOutdatedSessionChecker</code> returned true because it could not find the session in the database. Because of the <code class="code">true</code> return value, the session manager could not use the local session. It attempted to read it from the persistent store. It did not exist in the persistent store either, so a new session was created.
				</div><div class="para">
					To address this issue, <code class="code">VersionBasedOutdatedSessionChecker</code> now checks the session's <code class="code">getLastReplicated</code> method if it cannot find a persisted session. If the value is 0, the session is new, and has never been persisted, so it cannot be outdated. In that case it returns false.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5406">JBPAPP-5406</a> </span></dt><dd><div class="para">
					An incorrect subsystem was set during remoting client creation, due to the order of superclass constructor operations. This created <code class="code">NullPointerExceptions</code> and <code class="code">ClassCastExceptions</code>. Constructors have been altered to initialize the client after the correct subsystem is set.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5843">JBPAPP-5843</a> </span></dt><dd><div class="para">
					A timer that is shared across all channels in a group did not stop when one of the channels was closed. If OOB messages were passed around at the time a channel left a group, messages were added to the Retransmitter after the channel closed. This happened because messages which were added to the Retransmitter continued to be requested after <code class="code">Retransmitter.reset()</code> completed. This issue is resolved by fixing the condition that caused retransmission requests when a message from a node is processed at the same time the node leaves the cluster.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5844">JBPAPP-5844</a> </span></dt><dd><div class="para">
					In Microsoft Windows, when the network interface was disrupted, such as by removing the network cable and reinserting it, JGroups received an exception of type <code class="code">NoRouteToHostException</code> every time it attempted to send a message. This continued until the server was restarted. This problem is solved by new behavior in JGroups, which re-binds the socket to the interface, allowing JGroups to send messages again.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5851">JBPAPP-5851</a> </span></dt><dd><div class="para">
					The <code class="code">asym_provider</code> and <code class="code">sym_provider</code> security provider options of the ENCRYPT algorithm previously were only used by the <code class="code">KeyGenerator</code> lookup. These options are now implemented in the <code class="code">Cipher</code> lookup as well.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5855">JBPAPP-5855</a> </span></dt><dd><div class="para">
					The JGroups <code class="code">FD_SOCK</code> protocol is a failure detection protocol based on sockets. The client side of the <code class="code">FD_SOCK</code> TCP connection was not binding to a specific IP address. If you tried to open a firewall connection specific to each individual application, there was unnecessary cross-talk between applications. <code class="code">client_bind_port</code>, <code class="code">port_range</code>, and <code class="code">bind_addr</code> were added to <code class="code">FD_SOCK</code>, which allows you to bind the outgoing connections to a specific IP address and/or port range.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5900">JBPAPP-5900</a> </span></dt><dd><div class="para">
					A race condition in the JGroups <code class="literal">FLUSH</code> protocol caused messages to be processed in the wrong order when the master node left the cluster, so the master node left before sending a new view (with a new master). Therefore, the other nodes did not detect the master's absence, or elect a new master, until the master's absence was detected by the failure detection protocol. The message ordering has been corrected, and the race condition no longer occurs.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5912">JBPAPP-5912</a> </span></dt><dd><div class="para">
					When a JBoss Cache instance configured for asynchronous serialization was shunned from the cluster, all future replications would fail until the cache was restarted. The cause was a naming conflict between a method and its parent class. This has been fixed by renaming method <code class="methodname">CommandAwareRpcDispatcher.stop()</code> to <code class="methodname">stopDispatcher()</code>.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-6011">JBPAPP-6011</a> </span></dt><dd><div class="para">
					The JGroups configuration in the binding manager now implements the system properties added to the JGroups configurations in Enterprise Application Platform 5.1. In addition, hard-coded ports have been removed, and the default multicast addresses are set to the same values used in version 5.0 of the platform.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>Consoles</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-3928">JBPAPP-3928</a> </span></dt><dd><div class="para">
					If a user waits too long to log in after going to the Admin Console login page, the session times out. Previously, this caused an exception. A user-friendly timeout message is now displayed.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4791">JBPAPP-4791</a> </span></dt><dd><div class="para">
					If a topic or queue was created with the same name as an existing topic or queue, the new one overwrote the old one. This has been resolved by causing an attempt to create a topic or queue with a duplicate name to fail, generating an error.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4886">JBPAPP-4886</a> </span></dt><dd><div class="para">
					The <code class="classname">ApplicationServerDiscoveryComponent</code> class does not use JBoss variables because the paths are hardcoded to the <code class="filename">jar</code> files. If JBoss library locations and the JBoss variables for the libraries (<code class="varname">jboss.lib.url</code>, <code class="varname">jboss.common.lib.url</code> and <code class="varname">jboss.server.lib.url</code>) were changed, the JBoss Admin Console failed to open. This issue is resolved by adding <code class="function">BootstrapAction.createPluginContainerConfiguration()</code> to the Admin Console.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>Documentation</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4387">JBPAPP-4387</a> </span></dt><dd><div class="para">
					<em class="citetitle">Seam Reference User Guide</em> source code blocks did not have syntax highlighting, which made the source code difficult to read. The affected code has been updated with the correct highlighting.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4616">JBPAPP-4616</a> </span></dt><dd><div class="para">
					The <em class="citetitle">Microcontainer User Guide</em> contained references to some outdated Maven artifacts. Please review the document shipped with the current release for updated information.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4958">JBPAPP-4958</a> </span></dt><dd><div class="para">
					In the <em class="citetitle">Hibernate Core User Guide</em>, a reference was made to an incorrect POM file. This reference has been updated in the documentation for the current release.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5223">JBPAPP-5223</a> </span></dt><dd><div class="para">
					The configuration information in the <em class="citetitle">JMS Clustering Notes</em> section of the guide was inaccurate. The guide has been corrected with an updated configuration example, which fixes the issue.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5584">JBPAPP-5584</a> </span></dt><dd><div class="para">
					A change to the default value of the <code class="literal"> <span class="property">max_prepared_transactions</span> </code> datasource property in PostgreSQL versions 8.2 and 8.4 resulted in XA Transactions being denied. An Important admonition was added to <em class="citetitle">Appendix A.7 PostgreSQL</em> of the <em class="citetitle">Administration and Configuration Guide</em> for the XA Datasource example, to highlight the requirement.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5907">JBPAPP-5907</a> </span></dt><dd><div class="para">
					The <em class="citetitle">Security Guide</em> released with earlier versions of the Enterprise Application Platform missed the instructions for encrypting the datasource password. The documentation now includes the step. The instructions to configure the <code class="filename">server.password</code> file by running the following command:
				</div><pre class="screen">
java -cp jboss-as/common/lib/jbosssx.jar org.jboss.security.plugins.FilePassword \
          <em class="replaceable">SALT</em> <em class="replaceable">COUNT</em> <em class="replaceable">MASTER_PASSWORD</em> <em class="replaceable">PASSWORD_FILE</em></pre></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-6199">JBPAPP-6199</a> </span></dt><dd><div class="para">
					The <em class="citetitle">HTTP Connectors Guide</em> is a new user guide for JBoss Enterprise Application Platform 5.1.1. This guide supercedes and improves upon the <em class="citetitle">mod_cluster User Guide</em> and the HTTP Services section of the <em class="citetitle">Administration and Configuration Guide</em>. It also contains information about the ISAPI and NSAPI connectors.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>EJB</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-3392">JBPAPP-3392</a> </span></dt><dd><div class="para">
					EJB3 clients did not use existing socket connections on subsequent invocations. Instead, they created a new connection for each invocation, which was destroyed when the connection was complete. A delay has been added so that connections remain open for use in subsequent invocations.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5167">JBPAPP-5167</a> </span></dt><dd><div class="para">
					In two cases, the <code class="classname">UnifiedClassLoader</code> was used instead of an isolated EAR's classloader. The first case occurred when a EJB2 Entity Bean was packaged inside of an isolated EAR and an EJB client was packaged in the same isolated EAR. When the EJB Entity Bean was passivated, a <code class="code">ClassNotFound</code> exception was thrown. This was caused by the usage of <code class="code">UnifiedClassLoader</code> instead of the EAR's isolated classloader. The second case occured when a deployed EJB2 Entity Bean had a local interface of the same name as an interface in the <code class="code">UnifiedClassLoader</code>, resulting in a <code class="code">ClassCastException</code>. The correct classloader is now used in both cases, and the errors no longer occur.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5476">JBPAPP-5476</a> </span></dt><dd><div class="para">
					A bug in <code class="code">org.jboss.ejb.plugins.SecurityInterceptor</code> caused problems with setting the runas-identity context method invocation on stateless session EJBs that were not originally runas-deployed. Invocations used the identity of any authenticated context sent to the EJB, which resulted in invocations being executed as if the EJB was runas-deployed. The only way to stop this behavior was to restart the server. <code class="code">SecurityInterceptor</code> now looks at the run-as role of the original EJB, and ensures that runAsRole is available to any calls made by the EJB for declarative security checks.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5618">JBPAPP-5618</a> </span></dt><dd><div class="para">
					When an EJB Timer service was configured to use the <code class="code">GeneralPurposeDatabasePersistencePlugin</code>, and the <code class="code">CachedConnectionManager</code> was set to debug, the following warning was recorded in the server log:
				</div><pre class="screen">
WARN [org.jboss.resource.adapter.jdbc.WrappedConnection] Closing a result set you left open! Please close it yourself.
</pre><div class="para">
					This occurred because the <code class="code">GeneralPurposeDatabasePersistencePlugin</code> did not close an internally-used <code class="code">ResultSet</code>. The <code class="code">CachedConnectionManager</code> closed the <code class="code">ResultSet</code> and correctly informed the user of the error. The <code class="code">GeneralPurposeDatabasePersistencePlugin</code> has been modified to close the <code class="code">ResultSet</code>, so the warning no longer appears.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-6102">JBPAPP-6102</a> </span></dt><dd><div class="para">
					If you use JDK 6 update 19 or newer, and your application sends or receives <code class="classname">java.io.File</code> objects, a serialization exception may occur. This exception can also happen if you are using clustering with a stateful session containing a <code class="classname">java.io.File</code> object.
				</div><div class="para">
					To prevent this exception, a new property has been added. Set the system property <code class="literal">-Dorg.jboss.serial.SYNC_SERIALIZATION_BINARY_FORMATS=true</code>, for all JBoss instances that communicate with each other.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>Hibernate</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4175">JBPAPP-4175</a> </span></dt><dd><div class="para">
					When Hibernate executed a cacheable query using a <code class="classname">ResultTransformer</code>, it attempted to cache the results after applying the <code class="classname">ResultTransformer</code>. However, the data might be modified so that Hibernate could not read it. In this case, a <code class="exceptionname">ClassCastException</code> would occur when attempting to cache the results.
				</div><div class="para">
					This issue is fixed by introducing three new classes to the API:
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							<code class="code">org.hibernate.transform.AliasedTupleSubsetResultTransformer</code>
						</div></li><li class="listitem"><div class="para">
							<code class="code">org.hibernate.transform.CacheableResultTransformer</code>
						</div></li><li class="listitem"><div class="para">
							<code class="code">org.hibernate.transform.TupleSubsetResultTransformer</code>
						</div></li></ul></div><div class="para">
					Review the Javadoc for Hibernate for more details.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4738">JBPAPP-4738</a> </span></dt><dd><div class="para">
					Dialect <code class="code">org.hibernate.dialect.SQLServer2008Dialect</code> has been added to Hibernate, to address changes to the Microsoft SQL dialect introduced in Microsoft SQL Server version 2008.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4895">JBPAPP-4895</a> </span></dt><dd><div class="para">
					When a <code class="methodname">refresh()</code> method was invoked immediately prior to an <code class="methodname">insert()</code>, and second-level caching was enabled, the entity was inserted into the second-level cache. If the <code class="methodname">refresh()</code> committed successfully, however, the cached data was not automatically evicted. This occurred because <code class="methodname">refresh()</code> did not track entity state. <code class="methodname">refresh()</code> now tracks entity state, and evicts the cached data on a successful commit.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4904">JBPAPP-4904</a> </span></dt><dd><div class="para">
					JBoss Marshalling failed to serialize a session, due to a flaw in the serialization logic of <code class="classname">org.hibernate.impl.SessionImpl</code>. This class now adheres to the Java Serialization specification listed at <a href="http://java.sun.com/javase/6/docs/platform/serialization/spec/output.html#86">http://java.sun.com/javase/6/docs/platform/serialization/spec/output.html#86</a>, and serialization works properly and as expected.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4905">JBPAPP-4905</a> </span></dt><dd><div class="para">
					<code class="classname">org.hibernate.type.EnumType</code> used a static map to cache the <span class="type">enum</span> values, because getting the value of the <span class="type">enum</span> by reflecting is expensive. However, this implementation had the potential to cause memory leaks in come circumstances, especially when using Hibernate in the application server. This is because the cached objects would never be garbage-collected, so the Map acting as cache kept growing infinitely.
				</div><div class="para">
					Instead of using a global <span class="type">enum</span> cache, Hibernate now uses a transient array for each <code class="classname">EnumType</code> instance to cache the enum values. This improves performance and eliminates the memory leak.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4926">JBPAPP-4926</a> </span></dt><dd><div class="para">
					The <code class="code">cascade-save</code> operation was incorrectly handling auto-incremented Primary Key (PK) tables that linked to parent tables with an assigned PK. The fix now allows the <code class="code">cascade-save</code> operation to handle the parent-child relationship between tables.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5394">JBPAPP-5394</a> </span></dt><dd><div class="para">
					An issue with <code class="literal">QueryPlanCache</code> was discovered that caused a memory leak due to soft references held by the unbound <code class="literal">SoftLimitMRUCache</code>. The <code class="literal">SoftLimitMRUCache</code> eventually filled up until a major stop-the-world garbage collection was necessary to clean the <code class="literal">SoftLimitMRUCache</code> soft references.
				</div><div class="para">
					The solution involves constraining the amount of soft and strong unbound references held in the cache. Entries are evicted using an LRU policy, or by memory pressure from the GC in the case of soft references.
				</div><div class="para">
					Two configuration options are now available, which solve the issue:
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							<code class="classname">hibernate.query.plan_cache_max_strong_references</code> which defaults to 128
						</div></li><li class="listitem"><div class="para">
							<code class="classname">hibernate.query.plan_cache_max_soft_references</code> which defaults to 2048
						</div></li></ul></div><div class="para">
					Users that want to emulate previous behavior, can set <code class="classname">hibernate.query.plan_cache_max_soft_references</code> to Integer.MAX_VALUE
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5405">JBPAPP-5405</a> </span></dt><dd><div class="para">
					According to the JPA persistence specification, the <code class="code">AS</code> keyword is optional for collection declarations, such as the following:
				</div><pre class="screen">
collection_member_declaration ::= IN (collection_valued_path_expression)
[AS] identification_variable
</pre><div class="para">
					A HQL/JPQA such as the one below syntax caused a parser exception:
				</div><pre class="screen">
SELECT o FROM EntityBean AS o, IN (o.items) AS l WHERE l.itemValue = '1'
</pre><div class="para">
					This occurred because Hibernate did not implement the <code class="code">AS</code> keyword. Hibernate now follows the specification in this area, and allows the optional keyword.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5409">JBPAPP-5409</a> </span></dt><dd><div class="para">
					Hibernate's <code class="methodname">ByteCodeHelper.readByteCode()</code> was previously limited to 409600 bytes, but can now handle an entity class of any size.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5478">JBPAPP-5478</a> </span></dt><dd><div class="para">
					<code class="code">ChainedPropertyAccessor</code> was used by <code class="code">AliasToBeanResultTransformer</code>. <code class="code">ChainedPropertyAccessor</code> was not serializable. Therefore, any cacheable queries using <code class="code">AliasToBeanResultTransformer</code> broke during cache replication. For example, this query could not be replicated or cached to disk:
				</div><pre class="programlisting JAVA"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span>session.<span xmlns="" class="perl_Function">createQuery</span>(<span xmlns="" class="perl_String">"select foo"</span>).<span xmlns="" class="perl_Function">setResultTransformer</span>(<span xmlns="" class="perl_Keyword">new</span> <span xmlns="" class="perl_Function">AliasToBeanResultTransformer</span>(SimpleCount.<span xmlns="" class="perl_Function">class</span>)).<span xmlns="" class="perl_Function">setCacheable</span>(<span xmlns="" class="perl_Keyword">true</span>).<span xmlns="" class="perl_Function">list</span>();
</pre><div class="para">
					The behavior of <code class="code">AliasToBeanResultTransformer</code> has been changed. When the <code class="code">AliasToBeanResultTransformer</code> is created/deserialized, it recreates the <code class="code">ChainedPropertyAccessor</code> instance according to the cached <code class="code">resultClass</code>. Cacheable queries using <code class="code">AliasToBeanResultTransformer</code> continue to work during cache replication.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5479">JBPAPP-5479</a> </span></dt><dd><div class="para">
					<code class="code">AliasToBeanResultTransformer.hashCode</code> relied on <code class="code">propertyAccessor.hashCode()</code>. Implementations of <code class="code">PropertyAccessor</code> do not override <code class="code">hashCode()</code> or <code class="code">equals()</code>. Therefore, Cache lookups involving a <code class="code">QueryKey</code> with an <code class="code">AliasToBeanResultTransformer</code> resulted in a cache miss.
				</div><div class="para">
					Two <code class="code">AliasToBeanResultTransformer</code> objects should only be equal and use the same hash code if their <code class="code">resultClass</code> is equal. Getters are determined by aliases, which are provided as an argument, so they are not needed to determine equality. Setters should be used to compute <code class="code">equals()</code> and <code class="code">hashCode()</code>. However, due to the implementations of Setter, Setters do not override <code class="code">hashCode()</code> or <code class="code">equals()</code>.
				</div><div class="para">
					The fix is to cache the aliases corresponding to the Setters and use that to check for equality. Cache lookups involving a <code class="code">QueryKey</code> with an <code class="code">AliasToBeanResultTransformer</code> no longer result in a cache miss.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5481">JBPAPP-5481</a> </span></dt><dd><div class="para">
					When Hibernate executed a cacheable query using a <code class="classname">ResultTransformer</code>, it attempted to cache the results. However, the data had the potential to be modified so that Hibernate could not read it.
				</div><div class="para">
					<code class="classname"> PropertyAccessException</code> was thrown when all of the following are true:
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							The query has a <code class="literal">ResultTransformer</code>
						</div></li><li class="listitem"><div class="para">
							Results are cached before being transformed
						</div></li><li class="listitem"><div class="para">
							Each result has a single value
						</div></li></ul></div><div class="para">
					This issue is fixed by introducing three new API calls:
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							<code class="code">org.hibernate.transform.AliasedTupleSubsetResultTransformer</code>
						</div></li><li class="listitem"><div class="para">
							<code class="code">org.hibernate.transform.CacheableResultTransformer</code>
						</div></li><li class="listitem"><div class="para">
							<code class="code">org.hibernate.transform.TupleSubsetResultTransformer</code>
						</div></li></ul></div><div class="para">
					Refer to the Hibernate Javadoc for more details.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5581">JBPAPP-5581</a> </span></dt><dd><div class="para">
					Hibernate Core <code class="code">EntityMetamodel entityNameByInheritenceClassNameMap</code> field was used inconsistently. It used a class for puts to the map, but a method for gets from it. An exception was thrown when saving instances of subclasses with specific entity names. The <code class="classname">EntityModel</code> class has been updated to use class <code class="classname">InheritenceClass</code> instead of its <code class="code">getName()</code> method. Saving instances of subclasses no longer causes an exception in these cases.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5763">JBPAPP-5763</a> </span></dt><dd><div class="para">
					When <code class="code">org.hibernate.id.enhanced.OptimizerFactory.PooledOptimizer</code> was used in multiple JVMs with the same database, there was a risk of duplicate sequenced values being generated. This occurred because a method was invoked twice to initialize two different values (value and hiValue). If another JVM requested a sequence value between these invocations, the sequence related to the second invocation. This issue has been corrected by limiting the double-read to optimizer initialization, when the first read gives Hibernate the <code class="code">initialValue</code>.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5765">JBPAPP-5765</a> </span></dt><dd><div class="para">
					If an entity defined a collection with a property-ref-based key as cacheable, there was a problem loading the collection and putting it into its second level cache region. Hibernate used the incorrect key for the owning entity. It attempted to use the referenced property value instead of the corresponding ID value.
				</div><div class="para">
					Hibernate now checks whether the collection key is defined by a property-ref. If so, the key of the owner instance associated with the collection itself is used, if it exists. Hibernate resolves the owner of the collection against the owner of the Persistence Context.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5814">JBPAPP-5814</a> </span></dt><dd><div class="para">
					Synchronizing access to <code class="code">Map</code> caused performance degredation. Synchronization of <code class="code">Map</code> is now managed by <code class="code">ReentrantReadWriteLock</code> and <code class="code">ConcurrentHashMap</code>, which improves performance.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5817">JBPAPP-5817</a> </span></dt><dd><div class="para">
					Many well-formatted and indented <code class="code">String</code>s were built up for each element of a parsed HQL string, for each tree node. The purpose was to feed invocations of <code class="code">log.trace()</code>. The information was added to the log regardless of the log level. This caused extra output and larger log files. Hibernate now checks the log level, and only includes the formatted output when the log level is <code class="literal">TRACE</code>.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5898">JBPAPP-5898</a> </span></dt><dd><div class="para">
					A customer reported an issue with the ScrollableResults JoinFetch, where ScrollableResults set child collection correctly at the first parent object, but after the second parent object only the first element of a child collection was included.
				</div><div class="para">
					The ScrollableResults logic has been improved to read sequentially. When a new parent is encountered, ScrollableResults assumes it has finished processing all rows for the previous parent.
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="important"><div class="admonition_header"><p><strong>Important</strong></p></div><div class="admonition"><div class="para">
						This fix relies on results being ordered consistently. Because some databases do not return sorted data (such as H2) you should explicitly apply "order by" for ScrollableResults result ordering.
					</div></div></div></dd></dl></div><div class="variablelist"><p class="title"><strong>IOPP</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-3134">JBPAPP-3134</a> </span></dt><dd><div class="para">
					<code class="filename">jboss-log4j.xml</code> has been updated to include the <code class="code">jacorb.config</code> log level. The priority has been set to <code class="code">ERROR</code> to avoid printing unnecessary messages to the console during server startup.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>Installer</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-2724">JBPAPP-2724</a> </span></dt><dd><div class="para">
					In the graphical installer, the directory selection dialog used the language specified in the environment where the installer was run, rather than the language requested by the user at the beginning of the installation. The installer has been updated so that the directory selection screen uses the language selected by the user at the beginning of the installation process.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4262">JBPAPP-4262</a> </span></dt><dd><div class="para">
					During installation of the Enterprise Application Platform on Solaris, the user was prompted for the root password. This was caused by permission issues when the installer tried to create some optional shortcuts (symbolic links). This issue has been fixed by removing the ability for Solaris platforms to create shortcuts through the installer. You can still create the symbolic links manually if needed.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5049">JBPAPP-5049</a> </span></dt><dd><div class="para">
					Previously, scripts for all operating systems were included when JBoss Enterprise Application Platform was installed, rather than being restricted to operating system being installed onto. The installer has been updated so that only appropriate scripts are included in the bin/ directory of the platform. Shell scripts are installed for Linux and UNIX systems, and batch scripts are included for Microsoft environments.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5087">JBPAPP-5087</a> </span></dt><dd><div class="para">
					The Red Hat documentation page has moved from <a href="http://www.redhat.com/docs">http://www.redhat.com/docs</a> to <a href="http://docs.redhat.com/">http://docs.redhat.com/</a>. The link has been updated in all documentation.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5110">JBPAPP-5110</a> </span></dt><dd><div class="para">
					The graphical installer allows you to specify a custom JAAS security domain for securing consoles and invokers. However, in the past, the Tomcat console was always secured with the JAAS security domain <code class="code">jmx-console</code>, even if it does not exist.
				</div><div class="para">
					This issue is fixed, and the Tomcat console is secured with the security domain you specify during installation.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5116">JBPAPP-5116</a> </span></dt><dd><div class="para">
					When a custom JAAS security domain was created during the graphical installation process, the custom JAAS security domain continued to use <code class="filename">jmx-console-users.properties</code> and <code class="filename">jmx-console-roles.properties</code>. This incorrect behavior has been changed, so that the custom JAAS security domain called <em class="replaceable">NAME</em> uses <code class="filename"><em class="replaceable">NAME</em>-users.properties</code> and <code class="filename"><em class="replaceable">NAME</em>-roles.properties</code> files instead.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5129">JBPAPP-5129</a> </span></dt><dd><div class="para">
					Seam examples were not correctly deployed using <code class="code">ant explode</code> due to faulty path delimiters in the <code class="filename">build.properties</code> file. This caused Seam example deployment to fail. The <code class="filename">build.properties</code> file now uses the correct path delimiters.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5132">JBPAPP-5132</a> </span></dt><dd><div class="para">
					In Microsoft Windows installations of the Seam examples, the <span class="guilabel"><strong>Deploy Hotel Booking Seam Demo</strong></span> shortcut in the Start Menu pointed to a directory one level above the JBoss Enterprise Application Platform installation. This caused an error of type <code class="code">NoClassDefFoundError</code> to appear in the log, and the example not to deploy. The path has been corrected, and the example now deploys from the shortcut.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5435">JBPAPP-5435</a> </span></dt><dd><div class="para">
					The security configuration screen of the graphical installer contained incorrect links to the documentation portal and user documentation. All links have been corrected.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>JCA</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4964">JBPAPP-4964</a> </span></dt><dd><div class="para">
					Due to a regression introduced by the fix in <a href="https://issues.jboss.org/browse/JBAS-5929">JBAS-5929</a>, the JCA pool sometimes shut down without looking for checked-out connections. This issue has been fixed, and the JCA pool looks for checked-out connections before shutting down.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5119">JBPAPP-5119</a> </span></dt><dd><div class="para">
					<code class="classname">XAManagedConnectionFactory</code> class did not allow for the <code class="literal">is</code> methodName form for getting and setting properties. This caused problems for XA DataSources when the property was a <span class="type">boolean</span> type. <code class="classname">XAManagedConnectionFactory</code> now allows for the <code class="literal">is</code> format and handles <span class="type">boolean</span> types without errors.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5374">JBPAPP-5374</a> </span></dt><dd><div class="para">
					Passing a negative timeout value to method <code class="methodname">Thread.sleep</code> in class <code class="classname">NewMsgsWorker#run()</code> caused the <code class="classname">Mail</code> message-driven bean to stop checking for new messages. This has been fixed by not allowing a negative timeout value.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5596">JBPAPP-5596</a> </span></dt><dd><div class="para">
					The JCA code did not properly handle multi-threaded access, due to several potential causes of deadlocks involving JDBC operations and the JBossTS transaction reaper thread. The JCA code has been updated to resolve these problems, and multi-threaded access should work properly in the JCA.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>Metadata</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4041">JBPAPP-4041</a> </span></dt><dd><div class="para">
					The <code class="code">ServiceMetaDataParser.parseValueFactoryParameter()</code> method only considered the first child of the <code class="code">&lt;parameter&gt;</code> element. If the <code class="code">&lt;null/&gt;</code> element was surrounded by carriage returns, the node was treated as a text value and the parameter was not correctly substituted elsewhere. The following example failed, but now works properly.
				</div><pre class="programlisting XML"><span xmlns="" class="line">​</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;parameter&gt;</span>
<span xmlns="" class="line">​</span>   <span xmlns="" class="perl_Keyword">&lt;null/&gt;</span>
<span xmlns="" class="line">​</span><span xmlns="" class="perl_Keyword">&lt;/parameter&gt;</span>
</pre></dd></dl></div><div class="variablelist"><p class="title"><strong>JMX</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5690">JBPAPP-5690</a> </span></dt><dd><div class="para">
					The <code class="classname">JMXOpsAccessControlFilter</code> class did not retain the role mappings for a user if the roles were set with the <code class="classname">DeploymentRolesMappingProvider</code>. The filter class has been corrected, and the mappings are now retained as expected.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>Messaging</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5241">JBPAPP-5241</a> </span></dt><dd><div class="para">
					Some debugging code was inadvertently left in <code class="code">ChannelSupport.afterRecoveryEx()</code>, and this code was visible in log files. It has been removed, making log files clearer and easier to read.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5280">JBPAPP-5280</a> </span></dt><dd><div class="para">
					The MessageSucker is responsible for migrating messages between different members of a cluster. The <code class="methodname">onMessage</code> routine attempts to deliver messages to the local queue, among other tasks. If delivery failed, messages appeared to be lost. They were still in the database, but it was difficult to redeliver them.
				</div><div class="para">
					This was a defect in the JBoss Messaging component, and has been fixed in that component. The fix is complex, and is discussed in <a href="https://issues.jboss.org/browse/JBMESSAGING-1822">JBMESSAGING-1822</a>. In short, a new layer of reliability has been added to the message delivery logic.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5415">JBPAPP-5415</a> </span></dt><dd><div class="para">
					A potential race condition could occur if a session was closed while a transaction was committing. In this case, an exception was thrown. A check has been added such that a committed message is not cancelled.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>mod_cluster</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-3463">JBPAPP-3463</a> </span></dt><dd><div class="para">
					Because of problems with the <code class="code">pause()</code> method of the connector, a race condition could occur when applications were undeployed. Sessions that were forwarded to the application server by mod_cluster before receiving an undeploy notification could result in an <code class="code">error 503 - This application is not currently available</code>. The method has been updated, addressing these issues.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5048">JBPAPP-5048</a> </span></dt><dd><div class="para">
					The status page of the mod_cluster manager was not updated upon failover, so worker nodes were listed as active and available after they had failed. The status page now updates when nodes fail.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5237">JBPAPP-5237</a> </span></dt><dd><div class="para">
					A server configured for failover with an application deployed in a subdirectory such as <code class="code">/webapp</code>, and another application deployed in <code class="code">/</code>, occasionally caused an error. This was because the failed-over application tried to deploy in <code class="code">/</code> instead of <code class="code">/webapp</code>. This situation has been fixed, and failover now occurs as expected.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5283">JBPAPP-5283</a> </span></dt><dd><div class="para">
					The maximum length for cluster aliases has been raised from <code class="literal">40</code> to <code class="literal">64</code>, to accommodate longer aliases.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5315">JBPAPP-5315</a> </span></dt><dd><div class="para">
					Clustered nodes were only retired after the worker retry timeout (set to 60 seconds). This resulted in error messages suggesting that a node was in error for 60 seconds when it was likely the node had retired correctly during this period. Nodes are now retired when the node receives a STATUS message, broadcast by the nodes approximately every 10 seconds.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5511">JBPAPP-5511</a> </span></dt><dd><div class="para">
					<code class="code">mod_rewrite</code> could not rewrite from the root (/) in httpd if there was no <code class="code">ROOT</code> context deployed in JBoss Enterprise Application Platform. This occurred because mod_cluster attempted to use the original URI instead of the URI provided by <code class="code">mod_rewrite</code>. The rewrite rule now works regardless of whether the <code class="code">ROOT</code> context is deployed to the platform.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>Other</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-3083">JBPAPP-3083</a> </span></dt><dd><div class="para">
					When AopC was in use, report generation failed with an exception of type <code class="code">ArrayIndexOutOfBoundsException</code>. This has been resolved so that a report is now generated as expected, and no exception is thrown.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-3308">JBPAPP-3308</a> </span></dt><dd><div class="para">
					In isolated deployments, a <code class="code">ClassNotFoundException</code> was thrown when the application server tried to deserialize an info object associated with the Timer. This occurred because the wrong classloader (<code class="code">threadContextClassLoader</code>) was used to deserialize the object. This bug has been fixed and the correct classloader is now used.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5148">JBPAPP-5148</a> </span></dt><dd><div class="para">
					Deployment file names were not previously checked for legal paths. Poorly-constructed file names could cause unexpected file deletions or alterations. The deployment files are now checked for legal paths, and an exception is thrown if an illegal path is used.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5232">JBPAPP-5232</a> </span></dt><dd><div class="para">
					Due to a casting problem where a <span class="type">long</span> was cast to an <span class="type">int</span>, using <code class="code">org.jboss.varia.scheduler.ScheduleManager</code> with a short period, such as 1 ms, could cause negative repeat values. This has been remedied by using a <span class="type">long</span> instead of an <span class="type">int</span>.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>Profile Service</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-2698">JBPAPP-2698</a> </span></dt><dd><div class="para">
					A bug in the Profile service caused the status of deployments to be reported incorrectly if they are started and stopped very quickly. This bug is still present. However, modifications have been made to the console to work around this by updating the status after a short delay, or after the page is refreshed. In normal usage, the status is shown as expected.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>Remoting</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5748">JBPAPP-5748</a> </span></dt><dd><div class="para">
					Sending multiple requests from a WS client and using <code class="code">fastinfoset</code> caused an increase of sockets in a <code class="code">CLOSE_WAIT</code> state and incorrect shutdown. This issue was fixed by introducing the <code class="code">org.jboss.ws.client.remoting.disconnect.after.use</code> JVM property, which causes the client remote to disconnect immediately. This property is enabled by default. If you disable it, <code class="code">HttpURLConnections</code> remain open.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>RESTEasy</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-2993">JBPAPP-2993</a> </span></dt><dd><div class="para">
					The <code class="code">spring-hibernate-contacts</code> example failed with the error:
				</div><pre class="screen">
java.lang.IllegalArgumentException: object is not an instance of declaring class
</pre><div class="para">
					This occurred because the <code class="code">getContactById(@PathParam("id") Long id)</code> method in the <code class="code">ContactServiceImpl</code> class was missing the @GET annotation. This error has been corrected, and the example code now works as expected.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>Scripts and commands</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5403">JBPAPP-5403</a> </span></dt><dd><div class="para">
					When starting the server using <code class="filename">service.bat</code>, no options were inherited from <code class="filename">run.conf.bat</code>. This occurred because <code class="code">service.bat</code> set <code class="code">JAVA_OPTS</code> to a placeholder value, which was not overridden by values set in <code class="code">run.conf.bat</code> due to a faulty check. This issue has been fixed, and options set in <code class="code">run.conf.bat</code> are now used when starting the server with <code class="code">service.bat</code>.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>Seam</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-3520">JBPAPP-3520</a> </span></dt><dd><div class="para">
					The <code class="code">JpdlParser</code> in JBPM included some hard-coded file names of XSDs, which referred to internet locations and ignored XSDs in the classpath. This caused failures when those internet locations were unavailable. The hard-coded paths have been removed and the classpath is now searched for the XSDs.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4231">JBPAPP-4231</a> </span></dt><dd><div class="para">
					A <code class="exceptionname">NullPointerException</code> occured when undeploying or uninstalling Seam examples. It did not cause any application to fail, but the error was incorrect. The issue occurred in the <em class="citetitle">nestedbooking</em>, <em class="citetitle">dvdstore</em>, <em class="citetitle">itext</em>, and <em class="citetitle">excel</em> examples, but not in the <em class="citetitle">ui</em> example. The cause was a bug in the EJB3 deployer, and an upgrade to that component resolved the issue. The <code class="exceptionname">NullPointerException</code> no longer occurs in the examples listed above.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4508">JBPAPP-4508</a> </span></dt><dd><div class="para">
					When uploading files with <code class="code">&lt;s:fileUpload&gt;</code> inside <code class="code">&lt;h:dataTable&gt;</code>, errors occurred which led to identical filenames and incorrect content. This occurred because the local value was not returned by the <code class="methodname">getLocalValue()</code> method. This problem has been fixed by correcting the method, and the problems with the filenames and content no longer occur.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4582">JBPAPP-4582</a> </span></dt><dd><div class="para">
					The IBM JVM v1.6 was not handling annotations that were UNKNOWN during runtime. This caused problems with the Chatroom example. The underlying issue is resolved on IBM JVM version 1.6.0 (SR9 FP1).
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						To make the chatroom example work with IBM JVM versions prior to 1.6.0 (SR9 FP1), copy http://repository.jboss.org/maven2/net/jcip/jcip-annotations/1.0/jcip-annotations-1.0.jar into <em class="replaceable">JBOSS_HOME</em>/server/<em class="replaceable">PROFILE</em>/lib.
					</div><div class="para">
						Restart the server after adding the specified file.
					</div></div></div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5013">JBPAPP-5013</a> </span></dt><dd><div class="para">
					The Seampay example had an issue with the duration between the first payment and the second payment in the example. Users with a combination of fast hardware, Java 6 runtime, and Windows Server 2003 found the set delay between payments to be too short. The example has been fixed to extend the duration between payments, which fixes the issue.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5015">JBPAPP-5015</a> </span></dt><dd><div class="para">
					The <code class="filename">jta.jar</code> was being included as a third-party dependency of Eclipse by the seam-gen process. The <code class="filename">jboss-transaction-api.jar</code> was included in the seam-gen process, but the two files caused a <code class="filename">.classpath</code> conflict. All Hibernate dependencies have been updated to exclude the <code class="filename">jta.jar</code> file, which fixes the dependency issue.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5056">JBPAPP-5056</a> </span></dt><dd><div class="para">
					The SeamBay example shipped as part of the Enterprise Platform contained an incompatibility with Internet Explorer 8. This has been resolved, and the example once again works with Internet Explorer 8.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5078">JBPAPP-5078</a> </span></dt><dd><div class="para">
					There were two identical <code class="code">ant.jar</code> libraries in the Seam distribution within the Enterprise Platform:
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="itemizedlist"><ul><li class="listitem"><div class="para">
							<code class="filename">/seam/lib/ant.jar</code>
						</div></li><li class="listitem"><div class="para">
							<code class="filename">/seam/lib/gen/ant.jar</code>
						</div></li></ul></div><div class="para">
					This issue has been fixed by removing the <code class="filename">ant.jar</code> from <code class="filename">seam/lib/</code>.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5410">JBPAPP-5410</a> </span></dt><dd><div class="para">
					An asynchronous invocation of JBPM which required transactional capabilities could cause the asynchronous action not to execute, if a transaction was not started. An exception was thrown and processing did not continue. This is fixed by checking whether transactions are required, and starting a new one if it is not already active, before initiating the asynchronous JBPM processing.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5469">JBPAPP-5469</a> </span></dt><dd><div class="para">
					During transactions where application exceptions were thrown, the transaction was neither committed nor rolled back. Instead it remained in memory. Transactions now roll back properly when exceptions are thrown, and are cleared from memory.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5496">JBPAPP-5496</a> </span></dt><dd><div class="para">
					The configuration for persistence service in <code class="filename">jbpm.cfg.xml</code> has been updated in the <em class="citetitle">Todo</em> and <em class="citetitle">DvdStore</em> examples, to use the following value: <code class="literal">&lt;service name="persistence" factory="org.jbpm.persistence.jta.JtaDbPersistenceServiceFactory" /&gt;</code>
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5517">JBPAPP-5517</a> </span></dt><dd><div class="para">
					If any exception occurred while a Seam EL expression was being evaluated during the <code class="code">jbpm-jpdl</code> process definition, JBPM's transaction handling sometimes committed transactions that should have been rolled back. Rollback only occurred on the Seam side, because Seam tried to close the JBPM Context while the JBPM process was committing. Seam now closes the JPBM context immediately after rolling back the transaction, and the dirty commits no longer occur.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5590">JBPAPP-5590</a> </span></dt><dd><div class="para">
					Invoking EntityQuery.resultCount() resulted in a query such as <code class="code">select count( entity )...</code>. However, if the persistence provider is Hibernate and the Entity has a composite key, the exception <code class="code">[ERROR JDBCExceptionReporter] Operand should contain 1 column(s)</code> is triggered, because Hibernate does not support composite keys in <code class="code">count</code> queries.
				</div><div class="para">
					This constraint prevented you from using seam-gen and JBoss Developer Studio to generate CRUDs if you had Entities with composite keys and you use Hibernate. Hibernate extensively uses <code class="code">EntityQuery.resultCount()</code> in the generated code, and this class triggered the exception.
				</div><div class="para">
					Seam has been updated, so that if the persistence provider is Hibernate, Seam builds the query using the notation <code class="code">select count( * )</code> instead of <code class="code">select count ( entity )</code>. This method works, even with composite keys. With this fix in place, <code class="code">EntityQuery.resultCount()</code> works for all entities and all persistence providers, as do generated CRUDs.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5823">JBPAPP-5823</a> </span></dt><dd><div class="para">
					Seam-RESTEasy integration module allowed anemic session requests to remain open when an exception occured during the JAX-RS request invocation. Accessing previously authenticated sessions was possible even if incorrect credentials were passed in a request. The code responsible for invalidating the session is now contained in a Java <code class="code">finally</code> block. This fix prevents anemic session requests from remaining open.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-6283">JBPAPP-6283</a> </span></dt><dd><div class="para">
					<code class="code">s:link</code> was not working if pages containing the <code class="code">s:link</code> were not previously rendered on the JBoss Enterprise Platform instance. This caused an <span class="errorcode">IllegalStateException: Unable to read &lt;page&gt;</span>, because the method binding for the Seam UI page actions were not added to the SafeActions on other servers. <code class="code">viewId</code> now includes the path to the web context root in each searching path, which allows pages to remain active when workload is moved between nodes.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-6362">JBPAPP-6362</a> </span></dt><dd><div class="para">
					In seam-gen, Entity fields that were annotated by <code class="literal">@Version</code> were set as an Integer data type. The Update operation was not compatible with the Integer data type, and terminated with a <code class="code">NullPointerException</code>. The <code class="code">@Version</code> data type has been changed from Integer to int. Entity Update operations now complete successfully.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-6387">JBPAPP-6387</a> </span></dt><dd><div class="para">
					It was found that JBoss Seam did not properly block access to JBoss Expression Language (EL) constructs in page exception handling, allowing arbitrary Java methods to be executed. A remote attacker could use this flaw to execute arbitrary code through a specially-crafted URL provided to certain applications based on the JBoss Seam 2 framework.
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						A properly configured and enabled Java Security Manager would prevent exploitation of this flaw. <a href="https://bugzilla.redhat.com/show_bug.cgi?id=692421">CVE-2011-1484</a>)
					</div></div></div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-6770">JBPAPP-6770</a> </span></dt><dd><div class="para">
					It was found that the fix for CVE-2011-1484 was incomplete: JBoss Seam 2 did not block access to all malicious JBoss Expression Language (EL) constructs in page exception handling, allowing arbitrary Java methods to be executed. A remote attacker could use this flaw to execute arbitrary code via a specially-crafted URL provided to certain applications based on the JBoss Seam 2 framework.
				</div><div xmlns:d="http://docbook.org/ns/docbook" class="note"><div class="admonition_header"><p><strong>Note</strong></p></div><div class="admonition"><div class="para">
						A properly configured and enabled Java Security Manager would prevent exploitation of this flaw. (CVE-2011-2196)
					</div></div></div></dd></dl></div><div class="variablelist"><p class="title"><strong>Security</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-2598">JBPAPP-2598</a> </span></dt><dd><div class="para">
					Applying the workaround for <a href="https://issues.jboss.org/browse/JBAS-7049">JBAS-7049</a> causes servers using OpenJDK 6 and running the security manager to fail to start the Enterprise Application Platform. This was due to upstream issues in OpenJDK. These issues have been addressed in the OpenJDK software, which is a third-party product. Therefore, the Enterprise Application Platform now starts as expected on affected systems with upgraded OpenJDK.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5459">JBPAPP-5459</a> </span></dt><dd><div class="para">
					Due to an error in the order of services starting up, <code class="code">JNDIContextEstablishment</code> could potentially start later than expected, causing <code class="code">NamingExceptions</code> because the context <code class="literal">java:/jaas</code> was not bound in JNDI. This binding is now handled in <code class="code">JaasSecurityManagerService</code>, which starts before any service in the <code class="code">deploy/</code> directory.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5691">JBPAPP-5691</a> </span></dt><dd><div class="para">
					<code class="code">unauthenticatedIdentity</code> The option did not work with the <code class="code">LdapExtLoginModule</code> class, even when the method invoked did not require a specific role. The security libraries have been updated to fix this issue.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5729">JBPAPP-5729</a> </span></dt><dd><div class="para">
					The <code class="filename">org.jboss.security.plugins.FilePassword</code> file previously required write permission even for decoding the password. The file could not be changed to read-only for regular users because it was inaccessible. This issue has been fixed by changing the file permissions from to read-only.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5940">JBPAPP-5940</a> </span></dt><dd><div class="para">
					<code class="code">LdapExtLoginModule</code> queried LDAP for the <code class="code">roleNameAttributeID</code> instead of checking the returned distinguished name. This was slow. To improve performance, a <code class="code">parseRoleNameFromDN</code> option has been added to the module.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>System</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5608">JBPAPP-5608</a> </span></dt><dd><div class="para">
					The <code class="code">QueuedPessimisticEJBLock</code> in JBoss Transactions did not always detect that a waiting transaction had timed out, so the lock would remain active when it should have been released. This eventually resulted in a threadpool-wide lock, with all transactions waiting for the lock to release, or the locked transaction to be registered as timed out. The <code class="code">isTxExpired()</code> method has been modified to ensure that timeouts are registered, so that transactions are informed of locks.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>Transactions</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5175">JBPAPP-5175</a> </span></dt><dd><div class="para">
					The JBossTS TransactionReaper contained a bug which caused it to execute continuously when it was running in dynamic mode, rather than pausing between runs. This caused performance degradation. To fix this issue, JBossTS was updated. As a result, the Reaper now pauses between runs, leading to better performance.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5195">JBPAPP-5195</a> </span></dt><dd><div class="para">
					The Transactions Recovery Manager searched for XIDs in need of recovery in such a way that sometimes recoverable XIDs were missed. This happened when consecutive recovery scans for a given resource manager returned non-equal lists of in-doubt XIDs. The matching algorithm has been enhanced to handle recoverable XIDs.
				</div><div class="para">
					When using TX Resource managers, which are JDBC drivers that support XA, it is an anti-pattern to rely on the order of the XIDs the Resource Manager returns to you, because you risk losing XIDs and causing heuristic exceptions, in which you will need to manually commit or roll back the transaction.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5775">JBPAPP-5775</a> </span></dt><dd><div class="para">
					When nodes unexpectedly die during active transaction processing, zero length transaction journal files may be created. Upon node restart, the processing of these files caused logged warning messages, even though they do not contain any information that can be used to recover the transactions in question. This fix suppresses the log for this specific situation.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>Varia</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5566">JBPAPP-5566</a> </span></dt><dd><div class="para">
					A bug in class <code class="classname">org.jboss.mail.SessionObjectFactory</code> caused only one mail service to ever be resolved, even if more than one service was configured and present in the JNDI tree. The class now resolves more than one mail service if one is configured.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>Web</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4960">JBPAPP-4960</a> </span></dt><dd><div class="para">
					<code class="code">sendNotification</code> was present in <code class="filename">org.jboss.web.tomcat.service.deployers.TomcatServices.java</code>, but was disabled, so the <code class="code">jboss.tomcat.connectors.started notification</code> was missing. The Barrier Controller depended on that notification and was unavailable to manage subscriptions. This problem has been fixed by reinstating <code class="code">sendNotification</code>.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5168">JBPAPP-5168</a> </span></dt><dd><div class="para">
					Customers migrating from Oracle WebLogic need the ability to rewrite URLs in a different context from the webapp. This feature is now implemented. To override the context, set <code class="code">-Dorg.apache.catalina.connector.Response.REWRITE_CONTEXT_CHECK=false</code>.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5293">JBPAPP-5293</a> </span></dt><dd><div class="para">
					The HTTPS connector used <code class="function">addHandshakeCompletedListener()</code> to verify a SSL handshake was successfully negotiated between the connector and listener. <code class="function">addHandshakeCompletedListener()</code> added the listener after the notification thread started running, which required SSL handshake renegotiation. <code class="function">setEnabledCipherSuites(new String[0])</code> is now used to verify SSL Handshake negotiations, which fixes the issue. This issue was introduced by a fix for CVE-2009-3555.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5813">JBPAPP-5813</a> </span></dt><dd><div class="para">
					When using the <code class="code">org.apache.tomcat.util.http.ServerCookie.VERSION_SWITCH=false</code> property, cookies containing characters <code class="literal">\</code>, <code class="literal">(</code>, <code class="literal">)</code>, <code class="literal">:</code>, <code class="literal">&lt;</code>, <code class="literal">=</code>, <code class="literal">&gt;</code>, <code class="literal">?</code>, <code class="literal">@</code>, <code class="literal">[</code>, <code class="literal">\\</code>, <code class="literal">]</code>, <code class="literal">{</code>, <code class="literal">}</code>, <code class="literal">(</code>, <code class="literal">:</code> were truncated to the first occurrence of one of the listed characters. Changes have been made to the way these characters are handled in the code which prevents cookies containing these characters being incorrectly truncated.
				</div></dd></dl></div><div class="variablelist"><p class="title"><strong>Web Services</strong></p><dl class="variablelist"><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4346">JBPAPP-4346</a> </span></dt><dd><div class="para">
					Fault signing and encryption have been added to JBoss WS. These features can be enabled by specifying <code class="literal">includeFaults="true"</code> on a sign or encrypt element. For the client, specify <code class="literal">includeFaults="true"</code> in the encryption and signature elements that are within a <code class="code">&lt;requires&gt;</code> tag to enforce signed/encrypted faults.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4506">JBPAPP-4506</a> </span></dt><dd><div class="para">
					When services were deployed to JBoss Web Services Native, any XML Schema Declaration (XSD) imports with relative URLs were rewritten as absolute URLs relative to the WSDL service contract. This worked fine, unless an imported XSD imported a second XSD using a relative path. In this case, the path of the second XSD was incorrectly rewritten to be relative to the first XSD instead of the WSDL service contract. This problem has been resolved, and the paths are now rewritten relative to the WSDL service contract.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4564">JBPAPP-4564</a> </span></dt><dd><div class="para">
					You can now disable chunked encoding using the SAAJ API, by calling <code class="methodname">soapMessage.getMimeHeaders().addHeader("Transfer-Encoding", "disabled");</code>.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-4920">JBPAPP-4920</a> </span></dt><dd><div class="para">
					Generating WSDL for JAX-WS resulted in an incorrect namespace prefix for the message part in the WSDL. The wrong namespace prefix was referenced if the exception was mapped to a different namespace that used the @WebFault annotation. This issue has been fixed by correcting how WSDL is generated, and the correct namespaces prefixes are now used.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5450">JBPAPP-5450</a> </span></dt><dd><div class="para">
					Due to an error in the SAAJ implementation in the JBossWS libraries, SOAP nodes previously had the same prefix as the <code class="code">&lt;Envelope&gt;</code> node. This has been corrected, so that SOAP nodes now have their own prefix.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5494">JBPAPP-5494</a> </span></dt><dd><div class="para">
					DescriptorDeploymentAspect loaded the <code class="filename">/cxf.xml</code> in the classpath and put it in the deployment attachment as the CXF endpoint deployment descriptor. This prevented the <code class="code">META-INF/jbossws-cxf.xml</code> or <code class="code">WEB-INF/jbossws-cxf.xml</code> from being loaded. These are intended to co-exist with <code class="code">/cxf.xml</code>, which creates the CXF bus. The code has been updated so that these files are now loaded properly.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5545">JBPAPP-5545</a> </span></dt><dd><div class="para">
					Appending an <code class="code">Element</code> to a <code class="code">SOAPBody</code> resulted in a <code class="code">java.lang.IllegalArgumentException</code>. The code has been updated so that adding an <code class="code">Element</code> now results in the <code class="code">Element</code> being converted to a <code class="code">SOAPElement</code>, and no exception is thrown.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5577">JBPAPP-5577</a> </span></dt><dd><div class="para">
					The logging level for <code class="code">MessageContextJAXWS</code> was too high when the conversion of a WSDL URL to a URI failed. This caused excessive log messages. The logging level for these messages has been lowered to reflect the true severity.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5710">JBPAPP-5710</a> </span></dt><dd><div class="para">
					When a request with an <code class="code">application/fastinfoset</code> content-type header was sent to the <code class="code">FastInfoset</code> web service, the response was returned with an incorrect header of <code class="code">application/soap+xml</code> or <code class="code">text/xml</code>. This issue has been corrected with an upgrade of the JBoss Web Services component.
				</div></dd><dt><span class="term"> <a href="https://issues.jboss.org/browse/JBPAPP-5826">JBPAPP-5826</a> </span></dt><dd><div class="para">
					JBossWS does not reuse an established SSL connection when sending multiple requests over SSL to JBoss Enterprise Application Platform. This means an SSL handshake occurs on every request. This issue has been fixed and the SSL handshake occurs once and is reused for every subsequent request, if a local WSDL is used.
				</div></dd></dl></div></div></body></html>