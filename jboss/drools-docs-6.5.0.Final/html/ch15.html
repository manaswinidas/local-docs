<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 15. Apache Camel Integration</title><link rel="stylesheet" type="text/css" href="css/jbossorg.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"/><link rel="home" href="index.html" title="Drools Documentation"/><link rel="up" href="pt04.html" title="Part IV. Drools Integration"/><link rel="prev" href="ch14.html" title="Chapter 14. Android Integration"/><link rel="next" href="ch16.html" title="Chapter 16. Drools Camel Server"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><p id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="ch14.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="ch16.html"><strong>Next</strong></a></li></ul><div class="chapter" title="Chapter 15. Apache Camel Integration"><div class="titlepage"><div><div><h2 class="title"><a id="ch.camel"/>Chapter 15. Apache Camel Integration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ch15.html#d0e16370">15.1. Camel</a></span></dt></dl></div><div class="section" title="15.1. Camel"><div class="titlepage"><div><div><h2 class="title"><a id="d0e16370"/>15.1. Camel</h2></div></div></div><p>Camel provides a light weight bus framework for getting information
  into and out of Drools.</p><p>Drools introduces two elements to make easy integration.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Drools Policy</p><p>Augments any JAXB or XStream data loaders. For JAXB it adds drools
      related paths ot the contextpath, for XStream it adds custom converters
      and aliases for Drools classes. It also handles setting the ClassLoader
      to the targeted ksession.</p></li><li class="listitem"><p>Drools Endpoint</p><p>Executes the payload against the specified drools session</p></li></ul></div><p>Drools can be configured like any normal camel component, but notice
  the policy that wraps the drools related segments. This will route all
  payloads to ksession1</p><div class="example"><a id="d0e16390"/><p class="title"><strong>Example 15.1. Drools EndPoint configured with the CXFRS producer</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;bean id="kiePolicy" class="org.kie.camel.component.KiePolicy" /&gt;

&lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring"&gt;  
   &lt;route&gt;
      &lt;from uri="cxfrs://bean://rsServer"/&gt;
         &lt;policy ref="kiePolicy"&gt;
            &lt;unmarshal ref="xstream" /&gt;       
            &lt;to uri="kie:ksession1" /&gt;
            &lt;marshal ref="xstream" /&gt;
       &lt;/policy&gt;
    &lt;/route&gt;
&lt;/camelContext&gt;</code></pre></div></div><br class="example-break"/><p>It is possible to not specify the session in the drools endpoint uri,
  and instead "multiplex" based on an attribute or header. In this example the
  policy will check either the header field "DroolsLookup" for the named
  session to execute and if that isn't specified it'll check the "lookup"
  attribute on the incoming payload. </p><div class="example"><a id="d0e16397"/><p class="title"><strong>Example 15.2. Drools EndPoint configured with the CXFRS producer</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;bean id="kiePolicy" class="org.kie.camel.component.KiePolicy" /&gt;

&lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring"&gt;  
   &lt;route&gt;
      &lt;from uri="cxfrs://bean://rsServer"/&gt;
         &lt;policy ref="kiePolicy"&gt;
            &lt;unmarshal ref="xstream" /&gt;       
            &lt;to uri="kie:dynamic" /&gt;
            &lt;marshal ref="xstream" /&gt;
       &lt;/policy&gt;
    &lt;/route&gt;
&lt;/camelContext&gt;</code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e16402"/><p class="title"><strong>Example 15.3. Java Code to execute against Route from a Spring and Camel
    Context</strong></p><div class="example-contents"><pre><code class="no-highlight">public class MyTest extends CamelSpringTestSupport {
    
    @Override
    protected AbstractXmlApplicationContext createApplicationContext() {        
        return new ClassPathXmlApplicationContext("org/drools/camel/component/CxfRsSpring.xml");
    }  

    public void test1() throws Exception {
        String cmd = "";
        cmd += "&lt;batch-execution lookup=\"ksession1\"&gt;\n";
        cmd += "  &lt;insert out-identifier=\"salaboy\"&gt;\n";
        cmd += "      &lt;org.drools.pipeline.camel.Person&gt;\n";
        cmd += "         &lt;name&gt;salaboy&lt;/name&gt;\n";
        cmd += "      &lt;/org.drools.pipeline.camel.Person&gt;\n";
        cmd += "   &lt;/insert&gt;\n";
        cmd += "   &lt;fire-all-rules/&gt;\n";
        cmd += "&lt;/batch-execution&gt;\n";
                
        Object object = this.context.createProducerTemplate().requestBody("direct://client", cmd);
        System.out.println( object ); 
    }
}    </code></pre></div></div><br class="example-break"/><p>The following urls show sample script examples for jaxb, xstream and
  json marshalling using:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/jaxb.mvt?r=HEAD</p></li><li class="listitem"><p>http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/jaxb.mvt?r=HEAD</p></li><li class="listitem"><p>http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/xstream.mvt?r=HEAD</p></li></ul></div></div></div><script type="text/javascript" src="highlight.js/highlight.pack.js"> </script><script type="text/javascript">hljs.initHighlightingOnLoad();</script><ul class="docnav"><li class="previous"><a accesskey="p" href="ch14.html"><strong>Prev</strong>Chapter 14. Android Integration</a></li><li class="up"><a accesskey="u" href="#"><strong>Up</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Home</strong></a></li><li class="next"><a accesskey="n" href="ch16.html"><strong>Next</strong>Chapter 16. Drools Camel Server</a></li></ul></body></html>