<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 12. CDI</title><link rel="stylesheet" type="text/css" href="css/jbossorg.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"/><link rel="home" href="index.html" title="Drools Documentation"/><link rel="up" href="pt04.html" title="Part IV. Drools Integration"/><link rel="prev" href="ch11.html" title="Chapter 11. Drools Commands"/><link rel="next" href="ch13.html" title="Chapter 13. Integration with Spring"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><p id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="ch11.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="ch13.html"><strong>Next</strong></a></li></ul><div class="chapter" title="Chapter 12. CDI"><div class="titlepage"><div><div><h2 class="title"><a id="CDIChapter"/>Chapter 12. CDI</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ch12.html#d0e14965">12.1. Introduction</a></span></dt><dt><span class="section"><a href="ch12.html#d0e14972">12.2. Annotations</a></span></dt><dd><dl><dt><span class="section"><a href="ch12.html#d0e14977">12.2.1. @KReleaseId</a></span></dt><dt><span class="section"><a href="ch12.html#d0e14982">12.2.2. @KContainer</a></span></dt><dt><span class="section"><a href="ch12.html#d0e15002">12.2.3. @KBase</a></span></dt><dt><span class="section"><a href="ch12.html#d0e15029">12.2.4. @KSession for KieSession</a></span></dt><dt><span class="section"><a href="ch12.html#d0e15056">12.2.5. @KSession for StatelessKieSession</a></span></dt></dl></dd><dt><span class="section"><a href="ch12.html#d0e15083">12.3. API Example Comparison</a></span></dt></dl></div><div class="section" title="12.1. Introduction"><div class="titlepage"><div><div><h2 class="title"><a id="d0e14965"/>12.1. Introduction</h2></div></div></div><p><a class="link" href="http://www.cdi-spec.org">CDI</a>, Contexts and  Dependency Injection,
      is Java specification that provides declarative controls and strucutres to an application. KIE
      can use it to automatically instantiate and bind things, without the need to use the
      programmatic API. </p></div><div class="section" title="12.2. Annotations"><div class="titlepage"><div><div><h2 class="title"><a id="d0e14972"/>12.2. Annotations</h2></div></div></div><p>@KContainer, @KBase and @KSession all support an optional 'name' attribute. CDI typically
      does "getOrCreate" when it injects, all injections receive the same instance for the same set
      of annotations. the 'name' annotation forces a unique instance for each name, although all
      instance for that name will be identity equals.</p><div class="section" title="12.2.1. @KReleaseId"><div class="titlepage"><div><div><h3 class="title"><a id="d0e14977"/>12.2.1. @KReleaseId</h3></div></div></div><p>Used to bind an instance to a specific version of a KieModule. If kie-ci is on the
        classpath this will resolve dependencies automatically, downloading from remote
        repositories.</p></div><div class="section" title="12.2.2. @KContainer"><div class="titlepage"><div><div><h3 class="title"><a id="d0e14982"/>12.2.2. @KContainer</h3></div></div></div><p>@KContainer is optional as it can be detected and added by the use of @Inject and
        variable type inferrence.</p><div class="figure"><a id="d0e14987"/><p class="title"><strong>Figure 12.1. Injects Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
private KieContainer kContainer;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e14992"/><p class="title"><strong>Figure 12.2. Injects KieContainer for Dynamic KieModule</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KReleaseId(groupId = "jar1", artifactId = "art1", version = "1.1")
private KieContainer kContainer;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e14997"/><p class="title"><strong>Figure 12.3. Injects named KieContainer for Dynamic KieModule</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KContainer(name = "kc1")
@KReleaseId(groupId = "jar1", artifactId = "art1", version = "1.1")
private KieContainer kContainer;</code></pre></div></div><br class="figure-break"/></div><div class="section" title="12.2.3. @KBase"><div class="titlepage"><div><div><h3 class="title"><a id="d0e15002"/>12.2.3. @KBase</h3></div></div></div><p>@KBase is optional as it can be detected and added by the use of @Inject and variable
        type inference.</p><p>The default argument, if given, maps to the value attribute and specifies the name of the KieBase from the
        kmodule.xml file.</p><div class="figure"><a id="d0e15009"/><p class="title"><strong>Figure 12.4. Injects the Default KieBase from the Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
private KieBase kbase;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15014"/><p class="title"><strong>Figure 12.5. Injects the Default KieBase from a Dynamic KieModule</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")   
private KieBase kbase;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15019"/><p class="title"><strong>Figure 12.6. Side by side version loading for 'jar1.KBase1' KieBase</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KBase("kbase1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase1v10;

@Inject
@KBase("kbase1") 
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.1")
private KieBase kbase1v10;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15024"/><p class="title"><strong>Figure 12.7. Use 'name' attribute to force new Instance for 'jar1.KBase1' KieBase</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KSession(value="kbase1", name="kb1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase1kb1;

@Inject  
@KSession(value="kbase1", name="kb2")    
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase1kb2;</code></pre></div></div><br class="figure-break"/></div><div class="section" title="12.2.4. @KSession for KieSession"><div class="titlepage"><div><div><h3 class="title"><a id="d0e15029"/>12.2.4. @KSession for KieSession</h3></div></div></div><p>@KSession is optional as it can be detected and added by the use of @Inject and variable
        type inference.</p><p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the
        kmodule.xml file</p><div class="figure"><a id="d0e15036"/><p class="title"><strong>Figure 12.8. Injects the Default KieSession from the Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
private KieSession ksession;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15041"/><p class="title"><strong>Figure 12.9. Injects the Default KieSession from a Dynamic KieModule</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")   
private KieSession ksession;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15046"/><p class="title"><strong>Figure 12.10. Side by side version loading for 'jar1.KBase1' KieBase</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KSession("ksession1") 
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksessionv10;

@Inject
@KSession("ksession1") 
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.1")
private KieSession ksessionv11;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15051"/><p class="title"><strong>Figure 12.11. Use 'name' attribute to force new Instance for 'jar1.KBase1' KieSession</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KSession(value="ksession1", name="ks1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession1ks1

@Inject  
@KSession(value="ksession1", name="ks2")    
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession1ks2</code></pre></div></div><br class="figure-break"/></div><div class="section" title="12.2.5. @KSession for StatelessKieSession"><div class="titlepage"><div><div><h3 class="title"><a id="d0e15056"/>12.2.5. @KSession for StatelessKieSession</h3></div></div></div><p>@KSession is optional as it can be detected and added by the use of @Inject and variable
        type inference.</p><p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the
        kmodule.xml file.</p><div class="figure"><a id="d0e15063"/><p class="title"><strong>Figure 12.12. Injects the Default StatelessKieSession from the Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
private StatelessKieSession ksession;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15068"/><p class="title"><strong>Figure 12.13. Injects the Default StatelessKieSession from a Dynamic KieModule</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")   
private StatelessKieSession ksession;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15073"/><p class="title"><strong>Figure 12.14. Side by side version loading for 'jar1.KBase1' KieBase</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KSession("ksession1") 
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.0")
private StatelessKieSession ksessionv10;

@Inject
@KSession("ksession1") 
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.1")
private StatelessKieSession ksessionv11;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15078"/><p class="title"><strong>Figure 12.15. Use 'name' attribute to force new Instance for 'jar1.KBase1'
          StatelessKieSession</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KSession(value="ksession1", name="ks1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession1ks1

@Inject  
@KSession(value="ksession1", name="ks2")    
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession1ks2</code></pre></div></div><br class="figure-break"/></div></div><div class="section" title="12.3. API Example Comparison"><div class="titlepage"><div><div><h2 class="title"><a id="d0e15083"/>12.3. API Example Comparison</h2></div></div></div><p>CDI can inject instances into fields, or even pass them as arguments. In this example field injection is
      used.</p><div class="figure"><a id="d0e15088"/><p class="title"><strong>Figure 12.16. CDI example for a named KieSession</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KSession("ksession1")
KieSession kSession;

public void go(PrintStream out) {
    kSession.setGlobal("out", out);
    kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
    kSession.fireAllRules();
}</code></pre></div></div><br class="figure-break"/><p>This is less code and more declarative than the API approach.</p><div class="figure"><a id="d0e15095"/><p class="title"><strong>Figure 12.17. API equivalent example for a named KieSession</strong></p><div class="figure-contents"><pre><code class="language-java">public void go(PrintStream out) {
    KieServices ks = KieServices.Factory.get();
    KieContainer kContainer = ks.getKieClasspathContainer();

    KieSession kSession = kContainer.newKieSession("ksession1");
    kSession.setGlobal("out", out);
    kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
    kSession.fireAllRules();
}</code></pre></div></div><br class="figure-break"/></div></div><script type="text/javascript" src="highlight.js/highlight.pack.js"> </script><script type="text/javascript">hljs.initHighlightingOnLoad();</script><ul class="docnav"><li class="previous"><a accesskey="p" href="ch11.html"><strong>Prev</strong>Chapter 11. Drools Commands</a></li><li class="up"><a accesskey="u" href="#"><strong>Up</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Home</strong></a></li><li class="next"><a accesskey="n" href="ch13.html"><strong>Next</strong>Chapter 13. Integration with Spring</a></li></ul></body></html>