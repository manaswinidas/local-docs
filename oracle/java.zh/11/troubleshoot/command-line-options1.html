<html lang="en-us"  xml:lang="en-us"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="This appendix describes some command-line options that can be useful when diagnosing problems with the Java HotSpot VM.">
      <meta name="description" content="This appendix describes some command-line options that can be useful when diagnosing problems with the Java HotSpot VM.">
      <title>Command-Line Options</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Troubleshooting Guide">
      <meta property="og:description" content="This appendix describes some command-line options that can be useful when diagnosing problems with the Java HotSpot VM.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Troubleshooting Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="troubleshooting-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-20T10:41:43-07:00">
      <meta name="dcterms.title" content="Troubleshooting Guide">
      <meta name="dcterms.dateCopyrighted" content="1995, 2018">
      <meta name="dcterms.category" content="java">
      <meta name="dcterms.identifier" content="E94880-01">
      
      <meta name="dcterms.product" content="en/java/javase/11">
      <meta name="dcterms.release" content="11">
      <link rel="prev" href="environment-variables-and-system-properties.html" title="Previous" type="text/html">
      <link rel="next" href="summary-tools-this-release.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"java","element_name":"Java","display_in_url":true},"suite":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product_group":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product":{"short_name":"javase","element_name":"Java SE","display_in_url":true},"release":{"short_name":"11","element_name":"11","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TROUBLESHOOT">
  <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="environment-variables-and-system-properties.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一个</a> <a href="summary-tools-this-release.html" class="pull-right">下一个<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">故障排除指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="appendix.html" property="item" typeof="WebPage"><span property="name">附录</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">命令行选项</li>
            </ol>
            <a id="GUID-A84ECBFB-B6CF-44C3-B627-58BB509C8D05" name="GUID-A84ECBFB-B6CF-44C3-B627-58BB509C8D05"></a><a id="JSTGD593"></a><a id="JSTGD592"></a>
            
            <h2 id="JSTGD-GUID-A84ECBFB-B6CF-44C3-B627-58BB509C8D05" class="sect2"><span class="enumeration_appendix">D</span>命令行选项</h2>
         </header>
         <div class="ind">
            <div>
               <p>本附录介绍了一些命令行选项，这些选项在诊断Java HotSpot VM的问题时很有用。</p>
               <p>本附录包含以下部分：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="command-line-options1.html#GUID-B5E16C7D-AE3C-40EB-A192-234C130766A6" title="带有-XX前缀的命令行选项特定于Java HotSpot虚拟机。这些选项中的许多对于性能调整和诊断目的都很重要，因此在本附录中进行了描述。">Java HotSpot VM命令行选项</a></p>
                  </li>
                  <li>
                     <p><a href="command-line-options1.html#GUID-DE9FAAAF-DCD4-4974-A86F-C6B8907CCE9A" title="除了-XX选项外，许多其他命令行选项还可以提供故障排除信息。">其他命令行选项</a></p>
                  </li>
               </ul>
            </div><a id="JSTGD602"></a><a id="JSTGD594"></a><div class="props_rev_3"><a id="GUID-B5E16C7D-AE3C-40EB-A192-234C130766A6" name="GUID-B5E16C7D-AE3C-40EB-A192-234C130766A6"></a><h3 id="JSTGD-GUID-B5E16C7D-AE3C-40EB-A192-234C130766A6" class="sect3">Java HotSpot VM命令行选项</h3>
               <div>
                  <p>带有前缀的命令行选项<code>-XX</code>特定于Java HotSpot虚拟机。这些选项中的许多对于性能调整和诊断目的都很重要，因此在本附录中进行了描述。
                  </p>
                  <div class="section">
                     <p>进一步了解所有可能<code>-XX</code>选项，请参阅<a href="http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html" target="_blank">Java HotSpot VM选项</a> 。
                     </p>
                     <p>您可以使用以下命令为指定的Java进程动态设置，取消设置或更改某些Java VM标志的值。 <code class="codeph">jinfo -flag</code>命令。请参见<a href="diagnostic-tools.html#GUID-8201B690-78C2-417A-8186-D6ECAAA07BEE" title="jinfo命令行实用程序从正在运行的Java进程或故障转储中获取配置信息，并打印用于启动JVM的系统属性或命令行标志。">jinfo实用程序</a>和<a href="diagnostic-tools.html#GUID-92074912-77E2-46B4-9A2F-A27F10331576" title="JDK下载中包含的另一个有用的工具是JConsole监视工具。该工具与JMX兼容。该工具使用JVM中的内置JMX工具来提供有关正在运行的应用程序的性能和资源消耗的信息。">JConsole</a>实用程序。
                     </p>
                     <p>有关这些标志的完整列表，请使用JConsole实用程序的<span class="bold">MBeans</span>选项卡。请参阅值列表<code class="codeph">DiagnosticOptions</code>的属性<code class="codeph">HotSpotDiagnostic</code> MBean，位于<code class="codeph">com.sun.management</code>域。以下是标志：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><code class="codeph">HeapDumpOnOutOfMemoryError</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">HeapDumpPath</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">PrintGC</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">PrintGCDetails</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">PrintGCTimeStamps</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">PrintClassHistogram</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">PrintConcurrentLocks</code></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-B5E16C7D-AE3C-40EB-A192-234C130766A6__CHDFDIJI">
                     <p class="subhead2" id="GUID-B5E16C7D-AE3C-40EB-A192-234C130766A6__GUID-637E0D77-2A39-47B1-AC40-21E6D77B32A4">-XX：HeapDumpOnOutOfMemoryError选项</p>
                     <p>当无法满足来自Java堆的分配或永久生成时，此选项告诉Java HotSpot VM生成堆转储。使用此选项运行不会产生任何开销，因此它对于生产系统非常有用， <code class="codeph">OutOfMemoryError</code>异常需要很长时间才能出现。
                     </p>
                     <p>您还可以在运行时使用<a href="diagnostic-tools.html#GUID-92074912-77E2-46B4-9A2F-A27F10331576" title="JDK下载中包含的另一个有用的工具是JConsole监视工具。该工具与JMX兼容。该工具使用JVM中的内置JMX工具来提供有关正在运行的应用程序的性能和资源消耗的信息。">JConsole</a>实用程序中的<span class="bold">MBeans</span>选项卡指定此选项。
                     </p>
                     <p>下面的示例显示在设置了此标志的情况下内存不足的结果。</p><pre class="pre codeblock"><code>$ <span class="bold"><code class="codeph">java -XX:+HeapDumpOnOutOfMemoryError -mn256m -mx512m ConsumeHeap</code></span>
java.lang.OutOfMemoryError: Java heap space
Dumping heap to java_pid2262.hprof ...
Heap dump file created [531535128 bytes in 14.691 secs]
Exception in thread "main" java.lang.OutOfMemoryError: Java heap space
        at ConsumeHeap$BigObject.(ConsumeHeap.java:22)
        at ConsumeHeap.main(ConsumeHeap.java:32)
</code></pre><p>的<code class="codeph">ConsumeHeap</code>填充Java堆并耗尽内存。当。。。的时候<code class="codeph">java.lang.OutOfMemoryError</code>引发异常，将创建堆转储文件。在这种情况下，文件为507 MB，并使用以下名称创建<code class="codeph">java_pid2262.hprof</code>在当前目录中。
                     </p>
                     <p>默认情况下，堆转储是在一个名为<code class="codeph">java_pid<span class="variable" translate="no">pid.hprof</span></code>如上例所示，在VM的工作目录中。您可以使用以下命令指定备用文件名或目录<code class="codeph">-XX:HeapDumpPath=</code>选项。例如<code class="codeph">-XX:HeapDumpPath=/disk2/dumps</code>将导致堆转储在生成<code>/disk2/dumps</code>目录。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-B5E16C7D-AE3C-40EB-A192-234C130766A6__CHDFEJBB">
                     <p class="subhead2" id="GUID-B5E16C7D-AE3C-40EB-A192-234C130766A6__GUID-F921471E-2AD1-4525-944D-43FB613EF3F4">-XX：OnError选项</p>
                     <p>发生致命错误时，Java HotSpot VM可以选择执行用户提供的脚本或命令。脚本或命令使用<code class="codeph">-XX:OnError=<span class="variable" translate="no">string</span></code>命令行选项，其中<code class="codeph"><span class="variable" translate="no">string</span></code>是单个命令，还是用分号分隔的命令列表。在此字符串中，所有出现的<code class="codeph">%p</code>被当前的PID替换，并且所有出现的<code class="codeph">%%</code>被单个替换<code class="codeph">%</code> 。以下示例演示了使用以下命令启动名为MyApp的Java应用程序时如何使用此选项： <code class="codeph">java</code>发射器。
                     </p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="bold"><code class="codeph">java -XX:OnError="pmap %p" MyApp</code></span></p>
                           <p>在Oracle Solaris操作系统上<code class="codeph">pmap</code>命令显示有关进程地址空间的信息。在此示例中，如果发生致命错误，则<code class="codeph">pmap</code>命令执行并显示当前进程的地址空间。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold"><code class="codeph">java -XX:OnError="cat hs_err_pid%p.log | mail support@acme.com" MyApp</code></span></p>
                           <p>在上面的示例中，发生致命错误时，致命错误日志文件的内容被邮寄到支持别名。</p>
                        </li>
                        <li>
                           <p><span class="bold"><code class="codeph">java -XX:OnError="gcore %p; dbx - %p" MyApp</code></span></p>
                           <p>在Oracle Solaris操作系统上<code class="codeph">gcore</code>命令创建指定进程的核心映像，并且<code class="codeph">dbx</code>命令启动调试器。在上面的示例中， <code class="codeph">gcore</code>执行命令以创建当前进程的核心映像，并在发生意外错误时启动调试器以附加到进程。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold"><code class="codeph">java -XX:OnError="gdb - %p" MyApp</code></span></p>
                           <p>在Linux上， <code class="codeph">gdb</code>命令启动调试器。在上面的示例中， <code class="codeph">gdb</code>遇到意外错误时，调试器将启动并附加到当前进程。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold"><code class="codeph">java -XX:OnError="userdump.exe %p" MyApp</code></span></p>
                           <p>在Windows上， <code class="codeph">userdump.exe</code>实用程序创建指定进程的故障转储。该实用程序不随Windows一起提供，应作为Microsoft OEM支持工具包的一部分从Microsoft网站下载。
                           </p>
                           <p>在示例中， <code class="codeph">userdump.exe</code>如果发生致命错误，将执行实用程序以创建当前进程的核心转储。
                           </p>
                           <div class="infoboxnote" id="GUID-B5E16C7D-AE3C-40EB-A192-234C130766A6__GUID-263FEA30-30BF-44CE-8150-4E11EC5F3DBA">
                              <p class="notep1">注意：</p>
                              <p>该示例假设通向<code class="codeph">userdump.exe</code>实用程序在中定义<code class="codeph">PATH</code>变量。
                              </p>
                           </div>
                        </li>
                     </ul>
                     <p>要了解有关在Windows上创建故障转储的更多信息，请参阅在Windows上<a href="submit-bug-report.html#GUID-F7841268-D783-4E3D-9BB3-3EB50CD186BE" title="在Windows操作系统中，有三种故障转储类型：Dr.Watson日志文件，用户小型转储和Dr.Watson完整转储。">收集故障转储</a> 。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-B5E16C7D-AE3C-40EB-A192-234C130766A6__CHDJIEHH">
                     <p class="subhead2" id="GUID-B5E16C7D-AE3C-40EB-A192-234C130766A6__GUID-12CB07F9-648D-4DE6-9C67-45E431E240E2">-XX：ShowMessageBoxOnError选项</p>
                     <p>设置此选项并发生致命错误时，HotSpot VM将显示有关致命错误的信息，并提示用户指定是否要启动本机调试器。对于Oracle Solaris和Linux操作系统，输出和提示将发送到应用程序控制台（标准输入和标准输出）。对于Windows，将弹出一个Windows消息框。</p>
                     <p>以下示例显示了Linux系统上的致命错误。</p><pre class="pre codeblock"><code>==============================================================================
Unexpected Error
------------------------------------------------------------------------------
SIGSEGV (0xb) at pc=0x2000000001164db1, pid=10791, tid=1026

Do you want to debug the problem?

To debug, run 'gdb /proc/10791/exe 10791'; then switch to thread 1026
Enter 'yes' to launch gdb automatically (PATH must include gdb)
Otherwise, press RETURN to abort...
==============================================================================
</code></pre><p>在这种情况下， <code class="codeph">SIGSEGV</code>错误发生，并提示用户指定是否<code class="codeph">gdb</code>将启动调试器以附加到该进程。如果用户输入<code class="codeph">y</code>要么<code class="codeph">yes</code> ， 然后<code class="codeph">gdb</code>将启动（假设它在<code class="codeph">PATH</code>变量）。
                     </p>
                     <p>在Oracle Solaris操作系统上，该消息与Linux示例类似，不同之处在于，提示用户启动Windows Server 2003。 <code class="codeph">dbx</code>调试器。
                     </p>
                     <p>在Windows上，将显示一个消息框。如果用户单击“ <span class="bold">是”</span> ，则VM将尝试启动默认调试器。该调试器由注册表设置配置，该设置<a href="submit-bug-report.html#GUID-F7841268-D783-4E3D-9BB3-3EB50CD186BE" title="在Windows操作系统中，有三种故障转储类型：Dr.Watson日志文件，用户小型转储和Dr.Watson完整转储。">在Windows上的“收集崩溃转储”中进行了</a>描述。如果安装了Microsoft Visual Studio，则通常将默认调试器配置为<code class="codeph">msdev.exe</code> 。
                     </p>
                     <p>在上面的示例中，输出包含PID（ <code class="codeph">pid=10791</code> ）以及线程ID（ <code class="codeph">tid=1026</code> ）。如果启动了调试器，则调试器中的初始步骤之一可能是选择线程并获取其堆栈跟踪。
                     </p>
                     <p>当进程正在等待响应时，可以使用其他工具来获取故障转储或查询进程的状态。例如，在Oracle Solaris操作系统上，可以使用以下命令获取核心转储： <code class="codeph">gcore</code>效用。
                     </p>
                     <p>在Windows上，可以使用<code class="codeph">userdump</code>要么<code class="codeph">windbg</code>程式。的<code class="codeph">windbg</code>该实用程序包含在Microsoft的Windows调试工具中，并<a href="submit-bug-report.html#GUID-F7841268-D783-4E3D-9BB3-3EB50CD186BE" title="在Windows操作系统中，有三种故障转储类型：Dr.Watson日志文件，用户小型转储和Dr.Watson完整转储。">在Windows上收集崩溃转储中进行了</a>描述。在<code class="codeph">windbg</code> ，选择“ <span class="bold">附加到进程”</span>菜单选项，该选项显示进程列表并提示输入PID。 HotSpot VM显示一个消息框，其中包含PID。选择PID之后， <code class="codeph">.dump /f</code>该命令可用于强制崩溃转储。<a href="command-line-options1.html#GUID-B5E16C7D-AE3C-40EB-A192-234C130766A6__CHDCJIHF">图D-1</a>是在名为的文件中创建的示例故障转储<code class="codeph">crash.dump</code> 。
                     </p>
                     <div class="figure" id="GUID-B5E16C7D-AE3C-40EB-A192-234C130766A6__CHDCJIHF">
                        <p class="titleinfigure">图D-1由windbg创建的故障转储示例</p><img src="img/crash-dump-windbg.gif" alt="图D-1的说明如下" title="图D-1的说明如下" longdesc="img_text/crash-dump-windbg.html"><br><a href="img_text/crash-dump-windbg.html">“图D-1由windbg创建的故障转储示例”的描述</a></div>
                     <!-- class="figure" -->
                     <p>一般来说， <code class="codeph">-XX:+ShowMessageBoxOnError</code>选项在可用调试器工具的开发环境中更有用。的<code class="codeph">-XX:OnError</code> option更适用于在发生致命错误时执行固定顺序的命令或脚本的生产环境。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-B5E16C7D-AE3C-40EB-A192-234C130766A6__CHDHGIDJ">
                     <p class="subhead2" id="GUID-B5E16C7D-AE3C-40EB-A192-234C130766A6__GUID-86DA3531-0CF3-4D64-9DFC-AC334368321F">其他-XX选项</p>
                     <p>其他几个<code class="codeph">-XX</code>进行故障排除时，命令行选项可能很有用：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><span class="bold"><code class="codeph">-XX:OnOutOfMemoryError</code></span><span class="italic"><code class="codeph">=string</code></span></p>
                           <p>此选项可用于指定在以下情况下执行的命令或脚本： <code class="codeph">OutOfMemoryError</code>引发异常。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold"><code class="codeph">-XX:ErrorFile</code></span><span class="italic"><code class="codeph">=filename</code></span></p>
                           <p>此选项可用于指定致命错误日志文件的位置。请参阅<a href="fatal-error-log.html#GUID-6903F4A6-326C-403F-9DF0-475DC50F42F8" title="要指定将在何处创建日志文件，请使用产品标记-XX：ErrorFile = file，其中file表示日志文件位置的完整路径。">致命错误日志的位置</a> 。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold"><code class="codeph">-xx:HeapDumpPath</code></span><span class="italic"><code class="codeph">=path</code></span></p>
                           <p>此选项可用于指定堆转储的位置。请参见<a href="command-line-options1.html#GUID-B5E16C7D-AE3C-40EB-A192-234C130766A6__CHDFDIJI">-XX：HeapDumpOnOutOfMemoryError选项</a> 。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold"><code class="codeph">-XX:MaxPermSize</code></span><span class="italic"><code class="codeph">=size</code></span></p>
                           <p>此选项可用于指定永久代内存的大小。请参阅<a href="troubleshoot-memory-leaks.html#GUID-19F6D28E-75A1-4480-9879-D0932B2F305B" title="java.lang。当没有足够的空间在Java堆中分配对象时，将引发OutOfMemoryError错误。">了解OutOfMemoryError异常</a> 。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold"><code class="codeph">-XX:+PrintCommandLineFlags</code></span></p>
                           <p>此选项可用于打印所有VM命令行标志。请参阅<a href="submit-bug-report.html#GUID-E0B90A72-D502-4DD7-B7E1-CF043CF74B40" title="通常，建议使用最新更新版本甚至最新的可用早期访问（EA）版本进行测试，以查看问题是否仍然存在，然后在创建错误报告或提交支持时收集尽可能多的相关数据。呼叫。">收集数据以获取错误报告</a> 。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold"><code class="codeph">-XX:+PrintConcurrentLocks</code></span></p>
                           <p>此选项可用于使Control + Break处理程序打印每个线程拥有的并发锁列表。</p>
                        </li>
                        <li>
                           <p><span class="bold"><code class="codeph">-XX:+PrintClassHistogram</code></span></p>
                           <p>此选项可用于使Control + Break处理程序打印堆直方图。</p>
                        </li>
                        <li>
                           <p><span class="bold"><code class="codeph">-XX:+PrintGCDetails</code></span>和<span class="bold"><code class="codeph">-XX:+PrintGCTimeStamps</code></span></p>
                           <p>这些选项可用于打印有关垃圾收集的详细信息。请参阅<a href="command-line-options1.html#GUID-DE9FAAAF-DCD4-4974-A86F-C6B8907CCE9A__CHDJIIFF">-verbose：gc选项</a> 。
                           </p>
                        </li>
                        <li>
                           <p><span class="bold"><code class="codeph">-XX:+UseAltSigs</code></span></p>
                           <p>在Oracle Solaris 8和9操作系统上，此选项可用于指示HotSpot VM使用备用信号来<code class="codeph">SIGUSR1</code>和<code class="codeph">SIGUSR2</code> 。请参见<a href="handle-signals-and-exceptions.html#GUID-F012840D-8E5A-4B6D-8E49-0129A9EE46DB" title="Java HotSpot VM安装信号处理程序以实现各种功能并处理致命的错误情况。">在Oracle Solaris，Linux和macOS上处理信号</a> 。</p>
                        </li>
                        <li>
                           <p><span class="bold"><code class="codeph">-XX:+UseConcMarkSweepGC</code></span> ， <span class="bold"><code class="codeph">-XX:+UseSerialGC</code></span>和<span class="bold"><code class="codeph">-XX:+UseParallelGC</code></span></p>
                           <p>这些选项可用于指定要使用的垃圾收集策略。请参阅<a href="troubleshoot-system-crashes.html#GUID-F364244B-ABC0-4FAF-AFA5-35BABA346E48" title="如果崩溃发生在垃圾收集过程中，则可能的解决方法。">在回收垃圾时解决崩溃</a> 。
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JSTGD603"></a><div class="props_rev_3"><a id="GUID-DE9FAAAF-DCD4-4974-A86F-C6B8907CCE9A" name="GUID-DE9FAAAF-DCD4-4974-A86F-C6B8907CCE9A"></a><h3 id="JSTGD-GUID-DE9FAAAF-DCD4-4974-A86F-C6B8907CCE9A" class="sect3">其他命令行选项</h3>
               <div>
                  <p>除了<code>-XX</code>选项，许多其他命令行选项可以提供故障排除信息。
                  </p>
                  <div class="section">
                     <p>本节介绍其中一些选项。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-DE9FAAAF-DCD4-4974-A86F-C6B8907CCE9A__CHDDEGBI">
                     <p class="subhead2" id="GUID-DE9FAAAF-DCD4-4974-A86F-C6B8907CCE9A__GUID-311C5F8C-815E-4275-A32F-5B27266E67EB">-Xcheck：jni选项</p>
                     <p>诊断使用Java本机接口（JNI）的应用程序的问题时，此选项很有用。有时，本机代码中的错误会导致HotSpot VM崩溃或行为不正确。</p>
                     <p>的<code class="codeph">-Xcheck:jni</code>选项将添加到启动应用程序的命令行中，如以下示例所示：</p><pre class="pre codeblock"><code>java -Xcheck:jni MyApp
</code></pre><p>的<code>-Xcheck:jni</code>选项使VM对传递给JNI函数的参数进行附加验证。
                     </p>
                     <div class="infoboxnote" id="GUID-DE9FAAAF-DCD4-4974-A86F-C6B8907CCE9A__GUID-652C835C-2CD6-4409-A0F1-278B6A6CDE31">
                        <p class="notep1">注意：</p>该选项不能保证在应用程序代码中找到所有无效的参数或诊断逻辑错误，但可以帮助诊断大量此类问题。
                     </div>
                     <p>当检测到无效参数时，VM会将消息打印到应用程序控制台或标准输出，并打印有问题的线程的堆栈跟踪，然后停止VM。</p>
                     <p>以下示例显示了<code class="codeph">null</code>值被错误地传递给JNI函数，该函数不允许<code class="codeph">null</code>值。
                     </p><pre class="pre codeblock"><code>FATAL ERROR in native method: Null object passed to JNI
    at java.net.PlainSocketImpl.socketAccept(Native Method)
    at java.net.PlainSocketImpl.accept(PlainSocketImpl.java:343)
    - locked &lt;0x450b9f70&gt; (a java.net.PlainSocketImpl)
    at java.net.ServerSocket.implAccept(ServerSocket.java:439)
    at java.net.ServerSocket.accept(ServerSocket.java:410)
    at org.apache.tomcat.service.PoolTcpEndpoint.acceptSocket
                        (PoolTcpEndpoint.java:286)
    at org.apache.tomcat.service.TcpWorkerThread.runIt
                        (PoolTcpEndpoint.java:402)
    at org.apache.tomcat.util.ThreadPool$ControlRunnable.run
                        (ThreadPool.java:498)
    at java.lang.Thread.run(Thread.java:536)
</code></pre><p>以下示例显示了提供给JNI函数的错误参数，该参数期望一个<code class="codeph">jfieldID</code>论点。
                     </p><pre class="pre codeblock"><code>FATAL ERROR in native method: Instance field not found in JNI get/set 
                        field operations
        at java.net.PlainSocketImpl.socketBind(Native Method)
        at java.net.PlainSocketImpl.bind(PlainSocketImpl.java:359)
        - locked &lt;0xf082f290&gt; (a java.net.PlainSocketImpl)
        at java.net.ServerSocket.bind(ServerSocket.java:318)
        at java.net.ServerSocket.&lt;init&gt;(ServerSocket.java:185)
        at jvm003a.&lt;init&gt;(jvm003.java:190)
        at jvm003a.&lt;init&gt;(jvm003.java:151)
        at jvm003.run(jvm003.java:51)
        at jvm003.main(jvm003.java:30)
</code></pre><p>以下是其他问题的示例<code class="codeph">-Xcheck:jni</code>选项可以帮助诊断：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>使用错误线程的JNI环境的情况</p>
                        </li>
                        <li>
                           <p>使用无效的JNI引用的情况</p>
                        </li>
                        <li>
                           <p>向需要数组类型的函数提供对非数组类型的引用的情况</p>
                        </li>
                        <li>
                           <p>向需要静态字段ID的函数提供非静态字段ID的情况</p>
                        </li>
                        <li>
                           <p>进行JNI调用且异常未决的情况</p>
                        </li>
                     </ul>
                     <p>一般而言， <code class="codeph">-Xcheck:jni</code>选项是致命错误（即，打印错误并停止VM）。在JNI关键区域内进行JNI调用时，此行为有一个例外。在这种情况下，将显示以下非致命警告消息，如以下示例所示。
                     </p><pre class="pre codeblock"><code>Warning: Calling other JNI functions in the scope of 
Get/ReleasePrimitiveArrayCritical or Get/ReleaseStringCritical
</code></pre><p>当本机代码使用JNI函数时，将创建JNI关键区域<code class="codeph">GetPrimitiveArrayCritical</code>要么<code class="codeph">GetStringCritical</code>获取对Java堆中的数组或字符串的引用。保留引用，直到本机代码调用相应的释放函数。get和release之间的代码称为JNI关键部分，在此期间，HotSpot VM无法将VM置于允许进行垃圾收集的状态。一般建议不要在JNI关键节中使用其他JNI函数，尤其不要使用任何可能导致死锁的JNI函数。上面印有的警告<code class="codeph">-Xcheck:jni</code>因此，选项表明存在潜在问题；它并不总是表示应用程序错误。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-DE9FAAAF-DCD4-4974-A86F-C6B8907CCE9A__CHDJECGJ">
                     <p class="subhead2" id="GUID-DE9FAAAF-DCD4-4974-A86F-C6B8907CCE9A__GUID-891AEA7B-B7FE-456F-A4D7-CD1881D48BD9">-verbose：class选项</p>
                     <p>此选项启用记录类加载和卸载。</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-DE9FAAAF-DCD4-4974-A86F-C6B8907CCE9A__CHDJIIFF">
                     <p class="subhead2" id="GUID-DE9FAAAF-DCD4-4974-A86F-C6B8907CCE9A__GUID-85FD4428-7018-43C6-BB24-AE43B953310D">-verbose：gc选项</p>
                     <p>此选项启用日志记录垃圾收集（GC）信息。可以与其他HotSpot VM特定选项结合使用，例如<code>-XX:+PrintGCDetails</code>和<code>-XX:+PrintGCTimeStamps</code>以获得有关GC的更多信息。信息输出包括每个GC之前和之后的世代大小，堆的总大小，升级的对象的大小以及花费的时间。
                     </p>
                     <p>有关这些选项的更多信息，以及有关GC分析和调整的详细信息，请参见<a href="http://www.oracle.com/technetwork/articles/javase/gcportal-136937.html" target="_blank">GC Portal文章</a> 。
                     </p>
                     <p>的<code>-verbose:gc</code>可以使用管理API或JVM TI在运行时动态启用该选项。请参阅<a href="diagnostic-tools.html#GUID-55FDAAC0-8FA8-4F12-AE28-1E768FB49901" title="JDK具有广泛的API，可以开发自定义工具来观察，监视，分析，调试和诊断JRE中部署的应用程序中的问题。">自定义诊断工具</a> 。
                     </p>
                     <p>当该工具连接到管理VM时，JConsole监视和管理工具还可以启用或禁用该选项。参见<a href="diagnostic-tools.html#GUID-92074912-77E2-46B4-9A2F-A27F10331576" title="JDK下载中包含的另一个有用的工具是JConsole监视工具。该工具与JMX兼容。该工具使用JVM中的内置JMX工具来提供有关正在运行的应用程序的性能和资源消耗的信息。">JConsole</a> 。
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-DE9FAAAF-DCD4-4974-A86F-C6B8907CCE9A__CHDCHGEE">
                     <p class="subhead2" id="GUID-DE9FAAAF-DCD4-4974-A86F-C6B8907CCE9A__GUID-D746C849-A41F-48DA-990C-51D33CA48854">-verbose：jni选项</p>
                     <p>此选项启用JNI的日志记录。解析JNI或本机方法后，HotSpot VM将跟踪消息打印到应用程序控制台（标准输出）。使用JNI注册本机方法时，它还会打印跟踪消息。 <code class="codeph">RegisterNative</code>功能。的<code>-verbose:jni</code>在诊断使用本机库的应用程序的问题时，此选项很有用。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   

</body></html>