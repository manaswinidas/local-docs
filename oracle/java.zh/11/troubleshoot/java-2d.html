<html lang="en-us"  xml:lang="en-us"><head></head><body >﻿
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="Information and guidance for troubleshooting some of the most common issues that might be found in the Java 2D API.">
      <meta name="description" content="Information and guidance for troubleshooting some of the most common issues that might be found in the Java 2D API.">
      <title>Java 2D</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Troubleshooting Guide">
      <meta property="og:description" content="Information and guidance for troubleshooting some of the most common issues that might be found in the Java 2D API.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Troubleshooting Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="troubleshooting-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-20T10:41:43-07:00">
      <meta name="dcterms.title" content="Troubleshooting Guide">
      <meta name="dcterms.dateCopyrighted" content="1995, 2018">
      <meta name="dcterms.category" content="java">
      <meta name="dcterms.identifier" content="E94880-01">
      
      <meta name="dcterms.product" content="en/java/javase/11">
      <meta name="dcterms.release" content="11">
      <link rel="prev" href="java-2d-pipeline-rendering-and-properties.html" title="Previous" type="text/html">
      <link rel="next" href="swing.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"java","element_name":"Java","display_in_url":true},"suite":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product_group":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product":{"short_name":"javase","element_name":"Java SE","display_in_url":true},"release":{"short_name":"11","element_name":"11","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TROUBLESHOOT">
  <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script>
   
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="java-2d-pipeline-rendering-and-properties.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一个</a> <a href="swing.html" class="pull-right">下一个<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">故障排除指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="debug-client-issues.html" property="item" typeof="WebPage"><span property="name">调试客户端问题</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Java 2D</li>
            </ol>
            <a id="GUID-63FAD092-E3E7-416D-9CA3-25BBACFC46E9" name="GUID-63FAD092-E3E7-416D-9CA3-25BBACFC46E9"></a><a id="JSTGD447"></a><a id="JSTGD446"></a>
            
            <h2 id="JSTGD-GUID-63FAD092-E3E7-416D-9CA3-25BBACFC46E9" class="sect2"><span class="enumeration_chapter">12</span> Java 2D</h2>
         </header>
         <div class="ind">
            <div>
               <p>有关对Java 2D API中可能发现的一些最常见问题进行故障排除的信息和指南。</p>
               <p>本章包含以下部分：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="java-2d.html#GUID-74778D56-6201-4A60-B1CA-C304CD0B8A71" title="与Java 2D硬件加速的渲染基元有关的通用性能问题，以及如何检测基元跟踪并避免非加速的渲染。">通用性能问题</a></p>
                  </li>
                  <li>
                     <p><a href="java-2d.html#GUID-02BB2984-92CA-40E6-ACF6-CB8EB065F8B9" title="与文本呈现相关的可能的问题和崩溃，并描述了克服此类问题的技巧。">文字相关问题</a></p>
                  </li>
                  <li>
                     <p><a href="java-2d.html#GUID-17CCB9A9-F9A6-4541-A536-7259AAF90044" title="Java 2D打印可能发生的问题列表。">Java 2D打印</a></p>
                  </li>
               </ul>
               <p>有关Java 2D属性的摘要，请参见<a href="java-2d-properties.html#GUID-2DC38ED7-7F26-4489-B3B5-C3B0B31E2786" title="本附录提供了可用于对Java 2D进行故障诊断的属性。">Java 2D属性</a> 。
               </p>
            </div><a id="JSTGD448"></a><div class="props_rev_3"><a id="GUID-74778D56-6201-4A60-B1CA-C304CD0B8A71" name="GUID-74778D56-6201-4A60-B1CA-C304CD0B8A71"></a><h3 id="JSTGD-GUID-74778D56-6201-4A60-B1CA-C304CD0B8A71" class="sect3">通用性能问题</h3>
               <div>
                  <p>与Java 2D硬件加速的渲染基元有关的通用性能问题，以及如何检测基元跟踪并避免非加速的渲染。</p>
                  <p>可能有许多导致渲染性能不佳的原因。以下主题确定了导致应用程序渲染性能不佳的原因，并提出了一些改善纯软件渲染性能的方法。</p>
                  <p>本主题包含以下小节：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="java-2d.html#GUID-4576F21A-3BA5-4284-8AA1-C9A57E67EAE4" title="为了更好地了解可能导致性能问题的原因，请看一下硬件加速的含义。">硬件加速的渲染基元</a></p>
                     </li>
                     <li>
                        <p><a href="java-2d.html#GUID-35400B5A-A20D-4AFE-8A2C-1E1BD8AA5687" title="要检测非加速渲染，可以使用Java 2D基本体跟踪。">原始跟踪以检测和避免非加速渲染</a></p>
                     </li>
                     <li>
                        <p><a href="java-2d.html#GUID-974F86E9-8DFD-4551-9AF7-1D91D7F71403" title="渲染性能不佳的原因列表以及可能的替代方法。">渲染效果不佳的原因</a></p>
                     </li>
                     <li>
                        <p><a href="java-2d.html#GUID-D5849E59-9EB6-46FA-BA47-EA5C52DFA077" title="改善纯软件渲染性能的方法。">提高纯软件渲染的性能</a></p>
                     </li>
                  </ul>
               </div><a id="JSTGD449"></a><div class="props_rev_3"><a id="GUID-4576F21A-3BA5-4284-8AA1-C9A57E67EAE4" name="GUID-4576F21A-3BA5-4284-8AA1-C9A57E67EAE4"></a><h4 id="JSTGD-GUID-4576F21A-3BA5-4284-8AA1-C9A57E67EAE4" class="sect4">硬件加速的渲染基元</h4>
                  <div>
                     <p>为了更好地了解可能导致性能问题的原因，请看一下硬件加速的含义。</p>
                     <p>通常，硬件加速渲染可以分为两类。</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>硬件加速渲染到“加速”目标。可以硬件加速的渲染目标的示例是<code class="codeph">VolatileImage</code> ，屏幕和<code class="codeph">BufferStrategy</code> 。如果加速了目的地，则可以通过视频硬件执行渲染到表面。因此，如果您发出<code class="codeph">drawRect</code>调用，Java 2D将此调用重定向到底层的本机API（例如GDI，DirectDraw，Direct3D或OpenGL或X11），后者使用硬件执行操作。
                           </p>
                        </li>
                        <li>
                           <p>将图像缓存在加速内存（视频内存或像素图）中，以便可以将它们非常快速地复制到另一个加速表面。这些图像称为托管图像。</p>
                        </li>
                     </ul>
                     <p>理想情况下，在加速表面上执行的所有操作都应通过硬件加速。在这种情况下，应用程序将充分利用平台提供的功能。</p>
                     <p>不幸的是，在许多情况下，默认管道无法使用硬件进行渲染。由于管道限制或底层本机API，可能会发生这种情况。例如，大多数X服务器不支持渲染抗锯齿原语或alpha合成。</p>
                     <p>性能问题的一个原因是执行的操作未通过硬件加速。即使在加速目标表面的情况下，某些图元也可能不是。</p>
                     <p>知道如何检测不使用硬件加速的情况非常重要。知道这一点可能有助于提高性能。</p>
                  </div>
               </div><a id="JSTGD450"></a><div class="props_rev_3"><a id="GUID-35400B5A-A20D-4AFE-8A2C-1E1BD8AA5687" name="GUID-35400B5A-A20D-4AFE-8A2C-1E1BD8AA5687"></a><h4 id="JSTGD-GUID-35400B5A-A20D-4AFE-8A2C-1E1BD8AA5687" class="sect4">原始跟踪以检测和避免非加速渲染</h4>
                  <div>
                     <p>要检测非加速渲染，可以使用Java 2D基本体跟踪。</p>
                     <div class="section">
                        <p>Java 2D具有内置的原始跟踪。</p>
                        <p>运行您的应用程序<code class="codeph">-Dsun.java2d.trace=count</code> 。当应用程序退出时，基元及其计数列表将打印到控制台。
                        </p>
                        <p>每当你看到一个<code class="codeph">MaskBlit</code>或任何<code class="codeph">General*</code>原语，通常意味着您的某些渲染正在经历软件循环。这是执行结果<code class="codeph">drawImage</code>半透明<code class="codeph">BufferedImage</code>到<code class="codeph">VolatileImage</code>在Linux上：</p><pre class="pre codeblock"><code>sun.java2d.loops.Blit$GeneralMaskBlit::Blit(IntArgb, SrcOverNoEa, "Integer BGR Pixmap")sun.java2d.loops.MaskBlit::MaskBlit(IntArgb, SrcOver, IntBgr)
</code></pre><div class="p">这是默认管线中的一些常见的非加速原语，以及它们在跟踪输出中的签名。
                           <div class="infoboxnote" id="GUID-35400B5A-A20D-4AFE-8A2C-1E1BD8AA5687__GUID-E707A89B-FE5A-4775-909D-C38645FBBC25">
                              <p class="notep1">注意：</p>大多数这种跟踪是在Linux上进行的。您可能会看到一些差异，具体取决于您的平台和配置。
                           </div>
                        </div>
                     </div>
                     <!-- class="section" -->
                     <ul>
                        <li class="stepexpand"><span>半透明图像（具有<span class="apiname">ColorModel.getTranslucency（）的</span>图像返回<code class="codeph">Translucency.TRANSLUCENT</code> ），或带有<code class="codeph">AlphaCompositing</code> 。示例原始跟踪输出：</span><div><pre class="pre codeblock"><code>sun.java2d.loops.Blit$GeneralMaskBlit::Blit(IntArgb,SrcOverNoEa, "Integer BGR Pixmap")sun.java2d.loops.MaskBlit::MaskBlit(IntArgb, SrcOver, IntBgr)
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>使用抗锯齿（通过设置抗锯齿提示）。示例原始跟踪输出：</span><div><pre class="pre codeblock"><code>sun.java2d.loops.MaskFill::MaskFill(AnyColor, Src, IntBgr)
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>渲染抗锯齿的文本（设置文本抗锯齿提示）。样本输出可以是以下之一：</span><div>
                              <ul style="list-style-type:disc">
                                 <li><pre class="pre codeblock"><code>sun.java2d.loops.DrawGlyphListAA::DrawGlyphListAA(OpaqueColor, SrcNoEa, AnyInt)
</code></pre></li>
                                 <li><pre class="pre codeblock"><code>sun.java2d.loops.DrawGlyphListLCD::DrawGlyphListLCD(AnyColor, SrcNoEa, IntBgr)
</code></pre></li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Alpha合成，方法是使用半透明颜色（Alpha值不是<code class="codeph">0xff</code> ）或设置非默认值<code class="codeph">AlphaCompositing</code>模式与<code class="codeph">Graphics2D.setComposite()</code> ：</span><div><pre class="pre codeblock"><code>sun.java2d.loops.Blit$GeneralMaskBlit::Blit(IntArgb, SrcOver, IntRgb)sun.java2d.loops.MaskBlit::MaskBlit(IntArgb, SrcOver, IntRgb)
]</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>非平凡的转换（如果转换不只是翻译）。将转换后的不透明图像渲染为<code class="codeph">VolatileImage</code> ：</span><div><pre class="pre codeblock"><code>sun.java2d.loops.TransformHelper::TransformHelper(IntBgr, SrcNoEa, IntArgbPre)
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>渲染旋转线：</span><div><pre class="pre codeblock"><code>sun.java2d.loops.DrawPath::DrawPath(AnyColor, SrcNoEa, AnyInt)
</code></pre><p>通过跟踪运行您的应用程序，并确保除非需要它们，否则不要使用未加速的原语。</p>
                           </div>
                        </li>
                     </ul>
                  </div>
               </div><a id="JSTGD451"></a><div class="props_rev_3"><a id="GUID-974F86E9-8DFD-4551-9AF7-1D91D7F71403" name="GUID-974F86E9-8DFD-4551-9AF7-1D91D7F71403"></a><h4 id="JSTGD-GUID-974F86E9-8DFD-4551-9AF7-1D91D7F71403" class="sect4">渲染效果不佳的原因</h4>
                  <div>
                     <p>渲染性能不佳的原因列表以及可能的替代方法。</p>
                     <div class="section">
                        <p>渲染性能不佳的一些可能原因及其替代方法如下所述：</p>
                     </div>
                     <!-- class="section" -->
                     <ul>
                        <li class="stepexpand"><span><span class="bold">混合加速和非加速渲染</span> ：</span><div>
                              <p>当渲染到加速的表面时，特定的管道只能加速应用程序渲染的部分原语的情况，这可能会导致抖动，因为管道将不断尝试调整以获得更好的渲染性能，但收效甚微。</p>
                              <p>如果事先知道大多数渲染图元不会被加速，则最好将其中一个渲染为<code class="codeph">BufferedImage</code>然后将其复制到后台缓冲区或屏幕，或使用讨论的标志之一切换到非硬件加速的管道。
                              </p>
                              <div class="infoboxnote" id="GUID-974F86E9-8DFD-4551-9AF7-1D91D7F71403__GUID-3C0A6989-2431-457B-BFF3-8D35CF0D35CF">
                                 <p class="notep1">注意：</p>
                                 <p>这种方法可能会限制您的应用程序利用Java 2D对硬件加速的未来改进的优势。</p>
                              </div>
                              <div class="p">例如，如果您的应用程序经常在远程X服务器的情况下使用，但是它大量使用抗锯齿，alpha合成等，那么性能可能会严重下降。为避免这种情况，请通过设置<code>-Dsun.java2d.pmoffscreen=false</code>属性，可以将其传递给Java运行时，也可以使用<span class="apiname">System.setProperty（）</span> API以编程方式进行设置。<div class="infoboxnote" id="GUID-974F86E9-8DFD-4551-9AF7-1D91D7F71403__GUID-EC3F73DF-4964-4E3F-8032-C3D30447AC86">
                                    <p class="notep1">注意：</p>必须在与GUI相关的任何操作之前设置此属性，因为它只能读取一次。
                                 </div>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span><span class="bold">非最佳渲染图元</span> ：</span><div>
                              <p>最好使用最简单的图元来实现所需的视觉效果。</p>
                              <p>例如，使用<span class="apiname">Graphics.drawLine（）</span>而不是新的<span class="apiname">Line2D（）。draw（）</span> 。结果看起来一样。但是，第二个操作的计算量大得多，因为将其渲染为通用形状，通常渲染起来要昂贵得多。形状在原始跟踪中以不同方式显示，具体取决于抗锯齿设置和特定的管线，但是很可能它们会显示的数量<code class="codeph">*FillSpans</code>要么<code class="codeph">DrawPath</code>原语。
                              </p>
                              <p>复杂属性的另一个示例是<code class="codeph">GradientPaint</code> 。尽管它可以通过某些非默认管道（例如OpenGL）由硬件加速，但不是通过默认管道进行硬件加速。因此，您可以限制使用<code class="codeph">GradientPaint</code>如果它导致性能问题。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span><span class="bold">基于堆的目标表面</span> <code class="codeph">BufferedImage</code> ：</span><div>
                              <p>渲染到<code class="codeph">BufferedImage</code>几乎总是使用软件循环。
                              </p>
                              <p>在某些SPARC系统上，有一个例外是VIS指令集可用于加速某些成像操作。参见<a href="https://docs.oracle.com/cd/E19120-01/open.solaris/816-1681/sparcv9-tbl-26/" target="_blank">VIS指令集</a> 。
                              </p>
                              <p>为确保渲染具有硬件加速的机会，请选择一个<code class="codeph">BufferStrategy</code>或<code class="codeph">VolatileImage</code>对象作为渲染目标。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span><span class="bold">击败内置的加速机制</span> ：</span><div>
                              <p>Java 2D尝试加速某些类型的图像。图像内容可以缓存在视频内存中，以便更快地复制到加速的目的地，例如<code class="codeph">VolatileImages</code> 。这些机制可能会在不知不觉中被应用程序击败。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span><span class="bold">通过以下方式直接访问</span>像素<code class="codeph">getDataBuffer()</code> ：</span><div>
                              <p>如果应用程序可以访问<code class="codeph">BufferedImage</code>使用<span class="apiname">getRaster（）。getDataBuffer（）</span> API像素，则Java 2D将无法保证高速缓存中的数据是最新的，因此它将禁用此类图像的任何加速尝试。
                              </p>
                              <p>为避免这种情况，请勿调用<span class="apiname">getDataBuffer（）</span> 。相反，请与<code class="codeph">WriteableRaster</code> ，可以使用<span class="apiname">BufferedImage.getRaster（）</span>方法获得。
                              </p>
                              <p>如果您需要直接修改像素，则可以通过将图像的缓存副本保存在<code class="codeph">VolatileImage</code> ，并在触摸原始图像时更新缓存的数据。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span><span class="bold">在每个副本之前渲染为一个精灵</span> ：</span><div>
                              <p>如果应用程序先渲染图像，然后再将其复制到加速表面（ <code class="codeph">VolatileImage</code> ， <code class="codeph">BufferStrategy</code> ），则图片无法利用缓存在加速内存中的优势。这是因为每次更新原始映像时都必须更新缓存的副本，因此仅使用默认的基于系统内存的表面，这意味着没有加速。
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span><span class="bold">耗尽加速内存资源</span> ：</span><div>
                              <p>如果应用程序使用许多图像，则它将耗尽可用的加速内存。如果这是导致应用程序性能问题的原因，则可能需要处理资源。</p>
                              <p>以下API可用于请求可用的加速内存量： <span class="apiname">GraphicsDevice.getAvailableAcceleratedMemory（）</span> 。
                              </p>
                              <p>此外，以下API可用于确定图像是否正在加速： <span class="apiname">Image.getCapabilities（）</span> 。
                              </p>
                              <p>如果确定应用程序正在消耗资源，则可以通过不保存不再需要的图像来解决该问题。例如，如果您的游戏前进到下一个级别，请释放上一个级别的所有图像。您还可以使用<span class="apiname">Image.flush（）</span> API释放与图像关联的加速资源。</p>
                              <p>您还可以使用加速优先级API <span class="apiname">Image.getAccelerationPriority（）</span>和<span class="apiname">setAccelerationPriority（）</span>来指定图像的加速优先级。确保至少加速您的后缓冲区是一个好主意，因此请首先创建它，并且其加速优先级为1（默认值）。如果需要，还可以通过将加速优先级设置为0.0来禁止某些图像加速。
                              </p>
                           </div>
                        </li>
                     </ul>
                  </div>
               </div><a id="JSTGD452"></a><div class="props_rev_3"><a id="GUID-D5849E59-9EB6-46FA-BA47-EA5C52DFA077" name="GUID-D5849E59-9EB6-46FA-BA47-EA5C52DFA077"></a><h4 id="JSTGD-GUID-D5849E59-9EB6-46FA-BA47-EA5C52DFA077" class="sect4">提高纯软件渲染的性能</h4>
                  <div>
                     <p>改善纯软件渲染性能的方法。</p>
                     <p>如果您的应用程序依赖纯软件渲染（仅渲染到<code class="codeph">BufferedImage</code> ，或者将默认管道更改为未加速的管道），或者即使它进行了混合渲染，也可以使用以下某些方法来提高性能：</p>
                     <ol>
                        <li>
                           <p><span class="bold">具有优化支持的图像类型或操作</span> ：</p>
                           <p>由于整个平台大小的限制，Java 2D具有有限数量的用于从一种图像格式转换为另一种图像格式的优化例程。在找不到优化的直接循环的情况下，Java 2D将通过中间图像格式进行转换（ <code class="codeph">IntArgb</code> ）。这导致性能下降。
                           </p>
                           <p>Java 2D原语跟踪可用于检测此类情况。</p>
                           <p>对于每个<code class="codeph">drawImage</code>调用将有两个原语：第一个将图像从源格式转换为中间格式<code class="codeph">IntArgb</code>格式，第二个从中间转换<code class="codeph">IntArgb</code>转换为目标格式。
                           </p>
                           <p>以下是两种避免此类情况的方法：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>如果可能，请使用其他图像格式。</p>
                              </li>
                              <li>
                                 <p>将您的图像转换为支持更好的格式之一的中间图像，例如<code class="codeph">INT_RGB</code>要么<code class="codeph">INT_ARGB</code> 。这样，从自定义图像格式进行的转换将仅发生一次，而不是在每个副本上进行。
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p><span class="bold">透明与半透明</span> ：</p>
                           <p>考虑使用1位透明（ <code class="codeph">BITMASK</code> ）的图片，而不是具有半透明效果的图片（例如<code class="codeph">INT_ARGB</code> ） 如果可能的话。
                           </p>
                           <p>使用全alpha处理图像会占用更多CPU资源。</p>
                           <p>您可以通过调用<span class="apiname">GraphicsConfiguration.createCompatibleImage（w，h，Transparency。）获得1位透明图像<span class="apiname">。BITMASK）</span> 。
                           </span></p>
                        </li>
                     </ol>
                  </div>
               </div>
            </div><a id="JSTGD453"></a><div class="props_rev_3"><a id="GUID-02BB2984-92CA-40E6-ACF6-CB8EB065F8B9" name="GUID-02BB2984-92CA-40E6-ACF6-CB8EB065F8B9"></a><h3 id="JSTGD-GUID-02BB2984-92CA-40E6-ACF6-CB8EB065F8B9" class="sect3">文字相关问题</h3>
               <div>
                  <p>与文本呈现相关的可能的问题和崩溃，并描述了克服此类问题的技巧。</p>
                  <p>本节包含以下小节：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="java-2d.html#GUID-D6B0F0B7-E080-4FFB-AB84-0271BBF644C7" title="如果在文本渲染期间应用程序崩溃，请首先检查致命错误日志文件。">文本渲染期间应用程序崩溃</a></p>
                     </li>
                     <li>
                        <p><a href="java-2d.html#GUID-293BD82D-5073-469E-A3BA-2EEC0A30879A" title="Java具有自己的字体栅格化程序，您可以期望Java应用程序和本机应用程序中的文本外观之间存在一些细微的差别。">文字外观的差异</a></p>
                     </li>
                     <li>
                        <p><a href="java-2d.html#GUID-313CA2E2-320A-48B6-BB16-625640E7A2B5">指标</a></p>
                     </li>
                  </ul>
               </div><a id="JSTGD454"></a><div class="props_rev_3"><a id="GUID-D6B0F0B7-E080-4FFB-AB84-0271BBF644C7" name="GUID-D6B0F0B7-E080-4FFB-AB84-0271BBF644C7"></a><h4 id="JSTGD-GUID-D6B0F0B7-E080-4FFB-AB84-0271BBF644C7" class="sect4">文本渲染期间应用程序崩溃</h4>
                  <div>
                     <p>如果在文本渲染期间应用程序崩溃，请首先检查致命错误日志文件。</p>
                     <div class="section">
                        <p>有关此错误日志文件的详细信息，请参见<a href="fatal-error-log.html#GUID-2AE5EE08-A68F-4514-9618-A581C0EDFB1B" title="描述致命错误日志，其位置和内容。">致命错误日志</a> 。如果发生崩溃<code>fontmanager.dll</code>或者如果<code class="codeph">fontmanager</code>出现在堆栈中，则崩溃发生在字体处理代码中。以下示例显示了典型的本机堆栈帧（摘录自完整日志文件）。
                        </p><pre class="pre codeblock"><code>Stack: [0x008a0000,0x008f0000),  sp=0x008ef52c,  free space=317k
Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)
C  [ntdll.dll+0x1888f]
C  [ntdll.dll+0x18238]
C  [ntdll.dll+0x11c76]
C  [MSVCR71.dll+0x16b3]
C  [MSVCR71.dll+0x16db]
C  [fontmanager.dll+0x21f9a]
C  [fontmanager.dll+0x22876]
C  [fontmanager.dll+0x1de40]
C  [fontmanager.dll+0x1da94]
C  [fontmanager.dll+0x48abb]
j  sun.font.FileFont.getGlyphImage(JI)J+0
j  sun.font.FileFontStrike.getGlyphImagePtrs([I[JI)V+92
j  sun.font.GlyphList.mapChars(Lsun/java2d/loops/FontInfo;I)Z+37
j  sun.font.GlyphList.setFromString(Lsun/java2d/loops/FontInfo;Ljava/lang/String;FF)Z+71
j  sun.java2d.pipe.GlyphListPipe.drawString(Lsun/java2d/SunGraphics2D;Ljava/lang/String;DD)V+148
j  sun.java2d.SunGraphics2D.drawString(Ljava/lang/String;II)V+60
j  FontCrasher.tryFont(Ljava/lang/String;)V+138
j  FontCrasher.main([Ljava/lang/String;)V+20
v  ~StubRoutines::call_stub
</code></pre><p>在这种情况下，可能是特定字体的问题。如果是这样，那么从系统中删除该字体可能会解决该问题。</p>
                        <p>要识别字体文件，请使用<code>-Dsun.java2d.debugfonts=true</code> 。最后提到的字体通常是引起问题的字体，如以下示例所示。
                        </p><pre class="pre codeblock"><code>INFO: Registered file C:\WINDOWS\Fonts\WINGDING.TTF as font ** TrueType Font: Family=Wingdings
 Name=Wingdings style=0 fileName=C:\WINDOWS\Fonts\WINGDING.TTF rank=2
Aug 16, 2006 10:59:06 PM sun.font.FontManager initialiseDeferredFont
INFO: Opening deferred font file SYMBOL.TTF
Aug 16, 2006 10:59:06 PM sun.font.FontManager addToFontList
INFO: Add to Family Symbol, Font Symbol rank=2
Aug 16, 2006 10:59:06 PM sun.font.FontManager registerFontFile
INFO: Registered file C:\WINDOWS\Fonts\SYMBOL.TTF as font ** TrueType Font: Family=Symbol
 Name=Symbol style=0 fileName=C:\WINDOWS\Fonts\SYMBOL.TTF rank=2
Aug 16, 2006 10:59:06 PM sun.font.FontManager findFont2D
INFO: Search for font: Dialog
Aug 16, 2006 10:59:06 PM sun.font.FontManager initialiseDeferredFont
INFO: Opening deferred font file ARIALBD.TTF
Aug 16, 2006 10:59:06 PM sun.font.FontManager addToFontList
INFO: Add to Family Arial, Font Arial Bold rank=2
Aug 16, 2006 10:59:06 PM sun.font.FontManager registerFontFile
INFO: Registered file C:\WINDOWS\Fonts\ARIALBD.TTF as font ** TrueType Font: Family=Arial
 Name=Arial Bold style=1 fileName=C:\WINDOWS\Fonts\ARIALBD.TTF rank=2
Aug 16, 2006 10:59:06 PM sun.font.FontManager initialiseDeferredFont
INFO: Opening deferred font file WINGDING.TTF
Aug 16, 2006 10:59:06 PM sun.font.FontManager initialiseDeferredFont
INFO: Opening deferred font file SYMBOL.TTF
Aug 16, 2006 10:59:06 PM sun.font.FontManager findFont2D
INFO: Search for font: Dialog
Aug 16, 2006 10:59:06 PM sun.font.FontManager initialiseDeferredFont
INFO: Opening deferred font file ARIAL.TTF
Aug 16, 2006 10:59:06 PM sun.font.FontManager addToFontList
INFO: Add to Family Arial, Font Arial rank=2
Aug 16, 2006 10:59:06 PM sun.font.FontManager registerFontFile
INFO: Registered file C:\WINDOWS\Fonts\ARIAL.TTF as font ** TrueType Font: Family=Arial
 Name=Arial style=0 fileName=C:\WINDOWS\Fonts\ARIAL.TTF rank=2
Aug 16, 2006 10:59:06 PM sun.font.FontManager initialiseDeferredFont
INFO: Opening deferred font file WINGDING.TTF
Aug 16, 2006 10:59:06 PM sun.font.FontManager initialiseDeferredFont
INFO: Opening deferred font file SYMBOL.TTF
</code></pre><div class="infoboxnote" id="GUID-D6B0F0B7-E080-4FFB-AB84-0271BBF644C7__GUID-75647511-7DA2-4515-BA36-87F81C6727D9">
                           <p class="notep1">注意：</p>
                           <p>在某些情况下，最后提到的字体可能不是问题。字体名称是在首次使用时打印的，以后的使用没有显示。</p>
                        </div>
                        <p>要验证此特定字体是引起问题的原因，可以暂时将其从系统中删除。您可以从输出中轻松找到与此特定家族名称关联的文件名。</p>
                        <p>另一种验证方法是使用Font2DTest工具来测试您怀疑的字体。您可以指定特定的字体大小，样式和光栅化模式。如果使用Font2DTest查看特定字体的过程导致JDK崩溃，则很有可能是字体引起了问题。</p>
                        <p>如果您发现导致JDK崩溃的字体，则报告此问题非常重要，包括<a href="http://bugs.java.com" target="_blank">Bugs Database中</a>的特定字体和操作系统。请参阅<a href="submit-bug-report.html#GUID-DB465A9C-03FA-4324-BFF9-45BF9699F349" title="有关如何提交错误报告的指南。它包括有关提交报告之前应尝试的操作以及为该报告收集哪些数据的建议。">提交错误报告</a> 。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="JSTGD458"></a><a id="JSTGD457"></a><div class="props_rev_3"><a id="GUID-293BD82D-5073-469E-A3BA-2EEC0A30879A" name="GUID-293BD82D-5073-469E-A3BA-2EEC0A30879A"></a><h4 id="JSTGD-GUID-293BD82D-5073-469E-A3BA-2EEC0A30879A" class="sect4">文字外观的差异</h4>
                  <div>
                     <p>Java具有自己的字体栅格化程序，您可以期望Java应用程序和本机应用程序中的文本外观之间存在一些细微的差别。</p>
                     <p>这些差异的典型来源之一是抗锯齿设置可能不同。特别是，Swing应用程序有时会忽略Linux桌面字体的抗锯齿设置。</p>
                     <p>此行为有几种可能的原因：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>由于性能原因，默认情况下未在远程X11上启用抗锯齿。请参阅<a href="http://www.oracle.com/technetwork/java/index-137037.html#Font_and_Text_questions" target="_blank">Java 2D FAQ中的字体和测试问题</a> 。</p>
                        </li>
                        <li>
                           <p>使用嵌入式位图的CJK字体可以使用位图而不是子像素文本来呈现。</p>
                        </li>
                        <li>
                           <p>不支持的桌面的某些变体不能正确报告其字体平滑设置。例如，不支持KDE，但通常应该可以使用。但是，似乎有一些问题阻止JDK进行设置。</p>
                        </li>
                     </ul>
                     <p>确保配置符合您期望的最佳方法是运行Font2DTest，显式选择本机应用程序使用的字体，并根据需要设置其他参数。<a href="java-2d.html#GUID-293BD82D-5073-469E-A3BA-2EEC0A30879A__BABBJHAB">图12-1</a>是<span class="italic"><span class="bold">Font2DTest</span></span>工具的示例屏幕。
                     </p>
                     <div class="figure" id="GUID-293BD82D-5073-469E-A3BA-2EEC0A30879A__BABBJHAB">
                        <p class="titleinfigure">图12-1 Font2DTest工具的示例屏幕</p><img src="img/font2dtest.png" alt="如下图12-1所示" title="如下图12-1所示" longdesc="img_text/font2dtest.html"><br><a href="img_text/font2dtest.html">“图12-1 Font2DTest工具的示例屏幕”的描述</a></div>
                     <!-- class="figure" -->
                     <div class="infobox-tip" id="GUID-293BD82D-5073-469E-A3BA-2EEC0A30879A__GUID-A5C67174-365D-4DA9-B7FC-CCBD011980BF">
                        <p class="notep1">小费：</p>
                        <p>您可以通过在标记为<span class="bold">要使用的</span> <span class="bold">文本</span>的下拉列表中选择<span class="bold">用户文本</span>来输入自己的字符串。
                        </p>
                     </div>
                     <p>Java语言中的字体大小始终以72 dpi表示。本机操作系统可以使用不同的屏幕dpi，因此必须进行调整。匹配的Java字体大小可以计算为<code class="codeph">Toolkit.getScreenResolution()</code>除以72乘以本机字体的大小。
                     </p>
                     <p>在所有本机Swing外观中，例如Windows外观或GTK外观（对于Oracle Solaris和Linux操作系统），Swing组件都会自动执行此调整，但是如果您正在运行<span class="italic"><span class="bold">Font2DTest，</span></span>则文本显示区域将始终使用72 dpi。
                     </p>
                     <p>在Windows以外的操作系统上，一般建议使用TrueType字体而不是Type1字体。找出字体类型的最简单方法是查看文件扩展名：扩展名pfa和pfb表示Type1字体，而ttf，ttc和tte表示TrueType字体。</p>
                  </div>
               </div><a id="JSTGD459"></a><div class="props_rev_3"><a id="GUID-313CA2E2-320A-48B6-BB16-625640E7A2B5" name="GUID-313CA2E2-320A-48B6-BB16-625640E7A2B5"></a><h4 id="JSTGD-GUID-313CA2E2-320A-48B6-BB16-625640E7A2B5" class="sect4">指标</h4>
                  <div>
                     <p>如果发现文本边界与期望的边界不同，请确保使用正确的方法进行计算。例如，从<code class="codeph">FontMetrics</code>不特定于特定文本，并且<code class="codeph">stringWidth</code>表示逻辑超前，与<span class="italic"><span class="bold">阔度不同。</span></span> 有关更多详细信息，请参见<a href="http://www.oracle.com/technetwork/java/index-137037.html#Font_and_Text_questions" target="_blank">Java 2D FAQ中</a>的<a href="http://www.oracle.com/technetwork/java/index-137037.html#Font_and_Text_questions" target="_blank">Font和Text问题</a> 。</p>
                  </div>
               </div>
            </div><a id="JSTGD460"></a><div class="props_rev_3"><a id="GUID-17CCB9A9-F9A6-4541-A536-7259AAF90044" name="GUID-17CCB9A9-F9A6-4541-A536-7259AAF90044"></a><h3 id="JSTGD-GUID-17CCB9A9-F9A6-4541-A536-7259AAF90044" class="sect3">Java 2D打印</h3>
               <div>
                  <p>Java 2D打印可能发生的问题列表。</p>
                  <div class="section">
                     <p>本节描述Java 2D打印可能发生的一些问题，并提出原因和解决方案。</p>
                     <p>另外，请参阅<a href="http://www.oracle.com/technetwork/java/index-137037.html#Printing_questions" target="_blank">Java 2D FAQ中的</a> “ <a href="http://www.oracle.com/technetwork/java/index-137037.html#Printing_questions" target="_blank">打印”问题</a> 。</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span><span class="bold">在Windows上打印期间，JRE崩溃</span> 。</span><div>
                           <p><span class="bold">原因：</span> JRE使用Windows打印机驱动程序，它们可能有问题。
                           </p>
                           <p><span class="bold">解决方案：</span>升级正在使用的打印机的Windows打印机驱动程序。
                           </p>
                        </div>
                     </li>
                     <li class="stepexpand"><span><span class="bold">打印似乎成功，但是该作业无法在Windows上打印。</span></span><div>
                           <p><span class="bold">原因：</span>某些作业无法正确地后台处理到打印机。
                           </p>
                           <p><span class="bold">解决方案：</span>在打印机驱动程序属性中，禁用“高级打印选项”。
                           </p>
                        </div>
                     </li>
                     <li class="stepexpand"><span><span class="bold">打印对话框需要很长时间才能在Windows上显示。</span></span><div>
                           <p><span class="bold">原因：</span>应用程序可能导致JRE探测所有打印机，包括那些断开连接的打印机。
                           </p>
                           <p><span class="bold">解决方案：</span>查找断开连接或无法访问的网络打印机，并将其从打印机列表中删除。
                           </p>
                        </div>
                     </li>
                     <li class="stepexpand"><span><span class="bold">PrintJob.printDialog（）在Oracle Solaris和Linux上显示没有找到服务错误。</span></span><div>
                           <p><span class="bold">原因：</span>原因是以下之一：</p>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>的<code class="codeph">lpc</code>实用程序不在<code>/usr/sbin</code>目录。
                                 </p>
                              </li>
                              <li>
                                 <p>的<code class="codeph">lpstat</code>实用程序不在<code>/usr/sbin</code>目录。
                                 </p>
                              </li>
                           </ul>
                           <p><span class="bold">解决方案：</span>安装<code class="codeph">lpc</code>和<code class="codeph">lpstat</code>如前所述，在标准位置。
                           </p>
                        </div>
                     </li>
                  </ol>
               </div>
            </div>
         </div>
      </article>
   

</body></html>