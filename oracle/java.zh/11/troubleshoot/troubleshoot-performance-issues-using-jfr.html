<html lang="en-us"  xml:lang="en-us"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="Identify performance issues with a Java application and debug these issues using the Java Flight Recorder.">
      <meta name="description" content="Identify performance issues with a Java application and debug these issues using the Java Flight Recorder.">
      <title>Troubleshoot Performance Issues Using JFR</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Troubleshooting Guide">
      <meta property="og:description" content="Identify performance issues with a Java application and debug these issues using the Java Flight Recorder.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Troubleshooting Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="troubleshooting-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-20T10:41:43-07:00">
      <meta name="dcterms.title" content="Troubleshooting Guide">
      <meta name="dcterms.dateCopyrighted" content="1995, 2018">
      <meta name="dcterms.category" content="java">
      <meta name="dcterms.identifier" content="E94880-01">
      
      <meta name="dcterms.product" content="en/java/javase/11">
      <meta name="dcterms.release" content="11">
      <link rel="prev" href="troubleshoot-memory-leaks.html" title="Previous" type="text/html">
      <link rel="next" href="debug-jvm-issues.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"java","element_name":"Java","display_in_url":true},"suite":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product_group":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product":{"short_name":"javase","element_name":"Java SE","display_in_url":true},"release":{"short_name":"11","element_name":"11","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TROUBLESHOOT">
  <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="troubleshoot-memory-leaks.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一个</a> <a href="debug-jvm-issues.html" class="pull-right">下一个<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">故障排除指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="general-java-troubleshooting.html" property="item" typeof="WebPage"><span property="name">常规Java故障排除</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用JFR解决性能问题</li>
            </ol>
            <a id="GUID-0FE29092-18B5-4BEB-8D8D-0CBA7A4FEA1D" name="GUID-0FE29092-18B5-4BEB-8D8D-0CBA7A4FEA1D"></a><a id="JSTGD300"></a><a id="JSTGD299"></a>
            
            <h2 id="JSTGD-GUID-0FE29092-18B5-4BEB-8D8D-0CBA7A4FEA1D" class="sect2"><span class="enumeration_chapter">4</span>使用JFR解决性能问题</h2>
         </header>
         <div class="ind">
            <div>
               <div><span>找出Java应用程序的性能问题，并使用Java Flight Recorder调试这些问题。</span></div>
               <p>要了解有关创建飞行记录的更多信息，请参见<a href="diagnostic-tools.html#GUID-14DD9297-94CE-4B03-B6B9-4D5B6A7774DC" title="使用Java Mission Control（JMC）轻松管理飞行记录。在命令行上使用启动标志来生成性能分析记录，连续记录和使用诊断命令。您可以将Java Mission Control设置为在满足条件时自动开始或转储飞行记录。这是从JMX控制台完成的。要启动JMX控制台，请在JVM浏览器中找到您的应用程序，右键单击它，然后选择“启动JMX浏览器”。">如何制作飞行记录</a> 。
               </p>
               <p>Java Flight Recorder是研究性能问题的好工具。没有任何其他工具能够提供如此多的性能分析数据，而不会因其自身的性能开销而使结果产生偏差。本章提供了性能问题的示例，您可以使用Java Flight Recorder识别并调试问题。</p>
               <p>本章包含以下部分：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="troubleshoot-performance-issues-using-jfr.html#GUID-85F8E796-5FEC-451F-885D-2A4518A5FE68" title="在测量性能时，重要的是要考虑飞行记录器本身增加的任何性能开销。开销因应用程序而异。如果您设置了任何性能测试，则可以衡量特定应用程序上是否有任何明显的开销。">JFR架空</a></p>
                  </li>
                  <li>
                     <p><a href="troubleshoot-performance-issues-using-jfr.html#GUID-82335401-BDC8-47E5-871A-174B8B3AAD8C" title="不同的应用程序有不同的瓶颈。对于某些应用程序，瓶颈可能正在等待I / O或网络，它可能是线程之间的同步，或者可能是实际的CPU使用率。对于其他人来说，瓶颈可能是垃圾收集时间。一个应用程序可能有多个瓶颈。">查找瓶颈</a></p>
                  </li>
                  <li>
                     <p><a href="troubleshoot-performance-issues-using-jfr.html#GUID-E9C795D6-3D7A-4CD8-84DD-4F7DE3200614" title="可以使用JFR诊断垃圾回收的Java应用程序问题。">垃圾收集性能</a></p>
                  </li>
                  <li>
                     <p><a href="troubleshoot-performance-issues-using-jfr.html#GUID-F3D702A9-F2A7-47F7-9B54-97DD8E730399" title="要调试Java应用程序同步问题，或者换句话说，在应用程序线程花大量时间等待进入监视器的情况下，请查看“线程”选项卡组中的“争用”选项卡。">同步性能</a></p>
                  </li>
                  <li>
                     <p><a href="troubleshoot-performance-issues-using-jfr.html#GUID-AB398CCB-03A1-48E4-B573-2363DFB6ACA3" title="您可以通过监视I / O组下的“套接字读取”选项卡来诊断应用程序中的I / O问题。">I / O性能</a></p>
                  </li>
                  <li>
                     <p><a href="troubleshoot-performance-issues-using-jfr.html#GUID-82079DCD-8CAC-428A-9D61-B10B4305B476" title="可以使用Java任务控制的“调用树”选项卡监视代码执行性能。">代码执行性能</a></p>
                  </li>
               </ul>
            </div><a id="JSTGD301"></a><div class="props_rev_3"><a id="GUID-85F8E796-5FEC-451F-885D-2A4518A5FE68" name="GUID-85F8E796-5FEC-451F-885D-2A4518A5FE68"></a><h3 id="JSTGD-GUID-85F8E796-5FEC-451F-885D-2A4518A5FE68" class="sect3">JFR架空</h3>
               <div>
                  <p>在测量性能时，重要的是要考虑飞行记录器本身增加的任何性能开销。开销因应用程序而异。如果您设置了任何性能测试，则可以衡量特定应用程序上是否有任何明显的开销。</p>
                  <p>也就是说，对于大多数应用程序，使用默认设置来记录标准配置文件记录的开销小于2％。使用标准连续记录运行通常不会产生可衡量的性能影响。</p>
                  <p>造成开销的主要因素之一是堆统计信息事件，默认情况下禁用此事件。启用堆统计信息会在测试运行的开始和结束时触发旧的垃圾收集。这些旧的GC为应用程序提供了一些额外的暂停时间，因此，如果您要测量延迟或环境对暂停时间敏感，请不要在启用“堆统计信息”的情况下运行。当调试内存泄漏或调查应用程序的实时集时，堆统计信息非常有用。请参阅<a href="troubleshoot-memory-leaks.html#GUID-FA5677A5-B175-40B4-B7F0-851118B6B7AD" title="Java Flight Recorder记录有关Java运行时和在Java运行时中运行的Java应用程序的详细信息。">使用Java Flight Recorder调试内存泄漏</a> 。
                  </p>
                  <div class="p">
                     <div class="infoboxnote" id="GUID-85F8E796-5FEC-451F-885D-2A4518A5FE68__GUID-F9873CB3-EE5C-407D-91ED-CCFFB8C71B8F">
                        <p class="notep1">注意：</p>对于性能分析用例，此信息可能不是必需的。
                     </div>
                  </div>
               </div>
            </div><a id="JSTGD303"></a><a id="JSTGD304"></a><a id="JSTGD302"></a><div class="props_rev_3"><a id="GUID-82335401-BDC8-47E5-871A-174B8B3AAD8C" name="GUID-82335401-BDC8-47E5-871A-174B8B3AAD8C"></a><h3 id="JSTGD-GUID-82335401-BDC8-47E5-871A-174B8B3AAD8C" class="sect3">查找瓶颈</h3>
               <div>
                  <p>不同的应用程序有不同的瓶颈。对于某些应用程序，瓶颈可能正在等待I / O或网络，它可能是线程之间的同步，或者可能是实际的CPU使用率。对于其他人来说，瓶颈可能是垃圾收集时间。一个应用程序可能有多个瓶颈。</p>
                  <div class="section">
                     <p>找出应用程序瓶颈的一种方法是查看“ <span class="bold">事件”</span>选项卡。这是一个高级选项卡，有一些事情要做。首先，单击“ <span class="bold">事件”</span>选项卡，这将在JFR窗口的左侧打开“ <span class="bold">事件类型”</span>选项卡。在这里，您可以选择要查看的事件。现在，选择<span class="bold">统计</span>和<span class="bold">分配</span>之外的所有Java应用程序事件， <a href="troubleshoot-performance-issues-using-jfr.html#GUID-82335401-BDC8-47E5-871A-174B8B3AAD8C__CJADBFCH">如图4-1</a>所示。
                     </p>
                     <div class="figure" id="GUID-82335401-BDC8-47E5-871A-174B8B3AAD8C__CJADBFCH">
                        <p class="titleinfigure">图4-1查找瓶颈-Java应用程序事件</p><img src="img/jfr-eventtypes.png" alt="如下图4-1所示" title="如下图4-1所示" longdesc="img_text/jfr-eventtypes.html"><br><a href="img_text/jfr-eventtypes.html">“图4-1查找瓶颈-Java应用程序事件”的描述</a></div>
                     <!-- class="figure" -->
                     <p>现在，在所有“ <span class="bold">事件”</span>选项卡中，您只会看到这些事件。接下来，从<span class="bold">Graph</span>选项卡中，查看Java应用程序的主线程， <a href="troubleshoot-performance-issues-using-jfr.html#GUID-82335401-BDC8-47E5-871A-174B8B3AAD8C__CJAIFEEG">如图4-2</a>所示。
                     </p>
                     <div class="figure" id="GUID-82335401-BDC8-47E5-871A-174B8B3AAD8C__CJAIFEEG">
                        <p class="titleinfigure">图4-2在“图形”选项卡中查找瓶颈-主线程</p><img src="img/jfr-eventgraph.png" alt="如下图4-2所示" title="如下图4-2所示" longdesc="img_text/jfr-eventgraph.html"><br><a href="img_text/jfr-eventgraph.html">“图4-2在“图形”选项卡中查找瓶颈-主线程”的描述</a></div>
                     <!-- class="figure" -->
                     <p>“ <span class="bold">图形”</span>选项卡起初可能很难掌握。每行是一个线程，每个线程可以有多行。在<a href="troubleshoot-performance-issues-using-jfr.html#GUID-82335401-BDC8-47E5-871A-174B8B3AAD8C__CJAIFEEG">图4-2中</a> ，每个线程都有一行，代表该记录的“ <span class="bold">事件类型”</span>选项卡中启用的Java应用程序事件。选定的Java应用程序事件都具有重要的属性，它们都是线程陈旧事件。线程停顿表明事件期间该线程未在运行您的应用程序，它们都是持续时间事件。持续时间事件用于衡量应用程序未运行的持续时间。
                     </p>
                     <p>在“ <span class="bold">事件类型”</span>选项卡中，查看每个事件的颜色。例如， <span class="italic">黄色</span>表示<span class="bold">Java Monitor Wait</span>事件。黄色部分是线程正在等待对象的时间。这通常意味着线程处于空闲状态，可能正在等待任务。<span class="italic">红色</span>表示<span class="bold">Java Monitor Blocked</span>事件或同步事件。如果Java应用程序的重要线程花费大量时间被阻塞，那么这意味着应用程序的关键部分是单线程，这是一个瓶颈。<span class="italic">蓝色</span>表示<span class="bold">套接字读取</span>和<span class="bold">套接字写入</span>事件。同样，如果Java应用程序花费大量时间等待套接字，则主要瓶颈可能在网络中或与该应用程序通信的其他机器。
                     </p>
                     <p>在<a href="troubleshoot-performance-issues-using-jfr.html#GUID-82335401-BDC8-47E5-871A-174B8B3AAD8C__CJAIFEEG">图4-2中</a> ， <span class="italic">绿色</span>表示没有任何事件的部分。<span class="italic">绿色</span>部分表示线程未在休眠，等待，从套接字读取或从套接字读取或未阻塞。通常，这是运行应用程序代码的地方。如果Java应用程序的重要线程花费大量时间而不生成任何应用程序事件，则应用程序的瓶颈是执行代码或CPU本身所花费的时间。
                     </p>
                     <div class="p">
                        <div class="infoboxnote" id="GUID-82335401-BDC8-47E5-871A-174B8B3AAD8C__GUID-CD91FD0D-4BCB-4B00-A3C9-1ABC7E920C85">
                           <p class="notep1">注意：</p>对于大多数Java应用程序事件类型，仅记录超过20毫秒的事件。（可以在开始飞行记录时修改此阈值。）总而言之，这些区域可能没有记录事件，因为应用程序正在执行许多简短的任务，例如写入文件（一次写入一小部分）或花费很短的时间同步。
                        </div>
                     </div>
                     <p>可以在飞行记录中进一步调查每个先前的瓶颈。</p>
                     <p>“ <span class="italic"><span class="bold">事件”</span></span>选项卡不显示垃圾回收，也不显示垃圾回收是否可能成为瓶颈。请参阅有关垃圾回收性能的下一个主题。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JSTGD306"></a><a id="JSTGD305"></a><div class="props_rev_3"><a id="GUID-E9C795D6-3D7A-4CD8-84DD-4F7DE3200614" name="GUID-E9C795D6-3D7A-4CD8-84DD-4F7DE3200614"></a><h3 id="JSTGD-GUID-E9C795D6-3D7A-4CD8-84DD-4F7DE3200614" class="sect3">垃圾收集性能</h3>
               <div>
                  <p>可以使用JFR诊断垃圾回收的Java应用程序问题。</p>
                  <div class="section">
                     <p>调整Hotspot垃圾收集器会对性能产生很大影响。有关一般信息，请参见《 <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/java/javase/11/troubleshoot&id=JSGCT-GUID-326EB4CF-8C8C-4267-8355-21AB04F0D304" target="_blank">垃圾收集优化指南》</a> 。
                     </p>
                     <p>首先，在应用程序启动并运行时对其进行性能分析飞行记录。不包括堆统计信息，因为这将触发额外的旧集合。为了获得良好的样本，请记录更长的时间，例如1小时。</p>
                     <p>选择“ <span class="bold">内存”</span>选项卡，然后选择“ <span class="bold">GC时间”</span>子选项卡。<span class="italic"><span class="bold">GC Times</span></span>是一个很好的选项卡，可用于调查GC的总体性能影响。从右上角查看“ <span class="bold">所有集合暂停时间”</span>部分，然后查看记录中的“ <span class="italic">平均</span> <span class="italic">暂停</span> <span class="italic">总数”</span> ，“ <span class="italic">最大暂停</span> <span class="italic">总数”</span>和“ <span class="italic">总暂停时间</span> ”。<span class="italic">暂停</span>总数是GC期间应用程序<span class="italic">暂停</span>的总时间。许多GC在后台完成大部分工作。在这些情况下，GC的长度无关紧要，重要的是应用程序实际上必须停止多长时间。因此， <span class="italic">暂停总和</span>是衡量GC效果的好方法。
                     </p>
                     <p><a href="troubleshoot-performance-issues-using-jfr.html#GUID-E9C795D6-3D7A-4CD8-84DD-4F7DE3200614__CJAFGGAC">图4-3</a>显示了5分钟的飞行记录（从时间选择栏中可以看到）。在此期间， <span class="italic">平均暂停总和</span>为16 ms， <span class="italic">最大暂停总和</span>为49 ms， <span class="italic">总暂停时间</span>为2s 86 ms。
                     </p>
                     <div class="figure" id="GUID-E9C795D6-3D7A-4CD8-84DD-4F7DE3200614__CJAFGGAC">
                        <p class="titleinfigure">图4-3垃圾回收性能-GC暂停</p><img src="img/jfr-gctime.png" alt="如下图4-3所示" title="如下图4-3所示" longdesc="img_text/jfr-gctime.html"><br><a href="img_text/jfr-gctime.html">“图4-3垃圾收集性能-GC暂停”的说明</a></div>
                     <!-- class="figure" -->
                     <p>垃圾回收的主要性能问题通常是：单个GC花费的时间太长，或者在暂停的GC中花费了太多时间（总的GC暂停时间）。</p>
                     <p>如果单个GC花费的时间太长，则可能需要更改GC策略。在暂停时间与吞吐量性能之间，不同的GC具有不同的权衡。请参阅<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/java/javase/11/troubleshoot&id=JSGCT-GUID-3D0BB91E-9BFF-4EBB-B523-14493A860E73" target="_blank">基于行为的调整。</a> 。
                     </p>
                     <p>例如，您可能还需要修复您的应用程序，以便减少使用终结器或半引用。</p>
                     <p>当应用程序花费太多时间暂停时，有多种解决方法。</p>
                     <p>一种方法是增加Java堆大小。查看“ <span class="bold">垃圾回收”</span>子选项卡以估计应用程序使用的堆大小，然后将<span class="italic">Xms</span>和<span class="italic">Xmx</span>更改为更高的值。Java堆越大，GC之间的时间越长。注意Java应用程序中的任何内存泄漏，因为这可能会导致越来越频繁的GC，直到出现<code class="codeph">OutOfMemoryError</code>被抛出。有关更多信息，请参见<a href="troubleshoot-memory-leaks.html#GUID-FA5677A5-B175-40B4-B7F0-851118B6B7AD" title="Java Flight Recorder记录有关Java运行时和在Java运行时中运行的Java应用程序的详细信息。">使用Java Flight Recorder调试内存泄漏</a> 。
                     </p>
                     <p>减少GC数量的另一种方法是分配较少的临时对象。在“ <span class="bold">分配”</span>选项卡下，查看在录制过程中分配了多少内存。小对象分配在<span class="bold">TLAB</span>内部，大对象分配在<span class="bold">TLAB内部</span> 。通常，大多数分配发生在<span class="bold">TLAB</span>内部。
                     </p>
                     <p>最后，为减少对GC的需求，请降低分配率。<span class="bold">在新的TLAB</span>选项卡中选择<span class="bold">分配</span> ，然后选择<span class="bold">分配</span>选项卡以查看具有最大内存压力的分配站点和堆栈跟踪。您可以按类查看它，也可以选择<span class="bold">按线程分配，</span>以查看哪些线程消耗最多的内存。
                     </p>
                     <p>有关“ JFR <span class="bold">分配”</span>选项卡的一般详细信息，请参阅<a href="diagnostic-tools.html#GUID-7E8058D0-249E-44DB-8714-3AA9DA6A4DB8" title="有关如何获取样本JFR来检查飞行记录的信息，以及Java Mission Control中的各种选项卡供您分析飞行记录。">检查飞行记录</a> 。
                     </p>
                     <p>其他一些设置也可能会提高Java应用程序的GC性能。见<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/java/javase/11/troubleshoot&id=JSGCT-GUID-ED3AB6D3-FD9B-4447-9EDF-983ED2F7A573" target="_blank">垃圾收集调优指南</a>在<span><cite>Java平台标准版的HotSpot虚拟机垃圾收集调优指南</cite></span>讨论GC性能。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JSTGD308"></a><a id="JSTGD307"></a><div class="props_rev_3"><a id="GUID-F3D702A9-F2A7-47F7-9B54-97DD8E730399" name="GUID-F3D702A9-F2A7-47F7-9B54-97DD8E730399"></a><h3 id="JSTGD-GUID-F3D702A9-F2A7-47F7-9B54-97DD8E730399" class="sect3">同步性能</h3>
               <div>
                  <p>要调试Java应用程序同步问题，或者换句话说，在应用程序线程花大量时间等待进入监视器的情况下，请查看“ <span class="bold">线程”</span>选项卡组中的“ <span class="bold">争</span>用”选项卡。
                  </p>
                  <div class="section">
                     <p>查看最争夺的锁，以及等待获取该锁的线程的<span class="italic">堆栈跟踪</span> ， <a href="troubleshoot-performance-issues-using-jfr.html#GUID-F3D702A9-F2A7-47F7-9B54-97DD8E730399__CJAEGHGG">如图4-4</a>所示。
                     </p>
                     <div class="figure" id="GUID-F3D702A9-F2A7-47F7-9B54-97DD8E730399__CJAEGHGG">
                        <p class="titleinfigure">图4-4同步性能-“争用”选项卡</p><img src="img/jfr-synchronize.png" alt="如下图4-4所示" title="如下图4-4所示" longdesc="img_text/jfr-synchronize.html"><br><a href="img_text/jfr-synchronize.html">“图4-4同步性能-争用选项卡”的描述</a></div>
                     <!-- class="figure" -->
                     <p>在<a href="troubleshoot-performance-issues-using-jfr.html#GUID-F3D702A9-F2A7-47F7-9B54-97DD8E730399__CJAEGHGG">图4-4中</a> ，顶部的范围选择器使您可以查看事件发生的位置。放大选定时间范围内争用事件的范围选择器。
                     </p>
                     <p>通常，寻找您认为不是问题的争用。日志记录是一个常见的领域，在某些应用程序中可能是意外的瓶颈。</p>
                     <p>当您在程序更新后或Java应用程序中的任何特定时间看到性能下降时，请在情况良好时进行一次飞行记录，而在情况不好时进行另一次飞行记录，以查找数量增加的同步站点。</p>
                     <div class="p">
                        <div class="infoboxnote" id="GUID-F3D702A9-F2A7-47F7-9B54-97DD8E730399__GUID-518451D4-3EA6-404D-B3E6-5E058FA64D53">
                           <p class="notep1">注意：</p>范围选择器中显示的事件并非全部同步事件。默认情况下，会记录持续时间超过20 ms的竞争事件。（可以在开始飞行记录时修改此阈值。）阈值越短，事件<span class="italic">越多，开销</span>也可能<span class="italic">更大</span> 。如果您认为争用是一个问题，则可以以非常低的阈值（仅几毫秒）进行较短的录制。在实时应用程序上完成此操作后，请确保以非常短的记录开始，并监视性能开销。
                        </div>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JSTGD310"></a><a id="JSTGD309"></a><div class="props_rev_3"><a id="GUID-AB398CCB-03A1-48E4-B573-2363DFB6ACA3" name="GUID-AB398CCB-03A1-48E4-B573-2363DFB6ACA3"></a><h3 id="JSTGD-GUID-AB398CCB-03A1-48E4-B573-2363DFB6ACA3" class="sect3">I / O性能</h3>
               <div>
                  <p>您可以通过监视<span class="bold">I / O</span>组下的“ <span class="bold">套接字读取”</span>选项卡来诊断应用程序中的I / O问题。
                  </p>
                  <div class="section">
                     <p>当Java应用程序在<span class="bold">Socket Read</span> ， <span class="bold">Socket Write</span> ， <span class="bold">File Read</span>或<span class="bold">File Write中</span>花费大量时间时，I / O或网络可能成为瓶颈。要诊断应用程序中的I / O问题，请<span class="bold">查看</span> <span class="bold">I / O</span>组下的<span class="bold">Socket Read</span>选项卡， <a href="troubleshoot-performance-issues-using-jfr.html#GUID-AB398CCB-03A1-48E4-B573-2363DFB6ACA3__CJAICDEE">如图4-5</a>所示。
                     </p>
                     <div class="figure" id="GUID-AB398CCB-03A1-48E4-B573-2363DFB6ACA3__CJAICDEE">
                        <p class="titleinfigure">图4-5 I / O性能问题-套接字读取选项卡</p><img src="img/jfr-socket-read.png" alt="如下图4-5所示" title="如下图4-5所示" longdesc="img_text/jfr-socket-read.html"><br><a href="img_text/jfr-socket-read.html">“图4-5 I / O性能问题-套接字读取选项卡”的描述</a></div>
                     <!-- class="figure" -->
                     <p><a href="troubleshoot-performance-issues-using-jfr.html#GUID-AB398CCB-03A1-48E4-B573-2363DFB6ACA3__CJAICDEE">图4-5</a>显示该应用程序从远程地址198.51.100.0进行了100次读取。读取的字节总数为356字节，等待所花费的总时间为1分钟57 s。选择左上角的“ <span class="bold">按事件”</span>选项卡，然后查看每个事件以分析花费的时间和读取的数据。
                     </p>
                     <p>以类似的方式诊断文件或网络I / O问题。查看最多读取或写入的文件，然后查看每个文件的读取/写入以及在I / O上花费的时间。</p>
                     <p>默认情况下，I / O中的所有选项卡都会列出持续时间超过20毫秒的事件。开始飞行记录时，您可以降低<span class="italic">文件I / O阈值</span>或<span class="italic">套接字I / O阈值</span>以收集更多数据，从而可能会提高性能。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="JSTGD312"></a><a id="JSTGD311"></a><div class="props_rev_3"><a id="GUID-82079DCD-8CAC-428A-9D61-B10B4305B476" name="GUID-82079DCD-8CAC-428A-9D61-B10B4305B476"></a><h3 id="JSTGD-GUID-82079DCD-8CAC-428A-9D61-B10B4305B476" class="sect3">代码执行性能</h3>
               <div>
                  <p>可以使用Java任务控制的“ <span class="bold">调用树”</span>选项卡监视代码执行性能。
                  </p>
                  <div class="section">
                     <p>当Java应用程序事件不多时，可能是应用程序的主要瓶颈是运行代码。首先，查看“ <span class="bold">线程”</span>选项卡，然后选择“ <span class="bold">概述”</span>选项卡。请参阅<span class="italic">一段时间内的CPU使用率</span> 。这显示了正在记录的JVM的CPU使用率以及计算机上的总CPU使用率。如果JVM CPU使用率较低，但计算机的CPU使用率较高，则意味着某些其他应用程序占用了大量CPU。然后，从“ <span class="bold">系统”</span>选项卡组的“ <span class="bold">进程”</span>选项卡中查看系统上正在运行的其他应用程序。但是，您可能看不到它们的CPU使用率，因此通常更容易使用OS工具（例如<span class="bold">Top</span>或任务管理器）来确定哪些进程正在使用大量CPU。</p>
                     <p>选择“ <span class="bold">代码”</span>选项卡组，然后查看“ <span class="bold">热线程”</span>选项卡，以防您的应用程序<span class="bold">占用</span>大量CPU时间。此选项卡显示使用最多CPU时间的线程。但是，此信息是基于<span class="italic">方法抽样的</span> ，因此，如果抽样数量很少，则可能不是100％准确。当JFR运行时，JVM对线程进行采样。默认情况下，连续记录仅进行某些<span class="italic">方法采样</span> ，而性能分析记录则尽可能多。<span class="italic">方法采样</span>仅从那些运行代码的线程中收集数据。不采样等待I / O，睡眠，等待锁等的线程。因此，具有大量方法样本的线程是使用最多CPU时间的线程；但是，每个线程使用多少CPU是未知的。
                     </p>
                     <p>“ <span class="bold">代码”</span>选项卡组中的<span class="bold">“</span> <span class="bold">热方法</span> <span class="bold">”</span>选项卡有助于找出应用程序在大部分执行时间上所花费的时间。此选项卡显示堆栈中按top方法分组的所有样本。使用“ <span class="bold">调用树”</span>选项卡从堆栈跟踪中的最低方法开始，然后向上移动。<a href="troubleshoot-performance-issues-using-jfr.html#GUID-82079DCD-8CAC-428A-9D61-B10B4305B476__CJAFHAIH">图4-6</a>开头为<code class="codeph">Thread.run</code> ，然后查看采样次数最多的呼叫。
                     </p>
                     <div class="figure" id="GUID-82079DCD-8CAC-428A-9D61-B10B4305B476__CJAFHAIH">
                        <p class="titleinfigure">图4-6代码执行性能-“调用树”选项卡</p><img src="img/jfr-calltree.png" alt="如下图4-6所示" title="如下图4-6所示" longdesc="img_text/jfr-calltree.html"><br><a href="img_text/jfr-calltree.html">“图4-6代码执行性能-调用树选项卡”的描述</a></div>
                     <!-- class="figure" -->
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   

</body></html>