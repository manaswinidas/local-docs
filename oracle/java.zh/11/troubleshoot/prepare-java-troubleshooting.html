<html lang="en-us"  xml:lang="en-us"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="This chapter provides some guidelines for setting up both Java and a Java application for better troubleshooting techniques. These proactive Java setups help debug and narrow down issues with Java and the application. Not all suggestions apply to every application.">
      <meta name="description" content="This chapter provides some guidelines for setting up both Java and a Java application for better troubleshooting techniques. These proactive Java setups help debug and narrow down issues with Java and the application. Not all suggestions apply to every application.">
      <title>Prepare Java for Troubleshooting</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Troubleshooting Guide">
      <meta property="og:description" content="This chapter provides some guidelines for setting up both Java and a Java application for better troubleshooting techniques. These proactive Java setups help debug and narrow down issues with Java and the application. Not all suggestions apply to every application.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Troubleshooting Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="troubleshooting-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-20T10:41:43-07:00">
      <meta name="dcterms.title" content="Troubleshooting Guide">
      <meta name="dcterms.dateCopyrighted" content="1995, 2018">
      <meta name="dcterms.category" content="java">
      <meta name="dcterms.identifier" content="E94880-01">
      
      <meta name="dcterms.product" content="en/java/javase/11">
      <meta name="dcterms.release" content="11">
      <link rel="prev" href="general-java-troubleshooting.html" title="Previous" type="text/html">
      <link rel="next" href="diagnostic-tools.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"java","element_name":"Java","display_in_url":true},"suite":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product_group":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product":{"short_name":"javase","element_name":"Java SE","display_in_url":true},"release":{"short_name":"11","element_name":"11","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="TROUBLESHOOT">
  <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="general-java-troubleshooting.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一个</a> <a href="diagnostic-tools.html" class="pull-right">下一个<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">故障排除指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="general-java-troubleshooting.html" property="item" typeof="WebPage"><span property="name">常规Java故障排除</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">准备Java进行故障排除</li>
            </ol>
            <a id="GUID-28AFFE4C-4526-4C1F-9C47-32D669BCAF1E" name="GUID-28AFFE4C-4526-4C1F-9C47-32D669BCAF1E"></a><a id="JSTGD109"></a><a id="JSTGD108"></a>
            
            <h2 id="JSTGD-GUID-28AFFE4C-4526-4C1F-9C47-32D669BCAF1E" class="sect2"><span class="enumeration_chapter">1</span>准备Java进行故障排除</h2>
         </header>
         <div class="ind">
            <div>
               <div><span>本章为设置Java和Java应用程序提供了一些指导，以提供更好的故障排除技术。这些积极的Java设置有助于调试和缩小Java和应用程序的问题。并非所有建议都适用于每个应用程序。</span></div>
               <p>本章包含以下部分：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="prepare-java-troubleshooting.html#GUID-9058D741-AF5D-4F22-B0DD-FEF090545229" title="设置Java环境和命令行选项以启用收集相关数据以进行故障排除。">设置Java进行故障排除</a></p>
                  </li>
                  <li>
                     <p><a href="prepare-java-troubleshooting.html#GUID-CFA2A634-2C12-4A68-8A34-50E56C5AC16D" title="设置JVM选项和标志以启用收集相关数据以进行故障排除。">为JVM故障排除启用选项和标志</a></p>
                  </li>
                  <li>
                     <p><a href="prepare-java-troubleshooting.html#GUID-5F04F68A-8F6B-4508-B2F9-0C1DD5E72319" title="如果您的应用程序遇到问题，并且您想进一步调试问题，请确保在重新启动系统之前收集了所有相关数据，尤其是重新启动会删除以前的文件时。">收集相关数据</a></p>
                  </li>
               </ul>
            </div><a id="JSTGD110"></a><div class="props_rev_3"><a id="GUID-9058D741-AF5D-4F22-B0DD-FEF090545229" name="GUID-9058D741-AF5D-4F22-B0DD-FEF090545229"></a><h3 id="JSTGD-GUID-9058D741-AF5D-4F22-B0DD-FEF090545229" class="sect3">设置Java进行故障排除</h3>
               <div>
                  <p>设置Java环境和命令行选项以启用收集相关数据以进行故障排除。</p>
                  <div class="section">
                     <p>要设置Java，请执行以下操作：</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li><span><span class="bold">更新Java版本：</span>使用最新的Java版本，以避免花费时间解决Java中已修复的问题。通常，由Java运行时中的错误引起的问题已在最新的更新版本中得到修复。使用最新的Java版本有助于避免某些已知和常见问题。</span></li>
                     <li><span><span class="bold">设置Java环境进行调试：</span>在设置更大的Java应用程序，使用启动脚本启动应用程序或在多台计算机上运行分布式Java时，请考虑以下情形。</span><ol type="a">
                           <li class="substepexpand"><span><span class="bold">轻松更改Java版本：</span>使用最新的Java版本有助于避免许多运行时问题。如果您的应用程序通过运行脚本启动，请确保仅在一个位置更新Java路径。如果您在分布式系统上运行，请考虑在所有机器上更改Java版本的简便方法。</span></li>
                           <li class="substepexpand"><span><span class="bold">轻松更改Java命令行选项：</span>有时，在进行故障排除时，您可能希望更改Java选项；但是，有时可能需要更改Java选项。例如，添加详细输出，关闭功能或调整Java以获得更好的性能。为这些更改准备系统。</span><div>在远程运行的Java应用程序中，例如在测试框架或云解决方案中，请确保您仍然可以轻松更改Java标志。有时，应用程序需要命令行参数，或者您可能想快速尝试使用标志来重现问题。准备系统以使这些更改变得容易。</div>
                           </li>
                        </ol>
                     </li>
                  </ol>
               </div>
            </div><a id="JSTGD111"></a><div class="props_rev_3"><a id="GUID-CFA2A634-2C12-4A68-8A34-50E56C5AC16D" name="GUID-CFA2A634-2C12-4A68-8A34-50E56C5AC16D"></a><h3 id="JSTGD-GUID-CFA2A634-2C12-4A68-8A34-50E56C5AC16D" class="sect3">为JVM故障排除启用选项和标志</h3>
               <div>
                  <p>设置JVM选项和标志以启用收集相关数据以进行故障排除。</p>
                  <div class="section">
                     <p>您收集的数据取决于系统以及在遇到问题时将使用的数据。考虑收集以下数据。</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span><span class="bold">启用核心文件：</span>如果Java崩溃（例如由于分段错误），则OS将一个<span class="italic">核心文件</span>保存到磁盘（内存的完全转储）。在Linux和Solaris上，默认情况下有时会禁用<span class="italic">核心文件</span> 。要在Linux / Solaris上启用<span class="italic">核心文件</span> ，通常足以运行<code class="codeph">ulimit -c unlimited</code>在启动应用程序命令之前。某些系统可能有不同的方式来处理这些限制。</span><div>
                           <div class="p">
                              <div class="infoboxnote" id="GUID-CFA2A634-2C12-4A68-8A34-50E56C5AC16D__GUID-1A02E4ED-A3D2-4AD1-A548-C6826BCE4AEF">
                                 <p class="notep1">注意：</p><span class="italic">核心文件</span>会占用大量磁盘空间，尤其是在使用大型Java堆运行时。
                              </div> 
                           </div>
                           <p>要决定是否启用<span class="italic">核心文件</span> ，请考虑如果系统崩溃，该怎么办。您要查看核心文件吗？许多Java用户不会对核心文件有太多使用。但是，如果要调试可能的崩溃，请使用本机调试器（例如<code class="codeph">gdb</code>或使用<span class="italic">Serviceability Agent</span> ，然后确保在启动应用程序之前启用<span class="italic">核心文件</span> 。
                           </p>
                           <p>很多时候，崩溃很难重现。因此，请在启动应用程序之前启用核心文件。</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span><span class="bold">将-XX：+ HeapDumpOnOutOfMemoryError添加到JVM标志：</span> <code class="codeph">-XX:+HeapDumpOnOutOfMemoryError</code>如果应用程序运行到<code class="codeph">OutOfMemoryError</code> 。</span><div>
                           <p>像<span class="italic">核心文件</span>一样，堆转储可能非常大，尤其是在使用大型Java堆运行时。
                           </p>
                           <p>再次考虑一下如果应用程序运行到<code class="codeph">OutOfMemoryError</code> 。您想在发生错误时检查堆吗？在这种情况下，默认情况下打开标志，以便在应用程序意外运行时获取此数据<code class="codeph">OutOfMemoryError</code> 。
                           </p>
                        </div>
                     </li>
                     <li class="stepexpand"><span><span class="bold">运行连续的Java飞行记录：</span>设置Java以运行连续的飞行记录。</span><div>
                           <p>连续飞行记录是JFR事件的循环缓冲区。如果应用程序遇到问题，则可以转储运行最后一小时的数据。JFR事件有助于调试各种问题，从内存泄漏到网络错误，CPU使用率高，线程块等等。</p>
                           <p>连续飞行记录的运行开销非常低。请参阅<a href="diagnostic-tools.html#GUID-14DD9297-94CE-4B03-B6B9-4D5B6A7774DC" title="使用Java Mission Control（JMC）轻松管理飞行记录。在命令行上使用启动标志来生成性能分析记录，连续记录和使用诊断命令。您可以将Java Mission Control设置为在满足条件时自动开始或转储飞行记录。这是从JMX控制台完成的。要启动JMX控制台，请在JVM浏览器中找到您的应用程序，右键单击它，然后选择“启动JMX浏览器”。">如何产生飞行记录</a>以产生连续的Java飞行记录。
                           </p>
                        </div>
                     </li>
                     <li class="stepexpand"><span><span class="bold">将-verbosegc添加到JVM命令行：</span>标志<code class="codeph">-verbosegc</code>记录有关Java垃圾收集器的基本信息。该日志可帮助您找到以下内容：</span><div>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>垃圾收集会运行很长时间吗？</p>
                              </li>
                              <li>
                                 <p>可用内存会随着时间减少吗？</p>
                              </li>
                           </ul>
                           <p>当应用程序抛出垃圾邮件时，垃圾收集器日志有助于诊断问题。 <code class="codeph">OutOFMemoryError</code>或应用程序遇到性能问题；因此，打开<code class="codeph">-verbosegc</code>默认情况下标记有助于解决问题。
                           </p>
                           <div class="p">
                              <div class="infoboxnote" id="GUID-CFA2A634-2C12-4A68-8A34-50E56C5AC16D__GUID-163F3746-DB57-49E9-92DA-25AB91CA9098">
                                 <p class="notep1">注意：</p>使用日志轮换，以便应用程序重新启动不会删除以前的日志。从JDK7开始，标志<code class="codeph">UseGClogFileRotation</code>和<code class="codeph">NumberOfGCLogFiles</code>可用于设置日志轮换。有关这些标志的描述，请参见<a href="http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html" target="_blank">Java HotSpot VM的调试选项</a> 。</div> 
                           </div>
                        </div>
                     </li>
                     <li class="stepexpand"><span><span class="bold">打印Java版本和JVM标志：</span>在Java上提交错误或在论坛上寻求帮助之前，请在日志文件中提供基本信息。例如，打印使用的Java版本和JVM标志会很有帮助。</span><div>
                           <p>如果您的应用程序以脚本开头，请运行<code class="codeph">java -version</code>在执行之前打印Java版本并打印命令行。另一种选择是添加<code class="codeph">-XX+PrintCommandLineFlags</code>和<code class="codeph">-showversion</code> JVM参数。
                           </p>
                        </div>
                     </li>
                     <li class="stepexpand"><span><span class="bold">设置JMC JMX进行远程监视：</span>可以使用Mission Control或Visual VM等工具将<span class="bold">JMX远程</span>连接到Java应用程序。除非您可以在运行应用程序的同一台计算机上运行这些工具，否则进行设置对以后监视应用程序，发送诊断命令，管理飞行记录等很有帮助。如果启用JMX，则不会有性能开销。</span><div>
                           <p>另一种选择是在启动Java应用程序后启用JMX，即使用诊断命令<code class="codeph">ManagementAgent.start</code> 。跑<code class="codeph">jcmd <pid> help ManagementAgent.start</code>有关可以与命令一起发送的标志的列表。
                           </p>
                           <p>请参阅<a href="diagnostic-tools.html#GUID-42A18B29-B4AD-4831-B846-2CDBA55F2254" title="jcmd实用程序用于将诊断命令请求发送到JVM，这些请求对于控制Java Flight Recording，故障排除和诊断JVM和Java应用程序很有用。">jcmd实用程序</a> 。
                           </p>
                        </div>
                     </li>
                  </ol>
               </div>
            </div><a id="JSTGD112"></a><div class="props_rev_3"><a id="GUID-5F04F68A-8F6B-4508-B2F9-0C1DD5E72319" name="GUID-5F04F68A-8F6B-4508-B2F9-0C1DD5E72319"></a><h3 id="JSTGD-GUID-5F04F68A-8F6B-4508-B2F9-0C1DD5E72319" class="sect3">收集相关数据</h3>
               <div>
                  <p>如果您的应用程序遇到问题，并且您想进一步调试问题，请确保在重新启动系统之前收集了所有相关数据，尤其是重新启动会删除以前的文件时。</p>
                  <ul>
                     <li class="stepexpand"><span>收集以下文件很重要：</span><div>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>崩溃问题的核心文件。</p>
                              </li>
                              <li>
                                 <p><code class="codeph">hs_err</code> Java的打印文本文件崩溃。
                                 </p>
                              </li>
                              <li>
                                 <p>日志文件：Java和应用程序日志。</p>
                              </li>
                              <li>
                                 <p>的Java堆转储<code class="codeph">-XX:+HeapDumpOnOutOfMemoryError</code> 。
                                 </p>
                              </li>
                              <li>
                                 <p>Java飞行记录（如果启用）。如果问题没有终止应用程序，则转储连续的记录。</p>
                              </li>
                           </ul>
                        </div>
                     </li>
                     <li class="stepexpand"><span>如果应用程序停止响应，则收集以下文件：</span><div>
                           <ul style="list-style-type:disc">
                              <li>
                                 <p>堆栈跟踪：使用以下几个堆栈跟踪<code class="codeph">jcmd <pid> Thread.print</code>在重新启动系统之前。
                                 </p>
                              </li>
                              <li>
                                 <p>转储飞行记录（如果启用）。</p>
                              </li>
                              <li>
                                 <p>强制核心文件：如果无法正确关闭应用程序，则停止应用程序，然后使用以下命令强制核心文件<code class="codeph">kill -6 <pid></code>在Linux或Solaris系统上。
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </li>
                  </ul>
               </div><a id="JSTGD113"></a><div class="props_rev_3"><a id="GUID-9CBBB26E-E7DB-45D6-AF74-5CC44BF01287" name="GUID-9CBBB26E-E7DB-45D6-AF74-5CC44BF01287"></a><h4 id="JSTGD-GUID-9CBBB26E-E7DB-45D6-AF74-5CC44BF01287" class="sect4">使Java应用程序更易于调试</h4>
                  <div>
                     <p>使用日志记录框架是启用将来调试的好方法。</p>
                     <p>如果您在特定模块中遇到问题，则应该能够启用该模块中的登录功能。最好指定不同级别的日志记录，例如信息，调试和跟踪。</p>
                  </div>
               </div>
            </div>
         </div>
      </article>
   

</body></html>