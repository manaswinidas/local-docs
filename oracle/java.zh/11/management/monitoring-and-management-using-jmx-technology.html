<html lang="en-us"  xml:lang="en-us"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Monitoring and Management Using JMX Technology</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Monitoring and Management Guide">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Monitoring and Management Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="java-se-monitoring-and-management-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-21T10:39:15-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="2006, 2018">
      <meta name="dcterms.category" content="java">
      <meta name="dcterms.identifier" content="E95200-01">
      
      <meta name="dcterms.product" content="en/java/javase/11">
      <meta name="dcterms.release" content="11">
      <link rel="prev" href="overview-java-se-monitoring-and-management.html" title="Previous" type="text/html">
      <link rel="next" href="using-jconsole.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"java","element_name":"Java","display_in_url":true},"suite":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product_group":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product":{"short_name":"javase","element_name":"Java SE","display_in_url":true},"release":{"short_name":"11","element_name":"11","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Java SE Monitoring and Management Guide">
    <meta name="dcterms.isVersionOf" content="MANAGEMENT">
  <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="overview-java-se-monitoring-and-management.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一个</a> <a href="using-jconsole.html" class="pull-right">下一个<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">监控管理指南</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用JMX技术进行监视和管理</li>
            </ol>
            <a id="GUID-805517EC-2D33-4D61-81D8-4D0FA770D1B8" name="GUID-805517EC-2D33-4D61-81D8-4D0FA770D1B8"></a>
            
            <h2 id="JSMGM-GUID-805517EC-2D33-4D61-81D8-4D0FA770D1B8" class="sect2"><span class="enumeration_chapter">2</span>使用JMX技术进行监视和管理</h2>
         </header>
         <div class="ind">
            <div>
               <p>Java虚拟机（Java VM）具有内置的工具，使您可以使用Java管理扩展（JMX）技术对其进行监视和管理。这些内置的管理实用程序通常被称为Java VM <span class="variable" translate="no">out-of-the-box management</span>工具。您还可以使用JMX API监视任何经过适当检测的应用程序。</p>
            </div>
            <div class="sect2"><a id="GUID-586BDF8F-A98E-4C16-AAA3-387E96309686" name="GUID-586BDF8F-A98E-4C16-AAA3-387E96309686"></a><h3 id="JSMGM-GUID-586BDF8F-A98E-4C16-AAA3-387E96309686" class="sect3">设置系统属性</h3>
               <div>
                  <p>要启用和配置现成的JMX代理以监视和管理Java VM，必须在启动Java VM时设置某些系统属性。您可以在命令行上设置系统属性，如下所示：</p><pre class="pre codeblock"><code>java -D<span class="italic">property</span>=<span class="italic">value</span> ...
</code></pre><p>您可以通过这种方式设置任意数量的系统属性。如果您没有为管理属性指定值，那么该属性将设置为其默认值。有关完整的即用型管理属性，请<a href="monitoring-and-management-using-jmx-technology.html#GUID-2C1922AD-4BA0-4397-A3FE-7823F42A94A3__READY-TO-USEMONITORINGANDMANAGEMENT-0CCB777F" title="即用型监视和管理属性">参见表2-1</a> 。您也可以按照<a href="monitoring-and-management-using-jmx-technology.html#GUID-2C1922AD-4BA0-4397-A3FE-7823F42A94A3">准备使用的监视和管理属性</a>部分中的说明，在配置文件中设置系统属性。
                  </p>
                  <div class="p">
                     <div class="infoboxnote" id="GUID-586BDF8F-A98E-4C16-AAA3-387E96309686__GUID-E3F1AB13-A780-47BD-8337-F21D66D1690E">
                        <p class="notep1">注意：</p>要从命令行运行Java VM，必须添加<code class="codeph"><span class="variable" translate="no">JRE_HOME</span>/bin</code>到你的路，在哪里<code class="codeph"><span class="variable" translate="no">JRE_HOME</span></code>是包含Java Runtime Environment（JRE）实现的目录。或者，您可以在输入命令时输入完整路径。
                     </div>
                  </div>
                  <p><span><cite>Java平台标准版工具参考</cite></span>的<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/java/javase/11/management&id=JSWOR-GUID-3B1CE181-CD30-4178-9602-230B800D4FAE" target="_blank">Java应用程序启动器</a>部分中描述了Java HotSpot VM支持的语法和全套命令行选项。
                  </p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-E17343B0-FED2-4050-88D7-E4793E704ED5" name="GUID-E17343B0-FED2-4050-88D7-E4793E704ED5"></a><h3 id="JSMGM-GUID-E17343B0-FED2-4050-88D7-E4793E704ED5" class="sect3">启用即用型管理</h3>
               <div>
                  <p>要使用JMX API监视Java平台，必须执行以下操作：</p>
                  <ol>
                     <li>
                        <p>启动Java VM时，启用JMX代理（平台MBean服务器的另一个名称）。您可以为以下各项启用JMX代理：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>本地监视，用于在本地系统上运行的客户端管理应用程序。</p>
                           </li>
                           <li>
                              <p>远程监视，用于在远程系统上运行的客户端管理应用程序。</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>使用符合JMX规范的工具（例如JConsole）监视Java VM。请参阅<a href="using-jconsole.html#GUID-77416B38-7F15-4E35-B3D1-34BFD88350B5">使用JConsole</a> 。
                        </p>
                     </li>
                  </ol>
               </div>
               <div class="sect3"><a id="GUID-096EA656-4D07-4B09-A493-9EDEF83ABF28" name="GUID-096EA656-4D07-4B09-A493-9EDEF83ABF28"></a><h4 id="JSMGM-GUID-096EA656-4D07-4B09-A493-9EDEF83ABF28" class="sect4">本地监控和管理</h4>
                  <div>
                     <p>在启动Java VM或Java应用程序之前，您设置了以下属性以允许JMX客户端访问本地Java VM：</p><pre class="pre codeblock"><code>com.sun.management.jmxremote
</code></pre><p>设置此属性将注册Java VM平台的MBean，并通过专用接口发布远程方法调用（RMI）连接器。此设置允许JMX客户端应用程序监视本地Java平台，即与JMX客户端在同一台计算机上运行的Java VM。</p>
                     <p>在当前的Java SE平台中，不再需要设置此系统属性。在当前Java SE平台上启动的任何应用程序都支持Attach API，并且将在需要时自动用于本地监视和管理。</p>
                     <p>例如，以前，要为Java SE示例应用程序启用JMX代理<code class="codeph">Notepad</code> ，您将运行以下命令：</p><pre class="pre codeblock"><code>% cd <span class="variable" translate="no">JDK_HOME</span>/demo/jfc/Notepad
% java -Dcom.sun.management.jmxremote -jar Notepad.jar
</code></pre><p>在前面的命令中， <code class="codeph"><span class="variable" translate="no">JDK_HOME</span></code>是Java开发工具包（JDK）的安装目录。在当前的Java SE平台上，您必须运行以下命令来启动<code class="codeph">Notepad</code> 。
                     </p><pre class="pre codeblock"><code>% java -jar Notepad.jar
</code></pre><p>后<code class="codeph">Notepad</code>已启动，则使用Attach API的JMX客户端可以使开箱即用的管理代理监视和管理<code class="codeph">Notepad</code>应用。
                     </p>
                     <div class="infoboxnote" id="GUID-096EA656-4D07-4B09-A493-9EDEF83ABF28__GUID-4AAFB0B7-1160-4FB2-A549-A6BE0D4DA066">
                        <p class="notep1">注意：</p>在Windows平台上，出于安全原因，仅当默认临时目录位于允许设置文件和目录权限的文件系统上（例如，在新技术文件系统（NTFS）文件系统上）时，才支持本地监视和管理。 ）。文件分配表（FAT）文件系统不支持它，该文件系统提供了不足的访问控制。
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-6F896ED5-D517-4825-869B-BB045AF51A92" name="GUID-6F896ED5-D517-4825-869B-BB045AF51A92"></a><h5 id="JSMGM-GUID-6F896ED5-D517-4825-869B-BB045AF51A92" class="sect5">使用JConsole进行本地监视和管理</h5>
                     <div>
                        <p>使用JConsole进行本地监视对于开发和创建原型很有用。不建议在生产环境中本地使用JConsole，因为JConsole本身会消耗大量系统资源。相反，您应该在远程系统上使用JConsole使其与受监视的平台隔离。</p>
                        <p>但是，如果您确实希望使用JConsole执行本地监视，则可以通过输入以下内容来启动该工具<code class="codeph">jconsole</code>在命令外壳中。你几时开始<code class="codeph">jconsole</code>如果不带任何参数，它将自动检测所有本地Java应用程序，并显示一个对话框，使您可以选择要监视的应用程序。JConsole和应用程序都必须由同一用户执行，因为监视和管理系统使用操作系统的文件许可权。
                        </p>
                        <div class="infoboxnote" id="GUID-6F896ED5-D517-4825-869B-BB045AF51A92__GUID-E200F4D2-98BA-440B-9334-A8CB522C06DA">
                           <p class="notep1">注意：</p>要从命令行运行JConsole，必须添加<code class="codeph"><span class="variable" translate="no">JDK_HOME</span>/bin</code>到你的路。或者，您可以在输入命令时输入完整路径。请参阅<a href="using-jconsole.html#GUID-77416B38-7F15-4E35-B3D1-34BFD88350B5">使用JConsole</a> 。
                        </div>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-F08985BB-629A-4FBF-A0CB-8762DF7590E0" name="GUID-F08985BB-629A-4FBF-A0CB-8762DF7590E0"></a><h4 id="JSMGM-GUID-F08985BB-629A-4FBF-A0CB-8762DF7590E0" class="sect4">远程监控与管理</h4>
                  <div>
                     <p>默认情况下，发送到客户端的本地创建的远程对象的远程存根包含本地主机的IP地址。 <code class="codeph">dotted-quad</code>格式。为了使远程存根与特定的接口地址相关联， <code class="codeph">java.rmi.server.hostname</code>系统属性必须设置为该接口的IP地址。
                     </p>
                     <p>要从远程系统启用监视和管理，必须在启动Java VM时设置以下系统属性：</p><pre class="pre codeblock"><code>com.sun.management.jmxremote.port=<span class="variable" translate="no">portNum</span>
</code></pre><div class="p">哪里， <code class="codeph"><span class="variable" translate="no">portNum</span></code>是启用JMX RMI连接的端口号。确保指定未使用的端口号。除了发布用于本地访问的RMI连接器之外，设置此属性还会使用名称在指定端口的专用只读注册表中发布其他RMI连接器， <code class="codeph">jmxrmi</code> 。使用系统属性将RMI连接器绑定到的端口号：<pre class="pre codeblock"><code>com.sun.management.jmxremote.rmi.port</code></pre></div>
                     <p>确保使用未使用的端口号。</p>
                     <div class="infoboxnote" id="GUID-F08985BB-629A-4FBF-A0CB-8762DF7590E0__GUID-F8421E59-E595-44C4-9AC7-02BB6F142F50">
                        <p class="notep1">注意：</p>除了可能为安全性设置的任何属性之外，还必须设置先前的系统属性。
                     </div>
                     <p>远程监视和管理需要安全性，以确保未授权人员无法控制或监视您的应用程序。默认情况下，通过安全套接字层（SSL）和传输层安全性（TLS）启用密码身份验证。您可以分别禁用密码验证和SSL。</p>
                     <div class="infoboxnote" id="GUID-F08985BB-629A-4FBF-A0CB-8762DF7590E0__GUID-F506A7AC-3C09-4DE3-83F5-3A4AE32C5C11">
                        <p class="notep1">注意：</p>对于生产系统，请同时使用<a href="monitoring-and-management-using-jmx-technology.html#GUID-7E213B43-C044-4D70-A4F4-BDA60B7E7891">SSL客户端证书</a>来认证客户端主机和用于用户管理的密码认证。请参阅<a href="monitoring-and-management-using-jmx-technology.html#GUID-FA9A0A97-6016-4283-9E9C-983C4D6F96D4">使用SSL</a>和<a href="monitoring-and-management-using-jmx-technology.html#GUID-CC2C1BC4-72BB-4C1F-B398-C48467A1F313">使用LDAP身份验证</a> 。
                     </div>
                     <p>Java平台支持用于身份验证的可插入<a href="https://docs.oracle.com/javase/10/docs/api/com/sun/security/auth/module/package-summary.html" target="_blank"><span class="apiname">登录模块</span></a> 。您可以插入任何登录模块，具体取决于组织中的身份验证基础结构。<a href="monitoring-and-management-using-jmx-technology.html#GUID-CC2C1BC4-72BB-4C1F-B398-C48467A1F313">使用LDAP身份验证</a>介绍了如何插入<a href="https://docs.oracle.com/javase/10/docs/api/com/sun/security/auth/module/LdapLoginModule.html" target="_blank"><span class="apiname">com.sun.security.auth.module。LdapLoginModule</span></a>模块，用于基于轻量级目录访问协议（LDAP）的身份验证。
                     </p>
                     <p>启用JMX代理以供远程使用之后，可以使用JConsole监视应用程序，如使用JConsole进行<a href="monitoring-and-management-using-jmx-technology.html#GUID-EC81EB65-09FD-4179-A5FA-F1EDEB84018E">远程监视中</a>所述。以编程方式<a href="monitoring-and-management-using-jmx-technology.html#GUID-7B962724-69BC-46AF-A46E-4A47A4E0B57A">连接到JMX代理中</a>介绍了如何以编程方式连接到管理代理。
                     </p>
                  </div>
                  <div class="sect4"><a id="GUID-2F341A54-B0B0-4268-BDD7-5CFAB52A6C90" name="GUID-2F341A54-B0B0-4268-BDD7-5CFAB52A6C90"></a><h5 id="JSMGM-GUID-2F341A54-B0B0-4268-BDD7-5CFAB52A6C90" class="sect5">使用密码验证</h5>
                     <div>
                        <p>本节详细介绍了可以根据要求实现的不同密码认证方法。</p>
                     </div>
                     <div class="sect5"><a id="GUID-CC2C1BC4-72BB-4C1F-B398-C48467A1F313" name="GUID-CC2C1BC4-72BB-4C1F-B398-C48467A1F313"></a><h6 id="JSMGM-GUID-CC2C1BC4-72BB-4C1F-B398-C48467A1F313" class="sect6">使用LDAP验证</h6>
                        <div>
                           <p>JMX代理中的<a href="https://docs.oracle.com/javase/10/docs/api/javax/management/remote/JMXAuthenticator.html" target="_blank"><span class="apiname">JMXAuthenticator</span></a>实现基于Java身份验证和授权服务（JAAS）技术。通过将用户凭证传递给JAAS <a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/spi/LoginModule.html" target="_blank"><span class="apiname">javax.security.auth.spi来执行认证</span></a><a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/spi/LoginModule.html" target="_blank"><span class="apiname">。LoginModule</span></a>对象。<a href="https://docs.oracle.com/javase/10/docs/api/com/sun/security/auth/module/LdapLoginModule.html" target="_blank"><span class="apiname">com.sun.security.auth.module。LdapLoginModule</span></a>类启用使用LDAP的身份验证。您可以替换默认<code class="codeph">LoginModule</code>与类<code class="codeph">LdapLoginModule</code>类。
                           </p>
                           <p>创建可在所需业务组织中工作的JAAS配置文件。这是一个配置文件的示例（ <code class="codeph">ldap.config</code> ）：</p><pre class="pre codeblock"><code>ExampleCompanyConfig {
    com.sun.security.auth.module.LdapLoginModule REQUIRED
        userProvider="ldap://example-ds/ou=people,dc=examplecompany,dc=com"
        userFilter="(&amp;(uid={USERNAME})(objectClass=inetOrgPerson))"
        authzIdentity=monitorRole;
    };</code></pre><p>这是配置文件中提到的选项的概述：</p>
                           <ul style="list-style-type:disc">
                              <li>的<code class="codeph">com.sun.security.auth.module.LdapLoginModule REQUIRED</code>选项表示使用<code class="codeph">LdapLoginModule</code>要使整体身份验证成功，必须输入。
                              </li>
                              <li>的<code class="codeph">userProvider</code>选项标识LDAP服务器以及用户条目所在的目录树中的位置。
                              </li>
                              <li>的<code class="codeph">userFilter</code> option指定用于在LDAP目录中查找用户条目的搜索过滤器。代币<code class="codeph">{USERNAME}</code>在使用过滤器搜索目录之前，将用户名替换为用户名。
                              </li>
                              <li>的<code class="codeph">authzIdentity</code>选项指定经过身份验证的用户的访问角色。在此示例中，通过身份验证的用户将拥有<code class="codeph">monitorRole</code>选项。请参阅<a href="monitoring-and-management-using-jmx-technology.html#GUID-CA2FCB18-B639-4967-8E63-233E612E9D71">访问文件</a> 。
                              </li>
                           </ul>
                           <p><a href="https://docs.oracle.com/javase/10/docs/api/com/sun/security/auth/module/LdapLoginModule.html" target="_blank"><span class="apiname">com.sun.security.auth.module中解释了代码示例中提到的配置选项的详细信息</span></a><a href="https://docs.oracle.com/javase/10/docs/api/com/sun/security/auth/module/LdapLoginModule.html" target="_blank"><span class="apiname">。LdapLoginModule</span></a>类。
                           </p>
                           <p>在命令行上设置以下属性来启动应用程序：</p>
                           <ul style="list-style-type:disc">
                              <li><code class="codeph">com.sun.management.jmxremote.login.config</code> ：此<a href="monitoring-and-management-using-jmx-technology.html#GUID-2C1922AD-4BA0-4397-A3FE-7823F42A94A3__COM.SUN.MANAGEMENT.JMXREMOTE.LOGIN.-0CC996DC">属性</a>将JMX代理配置为使用指定的JAAS配置条目。
                              </li>
                              <li><code class="codeph">java.security.auth.login.config</code> ：此属性指定JAAS配置文件的路径。
                              </li>
                           </ul>
                           <p>这是一个示例命令行：</p><pre class="pre codeblock"><code>java -Dcom.sun.management.jmxremote.port=5000
     -Dcom.sun.management.jmxremote.login.config=ExampleCompanyConfig
     -Djava.security.auth.login.config=ldap.config
     -jar MyApplication.jar
</code></pre></div>
                     </div>
                     <div class="sect5"><a id="GUID-CFC3EF23-B816-459D-9A45-0A46425FA645" name="GUID-CFC3EF23-B816-459D-9A45-0A46425FA645"></a><h6 id="JSMGM-GUID-CFC3EF23-B816-459D-9A45-0A46425FA645" class="sect6">使用基于文件的密码身份验证</h6>
                        <div>
                           <p>JMX代理支持的基于文件的密码身份验证机制将密码以明文形式存储，并且仅供开发使用。对于生产用途，建议您使用<a href="monitoring-and-management-using-jmx-technology.html#GUID-7E213B43-C044-4D70-A4F4-BDA60B7E7891">SSL客户端证书</a>进行身份验证或插入安全的登录配置。
                           </p>
                           <div class="infoboxnote" id="GUID-CFC3EF23-B816-459D-9A45-0A46425FA645__GUID-B0EE9BE6-E368-47EE-8AB4-8A0AD17B4692">
                              <p class="notep1">注意：</p><span class="bold">警告</span> ：当客户端从不安全的RMI注册表（默认值）获得远程连接器时，通过远程连接器的密码验证已识别出潜在的安全问题。如果攻击者在启动合法注册表之前在目标服务器上启动了伪造的RMI注册表，则攻击者可以窃取客户端的密码。此方案包括使用system属性启动启用了远程管理的Java VM的情况<code class="codeph">com.sun.management.jmxremote.port=<span class="variable" translate="no">portNum</span></code> ，即使启用了SSL。尽管这类攻击很可能会被注意到，但这仍然是一个漏洞。
                           </div>
                           <p>默认情况下，启用JMX代理进行远程监视时，它将使用密码身份验证。但是，设置方式取决于您是在单用户环境中还是在多用户环境中。</p>
                           <p>由于密码以明文形式存储在密码文件中，因此建议不要使用常规用户名和密码进行监视。而是使用密码文件中指定的用户名，例如<code class="codeph">monitorRole</code>和<code class="codeph">controlRole</code> 。请参阅<a href="monitoring-and-management-using-jmx-technology.html#GUID-D4CBA2D6-2E24-4856-A7D8-62B3DFFB76EA">使用密码和访问文件</a> 。
                           </p>
                        </div>
                        <div class="sect6"><a id="GUID-08484F70-31A5-4B87-A7DD-2BCCD2E6580D" name="GUID-08484F70-31A5-4B87-A7DD-2BCCD2E6580D"></a><h6 id="JSMGM-GUID-08484F70-31A5-4B87-A7DD-2BCCD2E6580D" class="sect6">设置单用户环境</h6>
                           <div>
                              <p>您可以在<code class="codeph"><span class="variable" translate="no">JRE_HOME</span>/lib/management</code>目录如下：</p>
                              <ol>
                                 <li>复制密码模板文件， <code class="codeph">jmxremote.password.template</code> ， 至<code class="codeph">jmxremote.password</code> 。
                                 </li>
                                 <li>设置文件权限，以便只有所有者才能读取和写入密码文件。</li>
                                 <li>为以下角色添加密码： <code class="codeph">monitorRole</code>和<code class="codeph">controlRole.</code></li>
                              </ol>
                           </div>
                        </div>
                        <div class="sect6"><a id="GUID-D6F0189F-CC61-4132-9D36-FFE3623A7E35" name="GUID-D6F0189F-CC61-4132-9D36-FFE3623A7E35"></a><h6 id="JSMGM-GUID-D6F0189F-CC61-4132-9D36-FFE3623A7E35" class="sect6">设置多用户环境</h6>
                           <div>
                              <p>您可以在<code class="codeph"><span class="variable" translate="no">JRE_HOME</span>/lib/management</code>目录如下：</p>
                              <ol>
                                 <li>复制密码模板文件， <code class="codeph">jmxremote.password.template</code>到您的主目录，并将其重命名为<code class="codeph">jmxremote.password</code> 。
                                 </li>
                                 <li>设置文件权限，以便只有您可以读写密码文件。</li>
                                 <li>为以下角色添加密码： <code class="codeph">monitorRole</code>和<code class="codeph">controlRole</code> 。
                                 </li>
                                 <li>启动Java VM时，设置以下系统属性。<pre class="pre codeblock"><code>com.sun.management.jmxremote.password.file=<span class="variable" translate="no">pwFilePath</span></code></pre><p>在上述属性中， <code class="codeph"><span class="variable" translate="no">pwFilePath</span></code>是密码文件的路径。
                                    </p>
                                 </li>
                              </ol>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-9ED79A3B-B710-4B89-A64D-5C566A160A95" name="GUID-9ED79A3B-B710-4B89-A64D-5C566A160A95"></a><h5 id="JSMGM-GUID-9ED79A3B-B710-4B89-A64D-5C566A160A95" class="sect5">禁用密码认证</h5>
                     <div>
                        <p>默认情况下，将启用用于远程监视的密码身份验证。要禁用它，请在启动Java VM时设置以下系统属性：</p><pre class="pre codeblock"><code>com.sun.management.jmxremote.authenticate=false
</code></pre><div class="p">
                           <div class="infoboxnote" id="GUID-9ED79A3B-B710-4B89-A64D-5C566A160A95__GUID-23AC8DEA-38B0-4B7E-BBDC-BE9EAEB3A567">
                              <p class="notep1">注意：</p><span class="bold">注意</span> ：此配置不安全。任何知道（或猜测）您的JMX端口号和主机名的远程用户都将能够监视和控制您的Java应用程序和平台。尽管可以接受开发，但不建议将其用于生产系统。
                           </div>
                        </div>
                        <p>禁用密码身份验证时，还可以禁用SSL，如<a href="monitoring-and-management-using-jmx-technology.html#GUID-D0720E6F-4AC6-4C37-91C9-40069C0304AB">禁用安全性中所述</a> 。您还可以禁用密码，但是使用SSL客户端身份验证，如<a href="monitoring-and-management-using-jmx-technology.html#GUID-7E213B43-C044-4D70-A4F4-BDA60B7E7891">启用SSL客户端身份验证中所述</a> 。
                        </p>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-FA9A0A97-6016-4283-9E9C-983C4D6F96D4" name="GUID-FA9A0A97-6016-4283-9E9C-983C4D6F96D4"></a><h5 id="JSMGM-GUID-FA9A0A97-6016-4283-9E9C-983C4D6F96D4" class="sect5">使用SSL</h5>
                     <div>
                        <p>启用远程监视和管理时，默认情况下启用SSL。要使用SSL，您需要在运行JMX代理（MBean服务器）的系统上设置数字证书，然后正确配置SSL。您使用命令行实用程序<code class="codeph">keytool</code>使用证书。
                        </p>
                        <p>设置SSL的一般过程如下：</p>
                        <ol>
                           <li>如果在服务器上没有设置密钥对和证书，请执行以下任务：<ul style="list-style-type:disc">
                                 <li>
                                    <p>使用以下命令生成密钥对<code class="codeph">keytool -genkey</code>命令。
                                    </p>
                                 </li>
                                 <li>
                                    <p>向证书颁发机构（CA）请求签名的证书，其中包括<code class="codeph">keytool -certreq</code>命令。
                                    </p>
                                 </li>
                                 <li>
                                    <p>使用以下命令将证书导入到您的密钥库中： <code class="codeph">keytool -import</code>命令。请参阅中的<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/java/javase/11/management&id=JSWOR-GUID-5990A2E4-78E3-47B7-AE75-6D1826259549#GUID-5990A2E4-78E3-47B7-AE75-6D1826259549/KEYTOOL_OPTION_IMPORTCERT" target="_blank">导入证书</a> <code class="codeph">keytool</code>文档。
                                    </p>
                                 </li>
                              </ul>
                           </li>
                           <li>在服务器系统上配置SSL。有关配置和自定义SSL的完整说明不在本文档的讨论范围内，但是您通常需要按照以下列表中的说明设置系统属性：<table cellpadding="4" cellspacing="0" border="1" id="GUID-FA9A0A97-6016-4283-9E9C-983C4D6F96D4__SYSTEMPROPERTYDESCRIPTION-A6D1752A" summary="" frame="hsides" rules="rows" role="presentation">
                                 <tbody><tr>
                                    <td valign="top"><code class="codeph">javax.net.ssl.keyStore</code></td>
                                    <td valign="top">
                                       <p>密钥库位置</p>
                                    </td>
                                 </tr>
                                 <tr>
                                    <td valign="top"><code class="codeph">javax.net.ssl.keyStoreType</code></td>
                                    <td valign="top">
                                       <p>默认密钥库类型</p>
                                    </td>
                                 </tr>
                                 <tr>
                                    <td valign="top"><code class="codeph">javax.net.ssl.keyStorePassword</code></td>
                                    <td valign="top">
                                       <p>默认密钥库密码</p>
                                    </td>
                                 </tr>
                                 <tr>
                                    <td valign="top"><code class="codeph">javax.net.ssl.trustStore</code></td>
                                    <td valign="top">
                                       <p>信任库位置</p>
                                    </td>
                                 </tr>
                                 <tr>
                                    <td valign="top"><code class="codeph">javax.net.ssl.trustStoreType</code></td>
                                    <td valign="top">
                                       <p>默认信任库类型</p>
                                    </td>
                                 </tr>
                                 <tr>
                                    <td valign="top"><code class="codeph">javax.net.ssl.trustStorePassword</code></td>
                                    <td valign="top">
                                       <p>默认信任库密码</p>
                                    </td>
                                 </tr>
                              </tbody></table>
                              <p>设置系统属性在“ <a href="monitoring-and-management-using-jmx-technology.html#GUID-586BDF8F-A98E-4C16-AAA3-387E96309686">设置系统属性”</a>部分中进行了详细说明。
                              </p>
                              <p>看到：</p>
                              <ul style="list-style-type:disc">
                                 <li><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/java/javase/11/management&id=JSWOR-GUID-5990A2E4-78E3-47B7-AE75-6D1826259549" target="_blank">keytool-</a> <span><cite>Java平台标准版工具参考</cite></span>中的<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/java/javase/11/management&id=JSWOR-GUID-5990A2E4-78E3-47B7-AE75-6D1826259549" target="_blank">密钥和证书管理工具</a> 
                                 </li>
                                 <li>
                                    <p>在<span><cite>Java平台中</cite></span> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/java/javase/11/management&id=JSSEC-GUID-7D9F43B8-AABF-4C5B-93E6-3AFB18B66150" target="_blank">自定义默认密钥库和信任库，商店类型和商店密码</a> <span><cite>，《标准版安全性开发人员指南》</cite></span></p>
                                 </li>
                              </ul>
                           </li>
                        </ol>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-BA10AD87-78E8-4248-B648-D02284D21626" name="GUID-BA10AD87-78E8-4248-B648-D02284D21626"></a><h5 id="JSMGM-GUID-BA10AD87-78E8-4248-B648-D02284D21626" class="sect5">启用RMI注册表身份验证</h5>
                     <div>
                        <p>设置监视远程应用程序的连接时，可以选择将RMI连接器存根绑定到受SSL保护的RMI注册表。这允许具有适当SSL证书的客户端获取在RMI注册表中注册的连接器存根。要使用SSL保护RMI注册表，必须设置以下系统属性：</p><pre class="pre codeblock"><code>com.sun.management.jmxremote.registry.ssl=true
</code></pre><p>当此属性设置为<code class="codeph">true</code>启动Java VM时，即用型管理代理将创建和配置受SSL保护的RMI注册表。此属性的默认值为<code class="codeph">false</code> 。但是，建议您将此属性设置为<code class="codeph">true</code> 。如果将此属性设置为<code class="codeph">true</code> ，则要具有完全的安全性，还必须启用SSL客户端身份验证。
                        </p>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-7E213B43-C044-4D70-A4F4-BDA60B7E7891" name="GUID-7E213B43-C044-4D70-A4F4-BDA60B7E7891"></a><h5 id="JSMGM-GUID-7E213B43-C044-4D70-A4F4-BDA60B7E7891" class="sect5">启用SSL客户端身份验证</h5>
                     <div>
                        <p>要启用SSL客户端身份验证，请在启动Java VM时设置以下系统属性：</p><pre class="pre codeblock"><code>com.sun.management.jmxremote.ssl.need.client.auth=true
</code></pre><p>必须启用SSL（默认设置为<code class="codeph">false</code> ）以使用客户端SSL身份验证。建议您将此属性设置为<code class="codeph">true</code> 。此配置要求客户端系统具有有效的数字证书。您必须按照<a href="monitoring-and-management-using-jmx-technology.html#GUID-FA9A0A97-6016-4283-9E9C-983C4D6F96D4">使用SSL中</a>所述在客户端系统上安装证书并配置<a href="monitoring-and-management-using-jmx-technology.html#GUID-FA9A0A97-6016-4283-9E9C-983C4D6F96D4">SSL</a> 。如上一节所述，如果启用了RMI注册表SSL保护，则必须将客户端SSL身份验证设置为<code class="codeph">true</code> 。
                        </p>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-7F4C3AD0-D054-4ABF-9DB2-C39D8E6AFCB8" name="GUID-7F4C3AD0-D054-4ABF-9DB2-C39D8E6AFCB8"></a><h5 id="JSMGM-GUID-7F4C3AD0-D054-4ABF-9DB2-C39D8E6AFCB8" class="sect5">禁用SSL</h5>
                     <div>
                        <p>要在远程监视时禁用SSL，必须在启动Java VM时设置以下系统属性：</p><pre class="pre codeblock"><code>com.sun.management.jmxremote.ssl=false
</code></pre><p>除非您按照<a href="monitoring-and-management-using-jmx-technology.html#GUID-9ED79A3B-B710-4B89-A64D-5C566A160A95">禁用密码身份</a>验证中的说明将其禁用，否则仍然需要<a href="monitoring-and-management-using-jmx-technology.html#GUID-9ED79A3B-B710-4B89-A64D-5C566A160A95">密码身份验证</a> 。
                        </p>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-D0720E6F-4AC6-4C37-91C9-40069C0304AB" name="GUID-D0720E6F-4AC6-4C37-91C9-40069C0304AB"></a><h5 id="JSMGM-GUID-D0720E6F-4AC6-4C37-91C9-40069C0304AB" class="sect5">禁用安全性</h5>
                     <div>
                        <p>要同时禁用密码认证和SSL（即禁用<span class="bold">所有</span>安全性），应在启动Java VM时设置以下系统属性：</p><pre class="pre codeblock"><code>com.sun.management.jmxremote.authenticate=false
com.sun.management.jmxremote.ssl=false
</code></pre><div class="infoboxnote" id="GUID-D0720E6F-4AC6-4C37-91C9-40069C0304AB__GUID-2D7859AB-2CE6-4F16-8969-CA97B53A8494">
                           <p class="notep1">注意：</p><span class="bold">注意</span> ：此配置不安全；任何知道（或猜测）您的端口号和主机名的远程用户都将能够监视和控制您的Java应用程序和平台。此外，可能的危害不仅限于您在MBean中定义的操作。远程客户端可以创建一个<code class="codeph">javax.management.loading.MLet</code> MBean，并至少在没有安全管理器的情况下，使用它从任意URL创建新的MBean。换句话说，远程客户端可以使您的Java应用程序执行任意代码。
                        </div>
                        <p></p>
                        <p>因此，虽然禁用安全性对于开发来说是可以接受的，但强烈建议您不要对生产系统禁用安全性。</p>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-EC81EB65-09FD-4179-A5FA-F1EDEB84018E" name="GUID-EC81EB65-09FD-4179-A5FA-F1EDEB84018E"></a><h5 id="JSMGM-GUID-EC81EB65-09FD-4179-A5FA-F1EDEB84018E" class="sect5">使用JConsole进行远程监视</h5>
                     <div>
                        <p>您可以使用JConsole远程监视应用程序，无论是否启用安全性。</p>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-8CF90313-3A12-45BD-93C1-3495139D0457" name="GUID-8CF90313-3A12-45BD-93C1-3495139D0457"></a><h5 id="JSMGM-GUID-8CF90313-3A12-45BD-93C1-3495139D0457" class="sect5">使用启用了SSL的JConsole进行远程监视</h5>
                     <div>
                        <p>要监视启用了SSL的远程应用程序，您需要设置<code class="codeph">truststore</code>运行JConsole的系统上的文件并正确配置SSL。例如，您可以创建一个<code class="codeph">keystore</code>文件并启动您的应用程序（称为<code class="codeph">Server</code>在此示例中），使用以下命令：</p><pre class="pre codeblock"><code>% java -Djavax.net.ssl.keyStore=keystore \
  -Djavax.net.ssl.keyStorePassword=password Server
</code></pre><p>请参阅《 <span><cite>Java平台标准版安全性开发人员指南》中的“</cite></span> <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/java/javase/11/management&id=JSSEC-GUID-7D9F43B8-AABF-4C5B-93E6-3AFB18B66150" target="_blank">自定义默认密钥库和信任库，商店类型和商店密码</a> <span><cite>”</cite></span> 。
                        </p>
                        <p>如果您创建<code class="codeph">keystore</code>文件并启动<code class="codeph">Server</code> applicaton，然后按如下所示启动JConsole：</p><pre class="pre codeblock"><code>% jconsole -J-Djavax.net.ssl.trustStore=truststore \
  -J-Djavax.net.ssl.trustStorePassword=trustword
</code></pre><p>请参阅<a href="using-jconsole.html#GUID-77416B38-7F15-4E35-B3D1-34BFD88350B5">使用JConsole</a> 。
                        </p>
                        <p>该配置仅对服务器进行身份验证。如果设置了SSL客户端身份验证，则需要提供类似的内容<code class="codeph">keystore</code> JConsole的密钥和适当的文件<code class="codeph">truststore</code>该应用程序的文件。
                        </p>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-D4CBA2D6-2E24-4856-A7D8-62B3DFFB76EA" name="GUID-D4CBA2D6-2E24-4856-A7D8-62B3DFFB76EA"></a><h4 id="JSMGM-GUID-D4CBA2D6-2E24-4856-A7D8-62B3DFFB76EA" class="sect4">使用密码和访问文件</h4>
                  <div>
                     <p>密码和访问文件控制远程监视和管理的安全性。这些文件默认位于<code class="codeph"><span class="variable" translate="no">JRE_HOME</span>/lib/management</code>并且采用标准Java属性文件格式。有关格式的更多信息，请参见<a href="https://docs.oracle.com/javase/10/docs/api/java/util/logging/package-summary.html" target="_blank"><span class="apiname">java.util的API参考</span></a><a href="https://docs.oracle.com/javase/10/docs/api/java/util/logging/package-summary.html" target="_blank"><span class="apiname">。属性</span></a>包。
                     </p>
                  </div>
                  <div class="sect4"><a id="GUID-979A49B7-B9E7-4E4E-B80C-421B636D06FA" name="GUID-979A49B7-B9E7-4E4E-B80C-421B636D06FA"></a><h5 id="JSMGM-GUID-979A49B7-B9E7-4E4E-B80C-421B636D06FA" class="sect5">密码文件</h5>
                     <div>
                        <p>密码文件定义了不同的角色及其密码。访问控制文件（ <code class="codeph">jmxremote.access</code>默认情况下）定义每个角色的允许访问权限。要发挥作用，角色必须在密码和访问文件中均具有一个条目。
                        </p>
                        <p>JRE实现包含一个名为的密码文件模板<code class="codeph">jmxremote.password.template</code> 。将此文件复制到<code class="codeph"><span class="codeinlineitalic">jre_home</span>/lib/management/jmxremote.password</code>进入您的主目录，然后添加访问文件中定义的角色的密码。
                        </p>
                        <p>您必须确保只有所有者对此文件具有读取和写入权限，因为它包含明文形式的密码。出于安全原因，系统会检查该文件仅由所有者可读，如果没有则退出并返回错误。因此，在多用户环境中，您应该将密码文件存储在私有位置（例如主目录）中。</p>
                        <p>属性名称是角色，而关联的值是角色的密码。<a href="monitoring-and-management-using-jmx-technology.html#GUID-979A49B7-B9E7-4E4E-B80C-421B636D06FA__EXAMPLE2-1ANEXAMPLEPASSWORDFILE-EF5F1655">示例2–1</a>显示了密码文件中的示例条目。
                        </p>
                        <p id="GUID-979A49B7-B9E7-4E4E-B80C-421B636D06FA__EXAMPLE2-1ANEXAMPLEPASSWORDFILE-EF5F1655">示例2-1示例密码文件</p><pre class="pre codeblock"><code># specify actual password instead of the text <span class="italic">password</span>
monitorRole <span class="italic">password</span>
controlRole <span class="italic">password</span>
</code></pre><p>在Solaris，Linux或macOS操作系统上，可以通过运行以下命令来设置密码文件的文件许可权：</p><pre class="pre codeblock"><code>chmod 600 jmxremote.password
</code></pre></div>
                  </div>
                  <div class="sect4"><a id="GUID-CA2FCB18-B639-4967-8E63-233E612E9D71" name="GUID-CA2FCB18-B639-4967-8E63-233E612E9D71"></a><h5 id="JSMGM-GUID-CA2FCB18-B639-4967-8E63-233E612E9D71" class="sect5">存取档案</h5>
                     <div>
                        <p>默认情况下，访问文件名为<code class="codeph">jmxremote.access</code> 。属性名称是与密码文件位于同一空间的身份。相关值必须是<code class="codeph">readonly</code>要么<code class="codeph">readwrite</code> 。
                        </p>
                        <p>访问文件定义角色及其访问级别。默认情况下，访问文件定义以下主要角色：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">monitorRole</code> ，授予只读访问权限以进行监视。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">controlRole</code> ，授予对监视和管理的读/写访问权限。
                              </p>
                           </li>
                        </ul>
                        <div class="p">访问控制条目由角色名称和关联的访问级别组成。角色名称不能包含空格或制表符，并且必须与密码文件中的条目相对应。访问级别可以是以下之一：<ul style="list-style-type:disc">
                              <li>
                                 <p><code class="codeph">readonly</code> ：授予访问权限以读取MBean的属性。对于监视，这意味着担任此角色的远程客户端可以读取测量值，但不能执行任何更改正在运行的程序环境的操作。远程客户端还可以侦听MBean通知。
                                 </p>
                              </li>
                              <li>
                                 <p><code class="codeph">readwrite</code> ：授予访问权限以读取和写入MBean的属性，调用它们的操作以及创建或删除它们。此访问权限应仅授予受信任的客户端，因为它们可能会干扰应用程序的运行。
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <p>角色在访问文件中应该只有一个条目。如果角色没有条目，则它无权访问。如果一个角色有多个条目，则最后一个条目优先。访问文件中典型的预定义角色类似于<a href="monitoring-and-management-using-jmx-technology.html#GUID-CA2FCB18-B639-4967-8E63-233E612E9D71__EXAMPLE2-2ANEXAMPLEACCESSFILE-EF680AED">示例2-2中</a>所示。
                        </p>
                        <p id="GUID-CA2FCB18-B639-4967-8E63-233E612E9D71__EXAMPLE2-2ANEXAMPLEACCESSFILE-EF680AED">示例2-2示例访问文件</p><pre class="pre codeblock"><code># The "monitorRole" role has readonly access.
# The "controlRole" role has readwrite access.
monitorRole readonly
controlRole readwrite
</code></pre></div>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-3A4EFD73-E420-45E6-BF3D-277B496CD1E9" name="GUID-3A4EFD73-E420-45E6-BF3D-277B496CD1E9"></a><h3 id="JSMGM-GUID-3A4EFD73-E420-45E6-BF3D-277B496CD1E9" class="sect3">使用禁用了SSL的JConsole进行远程监视</h3>
               <div>
                  <p>要监视禁用了SSL的远程应用程序，请使用以下命令启动JConsole：</p><pre class="pre codeblock"><code>% jconsole hostName:portNum
</code></pre><p>您也可以省略主机名和端口号，然后在JConsole提供的对话框中输入它们。</p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-2C1922AD-4BA0-4397-A3FE-7823F42A94A3" name="GUID-2C1922AD-4BA0-4397-A3FE-7823F42A94A3"></a><h3 id="JSMGM-GUID-2C1922AD-4BA0-4397-A3FE-7823F42A94A3" class="sect3">即用型监视和管理属性</h3>
               <div>
                  <p>您可以在配置文件或命令行中设置即用型监视和管理属性。在命令行上指定的属性将覆盖配置文件中的属性。配置文件的默认位置是<code class="codeph"><span class="codeinlineitalic">jre_home</span>/lib/management/management.properties</code> 。如果设置了以下任一命令行属性，则Java VM会读取此文件：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">com.sun.management.jmxremote</code></p>要么</li>
                     <li>
                        <p><code class="codeph">com.sun.management.jmxremote.port</code></p>
                     </li>
                  </ul>
                  <p>您可以使用以下命令行选项为配置文件指定其他位置：</p><pre class="pre codeblock"><code>com.sun.management.config.file=<span class="variable" translate="no">ConfigFilePath</span>
</code></pre><p><code class="codeph"><span class="variable" translate="no">ConfigFilePath</span></code>是配置文件的路径。
                  </p>
                  <p><a href="monitoring-and-management-using-jmx-technology.html#GUID-2C1922AD-4BA0-4397-A3FE-7823F42A94A3__READY-TO-USEMONITORINGANDMANAGEMENT-0CCB777F" title="即用型监视和管理属性">表2-1说明</a>了即用型监视和管理属性。
                  </p>
                  <div class="tblformal" id="GUID-2C1922AD-4BA0-4397-A3FE-7823F42A94A3__READY-TO-USEMONITORINGANDMANAGEMENT-0CCB777F">
                     <p class="titleintable">表2-1即用型监视和管理属性</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="即用型监视和管理属性" border="1" summary="Ready-to-Use Monitoring and Management Properties" frame="hsides" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th rowspan="1" colspan="1" align="left" valign="bottom" id="d2824e1143">属性</th>
                              <th rowspan="1" colspan="1" align="left" valign="bottom" id="d2824e1146">描述</th>
                              <th rowspan="1" colspan="1" align="left" valign="bottom" id="d2824e1149">价值观</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td rowspan="1" colspan="1" align="left" valign="top" id="d2824e1154" headers="d2824e1143 ">
                                 <p><code class="codeph">com.sun.management.jmxremote</code></p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1154 d2824e1146 ">
                                 <p>使用JMX连接器启用JMX远程代理和本地监视。该代理程序在JConsole和其他任何使用Attach API的本地JMX客户端使用的专用接口上发布。如果连接器由启动代理的同一用户启动，则JConsole可以使用此连接器。对于来自此连接器的请求，不会检查密码或访问文件。</p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1154 d2824e1149 ">
                                 <p><code class="codeph">true</code> / <code class="codeph">false</code> 。默认为<code class="codeph">true</code> 。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td rowspan="1" colspan="1" align="left" valign="top" id="d2824e1173" headers="d2824e1143 ">
                                 <p><code class="codeph">com.sun.management.jmxremote.port</code></p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1173 d2824e1146 ">
                                 <p>启用JMX远程代理并创建一个远程JMX连接器以侦听指定端口。默认情况下，SSL，密码和访问文件属性用于此连接器。它也可以按照<code class="codeph">com.sun.management.jmxremote</code>属性。
                                 </p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1173 d2824e1149 ">
                                 <p>端口号。没有默认值。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td rowspan="1" colspan="1" align="left" valign="top" id="d2824e1187" headers="d2824e1143 ">
                                 <p><code class="codeph">com.sun.management.jmxremote.registry.ssl</code></p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1187 d2824e1146 ">
                                 <p>将RMI连接器存根绑定到受SSL保护的RMI注册表。</p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1187 d2824e1149 ">
                                 <p><code class="codeph">true</code> / <code class="codeph">false</code> 。默认为<code class="codeph">false</code> 。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td rowspan="1" colspan="1" align="left" valign="top" id="d2824e1206" headers="d2824e1143 ">
                                 <p><code class="codeph">com.sun.management.jmxremote.ssl</code></p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1206 d2824e1146 ">
                                 <p>使用SSL启用安全监视。如果值为<code class="codeph">false</code> ，则不使用SSL。
                                 </p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1206 d2824e1149 ">
                                 <p><code class="codeph">true</code> / <code class="codeph">false</code> 。默认为<code class="codeph">true</code> 。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td rowspan="1" colspan="1" align="left" valign="top" id="d2824e1228" headers="d2824e1143 ">
                                 <p><code class="codeph">com.sun.management.jmxremote.ssl.enabled.protocols</code></p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1228 d2824e1146 ">
                                 <p>显示要启用的SSL / TLS协议版本的逗号分隔列表。与...结合使用<code class="codeph">com.sun.management.jmxremote.ssl</code> 。
                                 </p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1228 d2824e1149 ">
                                 <p>默认SSL / TLS协议版本。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td rowspan="1" colspan="1" align="left" valign="top" id="d2824e1242" headers="d2824e1143 ">
                                 <p><code class="codeph">com.sun.management.jmxremote.ssl.enabled.cipher.suites</code></p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1242 d2824e1146 ">
                                 <p>显示要启用的SSL / TLS密码套件的逗号分隔列表。与...结合使用<code class="codeph">com.sun.management.jmxremote.ssl</code> 。
                                 </p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1242 d2824e1149 ">
                                 <p>默认的SSL / TLS密码套件。</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td rowspan="1" colspan="1" align="left" valign="top" id="d2824e1256" headers="d2824e1143 ">
                                 <p><code class="codeph">com.sun.management.jmxremote.ssl.need.client.auth</code></p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1256 d2824e1146 ">
                                 <p>如果此属性是，则执行客户端身份验证<code class="codeph">true</code>和财产<code class="codeph">com.sun.management.jmxremote.ssl</code>也是<code class="codeph">true</code> 。
                                 </p>
                                 <p>建议您将此属性设置为<code class="codeph">true</code> 。
                                 </p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1256 d2824e1149 ">
                                 <p><code class="codeph">true</code> / <code class="codeph">false</code> 。默认为<code class="codeph">false</code> 。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td rowspan="1" colspan="1" align="left" valign="top" id="d2824e1289" headers="d2824e1143 ">
                                 <p><code class="codeph">com.sun.management.jmxremote.authenticate</code></p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1289 d2824e1146 ">
                                 <p>如果此属性为，则阻止JMX使用密码或访问文件<code class="codeph">false</code> 。向所有用户提供完全访问权限。
                                 </p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1289 d2824e1149 ">
                                 <p><code class="codeph">true</code> / <code class="codeph">false</code> 。默认为<code class="codeph">true</code> 。
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td rowspan="1" colspan="1" align="left" valign="top" id="d2824e1311" headers="d2824e1143 ">
                                 <p><code class="codeph">com.sun.management.jmxremote. password.file</code></p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1311 d2824e1146 ">
                                 <p>指定密码文件的位置。如果<code class="codeph">com.sun.management.jmxremote.authenticate</code>是<code class="codeph">false</code> ，然后忽略此属性以及密码和访问文件。否则，密码文件必须存在并且采用有效格式。如果密码文件为空或不存在，则不允许访问。
                                 </p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1311 d2824e1149 ">
                                 <p><code class="codeph"><span class="variable" translate="no">JRE_HOME</span>/lib/management/ jmxremote.password</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td rowspan="1" colspan="1" align="left" valign="top" id="d2824e1331" headers="d2824e1143 ">
                                 <p><code class="codeph">com.sun.management.jmxremote.access.file</code></p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1331 d2824e1146 ">
                                 <p>指定访问文件的位置。如果<code class="codeph">com.sun.management.jmxremote.authenticate</code>如果为false，则忽略此属性以及密码和访问文件。否则，访问文件必须存在且采用有效格式。如果访问文件为空或不存在，则不允许访问。
                                 </p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1331 d2824e1149 ">
                                 <p><code class="codeph"><span class="variable" translate="no">JRE_HOME</span>/lib/management/jmxremote.access</code></p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td id="d2824e1348" rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1143 ">
                                 <p id="GUID-2C1922AD-4BA0-4397-A3FE-7823F42A94A3__COM.SUN.MANAGEMENT.JMXREMOTE.LOGIN.-0CC996DC"><code class="codeph">com.sun.management.jmxremote.login.config</code></p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1348 d2824e1146 ">
                                 <p>指定JMX代理对用户进行身份验证时使用的Java身份验证和授权服务（JAAS）登录配置条目的名称。使用此属性覆盖默认登录配置时，命名的配置条目必须位于JAAS加载的文件中。此外，配置中指定的登录模块应使用名称和密码回调来获取用户的凭据。有关更多信息，请参见API文档。 <code class="codeph">javax.security.auth.callback.NameCallback</code>和<code class="codeph">javax.security.auth.callback.PasswordCallback</code> 。
                                 </p>
                              </td>
                              <td rowspan="1" colspan="1" align="left" valign="top" headers="d2824e1348 d2824e1149 ">
                                 <p>默认登录配置是基于文件的密码身份验证。</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
               </div>
               <div class="sect3"><a id="GUID-1C798094-1CC3-4804-B4F2-0DCF2E0030CF" name="GUID-1C798094-1CC3-4804-B4F2-0DCF2E0030CF"></a><h4 id="JSMGM-GUID-1C798094-1CC3-4804-B4F2-0DCF2E0030CF" class="sect4">配置错误</h4>
                  <div>
                     <p>如果在启动MBean服务器，RMI注册表或连接器期间发生任何错误，则Java VM将引发异常并退出。配置错误包括以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>绑定端口号失败</p>
                        </li>
                        <li>
                           <p>无效的密码文件</p>
                        </li>
                        <li>
                           <p>无效的访问文件</p>
                        </li>
                        <li>
                           <p>密码文件可由所有者以外的其他用户读取</p>
                        </li>
                     </ul>
                     <p>如果您的应用程序运行安全管理器，则安全许可文件中需要其他许可。</p>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-7B962724-69BC-46AF-A46E-4A47A4E0B57A" name="GUID-7B962724-69BC-46AF-A46E-4A47A4E0B57A"></a><h3 id="JSMGM-GUID-7B962724-69BC-46AF-A46E-4A47A4E0B57A" class="sect3">以编程方式连接到JMX代理</h3>
               <div>
                  <p>启用JMX代理后，客户端可以使用以下URL访问监视服务：</p><pre class="pre codeblock"><code>service:jmx:rmi:///jndi/rmi://<span class="variable" translate="no">hostName</span>:<span class="variable" translate="no">portNum</span>/jmxrmi
</code></pre><p>客户端可以通过实例化代理来创建代理的连接器<code class="codeph">javax.management.remote.JMXServiceURL</code>使用URL的对象，然后使用<code class="codeph">JMXConnectorFactory.connect</code>方法，如<a href="monitoring-and-management-using-jmx-technology.html#GUID-7B962724-69BC-46AF-A46E-4A47A4E0B57A__EXAMPLE2-3CREATINGACONNECTIONUSING-8F09E0B4">示例2-3中</a>所示。
                  </p>
                  <p id="GUID-7B962724-69BC-46AF-A46E-4A47A4E0B57A__EXAMPLE2-3CREATINGACONNECTIONUSING-8F09E0B4">示例2-3使用JMXConnectorFactory.connect创建连接</p><pre class="pre codeblock"><code>JMXServiceURL u = new JMXServiceURL(
  "service:jmx:rmi:///jndi/rmi://" + hostName + ":" + portNum +  "/jmxrmi");
  JMXConnector c = JMXConnectorFactory.connect(u); 
</code></pre></div>
            </div>
            <div class="sect2"><a id="GUID-20C7215D-ED29-4939-B026-FAA01EC65765" name="GUID-20C7215D-ED29-4939-B026-FAA01EC65765"></a><h3 id="JSMGM-GUID-20C7215D-ED29-4939-B026-FAA01EC65765" class="sect3">以编程方式设置监视和管理</h3>
               <div>
                  <p>您可以创建一个使用<a href="https://docs.oracle.com/javase/10/docs/api/com/sun/tools/attach/package-summary.html" target="_blank">Attach API</a>的JMX客户端，以启用对Java SE 10平台上启动的任何应用程序的即用型监视和管理，而无需在启动时配置用于监视的应用程序。附加API为工具提供了一种附加到目标应用程序并在目标应用程序中启动代理的方法。代理运行之后，JMX客户端（和其他工具）能够使用Java VM代表该代理维护的属性列表来获取该代理的JMX连接器地址。可以使用使用Attach API的工具访问列表中的属性。因此，如果代理在应用程序中启动，并且如果代理创建了代表一条配置信息的属性，则该配置信息可用于连接到应用程序的工具。
                  </p>
                  <p>JMX代理使用本地JMX连接器服务器的地址创建一个属性。如果代理正在运行，这允许JMX工具附加到代理并获取代理的连接器地址。</p>
                  <p><a href="monitoring-and-management-using-jmx-technology.html#GUID-20C7215D-ED29-4939-B026-FAA01EC65765__EXAMPLE2-4ATTACHINGAJMXTOOLTOACONNE-8F09610A">例2-4</a>显示了可以在JMX工具中用于附加到目标VM，获取JMX代理的连接器地址并连接到它的代码。
                  </p>
                  <p id="GUID-20C7215D-ED29-4939-B026-FAA01EC65765__EXAMPLE2-4ATTACHINGAJMXTOOLTOACONNE-8F09610A">示例2-4将JMX工具附加到连接器并获取代理的地址</p><pre class="pre codeblock"><code>static final String CONNECTOR_ADDRESS =
"com.sun.management.jmxremote.localConnectorAddress";

// attach to the target application
VirtualMachine vm = VirtualMachine.attach(id);

// get the connector address
String connectorAddress =
    vm.getAgentProperties().getProperty(CONNECTOR_ADDRESS);

// no connector address, so we start the JMX agent
if (connectorAddress == null) {
     vm.startLocalManagementAgent();

   // agent is started, get the connector address
   connectorAddress =
       vm.getAgentProperties().getProperty(CONNECTOR_ADDRESS);
}
// establish connection to connector server
JMXServiceURL url = new JMXServiceURL(connectorAddress);
JMXConnector jmxConnector = JMXConnectorFactory.connect(url);
</code></pre><p><a href="monitoring-and-management-using-jmx-technology.html#GUID-20C7215D-ED29-4939-B026-FAA01EC65765__EXAMPLE2-4ATTACHINGAJMXTOOLTOACONNE-8F09610A">示例2-4</a>使用<code class="codeph">com.sun.tools.attach.VirtualMachine</code>班级的<code class="codeph">attach()</code>附加到给定Java VM的方法，以便它可以代表目标Java VM中运行的任何代理读取目标Java VM维护的属性。如果代理已在运行，则<code class="codeph">VirtualMachine</code>班级的<code class="codeph">getAgentProperties()</code>调用方法以获取代理的地址。的<code class="codeph">getAgentProperties()</code>方法返回本地连接器地址的字符串属性<code class="codeph">com.sun.management.jmxremote.localConnectorAddress</code> ，可用于连接到本地JMX代理。
                  </p>
                  <p>如果没有任何代理程序在运行，则由<code class="codeph">VirtualMachine</code>来自的班级<code class="codeph"><span class="codeinlineitalic">jre_home</span>/lib/management-agent.jar</code> ，其连接器地址由<code class="codeph">getAgentProperties()</code>方法。
                  </p>
                  <p>然后通过调用建立与代理的连接<code class="codeph">JMXConnectorFactory.connect</code>从此连接器地址构建的JMX服务URL上。
                  </p>
                  <div class="infoboxnote" id="GUID-20C7215D-ED29-4939-B026-FAA01EC65765__GUID-E7D16EE0-E12A-4708-AD4E-576501FDAA43">
                     <p class="notep1">注意：</p>
                     <p>在JDK 11之前，Attach API在定位在Docker容器中运行的JVM时遇到问题。现在，此问题已解决，并且<code class="codeph">jcmd</code>和<code class="codeph">jps</code>按预期工作。然而， <code class="codeph">jmc</code>不会列出<code class="codeph">java</code>在单独的Docker容器中运行的进程。没有已知的方法来明确提供<code class="codeph">java</code>处理此工具。
                     </p>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-E4673A12-41F2-4479-9F7A-0FD8593CE462" name="GUID-E4673A12-41F2-4479-9F7A-0FD8593CE462"></a><h3 id="JSMGM-GUID-E4673A12-41F2-4479-9F7A-0FD8593CE462" class="sect3">使用JMX远程API模仿现成的管理</h3>
               <div>
                  <p>通过身份验证和授权以及SSL加密保护对即用型管理代理的远程访问。通过设置系统属性或通过定义配置来执行配置<code class="codeph">management.properties</code>文件。在大多数情况下，使用即用型管理代理并通过<code class="codeph">management.properties</code>文件足以提供对远程Java VM的安全管理。但是，在某些情况下，需要更高级别的安全性，而在其他情况下，某些系统配置将不允许使用<code class="codeph">management.properties</code>文件。这种情况可能涉及通过某个端口导出RMI服务器的远程对象以允许通过防火墙，或者涉及使用多宿主系统中的特定网络接口导出RMI服务器的远程对象。对于此类情况，可以通过直接使用JMX Remote API来以编程方式创建，配置和部署管理代理来模仿即用型管理代理的行为。
                  </p>
               </div>
               <div class="sect3"><a id="GUID-0A699033-903C-4757-BCEC-D2DB60D96A89" name="GUID-0A699033-903C-4757-BCEC-D2DB60D96A89"></a><h4 id="JSMGM-GUID-0A699033-903C-4757-BCEC-D2DB60D96A89" class="sect4">模仿现成管理的示例</h4>
                  <div>
                     <p>本节提供了一个示例，该示例说明如何实现与现成的管理代理完全相同的JMX代理。与立即可用的管理代理完全相同， <a href="monitoring-and-management-using-jmx-technology.html#GUID-0A699033-903C-4757-BCEC-D2DB60D96A89__EXAMPLE2-5MIMICKINGANOUT-OF-THE-BOX-8F0B9A6B">示例2-5中</a>创建的代理将在端口3000上运行。它将有一个名为的密码文件<code class="codeph">password.properties</code> ，一个名为<code class="codeph">access.properties</code> ，它将为基于SSL / TLS的RMI套接字工厂实现默认配置，仅需要服务器身份验证。本示例假设<code class="codeph">keystore</code>如<a href="monitoring-and-management-using-jmx-technology.html#GUID-FA9A0A97-6016-4283-9E9C-983C4D6F96D4">使用SSL中</a>所述，已经创建了。有关如何设置SSL配置的信息，请参阅《 <span><cite>Java平台标准版安全性开发人员指南》</cite></span>中的“ <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/java/javase/11/management&id=JSSEC-GUID-3D26386B-BC7A-41BB-AC70-80E6CD147D6F" target="_blank">创建要与JSSE一起使用的密钥库”</a>部分。
                     </p>
                     <p>在名为的应用程序上启用监视和管理<code class="codeph">com.example.MyApp</code> ，在配置中使用现成的JMX代理，运行<code class="codeph">com.example.MyApp</code>使用以下命令：</p><pre class="pre codeblock"><code>% java -Dcom.sun.management.jmxremote.port=3000 \
     -Dcom.sun.management.jmxremote.password.file=password.properties \
     -Dcom.sun.management.jmxremote.access.file=access.properties \
     -Djavax.net.ssl.keyStore=keystore \
     -Djavax.net.ssl.keyStorePassword=password \
     com.example.MyApp
</code></pre><div class="infoboxnote" id="GUID-0A699033-903C-4757-BCEC-D2DB60D96A89__GUID-5445D36F-D855-43AE-8128-9EF6993666F6">
                        <p class="notep1">注意：</p>的<code class="codeph">com.sun.management.jmxremote.*</code>可以在<code class="codeph">management.properties</code>文件，而不是在命令行中传递它们。在这种情况下，系统属性<code class="codeph">-Dcom.sun.management.config.file=management.properties</code>需要指定位置<code class="codeph">management.properties</code>文件。
                     </div>
                     <p><a href="monitoring-and-management-using-jmx-technology.html#GUID-0A699033-903C-4757-BCEC-D2DB60D96A89__EXAMPLE2-5MIMICKINGANOUT-OF-THE-BOX-8F0B9A6B">例2-5</a>显示了您需要编写以编程方式创建JMX代理的代码，该代码将允许完全相同的监视和管理<code class="codeph">com.example.MyApp</code>与使用先前的命令一样。
                     </p>
                     <p id="GUID-0A699033-903C-4757-BCEC-D2DB60D96A89__EXAMPLE2-5MIMICKINGANOUT-OF-THE-BOX-8F0B9A6B">示例2-5以编程方式模仿现成的JMX代理</p><pre class="pre codeblock"><code>package com.example;

import java.lang.management.*;
import java.rmi.registry.*;
import java.util.*;
import javax.management.*;
import javax.management.remote.*;
import javax.management.remote.rmi.*;
import javax.rmi.ssl.*;

public class MyApp {

    public static void main(String[] args) throws Exception {

        // Ensure cryptographically strong random number generator used
        // to choose the object number - see java.rmi.server.ObjID
        //
        System.setProperty("java.rmi.server.randomIDs", "true");

        // Start an RMI registry on port 3000.
        //
        System.out.println("Create RMI registry on port 3000");
        LocateRegistry.createRegistry(3000);

        // Retrieve the PlatformMBeanServer.
        //
        System.out.println("Get the platform's MBean server");
        MBeanServer mbs = ManagementFactory.getPlatformMBeanServer();

        // Environment map.
        //
        System.out.println("Initialize the environment map");
        HashMap&lt;String,Object&gt; env = new HashMap&lt;String,Object&gt;();

        // Provide SSL-based RMI socket factories.
        //
        // The protocol and cipher suites to be enabled will be the ones
        // defined by the default JSSE implementation and only server
        // authentication will be required.
        //
        SslRMIClientSocketFactory csf = new SslRMIClientSocketFactory();
        SslRMIServerSocketFactory ssf = new SslRMIServerSocketFactory();
        env.put(RMIConnectorServer.RMI_CLIENT_SOCKET_FACTORY_ATTRIBUTE, csf);
        env.put(RMIConnectorServer.RMI_SERVER_SOCKET_FACTORY_ATTRIBUTE, ssf);

        // Provide the password file used by the connector server to
        // perform user authentication. The password file is a properties
        // based text file specifying username/password pairs.
        //
        env.put("jmx.remote.x.password.file", "password.properties");

        // Provide the access level file used by the connector server to
        // perform user authorization. The access level file is a properties
        // based text file specifying username/access level pairs where
        // access level is either "readonly" or "readwrite" access to the
        // MBeanServer operations.
        //
        env.put("jmx.remote.x.access.file", "access.properties");

        // Create an RMI connector server.
        //
        // As specified in the JMXServiceURL the RMIServer stub will be
        // registered in the RMI registry running in the local host on
        // port 3000 with the name "jmxrmi". This is the same name that the
        // ready-to-use management agent uses to register the RMIServer
        // stub.
        //
        System.out.println("Create an RMI connector server");
        JMXServiceURL url =
            new JMXServiceURL("service:jmx:rmi:///jndi/rmi://:3000/jmxrmi");
        JMXConnectorServer cs =
            JMXConnectorServerFactory.newJMXConnectorServer(url, env, mbs);

        // Start the RMI connector server.
        //
        System.out.println("Start the RMI connector server");
        cs.start();
    }
}
</code></pre><p>使用以下命令启动该应用程序：</p><pre class="pre codeblock"><code>java -Djavax.net.ssl.keyStore=keystore \
     -Djavax.net.ssl.keyStorePassword=password \
     com.example.MyApp
</code></pre><p>的<code class="codeph">com.example.MyApp</code>应用程序将启用JMX代理，并且将以与使用Java平台的即用型管理代理完全相同的方式进行监视和管理。但是，即用型管理代理使用的RMI注册表和模仿它的管理代理使用的RMI注册表之间存在一个微小但重要的区别。即用型管理代理使用的RMI注册表是只读的，即可以将单个条目绑定到该条目，并且在绑定后，该条目不能解除绑定。对于在<a href="monitoring-and-management-using-jmx-technology.html#GUID-0A699033-903C-4757-BCEC-D2DB60D96A89__EXAMPLE2-5MIMICKINGANOUT-OF-THE-BOX-8F0B9A6B">示例2-5中</a>创建的RMI注册表，情况并非如此。
                     </p>
                     <p>此外，两个RMI注册表都不安全，因为它们都不使用SSL / TLS。应使用需要客户端身份验证的基于SSL / TLS的RMI套接字工厂创建RMI注册表。这将阻止客户端将其凭据发送到恶意RMI服务器，还将阻止RMI注册表将对RMI服务器存根的访问权限授予不可信客户端。</p>
                     <p>可以通过在您的服务器上添加以下属性来创建实现SSL / TLS RMI套接字工厂的RMI注册表<code class="codeph">management.properties</code>文件：</p><pre class="pre codeblock"><code>com.sun.management.jmxremote.registry.ssl=true
com.sun.management.jmxremote.ssl.need.client.auth=true
</code></pre><p><a href="monitoring-and-management-using-jmx-technology.html#GUID-0A699033-903C-4757-BCEC-D2DB60D96A89__EXAMPLE2-5MIMICKINGANOUT-OF-THE-BOX-8F0B9A6B">例2-5</a>模仿了即用型JMX代理的主要行为，但没有复制JMX代理中的所有现有属性。 <code class="codeph">management.properties</code>文件。但是，您可以通过修改添加其他属性<code class="codeph">com.example.MyApp</code>适当地。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-34811D07-AB51-4EC7-8D37-EEAF7C15F5C7" name="GUID-34811D07-AB51-4EC7-8D37-EEAF7C15F5C7"></a><h4 id="JSMGM-GUID-34811D07-AB51-4EC7-8D37-EEAF7C15F5C7" class="sect4">通过防火墙监视应用程序</h4>
                  <div>
                     <p><a href="monitoring-and-management-using-jmx-technology.html#GUID-0A699033-903C-4757-BCEC-D2DB60D96A89__EXAMPLE2-5MIMICKINGANOUT-OF-THE-BOX-8F0B9A6B">例2-5中</a>的代码可用于通过防火墙监视应用程序，如果使用现成的监视解决方案，则可能无法实现。的<code class="codeph">com.sun.management.jmxremote.port</code>管理属性指定可访问RMI注册表的端口，但指定<code class="codeph">RMIServer</code>和<code class="codeph">RMIConnection</code>远程对象的导出是由RMI堆栈选择的。导出远程对象（ <code class="codeph">RMIServer</code>和<code class="codeph">RMIConnection</code> ）到给定的端口，您需要以编程方式创建自己的RMI连接器服务器，如<a href="monitoring-and-management-using-jmx-technology.html#GUID-0A699033-903C-4757-BCEC-D2DB60D96A89__EXAMPLE2-5MIMICKINGANOUT-OF-THE-BOX-8F0B9A6B">示例2-5中所述</a> 。但是，您必须指定<code class="codeph">JMXServiceURL</code>如下：</p><pre class="pre codeblock"><code>JMXServiceURL url = new JMXServiceURL("service:jmx:rmi://localhost:" + 
      <span class="variable" translate="no">port1</span>  + "/jndi/rmi://localhost:" + <span class="variable" translate="no">port2</span> + "/jmxrmi");
</code></pre><p><code class="codeph"><span class="variable" translate="no">port1</span></code>是端口号， <code class="codeph">RMIServer</code>和<code class="codeph">RMIConnection</code>远程对象被导出，并且<code class="codeph"><span class="variable" translate="no">port2</span></code>是RMI注册表的端口号。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-797B5B00-ADF9-47C6-9DD5-762A0383C233" name="GUID-797B5B00-ADF9-47C6-9DD5-762A0383C233"></a><h4 id="JSMGM-GUID-797B5B00-ADF9-47C6-9DD5-762A0383C233" class="sect4">使用代理类对应用程序进行检测</h4>
                  <div>
                     <p>Java SE平台提供的服务允许Java编程语言代理检测Java VM上运行的程序。创建检测代理意味着您不必向应用程序中添加任何新代码即可对其进行监视。而不是在应用程序的静态环境中实施监视和管理<code class="codeph">main</code>方法，您可以在单独的代理类中实现该方法，然后使用<code class="codeph">-javaagent</code>指定的选项。请参阅<a href="https://docs.oracle.com/javase/10/docs/api/java/lang/instrument/package-summary.html" target="_blank"><span class="apiname">java.lang.instrument</span></a>软件包的API参考文档，以获取有关如何创建代理类以对应用程序进行检测的完整详细信息。
                     </p>
                  </div>
                  <div class="sect4"><a id="GUID-937A3DE2-2D20-4DBE-9026-DFEA95B64B28" name="GUID-937A3DE2-2D20-4DBE-9026-DFEA95B64B28"></a><h5 id="JSMGM-GUID-937A3DE2-2D20-4DBE-9026-DFEA95B64B28" class="sect5">创建代理类以对应用程序进行检测</h5>
                     <div>
                        <p>以下过程说明了如何适应以下代码<code class="codeph">com.example.MyApp</code>创建代理以对其他任何应用程序进行监视和管理。
                        </p>
                        <ol>
                           <li>创建一个<code class="codeph">com.example.MyAgent</code>类。
                              <p>创建一个名为<code class="codeph">com.example.MyAgent</code> ，声明一个<code class="codeph">premain</code>方法而不是<code class="codeph">main</code>方法。
                              </p><pre class="pre codeblock"><code>package com.example;

[...]

public class MyAgent {
    
    public static void premain(String args) throws Exception {
    
    [...]
</code></pre><p>其余的代码<code class="codeph">com.example.MyAgent</code>类与<code class="codeph">com.example.MyApp</code>类如<a href="monitoring-and-management-using-jmx-technology.html#GUID-0A699033-903C-4757-BCEC-D2DB60D96A89__EXAMPLE2-5MIMICKINGANOUT-OF-THE-BOX-8F0B9A6B">示例2-5</a>所示。
                              </p>
                           </li>
                           <li>编译<code class="codeph">com.example.MyAgent</code>类。
                           </li>
                           <li>创建清单文件， <code class="codeph">MANIFEST.MF</code> ，带有<code class="codeph">Premain-Class</code>条目。
                              <p>代理被部署为Java存档（JAR）文件。JAR文件清单中的属性指定将被加载以启动代理的代理类。创建一个名为<code class="codeph">MANIFEST.MF</code> ，其中包含以下行：</p><pre class="pre codeblock"><code>Premain-Class: com.example.MyAgent
</code></pre></li>
                           <li>创建一个JAR文件， <code class="codeph">MyAgent.jar</code> 。
                              <p>JAR文件应包含以下文件：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">META-INF/MANIFEST.MF</code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">com/example/MyAgent.class</code></p>
                                 </li>
                              </ul>
                           </li>
                           <li>启动一个应用程序，指定代理以提供监视和管理服务。
                              <p>您可以使用<code class="codeph">com.example.MyAgent</code>检测任何应用程序以进行监视和管理。本示例使用<code class="codeph">Notepad</code>应用。
                              </p><pre class="pre codeblock"><code>% java -javaagent:MyAgent.jar -Djavax.net.ssl.keyStore=keystore \
      -Djavax.net.ssl.keyStorePassword=password -jar Notepad.jar
</code></pre><p>的<code class="codeph">com.example.MyAgent</code>代理使用<code class="codeph">-javaagent</code>开始时的选项<code class="codeph">Notepad</code> 。另外，如果您的<code class="codeph">com.example.MyAgent</code>应用程序复制与<code class="codeph">com.example.MyApp</code> <a href="monitoring-and-management-using-jmx-technology.html#GUID-0A699033-903C-4757-BCEC-D2DB60D96A89__EXAMPLE2-5MIMICKINGANOUT-OF-THE-BOX-8F0B9A6B">例2-5中</a>所示的应用程序，然后提供<code class="codeph">keystore</code>和<code class="codeph">password</code>信息，因为RMI连接器服务器受SSL保护。</p>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </article>
   

</body></html>