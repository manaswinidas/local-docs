<html lang="en-us"  xml:lang="en-us"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Security</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Java Management Extensions Guide">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Java Management Extensions Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="java-management-extensions-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-20T10:06:58-07:00">
      <meta name="dcterms.title" content="Java Management Extensions Guide">
      <meta name="dcterms.dateCopyrighted" content="1993, 2018">
      <meta name="dcterms.category" content="java">
      <meta name="dcterms.identifier" content="E95075-01">
      
      <meta name="dcterms.product" content="en/java/javase/11">
      <meta name="dcterms.release" content="11">
      <link rel="prev" href="lookup-services.html" title="Previous" type="text/html">
      <link rel="next" href="java-management-extensions-examples.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"java","element_name":"Java","display_in_url":true},"suite":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product_group":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product":{"short_name":"javase","element_name":"Java SE","display_in_url":true},"release":{"short_name":"11","element_name":"11","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="JMX">
  <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="lookup-services.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一个</a> <a href="java-management-extensions-examples.html" class="pull-right">下一个<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Java管理扩展指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="java-management-extensions-jmx-technology-tutorial.html" property="item" typeof="WebPage"><span property="name">Java管理扩展（JMX）技术教程</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">安全</li>
            </ol>
            <a id="GUID-2945088A-F715-4BC9-B8AD-6C56BC3BDF55" name="GUID-2945088A-F715-4BC9-B8AD-6C56BC3BDF55"></a>
            
            <h2 id="JSJMX-GUID-2945088A-F715-4BC9-B8AD-6C56BC3BDF55" class="sect2"><span class="enumeration_chapter">13</span>安全</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章提供了如何设置JMX技术安全性功能的示例，如以下各节所述：</p>
               <ul style="list-style-type:disc">
                  <li><a href="security.html#GUID-EFC2A37D-307F-4001-9D2F-6F0A2A3BC51D">简单安全性</a>介绍了一些连接器示例，这些连接器实现了基于密码身份验证和文件访问控制的直接安全性。
                  </li>
                  <li><a href="security.html#GUID-6D30665A-E576-4A9E-943C-2DA022F7A62D">主题委托</a>提供了使用主题委托模型代表几个不同的身份对给定的身份验证连接执行操作的连接器示例。
                  </li>
                  <li><a href="security.html#GUID-2A161539-E347-4CF1-84B9-482BC0C621C7">精细粒度的安全性</a>提供了实现更复杂的安全性机制的连接器示例，其中控制了执行单个操作的权限。
                  </li>
               </ul>
               <p><span class="bold">警告：</span></p>
               <ul style="list-style-type:disc">
                  <li>应用程序应提示用户输入密码，而不是期望用户在命令行中提供密码。</li>
                  <li>在生产系统中使用安全认证机制。特别是，既要使用SSL客户端证书来认证客户端主机，又要使用密码认证来进行用户管理。请参阅《 <span><cite>Java平台标准版管理开发人员指南》中的“</cite></span> <span class="italic">使用SSL</span>和<span class="italic">使用LDAP身份验证</span> <span><cite>”</cite></span> 。
                  </li>
               </ul>
            </div>
            <div class="sect2"><a id="GUID-EFC2A37D-307F-4001-9D2F-6F0A2A3BC51D" name="GUID-EFC2A37D-307F-4001-9D2F-6F0A2A3BC51D"></a><h3 id="JSJMX-GUID-EFC2A37D-307F-4001-9D2F-6F0A2A3BC51D" class="sect3">简单安全</h3>
               <div>
                  <p>可以与JMX技术一起使用的最简单的安全性基于加密，用户名和密码身份验证以及文件访问控制。</p>
                  <p></p>
                  <div class="section">
                     <p class="subhead2" id="GUID-EFC2A37D-307F-4001-9D2F-6F0A2A3BC51D__GUID-D4F192B7-0436-4DEB-B952-29F870C48D77">使用简单安全性示例类分析RMI连接器</p>
                     <ol>
                        <li>
                           <p>将源代码从“ <a href="simple-security-example.html">简单安全性”</a>复制到以下代码<code class="codeph"><span class="variable" translate="no">work_dir</span>/jmx_examples/Security/simple</code>子目录和文件：</p>
                           <ul style="list-style-type:disc">
                              <li><code class="codeph">/server/Server.java</code></li>
                              <li><code class="codeph">/config/access.properties</code></li>
                              <li><code class="codeph">/config/keystore</code></li>
                              <li><code class="codeph">/config/password.properties</code></li>
                              <li><code class="codeph">/config/truststore</code></li>
                              <li><code class="codeph">/mbeans/SimpleStandardMBean.java</code></li>
                              <li><code class="codeph">/mbeans/SimpleStandard.java</code></li>
                              <li><code class="codeph">/client/Client.java</code></li>
                              <li><code class="codeph">/client/ClientListener.java</code></li>
                           </ul>
                        </li>
                        <li>
                           <p>打开<code class="codeph">*.java</code>和<code class="codeph">*.properties</code>在IDE或文本编辑器中的文件。
                           </p>
                        </li>
                     </ol>
                     <p>以下各节分析这些文件，并说明它们如何执行上述安全操作。</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div class="sect3"><a id="GUID-BB34C33D-4F06-48CF-A239-8489A55CCF84" name="GUID-BB34C33D-4F06-48CF-A239-8489A55CCF84"></a><h4 id="JSJMX-GUID-BB34C33D-4F06-48CF-A239-8489A55CCF84" class="sect4">简单安全性示例中的Server.java</h4>
                  <div>
                     <p>的<code class="codeph">Server.java</code>类在代码示例5-1中显示。
                     </p>
                     <div class="section" id="GUID-BB34C33D-4F06-48CF-A239-8489A55CCF84__CODEEXAMPLE5-1RMICONNECTOREXAMPLESI-CB039FB8">
                        <p class="subhead3" id="GUID-BB34C33D-4F06-48CF-A239-8489A55CCF84__GUID-01031C54-858B-4F32-8A84-140B3493C9EA">代码示例5-1 RMI连接器示例（简单安全性）类Server.java</p><pre class="pre codeblock"><code>public class Server { 
 
  public static void main(String[] args) { 
  try { 
       MBeanServer mbs = MBeanServerFactory.createMBeanServer(); 
 
       HashMap env = new HashMap(); 
 
       SslRMIClientSocketFactory csf =  
                  new SslRMIClientSocketFactory(); 
       SslRMIServerSocketFactory ssf =  
                  new SslRMIServerSocketFactory(); 
       env.put(RMIConnectorServer. 
                  RMI_CLIENT_SOCKET_FACTORY_ATTRIBUTE,csf); 
       env.put(RMIConnectorServer. 
                  RMI_SERVER_SOCKET_FACTORY_ATTRIBUTE,ssf); 
 
       env.put("jmx.remote.x.password.file", 
                 "config" + File.separator + "password.properties"); 
       env.put("jmx.remote.x.access.file", 
                 "config" + File.separator + "access.properties"); 
 
       JMXServiceURL url = new JMXServiceURL( 
        "service:jmx:rmi:///jndi/rmi://localhost:9999/server"); 
         JMXConnectorServer cs = 
            JMXConnectorServerFactory.newJMXConnectorServer(url,  
                                                            env,  
                                                            mbs); 
       cs.start(); 
     } catch (Exception e) { 
       e.printStackTrace(); 
     } 
  } 
}</code></pre><p>的<code class="codeph">Server</code>代码示例5-1中显示的类创建MBean服务器<code class="codeph">mbs</code> ，并填充环境图<code class="codeph">env</code>使用安全的RMI客户端套接字工厂<code class="codeph">csf</code> ，一个安全的RMI服务器套接字工厂<code class="codeph">ssf</code> ，以及属性文件<code class="codeph">password.properties</code>和<code class="codeph">access.properties</code> 。
                        </p>
                        <p>属性文件<code class="codeph">password.properties</code>包含用户名和密码，可以使用JMX远程API界面进行访问<code class="codeph">JMXAuthenticator</code> 。使用属性<code class="codeph">jmx.remote.x.</code><code class="codeph">password.file</code>与创建基于密码的密码相同<code class="codeph">JMXAuthenticator</code>并将其通过<code class="codeph">jmx.remote.authenticator</code>属性。
                        </p>
                        <p>属性文件<code class="codeph">access.properties</code>包含用户名和访问权限级别，可以是<code class="codeph">readwrite</code>要么<code class="codeph">readonly</code> 。这代表该用户对MBean服务器操作的访问级别。此基于文件的访问控制是使用JMX技术界面实现的<code class="codeph">MBeanServerForwarder</code> ，它将真正的MBean服务器包装在访问控制器MBean服务器中。访问控制器MBean服务器仅在执行适当的检查后才将请求转发到真实的MBean服务器。
                        </p>
                        <p><code class="codeph">Server</code>创建一个名为的JMX服务URL <code class="codeph">url</code> ，用于将通过默认JRMP传输进行操作的RMI连接器，并在端口的RMI注册表中注册RMI连接器存根<code class="codeph">9999</code>本地主机。
                        </p>
                        <p>MBean服务器<code class="codeph">mbs</code> ，环境地图env和服务URL <code class="codeph">url</code>全部传递给<code class="codeph">JMXConnectorServer</code>创建一个新的安全JMX连接器服务器，名称为<code class="codeph">cs</code> 。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-6D10FB9B-1F8F-4727-93D4-09E0AE2B8FEB" name="GUID-6D10FB9B-1F8F-4727-93D4-09E0AE2B8FEB"></a><h4 id="JSJMX-GUID-6D10FB9B-1F8F-4727-93D4-09E0AE2B8FEB" class="sect4">简单安全性示例中的SimpleStandardMBean.java</h4>
                  <div>
                     <p>的<code class="codeph">SimpleStandardMBean</code>类定义与<a href="jmx-connectors.html#GUID-4F4C3AAF-B3A5-4165-A30F-963A88DF01CA">MBean示例</a>中的<a href="jmx-connectors.html#GUID-4F4C3AAF-B3A5-4165-A30F-963A88DF01CA">SimpleStandardMBean.java中</a>使用的相同的简单MBean接口。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-F1E9EB84-C874-403A-A88B-A8D4CBBF985F" name="GUID-F1E9EB84-C874-403A-A88B-A8D4CBBF985F"></a><h4 id="JSJMX-GUID-F1E9EB84-C874-403A-A88B-A8D4CBBF985F" class="sect4">简单安全性示例中的SimpleStandard.java</h4>
                  <div>
                     <p>的<code class="codeph">SimpleStandard</code>类定义与<a href="jmx-connectors.html#GUID-3DF0EA75-3F2E-4218-8A6D-08DC4D3BC4CC">MBean示例</a>中的<a href="jmx-connectors.html#GUID-3DF0EA75-3F2E-4218-8A6D-08DC4D3BC4CC">SimpleStandard.java中</a>使用的相同的简单MBean。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-7137FE50-4559-4758-8DE2-69A8F2E473D9" name="GUID-7137FE50-4559-4758-8DE2-69A8F2E473D9"></a><h4 id="JSJMX-GUID-7137FE50-4559-4758-8DE2-69A8F2E473D9" class="sect4">简单安全性示例中的ClientListener.java</h4>
                  <div>
                     <p>的<code class="codeph">ClientListener</code>类定义了<a href="jmx-connectors.html#GUID-871B0138-49A6-462D-8CC0-981C595822D0">MBean Example</a>中<a href="jmx-connectors.html#GUID-871B0138-49A6-462D-8CC0-981C595822D0">ClientListener.java中</a>使用的相同的直接通知监听器。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-C95094F9-EF92-4896-9AC3-CB739FF6881E" name="GUID-C95094F9-EF92-4896-9AC3-CB739FF6881E"></a><h4 id="JSJMX-GUID-C95094F9-EF92-4896-9AC3-CB739FF6881E" class="sect4">简单安全性示例中的Client.java</h4>
                  <div>
                     <p>的<code class="codeph">Client.java</code>类在代码示例5-2中显示。
                     </p>
                     <div class="section" id="GUID-C95094F9-EF92-4896-9AC3-CB739FF6881E__CODEEXAMPLE5-2RMICONNECTOREXAMPLESI-CB055F65">
                        <p class="subhead3" id="GUID-C95094F9-EF92-4896-9AC3-CB739FF6881E__GUID-13F3EEDD-02CA-4B14-820C-9E5CDA66CDB4">代码示例5-2 RMI连接器示例（简单安全性）类Client.java</p><pre class="pre codeblock"><code>public class Client { 
 
  public static void main(String[] args) { 
  try { 
      HashMap env = new HashMap(); 
 
      String[] credentials = new String[] { "username" , "password" }; 
      env.put("jmx.remote.credentials", credentials); 
      JMXServiceURL url = new JMXServiceURL( 
         "service:jmx:rmi:///jndi/rmi://localhost:9999/server");       
      JMXConnector jmxc = JMXConnectorFactory.connect(url, env); 
      MBeanServerConnection mbsc = jmxc.getMBeanServerConnection(); 
      String domains[] = mbsc.getDomains(); 
      for (int i = 0; i &lt; domains.length; i++) { 
         System.out.println("Domain[" + i + "] = " + domains[i]); 
      } 
       
      ObjectName mbeanName =  
          new ObjectName("MBeans:type=SimpleStandard"); 
      mbsc.createMBean("SimpleStandard", mbeanName, null, null); 
      // Perform MBean operations 
      [...] 
      
      mbsc.removeNotificationListener(mbeanName, listener); 
      mbsc.unregisterMBean(mbeanName); 
      jmxc.close(); 
    }  catch (Exception e) { 
      e.printStackTrace(); 
    } 
  } 
} 
</code></pre><p>的<code class="codeph">Client</code>代码示例5-2中显示的类填充环境图<code class="codeph">env</code>带有一组凭据，即<code class="codeph">username</code>和<code class="codeph">password</code>预期的<code class="codeph">Server</code> 。然后将这些凭据提供给的实例<code class="codeph">JMXConnector</code>命名<code class="codeph">jmxc</code>将连接器存根的服务URL和环境映射传递给<code class="codeph">JMXConnectorFactory.connect()</code> 。通过<code class="codeph">jmxc</code> ， <code class="codeph">Client</code>连接到MBean服务器，由<code class="codeph">Server</code> ，并执行MBean操作。
                        </p>
                        <p>建立连接后，环境映射中提供的凭据<code class="codeph">env</code>被发送到服务器。然后服务器调用<code class="codeph">authenticate()</code>的方法<code class="codeph">JMXAuthenticator</code>接口，将客户端凭据作为参数传递。的<code class="codeph">authenticate()</code>方法对客户端进行身份验证，并返回一个主题，该主题包含将在其上执行访问控制检查的一组主体。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-F86AE7C1-D6C1-4095-8E71-4EECFB46B760" name="GUID-F86AE7C1-D6C1-4095-8E71-4EECFB46B760"></a><h4 id="JSJMX-GUID-F86AE7C1-D6C1-4095-8E71-4EECFB46B760" class="sect4">以简单的安全性运行RMI连接器示例</h4>
                  <div>
                     <p>要以简单的安全性运行RMI连接器示例，请执行以下步骤：</p>
                     <ol>
                        <li>
                           <p>运行RMI连接器示例：</p><pre class="pre codeblock"><code>$ javac 
      mbeans/SimpleStandard.java \ 
      mbeans/SimpleStandardMBean.java \ 
      server/Server.java \ 
      client/Client.java \ 
      client/ClientListener.java 
</code></pre></li>
                        <li>在本地主机的端口<span class="bold">9999</span>上启动RMI注册表。<pre class="pre codeblock"><code>$ export CLASSPATH=server ; rmiregistry 9999 &amp; 
</code></pre></li>
                        <li>开始<code class="codeph">Server</code> 。<pre class="pre codeblock"><code>$ java -classpath server:mbeans \ 
     -Djavax.net.ssl.keyStore=config/keystore \ 
     -Djavax.net.ssl.keyStorePassword=password \ 
     Server &amp; 
</code></pre><p>您将看到有关MBean服务器和RMI连接器创建的确认。</p>
                        </li>
                        <li>开始<code class="codeph">Client</code> 。<pre class="pre codeblock"><code>$java -classpath client:server:mbeans \ 
     -Djavax.net.ssl.trustStore=config/truststore \ 
     -Djavax.net.ssl.trustStorePassword=trustword \ 
     Client 
</code></pre><p>您将看到有关创建连接器客户端，各种MBean操作以及关闭连接的确认。</p>
                        </li>
                     </ol>
                     <p>如您所见，以上所有操作似乎都与<a href="jmx-connectors.html#GUID-A4CA2A4D-49EE-4DA8-871F-DD633C28DAD9">JMX连接器中</a>描述的基本RMI连接器示例完全相同。但是，如果您要打开<code class="codeph">password.properties</code>并更改密码，您会看到一个<code class="codeph">java.lang.SecurityException</code>当您启动<code class="codeph">Client</code> ，连接将失败。
                     </p>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-6D30665A-E576-4A9E-943C-2DA022F7A62D" name="GUID-6D30665A-E576-4A9E-943C-2DA022F7A62D"></a><h3 id="JSJMX-GUID-6D30665A-E576-4A9E-943C-2DA022F7A62D" class="sect3">主题委托</h3>
               <div>
                  <p>如果您的实现要求连接的客户端代表多个用户或应用程序执行不同的操作，并且您使用了<a href="security.html#GUID-EFC2A37D-307F-4001-9D2F-6F0A2A3BC51D">Simple Security中</a>演示的安全性机制，则每个不同的用户对其执行的每个操作都需要一个安全的连接。如果您希望连接器客户端与众多用户进行交互，那么可以通过实现<span class="italic">主题委托</span>来减轻系统的负载。主题委派为用户建立单个安全连接。此连接可用于代表任何数量的用户执行相关操作。连接本身是由经过<span class="italic">身份验证的</span>用户建立的。如果通过身份验证的用户授予了<code class="codeph">SubjectDelegationPermission</code>允许它代表其他用户执行操作，然后可以代表该用户在连接上执行操作。
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-6D30665A-E576-4A9E-943C-2DA022F7A62D__GUID-84C1927E-41E6-429F-8AC1-5A6EE4EB5A2A">使用主题委托示例类分析安全RMI连接器</p>
                     <ol>
                        <li>
                           <p>将源代码从“ <a href="security-subject-delegation-example.html">带有主题委派的安全性”</a>复制到以下代码<code class="codeph"><span class="variable" translate="no">work_dir</span>/jmx_examples/Security/subject_delegation</code>子目录和文件：</p>
                           <ul style="list-style-type:disc">
                              <li><code class="codeph">/server/Server.java</code> ：</li>
                              <li><code class="codeph">/config/access.properties</code></li>
                              <li><code class="codeph">/config/java.policy</code></li>
                              <li><code class="codeph">/config/password.properties</code></li>
                              <li><code class="codeph">/mbeans/SimpleStandardMBean.java</code></li>
                              <li><code class="codeph">/mbeans/SimpleStandard.java</code></li>
                              <li><code class="codeph">/client/Client.java</code></li>
                              <li><code class="codeph">/client/ClientListener.java</code></li>
                           </ul>
                        </li>
                        <li>
                           <p>打开所有<code class="codeph">*.java</code>和<code class="codeph">*.properties</code> IDE或文本编辑器中的文件。
                           </p>
                        </li>
                     </ol>
                     <p>以下各节包含对这些文件的分析。</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div class="sect3"><a id="GUID-AC42678F-30FF-4211-A547-2E46C13B38D0" name="GUID-AC42678F-30FF-4211-A547-2E46C13B38D0"></a><h4 id="JSJMX-GUID-AC42678F-30FF-4211-A547-2E46C13B38D0" class="sect4">主题委派示例中的Server.java</h4>
                  <div>
                     <p>的<code class="codeph">Server.java</code>类在代码示例5-3中显示。
                     </p>
                     <div class="section" id="GUID-AC42678F-30FF-4211-A547-2E46C13B38D0__CODEEXAMPLE5-2SECURERMICONNECTORSUB-CB0F3E34">
                        <p class="subhead3" id="GUID-AC42678F-30FF-4211-A547-2E46C13B38D0__GUID-3B5EA57D-1985-4CA3-809F-7E1F887F4852">代码示例5-3安全RMI连接器（主题委托）示例类Server.java</p><pre class="pre codeblock"><code>public class Server { 
 
   public static void main(String[] args) { 
     try { 
          MBeanServer mbs = MBeanServerFactory.createMBeanServer(); 
          HashMap env = new HashMap(); 
          env.put("jmx.remote.x.password.file", 
                  "config" + File.separator + "password.properties"); 
          env.put("jmx.remote.x.access.file", 
                  "config" + File.separator + "access.properties"); 
 
          JMXServiceURL url = new JMXServiceURL( 
             "service:jmx:rmi:///jndi/rmi://localhost:9999/server"); 
          JMXConnectorServer cs = 
              JMXConnectorServerFactory.newJMXConnectorServer(url, env, mbs); 
          cs.start(); 
     } catch (Exception e) { 
          e.printStackTrace(); 
     } 
   } 
} 
</code></pre><p>代码示例5-3从创建MBean服务器开始<code class="codeph">mbs</code>以及环境图的填充<code class="codeph">env</code>带有密码文件和访问文件，称为<code class="codeph">password.properties</code>和<code class="codeph">access.properties</code>分别：</p>
                        <ul style="list-style-type:disc">
                           <li>密码文件包含用户名和密码组合，用于验证尝试建立连接的用户。</li>
                           <li>访问文件包含用户名和访问级别组合，用于授权对MBean服务器中MBean的访问。访问级别为读写或只读。</li>
                        </ul>
                        <p>的<code class="codeph">Server</code>然后创建一个名为的连接器服务器<code class="codeph">cs</code> ，并以与前面的RMI连接器示例完全相同的方式启动它。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-70D3FD66-4A10-4640-9A78-722C046CD9EB" name="GUID-70D3FD66-4A10-4640-9A78-722C046CD9EB"></a><h4 id="JSJMX-GUID-70D3FD66-4A10-4640-9A78-722C046CD9EB" class="sect4">主题委托示例中的java.policy</h4>
                  <div>
                     <p>的<code class="codeph">java.policy</code>文件授予<code class="codeph">username</code>一种<code class="codeph">SubjectDelegationPermission</code>因此它可以代表用户执行操作<code class="codeph">delegate</code> ，是<code class="codeph">JMXPrincipal</code>由创建<code class="codeph">Client</code>类。的<code class="codeph">java.policy</code>启动时需要文件<code class="codeph">Server</code>类。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-BBEDE9C9-5C81-4845-A307-2B402DE2E122" name="GUID-BBEDE9C9-5C81-4845-A307-2B402DE2E122"></a><h4 id="JSJMX-GUID-BBEDE9C9-5C81-4845-A307-2B402DE2E122" class="sect4">主题委托示例中的SimpleStandardMBean.java</h4>
                  <div>
                     <p>的<code class="codeph">SimpleStandardMBean</code>类定义了与先前示例相同的简单MBean接口。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-20646635-48E2-4EE5-9061-9D68057E31CE" name="GUID-20646635-48E2-4EE5-9061-9D68057E31CE"></a><h4 id="JSJMX-GUID-20646635-48E2-4EE5-9061-9D68057E31CE" class="sect4">主题委托示例中的SimpleStandard.java</h4>
                  <div>
                     <p>的<code class="codeph">SimpleStandard</code>类定义了与先前示例中相同的，简单的MBean。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-7F9DDC38-0EFE-4A45-B38F-72ABAF50A486" name="GUID-7F9DDC38-0EFE-4A45-B38F-72ABAF50A486"></a><h4 id="JSJMX-GUID-7F9DDC38-0EFE-4A45-B38F-72ABAF50A486" class="sect4">主题委托示例中的ClientListener.java</h4>
                  <div>
                     <p>的<code class="codeph">ClientListener</code>类定义了与先前示例中相同的，简单的通知侦听器。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-393CA4EB-3C30-4812-94B4-8D421B3115AF" name="GUID-393CA4EB-3C30-4812-94B4-8D421B3115AF"></a><h4 id="JSJMX-GUID-393CA4EB-3C30-4812-94B4-8D421B3115AF" class="sect4">主题委托示例中的Client.java</h4>
                  <div>
                     <p>的<code class="codeph">Client.java</code>类在代码示例5-4中显示。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-393CA4EB-3C30-4812-94B4-8D421B3115AF__GUID-03FCE024-DD53-4310-96C5-72486E45A7A5">代码示例5-4安全RMI连接器（主题委派）示例类Client.java</p><pre class="pre codeblock"><code>public class Client { 
 
  public static void main(String[] args) { 
    try { 
         HashMap env = new HashMap(); 
         String[] credentials = new String[] { "username" , "password" }; 
         env.put("jmx.remote.credentials", credentials); 
         JMXServiceURL url = new JMXServiceURL( 
            "service:jmx:rmi:///jndi/rmi://localhost:9999/server"); 
         JMXConnector jmxc = JMXConnectorFactory.connect(url, env); 
         Subject delegationSubject = 
            new Subject(true, 
                Collections.singleton(new JMXPrincipal("delegate")), 
                Collections.EMPTY_SET, 
                Collections.EMPTY_SET); 
 
         MBeanServerConnection mbsc = 
            jmxc.getMBeanServerConnection(delegationSubject); 
         String domains[] = mbsc.getDomains(); 
         ObjectName mbeanName = 
            new ObjectName("MBeans:type=SimpleStandard"); 
         mbsc.createMBean("SimpleStandard", mbeanName, null, null); 
         // Perform MBean operations 
         // 
 
[...] 
         mbsc.removeNotificationListener(mbeanName, listener); 
         mbsc.unregisterMBean(mbeanName); 
         jmxc.close(); 
     } catch (Exception e) { 
         e.printStackTrace(); 
     } 
  } 
} 
 
</code></pre><p>代码示例5-4从创建环境映射开始<code class="codeph">env</code>用用户名填充<code class="codeph">username</code>和密码<code class="codeph">password</code> 。这些字符串与存储在<code class="codeph">password.properties</code>所拥有的文件<code class="codeph">Server</code>验证访问连接器服务器的用户。
                        </p>
                        <p>JMX技术连接器客户端<code class="codeph">jmxc</code>与前面的RMI连接器示例中的创建方式相同，将用户名和密码传递到环境映射中<code class="codeph">env</code> 。
                        </p>
                        <p>的<code class="codeph">Client</code>然后创建一个实例<code class="codeph">Subject</code> ，称为<code class="codeph">delegationSubject</code> ，带有<code class="codeph">Principal</code>那是<code class="codeph">JMXPrincipal</code> ，命名<code class="codeph">delegate</code> 。
                        </p>
                        <p>一个MBean服务器连接，名为<code class="codeph">mbsc</code> ，是通过调用<code class="codeph">getMBeanServerConnection()</code>的方法<code class="codeph">JMXConnector</code> ，带有<code class="codeph">delegationSubject</code>作为参数传入。因此，此MBean服务器连接允许代表存储在远程MBean服务器上的主体在远程MBean服务器上执行操作。 <code class="codeph">delegationSubject</code> ，在此示例中是<code class="codeph">JMXPrincipal</code>命名<code class="codeph">delegate</code> 。
                        </p>
                        <p>该示例继续通过创建和注册<code class="codeph">SimpleStandard</code> MBean服务器中的MBean，并对其进行操作，其方式与前面的示例完全相同。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-43E31352-4E57-401E-A785-79698BFC50CF" name="GUID-43E31352-4E57-401E-A785-79698BFC50CF"></a><h4 id="JSJMX-GUID-43E31352-4E57-401E-A785-79698BFC50CF" class="sect4">使用主题委托运行Secure RMI Connector示例</h4>
                  <div>
                     <p>要使用主题委派运行安全的RMI连接器示例，请执行以下步骤：</p>
                     <ol>
                        <li>运行安全的RMI连接器示例：<pre class="pre codeblock"><code>
$ javac  mbeans/SimpleStandard.java \ 
  mbeans/SimpleStandardMBean.java \ 
  server/Server.java \ 
  client/Client.java \ 
  client/ClientListener.java 
 
</code></pre></li>
                        <li>在本地主机的端口<span class="bold">9999</span>上启动RMI注册表。
<pre class="pre codeblock"><code>$ export CLASSPATH=server ; rmiregistry 9999 &amp;</code></pre></li>
                        <li>开始<code class="codeph">Server</code> 。
<pre class="pre codeblock"><code>
$ java -classpath server:mbeans \ 
  -Djava.security.policy=config/java.policy Server &amp; 
 
</code></pre><p>您将看到有关MBean服务器创建，环境映射初始化，RMI连接器创建以及该连接器在MBean服务器中注册的确认。</p>
                        </li>
                        <li>开始<code class="codeph">Client</code> 。<pre class="pre codeblock"><code>$java -classpath client:server:mbeans Client</code></pre><p>您将看到有关创建连接器客户端，创建委托主题，与MBean服务器的连接以及各种MBean操作的确认，然后关闭连接。</p>
                        </li>
                     </ol>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-2A161539-E347-4CF1-84B9-482BC0C621C7" name="GUID-2A161539-E347-4CF1-84B9-482BC0C621C7"></a><h3 id="JSJMX-GUID-2A161539-E347-4CF1-84B9-482BC0C621C7" class="sect3">细粒度的安全</h3>
               <div>
                  <p>您可以通过Java身份验证和授权服务（JAAS）和Java平台标准版（Java SE）安全体系结构管理用户访问，从而在连接器中实现更细粒度的安全性。JAAS和Java SE安全性基于使用安全性管理器和策略文件为不同用户分配不同级别的访问权限。您可以指定允许哪些用户执行哪些操作。</p>
                  <p>本节中的两个示例与“ <a href="security.html#GUID-EFC2A37D-307F-4001-9D2F-6F0A2A3BC51D">简单安全性”中</a>显示的示例非常相似，不同之处在于基于策略的访问控制取代了基于文件的简单访问控制。
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-2A161539-E347-4CF1-84B9-482BC0C621C7__GUID-082223A0-DBDF-429B-992E-546936F4EC04">使用细粒度的安全示例类分析安全RMI连接器</p>
                     <ol>
                        <li>
                           <div class="p">将源代码从<a href="fine-grained-security-example.html">精细安全性</a>复制到<code class="codeph"><span class="variable" translate="no">work_dir</span>/jmx_examples/Security/fine_grained</code>子目录和文件：<ul style="list-style-type:disc">
                                 <li><code class="codeph">/server/Server.java</code></li>
                                 <li><code class="codeph">/config/java.policy</code></li>
                                 <li><code class="codeph">/config/keystore</code></li>
                                 <li><code class="codeph">/config/password.properties</code></li>
                                 <li><code class="codeph">/config/truststore</code></li>
                                 <li><code class="codeph">/mbeans/SimpleStandard.java</code></li>
                                 <li><code class="codeph">/mbeans/SimpleStandardMBean.java</code></li>
                                 <li><code class="codeph">/client/ClientListener.java</code></li>
                                 <li><code class="codeph">/client/Client.java</code></li>
                              </ul>
                           </div>
                        </li>
                        <li>打开所有<code class="codeph">*.java</code>和<code class="codeph">*.properties</code> IDE或文本编辑器中的文件。
                        </li>
                     </ol>
                     <p>以下各节包含对这些文件的分析。</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div class="sect3"><a id="GUID-2B52C953-4851-4F8A-A63B-24279CB76ED0" name="GUID-2B52C953-4851-4F8A-A63B-24279CB76ED0"></a><h4 id="JSJMX-GUID-2B52C953-4851-4F8A-A63B-24279CB76ED0" class="sect4">细粒度安全性示例中的Server.java</h4>
                  <div>
                     <p>的<code class="codeph">Server.java</code>本示例中的class <a href="security.html#GUID-AC42678F-30FF-4211-A547-2E46C13B38D0">与主题委托示例</a>中的<a href="security.html#GUID-AC42678F-30FF-4211-A547-2E46C13B38D0">Server.java中</a>使用的类非常相似。唯一的区别是没有<code class="codeph">access.properties</code>文件以映射到细粒度示例中的环境映射中。否则，这两个类是相同的。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-D70D2360-DCA8-41C7-84A7-D2E3896495DF" name="GUID-D70D2360-DCA8-41C7-84A7-D2E3896495DF"></a><h4 id="JSJMX-GUID-D70D2360-DCA8-41C7-84A7-D2E3896495DF" class="sect4">精细安全性示例中的java.policy</h4>
                  <div>
                     <p>的<code class="codeph">java.policy</code>文件授予以下权限：</p>
                     <ul style="list-style-type:disc">
                        <li>的所有权限<code class="codeph">server</code>代码库，以便连接器服务器可以创建连接器，然后执行远程用户调用所请求的操作</li>
                        <li><code class="codeph">MBeanTrustPermission</code>到<code class="codeph">mbeans</code>代码库，允许受信任的MBean在MBean服务器中注册</li>
                        <li>允许以表示的用户执行各种MBean和MBean服务器操作的权限<code class="codeph">JMXPrincipal</code>命名<code class="codeph">username.</code></li>
                     </ul>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-8A599F3A-D505-4CA6-8FD5-ADA43EDB97A1" name="GUID-8A599F3A-D505-4CA6-8FD5-ADA43EDB97A1"></a><h4 id="JSJMX-GUID-8A599F3A-D505-4CA6-8FD5-ADA43EDB97A1" class="sect4">细粒度安全性示例中的SimpleStandardMBean.java</h4>
                  <div>
                     <p>的<code class="codeph">SimpleStandardMBean</code>类定义了与先前示例相同的简单MBean接口。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-EB298AF7-E702-4DFB-BCB3-3F60AA706192" name="GUID-EB298AF7-E702-4DFB-BCB3-3F60AA706192"></a><h4 id="JSJMX-GUID-EB298AF7-E702-4DFB-BCB3-3F60AA706192" class="sect4">细粒度安全性示例中的SimpleStandard.java</h4>
                  <div>
                     <p>的<code class="codeph">SimpleStandard</code>类定义了与先前示例相同的简单MBean。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-8DDA6F9D-D791-46D6-B9CC-EAC4ECA4AA69" name="GUID-8DDA6F9D-D791-46D6-B9CC-EAC4ECA4AA69"></a><h4 id="JSJMX-GUID-8DDA6F9D-D791-46D6-B9CC-EAC4ECA4AA69" class="sect4">细粒度安全性示例中的ClientListener.java</h4>
                  <div>
                     <p>的<code class="codeph">ClientListener</code>类定义了与先前示例相同的简单通知侦听器。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-B70B9869-AA3F-42E7-BF20-5F60419508B2" name="GUID-B70B9869-AA3F-42E7-BF20-5F60419508B2"></a><h4 id="JSJMX-GUID-B70B9869-AA3F-42E7-BF20-5F60419508B2" class="sect4">细粒度安全性示例中的Client.java</h4>
                  <div>
                     <p>的<code class="codeph">Client.java</code>该类与<a href="security.html#GUID-393CA4EB-3C30-4812-94B4-8D421B3115AF">“主题委托示例”</a>中<a href="security.html#GUID-393CA4EB-3C30-4812-94B4-8D421B3115AF">Client.java中</a>使用的类完全相同。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-EDF837EA-A993-4000-9700-1700DD516455" name="GUID-EDF837EA-A993-4000-9700-1700DD516455"></a><h4 id="JSJMX-GUID-EDF837EA-A993-4000-9700-1700DD516455" class="sect4">以细粒度的安全性运行RMI连接器示例</h4>
                  <div>
                     <p>要以细粒度的安全性运行RMI连接器示例，请执行以下步骤：</p>
                     <ol>
                        <li>运行RMI连接器示例：<pre class="pre codeblock"><code>
$ javac 
      mbeans/SimpleStandard.java \ 
      mbeans/SimpleStandardMBean.java \ 
      server/Server.java \ 
      client/Client.java \ 
      client/ClientListener.java 
 
</code></pre></li>
                        <li>在本地主机的端口<span class="bold">9999</span>上启动RMI注册表。<pre class="pre codeblock"><code>$ export CLASSPATH=server ; rmiregistry 9999 &amp;</code></pre></li>
                        <li>开始<code class="codeph">Server</code> 。<pre class="pre codeblock"><code>
<code class="codeph">$ </code>java -classpath server:mbeans \ 
     -Djavax.net.ssl.keyStore=config/keystore \ 
     -Djavax.net.ssl.keyStorePassword=password \ 
     -Djava.security.manager \ 
     -Djava.security.policy=config/java.policy \ 
     Server &amp; 
 
</code></pre><p>您将看到环境映射的初始化，MBean服务器和RMI连接器的创建的确认。</p>
                        </li>
                        <li>开始<code class="codeph">Client</code> 。<pre class="pre codeblock"><code>
 
$ java -classpath client:server:mbeans \ 
     -Djavax.net.ssl.trustStore=config/truststore \ 
     -Djavax.net.ssl.trustStorePassword=trustword \ 
     Client 
 
</code></pre><p>您将看到有关创建连接器客户端，与RMI服务器的连接以及各种MBean操作的确认，然后关闭连接。</p>
                        </li>
                     </ol>
                  </div>
               </div>
            </div>
         </div>
      </article>
   

</body></html>