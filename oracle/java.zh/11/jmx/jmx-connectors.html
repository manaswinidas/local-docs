<html lang="en-us"  xml:lang="en-us"><head></head><body >﻿
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>JMX连接器</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Java Management Extensions Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Java Management Extensions Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="java-management-extensions-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-20T10:06:58-07:00">
      <meta name="dcterms.title" content="Java Management Extensions Guide">
      <meta name="dcterms.dateCopyrighted" content="1993, 2018">
      <meta name="dcterms.category" content="java">
      <meta name="dcterms.identifier" content="E95075-01">
      
      <meta name="dcterms.product" content="en/java/javase/11">
      <meta name="dcterms.release" content="11">
      <link rel="prev" href="essentials-jmx-api.html" title="Previous" type="text/html">
      <link rel="next" href="lookup-services.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"java","element_name":"Java","display_in_url":true},"suite":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product_group":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product":{"short_name":"javase","element_name":"Java SE","display_in_url":true},"release":{"short_name":"11","element_name":"11","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="JMX">
  <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script>
   
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="essentials-jmx-api.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一个</a> <a href="lookup-services.html" class="pull-right">下一个<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Java管理扩展指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="java-management-extensions-jmx-technology-tutorial.html" property="item" typeof="WebPage"><span property="name">Java管理扩展（JMX）技术教程</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">JMX连接器</li>
            </ol>
            <a id="GUID-A4CA2A4D-49EE-4DA8-871F-DD633C28DAD9" name="GUID-A4CA2A4D-49EE-4DA8-871F-DD633C28DAD9"></a>
            
            <h2 id="JSJMX-GUID-A4CA2A4D-49EE-4DA8-871F-DD633C28DAD9" class="sect2"><span class="enumeration_chapter">11个</span> JMX连接器</h2>
         </header>
         <div class="ind">
            <div>
               <p>本章介绍标准和动态管理Bean（MBean）的概念，并说明如何使用Java管理扩展（JMX）技术在本地和远程对MBean进行操作。</p>
            </div>
            <div class="sect2"><a id="GUID-681F18DA-8B9B-4FC2-8164-5BE0864A239C" name="GUID-681F18DA-8B9B-4FC2-8164-5BE0864A239C"></a><h3 id="JSJMX-GUID-681F18DA-8B9B-4FC2-8164-5BE0864A239C" class="sect3">使用RMI连接器访问标准和动态MBean</h3>
               <div>
                  <p>此示例演示了标准MBean和动态MBean。</p>
                  <p>从<a href="essentials-jmx-api.html#GUID-DED0E9DB-8ABE-41D1-A3A7-BA7EDB377AE5">JMX API的Essentials中</a>可以看出，标准MBean通过其包含的方法名称静态定义其管理接口。动态MBean实现特定的Java接口并在运行时显示其属性和操作。
                  </p>
                  <p>JMX技术定义了基于远程方法调用（RMI）的连接器。RMI连接器支持Java远程方法协议（JRMP）传输。通过此连接器，您可以从远程位置连接到MBean服务器中的MBean，并对其执行操作，就像在本地执行操作一样。</p>
                  <p>本示例的目的是演示标准MBean和动态MBean的实现。它显示了如何通过服务器和远程客户端之间的RMI连接在本地和远程对其执行操作。</p>
                  <p>当您运行此示例时：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p>服务器：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>创建一个MBean服务器</p>
                           </li>
                           <li>
                              <p>注册一个<code class="codeph">SimpleStandard</code>和一个<code class="codeph">SimpleDynamic</code>本地MBean服务器中的MBean</p>
                           </li>
                           <li>
                              <p>在MBean上执行本地操作</p>
                           </li>
                           <li>
                              <p>创建一个RMI连接器服务器</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>客户端：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>创建一个RMI连接器</p>
                           </li>
                           <li>
                              <p>注册一个<code class="codeph">SimpleStandard</code>和一个<code class="codeph">SimpleDynamic</code>远程MBean服务器上的MBean</p>
                           </li>
                           <li>
                              <p>在两个MBean上执行远程操作</p>
                           </li>
                        </ul>
                     </li>
                  </ul>
                  <div class="section">
                     <p class="subhead2" id="GUID-681F18DA-8B9B-4FC2-8164-5BE0864A239C__GUID-C7DB12B4-2805-4E02-AB9A-B84F0E434D18">分析基本MBean示例中使用的类</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li>
                        <p>将源代码从<a href="jmx-connectors-example.html">JMX连接器</a>复制到<code class="codeph"><span class="variable" translate="no">work_dir</span>/jmx_examples/Basic</code>目录。在此目录中，您将创建以下内容的副本：</p>
                        <ul style="list-style-type:disc">
                           <li><code class="codeph">Server.java</code></li>
                           <li><code class="codeph">SimpleStandardMBean.java</code></li>
                           <li><code class="codeph">SimpleStandard.java</code></li>
                           <li><code class="codeph">SimpleDynamic.java</code></li>
                           <li><code class="codeph">ClientListener.java</code></li>
                           <li><code class="codeph">Client.java</code></li>
                           <li><code class="codeph">README</code></li>
                        </ul>
                     </li>
                     <li>
                        <p>打开每个<code class="codeph">*.java</code> IDE或文本编辑器中的文件。
                        </p>
                     </li>
                  </ol>
                  <p>以下各节分析基本MBean示例中使用的每个类，并说明这些类如何执行上一节中描述的操作。</p>
               </div>
               <div class="sect3"><a id="GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1" name="GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1"></a><h4 id="JSJMX-GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1" class="sect4">MBean示例中的Server.java</h4>
                  <div>
                     <p>由于其尺寸， <code class="codeph">Server.java</code>以下代码摘录显示了该类：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="jmx-connectors.html#GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1__CODEEXAMPLE3-1MBEANEXAMPLECLASSSERV-BE43758F">代码示例3-1 MBean示例类Server.java（摘录1）</a></p>
                        </li>
                        <li>
                           <p><a href="jmx-connectors.html#GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1__CODEEXAMPLE3-2MBEANEXAMPLECLASSSERV-BE437B38">代码示例3-2 MBean示例类Server.java（摘录2）</a></p>
                        </li>
                        <li>
                           <p><a href="jmx-connectors.html#GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1__CODEEXAMPLE3-3MBEANEXAMPLECLASSSERV-BE437FC9">代码示例3-3 MBean示例类Server.java（摘录3）</a></p>
                        </li>
                        <li>
                           <p><a href="jmx-connectors.html#GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1__CODEEXAMPLE3-4MBEANEXAMPLECLASSSERV-BE4384A1">代码示例3-4 MBean示例类Server.java（摘录4）</a></p>
                        </li>
                        <li>
                           <p><a href="jmx-connectors.html#GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1__CODEEXAMPLE3-5MBEANEXAMPLECLASSSERV-BE438E4D">代码示例3-5 MBean示例类Server.java（摘录5）</a></p>
                        </li>
                     </ul>
                     <div class="section" id="GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1__CODEEXAMPLE3-1MBEANEXAMPLECLASSSERV-BE43758F">
                        <p class="subhead3" id="GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1__GUID-08B71948-7B15-4F98-BF68-D69E11A11264">代码示例3-1 MBean示例类Server.java（摘录1）</p><pre class="pre codeblock"><code>
 
public class Server { 
 
 public static void main(String[] args) { 
     try { 
          
         MBeanServer mbs = MBeanServerFactory.createMBeanServer(); 
         waitForEnterPressed(); 
 
         String domain = mbs.getDefaultDomain(); 
         waitForEnterPressed(); 
 
         String mbeanClassName = "SimpleStandard"; 
         String mbeanObjectNameStr = 
             domain + ":type=" + mbeanClassName + ",name=1"; 
         ObjectName mbeanObjectName = 
             createSimpleMBean(mbs, mbeanClassName, mbeanObjectNameStr); 
         waitForEnterPressed(); 
 
         printMBeanInfo(mbs, mbeanObjectName, mbeanClassName); 
         waitForEnterPressed(); 
 
         manageSimpleMBean(mbs, mbeanObjectName, mbeanClassName); 
         waitForEnterPressed(); 
 
         mbeanClassName = "SimpleDynamic"; 
         mbeanObjectNameStr = 
             domain + ":type=" + mbeanClassName + ",name=1"; 
         mbeanObjectName = 
             createSimpleMBean(mbs, mbeanClassName, mbeanObjectNameStr); 
         waitForEnterPressed(); 
 
         printMBeanInfo(mbs, mbeanObjectName, mbeanClassName); 
         waitForEnterPressed(); 
 
         manageSimpleMBean(mbs, mbeanObjectName, mbeanClassName); 
         waitForEnterPressed(); 
 
         [...] 
 
</code></pre><p>检查此类，您会看到发生以下情况：</p>
                        <p>首先， <code class="codeph">Server.java</code>类创建一个名为的新MBean服务器<code class="codeph">mbs</code>通过调用<code class="codeph">createMBeanServer()</code>的方法<code class="codeph">MBeanServerFactory</code>类。
                        </p>
                        <p>然后，通过调用来获得注册MBean服务器的默认域。 <code class="codeph">getDefaultDomain()</code>的方法<code class="codeph">MBeanServer</code>接口。域由字符串标识<code class="codeph">domain</code> 。
                        </p>
                        <p>名为MBean的类<code class="codeph">SimpleStandard</code>也由变量标识，在这种情况下为字符串<code class="codeph">mbeanClassName</code> 。 <code class="codeph">SimpleStandard</code>是此MBean是其实例的Java对象的Java类的名称。的<code class="codeph">SimpleStandard.java</code> <a href="security.html#GUID-EB298AF7-E702-4DFB-BCB3-3F60AA706192">细粒度安全性示例</a>中的<a href="security.html#GUID-EB298AF7-E702-4DFB-BCB3-3F60AA706192">SimpleStandard.java中</a>检查了对象。
                        </p>
                        <p>另一个变量，字符串<code class="codeph">mbeanObjectNameStr</code>定义为域的组合，再加上以下键=值对：</p>
                        <ul style="list-style-type:disc">
                           <li>的<code class="codeph">type</code> ，在这种情况下是<code class="codeph">mbeanClassName</code> 。
                           </li>
                           <li>一种<code class="codeph">name</code> ，以区分该MBean与随后可能创建的相同类型的其他MBean。在这种情况下，名称号码是<code class="codeph">1</code> 。
                           </li>
                        </ul>
                        <p>的目的<code class="codeph">mbeanObjectNameStr</code>为MBean提供人类可读的标识符。
                        </p>
                        <p>对createSimpleMBean（）的调用将使用给定的对象名称在本地MBean服务器中创建并注册SimpleStandard MBean。</p>
                        <p>行动<code class="codeph">printMBeanInfo()</code>和<code class="codeph">manageSimpleMBean()</code>然后在<code class="codeph">SimpleStandard</code> MBean。喜欢<code class="codeph">createSimpleMBean()</code> ，这些方法将在后面的<code class="codeph">Server.java</code>代码，如<a href="jmx-connectors.html#GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1__CODEEXAMPLE3-4MBEANEXAMPLECLASSSERV-BE4384A1">代码示例3-4 MBean示例类Server.java（摘录4）</a>和<a href="jmx-connectors.html#GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1__CODEEXAMPLE3-5MBEANEXAMPLECLASSSERV-BE438E4D">代码示例3-5 MBean示例类Server.java（摘录5）中所示</a> 。
                        </p>
                        <p>在此处未显示的代码中，该类型的第二个MBean <code class="codeph">SimpleDynamic</code>的创建和注册方式与MBean服务器中的完全相同<code class="codeph">SimpleStandard</code> MBean。顾名思义，此MBean是<code class="codeph">SimpleDynamic</code> Java对象， <a href="jmx-connectors.html#GUID-D17D3B4F-E305-4665-B7CB-45E72BA77606">在MBean Example的SimpleDynamic.java中</a>进行了检查。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1__CODEEXAMPLE3-2MBEANEXAMPLECLASSSERV-BE437B38">
                        <p class="subhead3" id="GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1__GUID-5BC42FFE-BAA8-47B8-9DE4-F088EB5F330B">代码示例3-2 MBean示例类Server.java（摘录2）</p><pre class="pre codeblock"><code>
 
[...] 
 
JMXServiceURL url = 
  new JMXServiceURL("service:jmx:rmi:///jndi/rmi://localhost:9999/server"); 
JMXConnectorServer cs = 
  JMXConnectorServerFactory.newJMXConnectorServer(url, null, mbs); 
cs.start(); 
waitForEnterPressed(); 
cs.stop(); 
 
[...] 
 
</code></pre><p>在<span class="bold">代码示例3-2 MBean示例类Server.java（摘录2）中</span> ，创建了RMI连接器服务器，以便可以在MBean上远程执行操作。召集全班<code class="codeph">JMXServiceURL</code>创建一个名为的新服务URL <code class="codeph">url</code> ，用作连接器服务器的地址。在此示例中，服务URL以<span class="italic">JNDI形式</span>给出，而不是以<span class="italic">编码形式给出</span> （请参阅API文档以获取<code class="codeph">javax.management.remote.rmi</code>包，以解释JNDI表单）。该服务URL定义以下内容：</p>
                        <ul style="list-style-type:disc">
                           <li>连接器将使用默认的RMI传输，表示为<code class="codeph">rmi</code> 。
                           </li>
                           <li>存储RMI连接器存根的RMI注册表将在端口上运行<code class="codeph">9999</code>在本地主机上，并且服务器地址将以该名称注册<code class="codeph">server</code> 。港口<code class="codeph">9999</code>在示例中指定是任意的；您可以使用任何可用的端口。
                           </li>
                        </ul>
                        <p>一个名为RMI的连接器服务器<code class="codeph">cs</code>通过调用构造函数创建<code class="codeph">JMXConnectorServerFactory</code> ，带有服务网址<code class="codeph">url</code> ， 一种<code class="codeph">null</code>环境图和MBean服务器<code class="codeph">mbs</code>作为参数。连接器服务器<code class="codeph">cs</code>通过调用<code class="codeph">start()</code>的方法<code class="codeph">JMXConnectorServer</code> ，于是<code class="codeph">RMIConnectorServer</code>导出RMI对象<code class="codeph">server</code>到RMI注册表。按照简单方法的指示，连接将保持打开状态，直到按Enter键为止<code class="codeph">waitForEnterPressed</code> ，这将在后面的<code class="codeph">Server</code>码。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1__CODEEXAMPLE3-3MBEANEXAMPLECLASSSERV-BE437FC9">
                        <p class="subhead3" id="GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1__GUID-3C140789-BD58-4589-B02F-75D239784921">代码示例3-3 MBean示例类Server.java（摘录3）</p><pre class="pre codeblock"><code>
 
[...] 
 
private static ObjectName createSimpleMBean(MBeanServer mbs, 
                                              String mbeanClassName, 
                                              String mbeanObjectNameStr) { 
     echo("\n&gt;&gt;&gt; Create the " + mbeanClassName + 
          " MBean within the MBeanServer"); 
     echo("ObjectName = " + mbeanObjectNameStr); 
     try { 
          ObjectName mbeanObjectName = 
             ObjectName.getInstance(mbeanObjectNameStr); 
          mbs.createMBean(mbeanClassName, mbeanObjectName); 
             return mbeanObjectName; 
          } catch (Exception e) { 
            echo(       "!!! Could not create the " +  
                  mbeanClassName + " MBean !!!"); 
            e.printStackTrace(); 
            echo("\nEXITING...\n"); 
            System.exit(1); 
        } 
        return null; 
     } 
 
[...] 
 
</code></pre><p><span class="bold">代码示例3-3 MBean示例类Server.java（摘录3）</span>显示了<code class="codeph">createSimpleMBean()</code>方法。在此方法中，具有对象名称的MBean实例<code class="codeph">mbeanObjectNameStr</code>被传递给<code class="codeph">getInstance()</code>的方法<code class="codeph">ObjectName</code>接口以创建用于在MBean服务器内部注册MBean的新对象名称。结果对象名称实例命名为<code class="codeph">mbeanObjectName</code> 。致电<code class="codeph">MBeanServer</code>方法<code class="codeph">createMBean()</code>然后实例化由MBean标识的Java对象的组合定义的MBean <code class="codeph">mbeanClassName</code>和MBean实例<code class="codeph">mbeanObjectName</code>并在MBean服务器中注册此MBean <code class="codeph">mbs</code> 。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1__CODEEXAMPLE3-4MBEANEXAMPLECLASSSERV-BE4384A1">
                        <p class="subhead3" id="GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1__GUID-9AD100DD-AD7F-494F-AD04-89FB5D85898E">代码示例3-4 MBean示例类Server.java（摘录4）</p><pre class="pre codeblock"><code>
[...] 
 
private static void printMBeanInfo(MBeanServer mbs, 
                                     ObjectName mbeanObjectName, 
                                     String mbeanClassName) { 
     MBeanInfo info = null; 
     try { 
         info = mbs.getMBeanInfo(mbeanObjectName); 
     } catch (Exception e) { 
         echo(  "!!! Could not get MBeanInfo object for " + 
         mbeanClassName +" !!!"); 
         e.printStackTrace(); 
         return; 
     } 
 
     MBeanAttributeInfo[] attrInfo = info.getAttributes(); 
     if (attrInfo.length &gt; 0) { 
         for (int i = 0; i &lt; attrInfo.length; i++) { 
        echo(" ** NAME:    " + attrInfo[i].getName()); 
        echo("    DESCR:   " + attrInfo[i].getDescription()); 
        echo("    TYPE:    " + attrInfo[i].getType() + 
                "READ: "+ attrInfo[i].isReadable() + 
                "WRITE: "+ attrInfo[i].isWritable()); 
        } 
     } else echo(" ** No attributes **"); 
 
[...] 
</code></pre><p>在<span class="bold">代码示例3-4 MBean示例类Server.java（摘录4）中</span> ，我们看到了方法的定义<code class="codeph">printMBeanInfo()</code> 。的<code class="codeph">printMBeanInfo()</code>方法调用<code class="codeph">MBeanServer</code>方法<code class="codeph">getMBeanInfo()</code>获取MBean公开的属性和操作的详细信息<code class="codeph">mbeanObjectName</code> 。 <code class="codeph">MBeanAttributeInfo</code>定义以下方法，依次调用每个方法以获取有关<code class="codeph">mbeanObjectName</code> MBean的属性：</p>
                        <ul style="list-style-type:disc">
                           <li><code class="codeph">getName</code> ：获取属性的名称。
                           </li>
                           <li><code class="codeph">getDescription</code> ：获取该属性的可读描述。
                           </li>
                           <li><code class="codeph">getType</code> ：获取属性的类名称。
                           </li>
                           <li><code class="codeph">isReadable</code> ：确定属性是否可读。
                           </li>
                           <li><code class="codeph">isWritable</code> ：确定属性是否可写。
                           </li>
                        </ul>
                        <p>在此处未显示的代码中，将进行调用以获取有关<code class="codeph">mbeanObjectName</code> MBean的构造函数，操作和通知：</p>
                        <ul style="list-style-type:disc">
                           <li><code class="codeph">MBeanConstructorInfo</code> ：获取有关MBean的Java类的信息。
                           </li>
                           <li><code class="codeph">MBeanOperationInfo</code> ：了解MBean执行哪些操作以及需要使用什么参数。
                           </li>
                           <li><code class="codeph">MBeanNotificationInfo</code> ：找出执行其操作时MBean发送的通知。
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1__CODEEXAMPLE3-5MBEANEXAMPLECLASSSERV-BE438E4D">
                        <p class="subhead3" id="GUID-89B47AE8-B4FA-44EA-BB90-8F8C9D0710E1__GUID-44B104F4-4D7F-4F8F-931E-0B1E5FE9804C">代码示例3-5 MBean示例类Server.java（摘录5）</p><pre class="pre codeblock"><code>
[...] 
 
private static void manageSimpleMBean(MBeanServer mbs, 
                                        ObjectName mbeanObjectName, 
                                        String mbeanClassName) { 
        try { 
            printSimpleAttributes(mbs, mbeanObjectName); 
 
            Attribute stateAttribute = new Attribute("State", 
                                                     "new state"); 
            mbs.setAttribute(mbeanObjectName, stateAttribute); 
 
            printSimpleAttributes(mbs, mbeanObjectName); 
             
            echo("\n    Invoking reset operation..."); 
            mbs.invoke(mbeanObjectName, "reset", null, null); 
 
            printSimpleAttributes(mbs, mbeanObjectName); 
        } catch (Exception e) { 
            e.printStackTrace(); 
        } 
    } 
 
    private static void printSimpleAttributes( 
                                        MBeanServer mbs, 
                                        ObjectName mbeanObjectName) { 
        try { 
            String State =  
               (String) mbs.getAttribute(mbeanObjectName, "State"); 
            Integer NbChanges = 
               (Integer) mbs.getAttribute(mbeanObjectName, 
                                          "NbChanges"); 
        } catch (Exception e) { 
            echo(       "!!! Could not read attributes !!!"); 
            e.printStackTrace(); 
        } 
   } 
 
[...]  
</code></pre><p><span class="bold">代码示例3-5 MBean示例类Server.java（摘录5）</span>演示了一种用于管理简单MBean的方法。
                        </p>
                        <p>的<code class="codeph">manageSimpleMBean()</code>方法首先调用<code class="codeph">printSimpleAttributes()</code>也由定义的方法<code class="codeph">Server</code> 。的<code class="codeph">printSimpleAttributes()</code>方法获得一个称为的MBean属性<code class="codeph">state</code>从MBean <code class="codeph">mbeanObjectName</code> ，以及另一个名为MBean的属性<code class="codeph">NbChanges</code> 。这两个属性均在<code class="codeph">SimpleStandard</code>类， <a href="security.html#GUID-EB298AF7-E702-4DFB-BCB3-3F60AA706192">在“精细安全性示例”</a>中的<a href="security.html#GUID-EB298AF7-E702-4DFB-BCB3-3F60AA706192">SimpleStandard.java中</a>显示。
                        </p>
                        <p>的<code class="codeph">manageSimpleMBean()</code>然后，该方法定义一个称为<code class="codeph">stateAttribute</code> ，这是<code class="codeph">Attribute</code>类。的<code class="codeph">stateAttribute</code>属性将值关联<code class="codeph">new state</code>具有现有属性<code class="codeph">state</code> ， 被定义为<code class="codeph">SimpleStandard</code> 。致电<code class="codeph">MBeanServer</code>方法<code class="codeph">setAttribute()</code>然后设置<code class="codeph">mbeanObjectName</code> MBean的状态变为由定义的新状态<code class="codeph">stateAttribute</code> 。
                        </p>
                        <p>最后，致电<code class="codeph">MBeanServer</code>方法<code class="codeph">invoke()</code>调用<code class="codeph">mbeanObjectName</code> MBean的<code class="codeph">reset</code>操作。的<code class="codeph">reset</code>操作在<code class="codeph">SimpleStandard</code>类。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-4F4C3AAF-B3A5-4165-A30F-963A88DF01CA" name="GUID-4F4C3AAF-B3A5-4165-A30F-963A88DF01CA"></a><h4 id="JSJMX-GUID-4F4C3AAF-B3A5-4165-A30F-963A88DF01CA" class="sect4">MBean示例中的SimpleStandardMBean.java</h4>
                  <div>
                     <p>的<code class="codeph">SimpleStandardMBean.java</code> <span class="bold">CODE Example 3-6 MBean示例类中</span>显示了<span class="bold">该类<code class="codeph">SimpleStandardMBean.java</code></span> 。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-4F4C3AAF-B3A5-4165-A30F-963A88DF01CA__GUID-0E21E1DD-8EE9-43BA-AED4-CE30014C4D3E">代码示例3-6 MBean示例类SimpleStandardMBean.java</p><pre class="pre codeblock"><code>
 
public interface SimpleStandardMBean { 
 
       public String getState(); 
       public void setState(String s); 
       public int getNbChanges(); 
       public void reset(); 
 
} 
 
</code></pre><p>的<code class="codeph">SimpleStandardMBean.java</code>类是MBean的简单JMX规范管理接口<code class="codeph">SimpleStandard</code> 。该接口公开了由定义的四个操作<code class="codeph">SimpleStandard</code>通过JMX代理进行管理。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-3DF0EA75-3F2E-4218-8A6D-08DC4D3BC4CC" name="GUID-3DF0EA75-3F2E-4218-8A6D-08DC4D3BC4CC"></a><h4 id="JSJMX-GUID-3DF0EA75-3F2E-4218-8A6D-08DC4D3BC4CC" class="sect4">MBean示例中的SimpleStandard.java</h4>
                  <div>
                     <p>的<code class="codeph">SimpleStandard.java</code> <span class="bold">代码示例3-7中</span>显示了<span class="bold">MBean示例类<code class="codeph">SimpleStandard.java</code></span> 。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-3DF0EA75-3F2E-4218-8A6D-08DC4D3BC4CC__GUID-F7CF192D-7C83-4CED-A958-B4F3E065BE0A">代码示例3-7 MBean示例类SimpleStandard.java</p><pre class="pre codeblock"><code>
 
public class SimpleStandard 
    extends NotificationBroadcasterSupport 
    implements SimpleStandardMBean { 
    public String getState() { 
       return state; 
    } 
    public void setState(String s) { 
       state = s; 
       nbChanges++; 
    } 
     
    public int getNbChanges() { 
        return nbChanges; 
    } 
     
    public void reset() { 
       AttributeChangeNotification acn =  
           new AttributeChangeNotification(this, 
                                          0, 
                                          0, 
                                          "NbChanges reset", 
                                          "NbChanges", 
                                          "Integer", 
                                          new Integer(nbChanges), 
                                          new Integer(0)); 
       state = "initial state"; 
       nbChanges = 0; 
       nbResets++; 
       sendNotification(acn); 
    } 
     
    public int getNbResets() { 
       return nbResets; 
    } 
 
    public MBeanNotificationInfo[] getNotificationInfo() { 
        return new MBeanNotificationInfo[] { 
          new MBeanNotificationInfo( 
          new String[] { 
            AttributeChangeNotification.ATTRIBUTE_CHANGE }, 
            AttributeChangeNotification.class.getName(), 
            "This notification is emitted when the reset()  
             method is called.") 
        }; 
    } 
     
    private String state = "initial state"; 
    private int nbChanges = 0; 
    private int nbResets = 0; 
 
}         
 
</code></pre><p>的<code class="codeph">SimpleStandard</code>类定义了简单的JMX规范标准MBean。的<code class="codeph">SimpleStandard</code> MBean通过实现相应的方法来公开用于管理的操作和属性<code class="codeph">SimpleStandardMBean</code>界面，如<a href="security.html#GUID-BBEDE9C9-5C81-4845-A307-2B402DE2E122">“主题委托示例”</a>中的<a href="security.html#GUID-BBEDE9C9-5C81-4845-A307-2B402DE2E122">SimpleStandardMBean.java中</a>所示。
                        </p>
                        <p>此MBean公开的简单操作是：</p>
                        <ul style="list-style-type:disc">
                           <li>
                              <p>定义状态</p>
                           </li>
                           <li>
                              <p>更新此状态</p>
                           </li>
                           <li>
                              <p>计算状态更新的次数</p>
                           </li>
                           <li>
                              <p>将状态值和更改次数重置为原始值零</p>
                           </li>
                           <li>
                              <p>每当调用重置操作时发送通知</p>
                           </li>
                        </ul>
                        <p>reset操作发出的通知是该类的实例<code class="codeph">AttributeChangeNotification</code> ，它收集有关在服务器上执行的更改数量的信息<code class="codeph">State</code>属性，然后调用reset。发送的通知的内容由<code class="codeph">MBeanNotificationInfo</code>实例。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-D17D3B4F-E305-4665-B7CB-45E72BA77606" name="GUID-D17D3B4F-E305-4665-B7CB-45E72BA77606"></a><h4 id="JSJMX-GUID-D17D3B4F-E305-4665-B7CB-45E72BA77606" class="sect4">MBean示例中的SimpleDynamic.java</h4>
                  <div>
                     <p>的<code class="codeph">SimpleDynamic</code>类在<span class="bold">代码示例3-8中</span>显示。 <span class="bold"><code class="codeph">SimpleDynamic.java</code></span> 。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-D17D3B4F-E305-4665-B7CB-45E72BA77606__GUID-79DF35F0-0999-494F-8F76-FE22E91FB090">代码示例3-8 MBean示例类SimpleDynamic.java</p><pre class="pre codeblock"><code>
 
public class SimpleDynamic 
    extends NotificationBroadcasterSupport 
    implements DynamicMBean { 
 
    public SimpleDynamic() { 
        buildDynamicMBeanInfo(); 
    } 
 
[...] 
</code></pre><p>的<code class="codeph">SimpleDynamic</code>动态MBean通过实现以下功能展示了如何在运行时公开用于管理的属性和操作： <code class="codeph">DynamicMBean</code>接口。首先定义一个方法， <code class="codeph">buildDynamicMBeanInfo()</code> ，用于动态获取MBean的信息。的<code class="codeph">buildDynamicMBeanInfo()</code>方法建立<code class="codeph">MBeanInfo</code>用于动态MBean。
                        </p>
                        <p>其余的代码<code class="codeph">SimpleDynamic</code>对应于<code class="codeph">DynamicMBean</code>接口。公开的属性，操作和通知与<code class="codeph">SimpleStandard</code> MBean。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-871B0138-49A6-462D-8CC0-981C595822D0" name="GUID-871B0138-49A6-462D-8CC0-981C595822D0"></a><h4 id="JSJMX-GUID-871B0138-49A6-462D-8CC0-981C595822D0" class="sect4">MBean示例中的ClientListener.java</h4>
                  <div>
                     <p>的<code class="codeph">ClientListener.java</code>类在<span class="bold">代码示例3-9中显示MBean示例类<code class="codeph">ClientListener.java</code></span> 。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-871B0138-49A6-462D-8CC0-981C595822D0__GUID-C5DEE887-08A8-47AF-9E5D-824AADC466F2">代码示例3-9 MBean示例类ClientListener.java</p><pre class="pre codeblock"><code>
 
 
public class ClientListener implements NotificationListener {  
 public void handleNotification(Notification notification, Object handback)  
     {  
         System.out.println("\nReceived notification: " + notification);  
     }  
} 
 
</code></pre><p>的<code class="codeph">ClientListener</code>类实现了一个简单的JMX规范通知侦听器。的<code class="codeph">handleNotification()</code>的方法<code class="codeph">NotificationListener</code>接收到通知后，将调用该接口，并打印一条消息以确认已接收到通知。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-1F7EEC29-1A49-459E-B48A-3AD5878D3638" name="GUID-1F7EEC29-1A49-459E-B48A-3AD5878D3638"></a><h4 id="JSJMX-GUID-1F7EEC29-1A49-459E-B48A-3AD5878D3638" class="sect4">MBean示例中的Client.java</h4>
                  <div>
                     <p>的<code class="codeph">Client.java</code>类在<span class="bold">代码示例3-10中</span>显示。 <span class="bold"><code class="codeph">Client.java</code></span> 。
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-1F7EEC29-1A49-459E-B48A-3AD5878D3638__GUID-45B7AAF6-7470-4C2F-B46D-976C14C594F1">代码示例3-10 MBean示例类Client.java</p><pre class="pre codeblock"><code>
 
public class Client { 
 
  public static void main(String[] args) { 
    try { 
      // Create an RMI connector client 
      // 
      JMXServiceURL url = new JMXServiceURL( 
         "service:jmx:rmi:///jndi/rmi://localhost:9999/server"); 
      JMXConnector jmxc = JMXConnectorFactory.connect(url, null); 
      ClientListener listener = new ClientListener(); 
      MBeanServerConnection mbsc = jmxc.getMBeanServerConnection(); 
      waitForEnterPressed();       
       
      // Get domains from MBeanServer 
      // 
      String domains[] = mbsc.getDomains(); 
      for (int i = 0; i &lt; domains.length; i++) { 
          System.out.println("Domain[" + i + "] = " + domains[i]); 
      } 
      waitForEnterPressed();       
 
      String domain = mbsc.getDefaultDomain();       
   
      // Create SimpleStandard MBean  
      ObjectName mbeanName =  
             new ObjectName(domain +":type=SimpleStandard,name=2"); 
      mbsc.createMBean("SimpleStandard", stdMBeanName, null, null); 
      waitForEnterPressed();       
             
      // Create SimpleDynamic MBean 
      ObjectName dynMBeanName = 
          new ObjectName(domain +":type=SimpleDynamic,name=2"); 
      echo("\nCreate SimpleDynamic MBean..."); 
      mbsc.createMBean("SimpleDynamic", dynMBeanName, null, null); 
      waitForEnterPressed(); 
       
      // Get MBean count 
      echo("\nMBean count = " + mbsc.getMBeanCount()); 
 
      // Query MBean names 
      echo("\nQuery MBeanServer MBeans:"); 
      Set names = mbsc.queryNames(null, null); 
      for (Iterator i = names.iterator(); i.hasNext(); ) { 
      echo(     "ObjectName = " + (ObjectName) i.next()); 
      } 
      waitForEnterPressed(); 
       
      mbsc.setAttribute(stdMBeanName, 
                        new Attribute("State", "changed state")); 
 
      SimpleStandardMBean proxy = JMX.newMBeanProxy( 
          mbsc, stdMBeanName, SimpleStandardMBean.class, true); 
      echo("\nState = " + proxy.getState()); 
 
      ClientListener listener = new ClientListener(); 
      mbsc.addNotificationListener(stdMBeanName, listener, null, null); 
 
      mbsc.invoke(stdMBeanName, "reset", null, null); 
 
      mbsc.removeNotificationListener(stdMBeanName, listener); 
      mbsc.unregisterMBean(stdMBeanName); 
       
      [...] 
       
      jmxc.close(); 
    } catch (Exception e) { 
      e.printStackTrace(); 
    } 
  } 
} 
[...] 
</code></pre><p>的<code class="codeph">Client.java</code>类创建一个RMI连接器客户端，该客户端配置为连接到由创建的RMI连接器服务器<code class="codeph">Server.java</code> 。 <code class="codeph">Client.java</code>定义相同的服务URL <code class="codeph">url</code>如定义<code class="codeph">Server.java</code> 。这允许连接器客户端检索名为的RMI连接器服务器存根。 <code class="codeph">server</code>从端口上运行的RMI注册表中<code class="codeph">9999</code>本地主机，并连接到RMI连接器服务器。
                        </p>
                        <p>标识了RMI注册表后，即可创建连接器客户端。连接器客户端， <code class="codeph">jmxc</code> ，是接口的一个实例<code class="codeph">JMXConnector</code> ，由<code class="codeph">connect()</code>的方法<code class="codeph">JMXConnectorFactory</code> 。的<code class="codeph">connect()</code>方法传递参数<code class="codeph">url</code>和一个<code class="codeph">null</code>调用时的环境地图。
                        </p>
                        <p>客户端还会创建一个实例<code class="codeph">ClientListener</code> ，以侦听通知，如<a href="jmx-connectors.html#GUID-871B0138-49A6-462D-8CC0-981C595822D0">MBean Example</a>中的<a href="jmx-connectors.html#GUID-871B0138-49A6-462D-8CC0-981C595822D0">ClientListener.java</a>所示。
                        </p>
                        <p>JMX规范的实例<code class="codeph">MBeanServerConnection</code> ，命名<code class="codeph">mbsc</code> ，然后通过调用<code class="codeph">getMBeanServerConnection()</code>的方法<code class="codeph">JMXConnector</code>实例<code class="codeph">jmxc</code> 。
                        </p>
                        <p>现在，连接器客户端已连接到由创建的MBean服务器<code class="codeph">Server.java</code> ，并且可以注册MBean并对其执行操作，而连接对两端完全透明。
                        </p>
                        <p>客户端创建并注册<code class="codeph">SimpleStandard</code> MBean和MBean服务器中的SimpleDynamic MBean，并调用<code class="codeph">createMBean()</code>的方法<code class="codeph">MBeanServerConnection</code> ，并执行由定义的操作<code class="codeph">SimpleStandard</code>和<code class="codeph">SimpleDynamic</code>就像它们是本地JMX规范MBean操作一样。
                        </p>
                        <p>MBean代理使您可以通过Java接口访问MBean，从而使您可以在代理上进行调用，而不必编写冗长的代码来访问远程MBean。的MBean代理<code class="codeph">SimpleStandardMBean</code>通过调用方法在此处创建<code class="codeph">newMBeanProxy()</code>在里面<code class="codeph">javax.management.JMX</code>类，将其传递给MBean <code class="codeph">MBeanServerConnection</code> ，对象名称，MBean接口的类名称以及true，表示代理必须表现为<code class="codeph">NotificationBroadcaster</code> 。您可以通过简单地调用MXBean与标准MBean完全相同的方式来为其代理<code class="codeph">newMXBeanProxy()</code>代替<code class="codeph">newMBeanProxy()</code> 。
                        </p>
                        <p>用于执行不同操作的代码<code class="codeph">SimpleDynamic</code>此处未显示，因为操作与在上执行的操作相同<code class="codeph">SimpleStandard</code> 。
                        </p>
                        <p>最后，客户端取消注册<code class="codeph">SimpleStandard</code> MBean并关闭连接。决赛<code class="codeph">removeNotificationListener</code>是可选的，因为在关闭远程客户端时，将删除该远程客户端注册的侦听器。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-2DC09ACD-39C8-4132-BA5D-5DAAD15D5916" name="GUID-2DC09ACD-39C8-4132-BA5D-5DAAD15D5916"></a><h3 id="JSJMX-GUID-2DC09ACD-39C8-4132-BA5D-5DAAD15D5916" class="sect3">运行MBean示例</h3>
               <div>
                  <p>检查了示例类之后，您可以运行该示例。运行示例：</p>
                  <ol>
                     <li>编译Java类。
                        <div class="p"><pre class="pre codeblock"><code>$ javac *.java</code></pre></div>
                     </li>
                     <li>在端口上启动RMI注册表<code class="codeph">9999</code>本地主机。
                        <p>RMI注册表由<code class="codeph">Server</code>类来注册RMI连接器存根。
                        </p>
                        <div class="p"><pre class="pre codeblock"><code>$ rmiregistry 9999 &amp;</code></pre></div>
                     </li>
                     <li>开始<code class="codeph">Server</code>类。
                        <div class="p"><pre class="pre codeblock"><code>$ java -classpath . Server</code></pre></div>
                        <p>您将看到有关创建MBean服务器和创建MBean服务器的确认。 <code class="codeph">SimpleStandard</code> MBean服务器中的MBean。然后，系统将提示您按Enter键以获取有关以下内容的信息，然后对其执行操作： <code class="codeph">SimpleStandard</code> MBean。
                        </p>
                        <p>手术后<code class="codeph">SimpleStandard</code>完成后，对于<code class="codeph">SimpleDynamic</code> MBean。
                        </p>
                        <p>在创建MBean和执行它们的操作之后，您将看到RMI连接器服务器的创建，以允许从远程对MBean执行操作。 <code class="codeph">Client</code> 。
                        </p>
                     </li>
                     <li>开始<code class="codeph">Client</code>类在另一个终端窗口中。
                        <div class="p"><pre class="pre codeblock"><code>$ java -classpath . Client</code></pre></div>
                        <p>您将看到有关RMI连接器客户端的创建以及与连接器服务器的连接的确认。您还将被告知域名，域名的创建和注册。 <code class="codeph">SimpleStandard</code>和SimpleDynamic MBean。客户端将在<code class="codeph">SimpleStandard</code>和SimpleDynamic MBean，然后再注销它们。
                        </p>
                     </li>
                  </ol>
               </div>
            </div>
         </div>
      </article>
   

</body></html>