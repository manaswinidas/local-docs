<html lang="en-us"  xml:lang="en-us"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="The Process API lets you start, retrieve information about, and manage native operating system processes.">
      <meta name="description" content="The Process API lets you start, retrieve information about, and manage native operating system processes.">
      <title>Process API</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Core Libraries">
      <meta property="og:description" content="The Process API lets you start, retrieve information about, and manage native operating system processes.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Core Libraries">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="java-core-libraries-developer-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-20T08:11:40-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="2017, 2018">
      <meta name="dcterms.category" content="java">
      <meta name="dcterms.identifier" content="E94895-01">
      
      <meta name="dcterms.product" content="en/java/javase/11">
      <meta name="dcterms.release" content="11">
      <link rel="prev" href="creating-immutable-lists-sets-and-maps.html" title="Previous" type="text/html">
      <link rel="next" href="java-logging-overview.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"java","element_name":"Java","display_in_url":true},"suite":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product_group":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product":{"short_name":"javase","element_name":"Java SE","display_in_url":true},"release":{"short_name":"11","element_name":"11","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Java Core Libraries Developer Guide">
    <meta name="dcterms.isVersionOf" content="CORE">
  
                    <script>var w=window;if(w.performance||w.mozPerformance||w.msPerformance||w.webkitPerformance){var d=document;AKSB=w.AKSB||{},AKSB.q=AKSB.q||[],AKSB.mark=AKSB.mark||function(e,_){AKSB.q.push(["mark",e,_||(new Date).getTime()])},AKSB.measure=AKSB.measure||function(e,_,t){AKSB.q.push(["measure",e,_,t||(new Date).getTime()])},AKSB.done=AKSB.done||function(e){AKSB.q.push(["done",e])},AKSB.mark("firstbyte",(new Date).getTime()),AKSB.prof={custid:"322179",ustr:"",originlat:"0",clientrtt:"1",ghostip:"23.212.3.15",ipv6:false,pct:"10",clientip:"45.78.37.67",requestid:"29ee10cb",region:"32996",protocol:"",blver:14,akM:"dsca",akN:"ae",akTT:"O",akTX:"1",akTI:"29ee10cb",ai:"206465",ra:"false",pmgn:"",pmgi:"",pmp:"",qc:""},function(e){var _=d.createElement("script");_.async="async",_.src=e;var t=d.getElementsByTagName("script"),t=t[t.length-1];t.parentNode.insertBefore(_,t)}(("https:"===d.location.protocol?"https:":"http:")+"//ds-aksb-a.akamaihd.net/aksb.min.js")}</script>
                    <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="creating-immutable-lists-sets-and-maps.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一个</a> <a href="java-logging-overview.html" class="pull-right">下一个<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">核心图书馆</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">流程API</li>
            </ol>
            <a id="GUID-6FAB2491-FD4E-42B4-A883-DCD181A1CE3E" name="GUID-6FAB2491-FD4E-42B4-A883-DCD181A1CE3E"></a>
            
            <h2 id="JSCOR-GUID-6FAB2491-FD4E-42B4-A883-DCD181A1CE3E" class="sect2"><span class="enumeration_chapter">6</span>流程API</h2>
         </header>
         <div class="ind">
            <div>
               <p>使用Process API，您可以启动，检索有关本机操作系统进程的信息以及管理本机操作系统进程。</p>
               <p>使用此API，您可以按如下方式使用操作系统进程：</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p>运行任意命令：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>筛选正在运行的进程。</p>
                        </li>
                        <li>
                           <p>重定向输出。</p>
                        </li>
                        <li>
                           <p>通过调度进程在另一个结束时启动来连接异构命令和外壳程序。</p>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <p>测试命令的执行：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>运行一系列测试。</p>
                        </li>
                        <li>
                           <p>日志输出。</p>
                        </li>
                        <li>
                           <p>清理剩余的进程。</p>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <p>监视命令：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>监视长时间运行的进程，并在终止时重新启动它们</p>
                        </li>
                        <li>
                           <p>收集使用情况统计</p>
                        </li>
                     </ul>
                  </li>
               </ul>
               <div class="section">
                  <p class="subhead1" id="GUID-6FAB2491-FD4E-42B4-A883-DCD181A1CE3E__GUID-A69A8C5A-00D3-4AC6-B041-128EA86EF2F6">话题</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="process-api1.html#GUID-ED9190A3-FE19-474F-8F85-36819B665130" title="Process API由ProcessBuilder，Process，ProcessHandle和ProcessHandle的类和接口组成。信息。">流程API类和接口</a></p>
                     </li>
                     <li>
                        <p><a href="process-api1.html#GUID-81804DFA-D47A-4874-AF73-528365FEC711" title="要创建流程，请首先使用ProcessBuilder类指定流程的属性，例如命令名称及其参数。然后，使用ProcessBuilder.start方法启动该过程，该方法返回一个Process实例。">创建过程</a></p>
                     </li>
                     <li>
                        <p><a href="process-api1.html#GUID-30EA2C53-C6BA-422F-9F04-2660525B7F3D" title="方法Process.pid返回该进程的本机进程ID。方法Process.info返回一个ProcessHandle。信息实例，其中包含有关该进程的其他信息，例如其可执行路径名称，开始时间和用户。">获取有关流程的信息</a></p>
                     </li>
                     <li>
                        <p><a href="process-api1.html#GUID-472F9FE1-DA6E-4A72-A19F-6EDF059B37B7" title="默认情况下，进程将标准输出和标准错误写入管道。在您的应用程序中，您可以通过Process.getOutputStream和Process.getErrorStream方法返回的输入流访问这些管道。但是，在开始该过程之前，您可以使用redirectOutput和redirectError方法将标准输出和标准错误重定向到其他目标，例如文件。">从流程重定向输出</a></p>
                     </li>
                     <li>
                        <p><a href="process-api1.html#GUID-2A7BD6A9-7EE6-4050-A08A-BD7731BE2623" title="方法ProcessHandle.allProcesses返回当前进程可见的所有进程的流。您可以使用与过滤集合中的元素相同的方式来过滤此流的ProcessHandle实例。">使用流过滤流程</a></p>
                     </li>
                     <li>
                        <p><a href="process-api1.html#GUID-A6A4B56A-7F3F-4ACD-930A-4E4AA3A930E7" title="Process.onExit和ProcessHandle.onExit方法返回CompletableFuture实例，您可以使用该实例在流程终止时安排任务。另外，如果您希望应用程序等待进程终止，则可以调用onExit（）。get（）。">使用onExit方法终止过程时的处理</a></p>
                     </li>
                     <li>
                        <p><a href="process-api1.html#GUID-FB7E1852-6C0F-4681-8B35-E2F1ABF483D5" title="进程信息可能包含敏感信息，例如用户ID，路径和命令参数。使用安全管理器控制对过程信息的访问。">控制对敏感过程信息的访问</a></p>
                     </li>
                  </ul>
               </div>
               <!-- class="section" -->
            </div>
            <div class="sect2"><a id="GUID-ED9190A3-FE19-474F-8F85-36819B665130" name="GUID-ED9190A3-FE19-474F-8F85-36819B665130"></a><h3 id="JSCOR-GUID-ED9190A3-FE19-474F-8F85-36819B665130" class="sect3">流程API类和接口</h3>
               <div>
                  <p>Process API由类和接口组成<code class="codeph">ProcessBuilder</code> ， <code class="codeph">Process</code> ， <code class="codeph">ProcessHandle</code>和<code class="codeph">ProcessHandle.Info</code> 。
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-ED9190A3-FE19-474F-8F85-36819B665130__GUID-EDCA9649-3C25-4B7B-B842-0570832FD0EC">话题</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p><a href="process-api1.html#GUID-0E93BAEE-8EA9-4D30-8204-AFD5AEA1EA04" title="ProcessBuilder类使您可以创建和启动操作系统进程。">ProcessBuilder类</a></p>
                        </li>
                        <li>
                           <p><a href="process-api1.html#GUID-723DF356-3387-422C-A9B4-49A17ACE1AEB" title="通过Process类中的方法，您可以控制由ProcessBuilder.start和Runtime.exec方法启动的进程。下表总结了这些方法：">工艺类别</a></p>
                        </li>
                        <li>
                           <p><a href="process-api1.html#GUID-2768CADC-6BAA-44CD-80D0-17B5E4DB9679" title="ProcessHandle界面使您可以识别和控制本机进程。Process类与ProcessHandle不同，因为它使您可以控制仅由ProcessBuilder.start和Runtime.exec方法启动的进程。但是，使用Process类可以访问流程的输入，输出和错误流。">ProcessHandle界面</a></p>
                        </li>
                        <li>
                           <p><a href="process-api1.html#GUID-294DB006-BD75-4B49-995E-D62693A29E69" title="ProcessHandle。信息界面使您可以检索有关流程的信息，包括由ProcessBuilder.start方法创建的流程和本机流程。">ProcessHandle。信息界面</a></p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
               <div class="sect3"><a id="GUID-0E93BAEE-8EA9-4D30-8204-AFD5AEA1EA04" name="GUID-0E93BAEE-8EA9-4D30-8204-AFD5AEA1EA04"></a><h4 id="JSCOR-GUID-0E93BAEE-8EA9-4D30-8204-AFD5AEA1EA04" class="sect4">ProcessBuilder类</h4>
                  <div>
                     <p><span class="apiname">ProcessBuilder</span>类使您可以创建和启动操作系统进程。
                     </p>
                     <p>有关如何创建和启动<a href="process-api1.html#GUID-81804DFA-D47A-4874-AF73-528365FEC711" title="To create a process, first specify the attributes of the process, such as the command name and its arguments, with the ProcessBuilder class. Then, start the process with the ProcessBuilder.start method, which returns a Process instance.">过程</a>的示例，请参见<a href="process-api1.html#GUID-81804DFA-D47A-4874-AF73-528365FEC711" title="要创建流程，请首先使用ProcessBuilder类指定流程的属性，例如命令名称及其参数。然后，使用ProcessBuilder.start方法启动该过程，该方法返回一个Process实例。">创建</a>过程。<a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessBuilder.html" target="_blank"><span class="apiname">ProcessBuilder</span></a>类管理各种流程属性，下表总结了这些属性：</p>
                     <div class="tblformal" id="GUID-0E93BAEE-8EA9-4D30-8204-AFD5AEA1EA04__GUID-8F012C7B-F54C-4FD9-B152-C86887FF07D7">
                        <p class="titleintable">表6-1 ProcessBuilder类的属性和相关方法</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="ProcessBuilder类属性和相关方法" border="1" summary="ProcessBuilder Class attributes and related methods" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" id="d5320e294">流程属性</th>
                                 <th align="left" valign="bottom" id="d5320e296">描述</th>
                                 <th align="left" valign="bottom" id="d5320e298">相关方法</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e302" headers="d5320e294 ">命令</td>
                                 <td align="left" valign="top" headers="d5320e302 d5320e296 ">指定要调用的外部程序文件及其参数（如果有）的字符串。</td>
                                 <td align="left" valign="top" headers="d5320e302 d5320e298 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessBuilder.html#ProcessBuilder-java.lang.String...-" target="_blank"><span class="apiname">ProcessBuilder</span></a>构造函数</p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessBuilder.html#command-java.lang.String...-" target="_blank"><span class="apiname">命令（字符串...命令）</span></a></p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e322" headers="d5320e294 ">环境</td>
                                 <td align="left" valign="top" headers="d5320e322 d5320e296 ">环境变量（及其值）。最初，它是当前进程的系统环境的副本。</td>
                                 <td align="left" valign="top" headers="d5320e322 d5320e298 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessBuilder.html#environment--" target="_blank"><span class="apiname">环境</span></a></p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e335" headers="d5320e294 ">工作目录</td>
                                 <td align="left" valign="top" headers="d5320e335 d5320e296 ">默认情况下，当前进程的当前工作目录。</td>
                                 <td align="left" valign="top" headers="d5320e335 d5320e298 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessBuilder.html#directory--" target="_blank"><span class="apiname">目录（）</span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessBuilder.html#directory-java.io.File-" target="_blank"><span class="apiname">目录（文件目录）</span></a></p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e354" headers="d5320e294 ">标准输入源</td>
                                 <td align="left" valign="top" headers="d5320e354 d5320e296 ">默认情况下，进程从管道读取标准输入。通过<a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html#getOutputStream--" target="_blank"><span class="apiname">Process.getOutputStream</span></a>方法返回的输出流访问它。
                                 </td>
                                 <td align="left" valign="top" headers="d5320e354 d5320e298 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessBuilder.html#redirectInput-java.lang.ProcessBuilder.Redirect-" target="_blank"><span class="apiname">redirectInput（ProcessBuilder。重定向源）</span></a></p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e372" headers="d5320e294 ">标准输出和标准错误目标</td>
                                 <td align="left" valign="top" headers="d5320e372 d5320e296 ">默认情况下，进程将标准输出和标准错误写入管道。通过<a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html#getInputStream--" target="_blank"><span class="apiname">Process.getInputStream</span></a>和<a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html#getErrorStream--" target="_blank"><span class="apiname">Process.getErrorStream</span></a>方法返回的输入流访问它们。有关示例，请参见<a href="process-api1.html#GUID-472F9FE1-DA6E-4A72-A19F-6EDF059B37B7" title="默认情况下，进程将标准输出和标准错误写入管道。在您的应用程序中，您可以通过Process.getOutputStream和Process.getErrorStream方法返回的输入流访问这些管道。但是，在开始该过程之前，您可以使用redirectOutput和redirectError方法将标准输出和标准错误重定向到其他目标，例如文件。">从流程重定向输出</a> 。
                                 </td>
                                 <td align="left" valign="top" headers="d5320e372 d5320e298 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessBuilder.html#redirectOutput-java.lang.ProcessBuilder.Redirect-" target="_blank"><span class="apiname">redirectOutput（ProcessBuilder。重定向目标）</span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessBuilder.html#redirectError-java.lang.ProcessBuilder.Redirect-" target="_blank"><span class="apiname">redirectError（ProcessBuilder。重定向目标）</span></a></p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e419" headers="d5320e294 "><span class="apiname">redirectErrorStream</span>属性</td>
                                 <td align="left" valign="top" headers="d5320e419 d5320e296 ">指定是将标准输出和错误输出作为两个单独的流（值为false）发送还是将任何错误输出与标准输出（值为true）合并。</td>
                                 <td align="left" valign="top" headers="d5320e419 d5320e298 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessBuilder.html#redirectErrorStream--" target="_blank"><span class="apiname">redirectErrorStream（）</span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessBuilder.html#redirectErrorStream-boolean-" target="_blank"><span class="apiname">redirectErrorStream（boolean redirectErrorStream）</span></a></p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-723DF356-3387-422C-A9B4-49A17ACE1AEB" name="GUID-723DF356-3387-422C-A9B4-49A17ACE1AEB"></a><h4 id="JSCOR-GUID-723DF356-3387-422C-A9B4-49A17ACE1AEB" class="sect4">工艺类别</h4>
                  <div>
                     <p>通过<span class="apiname">Process</span>类中的方法，您可以控制由<span class="apiname">ProcessBuilder.start</span>和<span class="apiname">Runtime.exec</span>方法启动的进程。下表总结了这些方法：</p>
                     <p>下表总结了<a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html" target="_blank"><span class="apiname">Process</span></a>类的方法。
                     </p>
                     <div class="tblformal" id="GUID-723DF356-3387-422C-A9B4-49A17ACE1AEB__GUID-83473CE6-CB7E-43B5-9EF6-AA9AD495CA47">
                        <p class="titleintable">表6-2流程类方法</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="流程类方法" border="1" summary="Process Class methods" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" id="d5320e474">方法类型</th>
                                 <th align="left" valign="bottom" id="d5320e476">相关方法</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e480" headers="d5320e474 ">等待过程完成。</td>
                                 <td align="left" valign="top" headers="d5320e480 d5320e476 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html#waitFor--" target="_blank"><span class="apiname">等待（）</span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html#waitFor-long-java.util.concurrent.TimeUnit-" target="_blank"><span class="apiname">waitFor（长时间超时，TimeUnit单位）</span></a></p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e497" headers="d5320e474 ">检索有关该过程的信息。</td>
                                 <td align="left" valign="top" headers="d5320e497 d5320e476 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html#isAlive--" target="_blank"><span class="apiname">isAlive（）</span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html#pid--" target="_blank"><span class="apiname">pid（）</span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html#info--" target="_blank"><span class="apiname">信息（）</span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html#exitValue--" target="_blank"><span class="apiname">exitValue（）</span></a></p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e526" headers="d5320e474 ">检索输入，输出和错误流。有关示例，请参见<a href="process-api1.html#GUID-A6A4B56A-7F3F-4ACD-930A-4E4AA3A930E7" title="Process.onExit和ProcessHandle.onExit方法返回CompletableFuture实例，您可以使用该实例在流程终止时安排任务。另外，如果您希望应用程序等待进程终止，则可以调用onExit（）。get（）。">使用onExit方法终止处理过程</a> 。
                                 </td>
                                 <td align="left" valign="top" headers="d5320e526 d5320e476 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html#getInputStream--" target="_blank"><span class="apiname">getInputStream（）</span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html#getOutputStream--" target="_blank"><span class="apiname">getOutputStream（）</span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html#getErrorStream--" target="_blank"><span class="apiname">getErrorStream（）</span></a></p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e567" headers="d5320e474 ">检索直接和间接子进程。</td>
                                 <td align="left" valign="top" headers="d5320e567 d5320e476 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html#children--" target="_blank"><span class="apiname">儿童（）</span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html#descendants--" target="_blank"><span class="apiname">后裔（）</span></a></p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e584" headers="d5320e474 ">销毁或终止该过程。</td>
                                 <td align="left" valign="top" headers="d5320e584 d5320e476 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html#destroy--" target="_blank"><span class="apiname">破坏（）</span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html#destroyForcibly--" target="_blank"><span class="apiname">destroyForcfully（）</span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html#supportsNormalTermination--" target="_blank"><span class="apiname">supportNormalTermination（）</span></a></p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e607" headers="d5320e474 ">返回一个<a href="https://docs.oracle.com/javase/10/docs/api/java/util/concurrent/CompletableFuture.html" target="_blank"><span class="apiname">CompletableFuture</span></a>实例，该实例将在流程退出时完成。有关示例，请参见<a href="process-api1.html#GUID-A6A4B56A-7F3F-4ACD-930A-4E4AA3A930E7" title="Process.onExit和ProcessHandle.onExit方法返回CompletableFuture实例，您可以使用该实例在流程终止时安排任务。另外，如果您希望应用程序等待进程终止，则可以调用onExit（）。get（）。">使用onExit方法终止处理过程</a> 。
                                 </td>
                                 <td align="left" valign="top" headers="d5320e607 d5320e476 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/Process.html#onExit--" target="_blank"><span class="apiname">onExit（）</span></a></p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-2768CADC-6BAA-44CD-80D0-17B5E4DB9679" name="GUID-2768CADC-6BAA-44CD-80D0-17B5E4DB9679"></a><h4 id="JSCOR-GUID-2768CADC-6BAA-44CD-80D0-17B5E4DB9679" class="sect4">ProcessHandle界面</h4>
                  <div>
                     <p><span class="apiname">ProcessHandle</span>界面使您可以识别和控制本机进程。<span class="apiname">Process</span>类不同于<span class="apiname">ProcessHandle，</span>因为它使您可以控制仅由<span class="apiname">ProcessBuilder.start</span>和<span class="apiname">Runtime.exec</span>方法启动的进程；但是，使用<span class="apiname">Process</span>类可以访问流程的输入，输出和错误流。
                     </p>
                     <p>有关<a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.html" target="_blank"><span class="apiname">ProcessHandle</span></a>接口的示例，请参见<a href="process-api1.html#GUID-2A7BD6A9-7EE6-4050-A08A-BD7731BE2623" title="方法ProcessHandle.allProcesses返回当前进程可见的所有进程的流。您可以使用与过滤集合中的元素相同的方式来过滤此流的ProcessHandle实例。">使用流过滤流程</a> 。下表总结了此接口的方法：</p>
                     <div class="tblformal" id="GUID-2768CADC-6BAA-44CD-80D0-17B5E4DB9679__GUID-512F0A47-3566-441A-AAD0-F424CE378C63">
                        <p class="titleintable">表6-3 ProcessHandle接口方法</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="ProcessHandle接口方法" border="1" summary="ProcessHandle interface methods" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" id="d5320e698">方法类型</th>
                                 <th align="left" valign="bottom" id="d5320e700">相关方法</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e704" headers="d5320e698 ">检索所有操作系统进程。</td>
                                 <td align="left" valign="top" headers="d5320e704 d5320e700 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.html#allProcesses--" target="_blank"><span class="apiname">allProcesses（）</span></a></p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e715" headers="d5320e698 ">检索过程句柄。</td>
                                 <td align="left" valign="top" headers="d5320e715 d5320e700 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.html#current--" target="_blank"><span class="apiname">当前（）</span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.html#of-long-" target="_blank"><span class="apiname">的（long pid）</span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.html#parent--" target="_blank"><span class="apiname">parent（）</span></a></p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e738" headers="d5320e698 ">检索有关该过程的信息。</td>
                                 <td align="left" valign="top" headers="d5320e738 d5320e700 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.html#isAlive--" target="_blank"><span class="apiname">活着（）</span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.html#pid--" target="_blank"><span class="apiname">pid（）</span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.html#info--" target="_blank"><span class="apiname">信息（）</span></a></p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e761" headers="d5320e698 ">检索直接和间接子进程的流。</td>
                                 <td align="left" valign="top" headers="d5320e761 d5320e700 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.html#children--" target="_blank"><span class="apiname">儿童（）</span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.html#descendants--" target="_blank"><span class="apiname">后裔（）</span></a></p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e778" headers="d5320e698 ">销毁流程。</td>
                                 <td align="left" valign="top" headers="d5320e778 d5320e700 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.html#destroy--" target="_blank"><span class="apiname">破坏（）</span></a></p>
                                       </li>
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.html#destroyForcibly--" target="_blank"><span class="apiname">destroyForcfully（）</span></a></p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e795" headers="d5320e698 ">返回一个<a href="https://docs.oracle.com/javase/10/docs/api/java/util/concurrent/CompletableFuture.html" target="_blank"><span class="apiname">CompletableFuture</span></a>实例，该实例将在流程退出时完成。有关示例，请参见<a href="process-api1.html#GUID-A6A4B56A-7F3F-4ACD-930A-4E4AA3A930E7" title="Process.onExit和ProcessHandle.onExit方法返回CompletableFuture实例，您可以使用该实例在流程终止时安排任务。另外，如果您希望应用程序等待进程终止，则可以调用onExit（）。get（）。">使用onExit方法终止处理过程</a> 。
                                 </td>
                                 <td align="left" valign="top" headers="d5320e795 d5320e700 ">
                                    <ul style="list-style-type:disc">
                                       <li>
                                          <p><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.html#onExit--" target="_blank"><span class="apiname">onExit（）</span></a></p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-294DB006-BD75-4B49-995E-D62693A29E69" name="GUID-294DB006-BD75-4B49-995E-D62693A29E69"></a><h4 id="JSCOR-GUID-294DB006-BD75-4B49-995E-D62693A29E69" class="sect4">ProcessHandle。信息界面</h4>
                  <div>
                     <p><span class="apiname">ProcessHandle。信息</span>界面使您可以检索有关流程的信息，包括由<span class="apiname">ProcessBuilder.start</span>方法创建的流程和本机流程。
                     </p>
                     <p>有关<a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.Info.html" target="_blank"><span class="apiname">ProcessHandle的示例，请参见</span></a><a href="process-api1.html#GUID-30EA2C53-C6BA-422F-9F04-2660525B7F3D" title="The method Process.pid returns the native process ID of the process. The method Process.info returns a ProcessHandle.Info instance, which contains additional information about the process, such as its executable path name, start time, and user.">获取</a>有关<a href="process-api1.html#GUID-30EA2C53-C6BA-422F-9F04-2660525B7F3D" title="方法Process.pid返回该进程的本机进程ID。方法Process.info返回一个ProcessHandle。信息实例，其中包含有关该进程的其他信息，例如其可执行路径名称，开始时间和用户。">流程的信息</a> <a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.Info.html" target="_blank"><span class="apiname">。信息</span></a>界面。下表总结了此界面中的方法：</p>
                     <div class="tblformal" id="GUID-294DB006-BD75-4B49-995E-D62693A29E69__GUID-B89F7124-187D-43DC-B27B-64A4C8D09D9E">
                        <p class="titleintable">表6-4 ProcessHandle。信息界面方法</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="ProcessHandle。信息界面方法" border="1" summary="ProcessHandle.Info interface methods" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" id="d5320e875">方法</th>
                                 <th align="left" valign="bottom" id="d5320e877">描述</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e881" headers="d5320e875 "><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.Info.html#arguments--" target="_blank"><span class="apiname">arguments（）</span></a></td>
                                 <td align="left" valign="top" headers="d5320e881 d5320e877 ">以<span class="apiname">String</span>数组形式返回进程的参数。
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e892" headers="d5320e875 "><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.Info.html#command--" target="_blank"><span class="apiname">命令（）</span></a></td>
                                 <td align="left" valign="top" headers="d5320e892 d5320e877 ">返回进程的可执行路径名。</td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e900" headers="d5320e875 "><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.Info.html#commandLine--" target="_blank"><span class="apiname">命令行（）</span></a></td>
                                 <td align="left" valign="top" headers="d5320e900 d5320e877 ">返回进程的命令行。</td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e908" headers="d5320e875 "><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.Info.html#startInstant--" target="_blank"><span class="apiname">startInstant（）</span></a></td>
                                 <td align="left" valign="top" headers="d5320e908 d5320e877 ">返回进程的开始时间。</td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e916" headers="d5320e875 "><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.Info.html#totalCpuDuration--" target="_blank"><span class="apiname">totalCpuDuration（）</span></a></td>
                                 <td align="left" valign="top" headers="d5320e916 d5320e877 ">返回该进程累计的CPU总时间。</td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d5320e924" headers="d5320e875 "><a href="https://docs.oracle.com/javase/10/docs/api/java/lang/ProcessHandle.Info.html#user--" target="_blank"><span class="apiname">用户（）</span></a></td>
                                 <td align="left" valign="top" headers="d5320e924 d5320e877 ">返回流程的用户。</td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-81804DFA-D47A-4874-AF73-528365FEC711" name="GUID-81804DFA-D47A-4874-AF73-528365FEC711"></a><h3 id="JSCOR-GUID-81804DFA-D47A-4874-AF73-528365FEC711" class="sect3">创建过程</h3>
               <div>
                  <p>要创建流程，请首先使用<span class="apiname">ProcessBuilder</span>类指定流程的属性，例如命令名称及其参数。然后，使用<span class="apiname">ProcessBuilder.start</span>方法启动该过程，该方法返回一个<span class="apiname">Process</span>实例。
                  </p>
                  <p>以下几行创建并开始一个过程：</p><pre class="pre codeblock"><code>  ProcessBuilder pb = new ProcessBuilder("echo", "Hello World!");
  Process p = pb.start();</code></pre><p>在以下摘录中， <code class="codeph">setEnvTest</code>方法设置两个环境变量， <code class="codeph">horse</code>和<code class="codeph">oats</code> ，然后输出这些环境变量的值（以及系统环境变量<code class="codeph">HOME</code> ）与<code class="codeph">echo</code>命令：</p><pre class="pre codeblock"><code>  public static void setEnvTest() throws IOException, InterruptedException {
    ProcessBuilder pb =
      new ProcessBuilder("/bin/sh", "-c", "echo $horse $dog $HOME").inheritIO();
    pb.environment().put("horse", "oats");
    pb.environment().put("dog", "treats");
    pb.start().waitFor();
  }</code></pre><p>此方法将打印以下内容（假设您的主目录为<code class="codeph">/home/admin</code> ）：</p><pre class="pre codeblock"><code>oats treats /home/admin</code></pre></div>
            </div>
            <div class="sect2"><a id="GUID-30EA2C53-C6BA-422F-9F04-2660525B7F3D" name="GUID-30EA2C53-C6BA-422F-9F04-2660525B7F3D"></a><h3 id="JSCOR-GUID-30EA2C53-C6BA-422F-9F04-2660525B7F3D" class="sect3">获取有关流程的信息</h3>
               <div>
                  <p>方法<span class="apiname">Process.pid</span>返回该进程的本机进程ID。方法<span class="apiname">Process.info</span>返回一个<span class="apiname">ProcessHandle。信息</span>实例，其中包含有关该进程的其他信息，例如其可执行路径名称，开始时间和用户。
                  </p>
                  <p>在下面的摘录中，方法<code class="codeph">getInfoTest</code>开始一个过程，然后打印有关它的信息：</p><pre class="pre codeblock"><code>  public static void getInfoTest() throws IOException {
    ProcessBuilder pb = new ProcessBuilder("echo", "Hello World!");
    String na = "&lt;not available&gt;";
    Process p = pb.start();
    ProcessHandle.Info info = p.info();
    System.out.printf("Process ID: %s%n", p.pid());
    System.out.printf("Command name: %s%n", info.command().orElse(na));
    System.out.printf("Command line: %s%n", info.commandLine().orElse(na));
    
    System.out.printf("Start time: %s%n",
      info.startInstant().map(i -&gt; i.atZone(ZoneId.systemDefault())
                                    .toLocalDateTime().toString())
                         .orElse(na));
    
    System.out.printf("Arguments: %s%n",
      info.arguments().map(a -&gt; Stream.of(a)
                                      .collect(Collectors.joining(" ")))
                      .orElse(na));
  
    System.out.printf("User: %s%n", info.user().orElse(na));
  }</code></pre><p>此方法打印输出类似于以下内容：</p><pre class="pre codeblock"><code>Process ID: 18761
Command name: /usr/bin/echo
Command line: echo Hello World!
Start time: 2017-05-30T18:52:15.577
Arguments: &lt;not available&gt;
User: administrator</code></pre><div class="infoboxnote" id="GUID-30EA2C53-C6BA-422F-9F04-2660525B7F3D__GUID-C7A729B4-4A41-4D0B-A36F-1B9923B09C5C">
                     <p class="notep1">注意：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>进程的属性因操作系统而异，并非在所有实现中都可用。另外，有关进程的信息受发出请求的进程的操作系统特权的限制。</p>
                        </li>
                        <li>
                           <p>接口<span class="apiname">ProcessHandle中的所有方法<span class="apiname">。<span class="apiname">可选的</span> 信息</span>返回实例<span class="apiname"><t></t></span> ;始终检查返回的值是否为空。
                           </span></p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-472F9FE1-DA6E-4A72-A19F-6EDF059B37B7" name="GUID-472F9FE1-DA6E-4A72-A19F-6EDF059B37B7"></a><h3 id="JSCOR-GUID-472F9FE1-DA6E-4A72-A19F-6EDF059B37B7" class="sect3">从流程重定向输出</h3>
               <div>
                  <p>默认情况下，进程将标准输出和标准错误写入管道。在您的应用程序中，您可以通过<span class="apiname">Process.getOutputStream</span>和<span class="apiname">Process.getErrorStream</span>方法<span class="apiname">返回</span>的输入流访问这些管道。但是，在开始该过程之前，您可以使用以下方法将标准输出和标准错误重定向到其他目标，例如文件<code class="codeph">redirectOutput</code>和<code class="codeph">redirectError</code> 。
                  </p>
                  <p>在下面的摘录中，方法<code class="codeph">redirectToFileTest</code>将标准输入重定向到文件， <code>out.tmp</code> ，然后打印此文件：</p><pre class="pre codeblock"><code>  public static void redirectToFileTest() throws IOException, InterruptedException {
    File outFile = new File("out.tmp");
    Process p = new ProcessBuilder("ls", "-la")
      .redirectOutput(outFile)
      .redirectError(Redirect.INHERIT)
      .start();
    int status = p.waitFor();
    if (status == 0) {
      p = new ProcessBuilder("cat" , outFile.toString())
        .inheritIO()
        .start();
      p.waitFor();
    }
  }</code></pre><p>摘录将标准输出重定向到文件<code>out.tmp</code> 。它将标准错误重定向到调用过程的标准错误。值<span class="apiname">重定向。INHERIT</span>指定子进程的I / O源或目标与当前进程的I / O相同。对<span class="apiname">InheritIO（）</span>方法的调用等效于<span class="apiname">redirectInput（Redirect。INHERIT）.redirectOuput（重定向INHERIT）.redirectError（重定向。继承）</span> 。
                  </p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-2A7BD6A9-7EE6-4050-A08A-BD7731BE2623" name="GUID-2A7BD6A9-7EE6-4050-A08A-BD7731BE2623"></a><h3 id="JSCOR-GUID-2A7BD6A9-7EE6-4050-A08A-BD7731BE2623" class="sect3">使用流过滤流程</h3>
               <div>
                  <p>方法<span class="apiname">ProcessHandle.allProcesses</span>返回当前进程可见的所有进程的流。您可以使用与过滤集合中的元素相同的方式来过滤此流的<span class="apiname">ProcessHandle</span>实例。
                  </p>
                  <p>在下面的摘录中，方法<code class="codeph">filterProcessesTest</code>打印有关当前用户拥有的所有进程的信息，并按其父进程的进程ID进行排序：</p><pre class="pre codeblock"><code>public class ProcessTest {

  // ...

  static void filterProcessesTest() {
    Optional&lt;String&gt; currUser = ProcessHandle.current().info().user();
    ProcessHandle.allProcesses()
        .filter(p1 -&gt; p1.info().user().equals(currUser))
        .sorted(ProcessTest::parentComparator)
        .forEach(ProcessTest::showProcess);
  }

  static int parentComparator(ProcessHandle p1, ProcessHandle p2) {
    long pid1 = p1.parent().map(ph -&gt; ph.pid()).orElse(-1L);
    long pid2 = p2.parent().map(ph -&gt; ph.pid()).orElse(-1L);
    return Long.compare(pid1, pid2);
  }

  static void showProcess(ProcessHandle ph) {
    ProcessHandle.Info info = ph.info();
    System.out.printf("pid: %d, user: %s, cmd: %s%n",
      ph.pid(), info.user().orElse("none"), info.command().orElse("none"));
  } 

  // ...
}</code></pre><p>请注意， <span class="apiname">allProcesses</span>方法受本机操作系统访问控制的限制。同样，由于所有进程都是异步创建和终止的，因此无法保证流中的某个进程处于活动状态，或者自从调用<span class="apiname">allProcesses</span>方法以来，没有其他进程可以创建。
                  </p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-A6A4B56A-7F3F-4ACD-930A-4E4AA3A930E7" name="GUID-A6A4B56A-7F3F-4ACD-930A-4E4AA3A930E7"></a><h3 id="JSCOR-GUID-A6A4B56A-7F3F-4ACD-930A-4E4AA3A930E7" class="sect3">使用onExit方法终止过程时的处理</h3>
               <div>
                  <p><span class="apiname">Process.onExit</span>和<span class="apiname">ProcessHandle.onExit</span>方法返回<span class="apiname">CompletableFuture</span>实例，您可以使用该实例在流程终止时安排任务。另外，如果您希望应用程序等待进程终止，则可以调用<span class="apiname">onExit（）。get（）</span> 。
                  </p>
                  <p>在下面的摘录中，方法<code class="codeph">startProcessesTest</code>创建三个进程，然后启动它们。之后，它调用<code class="codeph">onExit().thenAccept(onExitMethod)</code>在每个过程中； <code class="codeph">onExitMethod</code>打印流程ID（PID），退出状态和流程输出。
                  </p><pre class="pre codeblock"><code>public class ProcessTest {

  // ...

  static public void startProcessesTest() throws IOException, InterruptedException {
    List&lt;ProcessBuilder&gt; greps = new ArrayList&lt;&gt;();
    greps.add(new ProcessBuilder("/bin/sh", "-c", "grep -c \"java\" *"));
    greps.add(new ProcessBuilder("/bin/sh", "-c", "grep -c \"Process\" *"));
    greps.add(new ProcessBuilder("/bin/sh", "-c", "grep -c \"onExit\" *"));
    ProcessTest.startSeveralProcesses (greps, ProcessTest::printGrepResults);      
    System.out.println("\nPress enter to continue ...\n");
    System.in.read();  
  }

  static void startSeveralProcesses (
    List&lt;ProcessBuilder&gt; pBList,
    Consumer&lt;Process&gt; onExitMethod)
    throws InterruptedException {
    System.out.println("Number of processes: " + pBList.size());
    pBList.stream().forEach(
      pb -&gt; {
        try {
          Process p = pb.start();
          System.out.printf("Start %d, %s%n",
            p.pid(), p.info().commandLine().orElse("&lt;na&gt;"));
          p.onExit().thenAccept(onExitMethod);
        } catch (IOException e) {
          System.err.println("Exception caught");
          e.printStackTrace();
        }
      }
    );
  }
  
  static void printGrepResults(Process p) {
    System.out.printf("Exit %d, status %d%n%s%n%n",
      p.pid(), p.exitValue(), output(p.getInputStream()));
  }

  private static String output(InputStream inputStream) {
    String s = "";
    try (BufferedReader br = new BufferedReader(new InputStreamReader(inputStream))) {
      s = br.lines().collect(Collectors.joining(System.getProperty("line.separator")));
    } catch (IOException e) {
      System.err.println("Caught IOException");
      e.printStackTrace();
    }
    return s;
  }

  // ...
}</code></pre><p>方法的输出<code class="codeph">startProcessesTest</code>与以下类似。请注意，进程可能以与启动顺序不同的顺序退出。
                  </p><pre class="pre codeblock"><code>Number of processes: 3
Start 12401, /bin/sh -c grep -c "java" *
Start 12403, /bin/sh -c grep -c "Process" *
Start 12404, /bin/sh -c grep -c "onExit" *

Press enter to continue ...

Exit 12401, status 0
ProcessTest.class:0
ProcessTest.java:16

Exit 12404, status 0
ProcessTest.class:0
ProcessTest.java:8

Exit 12403, status 0
ProcessTest.class:0
ProcessTest.java:38</code></pre><p>此方法调用<span class="apiname">System.in.read（）</span>方法以防止程序在所有进程退出（并运行<span class="apiname">thenAccept</span>方法指定的方法）之前终止。
                  </p>
                  <p>如果要在继续执行程序的其余部分之前等待进程终止，请调用<code class="codeph">onExit().get()</code> ：</p><pre class="pre codeblock"><code>  static void startSeveralProcesses (
    List&lt;ProcessBuilder&gt; pBList, Consumer&lt;Process&gt; onExitMethod)
    throws InterruptedException {
    System.out.println("Number of processes: " + pBList.size());
    pBList.stream().forEach(
      pb -&gt; {
        try {
          Process p = pb.start();
          System.out.printf("Start %d, %s%n",
            p.pid(), p.info().commandLine().orElse("&lt;na&gt;"));
          <span class="bold">p.onExit().get();</span>
          <span class="bold">printGrepResults(p);</span>          
        } catch (IOException<span class="bold">|InterruptedException|ExecutionException</span> e ) {
          System.err.println("Exception caught");
          e.printStackTrace();
        }
      }
    );
  }</code></pre><p>的<code class="codeph">ComputableFuture</code>该类包含多种方法，您可以在流程退出时调用这些方法来安排任务，包括：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><span class="apiname">thenApply</span> ：类似于<span class="apiname">thenAccept</span> ，不同之处在于它采用<span class="apiname">函数</span>类型的lambda表达式（返回值的lambda表达式）。
                        </p>
                     </li>
                     <li>
                        <p><span class="apiname">thenRun</span> ：采用<span class="apiname">Runnable</span>类型的lambda表达式（无形式参数或返回值）。
                        </p>
                     </li>
                     <li>
                        <p><span class="apiname">thenApplyAsyc</span> ：从以下线程运行指定的<span class="apiname">函数</span> <code class="codeph">ForkJoinPool.commonPool()</code> 。
                        </p>
                     </li>
                  </ul>
                  <p>因为<code class="codeph">ComputableFuture</code>实现<code class="codeph">Future</code>接口，此类还包含同步方法：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><span class="apiname">get（长超时，TimeUnit单位）</span> ：如有必要，最多等待其参数指定的时间以完成过程。
                        </p>
                     </li>
                     <li>
                        <p><span class="apiname">isDone</span> ：如果过程完成，则返回true。
                        </p>
                     </li>
                  </ul>
               </div>
            </div>
            <div class="sect2"><a id="GUID-FB7E1852-6C0F-4681-8B35-E2F1ABF483D5" name="GUID-FB7E1852-6C0F-4681-8B35-E2F1ABF483D5"></a><h3 id="JSCOR-GUID-FB7E1852-6C0F-4681-8B35-E2F1ABF483D5" class="sect3">控制对敏感过程信息的访问</h3>
               <div>
                  <p>进程信息可能包含敏感信息，例如用户ID，路径和命令参数。使用安全管理器控制对过程信息的访问。</p>
                  <p>当以普通应用程序运行时， <code class="codeph">ProcessHandle</code>与本机应用程序一样，对其他进程的信息具有相同的操作系统特权；但是，有关系统进程的信息可能不可用。
                  </p>
                  <p>如果您的应用程序使用<span class="apiname">SecurityManager</span>类实现安全策略， <span class="apiname">则要</span>使其能够访问进程信息，该安全策略必须授予<span class="apiname">RuntimePermission（“ manageProcess”）</span> 。该权限允许本机进程终止并访问进程<span class="apiname">ProcessHandle</span>信息。请注意，此权限使代码可以识别和终止未创建的进程。
                  </p>
               </div>
            </div>
         </div>
      </article>
   

</body></html>