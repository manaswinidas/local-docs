<html lang="en-us"  xml:lang="en-us"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="This section covers other situations that affect garbage collection.">
      <meta name="description" content="This section covers other situations that affect garbage collection.">
      <title>其他注意事项</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="HotSpot Virtual Machine Garbage Collection Tuning Guide">
      <meta property="og:description" content="This section covers other situations that affect garbage collection.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="HotSpot Virtual Machine Garbage Collection Tuning Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="hotspot-virtual-machine-garbage-collection-tuning-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-21T11:00:40-07:00">
      <meta name="dcterms.title" content="HotSpot Virtual Machine Garbage Collection Tuning Guide">
      <meta name="dcterms.dateCopyrighted" content="2015, 2018">
      <meta name="dcterms.category" content="java">
      <meta name="dcterms.identifier" content="E95201-01">
      
      <meta name="dcterms.product" content="en/java/javase/11">
      <meta name="dcterms.release" content="11">
      <link rel="prev" href="z-garbage-collector1.html" title="Previous" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"java","element_name":"Java","display_in_url":true},"suite":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product_group":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product":{"short_name":"javase","element_name":"Java SE","display_in_url":true},"release":{"short_name":"11","element_name":"11","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="GCTUNING">
  <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
   <body >
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="z-garbage-collector1.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一个</a> <a href="#" class="pull-right">下一个<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">HotSpot虚拟机垃圾收集优化指南</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">其他注意事项</li>
            </ol>
            <a id="GUID-28448147-EC4C-4C94-9A54-54152AD21CB8" name="GUID-28448147-EC4C-4C94-9A54-54152AD21CB8"></a>
            
            <h2 id="JSGCT-GUID-28448147-EC4C-4C94-9A54-54152AD21CB8" class="sect2"><span class="enumeration_chapter">12</span>其他注意事项</h2>
         </header>
         <div class="ind">
            <div>
               <p>本节介绍影响垃圾收集的其他情况。</p>
               <div class="section">
                  <p class="subhead1" id="GUID-28448147-EC4C-4C94-9A54-54152AD21CB8__GUID-D489EDE9-8B03-4EDF-BCFB-0093F259CEF8">话题</p>
                  <ul style="list-style-type:disc">
                     <li><a href="other-considerations.html#GUID-A7B0991C-661F-47BE-AEDB-74C6BDBDE181" title="一些应用程序通过使用终结处理和弱引用，软引用或幻像引用与垃圾回收进行交互。">终结和弱引用，软引用和幻像引用</a></li>
                     <li><a href="other-considerations.html#GUID-9E3E5371-20F5-4B70-A003-9D7851B115AF" title="应用程序可以与垃圾回收进行交互的另一种方式是通过使用System.gc（）显式调用完整的垃圾回收。">显式垃圾回收</a></li>
                     <li><a href="other-considerations.html#GUID-BFB89453-60C0-42AC-81CA-87D59B0ACE2E" title="在服务器虚拟机中，软引用的生存期比在客户端中更长。">软参考</a></li>
                     <li><a href="other-considerations.html#GUID-B29C9153-3530-4C15-9154-E74F44E3DAD9" title="Java类在Java Hotspot VM中具有内部表示形式，被称为类元数据。">类元数据</a></li>
                  </ul>
               </div>
               <!-- class="section" -->
            </div>
            <div class="props_rev_3"><a id="GUID-A7B0991C-661F-47BE-AEDB-74C6BDBDE181" name="GUID-A7B0991C-661F-47BE-AEDB-74C6BDBDE181"></a><h3 id="JSGCT-GUID-A7B0991C-661F-47BE-AEDB-74C6BDBDE181" class="sect3">终结和弱引用，软引用和幻像引用</h3>
               <div>
                  <p>一些应用程序通过使用终结处理和弱引用，软引用或幻像引用与垃圾回收进行交互。</p>
                  <p>这些功能可以在Java编程语言级别上创建性能工件。这样的一个例子是依靠终结来关闭文件描述符，这使得外部资源（描述符）依赖于垃圾回收的及时性。依靠垃圾回收来管理内存以外的资源几乎总是一个坏主意。</p>
                  <p>请参阅“ <a href="http://www.devx.com/Java/Article/30192" target="_blank">如何处理Java</a>终结<a href="http://www.devx.com/Java/Article/30192" target="_blank">处理的内存保留问题”</a> ，其中深入讨论了终结处理的一些陷阱以及避免这些陷阱的技术。
                  </p>
               </div>
            </div>
            <div class="props_rev_3"><a id="GUID-9E3E5371-20F5-4B70-A003-9D7851B115AF" name="GUID-9E3E5371-20F5-4B70-A003-9D7851B115AF"></a><h3 id="JSGCT-GUID-9E3E5371-20F5-4B70-A003-9D7851B115AF" class="sect3">显式垃圾回收</h3>
               <div>
                  <p>应用程序可以与垃圾回收进行交互的另一种方式是通过使用显式调用完整的垃圾回收<code class="codeph">System.gc()</code> 。
                  </p>
                  <p>这可以强制在不需要时（例如，当次要收集就足够时）进行主要收集，因此通常应避免使用。可以通过使用标志禁用显式垃圾收集来评估它们的性能效果<code class="codeph">-XX:+DisableExplicitGC</code> ，导致VM忽略对的调用<code class="codeph">System.gc()</code> 。
                  </p>
                  <p>显式垃圾回收最常遇到的用途之一是远程方法调用（RMI）的分布式垃圾回收（DGC）。使用RMI的应用程序引用其他虚拟机中的对象。在不偶尔调用本地堆的垃圾收集的情况下，无法在这些分布式应用程序中收集垃圾，因此RMI会定期强制执行完整收集。可以使用属性控制这些收集的频率，如以下示例所示：</p><pre class="pre codeblock"><code>java -Dsun.rmi.dgc.client.gcInterval=3600000
    -Dsun.rmi.dgc.server.gcInterval=3600000 ...
</code></pre><p>本示例指定每小时一次的显式垃圾回收，而不是默认的每分钟一次的回收率。但是，这也可能导致某些对象需要更长的时间才能被回收。这些属性可以设置为<code class="codeph">Long.MAX_VALUE</code>如果不希望DGC活动的及时性达到上限，则可以有效地使显式集合之间的时间无限长。
                  </p>
               </div>
            </div>
            <div class="props_rev_3"><a id="GUID-BFB89453-60C0-42AC-81CA-87D59B0ACE2E" name="GUID-BFB89453-60C0-42AC-81CA-87D59B0ACE2E"></a><h3 id="JSGCT-GUID-BFB89453-60C0-42AC-81CA-87D59B0ACE2E" class="sect3">软参考</h3>
               <div>
                  <p>在服务器虚拟机中，软引用的生存期比在客户端中更长。</p>
                  <p>清除率可以通过命令行选项控制<code class="codeph">-XX:SoftRefLRUPolicyMSPerMB=</code><code class="codeph"><N></code> ，它指定了对于堆中每兆字节的可用空间，软引用将保持活动状态的毫秒数（一旦不再严格可达）。缺省值为每兆字节1000毫秒，这意味着对于堆中的每兆字节可用空间，软引用（在收集到对对象的最后一个强引用之后）将保留1秒钟。这是一个大概的数字，因为仅在垃圾收集期间才清除软引用，这可能会偶尔发生。
                  </p>
               </div>
            </div>
            <div class="props_rev_3"><a id="GUID-B29C9153-3530-4C15-9154-E74F44E3DAD9" name="GUID-B29C9153-3530-4C15-9154-E74F44E3DAD9"></a><h3 id="JSGCT-GUID-B29C9153-3530-4C15-9154-E74F44E3DAD9" class="sect3">类元数据</h3>
               <div>
                  <p>Java类在Java Hotspot VM中具有内部表示形式，被称为类元数据。</p>
                  <p>在Java Hotspot VM的先前发行版中，类元数据是在所谓的永久生成中分配的。从JDK 8开始，永久代被删除，并且类元数据分配在本机内存中。默认情况下，可用于类元数据的本地内存数量是无限的。使用选项<code class="codeph">-XX:MaxMetaspaceSize</code>对用于类元数据的本机内存量设置上限。
                  </p>
                  <p>Java Hotspot VM显式管理用于元数据的空间。从操作系统请求空间，然后将其分成多个块。类加载器从其块分配元数据空间（块绑定到特定的类加载器）。当为类加载器卸载类时，其块将被回收以重新使用或返回给OS。元数据使用分配的空间<code class="codeph">mmap</code> ，而不是<code class="codeph">malloc</code> 。
                  </p>
                  <p>如果<code class="codeph">-XX:UseCompressedOops</code>开启并<code class="codeph">-XX:UseCompressedClassesPointers</code>如果使用，则将本机内存的两个逻辑上不同的区域用于类元数据。 <code class="codeph">-XX:UseCompressedClassPointers</code>使用32位偏移量来表示64位进程中的类指针<code class="codeph">-XX:UseCompressedOops</code> Java对象引用。为这些压缩的类指针分配了一个区域（32位偏移量）。区域的大小可以用<code class="codeph">-XX:CompressedClassSpaceSize</code>并且默认为1 GB。压缩类指针的空间保留为<code class="codeph">-XX:mmap</code>在初始化并根据需要提交。的<code class="codeph">-XX:MaxMetaspaceSize</code>适用于已提交的压缩类空间和其他类元数据的空间的总和。
                  </p>
                  <p>当相应的Java类卸载时，类元数据将被释放。Java类是作为垃圾回收的结果而卸载的，垃圾回收可能会导致卸载类和取消分配类元数据。当用于类元数据的空间达到一定级别（高水位线）时，将引发垃圾回收。垃圾收集之后，高水位线可能会升高或降低，具体取决于类元数据释放的空间量。高水位线将被抬起，以免过早引起另一次垃圾收集。高水位线最初设置为命令行选项的值<code class="codeph">-XX:MetaspaceSize</code> 。根据选项升高或降低<code class="codeph">-XX:MaxMetaspaceFreeRatio</code>和<code class="codeph">-XX:MinMetaspaceFreeRatio</code> 。如果可用于类元数据的承诺空间占用于类元数据的总承诺空间的百分比大于<code class="codeph">-XX:MaxMetaspaceFreeRatio</code> ，则高水位线将降低。如果小于<code class="codeph">-XX:MinMetaspaceFreeRatio</code> ，则高水位线将升高。
                  </p>
                  <p>为选项指定更高的值<code class="codeph">-XX:MetaspaceSize</code>以避免为类元数据引入早期垃圾回收。为应用程序分配的类元数据的数量取决于应用程序，并且不存在用于选择以下内容的通用准则<code class="codeph">-XX:MetaspaceSize</code> 。默认大小<code class="codeph">-XX:MetaspaceSize</code>与平台有关，范围从12 MB到大约20 MB。</p>
                  <p>有关用于元数据的空间的信息包含在堆的打印输出中。以下是典型输出：</p><pre class="pre codeblock"><code>[0,296s][info][gc,heap,exit] Heap
[0,296s][info][gc,heap,exit] garbage-first heap total 514048K, used 0K [0x00000005ca600000, 0x00000005ca8007d8, 0x00000007c0000000)
[0,296s][info][gc,heap,exit] region size 2048K, 1 young (2048K), 0 survivors (0K)
[0,296s][info][gc,heap,exit] Metaspace used 2575K, capacity 4480K, committed 4480K, reserved 1056768K
[0,296s][info][gc,heap,exit] class space used 238K, capacity 384K, committed 384K, reserved 1048576K</code></pre><p>在以<code class="codeph">Metaspace</code> ， <code class="codeph">used</code> value是用于加载的类的空间量。的<code class="codeph">capacity</code> value是当前分配的块中可用于元数据的空间。的<code class="codeph">committed</code> value是可用于块的空间量。的<code class="codeph">reserved</code> value是为元数据保留（但不一定要提交）的空间量。开头的行<code class="codeph">class space</code>包含压缩类指针的元数据的相应值。
                  </p>
               </div>
            </div>
         </div>
      </article>
   

</body></html>