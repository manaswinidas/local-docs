<html lang="en-us"  xml:lang="en-us"><head></head><body >﻿
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>使用Java GSS-API和JAAS可以做的更多事情</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Security Developer’s Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Security Developer’s Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="security-developer-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-21T08:42:26-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="1993, 2018">
      <meta name="dcterms.category" content="java">
      <meta name="dcterms.identifier" content="E94828-01">
      
      <meta name="dcterms.product" content="en/java/javase/11">
      <meta name="dcterms.release" content="11">
      <link rel="prev" href="use-jaas-login-utility-and-java-gss-api-secure-message-exchanges.html" title="Previous" type="text/html">
      <link rel="next" href="kerberos-requirements.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"java","element_name":"Java","display_in_url":true},"suite":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product_group":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product":{"short_name":"javase","element_name":"Java SE","display_in_url":true},"release":{"short_name":"11","element_name":"11","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Security Developer Guide">
    <meta name="dcterms.isVersionOf" content="SECURITY">
  
                    <script>var w=window;if(w.performance||w.mozPerformance||w.msPerformance||w.webkitPerformance){var d=document;AKSB=w.AKSB||{},AKSB.q=AKSB.q||[],AKSB.mark=AKSB.mark||function(e,_){AKSB.q.push(["mark",e,_||(new Date).getTime()])},AKSB.measure=AKSB.measure||function(e,_,t){AKSB.q.push(["measure",e,_,t||(new Date).getTime()])},AKSB.done=AKSB.done||function(e){AKSB.q.push(["done",e])},AKSB.mark("firstbyte",(new Date).getTime()),AKSB.prof={custid:"322179",ustr:"",originlat:"0",clientrtt:"3",ghostip:"23.212.3.15",ipv6:false,pct:"10",clientip:"45.78.37.67",requestid:"29efed3a",region:"32996",protocol:"",blver:14,akM:"dsca",akN:"ae",akTT:"O",akTX:"1",akTI:"29efed3a",ai:"206465",ra:"false",pmgn:"",pmgi:"",pmp:"",qc:""},function(e){var _=d.createElement("script");_.async="async",_.src=e;var t=d.getElementsByTagName("script"),t=t[t.length-1];t.parentNode.insertBefore(_,t)}(("https:"===d.location.protocol?"https:":"http:")+"//ds-aksb-a.akamaihd.net/aksb.min.js")}</script>
                    <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script>
   
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="use-jaas-login-utility-and-java-gss-api-secure-message-exchanges.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一个</a> <a href="kerberos-requirements.html" class="pull-right">下一个<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">安全开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="java-generic-security-services-java-gss-api1.html" property="item" typeof="WebPage"><span property="name">Java通用安全服务（Java GSS-API）</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="introduction-jaas-and-java-gss-api-tutorials1.html" property="item" typeof="WebPage"><span property="name">JAAS和Java GSS-API教程简介</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">使用Java GSS-API和JAAS可以做的更多事情</li>
            </ol>
            <a id="GUID-B69758E7-D7B9-4860-BFA2-0429618374E8" name="GUID-B69758E7-D7B9-4860-BFA2-0429618374E8"></a>
            
            <h2 id="JSSEC-GUID-B69758E7-D7B9-4860-BFA2-0429618374E8" class="sect2">使用Java GSS-API和JAAS可以做的更多事情</h2>
         </header>
         <div class="ind">
            <div>
               <p>上一个教程“ <a href="use-jaas-login-utility-and-java-gss-api-secure-message-exchanges.html#GUID-C1DFED9D-D3A1-4C11-95D8-3543935E87C8">使用JAAS登录实用程序和Java GSS-API进行安全消息交换</a> ”展示了两个应用程序（尤其是客户端和服务器）如何使用Java GSS-API在它们之间建立安全上下文，然后安全地交换消息。
               </p>
               <p>一旦与上下文发起者（客户端）建立了上下文，上下文接受器（我们的客户端/服务器示例中的服务器）可以执行其他操作。基本上，服务器可以“模拟”客户端。模拟级别取决于客户端是否已将凭据委派给服务器。</p>
               <ul style="list-style-type:disc">
                  <li><a href="more-things-you-can-do-java-gss-api-and-jaas.html#GUID-7836E843-A8F1-4C59-A5FD-BFEE3B307508">代表客户执行代码</a></li>
                  <li><a href="more-things-you-can-do-java-gss-api-and-jaas.html#GUID-23E84B31-CEAD-4FAC-A3EB-AD807587A502">使用从客户端委派的凭据</a></li>
               </ul>
            </div>
            <div class="sect2"><a id="GUID-7836E843-A8F1-4C59-A5FD-BFEE3B307508" name="GUID-7836E843-A8F1-4C59-A5FD-BFEE3B307508"></a><h3 id="JSSEC-GUID-7836E843-A8F1-4C59-A5FD-BFEE3B307508" class="sect3">代表客户执行代码</h3>
               <div>
                  <p>服务器可以执行的一种客户机模拟，可能是使代码代表客户代码执行所在的同一实体（用户）执行。通常，线程执行的方法使用该线程本身的访问控制设置。但是，在本教程中模拟客户端时，服务器将使用客户端的访问控制设置，以便服务器可以完全访问客户端在运行时本身拥有的那些资源。</p>
                  <p>本教程中使用的方法的一个主要优点是JAAS授权组件可以用于访问控制。如果没有JAAS授权组件，则服务器主体将需要访问由代表客户端用户执行的代码访问的任何资源，并且服务器代码将需要包括访问控制逻辑以确定用户是否被授权访问此类资源。通过利用JAAS授权，提供基于主体的访问控制，可以自动处理访问控制。此类代码中对安全性敏感的操作的权限仅需要授予该用户，而无需授予服务器代码。有关<a href="jaas-authorization.html#GUID-69241059-CCD0-49F6-838F-DDC752F9F19F">JAAS授权</a>的更多信息，请参见<a href="jaas-authorization.html#GUID-69241059-CCD0-49F6-838F-DDC752F9F19F">JAAS授权</a>教程。
                  </p>
                  <ul style="list-style-type:disc">
                     <li><a href="more-things-you-can-do-java-gss-api-and-jaas.html#GUID-08F32421-A49E-4DB8-9FD9-CC25D398CF2D">基本方法</a></li>
                     <li><a href="more-things-you-can-do-java-gss-api-and-jaas.html#GUID-B04626E5-C67D-4116-A7D4-4D58270BE4CB">示例代码和策略文件</a></li>
                     <li><a href="more-things-you-can-do-java-gss-api-and-jaas.html#GUID-4CD5A92F-DDD9-4464-9F42-4105B583A08B">运行示例代码</a></li>
                  </ul>
               </div>
               <div class="sect3"><a id="GUID-08F32421-A49E-4DB8-9FD9-CC25D398CF2D" name="GUID-08F32421-A49E-4DB8-9FD9-CC25D398CF2D"></a><h4 id="JSSEC-GUID-08F32421-A49E-4DB8-9FD9-CC25D398CF2D" class="sect4">基本方法</h4>
                  <div>
                     <p>服务器如何代表用户运行客户端代码来“模拟”客户端以执行代码？基本上以相同的方式将客户端代码设置为代表该用户运行。所有服务器代码需要知道的是用户的主体名称，它可以从与客户端建立的上下文中获取。</p>
                     <p>回想一下，执行客户端代码的用户的JAAS身份验证导致创建包含带有用户名（主体）的<span class="apiname">Principal</span>的<span class="apiname">Subject</span> 。随后，主题与新的访问控制上下文相关联（通过<code class="codeph">Subject.doAsPrivileged</code>从登录实用程序调用），并且认为客户端代码代表用户执行；随后的访问控制决策是基于是否向执行客户端代码的特定用户授予了所需的权限。
                     </p>
                     <p>服务器代码的处理方式类似，除了在这种情况下，指定用于身份验证的主体通常是“服务主体”，而不是用户主体。再次，将创建包含与指定主体名称的<span class="apiname">首席</span> <span class="apiname">受试者</span> <code class="codeph">Subject.doAsPrivileged</code>被调用，并且服务器代码被视为代表指定的主体执行；随后的访问控制决策基于是否为执行服务器代码的特定主体授予了必需的权限。
                     </p>
                     <p>一旦客户端和服务器建立了相互的上下文，就可以通过以下方式确定上下文发起者的名称（客户端的主体名称）：</p><pre class="pre codeblock"><code>GSSName clientGSSName = context.getSrcName();
</code></pre><p>上下文接受器（服务器）可以使用此名称来构造一个<span class="apiname">Subject</span> ，该<span class="apiname">Subject</span>包含代表同一实体的<span class="apiname">Principal</span> 。例如，您可以通过以下方式使用Oracle的JDK构造这样的<span class="apiname">主题</span> ：</p><pre class="pre codeblock"><code>Subject client = 
  com.sun.security.jgss.GSSUtil.createSubject(clientGSSName, null);
</code></pre><p><a href="https://docs.oracle.com/javase/10/docs/api/com/sun/security/jgss/GSSUtil.html#createSubject-org.ietf.jgss.GSSName-org.ietf.jgss.GSSCredential-" target="_blank"><span class="apiname">createSubject</span></a>方法根据指定为参数的GSSName和GSSCredential创建新的Subject。如果服务器代码只是要在本地JVM中代表用户执行代码，则不需要用户凭据-实际上，除非客户端已将凭据委派给服务器，否则甚至无法获得用户凭据，如<a href="more-things-you-can-do-java-gss-api-and-jaas.html#GUID-23E84B31-CEAD-4FAC-A3EB-AD807587A502">使用凭据委派中所述。来自客户</a> 。由于此处不需要凭据，因此我们通过了<code class="codeph">null</code> GSSCredential参数。
                     </p>
                     <div class="infoboxnote" id="GUID-08F32421-A49E-4DB8-9FD9-CC25D398CF2D__GUID-CCD1A8B1-8E91-418D-93DA-869E28C603FF">
                        <p class="notep1">注意：</p>
                        <p>注意：如果您不使用Oracle的JDK，则另一种方法是按以下方式构造<span class="apiname">KerberosPrincipal</span>实例：</p><pre class="pre codeblock"><code>KerberosPrincipal principal = 
  new KerberosPrincipal(clientGSSName.toString());
</code></pre><p>然后使用此主体构造一个新的<span class="apiname">主题，</span>或在现有<span class="apiname">主题</span>的主体集中填充此<span class="apiname">主体</span> 。
                        </p>
                        <p>服务器要代表用户执行的代码应从<code class="codeph">run</code>实现的类的方法<code class="codeph">java.security.PrivilegedAction</code> （要么<code class="codeph">java.security.PrivilegedExceptionAction</code> ）。也就是说，代码可以位于<code class="codeph">run</code>方法或从这样的方法调用<code class="codeph">run</code>方法。
                        </p>
                        <p>服务器代码可以将<span class="apiname">Subject</span>以及<span class="apiname">PrivilegedAction</span> （或<span class="apiname">PrivilegedExceptionAction</span> ）的实例传递给<code class="codeph">Subject.doAsPrivileged</code>以执行后续代码，从<code class="codeph">run</code> <span class="apiname">PrivilegedAction中的</span>方法，代表指定Subject中的委托人（用户）。
                        </p>
                        <p>例如，假设<span class="apiname">PrivilegedAction</span>类称为<span class="apiname">ReadFileAction</span> ，并且将具有主体名称的<span class="apiname">String</span>作为参数。您可以通过以下方式创建此类的实例</p><pre class="pre codeblock"><code>String clientName = clientGSSName.toString();
PrivilegedAction readFile = 
    new ReadFileAction(clientName);
</code></pre><p>致电<code class="codeph">doAsPrivileged</code>然后</p><pre class="pre codeblock"><code>Subject.doAsPrivileged(client, readFile, null);
</code></pre></div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-B04626E5-C67D-4116-A7D4-4D58270BE4CB" name="GUID-B04626E5-C67D-4116-A7D4-4D58270BE4CB"></a><h4 id="JSSEC-GUID-B04626E5-C67D-4116-A7D4-4D58270BE4CB" class="sect4">示例代码和策略文件</h4>
                  <div>
                     <p>以下示例代码和策略文件说明了服务器模拟客户端以便执行仅允许执行客户端的特定用户执行其安全性敏感操作的代码。</p>
                     <ul style="list-style-type:disc">
                        <li><a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__SAMPLESERVERIMP.JAVA-33894617"><code>SampleServerImp.java</code></a></li>
                        <li><a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__READFILEACTION.JAVA-33894842"><code>ReadFileAction.java</code></a></li>
                        <li><a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__SERVERIMP.POLICY-33894A6C"><code>serverimp.policy</code></a></li>
                     </ul>
                  </div>
                  <div class="sect4"><a id="GUID-78C0C551-4A03-4094-8BEB-DA3D5212E509" name="GUID-78C0C551-4A03-4094-8BEB-DA3D5212E509"></a><h5 id="JSSEC-GUID-78C0C551-4A03-4094-8BEB-DA3D5212E509" class="sect5">SampleServerImp.java</h5>
                     <div>
                        <p>的<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__SAMPLESERVERIMP.JAVA-33894617"><code>SampleServerImp.java</code></a>文件与完全相同<code>SampleServer.java</code>上一期（ <a href="use-jaas-login-utility-and-java-gss-api-secure-message-exchanges.html#GUID-C1DFED9D-D3A1-4C11-95D8-3543935E87C8">使用JAAS登录实用程序和Java GSS-API进行安全消息交换</a> ）教程中的文件，但与客户端交换消息后，它具有以下代码来执行<code class="codeph">ReadFileAction</code>作为客户端用户：</p><pre class="pre codeblock"><code>System.out.println("Impersonating client.");

/*
 * Extract the KerberosPrincipal from the client GSSName and 
 * populate it in the principal set of a new Subject. Pass in a 
 * null for credentials since credentials will not be needed.
 */
GSSName clientGSSName = <span class="bold">context.getSrcName</span>();
System.out.println("clientGSSName: " + clientGSSName);
Subject client =
   com.sun.security.jgss.GSSUtil.<span class="bold">createSubject</span>(clientGSSName,
        null);

/*
* Construct an action that will read a file meant only for the
* client
*/
String clientName = clientGSSName.toString();
PrivilegedAction readFile = 
   new <span class="bold">ReadFileAction</span>(clientName);

/*
* Invoke the action via a doAsPrivileged. This allows the
* action to be executed as the client subject, and it also 
* runs that code as privileged. This means that any permission 
* checking that happens beyond this point applies only to 
* the code being run as the client.
*/
<span class="bold">Subject.doAsPrivileged</span>(client, readFile, null);
</code></pre></div>
                  </div>
                  <div class="sect4"><a id="GUID-2754F056-55C4-4844-ABA5-7535B541A538" name="GUID-2754F056-55C4-4844-ABA5-7535B541A538"></a><h5 id="JSSEC-GUID-2754F056-55C4-4844-ABA5-7535B541A538" class="sect5">ReadFileAction.java</h5>
                     <div>
                        <p>的<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__READFILEACTION.JAVA-33894842"><code>ReadFileAction.java</code></a>文件包含<code class="codeph">ReadFileAction</code>类。它的构造函数将客户用户名的<span class="apiname">字符串</span>作为参数。客户端用户名用于为以下文件构造文件名： <code class="codeph">ReadFileAction</code>将尝试阅读。文件名将是：</p><pre class="pre codeblock"><code>./data/<span class="variable" translate="no">&lt;name&gt;</span>_info.txt
</code></pre><p>哪里<code class="codeph"><span class="variable" translate="no"><name></span></code>是没有相应领域的客户端用户名。例如，如果完整的用户名是<code class="codeph">mjones@KRBNT-OPERATIONS.EXAMPLE.COM</code> ，则文件名为</p><pre class="pre codeblock"><code>./data/mjones_info.txt
</code></pre><div class="infoboxnote" id="GUID-2754F056-55C4-4844-ABA5-7535B541A538__GUID-09828A7D-C3B7-40BF-9A22-8C3194F7EA76">
                           <p class="notep1">注意：</p>
                           <p>在Window上，正斜杠将是反斜杠。</p>
                        </div>
                        <p>的<code class="codeph">ReadFileAction</code><code class="codeph">run</code>方法读取指定的文件并打印其内容。
                        </p>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-53271ED8-797E-4BCB-8AAB-2D8ABAAE3991" name="GUID-53271ED8-797E-4BCB-8AAB-2D8ABAAE3991"></a><h5 id="JSSEC-GUID-53271ED8-797E-4BCB-8AAB-2D8ABAAE3991" class="sect5">serverimp.policy</h5>
                     <div>
                        <p><span class="apiname">ReadFileAction</span>尝试读取文件，这是一项经过安全检查的操作。由于<span class="apiname">ReadFileAction</span>被视为以客户端用户（ <span class="apiname">Principal</span> ）的身份执行，因此不仅必须向<span class="apiname">ReadFileAction</span>代码本身授予适当的权限，还必须向客户端<span class="apiname">Principal</span>授予适当的权限。
                        </p>
                        <p>假设<code class="codeph">ReadFileAction</code>类放置在名为的JAR文件中<code class="codeph">ReadFileAction.jar</code> ，并且用户主体名称为<code class="codeph">mjones@KRBNT-OPERATIONS.EXAMPLE.COM</code> ，可以通过以下策略文件授予此权限：</p><pre class="pre codeblock"><code>grant CodeBase "file:./ReadFileAction.jar" 
    Principal javax.security.auth.kerberos.KerberosPrincipal 
        "mjones@KRBNT-OPERATIONS.EXAMPLE.COM" {

    permission java.io.FilePermission "data/mjones_info.txt", 
        "read";
};
</code></pre><p>的<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__SERVERIMP.POLICY-33894A6C"><code>serverimp.policy</code></a>文件与完全相同<code class="codeph">server.policy</code>以前的教程（ <a href="use-jaas-login-utility-and-java-gss-api-secure-message-exchanges.html#GUID-C1DFED9D-D3A1-4C11-95D8-3543935E87C8">使用JAAS登录实用程序和Java GSS-API进行安全消息交换</a> ）教程中提供的文件，不同之处在于它授予<span class="apiname">SampleServer</span>代码<code class="codeph">javax.security.auth.AuthPermission "doAsPrivileged"</code>调用它所需的权限<code class="codeph">doAsPrivileged</code>方法，并且具有以下占位符来授予上面显示的<span class="apiname">FilePermission</span> ：</p><pre class="pre codeblock"><code>grant CodeBase "file:./ReadFileAction.jar" 
    Principal javax.security.auth.kerberos.KerberosPrincipal 
        "your_user_name@your_realm" {

    permission java.io.FilePermission "data/your_user_name_info.txt", 
        "read";
};
</code></pre><p>您必须用Kerberos领域代替<code class="codeph">your_realm</code> ，以及您的用户名<code class="codeph">your_user_name</code>同时<code class="codeph">your_user_name@your_realm</code>和<code class="codeph">data/your_user_name_info.txt</code> 。如果您使用的是Windows，则还要在<code class="codeph">data/your_user_name_info.txt</code>带“ \”。
                        </p>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-4CD5A92F-DDD9-4464-9F42-4105B583A08B" name="GUID-4CD5A92F-DDD9-4464-9F42-4105B583A08B"></a><h4 id="JSSEC-GUID-4CD5A92F-DDD9-4464-9F42-4105B583A08B" class="sect4">运行示例代码</h4>
                  <div>
                     <p>要运行说明服务器模拟客户端的示例代码，请执行上一教程的“ <a href="use-jaas-login-utility-and-java-gss-api-secure-message-exchanges.html#GUID-07D0C8CC-0922-4B0F-B14D-9A644CB13783">运行SampleClient和SampleServer程序”</a>中列出的所有内容，但以下各项除外：</p>
                     <ul style="list-style-type:disc">
                        <li>在“准备<code class="codeph">SampleServer</code>执行”步骤：<ul style="list-style-type:disc">
                              <li>使用<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__SAMPLESERVERIMP.JAVA-33894617"><code>SampleServerImp.java</code></a>代替<code class="codeph">SampleServer.java</code> 。编译并创建一个名为的JAR文件<code class="codeph">SampleServerImp.jar</code>包含<code class="codeph">SampleServerImp.class</code>通过以下方式：<pre class="pre codeblock"><code>javac SampleServerImp.java
jar -cvf SampleServerImp.jar SampleServerImp.class
</code></pre></li>
                              <li>使用<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__SERVERIMP.POLICY-33894A6C"><code>serverimp.policy</code></a>策略文件，而不是<code class="codeph">server.policy</code> 。
                              </li>
                              <li>使用<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__CSIMPLOGIN.CONF-37761B67"><code>csImpLogin.conf</code></a>登录配置文件而不是<code class="codeph">cs.conf</code> 。
                              </li>
                              <li>复制<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__READFILEACTION.JAVA-33894842"><code>ReadFileAction.java</code></a>到与其他文件相同的目录。编译它，并通过以下方式将其放置在JAR文件中：<pre class="pre codeblock"><code>javac ReadFileAction.java
jar -cvf ReadFileAction.jar ReadFileAction.class
</code></pre></li>
                              <li>在<code class="codeph">csImpLogin.conf</code> ，替换<code class="codeph">service_principal@your_realm</code>带有代表<span class="apiname">SampleServer</span>的服务主体的Kerberos名称（请参阅<a href="use-jaas-login-utility-and-java-gss-api-secure-message-exchanges.html#GUID-832A32FD-3D99-4624-86A4-7AFBF8924C80">Kerberos用户和服务主体名称</a> ）。
                              </li>
                              <li>在<code class="codeph">serverimp.policy</code> ，替换<code class="codeph">service_principal@your_realm</code>在两个地方都显示了带有服务主体的Kerberos名称，该名称代表<code class="codeph">SampleServer</code> 。（与登录配置文件中使用的名称相同。）另外，用Kerberos领域代替<code class="codeph">your_realm</code> ，以及您的用户名<code class="codeph">your_user_name</code>同时<code class="codeph">your_user_name@your_realm</code>和<code class="codeph">data/your_user_name_info.txt</code> 。如果您在Windows上运行，则将“ /”替换为<code class="codeph">data/your_user_name_info.txt</code>带“ \”。
                              </li>
                              <li>创建一个<code class="codeph">data</code>当前目录的子目录，并在该目录中创建具有指定名称的简短文本文件。例如，如果您的用户名是<code class="codeph">mjones</code> ，应将要放置在data子目录中的文件命名为<code class="codeph">mjones_info.txt</code> 。
                              </li>
                           </ul>
                        </li>
                        <li>在“执行<code class="codeph">SampleServer</code> “ 步：<ul style="list-style-type:disc">
                              <li>
                                 <p>使用以下命令代替该部分中指定的命令，以便<code class="codeph">SampleServerImp</code>被执行<code class="codeph">serverimp.policy</code>和<code class="codeph">csImpLogin.conf</code>被使用，并且<code class="codeph">ReadFileAction.jar</code>已经包括了。
                                 </p>
                                 <div class="infoboxnote" id="GUID-4CD5A92F-DDD9-4464-9F42-4105B583A08B__GUID-EE702120-44BD-426F-817C-18158F6D293D">
                                    <p class="notep1">注意：</p>
                                    <p><span class="bold">重要说明：在这些命令中，您必须替换<code class="codeph"><span class="variable" translate="no"><port_number></span></code>具有适当的端口号（较高的端口号，例如4444）， <code class="codeph"><span class="variable" translate="no"><your_realm></span></code>与您的Kerberos领域，以及<code class="codeph"><span class="variable" translate="no"><your_kdc></span></code>与您的Kerberos KDC。</span></p>
                                 </div>
                                 <p>这是Windows的命令：</p><pre class="pre codeblock"><code>  java -classpath Login.jar;SampleServerImp.jar;ReadFileAction.jar 
    -Djava.security.manager 
    -Djava.security.krb5.realm=<span class="variable" translate="no">&lt;your_realm&gt;</span> 
    -Djava.security.krb5.kdc=<span class="variable" translate="no">&lt;your_kdc&gt;</span> 
    -Djava.security.policy=serverimp.policy 
    -Djava.security.auth.login.config=csImpLogin.conf 
    Login SampleServerImp <span class="variable" translate="no">&lt;port_number&gt;</span> 
</code></pre><p>这是用于Solaris，Linux和macOS的命令：</p><pre class="pre codeblock"><code>  java -classpath Login.jar:SampleServerImp.jar:ReadFileAction.jar 
    -Djava.security.manager 
    -Djava.security.krb5.realm=<span class="variable" translate="no">&lt;your_realm&gt;</span> 
    -Djava.security.krb5.kdc=<span class="variable" translate="no">&lt;your_kdc&gt;</span> 
    -Djava.security.policy=serverimp.policy 
    -Djava.security.auth.login.config=csImpLogin.conf 
    Login SampleServerImp <span class="variable" translate="no">&lt;port_number&gt;</span> </code></pre><p>像往常一样，在一行上键入完整命令。为了清晰起见，此处使用多行。如果该命令对于您的系统而言太长，则可能需要将其放置在.bat文件（对于Windows）或.sh文件（对于Solaris，Linux和macOS）中，然后运行该文件以执行命令。</p>
                                 <p>就像跑步时一样<code class="codeph">SampleServer</code> ，系统将提示您输入服务主体的Kerberos密码， <code class="codeph">SampleServerImp</code>预计将运行。在登录配置文件中指定的Kerberos登录模块会将服务主体记录到Kerberos中。身份验证成功完成后， <code class="codeph">SampleServerImp</code>代码将代表服务主体执行。它将侦听指定端口上的套接字连接。
                                 </p>
                                 <p>按照“准备<code class="codeph">SampleClient</code>执行”和“执行<code class="codeph">SampleClient</code> ”指令照常执行并执行用户登录，客户端代码将请求与<code class="codeph">SampleServerImp</code> 。一旦<code class="codeph">SampleServerImp</code>接受连接， <code class="codeph">SampleClient</code>和<code class="codeph">SampleServerImp</code>建立共享上下文，然后按照上一教程中的说明交换消息。
                                 </p>
                                 <p>消息交换后， <code class="codeph">SampleServerImp</code>确定执行所述客户端代码的用户的主体名称，创建包含一个<span class="apiname">主体</span>具有该名称的新的<span class="apiname">主题</span> ，并要求<code class="codeph">Subject.doAsPrivileged</code>在执行代码<code class="codeph">ReadFileAction</code>代表指定用户。 <code class="codeph">ReadFileAction</code>读取名为<code class="codeph">your_user_name_info.txt</code> （哪里<code class="codeph">your_user_name</code>代表实际的用户名） <code class="codeph">data</code>当前目录的子目录，并打印出其内容。
                                 </p>
                                 <p>有关登录故障排除的建议，请参阅<a href="troubleshooting.html#GUID-2087ADBA-6C36-43D5-8841-C79FCB4F5FBE">故障排除</a> 。
                                 </p>
                              </li>
                           </ul>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-23E84B31-CEAD-4FAC-A3EB-AD807587A502" name="GUID-23E84B31-CEAD-4FAC-A3EB-AD807587A502"></a><h3 id="JSSEC-GUID-23E84B31-CEAD-4FAC-A3EB-AD807587A502" class="sect3">使用从客户端委派的凭据</h3>
               <div>
                  <p>如果客户端将其凭据委派给服务器，则可能是最完整的客户端模拟类型。</p>
                  <p>回想一下，在使用上下文接受器（我们之前的教程中的服务器）建立上下文之前，上下文发起者（客户端）会设置各种上下文选项。如果发起方调用<code class="codeph">requestCredDeleg</code>上的方法<code class="codeph">context</code>带一个对象<code class="codeph">true</code>论点，如</p><pre class="pre codeblock"><code>context.requestCredDeleg(true);
</code></pre><p>然后这要求在上下文建立期间将发起者的凭据委派给接受者。</p>
                  <p>从发起者到接受者的凭证委派使接受者能够将自己认证为发起者的代理或委托。</p>
                  <p>首先，在上下文建立之后，接受者必须确定是否确实进行了凭证委派。通过调用<code class="codeph">getCredDelegState</code>方法：</p><pre class="pre codeblock"><code>boolean delegated = context.getCredDelegState();
</code></pre><p>如果委托凭证，则接受者可以通过调用<code class="codeph">getDelegCr</code>方法：</p><pre class="pre codeblock"><code>GSSCredential clientCr = context.getDelegCred();
</code></pre><p>然后，可以将所得的<span class="apiname">GSSCredential</span>对象用作启动器的“代理”来启动后续的GSS-API上下文。例如，服务器可以向后端服务器认证为客户端，该后端服务器更关心原始客户端是谁，而不是中间服务器是谁。
                  </p>
                  <p>充当客户端，服务器可以与后端服务器建立连接，建立联合安全上下文并以与客户端和服务器相同的方式交换消息。</p>
                  <p>一种可能的方法是，当服务器调用<code class="codeph">createContext</code> <span class="apiname">GSSManager的</span>方法，它可以通过<code class="codeph">createContext</code>委派的凭证，而不是传递一个<code class="codeph">null</code> 。
                  </p>
                  <p>或者，服务器代码可以先调用<code class="codeph">com.sun.security.jgss.GSSUtil createSubject</code>方法并将其传递给委派的凭据。该方法返回一个<span class="apiname">主题，</span>其中包含那些凭据作为默认凭据。然后，服务器可以将其关联<code class="codeph">Subject</code>与当前<span class="apiname">AccessControlContext一起使用</span> ，如<a href="jaas-authorization.html#GUID-86CC2E0C-58B9-4E35-91E1-EC130EE2E4FC">如何将主题与访问控制上下文相关联中所述。</a> 在JAAS授权教程中。然后，当服务器代码调用<span class="apiname">GSSManager时</span> <code class="codeph">createContext</code>方法，它可以传递一个null（指示应使用“当前”主题的凭据）。换句话说，服务器将有效地成为客户端。随后使用GSS与后端服务器的连接可以完全按照先前教程中的描述进行。如果您希望将使用委派凭据的代码与使用默认本地凭据的代码相同，则此方法很有用。
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-23E84B31-CEAD-4FAC-A3EB-AD807587A502__GUID-13B3880E-42EC-4BA8-AE00-22752CD8F457">约束委派</p>
                     <p>如果在KDC服务器中配置了约束委派，则在服务器端，即使客户端未调用<span class="apiname">requestCredDeleg（</span> <span class="apiname">）</span> ， <span class="apiname">getKredDelegState（）</span>调用仍可能返回true，而<span class="apiname">getDelegCred（）</span>将返回委托凭据，具体取决于KDC设置。 <span class="apiname">正确）</span> 。
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-46E411CE-A04B-4489-AEC6-9AF4D569B371" name="GUID-46E411CE-A04B-4489-AEC6-9AF4D569B371"></a><h3 id="JSSEC-GUID-46E411CE-A04B-4489-AEC6-9AF4D569B371" class="sect3">委派凭据所需的权限</h3>
               <div>
                  <p>为了委派凭据，上下文启动器（ <code class="codeph">SampleClient</code>在我们之前的教程中）必须有一个<code class="codeph">javax.security.auth.kerberos.DelegationPermission</code> 。以下是使用斜体的占位符表示实际值的示例：</p><pre class="pre codeblock"><code>permission javax.security.auth.kerberos.DelegationPermission
  "\"<span class="variable" translate="no">service_principal@your_realm</span>\"  
     \"krbtgt/<span class="variable" translate="no">your_realm</span>@<span class="variable" translate="no">your_realm</span>\"";
</code></pre><p>请注意， <span class="apiname">DelegatePermission</span>在引号中有一个目标，其中包含两个项目，并且两个项目都被引用了。每个内部引号均以“ \”转义。因此，第一项是</p><pre class="pre codeblock"><code>"<span class="variable" translate="no">service_principal@your_realm</span>"
</code></pre><p>第二个是</p><pre class="pre codeblock"><code>"krbtgt/<span class="variable" translate="no">your_realm</span>@<span class="variable" translate="no">your_realm</span>"
</code></pre><p>这基本上使代表客户端执行的代码具有将Kerberos票证转发到指定对等方的权限（ <code class="codeph"><span class="variable" translate="no">service_principal</span></code> ），其中Kerberos票证旨在从<code class="codeph">krbtgt/<span class="variable" translate="no">your_realm</span>@<span class="variable" translate="no">your_realm</span></code> 。
                  </p>
                  <p>将您的领域替换为所有地方<code class="codeph"><span class="variable" translate="no">your_realm</span></code>出现。还用服务主体名称替换代表服务器的服务主体<code class="codeph"><span class="variable" translate="no">service_principal@your_realm</span></code> 。（请参阅上一教程中的<a href="use-jaas-login-utility-and-java-gss-api-secure-message-exchanges.html#GUID-832A32FD-3D99-4624-86A4-7AFBF8924C80">Kerberos用户和服务主体名称</a> 。）假设你的境界是<code class="codeph">KRBNT-OPERATIONS.EXAMPLE.COM</code>服务主体是<code class="codeph">sample/raven.example.com@KRBNT-OPERATIONS.EXAMPLE.COM</code> 。然后，该权限可能会在策略文件中显示为</p><pre class="pre codeblock"><code>permission javax.security.auth.kerberos.DelegationPermission
  "\"sample/raven.example.com@KRBNT-OPERATIONS.EXAMPLE.COM\"  
     \"krbtgt/KRBNT-OPERATIONS.EXAMPLE.COM@KRBNT-OPERATIONS.EXAMPLE.COM\"";
</code></pre></div>
            </div>
         </div>
      </article>
   

</body></html>