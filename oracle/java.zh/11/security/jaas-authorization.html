<html lang="en-us"  xml:lang="en-us"><head></head><body >﻿
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>JAAS授权</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Security Developer’s Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Security Developer’s Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="security-developer-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-21T08:42:26-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="1993, 2018">
      <meta name="dcterms.category" content="java">
      <meta name="dcterms.identifier" content="E94828-01">
      
      <meta name="dcterms.product" content="en/java/javase/11">
      <meta name="dcterms.release" content="11">
      <link rel="prev" href="jaas-authentication.html" title="Previous" type="text/html">
      <link rel="next" href="use-jaas-login-utility.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"java","element_name":"Java","display_in_url":true},"suite":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product_group":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product":{"short_name":"javase","element_name":"Java SE","display_in_url":true},"release":{"short_name":"11","element_name":"11","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Security Developer Guide">
    <meta name="dcterms.isVersionOf" content="SECURITY">
  <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script>
   
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="jaas-authentication.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一个</a> <a href="use-jaas-login-utility.html" class="pull-right">下一个<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">安全开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="java-generic-security-services-java-gss-api1.html" property="item" typeof="WebPage"><span property="name">Java通用安全服务（Java GSS-API）</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="introduction-jaas-and-java-gss-api-tutorials1.html" property="item" typeof="WebPage"><span property="name">JAAS和Java GSS-API教程简介</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">JAAS授权</li>
            </ol>
            <a id="GUID-69241059-CCD0-49F6-838F-DDC752F9F19F" name="GUID-69241059-CCD0-49F6-838F-DDC752F9F19F"></a>
            
            <h2 id="JSSEC-GUID-69241059-CCD0-49F6-838F-DDC752F9F19F" class="sect2">JAAS授权</h2>
         </header>
         <div class="ind">
            <div>
               <p><span></span></p>
               <p>本教程将扩展“ <a href="jaas-authentication.html#GUID-0C6EB04B-D203-4688-A3E2-A7D442334623">JAAS身份验证”</a>教程中开发的程序和策略文件，以演示JAAS授权组件，该组件可确保经过身份验证的调用者具有执行后续安全敏感操作所需的访问控制权（权限）。由于授权组件要求首先完成用户认证，因此，如果尚未完成，请首先阅读<a href="jaas-authentication.html#GUID-0C6EB04B-D203-4688-A3E2-A7D442334623">JAAS认证</a>教程。
               </p>
               <p>本教程的其余部分包括以下部分：</p>
               <ul style="list-style-type:disc">
                  <li><a href="jaas-authorization.html#GUID-95EBDFAE-D531-45ED-BF48-4CC122E483E1">什么是JAAS授权？</a></li>
                  <li><a href="jaas-authorization.html#GUID-9B40B33D-3618-4F98-9DDE-9A639F751CA4">JAAS授权如何执行？</a><ul style="list-style-type:disc">
                        <li><a href="jaas-authorization.html#GUID-80F0B546-1E95-457B-8EF7-5BB1519E20A4">您如何制作基于主体的策略文件语句？</a></li>
                        <li><a href="jaas-authorization.html#GUID-86CC2E0C-58B9-4E35-91E1-EC130EE2E4FC">您如何将主题与访问控制上下文相关联？</a></li>
                     </ul>
                  </li>
                  <li><a href="jaas-authorization.html#GUID-6C7F947A-E2F3-4C1A-BF58-8198E4E9B6D3">授权教程代码</a></li>
                  <li><a href="jaas-authorization.html#GUID-C7E4B4C5-1541-4482-BA11-98A1D489CA76">登录配置文件</a></li>
                  <li><a href="jaas-authorization.html#GUID-19567566-CC1A-4440-AE33-D7C6AB305D3F">政策档案</a></li>
                  <li><a href="jaas-authorization.html#GUID-F22DFBEC-7DF0-4CFB-B882-B5A58C2C76B1">运行授权教程代码</a></li>
               </ul>
               <p>如果您希望首先看到实际使用的教程代码，则可以直接跳至“ <a href="jaas-authorization.html#GUID-F22DFBEC-7DF0-4CFB-B882-B5A58C2C76B1">运行授权教程代码”</a> ，然后返回其他部分以了解更多信息。
               </p>
            </div>
            <div class="sect2"><a id="GUID-95EBDFAE-D531-45ED-BF48-4CC122E483E1" name="GUID-95EBDFAE-D531-45ED-BF48-4CC122E483E1"></a><h3 id="JSSEC-GUID-95EBDFAE-D531-45ED-BF48-4CC122E483E1" class="sect3">什么是JAAS授权？</h3>
               <div>
                  <p>JAAS授权扩展了使用安全策略（请参阅“ <a href="permissions-jdk1.html#GUID-789089CA-8557-4017-B8B0-6899AD3BA18D">默认策略实现”和“策略文件语法”</a> ）来指定授予执行代码哪些访问权限的现有Java安全体系结构。这种架构是以<span class="variable" translate="no">code-centric</span> 。也就是说，根据代码特征授予权限：代码来自哪里，是否经过数字签名，以及是否由谁签名。我们在<code class="codeph">jaasacn.policy</code> <a href="jaas-authentication.html#GUID-0C6EB04B-D203-4688-A3E2-A7D442334623">JAAS认证</a>教程中使用的文件。该文件包含以下内容：</p><pre class="pre codeblock"><code>grant codebase "file:./JaasAcn.jar" {
   permission javax.security.auth.AuthPermission 
                    "createLoginContext.JaasSample";
};
</code></pre><p>这会授予<code class="codeph">JaasAcn.jar</code>文件，位于当前目录中，具有指定的权限。（未指定签名者，因此代码是否签名都没有关系。）
                  </p>
                  <p>JAAS授权通过新<span class="variable" translate="no">user-centric</span>访问控制来扩展现有的以代码为<span class="variable" translate="no">user-centric</span>访问控制。权限可以不只是基于什么代码在运行，但也被授予<span class="variable" translate="no">who</span>正在运行它。
                  </p>
                  <p>当应用程序使用JAAS身份验证来验证用户（或其他实体，例如服务）时，将创建一个<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/Subject.html" target="_blank"><span class="apiname">Subject</span></a> 。<span class="apiname">主题</span>的目的是代表经过身份验证的用户。一个<span class="apiname">Subject</span>由一组<a href="https://docs.oracle.com/javase/10/docs/api/java/security/Principal.html" target="_blank"><span class="apiname">Principal组成</span></a> ，其中每个<span class="apiname">Principal</span>代表该用户的身份。例如，一个<span class="apiname">主题</span>可以有一个名字<span class="apiname">校长</span> （“ Susan Smith”）和一个社会安全号码校长（“ 987-65-4321”），从而可以将该<span class="apiname">主题</span>与其他主题区分开。
                  </p>
                  <p>可以在策略中向特定<span class="apiname">Principal</span>授予权限。在对用户进行身份验证之后，应用程序可以将<span class="apiname">主题</span>与当前访问控制上下文相关联。对于随后的每个经过安全检查的操作（例如，本地文件访问），Java运行时将自动确定该策略是否仅向特定的<span class="apiname">Principal</span>授予所需的权限，如果是，则仅当<span class="apiname">Subject</span>关联时，才允许该操作与访问控制上下文一起包含指定的<span class="apiname">Principal</span> 。
                  </p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-9B40B33D-3618-4F98-9DDE-9A639F751CA4" name="GUID-9B40B33D-3618-4F98-9DDE-9A639F751CA4"></a><h3 id="JSSEC-GUID-9B40B33D-3618-4F98-9DDE-9A639F751CA4" class="sect3">JAAS授权如何执行？</h3>
               <div>
                  <p>要进行JAAS授权，需要满足以下条件：</p>
                  <ul style="list-style-type:disc">
                     <li>如<a href="jaas-authentication.html#GUID-0C6EB04B-D203-4688-A3E2-A7D442334623">JAAS认证</a>教程中所述，必须对用户进行认证。
                     </li>
                     <li>必须在安全策略中配置基于主体的条目。请参阅<a href="jaas-authorization.html#GUID-80F0B546-1E95-457B-8EF7-5BB1519E20A4">如何制作基于主体的策略文件语句？</a></li>
                     <li>身份验证结果的主题必须与当前访问控制上下文关联。请参阅<a href="jaas-authorization.html#GUID-86CC2E0C-58B9-4E35-91E1-EC130EE2E4FC">如何将主题与访问控制上下文相关联？</a></li>
                  </ul>
               </div>
               <div class="sect3"><a id="GUID-80F0B546-1E95-457B-8EF7-5BB1519E20A4" name="GUID-80F0B546-1E95-457B-8EF7-5BB1519E20A4"></a><h4 id="JSSEC-GUID-80F0B546-1E95-457B-8EF7-5BB1519E20A4" class="sect4">您如何制作基于主体的策略文件语句？</h4>
                  <div>
                     <p>政策文件<code class="codeph">grant</code>语句现在可以选择包括一个或多个Principal字段（请参阅<a href="permissions-jdk1.html#GUID-789089CA-8557-4017-B8B0-6899AD3BA18D">默认策略实现和策略文件语法</a> ）。包含Principal字段表示执行指定代码的，由指定Principal表示的用户或其他实体具有指定的权限。
                     </p>
                     <p>因此， <code class="codeph">grant</code>声明现在</p><pre class="pre codeblock"><code>
grant &lt;<span class="variable" translate="no">signer(s) field</span>&gt;, &lt;<span class="variable" translate="no">codeBase URL</span>&gt; 
  &lt;<span class="variable" translate="no">Principal field(s)</span>&gt; {
    permission <span class="variable" translate="no">perm_class_name</span> "<span class="variable" translate="no">target_name</span>", "<span class="variable" translate="no">action</span>";
    ....
    permission <span class="variable" translate="no">perm_class_name</span> "<span class="variable" translate="no">target_name</span>", "<span class="variable" translate="no">action</span>";
  };
</code></pre><p>其中每个签署者，codeBase和Principal字段是可选的，并且字段之间的顺序无关紧要。</p>
                     <p>Principal字段如下所示：</p><pre class="pre codeblock"><code>Principal <span class="variable" translate="no">Principal_class</span> "<span class="variable" translate="no">principal_name</span>"
</code></pre><p>也就是说，它是单词“ Principal”（大小写无关紧要），后跟Principal类的（完全限定）名称和主体名称。</p>
                     <p><span class="apiname">Principal</span>类是实现<a href="https://docs.oracle.com/javase/10/docs/api/java/security/Principal.html" target="_blank"><span class="apiname">java.security的类</span></a><a href="https://docs.oracle.com/javase/10/docs/api/java/security/Principal.html" target="_blank"><span class="apiname">。主</span></a>界面。所有Principal对象都有一个关联的名称，可以通过调用它们的名称来获得<code class="codeph">getName</code>方法。名称使用的格式取决于每个<span class="apiname">Principal</span>实现。
                     </p>
                     <p>放置在<span class="apiname">受试者</span>中的<span class="apiname">主要</span>类型创建由本教程使用的Kerberos的认证机制是<code class="codeph">javax.security.auth.kerberos.KerberosPrincipal</code> ，因此应将其用作<code class="codeph"><span class="variable" translate="no">Principal_class</span></code>我们的一部分<code class="codeph">grant</code>声明的<span class="apiname">主要</span>名称。的用户名<code class="codeph">KerberosPrincipal</code> s的形式<code class="codeph"><span class="variable" translate="no">name</span>@<span class="variable" translate="no">realm</span></code> 。因此，如果用户名是<code class="codeph">mjones</code>而领域是<code class="codeph">KRBNT-OPS.ABC.COM</code> ，完整<code class="codeph"><span class="variable" translate="no">principal_name</span></code>指定用于<code class="codeph">grant</code>声明是<code class="codeph">mjones@KRBNT-OPS.ABC.COM</code> 。
                     </p>
                     <p>可以在一个字段中包含多个Principal字段<code class="codeph">grant</code>声明。如果指定了多个Principal字段，则该字段中的权限<code class="codeph">grant</code>仅当与当前访问控制上下文关联的主题包含<span class="variable" translate="no">all</span>这些主体时，才授予该语句。
                     </p>
                     <p>要将同一组权限授予不同的主体，请创建多个<code class="codeph">grant</code>语句，其中每个列出权限，并包含一个指定一个Principal的Principal字段。
                     </p>
                     <p>本教程的策略文件包括一个<code class="codeph">grant</code>具有Principal字段的语句：</p><pre class="pre codeblock"><code>grant codebase "file:./SampleAction.jar",
    Principal javax.security.auth.kerberos.KerberosPrincipal 
        "your_user_name@your_realm"  {

   permission java.util.PropertyPermission "java.home", "read";
   permission java.util.PropertyPermission "user.home", "read";
   permission java.io.FilePermission "foo.txt", "read";
};
</code></pre><p>在其中替换Kerberos用户名（用“ @”和领域完整）的位置<code class="codeph">your_user_name@your_realm</code> 。这指定将指定的权限授予执行代码的指定委托人<code class="codeph">SampleAction.jar</code> 。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-86CC2E0C-58B9-4E35-91E1-EC130EE2E4FC" name="GUID-86CC2E0C-58B9-4E35-91E1-EC130EE2E4FC"></a><h4 id="JSSEC-GUID-86CC2E0C-58B9-4E35-91E1-EC130EE2E4FC" class="sect4">您如何将主题与访问控制上下文相关联？</h4>
                  <div>
                     <p>要创建主题并将其与访问控制上下文相关联，您需要以下内容：</p>
                     <ul style="list-style-type:disc">
                        <li>如<a href="jaas-authentication.html#GUID-0C6EB04B-D203-4688-A3E2-A7D442334623">JAAS Authentication中</a>所述，必须首先对用户进行认证。
                        </li>
                        <li>静态<code class="codeph">doAs</code>必须调用<span class="apiname">Subject</span>类中的方法，并向其传递经过身份验证的<span class="apiname">Subject</span>和<a href="https://docs.oracle.com/javase/10/docs/api/java/security/PrivilegedAction.html" target="_blank"><span class="apiname">java.security。PrivilegedAction</span></a>或<a href="https://docs.oracle.com/javase/10/docs/api/java/security/PrivilegedExceptionAction.html" target="_blank"><span class="apiname">java.security。PrivilegedExceptionAction</span></a> 。（有关<span class="apiname">PrivilegedAction</span>和<span class="apiname">PrivilegedExceptionAction</span>的比较，请参见<a href="java-se-platform-security-architecture.html#GUID-BB3C8FB3-1A1A-47F3-8536-3952B84F46F2" title="本节说明什么是特权代码及其用途。它还显示了如何使用doPrivileged API。">附录A：特权块的API</a> 。）的<code class="codeph">doAs</code>方法将提供的<span class="apiname">Subject</span>与当前访问控制上下文关联，然后调用<code class="codeph">run</code>从行动方法。的<code class="codeph">run</code>方法实现包含要作为指定<span class="apiname">Subject</span>执行的所有代码。因此，该动作将作为指定的<span class="apiname">Subject</span>执行。
                           <p>静态<code class="codeph">doAsPrivileged</code>可以调用<span class="apiname">Subject</span>类中的方法代替<code class="codeph">doAs</code>方法。除了传递给<code class="codeph">doAs</code> ， <code class="codeph">doAsPrivileged</code>需要第三个参数： <span class="apiname">AccessControlContext</span> 。不像<code class="codeph">doAs</code> ，它将提供的Subject与当前访问控制上下文相关联， <code class="codeph">doAsPrivileged</code>将<span class="apiname">Subject</span>与提供的访问控制上下文相关联。有关这些方法的比较，请参见《 JAAS参考指南》中的<a href="java-authentication-and-authorization-service-jaas-reference-guide.html#GUID-97198A0C-B488-4D24-A242-CAFA8F70DFA5">doAs与doAsPrivileged</a> 。
                           </p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-6C7F947A-E2F3-4C1A-BF58-8198E4E9B6D3" name="GUID-6C7F947A-E2F3-4C1A-BF58-8198E4E9B6D3"></a><h3 id="JSSEC-GUID-6C7F947A-E2F3-4C1A-BF58-8198E4E9B6D3" class="sect3">授权教程代码</h3>
               <div>
                  <p>本教程的代码包含两个文件：</p>
                  <ul style="list-style-type:disc">
                     <li><a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__JAASAZN.JAVA-33892F00"><code>JaasAzn.java</code></a>与...完全相同<code class="codeph">JaasAcn.java</code>从<a href="jaas-authentication.html#GUID-0C6EB04B-D203-4688-A3E2-A7D442334623">JAAS认证</a>教程中获得，除了需要调用的其他代码外<code class="codeph">Subject.doAsPrivileged</code> 。
                     </li>
                     <li><a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__SAMPLEACTION.JAVA-33893145"><code>SampleAction.java</code></a>包含<span class="apiname">SampleAction</span>类。此类实现<span class="apiname">PrivilegedAction</span>并具有一个<code class="codeph">run</code>包含我们希望通过基于<span class="apiname">主体</span>的授权检查执行的所有代码的方法。
                     </li>
                  </ul>
               </div>
               <div class="sect3"><a id="GUID-EEBB584B-80FA-4EDD-B57A-BED4CCFE4EB4" name="GUID-EEBB584B-80FA-4EDD-B57A-BED4CCFE4EB4"></a><h4 id="JSSEC-GUID-EEBB584B-80FA-4EDD-B57A-BED4CCFE4EB4" class="sect4">JaasAzn.java</h4>
                  <div>
                     <p><a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__JAASAZN.JAVA-33892F00"><code>JaasAzn.java</code></a>与...完全相同<code class="codeph">JaasAcn.java</code>上一教程中使用的代码，但在末尾添加了三个语句<code class="codeph">main</code>验证完成后的方法。这些语句导致（1）代表经过身份验证的用户的<span class="apiname">Subject</span>与当前访问控制上下文的关联，以及（2）执行代码中的代码<code class="codeph">run</code>的方法<code class="codeph">SampleAction</code> 。将<span class="apiname">主题</span>与访问控制上下文相关联，可以在<code class="codeph">SampleAction</code><code class="codeph">run</code>如果在当前策略中授予代表经过身份验证的用户的<span class="apiname">Principal</span>所需的权限，则将执行该方法（及其直接或间接调用的任何代码）。
                     </p>
                     <p>喜欢<code class="codeph">JaasAcn.java</code> ， <code class="codeph">JaasAzn.java</code>实例化一个<span class="apiname">LoginContext</span> <code class="codeph">lc</code>并称之为<code class="codeph">login</code>执行身份验证的方法。如果成功，则通过调用<span class="apiname">LoginContext</span>的获取获得经过身份验证的<span class="apiname">Subject</span> （包括代表用户的<span class="apiname">Principal</span> ）。 <code class="codeph">getSubject</code>方法：</p><pre class="pre codeblock"><code>Subject mySubject = lc.getSubject();
</code></pre><p>的<code class="codeph">main</code>方法然后调用<code class="codeph">Subject.doAsPrivileged</code> ，并向其传递经过身份验证的<span class="apiname">主题</span> <code class="codeph">mySubject</code> ，一个<span class="apiname">PrivilegedAction</span> （ <code class="codeph">SampleAction</code> ）和一个<code class="codeph">null</code> <span class="apiname">AccessControlContext</span> ，如下所述。
                     </p>
                     <p>的<code class="codeph">SampleAction</code>该类通过以下方法实例化：</p><pre class="pre codeblock"><code>PrivilegedAction action = new SampleAction();
</code></pre><p>致电<code class="codeph">Subject.doAsPrivileged</code>通过以下方式执行：</p><pre class="pre codeblock"><code>Subject.doAsPrivileged(mySubject, action, null);
</code></pre><p>的<code class="codeph">doAsPrivileged</code>方法调用执行<code class="codeph">run</code> <span class="apiname">PrivilegedAction中的</span>方法<code class="codeph">action</code> （ <code class="codeph">SampleAction</code> ）以启动其余代码的执行，这些代码被视为代表主题执行<code class="codeph">mySubject</code> 。
                     </p>
                     <p>通过<code class="codeph">null</code>作为<span class="apiname">AccessControlContext</span> （第三个）参数<code class="codeph">doAsPrivileged</code>表示<code class="codeph">mySubject</code>应该与一个新的空<span class="apiname">AccessControlContext</span>关联。结果是在执行期间执行安全检查<code class="codeph">SampleAction</code>只需要对<code class="codeph">SampleAction</code>代码本身（或它调用的其他代码），以<code class="codeph">mySubject</code> 。请注意， <code class="codeph">doAsPrivileged</code> （以及当时执行堆栈中的调用方<code class="codeph">doAsPrivileged</code>在执行操作时不需要任何权限。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-994AEA05-292D-418A-8C2D-A32E3A9AC7D3" name="GUID-994AEA05-292D-418A-8C2D-A32E3A9AC7D3"></a><h4 id="JSSEC-GUID-994AEA05-292D-418A-8C2D-A32E3A9AC7D3" class="sect4">SampleAction.java</h4>
                  <div>
                     <p><a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__SAMPLEACTION.JAVA-33893145"><code>SampleAction.java</code></a>包含<span class="apiname">SampleAction</span>类。该类实现<code class="codeph">java.security.PrivilegedAction</code>并有一个<code class="codeph">run</code>包含我们要作为主题执行的所有代码的方法<code class="codeph">mySubject</code> 。在本教程中，我们将执行三个操作，除非已授予代码必需的权限，否则每个操作都无法完成。我们会：</p>
                     <ul style="list-style-type:disc">
                        <li>读取并打印<code class="codeph">java.home</code>系统属性，</li>
                        <li>读取并打印<code class="codeph">user.home</code>系统属性，以及</li>
                        <li>确定是否有一个名为<code class="codeph">foo.txt</code>存在于当前目录中。
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-C7E4B4C5-1541-4482-BA11-98A1D489CA76" name="GUID-C7E4B4C5-1541-4482-BA11-98A1D489CA76"></a><h3 id="JSSEC-GUID-C7E4B4C5-1541-4482-BA11-98A1D489CA76" class="sect3">登录配置文件</h3>
               <div>
                  <p>本教程使用的登录配置文件可以与<a href="jaas-authentication.html#GUID-0C6EB04B-D203-4688-A3E2-A7D442334623">JAAS认证</a>教程使用的登录配置文件完全相同。因此，我们可以使用<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__JASS.CONF-33892AE7"><span class="apiname">jaas.conf</span></a> ，其中仅包含一个条目：</p><pre class="pre codeblock"><code>JaasSample {
  com.sun.security.auth.module.Krb5LoginModule required;
};
</code></pre><p>此项名为“ JaasSample”，这是我们两个教程应用程序的名称<code class="codeph">JaasAcn</code>和<code class="codeph">JaasAzn</code>用于引用它。该条目指定要用于执行用户身份验证的<span class="apiname">LoginModule</span>是<span class="apiname">Krb5LoginModule</span> ，位于<code class="codeph">com.sun.security.auth.module</code>包，并且“成功”需要此<span class="apiname">Krb5LoginModule</span>才能使身份验证成功。仅当成功使用用户提供的名称和密码将用户登录到Kerberos KDC时， <span class="apiname">Krb5LoginModule才会</span>成功。</p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-19567566-CC1A-4440-AE33-D7C6AB305D3F" name="GUID-19567566-CC1A-4440-AE33-D7C6AB305D3F"></a><h3 id="JSSEC-GUID-19567566-CC1A-4440-AE33-D7C6AB305D3F" class="sect3">政策档案</h3>
               <div>
                  <p>本授权教程包含两个类， <code class="codeph">JaasAzn</code>和<code class="codeph">SampleAction</code> 。每个类中的代码都包含一些对安全性敏感的操作，因此在策略文件中需要相关的权限才能执行操作。
                  </p>
               </div>
               <div class="sect3"><a id="GUID-90DA29A4-6980-49EB-B4F0-21E6678AB7A2" name="GUID-90DA29A4-6980-49EB-B4F0-21E6678AB7A2"></a><h4 id="JSSEC-GUID-90DA29A4-6980-49EB-B4F0-21E6678AB7A2" class="sect4">JaasAzn所需的权限</h4>
                  <div>
                     <p>主要方法<code class="codeph">JaasAzn</code>类执行两个需要权限的操作。它</p>
                     <ul style="list-style-type:disc">
                        <li>创建一个<span class="apiname">LoginContext</span> ，并</li>
                        <li>称<code class="codeph">doAsPrivileged</code> <span class="apiname">Subject</span>类的静态方法。
                        </li>
                     </ul>
                     <p><span class="apiname">LoginContext的</span>创建与身份验证教程中的创建完全相同，因此需要相同的内容<code class="codeph">javax.security.auth.AuthPermission</code>目标许可<code class="codeph">createLoginContext.JaasSample</code> 。
                     </p>
                     <p>为了打电话<code class="codeph">doAsPrivileged</code> Subject类的方法，您需要<code class="codeph">javax.security.auth.AuthPermission</code>与目标<code class="codeph">doAsPrivileged</code> 。
                     </p>
                     <p>假设<code class="codeph">JaasAzn</code>类放置在名为的JAR文件中<code class="codeph">JaasAzn.jar</code> ，这些权限可以授予<code class="codeph">JaasAzn</code>通过以下代码<code class="codeph">grant</code>策略文件中的语句：</p><pre class="pre codeblock"><code>grant codebase "file:./JaasAzn.jar" {
   permission javax.security.auth.AuthPermission 
                    "createLoginContext.JaasSample";
   permission javax.security.auth.AuthPermission "doAsPrivileged";
};
</code></pre></div>
               </div>
               <div class="sect3"><a id="GUID-9ADEB874-E415-4ABC-BB20-70FBBFF87F84" name="GUID-9ADEB874-E415-4ABC-BB20-70FBBFF87F84"></a><h4 id="JSSEC-GUID-9ADEB874-E415-4ABC-BB20-70FBBFF87F84" class="sect4">SampleAction所需的权限</h4>
                  <div>
                     <p>的<code class="codeph">SampleAction</code>代码执行需要权限的三个操作。它</p>
                     <ul style="list-style-type:disc">
                        <li>读取<code class="codeph">java.home</code>系统属性。
                        </li>
                        <li>读取<code class="codeph">user.home</code>系统属性。
                        </li>
                        <li>检查以查看是否有一个名为<code class="codeph">foo.txt</code>存在于当前目录中。
                        </li>
                     </ul>
                     <p>这些操作所需的权限如下：</p><pre class="pre codeblock"><code>permission java.util.PropertyPermission "java.home", "read";
permission java.util.PropertyPermission "user.home", "read";
permission java.io.FilePermission "foo.txt", "read";
</code></pre><p>我们需要向这些代码授予这些权限<code class="codeph">SampleAction.class</code> ，我们将其放置在一个名为<code class="codeph">SampleAction.jar</code> 。但是，对于此特定<code class="codeph">grant</code>语句，我们不仅要向<span class="variable" translate="no">code</span>授予权限，还要向执行代码的特定用户授予权限，以演示如何限制对特定用户的访问。
                     </p>
                     <p>因此，如<a href="jaas-authorization.html#GUID-80F0B546-1E95-457B-8EF7-5BB1519E20A4">您如何制作基于主体的策略文件语句中所述？</a> ， 我们的<code class="codeph">grant</code>语句如下所示：</p><pre class="pre codeblock"><code>grant codebase "file:./SampleAction.jar",
    Principal javax.security.auth.kerberos.KerberosPrincipal 
        "your_user_name@your_realm"  {

   permission java.util.PropertyPermission "java.home", "read";
   permission java.util.PropertyPermission "user.home", "read";
   permission java.io.FilePermission "foo.txt", "read";
};
</code></pre><p>您将Kerberos用户名（用“ @”和领域完整）替换为<code class="codeph">your_user_name@your_realm</code> 。例如，如果您的用户名是<code class="codeph">mjones</code>而你的境界是<code class="codeph">KRBNT-OPERATIONS.ABC.COM</code> ，您将使用<code class="codeph">mjones@KRBNT-OPERATIONS.ABC.COM</code> 。
                     </p>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-F22DFBEC-7DF0-4CFB-B882-B5A58C2C76B1" name="GUID-F22DFBEC-7DF0-4CFB-B882-B5A58C2C76B1"></a><h3 id="JSSEC-GUID-F22DFBEC-7DF0-4CFB-B882-B5A58C2C76B1" class="sect3">运行授权教程代码</h3>
               <div>
                  <p>要执行我们的JAAS授权教程代码，您要做的就是</p>
                  <ol>
                     <li>将以下文件放入目录：<ul style="list-style-type:disc">
                           <li>的<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__JAASAZN.JAVA-33892F00"><code>JaasAzn.java</code></a>源文件。
                           </li>
                           <li>的<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__SAMPLEACTION.JAVA-33893145"><code>SampleAction.java</code></a>源文件。
                           </li>
                           <li>的<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__JASS.CONF-33892AE7"><code>jaas.conf</code></a>登录配置文件。
                           </li>
                           <li>的<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__JASSAZN.POLICY-3389344E"><code>jaasazn.policy</code></a>策略文件。
                           </li>
                        </ul>
                     </li>
                     <li>更换<code class="codeph">your_user_name@your_realm</code>在<code class="codeph">jaasazn.policy</code>与您的用户名和领域。
                     </li>
                     <li>编译<code class="codeph">SampleAction.java</code>和<code class="codeph">JaasAzn.java</code> ：<pre class="pre codeblock"><code>javac SampleAction.java JaasAzn.java
</code></pre></li>
                     <li>创建一个名为的JAR文件<code class="codeph">JaasAzn.jar</code>包含<code class="codeph">JaasAzn.class</code> ：<pre class="pre codeblock"><code>jar -cvf JaasAzn.jar JaasAzn.class
</code></pre></li>
                     <li>创建一个名为的JAR文件<code class="codeph">SampleAction.jar</code>包含<code class="codeph">SampleAction.class</code> ：<pre class="pre codeblock"><code>jar -cvf SampleAction.jar SampleAction.class
</code></pre></li>
                     <li>执行<code class="codeph">JaasAzn</code>应用程序，指定<ol type="a">
                           <li>通过适当的<code class="codeph">-classpath</code>子句，应该在<code class="codeph">JaasAzn.jar</code>和<code class="codeph">SampleAction.jar</code> JAR文件，</li>
                           <li>通过<code class="codeph">-Djava.security.manager</code>应该安装安全管理器，</li>
                           <li>通过<code class="codeph">-Djava.security.krb5.realm=<span class="variable" translate="no"><your_realm></span></code>您的Kerberos领域是指定的领域。
                           </li>
                           <li>通过<code class="codeph">-Djava.security.krb5.kdc=<span class="variable" translate="no"><your_kdc></span></code>您的Kerberos KDC是指定的那个。
                           </li>
                           <li>通过<code class="codeph">-Djava.security.policy=jaasazn.policy</code>要使用的策略文件是<code class="codeph">jaasazn.policy</code>和</li>
                           <li>通过<code class="codeph">-Djava.security.auth.login.config=jaas.conf</code>要使用的登录配置文件是<code class="codeph">jaas.conf</code> 。
                           </li>
                        </ol>
                        <p>以下是可用于Windows，Solaris，Linux和macOS的完整命令。唯一的区别是，在Windows上，您使用分号来分隔类路径项，而在Solaris，Linux和macOS上，则使用冒号来实现此目的。</p>
                        <div class="infoboxnote" id="GUID-F22DFBEC-7DF0-4CFB-B882-B5A58C2C76B1__GUID-727C449C-ADA7-4370-8CA3-BF4DA171C9D7">
                           <p class="notep1">注意：</p>
                           <p><span class="bold">请务必更换<code class="codeph"><span class="variable" translate="no"><your_realm></span></code>与您的Kerberos领域，以及<code class="codeph"><span class="variable" translate="no"><your_kdc></span></code>与您的Kerberos KDC。</span></p>
                        </div>
                        <p>这是Windows的完整命令：</p><pre class="pre codeblock"><code>java -classpath JaasAzn.jar;SampleAction.jar 
 -Djava.security.manager 
 -Djava.security.krb5.realm=<span class="variable" translate="no">&lt;your_realm&gt;</span> 
 -Djava.security.krb5.kdc=<span class="variable" translate="no">&lt;your_kdc&gt;</span> 
 -Djava.security.policy=jaasazn.policy 
 -Djava.security.auth.login.config=jaas.conf JaasAzn
</code></pre><p>这是针对Solaris，Linux和macOS的完整命令：</p><pre class="pre codeblock"><code>java -classpath JaasAzn.jar:SampleAction.jar 
 -Djava.security.manager 
 -Djava.security.krb5.realm=<span class="variable" translate="no">&lt;your_realm&gt;</span> 
 -Djava.security.krb5.kdc=<span class="variable" translate="no">&lt;your_kdc&gt;</span> 
 -Djava.security.policy=jaasazn.policy 
 -Djava.security.auth.login.config=jaas.conf JaasAzn
</code></pre><p>在一行上键入完整的命令。为了清晰起见，此处使用多行。如果该命令对于您的系统而言太长，则可能需要将其放置在.bat文件（对于Windows）或.sh文件（对于Solaris，Linux和macOS）中，然后运行该文件以执行命令。</p>
                        <p>系统将提示您输入Kerberos用户名和密码，并且在登录配置文件中指定的基础Kerberos身份验证机制将使您登录Kerberos。如果登录成功，您将看到消息“身份验证成功！”，如果没有，您将看到“身份验证失败”。</p>
                        <p>有关登录故障排除的建议，请参阅<a href="troubleshooting.html#GUID-2087ADBA-6C36-43D5-8841-C79FCB4F5FBE">故障排除</a> 。
                        </p>
                        <p>身份验证成功完成后，程序的其余部分（在<code class="codeph">SampleAction</code> ）将代表您（即用户）执行，要求您被授予适当的权限。的<code class="codeph">jaasazn.policy</code>策略文件会授予您所需的权限，因此您将看到您的值的显示<code class="codeph">java.home</code>和<code class="codeph">user.home</code>系统属性以及关于您是否具有名为的文件的声明<code class="codeph">foo.txt</code>在当前目录中。
                        </p>
                     </li>
                  </ol>
               </div>
            </div>
         </div>
      </article>
   

</body></html>