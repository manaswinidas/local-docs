<html lang="en-us"  xml:lang="en-us"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>JAAS Authentication Tutorial</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Security Developer’s Guide">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Security Developer’s Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="security-developer-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-21T08:42:26-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="1993, 2018">
      <meta name="dcterms.category" content="java">
      <meta name="dcterms.identifier" content="E94828-01">
      
      <meta name="dcterms.product" content="en/java/javase/11">
      <meta name="dcterms.release" content="11">
      <link rel="prev" href="jaas-tutorials.html" title="Previous" type="text/html">
      <link rel="next" href="jaas-authorization-tutorial.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"java","element_name":"Java","display_in_url":true},"suite":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product_group":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product":{"short_name":"javase","element_name":"Java SE","display_in_url":true},"release":{"short_name":"11","element_name":"11","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Security Developer Guide">
    <meta name="dcterms.isVersionOf" content="SECURITY">
  <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="jaas-tutorials.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一个</a> <a href="jaas-authorization-tutorial.html" class="pull-right">下一个<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">安全开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="java-authentication-and-authorization-service-jaas1.html" property="item" typeof="WebPage"><span property="name">Java身份验证和授权服务（JAAS）</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="jaas-tutorials.html" property="item" typeof="WebPage"><span property="name">JAAS教程</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">JAAS认证教程</li>
            </ol>
            <a id="GUID-BFEBDB00-9826-499C-A20F-E9463883DED4" name="GUID-BFEBDB00-9826-499C-A20F-E9463883DED4"></a>
            
            <h2 id="JSSEC-GUID-BFEBDB00-9826-499C-A20F-E9463883DED4" class="sect2">JAAS认证教程</h2>
         </header>
         <div class="ind">
            <div>
               <p>JAAS可以用于两个目的：</p>
               <ul style="list-style-type:disc">
                  <li>为了对用户进行<span class="variable" translate="no">authentication</span> ，无论代码是作为应用程序，applet，bean还是servlet运行，都可以可靠，安全地确定谁正在执行Java代码。和</li>
                  <li><span class="variable" translate="no">authorization</span>用户以确保他们具有执行所执行操作所需的访问控制权（权限）。
                  </li>
               </ul>
               <p>本节提供了身份验证组件的基本教程。授权组件将在<a href="jaas-authorization-tutorial.html#GUID-D43CF965-8A5F-4A23-A2AF-F41DD5F8B411">JAAS授权教程中</a>进行描述。
               </p>
               <p>JAAS认证以<span class="variable" translate="no">pluggable</span>方式执行。这允许Java应用程序保持独立于基础身份验证技术的状态。可以插入新技术或更新技术，而无需修改应用程序本身。在运行时确定要使用的特定身份验证技术的实现。该实现在登录配置文件中指定。本教程使用的身份验证技术是非常基本的，仅确保用户指定了特定的名称和密码。
               </p>
               <p>本教程的其余部分包括以下部分：</p>
               <ol>
                  <li><a href="jaas-authentication-tutorial.html#GUID-EF77AA97-CB87-4D1D-A3BF-8541FF41BA4A">认证教程代码</a></li>
                  <li><a href="jaas-authentication-tutorial.html#GUID-987700C5-AE03-4EB1-B16A-66A1404B9604">登录配置</a></li>
                  <li><a href="jaas-authentication-tutorial.html#GUID-743703A2-7EC1-4391-A816-4A883FB6A017">运行代码</a></li>
                  <li><a href="jaas-authentication-tutorial.html#GUID-44F2BF3A-F51D-4F21-8F40-96CB1120396D">使用安全管理器运行代码</a></li>
               </ol>
               <p>如果要首先查看实际使用的教程代码，则可以直接跳至“ <a href="jaas-authentication-tutorial.html#GUID-743703A2-7EC1-4391-A816-4A883FB6A017">运行代码”</a> ，然后返回其他部分以了解有关编码和配置文件的详细信息。
               </p>
            </div>
            <div class="sect2"><a id="GUID-EF77AA97-CB87-4D1D-A3BF-8541FF41BA4A" name="GUID-EF77AA97-CB87-4D1D-A3BF-8541FF41BA4A"></a><h3 id="JSSEC-GUID-EF77AA97-CB87-4D1D-A3BF-8541FF41BA4A" class="sect3">认证教程代码</h3>
               <div>
                  <p>本教程的代码包含三个文件：</p>
                  <ul style="list-style-type:disc">
                     <li><a href="jaas-authentication-tutorial.html#GUID-E007D5F4-3FA5-417A-B85F-E669839F0101__GUID-1270A0AC-EA51-4A47-B9BC-BDB42F96F5FE"><code>SampleAcn.java</code></a>包含示例应用程序类（ <code class="codeph">SampleAcn</code> ）和另一个用于处理用户输入的类（ <code class="codeph">MyCallbackHandler</code> ）。<span class="bold">该文件中的代码是本教程需要了解的唯一代码。您的应用程序将仅间接使用其他源文件。</span></li>
                     <li><a href="jaas-authentication-tutorial.html#GUID-03476CCA-11C6-4D51-B170-C8DD7C0D9075__GUID-F9A208EC-3247-4320-8158-82B0E84C6A04"><code>SampleLoginModule.java</code></a>是教程的登录配置文件指定的类， <code>sample_jass.config</code> ，在<a href="jaas-authentication-tutorial.html#GUID-A7E0803F-DA0B-42BF-8E25-DA5889BE847F">JAAS身份验证教程的登录配置文件中</a>描述为实现所需基础身份验证的类。 <code class="codeph">SampleLoginModule</code>的用户身份验证仅包含验证用户指定的名称和密码是否具有特定值。
                     </li>
                     <li><a href="jaas-authentication-tutorial.html#GUID-03476CCA-11C6-4D51-B170-C8DD7C0D9075__GUID-3EA5533B-1284-481E-A35F-C82B17837F2E"><code>SamplePrincipal.java</code></a>是实现<a href="https://docs.oracle.com/javase/10/docs/api/java/security/Principal.html" target="_blank"><span class="apiname">java.security的样本类</span></a><a href="https://docs.oracle.com/javase/10/docs/api/java/security/Principal.html" target="_blank"><span class="apiname">。主</span></a>界面。它由<code class="codeph">SampleLoginModule</code> 。
                     </li>
                  </ul>
               </div>
               <div class="sect3"><a id="GUID-01DE56D2-3A45-4C38-83EB-257783975372" name="GUID-01DE56D2-3A45-4C38-83EB-257783975372"></a><h4 id="JSSEC-GUID-01DE56D2-3A45-4C38-83EB-257783975372" class="sect4">SampleAcn.java</h4>
                  <div>
                     <p>我们的身份验证教程应用程序代码包含在一个源文件中， <code>SampleAcn.java</code> 。该文件包含两个类：</p>
                     <ul style="list-style-type:disc">
                        <li><a href="jaas-authentication-tutorial.html#GUID-8DE2AB48-46DC-4EDC-B6E1-93EE0E35D801">SampleAcn类</a></li>
                        <li><a href="jaas-authentication-tutorial.html#GUID-3D19984B-76FE-4BD6-8B21-44512936DAEE">MyCallbackHandler类</a></li>
                     </ul>
                  </div>
                  <div class="sect4"><a id="GUID-8DE2AB48-46DC-4EDC-B6E1-93EE0E35D801" name="GUID-8DE2AB48-46DC-4EDC-B6E1-93EE0E35D801"></a><h5 id="JSSEC-GUID-8DE2AB48-46DC-4EDC-B6E1-93EE0E35D801" class="sect5">SampleAcn类</h5>
                     <div>
                        <p>的<code class="codeph">main</code>的方法<code class="codeph">SampleAcn</code>类执行身份验证，然后报告身份验证是否成功。
                        </p>
                        <p>用于验证用户身份的代码非常简单，仅包含两个步骤：</p>
                        <ol>
                           <li><a href="jaas-authentication-tutorial.html#GUID-C6F31AF5-24D6-48FD-B92C-930BFC312FDE">实例化LoginContext</a></li>
                           <li><a href="jaas-authentication-tutorial.html#GUID-A2D1F3BA-3CFF-498A-A1F0-9E728C5C5C51">调用LoginContext的登录方法</a></li>
                        </ol>
                        <p>首先显示基本代码，然后<a href="jaas-authentication-tutorial.html#GUID-E007D5F4-3FA5-417A-B85F-E669839F0101">显示完整的SampleAcn类代码</a> ，以及所需的导入语句和错误处理。
                        </p>
                     </div>
                     <div class="sect5"><a id="GUID-C6F31AF5-24D6-48FD-B92C-930BFC312FDE" name="GUID-C6F31AF5-24D6-48FD-B92C-930BFC312FDE"></a><h6 id="JSSEC-GUID-C6F31AF5-24D6-48FD-B92C-930BFC312FDE" class="sect6">实例化LoginContext</h6>
                        <div>
                           <p>为了验证用户身份，您首先需要一个<code class="codeph">javax.security.auth.login.LoginContext</code> 。这是实例化LoginContext的基本方法：</p><pre class="pre codeblock"><code>
import javax.security.auth.login.*;
. . .
LoginContext lc =
    new LoginContext(&lt;config file entry name&gt;,
           &lt;CallbackHandler to be used for user interaction&gt;);
</code></pre><p>这是我们的教程代码执行实例化的特定方式：</p><pre class="pre codeblock"><code>
import javax.security.auth.login.*;
. . .
<span class="bold">LoginContext lc =
    new LoginContext("Sample",
          new MyCallbackHandler());</span>
</code></pre><p>参数如下：</p>
                           <ol>
                              <li><span class="bold">JAAS登录配置文件中的条目名称</span><p>这是<span class="apiname">LoginContext</span>的名称，用于在JAAS登录配置文件中查找此应用程序的条目，如<a href="jaas-authentication-tutorial.html#GUID-987700C5-AE03-4EB1-B16A-66A1404B9604">“登录配置”中所述</a> 。这样的条目指定了实现所需基础身份验证技术的类。该类必须实现<span class="apiname">LoginModule</span>接口，该接口位于<code class="codeph">javax.security.auth.spi</code>包。
                                 </p>
                                 <p>在示例代码中，我们使用<code class="codeph">SampleLoginModule</code>本教程随附。的<code class="codeph">SampleLoginModule</code>通过确保用户键入特定的名称和密码来执行身份验证。
                                 </p>
                                 <p>本教程使用的登录配置文件中的条目， <code>sample_jass.config</code> （请参阅<a href="jaas-authentication-tutorial.html#GUID-A7E0803F-DA0B-42BF-8E25-DA5889BE847F">《 JAAS身份验证教程</a> 》的“ <a href="jaas-authentication-tutorial.html#GUID-A7E0803F-DA0B-42BF-8E25-DA5889BE847F">登录配置文件”</a> ），名称为“ Sample”，因此这是我们指定为LoginContext构造函数的第一个参数的名称。
                                 </p>
                              </li>
                              <li><span class="bold">一个CallbackHandler实例</span><p>当<span class="apiname">LoginModule</span>需要与用户通信时（例如，要求输入用户名和密码），它不会直接进行通信。那是因为存在与用户通信的各种方式，并且希望<span class="apiname">LoginModule</span>保持独立于不同类型的用户交互。而是， <span class="apiname">LoginModule</span>调用<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/callback/CallbackHandler.html" target="_blank"><span class="apiname">javax.security.auth.callback。CallbackHandler</span></a>执行用户交互并获取请求的信息，例如用户名和密码。
                                 </p>
                                 <p>将要使用的特定<span class="apiname">CallbackHandler</span>的实例指定为<span class="apiname">LoginContext</span>构造函数的第二个参数。<span class="apiname">LoginContext</span>将实例转发到基础<span class="apiname">LoginModule</span> （在我们的示例中） <code class="codeph">SampleLoginModule</code> ）。应用程序通常提供其自己的<span class="apiname">CallbackHandler</span>实现。在中提供了一个简单的<span class="apiname">CallbackHandler</span> <span class="apiname">TextCallbackHandler</span> 。 <code class="codeph">com.sun.security.auth.callback</code>软件包以将信息输出到命令行并从命令行读取输入。但是，我们改为演示应用程序提供其自己的<span class="apiname">CallbackHandler</span>实现的更为典型的情况，如<a href="jaas-authentication-tutorial.html#GUID-3D19984B-76FE-4BD6-8B21-44512936DAEE">MyCallbackHandler Class中所述</a> 。
                                 </p>
                              </li>
                           </ol>
                        </div>
                     </div>
                     <div class="sect5"><a id="GUID-A2D1F3BA-3CFF-498A-A1F0-9E728C5C5C51" name="GUID-A2D1F3BA-3CFF-498A-A1F0-9E728C5C5C51"></a><h6 id="JSSEC-GUID-A2D1F3BA-3CFF-498A-A1F0-9E728C5C5C51" class="sect6">调用LoginContext的登录方法</h6>
                        <div>
                           <p>一旦我们有了一个<span class="apiname">LoginContext</span> <code class="codeph">lc</code> ，我们可以称之为<code class="codeph">login</code>进行身份验证过程的方法：</p><pre class="pre codeblock"><code><span class="bold">lc.login();</span>
</code></pre><p><span class="apiname">LoginContext</span>实例化一个新的空<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/Subject.html" target="_blank"><span class="apiname">javax.security.auth。主题</span></a>对象（代表正在认证的用户或服务；请参阅<a href="java-authentication-and-authorization-service-jaas-reference-guide.html#GUID-804BDE80-9E66-421C-BF0A-A96FBE7DE4E3">Subject</a> ）。<span class="apiname">LoginContext</span>构造配置的<span class="apiname">LoginModule</span> （在本例中为<code class="codeph">SampleLoginModule</code> ），并使用此新<span class="apiname">主题</span>对其进行初始化， <code class="codeph">MyCallbackHandler</code> 。
                           </p>
                           <p><span class="apiname">LoginContext</span>的<code class="codeph">login</code>然后在中调用方法<code class="codeph">SampleLoginModule</code>执行登录和身份验证。的<code class="codeph">SampleLoginModule</code>将利用<code class="codeph">MyCallbackHandler</code>获取用户名和密码。然后<code class="codeph">SampleLoginModule</code>将检查名称和密码是否与预期的相同。
                           </p>
                           <p>如果身份验证成功，则<code class="codeph">SampleLoginModule</code>用代表用户的<span class="apiname">Principal</span>填充<span class="apiname">Subject</span> 。<span class="apiname">校长</span> <code class="codeph">SampleLoginModule</code> <span class="apiname">主题中的位置</span>是的一个实例<code class="codeph">SamplePrincipal</code> ，这是实现<a href="https://docs.oracle.com/javase/10/docs/api/java/security/Principal.html" target="_blank"><span class="apiname">java.security的示例类</span></a><a href="https://docs.oracle.com/javase/10/docs/api/java/security/Principal.html" target="_blank"><span class="apiname">。主</span></a>界面。
                           </p>
                           <p>调用应用程序可以通过调用<span class="apiname">LoginContext</span>的随后检索认证<span class="apiname">主题</span> <code class="codeph">getSubject</code>方法，尽管本教程不需要这样做。
                           </p>
                        </div>
                     </div>
                     <div class="sect5"><a id="GUID-E007D5F4-3FA5-417A-B85F-E669839F0101" name="GUID-E007D5F4-3FA5-417A-B85F-E669839F0101"></a><h6 id="JSSEC-GUID-E007D5F4-3FA5-417A-B85F-E669839F0101" class="sect6">完整的SampleAcn类代码</h6>
                        <div>
                           <p>既然您已经看到了验证用户身份所需的基本代码，我们就可以将它们全部整合到<code>SampleAcn.java</code> ，其中包括相关的导入语句和错误处理：</p>
                           <div class="section" id="GUID-E007D5F4-3FA5-417A-B85F-E669839F0101__GUID-1270A0AC-EA51-4A47-B9BC-BDB42F96F5FE">
                              <p class="subhead3" id="GUID-E007D5F4-3FA5-417A-B85F-E669839F0101__GUID-C9DD1301-0FBC-4D05-BE1D-B0CFC3224C37">SampleAcn.java</p><pre class="pre codeblock"><code>package sample;

import java.io.*;
import java.util.*;
import javax.security.auth.login.*;
import javax.security.auth.*;
import javax.security.auth.callback.*;

/**
 * This Sample application attempts to authenticate a user
 * and reports whether or not the authentication was successful.
 */
public class <span class="bold">SampleAcn</span> {

   /**
    * Attempt to authenticate the user.
    *
    * @param args input arguments for this application.  These are ignored.
    */
    public static void main(String[] args) {

        // Obtain a LoginContext, needed for authentication. Tell it
        // to use the LoginModule implementation specified by the
        // entry named "Sample" in the JAAS login configuration
        // file and to also use the specified CallbackHandler.
        LoginContext lc = null;
        try {
            <span class="bold">lc = new LoginContext("Sample", new MyCallbackHandler());</span>
        } catch (LoginException le) {
            System.err.println("Cannot create LoginContext. "
                + le.getMessage());
            System.exit(-1);
        } catch (SecurityException se) {
            System.err.println("Cannot create LoginContext. "
                + se.getMessage());
            System.exit(-1);
        }

        // the user has 3 attempts to authenticate successfully
        int i;
        for (i = 0; i &lt; 3; i++) {
            try {

                // attempt authentication
                <span class="bold">lc.login();</span>

                // if we return with no exception, authentication succeeded
                break;

            } catch (LoginException le) {

                  System.err.println("Authentication failed:");
                  System.err.println("  " + le.getMessage());
                  try {
                      Thread.currentThread().sleep(3000);
                  } catch (Exception e) {
                      // ignore
                  }

            }
        }

        // did they fail three times?
        if (i == 3) {
            System.out.println("Sorry");
            System.exit(-1);
        }

        System.out.println("Authentication succeeded!");

    }
}


/**
 * The application implements the CallbackHandler.
 *
 * &lt;p&gt; This application is text-based.  Therefore it displays information
 * to the user using the OutputStreams System.out and System.err,
 * and gathers input from the user using the InputStream System.in.
 */
class MyCallbackHandler implements CallbackHandler {

    /**
     * Invoke an array of Callbacks.
     *
     * &lt;p&gt;
     *
     * @param callbacks an array of &lt;code&gt;Callback&lt;/code&gt; objects which contain
     *                  the information requested by an underlying security
     *                  service to be retrieved or displayed.
     *
     * @exception java.io.IOException if an input or output error occurs. &lt;p&gt;
     *
     * @exception UnsupportedCallbackException if the implementation of this
     *                  method does not support one or more of the Callbacks
     *                  specified in the &lt;code&gt;callbacks&lt;/code&gt; parameter.
     */
    public void handle(Callback[] callbacks)
    throws IOException, UnsupportedCallbackException {

        for (int i = 0; i &lt; callbacks.length; i++) {
            if (callbacks[i] instanceof TextOutputCallback) {

                // display the message according to the specified type
                TextOutputCallback toc = (TextOutputCallback)callbacks[i];
                switch (toc.getMessageType()) {
                case TextOutputCallback.INFORMATION:
                    System.out.println(toc.getMessage());
                    break;
                case TextOutputCallback.ERROR:
                    System.out.println("ERROR: " + toc.getMessage());
                    break;
                case TextOutputCallback.WARNING:
                    System.out.println("WARNING: " + toc.getMessage());
                    break;
                default:
                    throw new IOException("Unsupported message type: " +
                                        toc.getMessageType());
                }

            } else if (callbacks[i] instanceof NameCallback) {

                // prompt the user for a username
                NameCallback nc = (NameCallback)callbacks[i];

                System.err.print(nc.getPrompt());
                System.err.flush();
                nc.setName((new BufferedReader
                        (new InputStreamReader(System.in))).readLine());

            } else if (callbacks[i] instanceof PasswordCallback) {

                // prompt the user for sensitive information
                PasswordCallback pc = (PasswordCallback)callbacks[i];
                System.err.print(pc.getPrompt());
                System.err.flush();
                pc.setPassword(System.console().readPassword());

            } else {
                throw new UnsupportedCallbackException
                        (callbacks[i], "Unrecognized Callback");
            }
        }
    }
}
</code></pre></div>
                           <!-- class="section" -->
                        </div>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-3D19984B-76FE-4BD6-8B21-44512936DAEE" name="GUID-3D19984B-76FE-4BD6-8B21-44512936DAEE"></a><h5 id="JSSEC-GUID-3D19984B-76FE-4BD6-8B21-44512936DAEE" class="sect5">MyCallbackHandler类</h5>
                     <div>
                        <p>在某些情况下， <span class="apiname">LoginModule</span>必须与用户通信以获得身份验证信息。<span class="apiname">LoginModule</span>的使用<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/callback/CallbackHandler.html" target="_blank"><code class="codeph">javax.security.auth.callback.CallbackHandler</code></a>以此目的。应用程序可以使用以下示例中提供的示例实现之一<code class="codeph">com.sun.security.auth.callback</code>包，或更常见的是编写<span class="apiname">CallbackHandler</span>实现。应用程序将<span class="apiname">CallbackHandler</span>作为参数传递给<span class="apiname">LoginContext</span>实例。<span class="apiname">LoginContext</span>将<span class="apiname">CallbackHandler</span>直接转发到基础<span class="apiname">LoginModule</span> 。
                        </p>
                        <p>教程示例代码提供了自己的<span class="apiname">CallbackHandler</span>实现， <code class="codeph">MyCallbackHandler</code>上课<a href="jaas-authentication-tutorial.html#GUID-01DE56D2-3A45-4C38-83EB-257783975372"><code></code></a> 。
                        </p>
                        <p><span class="apiname">CallbackHandler</span>是一个具有一种实现方法的接口：</p><pre class="pre codeblock"><code>     void handle(Callback[] callbacks)
         throws java.io.IOException, UnsupportedCallbackException;
</code></pre><p><span class="apiname">LoginModule</span>将适当的<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/callback/Callback.html" target="_blank"><span class="apiname">javax.security.auth.callback数组传递给<span class="apiname">CallbackHandler</span>处理方法</span></a><a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/callback/Callback.html" target="_blank"><span class="apiname">。Callback</span></a> ，例如，用于用户名的<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/callback/NameCallback.html" target="_blank"><span class="apiname">NameCallback</span></a>和用于<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/callback/PasswordCallback.html" target="_blank"><span class="apiname">密码</span></a>的PasswordCallback，并且<span class="apiname">CallbackHandler</span>执行请求的用户交互并在<span class="apiname">Callback中</span>设置适当的值。
                        </p>
                        <p>的<code class="codeph">MyCallbackHandler</code><code class="codeph">handle</code>方法的结构如下：</p><pre class="pre codeblock"><code>public void handle(Callback[] callbacks)
  throws IOException, UnsupportedCallbackException {

  for (int i = 0; i &lt; callbacks.length; i++) {
    if (callbacks[i] instanceof TextOutputCallback) {

      // display a message according to a specified type
      . . .

    } else if (callbacks[i] instanceof NameCallback) {

      // prompt the user for a username
      . . .

    } else if (callbacks[i] instanceof PasswordCallback) {

      // prompt the user for a password
      . . .

    } else {
        throw new UnsupportedCallbackException
         (callbacks[i], "Unrecognized Callback");
    }
  }
}
</code></pre><p>一个<span class="apiname">CallbackHandler</span> <span class="apiname">句柄</span>方法被传递一个<span class="apiname">Callback</span>实例数组，每个实例都有一个特定的类型（ <span class="apiname">NameCallback</span> ， <span class="apiname">PasswordCallback</span>等）。它必须处理每个回调，并以适合于正在执行的应用程序的方式执行用户交互。
                        </p>
                        <p><code class="codeph">MyCallbackHandler</code>处理三种类型的回调： <span class="bold"><span class="apiname">NameCallback</span></span>提示用户输入用户名， <span class="bold"><span class="apiname">PasswordCallback</span></span>提示输入密码， <span class="bold"><span class="apiname">TextOutputCallback</span></span>报告任何错误，警告或<span class="apiname">SampleLoginModule</span>希望发送给用户的其他消息。
                        </p>
                        <p><span class="apiname">handle</span>方法通过提取要报告的消息然后将其打印<span class="bold"><span class="apiname">到来</span></span>处理<span class="bold"><span class="apiname">TextOutputCallback</span></span> 。 <code class="codeph">System.out<span class="apiname"></span></code> ，还可以在其前面加上取决于消息类型的其他措辞。通过调用<span class="apiname">TextOutputCallback</span>的<span class="apiname">getMessage</span>方法确定要报告的消息，并通过调用其<span class="apiname">getMessageType</span>方法确定消息的类型。这是用于处理<span class="apiname">TextOutputCallback</span>的代码：</p><pre class="pre codeblock"><code>if (callbacks[i] instanceof TextOutputCallback) {

  // display the message according to the specified type
  TextOutputCallback toc = (TextOutputCallback)callbacks[i];
  switch (toc.getMessageType()) {
     case TextOutputCallback.INFORMATION:
        System.out.println(toc.getMessage());
        break;
     case TextOutputCallback.ERROR:
        System.out.println("ERROR: " + toc.getMessage());
        break;
     case TextOutputCallback.WARNING:
        System.out.println("WARNING: " + toc.getMessage());
        break;
     default:
        throw new IOException("Unsupported message type: " +
            toc.getMessageType());
   }
</code></pre><p>的<code class="codeph">handle</code>方法通过提示用户输入用户名来处理<span class="bold"><span class="apiname">NameCallback</span></span> 。它通过将提示打印到<code class="codeph">System.err</code> 。然后，它设置名称以供<code class="codeph">SampleLoginModule</code>通过调用<span class="apiname">NameCallback</span>的<code class="codeph">setName</code>方法，向其传递用户键入的名称：</p><pre class="pre codeblock"><code>} else if (callbacks[i] instanceof NameCallback) {

    // prompt the user for a username
    NameCallback nc = (NameCallback)callbacks[i];

    System.err.print(nc.getPrompt());
    System.err.flush();
    nc.setName((new BufferedReader
        (new InputStreamReader(System.in))).readLine());
</code></pre><p>同样， <code class="codeph">handle</code>方法通过将提示打印到来处理<span class="bold"><span class="apiname">PasswordCallback</span></span> <code class="codeph">System.err</code>提示用户输入密码。然后，它设置密码以供<code class="codeph">SampleLoginModule</code>通过调用<span class="apiname">PasswordCallback</span>的<code class="codeph">setPassword</code>方法，向其传递用户键入的密码：</p><pre class="pre codeblock"><code>} else if (callbacks[i] instanceof PasswordCallback) {

    // prompt the user for sensitive information
    PasswordCallback pc = (PasswordCallback)callbacks[i];

    System.err.print(pc.getPrompt());
    System.err.flush();
    pc.setPassword(System.console().readPassword());
</code></pre></div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-03476CCA-11C6-4D51-B170-C8DD7C0D9075" name="GUID-03476CCA-11C6-4D51-B170-C8DD7C0D9075"></a><h4 id="JSSEC-GUID-03476CCA-11C6-4D51-B170-C8DD7C0D9075" class="sect4">SampleLoginModule.java和SamplePrincipal.java</h4>
                  <div>
                     <p><code>SampleLoginModule.java</code>实现<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/spi/LoginModule.html" target="_blank"><code class="codeph">LoginModule</code></a>接口。 <code class="codeph">SampleLoginModule</code>是由教程的登录配置文件（请参阅<a href="jaas-authentication-tutorial.html#GUID-A7E0803F-DA0B-42BF-8E25-DA5889BE847F">JAAS Authentication Tutorial的登录配置文件</a> ）指定的类，作为实现所需基础身份验证的类。 <code class="codeph">SampleLoginModule</code>的用户身份验证仅包含验证用户指定的名称和密码是否具有特定值。这个<code class="codeph">SampleLoginModule</code>由教程的登录配置文件指定为<span class="apiname">LoginModule</span>来使用，因为（1）它执行适合于任何环境的基本身份验证类型，因此适合所有用户的教程，并且（2）提供了一个示例<span class="apiname">LoginModule</span>实现，用于经验丰富的程序员，需要具备编写实现身份验证技术的<span class="apiname">LoginModule</span>的能力。
                     </p>
                     <p><code>SamplePrincipal.java</code>是实现<a href="https://docs.oracle.com/javase/10/docs/api/java/security/Principal.html" target="_blank"><span class="apiname">java.security的样本类</span></a><a href="https://docs.oracle.com/javase/10/docs/api/java/security/Principal.html" target="_blank"><span class="apiname">。主</span></a>界面。如果身份验证成功，则<code class="codeph">SampleLoginModule</code>向<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/Subject.html" target="_blank"><span class="apiname">主题</span></a>填充<code class="codeph">SamplePrincipal</code>代表用户。
                     </p>
                     <p><span class="bold">重要说明：如果您是应用程序编写者，则无需知道如何编写<span class="apiname">LoginModule</span>或<span class="apiname">Principal</span>实现。您无需检查<code class="codeph">SampleLoginModule</code>要么<code class="codeph">SamplePrincipal</code>码。</span> 您所需要知道的就是如何编写应用程序并指定配置信息（例如在登录配置文件中），以便应用程序能够利用配置指定的<span class="apiname">LoginModule</span>来对用户进行身份验证。您需要确定要使用哪个<span class="apiname">LoginModule</span> ，并阅读<span class="apiname">LoginModule</span>的文档，以了解可以为（在配置中）指定值的哪些选项来控制<span class="apiname">LoginModule</span>的行为。
                     </p>
                     <p>任何供应商都可以提供您可以使用的LoginModule实现。Oracle的JRE提供了一些实现，如<a href="appendix-b-jaas-login-configuration-file.html#GUID-7EB80FA5-3C16-4016-AED6-0FC619F86F8E">附录B：JAAS登录配置文件中</a>所列。
                     </p>
                     <p>可以在<a href="java-authentication-and-authorization-service-jaas-loginmodule-developers-guide1.html#GUID-CB46C30D-FFF1-466F-B2F5-6DE0BD5DA43A">Java身份验证和授权服务（JAAS）中</a>找到要编写<span class="apiname">LoginModule的</span>程序员的信息<a href="java-authentication-and-authorization-service-jaas-loginmodule-developers-guide1.html#GUID-CB46C30D-FFF1-466F-B2F5-6DE0BD5DA43A">：LoginModule开发人员指南</a> 。
                     </p>
                     <div class="section" id="GUID-03476CCA-11C6-4D51-B170-C8DD7C0D9075__GUID-F9A208EC-3247-4320-8158-82B0E84C6A04">
                        <p class="subhead3" id="GUID-03476CCA-11C6-4D51-B170-C8DD7C0D9075__GUID-E4CB42A8-307A-4553-A268-871E4A5EC867">SampleLoginModule.java</p><pre class="pre codeblock"><code>package sample.module;

import java.util.*;
import java.io.IOException;
import javax.security.auth.*;
import javax.security.auth.callback.*;
import javax.security.auth.login.*;
import javax.security.auth.spi.*;
import sample.principal.SamplePrincipal;

/**
 * &lt;p&gt; This sample LoginModule authenticates users with a password.
 *
 * &lt;p&gt; This LoginModule only recognizes one user:       testUser
 * &lt;p&gt; testUser's password is:  testPassword
 *
 * &lt;p&gt; If testUser successfully authenticates itself,
 * a &lt;code&gt;SamplePrincipal&lt;/code&gt; with the testUser's user name
 * is added to the Subject.
 *
 * &lt;p&gt; This LoginModule recognizes the debug option.
 * If set to true in the login Configuration,
 * debug messages will be output to the output stream, System.out.
 *
 */
public class SampleLoginModule implements LoginModule {

    // initial state
    private Subject subject;
    private CallbackHandler callbackHandler;
    private Map sharedState;
    private Map options;

    // configurable option
    private boolean debug = false;

    // the authentication status
    private boolean succeeded = false;
    private boolean commitSucceeded = false;

    // username and password
    private String username;
    private char[] password;

    // testUser's SamplePrincipal
    private SamplePrincipal userPrincipal;

    /**
     * Initialize this &lt;code&gt;LoginModule&lt;/code&gt;.
     *
     * @param subject the &lt;code&gt;Subject&lt;/code&gt; to be authenticated. &lt;p&gt;
     *
     * @param callbackHandler a &lt;code&gt;CallbackHandler&lt;/code&gt; for communicating
     *                  with the end user (prompting for user names and
     *                  passwords, for example). &lt;p&gt;
     *
     * @param sharedState shared &lt;code&gt;LoginModule&lt;/code&gt; state. &lt;p&gt;
     *
     * @param options options specified in the login
     *                  &lt;code&gt;Configuration&lt;/code&gt; for this particular
     *                  &lt;code&gt;LoginModule&lt;/code&gt;.
     */
    public void initialize(Subject subject,
                   CallbackHandler callbackHandler,
                         Map&lt;java.lang.String, ?&gt; sharedState,
                         Map&lt;java.lang.String, ?&gt; options) {

        this.subject = subject;
        this.callbackHandler = callbackHandler;
        this.sharedState = sharedState;
        this.options = options;

        // initialize any configured options
        debug = "true".equalsIgnoreCase((String)options.get("debug"));
    }

    /**
     * Authenticate the user by prompting for a user name and password.
     *
     * @return true in all cases since this &lt;code&gt;LoginModule&lt;/code&gt;
     *          should not be ignored.
     *
     * @exception FailedLoginException if the authentication fails. &lt;p&gt;
     *
     * @exception LoginException if this &lt;code&gt;LoginModule&lt;/code&gt;
     *          is unable to perform the authentication.
     */
    public boolean login() throws LoginException {

        // prompt for a user name and password
        if (callbackHandler == null)
            throw new LoginException("Error: no CallbackHandler available " +
                        "to garner authentication information from the user");

        Callback[] callbacks = new Callback[2];
        callbacks[0] = new NameCallback("user name: ");
        callbacks[1] = new PasswordCallback("password: ", false);

        try {
            callbackHandler.handle(callbacks);
            username = ((NameCallback)callbacks[0]).getName();
            char[] tmpPassword = ((PasswordCallback)callbacks[1]).getPassword();
            if (tmpPassword == null) {
                // treat a NULL password as an empty password
                tmpPassword = new char[0];
            }
            password = new char[tmpPassword.length];
            System.arraycopy(tmpPassword, 0,
                        password, 0, tmpPassword.length);
            ((PasswordCallback)callbacks[1]).clearPassword();

        } catch (java.io.IOException ioe) {
            throw new LoginException(ioe.toString());
        } catch (UnsupportedCallbackException uce) {
            throw new LoginException("Error: " + uce.getCallback().toString() +
                " not available to garner authentication information " +
                "from the user");
        }

        // print debugging information
        if (debug) {
            System.out.println("\t\t[SampleLoginModule] " +
                                "user entered user name: " +
                                username);
            System.out.print("\t\t[SampleLoginModule] " +
                                "user entered password: ");
            for (int i = 0; i &lt; password.length; i++)
                System.out.print(password[i]);
            System.out.println();
        }

        // verify the username/password
        boolean usernameCorrect = false;
        boolean passwordCorrect = false;
        if (username.equals("testUser"))
            usernameCorrect = true;
        if (usernameCorrect &amp;&amp;
            password.length == 12 &amp;&amp;
            password[0] == 't' &amp;&amp;
            password[1] == 'e' &amp;&amp;
            password[2] == 's' &amp;&amp;
            password[3] == 't' &amp;&amp;
            password[4] == 'P' &amp;&amp;
            password[5] == 'a' &amp;&amp;
            password[6] == 's' &amp;&amp;
            password[7] == 's' &amp;&amp;
            password[8] == 'w' &amp;&amp;
            password[9] == 'o' &amp;&amp;
            password[10] == 'r' &amp;&amp;
            password[11] == 'd') {

            // authentication succeeded!!!
            passwordCorrect = true;
            if (debug)
                System.out.println("\t\t[SampleLoginModule] " +
                                "authentication succeeded");
            succeeded = true;
            return true;
        } else {

            // authentication failed -- clean out state
            if (debug)
                System.out.println("\t\t[SampleLoginModule] " +
                                "authentication failed");
            succeeded = false;
            username = null;
            for (int i = 0; i &lt; password.length; i++)
                password[i] = ' ';
            password = null;
            if (!usernameCorrect) {
                throw new FailedLoginException("User Name Incorrect");
            } else {
                throw new FailedLoginException("Password Incorrect");
            }
        }
    }

    /**
     * This method is called if the LoginContext's
     * overall authentication succeeded
     * (the relevant REQUIRED, REQUISITE, SUFFICIENT and OPTIONAL LoginModules
     * succeeded).
     *
     * If this LoginModule's own authentication attempt
     * succeeded (checked by retrieving the private state saved by the
     * &lt;code&gt;login&lt;/code&gt; method), then this method associates a
     * &lt;code&gt;SamplePrincipal&lt;/code&gt;
     * with the &lt;code&gt;Subject&lt;/code&gt; located in the
     * &lt;code&gt;LoginModule&lt;/code&gt;.  If this LoginModule's own
     * authentication attempted failed, then this method removes
     * any state that was originally saved.
     *
     * @exception LoginException if the commit fails.
     *
     * @return true if this LoginModule's own login and commit
     *          attempts succeeded, or false otherwise.
     */
    public boolean commit() throws LoginException {
        if (succeeded == false) {
            return false;
        } else {
            // add a Principal (authenticated identity)
            // to the Subject

            // assume the user we authenticated is the SamplePrincipal
            userPrincipal = new SamplePrincipal(username);
            if (!subject.getPrincipals().contains(userPrincipal))
                subject.getPrincipals().add(userPrincipal);

            if (debug) {
                System.out.println("\t\t[SampleLoginModule] " +
                                "added SamplePrincipal to Subject");
            }

            // in any case, clean out state
            username = null;
            for (int i = 0; i &lt; password.length; i++)
                password[i] = ' ';
            password = null;

            commitSucceeded = true;
            return true;
        }
    }

    /**
     * This method is called if the LoginContext's
     * overall authentication failed.
     * (the relevant REQUIRED, REQUISITE, SUFFICIENT and OPTIONAL LoginModules
     * did not succeed).
     *
     * If this LoginModule's own authentication attempt
     * succeeded (checked by retrieving the private state saved by the
     * &lt;code&gt;login&lt;/code&gt; and &lt;code&gt;commit&lt;/code&gt; methods),
     * then this method cleans up any state that was originally saved.
     *
     * @exception LoginException if the abort fails.
     *
     * @return false if this LoginModule's own login and/or commit attempts
     *          failed, and true otherwise.
     */
    public boolean abort() throws LoginException {
        if (succeeded == false) {
            return false;
        } else if (succeeded == true &amp;&amp; commitSucceeded == false) {
            // login succeeded but overall authentication failed
            succeeded = false;
            username = null;
            if (password != null) {
                for (int i = 0; i &lt; password.length; i++)
                    password[i] = ' ';
                password = null;
            }
            userPrincipal = null;
        } else {
            // overall authentication succeeded and commit succeeded,
            // but someone else's commit failed
            logout();
        }
        return true;
    }

    /**
     * Logout the user.
     *
     * This method removes the &lt;code&gt;SamplePrincipal&lt;/code&gt;
     * that was added by the &lt;code&gt;commit&lt;/code&gt; method.
     *
     * @exception LoginException if the logout fails.
     *
     * @return true in all cases since this &lt;code&gt;LoginModule&lt;/code&gt;
     *          should not be ignored.
     */
    public boolean logout() throws LoginException {

        subject.getPrincipals().remove(userPrincipal);
        succeeded = false;
        succeeded = commitSucceeded;
        username = null;
        if (password != null) {
            for (int i = 0; i &lt; password.length; i++)
                password[i] = ' ';
            password = null;
        }
        userPrincipal = null;
        return true;
    }
}
</code></pre></div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-03476CCA-11C6-4D51-B170-C8DD7C0D9075__GUID-3EA5533B-1284-481E-A35F-C82B17837F2E">
                        <p class="subhead3" id="GUID-03476CCA-11C6-4D51-B170-C8DD7C0D9075__GUID-EA20B159-33AD-4107-84F8-5291E1887DBA">SamplePrincipal.java</p><pre class="pre codeblock"><code>package sample.principal;

import java.security.Principal;

/**
 * This class implements the &lt;code&gt;Principal&lt;/code&gt; interface
 * and represents a Sample user.
 *
 * Principals such as this &lt;code&gt;SamplePrincipal&lt;/code&gt;
 * may be associated with a particular &lt;code&gt;Subject&lt;/code&gt;
 * to augment that &lt;code&gt;Subject&lt;/code&gt; with an additional
 * identity.  Refer to the &lt;code&gt;Subject&lt;/code&gt; class for more information
 * on how to achieve this.  Authorization decisions can then be based upon
 * the Principals associated with a &lt;code&gt;Subject&lt;/code&gt;.
 *
 * @see java.security.Principal
 * @see javax.security.auth.Subject
 */
public class SamplePrincipal implements Principal, java.io.Serializable {

    /**
     * @serial
     */
    private String name;

    /**
     * Create a SamplePrincipal with a Sample username.
     *
     * @param name the Sample username for this user.
     *
     * @exception NullPointerException if the &lt;code&gt;name&lt;/code&gt;
     *                  is &lt;code&gt;null&lt;/code&gt;.
     */
    public SamplePrincipal(String name) {
        if (name == null)
            throw new NullPointerException("illegal null input");

        this.name = name;
    }

    /**
     * Return the Sample username for this &lt;code&gt;SamplePrincipal&lt;/code&gt;.
     *
     * @return the Sample username for this &lt;code&gt;SamplePrincipal&lt;/code&gt;
     */
    public String getName() {
        return name;
    }

    /**
     * Return a string representation of this &lt;code&gt;SamplePrincipal&lt;/code&gt;.
     *
     * @return a string representation of this &lt;code&gt;SamplePrincipal&lt;/code&gt;.
     */
    public String toString() {
        return("SamplePrincipal:  " + name);
    }

    /**
     * Compares the specified Object with this &lt;code&gt;SamplePrincipal&lt;/code&gt;
     * for equality.  Returns true if the given object is also a
     * &lt;code&gt;SamplePrincipal&lt;/code&gt; and the two SamplePrincipals
     * have the same username.
     *
     * @param o Object to be compared for equality with this
     *          &lt;code&gt;SamplePrincipal&lt;/code&gt;.
     *
     * @return true if the specified Object is equal equal to this
     *          &lt;code&gt;SamplePrincipal&lt;/code&gt;.
     */
    public boolean equals(Object o) {
        if (o == null)
            return false;

        if (this == o)
            return true;

        if (!(o instanceof SamplePrincipal))
            return false;
        SamplePrincipal that = (SamplePrincipal)o;

        if (this.getName().equals(that.getName()))
            return true;
        return false;
    }

    /**
     * Return a hash code for this &lt;code&gt;SamplePrincipal&lt;/code&gt;.
     *
     * @return a hash code for this &lt;code&gt;SamplePrincipal&lt;/code&gt;.
     */
    public int hashCode() {
        return name.hashCode();
    }
}
</code></pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-987700C5-AE03-4EB1-B16A-66A1404B9604" name="GUID-987700C5-AE03-4EB1-B16A-66A1404B9604"></a><h3 id="JSSEC-GUID-987700C5-AE03-4EB1-B16A-66A1404B9604" class="sect3">登录配置</h3>
               <div>
                  <p>JAAS身份验证以可插入方式执行，因此应用程序可以保持独立于基础身份验证技术的状态。系统管理员确定将用于每个应用程序的身份验证技术或<span class="apiname">LoginModule</span> ，并在登录<span class="apiname">Configuration中</span>对其进行<span class="apiname">配置</span> 。配置信息的来源（例如，文件或数据库）取决于当前的<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/login/Configuration.html" target="_blank"><span class="apiname">javax.security.auth.login。配置</span></a>实施。默认值<code class="codeph">Configuration</code>如<a href="https://docs.oracle.com/javase/10/docs/api/com/sun/security/auth/login/ConfigFile.html" target="_blank"><span class="apiname">ConfigFile</span></a>类中所述，Oracle的实现从配置文件中读取配置信息。
                  </p>
                  <p>有关什么是登录配置文件，包含的内容以及如何指定应使用哪个登录配置文件的信息，请参见<a href="appendix-b-jaas-login-configuration-file.html#GUID-7EB80FA5-3C16-4016-AED6-0FC619F86F8E">附录B：JAAS登录配置文件</a> 。
                  </p>
               </div>
               <div class="sect3"><a id="GUID-A7E0803F-DA0B-42BF-8E25-DA5889BE847F" name="GUID-A7E0803F-DA0B-42BF-8E25-DA5889BE847F"></a><h4 id="JSSEC-GUID-A7E0803F-DA0B-42BF-8E25-DA5889BE847F" class="sect4">JAAS认证教程的登录配置文件</h4>
                  <div>
                     <p>如前所述，我们在本教程中使用的登录配置文件<code>sample_jass.config</code> ，仅包含一个条目，即</p><pre class="pre codeblock"><code><span class="bold">Sample {
  sample.module.SampleLoginModule required debug=true;
};</span>
</code></pre><p>此项名为“ Sample”，即我们的教程应用程序的名称， <code class="codeph">SampleAcn</code> ，用于引用该条目。该条目指定用于执行用户身份验证的<span class="apiname">LoginModule</span>是<code class="codeph">SampleLoginModule</code>在里面<code class="codeph">sample.module</code>包和这个<code class="codeph">SampleLoginModule</code>必须“成功”才能使认证成功。的<code class="codeph">SampleLoginModule</code>仅当用户提供的名称和密码与期望的名称和密码（分别为“ testUser”和“ testPassword”）相匹配时，成功。
                     </p>
                     <p>的<code class="codeph">SampleLoginModule</code>还定义了一个“调试”选项，可以将其设置为<code class="codeph">true</code>如图所示。如果此选项设置为<code class="codeph">true,</code><code class="codeph">SampleLoginModule</code>输出有关身份验证进度的其他信息。<span class="apiname">LoginModule</span>可以根据需要定义尽可能多的选项。<span class="apiname">LoginModule</span>文档应指定可能在配置文件中设置的选项名称和值。
                     </p>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-743703A2-7EC1-4391-A816-4A883FB6A017" name="GUID-743703A2-7EC1-4391-A816-4A883FB6A017"></a><h3 id="JSSEC-GUID-743703A2-7EC1-4391-A816-4A883FB6A017" class="sect3">运行代码</h3>
               <div>
                  <p>要执行我们的JAAS认证教程代码，您要做的就是</p>
                  <ol>
                     <li>
                        <p>将以下文件放入目录：</p>
                        <ul style="list-style-type:disc">
                           <li><span class="apiname">sample_jass.config</span>登录配置文件（请参阅<a href="jaas-authentication-tutorial.html#GUID-A7E0803F-DA0B-42BF-8E25-DA5889BE847F">JAAS认证教程的登录配置文件</a> ）</li>
                        </ul>
                     </li>
                     <li>
                        <p>创建一个名为该顶级目录的<span class="apiname">sample</span>子目录，并将以下内容放入其中（请注意<code class="codeph">SampleAcn</code>和<span class="apiname">MyCallbackHandler</span>类，都在<code class="codeph">SampleAcn.java</code> ，位于名为<code class="codeph">sample</code> ）：</p>
                        <ul style="list-style-type:disc">
                           <li><a href="jaas-authentication-tutorial.html#GUID-E007D5F4-3FA5-417A-B85F-E669839F0101__GUID-1270A0AC-EA51-4A47-B9BC-BDB42F96F5FE"><code>SampleAcn.java</code></a>应用程序源文件</li>
                        </ul>
                     </li>
                     <li>
                        <p>创建一个子目录<code>sample</code>目录并命名<code>module</code> 。将以下内容放入其中（请注意<code>SampleLoginModule</code>类在名为的包中<code class="codeph">sample.module</code> ）：</p>
                        <ul style="list-style-type:disc">
                           <li><a href="jaas-authentication-tutorial.html#GUID-03476CCA-11C6-4D51-B170-C8DD7C0D9075__GUID-F9A208EC-3247-4320-8158-82B0E84C6A04"><code>SampleLoginModule.java</code></a>源文件</li>
                        </ul>
                     </li>
                     <li>创建另一个子目录<code>sample</code>目录并命名<code>principal</code> 。将以下内容放入其中（请注意<code class="codeph">SamplePrincipal</code>类在名为的包中<code class="codeph">sample.principal</code> ）：<ul style="list-style-type:disc">
                           <li><a href="jaas-authentication-tutorial.html#GUID-03476CCA-11C6-4D51-B170-C8DD7C0D9075__GUID-3EA5533B-1284-481E-A35F-C82B17837F2E"><code>SamplePrincipal.java</code></a>源文件</li>
                        </ul>
                     </li>
                     <li>
                        <p>在顶级目录中时，进行编译<code class="codeph">SampleAcn.java</code> ， <code class="codeph">SampleLoginModule.java</code>和<code class="codeph">SamplePrincipal.java</code> ：</p> 
                        <p><code class="codeph">javac sample/SampleAcn.java sample/module/SampleLoginModule.java sample/principal/SamplePrincipal.java</code></p>
                        <p>（在一行上键入所有内容。）</p>
                     </li>
                     <li>执行<code class="codeph">SampleAcn</code>应用程序，指定<ul style="list-style-type:disc">
                           <li>通过<code class="codeph">-Djava.security.auth.login.config==sample_jaas.config</code>要使用的登录配置文件是<code class="codeph">sample_jaas.config</code> 。
                           </li>
                        </ul>
                     </li>
                  </ol>
                  <p>完整命令如下。</p><pre class="pre codeblock"><code>java -Djava.security.auth.login.config==sample_jaas.config sample.SampleAcn
</code></pre><p>系统将提示您输入用户名和密码，然后<code class="codeph">SampleLoginModule</code>在登录配置文件中指定的名称将进行检查以确保它们是正确的。的<code class="codeph">SampleLoginModule</code>期望<code class="codeph">testUser</code>用户名和<code class="codeph">testPassword</code>输入密码。
                  </p>
                  <p>您会看到一些消息的输出<code class="codeph">SampleLoginModule</code>由于<code class="codeph">debug</code>选项设置为<code class="codeph">true</code>在登录配置文件中。然后，如果登录成功，您将看到<span class="apiname">SampleAcn</span>输出以下消息：</p><pre class="pre codeblock"><code>Authentication succeeded!
</code></pre><p>如果登录失败（例如，拼写错误的密码），您将看到</p><pre class="pre codeblock"><code>Authentication failed:
</code></pre><p>其次是失败的原因。例如，如果您输错密码，则可能会看到类似以下的消息：</p><pre class="pre codeblock"><code>Authentication failed:
  Password Incorrect
</code></pre><p><span class="apiname">SampleAcn</span>为您提供三种成功登录的机会。
                  </p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-44F2BF3A-F51D-4F21-8F40-96CB1120396D" name="GUID-44F2BF3A-F51D-4F21-8F40-96CB1120396D"></a><h3 id="JSSEC-GUID-44F2BF3A-F51D-4F21-8F40-96CB1120396D" class="sect3">使用安全管理器运行代码</h3>
               <div>
                  <p>当Java程序在安装了安全管理器的情况下运行时，除非有效的安全策略明确授予该程序访问资源的权限，否则不允许该程序访问资源或执行其他对安全性敏感的操作。（请参阅<a href="permissions-jdk1.html#GUID-1E8E213A-D7F2-49F1-A2F0-EFB3397A8C95" title="权限表示对系统资源的访问。为了允许对applet（或使用安全管理器运行的应用程序）进行资源访问，必须将相应的权限显式授予尝试访问的代码。">JDK中的权限</a> 。）该权限必须由策略文件中的条目授予（请参阅<a href="permissions-jdk1.html#GUID-789089CA-8557-4017-B8B0-6899AD3BA18D">默认策略实现和策略文件语法）</a> 。
                  </p>
                  <p>大多数浏览器都安装了安全管理器，因此<span class="variable" translate="no">applets</span>通常在安全管理器的审查下运行。另一方面， <span class="variable" translate="no">Applications</span>则不会，因为在运行应用程序时不会自动安装安全管理器。因此，像我们这样的应用程序<code class="codeph">SampleAcn</code>应用程序，默认情况下具有对资源的完全访问权限。
                  </p>
                  <p><span class="bold">要使用安全管理器运行应用程序</span> ，只需使用以下命令调用解释器： <code class="codeph">-Djava.security.manager</code>命令行中包含的参数。
                  </p>
                  <p>如果您尝试调用<code class="codeph">SampleAcn</code>使用安全管理器但未指定任何策略文件，您将获得以下内容（除非您在其他地方具有默认的策略设置，该默认策略设置授予了必需的权限或授权<code class="codeph">AllPermission</code> ）：</p><pre class="pre codeblock"><code>% java -Djava.security.manager \
 -Djava.security.auth.login.config==sample_jaas.config sample.SampleAcn
Exception in thread "main" java.security.AccessControlException:
  access denied (
  javax.security.auth.AuthPermission createLoginContext.Sample)
</code></pre><p>如您所见，您将获得一个<span class="apiname">AccessControlException</span> ，因为我们还没有创建和使用一个策略文件来向我们的代码授予允许创建<span class="apiname">LoginContext</span>所需的权限。
                  </p>
                  <p>这是能够运行我们的产品所需的完整步骤<code class="codeph">SampleAcn</code>安装了安全管理器的应用程序。如果您已经完成了前五个步骤，则可以跳过它们，如<a href="jaas-authentication-tutorial.html#GUID-743703A2-7EC1-4391-A816-4A883FB6A017">运行代码中所述</a> 。
                  </p>
                  <ol>
                     <li>
                        <p>将以下文件放入目录：</p>
                        <ul style="list-style-type:disc">
                           <li><code>sample_jass.config</code>登录配置文件（请参阅<a href="jaas-authentication-tutorial.html#GUID-A7E0803F-DA0B-42BF-8E25-DA5889BE847F">“ JAAS认证教程”的“登录配置文件”</a> ）</li>
                        </ul>
                     </li>
                     <li>
                        <p>创建一个名为该顶级目录的<span class="apiname">sample</span>子目录，并将以下内容放入其中（请注意<code class="codeph">SampleAcn</code>和<span class="apiname">MyCallbackHandler</span>类，都在<code class="codeph">SampleAcn.java</code> ，位于名为<code class="codeph">sample</code> ）：</p>
                        <ul style="list-style-type:disc">
                           <li><a href="jaas-authentication-tutorial.html#GUID-E007D5F4-3FA5-417A-B85F-E669839F0101__GUID-1270A0AC-EA51-4A47-B9BC-BDB42F96F5FE"><code>SampleAcn.java</code></a>应用程序源文件</li>
                        </ul>
                     </li>
                     <li>
                        <p>创建一个子目录<code>sample</code>目录并命名<code>module</code> 。将以下内容放入其中（请注意<code>SampleLoginModule</code>类在名为的包中<code class="codeph">sample.module</code> ）：</p>
                        <ul style="list-style-type:disc">
                           <li><a href="jaas-authentication-tutorial.html#GUID-03476CCA-11C6-4D51-B170-C8DD7C0D9075__GUID-F9A208EC-3247-4320-8158-82B0E84C6A04"><code>SampleLoginModule.java</code></a>源文件</li>
                        </ul>
                     </li>
                     <li>
                        <p>创建另一个子目录<code>sample</code>目录并命名<code>principal</code> 。将以下内容放入其中（请注意<code class="codeph">SamplePrincipal</code>类在名为的包中<code class="codeph">sample.principal</code> ）：</p> 
                        <ul style="list-style-type:disc">
                           <li><a href="jaas-authentication-tutorial.html#GUID-03476CCA-11C6-4D51-B170-C8DD7C0D9075__GUID-3EA5533B-1284-481E-A35F-C82B17837F2E"><code>SamplePrincipal.java</code></a>源文件</li>
                        </ul>
                     </li>
                     <li>
                        <p>在顶级目录中时，进行编译<code class="codeph">SampleAcn.java</code> ， <code class="codeph">SampleLoginModule.java</code>和<code class="codeph">SamplePrincipal.java</code> ：</p> 
                        <p><code class="codeph">javac sample/SampleAcn.java sample/module/SampleLoginModule.java sample/principal/SamplePrincipal.java</code></p>
                        <p>（在一行上键入所有内容。）</p>
                     </li>
                     <li>
                        <p>创建一个包含以下内容的JAR文件<code class="codeph">SampleAcn.class</code>和<code class="codeph">MyCallbackHandler.class</code> ：</p>
                        <p><code class="codeph">jar -cvf SampleAcn.jar sample/SampleAcn.class sample/MyCallbackHandler.class</code></p>
                        <p>（在一行上键入所有内容。）该命令创建一个JAR文件， <code class="codeph">SampleAcn.jar</code> ，并将<code class="codeph">SampleAcn.class</code>和<code class="codeph">MyCallbackHandler.class</code>里面的文件。
                        </p>
                     </li>
                     <li>
                        <p>创建一个包含以下内容的JAR文件<code class="codeph">SampleLoginModule.class</code>和<code class="codeph">SamplePrincipal.class</code> ：</p>
                        <p><code class="codeph">jar -cvf SampleLM.jar sample/module/SampleLoginModule.class sample/principal/SamplePrincipal.class</code></p>
                     </li>
                     <li>
                        <p>创建一个授予所需权限的策略文件。</p> 
                        <p>尝试实例化<span class="apiname">LoginContext</span>的代码所需的权限是<code class="codeph">javax.security.auth.AuthPermission</code>与目标<code class="codeph">createLoginContext.<span class="variable" translate="no"><entry name></span></code> 。这里， <code class="codeph"><span class="variable" translate="no"><entry name></span></code>引用应用程序在其<span class="apiname">LoginContext</span>实例中引用的登录配置文件条目的名称。我们使用的名称<code class="codeph">SampleAcn</code>应用程序的<span class="apiname">LoginContext</span>实例为<code class="codeph">Sample</code> ，如您在代码中所见：</p><pre class="pre codeblock"><code>LoginContext lc =
    new LoginContext("Sample",
          new MyCallbackHandler());
</code></pre><p>因此，需要授予的许可<code class="codeph">SampleAcn.jar</code>是</p><pre class="pre codeblock"><code>permission javax.security.auth.AuthPermission
  "createLoginContext.Sample";
</code></pre><p>的<code class="codeph">SampleLM.jar</code>文件也需要被授予权限。<span class="apiname">LoginModule</span>的文档应告诉您需要授予什么权限。如果是<code class="codeph">SampleLoginModule</code> ，它需要一个<code class="codeph">javax.security.auth.AuthPermission</code>与目标<code class="codeph">modifyPrincipals</code>为了填充一个<span class="apiname">校长</span>一个<span class="apiname">主题</span> ：</p><pre class="pre codeblock"><code>permission javax.security.auth.AuthPermission
  "modifyPrincipals";
</code></pre><p>复制策略文件<a href="jaas-authentication-tutorial.html#GUID-44F2BF3A-F51D-4F21-8F40-96CB1120396D__SAMPLEACN.POLICY-2FEDE143"><code>sampleacn.policy</code></a>到与您存储的目录相同的目录<code class="codeph">SampleAcn.java</code>等等。策略文件包含以下内容<code class="codeph">grant</code>授予声明<code class="codeph">SampleAcn.jar</code> （在当前目录中）其所需的权限：</p><pre class="pre codeblock"><code>grant codebase "file:./SampleAcn.jar" {
   permission javax.security.auth.AuthPermission "createLoginContext.Sample";
};
</code></pre><p>该策略文件还包含以下内容<code class="codeph">grant</code>授予声明<code class="codeph">SampleLM.jar</code> （同样在当前目录中）其所需的权限：</p><pre class="pre codeblock"><code>grant codebase "file:./SampleLM.jar" {
   permission javax.security.auth.AuthPermission "modifyPrincipals";
};
</code></pre><p>注意：策略文件及其中条目的结构在“ <a href="permissions-jdk1.html#GUID-789089CA-8557-4017-B8B0-6899AD3BA18D">默认策略实现”和“策略文件语法”中</a>进行了描述。权限<a href="permissions-jdk1.html#GUID-1E8E213A-D7F2-49F1-A2F0-EFB3397A8C95" title="A permission represents access to a system resource. In order for a resource access to be allowed for an applet (or an application running with a security manager), the corresponding permission must be explicitly granted to the code attempting the access.">在JDK</a>中的“ <a href="permissions-jdk1.html#GUID-1E8E213A-D7F2-49F1-A2F0-EFB3397A8C95" title="权限表示对系统资源的访问。为了允许对applet（或使用安全管理器运行的应用程序）进行资源访问，必须将相应的权限显式授予尝试访问的代码。">权限”中进行了</a>描述。</p>
                        <p>执行<code class="codeph">SampleAcn</code>应用程序，指定</p>
                        <ol type="a">
                           <li>通过适当的<code class="codeph">-classpath</code>子句，应该在<code class="codeph">SampleAcn.jar</code>和<code class="codeph">SampleLM.jar</code> JAR文件，</li>
                           <li>通过<code class="codeph">-Djava.security.manager</code>应该安装安全管理器，</li>
                           <li>通过<code class="codeph">-Djava.security.policy==sampleacn.policy</code>要使用的策略文件是<code class="codeph">sampleacn.policy</code>和</li>
                           <li>通过<code class="codeph">-Djava.security.auth.login.config==sample_jaas.config</code>要使用的登录配置文件是<code class="codeph">sample_jaas.config</code> 。
                           </li>
                        </ol>
                        <p>以下是可用于Windows和Solaris，Linux和macOS系统的完整命令。唯一的区别是，在Windows系统上，您使用分号分隔类路径项，而在Solaris，Linux和macOS系统上，则为此使用冒号。</p>
                        <p>这是Windows系统的完整命令：</p><pre class="pre codeblock"><code>java -classpath SampleAcn.jar;SampleLM.jar
 -Djava.security.manager
 -Djava.security.policy==sampleacn.policy
 -Djava.security.auth.login.config==sample_jaas.config
 sample.SampleAcn
</code></pre><p>这是Solaris，Linux和macOS系统的完整命令：</p><pre class="pre codeblock"><code>java -classpath SampleAcn.jar:SampleLM.jar
 -Djava.security.manager
 -Djava.security.policy==sampleacn.policy
 -Djava.security.auth.login.config==sample_jaas.config
 sample.SampleAcn
</code></pre><p>在一行上键入所有内容。为了清晰起见，此处使用多行。如果该命令对于您的系统而言太长，则可能需要将其放置在<code class="codeph">.bat</code>文件（对于Microsoft Windows）或<code class="codeph">.sh</code>文件（适用于Solaris，Linux和macOS），然后运行该文件以执行命令。
                        </p>
                        <p>由于指定的策略文件包含一个授予代码所需权限的条目，因此应继续执行而不会出现任何异常，表明未授予所需权限。系统将提示您输入用户名和密码（使用<code class="codeph">testUser</code>和<code class="codeph">testPassword</code> ），以及<code class="codeph">SampleLoginModule</code>在登录配置文件中指定的名称将检查名称和密码。如果登录成功，您将看到消息<code class="codeph">Authentication succeeded!</code>如果没有，您会看到<code class="codeph">Authentication failed:</code>其次是失败的原因。
                        </p>
                     </li>
                  </ol>
                  <div class="section" id="GUID-44F2BF3A-F51D-4F21-8F40-96CB1120396D__SAMPLEACN.POLICY-2FEDE143">
                     <p class="subhead2" id="GUID-44F2BF3A-F51D-4F21-8F40-96CB1120396D__GUID-2848E450-3412-4124-B72B-9DC287E4B4B7">样本政策</p><pre class="pre codeblock"><code>/* grant the sample LoginModule permissions */
grant codebase "file:./SampleLM.jar" {
    permission javax.security.auth.AuthPermission "modifyPrincipals";
};

grant codebase "file:./SampleAcn.jar" {
   permission javax.security.auth.AuthPermission "createLoginContext.Sample";
};</code></pre></div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   

</body></html>