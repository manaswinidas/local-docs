<html lang="en-us"  xml:lang="en-us"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content>
      <meta name="description" content>
      <title>Java Authentication and Authorization Service (JAAS): LoginModule Developer's Guide</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Security Developer’s Guide">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Security Developer’s Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="security-developer-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-21T08:42:26-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="1993, 2018">
      <meta name="dcterms.category" content="java">
      <meta name="dcterms.identifier" content="E94828-01">
      
      <meta name="dcterms.product" content="en/java/javase/11">
      <meta name="dcterms.release" content="11">
      <link rel="prev" href="jaas-authorization-tutorial.html" title="Previous" type="text/html">
      <link rel="next" href="java-generic-security-services-java-gss-api1.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"java","element_name":"Java","display_in_url":true},"suite":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product_group":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product":{"short_name":"javase","element_name":"Java SE","display_in_url":true},"release":{"short_name":"11","element_name":"11","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Security Developer Guide">
    <meta name="dcterms.isVersionOf" content="SECURITY">
  <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="jaas-authorization-tutorial.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一个</a> <a href="java-generic-security-services-java-gss-api1.html" class="pull-right">下一个<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">安全开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="java-authentication-and-authorization-service-jaas1.html" property="item" typeof="WebPage"><span property="name">Java身份验证和授权服务（JAAS）</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Java身份验证和授权服务（JAAS）：LoginModule开发人员指南</li>
            </ol>
            <a id="GUID-CB46C30D-FFF1-466F-B2F5-6DE0BD5DA43A" name="GUID-CB46C30D-FFF1-466F-B2F5-6DE0BD5DA43A"></a>
            
            <h2 id="JSSEC-GUID-CB46C30D-FFF1-466F-B2F5-6DE0BD5DA43A" class="sect2">Java身份验证和授权服务（JAAS）：LoginModule开发人员指南</h2>
         </header>
         <div class="ind">
            <div>
               <p></p>
               <p>JAAS对身份验证的身份提供基于主题的授权。本文档重点介绍JAAS的身份验证方面，尤其是<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/spi/LoginModule.html" target="_blank"><span class="apiname">LoginModule</span></a>接口。
               </p>
               <div class="section">
                  <p class="subhead1" id="GUID-CB46C30D-FFF1-466F-B2F5-6DE0BD5DA43A__GUID-39874DEC-3315-4CF0-BFA9-02DC88B47C3B">谁应该阅读本文件</p>
                  <p>本文档适用于有经验的程序员，他们需要能够编写实现身份验证技术的<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/spi/LoginModule.html" target="_blank"><span class="apiname">LoginModule</span></a> 。
                  </p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1" id="GUID-CB46C30D-FFF1-466F-B2F5-6DE0BD5DA43A__GUID-A7125EFB-A4B6-4D29-AFC8-88818607E0D1">相关文件</p>
                  <p>本文档假定您已经阅读以下内容：</p>
                  <ul style="list-style-type:disc">
                     <li><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/jaas/JAASRefGuide.html" target="_blank">Java身份验证和授权服务（JAAS）参考指南</a></li>
                  </ul>
                  <p>它还讨论了JAAS API中的各种类和接口。有关更多详细信息，请参阅Javadoc API文档以获取JAAS API规范：</p>
                  <ul style="list-style-type:disc">
                     <li><a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/package-summary.html" target="_blank"><span class="apiname">javax.security.auth</span></a></li>
                     <li><a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/callback/package-summary.html" target="_blank"><span class="apiname">javax.security.auth.callback</span></a></li>
                     <li><a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/kerberos/package-summary.html" target="_blank"><span class="apiname">javax.security.auth.kerberos</span></a></li>
                     <li><a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/login/package-summary.html" target="_blank"> <span class="apiname">javax.security.auth.login</span></a></li>
                     <li><a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/spi/package-summary.html" target="_blank"><span class="apiname">javax.security.auth.spi</span></a></li>
                     <li><a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/x500/package-summary.html" target="_blank"><span class="apiname">javax.security.auth.x500</span></a></li>
                  </ul>
                  <p>以下软件包包含受支持的<span class="apiname">LoginModule</span>示例：</p>
                  <ul style="list-style-type:disc">
                     <li><a href="https://docs.oracle.com/javase/10/docs/api/com/sun/security/auth/package-summary.html" target="_blank"><span class="apiname">com.sun.security.auth</span></a></li>
                     <li><a href="https://docs.oracle.com/javase/10/docs/api/com/sun/security/auth/callback/package-summary.html" target="_blank"><span class="apiname">com.sun.security.auth.callback</span></a></li>
                     <li><a href="https://docs.oracle.com/javase/10/docs/api/com/sun/security/auth/login/package-summary.html" target="_blank"><span class="apiname">com.sun.security.auth.login</span></a></li>
                     <li><a href="https://docs.oracle.com/javase/10/docs/api/com/sun/security/auth/module/package-summary.html" target="_blank"><span class="apiname">com.sun.security.auth.module</span></a></li>
                  </ul>
                  <p>每个人都可以运行以下有关JAAS身份验证和授权的<span class="bold">教程</span> ：</p>
                  <ul style="list-style-type:disc">
                     <li><a href="jaas-authentication-tutorial.html#GUID-BFEBDB00-9826-499C-A20F-E9463883DED4">JAAS认证教程</a></li>
                     <li><a href="jaas-authorization-tutorial.html#GUID-D43CF965-8A5F-4A23-A2AF-F41DD5F8B411">JAAS授权教程</a></li>
                  </ul>
                  <p>可以在以下位置找到用于JAAS身份验证和授权的类似教程，但它们演示了Kerberos LoginModule的使用，因此需要安装Kerberos。</p>
                  <ul style="list-style-type:disc">
                     <li><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/jgss/tutorials/AcnOnly.html" target="_blank">JAAS认证</a></li>
                     <li><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/jgss/tutorials/AcnAndAzn.html" target="_blank">JAAS授权</a></li>
                  </ul>
                  <p>这两个教程是“ <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/jgss/tutorials/index.html" target="_blank">JAAS简介”和Java GSS-API教程</a>的一部分，这些教程利用Kerberos作为身份验证和安全通信的基础技术。
                  </p>
               </div>
               <!-- class="section" -->
            </div>
            <div class="sect2"><a id="GUID-3F7CF22D-A207-49EE-B1CC-575FBF3789DE" name="GUID-3F7CF22D-A207-49EE-B1CC-575FBF3789DE"></a><h3 id="JSSEC-GUID-3F7CF22D-A207-49EE-B1CC-575FBF3789DE" class="sect3">LoginModule简介</h3>
               <div>
                  <p></p>
                  <p>身份验证技术提供者必须实现<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/spi/LoginModule.html" target="_blank"><span class="apiname">LoginModule</span></a>接口。 <code class="codeph">LoginModule</code>在应用程序下插入，以提供特定类型的身份验证。
                  </p>
                  <p>当应用程序写入<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/login/LoginContext.html" target="_blank"><span class="apiname">LoginContext</span></a>应用程序编程接口（API）时，身份验证技术提供程序将实现<code class="codeph">LoginModule</code>接口。<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/login/Configuration.html" target="_blank"><span class="apiname">配置</span></a>指定<code class="codeph">LoginModule</code> （s）与特定的登录应用程序一起使用。不同<code class="codeph">LoginModule</code>可以在应用程序下插入s，而无需对应用程序本身进行任何修改。
                  </p>
                  <p>的<code class="codeph">LoginContext</code>负责阅读<code class="codeph">Configuration</code>并实例化指定<code class="codeph">LoginModule</code> s。每<code class="codeph">LoginModule</code>使用<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/Subject.html" target="_blank"><span class="apiname">Subject</span></a> ， <a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/callback/CallbackHandler.html" target="_blank"><span class="apiname">CallbackHandler</span></a>和共享初始化<code class="codeph">LoginModule</code>状态，以及<code class="codeph">LoginModule</code>特定的选项。
                  </p>
                  <p>的<span class="bold"><code class="codeph">Subject</code></span>代表当前正在认证的用户或服务，并由<code class="codeph">LoginModule</code>如果身份验证成功，则使用相关的<a href="https://docs.oracle.com/javase/10/docs/api/java/security/Principal.html" target="_blank"><span class="apiname">Principal</span></a>和凭据。 <code class="codeph">LoginModule</code>使用<span class="bold"><code class="codeph">CallbackHandler</code></span>与用户通信（例如，提示输入用户名和密码），如登录方法描述中所述。请注意<code class="codeph">CallbackHandler</code>可以为null。一种<code class="codeph">LoginModule</code>这需要一个<code class="codeph">CallbackHandler</code>验证<code class="codeph">Subject</code>如果使用初始化，可能会抛出<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/login/LoginException.html" target="_blank"><span class="apiname">LoginException。</span></a> <code class="codeph">null</code><code class="codeph">CallbackHandler</code> 。 <code class="codeph">LoginModule</code>可以选择使用<span class="bold">共享状态</span>在彼此之间共享信息或数据。
                  </p>
                  <p>的<span class="bold"><code class="codeph">LoginModule</code>特定的选项</span>代表为此配置的选项<code class="codeph">LoginModule</code>在登录名中<code class="codeph">Configuration</code> 。这些选项由<code class="codeph">LoginModule</code>本身并控制其中的行为。例如，一个<code class="codeph">LoginModule</code>可以定义支持调试/测试功能的选项。使用键值语法定义选项，例如<span class="variable" translate="no">debug=true</span> 。的<code class="codeph">LoginModule</code>将选项存储为<code class="codeph">Map</code>以便可以使用键来检索值。请注意，选项a的数量没有限制<code class="codeph">LoginModule</code>选择定义。
                  </p>
                  <p>调用应用程序将身份验证过程视为通过对的调用而调用的单个操作。 <code class="codeph">LoginContext</code>的<code class="codeph">login</code>方法。但是，每个内部的身份验证过程<code class="codeph">LoginModule</code>分两个不同的阶段进行。在身份验证的第一阶段， <code class="codeph">LoginContext</code>的<code class="codeph">login</code>方法调用<code class="codeph">login</code>每个方法<code class="codeph">LoginModule</code>在指定<code class="codeph">Configuration</code> 。的<code class="codeph">login</code>方法<code class="codeph">LoginModule</code>执行实际的身份验证（例如，提示和验证密码），并将其身份验证状态保存为私有状态信息。完成后， <code class="codeph">LoginModule</code>的<code class="codeph">login</code>方法返回<code class="codeph">true</code> （如果成功）或<code class="codeph">false</code> （如果应该忽略），或者抛出一个<code class="codeph">LoginException</code>指定失败。在失败的情况下， <code class="codeph">LoginModule</code>不得重试身份验证或引入延迟。此类任务的责任属于应用程序。如果应用程序尝试重试身份验证，则每个<code class="codeph">LoginModule</code>的<code class="codeph">login</code>方法将再次被调用。
                  </p>
                  <p>在第二阶段，如果<code class="codeph">LoginContext</code>的整体身份验证成功（调用了相关的<span class="variable" translate="no">required</span> ， <span class="variable" translate="no">requisite</span> ， <span class="variable" translate="no">sufficient</span>和<span class="variable" translate="no">optional</span> <code class="codeph">LoginModule</code> s' <code class="codeph">login</code>方法成功），然后<code class="codeph">commit</code>每个方法<code class="codeph">LoginModule</code>被调用。（有关<code class="codeph">LoginModule</code>标志<span class="variable" translate="no">required</span> ， <span class="variable" translate="no">requisite</span> ， <span class="variable" translate="no">sufficient</span>和<span class="variable" translate="no">optional</span> ，请参阅《 <a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/login/Configuration.html" target="_blank"><span class="apiname">配置</span></a>文档》和<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/jaas/JAASRefGuide.html#AppendixB" target="_blank">《</a> JAAS参考指南》中的<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/jaas/JAASRefGuide.html#AppendixB" target="_blank">附录B：示例登录配置</a> 。）的<code class="codeph">commit</code>方法<code class="codeph">LoginModule</code>检查其私有保存状态，以查看其自身的身份验证是否成功。如果整体<code class="codeph">LoginContext</code>身份验证成功，并且<code class="codeph">LoginModule</code>自己的身份验证成功，然后<code class="codeph">commit</code>方法将相关<code class="codeph">Principal</code> s（经过身份验证的身份）和凭据（诸如加密密钥之类的身份验证数据）与<code class="codeph">Subject</code> 。
                  </p>
                  <p>如果<code class="codeph">LoginContext</code>的整体身份验证失败（相关的必需，必要，充分和可选<code class="codeph">LoginModule</code> s' <code class="codeph">login</code>方法未成功），则<code class="codeph">abort</code>每个方法<code class="codeph">LoginModule</code>被调用。在这种情况下， <code class="codeph">LoginModule</code>删除/破坏最初保存的任何身份验证状态。
                  </p>
                  <p>登出<code class="codeph">Subject</code>仅涉及一个阶段。的<code class="codeph">LoginContext</code>调用<code class="codeph">LoginModule</code>的<code class="codeph">logout</code>方法。的<code class="codeph">logout</code>方法<code class="codeph">LoginModule</code>然后执行注销过程，例如删除<code class="codeph">Principal</code>或的凭据<code class="codeph">Subject</code> ，或记录会话信息。
                  </p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-EE1C4BBE-289F-4419-A233-43F2D897765B" name="GUID-EE1C4BBE-289F-4419-A233-43F2D897765B"></a><h3 id="JSSEC-GUID-EE1C4BBE-289F-4419-A233-43F2D897765B" class="sect3">实现LoginModule的步骤</h3>
               <div>
                  <p>以下是实施和测试<code class="codeph">LoginModule</code> ：</p>
               </div>
               <div class="sect3"><a id="GUID-A4140569-4124-4AE7-81CC-145537BE0F42" name="GUID-A4140569-4124-4AE7-81CC-145537BE0F42"></a><h4 id="JSSEC-GUID-A4140569-4124-4AE7-81CC-145537BE0F42" class="sect4">步骤1：了解验证技术</h4>
                  <div>
                     <p>首先，了解新用户要实施的身份验证技术<code class="codeph">LoginModule</code>提供者并确定其要求。
                     </p>
                     <ol>
                        <li class="stepexpand"><span>确定您是否<code class="codeph">LoginModule</code>将需要某种形式的用户交互（例如，检索用户名和密码）。如果是这样，您将需要熟悉<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/callback/CallbackHandler.html" target="_blank"><span class="apiname">CallbackHandler</span></a>接口和<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/callback/package-summary.html" target="_blank"><span class="apiname">javax.security.auth.callback</span></a>包。</span><div>
                              <p>在该软件包中，您会发现几种可能<code class="codeph">Callback</code>使用的实现。（或者，您可以创建自己的<code class="codeph">Callback</code>实施。）的<code class="codeph">LoginModule</code>将调用<code class="codeph">CallbackHandler</code>由应用程序本身指定并传递给<code class="codeph">LoginModule</code>的<code class="codeph">initialize</code>方法。的<code class="codeph">LoginModule</code>通过<code class="codeph">CallbackHandler</code>适当的数组<code class="codeph">Callback</code> s。见<a href="java-authentication-and-authorization-service-jaas-loginmodule-developers-guide1.html#GUID-E9C5810B-ADB6-4454-869D-B269ECA8145F__LOGINMODULE.LOGINMETHOD-21144491">LoginModule.login方法</a>在<a href="java-authentication-and-authorization-service-jaas-loginmodule-developers-guide1.html#GUID-E9C5810B-ADB6-4454-869D-B269ECA8145F" title="LoginModule接口指定了需要实现的五个抽象方法。">第3步：实现抽象的LoginModule方法</a> 。
                              </p>
                              <div class="p">
                                 <div class="infoboxnote" id="GUID-A4140569-4124-4AE7-81CC-145537BE0F42__GUID-E00E32FE-7328-4E56-B91F-04095BA3A9D6">
                                    <p class="notep1">注意：</p>有可能<code class="codeph">LoginModule</code>实现中没有任何最终用户交互。这样<code class="codeph">LoginModule</code> s不需要访问<code class="codeph">callback</code>包。
                                 </div>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>确定要向用户提供哪些配置选项，用户以当前Configuration实施期望的任何形式（例如，在文件中）指定配置信息。对于每个选项，请确定选项名称和可能的值。</span><div>例如，如果<code class="codeph">LoginModule</code>可以配置为咨询特定的身份验证服务器主机，确定选项的密钥名称（例如“ auth_server”），以及对该选项有效的可能的服务器主机名（“ server_one.example.com”和“ server_two.example” .com”）。
                           </div>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-A6BAE987-54F4-4634-9D03-7EB986C7F484" name="GUID-A6BAE987-54F4-4634-9D03-7EB986C7F484"></a><h4 id="JSSEC-GUID-A6BAE987-54F4-4634-9D03-7EB986C7F484" class="sect4">步骤2：命名LoginModule实现</h4>
                  <div>
                     <p>确定适合您的软件包和类名称<code class="codeph">LoginModule</code> 。
                     </p>
                     <div class="example" id="GUID-A6BAE987-54F4-4634-9D03-7EB986C7F484__GUID-61466AE4-79E1-4B1F-9BFA-6DD64DEB781C">
                        <p>例如，一个<code class="codeph">LoginModule</code>由IBM开发的可能被称为<code class="codeph">com.ibm.auth.Module</code>哪里<code class="codeph">com.ibm.auth</code>是软件包名称， <code class="codeph">Module</code>是的名称<code class="codeph">LoginModule</code>类的实现。
                        </p>
                     </div>
                     <!-- class="example" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-E9C5810B-ADB6-4454-869D-B269ECA8145F" name="GUID-E9C5810B-ADB6-4454-869D-B269ECA8145F"></a><h4 id="JSSEC-GUID-E9C5810B-ADB6-4454-869D-B269ECA8145F" class="sect4">步骤3：实现抽象LoginModule方法</h4>
                  <div>
                     <p>的<code class="codeph">LoginModule</code>接口指定了五个需要实现的抽象方法。
                     </p>
                     <div class="section">
                        <ul style="list-style-type:disc">
                           <li>
                              <p><a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/spi/LoginModule.html#initialize-javax.security.auth.Subject-javax.security.auth.callback.CallbackHandler-java.util.Map-java.util.Map-" target="_blank"><span class="apiname">初始化</span></a></p>
                           </li>
                           <li>
                              <p><a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/spi/LoginModule.html#login--" target="_blank"><span class="apiname">登录</span></a></p>
                           </li>
                           <li>
                              <p><a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/spi/LoginModule.html#commit--" target="_blank"><span class="apiname">承诺</span></a></p>
                           </li>
                           <li>
                              <p><a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/spi/LoginModule.html#abort--" target="_blank"><span class="apiname">中止</span></a></p>
                           </li>
                           <li>
                              <p><a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/spi/LoginModule.html#logout--" target="_blank"><span class="apiname">登出</span></a></p>
                           </li>
                        </ul>
                        <p>除了这些方法之外， <span class="apiname">LoginModule</span>实现还必须提供不带参数的公共构造函数。这允许通过<span class="apiname">LoginContext</span>对其进行适当的实例化。请注意，如果<span class="apiname">LoginModule</span>实现中未提供构造函数，则默认的无参数构造函数会自动从<span class="apiname">Object</span>类继承。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-E9C5810B-ADB6-4454-869D-B269ECA8145F__LOGINMODULE.INITIALIZEMETHOD-2114401D">
                        <p class="subhead3" id="GUID-E9C5810B-ADB6-4454-869D-B269ECA8145F__GUID-0822523A-1E3A-4661-9778-C49C77B24CE0">LoginModule.initialize方法</p><pre class="pre codeblock"><code>    public void initialize(
        Subject subject,
        CallbackHandler handler,
        Map&lt;java.lang.String, ?&gt; sharedState,
        Map&lt;java.lang.String, ?&gt; options);
</code></pre><p>的<code class="codeph">initialize</code>调用方法来初始化<code class="codeph">LoginModule</code>以及相关的身份验证和状态信息。
                        </p>
                        <p>此方法由<code class="codeph">LoginContext</code>在此之后<code class="codeph">LoginModule</code>已实例化，并且在调用其其他公共方法之前。方法实现应存储提供的参数以备将来使用。
                        </p>
                        <p>的<code class="codeph">initialize</code>方法还可以细读提供的<span class="variable" translate="no">sharedState</span>以确定其他用户提供的附加身份验证状态<code class="codeph">LoginModule</code> ，也可以遍历提供的<span class="variable" translate="no">options</span>以确定指定了哪些配置选项来影响<code class="codeph">LoginModule</code>的行为。它将选项值保存在变量中以备将来使用。
                        </p>
                        <p>以下是<span class="apiname">LoginModule</span>通常支持的选项列表。请注意，以下仅是一个准则。模块可以自由支持以下选项的子集（或不提供）。
                        </p>
                        <ul style="list-style-type:disc">
                           <li><code class="codeph">tryFirstPass</code> -如果<code class="codeph">true</code> ，堆栈中的第一个<span class="apiname">LoginModule会</span>保存输入的密码，随后的<span class="apiname">LoginModules</span>也尝试使用它。如果身份验证失败，则<span class="apiname">LoginModule</span>提示输入新密码，然后重试身份验证。
                           </li>
                           <li><code class="codeph">useFirstPass</code> -如果<code class="codeph">true</code> ，堆栈中的第一个<span class="apiname">LoginModule会</span>保存输入的密码，随后的<span class="apiname">LoginModules</span>也尝试使用它。如果身份验证失败（身份验证完全失败），则<span class="apiname">LoginModule</span>不会提示输入新密码。
                           </li>
                           <li><code class="codeph">tryMappedPass</code> -如果<code class="codeph">true</code> ，堆栈中的第一个<span class="apiname">LoginModule</span>将保存输入的密码，随后的<span class="apiname">LoginModules</span>尝试将其映射到其服务特定的密码。如果身份验证失败，则<span class="apiname">LoginModule</span>提示输入新密码，然后重试身份验证。
                           </li>
                           <li><code class="codeph">useMappedPass</code> -如果<code class="codeph">true</code> ，堆栈中的第一个<span class="apiname">LoginModule</span>将保存输入的密码，随后的<span class="apiname">LoginModules</span>尝试将其映射到其服务特定的密码。如果身份验证失败（身份验证完全失败），则<span class="apiname">LoginModule</span>不会提示输入新密码。
                           </li>
                           <li><code class="codeph">moduleBanner</code> -如果<code class="codeph">true</code> ，然后在调用<span class="apiname">CallbackHandler时</span> ， <span class="apiname">LoginModule</span>提供<span class="apiname">TextOutputCallback</span>作为第一个<span class="apiname">Callback</span> ，它描述了执行身份验证的<span class="apiname">LoginModule</span> 。
                           </li>
                           <li><code class="codeph">debug</code> -如果<code class="codeph">true</code> ，指示<span class="apiname">LoginModule</span>输出调试信息。
                           </li>
                        </ul>
                        <p>的<code class="codeph">initialize</code>该方法可以随意忽略其不了解的状态或选项，尽管如果确实发生这种情况，则将其记录下来是明智的。
                        </p>
                        <p>请注意<code class="codeph">LoginContext</code>调用这个<code class="codeph">LoginModule</code> （以及其他已配置的<code class="codeph">LoginModule</code> ，也都对提供的内容具有相同的引用<code class="codeph">Subject</code>和<code class="codeph">sharedState</code> 。修改<code class="codeph">Subject</code>和<code class="codeph">sharedState</code>因此，所有人都会看到。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-E9C5810B-ADB6-4454-869D-B269ECA8145F__LOGINMODULE.LOGINMETHOD-21144491">
                        <p class="subhead3" id="GUID-E9C5810B-ADB6-4454-869D-B269ECA8145F__GUID-912E9E9F-1904-4A45-AB1E-A80D2E6B1358">LoginModule.login方法</p><pre class="pre codeblock"><code>    boolean login() throws LoginException;
</code></pre><p>的<code class="codeph">login</code>调用方法来认证<code class="codeph">Subject</code> 。这是身份验证的第一阶段。
                        </p>
                        <p>此方法实现应执行实际的身份验证。例如，它可能会提示您输入用户名和密码，然后尝试根据密码数据库验证密码。另一示例实现方式可以通知用户将其手指插入指纹读取器，然后将输入的指纹与指纹数据库进行匹配。</p>
                        <p>如果你的<code class="codeph">LoginModule</code>需要某种形式的用户交互（例如，检索用户名和密码），则不应直接这样做。那是因为存在与用户通信的各种方式，并且对于<code class="codeph">LoginModule</code>保持独立于不同类型的用户交互。而是<code class="codeph">LoginModule</code>的<code class="codeph">login</code>方法应调用<code class="codeph">handle</code> <a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/callback/CallbackHandler.html" target="_blank"><span class="apiname">CallbackHandler</span></a>接口的方法传递给<code class="codeph">initialize</code>进行用户交互并设置适当结果（例如用户名和密码）的方法。的<code class="codeph">LoginModule</code>通过<code class="codeph">CallbackHandler</code>适当的数组<code class="codeph">Callback</code> s，例如，用于用户名的<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/callback/NameCallback.html" target="_blank"><span class="apiname">NameCallback</span></a>和用于<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/callback/PasswordCallback.html" target="_blank"><span class="apiname">密码</span></a>的PasswordCallback，以及<code class="codeph">CallbackHandler</code>执行请求的用户交互，并在<code class="codeph">Callback</code> s。例如，要处理一个<code class="codeph">NameCallback</code> ， <code class="codeph">CallbackHandler</code>可能会提示您输入名称，从用户那里检索值，然后调用<code class="codeph">NameCallback</code>的<code class="codeph">setName</code>存储名称的方法。
                        </p>
                        <p>认证过程还可以涉及通过网络的通信。例如，如果此方法实现与Kerberos中的<span class="variable" translate="no">kinit</span>等效，则需要联系KDC。如果密码数据库条目本身位于远程命名服务中，则需要通过Java命名和目录接口（JNDI）与该命名服务联系。实现也可能与底层操作系统进行交互。例如，如果用户已经登录了Solaris，Linux，macOS或Windows之类的操作系统，则此方法可能只是导入基础操作系统的身份信息。
                        </p>
                        <p>的<code class="codeph">login</code>方法应该</p>
                        <ol>
                           <li>确定是否<code class="codeph">LoginModule</code>应该被忽略。何时应忽略该身份的一个示例是用户尝试以与此身份无关的身份进行身份验证<code class="codeph">LoginModule</code> （例如，如果用户尝试使用NIS作为<span class="variable" translate="no">root</span>用户进行身份验证）。如果这<code class="codeph">LoginModule</code>应该被忽略， <code class="codeph">login</code>应该回来<code class="codeph">false</code> 。否则，应执行以下操作：</li>
                           <li>致电<code class="codeph">CallbackHandler</code><code class="codeph">handle</code>要求用户交互的方法。
                           </li>
                           <li>执行身份验证。</li>
                           <li>存储认证结果（成功或失败）。</li>
                           <li>如果身份验证成功，请保存服务器可能需要的所有相关状态信息。 <code class="codeph">commit</code>方法。
                           </li>
                           <li>返回<code class="codeph">true</code>如果认证成功，或者如果认证失败，则抛出<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/login/LoginException.html" target="_blank"><span class="apiname">LoginException，</span></a>例如<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/login/FailedLoginException.html" target="_blank"><span class="apiname">FailedLoginException</span></a> 。
                           </li>
                        </ol>
                        <p>请注意<code class="codeph">login</code>方法实现不应关联任何新<code class="codeph">Principal</code>或带有已保存的凭证信息<code class="codeph">Subject</code>宾语。该方法仅执行认证，然后存储认证结果和相应的认证状态。此结果和状态以后将由<code class="codeph">commit</code>要么<code class="codeph">abort</code>方法。请注意，结果和状态通常不应保存在<span class="variable" translate="no">sharedState</span> <code class="codeph">Map</code> ，因为它们不打算与其他人共享<code class="codeph">LoginModule</code> s。
                        </p>
                        <p>此方法可能在将状态信息存储在<span class="variable" translate="no">sharedState</span>有用的一个示例<code class="codeph">Map</code>那时候<code class="codeph">LoginModule</code>配置为共享密码。在这种情况下，输入的密码将被保存为共享状态。通过共享密码，用户只需输入一次密码，仍然可以通过多个身份验证<code class="codeph">LoginModule</code> s。从<span class="variable" translate="no">sharedState</span>保存和检索名称和密码的标准约定<code class="codeph">Map</code>以下是：</p>
                        <ul style="list-style-type:disc">
                           <li><code class="codeph">javax.security.auth.login.name</code> -使用它作为共享状态映射键，以保存/检索名称。该值应为<span class="apiname">String</span> 。
                           </li>
                           <li><code class="codeph">javax.security.auth.login.password</code> -使用它作为共享状态映射密钥，以保存/检索密码。该值应为<span class="apiname">char</span>数组。
                           </li>
                        </ul>
                        <p>如果验证失败，则<code class="codeph">login</code>方法不应重试身份验证。这是应用程序的责任。多<code class="codeph">LoginContext</code><code class="codeph">login</code>与从内部多次登录尝试相比，应用程序的方法调用优先<code class="codeph">LoginModule.login()</code> 。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-E9C5810B-ADB6-4454-869D-B269ECA8145F__LOGINMODULE.COMMITMETHOD-21144844">
                        <p class="subhead3" id="GUID-E9C5810B-ADB6-4454-869D-B269ECA8145F__GUID-7C5914F5-D28C-47EC-ADDE-1BB7FEEE6E90">LoginModule.commit方法</p><pre class="pre codeblock"><code>    boolean commit() throws LoginException;
</code></pre><p>的<code class="codeph">commit</code>调用方法提交身份验证过程。当阶段1成功时，这就是身份验证的阶段2。如果<code class="codeph">LoginContext</code>的整体身份验证成功（也就是说，如果相关的必填，必填，充实和可选<code class="codeph">LoginModule</code> s成功。）
                        </p>
                        <p>该方法应访问认证结果以及认证机构保存的相应认证状态。 <code class="codeph">login</code>方法。
                        </p>
                        <p>如果认证结果表明<code class="codeph">login</code>方法失败，那么这个<code class="codeph">commit</code>方法应删除/销毁最初保存的任何对应状态。
                        </p>
                        <p>如果保存的结果相反表示<code class="codeph">LoginModule</code>的<code class="codeph">login</code>方法成功后，则应访问相应的状态信息以构建任何相关的<code class="codeph">Principal</code>和凭据信息。这样<code class="codeph">Principal</code> ，然后将凭据添加到<code class="codeph">Subject</code>被存放<code class="codeph">initialize</code>方法。
                        </p>
                        <p>添加后<code class="codeph">Principal</code> s和凭据，应尽快销毁可分配的状态字段。要破坏的字段可能是身份验证过程中存储的用户名和密码。
                        </p>
                        <p>的<code class="codeph">commit</code>方法应保存指示提交成功还是失败的私有状态。
                        </p>
                        <p>下图描述了<code class="codeph">LoginModule</code>的<code class="codeph">commit</code>方法应该返回。不同的框代表可能发生的不同情况。例如，左上角的方框描述了<code class="codeph">commit</code>如果之前的两个调用都应返回方法<code class="codeph">login</code>成功了， <code class="codeph">commit</code>方法本身成功。
                        </p>
                        <div class="tblformalwide" id="GUID-E9C5810B-ADB6-4454-869D-B269ECA8145F__GUID-80D5A33A-9B15-45EA-87FD-1C17A26F795C">
                           <p class="titleintable">表6-2 LoginModule.commit方法的返回值</p>
                           <table cellpadding="4" cellspacing="0" class="FormalWide" title="LoginModule.commit方法返回值" width="100%" border="1" summary="LoginModule.commit method return values" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" id="d93925e1134">登录状态</th>
                                    <th align="left" valign="bottom" id="d93925e1136">提交：成功</th>
                                    <th align="left" valign="bottom" id="d93925e1138">提交：失败</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td rowspan="1" colspan="1" align="left" valign="top" id="d93925e1142" headers="d93925e1134 ">登录：成功</td>
                                    <td rowspan="1" colspan="1" align="left" valign="top" headers="d93925e1142 d93925e1136 ">返回TRUE</td>
                                    <td rowspan="1" colspan="1" align="left" valign="top" headers="d93925e1142 d93925e1138 ">抛出异常</td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td rowspan="1" colspan="1" align="left" valign="top" id="d93925e1149" headers="d93925e1134 ">登录：失败</td>
                                    <td rowspan="1" colspan="1" align="left" valign="top" headers="d93925e1149 d93925e1136 ">返回FALSE</td>
                                    <td rowspan="1" colspan="1" align="left" valign="top" headers="d93925e1149 d93925e1138 ">返回FALSE</td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-E9C5810B-ADB6-4454-869D-B269ECA8145F__LOGINMODULE.ABORTMETHOD-21144BEF">
                        <p class="subhead3" id="GUID-E9C5810B-ADB6-4454-869D-B269ECA8145F__GUID-03B7472C-DFE1-4235-A75D-786A68C898FB">LoginModule.abort方法</p><pre class="pre codeblock"><code>    boolean abort() throws LoginException;
</code></pre><p>的<code class="codeph">abort</code>调用方法来终止身份验证过程。当阶段1失败时，这是身份验证的阶段2。如果<code class="codeph">LoginContext</code>的整体身份验证失败。
                        </p>
                        <p>该方法首先访问<code class="codeph">LoginModule</code>的认证结果和相应的认证状态保存<code class="codeph">login</code> （并且可能<code class="codeph">commit</code> ）方法，然后清除并销毁信息。要破坏的示例状态将是用户名和密码。
                        </p>
                        <p>如果这<code class="codeph">LoginModule</code>的身份验证尝试失败，因此不应清除任何私有状态。
                        </p>
                        <p>以下图表描述了<code class="codeph">LoginModule</code>的<code class="codeph">abort</code>方法应该返回。此第一张图表假定上一个调用<code class="codeph">login</code>成功了。例如， <code class="codeph">abort</code>如果之前的两个调用都必须返回TRUE <code class="codeph">login</code>和<code class="codeph">commit</code>成功了， <code class="codeph">abort</code>方法本身也成功。
                        </p>
                        <div class="tblformalwide" id="GUID-E9C5810B-ADB6-4454-869D-B269ECA8145F__GUID-BBDD2DC0-2F02-45A3-86D5-05E37240DC3A">
                           <p class="titleintable">表6-3 LoginModule.abort方法返回值：登录成功</p>
                           <table cellpadding="4" cellspacing="0" class="FormalWide" title="LoginModule.abort方法返回值：成功登录" width="100%" border="1" summary="LoginModule.abort method return values: login succeeded" frame="hsides" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" id="d93925e1219">登录状态</th>
                                    <th align="left" valign="bottom" id="d93925e1221">中止：成功</th>
                                    <th align="left" valign="bottom" id="d93925e1223">中止：失败</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td rowspan="1" colspan="1" align="left" valign="top" id="d93925e1227" headers="d93925e1219 ">提交：成功</td>
                                    <td rowspan="1" colspan="1" align="left" valign="top" headers="d93925e1227 d93925e1221 ">返回TRUE</td>
                                    <td rowspan="1" colspan="1" align="left" valign="top" headers="d93925e1227 d93925e1223 ">抛出异常</td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td rowspan="1" colspan="1" align="left" valign="top" id="d93925e1234" headers="d93925e1219 ">提交：失败</td>
                                    <td rowspan="1" colspan="1" align="left" valign="top" headers="d93925e1234 d93925e1221 ">返回TRUE</td>
                                    <td rowspan="1" colspan="1" align="left" valign="top" headers="d93925e1234 d93925e1223 ">抛出异常</td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                        <p>第二张图描述了<span class="apiname">LoginModule</span>的abort方法应该返回什么，假设先前的登录调用失败。例如，如果先前的<span class="apiname">登录</span>调用失败，先前的<span class="apiname">提交</span>调用成功且<span class="apiname">中止</span>方法本身也成功，则<span class="apiname">中止</span>方法应返回FALSE。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="tblformalwide" id="GUID-E9C5810B-ADB6-4454-869D-B269ECA8145F__LOGINMODULE.ABORTMETHODRETURNVALUES-2119026E">
                        <p class="titleintable">表6-4 LoginModule.abort方法返回值：登录失败</p>
                        <table cellpadding="4" cellspacing="0" class="FormalWide" title="LoginModule.abort方法返回值：登录失败" width="100%" border="1" summary="LoginModule.abort method return values: login failed" frame="hsides" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" id="d93925e1268">登录状态</th>
                                 <th align="left" valign="bottom" id="d93925e1270">中止：成功</th>
                                 <th align="left" valign="bottom" id="d93925e1272">中止：失败</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td rowspan="1" colspan="1" align="left" valign="top" id="d93925e1276" headers="d93925e1268 ">提交：成功</td>
                                 <td rowspan="1" colspan="1" align="left" valign="top" headers="d93925e1276 d93925e1270 ">返回FALSE</td>
                                 <td rowspan="1" colspan="1" align="left" valign="top" headers="d93925e1276 d93925e1272 ">返回FALSE</td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td rowspan="1" colspan="1" align="left" valign="top" id="d93925e1283" headers="d93925e1268 ">提交：失败</td>
                                 <td rowspan="1" colspan="1" align="left" valign="top" headers="d93925e1283 d93925e1270 ">返回FALSE</td>
                                 <td rowspan="1" colspan="1" align="left" valign="top" headers="d93925e1283 d93925e1272 ">返回FALSE</td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="section" id="GUID-E9C5810B-ADB6-4454-869D-B269ECA8145F__LOGINMODULE.LOGOUTMETHOD-21144F6A">
                        <p class="subhead3" id="GUID-E9C5810B-ADB6-4454-869D-B269ECA8145F__GUID-573BBE6D-4875-4D18-ACEA-A55F648D0A26">LoginModule.logout方法</p><pre class="pre codeblock"><code>    boolean logout() throws LoginException;
</code></pre><p>的<code class="codeph">logout</code>调用方法注销<code class="codeph">Subject</code> 。
                        </p>
                        <p>此方法删除<code class="codeph">Principal</code> ，并删除/销毁与<code class="codeph">Subject</code>在此期间<code class="codeph">commit</code>操作。这种方法不应该碰那些<code class="codeph">Principal</code>或先前存在于<code class="codeph">Subject</code>或其他人添加的<code class="codeph">LoginModule</code> s。
                        </p>
                        <p>如果<code class="codeph">Subject</code>已被标记为<span class="variable" translate="no">read-only</span> （ <code class="codeph">Subject</code>的<code class="codeph">isReadOnly</code>方法返回<span class="variable" translate="no">true</span> ），则此方法应仅销毁与<code class="codeph">Subject</code>在此期间<code class="codeph">commit</code>操作（无法删除凭据）。如果<code class="codeph">Subject</code>已被标记为<span class="variable" translate="no">read-only</span>并且与<code class="codeph">Subject</code>在此期间<code class="codeph">commit</code>操作是不可破坏的（它们不执行<code class="codeph">Destroyable</code>接口），则此方法可能会抛出一个<code class="codeph">LoginException</code> 。
                        </p>
                        <p>的<code class="codeph">logout</code>方法应该返回<code class="codeph">true</code>如果注销成功，否则抛出<code class="codeph">LoginException</code> 。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-4A0BD9DC-B45F-4606-A6BD-8BAC22952C52" name="GUID-4A0BD9DC-B45F-4606-A6BD-8BAC22952C52"></a><h4 id="JSSEC-GUID-4A0BD9DC-B45F-4606-A6BD-8BAC22952C52" class="sect4">步骤4：选择或编写示例应用程序</h4>
                  <div>
                     <p>选择一个现有的示例应用程序进行测试，或者编写一个新的示例应用程序。</p>
                     <p>有关应用程序需求和可用于测试的示例应用程序的信息，请参阅《 <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/jaas/JAASRefGuide.html" target="_blank">Java认证和授权服务（JAAS）参考指南》</a> 。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-6DEAB2A4-2ADE-4CC8-B188-F0A58A38F61C" name="GUID-6DEAB2A4-2ADE-4CC8-B188-F0A58A38F61C"></a><h4 id="JSSEC-GUID-6DEAB2A4-2ADE-4CC8-B188-F0A58A38F61C" class="sect4">步骤5：编译LoginModule和应用程序</h4>
                  <div>
                     <p>编译新的<code class="codeph">LoginModule</code>以及将用于测试的应用程序。
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-800F2CC8-C4BC-4AE7-B29A-1BFBE01D9979" name="GUID-800F2CC8-C4BC-4AE7-B29A-1BFBE01D9979"></a><h4 id="JSSEC-GUID-800F2CC8-C4BC-4AE7-B29A-1BFBE01D9979" class="sect4">步骤6：准备测试</h4>
                  <div>
                     <p></p>
                     <div class="section" id="GUID-800F2CC8-C4BC-4AE7-B29A-1BFBE01D9979__STEP6APLACEYOURLOGINMODULEANDAPPLIC-83D213BF">
                        <p class="subhead3" id="GUID-800F2CC8-C4BC-4AE7-B29A-1BFBE01D9979__GUID-033837DB-93BE-4480-AB46-CED193887B99">步骤6a：将您的<code class="codeph">LoginModule</code>和JAR文件中的应用程序代码</p>
                        <p>放置你的<code class="codeph">LoginModule</code>和应用程序代码放在单独的JAR文件中，以准备在<a href="java-authentication-and-authorization-service-jaas-loginmodule-developers-guide1.html#GUID-800F2CC8-C4BC-4AE7-B29A-1BFBE01D9979__STEP6CSETLOGINMODULEANDAPPLICATIONJ-83D21A8B">步骤6b：设置LoginModule和Application JAR File Permissions</a>中的策略中引用JAR文件。这是用于创建JAR文件的示例命令：</p><pre class="pre codeblock"><code>jar cvf &lt;JAR file name&gt; &lt;list of classes, separated by spaces&gt;
</code></pre><p>此命令使用包含指定类的指定名称创建一个JAR文件。</p>
                        <p>有关<span class="bold">jar</span>工具的更多信息，请参见<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/java/javase/11/security&id=JSWOR614" target="_blank">jar</a> 。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-800F2CC8-C4BC-4AE7-B29A-1BFBE01D9979__STEP6CSETLOGINMODULEANDAPPLICATIONJ-83D21A8B">
                        <p class="subhead3" id="GUID-800F2CC8-C4BC-4AE7-B29A-1BFBE01D9979__GUID-35E27494-91ED-4B42-AF0C-A6E8AEA620E5">步骤6b：设定<code class="codeph">LoginModule</code>和应用程序JAR文件权限</p>
                        <p>如果你的<code class="codeph">LoginModule</code>和/或应用程序执行对安全敏感的任务，这些任务将触发安全检查（建立网络连接，读取或写入本地磁盘上的文件等），如果在安全管理器处于运行状态时运行它，则必须被授予必需的权限安装;请参见<a href="permissions-jdk1.html#GUID-1E8E213A-D7F2-49F1-A2F0-EFB3397A8C95" title="权限表示对系统资源的访问。为了允许对applet（或使用安全管理器运行的应用程序）进行资源访问，必须将相应的权限显式授予尝试访问的代码。">JDK中的权限</a> 。</p>
                        <p>以来<code class="codeph">LoginModule</code>通常是联想<code class="codeph">Principal</code>和带有经过身份验证的主题的凭证，某些类型的权限<code class="codeph">LoginModule</code>通常需要使用<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/AuthPermission.html" target="_blank"><span class="apiname">AuthPermission</span></a> ，目标名称为“ modifyPrincipals”，“ modifyPublicCredentials”和“ modifyPrivateCredentials”。
                        </p>
                        <p>向某人授予权限的示例语句<code class="codeph">LoginModule</code>谁的代码在<code class="codeph">MyLM.jar</code>出现在下面。这样的声明可能会出现在策略文件中。在此示例中， <code class="codeph">MyLM.jar</code>假定文件位于<code class="codeph">/localWork</code>目录。
                        </p><pre class="pre codeblock"><code>grant codeBase "file:/localWork/MyLM.jar" {
    permission javax.security.auth.AuthPermission "modifyPrincipals";
    permission javax.security.auth.AuthPermission "modifyPublicCredentials";
    permission javax.security.auth.AuthPermission "modifyPrivateCredentials";
};
</code></pre><div class="infoboxnote" id="GUID-800F2CC8-C4BC-4AE7-B29A-1BFBE01D9979__GUID-AF562355-EB12-48C5-A4A3-686DB9A8DA32">
                           <p class="notep1">注意：</p>由于一个<code class="codeph">LoginModule</code>总是在<code class="codeph">AccessController.doPrivileged</code>打电话，它不必打电话<code class="codeph">doPrivileged</code>本身。如果这样做，可能会无意中打开一个安全漏洞。例如，一个<code class="codeph">LoginModule</code>调用应用程序提供的<code class="codeph">CallbackHandler</code>里面<code class="codeph">doPrivileged</code>调用通过允许应用程序的<code class="codeph">CallbackHandler</code>为了获得对资源的访问权，否则它将无法访问。
                        </div>
                     </div>
                     <!-- class="section" -->
                     <div class="section" id="GUID-800F2CC8-C4BC-4AE7-B29A-1BFBE01D9979__STEP6DCREATEACONFIGURATIONREFERENCI-83D21DD1">
                        <p class="subhead3" id="GUID-800F2CC8-C4BC-4AE7-B29A-1BFBE01D9979__GUID-38008F4A-62F7-45D8-B3DF-04E9B499C382">步骤6c：创建引用LoginModule的配置</p>
                        <p>由于JAAS支持可插拔身份验证体系结构，因此您的新<code class="codeph">LoginModule</code>无需修改现有应用程序即可使用。只有登录<code class="codeph">Configuration</code>需要更新以指示使用新的<code class="codeph">LoginModule</code> 。
                        </p>
                        <p>默认值<code class="codeph">Configuration</code> Oracle的实现如<a href="https://docs.oracle.com/javase/10/docs/api/com/sun/security/auth/login/ConfigFile.html" target="_blank"><span class="apiname">ConfigFile中</span></a>所述从配置文件中读取配置信息。
                        </p>
                        <p>创建一个配置文件以用于测试。例如，配置前面提到的假设IBM <code class="codeph">LoginModule</code>对于应用程序，配置文件可能如下所示：</p><pre class="pre codeblock"><code>    AppName {
        com.ibm.auth.Module REQUIRED debug=true;
    };
</code></pre><p>哪里<code class="codeph">AppName</code>应为应用程序用来在登录配置文件中引用此条目的任何名称。应用程序将此名称指定为<code class="codeph">LoginContext</code>构造函数。
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-D8079E42-9E73-4378-9D34-E528BE727857" name="GUID-D8079E42-9E73-4378-9D34-E528BE727857"></a><h4 id="JSSEC-GUID-D8079E42-9E73-4378-9D34-E528BE727857" class="sect4">步骤7：测试LoginModule的使用</h4>
                  <div>
                     <p>测试您的应用程序及其使用<code class="codeph">LoginModule</code> 。运行应用程序时，请指定要使用的登录配置文件。例如，假设您的应用程序名为<code class="codeph">MyApp</code> ， 它位于<code class="codeph">MyApp.jar</code> ，而您的配置文件是<code class="codeph">test.conf</code> 。
                     </p>
                     <div class="section">
                        <p>您可以运行应用程序并通过以下命令指定配置文件：</p><pre class="pre codeblock"><code>
java -classpath MyApp.jar
 -Djava.security.auth.login.config=test.conf MyApp
</code></pre><p>在一行上键入所有内容。为了清晰起见，此处使用多行。</p>
                        <p>指定名为的策略文件<code class="codeph">my.policy</code>并在安装了安全管理器的情况下运行该应用程序，请执行以下操作：</p><pre class="pre codeblock"><code>
java -classpath MyApp.jar -Djava.security.manager
 -Djava.security.policy=my.policy
 -Djava.security.auth.login.config=test.conf MyApp
</code></pre><p>再次在一行上键入所有内容。</p>
                        <p>您可能要配置<code class="codeph">LoginModule</code>带有<span class="variable" translate="no">debug</span>选项，以帮助确保其正常工作。
                        </p>
                        <p>调试您的代码，并根据需要继续测试。如果您有问题，请查看上述步骤并确保所有步骤均已完成。</p>
                        <p>确保更改用户输入，并且<code class="codeph">LoginModule</code>配置文件中指定的选项。
                        </p>
                        <p>确保还包括使用其他安装选项进行的测试（例如，将<code class="codeph">LoginModule</code>在类路径或模块路径上）和执行环境（运行或不运行安全管理器）。特别是为了确保您的<code class="codeph">LoginModule</code>当安装了安全管理器并且<code class="codeph">LoginModule</code> ，您需要在授予所需权限后测试这种安装和执行环境，如<a href="java-authentication-and-authorization-service-jaas-loginmodule-developers-guide1.html#GUID-800F2CC8-C4BC-4AE7-B29A-1BFBE01D9979__STEP6CSETLOGINMODULEANDAPPLICATIONJ-83D21A8B">步骤6b：设置LoginModule和Application JAR File Permissions中所述</a> 。
                        </p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li><span>如果您在测试过程中发现<code class="codeph">LoginModule</code>或应用程序需要修改，进行修改，然后重新编译（ <a href="java-authentication-and-authorization-service-jaas-loginmodule-developers-guide1.html#GUID-6DEAB2A4-2ADE-4CC8-B188-F0A58A38F61C" title="编译新的LoginModule和将用于测试的应用程序。">步骤5：编译LoginModule和Application</a> ）。</span></li>
                        <li><span>将更新的代码放入JAR文件中（ <a href="java-authentication-and-authorization-service-jaas-loginmodule-developers-guide1.html#GUID-800F2CC8-C4BC-4AE7-B29A-1BFBE01D9979__STEP6APLACEYOURLOGINMODULEANDAPPLIC-83D213BF">步骤6a：将LoginModule和应用程序代码放入JAR文件中</a> ）。</span></li>
                        <li><span>如果需要，请修复或添加到权限（ <a href="java-authentication-and-authorization-service-jaas-loginmodule-developers-guide1.html#GUID-800F2CC8-C4BC-4AE7-B29A-1BFBE01D9979__STEP6CSETLOGINMODULEANDAPPLICATIONJ-83D21A8B">步骤6b：设置LoginModule和应用程序JAR文件权限</a> ）。</span></li>
                        <li><span>如果需要，请修改登录配置文件（ <a href="java-authentication-and-authorization-service-jaas-loginmodule-developers-guide1.html#GUID-800F2CC8-C4BC-4AE7-B29A-1BFBE01D9979__STEP6DCREATEACONFIGURATIONREFERENCI-83D21DD1">步骤6c：创建引用LoginModule的配置</a> ）。</span></li>
                        <li><span>重新运行该应用程序，然后根据需要重复这些步骤。</span></li>
                     </ol>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-F799DF94-AD31-47CC-8760-863492F506EF" name="GUID-F799DF94-AD31-47CC-8760-863492F506EF"></a><h4 id="JSSEC-GUID-F799DF94-AD31-47CC-8760-863492F506EF" class="sect4">步骤8：记录您的LoginModule实现</h4>
                  <div>
                     <p>为您的客户编写文档<code class="codeph">LoginModule</code> 。
                     </p>
                     <div class="section">您可能要包括的示例文档是：</div>
                     <!-- class="section" -->
                     <ul>
                        <li><span>自述或说明的用户指南</span><ol>
                              <li><span>您使用的身份验证过程<code class="codeph">LoginModule</code>实施。</span></li>
                              <li><span>有关如何安装<code class="codeph">LoginModule</code> 。</span></li>
                              <li><span>接受的配置选项<code class="codeph">LoginModule</code> 。对于每个选项，请指定选项名称和可能的值（或值的类型），以及该选项控制的行为。</span></li>
                              <li><span>您所需的权限<code class="codeph">LoginModule</code>与安全管理器一起运行时。</span></li>
                           </ol>
                        </li>
                        <li><span>一个例子<code class="codeph">Configuration</code>引用您的新文件<code class="codeph">LoginModule</code> 。</span></li>
                        <li><span>授予您政策的示例政策文件<code class="codeph">LoginModule</code>所需的权限。</span></li>
                        <li><span>API文档。在编写Javadoc注释时将其放入源代码中将使Javadoc API文档易于生成。</span></li>
                     </ul>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-0A07484F-050E-4162-AE90-3A975AB26055" name="GUID-0A07484F-050E-4162-AE90-3A975AB26055"></a><h4 id="JSSEC-GUID-0A07484F-050E-4162-AE90-3A975AB26055" class="sect4">步骤9：使LoginModule JAR文件和文档可用</h4>
                  <div>
                     <p>做你的<code class="codeph">LoginModule</code>可供客户使用的JAR文件和文档。
                     </p>
                  </div>
               </div>
            </div>
         </div>
      </article>
   

</body></html>