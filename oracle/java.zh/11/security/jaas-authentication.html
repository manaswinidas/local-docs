<html lang="en-us"  xml:lang="en-us"><head></head><body >﻿
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>JAAS认证</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Security Developer’s Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Security Developer’s Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="security-developer-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-21T08:42:26-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="1993, 2018">
      <meta name="dcterms.category" content="java">
      <meta name="dcterms.identifier" content="E94828-01">
      
      <meta name="dcterms.product" content="en/java/javase/11">
      <meta name="dcterms.release" content="11">
      <link rel="prev" href="use-java-gss-api-secure-message-exchanges-jaas-programming.html" title="Previous" type="text/html">
      <link rel="next" href="jaas-authorization.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"java","element_name":"Java","display_in_url":true},"suite":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product_group":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product":{"short_name":"javase","element_name":"Java SE","display_in_url":true},"release":{"short_name":"11","element_name":"11","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Security Developer Guide">
    <meta name="dcterms.isVersionOf" content="SECURITY">
  <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script>
   
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="use-java-gss-api-secure-message-exchanges-jaas-programming.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一个</a> <a href="jaas-authorization.html" class="pull-right">下一个<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">安全开发人员指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="java-generic-security-services-java-gss-api1.html" property="item" typeof="WebPage"><span property="name">Java通用安全服务（Java GSS-API）</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="introduction-jaas-and-java-gss-api-tutorials1.html" property="item" typeof="WebPage"><span property="name">JAAS和Java GSS-API教程简介</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">JAAS认证</li>
            </ol>
            <a id="GUID-0C6EB04B-D203-4688-A3E2-A7D442334623" name="GUID-0C6EB04B-D203-4688-A3E2-A7D442334623"></a>
            
            <h2 id="JSSEC-GUID-0C6EB04B-D203-4688-A3E2-A7D442334623" class="sect2">JAAS认证</h2>
         </header>
         <div class="ind">
            <div>
               <p>JAAS可以用于两个目的：</p>
               <ul style="list-style-type:disc">
                  <li>为了对用户进行<span class="variable" translate="no">authentication</span> ，无论代码是作为应用程序，applet，bean还是servlet运行，都可以可靠，安全地确定谁正在执行Java代码。和</li>
                  <li><span class="variable" translate="no">authorization</span>用户以确保他们具有执行所执行操作所需的访问控制权（权限）。
                  </li>
               </ul>
               <p>本节提供了身份验证组件的基本教程。授权组件将在<a href="jaas-authorization.html#GUID-69241059-CCD0-49F6-838F-DDC752F9F19F">JAAS授权</a>教程中进行描述。
               </p>
               <p>JAAS认证以<span class="variable" translate="no">pluggable</span>方式执行。这允许Java应用程序保持独立于基础身份验证技术的状态。可以插入新技术或更新技术，而无需修改应用程序本身。在运行时确定要使用的特定身份验证技术的实现。该实现在登录配置文件中指定。本教程使用的身份验证技术是Kerberos。（请参阅<a href="kerberos-requirements.html#GUID-EAA2758B-3071-4CDA-AEF1-D76F5271E998">Kerberos要求</a> 。）
               </p>
               <p>本教程的其余部分包括以下部分：</p>
               <ol>
                  <li><a href="jaas-authentication.html#GUID-F12A6645-5A3E-41F7-94E6-57694DFFF2D3">认证教程代码</a></li>
                  <li><a href="jaas-authentication.html#GUID-C595253D-3817-4CA6-9336-D7D5159C9680">登录配置</a></li>
                  <li><a href="jaas-authentication.html#GUID-A76E9155-E82F-48C0-9382-C365C157EEBF">运行代码</a></li>
                  <li><a href="jaas-authentication.html#GUID-EF86E769-AFAF-4341-B9B0-4E122A0BFCEC">使用安全管理器运行代码</a></li>
               </ol>
               <p>如果要首先查看实际使用的教程代码，则可以直接跳至“ <a href="jaas-authentication.html#GUID-A76E9155-E82F-48C0-9382-C365C157EEBF">运行代码”</a> ，然后返回其他部分以了解有关编码和配置文件的详细信息。
               </p>
            </div>
            <div class="sect2"><a id="GUID-F12A6645-5A3E-41F7-94E6-57694DFFF2D3" name="GUID-F12A6645-5A3E-41F7-94E6-57694DFFF2D3"></a><h3 id="JSSEC-GUID-F12A6645-5A3E-41F7-94E6-57694DFFF2D3" class="sect3">认证教程代码</h3>
               <div>
                  <p>我们的身份验证教程代码包含在一个源文件中， <a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__JAASACN.JAVA-338927FE"><code>JaasAcn.java</code></a> 。该文件的<code class="codeph">main</code>方法执行身份验证，然后报告身份验证是否成功。
                  </p>
                  <p>用于验证用户身份的代码非常简单，仅包含两个步骤：</p>
                  <ol>
                     <li><a href="jaas-authentication.html#GUID-080F384C-0FF3-4443-B4A7-21B6F03371F0">实例化LoginContext</a></li>
                     <li><a href="jaas-authentication.html#GUID-98A3DD32-C417-449B-9C55-1C9509364612">调用LoginContext的登录方法</a></li>
                  </ol>
               </div>
               <div class="sect3"><a id="GUID-080F384C-0FF3-4443-B4A7-21B6F03371F0" name="GUID-080F384C-0FF3-4443-B4A7-21B6F03371F0"></a><h4 id="JSSEC-GUID-080F384C-0FF3-4443-B4A7-21B6F03371F0" class="sect4">实例化LoginContext</h4>
                  <div>
                     <p>为了验证用户身份，您首先需要一个<code class="codeph">javax.security.auth.login.LoginContext</code> 。这是实例化<span class="apiname">LoginContext</span>的基本方法：</p><pre class="pre codeblock"><code>import javax.security.auth.login.*;
. . .
LoginContext lc = 
    new LoginContext(<span class="variable" translate="no">&lt;config file entry name&gt;</span>,
           <span class="variable" translate="no">&lt;CallbackHandler to be used for user interaction&gt;</span>); 
</code></pre><p>这是我们的教程代码执行实例化的特定方式：</p><pre class="pre codeblock"><code>import javax.security.auth.login.*;
import com.sun.security.auth.callback.TextCallbackHandler;
. . .
<span class="bold">LoginContext lc = 
    new LoginContext("JaasSample", 
          new TextCallbackHandler());</span>
</code></pre><p>参数如下：</p>
                     <ol>
                        <li><span class="bold">JAAS登录配置文件中的条目名称</span><p>这是<span class="apiname">LoginContext</span>的名称，用于在JAAS登录配置文件中查找此应用程序的条目，如<a href="jaas-authentication.html#GUID-C595253D-3817-4CA6-9336-D7D5159C9680">“登录配置”中所述</a> 。这样的条目指定了实现所需基础身份验证技术的类。该类必须实现<span class="apiname">LoginModule</span>接口，该接口位于<code class="codeph">javax.security.auth.spi</code>包。
                           </p>
                           <p>在示例代码中，我们使用<code class="codeph">Krb5LoginModule</code>在里面<code class="codeph">com.sun.security.auth.module</code>软件包，用于执行Kerberos身份验证。
                           </p>
                           <p>本教程使用的登录配置文件中的条目（请参阅<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__JASS.CONF-33892AE7"><code>jaas.conf</code></a> ）的名称为“ JaasSample”，因此我们将其指定为<span class="apiname">LoginContext</span>构造函数的第一个参数。
                           </p>
                        </li>
                        <li><span class="bold">一个<span class="apiname">CallbackHandler</span>实例。</span><p>当<span class="apiname">LoginModule</span>需要与用户通信时（例如，要求输入用户名和密码），它不会直接进行通信。那是因为有多种与用户通信的方式，并且希望<span class="apiname">LoginModule</span>保持独立于不同类型的用户交互。而是， <span class="apiname">LoginModule</span>调用<span class="apiname">CallbackHandler</span>来执行用户交互并获取请求的信息，例如用户名和密码。（ <span class="apiname">CallbackHandler</span>是<code class="codeph">javax.security.auth.callback</code>包。）
                           </p>
                           <p>将要使用的特定<span class="apiname">CallbackHandler</span>的实例指定为<span class="apiname">LoginContext</span>构造函数的第二个参数。<span class="apiname">LoginContext</span>将实例转发到基础<span class="apiname">LoginModule</span> （在我们的示例中为<span class="apiname">Krb5LoginModule</span> ）。应用程序通常提供其自己的<span class="apiname">CallbackHandler</span>实现。在中提供了一个简单的<span class="apiname">CallbackHandler</span> <span class="apiname">TextCallbackHandler</span> 。 <code class="codeph">com.sun.security.auth.callback</code>软件包以将信息输出到命令行并从命令行读取输入。
                           </p>
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-98A3DD32-C417-449B-9C55-1C9509364612" name="GUID-98A3DD32-C417-449B-9C55-1C9509364612"></a><h4 id="JSSEC-GUID-98A3DD32-C417-449B-9C55-1C9509364612" class="sect4">调用LoginContext的登录方法</h4>
                  <div>
                     <p>一旦我们有了一个<span class="apiname">LoginContext</span> <code class="codeph">lc</code> ，我们可以称之为<code class="codeph">login</code>进行身份验证过程的方法：</p><pre class="pre codeblock"><code>lc.login();
</code></pre><p>LoginContext实例化一个新的空<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/Subject.html" target="_blank"><code class="codeph">javax.security.auth.Subject</code></a>对象（代表正在验证的用户或服务；请参见<a href="java-authentication-and-authorization-service-jaas-reference-guide.html#GUID-804BDE80-9E66-421C-BF0A-A96FBE7DE4E3">Subject</a> ）。<span class="apiname">LoginContext</span>构造配置的<span class="apiname">LoginModule</span> （在我们的示例中为<span class="apiname">Krb5LoginModule</span> ），并使用此新的<span class="apiname">Subject</span>和<span class="apiname">TextCallbackHandler</span>对其进行初始化。
                     </p>
                     <p><span class="apiname">LoginContext</span>的<code class="codeph">login</code>然后，方法调用<span class="apiname">Krb5LoginModule中的</span>方法以执行登录和身份验证。<span class="apiname">Krb5LoginModule</span>将利用<span class="apiname">TextCallbackHandler</span>获得用户名和密码。然后， <span class="apiname">Krb5LoginModule</span>将使用此信息从Kerberos KDC获取用户凭据。请参阅<a href="http://web.MIT.edu/kerberos/www/index.html" target="_blank">Kerberos参考文档</a> 。
                     </p>
                     <p>如果身份验证成功，则<span class="apiname">Krb5LoginModule会</span>用（1）代表用户的Kerberos <span class="apiname">主体</span>和（2）用户的凭证（TGT）填充<span class="apiname">主题</span> 。
                     </p>
                     <p>调用应用程序可以通过调用<span class="apiname">LoginContext</span>的随后检索认证<span class="apiname">主题</span> <code class="codeph">getSubject</code>方法，尽管本教程不需要这样做。
                     </p>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-C595253D-3817-4CA6-9336-D7D5159C9680" name="GUID-C595253D-3817-4CA6-9336-D7D5159C9680"></a><h3 id="JSSEC-GUID-C595253D-3817-4CA6-9336-D7D5159C9680" class="sect3">登录配置</h3>
               <div>
                  <p>JAAS身份验证以可插入方式执行，因此应用程序可以保持独立于基础身份验证技术的状态。系统管理员确定将用于每个应用程序的身份验证技术或<span class="apiname">LoginModule</span> ，并在登录<span class="apiname">Configuration中</span>对其进行<span class="apiname">配置</span> 。配置信息的来源（例如，文件或数据库）取决于当前的<a href="https://docs.oracle.com/javase/10/docs/api/javax/security/auth/login/Configuration.html" target="_blank"><span class="apiname">javax.security.auth.login。配置</span></a>实施。默认值<code class="codeph">Configuration</code>如<a href="https://docs.oracle.com/javase/10/docs/api/com/sun/security/auth/login/ConfigFile.html" target="_blank"><span class="apiname">com.sun.security.auth.login中所述，Oracle实施从配置文件中读取配置信息</span></a><a href="https://docs.oracle.com/javase/10/docs/api/com/sun/security/auth/login/ConfigFile.html" target="_blank"><span class="apiname">。ConfigFile</span></a> 。
                  </p>
                  <p>有关什么是登录配置文件，包含的内容以及如何指定应使用哪个登录配置文件的信息，请参见<a href="appendix-b-jaas-login-configuration-file.html#GUID-7EB80FA5-3C16-4016-AED6-0FC619F86F8E">附录B：JAAS登录配置文件</a> 。
                  </p>
               </div>
               <div class="sect3"><a id="GUID-D6F986DD-2046-4025-A65F-AC8855C85984" name="GUID-D6F986DD-2046-4025-A65F-AC8855C85984"></a><h4 id="JSSEC-GUID-D6F986DD-2046-4025-A65F-AC8855C85984" class="sect4">本教程的登录配置文件</h4>
                  <div>
                     <p>如前所述，我们在本教程中使用的登录配置文件<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__JASS.CONF-33892AE7">jass.conf</a>仅包含一个条目，即</p><pre class="pre codeblock"><code>JaasSample {
  com.sun.security.auth.module.Krb5LoginModule required;
};
</code></pre><p>该条目名为<code class="codeph">JaasSample</code>这就是我们的教程应用程序的名称， <code class="codeph">JaasAcn</code> ，用于引用该条目。该条目指定要用于执行用户身份验证的<span class="apiname">LoginModule</span>是<span class="apiname">Krb5LoginModule</span> ，位于<code class="codeph">com.sun.security.auth.module</code>包，并且“成功”需要此<span class="apiname">Krb5LoginModule</span>才能使身份验证成功。仅当成功使用用户提供的名称和密码将用户登录到Kerberos KDC时， <span class="apiname">Krb5LoginModule才会</span>成功。</p>
                     <p>请参阅<a href="https://docs.oracle.com/javase/10/docs/api/com/sun/security/auth/module/Krb5LoginModule.html" target="_blank"><span class="apiname">Krb5LoginModule</span></a> Javadoc API文档，以获取有关可以传递给<span class="apiname">Krb5LoginModule的</span>所有可能选项的信息。
                     </p>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-A76E9155-E82F-48C0-9382-C365C157EEBF" name="GUID-A76E9155-E82F-48C0-9382-C365C157EEBF"></a><h3 id="JSSEC-GUID-A76E9155-E82F-48C0-9382-C365C157EEBF" class="sect3">运行代码</h3>
               <div>
                  <p>要执行我们的JAAS认证教程代码，您要做的就是</p>
                  <ol>
                     <li>放置<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__JAASACN.JAVA-338927FE"><code>JaasAcn.java</code></a>应用程序源文件和<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__JASS.CONF-33892AE7"><code>jaas.conf</code></a>登录配置文件到目录中。
                     </li>
                     <li>编译<code class="codeph">JaasAcn.java</code> ：<pre class="pre codeblock"><code>
javac JaasAcn.java
</code></pre></li>
                     <li>执行<code class="codeph">JaasAcn</code>应用程序，指定<ul style="list-style-type:disc">
                           <li>
                              <p>通过<code class="codeph">-Djava.security.krb5.realm=<span class="variable" translate="no"><your_realm></span></code>您的Kerberos领域是指定的领域。
                              </p>
                              <p>例如，如果您的领域是<code class="codeph">KRBNT-OPERATIONS.EXAMPLE.COM</code>你放<code class="codeph">-Djava.security.krb5.realm=KRBNT-OPERATIONS.EXAMPLE.COM</code> 。
                              </p>
                           </li>
                           <li>
                              <p>通过<code class="codeph">-Djava.security.krb5.kdc=<span class="variable" translate="no"><your_kdc></span></code>您的Kerberos KDC是指定的那个。
                              </p>
                              <p>例如，如果您的KDC是<code class="codeph">samplekdc.example.com</code>你放<code class="codeph">-Djava.security.krb5.kdc=samplekdc.example.com</code> 。
                              </p>
                           </li>
                           <li>
                              <p>通过<code class="codeph">-Djava.security.auth.login.config=jaas.conf</code>要使用的登录配置文件是<code class="codeph">jaas.conf</code> 。
                              </p>
                           </li>
                        </ul>
                     </li>
                  </ol>
                  <p>完整命令如下。</p>
                  <div class="infoboxnote" id="GUID-A76E9155-E82F-48C0-9382-C365C157EEBF__GUID-5651F673-F501-42BB-AF33-C11B7DCC5F73">
                     <p class="notep1">注意：</p>
                     <p><span class="bold">请务必更换<code class="codeph"><span class="variable" translate="no"><your_realm></span></code>与您的Kerberos领域，以及<code class="codeph"><span class="variable" translate="no"><your_kdc></span></code>与您的Kerberos KDC。</span></p>
                  </div><pre class="pre codeblock"><code>
java -Djava.security.krb5.realm=<span class="variable" translate="no">&lt;your_realm&gt;</span> 
 -Djava.security.krb5.kdc=<span class="variable" translate="no">&lt;your_kdc&gt;</span> 
 -Djava.security.auth.login.config=jaas.conf JaasAcn
</code></pre><p>在一行上键入所有内容。为了清晰起见，此处使用多行。</p>
                  <p>系统将提示您输入Kerberos用户名和密码，并且在登录配置文件中指定的基础Kerberos身份验证机制将使您登录Kerberos。如果登录成功，您将看到以下消息：</p><pre class="pre codeblock"><code>Authentication succeeded!
</code></pre><p>如果登录失败（例如，如果您拼错了密码），则会看到</p><pre class="pre codeblock"><code>Authentication failed:
</code></pre><p>其次是失败的原因。例如，如果您输入错误的用户名，则可能会看到类似以下的消息（此处对格式进行了稍微修改以提高可读性）：</p><pre class="pre codeblock"><code>Authentication failed:
  Kerberos Authentication Failed:
    javax.security.auth.login.LoginException: 
      KrbException: Client not found in Kerberos database
</code></pre><p>有关登录故障排除的建议，请参阅<a href="troubleshooting.html#GUID-2087ADBA-6C36-43D5-8841-C79FCB4F5FBE">故障排除</a> 。
                  </p>
                  <p>解决任何问题后，请重新运行该程序以重试。</p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-EF86E769-AFAF-4341-B9B0-4E122A0BFCEC" name="GUID-EF86E769-AFAF-4341-B9B0-4E122A0BFCEC"></a><h3 id="JSSEC-GUID-EF86E769-AFAF-4341-B9B0-4E122A0BFCEC" class="sect3">使用安全管理器运行代码</h3>
               <div>
                  <p>当Java程序在安装了安全管理器的情况下运行时，除非该程序被明确授予许可，否则该程序将不允许访问资源或执行对安全性敏感的操作（请参阅<a href="permissions-jdk1.html#GUID-1E8E213A-D7F2-49F1-A2F0-EFB3397A8C95" title="权限表示对系统资源的访问。为了允许对applet（或使用安全管理器运行的应用程序）进行资源访问，必须将相应的权限显式授予尝试访问的代码。">JDK中的Permission，</a>以有效的安全策略来执行此操作）。该权限必须由策略文件中的条目授予（请参阅<a href="permissions-jdk1.html#GUID-789089CA-8557-4017-B8B0-6899AD3BA18D">默认策略实现和策略文件语法</a> ）。
                  </p>
                  <p>大多数浏览器都安装了安全管理器，因此<span class="variable" translate="no">applets</span>通常在安全管理器的审查下运行。另一方面， <span class="variable" translate="no">Applications</span>则不会，因为在运行应用程序时不会自动安装安全管理器。因此，像我们这样的应用程序<code class="codeph">JaasAcn</code>应用程序，默认情况下具有对资源的完全访问权限。
                  </p>
                  <p><span class="bold">要使用安全管理器运行应用程序</span> ，只需使用以下命令调用解释器： <code class="codeph">-Djava.security.manager</code>命令行中包含的参数。
                  </p>
                  <p>如果您尝试调用<code class="codeph">JaasAcn</code>使用安全管理器但未指定任何策略文件，您将获得以下内容（除非您在其他地方具有默认的策略设置，该默认策略设置授予了必需的权限或授权<code class="codeph">AllPermission</code> ）：</p><pre class="pre codeblock"><code>% java -Djava.security.manager \
 -Djava.security.krb5.realm=<span class="variable" translate="no">&lt;your_realm&gt;</span> \
 -Djava.security.krb5.kdc=<span class="variable" translate="no">&lt;your_kdc&gt;</span> \
 -Djava.security.auth.login.config=jaas.conf JaasAcn
Exception in thread "main" java.security.AccessControlException: 
  access denied (
  javax.security.auth.AuthPermission createLoginContext.JaasSample)
</code></pre><p>如您所见，您将获得一个<span class="apiname">AccessControlException</span> ，因为我们还没有创建和使用一个策略文件来向我们的代码授予允许创建<span class="apiname">LoginContext</span>所需的权限。
                  </p>
                  <p>这是能够运行我们的产品所需的完整步骤<code class="codeph">JaasAcn</code>安装了安全管理器的应用程序。如果您已经完成了前两个步骤，则可以跳过它们，如<a href="jaas-authentication.html#GUID-A76E9155-E82F-48C0-9382-C365C157EEBF">运行代码中所述</a> 。
                  </p>
                  <ol>
                     <li>放置<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__JAASACN.JAVA-338927FE"><code>JaasAcn.java</code></a>应用程序源文件和<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__JASS.CONF-33892AE7"><code>jaas.conf</code></a>登录配置文件到目录中。
                     </li>
                     <li>编译<code class="codeph">JaasAcn.java</code> ：<pre class="pre codeblock"><code>javac JaasAcn.java
</code></pre></li>
                     <li>创建一个包含以下内容的JAR文件<code class="codeph">JaasAcn.class</code> ：<pre class="pre codeblock"><code>jar -cvf JaasAcn.jar JaasAcn.class
</code></pre><p>该命令创建一个JAR文件， <code class="codeph">JaasAcn.jar</code> ，并将<code class="codeph">JaasAcn.class</code>里面的文件。
                        </p>
                     </li>
                     <li>创建一个策略文件，向JAR文件中的代码授予所需的权限。
                        <p>尝试实例化<span class="apiname">LoginContext</span>的代码所需的权限是<code class="codeph">javax.security.auth.AuthPermission</code>与目标<code class="codeph">createLoginContext.<span class="variable" translate="no"><entry name></span></code> 。这里， <code class="codeph"><span class="variable" translate="no"><entry name></span></code>引用应用程序在其<span class="apiname">LoginContext</span>实例中引用的登录配置文件条目的名称。我们使用的名称<code class="codeph">JaasAcn</code>应用程序的<span class="apiname">LoginContext</span>实例为<code class="codeph">JaasSample</code> ，如您在代码中所见：</p><pre class="pre codeblock"><code>LoginContext lc = 
    new LoginContext("JaasSample", 
          new TextCallbackHandler());
</code></pre>因此，需要授予的许可<code class="codeph">JaasAcn.jar</code>是<pre class="pre codeblock"><code>permission javax.security.auth.AuthPermission 
  "createLoginContext.JaasSample";
</code></pre>复制策略文件<a href="source-code-jaas-and-java-gss-api-tutorials.html#GUID-09D4192C-D855-49D6-BC62-E08F49ADB4F8__JASSACN.POLICY-33892D36"><code>jaasacn.policy</code></a>到与您存储的目录相同的目录<code class="codeph">JaasAcn.java</code> ，等等。这是一个文本文件，包含以下内容<code class="codeph">grant</code>授予声明<code class="codeph">JaasAcn.jar</code> （在当前目录中）所需的权限：<pre class="pre codeblock"><code>grant codebase "file:./JaasAcn.jar" {
   permission javax.security.auth.AuthPermission 
                    "createLoginContext.JaasSample";
};
</code></pre><p>注意：策略文件及其中条目的结构在“ <a href="permissions-jdk1.html#GUID-789089CA-8557-4017-B8B0-6899AD3BA18D">默认策略实现”和“策略文件语法”中</a>进行了描述。权限<a href="permissions-jdk1.html#GUID-1E8E213A-D7F2-49F1-A2F0-EFB3397A8C95" title="A permission represents access to a system resource. In order for a resource access to be allowed for an applet (or an application running with a security manager), the corresponding permission must be explicitly granted to the code attempting the access.">在JDK</a>中的“ <a href="permissions-jdk1.html#GUID-1E8E213A-D7F2-49F1-A2F0-EFB3397A8C95" title="权限表示对系统资源的访问。为了允许对applet（或使用安全管理器运行的应用程序）进行资源访问，必须将相应的权限显式授予尝试访问的代码。">权限”中进行了</a>描述。</p>
                     </li>
                     <li>执行<code class="codeph">JaasAcn</code>应用程序，指定<ol type="a">
                           <li>通过适当的<code class="codeph">-classpath</code>子句，应该在<code class="codeph">JaasAcn.jar</code> JAR文件，</li>
                           <li>通过<code class="codeph">-Djava.security.manager</code>应该安装安全管理器，</li>
                           <li>通过<code class="codeph">-Djava.security.krb5.realm=<span class="variable" translate="no"><your_realm></span></code>您的Kerberos领域是指定的领域。例如，如果您的领域是<code class="codeph">KRBNT-OPERATIONS.EXAMPLE.COM</code>你放<code class="codeph">-Djava.security.krb5.realm=KRBNT-OPERATIONS.EXAMPLE.COM</code> 。
                           </li>
                           <li>通过<code class="codeph">-Djava.security.krb5.kdc=<span class="variable" translate="no"><your_kdc></span></code>您的Kerberos KDC是指定的那个。例如，如果您的KDC是<code class="codeph">samplekdc.example.com</code>你放<code class="codeph">-Djava.security.krb5.kdc=samplekdc.example.com</code> 。
                           </li>
                           <li>通过<code class="codeph">-Djava.security.policy=jaasacn.policy</code>要使用的策略文件是<code class="codeph">jaasacn.policy</code>和</li>
                           <li>通过<code class="codeph">-Djava.security.auth.login.config=jaas.conf</code>要使用的登录配置文件是<code class="codeph">jaas.conf</code> 。
                           </li>
                        </ol>
                        <p>完整命令如下。</p>
                        <div class="infoboxnote" id="GUID-EF86E769-AFAF-4341-B9B0-4E122A0BFCEC__GUID-38015C89-C0E8-4C45-934F-7AF0A69D677B">
                           <p class="notep1">注意：</p>
                           <p><span class="bold">请务必更换<code class="codeph"><span class="variable" translate="no"><your_realm></span></code>与您的Kerberos领域，以及<code class="codeph"><span class="variable" translate="no"><your_kdc></span></code>与您的Kerberos KDC。</span></p>
                        </div><pre class="pre codeblock"><code>java -classpath JaasAcn.jar -Djava.security.manager 
 -Djava.security.krb5.realm=<span class="variable" translate="no">&lt;your_realm&gt;</span> 
 -Djava.security.krb5.kdc=<span class="variable" translate="no">&lt;your_kdc&gt;</span> 
 -Djava.security.policy=jaasacn.policy 
 -Djava.security.auth.login.config=jaas.conf JaasAcn
</code></pre><p>在一行上键入所有内容。为了清晰起见，此处使用多行。如果该命令对于您的系统而言太长，则可能需要将其放置在.bat文件（对于Windows）或.sh文件（对于Solaris，Linux和macOS）中，然后运行该文件以执行命令。</p>
                        <p>由于指定的策略文件包含授予代码所需权限的条目， <code class="codeph">JaasAcn</code>将允许实例化<span class="apiname">LoginContext</span>并继续执行。系统将提示您输入Kerberos用户名和密码，并且在登录配置文件中指定的基础Kerberos身份验证机制将使您登录Kerberos。如果登录成功，您将看到消息“身份验证成功！”，如果没有，您将看到“身份验证失败：”以及失败的原因。
                        </p>
                        <p>有关登录故障排除的建议，请参阅<a href="troubleshooting.html#GUID-2087ADBA-6C36-43D5-8841-C79FCB4F5FBE">故障排除</a> 。
                        </p>
                     </li>
                  </ol>
               </div>
            </div>
         </div>
      </article>
   

</body></html>