<html lang="en-us"  xml:lang="en-us"><head></head><body >﻿
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="The following topics examine how directives behave and interact.">
      <meta name="description" content="The following topics examine how directives behave and interact.">
      <title>了解指令</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Java Virtual Machine Guide">
      <meta property="og:description" content="The following topics examine how directives behave and interact.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Java Virtual Machine Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="java-virtual-machine-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-20T02:39:56-07:00">
      <meta name="dcterms.title" content="Java Virtual Machine Guide">
      <meta name="dcterms.dateCopyrighted" content="1993, 2018">
      <meta name="dcterms.category" content="java">
      <meta name="dcterms.identifier" content="E95202-01">
      
      <meta name="dcterms.product" content="en/java/javase/11">
      <meta name="dcterms.release" content="11">
      <link rel="prev" href="writing-directives.html" title="Previous" type="text/html">
      <link rel="next" href="commands-work-directive-files.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"java","element_name":"Java","display_in_url":true},"suite":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product_group":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product":{"short_name":"javase","element_name":"Java SE","display_in_url":true},"release":{"short_name":"11","element_name":"11","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="VM">
  <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script>
   
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="writing-directives.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一个</a> <a href="commands-work-directive-files.html" class="pull-right">下一个<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Java虚拟机指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="compiler-control1.html" property="item" typeof="WebPage"><span property="name">编译器控制</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">了解指令</li>
            </ol>
            <a id="GUID-C776A298-BC96-40C7-8028-DB461298DD9F" name="GUID-C776A298-BC96-40C7-8028-DB461298DD9F"></a>
            
            <h2 id="JSJVM-GUID-C776A298-BC96-40C7-8028-DB461298DD9F" class="sect2">了解指令</h2>
         </header>
         <div class="ind">
            <div>
               <p>以下主题研究了指令如何行为和交互。</p>
               <div class="section">
                  <p class="subhead1" id="GUID-C776A298-BC96-40C7-8028-DB461298DD9F__GUID-5C232252-6A97-4F24-837A-22730B66F082">话题：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><a href="understanding-directives-better.html#GUID-1011AB83-1C0E-4C4B-B302-4CD487F25C61" title="默认指令是一个编译器指令，其中包含所有可能的指令选项的默认值。它是堆栈中最底层的指令，与提交给编译的每个方法匹配。">什么是默认指令？</a></p>
                     </li>
                     <li>
                        <p><a href="understanding-directives-better.html#GUID-FB010DC3-9E3C-4D19-AEDE-9527DAA1AD7D" title="伪指令基于方法匹配过程应用于代码。提交编译的每个方法都与指令堆栈中的指令匹配。">指令如何应用于代码？</a></p>
                     </li>
                     <li>
                        <p><a href="understanding-directives-better.html#GUID-AC93D367-C00F-4054-83A0-42C4BD5C4F87" title="CompileCommand和命令行标志可与Compiler Control指令一起使用。">编译器控制和向后兼容性</a></p>
                     </li>
                  </ul>
               </div>
               <!-- class="section" -->
            </div>
            <div class="sect2"><a id="GUID-1011AB83-1C0E-4C4B-B302-4CD487F25C61" name="GUID-1011AB83-1C0E-4C4B-B302-4CD487F25C61"></a><h3 id="JSJVM-GUID-1011AB83-1C0E-4C4B-B302-4CD487F25C61" class="sect3">什么是默认指令？</h3>
               <div>
                  <p>默认指令是一个编译器指令，其中包含所有可能的指令选项的默认值。它是堆栈中最底层的指令，与提交给编译的每个方法匹配。</p>
                  <p>设计新的编译器指令时，请指定新指令与默认指令的区别。默认指令成为指导设计决策的模板。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-1011AB83-1C0E-4C4B-B302-4CD487F25C61__GUID-D477DA1F-D95A-4B63-B8E4-C0D25DCC296D">默认指令中的指令选项值</p>
                     <div class="p">您可以打印一个空的指令堆栈，以显示匹配的条件和默认编译器指令中所有指令选项的值：<pre class="pre codeblock"><code>Directive: (default)
 matching: *.*
 c1 directives:
  inline: -
  Enable:true Exclude:false BreakAtExecute:false BreakAtCompile:false Log:false PrintAssembly:false PrintInlining:false PrintNMethods:false BackgroundCompilation:true ReplayInline:false DumpReplay:false DumpInline:false CompilerDirectivesIgnoreCompileCommands:false DisableIntrinsic: BlockLayoutByFrequency:true PrintOptoAssembly:false PrintIntrinsics:false TraceOptoPipelining:false TraceOptoOutput:false TraceSpilling:false Vectorize:false VectorizeDebug:0 CloneMapDebug:false IGVPrintLevel:0 MaxNodeLimit:80000

 c2 directives:
  inline: -
  Enable:true Exclude:false BreakAtExecute:false BreakAtCompile:false Log:false PrintAssembly:false PrintInlining:false PrintNMethods:false BackgroundCompilation:true ReplayInline:false DumpReplay:false DumpInline:false CompilerDirectivesIgnoreCompileCommands:false DisableIntrinsic: BlockLayoutByFrequency:true PrintOptoAssembly:false PrintIntrinsics:false TraceOptoPipelining:false TraceOptoOutput:false TraceSpilling:false Vectorize:false VectorizeDebug:0 CloneMapDebug:false IGVPrintLevel:0 MaxNodeLimit:80000
</code></pre><div class="infoboxnote" id="GUID-1011AB83-1C0E-4C4B-B302-4CD487F25C61__GUID-CD45A841-50FA-4EB4-BC4D-C9EC20C4D32B">
                           <p class="notep1">注意：</p>某些选项仅适用于<code class="codeph">c2</code>编译器。有关完整列表，请<a href="writing-directives.html#GUID-FF488969-AFCD-48ED-93F5-A49C6C893D39__C2OPTIONS-61F28E20" title="c2编译器专有的选项">参见表2-2</a> 。
                        </div>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-1011AB83-1C0E-4C4B-B302-4CD487F25C61__GUID-9F33081B-475E-4BAA-A6AF-7000099BB020">新指令中的指令选项值</p>
                     <p>在新的伪指令中，必须指定伪指令与默认伪指令的区别。如果未指定指令选项，则该选项将保留默认指令中的值。</p>
                     <div class="p">例：<pre class="pre codeblock"><code>[
    {
        match: ["*Concurrent.*"],
        c2: {
            MaxNodeLimit: 1000,
        },
        Exclude:true,
    },
]</code></pre>将新指令添加到指令堆栈时，默认指令将成为堆栈中最底部的指令。请参阅<a href="commands-work-directive-files.html#GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D" title="指令在指令文件中以及在指令中的顺序非常重要。堆栈中最顶部，最匹配的指令将获得优先级，并应用于代码编译。">如何在指令堆栈中对指令进行排序？</a> 有关此过程的说明。对于此示例，在打印指令堆栈时，它显示了新指令中指定的指令选项与默认指令中的值有何不同：<pre class="pre codeblock"><code>Directive:
 matching: *Concurrent.*
 c1 directives:
  inline: -
  Enable:true Exclude:true BreakAtExecute:false BreakAtCompile:false Log:false PrintAssembly:false PrintInlining:false PrintNMethods:false BackgroundCompilation:true ReplayInline:false DumpReplay:false DumpInline:false CompilerDirectivesIgnoreCompileCommands:false DisableIntrinsic: BlockLayoutByFrequency:true PrintOptoAssembly:false PrintIntrinsics:false TraceOptoPipelining:false TraceOptoOutput:false TraceSpilling:false Vectorize:false VectorizeDebug:0 CloneMapDebug:false IGVPrintLevel:0 MaxNodeLimit:80000 

 c2 directives:
  inline: -
  Enable:true Exclude:true BreakAtExecute:false BreakAtCompile:false Log:false PrintAssembly:false PrintInlining:false PrintNMethods:false BackgroundCompilation:true ReplayInline:false DumpReplay:false DumpInline:false CompilerDirectivesIgnoreCompileCommands:false DisableIntrinsic: BlockLayoutByFrequency:true PrintOptoAssembly:false PrintIntrinsics:false TraceOptoPipelining:false TraceOptoOutput:false TraceSpilling:false Vectorize:false VectorizeDebug:0 CloneMapDebug:false IGVPrintLevel:0 MaxNodeLimit:1000 


Directive: (default)
 matching: *.*
 c1 directives:
  inline: -
  Enable:true Exclude:false BreakAtExecute:false BreakAtCompile:false Log:false PrintAssembly:false PrintInlining:false PrintNMethods:false BackgroundCompilation:true ReplayInline:false DumpReplay:false DumpInline:false CompilerDirectivesIgnoreCompileCommands:false DisableIntrinsic: BlockLayoutByFrequency:true PrintOptoAssembly:false PrintIntrinsics:false TraceOptoPipelining:false TraceOptoOutput:false TraceSpilling:false Vectorize:false VectorizeDebug:0 CloneMapDebug:false IGVPrintLevel:0 MaxNodeLimit:80000 

 c2 directives:
  inline: -
  Enable:true Exclude:false BreakAtExecute:false BreakAtCompile:false Log:false PrintAssembly:false PrintInlining:false PrintNMethods:false BackgroundCompilation:true ReplayInline:false DumpReplay:false DumpInline:false CompilerDirectivesIgnoreCompileCommands:false DisableIntrinsic: BlockLayoutByFrequency:true PrintOptoAssembly:false PrintIntrinsics:false TraceOptoPipelining:false TraceOptoOutput:false TraceSpilling:false Vectorize:false VectorizeDebug:0 CloneMapDebug:false IGVPrintLevel:0 MaxNodeLimit:80000 </code></pre></div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-FB010DC3-9E3C-4D19-AEDE-9527DAA1AD7D" name="GUID-FB010DC3-9E3C-4D19-AEDE-9527DAA1AD7D"></a><h3 id="JSJVM-GUID-FB010DC3-9E3C-4D19-AEDE-9527DAA1AD7D" class="sect3">指令如何应用于代码？</h3>
               <div>
                  <p>伪指令基于方法匹配过程应用于代码。提交编译的每个方法都与指令堆栈中的指令匹配。</p>
                  <p>将方法与指令堆栈中的指令匹配的过程由CompilerBroker执行。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-FB010DC3-9E3C-4D19-AEDE-9527DAA1AD7D__GUID-CA350A20-34FE-4A50-9C2C-7DBEA6DB1348">方法匹配过程</p>
                     <p>提交方法进行编译时，会将方法的标准名称与指令堆栈中的匹配条件进行比较。堆栈中匹配的第一个指令将应用于该方法。堆栈中其余的指令将被忽略。如果未找到匹配项，则将应用默认指令。</p>
                     <p>对编译中的所有方法重复此过程。一个编译中可以应用多个指令，但是每个方法只能应用一个指令。堆栈中的所有指令均被视为活动指令，因为它们可能适用。活动和应用指令之间的主要区别是：</p>
                     <ul style="list-style-type:disc">
                        <li>
                           <p>如果指令存在于指令堆栈中，则该指令是活动的。</p>
                        </li>
                        <li>
                           <p>如果指令影响代码，则将其应用。</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-FB010DC3-9E3C-4D19-AEDE-9527DAA1AD7D__WHENAMATCHISFOUND-573E11E1">
                     <p class="titleinexample">示例2-1找到匹配项时</p>
                     <div class="p">以下示例显示了提交进行编译的方法：<pre class="pre codeblock"><code>public int exampleMethod(int x){
	return x;
}</code></pre>根据方法匹配标准， <code class="codeph">Directive 2</code>从以下示例指令堆栈应用：<pre class="pre codeblock"><code>Directive 2:
 matching: *.*example*
Directive 1:
 matching: *.*exampleMethod*
Directive 0: (default)
 matching: *.*</code></pre></div>
                  </div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-FB010DC3-9E3C-4D19-AEDE-9527DAA1AD7D__WHENNOMATCHISFOUND-573E14F6">
                     <p class="titleinexample">示例2-2未找到匹配项</p>
                     <div class="p">以下示例显示了提交进行编译的方法：<pre class="pre codeblock"><code>public int otherMethod(int y){
	return y;
}</code></pre>根据方法匹配标准， <code class="codeph">Directive 0</code> （默认指令）是从以下示例指令堆栈应用的：<pre class="pre codeblock"><code>Directive 2:
 matching: *.*example*
Directive 1:
 matching: *.*exampleMethod*
Directive 0: (default)
 matching: *.*</code></pre></div>
                  </div>
                  <!-- class="example" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-FB010DC3-9E3C-4D19-AEDE-9527DAA1AD7D__OTHERGUIDELINES-B2A2E979">编写新指令的准则</p>
                     <div class="p">
                        <ul style="list-style-type:disc">
                           <li>
                              <p>没有提供反馈机制来验证哪个指令应用于给定方法。取而代之的是，使用诸如Java管理扩展（JMX）之类的探查器来测量所应用指令的累积效果。</p>
                           </li>
                           <li>
                              <p>CompilerBroker会忽略创建错误代码的指令选项，例如在不提供支持的平台上强制执行硬件指令。显示警告消息。</p>
                           </li>
                           <li>
                              <p>指令选项与典型的命令行标志具有相同的限制。例如，仅在中间表示（IR）不会变得太大时才遵循内联代码的指令。</p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-AC93D367-C00F-4054-83A0-42C4BD5C4F87" name="GUID-AC93D367-C00F-4054-83A0-42C4BD5C4F87"></a><h3 id="JSJVM-GUID-AC93D367-C00F-4054-83A0-42C4BD5C4F87" class="sect3">编译器控制和向后兼容性</h3>
               <div>
                  <p>CompileCommand和命令行标志可与Compiler Control指令一起使用。</p>
                  <div class="p">尽管Compiler Control可以代替CompileCommand，但提供了向后兼容性。可以同时使用两者。编译器控制获得优先级。根据以下优先级处理冲突：<ol>
                        <li>
                           <p>编译器控制</p>
                        </li>
                        <li>
                           <p>编译命令</p>
                        </li>
                        <li>
                           <p>命令行标志</p>
                        </li>
                        <li>
                           <p>默认值</p>
                        </li>
                     </ol>
                  </div>
                  <div class="example" id="GUID-AC93D367-C00F-4054-83A0-42C4BD5C4F87__GUID-DCEFB89D-AA73-484F-B97A-270D472486A8">
                     <p class="titleinexample">示例2-3混合使用编译器控件和CompileCommand</p>
                     <div class="p">以下列表显示了少量的编译选项和值：<ul style="list-style-type:disc">
                           <li>
                              <p>编译器控制：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">Exclude: true</code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">BreakAtExecute: false</code></p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>编译命令：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">BreakAtExecute: true</code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">BreakAtCompile: true</code></p>
                                 </li>
                              </ul>
                           </li>
                           <li>
                              <p>默认值：</p>
                              <ul style="list-style-type:disc">
                                 <li>
                                    <p><code class="codeph">Exclude: false</code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">BreakAtExecute: false</code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">BreakAtCompile: false</code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">Log: false</code></p>
                                 </li>
                              </ul>
                           </li>
                        </ul>对于此示例中的选项和值，使用用于处理向后兼容性冲突的规则来确定生成的编译：<ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">Exclude: true</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">BreakAtExecute: false</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">BreakAtCompile: true</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">Log: false</code></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="example" -->
               </div>
            </div>
         </div>
      </article>
   

</body></html>