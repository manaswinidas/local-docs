<html lang="en-us"  xml:lang="en-us"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="This topic examines commands and the effects of working with completed directive files.">
      <meta name="description" content="This topic examines commands and the effects of working with completed directive files.">
      <title>Commands for Working with Directive Files</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Java Virtual Machine Guide">
      <meta property="og:description" content="This topic examines commands and the effects of working with completed directive files.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Java Virtual Machine Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="java-virtual-machine-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-20T02:39:56-07:00">
      <meta name="dcterms.title" content="Java Virtual Machine Guide">
      <meta name="dcterms.dateCopyrighted" content="1993, 2018">
      <meta name="dcterms.category" content="java">
      <meta name="dcterms.identifier" content="E95202-01">
      
      <meta name="dcterms.product" content="en/java/javase/11">
      <meta name="dcterms.release" content="11">
      <link rel="prev" href="understanding-directives-better.html" title="Previous" type="text/html">
      <link rel="next" href="garbage-collection-enhancements.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"java","element_name":"Java","display_in_url":true},"suite":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product_group":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product":{"short_name":"javase","element_name":"Java SE","display_in_url":true},"release":{"short_name":"11","element_name":"11","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="VM">
  <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="understanding-directives-better.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>上一个</a> <a href="garbage-collection-enhancements.html" class="pull-right">下一个<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a> <span class="fa fa-exclamation-triangle" aria-hidden="true"></span>必须启用JavaScript才能正确显示此内容</div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Java虚拟机指南</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="compiler-control1.html" property="item" typeof="WebPage"><span property="name">编译器控制</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">用于处理指令文件的命令</li>
            </ol>
            <a id="GUID-88ECC49E-4581-49F6-952F-0EB7E12E8C84" name="GUID-88ECC49E-4581-49F6-952F-0EB7E12E8C84"></a>
            
            <h2 id="JSJVM-GUID-88ECC49E-4581-49F6-952F-0EB7E12E8C84" class="sect2">用于处理指令文件的命令</h2>
         </header>
         <div class="ind">
            <div>
               <p>本主题检查命令以及使用完成的指令文件的效果。</p>
               <ul style="list-style-type:disc">
                  <li>
                     <p><a href="commands-work-directive-files.html#GUID-3517007F-824A-4079-B374-188C107D9AB2" title="您可以在启动程序时使用命令行界面添加和打印编译器指令。">编译器指令和命令行</a></p>
                  </li>
                  <li>
                     <p><a href="commands-work-directive-files.html#GUID-4B31D43A-EEBF-47E0-AAB5-9BEB23B7CFC2" title="您可以使用诊断命令来管理哪些指令在运行时处于活动状态。您可以添加或删除指令，而无需重新启动正在运行的程序。">编译器指令和诊断命令</a></p>
                  </li>
                  <li>
                     <p><a href="commands-work-directive-files.html#GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D" title="指令在指令文件中以及在指令中的顺序非常重要。堆栈中最顶部，最匹配的指令将获得优先级，并应用于代码编译。">指令堆栈中的指令顺序如何？</a></p>
                  </li>
               </ul>
            </div>
            <div class="sect2"><a id="GUID-3517007F-824A-4079-B374-188C107D9AB2" name="GUID-3517007F-824A-4079-B374-188C107D9AB2"></a><h3 id="JSJVM-GUID-3517007F-824A-4079-B374-188C107D9AB2" class="sect3">编译器指令和命令行</h3>
               <div>
                  <p>您可以在启动程序时使用命令行界面添加和打印编译器指令。</p>
                  <p>您只能在命令行中指定一个指令文件。该文件中的所有指令都添加到指令堆栈中，并且在程序启动时立即处于活动状态。在命令行中添加指令可以使您在程序的早期阶段测试指令的性能效果。您也可以专注于调试和开发程序。</p>
                  <div class="section">
                     <p class="subhead2" id="GUID-3517007F-824A-4079-B374-188C107D9AB2__GUID-C2CED810-86A6-48D1-89B4-E1D2604F2231">通过命令行添加指令</p>
                     <div class="p">以下命令行选项指定了指令文件：<pre class="pre codeblock"><code>XX:CompilerDirectivesFile=<span class="variable" translate="no">file</span></code></pre>启动Java程序时，请包含此命令行选项。以下示例显示了此选项，该选项开始<code class="codeph">TestProgram</code> ：<pre class="pre codeblock"><code>java -XX:+UnlockDiagnosticVMOptions -XX:CompilerDirectivesFile=File_A.json TestProgram</code></pre>在示例中：<ul style="list-style-type:disc">
                           <li>
                              <p><code class="codeph">-XX:+UnlockDiagnosticVMOptions</code>启用诊断选项。您必须先输入此内容，然后才能在命令行中添加指令。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">-XX:CompilerDirectivesFile</code>是一种诊断选项。您可以使用它指定一个指令文件以添加到指令堆栈。
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">File_A.json</code>是指令文件。该文件可以包含多个指令，程序启动时，所有这些指令都将添加到活动指令堆栈中。
                              </p>
                           </li>
                           <li>
                              <p>如果<code class="codeph">File_A.json</code>包含语法错误或格式错误的指令，然后显示错误消息并<code class="codeph">TestProgram</code>无法启动。
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-3517007F-824A-4079-B374-188C107D9AB2__GUID-A30F49F4-D0B8-46FD-9BCC-F7D8FA0DDFC0">通过命令行打印指令</p>
                     <div class="p">您可以在程序启动时或通过诊断命令添加其他指令时自动打印指令堆栈。以下命令行选项可启用此行为：<pre class="pre codeblock"><code>-XX:+CompilerDirectivesPrint</code></pre>以下示例显示如何在命令行中包含此诊断命令：<pre class="pre codeblock"><code>java -XX:+UnlockDiagnosticVMOptions -XX:+CompilerDirectivesPrint -XX:CompilerDirectivesFile=File_A.json TestProgram&nbsp;</code></pre></div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-4B31D43A-EEBF-47E0-AAB5-9BEB23B7CFC2" name="GUID-4B31D43A-EEBF-47E0-AAB5-9BEB23B7CFC2"></a><h3 id="JSJVM-GUID-4B31D43A-EEBF-47E0-AAB5-9BEB23B7CFC2" class="sect3">编译器指令和诊断命令</h3>
               <div>
                  <p>您可以使用诊断命令来管理哪些指令在运行时处于活动状态。您可以添加或删除指令，而无需重新启动正在运行的程序。</p>
                  <p>制作一个完美的指令文件可能需要一些迭代和试验。诊断命令提供了强大的机制来测试指令堆栈中指令的不同配置。使用诊断命令，您可以添加或删除指令，而无需重新启动正在运行的程序的JVM。</p>
               </div>
               <div class="sect3"><a id="GUID-EDDC54D0-F1E9-45C9-A251-C8067B1ABE17" name="GUID-EDDC54D0-F1E9-45C9-A251-C8067B1ABE17"></a><h4 id="JSJVM-GUID-EDDC54D0-F1E9-45C9-A251-C8067B1ABE17" class="sect4">获取您的Java进程标识号</h4>
                  <div>
                     <p>要测试指令，您必须找到正在运行的程序的处理器标识符（PID）号。</p>
                     <ol>
                        <li><span>打开一个终端。</span></li>
                        <li><span>输入<kbd class="userinput">jcmd</kbd>命令。</span></li>
                     </ol>
                     <div class="section">的<code>jcmd</code>命令返回正在运行的Java进程及其PID编号的列表。在以下示例中，返回的信息有关<code class="codeph">TestProgram</code> ：<pre class="pre codeblock"><code>11084 TestProgram</code></pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-AC077891-EB16-42FD-A10B-9FE1D2F4D03B" name="GUID-AC077891-EB16-42FD-A10B-9FE1D2F4D03B"></a><h4 id="JSJVM-GUID-AC077891-EB16-42FD-A10B-9FE1D2F4D03B" class="sect4">通过诊断命令添加指令</h4>
                  <div>
                     <p>您可以通过以下诊断命令将文件中的所有指令添加到指令堆栈。</p>
                     <div class="p">句法：<pre class="pre codeblock"><code>jcmd <span class="variable" translate="no">pid</span> Compiler.directives_add <span class="variable" translate="no">file</span></code></pre>以下示例显示了诊断命令：<pre class="pre codeblock"><code>jcmd 11084 Compiler.directives_add File_B.json</code></pre>终端报告添加的单个指令的数量。如果指令文件包含语法错误或格式错误的指令，则会显示一条错误消息，并且不会将文件中的指令添加到堆栈中，并且不会对正在运行的程序进行任何更改。</div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-11268025-CEE7-4C8A-82A4-B77FB690EFE7" name="GUID-11268025-CEE7-4C8A-82A4-B77FB690EFE7"></a><h4 id="JSJVM-GUID-11268025-CEE7-4C8A-82A4-B77FB690EFE7" class="sect4">通过诊断命令删除指令</h4>
                  <div>
                     <p>您可以使用诊断命令删除指令。</p>
                     <div class="p">要从指令堆栈中删除最顶层的单个指令，请输入：<pre class="pre codeblock"><code>jcmd <span class="variable" translate="no">pid</span> Compiler.directives_remove</code></pre>要清除添加到指令堆栈的每个指令，请输入：<pre class="pre codeblock"><code>jcmd <span class="variable" translate="no">pid</span> Compiler.directives_clear</code></pre>无法指定要删除的指令的整个文件，也无法使用其他任何方法来批量删除指令。</div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-0BA25646-8CB5-4DC4-A818-97140D83A4D9" name="GUID-0BA25646-8CB5-4DC4-A818-97140D83A4D9"></a><h4 id="JSJVM-GUID-0BA25646-8CB5-4DC4-A818-97140D83A4D9" class="sect4">通过诊断命令打印指令</h4>
                  <div>
                     <p>您可以使用诊断命令来打印正在运行的程序的指令堆栈。</p>
                     <div class="p">要打印完整指令堆栈的详细描述，请输入：<pre class="pre codeblock"><code>jcmd <span class="variable" translate="no">pid</span> Compiler.directives_print</code></pre>示例输出显示在<a href="understanding-directives-better.html#GUID-1011AB83-1C0E-4C4B-B302-4CD487F25C61" title="默认指令是一个编译器指令，其中包含所有可能的指令选项的默认值。它是堆栈中最底层的指令，与提交给编译的每个方法匹配。">什么是默认指令？</a></div>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D" name="GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D"></a><h3 id="JSJVM-GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D" class="sect3">指令堆栈中的指令顺序如何？</h3>
               <div>
                  <p>指令在指令文件中以及在指令中的顺序非常重要。堆栈中最顶部，最匹配的指令将获得优先级，并应用于代码编译。</p>
                  <p>以下示例说明了示例指令堆栈中指令文件的顺序。示例中的指令文件包含以下指令：</p>
                  <ul style="list-style-type:disc">
                     <li>
                        <p><code class="codeph">File_A</code>包含<code class="codeph">Directive 1</code>和<code class="codeph">Directive 2</code> 。
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">File_B</code>包含<code class="codeph">Directive 3</code> 。
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">File_C</code>包含<code class="codeph">Directive 4</code>和<code class="codeph">Directive 5</code> 。
                        </p>
                     </li>
                  </ul>
                  <div class="section">
                     <p class="subhead2" id="GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D__GUID-A3AA5893-BA94-4988-A039-0974E69601CD">使用或不使用指令启动应用程序</p>
                     <div class="p">您可以启动<code class="codeph">TestProgram</code>不指定指令文件。
                        <ul style="list-style-type:disc">
                           <li>
                              <div class="p">开始<code class="codeph">TestProgram</code>在不添加任何指令的情况下，在命令行中输入以下命令：<pre class="pre codeblock"><code>java TestProgram</code></pre></div>
                           </li>
                           <li>
                              <p><code class="codeph">TestProgram</code>开始时未指定任何指令文件。
                              </p>
                           </li>
                           <li>
                              <p>默认指令始终是指令堆栈中最底部的指令。<a href="commands-work-directive-files.html#GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D__GUID-25591A0A-0883-47B2-8BAC-6AF6B7DF3C0C">图2-1</a>显示默认指令为<code class="codeph">Directive 0</code> 。当您不指定指令文件时，默认指令也是最顶层的指令，它具有优先级。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="figure" id="GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D__GUID-25591A0A-0883-47B2-8BAC-6AF6B7DF3C0C">
                        <p class="titleinfigure">图2-1在没有指令的情况下启动程序</p><img src="img/jsjvm_dt_005_default.png" alt="如下图2-1所示" title="如下图2-1所示" longdesc="img_text/jsjvm_dt_005_default.html"><br><a href="img_text/jsjvm_dt_005_default.html">“图2-1在没有指令的情况下启动程序”的说明</a></div>
                     <!-- class="figure" -->
                     <div class="p">您可以启动应用程序并指定指令。
                        <ul style="list-style-type:disc">
                           <li>
                              <div class="p">开始<code class="codeph">TestProgram</code>应用程序并从中添加指令<code class="codeph">File_A.json</code>在指令堆栈中，在命令行中输入以下命令：<pre class="pre codeblock"><code>java -XX:+UnlockDiagnosticVMOptions -XX:CompilerDirectivesFile=File_A.json TestProgram</code></pre></div>
                           </li>
                           <li>
                              <p><code class="codeph">TestProgram</code>启动和中的指令<code class="codeph">File_A</code>被添加到堆栈中。指令文件中的最高指令成为指令堆栈中的最高指令。
                              </p>
                           </li>
                           <li>
                              <p><a href="commands-work-directive-files.html#GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D__GUID-2BCA3FD8-D759-432F-87ED-D4DD3729F087">图2-2</a>显示了指令在堆栈中从上到下的顺序为[1、2、0]。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="figure" id="GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D__GUID-2BCA3FD8-D759-432F-87ED-D4DD3729F087">
                        <p class="titleinfigure">图2-2使用指令启动程序</p><img src="img/jsjvm_dt_001_stacka.png" alt="如下图2-2所示" title="如下图2-2所示" longdesc="img_text/jsjvm_dt_001_stacka.html"><br><a href="img_text/jsjvm_dt_001_stacka.html">“图2-2使用指令启动程序”的说明</a></div>
                     <!-- class="figure" -->
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D__GUID-FE0C295C-696C-4B75-B691-2182CEF8A51B">向正在运行的应用程序添加指令</p>
                     <div class="p">您可以通过诊断命令将指令添加到正在运行的应用程序。
                        <ul style="list-style-type:disc">
                           <li>
                              <div class="p">要添加来自的所有指令<code class="codeph">File_B</code>到指令堆栈，输入以下命令：<pre class="pre codeblock"><code>jcmd 11084 Compiler.directives_add File_B.json</code></pre></div>
                              <p>中的指令<code class="codeph">File_B</code>被添加到堆栈的顶部。
                              </p>
                           </li>
                           <li>
                              <p><a href="commands-work-directive-files.html#GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D__GUID-4C6536FE-940A-415F-8CF7-F30E7FB1DB1D">图2-3</a>显示指令在堆栈中的顺序变为[3，1，2，0]。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="figure" id="GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D__GUID-4C6536FE-940A-415F-8CF7-F30E7FB1DB1D">
                        <p class="titleinfigure">图2-3向正在运行的程序中添加指令</p><img src="img/jsjvm_dt_002_stackb.png" alt="如下图2-3所示" title="如下图2-3所示" longdesc="img_text/jsjvm_dt_002_stackb.html"><br><a href="img_text/jsjvm_dt_002_stackb.html">“图2-3向正在运行的程序中添加指令”的说明</a></div>
                     <!-- class="figure" -->
                     <div class="p">您可以通过诊断命令将指令文件添加到<code class="codeph">TestProgram</code>在运行时：<ul style="list-style-type:disc">
                           <li>
                              <div class="p">要添加来自的所有指令<code class="codeph">File_C</code>到指令堆栈，输入以下命令。<pre class="pre codeblock"><code>jcmd 11084 Compiler.directives_add File_C.json</code></pre></div>
                           </li>
                           <li>
                              <p><a href="commands-work-directive-files.html#GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D__GUID-214F325E-560B-439B-87D9-CEF7FCEC484B">图2-4</a>显示指令在堆栈中的顺序为[4，5，3，1，2，0]。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="figure" id="GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D__GUID-214F325E-560B-439B-87D9-CEF7FCEC484B">
                        <p class="titleinfigure">图2-4将多个指令添加到正在运行的程序</p><img src="img/jsjvm_dt_003_stackc.png" alt="如下图2-4所示" title="如下图2-4所示" longdesc="img_text/jsjvm_dt_003_stackc.html"><br><a href="img_text/jsjvm_dt_003_stackc.html">“图2-4向正在运行的程序中添加多个指令”的说明</a></div>
                     <!-- class="figure" -->
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2" id="GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D__GUID-915216C4-D7CD-4009-887B-41B645B9A24F">从指令堆栈中删除指令</p>
                     <div class="p">您可以通过诊断命令从指令堆栈中删除最顶层的指令。
                        <ul style="list-style-type:disc">
                           <li>
                              <div class="p">去除<code class="codeph">Directive 4</code>从堆栈中，输入以下命令：<pre class="pre codeblock"><code><kbd class="userinput">jcmd 11084 Compiler.directives_remove</kbd></code></pre></div>
                           </li>
                           <li>
                              <p>要删除更多内容，请重复此诊断命令，直到仅保留默认伪指令为止。您无法删除默认指令。</p>
                           </li>
                           <li>
                              <p><a href="commands-work-directive-files.html#GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D__GUID-71E5F16A-326E-46F0-8D87-43482E996466">图2-5</a>显示指令在堆栈中的顺序变为[5，3，1，2，0]。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="figure" id="GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D__GUID-71E5F16A-326E-46F0-8D87-43482E996466">
                        <p class="titleinfigure">图2-5从堆栈中删除一个指令</p><img src="img/jsjvm_dt_006_remove.png" alt="如下图2-5所示" title="如下图2-5所示" longdesc="img_text/jsjvm_dt_006_remove.html"><br><a href="img_text/jsjvm_dt_006_remove.html">“图2-5从堆栈中删除一个指令”的说明</a></div>
                     <!-- class="figure" -->
                     <div class="p">您可以从指令堆栈中删除多个指令。
                        <ul style="list-style-type:disc">
                           <li>
                              <div class="p">要清除指令堆栈，请输入以下命令：<pre class="pre codeblock"><code><kbd class="userinput">jcmd 11084 Compiler.directives_clear</kbd></code></pre></div>
                           </li>
                           <li>
                              <p>除默认指令外，所有指令均被删除。您无法删除默认指令。</p>
                           </li>
                           <li>
                              <p><a href="commands-work-directive-files.html#GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D__GUID-2430733A-6FD5-4BE1-A04C-B569D796325D">图2-6</a>显示只有<code class="codeph">Directive 0</code>保留在堆栈中。
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="figure" id="GUID-0BE73FEB-C133-4907-869A-42F9E4646E9D__GUID-2430733A-6FD5-4BE1-A04C-B569D796325D">
                        <p class="titleinfigure">图2-6从堆栈中删除所有指令</p><img src="img/jsjvm_dt_004_clear.png" alt="如下图2-6所示" title="如下图2-6所示" longdesc="img_text/jsjvm_dt_004_clear.html"><br><a href="img_text/jsjvm_dt_004_clear.html">“图2-6从堆栈中删除所有指令”的说明</a></div>
                     <!-- class="figure" -->
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   

</body></html>