<html lang="en-US"  xmlns="http://www.w3.org/1999/xhtml"><head></head><body  onload="load()">﻿
        <title>传输和接收MIDI消息（Java™教程>声音）</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
     <meta name="description" content="">
     <meta name="keywords" content="java programming, learn java, java sample code, ">
        
<style type="text/css">
    body {
        margin-left:10px;
        margin-right:10px;
        line-height: 1.5;
        FONT-FAMILY: Arial, Helvetica, sans-serif; 
        font-size: 0.8em;
    }
    
    a:link{text-decoration:none; color:#09569d;}
    a:visited{text-decoration:none; color: #3a87cf;}
    a:hover{text-decoration:underline; }
        
    code{
        font-family:Monaco,Courier,"Courier New";
    }
    
    .header-container {
        background-color: #fff;
        border-bottom: 1px solid #C1CFDA;
        -webkit-box-shadow: 0 2px 2px rgba(117, 163, 231, 0.1);
        box-shadow: 0 2px 2px rgba(117, 163, 231, 0.1);
    }
    
    .bookwrapper {
        width: auto;
        margin: auto;
    }
    
    .clearfix {
    }
    
    .clearfloat {
        clear: both;
        overflow: auto;
        height: 0px;
        font-size: 1px;
        line-height: 0px;
    }
    
    #brandProdName {
        width: auto;
        height: auto;
    }
    
    #logocover {
        display: block;
        background: transparent url(../images/oracle-java-logo.png) 0px 0px no-repeat;
        height: 50px;
        width: 229px;
        float: left;
    }
    
    #productName {
        font-size: 16px;
        position: relative;
        top: 19px;
        padding-left: 3px;
        color: #457798;
        white-space: nowrap;
        width: 340px;
    }


    .FigureCaption   { 
        font-family: sans-serif; 
        text-align: center;
    }
    
    #TopBar_bl {        
        width: 100%;
        height: 60px;
    }
    #TopBar_br {
        width: 100%;
        height: 60px;
    }
    #TopBar_tl {
        margin-left: -110px;
        margin-right: -100px;       
		align: left;
        height: 60px;
    }
    #TopBar_tr {
        width: 100%;
        height: 60px;
    }
    
    #TopBar {
        min-width:700px;
        padding:25px 100px 10px;
        margin-bottom:25px;
        clear:both;
        
        border-bottom:1px solid #d2dde5;
        border-radius: 3px;
    
        background:#efefef; /* Old browsers */
        /* IE9 SVG, needs conditional override of 'filter' to 'none' */
        background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlMmVmZjkiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);
        background: -moz-linear-gradient(top,  #ffffff 0%, #e2eff9 100%); /* FF3.6+ */
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#ffffff), color-stop(100%,#e2eff9)); /* Chrome,Safari4+ */
        background: -webkit-linear-gradient(top,  #ffffff 0%,#e2eff9 100%); /* Chrome10+,Safari5.1+ */
        background: -o-linear-gradient(top,  #ffffff 0%,#e2eff9 100%); /* Opera 11.10+ */
        background: -ms-linear-gradient(top,  #ffffff 0%,#e2eff9 100%); /* IE10+ */
        background: linear-gradient(to bottom,  #ffffff 0%,#e2eff9 100%); /* W3C */
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='#e2eff9',GradientType=0 ); /* IE6-8 */
        
    }
    
    #TopBar_left {
        line-height: 14px;
        position: absolute;
        padding-top: 30px;
        padding-right: 30px;
        padding-left: 30px;
        text-align: left;
        font: 13px/20px Arial, Helvetica, sans-serif;
        font-weight: bold;
        font-size: 20px;
        color: #333;
    }
    
    #TopBar_right {
        line-height: 12px;
        float: right;
        padding-top: 10px;
        padding-right: 30px;
        text-align: left;
    }
    

    @media print {
        #BreadCrumbs, #Download {
            display: none;
        }
    }
    
     
    @media print {
        #TopBar_right {
            display: none;
        }
    }
    #TopBar_right a {
        font-size: 10px;
        margin: 3px;
        padding: 0;
    }
 
    #BreadCrumbs {
        padding: 15px 5px 0.5em 0;
        font-family: sans-serif; 
        float: right;
    }
    
    #BreadCrumbs a {
        color:#09569d;
    }
    
    #BreadCrumbs a:visited, #BreadCrumbs a:link {
        text-decoration: none;
    }
    
    #BreadCrumbs a:hover, #BreadCrumbs a:active {
        text-decoration: underline;
    }
    
    #PageTitle {
        margin: 0 5px 0.5em 0;
        color: #F90000;
    }
    
    #PageContent{
        margin: 0 5px 0 20px;
    }
    
    .LeftBar_shown {
        width: 13em;
        float: left;
    }
    
    @media print {
        .LeftBar_shown {
            display: none;
        }
    }
    
    .LeftBar_hidden {
        display: none;
    }
    
    #Footer {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;       
    }
    
    .footertext {
        font-size: 10px;
        font-family: sans-serif; 
        margin-top: 1px;
    }

    .NavBit  {
        padding: 15px 5px 0.5em 0;
        font-family: sans-serif; 
    }
    
    @media print {
        .NavBit {
            display: none;
        }
    }
    
    #TagNotes {
        text-align: right;        
    }
    
    @media print {
        #TagNotes a:visited, #TagNotes a:link {
            color: #35556B;
            text-decoration: none;
        }
    }
    
    #Contents a, .NavBit a, #TagNotes a {
        color:#09569d;
    }
    
    #TagNotes a:visited, #TagNotes a:link,
    #Contents a:visited, #Contents a:link,
    .NavBit a:visited, .NavBit a:link {
        text-decoration: none;
    }
    
    #TagNotes a:hover, #TagNotes a:active,   
    #Contents a:hover, #Contents a:active,   
    .NavBit a:hover, .NavBit a:active {  
        text-decoration: underline;
    }
    
    #Contents {
        float: left;
        font-family: sans-serif; 
    }
    @media print {
        #Contents {
            display: none;
        }
    }
    @media screen {
        div.PrintHeaders {
            display: none;
        }
    }
    .linkLESSON, .nolinkLESSON {
        margin-left: 0.5em;
        text-indent: -0.5em;
    }
    .linkAHEAD, .nolinkAHEAD, .linkQUESTIONS, .nolinkQUESTIONS   {
        margin-left: 1.5em; 
        text-indent: -0.5em
    }
    .linkBHEAD, .nolinkBHEAD   {
        margin-left: 2.5em;
        text-indent: -0.5em
    }
    .linkCHEAD, .nolinkCHEAD   {
        margin-left: 3.5em;
        text-indent: -0.5em
    }
    .nolinkLESSON, .nolinkAHEAD, .nolinkBHEAD, .nolinkCHEAD,
    .nolinkQUESTIONS {
        font-weight: bold;
        color: #333;
		
		
    }
    .MainFlow_indented {
        margin-right: 10px;
        margin-left: 15em;
        margin-bottom: 2em;

    }
    .MainFlow_wide {
	
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 2em;

    }
    @media print {
        .MainFlow_indented, .MainFlow_wide {
            padding-top: 0;
            margin-top: 10px;
            margin-right: 10px;
            margin-left: 0;
        }
    }
    h1, h2, h3, h4, h5 {
        color: #333;
        
    }

    h1 {
        font-weight: bold;
        font-size: 20px;
    }

    h2 {
        font-weight: bold;
        font-size: 17px;
    }

    h3 {
        font-weight: bold;
        font-size: 14px;
    }

    h4 {
        font-size: 15px;
    }

    h5 {
        font-size: 12px;
    }


    #ToggleLeft {
        display: none;
    }
    
    .note {
        margin: 0 30px 0px 30px;
    }
    
    .codeblock {
        margin: 0 30px 0px 30px;
		font-size:12px;
		font-family:Monaco,Courier,"Courier New";
    }
    
    .tocli {
        list-style-type:none;
    }

    .betadraft {
        color: red;
    }

</style>
<script type="text/javascript">
/* <![CDATA[ */
    function leftBar() {
        var nameq = 'tutorial_showLeftBar='
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookieString = cookies[i];
            while (cookieString.charAt(0) == ' ') {
                cookieString = cookieString.substring(1, cookieString.length);
            }
            if (cookieString.indexOf(nameq) == 0) {
                cookieValue =  cookieString.substring(nameq.length,
                        cookieString.length);
                return cookieValue == 'yes';
            }
        }
        return true;
    }

    function showLeft(b) {
        var contents = document.getElementById("LeftBar");
        var main = document.getElementById("MainFlow");
        var toggle = document.getElementById("ToggleLeft");
        if (b) {
            contents.className = "LeftBar_shown";
            main.className = "MainFlow_indented";
            toggle.innerHTML = "Hide TOC";
            document.cookie = 'tutorial_showLeftBar=yes; path=/';
        } else {
            contents.className = "LeftBar_hidden";
            main.className = "MainFlow_wide";
            toggle.innerHTML = "Show the TOC";
            document.cookie = 'tutorial_showLeftBar=no; path=/';
        }
    }

    function toggleLeft() {
        showLeft(document.getElementById("LeftBar").className ==
                "LeftBar_hidden");
        document.getElementById("ToggleLeft").blur();
    }

    function load() {
        showLeft(leftBar());
        document.getElementById("ToggleLeft").style.display="inline";
    }

    function showCode(displayCodePage, codePath) {
        var codePathEls = codePath.split("/");
        var currDocPathEls = location.href.split("/");
        //alert ("codePathEls = " + codePathEls + "\n" + "currDocPathEls = " + currDocPathEls);
        currDocPathEls.pop(); // remove file name at the end
        while (codePathEls.length > 0) {
            if (codePathEls[0] == "..") {
                codePathEls.shift();
                currDocPathEls.pop();
            } else {
                break;
            }
        }
        var fullCodePath = currDocPathEls.join("/") + "/" + codePathEls.join("/");
        //alert ("fullCodePath = " + fullCodePath );
        if (codePath.indexOf(".java") != -1 || codePath.indexOf(".jnlp") != -1) {
            window.location.href = displayCodePage + "?code=" + encodeURI(fullCodePath);
        } else {
            window.location.href = fullCodePath;
        }
    }
/* ]]> */    
</script>


    
                    <script>var w=window;if(w.performance||w.mozPerformance||w.msPerformance||w.webkitPerformance){var d=document;AKSB=w.AKSB||{},AKSB.q=AKSB.q||[],AKSB.mark=AKSB.mark||function(e,_){AKSB.q.push(["mark",e,_||(new Date).getTime()])},AKSB.measure=AKSB.measure||function(e,_,t){AKSB.q.push(["measure",e,_,t||(new Date).getTime()])},AKSB.done=AKSB.done||function(e){AKSB.q.push(["done",e])},AKSB.mark("firstbyte",(new Date).getTime()),AKSB.prof={custid:"322179",ustr:"",originlat:"0",clientrtt:"1",ghostip:"23.212.3.15",ipv6:false,pct:"10",clientip:"45.78.37.67",requestid:"2a67848c",region:"32996",protocol:"",blver:14,akM:"dsca",akN:"ae",akTT:"O",akTX:"1",akTI:"2a67848c",ai:"206465",ra:"false",pmgn:"",pmgi:"",pmp:"",qc:""},function(e){var _=d.createElement("script");_.async="async",_.src=e;var t=d.getElementsByTagName("script"),t=t[t.length-1];t.parentNode.insertBefore(_,t)}(("https:"===d.location.protocol?"https:":"http:")+"//ds-aksb-a.akamaihd.net/aksb.min.js")}</script>
                    <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script>

    <noscript>要使此页面正常运行，需要启用JavaScript的浏览器。
    </noscript>
        <!-- header -->
    <div class="header-container">
        <div class="bookwrapper  clearfix">       
            <div id="brandProdName">
                <div id="logocover"></div>
                <div id="productName">文献资料</div>
            </div> 
            <br class="clearfloat">
        </div>
    </div>
    
    <div id="TopBar">
        <div id="TopBar_tr">
            <div id="TopBar_tl">
                <div id="TopBar_br"> <div id="TopBar_bl"> 
                    <div id="TopBar_left">Java™教程</div>
                        <div id="TopBar_right"> 
                            <!--
                            <a href="URL" target="_blank">External Link</a><br/>
                            --> <a href="javascript:void(0);" id="ToggleLeft">隐藏目录</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="LeftBar" class="LeftBar_shown">
        <div id="Contents">
            <div class="linkAHEAD"><a href="sampled-overview.html">采样包概述</a></div>
<div class="linkAHEAD"><a href="accessing.html">访问音频系统资源</a></div>
<div class="linkAHEAD"><a href="playing.html">播放音频</a></div>
<div class="linkAHEAD"><a href="capturing.html">捕捉音频</a></div>
<div class="linkAHEAD"><a href="controls.html">使用控件处理音频</a></div>
<div class="linkAHEAD"><a href="converters.html">使用文件和格式转换器</a></div>
<div class="linkAHEAD"><a href="overview-MIDI.html">MIDI包概述</a></div>
<div class="linkAHEAD"><a href="accessing-MIDI.html">访问MIDI系统资源</a></div>
<div class="nolinkAHEAD">传输和接收MIDI信息</div>
<div class="linkAHEAD"><a href="MIDI-seq-intro.html">音序器简介</a></div>
<div class="linkAHEAD"><a href="MIDI-seq-methods.html">使用定序器方法</a></div>
<div class="linkAHEAD"><a href="MIDI-seq-adv.html">使用高级音序器功能</a></div>
<div class="linkAHEAD"><a href="MIDI-synth.html">合成声音</a></div>
<div class="linkAHEAD"><a href="SPI-intro.html">服务提供商接口简介</a></div>
<div class="linkAHEAD"><a href="SPI-providing-sampled.html">提供音频采样服务</a></div>
<div class="linkAHEAD"><a href="SPI-providing-MIDI.html">提供MIDI服务</a></div>
</div>
    </div>
    <div id="MainFlow" class="MainFlow_indented">
    <div class="PrintHeaders">
        <b>踪迹：</b>声音</div>
            <div id="BreadCrumbs">
                <a href="../index.html" target="_top">主页</a> > <a href="./index.html" target="_top">声音</a>
            </div>
            <div class="NavBit">
                <a href="accessing-MIDI.html" target="_top">«上一个</a> • <a href="./TOC.html" target="_top">追踪</a> • <a href="MIDI-seq-intro.html" target="_top">下一个»</a>
            </div>
            <div class="Banner"><p style="background-color:rgb(247,248,249);border-width:1px;padding:10px;font-style:italic;border-style:solid;border-color:rgb(64,74,91)">Java教程是为JDK 8编写的。此页面中描述的示例和实践没有利用更高版本中引入的改进。</p></div>
            <div id="PageTitle"><h1>传输和接收MIDI信息</h1></div>
            <div id="PageContent">

<p><a name="120461"></a></p>
<h2>了解设备，发送器和接收器</h2>
<p>一旦了解了MIDI数据的工作原理，Java Sound API就为MIDI数据指定了一种消息路由体系结构，该结构灵活且易于使用。该系统基于模块连接设计：每个模块都可以执行特定任务的不同模块可以互连（联网），从而使数据从一个模块流向另一个模块。</p>
<p><a name="121778"></a> Java Sound API消息传递系统中的基本模块是<a class="APILink" href="https://docs.oracle.com/javase/8/docs/api/javax/sound/midi/MidiDevice.html" target="_blank"><code>MidiDevice</code></a>接口。 <code>MidiDevices</code>包括音序器（记录，播放，加载和编辑带时间戳的MIDI消息的序列），合成器（由MIDI消息触发时产生声音）以及MIDI输入和输出端口，数据通过该端口输入和输出到外部MIDI设备。MIDI端口通常需要的功能由基本功能描述<code>MidiDevice</code>接口。的<a class="APILink" href="https://docs.oracle.com/javase/8/docs/api/javax/sound/midi/Sequencer.html" target="_blank"><code>Sequencer</code></a>和<a class="APILink" href="https://docs.oracle.com/javase/8/docs/api/javax/sound/midi/Synthesizer.html" target="_blank"><code>Synthesizer</code></a>接口扩展了<code>MidiDevice</code>接口，分别描述MIDI音序器和合成器的附加功能特性。充当定序器或合成器的具体类应实现这些接口。</p>
<p><a name="121816"></a>一种<code>MidiDevice</code>通常拥有一个或多个实现对象的辅助对象<code>Receiver</code>要么<code>Transmitter</code>接口。这些接口代表将设备连接在一起的“插头”或“端口”，从而允许数据流入和流出设备。通过连接一个<code>Transmitter</code>一<code>MidiDevice</code>到<code>Receiver</code>另外，您可以创建一个模块网络，其中数据从一个模块流向另一个模块。</p>
<p><a name="121833"></a>的<code>MidiDevice</code>接口包括用于确定设备可以同时支持多少个发送器和接收器对象的方法，以及用于访问这些对象的其他方法。MIDI输出端口通常至少有一个<code>Receiver</code>通过它可以接收传出消息；类似地，合成器通常会响应发送给它的消息<code>Receiver</code>要么<code>Receivers</code> 。MIDI输入端口通常至少有一个<code>Transmitter</code> ，它传播传入的消息。功能齐全的音序器同时支持<code>Receivers</code> ，它会在录制过程中接收消息，以及<code>Transmitters</code> ，在播放过程中发送消息。</p>
<p><a name="120470"></a>的<code>Transmitter</code>界面包括用于设置和查询发送器向其发送信息的接收器的方法<code>MidiMessages</code> 。设置接收器可建立两者之间的连接。的<code>Receiver</code>接口包含发送<code>MidiMessage</code>给接收者。通常，此方法由<code>Transmitter</code> 。这俩<code>Transmitter</code>和<code>Receiver</code>界面包括<code>close</code>释放先前连接的发送器或接收器，使其可用于其他连接的方法。</p>
<p><a name="120474"></a>现在，我们将研究如何使用发送器和接收器。在介绍连接两个设备的典型情况（例如将音序器连接到合成器）之前，我们将研究一个更简单的情况，即您直接从应用程序向设备发送MIDI消息。研究这个简单的场景应该使您更容易理解Java Sound API如何安排在两个设备之间发送MIDI消息。</p>
<p><a name="sending" id="sending"></a></p>
<h2>在不使用发送器的情况下将消息发送到接收器</h2>
<p><a name="121187"></a>假设您要从头创建MIDI消息，然后将其发送到某些接收器。您可以创建一个新的空白<code>ShortMessage</code>然后使用以下命令将其填充为MIDI数据<code>ShortMessage</code>方法：</p>
<div class="codeblock"><pre>
void setMessage(int command, int channel, int data1,
         int data2) 
</pre></div>
<p>准备好要发送的消息后，您可以将其发送到<code>Receiver</code>对象，使用此<code>Receiver</code>方法：</p>
<div class="codeblock"><pre>
void send(MidiMessage message, long timeStamp)
</pre></div>
<p>时间戳参数将被暂时解释。现在，我们只提到如果您不希望指定精确的时间，则可以将其值设置为-1。在这种情况下，接收消息的设备将尝试尽快响应消息。</p>
<p><a name="121753"></a>应用程序可以获取<code>MidiDevice</code>通过调用设备的<code>getReceiver</code>方法。如果设备无法为程序提供接收器（通常是因为所有设备的接收器都已在使用中），则<code>MidiUnavailableException</code>被抛出。否则，从该方法返回的接收器可供程序立即使用。程序使用完接收方后，应调用接收方的<code>close</code>方法。如果程序在调用后尝试在接收方上调用方法<code>close</code> ， <code>IllegalStateException</code>可能会抛出。</p>
<p><a name="121858"></a>作为不使用发送器发送消息的具体简单示例，让我们将Note On消息发送到默认接收器，该接收器通常与MIDI输出端口或合成器等设备相关联。为此，我们创建了一个合适的<code>ShortMessage</code>并将其作为参数传递给<code>Receiver's</code><code>send</code>方法：</p>
<div class="codeblock"><pre>
  ShortMessage myMsg = new ShortMessage();
  // Start playing the note Middle C (60), 
  // moderately loud (velocity = 93).
  myMsg.setMessage(ShortMessage.NOTE_ON, 0, 60, 93);
  long timeStamp = -1;
  Receiver       rcvr = MidiSystem.getReceiver();
  rcvr.send(myMsg, timeStamp);
</pre></div>
<p>此代码使用一个静态整数字段<code>ShortMessage</code> ，即<code>NOTE_ON</code> ，用作MIDI消息的状态字节。MIDI信息的其他部分被赋予显式数值，作为<code>setMessage</code>方法。零表示该音符将使用MIDI通道编号1播放； 60表示音符中间C； 93是一个任意的低调力度值，通常表示最终演奏该音符的合成器应将其大声播放。（MIDI规范保留了速度的精确解释，直到合成器执行其当前乐器为止。）然后，此MIDI消息将以-1的时间戳发送到接收器。现在，我们需要准确检查时间戳参数的含义，这是下一部分的主题。<a name="understanding_time" id="understanding_time"></a></p>
<h2>了解时间戳</h2>
<p><a name="120509"></a>如您所知，MIDI规范具有不同的部分。一部分描述MIDI“有线”协议（设备之间实时发送的消息），另一部分描述标准MIDI文件（作为事件存储在“序列”中的消息）。在规范的后半部分，标准MIDI文件中存储的每个事件都用指示该事件应在何时播放的定时值进行标记。相比之下，设备总是在接收到MIDI有线协议中的消息后立即对其进行处理，因此它们没有随附的计时值。</p>
<p><a name="120511"></a> Java Sound API带来了额外的变化。毫无疑问，计时值出现在<code>MidiEvent</code>与标准MIDI文件规范中一样，按顺序存储的对象（可能是从MIDI文件读取的）。但是在Java Sound API中，甚至设备之间发送的消息（换句话说，就是与MIDI有线协议相对应的消息）也可以被赋予计时值，称为<em>时间戳</em> 。这些时间戳关系到我们。</p>
<h3>发送给设备的消息上的时间戳</h3>
<p><a name="120519"></a> Java Sound API中的设备之间发送的消息可以有选择地附带的时间戳与标准MIDI文件中的定时值完全不同。MIDI文件中的定时值通常基于拍子和拍子之类的音乐概念，每个事件的定时都测量自上一个事件以来经过的时间。相反，发送到设备的邮件上的时间戳<code>Receiver</code>对象始终以毫秒为单位测量绝对时间。具体来说，它测量自拥有接收器的设备打开以来经过的微秒数。</p>
<p><a name="120521"></a>这种时间戳旨在帮助补偿操作系统或应用程序引入的延迟。重要的是要意识到，这些时间戳是用于对时间进行较小的调整，而不是实现可以在完全任意的时间安排事件的复杂队列（例如<code>MidiEvent</code>计时值）。</p>
<p><a name="122050"></a>发送给设备的消息上的时间戳（通过<code>Receiver</code> ）可以为设备提供精确的时序信息。设备在处理消息时可能会使用此信息。例如，它可以将事件的时间调整几毫秒以匹配时间戳中的信息。另一方面，并非所有设备都支持时间戳，因此设备可能会完全忽略消息的时间戳。</p>
<p><a name="122051"></a>即使设备支持时间戳，它也可能不会在您请求的时间确切地安排事件。您不能指望发送时间戳很远的消息，而让设备按预期的方式处理消息，当然也不能指望设备正确地调度时间戳过去的消息！由设备决定如何处理将来或过去太远的时间戳。发件人不知道设备认为相距太远，或者设备时间戳是否有问题。这种无知模仿了外部MIDI硬件设备的行为，这些设备在不知道是否正确接收消息的情况下发送消息。（MIDI线协议是单向的。）</p>
<p><a name="120527"></a>某些设备会发送带时间戳的消息（通过<code>Transmitter</code> ）。例如，由MIDI输入端口发送的消息可能带有传入消息到达端口的时间标记。在某些系统上，事件处理机制会使消息的后续处理过程中失去一定量的计时精度。消息的时间戳可以保留原始的计时信息。</p>
<p><a name="122114"></a>要了解设备是否支持时间戳，请调用以下方法： <code>MidiDevice</code> ：</p>
<div class="codeblock"><pre>
    long getMicrosecondPosition()
</pre></div>
<p>如果设备忽略时间戳，则此方法返回-1。否则，它将返回设备的当前时间概念，在确定后续发送消息的时间戳时，您作为发送方可以将其用作偏移量。例如，如果您想在将来发送带有时间戳的消息五毫秒，则可以获取设备的当前位置（以微秒为单位），增加5000微秒，并将其用作时间戳。请记住， <code>MidiDevice's</code>时间概念总是在打开设备时将时间设置为零。</p>
<p><a name="120533"></a>现在，以对时间戳的所有解释为背景，让我们回到<code>send</code>的方法<code>Receiver</code> ：</p>
<div class="codeblock"><pre>
void send(MidiMessage message, long timeStamp)
</pre></div>
<p>的<code>timeStamp</code>参数根据接收设备的时间概念以微秒表示。如果设备不支持时间戳，则它只会忽略<code>timeStamp</code>论点。您无需为发送给接收者的邮件加上时间戳。您可以将-1用作<code>timeStamp</code>表示您不关心调整确切时间的参数；您只是将其留给接收设备来尽快处理邮件。但是，建议不要将某些消息发送给-1，而将其他消息发送给相同的接收者，同时使用明确的时间戳。这样做可能会导致最终时序不规则。<a name="122132"></a></p>
<h2>将发射器连接到接收器</h2>
<p><a name="120542"></a>我们已经了解了如何不使用发送器就能直接将MIDI消息发送到接收器。现在，让我们看一下更常见的情况，您不是从头开始创建MIDI消息，而只是将设备连接在一起，以便其中一个可以将MIDI消息发送到另一个。</p>
<p><a name="120544"></a></p>
<h3>连接到单个设备</h3>
<p><a name="120546"></a>我们将作为第一个示例的特定情况是将定序器连接到合成器。建立此连接后，启动定序器运行将使合成器根据定序器当前序列中的事件生成音频。现在，我们将忽略将序列从MIDI文件加载到音序器的过程。另外，我们将不涉及播放序列的机制。加载和播放序列在“ <a class="TutorialLink" href="MIDI-seq-intro.html" target="_top">播放，录制和编辑MIDI序列”</a>中有详细讨论。在“ <a class="TutorialLink" href="MIDI-synth.html" target="_top">合成声音”中</a>讨论了将乐器加载到合成器中的过程。现在，我们感兴趣的只是如何在定序器和合成器之间建立连接。这将说明将一个设备的发送器连接到另一设备的接收器的更一般的过程。</p>
<p><a name="121529"></a>为简单起见，我们将使用默认的音序器和默认的合成器。</p>
<div class="codeblock"><pre>
    Sequencer           seq;
    Transmitter         seqTrans;
    Synthesizer         synth;
    Receiver         synthRcvr;
    try {
          seq     = MidiSystem.getSequencer();
          seqTrans = seq.getTransmitter();
          synth   = MidiSystem.getSynthesizer();
          synthRcvr = synth.getReceiver(); 
          seqTrans.setReceiver(synthRcvr);      
    } catch (MidiUnavailableException e) {
          // handle or throw exception
    }
</pre></div>
<p>一个实现实际上可能只有一个对象，同时充当默认序列发生器和默认合成器。换句话说，该实现可能会使用同时实现<code>Sequencer</code>界面和<code>Synthesizer</code>接口。在这种情况下，可能没有必要像我们在上面的代码中那样进行显式连接。但是，出于可移植性考虑，不采用这种配置更为安全。当然，如果需要，您可以测试这种情况：</p>
<div class="codeblock"><pre>
if (seq instanceof Synthesizer)
</pre></div>
<p><a name="122187"></a>尽管上面的显式连接在任何情况下都应该起作用。</p>
<p><a name="120569"></a></p>
<h3>连接到多个设备</h3>
<p><a name="121563"></a>前面的代码示例说明了发送器和接收器之间的一对一连接。但是，如果您需要向多个接收器发送相同的MIDI消息怎么办？例如，假设您要从外部设备捕获MIDI数据以驱动内部合成器，同时将数据记录到序列中。这种连接形式（有时称为“扇出”或“分离器”）很简单。以下语句说明如何创建扇出连接，通过该连接将到达MIDI输入端口的MIDI消息发送到两个<code>Synthesizer</code>对象和一个<code>Sequencer</code>宾语。我们假设您已经获得并打开了三个设备：输入端口，音序器和合成器。（要获取输入端口，您需要遍历<code>MidiSystem.getMidiDeviceInfo</code> ）</p>
<div class="codeblock"><pre>
    Synthesizer  synth;
    Sequencer    seq;
    MidiDevice   inputPort;
    // [obtain and open the three devices...]
    Transmitter   inPortTrans1, inPortTrans2;
    Receiver            synthRcvr;
    Receiver            seqRcvr;
    try {
          inPortTrans1 = inputPort.getTransmitter();
          synthRcvr = synth.getReceiver(); 
          inPortTrans1.setReceiver(synthRcvr);
          inPortTrans2 = inputPort.getTransmitter();
          seqRcvr = seq.getReceiver(); 
          inPortTrans2.setReceiver(seqRcvr);
    } catch (MidiUnavailableException e) {
          // handle or throw exception
    }
</pre></div>
<p>此代码引入了对<code>MidiDevice.getTransmitter</code>方法，将结果分配给<code>inPortTrans1</code>和<code>inPortTrans2</code> 。如前所述，一个设备可以拥有多个发送器和接收器。每一次<code>MidiDevice.getTransmitter()</code>如果为给定设备调用，则返回另一个发送器，直到没有可用的发送器为止，这时将引发异常。</p>
<p><a name="122228"></a>要了解设备支持多少个发射器和接收器，可以使用以下命令<code>MidiDevice</code>方法：</p>
<div class="codeblock"><pre>
    int getMaxTransmitters()
    int <code>getMaxReceivers</code>()
</pre></div>
<p>这些方法返回设备拥有的总数，而不是当前可用的总数。</p>
<p><a name="120602"></a>一台发送器一次只能将MIDI信息发送到一个接收器。（每次您打电话<code>Transmitter's setReceiver</code>方法，现有<code>Receiver</code> （如果有）被新指定的替换。您可以通过调用来确定发送方当前是否有接收方<code>Transmitter.getReceiver</code> ）但是，如果一台设备有多个发送器，则可以通过将每个发送器连接到不同的接收器来一次将数据发送到一个以上的设备，就像我们在上面的输入端口中看到的那样。</p>
<p><a name="122286"></a>同样，一台设备可以使用其多个接收器来一次从一个以上的设备进行接收。所需的多接收器代码很简单，直接类似于上面的多发送器代码。单个接收器也可能一次从多个发送器接收消息。</p>
<p><a name="120605"></a></p>
<h3>关闭连接</h3>
<p><a name="120607"></a>连接完成后，您可以通过调用连接来释放其资源<code>close</code>获得的每个发射器和接收器的方法。的<code>Transmitter</code>和<code>Receiver</code>每个接口都有一个<code>close</code>方法。请注意，调用<code>Transmitter.setReceiver</code>不会关闭发送器的当前接收器。接收器处于打开状态，它仍然可以从与其连接的任何其他发送器接收消息。</p>
<p><a name="122314"></a>如果您还完成了这些设备的操作，则可以通过调用类似的方法将其提供给其他应用程序使用<code>MidiDevice.close()</code> 。关闭设备会自动关闭其所有发送器和接收器。</p>


        </div>
        <div class="NavBit">
            <a href="accessing-MIDI.html" target="_top">«上一个</a> • <a href="./TOC.html" target="_top">追踪</a> • <a href="MIDI-seq-intro.html" target="_top">下一个»</a>
        </div>
    </div>
    
<hr class="clearfloat">

<div id="Footer">

<p class="footertext">
<a href="http://www.oracle.com/corporate/index.html">关于Oracle</a> | <a href="http://www.oracle.com/us/corporate/contact/index.html">联系我们</a> | <a href="http://www.oracle.com/us/legal/index.html">法律声明</a> | <a href="http://www.oracle.com/us/legal/terms/index.html">使用条款</a> | <a href="http://www.oracle.com/us/legal/privacy/index.html">您的隐私权</a></p>

<p class="footertext"><a href="http://www.oracle.com/pls/topic/lookup?ctx=cpyr&id=en-US">版权所有©1995、2017 Oracle和/或其分支机构。版权所有。</a></p>
       
</div>    
    <div class="PrintHeaders">
        <b>上一页：</b>访问MIDI系统资源<br><b>下一页：</b>音序器简介</div>
<!-- Start SiteCatalyst code -->
<script type="application/javascript" src="https://www.oracleimg.com/us/assets/metrics/ora_docs.js"></script>
<!-- End SiteCatalyst code --> 

 
</body></html>