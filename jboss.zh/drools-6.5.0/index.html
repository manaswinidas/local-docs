<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Drools Documentation</title><link rel="stylesheet" type="text/css" href="css/jbossorg.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><div class="book" title="Drools Documentation"><div class="titlepage"><div><p id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><div><h1 class="title"><a id="d0e1"/>Drools Documentation</h1></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="orgname"><a class="link" href="http://www.drools.org/community/team.html">The JBoss Drools team</a></span></h3></div></div></div><div><p class="releaseinfo">Version 6.5.0.Final</p></div></div><hr/></div><div class="toc"><dl><dt><span class="preface"><a href="#d0e19"/></span></dt><dt><span class="part"><a href="#d0e23">I. Welcome</a></span></dt><dd><dl><dt><span class="chapter"><a href="#Welcome">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e32">1.1. Introduction</a></span></dt><dt><span class="section"><a href="#gettingstarted">1.2. Getting Involved</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e56">1.2.1. Sign up to jboss.org</a></span></dt><dt><span class="section"><a href="#d0e67">1.2.2. Sign the Contributor Agreement</a></span></dt><dt><span class="section"><a href="#d0e78">1.2.3. Submitting issues via JIRA</a></span></dt><dt><span class="section"><a href="#d0e98">1.2.4. Fork GitHub</a></span></dt><dt><span class="section"><a href="#d0e109">1.2.5. Writing Tests</a></span></dt><dt><span class="section"><a href="#d0e122">1.2.6. Commit with Correct Conventions</a></span></dt><dt><span class="section"><a href="#d0e132">1.2.7. Submit Pull Requests</a></span></dt></dl></dd><dt><span class="section"><a href="#installationAndSetup">1.3. Installation and Setup (Core and IDE)</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e147">1.3.1. Installing and using</a></span></dt><dt><span class="section"><a href="#d0e322">1.3.2. Building from source</a></span></dt><dt><span class="section"><a href="#d0e368">1.3.3. Eclipse</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#DroolsReleaseNotesChapter">2. Release Notes</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.ReleaseNotesDrools.6.5.0">2.1. What is New and Noteworthy in Drools 6.5.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e443">2.1.1. Configurable ThreadFactory</a></span></dt><dt><span class="section"><a href="#d0e456">2.1.2. Use of any expressions as input for a query</a></span></dt><dt><span class="section"><a href="#d0e467">2.1.3. Update with modified properties</a></span></dt><dt><span class="section"><a href="#d0e476">2.1.4. Monitoring framework improvements</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ReleaseNotesWorkbench.6.5.0.Final">2.2. New and Noteworthy in KIE Workbench 6.5.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e567">2.2.1. Guided Rule Editor : Support formulae in composite field constraints</a></span></dt><dt><span class="section"><a href="#d0e588">2.2.2. Authoring - Project Editor - Reimport button</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.ReleaseNotesDrools.6.4.0">2.3. What is New and Noteworthy in Drools 6.4.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e596">2.3.1. Better Java 8 compatibility</a></span></dt><dt><span class="section"><a href="#d0e601">2.3.2. More robust incremental compilation</a></span></dt><dt><span class="section"><a href="#d0e606">2.3.3. Improved multi-threading behaviour</a></span></dt><dt><span class="section"><a href="#d0e615">2.3.4. OOPath improvements</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ReleaseNotesWorkbench.6.4.0.Final">2.4. New and Noteworthy in KIE Workbench 6.4.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e663">2.4.1. New look and feel</a></span></dt><dt><span class="section"><a href="#d0e678">2.4.2. Various UI improvements</a></span></dt><dt><span class="section"><a href="#d0e704">2.4.3. New locales</a></span></dt><dt><span class="section"><a href="#d0e762">2.4.4. Authoring - Imports - Consistent terminology</a></span></dt><dt><span class="section"><a href="#d0e801">2.4.5. Disable automatic build</a></span></dt><dt><span class="section"><a href="#d0e815">2.4.6. Support for <code class="literal">SCP</code> style <code class="literal">git</code> Repository URLs</a></span></dt><dt><span class="section"><a href="#d0e838">2.4.7. Authoring - Duplicate GAV detection</a></span></dt><dt><span class="section"><a href="#d0e945">2.4.8. New Execution Server Management User Interface</a></span></dt><dt><span class="section"><a href="#d0e957">2.4.9.  User and group management</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.ReleaseNotesDrools.6.3.0">2.5. What is New and Noteworthy in Drools 6.3.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e973">2.5.1. Browsing graphs of objects with OOPath</a></span></dt><dt><span class="section"><a href="#shared.ReleaseNotes.KieNavigator">2.5.2. Kie Navigator View for Eclipse</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ReleaseNotesWorkbench.6.3.0.Final">2.6. New and Noteworthy in KIE Workbench 6.3.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1105">2.6.1. Real Time Validation and Verification for the Decision Tables</a></span></dt><dt><span class="section"><a href="#d0e1121">2.6.2. Improved DRL Editor</a></span></dt><dt><span class="section"><a href="#d0e1133">2.6.3. Asset locking</a></span></dt><dt><span class="section"><a href="#d0e1152">2.6.4. Data Modeller Tool Windows</a></span></dt><dt><span class="section"><a href="#d0e1178">2.6.5. Generation of JPA enabled Data Models</a></span></dt><dt><span class="section"><a href="#d0e1221">2.6.6. Data Set Authoring</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.ReleaseNotesDrools.6.2.0">2.7. What is New and Noteworthy in Drools 6.2.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1236">2.7.1. Propagation modes</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ReleaseNotesWorkbench.6.2.0.Final">2.8. New and Noteworthy in KIE Workbench 6.2.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1291">2.8.1. Download Repository or Part of the Repository as a ZIP</a></span></dt><dt><span class="section"><a href="#d0e1310">2.8.2. Project Editor permissions</a></span></dt><dt><span class="section"><a href="#d0e1354">2.8.3. Unify validation style in Guided Decision Table Wizard.</a></span></dt><dt><span class="section"><a href="#d0e1370">2.8.4. Improved Wizards</a></span></dt><dt><span class="section"><a href="#d0e1384">2.8.5. Consistent behaviour of XLS, Guided Decision Tables and Guided Templates</a></span></dt><dt><span class="section"><a href="#d0e1407">2.8.6. Improved Metadata Tab</a></span></dt><dt><span class="section"><a href="#d0e1461">2.8.7. Improved Data Objects Editor</a></span></dt><dt><span class="section"><a href="#d0e1496">2.8.8. Execution Server Management UI</a></span></dt><dt><span class="section"><a href="#d0e1517">2.8.9. Social Activities</a></span></dt><dt><span class="section"><a href="#d0e1567">2.8.10. Contributors Dashboard</a></span></dt><dt><span class="section"><a href="#d0e1587">2.8.11. Package selector</a></span></dt><dt><span class="section"><a href="#d0e1603">2.8.12. Improved visual consistency</a></span></dt><dt><span class="section"><a href="#d0e1624">2.8.13. Guided Decision Tree Editor</a></span></dt><dt><span class="section"><a href="#d0e1638">2.8.14. Create Repository Wizard</a></span></dt><dt><span class="section"><a href="#d0e1657">2.8.15. Repository Structure Screen</a></span></dt></dl></dd><dt><span class="section"><a href="#kie.ReleaseNotesIntegration.6.2.0">2.9. New and Noteworthy in Integration 6.2.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1679">2.9.1. KIE Execution Server</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.ReleaseNotesDrools.6.1.0">2.10. What is New and Noteworthy in Drools 6.1.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1694">2.10.1. JMX support for KieScanner</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ReleaseNotesWorkbench.6.1.0">2.11. New and Noteworthy in KIE Workbench 6.1.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1755">2.11.1. Data Modeler - round trip and source code preservation</a></span></dt><dt><span class="section"><a href="#d0e1760">2.11.2. Data Modeler - improved annotations</a></span></dt><dt><span class="section"><a href="#d0e1765">2.11.3. Standardization of the display of tabular data</a></span></dt><dt><span class="section"><a href="#d0e1824">2.11.4. Generation of <code class="code">modify(x) {...}</code> blocks</a></span></dt></dl></dd><dt><span class="section"><a href="#kie.ReleaseNotesKIE.6.0.0">2.12. New and Noteworthy in KIE API 6.0.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1848">2.12.1. New KIE name</a></span></dt><dt><span class="section"><a href="#d0e1859">2.12.2. Maven aligned projects and modules and Maven Deployment</a></span></dt><dt><span class="section"><a href="#d0e1866">2.12.3. Configuration and convention based projects</a></span></dt><dt><span class="section"><a href="#d0e1881">2.12.4. KieBase Inclusion</a></span></dt><dt><span class="section"><a href="#d0e1901">2.12.5. KieModules, KieContainer and KIE-CI</a></span></dt><dt><span class="section"><a href="#d0e1920">2.12.6. KieScanner</a></span></dt><dt><span class="section"><a href="#d0e1970">2.12.7. Hierarchical ClassLoader</a></span></dt><dt><span class="section"><a href="#d0e1975">2.12.8. Legacy API Adapter</a></span></dt><dt><span class="section"><a href="#d0e1980">2.12.9. KIE Documentation</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.ReleaseNotesDrools.6.0.0">2.13. What is New and Noteworthy in Drools 6.0.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1988">2.13.1. PHREAK - Lazy rule matching algorithm</a></span></dt><dt><span class="section"><a href="#d0e1997">2.13.2. Automatically firing timed rule in passive mode</a></span></dt><dt><span class="section"><a href="#d0e2023">2.13.3. Expression Timers</a></span></dt><dt><span class="section"><a href="#d0e2058">2.13.4. RuleFlowGroups and AgendaGroups are merged</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ReleaseNotesWorkbench.6.0.0">2.14. New and Noteworthy in KIE Workbench 6.0.0</a></span></dt><dt><span class="section"><a href="#kie.ReleaseNotesIntegration.6.0.0">2.15. New and Noteworthy in Integration 6.0.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2161">2.15.1. CDI</a></span></dt><dt><span class="section"><a href="#d0e2176">2.15.2. Spring</a></span></dt><dt><span class="section"><a href="#d0e2181">2.15.3. Aries Blueprints</a></span></dt><dt><span class="section"><a href="#d0e2186">2.15.4. OSGi Ready</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#compatibilityMatrix">3. Compatibility matrix</a></span></dt></dl></dd><dt><span class="part"><a href="#d0e2196">II. KIE</a></span></dt><dd><dl><dt><span class="chapter"><a href="#KIEChapter">4. KIE</a></span></dt><dd><dl><dt><span class="section"><a href="#KIEOverviewSection">4.1. Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#KIEAnatomySection">4.1.1. Anatomy of Projects</a></span></dt><dt><span class="section"><a href="#KIELifeCyclesSection">4.1.2. Lifecycles</a></span></dt></dl></dd><dt><span class="section"><a href="#BuildDeployUtilizeAndRunSection">4.2. Build, Deploy, Utilize and Run</a></span></dt><dd><dl><dt><span class="section"><a href="#KIEModuleIntroductionBuildingIntroductionSection">4.2.1. Introduction</a></span></dt><dt><span class="section"><a href="#KIEBuildingSection">4.2.2. Building</a></span></dt><dt><span class="section"><a href="#KIEDeployingSection">4.2.3. Deploying</a></span></dt><dt><span class="section"><a href="#KIERunningSection">4.2.4. Running</a></span></dt><dt><span class="section"><a href="#KIEDeployCheatSheets">4.2.5. Installation and Deployment Cheat Sheets</a></span></dt><dt><span class="section"><a href="#KIEExamplesSection">4.2.6. Build,  Deploy and Utilize Examples</a></span></dt></dl></dd><dt><span class="section"><a href="#KIESecuritySection">4.3. Security</a></span></dt><dd><dl><dt><span class="section"><a href="#SecurityManager">4.3.1. Security Manager</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="part"><a href="#d0e4235">III. Drools Runtime and Language</a></span></dt><dd><dl><dt><span class="chapter"><a href="#HybridReasoningChapter">5. Hybrid Reasoning</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4244">5.1. Artificial Intelligence</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4247">5.1.1. A Little History</a></span></dt><dt><span class="section"><a href="#d0e4333">5.1.2. Knowledge Representation and Reasoning</a></span></dt><dt><span class="section"><a href="#d0e4344">5.1.3. Rule Engines and Production Rule Systems (PRS)</a></span></dt><dt><span class="section"><a href="#d0e4429">5.1.4. Hybrid Reasoning Systems (HRS)</a></span></dt><dt><span class="section"><a href="#d0e4462">5.1.5. Expert Systems</a></span></dt><dt><span class="section"><a href="#d0e4486">5.1.6. Recommended Reading</a></span></dt></dl></dd><dt><span class="section"><a href="#ReteOO">5.2. Rete Algorithm</a></span></dt><dt><span class="section"><a href="#ReteOOSection">5.3. ReteOO Algorithm</a></span></dt><dt><span class="section"><a href="#PHREAK">5.4. PHREAK Algorithm</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e4870">6. User Guide</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4873">6.1. The Basics</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4876">6.1.1. Stateless Knowledge Session</a></span></dt><dt><span class="section"><a href="#d0e5038">6.1.2. Stateful Knowledge Session</a></span></dt><dt><span class="section"><a href="#d0e5213">6.1.3. Methods versus Rules</a></span></dt><dt><span class="section"><a href="#d0e5245">6.1.4. Cross Products</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5270">6.2. Execution Control</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5273">6.2.1. Agenda</a></span></dt><dt><span class="section"><a href="#d0e5306">6.2.2. Rule Matches and Conflict Sets.</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5518">6.3. Inference</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5521">6.3.1. Bus Pass Example</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5589">6.4. Truth Maintenance with  Logical Objects</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5596">6.4.1. Overview</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5713">6.5. Decision Tables in Spreadsheets</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5725">6.5.1. When to Use Decision Tables</a></span></dt><dt><span class="section"><a href="#d0e5743">6.5.2. Overview</a></span></dt><dt><span class="section"><a href="#d0e5785">6.5.3. How Decision Tables Work</a></span></dt><dt><span class="section"><a href="#d0e5871">6.5.4. Spreadsheet Syntax</a></span></dt><dt><span class="section"><a href="#d0e6396">6.5.5. Creating and integrating Spreadsheet based Decision Tables</a></span></dt><dt><span class="section"><a href="#d0e6417">6.5.6. Managing Business Rules in Decision Tables</a></span></dt><dt><span class="section"><a href="#d0e6464">6.5.7. Rule Templates</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e6567">6.6. Logging</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e6607">7. Running</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6612">7.1. KieRuntime</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6615">7.1.1. EntryPoint</a></span></dt><dt><span class="section"><a href="#d0e6790">7.1.2. RuleRuntime</a></span></dt><dt><span class="section"><a href="#d0e6849">7.1.3. StatefulRuleSession</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e6889">7.2. Agenda</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6926">7.2.1. Conflict Resolution</a></span></dt><dt><span class="section"><a href="#d0e6942">7.2.2. AgendaGroup</a></span></dt><dt><span class="section"><a href="#d0e6974">7.2.3. ActivationGroup</a></span></dt><dt><span class="section"><a href="#d0e6990">7.2.4. RuleFlowGroup</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e7006">7.3. Event Model</a></span></dt><dt><span class="section"><a href="#d0e7084">7.4. StatelessKieSession</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7214">7.4.1. Sequential Mode</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e7279">7.5. Rule Execution Modes</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7286">7.5.1. Passive Mode</a></span></dt><dt><span class="section"><a href="#d0e7301">7.5.2. Active Mode</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e7377">7.6. Propagation modes</a></span></dt><dt><span class="section"><a href="#d0e7429">7.7. Commands and the CommandExecutor</a></span></dt></dl></dd><dt><span class="chapter"><a href="#DroolsLanguageReferenceChapter">8. Rule Language Reference</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7602">8.1. Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7610">8.1.1. A rule file</a></span></dt><dt><span class="section"><a href="#d0e7643">8.1.2. What makes a rule</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e7679">8.2. Keywords</a></span></dt><dt><span class="section"><a href="#d0e7874">8.3. Comments</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7879">8.3.1. Single line comment</a></span></dt><dt><span class="section"><a href="#d0e7889">8.3.2. Multi-line comment</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e7902">8.4. Error Messages</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7907">8.4.1. Message format</a></span></dt><dt><span class="section"><a href="#d0e7938">8.4.2. Error Messages Description</a></span></dt><dt><span class="section"><a href="#d0e8093">8.4.3. Other Messages</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e8098">8.5. Package</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8121">8.5.1. import</a></span></dt><dt><span class="section"><a href="#d0e8135">8.5.2. global</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e8178">8.6. Function</a></span></dt><dt><span class="section"><a href="#d0e8212">8.7. Type Declaration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8240">8.7.1. Declaring New Types</a></span></dt><dt><span class="section"><a href="#d0e8397">8.7.2. Declaring Metadata</a></span></dt><dt><span class="section"><a href="#d0e8758">8.7.3. Declaring Metadata for Existing Types</a></span></dt><dt><span class="section"><a href="#d0e8801">8.7.4. Parametrized constructors for declared types</a></span></dt><dt><span class="section"><a href="#d0e8825">8.7.5. Non Typesafe Classes</a></span></dt><dt><span class="section"><a href="#d0e8830">8.7.6. Accessing Declared Types from the Application Code</a></span></dt><dt><span class="section"><a href="#d0e8879">8.7.7. Type Declaration 'extends'</a></span></dt><dt><span class="section"><a href="#d0e8911">8.7.8. Traits</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e9154">8.8. Rule</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e9196">8.8.1. Rule Attributes</a></span></dt><dt><span class="section"><a href="#d0e9356">8.8.2. Timers and Calendars</a></span></dt><dt><span class="section"><a href="#d0e9456">8.8.3. Left Hand Side (when) syntax</a></span></dt><dt><span class="section"><a href="#d0e11687">8.8.4. The Right Hand Side (then)</a></span></dt><dt><span class="section"><a href="#d0e11934">8.8.5. Conditional named consequences</a></span></dt><dt><span class="section"><a href="#d0e11959">8.8.6. A Note on Auto-boxing and Primitive Types</a></span></dt></dl></dd><dt><span class="section"><a href="#QuerySection">8.9. Query</a></span></dt><dt><span class="section"><a href="#d0e12041">8.10. Domain Specific Languages</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12051">8.10.1. When to Use a DSL</a></span></dt><dt><span class="section"><a href="#d0e12058">8.10.2. DSL Basics</a></span></dt><dt><span class="section"><a href="#d0e12127">8.10.3. Adding Constraints to Facts</a></span></dt><dt><span class="section"><a href="#d0e12171">8.10.4. Developing a DSL</a></span></dt><dt><span class="section"><a href="#d0e12184">8.10.5. DSL and DSLR Reference</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#DroolsComplexEventProcessingChapter">9. Complex Event Processing</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12392">9.1. Complex Event Processing</a></span></dt><dt><span class="section"><a href="#d0e12443">9.2. Drools Fusion</a></span></dt><dt><span class="section"><a href="#d0e12545">9.3. Event Semantics</a></span></dt><dt><span class="section"><a href="#d0e12597">9.4. Event Processing Modes</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12604">9.4.1. Cloud Mode</a></span></dt><dt><span class="section"><a href="#d0e12635">9.4.2. Stream Mode</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e12715">9.5. Session Clock</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12746">9.5.1. Available Clock Implementations</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e12773">9.6. Sliding Windows</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12786">9.6.1. Sliding Time Windows</a></span></dt><dt><span class="section"><a href="#d0e12809">9.6.2. Sliding Length Windows</a></span></dt><dt><span class="section"><a href="#d0e12845">9.6.3. Window Declaration</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e12866">9.7. Streams Support</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12888">9.7.1. Declaring and Using Entry Points</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e12922">9.8. Memory Management for Events</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12940">9.8.1. Explicit expiration offset</a></span></dt><dt><span class="section"><a href="#d0e12958">9.8.2. Inferred expiration offset</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e12978">9.9. Temporal Reasoning</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e13050">9.9.1. Temporal Operators</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ExperimentalFeaturesChapter">10. Experimental Features</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e13520">10.1. Declarative Agenda</a></span></dt><dt><span class="section"><a href="#d0e13581">10.2. Browsing graphs of objects with OOPath</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e13688">10.2.1. Reactive and Non-Reactive OOPath</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="part"><a href="#d0e13738">IV. Drools Integration</a></span></dt><dd><dl><dt><span class="chapter"><a href="#ch.commands">11. Drools Commands</a></span></dt><dd><dl><dt><span class="section"><a href="#CommandsAPISection">11.1. API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e13764">11.1.1. XStream</a></span></dt><dt><span class="section"><a href="#d0e13780">11.1.2. JSON</a></span></dt><dt><span class="section"><a href="#d0e13796">11.1.3. JAXB</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e13824">11.2. Commands supported</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e13904">11.2.1. BatchExecutionCommand</a></span></dt><dt><span class="section"><a href="#d0e13972">11.2.2. InsertObjectCommand</a></span></dt><dt><span class="section"><a href="#d0e14054">11.2.3. RetractCommand</a></span></dt><dt><span class="section"><a href="#d0e14121">11.2.4. ModifyCommand</a></span></dt><dt><span class="section"><a href="#d0e14188">11.2.5. GetObjectCommand</a></span></dt><dt><span class="section"><a href="#d0e14256">11.2.6. InsertElementsCommand</a></span></dt><dt><span class="section"><a href="#d0e14334">11.2.7. FireAllRulesCommand</a></span></dt><dt><span class="section"><a href="#d0e14409">11.2.8. StartProcessCommand</a></span></dt><dt><span class="section"><a href="#d0e14479">11.2.9. SignalEventCommand</a></span></dt><dt><span class="section"><a href="#d0e14548">11.2.10. CompleteWorkItemCommand</a></span></dt><dt><span class="section"><a href="#d0e14615">11.2.11. AbortWorkItemCommand</a></span></dt><dt><span class="section"><a href="#d0e14676">11.2.12. QueryCommand</a></span></dt><dt><span class="section"><a href="#d0e14748">11.2.13. SetGlobalCommand</a></span></dt><dt><span class="section"><a href="#d0e14826">11.2.14. GetGlobalCommand</a></span></dt><dt><span class="section"><a href="#d0e14894">11.2.15. GetObjectsCommand</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#CDIChapter">12. CDI</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e14965">12.1. Introduction</a></span></dt><dt><span class="section"><a href="#d0e14972">12.2. Annotations</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e14977">12.2.1. @KReleaseId</a></span></dt><dt><span class="section"><a href="#d0e14982">12.2.2. @KContainer</a></span></dt><dt><span class="section"><a href="#d0e15002">12.2.3. @KBase</a></span></dt><dt><span class="section"><a href="#d0e15029">12.2.4. @KSession for KieSession</a></span></dt><dt><span class="section"><a href="#d0e15056">12.2.5. @KSession for StatelessKieSession</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e15083">12.3. API Example Comparison</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ch.kie.spring">13. Integration with Spring</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e15103">13.1. Important Changes for Drools 6.0</a></span></dt><dt><span class="section"><a href="#d0e15157">13.2. Integration with Drools Expert</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e15165">13.2.1. KieModule</a></span></dt><dt><span class="section"><a href="#d0e15212">13.2.2. KieBase</a></span></dt><dt><span class="section"><a href="#d0e15312">13.2.3. IMPORTANT NOTE</a></span></dt><dt><span class="section"><a href="#d0e15337">13.2.4. KieSessions</a></span></dt><dt><span class="section"><a href="#d0e15425">13.2.5. Kie:ReleaseId</a></span></dt><dt><span class="section"><a href="#d0e15482">13.2.6. Kie:Import</a></span></dt><dt><span class="section"><a href="#d0e15565">13.2.7. Annotations</a></span></dt><dt><span class="section"><a href="#d0e15688">13.2.8. Event Listeners</a></span></dt><dt><span class="section"><a href="#d0e15844">13.2.9. Loggers</a></span></dt><dt><span class="section"><a href="#d0e15933">13.2.10. Defining Batch Commands</a></span></dt><dt><span class="section"><a href="#d0e16013">13.2.11. Persistence</a></span></dt><dt><span class="section"><a href="#d0e16043">13.2.12. Leveraging Other Spring Features</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e16083">13.3. Integration with jBPM Human Task</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16088">13.3.1. How to configure Spring with jBPM Human task</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ch.kie.android">14. Android Integration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16206">14.1. Integration with Drools Expert</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16214">14.1.1. Pre-serialized Rules</a></span></dt><dt><span class="section"><a href="#d0e16242">14.1.2. KieContainer API with drools-compiler dependency</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e16257">14.2. Integration with Roboguice</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16260">14.2.1. Pre-serialized Rules with Roboguice</a></span></dt><dt><span class="section"><a href="#d0e16290">14.2.2. KieContainer with drools-compiler dependency and Roboguice</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ch.camel">15. Apache Camel Integration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16370">15.1. Camel</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ch.server">16. Drools Camel Server</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16423">16.1. Introduction</a></span></dt><dt><span class="section"><a href="#d0e16428">16.2. Deployment</a></span></dt><dt><span class="section"><a href="#d0e16433">16.3. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16473">16.3.1. REST/Camel Services configuration</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#RHQChapter">17. JMX monitoring with RHQ/JON</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16550">17.1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16555">17.1.1. Enabling JMX monitoring in a Drools application</a></span></dt><dt><span class="section"><a href="#d0e16574">17.1.2. Installing and running the RHQ/JON plugin</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="part"><a href="#d0e16616">V. Drools Workbench</a></span></dt><dd><dl><dt><span class="chapter"><a href="#wb.Workbench">18. Workbench (General)</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.Installation">18.1. Installation</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.warInstallation">18.1.1. War installation</a></span></dt><dt><span class="section"><a href="#wb.workbenchData">18.1.2. Workbench data</a></span></dt><dt><span class="section"><a href="#wb.systemProperties">18.1.3. System properties</a></span></dt><dt><span class="section"><a href="#wb.troubleShooting">18.1.4. Trouble shooting</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.QuickStart">18.2. Quick Start</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.QuickStartAddRepository">18.2.1. Add repository</a></span></dt><dt><span class="section"><a href="#wb.QuickStartAddProject">18.2.2. Add project</a></span></dt><dt><span class="section"><a href="#wb.QuickStartDefineDataModel">18.2.3. Define Data Model</a></span></dt><dt><span class="section"><a href="#wb.QuickStartDefineRule">18.2.4. Define Rule</a></span></dt><dt><span class="section"><a href="#wb.QuickStartBuildAndDeloy">18.2.5. Build and Deploy</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.Administration">18.3. Administration</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.administrationOverview">18.3.1. Administration overview</a></span></dt><dt><span class="section"><a href="#wb.OrganizationalUnit">18.3.2. Organizational unit</a></span></dt><dt><span class="section"><a href="#wb.VFSRepository">18.3.3. Repositories</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.Configuration">18.4. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.UserManagement">18.4.1. Basic user management</a></span></dt><dt><span class="section"><a href="#wb.Roles">18.4.2. Roles</a></span></dt><dt><span class="section"><a href="#wb.RestrictedAccess">18.4.3. Restricting access to repositories </a></span></dt><dt><span class="section"><a href="#wb.CommandLineConfig">18.4.4. Command line config tool</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.Introduction">18.5. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.LogInAndLogOut">18.5.1. Log in and log out</a></span></dt><dt><span class="section"><a href="#wb.HomeScreen">18.5.2. Home screen</a></span></dt><dt><span class="section"><a href="#wb.WorkbenchConcepts">18.5.3. Workbench concepts</a></span></dt><dt><span class="section"><a href="#wb.InitialLayout">18.5.4. Initial layout</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ChangingLayout">18.6. Changing the layout</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.Resizing">18.6.1. Resizing</a></span></dt><dt><span class="section"><a href="#wb.Repositioning">18.6.2. Repositioning</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.Authoring">18.7. Authoring (General)</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.ArtifactRepository">18.7.1. Artifact Repository</a></span></dt><dt><span class="section"><a href="#wb.AssetEditor">18.7.2. Asset Editor</a></span></dt><dt><span class="section"><a href="#wb.TagsEditor">18.7.3. Tags Editor</a></span></dt><dt><span class="section"><a href="#wb.ProjectExplorer">18.7.4. Project Explorer</a></span></dt><dt><span class="section"><a href="#wb.ProjectEditor">18.7.5. Project Editor</a></span></dt><dt><span class="section"><a href="#wb.Validation">18.7.6. Validation</a></span></dt><dt><span class="section"><a href="#wb.DataModeller">18.7.7. Data Modeller</a></span></dt><dt><span class="section"><a href="#wb.DataSets">18.7.8. Data Sets</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.UserAndGroupMgmt">18.8. User and group management</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e19602">18.8.1. Introduction</a></span></dt><dt><span class="section"><a href="#d0e19623">18.8.2. Security management providers</a></span></dt><dt><span class="section"><a href="#d0e19730">18.8.3. Installation and setup</a></span></dt><dt><span class="section"><a href="#d0e19860">18.8.4. Usage</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.Embedding">18.9. Embedding Workbench In Your Application</a></span></dt><dt><span class="section"><a href="#wb.AssetManagement">18.10. Asset Management</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.assetMgmtOverview">18.10.1. Asset Management Overview</a></span></dt><dt><span class="section"><a href="#wb.assetMgmtManagedVsUnmanaged">18.10.2. Managed vs Unmanaged Repositories</a></span></dt><dt><span class="section"><a href="#wb.assetMgmtProcesses">18.10.3. Asset Management Processes</a></span></dt><dt><span class="section"><a href="#wb.assetMgmtUsageFlow">18.10.4. Usage Flow</a></span></dt><dt><span class="section"><a href="#wb.assetMgmtRepositoryStructure">18.10.5. Repository Structure</a></span></dt><dt><span class="section"><a href="#wb.assetMgmtManagedRepositoryOperations">18.10.6. Managed Repositories Operations</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ExecServerUI">18.11. Execution Server Management UI</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.ExecServerUITemplate">18.11.1. Server Templates</a></span></dt><dt><span class="section"><a href="#wb.ExecServerUIContainer">18.11.2. Container</a></span></dt><dt><span class="section"><a href="#wb.ExecServerUIRemoteServer">18.11.3. Remote Server</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#drools.AuthoringAssets">19. Authoring Rule Assets</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.NewPackage">19.1. Creating a package</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e20580">19.1.1. Empty package</a></span></dt><dt><span class="section"><a href="#d0e20599">19.1.2. Copy, Rename and Delete Packages</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.GuidedRuleEditor">19.2. Business rules with the guided editor</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.GuidedRuleEditorParts">19.2.1. Parts of the Guided Rule Editor</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorLHS">19.2.2. The "WHEN" (left-hand side) of a Rule</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorRHS">19.2.3. The "THEN" (right-hand side) of a Rule</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorOptionalAttributes">19.2.4. Optional attributes</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorToolbar">19.2.5. Pattern/Action toolbar</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorEnumerations">19.2.6. User driven drop down lists</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorDSL">19.2.7. Augmenting with DSL sentences</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorComplexExample">19.2.8. A more complex example:</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.GuidedRuleTemplateEditor">19.3. Templates of assets/rules</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.GuidedRuleTemplateEditorCreating">19.3.1. Creating a rule template</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleTemplateEditorDefining">19.3.2. Define the template</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleTemplateEditorDefiningData">19.3.3. Defining the template data</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleTemplateEditorGeneratedDRL">19.3.4. Generated DRL</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.GuidedDecisionTableEditor">19.4. Guided decision tables (web based)</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.GuidedDecisionTableEditorTypesOfDecisionTable">19.4.1. Types of decision table</a></span></dt><dt><span class="section"><a href="#drools.GuidedDecisionTableEditorConcepts">19.4.2. Main components\concepts</a></span></dt><dt><span class="section"><a href="#drools.GuidedDecisionTableEditorDefining">19.4.3. Defining a web based decision table</a></span></dt><dt><span class="section"><a href="#drools.GuidedDecisionTableEditorRuleDefinitions">19.4.4. Rule definition</a></span></dt><dt><span class="section"><a href="#drools.GuidedDecisionTableEditorAuditLog">19.4.5. Audit Log</a></span></dt><dt><span class="section"><a href="#drools.GuidedDecisionTableEditorVerification">19.4.6. Real Time Validation and Verification</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.GuidedDecisionTreeEditor">19.5. Guided Decision Trees</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e21644">19.5.1. The initial editor layout</a></span></dt><dt><span class="section"><a href="#d0e21692">19.5.2. First steps</a></span></dt><dt><span class="section"><a href="#d0e21730">19.5.3. Editing Data Object nodes</a></span></dt><dt><span class="section"><a href="#d0e21743">19.5.4. Editing Field Constraint nodes</a></span></dt><dt><span class="section"><a href="#d0e21756">19.5.5. Editing Action nodes</a></span></dt><dt><span class="section"><a href="#d0e21789">19.5.6. Managing the tree</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.XLSDecisionTable">19.6. Spreadsheet decision tables</a></span></dt><dt><span class="section"><a href="#drools.GuidedScoreCardEditor">19.7. Scorecards</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.GuidedScoreCardEditorSetupParameters">19.7.1. (a) Setup Parameters</a></span></dt><dt><span class="section"><a href="#drools.GuidedScoreCardEditorCharacteristics">19.7.2. (b) Characteristics</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.TestScenarioEditor">19.8. Test Scenario</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.KSessionSelector">19.8.1. Knowledge Session Selector</a></span></dt><dt><span class="section"><a href="#drools.TestScenarioEditorGivenSection">19.8.2. Given Section</a></span></dt><dt><span class="section"><a href="#drools.TestScenarioEditorExpectedSection">19.8.3. Expect Section</a></span></dt><dt><span class="section"><a href="#drools.TestScenarioEditorGlobalSection">19.8.4. Global Section</a></span></dt><dt><span class="section"><a href="#drools.TestScenarioEditorInpuotSection">19.8.5. New Input Section</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.FunctionEditor">19.9. Functions</a></span></dt><dt><span class="section"><a href="#drools.DSLEditor">19.10. DSL editor</a></span></dt><dt><span class="section"><a href="#drools.EnumerationEditor">19.11. Data enumerations (drop down list configurations)</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.AdvancedEnumConcepts">19.11.1. Advanced enumeration concepts</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.DRLEditor">19.12. Technical rules (DRL)</a></span></dt></dl></dd><dt><span class="chapter"><a href="#wb.WorkbenchIntegration">20. Workbench Integration</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.WorkbenchRemoteAPI">20.1. REST</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e22427">20.1.1. Job calls</a></span></dt><dt><span class="section"><a href="#d0e22531">20.1.2. Repository calls</a></span></dt><dt><span class="section"><a href="#d0e22706">20.1.3. Organizational unit calls</a></span></dt><dt><span class="section"><a href="#d0e22837">20.1.4. Maven calls</a></span></dt><dt><span class="section"><a href="#d0e22953">20.1.5. REST summary</a></span></dt></dl></dd><dt><span class="section"><a href="#kie.KeycloakSSOIntegration">20.2. Keycloak SSO integration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e23153">20.2.1. Scenario</a></span></dt><dt><span class="section"><a href="#d0e23178">20.2.2. Install and setup a Keycloak server</a></span></dt><dt><span class="section"><a href="#d0e23222">20.2.3. Create and setup the demo realm</a></span></dt><dt><span class="section"><a href="#d0e23351">20.2.4. Install and setup jBPM Workbench</a></span></dt><dt><span class="section"><a href="#d0e23519">20.2.5. Securing workbench remote services via Keycloak</a></span></dt><dt><span class="section"><a href="#d0e23565">20.2.6. Securing workbench's file system services via Keycloak</a></span></dt><dt><span class="section"><a href="#d0e23668">20.2.7. Execution server</a></span></dt><dt><span class="section"><a href="#d0e23850">20.2.8. Consuming remote services</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#wb.WorkbenchHighAvailability">21. Workbench High Availability</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.HighAvailability">21.1. </a></span></dt><dd><dl><dt><span class="section"><a href="#wb.vfsClustering">21.1.1. VFS clustering</a></span></dt><dt><span class="section"><a href="#d0e24193">21.1.2. jBPM clustering</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="part"><a href="#d0e24201">VI. KIE Server</a></span></dt><dd><dl><dt><span class="chapter"><a href="#ch.kie.server">22. KIE Execution Server</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e24210">22.1. Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e24254">22.1.1. Glossary</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e24323">22.2. Installing the KIE Server</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e24374">22.2.1. Bootstrap switches</a></span></dt><dt><span class="section"><a href="#d0e24677">22.2.2. Installation details for different containers</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e24798">22.3. Kie Server setup</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e24807">22.3.1. Managed Kie Server </a></span></dt><dt><span class="section"><a href="#d0e24889">22.3.2. Unmanaged KIE Execution Server</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e24914">22.4. Creating a Kie Container</a></span></dt><dt><span class="section"><a href="#d0e24991">22.5. Managing Containers</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e24996">22.5.1. Starting a Container</a></span></dt><dt><span class="section"><a href="#d0e25005">22.5.2. Stopping and Deleting a Container</a></span></dt><dt><span class="section"><a href="#d0e25010">22.5.3. Updating a Container</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e25070">22.6. Kie Server REST API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e25090">22.6.1. [GET] /</a></span></dt><dt><span class="section"><a href="#d0e25100">22.6.2. [POST] /</a></span></dt><dt><span class="section"><a href="#d0e25140">22.6.3. [GET] /containers</a></span></dt><dt><span class="section"><a href="#d0e25171">22.6.4. ⁠[GET] /containers/{id}</a></span></dt><dt><span class="section"><a href="#d0e25184">22.6.5. [PUT] /containers/{id}</a></span></dt><dt><span class="section"><a href="#d0e25207">22.6.6. [DELETE] /containers/{id}</a></span></dt><dt><span class="section"><a href="#d0e25220">22.6.7. [POST] /containers/instances/{id}</a></span></dt><dt><span class="section"><a href="#d0e25288">22.6.8. [GET] /containers/{id}/release-id</a></span></dt><dt><span class="section"><a href="#d0e25298">22.6.9. [POST] /containers/{id}/release-id</a></span></dt><dt><span class="section"><a href="#d0e25315">22.6.10. [GET] /containers/{id}/scanner</a></span></dt><dt><span class="section"><a href="#d0e25325">22.6.11. [POST] /containers/{id}/scanner</a></span></dt><dt><span class="section"><a href="#d0e25350">22.6.12. Native REST client for Execution Server</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e25373">22.7. OptaPlanner REST API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e25410">22.7.1. [GET] /containers/{containerId}/solvers</a></span></dt><dt><span class="section"><a href="#d0e25425">22.7.2. [PUT] /containers/{containerId}/solvers/{solverId}</a></span></dt><dt><span class="section"><a href="#d0e25458">22.7.3. [GET] /containers/{containerId}/solvers/{solverId}</a></span></dt><dt><span class="section"><a href="#d0e25479">22.7.4. [POST] /containers/{containerId}/solvers/{solverId}</a></span></dt><dt><span class="section"><a href="#d0e25530">22.7.5. [GET] /containers/{containerId}/solvers/{solverId}/bestsolution</a></span></dt><dt><span class="section"><a href="#d0e25548">22.7.6. [DELETE] /containers/{containerId}/solvers/{solverId}</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e25569">22.8. Controller REST API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e25587">22.8.1. [GET] /management/servers</a></span></dt><dt><span class="section"><a href="#d0e25597">22.8.2. [GET] /management/server/{id}</a></span></dt><dt><span class="section"><a href="#d0e25607">22.8.3. [PUT] /management/server/{id}</a></span></dt><dt><span class="section"><a href="#d0e25617">22.8.4. [DELETE] /management/server/{id}</a></span></dt><dt><span class="section"><a href="#d0e25622">22.8.5. [GET] /management/server/{id}/containers</a></span></dt><dt><span class="section"><a href="#d0e25632">22.8.6. [GET] /management/server/{id}/containers/{containerId}</a></span></dt><dt><span class="section"><a href="#d0e25642">22.8.7. [PUT] /management/server/{id}/containers/{containerId}</a></span></dt><dt><span class="section"><a href="#d0e25652">22.8.8. [DELETE] /management/server/{id}/containers/{containerId}</a></span></dt><dt><span class="section"><a href="#d0e25657">22.8.9. [POST] /management/server/{id}/containers/{containerId}/status/started</a></span></dt><dt><span class="section"><a href="#d0e25662">22.8.10. [POST] /management/server/{id}/containers/{containerId}/status/stopped</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e25667">22.9. Kie Server Java Client API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e25672">22.9.1. Maven Configuration</a></span></dt><dt><span class="section"><a href="#d0e25690">22.9.2. Client Configuration</a></span></dt><dt><span class="section"><a href="#d0e25753">22.9.3. Server Response</a></span></dt><dt><span class="section"><a href="#d0e25777">22.9.4. Server Capabilities</a></span></dt><dt><span class="section"><a href="#d0e25798">22.9.5. Kie Containers</a></span></dt><dt><span class="section"><a href="#d0e25826">22.9.6. Managing Containers</a></span></dt><dt><span class="section"><a href="#d0e25837">22.9.7. Available Clients for the Decision Server</a></span></dt><dt><span class="section"><a href="#d0e25870">22.9.8. Sending commands to the server</a></span></dt><dt><span class="section"><a href="#d0e25897">22.9.9. Listing available business processes</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="part"><a href="#d0e25909">VII. Drools Examples</a></span></dt><dd><dl><dt><span class="chapter"><a href="#d0e25915">23. Examples</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e25918">23.1. Getting the Examples</a></span></dt><dt><span class="section"><a href="#d0e25925">23.2. Hello World</a></span></dt><dt><span class="section"><a href="#d0e26213">23.3. State Example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e26218">23.3.1. Understanding the State Example</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e26472">23.4. Fibonacci Example</a></span></dt><dt><span class="section"><a href="#d0e26678">23.5. Banking Tutorial</a></span></dt><dt><span class="section"><a href="#d0e27005">23.6. Pricing Rule Decision Table Example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e27029">23.6.1. Executing the example</a></span></dt><dt><span class="section"><a href="#d0e27071">23.6.2. The decision table</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e27136">23.7. Pet Store Example</a></span></dt><dt><span class="section"><a href="#d0e27716">23.8. Honest Politician Example</a></span></dt><dt><span class="section"><a href="#d0e27845">23.9. Sudoku Example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e27866">23.9.1. Sudoku Overview</a></span></dt><dt><span class="section"><a href="#d0e27880">23.9.2. Running the Example</a></span></dt><dt><span class="section"><a href="#d0e27953">23.9.3. Java Source and Rules Overview</a></span></dt><dt><span class="section"><a href="#d0e28083">23.9.4. Sudoku Validator Rules (validate.drl)</a></span></dt><dt><span class="section"><a href="#d0e28092">23.9.5. Sudoku Solving Rules (sudoku.drl)</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e28128">23.10. Number Guess</a></span></dt><dt><span class="section"><a href="#d0e28419">23.11. Conway's Game Of Life</a></span></dt><dt><span class="section"><a href="#d0e28568">23.12. Invaders</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e28601">23.12.1. Invaders1Main</a></span></dt><dt><span class="section"><a href="#d0e28613">23.12.2. Invaders2Main</a></span></dt><dt><span class="section"><a href="#d0e28623">23.12.3. Invaders3Main</a></span></dt><dt><span class="section"><a href="#d0e28633">23.12.4. Invaders4Main</a></span></dt><dt><span class="section"><a href="#d0e28643">23.12.5. Invaders5Main</a></span></dt><dt><span class="section"><a href="#d0e28648">23.12.6. Invaders6Main</a></span></dt><dt><span class="section"><a href="#d0e28653">23.12.7. Invaders4Main</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e28663">23.13. Adventures with Drools</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e28691">23.13.1. Using the game.</a></span></dt><dt><span class="section"><a href="#d0e28725">23.13.2. The code</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e28763">23.14. Pong</a></span></dt><dt><span class="section"><a href="#d0e28781">23.15. Wumpus World</a></span></dt><dt><span class="section"><a href="#d0e28828">23.16. Miss Manners and Benchmarking</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e28850">23.16.1. Introduction</a></span></dt><dt><span class="section"><a href="#d0e28936">23.16.2. In depth Discussion</a></span></dt><dt><span class="section"><a href="#d0e29146">23.16.3. Output Summary</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e29201">23.17. Backward-Chaining</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e29215">23.17.1. Backward-Chaining Systems</a></span></dt><dt><span class="section"><a href="#d0e29220">23.17.2. Cloning Transitive Closures</a></span></dt><dt><span class="section"><a href="#d0e29250">23.17.3. Defining a Query</a></span></dt><dt><span class="section"><a href="#d0e29275">23.17.4. Transitive Closure Example</a></span></dt><dt><span class="section"><a href="#d0e29347">23.17.5. Reactive Transitive Queries</a></span></dt><dt><span class="section"><a href="#d0e29372">23.17.6. Queries with Unbound Arguments</a></span></dt><dt><span class="section"><a href="#d0e29391">23.17.7. Multiple Unbound Arguments</a></span></dt></dl></dd></dl></dd></dl></dd></dl></div><div class="preface"><div class="titlepage"/><div class="mediaobject"><img src="images/droolsExpertLogo.png"/></div></div><div class="part" title="Part I. Welcome"><div class="titlepage"><div><div><h1 class="title"><a id="d0e23"/>Part I. Welcome</h1></div></div></div><div class="partintro" title="Welcome"><div/><p>Welcome and Release Notes</p><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="chapter"><a href="#Welcome">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e32">1.1. Introduction</a></span></dt><dt><span class="section"><a href="#gettingstarted">1.2. Getting Involved</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e56">1.2.1. Sign up to jboss.org</a></span></dt><dt><span class="section"><a href="#d0e67">1.2.2. Sign the Contributor Agreement</a></span></dt><dt><span class="section"><a href="#d0e78">1.2.3. Submitting issues via JIRA</a></span></dt><dt><span class="section"><a href="#d0e98">1.2.4. Fork GitHub</a></span></dt><dt><span class="section"><a href="#d0e109">1.2.5. Writing Tests</a></span></dt><dt><span class="section"><a href="#d0e122">1.2.6. Commit with Correct Conventions</a></span></dt><dt><span class="section"><a href="#d0e132">1.2.7. Submit Pull Requests</a></span></dt></dl></dd><dt><span class="section"><a href="#installationAndSetup">1.3. Installation and Setup (Core and IDE)</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e147">1.3.1. Installing and using</a></span></dt><dt><span class="section"><a href="#d0e322">1.3.2. Building from source</a></span></dt><dt><span class="section"><a href="#d0e368">1.3.3. Eclipse</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#DroolsReleaseNotesChapter">2. Release Notes</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.ReleaseNotesDrools.6.5.0">2.1. What is New and Noteworthy in Drools 6.5.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e443">2.1.1. Configurable ThreadFactory</a></span></dt><dt><span class="section"><a href="#d0e456">2.1.2. Use of any expressions as input for a query</a></span></dt><dt><span class="section"><a href="#d0e467">2.1.3. Update with modified properties</a></span></dt><dt><span class="section"><a href="#d0e476">2.1.4. Monitoring framework improvements</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ReleaseNotesWorkbench.6.5.0.Final">2.2. New and Noteworthy in KIE Workbench 6.5.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e567">2.2.1. Guided Rule Editor : Support formulae in composite field constraints</a></span></dt><dt><span class="section"><a href="#d0e588">2.2.2. Authoring - Project Editor - Reimport button</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.ReleaseNotesDrools.6.4.0">2.3. What is New and Noteworthy in Drools 6.4.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e596">2.3.1. Better Java 8 compatibility</a></span></dt><dt><span class="section"><a href="#d0e601">2.3.2. More robust incremental compilation</a></span></dt><dt><span class="section"><a href="#d0e606">2.3.3. Improved multi-threading behaviour</a></span></dt><dt><span class="section"><a href="#d0e615">2.3.4. OOPath improvements</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ReleaseNotesWorkbench.6.4.0.Final">2.4. New and Noteworthy in KIE Workbench 6.4.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e663">2.4.1. New look and feel</a></span></dt><dt><span class="section"><a href="#d0e678">2.4.2. Various UI improvements</a></span></dt><dt><span class="section"><a href="#d0e704">2.4.3. New locales</a></span></dt><dt><span class="section"><a href="#d0e762">2.4.4. Authoring - Imports - Consistent terminology</a></span></dt><dt><span class="section"><a href="#d0e801">2.4.5. Disable automatic build</a></span></dt><dt><span class="section"><a href="#d0e815">2.4.6. Support for <code class="literal">SCP</code> style <code class="literal">git</code> Repository URLs</a></span></dt><dt><span class="section"><a href="#d0e838">2.4.7. Authoring - Duplicate GAV detection</a></span></dt><dt><span class="section"><a href="#d0e945">2.4.8. New Execution Server Management User Interface</a></span></dt><dt><span class="section"><a href="#d0e957">2.4.9.  User and group management</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.ReleaseNotesDrools.6.3.0">2.5. What is New and Noteworthy in Drools 6.3.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e973">2.5.1. Browsing graphs of objects with OOPath</a></span></dt><dt><span class="section"><a href="#shared.ReleaseNotes.KieNavigator">2.5.2. Kie Navigator View for Eclipse</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ReleaseNotesWorkbench.6.3.0.Final">2.6. New and Noteworthy in KIE Workbench 6.3.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1105">2.6.1. Real Time Validation and Verification for the Decision Tables</a></span></dt><dt><span class="section"><a href="#d0e1121">2.6.2. Improved DRL Editor</a></span></dt><dt><span class="section"><a href="#d0e1133">2.6.3. Asset locking</a></span></dt><dt><span class="section"><a href="#d0e1152">2.6.4. Data Modeller Tool Windows</a></span></dt><dt><span class="section"><a href="#d0e1178">2.6.5. Generation of JPA enabled Data Models</a></span></dt><dt><span class="section"><a href="#d0e1221">2.6.6. Data Set Authoring</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.ReleaseNotesDrools.6.2.0">2.7. What is New and Noteworthy in Drools 6.2.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1236">2.7.1. Propagation modes</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ReleaseNotesWorkbench.6.2.0.Final">2.8. New and Noteworthy in KIE Workbench 6.2.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1291">2.8.1. Download Repository or Part of the Repository as a ZIP</a></span></dt><dt><span class="section"><a href="#d0e1310">2.8.2. Project Editor permissions</a></span></dt><dt><span class="section"><a href="#d0e1354">2.8.3. Unify validation style in Guided Decision Table Wizard.</a></span></dt><dt><span class="section"><a href="#d0e1370">2.8.4. Improved Wizards</a></span></dt><dt><span class="section"><a href="#d0e1384">2.8.5. Consistent behaviour of XLS, Guided Decision Tables and Guided Templates</a></span></dt><dt><span class="section"><a href="#d0e1407">2.8.6. Improved Metadata Tab</a></span></dt><dt><span class="section"><a href="#d0e1461">2.8.7. Improved Data Objects Editor</a></span></dt><dt><span class="section"><a href="#d0e1496">2.8.8. Execution Server Management UI</a></span></dt><dt><span class="section"><a href="#d0e1517">2.8.9. Social Activities</a></span></dt><dt><span class="section"><a href="#d0e1567">2.8.10. Contributors Dashboard</a></span></dt><dt><span class="section"><a href="#d0e1587">2.8.11. Package selector</a></span></dt><dt><span class="section"><a href="#d0e1603">2.8.12. Improved visual consistency</a></span></dt><dt><span class="section"><a href="#d0e1624">2.8.13. Guided Decision Tree Editor</a></span></dt><dt><span class="section"><a href="#d0e1638">2.8.14. Create Repository Wizard</a></span></dt><dt><span class="section"><a href="#d0e1657">2.8.15. Repository Structure Screen</a></span></dt></dl></dd><dt><span class="section"><a href="#kie.ReleaseNotesIntegration.6.2.0">2.9. New and Noteworthy in Integration 6.2.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1679">2.9.1. KIE Execution Server</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.ReleaseNotesDrools.6.1.0">2.10. What is New and Noteworthy in Drools 6.1.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1694">2.10.1. JMX support for KieScanner</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ReleaseNotesWorkbench.6.1.0">2.11. New and Noteworthy in KIE Workbench 6.1.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1755">2.11.1. Data Modeler - round trip and source code preservation</a></span></dt><dt><span class="section"><a href="#d0e1760">2.11.2. Data Modeler - improved annotations</a></span></dt><dt><span class="section"><a href="#d0e1765">2.11.3. Standardization of the display of tabular data</a></span></dt><dt><span class="section"><a href="#d0e1824">2.11.4. Generation of <code class="code">modify(x) {...}</code> blocks</a></span></dt></dl></dd><dt><span class="section"><a href="#kie.ReleaseNotesKIE.6.0.0">2.12. New and Noteworthy in KIE API 6.0.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1848">2.12.1. New KIE name</a></span></dt><dt><span class="section"><a href="#d0e1859">2.12.2. Maven aligned projects and modules and Maven Deployment</a></span></dt><dt><span class="section"><a href="#d0e1866">2.12.3. Configuration and convention based projects</a></span></dt><dt><span class="section"><a href="#d0e1881">2.12.4. KieBase Inclusion</a></span></dt><dt><span class="section"><a href="#d0e1901">2.12.5. KieModules, KieContainer and KIE-CI</a></span></dt><dt><span class="section"><a href="#d0e1920">2.12.6. KieScanner</a></span></dt><dt><span class="section"><a href="#d0e1970">2.12.7. Hierarchical ClassLoader</a></span></dt><dt><span class="section"><a href="#d0e1975">2.12.8. Legacy API Adapter</a></span></dt><dt><span class="section"><a href="#d0e1980">2.12.9. KIE Documentation</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.ReleaseNotesDrools.6.0.0">2.13. What is New and Noteworthy in Drools 6.0.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1988">2.13.1. PHREAK - Lazy rule matching algorithm</a></span></dt><dt><span class="section"><a href="#d0e1997">2.13.2. Automatically firing timed rule in passive mode</a></span></dt><dt><span class="section"><a href="#d0e2023">2.13.3. Expression Timers</a></span></dt><dt><span class="section"><a href="#d0e2058">2.13.4. RuleFlowGroups and AgendaGroups are merged</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ReleaseNotesWorkbench.6.0.0">2.14. New and Noteworthy in KIE Workbench 6.0.0</a></span></dt><dt><span class="section"><a href="#kie.ReleaseNotesIntegration.6.0.0">2.15. New and Noteworthy in Integration 6.0.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2161">2.15.1. CDI</a></span></dt><dt><span class="section"><a href="#d0e2176">2.15.2. Spring</a></span></dt><dt><span class="section"><a href="#d0e2181">2.15.3. Aries Blueprints</a></span></dt><dt><span class="section"><a href="#d0e2186">2.15.4. OSGi Ready</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#compatibilityMatrix">3. Compatibility matrix</a></span></dt></dl></div></div><div class="chapter" title="Chapter 1. Introduction"><div class="titlepage"><div><div><h2 class="title"><a id="Welcome"/>Chapter 1. Introduction</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e32">1.1. Introduction</a></span></dt><dt><span class="section"><a href="#gettingstarted">1.2. Getting Involved</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e56">1.2.1. Sign up to jboss.org</a></span></dt><dt><span class="section"><a href="#d0e67">1.2.2. Sign the Contributor Agreement</a></span></dt><dt><span class="section"><a href="#d0e78">1.2.3. Submitting issues via JIRA</a></span></dt><dt><span class="section"><a href="#d0e98">1.2.4. Fork GitHub</a></span></dt><dt><span class="section"><a href="#d0e109">1.2.5. Writing Tests</a></span></dt><dt><span class="section"><a href="#d0e122">1.2.6. Commit with Correct Conventions</a></span></dt><dt><span class="section"><a href="#d0e132">1.2.7. Submit Pull Requests</a></span></dt></dl></dd><dt><span class="section"><a href="#installationAndSetup">1.3. Installation and Setup (Core and IDE)</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e147">1.3.1. Installing and using</a></span></dt><dt><span class="section"><a href="#d0e322">1.3.2. Building from source</a></span></dt><dt><span class="section"><a href="#d0e368">1.3.3. Eclipse</a></span></dt></dl></dd></dl></div><div class="section" title="1.1. Introduction"><div class="titlepage"><div><div><h2 class="title"><a id="d0e32"/>1.1. Introduction</h2></div></div></div><p>It's been a busy year since the last 5.x series release and so much has change.</p><p>One of the biggest complaints during the 5.x series was the lack of defined methodology for
    deployment. The mechanism used by Drools and jBPM was very flexible, but it was too flexible.
    A big focus for 6.0 was streamlining the build, deploy and loading(utilization) aspects of the
    system. Building and deploying now align with Maven and the utilization is now convention and
    configuration oriented, instead of programmatic, with sane default to minimise the
    configuration.</p><p>The workbench has been rebuilt from the ground up, inspired by Eclipse, to provide a
    flexible and better integrated solution; with panels and perspectives via plugins. The base
    workbench has been spun off into a standalone project called UberFire, so that anyone now can
    build high quality web based workbenches. In the longer term it will facilitate user
    customised Drools and jBPM installations.</p><p>Git replaces JCR as the content repository, offering a fast and scalable back-end storage
    for content that has strong tooling support. There has been a refocus on simplicity away from
    databases with an aim of storing everything as text file, even meta data is just a file.
    The database is just there to provide fast indexing and search via Lucene. This will allow
    repositories now to be synced and published with established infrastructure, like
    GitHub.</p><p>jBPM has been dramatically beefed up, thanks to the Polymita acquisition, with human
    tasks, form builders, class modellers, execution servers and runtime management. All fully
    integrated into the new workbench.</p><p>OptaPlanner is now a top level project and getting full time attention.</p><p>A new umbrella name, KIE (Knowledge Is Everything), has been introduced to bring our related technologies
      together under one roof. It also acts as the core shared around for our projects. So expect to see it a
      lot.</p></div><div class="section" title="1.2. Getting Involved"><div class="titlepage"><div><div><h2 class="title"><a id="gettingstarted"/>1.2. Getting Involved</h2></div></div></div><p>We are often asked "How do I get involved". Luckily the answer is
  simple, just write some code and submit it :) There are no hoops you have to
  jump through or secret handshakes. We have a very minimal "overhead" that we
  do request to allow for scalable project development. Below we provide a
  general overview of the tools and "workflow" we request, along with some
  general advice.</p><p>If you contribute some good work, don't forget to blog about it
  :)</p><div class="section" title="1.2.1. Sign up to jboss.org"><div class="titlepage"><div><div><h3 class="title"><a id="d0e56"/>1.2.1. Sign up to jboss.org</h3></div></div></div><p>Signing to jboss.org will give you access to the JBoss wiki, forums and JIRA. Go to 
    <a class="link" href="http://www.jboss.org/">http://www.jboss.org/</a> and click "Register".</p><div class="mediaobject"><img src="images/GettingInvolved/sign_jbossorg.png"/></div></div><div class="section" title="1.2.2. Sign the Contributor Agreement"><div class="titlepage"><div><div><h3 class="title"><a id="d0e67"/>1.2.2. Sign the Contributor Agreement</h3></div></div></div><p>The only form you need to sign is the contributor agreement, which
    is fully automated via the web. As the image below says "This establishes
    the terms and conditions for your contributions and ensures that source
    code can be licensed appropriately"</p><p><a class="link" href="https://cla.jboss.org/">https://cla.jboss.org/</a></p><div class="mediaobject"><img src="images/GettingInvolved/sign_contributor.png"/></div></div><div class="section" title="1.2.3. Submitting issues via JIRA"><div class="titlepage"><div><div><h3 class="title"><a id="d0e78"/>1.2.3. Submitting issues via JIRA</h3></div></div></div><p>To be able to interact with the core development team you will need
    to use JIRA, the issue tracker. This ensures that all requests are logged
    and allocated to a release schedule and all discussions captured in one
    place. Bug reports, bug fixes, feature requests and feature submissions
    should all go here. General questions should be undertaken at the mailing
    lists.</p><p>Minor code submissions, like format or documentation fixes do not
    need an associated JIRA issue created.</p><p><a class="link" href="https://issues.jboss.org/browse/JBRULES">https://issues.jboss.org/browse/JBRULES
    </a>(Drools)</p><p><a class="link" href="https://issues.jboss.org/browse/JBPM">https://issues.jboss.org/browse/JBPM</a></p><p><a class="link" href="https://issues.jboss.org/browse/GUVNOR">https://issues.jboss.org/browse/GUVNOR</a></p><div class="mediaobject"><img src="images/GettingInvolved/submit_jira.png"/></div></div><div class="section" title="1.2.4. Fork GitHub"><div class="titlepage"><div><div><h3 class="title"><a id="d0e98"/>1.2.4. Fork GitHub</h3></div></div></div><p>With the contributor agreement signed and your requests submitted to
    JIRA you should now be ready to code :) Create a GitHub account and fork
    any of the Drools, jBPM or Guvnor repositories. The fork will create a copy
    in your own GitHub space which you can work on at your own pace. If you
    make a mistake, don't worry blow it away and fork again. Note each GitHub
    repository provides you the clone (checkout) URL, GitHub will provide you
    URLs specific to your fork.</p><p><a class="link" href="https://github.com/droolsjbpm">https://github.com/droolsjbpm</a></p><div class="mediaobject"><img src="images/GettingInvolved/fork_github.png"/></div></div><div class="section" title="1.2.5. Writing Tests"><div class="titlepage"><div><div><h3 class="title"><a id="d0e109"/>1.2.5. Writing Tests</h3></div></div></div><p>When writing tests, try and keep them minimal and self contained. We
    prefer to keep the DRL fragments within the test, as it makes for quicker
    reviewing. If their are a large number of rules then using a String is not
    practical so then by all means place them in separate DRL files instead to
    be loaded from the classpath. If your tests need to use a model, please
    try to use those that already exist for other unit tests; such as Person,
    Cheese or Order. If no classes exist that have the fields you need, try
    and update fields of existing classes before adding a new class.</p><p>There are a vast number of tests to look over to get an idea,
    MiscTest is a good place to start.</p><p><a class="link" href="https://github.com/droolsjbpm">https://github.com/droolsjbpm/drools/blob/master/drools-compiler/src/test/java/org/drools/integrationtests/MiscTest.java</a></p><div class="mediaobject"><img src="images/GettingInvolved/unit_test.png"/></div></div><div class="section" title="1.2.6. Commit with Correct Conventions"><div class="titlepage"><div><div><h3 class="title"><a id="d0e122"/>1.2.6. Commit with Correct Conventions</h3></div></div></div><p>When you commit, make sure you use the correct conventions. The
    commit must start with the JIRA issue id, such as JBRULES-220. This
    ensures the commits are cross referenced via JIRA, so we can see all
    commits for a given issue in the same place. After the id the title of the
    issue should come next. Then use a newline, indented with a dash, to
    provide additional information related to this commit. Use an additional
    new line and dash for each separate point you wish to make. You may add
    additional JIRA cross references to the same commit, if it's appropriate.
    In general try to avoid combining unrelated issues in the same
    commit.</p><p>Don't forget to rebase your local fork from the original master and
    then push your commits back to your fork.</p><div class="mediaobject"><img src="images/GettingInvolved/jira_crossreferenced.png"/></div></div><div class="section" title="1.2.7. Submit Pull Requests"><div class="titlepage"><div><div><h3 class="title"><a id="d0e132"/>1.2.7. Submit Pull Requests</h3></div></div></div><p>With your code rebased from original master and pushed to your
    personal GitHub area, you can now submit your work as a pull request. If
    you look at the top of the page in GitHub for your work area their will be
    a "Pull Request" button. Selecting this will then provide a gui to
    automate the submission of your pull request.</p><p>The pull request then goes into a queue for everyone to see and
    comment on. Below you can see a typical pull request. The pull requests
    allow for discussions and it shows all associated commits and the diffs
    for each commit. The discussions typically involve code reviews which
    provide helpful suggestions for improvements, and allows for us to leave
    inline comments on specific parts of the code. Don't be disheartened if we
    don't merge straight away, it can often take several revisions before we
    accept a pull request. Luckily GitHub makes it very trivial to go back to
    your code, do some more commits and then update your pull request to your
    latest and greatest.</p><p>It can take time for us to get round to responding to pull requests,
    so please be patient. Submitted tests that come with a fix will generally
    be applied quite quickly, where as just tests will often way until we get
    time to also submit that with a fix. Don't forget to rebase and resubmit
    your request from time to time, otherwise over time it will have merge
    conflicts and core developers will general ignore those.</p><div class="mediaobject"><img src="images/GettingInvolved/submit_pull_request.png"/></div></div></div><div class="section" title="1.3. Installation and Setup (Core and IDE)"><div class="titlepage"><div><div><h2 class="title"><a id="installationAndSetup"/>1.3. Installation and Setup (Core and IDE)</h2></div></div></div><div class="section" title="1.3.1. Installing and using"><div class="titlepage"><div><div><h3 class="title"><a id="d0e147"/>1.3.1. Installing and using</h3></div></div></div><p>Drools provides an Eclipse-based IDE (which is optional), but at its core only Java 1.5 (Java SE) is
  required.</p><p>A simple way to get started is to download and install the Eclipse plug-in - this will also require the Eclipse
  GEF framework to be installed (see below, if you don't have it installed already). This will provide you with all the
  dependencies you need to get going: you can simply create a new rule project and everything will be done for you.
  Refer to the chapter on the Rule Workbench and IDE for detailed instructions on this. Installing the Eclipse plug-in
  is generally as simple as unzipping a file into your Eclipse plug-in directory.</p><p>Use of the Eclipse plug-in is not required. Rule files are just textual input (or spreadsheets as the case may
  be) and the IDE (also known as the Rule Workbench) is just a convenience. People have integrated the rule engine in
  many ways, there is no "one size fits all".</p><p>Alternatively, you can download the binary distribution, and include the relevant JARs in your projects
  classpath.</p><div class="section" title="1.3.1.1. Dependencies and JARs"><div class="titlepage"><div><div><h4 class="title"><a id="d0e158"/>1.3.1.1. Dependencies and JARs</h4></div></div></div><p>Drools is broken down into a few modules, some are required during rule development/compiling, and some are
    required at runtime. In many cases, people will simply want to include all the dependencies at runtime, and this is
    fine. It allows you to have the most flexibility. However, some may prefer to have their "runtime" stripped down to
    the bare minimum, as they will be deploying rules in binary form - this is also possible. The core runtime engine
    can be quite compact, and only requires a few 100 kilobytes across 3 JAR files.</p><p>The following is a description of the important libraries that make up JBoss Drools</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>knowledge-api.jar - this provides the interfaces and factories. It also helps clearly show what is
        intended as a user API and what is just an engine API.</p></li><li class="listitem"><p>knowledge-internal-api.jar - this provides internal interfaces and factories.</p></li><li class="listitem"><p>drools-core.jar - this is the core engine, runtime component. Contains both the RETE engine and the LEAPS
        engine. This is the only runtime dependency if you are pre-compiling rules (and deploying via Package or
        RuleBase objects).</p></li><li class="listitem"><p>drools-compiler.jar - this contains the compiler/builder components to take rule source, and build
        executable rule bases. This is often a runtime dependency of your application, but it need not be if you are
        pre-compiling your rules. This depends on drools-core.</p></li><li class="listitem"><p>drools-jsr94.jar - this is the JSR-94 compliant implementation, this is essentially a layer over the
        drools-compiler component. Note that due to the nature of the JSR-94 specification, not all features are easily
        exposed via this interface. In some cases, it will be easier to go direct to the Drools API, but in some
        environments the JSR-94 is mandated.</p></li><li class="listitem"><p>drools-decisiontables.jar - this is the decision tables 'compiler' component, which uses the
        drools-compiler component. This supports both excel and CSV input formats.</p></li></ul></div><p>There are quite a few other dependencies which the above components require, most of which are for the
    drools-compiler, drools-jsr94 or drools-decisiontables module. Some key ones to note are "POI" which provides the
    spreadsheet parsing ability, and "antlr" which provides the parsing for the rule language itself.</p><p>NOTE: if you are using Drools in J2EE or servlet containers and you come across classpath issues with "JDT",
    then you can switch to the janino compiler. Set the system property "drools.compiler": For example:
    -Ddrools.compiler=JANINO.</p><p>For up to date info on dependencies in a release, consult the released POMs, which can be found on the Maven
    repository.</p></div><div class="section" title="1.3.1.2. Use with Maven, Gradle, Ivy, Buildr or Ant"><div class="titlepage"><div><div><h4 class="title"><a id="d0e190"/>1.3.1.2. Use with Maven, Gradle, Ivy, Buildr or Ant</h4></div></div></div><p>The JARs are also available in <a class="link" href="http://search.maven.org/#search|ga|1|org.drools">the central
    Maven repository</a> (and also in <a class="link" href="https://repository.jboss.org/nexus/index.html#nexus-search;gav~org.drools~~~~">the JBoss Maven
    repository</a>).</p><p>If you use Maven, add KIE and Drools dependencies in your project's <code class="filename">pom.xml</code> like
    this:</p><pre><code class="language-xml">  &lt;dependencyManagement&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;org.drools&lt;/groupId&gt;
        &lt;artifactId&gt;drools-bom&lt;/artifactId&gt;
        &lt;type&gt;pom&lt;/type&gt;
        &lt;version&gt;...&lt;/version&gt;
        &lt;scope&gt;import&lt;/scope&gt;
      &lt;/dependency&gt;
      ...
    &lt;/dependencies&gt;
  &lt;/dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.kie&lt;/groupId&gt;
      &lt;artifactId&gt;kie-api&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.drools&lt;/groupId&gt;
      &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;/dependency&gt;
    ...
  &lt;dependencies&gt;</code></pre><p>This is similar for Gradle, Ivy and Buildr. To identify the latest version, check the Maven repository.</p><p>If you're still using Ant (without Ivy), copy all the JARs from the download zip's
    <code class="filename">binaries</code> directory and manually verify that your classpath doesn't contain duplicate
    JARs.</p></div><div class="section" title="1.3.1.3. Runtime"><div class="titlepage"><div><div><h4 class="title"><a id="d0e215"/>1.3.1.3. Runtime</h4></div></div></div><p>The "runtime" requirements mentioned here are if you are deploying rules as their binary form (either as
    KnowledgePackage objects, or KnowledgeBase objects etc). This is an optional feature that allows you to keep your
    runtime very light. You may use drools-compiler to produce rule packages "out of process", and then deploy them to a
    runtime system. This runtime system only requires drools-core.jar and knowledge-api for execution. This is an optional
    deployment pattern, and many people do not need to "trim" their application this much, but it is an ideal option for
    certain environments.</p></div><div class="section" title="1.3.1.4. Installing IDE (Rule Workbench)"><div class="titlepage"><div><div><h4 class="title"><a id="d0e220"/>1.3.1.4. Installing IDE (Rule Workbench)</h4></div></div></div><p>The rule workbench (for Eclipse) requires that you have Eclipse 3.4 or greater, as well as Eclipse GEF 3.4 or
    greater. You can install it either by downloading the plug-in or using the update site.</p><p>Another option is to use the JBoss IDE, which comes with all the plug-in requirements pre packaged, as well as
    a choice of other tools separate to rules. You can choose just to install rules from the "bundle" that JBoss IDE
    ships with.</p><div class="section" title="1.3.1.4.1. Installing GEF (a required dependency)"><div class="titlepage"><div><div><h5 class="title"><a id="d0e227"/>1.3.1.4.1. Installing GEF (a required dependency)</h5></div></div></div><p>GEF is the Eclipse Graphical Editing Framework, which is used for graph viewing components in the
      plug-in.</p><p>If you don't have GEF installed, you can install it using the built in update mechanism (or downloading GEF
      from the Eclipse.org website not recommended). JBoss IDE has GEF already, as do many other "distributions" of
      Eclipse, so this step may be redundant for some people.</p><p>Open the Help-&gt;Software updates...-&gt;Available Software-&gt;Add Site... from the help menu. Location
      is:</p><pre><code class="no-highlight">http://download.eclipse.org/tools/gef/updates/releases/</code></pre><p>Next you choose the GEF plug-in:</p><div class="screenshot"><div class="mediaobject"><img src="images/Install/install_gef.png"/></div></div><p>Press next, and agree to install the plug-in (an Eclipse restart may be required). Once this is completed,
      then you can continue on installing the rules plug-in.</p></div><div class="section" title="1.3.1.4.2. Installing GEF from zip file"><div class="titlepage"><div><div><h5 class="title"><a id="d0e246"/>1.3.1.4.2. Installing GEF from zip file</h5></div></div></div><p>To install from the zip file, download and unzip the file. Inside the zip you will see a plug-in directory,
      and the plug-in JAR itself. You place the plug-in JAR into your Eclipse applications plug-in directory, and
      restart Eclipse.</p></div><div class="section" title="1.3.1.4.3. Installing Drools plug-in from zip file"><div class="titlepage"><div><div><h5 class="title"><a id="d0e251"/>1.3.1.4.3. Installing Drools plug-in from zip file</h5></div></div></div><p>Download the Drools Eclipse IDE plugin from the link below. Unzip the downloaded file in your main eclipse
      folder (do not just copy the file there, extract it so that the feature and plugin JARs end up in the features and
      plugin directory of eclipse) and (re)start Eclipse.</p><p><a class="ulink" href="http://www.drools.org/download/download.html">http://www.drools.org/download/download.html</a></p><p>To check that the installation was successful, try opening the Drools perspective: Click the 'Open
      Perspective' button in the top right corner of your Eclipse window, select 'Other...' and pick the Drools
      perspective. If you cannot find the Drools perspective as one of the possible perspectives, the installation
      probably was unsuccessful. Check whether you executed each of the required steps correctly: Do you have the right
      version of Eclipse (3.4.x)? Do you have Eclipse GEF installed (check whether the org.eclipse.gef_3.4.*.jar exists
      in the plugins directory in your eclipse root folder)? Did you extract the Drools Eclipse plugin correctly (check
      whether the org.drools.eclipse_*.jar exists in the plugins directory in your eclipse root folder)? If you cannot
      find the problem, try contacting us (e.g. on irc or on the user mailing list), more info can be found no our
      homepage here:</p><p><a class="ulink" href="http://www.drools.org/">http://www.drools.org/</a></p></div><div class="section" title="1.3.1.4.4. Drools Runtimes"><div class="titlepage"><div><div><h5 class="title"><a id="d0e264"/>1.3.1.4.4. Drools Runtimes</h5></div></div></div><p>A Drools runtime is a collection of JARs on your file system that represent one specific release of the
      Drools project JARs. To create a runtime, you must point the IDE to the release of your choice. If you want to
      create a new runtime based on the latest Drools project JARs included in the plugin itself, you can also easily do
      that. You are required to specify a default Drools runtime for your Eclipse workspace, but each individual project
      can override the default and select the appropriate runtime for that project specifically.</p><div class="section" title="1.3.1.4.4.1. Defining a Drools runtime"><div class="titlepage"><div><div><h6 class="title"><a id="d0e269"/>1.3.1.4.4.1. Defining a Drools runtime</h6></div></div></div><p>You are required to define one or more Drools runtimes using the Eclipse preferences view. To open up your
        preferences, in the menu Window select the Preferences menu item. A new preferences dialog should show all your
        preferences. On the left side of this dialog, under the Drools category, select "Installed Drools runtimes". The
        panel on the right should then show the currently defined Drools runtimes. If you have not yet defined any
        runtimes, it should like something like the figure below.</p><div class="mediaobject" align="center"><img src="images/Install/drools-runtimes.png" align="middle"/></div><p>To define a new Drools runtime, click on the add button. A dialog as shown below should pop up, requiring
        the name for your runtime and the location on your file system where it can be found.</p><div class="mediaobject" align="center"><img src="images/Install/drools-runtimes-add.png" align="middle"/></div><p>In general, you have two options:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>If you simply want to use the default JARs as included in the Drools Eclipse plugin, you can create a
            new Drools runtime automatically by clicking the "Create a new Drools 5 runtime ..." button. A file browser
            will show up, asking you to select the folder on your file system where you want this runtime to be created.
            The plugin will then automatically copy all required dependencies to the specified folder. After selecting
            this folder, the dialog should look like the figure shown below.</p></li><li class="listitem"><p>If you want to use one specific release of the Drools project, you should create a folder on your file
            system that contains all the necessary Drools libraries and dependencies. Instead of creating a new Drools
            runtime as explained above, give your runtime a name and select the location of this folder containing all
            the required JARs.</p></li></ol></div><div class="mediaobject" align="center"><img src="images/Install/drools-runtimes-add2.png" align="middle"/></div><p>After clicking the OK button, the runtime should show up in your table of installed Drools runtimes, as
        shown below. Click on checkbox in front of the newly created runtime to make it the default Drools runtime. The
        default Drools runtime will be used as the runtime of all your Drools project that have not selected a
        project-specific runtime.</p><div class="mediaobject" align="center"><img src="images/Install/drools-runtimes2.png" align="middle"/></div><p>You can add as many Drools runtimes as you need. For example, the screenshot below shows a configuration
        where three runtimes have been defined: a Drools 4.0.7 runtime, a Drools 5.0.0 runtime and a Drools
        5.0.0.SNAPSHOT runtime. The Drools 5.0.0 runtime is selected as the default one.</p><div class="mediaobject" align="center"><img src="images/Install/drools-runtimes3.png" align="middle"/></div><p>Note that you will need to restart Eclipse if you changed the default runtime and you want to make sure
        that all the projects that are using the default runtime update their classpath accordingly.</p></div><div class="section" title="1.3.1.4.4.2. Selecting a runtime for your Drools project"><div class="titlepage"><div><div><h6 class="title"><a id="d0e306"/>1.3.1.4.4.2. Selecting a runtime for your Drools project</h6></div></div></div><p>Whenever you create a Drools project (using the New Drools Project wizard or by converting an existing
        Java project to a Drools project using the "Convert to Drools Project" action that is shown when you are in the
        Drools perspective and you right-click an existing Java project), the plugin will automatically add all the
        required JARs to the classpath of your project.</p><p>When creating a new Drools project, the plugin will automatically use the default Drools runtime for that
        project, unless you specify a project-specific one. You can do this in the final step of the New Drools Project
        wizard, as shown below, by deselecting the "Use default Drools runtime" checkbox and selecting the appropriate
        runtime in the drop-down box. If you click the "Configure workspace settings ..." link, the workspace
        preferences showing the currently installed Drools runtimes will be opened, so you can add new runtimes
        there.</p><div class="mediaobject" align="center"><img src="images/Install/drools-runtimes-newproject.png" align="middle"/></div><p>You can change the runtime of a Drools project at any time by opening the project properties (right-click
        the project and select Properties) and selecting the Drools category, as shown below. Check the "Enable project
        specific settings" checkbox and select the appropriate runtime from the drop-down box. If you click the
        "Configure workspace settings ..." link, the workspace preferences showing the currently installed Drools
        runtimes will be opened, so you can add new runtimes there. If you deselect the "Enable project specific
        settings" checkbox, it will use the default runtime as defined in your global preferences.</p><div class="mediaobject" align="center"><img src="images/Install/drools-runtimes-project.png" align="middle"/></div></div></div></div></div><div class="section" title="1.3.2. Building from source"><div class="titlepage"><div><div><h3 class="title"><a id="d0e322"/>1.3.2. Building from source</h3></div></div></div><div class="section" title="1.3.2.1. Getting the sources"><div class="titlepage"><div><div><h4 class="title"><a id="d0e325"/>1.3.2.1. Getting the sources</h4></div></div></div><p>The source code of each Maven artifact is available in the JBoss Maven repository as a source JAR. The same
    source JARs are also included in the download zips. However, if you want to build from source, it's highly
    recommended to get our sources from our source control.</p><p>Drools and jBPM use <a class="link" href="http://git-scm.com/">Git</a> for source control. The blessed git
    repositories are hosted on <a class="link" href="https://github.com">GitHub</a>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="link" href="https://github.com/droolsjbpm">https://github.com/droolsjbpm</a></p></li></ul></div><p>Git allows you to fork our code, independently make personal changes on it, yet still merge in our latest
    changes regularly and optionally share your changes with us. To learn more about git, read the free book <a class="link" href="http://progit.org/book/">Git Pro</a>.</p></div><div class="section" title="1.3.2.2. Building the sources"><div class="titlepage"><div><div><h4 class="title"><a id="d0e348"/>1.3.2.2. Building the sources</h4></div></div></div><p>In essense, building from source is very easy, for example if you want to build the
    <em class="firstterm">guvnor</em> project:</p><pre><code class="no-highlight">$ git clone git@github.com:droolsjbpm/guvnor.git
...
$ cd guvnor
$ mvn clean install -DskipTests -Dfull
...</code></pre><p>However, <span class="emphasis"><em>there are a lot potential pitfalls</em></span>, so if you're serious about building from
    source and possibly contributing to the project, <span class="bold"><strong>follow the instructions <a class="link" href="https://github.com/droolsjbpm/droolsjbpm-build-bootstrap/blob/master/README.md">in the README file in
    droolsjbpm-build-bootstrap</a>. </strong></span></p></div></div><div class="section" title="1.3.3. Eclipse"><div class="titlepage"><div><div><h3 class="title"><a id="d0e368"/>1.3.3. Eclipse</h3></div></div></div><div class="section" title="1.3.3.1. Importing Eclipse Projects"><div class="titlepage"><div><div><h4 class="title"><a id="d0e371"/>1.3.3.1. Importing Eclipse Projects</h4></div></div></div><p>With the <a id="d0e376" class="indexterm"/>Eclipse project files generated they can now be imported into Eclipse. When starting Eclipse open the
    workspace in the root of your subversion checkout.</p><div class="screenshot"><div class="mediaobject"><img src="images/Install/eclipse_import1.jpg"/></div></div><div class="screenshot"><div class="mediaobject"><img src="images/Install/eclipse_import2.jpg"/></div></div><div class="screenshot"><div class="mediaobject"><img src="images/Install/eclipse_import3.jpg"/></div></div><div class="screenshot"><div class="mediaobject"><img src="images/Install/eclipse_import4.jpg"/></div></div><p>When calling <span class="command"><strong>mvn install</strong></span> all the project dependencies were downloaded and added to the
    local Maven repository. Eclipse cannot find those dependencies unless you tell it where that repository is. To do
    this setup an <code class="literal">M2_REPO</code> classpath variable.</p><div class="screenshot"><div class="mediaobject"><img src="images/Install/eclipse_import6.jpg"/></div></div><div class="screenshot"><div class="mediaobject"><img src="images/Install/eclipse_import7.jpg"/></div></div><div class="screenshot"><div class="mediaobject"><img src="images/Install/eclipse_import8.jpg"/></div></div><div class="screenshot"><div class="mediaobject"><img src="images/Install/eclipse_import9.jpg"/></div></div></div></div></div></div><div class="chapter" title="Chapter 2. Release Notes"><div class="titlepage"><div><div><h2 class="title"><a id="DroolsReleaseNotesChapter"/>Chapter 2. Release Notes</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#drools.ReleaseNotesDrools.6.5.0">2.1. What is New and Noteworthy in Drools 6.5.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e443">2.1.1. Configurable ThreadFactory</a></span></dt><dt><span class="section"><a href="#d0e456">2.1.2. Use of any expressions as input for a query</a></span></dt><dt><span class="section"><a href="#d0e467">2.1.3. Update with modified properties</a></span></dt><dt><span class="section"><a href="#d0e476">2.1.4. Monitoring framework improvements</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ReleaseNotesWorkbench.6.5.0.Final">2.2. New and Noteworthy in KIE Workbench 6.5.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e567">2.2.1. Guided Rule Editor : Support formulae in composite field constraints</a></span></dt><dt><span class="section"><a href="#d0e588">2.2.2. Authoring - Project Editor - Reimport button</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.ReleaseNotesDrools.6.4.0">2.3. What is New and Noteworthy in Drools 6.4.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e596">2.3.1. Better Java 8 compatibility</a></span></dt><dt><span class="section"><a href="#d0e601">2.3.2. More robust incremental compilation</a></span></dt><dt><span class="section"><a href="#d0e606">2.3.3. Improved multi-threading behaviour</a></span></dt><dt><span class="section"><a href="#d0e615">2.3.4. OOPath improvements</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ReleaseNotesWorkbench.6.4.0.Final">2.4. New and Noteworthy in KIE Workbench 6.4.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e663">2.4.1. New look and feel</a></span></dt><dt><span class="section"><a href="#d0e678">2.4.2. Various UI improvements</a></span></dt><dt><span class="section"><a href="#d0e704">2.4.3. New locales</a></span></dt><dt><span class="section"><a href="#d0e762">2.4.4. Authoring - Imports - Consistent terminology</a></span></dt><dt><span class="section"><a href="#d0e801">2.4.5. Disable automatic build</a></span></dt><dt><span class="section"><a href="#d0e815">2.4.6. Support for <code class="literal">SCP</code> style <code class="literal">git</code> Repository URLs</a></span></dt><dt><span class="section"><a href="#d0e838">2.4.7. Authoring - Duplicate GAV detection</a></span></dt><dt><span class="section"><a href="#d0e945">2.4.8. New Execution Server Management User Interface</a></span></dt><dt><span class="section"><a href="#d0e957">2.4.9.  User and group management</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.ReleaseNotesDrools.6.3.0">2.5. What is New and Noteworthy in Drools 6.3.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e973">2.5.1. Browsing graphs of objects with OOPath</a></span></dt><dt><span class="section"><a href="#shared.ReleaseNotes.KieNavigator">2.5.2. Kie Navigator View for Eclipse</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ReleaseNotesWorkbench.6.3.0.Final">2.6. New and Noteworthy in KIE Workbench 6.3.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1105">2.6.1. Real Time Validation and Verification for the Decision Tables</a></span></dt><dt><span class="section"><a href="#d0e1121">2.6.2. Improved DRL Editor</a></span></dt><dt><span class="section"><a href="#d0e1133">2.6.3. Asset locking</a></span></dt><dt><span class="section"><a href="#d0e1152">2.6.4. Data Modeller Tool Windows</a></span></dt><dt><span class="section"><a href="#d0e1178">2.6.5. Generation of JPA enabled Data Models</a></span></dt><dt><span class="section"><a href="#d0e1221">2.6.6. Data Set Authoring</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.ReleaseNotesDrools.6.2.0">2.7. What is New and Noteworthy in Drools 6.2.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1236">2.7.1. Propagation modes</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ReleaseNotesWorkbench.6.2.0.Final">2.8. New and Noteworthy in KIE Workbench 6.2.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1291">2.8.1. Download Repository or Part of the Repository as a ZIP</a></span></dt><dt><span class="section"><a href="#d0e1310">2.8.2. Project Editor permissions</a></span></dt><dt><span class="section"><a href="#d0e1354">2.8.3. Unify validation style in Guided Decision Table Wizard.</a></span></dt><dt><span class="section"><a href="#d0e1370">2.8.4. Improved Wizards</a></span></dt><dt><span class="section"><a href="#d0e1384">2.8.5. Consistent behaviour of XLS, Guided Decision Tables and Guided Templates</a></span></dt><dt><span class="section"><a href="#d0e1407">2.8.6. Improved Metadata Tab</a></span></dt><dt><span class="section"><a href="#d0e1461">2.8.7. Improved Data Objects Editor</a></span></dt><dt><span class="section"><a href="#d0e1496">2.8.8. Execution Server Management UI</a></span></dt><dt><span class="section"><a href="#d0e1517">2.8.9. Social Activities</a></span></dt><dt><span class="section"><a href="#d0e1567">2.8.10. Contributors Dashboard</a></span></dt><dt><span class="section"><a href="#d0e1587">2.8.11. Package selector</a></span></dt><dt><span class="section"><a href="#d0e1603">2.8.12. Improved visual consistency</a></span></dt><dt><span class="section"><a href="#d0e1624">2.8.13. Guided Decision Tree Editor</a></span></dt><dt><span class="section"><a href="#d0e1638">2.8.14. Create Repository Wizard</a></span></dt><dt><span class="section"><a href="#d0e1657">2.8.15. Repository Structure Screen</a></span></dt></dl></dd><dt><span class="section"><a href="#kie.ReleaseNotesIntegration.6.2.0">2.9. New and Noteworthy in Integration 6.2.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1679">2.9.1. KIE Execution Server</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.ReleaseNotesDrools.6.1.0">2.10. What is New and Noteworthy in Drools 6.1.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1694">2.10.1. JMX support for KieScanner</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ReleaseNotesWorkbench.6.1.0">2.11. New and Noteworthy in KIE Workbench 6.1.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1755">2.11.1. Data Modeler - round trip and source code preservation</a></span></dt><dt><span class="section"><a href="#d0e1760">2.11.2. Data Modeler - improved annotations</a></span></dt><dt><span class="section"><a href="#d0e1765">2.11.3. Standardization of the display of tabular data</a></span></dt><dt><span class="section"><a href="#d0e1824">2.11.4. Generation of <code class="code">modify(x) {...}</code> blocks</a></span></dt></dl></dd><dt><span class="section"><a href="#kie.ReleaseNotesKIE.6.0.0">2.12. New and Noteworthy in KIE API 6.0.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1848">2.12.1. New KIE name</a></span></dt><dt><span class="section"><a href="#d0e1859">2.12.2. Maven aligned projects and modules and Maven Deployment</a></span></dt><dt><span class="section"><a href="#d0e1866">2.12.3. Configuration and convention based projects</a></span></dt><dt><span class="section"><a href="#d0e1881">2.12.4. KieBase Inclusion</a></span></dt><dt><span class="section"><a href="#d0e1901">2.12.5. KieModules, KieContainer and KIE-CI</a></span></dt><dt><span class="section"><a href="#d0e1920">2.12.6. KieScanner</a></span></dt><dt><span class="section"><a href="#d0e1970">2.12.7. Hierarchical ClassLoader</a></span></dt><dt><span class="section"><a href="#d0e1975">2.12.8. Legacy API Adapter</a></span></dt><dt><span class="section"><a href="#d0e1980">2.12.9. KIE Documentation</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.ReleaseNotesDrools.6.0.0">2.13. What is New and Noteworthy in Drools 6.0.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1988">2.13.1. PHREAK - Lazy rule matching algorithm</a></span></dt><dt><span class="section"><a href="#d0e1997">2.13.2. Automatically firing timed rule in passive mode</a></span></dt><dt><span class="section"><a href="#d0e2023">2.13.3. Expression Timers</a></span></dt><dt><span class="section"><a href="#d0e2058">2.13.4. RuleFlowGroups and AgendaGroups are merged</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ReleaseNotesWorkbench.6.0.0">2.14. New and Noteworthy in KIE Workbench 6.0.0</a></span></dt><dt><span class="section"><a href="#kie.ReleaseNotesIntegration.6.0.0">2.15. New and Noteworthy in Integration 6.0.0</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e2161">2.15.1. CDI</a></span></dt><dt><span class="section"><a href="#d0e2176">2.15.2. Spring</a></span></dt><dt><span class="section"><a href="#d0e2181">2.15.3. Aries Blueprints</a></span></dt><dt><span class="section"><a href="#d0e2186">2.15.4. OSGi Ready</a></span></dt></dl></dd></dl></div><div class="section" title="2.1. What is New and Noteworthy in Drools 6.5.0"><div class="titlepage"><div><div><h2 class="title"><a id="drools.ReleaseNotesDrools.6.5.0"/>2.1. What is New and Noteworthy in Drools 6.5.0</h2></div></div></div><div class="section" title="2.1.1. Configurable ThreadFactory"><div class="titlepage"><div><div><h3 class="title"><a id="d0e443"/>2.1.1. Configurable ThreadFactory</h3></div></div></div><p>Some runtime environments (like for example Google App Engine) don't allow to
      directly create new Threads. For this reason it is now possible to plug your own
      ThreadFactory implementation by setting the system property
      <span class="bold"><strong>drools.threadFactory</strong></span> with its class name.
      For instance if you implemented your Google App Engine compatible ThreadFactory
      with the class <code class="literal">com.user.project.GoogleAppEngineThreadFactory</code> you can
      make Drools to use it by setting:</p><pre><code class="no-highlight">drools.threadFactory = com.user.project.GoogleAppEngineThreadFactory</code></pre></div><div class="section" title="2.1.2. Use of any expressions as input for a query"><div class="titlepage"><div><div><h3 class="title"><a id="d0e456"/>2.1.2. Use of any expressions as input for a query</h3></div></div></div><p>It is now possible to use as input argument for a query both the field of a fact as in:</p><pre><code class="no-highlight">query contains(String $s, String $c)
    $s := String( this.contains( $c ) )
end

rule PersonNamesWithA when
    $p : Person()
    contains( $p.name, "a"; )
then
end</code></pre><p>and more in general any kind of valid expression like in:</p><pre><code class="no-highlight">query checkLength(String $s, int $l)
    $s := String( length == $l )
end

rule CheckPersonNameLength when
    $i : Integer()
    $p : Person()
    checkLength( $p.name, 1 + $i + $p.age; )
then
end</code></pre></div><div class="section" title="2.1.3. Update with modified properties"><div class="titlepage"><div><div><h3 class="title"><a id="d0e467"/>2.1.3. Update with modified properties</h3></div></div></div><p>Property reactivity has been introduced to avoid unwanted and useless (re)evaluations and
    allow the engine to react only to modification of properties actually constrained or bound inside
    of a given pattern. However this feature is automatically available only for modifications performed
    inside the consequence of a rule. Conversely a programmatic update is unaware of the object’s properties
    that have been changed, so it is unable of using this feature.</p><p>To overcome this limitation it is now possible to optionally specify in an update statement the
    names of the properties that have been changed in the modified object as in the following example:</p><pre><code class="no-highlight">Person me = new Person("me", 40);
FactHandle meHandle = ksession.insert( me );

me.setAge(41);
me.setAddress("California Avenue");
ksession.update( meHandle, me, "age", "address" );</code></pre></div><div class="section" title="2.1.4. Monitoring framework improvements"><div class="titlepage"><div><div><h3 class="title"><a id="d0e476"/>2.1.4. Monitoring framework improvements</h3></div></div></div><p>A new type of MBean has been introduced in order to provide monitoring of the KieContainers,
    and the JMX MBeans hierarchical structure have been revisited to reflect the relationship
    with the related MBeans of the KieBases. The JMX objectnaming has been normalized to reflect the
    terminology used in the Kie API.A new type of MBean has been introduced in order to provide
    monitoring for Stateless KieSession, which was not available in previous releases.</p><div class="table"><a id="d0e481"/><p class="title"><strong>Table 2.1. JMX objectname changes</strong></p><div class="table-contents"><table summary="JMX objectname changes" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">MBean</th><th align="center">before <code class="code">6.5.x</code></th><th align="center">from <code class="code">6.5.0.Final</code></th></tr></thead><tbody><tr><td>KieContainer</td><td>n/a</td><td><code class="code">org.kie:kcontainerId={kcontainerId}</code></td></tr><tr><td>KieBase</td><td><code class="code">org.drools.kbases:type={kbaseId}</code></td><td><code class="code">org.kie:kcontainerId={kcontainerId},kbaseId={kbaseId}</code></td></tr><tr><td>KieSession (stateful)</td><td><code class="code">org.drools.kbases:type={kbaseId},group=Sessions,sessionId={ksessionId}</code></td><td><code class="code">org.kie:kcontainerId={kcontainerId},kbaseId={kbaseId},ksessionType=Stateful,ksessionName={ksessionName}</code></td></tr><tr><td>Stateless KieSession</td><td>n/a</td><td><code class="code">org.kie:kcontainerId={kcontainerId},kbaseId={kbaseId},ksessionType=Stateless,ksessionName={ksessionName}</code></td></tr></tbody></table></div></div><br class="table-break"/><p>The KieSession MBeans consolidate the statistics data for all sessions instantiated under the same name.</p><p>KieSession created via <code class="code">JPAKnowledgeService</code>, will be monitored under a KieSession MBean having constant <code class="code">{ksessionName}</code>
     valorized to <code class="code">persistent</code>; this MBean is not managed by the KieContainer directly, hence it requires to be manually deregistered
     from JMX, when monitoring is no longer needed.</p><p>The new JMX objectnaming scheme now enforces proper JMX quoting for IDs, e.g.: 
     <code class="code">org.kie:kcontainerId="2cb55f40-f220-432a-aba8-7940c18bf108",kbaseId="KBase1"</code></p><p>The old DroolsManagementAgent (which was registered on JMX under <code class="code">org.drools:type=DroolsManagementAgent</code>) is no longer
     necessary, hence no longer registered on JMX.</p><p>The KieSession MBeans now have proper JMX <code class="code">CompositeData</code> and <code class="code">TabularData</code> support, where applicable.
     The KieSession MBeans continue to support all process-related aggregated statistics monitoring, but no longer display start/end dates
     for each process instances: auditing and logging support is available in jBPM for this scope.</p><p>The Drools RHQ/JON plug-in have been changed to reflect all the above mentioned changes, in addition to specific bug-fixing
     aiming to display hierarchical nesting correctly.</p></div></div><div class="section" title="2.2. New and Noteworthy in KIE Workbench 6.5.0"><div class="titlepage"><div><div><h2 class="title"><a id="wb.ReleaseNotesWorkbench.6.5.0.Final"/>2.2. New and Noteworthy in KIE Workbench 6.5.0</h2></div></div></div><div class="section" title="2.2.1. Guided Rule Editor : Support formulae in composite field constraints"><div class="titlepage"><div><div><h3 class="title"><a id="d0e567"/>2.2.1. Guided Rule Editor : Support formulae in composite field constraints</h3></div></div></div><p>Composite field constraints now support use of formulae.</p><p>When adding constraints to a Pattern the "Multiple Field Constraint" selection ("All of (and)" and "Any of (or)") supports use of formulae in addition to expressions.</p><div class="figure"><a id="d0e574"/><p class="title"><strong>Figure 2.1. Composite field constraint - Select formula</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/composite-field-constraint-formulae1.png" alt="Composite field constraint - Select formula"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e581"/><p class="title"><strong>Figure 2.2. Composite field constraint - Formula editor</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/composite-field-constraint-formulae2.png" alt="Composite field constraint - Formula editor"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="2.2.2. Authoring - Project Editor - Reimport button"><div class="titlepage"><div><div><h3 class="title"><a id="d0e588"/>2.2.2. Authoring - Project Editor - Reimport button</h3></div></div></div><p>The "Reimport" button invalidates all cached dependencies, in order to handle scenarios where a specific dependency was updated without having its version modified.
    </p></div></div><div class="section" title="2.3. What is New and Noteworthy in Drools 6.4.0"><div class="titlepage"><div><div><h2 class="title"><a id="drools.ReleaseNotesDrools.6.4.0"/>2.3. What is New and Noteworthy in Drools 6.4.0</h2></div></div></div><div class="section" title="2.3.1. Better Java 8 compatibility"><div class="titlepage"><div><div><h3 class="title"><a id="d0e596"/>2.3.1. Better Java 8 compatibility</h3></div></div></div><p>It is now possible to use Java 8 syntax (lambdas and method references) in the
    Right Hand Side (then) part of a rule.</p></div><div class="section" title="2.3.2. More robust incremental compilation"><div class="titlepage"><div><div><h3 class="title"><a id="d0e601"/>2.3.2. More robust incremental compilation</h3></div></div></div><p>The incremental compilation (dynamic rule-base update) had some relevant flaws
    when one or more rules with a subnetwork (rules with complex existential patterns)
    were involved, especially when the same subnetwork was shared among different rules.
    This issue required a partial rewriting of the existing incremental compilation algorithm,
    followed by a complete audit that has also been validated by brand new test suite
    made by more than 20,000 test cases only in this area.</p></div><div class="section" title="2.3.3. Improved multi-threading behaviour"><div class="titlepage"><div><div><h3 class="title"><a id="d0e606"/>2.3.3. Improved multi-threading behaviour</h3></div></div></div><p>Engine's code dealing with multi-threading has been partially rewritten
    in order to remove a large number of synchronisation points and improve stability
    and predictability. In particular this new implementation allows a clearer separation
    and better interaction between the User thread (performing the insert/update/delete
    actions on the session), the Engine thread (doing the proper rules evaluation) and
    the Timer one (performing time-based actions like events expiration).</p><p>This improvement has been made possible by the new phreak algorithm
    introduced with Drools 6. In fact with in the ReteOO algorithm the network evaluation
    is performed during the User insert/update/delete action, meaning that each user
    action locks the entire engine. Conversely with phreak the insert/update/delete
    is separated and the network evaluation happens when fireAllRules or fireUntilHalt
    is called.</p><p>More in detail this improvement has been made by 2 parts. First of all a new
    thread-safe queue has been added to store all user actions as commands. This queue
    is populated by the User thread while its entries are flushed and processed by the
    Engine thread during the rules evaluations phase. The second part introduced a state
    machine coordinating the User, Timer and Engine threads and then providing a clearer
    and self-documenting way to model their interactions.</p></div><div class="section" title="2.3.4. OOPath improvements"><div class="titlepage"><div><div><h3 class="title"><a id="d0e615"/>2.3.4. OOPath improvements</h3></div></div></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>This feature is experimental</p></div><p>OOPath has been introduced with Drools 6.3.0. In Drools 6.4.0 it has been enhanced
      to support the following features:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A constraint can also have a beckreference to an object of the graph traversed before the
          currently iterated one. For example the following OOPath:</p><pre><code class="no-highlight">Student( $grade: /plan/exams/grades{ result &gt; ../averageResult } )</code></pre><p>will match only the grades having a result above the average for the passed exam.</p></li><li class="listitem"><p>A constraint can also recursively be another OOPath as it follows:</p><pre><code class="no-highlight">Student( $exam: /plan/exams{ /grades{ result &gt; 20 } } )</code></pre></li><li class="listitem"><p>It is also possible to use the <code class="literal">?/</code> separator instead of
          the <code class="literal">/</code> one. As in the following example:</p><pre><code class="no-highlight">Student( $grade: /plan/exams{ course == "Big Data" }?/grades )</code></pre><p>By doing so the engine will react to a change made to an exam, or if an exam is added to the plan,
          but not if a new grade is added to an existing exam. Of course if a OOPath chunk is not reactive,
          all remaining part of the OOPath from there till the end of the expression will be non-reactive as well.
          For instance the following OOPath</p><pre><code class="no-highlight">Student( $grade: ?/plan/exams{ course == "Big Data" }/grades )</code></pre><p>will be completely non-reactive. For this reason it is not allowed to use the
          <code class="literal">?/</code> separator more than once in the same OOPath so an expression like:</p><pre><code class="no-highlight">Student( $grade: /plan?/exams{ course == "Big Data" }?/grades )</code></pre><p>will cause a compile time error.</p></li></ul></div></div></div><div class="section" title="2.4. New and Noteworthy in KIE Workbench 6.4.0"><div class="titlepage"><div><div><h2 class="title"><a id="wb.ReleaseNotesWorkbench.6.4.0.Final"/>2.4. New and Noteworthy in KIE Workbench 6.4.0</h2></div></div></div><div class="section" title="2.4.1. New look and feel"><div class="titlepage"><div><div><h3 class="title"><a id="d0e663"/>2.4.1. New look and feel</h3></div></div></div><p>The general look and feel in the entire workbench has been updated to adopt <a class="link" href="https://www.patternfly.org/">PatternFly</a>. The update brings a cleaner, lightweight and more consistent user experience throughout
      every screen. Allowing users focus on the data and the tasks by removing all uncessary visual elements.
      Interactions and behaviors remain mostly unchanged, limiting the scope of this change to visual updates.
    </p><div class="figure"><a id="d0e671"/><p class="title"><strong>Figure 2.3. Workbench - New look and feel</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/NewLookAndFeel.png" alt="Workbench - New look and feel"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="2.4.2. Various UI improvements"><div class="titlepage"><div><div><h3 class="title"><a id="d0e678"/>2.4.2. Various UI improvements</h3></div></div></div><p>In addition to the PatternFly update described above which targeted the general look and feel, many 
      individual components in the workbench have been improved to create a better user experience. This involved 
      making sure the default size of modal popup windows is appropriate to fit the corresponding content, adjusting
      the size of text fields as well as aligning labels, and improving the resize behaviour of various components 
      when used on smaller screens.
    </p><div class="figure"><a id="d0e683"/><p class="title"><strong>Figure 2.4. Workbench - Properly sized popup window</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/ModalPostPatternFly.png" alt="Workbench - Properly sized popup window"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e690"/><p class="title"><strong>Figure 2.5. Workbench - Properly sized text fields and aligned labels</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/LabelFieldAlignmentPostPatternFly.png" alt="Workbench - Properly sized text fields and aligned labels"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e697"/><p class="title"><strong>Figure 2.6. Workbench - Resized editor window with limited horizontal space</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/HorizonalAlignmentPostPatternFly.png" alt="Workbench - Resized editor window with limited horizontal space"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="2.4.3. New locales"><div class="titlepage"><div><div><h3 class="title"><a id="d0e704"/>2.4.3. New locales</h3></div></div></div><p>Locales <code class="literal">ru</code> (Russian) and <code class="literal">zh_TW</code> (Chineses Traditional) have now been added.</p><p>The locales now supported are:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Default English.</p></li><li class="listitem"><p><code class="literal">es</code> (Spanish)</p></li><li class="listitem"><p><code class="literal">fr</code> (French)</p></li><li class="listitem"><p><code class="literal">de</code> (German)</p></li><li class="listitem"><p><code class="literal">ja</code> (Japanese)</p></li><li class="listitem"><p><code class="literal">pt_BR</code> (Portuguese - Brazil)</p></li><li class="listitem"><p><code class="literal">zh_CN</code> (Chinese - Simplified)</p></li><li class="listitem"><p><code class="literal">zh_TW</code> (Chinese - Traditional)</p></li><li class="listitem"><p><code class="literal">ru</code> (Russian)</p></li></ul></div><p>
    </p></div><div class="section" title="2.4.4. Authoring - Imports - Consistent terminology"><div class="titlepage"><div><div><h3 class="title"><a id="d0e762"/>2.4.4. Authoring - Imports - Consistent terminology</h3></div></div></div><p>The Workbench used to have a section in the Project Editor for "Import Suggestions" which
      was really a way for Users to register classes provided by the Java Runtime environment to be
      available to Rule authoring. Furthermore Editors had a "Config" tab which was where Users were
      expected to import classes from other packages to that in which the rule resides.</p><p>Neither term was clear and both were inconsistent with each other and other aspects of the Workbench.</p><p>We have changed these terms to (hopefully) be clearer in their meaning and to be
      consistent with the "Data Object" term used in relation to authoring Java classes within the
      Workbench.</p><div class="figure"><a id="d0e771"/><p class="title"><strong>Figure 2.7. Project Editor - External Data Objects</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/ExternalDataObjects1.png" alt="Project Editor - External Data Objects"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e778"/><p class="title"><strong>Figure 2.8. Project Editor - Defining External Data Objects</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/ExternalDataObjects2.png" alt="Project Editor - Defining External Data Objects"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e785"/><p class="title"><strong>Figure 2.9. Asset Editors - Data Objects</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/DataObjects1.png" alt="Asset Editors - Data Objects"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e792"/><p class="title"><strong>Figure 2.10. Asset Editors - Defining Data Objects available for authoring</strong></p><div class="figure-contents"><p>The Data Object screen lists all Data Objects in the same package as the asset and allows other Data Objects from other packages to be imported.</p><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/DataObjects2.png" alt="Asset Editors - Defining Data Objects available for authoring"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="2.4.5. Disable automatic build"><div class="titlepage"><div><div><h3 class="title"><a id="d0e801"/>2.4.5. Disable automatic build</h3></div></div></div><p>When navigating Projects with the Project Explorer the workbench automatically builds the selected project, displaying build messages in the 
      Message Console. Whilst this is beneficial it can have a detremental impact on performance of the workbench when authoring large projects. The 
      automatic build can now be disabled with the <code class="code">org.kie.build.disable-project-explorer</code> System Property. Set the value 
      to <code class="code">true</code> to disable. The default value is <code class="code">false</code>.</p></div><div class="section" title="2.4.6. Support for SCP style git Repository URLs"><div class="titlepage"><div><div><h3 class="title"><a id="d0e815"/>2.4.6. Support for <code class="literal">SCP</code> style <code class="literal">git</code> Repository URLs</h3></div></div></div><p>When cloning <code class="literal">git</code> Repositories it is now possible to use <code class="literal">SCP</code> style URLS, for example <code class="literal">git@github.com:user/repository.git</code>. 
    If your Operating System's public keystore is password protected the passphrase can be provided with the <code class="literal">org.uberfire.nio.git.ssh.passphrase</code> System Property.</p></div><div class="section" title="2.4.7. Authoring - Duplicate GAV detection"><div class="titlepage"><div><div><h3 class="title"><a id="d0e838"/>2.4.7. Authoring - Duplicate GAV detection</h3></div></div></div><p>When performing any of the following operations a check is now made against all Maven Repositories, resolved for the Project, 
      for whether the Project's GroupId, ArtifactId and Version pre-exist. If a clash is found the operation is prevented; although this can be overridden by Users
      with the <code class="code">admin</code> role.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The feature can be disabled by setting the System Property <code class="code">org.guvnor.project.gav.check.disabled</code> to <code class="code">true</code>.</p></div><p>Resolved repositories are those discovered in:-
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The Project's <code class="code">POM</code> <code class="code">&lt;repositories&gt;</code> section (or any parent <code class="code">POM</code>).</p></li><li class="listitem"><p>The Project's <code class="code">POM</code> <code class="code">&lt;distributionManagement&gt;</code> section.</p></li><li class="listitem"><p>Maven's global <code class="code">settings.xml</code> configuration file.</p></li></ul></div><p>
    </p><p>Affected operations:-
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Creation of new Managed Repositories.</p></li><li class="listitem"><p>Saving a Project defintion with the Project Editor.</p></li><li class="listitem"><p>Adding new Modules to a Managed Multi-Module Repository.</p></li><li class="listitem"><p>Saving the <code class="code">pom.xml</code> file.</p></li><li class="listitem"><p>Build &amp; installing a Project with the Project Editor.</p></li><li class="listitem"><p>Build &amp; deploying a Project with the Project Editor.</p></li><li class="listitem"><p>Asset Management operations building, installing or deploying Projects.</p></li><li class="listitem"><p><code class="code">REST</code> operations creating, installing or deploying Projects.</p></li></ul></div><p>
    </p><p>Users with the <code class="code">Admin</code> role can override the list of Repositories checked using the "Repositories" settings in the Project Editor.</p><div class="figure"><a id="d0e924"/><p class="title"><strong>Figure 2.11. Project Editor - Viewing resolved Repositories</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/MavenRepositories1.png" alt="Project Editor - Viewing resolved Repositories"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e931"/><p class="title"><strong>Figure 2.12. Project Editor - The list of resolved Repositories</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/MavenRepositories2.png" alt="Project Editor - The list of resolved Repositories"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e938"/><p class="title"><strong>Figure 2.13. Duplicate GAV detected</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/MavenRepositories3.png" alt="Duplicate GAV detected"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="2.4.8. New Execution Server Management User Interface"><div class="titlepage"><div><div><h3 class="title"><a id="d0e945"/>2.4.8. New Execution Server Management User Interface</h3></div></div></div><p>The KIE Execution Server Management UI has been completely redesigned to adjust to major improvements introduced recently.
      Besides the fact that new UI has been built from scratch and following best practices provided by PatternFly,
      the new interface expands previous features giving users more control of their servers.
    </p><div class="figure"><a id="d0e950"/><p class="title"><strong>Figure 2.14. KIE Execution Server - New user interface</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/NewExecServerUI.png" alt="KIE Execution Server - New user interface"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="2.4.9.  User and group management"><div class="titlepage"><div><div><h3 class="title"><a id="d0e957"/>2.4.9.  User and group management</h3></div></div></div><p>Provides the backend services and an intuitive and friendly user interface that allows the
      workbench administrators to manage the application's users and groups. </p><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/UserAndGroupManagement.png"/></div></div><p>This interface provides to the workbench administrators the ability to perform realm related
      operations such as create users, create groups, assign groups or roles to a given user,
      etc.</p><p>It comes by default with built-in implementations for the administration of Wildfly, EAP
      and Tomcat default realms, and it's designed to be extensible - any third party realm
      management system can be easily integrated into the workbench.</p></div></div><div class="section" title="2.5. What is New and Noteworthy in Drools 6.3.0"><div class="titlepage"><div><div><h2 class="title"><a id="drools.ReleaseNotesDrools.6.3.0"/>2.5. What is New and Noteworthy in Drools 6.3.0</h2></div></div></div><div class="section" title="2.5.1. Browsing graphs of objects with OOPath"><div class="titlepage"><div><div><h3 class="title"><a id="d0e973"/>2.5.1. Browsing graphs of objects with OOPath</h3></div></div></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>This feature is experimental</p></div><p>When the field of a fact is a collection it is possible to bind and reason over
    all the items in that collection on by one using the <code class="literal">from</code> keyword.
    Nevertheless, when it is required to browse a graph of object the extensive use of the
    <code class="literal">from</code> conditional element may result in a verbose and cubersome syntax
    like in the following example:
    </p><div class="example"><a id="d0e987"/><p class="title"><strong>Example 2.1. Browsing a graph of objects with from</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Find all grades for Big Data exam" when
    $student: Student( $plan: plan )
    $exam: Exam( course == "Big Data" ) from $plan.exams
    $grade: Grade() from $exam.grades
then /* RHS */ end</code></pre></div></div><br class="example-break"/><p>In this example it has been assumed to use a domain model consisting of a
    <code class="literal">Student</code> who has a <code class="literal">Plan</code> of study: a <code class="literal">Plan</code>
    can have zero or more <code class="literal">Exam</code>s and an <code class="literal">Exam</code> zero or more
    <code class="literal">Grade</code>s. Note that only the root object of the graph (the <code class="literal">Student</code>
    in this case) needs to be in the working memory in order to make this works.</p><p>By borrowing ideas from XPath, this syntax can be made more succinct, as XPath has a
    compact notation for navigating through related elements while handling collections and
    filtering constraints. This XPath-inspired notation has been called <code class="literal">OOPath</code>
    since it is explictly intended to browse graph of objects. Using this notation the former
    example can be rewritten as it follows:
    </p><div class="example"><a id="d0e1020"/><p class="title"><strong>Example 2.2. Browsing a graph of objects with OOPath</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Find all grades for Big Data exam" when
    Student( $grade: /plan/exams{course == "Big Data"}/grades )
then /* RHS */ end</code></pre></div></div><br class="example-break"/><p>Formally, the core grammar of an <code class="literal">OOPath</code> expression can be defined in EBNF notation in this way.</p><pre><code class="no-highlight">OOPExpr = "/" OOPSegment { ( "/" | "." ) OOPSegment } ;
OOPSegment = [ID ( ":" | ":=" )] ID ["[" Number "]"] ["{" Constraints "}"];</code></pre><p>In practice an <code class="literal">OOPath</code> expression has the following features.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>It has to start with <code class="literal">/</code>.</p></li><li class="listitem"><p>It can dereference a single property of an object with the <code class="literal">.</code> operator</p></li><li class="listitem"><p>It can dereference a multiple property of an object using the <code class="literal">/</code> operator.
        If a collection is returned, it will iterate over the values in the collection</p></li><li class="listitem"><p>While traversing referenced objects it can filter away those not satisfying
        one or more constraints, written as predicate expressions between curly
        brackets like in:</p><pre><code class="no-highlight">Student( $grade: /plan/exams{course == "Big Data"}/grades )</code></pre></li><li class="listitem"><p>Items can also be accessed by their index by putting it between square brackets
        like in:</p><pre><code class="no-highlight">Student( $grade: /plan/exams[0]/grades )</code></pre><p>To adhere to Java convention OOPath indexes are 0-based, compared to XPath 1-based</p></li></ul></div><div class="section" title="2.5.1.1. Reactive OOPath"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1068"/>2.5.1.1. Reactive OOPath</h4></div></div></div><p>At the moment Drools is not able to react to updates involving a deeply nested traversed
      during the evaluation of an <code class="literal">OOPath</code> expression. To make these objects reactive
      to changes at the moment it is necessary to make them extend the class
      <code class="literal">org.drools.core.phreak.ReactiveObject</code>. It is planned to overcome this
      limitation by implementing a mechanism that automatically instruments the classes belonging
      to a specific domain model.</p><p>Having extendend that class, the domain objects can notify the engine when one of
      its field has been updated by invoking the inherited method <code class="literal">notifyModification</code>
      as in the following example:</p><div class="example"><a id="d0e1084"/><p class="title"><strong>Example 2.3. Notifying the engine that an exam has been moved to a different course</strong></p><div class="example-contents"><pre><code class="no-highlight">public void setCourse(String course) {
    this.course = course;
    notifyModification(this);
}</code></pre></div></div><br class="example-break"/><p>In this way if an exam is moved to a different course, the rule is
      re-triggered and the list of grades matching the rule recomputed.</p></div></div><div class="section" title="2.5.2. Kie Navigator View for Eclipse"><div class="titlepage"><div><div><h3 class="title"><a id="shared.ReleaseNotes.KieNavigator"/>2.5.2. Kie Navigator View for Eclipse</h3></div></div></div><p>A new viewer has been added to the Eclipse Tooling. This Kie Navigator View is used to manage Kie Server installations and projects.</p><p>Please read the chapter
    <span class="olink"><span class="command"><strong>Kie Navigator View</strong></span></span>
    for more information about this new feature</p></div></div><div class="section" title="2.6. New and Noteworthy in KIE Workbench 6.3.0"><div class="titlepage"><div><div><h2 class="title"><a id="wb.ReleaseNotesWorkbench.6.3.0.Final"/>2.6. New and Noteworthy in KIE Workbench 6.3.0</h2></div></div></div><div class="section" title="2.6.1. Real Time Validation and Verification for the Decision Tables"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1105"/>2.6.1. Real Time Validation and Verification for the Decision Tables</h3></div></div></div><p>Decision tables used to have a Validation-button for validating the table. This is now removed and the table is validated after each cell value change. The validation and verification checks include:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Redundancy</li><li class="listitem">Subsumption</li><li class="listitem">Conflicts</li><li class="listitem">Missing Columns</li></ul></div><p>These checks are explained in detail in the workbench documentation.</p></div><div class="section" title="2.6.2. Improved DRL Editor"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1121"/>2.6.2. Improved DRL Editor</h3></div></div></div><p>The DRL Editor has undergone a face lift; moving from a plain TextArea to using ACE Editor and a custom DRL syntax highlighter.</p><div class="figure"><a id="d0e1126"/><p class="title"><strong>Figure 2.15. ACE Editor</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/drl-ace-editor.png" alt="ACE Editor"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="2.6.3. Asset locking"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1133"/>2.6.3. Asset locking</h3></div></div></div><p>To avoid conflicts when editing assets, a new locking mechanism has been introduced that
      makes sure that only one user at a time can edit an asset. When a user begins to edit an
      asset, a lock will automatically be acquired. This is indicated by a lock symbol appearing on
      the asset title bar as well as in the project explorer view. If a user starts editing an
      already locked asset a pop-up notification will appear to inform the user that the asset can't
      currently be edited, as it is being worked on by another user. As long as the editing user
      holds the lock, changes by other users will be prevented. Locks will automatically be released
      when the editing user saves or closes the asset, or logs out of the workbench. Every user
      further has the option to force a lock release in the metadata tab, if required.</p><div class="figure"><a id="d0e1138"/><p class="title"><strong>Figure 2.16. Editing an asset automatically acquires a lock</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/DataModelEditingWithLock.png" alt="Editing an asset automatically acquires a lock"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e1145"/><p class="title"><strong>Figure 2.17. Locked assets cannot be edited by other users</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/DataModelLocked.png" alt="Locked assets cannot be edited by other users"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="2.6.4. Data Modeller Tool Windows"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1152"/>2.6.4. Data Modeller Tool Windows</h3></div></div></div><p>Drools and jBPM configurations, Persistence (see Generation of JPA enabled Data Models) and Advanced configurations were moved into "Tool Windows".
      "Tool Windows" are a new concept introduced in latest Uberfire version that enables the development of context aware screens.
      Each "Tool Window" will contain a domain editor that will manage a set of related Data Object parameters.
    </p><div class="figure"><a id="d0e1157"/><p class="title"><strong>Figure 2.18. Drools and jBPM domain tool window</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/DM-DroolsDomainToolWindow6.3.png" alt="Drools and jBPM domain tool window"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e1164"/><p class="title"><strong>Figure 2.19. Persistence tool window</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/DM-JPADomainToolWindow6.3.png" alt="Persistence tool window"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e1171"/><p class="title"><strong>Figure 2.20. Advanced configurations tool window</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/DM-AdvancedDomainToolWindow6.3.png" alt="Advanced configurations tool window"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="2.6.5. Generation of JPA enabled Data Models"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1178"/>2.6.5. Generation of JPA enabled Data Models</h3></div></div></div><p>Data modeller was extended to support the generation of persistable Data Objects.
      The persistable Data Objects are based on the JPA specification and all the underlying metadata are automatically generated.
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>"The New -&gt; Data Object" Data Objects can be marked as persistable at creation time.</p><div class="figure"><a id="d0e1187"/><p class="title"><strong>Figure 2.21. New Data Object</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/DM-NewDataObject6.3.png" alt="New Data Object"/></div></div></div></div><br class="figure-break"/></li><li class="listitem"><p>The Persistence tool window contains the JPA Domain editors for both Data Object and Field. Each editor will manage the by default generated JPA metadata</p><div class="figure"><a id="d0e1197"/><p class="title"><strong>Figure 2.22. Data Object level JPA domain editor</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/DM-DataObjectJPADomainTab6.3.png" alt="Data Object level JPA domain editor"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e1204"/><p class="title"><strong>Figure 2.23. Field level JPA domain editor</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/DM-FieldJPADomainTab6.3.png" alt="Field level JPA domain editor"/></div></div></div></div><br class="figure-break"/></li><li class="listitem"><p>Persistence configuration screen was added to the project editor.</p><div class="figure"><a id="d0e1214"/><p class="title"><strong>Figure 2.24. Persistence configuration</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/DM-Persistence-Configuration6.3.png" alt="Persistence configuration"/></div></div></div></div><br class="figure-break"/></li></ul></div></div><div class="section" title="2.6.6. Data Set Authoring"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1221"/>2.6.6. Data Set Authoring</h3></div></div></div><p>A new perspective for authoring data set definitions has been added. Data set definitions make it possible
      to retrieve data from external systems like databases, CSV/Excel files or even use a Java class to generate the data.
      Once the data is available it can be used, for instance, to create charts and dashboards from the Perspective Editor
      just feeding the charts from any of the data sets available.
    </p><div class="figure"><a id="d0e1226"/><p class="title"><strong>Figure 2.25. Data Sets Authoring Perspective</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/DataSetAuthoringPerspective.png" alt="Data Sets Authoring Perspective"/></div></div></div></div><br class="figure-break"/></div></div><div class="section" title="2.7. What is New and Noteworthy in Drools 6.2.0"><div class="titlepage"><div><div><h2 class="title"><a id="drools.ReleaseNotesDrools.6.2.0"/>2.7. What is New and Noteworthy in Drools 6.2.0</h2></div></div></div><div class="section" title="2.7.1. Propagation modes"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1236"/>2.7.1. Propagation modes</h3></div></div></div><p>The introduction of PHREAK as default algorithm for the Drools engine made the rules' evaluation
    lazy. This new Drools lazy behavior allowed a relevant performance boost but, in some very specific cases,
    breaks the semantic of a few Drools features.</p><p>More precisely in some circumstances it is necessary to propagate the insertion of new fact into th
    session immediately. For instance Drools allows a query to be executed in pull only (or passive) mode by
    prepending a '?' symbol to its invocation as in the following example:</p><div class="example"><a id="d0e1243"/><p class="title"><strong>Example 2.4. A passive query</strong></p><div class="example-contents"><pre><code class="language-java">query Q (Integer i)
    String( this == i.toString() )
end
rule R when
    $i : Integer()
    ?Q( $i; )
then
    System.out.println( $i );
end</code></pre></div></div><br class="example-break"/><p>In this case, since the query is passive, it shouldn't react to the insertion of a String
    matching the join condition in the query itself. In other words this sequence of commands</p><pre><code class="language-java">KieSession ksession = ...
ksession.insert(1);
ksession.insert("1");
ksession.fireAllRules();</code></pre><p>shouldn't cause the rule R to fire because the String satisfying the query condition has
    been inserted after the Integer and the passive query shouldn't react to this insertion.
    Conversely the rule should fire if the insertion sequence is inverted because the insertion
    of the Integer, when the passive query can be satisfied by the presence of an already existing
    String, will trigger it.</p><p>Unfortunately the lazy nature of PHREAK doesn't allow the engine to make any
    distinction regarding the insertion sequence of the two facts, so the rule will fire
    in both cases. In circumstances like this it is necessary to evaluate the rule eagerly as
    done by the old RETEOO-based engine.</p><p>In other cases it is required that the propagation is eager, meaning that it is not immedate,
    but anyway has to happen before the engine/agenda starts scheduled evaluations. For instance this
    is necessary when a rule has the no-loop or the lock-on-active attribute and in fact when this
    happens this propagation mode is automatically enforced by the engine.</p><p>To cover these use cases, and in all other situations where an immediate or eager rule
    evaluation is required, it is possible to declaratively specify so by annotating the rule
    itself with <span class="bold"><strong>@Propagation(Propagation.Type)</strong></span>, where
    Propagation.Type is an enumeration with 3 possible values:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>IMMEDIATE</strong></span> means that the propagation is performed immediately.</p></li><li class="listitem"><p><span class="bold"><strong>EAGER</strong></span> means that the propagation is performed lazily but
        eagerly evaluated before scheduled evaluations.</p></li><li class="listitem"><p><span class="bold"><strong>LAZY</strong></span> means that the propagation is totally lazy and this is
        default PHREAK behaviour</p></li></ul></div><p>This means that the following drl:</p><div class="example"><a id="d0e1281"/><p class="title"><strong>Example 2.5. A data-driven rule using a passive query</strong></p><div class="example-contents"><pre><code class="language-java">query Q (Integer i)
    String( this == i.toString() )
end
rule R @Propagation(IMMEDIATE) when
    $i : Integer()
    ?Q( $i; )
then
    System.out.println( $i );
end</code></pre></div></div><br class="example-break"/><p>will make the rule R to fire if and only if the Integer is inserted after the String, thus
    behaving in accordance with the semantic of the passive query.</p></div></div><div class="section" title="2.8. New and Noteworthy in KIE Workbench 6.2.0"><div class="titlepage"><div><div><h2 class="title"><a id="wb.ReleaseNotesWorkbench.6.2.0.Final"/>2.8. New and Noteworthy in KIE Workbench 6.2.0</h2></div></div></div><div class="section" title="2.8.1. Download Repository or Part of the Repository as a ZIP"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1291"/>2.8.1. Download Repository or Part of the Repository as a ZIP</h3></div></div></div><p>This feature makes it possible to download a repository or a folder from the repository as a ZIP file.</p><div class="figure"><a id="d0e1296"/><p class="title"><strong>Figure 2.26. Download current repository or project</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/zip_repo.png" alt="Download current repository or project"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e1303"/><p class="title"><strong>Figure 2.27. Download a folder</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/zip_folder.png" alt="Download a folder"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="2.8.2. Project Editor permissions"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1310"/>2.8.2. Project Editor permissions</h3></div></div></div><p>The ability to configure role-based permissions for the Project Editor have been added.</p><p>Permissions can be configured using the <code class="code">WEB-INF/classes/workbench-policy.properties</code> file.</p><p>The following permissions are supported:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Save button</p><p><code class="code">feature.wb_project_authoring_save</code></p></li><li class="listitem"><p>Delete button</p><p><code class="code">feature.wb_project_authoring_delete</code></p></li><li class="listitem"><p>Copy button</p><p><code class="code">feature.wb_project_authoring_copy</code></p></li><li class="listitem"><p>Rename button</p><p><code class="code">feature.wb_project_authoring_rename</code></p></li><li class="listitem"><p>Build &amp; Deploy button</p><p><code class="code">feature.wb_project_authoring_buildAndDeploy</code></p></li></ul></div><p>
    </p></div><div class="section" title="2.8.3. Unify validation style in Guided Decision Table Wizard."><div class="titlepage"><div><div><h3 class="title"><a id="d0e1354"/>2.8.3. Unify validation style in Guided Decision Table Wizard.</h3></div></div></div><p>All of our new screens use GWT-Bootstrap widgets and alert users to input errors in a consistent way.</p><p>One of the most noticable differences was the Guided Decision Table Wizard that alerted errors in a way inconsistent with our use of GWT-Bootstrap.</p><p>This Wizard has been updated to use the new look and feel.</p><div class="figure"><a id="d0e1363"/><p class="title"><strong>Figure 2.28. New Guided Decision Table Wizard validation</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/NewGuidedDecisionTableWizardValidation.png" alt="New Guided Decision Table Wizard validation"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="2.8.4. Improved Wizards"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1370"/>2.8.4. Improved Wizards</h3></div></div></div><p>During the re-work of the Guided Decision Table's Wizard to make it's validation
      consistent with other areas of the application we took the opportunity to move the Wizard
      Framework to GWT-Bootstrap too.</p><p>The resulting appearance is much more pleasing. We hope to migrate more legacy editors to
      GWT-Bootstrap as time and priorities permit.</p><div class="figure"><a id="d0e1377"/><p class="title"><strong>Figure 2.29. New Wizard Framework</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/NewGuidedDecisionTableWizard.png" alt="New Wizard Framework"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="2.8.5. Consistent behaviour of XLS, Guided Decision Tables and Guided Templates"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1384"/>2.8.5. Consistent behaviour of XLS, Guided Decision Tables and Guided Templates</h3></div></div></div><p>Consistency is a good thing for everybody. Users can expect different authoring metaphores to produce the same rule behaviour (and developers know when something is a bug!).</p><p>There were a few inconsistencies in the way XLS Decision Tables, Guidied Decision Tables and Guided Rule Templates generated the underlying rules for empty cells. These have been eliminated making their operation consistent.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If all constraints have null values (empty cells) the Pattern is not created.</p><p>Should you need the Pattern but no constraints; you will need to include the constraint <code class="code">this != null</code>.</p><p>This operation is consistent with how XLS and Guided Decision Tables have always worked.</p></li><li class="listitem"><p>You can define a constraint on a String field for an empty String or white-space by delimiting it with double-quotation marks. The enclosing quotation-marks are removed from the value when generating the rules.</p><p>The use of quotation marks for other String values is not required and they can be omitted. Their use is however essential to differentiate a constraint for an empty String from an empty cell - in which case the constraint is omitted.</p></li></ul></div></div><div class="section" title="2.8.6. Improved Metadata Tab"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1407"/>2.8.6. Improved Metadata Tab</h3></div></div></div><p>The Metadata tab provided in previous versions was redesigned to provide a better asset versioning information browsing and recovery. Now every workbench editor will provide an "Overview tab" that will enable the user to manage the following information.</p><div class="figure"><a id="d0e1412"/><p class="title"><strong>Figure 2.30. Improved Metadata Tab</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/ImprovedMetadataWidget.jpg" alt="Improved Metadata Tab"/></div></div></div></div><br class="figure-break"/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Versions history</p><p>The versions history shows a tabular view of the asset versions and provides a "Select" button that will enable the user to load a previously created version.</p><div class="figure"><a id="d0e1425"/><p class="title"><strong>Figure 2.31. Versions history</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/ImprovedVersionsHistory.jpg" alt="Versions history"/></div></div></div></div><br class="figure-break"/></li><li class="listitem"><p>Metadata</p><p>The metadata section gets access to additional file attributes.</p><div class="figure"><a id="d0e1437"/><p class="title"><strong>Figure 2.32. Metadata section</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/ImprovedMetadatSection.jpg" alt="Metadata section"/></div></div></div></div><br class="figure-break"/></li><li class="listitem"><p>Comments area</p><p>The redesigned comments area enables much clearer discussions on a file.</p></li><li class="listitem"><p>Version selection dropdown</p><p>The "Version selector dropdown" located at the menu bar provides the ability to load and restore previous versions from the "Editor tab", without having to open the "Overview tab" to load the "Version history".</p><div class="figure"><a id="d0e1454"/><p class="title"><strong>Figure 2.33. Version selection dropdown</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/ImprovedVersionsSelector.jpg" alt="Version selection dropdown"/></div></div></div></div><br class="figure-break"/></li></ul></div></div><div class="section" title="2.8.7. Improved Data Objects Editor"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1461"/>2.8.7. Improved Data Objects Editor</h3></div></div></div><p>The Java editor was unified to the standard workbench editors functioning. It means that
      and now every data object is edited on his own editor window.</p><div class="figure"><a id="d0e1466"/><p class="title"><strong>Figure 2.34. Improved Data Object Editor</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/NewJavaEditor.png" alt="Improved Data Object Editor"/></div></div></div></div><br class="figure-break"/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>"New -&gt; Data Object" option was added to create the data objects.</p></li><li class="listitem"><p>Overview tab was added for every file to manage the file metadata and have access to
          the file versions history.</p></li><li class="listitem"><p>Editable "Source Tab" tab was added. Now the Java code can be modified by
          administrators using the workbench. </p></li><li class="listitem"><p>"Editor" - "Source Tab" round trip is provided. This will let administrators to do manual changes on the generated Java code and go back to the editor tab to continue working.</p></li><li class="listitem"><p>Class usages detection. Whenever a Data Object is about to be deleted or renamed, the
          project will be scanned for the class usages. If usages are found (e.g. in drl files,
          decision tables, etc.) the user will receive an alert. This will prevent the user from
          breaking the project build.</p><div class="figure"><a id="d0e1489"/><p class="title"><strong>Figure 2.35. Usages detection</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/UsagesDetection.png" alt="Usages detection"/></div></div></div></div><br class="figure-break"/></li></ul></div></div><div class="section" title="2.8.8. Execution Server Management UI"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1496"/>2.8.8. Execution Server Management UI</h3></div></div></div><p>A new perspective called <span class="bold"><strong>Management</strong></span> has been added under
      <span class="bold"><strong>Servers</strong></span> top level menu. This perspective provides users the ability to
      manage multiple execution servers with multiple containers. Available features includes connect
      to already deployed execution servers; create new, start, stop, delete or upgrade containers.
    </p><div class="figure"><a id="d0e1507"/><p class="title"><strong>Figure 2.36. Management perspective</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/NewExecutionServerManagementPerspective.png" alt="Management perspective"/></div></div></div></div><br class="figure-break"/><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Current version of Execution Server just supports rule based execution.</p></div></div><div class="section" title="2.8.9. Social Activities"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1517"/>2.8.9. Social Activities</h3></div></div></div><p> A brand new feature called  <span class="bold"><strong>Social Activities</strong></span> has been added under a new top level menu item group called <span class="bold"><strong>Activity</strong></span>.</p><p> This new feature is divided in two different perspectives: <span class="bold"><strong>Timeline Perspective</strong></span>  and <span class="bold"><strong>People Perspective</strong></span>.</p><p>The <span class="bold"><strong>Timeline Perspective</strong></span> shows on left side the recent assets created or edited by the logged user. In the main window there is the "Latest Changes" screen, showing all the recent updated assets and an option to filter the recent updates by repository.</p><div class="figure"><a id="d0e1541"/><p class="title"><strong>Figure 2.37. Timeline Perspective</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/TimelinePerspective.png" alt="Timeline Perspective"/></div></div></div></div><br class="figure-break"/><p>The <span class="bold"><strong>People Perspective</strong></span> is the home page of an user. Showing his infos (including a gravatar picture from user e-mail), user connections (people that user follow) and user recent activities. There is also a way to edit an user info. The search suggestion can be used to navigate to a user profile, follow him and see his updates on your timeline.</p><div class="figure"><a id="d0e1553"/><p class="title"><strong>Figure 2.38. People Perspective</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/PeoplePerspective.png" alt="People Perspective"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e1560"/><p class="title"><strong>Figure 2.39. Edit User Info</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/PeoplePerspective1.png" alt="Edit User Info"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="2.8.10. Contributors Dashboard"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1567"/>2.8.10. Contributors Dashboard</h3></div></div></div><p>A brand new perspective called <span class="bold"><strong>Contributors</strong></span> has been added under
      a new top level menu item group called <span class="bold"><strong>Activity</strong></span>. The perspective itself
      is a dashboard which shows several indicators about the contributions made to the managed
      organizations / repositories within the workbench. Every time a organization/repository is added/removed
      from the workbench the dashboard itself is updated accordingly.</p><p>This new perspective allows for the monitoring of the underlying activity on
      the managed repositories.</p><div class="figure"><a id="d0e1580"/><p class="title"><strong>Figure 2.40. Contributors perspective</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/ContributorsPerspective.png" alt="Contributors perspective"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="2.8.11. Package selector"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1587"/>2.8.11. Package selector</h3></div></div></div><p>The location of new assets whilst authoring was driven by the context of the Project Explorer.</p><p>This has been replaced with a Package Selector in the New Resource Popup.</p><p>The location defaults to the Project Explorer context but different packages can now be
      more easily chosen.</p><div class="figure"><a id="d0e1596"/><p class="title"><strong>Figure 2.41. Package selector</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/PackageSelector.png" alt="Package selector"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="2.8.12. Improved visual consistency"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1603"/>2.8.12. Improved visual consistency</h3></div></div></div><p>All Popups have been refactored to use GWT-Bootstrap widgets.</p><p>Whilst a simple change it brings greater visual consistency to the application as a whole.</p><div class="figure"><a id="d0e1610"/><p class="title"><strong>Figure 2.42. Example Guided Decision Table Editor popup</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/GuidedDecisionTableNewPopup.png" alt="Example Guided Decision Table Editor popup"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e1617"/><p class="title"><strong>Figure 2.43. Example Guided Rule Editor popup</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/GuidedRuleNewPopup.png" alt="Example Guided Rule Editor popup"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="2.8.13. Guided Decision Tree Editor"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1624"/>2.8.13. Guided Decision Tree Editor</h3></div></div></div><p>A new editor has been added to support modelling of simple decision trees.</p><p>See the applicable section within the User Guide for more information about usage.</p><div class="figure"><a id="d0e1631"/><p class="title"><strong>Figure 2.44. Example Guided Decision Tree</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/GuidedDecisionTree1.png" alt="Example Guided Decision Tree"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="2.8.14. Create Repository Wizard"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1638"/>2.8.14. Create Repository Wizard</h3></div></div></div><p>A wizard has been created to guide the repository creation process. Now the user can
      decide at repository creation time if it should be a managed or unmanaged repository and
      configure all related parameters.</p><div class="figure"><a id="d0e1643"/><p class="title"><strong>Figure 2.45. Create Repository Wizard 1/2</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/CreateRepositoryWizard1.png" alt="Create Repository Wizard 1/2"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e1650"/><p class="title"><strong>Figure 2.46. Create Repository Wizard 2/2</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/CreateRepositoryWizard2.png" alt="Create Repository Wizard 2/2"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="2.8.15. Repository Structure Screen"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1657"/>2.8.15. Repository Structure Screen</h3></div></div></div><p>The new Repository Structure Screen will let users to manage the projects for a given repository, as well as
      other operations related to managed repositories like: branch creation, assets promotion and project release.</p><div class="figure"><a id="d0e1662"/><p class="title"><strong>Figure 2.47. Repository Structure Screen for a Managed Repository</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/ManagedRepositoryStructureScreen.png" alt="Repository Structure Screen for a Managed Repository"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e1669"/><p class="title"><strong>Figure 2.48. Repository Structure Screen for an Unmanaged Repository</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/UnManagedRepositoryStructureScreen.png" alt="Repository Structure Screen for an Unmanaged Repository"/></div></div></div></div><br class="figure-break"/></div></div><div class="section" title="2.9. New and Noteworthy in Integration 6.2.0"><div class="titlepage"><div><div><h2 class="title"><a id="kie.ReleaseNotesIntegration.6.2.0"/>2.9. New and Noteworthy in Integration 6.2.0</h2></div></div></div><div class="section" title="2.9.1. KIE Execution Server"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1679"/>2.9.1. KIE Execution Server</h3></div></div></div><p>A new KIE Execution Server was created with the goal of supporting the deployment of kjars
      and the automatic creation of REST endpoints for remote rules execution.  This initial
      implementation supports provisioning and execution of kjars via REST without any glue
      code.</p><p>A user interface was also integrated into the workbench for remote provisioning. See the
      workbench's New&amp;Noteworthy for details. </p><div class="figure"><a id="d0e1686"/><p class="title"><strong>Figure 2.49. Kie Server interface</strong></p><div class="figure-contents"><pre><code class="language-java">@Path("/server")
public interface KieServer {
    
    @GET
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response getInfo();
    
    @POST
    @Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response execute( CommandScript command );
    
    @GET
    @Path("containers")
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response listContainers();
    
    @GET
    @Path("containers/{id}")
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response getContainerInfo( @PathParam("id") String id );
    
    @PUT
    @Path("containers/{id}")
    @Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response createContainer( @PathParam("id") String id, KieContainerResource container );
    
    @DELETE
    @Path("containers/{id}")
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response disposeContainer( @PathParam("id") String id );
    
    @POST
    @Path("containers/{id}")
    @Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response execute( @PathParam("id") String id, String cmdPayload );
    
    @GET
    @Path("containers/{id}/release-id")
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response getReleaseId( @PathParam("id") String id);

    @POST
    @Path("containers/{id}/release-id")
    @Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response updateReleaseId( @PathParam("id") String id, ReleaseId releaseId );
    
    @GET
    @Path("containers/{id}/scanner")
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response getScannerInfo( @PathParam("id") String id );
    
    @POST
    @Path("containers/{id}/scanner")
    @Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response updateScanner( @PathParam("id") String id, KieScannerResource resource );
    
} 
</code></pre></div></div><br class="figure-break"/></div></div><div class="section" title="2.10. What is New and Noteworthy in Drools 6.1.0"><div class="titlepage"><div><div><h2 class="title"><a id="drools.ReleaseNotesDrools.6.1.0"/>2.10. What is New and Noteworthy in Drools 6.1.0</h2></div></div></div><div class="section" title="2.10.1. JMX support for KieScanner"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1694"/>2.10.1. JMX support for KieScanner</h3></div></div></div><p>Added support for JMX monitoring and management on KieScanner and KieContainer. To enable, set the
      property <code class="code">kie.scanner.mbeans</code> to <code class="code">enabled</code>, for example via Java command line: <code class="code"> -Dkie.scanner.mbeans=enabled </code>.</p><p>KieScannerMBean will register under the name:</p><p>It exposes the following properties:</p><p>
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Scanner Release Id:</strong></span> the release ID the scanner was configured with. May
            include maven range versions and special keywords like LATEST, SNAPSHOT, etc.</p></li><li class="listitem"><p><span class="bold"><strong>Current Release Id: </strong></span>the actual release ID the artifact resolved
            to.</p></li><li class="listitem"><p><span class="bold"><strong>Status:</strong></span> STARTING, SCANNING, UPDATING, RUNNING, STOPPED, SHUTDOWN</p></li></ul></div><p>
    </p><p>It also exposes the following operations:</p><p>
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>scanNow():</strong></span> forces an immediate scan of the maven repository looking for
            artifact updates</p></li><li class="listitem"><p><span class="bold"><strong>start():</strong></span> starts polling the maven repository for artifact updates based
            on the polling interval parameter</p></li><li class="listitem"><p><span class="bold"><strong>stop():</strong></span> stops automatically polling the maven repository</p></li></ul></div><p>
    </p></div></div><div class="section" title="2.11. New and Noteworthy in KIE Workbench 6.1.0"><div class="titlepage"><div><div><h2 class="title"><a id="wb.ReleaseNotesWorkbench.6.1.0"/>2.11. New and Noteworthy in KIE Workbench 6.1.0</h2></div></div></div><div class="section" title="2.11.1. Data Modeler - round trip and source code preservation"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1755"/>2.11.1. Data Modeler - round trip and source code preservation</h3></div></div></div><p>Full round trip between Data modeler and Java source code is now supported. No matter
      where the Java code was generated (e.g. Eclipse, Data modeller), data modeler will only
      update the necessary code blocks to maintain the model updated.</p></div><div class="section" title="2.11.2. Data Modeler - improved annotations"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1760"/>2.11.2. Data Modeler - improved annotations</h3></div></div></div><p>New annotations @TypeSafe, @ClassReactive, @PropertyReactive, @Timestamp, @Duration and
      @Expires were added in order enrich current Drools annotations manged by the data
      modeler.</p></div><div class="section" title="2.11.3. Standardization of the display of tabular data"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1765"/>2.11.3. Standardization of the display of tabular data</h3></div></div></div><p>We have standardized the display of tabular data with a new table widget.</p><p>The new table supports the following features: </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Selection of visible columns</p></li><li class="listitem"><p>Resizable columns</p></li><li class="listitem"><p>Moveable columns</p></li></ul></div><p>
    </p><div class="figure"><a id="d0e1783"/><p class="title"><strong>Figure 2.50. New table</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/new-grid.png" alt="New table"/></div></div></div></div><br class="figure-break"/><p>The table is used in the following scenarios: </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Inbox (Incoming changes)</p></li><li class="listitem"><p>Inbox (Recently edited)</p></li><li class="listitem"><p>Inbox (Recently opened)</p></li><li class="listitem"><p>Project Problems summary</p></li><li class="listitem"><p>Artifact Repository browser</p></li><li class="listitem"><p>Project Editor Dependency grid</p></li><li class="listitem"><p>Project Editor KSession grid</p></li><li class="listitem"><p>Project Editor Work Item Handlers Configuration grid</p></li><li class="listitem"><p>Project Editor Listeners Configuration grid</p></li><li class="listitem"><p>Search Results grid</p></li></ul></div><p>
    </p></div><div class="section" title="2.11.4. Generation of modify(x) {...} blocks"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1824"/>2.11.4. Generation of <code class="code">modify(x) {...}</code> blocks</h3></div></div></div><p>The Guided Rule Editor, Guided Template Editor and Guided Decision Table Editor have been
      changed to generate <code class="code">modify(x){...}</code></p><p>Historically these editors supported the older <code class="code">update(x)</code> syntax and hence
      rules created within the Workbench would not respond correctly to
        <code class="code">@PropertyReactive</code> and associated annotations within a model. This has now been
      rectified with the use of <code class="code">modify(x){...}</code> blocks.</p></div></div><div class="section" title="2.12. New and Noteworthy in KIE API 6.0.0"><div class="titlepage"><div><div><h2 class="title"><a id="kie.ReleaseNotesKIE.6.0.0"/>2.12. New and Noteworthy in KIE API 6.0.0</h2></div></div></div><div class="section" title="2.12.1. New KIE name"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1848"/>2.12.1. New KIE name</h3></div></div></div><p>KIE is the new umbrella name used to group together our related projects; as the family continues to grow. KIE
      is also used for the generic parts of unified API; such as building, deploying and loading. This replaces the
      droolsjbpm and knowledge keywords that would have been used before. </p><div class="figure"><a id="d0e1853"/><p class="title"><strong>Figure 2.51. KIE Anatomy</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/Overview/kie.png" alt="KIE Anatomy"/></div></div></div><br class="figure-break"/></div><div class="section" title="2.12.2. Maven aligned projects and modules and Maven Deployment"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1859"/>2.12.2. Maven aligned projects and modules and Maven Deployment</h3></div></div></div><p>One of the biggest complaints during the 5.x series was the lack of defined methodology for deployment. The
      mechanism used by Drools and jBPM was very flexible, but it was too flexible. A big focus for 6.0 was streamlining
      the build, deploy and loading (utilization) aspects of the system. Building and deploying activities are now aligned
      with Maven and Maven repositories. The utilization for loading rules and processess is now convention and configuration oriented,
      instead of programmatic, with sane defaults to minimise the configuration.</p><p>Projects can be built with Maven and installed to the local M2_REPO or remote Maven repositories. Maven is
      then used to declare and build the classpath of dependencies, for KIE to access.</p></div><div class="section" title="2.12.3. Configuration and convention based projects"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1866"/>2.12.3. Configuration and convention based projects</h3></div></div></div><p>The 'kmodule.xml' provides declarative configuration for KIE projects. Conventions and defaults are used to
      reduce the amount of configuration needed. </p><div class="example"><a id="d0e1871"/><p class="title"><strong>Example 2.6. Declare KieBases and KieSessions</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"&gt;
  &lt;kbase name="kbase1" packages="org.mypackages"&gt;
    &lt;ksession name="ksession1"/&gt;
  &lt;/kbase&gt;
&lt;/kmodule&gt;</code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e1876"/><p class="title"><strong>Example 2.7. Utilize the KieSession</strong></p><div class="example-contents"><pre><code class="language-java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.getKieClasspathContainer();

KieSession kSession = kContainer.newKieSession("ksession1");
kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
kSession.fireAllRules();</code></pre></div></div><br class="example-break"/></div><div class="section" title="2.12.4. KieBase Inclusion"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1881"/>2.12.4. KieBase Inclusion</h3></div></div></div><p>It is possible to include all the KIE artifacts belonging to a KieBase into a second KieBase. This means that
      the second KieBase, in addition to all the rules, function and processes directly defined into it,  will also contain the
      ones created in the included KieBase. This inclusion can be done declaratively in the kmodule.xml file</p><div class="example"><a id="d0e1886"/><p class="title"><strong>Example 2.8. Including a KieBase into another declaratively</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"&gt;
  &lt;kbase name="kbase2" includes="kbase1"&gt;
    &lt;ksession name="ksession2"/&gt;
  &lt;/kbase&gt;
&lt;/kmodule&gt;</code></pre></div></div><br class="example-break"/><p>or programmatically using the <code class="code">KieModuleModel</code>.</p><div class="example"><a id="d0e1896"/><p class="title"><strong>Example 2.9. Including a KieBase into another programmatically</strong></p><div class="example-contents"><pre><code class="language-java">KieModuleModel kmodule = KieServices.Factory.get().newKieModuleModel();
KieBaseModel kieBaseModel1 = kmodule.newKieBaseModel("KBase2").addInclude("KBase1");</code></pre></div></div><br class="example-break"/></div><div class="section" title="2.12.5. KieModules, KieContainer and KIE-CI"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1901"/>2.12.5. KieModules, KieContainer and KIE-CI</h3></div></div></div><p>Any Maven produced JAR with a 'kmodule.xml' in it is considered a KieModule. This can be loaded from the
      classpath or dynamically at runtime from a Resource location. If the kie-ci dependency is on the classpath it
      embeds Maven and all resolving is done automatically using Maven and can access local or remote repositories.
      Settings.xml is obeyed for Maven configuration.</p><p>The KieContainer provides a runtime to utilize the KieModule, versioning is built in throughout, via Maven.
      Kie-ci will create a classpath dynamically from all the Maven declared dependencies for the artifact being loaded.
      Maven LATEST, SNAPSHOT, RELEASE and version ranges are supported.</p><div class="example"><a id="d0e1908"/><p class="title"><strong>Example 2.10. Utilize and Run - Java</strong></p><div class="example-contents"><pre><code class="language-java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.newKieContainer(
        ks.newReleaseId("org.mygroup", "myartefact", "1.0") );

KieSession kSession = kContainer.newKieSession("ksession1");
kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
kSession.fireAllRules();</code></pre></div></div><br class="example-break"/><p>KieContainers can be dynamically updated to a specific version, and resolved through Maven if KIE-CI is on the
      classpath. For stateful KieSessions the existing sessions are incrementally updated.</p><div class="example"><a id="d0e1915"/><p class="title"><strong>Example 2.11. Dynamically Update - Java</strong></p><div class="example-contents"><pre><code class="language-java">KieContainer kContainer.updateToVersion(
                ks.newReleaseId("org.mygroup", "myartefact", "1.1") );</code></pre></div></div><br class="example-break"/></div><div class="section" title="2.12.6. KieScanner"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1920"/>2.12.6. KieScanner</h3></div></div></div><p>The <code class="code">KieScanner</code> is a Maven-oriented replacement of the KnowledgeAgent
    present in Drools 5. It continuously monitors your Maven repository
    to check if a new release of a Kie project has been installed and if so, deploys it in
    the <code class="code">KieContainer</code> wrapping that project. The use of the <code class="code">KieScanner</code>
    requires kie-ci.jar to be on the classpath.</p><p>A <code class="code">KieScanner</code> can be registered on a <code class="code">KieContainer</code>
    as in the following example.</p><div class="example"><a id="d0e1942"/><p class="title"><strong>Example 2.12. Registering and starting a KieScanner on a KieContainer</strong></p><div class="example-contents"><pre><code class="language-java">KieServices kieServices = KieServices.Factory.get();
ReleaseId releaseId = kieServices.newReleaseId( "org.acme", "myartifact", "1.0-SNAPSHOT" );
KieContainer kContainer = kieServices.newKieContainer( releaseId );
KieScanner kScanner = kieServices.newKieScanner( kContainer );

// Start the KieScanner polling the Maven repository every 10 seconds
kScanner.start( 10000L );</code></pre></div></div><br class="example-break"/><p>In this example the <code class="code">KieScanner</code> is configured to run with a fixed
    time interval, but it is also possible to run it on demand by invoking the
    <code class="code">scanNow()</code> method on it. If the <code class="code">KieScanner</code> finds, in the
    Maven repository, an updated version of the Kie project used by that <code class="code">KieContainer</code>
    it automatically downloads the new version and triggers an incremental build of the new
    project. From this moment all the new <code class="code">KieBase</code>s and <code class="code">KieSession</code>s
    created from that <code class="code">KieContainer</code> will use the new project version.</p></div><div class="section" title="2.12.7. Hierarchical ClassLoader"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1970"/>2.12.7. Hierarchical ClassLoader</h3></div></div></div><p>The CompositeClassLoader is no longer used; as it was a constant source of performance problems and bugs.
      Traditional hierarchical classloaders are now used. The root classloader is at the KieContext level, with
      one child ClassLoader per namespace. This makes it cleaner to add and remove rules, but there can now be no
      referencing between namespaces in DRL files; i.e. functions can only be used by the namespaces that declared them.
      The recommendation is to use static Java methods in your project, which is visible to all namespaces; but those
      cannot (like other classes on the root KieContainer ClassLoader) be dynamically updated.</p></div><div class="section" title="2.12.8. Legacy API Adapter"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1975"/>2.12.8. Legacy API Adapter</h3></div></div></div><p>The 5.x API for building and running with Drools and jBPM is still available through Maven dependency
      "knowledge-api-legacy5-adapter". Because the nature of deployment has significantly changed in 6.0, it was not
      possible to provide an adapter bridge for the KnowledgeAgent. If any other methods are missing or problematic,
      please open a JIRA, and we'll fix for 6.1</p></div><div class="section" title="2.12.9. KIE Documentation"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1980"/>2.12.9. KIE Documentation</h3></div></div></div><p> While a lot of new documentation has been added for working with the new KIE API, the entire documentation
      has not yet been brought up to date. For this reason there will be continued references to old terminologies.
      Apologies in advance, and thank you for your patience. We hope those in the community will work with us to get the
      documentation updated throughout, for 6.1</p></div></div><div class="section" title="2.13. What is New and Noteworthy in Drools 6.0.0"><div class="titlepage"><div><div><h2 class="title"><a id="drools.ReleaseNotesDrools.6.0.0"/>2.13. What is New and Noteworthy in Drools 6.0.0</h2></div></div></div><div class="section" title="2.13.1. PHREAK - Lazy rule matching algorithm"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1988"/>2.13.1. PHREAK - Lazy rule matching algorithm</h3></div></div></div><p>The main work done for Drools in 6.0 involves the new PREAK algorithm. This is a lazy algorithm that should
      enable Drools to handle a larger number of rules and facts. AngendaGroups can now help improvement performance, as
      rules are not evaluated until it attempts to fire them.</p><p>Sequential mode continues to be supported for PHREAK but now 'modify' is allowed. While there is no
      'inference' with sequential configuration,  as rules are lazily evaluated, any rule not yet evaluated will see the
      more recent data as a result of 'modify'. This is more inline with how people intuitively think sequential
      works.</p><p>The conflict resolution order has been tweaked for PHREAK, and now is ordered by salience and then rule order;
      based on the rule position in the file.. Prior to Drools 6.0.0, after salience, it was considered arbitrary. When
      KieModules and updateToVersion are used for dynamic deployment, the rule order in the file is preserved via the
      diff processing.</p></div><div class="section" title="2.13.2. Automatically firing timed rule in passive mode"><div class="titlepage"><div><div><h3 class="title"><a id="d0e1997"/>2.13.2. Automatically firing timed rule in passive mode</h3></div></div></div><p>When the rule engine runs in passive mode (i.e.: using fireAllRules)
    by default it doesn't fire consequences of timed rules unless fireAllRules isn't invoked again.
    Now it is possible to change this default behavior by configuring the KieSession
    with a <code class="code">TimedRuleExectionOption</code> as shown in the following example.</p><div class="example"><a id="d0e2005"/><p class="title"><strong>Example 2.13. Configuring a KieSession to automatically execute timed rules</strong></p><div class="example-contents"><pre><code class="language-java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
ksconf.setOption( TimedRuleExectionOption.YES );
KSession ksession = kbase.newKieSession(ksconf, null);</code></pre></div></div><br class="example-break"/><p>It is also possible to have a finer grained control on the timed rules that have to be
    automatically executed. To do this it is necessary to set a <code class="code">FILTERED</code>
    <code class="code">TimedRuleExectionOption</code> that allows to define a callback to filter those
    rules, as done in the next example.</p><div class="example"><a id="d0e2018"/><p class="title"><strong>Example 2.14. Configuring a filter to choose which timed rules should be automatically executed</strong></p><div class="example-contents"><pre><code class="language-java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
conf.setOption( new TimedRuleExectionOption.FILTERED(new TimedRuleExecutionFilter() {
    public boolean accept(Rule[] rules) {
        return rules[0].getName().equals("MyRule");
    }
}) );</code></pre></div></div><br class="example-break"/></div><div class="section" title="2.13.3. Expression Timers"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2023"/>2.13.3. Expression Timers</h3></div></div></div><p>It is now possible to define both the delay and interval of an interval timer
    as an expression instead of a fixed value. To do that it is necessary to declare
    the timer as an expression one (indicated by "expr:") as in the following example:</p><div class="example"><a id="d0e2028"/><p class="title"><strong>Example 2.15. An Expression Timer Example</strong></p><div class="example-contents"><pre><code class="language-java">declare Bean
    delay   : String = "30s"
    period  : long = 60000
end

rule "Expression timer"
    timer( expr: $d, $p )
when
    Bean( $d : delay, $p : period )
then
end</code></pre></div></div><br class="example-break"/><p>The expressions, $d and $p in this case, can use any variable defined in the
    pattern matching part of the rule and can be any String that can be parsed in a time
    duration or any numeric value that will be internally converted in a long representing
    a duration expressed in milliseconds.</p><p>Both interval and expression timers can have 3 optional parameters named
    "start", "end" and "repeat-limit". When one or more of these parameters are used the first
    part of the timer definition must be followed by a semicolon ';' and the parameters have
    to be separated by a comma ',' as in the following example:</p><div class="example"><a id="d0e2037"/><p class="title"><strong>Example 2.16. An Interval Timer with a start and an end</strong></p><div class="example-contents"><pre><code class="language-java">timer (int: 30s 10s; start=3-JAN-2010, end=5-JAN-2010)</code></pre></div></div><br class="example-break"/><p>The value for start and end parameters can be a Date, a String representing
    a Date or a long, or more in general any Number, that will be transformed in a Java Date
    applying the following conversion:</p><pre><code class="language-java">new Date( ((Number) n).longValue() )</code></pre><p>Conversely the repeat-limit can be only an integer and it defines the maximum
    number of repetitions allowed by the timer. If both the end and the repeat-limit parameters
    are set the timer will stop when the first of the two will be matched.</p><p>The using of the start parameter implies the definition of a phase for the timer,
    where the beginning of the phase is given by the start itself plus the eventual delay.
    In other words in this case the timed rule will then be scheduled at times:</p><pre><code class="language-java">start + delay + n*period</code></pre><p>for up to repeat-limit times and no later than the end timestamp (whichever first).
    For instance the rule having the following interval timer</p><pre><code class="language-java">timer ( int: 30s 1m; start="3-JAN-2010" )</code></pre><p>will be scheduled at the 30th second of every minute after the midnight of the
    3-JAN-2010. This also means that if for example you turn the system on at midnight of
    the 3-FEB-2010 it won't be scheduled immediately but will preserve the phase defined by
    the timer and so it will be scheduled for the first time 30 seconds after the midnight.
    If for some reason the system is paused (e.g. the session is serialized and then deserialized
    after a while) the rule will be scheduled only once to recover from missing activations
    (regardless of how many activations we missed) and subsequently it will be scheduled
    again in phase with the timer.</p></div><div class="section" title="2.13.4. RuleFlowGroups and AgendaGroups are merged"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2058"/>2.13.4. RuleFlowGroups and AgendaGroups are merged</h3></div></div></div><p>These two groups have been merged and now RuleFlowGroups behave the same as AgendaGroups. The get methods
      have been left, for deprecation reasons, but both return the same underlying data. When jBPM activates a group it
      now just calls setFocus. RuleFlowGroups and AgendaGroups when used together was a continued source of errors. It
      also aligns the codebase, towards PHREAK and the multi-core explotation that is planned in the future.</p></div></div><div class="section" title="2.14. New and Noteworthy in KIE Workbench 6.0.0"><div class="titlepage"><div><div><h2 class="title"><a id="wb.ReleaseNotesWorkbench.6.0.0"/>2.14. New and Noteworthy in KIE Workbench 6.0.0</h2></div></div></div><p>The workbench has had a big overhaul using a new base project called UberFire. UberFire is inspired by Eclipse
    and provides a clean, extensible and flexible framework for the workbench. The end result is not only a richer
    experience for our end users, but we can now develop more rapidly with a clean component based architecture. If you
    like he Workbench experience you can use UberFire today to build your own web based dashboard and console
    efforts.</p><p>As well as the move to a UberFire the other biggest change is the move from JCR to Git; there is an utility
    project to help with migration. Git is the most scalable and powerful source repository bar none. JGit provides a
    solid OSS implementation for Git. This addresses the continued performance problems with the various JCR
    implementations, which would slow down once the number of files and number of versions become too high. There has
    been a big "low tech" drive, to remove complexity. Everything is now stored as a file, including meta data. The
    database is only there to provide fast indexing and search. So importing and exporting is all standard Git and
    external sites, like GitHub, can be used to exchange repositories. </p><p>In 5.x developers would work with their own source repository and then push JCR, via the team provider. This
    team provider was not full featured and not available outside Eclipse. Git enables our repository to work any
    existing Git tool or team provider. While not yet supported in the UI,  this will be added over time, it is possible
    to connect to the repo and tag and branch and restore things.</p><div class="figure"><a id="d0e2073"/><p class="title"><strong>Figure 2.52. Workbench</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/ReleaseNotes/kie-drools-wb.png" align="middle" alt="Workbench"/></div></div></div><br class="figure-break"/><p>The Guvnor brand leaked too much from its intended role; such as the authoring metaphors, like Decision Tables,
    being considered Guvnor components instead of Drools components. This wasn't helped by the monolithic projects
    structure used in 5.x for Guvnor. In 6.0 Guvnor 's focus has been narrowed to encapsulates the set of UberFire
    plugins that provide the basis for building a web based IDE. Such as Maven integration for building and deploying,
    management of Maven repositories and activity notifications via inboxes. Drools and jBPM build workbench
    distributions using Uberfire as the base and including a set of plugins, such as Guvnor, along with their own
    plugins for things like decision tables, guided editors, BPMN2 designer, human tasks. </p><p>The "Model Structure" diagram outlines the new project anatomy. The Drools workbench is called KIE-Drools-WB.
    KIE-WB is the uber workbench that combines all the Guvnor, Drools and jBPM plugins. The jBPM-WB is ghosted out, as
    it doesn't actually exist, being made redundant by KIE-WB.</p><div class="figure"><a id="d0e2083"/><p class="title"><strong>Figure 2.53. Module Structure</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/ReleaseNotes/kie-structure.png" align="middle" alt="Module Structure"/></div></div></div><br class="figure-break"/><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>KIE Drools Workbench and KIE Workbench share a common set of components for generic workbench functionality
      such as Project navigation, Project definitions, Maven based Projects, Maven Artifact Repository. These common
      features are described in more detail throughout this documentation.</p></div><p/><p>The two primary distributions consist of:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>KIE Drools Workbench</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Drools Editors, for rules and supporting assets.</p></li><li class="listitem"><p>jBPM Designer, for Rule Flow and supporting assets.</p></li></ul></div></li><li class="listitem"><p>KIE Workbench</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Drools Editors, for rules and supporting assets.</p></li><li class="listitem"><p>jBPM Designer, for BPMN2 and supporting assets.</p></li><li class="listitem"><p>jBPM Console, runtime and Human Task support.</p></li><li class="listitem"><p>jBPM Form Builder.</p></li><li class="listitem"><p>BAM.</p></li></ul></div></li></ul></div><p>Workbench highlights:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>New flexible Workbench environment, with perspectives and panels.</p></li><li class="listitem"><p>New packaging and build system following KIE API.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Maven based projects.</p></li><li class="listitem"><p>Maven Artifact Repository replaces Global Area, with full dependency support.</p></li></ul></div></li><li class="listitem"><p>New Data Modeller replaces the declarative Fact Model Editor; bringing authoring of Java classes to the
          authoring environment. Java classes are packaged into the project and can be used within rules, processes etc
          and externally in your own applications.</p></li><li class="listitem"><p>Virtual File System replaces JCR with a default Git based implementation.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Default Git based implementation supports remote operations.</p></li><li class="listitem"><p>External modifications appear within the Workbench.</p></li></ul></div></li><li class="listitem"><p>Incremental Build system showing, near real-time validation results of your project and assets.</p></li></ul></div><p> The editors themselves are largely unchanged; however of note imports have moved from the package
    definition to individual editors so you need only import types used for an asset and not the package as a
    whole.</p></div><div class="section" title="2.15. New and Noteworthy in Integration 6.0.0"><div class="titlepage"><div><div><h2 class="title"><a id="kie.ReleaseNotesIntegration.6.0.0"/>2.15. New and Noteworthy in Integration 6.0.0</h2></div></div></div><div class="section" title="2.15.1. CDI"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2161"/>2.15.1. CDI</h3></div></div></div><p>CDI is now tightly integrated into the KIE API. It can be used to inject versioned KieSession and KieBases.</p><div class="figure"><a id="d0e2166"/><p class="title"><strong>Figure 2.54. Side by side version loading for 'jar1.KBase1' KieBase</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KSession("kbase1") 
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.0")
private KieBase kbase1v10;

@Inject
@KBase("kbase1") 
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.1")
private KieBase kbase1v10;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e2171"/><p class="title"><strong>Figure 2.55. Side by side version loading for 'jar1.KBase1' KieBase</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KSession("ksession1") 
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.0")
private KieSession ksessionv10;

@Inject
@KSession("ksession1") 
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.1")
private KieSession ksessionv11;</code></pre></div></div><br class="figure-break"/></div><div class="section" title="2.15.2. Spring"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2176"/>2.15.2. Spring</h3></div></div></div><p>Spring has been revamped and now integrated with KIE. Spring can replace the 'kmodule.xml' with a more
      powerful spring version. The aim is for consistency with kmodule.xml</p></div><div class="section" title="2.15.3. Aries Blueprints"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2181"/>2.15.3. Aries Blueprints</h3></div></div></div><p>Aries blueprints is now also supported, and follows the work done for spring. The aim is for consistency with
      spring and kmodule.xml</p></div><div class="section" title="2.15.4. OSGi Ready"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2186"/>2.15.4. OSGi Ready</h3></div></div></div><p>All modules have been refactored to avoid package splitting, which was a problem in 5.x.
      Testing has been moved to PAX.</p></div></div></div><div class="chapter" title="Chapter 3. Compatibility matrix"><div class="titlepage"><div><div><h2 class="title"><a id="compatibilityMatrix"/>Chapter 3. Compatibility matrix</h2></div></div></div><p>Starting from KIE 6.0, Drools (including workbench), jBPM (including designer and console)
  and OptaPlanner follow the same version numbering.</p></div></div><div class="part" title="Part II. KIE"><div class="titlepage"><div><div><h1 class="title"><a id="d0e2196"/>Part II. KIE</h1></div></div></div><div class="partintro" title="KIE"><div/><p>KIE is the shared core for Drools and jBPM. It provides a unified methodology and programming model for
        building, deploying and utilizing resources.</p><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="chapter"><a href="#KIEChapter">4. KIE</a></span></dt><dd><dl><dt><span class="section"><a href="#KIEOverviewSection">4.1. Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#KIEAnatomySection">4.1.1. Anatomy of Projects</a></span></dt><dt><span class="section"><a href="#KIELifeCyclesSection">4.1.2. Lifecycles</a></span></dt></dl></dd><dt><span class="section"><a href="#BuildDeployUtilizeAndRunSection">4.2. Build, Deploy, Utilize and Run</a></span></dt><dd><dl><dt><span class="section"><a href="#KIEModuleIntroductionBuildingIntroductionSection">4.2.1. Introduction</a></span></dt><dt><span class="section"><a href="#KIEBuildingSection">4.2.2. Building</a></span></dt><dt><span class="section"><a href="#KIEDeployingSection">4.2.3. Deploying</a></span></dt><dt><span class="section"><a href="#KIERunningSection">4.2.4. Running</a></span></dt><dt><span class="section"><a href="#KIEDeployCheatSheets">4.2.5. Installation and Deployment Cheat Sheets</a></span></dt><dt><span class="section"><a href="#KIEExamplesSection">4.2.6. Build,  Deploy and Utilize Examples</a></span></dt></dl></dd><dt><span class="section"><a href="#KIESecuritySection">4.3. Security</a></span></dt><dd><dl><dt><span class="section"><a href="#SecurityManager">4.3.1. Security Manager</a></span></dt></dl></dd></dl></dd></dl></div></div><div class="chapter" title="Chapter 4. KIE"><div class="titlepage"><div><div><h2 class="title"><a id="KIEChapter"/>Chapter 4. KIE</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#KIEOverviewSection">4.1. Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#KIEAnatomySection">4.1.1. Anatomy of Projects</a></span></dt><dt><span class="section"><a href="#KIELifeCyclesSection">4.1.2. Lifecycles</a></span></dt></dl></dd><dt><span class="section"><a href="#BuildDeployUtilizeAndRunSection">4.2. Build, Deploy, Utilize and Run</a></span></dt><dd><dl><dt><span class="section"><a href="#KIEModuleIntroductionBuildingIntroductionSection">4.2.1. Introduction</a></span></dt><dt><span class="section"><a href="#KIEBuildingSection">4.2.2. Building</a></span></dt><dt><span class="section"><a href="#KIEDeployingSection">4.2.3. Deploying</a></span></dt><dt><span class="section"><a href="#KIERunningSection">4.2.4. Running</a></span></dt><dt><span class="section"><a href="#KIEDeployCheatSheets">4.2.5. Installation and Deployment Cheat Sheets</a></span></dt><dt><span class="section"><a href="#KIEExamplesSection">4.2.6. Build,  Deploy and Utilize Examples</a></span></dt></dl></dd><dt><span class="section"><a href="#KIESecuritySection">4.3. Security</a></span></dt><dd><dl><dt><span class="section"><a href="#SecurityManager">4.3.1. Security Manager</a></span></dt></dl></dd></dl></div><div class="section" title="4.1. Overview"><div class="titlepage"><div><div><h2 class="title"><a id="KIEOverviewSection"/>4.1. Overview</h2></div></div></div><div class="section" title="4.1.1. Anatomy of Projects"><div class="titlepage"><div><div><h3 class="title"><a id="KIEAnatomySection"/>4.1.1. Anatomy of Projects</h3></div></div></div><p>The process of researching an integration knowledge solution for Drools and jBPM has simply
    used the "droolsjbpm" group name. This name permeates GitHub accounts and Maven POMs. As
    scopes broadened and new projects were spun KIE, an acronym for Knowledge Is Everything, was
    chosen as the new group name.  The KIE name is also used for the shared aspects of the system;
    such as the unified build, deploy and utilization.</p><p>KIE currently consists of the following subprojects:</p><div class="figure"><a id="d0e2215"/><p class="title"><strong>Figure 4.1. KIE Anatomy</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/Overview/kie.png" alt="KIE Anatomy"/></div></div></div><br class="figure-break"/><p>OptaPlanner, a local search and optimization tool, has been spun off from Drools Planner and
    is now a top level project with Drools and jBPM. This was a natural evolution as Optaplanner,
    while having strong Drools integration, has long been independant of Drools. </p><p>From the Polymita acquisition, along with other things, comes the powerful Dashboard Builder
    which provides powerful reporting capabilities. Dashboard Builder is currently a temporary name
    and after the 6.0 release a new name will be chosen. Dashboard Builder is completely
    independant of Drools and jBPM and will be used by many projects at JBoss, and hopefully
    outside of JBoss :)</p><p>UberFire is the new base workbench project, spun off from the ground up rewrite. UberFire
    provides Eclipse-like workbench capabilities, with panels and perspectives from plugins. The
    project is independant of Drools and jBPM and anyone can use it as a basis of building
    flexible and powerful workbenches. UberFire will be used for console and workbench development
    throughout JBoss.</p><p>It was determined that the Guvnor brand leaked too much from its intended role; such as the authoring
    metaphors, like Decision Tables, being considered Guvnor components instead of Drools components. This wasn't
    helped by the monolithic projects structure used in 5.x for Guvnor. In 6.0 Guvnor's focus has been narrowed to
    encapsulate the set of UberFire plugins that provide the basis for building a web based IDE. Such as Maven
    integration for building and deploying, management of Maven repositories and activity notifications via inboxes.
    Drools and jBPM build workbench distributions using Uberfire as the base and including a set of plugins, such as
    Guvnor, along with their own plugins for things like decision tables, guided editors, BPMN2 designer, human tasks.
    The Drools workbench is called Drools-WB. KIE-WB is the uber workbench that combined all the Guvnor, Drools and jBPM
    plugins. The jBPM-WB is ghosted out, as it doesn't actually exist, being made redundant by KIE-WB.</p><p/></div><div class="section" title="4.1.2. Lifecycles"><div class="titlepage"><div><div><h3 class="title"><a id="KIELifeCyclesSection"/>4.1.2. Lifecycles</h3></div></div></div><p>The different aspects, or life cycles, of working with KIE system, whether it's Drools or
    jBPM, can typically be broken down into the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Author</strong></span>
        </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Authoring of knowledge using a UI metaphor, such as: DRL, BPMN2, decision table,
              class models.</p></li></ul></div></li><li class="listitem"><p><span class="bold"><strong>Build</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Builds the authored knowledge into deployable units. </p></li><li class="listitem"><p>For KIE this unit is a JAR.</p></li></ul></div></li><li class="listitem"><p><span class="bold"><strong>Test</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Test KIE knowedge before it's deployed to the application.</p></li></ul></div></li><li class="listitem"><p><span class="bold"><strong>Deploy</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Deploys the unit to a location where applications may utilize (consume)
            them.</p></li><li class="listitem"><p>KIE uses Maven style repository.</p></li></ul></div></li><li class="listitem"><p><span class="bold"><strong>Utilize</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The loading of a JAR to provide a KIE session (KieSession), for which the
            application can interact with.</p></li><li class="listitem"><p>KIE exposes the JAR at runtime via a KIE container (KieContainer).</p></li><li class="listitem"><p>KieSessions, for the runtime's to interact with, are created from the
            KieContainer.</p></li></ul></div></li><li class="listitem"><p><span class="bold"><strong>Run</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>System interaction with the KieSession, via API.</p></li></ul></div></li><li class="listitem"><p><span class="bold"><strong>Work</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>User interaction with the KieSession, via command line or UI.</p></li></ul></div></li><li class="listitem"><p><span class="bold"><strong>Manage</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Manage any KieSession or KieContainer.</p></li></ul></div></li></ul></div></div></div><div class="section" title="4.2. Build, Deploy, Utilize and Run"><div class="titlepage"><div><div><h2 class="title"><a id="BuildDeployUtilizeAndRunSection"/>4.2. Build, Deploy, Utilize and Run</h2></div></div></div><div class="section" title="4.2.1. Introduction"><div class="titlepage"><div><div><h3 class="title"><a id="KIEModuleIntroductionBuildingIntroductionSection"/>4.2.1. Introduction</h3></div></div></div><p>6.0 introduces a new configuration and convention approach to building knowledge bases,
    instead of using the programmatic builder approach in 5.x. The builder is still
    available to fall back on, as it's used for the tooling integration.</p><p>Building now uses Maven, and aligns with Maven practices. A KIE project or module is simply
    a Maven Java project or module; with an additional metadata file META-INF/kmodule.xml. The
    kmodule.xml file is the descriptor that selects resources to knowledge bases and configures
    those knowledge bases and sessions. There is also alternative XML support via Spring and OSGi
    BluePrints.</p><p>While standard Maven can build and package KIE resources, it will not provide validation at
    build time. There is a Maven plugin which is recommended to use to get build time validation. The
    plugin also generates many classes, making the runtime loading faster too.</p><p>The example project layout and Maven POM descriptor is illustrated in the screenshot</p><div class="figure"><a id="d0e2327"/><p class="title"><strong>Figure 4.2. Example project layout and Maven POM</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/defaultkiesession.png" alt="Example project layout and Maven POM"/></div></div></div></div><br class="figure-break"/><p>KIE uses defaults to minimise the amount of configuration. With an empty kmodule.xml being
    the simplest configuration. There must always be a kmodule.xml file, even if empty, as it's used
    for discovery of the JAR and its contents.</p><p>Maven can either 'mvn install' to deploy a KieModule to the local machine, where all other
    applications on the local machine use it. Or it can 'mvn deploy' to push the KieModule to a
    remote Maven repository. Building the Application will pull in the KieModule and populate the
    local Maven repository in the process.</p><div class="figure"><a id="d0e2338"/><p class="title"><strong>Figure 4.3. Example project layout and Maven POM</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/maven.png" alt="Example project layout and Maven POM"/></div></div></div></div><br class="figure-break"/><p>JARs can be deployed in one of two ways. Either added to the classpath, like any other JAR
    in a Maven dependency listing, or they can be dynamically loaded at runtime. KIE will scan the
    classpath to find all the JARs with a kmodule.xml in it. Each found JAR is represented by the
    KieModule interface. The terms classpath KieModule and dynamic KieModule are used to refer to the
    two loading approaches. While dynamic modules supports side by side versioning, classpath
    modules do not. Further once a module is on the classpath, no other version may be loaded
    dynamically.</p><p>Detailed references for the API are included in the next sections, the impatient can jump
    straight to the examples section, which is fairly self-explanatory on the different use cases.</p></div><div class="section" title="4.2.2. Building"><div class="titlepage"><div><div><h3 class="title"><a id="KIEBuildingSection"/>4.2.2. Building</h3></div></div></div><div class="figure"><a id="d0e2352"/><p class="title"><strong>Figure 4.4. org.kie.api.core.builder</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/builder.png" alt="org.kie.api.core.builder"/></div></div></div><br class="figure-break"/><div class="section" title="4.2.2.1. Creating and building a Kie Project"><div class="titlepage"><div><div><h4 class="title"><a id="creatingAndBuildingAKieProject"/>4.2.2.1. Creating and building a Kie Project</h4></div></div></div><p>A Kie Project has the structure of a normal Maven project with the only peculiarity
    of including a kmodule.xml file defining in a declaratively way the <code class="code">KieBase</code>s
    and <code class="code">KieSession</code>s that can be created from it. This file has to be placed in the
    resources/META-INF folder of the Maven project while all the other Kie artifacts, such as
    DRL or a Excel files, must be stored in the resources folder or in any other subfolder under it.</p><p>Since meaningful defaults have been provided for all configuration aspects, the simplest
    kmodule.xml file can contain just an empty kmodule tag like the following:</p><div class="example"><a id="d0e2372"/><p class="title"><strong>Example 4.1. An empty kmodule.xml file</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"/&gt;</code></pre></div></div><br class="example-break"/><p>In this way the kmodule will contain one single default <code class="code">KieBase</code>. All Kie
      assets stored under the resources folder, or any of its subfolders, will be compiled and added
      to it. To trigger the building of these artifacts it is enough to create a
        <code class="code">KieContainer</code> for them.</p><div class="figure"><a id="d0e2385"/><p class="title"><strong>Figure 4.5. KieContainer</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/KieContainer.png" alt="KieContainer"/></div></div></div><br class="figure-break"/><p>For this simple case it is enough to create a <code class="code">KieContainer</code> that reads the
      files to be built from the classpath:</p><div class="example"><a id="d0e2396"/><p class="title"><strong>Example 4.2. Creating a KieContainer from the classpath</strong></p><div class="example-contents"><pre><code class="language-java">KieServices kieServices = KieServices.Factory.get();
KieContainer kContainer = kieServices.getKieClasspathContainer();</code></pre></div></div><br class="example-break"/><p><code class="code">KieServices</code> is the interface from where it possible to access all the Kie
      building and runtime facilities:</p><div class="figure"><a id="d0e2405"/><p class="title"><strong>Figure 4.6. KieServices</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/KieServices.png" alt="KieServices"/></div></div></div><br class="figure-break"/><p>In this way all the Java sources and the Kie resources are compiled and deployed into
    the KieContainer which makes its contents available for use at runtime.</p></div><div class="section" title="4.2.2.2. The kmodule.xml file"><div class="titlepage"><div><div><h4 class="title"><a id="theKmoduleXmlFile"/>4.2.2.2. The kmodule.xml file</h4></div></div></div><p>As explained in the former section, the kmodule.xml file is the place where it is possible
    to declaratively configure the <code class="code">KieBase</code>(s) and <code class="code">KieSession</code>(s) that can be
    created from a KIE project.</p><p>In particular a <code class="code">KieBase</code> is a repository of all the application's knowledge definitions.
    It will contain rules, processes, functions, and type models. The <code class="code">KieBase</code> itself does not contain
    data; instead, sessions are created from the <code class="code">KieBase</code> into which data can be inserted and from
    which process instances may be started. Creating the <code class="code">KieBase</code> can be heavy, whereas session
    creation is very light, so it is recommended that <code class="code">KieBase</code> be cached where possible to allow
    for repeated session creation. However end-users usually shouldn't worry about it, because this caching
    mechanism is already automatically provided by the <code class="code">KieContainer</code>.</p><div class="figure"><a id="d0e2444"/><p class="title"><strong>Figure 4.7. KieBase</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/KieBase.png" alt="KieBase"/></div></div></div><br class="figure-break"/><p>Conversely the <code class="code">KieSession</code> stores and executes on the runtime data.
    It is created from the <code class="code">KieBase</code> or more easily can be created directly from the
    <code class="code">KieContainer</code> if it has been defined in the kmodule.xml file</p><div class="figure"><a id="d0e2461"/><p class="title"><strong>Figure 4.8. KieSession</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/KieSession.png" alt="KieSession"/></div></div></div><br class="figure-break"/><p>The kmodule.xml allows to define and configure one or more <code class="code">KieBase</code>s and for each
    <code class="code">KieBase</code> all the different <code class="code">KieSession</code>s that can be created from it,
    as showed by the follwing example:</p><div class="example"><a id="d0e2478"/><p class="title"><strong>Example 4.3. A sample kmodule.xml file</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;kmodule xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://www.drools.org/xsd/kmodule"&gt;
  &lt;configuration&gt;
    &lt;property key="drools.evaluator.supersetOf" value="org.mycompany.SupersetOfEvaluatorDefinition"/&gt;
  &lt;/configuration&gt;
  &lt;kbase name="KBase1" default="true" eventProcessingMode="cloud" equalsBehavior="equality" declarativeAgenda="enabled" packages="org.domain.pkg1"&gt;
    &lt;ksession name="KSession2_1" type="stateful" default="true"/&gt;
    &lt;ksession name="KSession2_2" type="stateless" default="false" beliefSystem="jtms"/&gt;
  &lt;/kbase&gt;
  &lt;kbase name="KBase2" default="false" eventProcessingMode="stream" equalsBehavior="equality" declarativeAgenda="enabled" packages="org.domain.pkg2, org.domain.pkg3" includes="KBase1"&gt;
    &lt;ksession name="KSession3_1" type="stateful" default="false" clockType="realtime"&gt;
      &lt;fileLogger file="drools.log" threaded="true" interval="10"/&gt;
      &lt;workItemHandlers&gt;
        &lt;workItemHandler name="name" type="org.domain.WorkItemHandler"/&gt;
      &lt;/workItemHandlers&gt;
      &lt;listeners&gt;
        &lt;ruleRuntimeEventListener type="org.domain.RuleRuntimeListener"/&gt;
        &lt;agendaEventListener type="org.domain.FirstAgendaListener"/&gt;
        &lt;agendaEventListener type="org.domain.SecondAgendaListener"/&gt;
        &lt;processEventListener type="org.domain.ProcessListener"/&gt;
      &lt;/listeners&gt;
    &lt;/ksession&gt;
  &lt;/kbase&gt;
&lt;/kmodule&gt;</code></pre></div></div><br class="example-break"/><p>Here the &lt;configuration&gt; tag contains a list of key-value pairs that are the optional properties
    used to configure the <code class="code">KieBase</code>s building process. For instance this sample kmodule.xml file defines
    an additional custom operator named <code class="code">supersetOf</code> and implemented by the
    <code class="code">org.mycompany.SupersetOfEvaluatorDefinition</code> class.</p><p>After this 2 <code class="code">KieBase</code>s have been defined and it is possible to instance 2 different types of
    <code class="code">KieSession</code>s from the first one, while only one from the second. A list of the attributes that
    can be defined on the kbase tag, together with their meaning and default values follows:</p><div class="table"><a id="d0e2502"/><p class="title"><strong>Table 4.1. kbase Attributes</strong></p><div class="table-contents"><table summary="kbase Attributes" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center">Attribute name</th><th align="center">Default value</th><th align="center">Admitted values</th><th align="center">Meaning</th></tr></thead><tbody><tr><td>name</td><td>none</td><td>any</td><td>The name with which retrieve this KieBase from the KieContainer.
            This is the only mandatory attribute.</td></tr><tr><td>includes</td><td>none</td><td>any comma separated list</td><td>A comma separated list of other KieBases contained in this kmodule.
            The artifacts of all these KieBases will be also included in this one.</td></tr><tr><td>packages</td><td>all</td><td>any comma separated list</td><td>By default all the Drools artifacts under the resources folder,
            at any level, are included into the KieBase. This attribute allows to limit
            the artifacts that will be compiled in this KieBase to only the ones
            belonging to the list of packages.</td></tr><tr><td>default</td><td>false</td><td>true, false</td><td>Defines if this KieBase is the default one for this module, so
            it can be created from the KieContainer without passing any name to it.
            There can be at most one default KieBase in each module.</td></tr><tr><td>equalsBehavior</td><td>identity</td><td>identity, equality</td><td>Defines the behavior of Drools when a new fact is inserted into the
            Working Memory. With identity it always create a new FactHandle unless the same
            object isn't already present in the Working Memory, while with equality only if
            the newly inserted object is not equal (according to its equal method) to an already
            existing fact.</td></tr><tr><td>eventProcessingMode</td><td>cloud</td><td>cloud, stream</td><td>When compiled in cloud mode the KieBase treats events as normal facts, while
            in stream mode allow temporal reasoning on them.</td></tr><tr><td>declarativeAgenda</td><td>disabled</td><td>disabled, enabled</td><td>Defines if the Declarative Agenda is enabled or not.</td></tr></tbody></table></div></div><br class="table-break"/><p>Similarly all attributes of the ksession tag (except of course the name)
    have meaningful default. They are listed and described in the following table:</p><div class="table"><a id="d0e2582"/><p class="title"><strong>Table 4.2. ksession Attributes</strong></p><div class="table-contents"><table summary="ksession Attributes" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center">Attribute name</th><th align="center">Default value</th><th align="center">Admitted values</th><th align="center">Meaning</th></tr></thead><tbody><tr><td>name</td><td>none</td><td>any</td><td>Unique name of this KieSession. Used to fetch the KieSession from the KieContainer.
            This is the only mandatory attribute.</td></tr><tr><td>type</td><td>stateful</td><td>stateful, stateless</td><td>A stateful session allows to iteratively work with the Working Memory,
            while a stateless one is a one-off execution of a Working Memory with a provided data set.</td></tr><tr><td>default</td><td>false</td><td>true, false</td><td>Defines if this KieSession is the default one for this module, so
            it can be created from the KieContainer without passing any name to it.
            In each module there can be at most one default KieSession for each type.</td></tr><tr><td>clockType</td><td>realtime</td><td>realtime, pseudo</td><td>Defines if events timestamps are determined by the system clock or by
            a psuedo clock controlled by the application. This clock is specially useful for
            unit testing temporal rules.</td></tr><tr><td>beliefSystem</td><td>simple</td><td>simple, jtms, defeasible</td><td>Defines the type of belief system used by the KieSession.</td></tr></tbody></table></div></div><br class="table-break"/><p>As outlined in the former kmodule.xml sample, it is also possible to declaratively
    create on each <code class="code">KieSession</code> a file (or a console) logger, one or more
    <code class="code">WorkItemHandler</code>s and some listeners that can be of 3 different types:
    ruleRuntimeEventListener, agendaEventListener and processEventListener</p><p>Having defined a kmodule.xml like the one in the former sample, it is now possible
    to simply retrieve the KieBases and KieSessions from the KieContainer using their names.</p><div class="example"><a id="d0e2652"/><p class="title"><strong>Example 4.4. Retriving KieBases and KieSessions from the KieContainer</strong></p><div class="example-contents"><pre><code class="language-java">KieServices kieServices = KieServices.Factory.get();
KieContainer kContainer = kieServices.getKieClasspathContainer();

KieBase kBase1 = kContainer.getKieBase("KBase1");
KieSession kieSession1 = kContainer.newKieSession("KSession2_1");
StatelessKieSession kieSession2 = kContainer.newStatelessKieSession("KSession2_2");</code></pre></div></div><br class="example-break"/><p>It has to be noted that since KSession2_1 and KSession2_2 are of 2 different types
    (the first is stateful, while the second is stateless) it is necessary to invoke 2 different methods on the
    <code class="code">KieContainer</code> according to their declared type. If the type of the <code class="code">KieSession</code>
    requested to the <code class="code">KieContainer</code> doesn't correspond with the one declared in the
    kmodule.xml file the <code class="code">KieContainer</code> will throw a <code class="code">RuntimeException</code>.
    Also since a <code class="code">KieBase</code> and a <code class="code">KieSession</code> have been flagged as default
    is it possible to get them from the <code class="code">KieContainer</code> without passing any name.</p><div class="example"><a id="d0e2683"/><p class="title"><strong>Example 4.5. Retriving default KieBases and KieSessions from the KieContainer</strong></p><div class="example-contents"><pre><code class="language-java">KieContainer kContainer = ...

KieBase kBase1 = kContainer.getKieBase(); // returns KBase1
KieSession kieSession1 = kContainer.newKieSession(); // returns KSession2_1</code></pre></div></div><br class="example-break"/><p>Since a Kie project is also a Maven project the groupId, artifactId and version declared
    in the pom.xml file are used to generate a <code class="code">ReleaseId</code> that uniquely identifies
    this project inside your application. This allows creation of a new KieContainer from the
    project by simply passing its <code class="code">ReleaseId</code> to the <code class="code">KieServices</code>.</p><div class="example"><a id="d0e2699"/><p class="title"><strong>Example 4.6. Creating a KieContainer of an existing project by ReleaseId</strong></p><div class="example-contents"><pre><code class="language-java">KieServices kieServices = KieServices.Factory.get();
ReleaseId releaseId = kieServices.newReleaseId( "org.acme", "myartifact", "1.0" );
KieContainer kieContainer = kieServices.newKieContainer( releaseId );</code></pre></div></div><br class="example-break"/></div><div class="section" title="4.2.2.3. Building with Maven"><div class="titlepage"><div><div><h4 class="title"><a id="buildingWithMaven"/>4.2.2.3. Building with Maven</h4></div></div></div><p>
      The KIE plugin for Maven ensures that artifact resources are validated and pre-compiled, it is recommended
      that this is used at all times. To use the plugin simply add it to the build
      section of the Maven pom.xml and activate it by using packaging <code class="code">kjar</code>.
     </p><div class="example"><a id="d0e2712"/><p class="title"><strong>Example 4.7. Adding the KIE plugin to a Maven pom.xml and activating it</strong></p><div class="example-contents"><pre><code class="language-xml">
  &lt;packaging&gt;kjar&lt;/packaging&gt;
  ...
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.kie&lt;/groupId&gt;
        &lt;artifactId&gt;kie-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;6.5.0.Final&lt;/version&gt;
        &lt;extensions&gt;true&lt;/extensions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;        
      </code></pre></div></div><br class="example-break"/><p>The plugin comes with support for all the Drools/jBPM knowledge resources.
      However, in case you are using specific KIE annotations in your Java classes, like for example <code class="code">@kie.api.Position</code>, you will
      need to add compile time dependency on <code class="code">kie-api</code> into your project. We recommend to use the provided scope
      for all the additional KIE dependencies. That way the kjar stays as lightweight as possible, and not dependant
      on any particular KIE version.
    </p><p>Building a KIE module without the Maven plugin will copy all the resources, as is, into the resulting JAR.
      When that JAR is loaded by the runtime, it will attempt to build all the resources then. If there are compilation
      issues it will return a null KieContainer. It also pushes the compilation overhead to the runtime. In general this
      is not recommended, and the Maven plugin should always be used. </p></div><div class="section" title="4.2.2.4. Defining a KieModule programmatically"><div class="titlepage"><div><div><h4 class="title"><a id="definingAKieModuleProgrammatically"/>4.2.2.4. Defining a KieModule programmatically</h4></div></div></div><p>It is also possible to define the <code class="code">KieBase</code>s and <code class="code">KieSession</code>s
    belonging to a KieModule programmatically instead of the declarative definition in the
    kmodule.xml file. The same programmatic API also allows in explicitly adding the file containing the
    Kie artifacts instead of automatically read them from the resources folder of your project.
    To do that it is necessary to create a <code class="code">KieFileSystem</code>, a sort of virtual file
    system, and add all the resources contained in your project to it.</p><div class="figure"><a id="d0e2741"/><p class="title"><strong>Figure 4.9. KieFileSystem</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/KieFileSystem.png" alt="KieFileSystem"/></div></div></div><br class="figure-break"/><p>Like all other Kie core components you can obtain an instance of the <code class="code">KieFileSystem</code> from
    the <code class="code">KieServices</code>. The kmodule.xml configuration file must be added to the filesystem. This is a
    mandatory step. Kie also provides a convenient fluent API, implemented by the <code class="code">KieModuleModel</code>,
      to programmatically create this file.</p><div class="figure"><a id="d0e2758"/><p class="title"><strong>Figure 4.10. KieModuleModel</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/KieModuleModel.png" alt="KieModuleModel"/></div></div></div><br class="figure-break"/><p>To do this in practice it is necessary to create a <code class="code">KieModuleModel</code> from the
    <code class="code">KieServices</code>, configure it with the desired <code class="code">KieBase</code>s and
    <code class="code">KieSession</code>s, convert it in XML and add the XML to the <code class="code">KieFileSystem</code>.
    This process is shown by the following example:</p><div class="example"><a id="d0e2781"/><p class="title"><strong>Example 4.8. Creating a kmodule.xml programmatically and adding it to a KieFileSystem</strong></p><div class="example-contents"><pre><code class="language-java">KieServices kieServices = KieServices.Factory.get();
KieModuleModel kieModuleModel = kieServices.newKieModuleModel();

KieBaseModel kieBaseModel1 = kieModuleModel.newKieBaseModel( "KBase1 ")
        .setDefault( true )
        .setEqualsBehavior( EqualityBehaviorOption.EQUALITY )
        .setEventProcessingMode( EventProcessingOption.STREAM );

KieSessionModel ksessionModel1 = kieBaseModel1.newKieSessionModel( "KSession1" )
        .setDefault( true )
        .setType( KieSessionModel.KieSessionType.STATEFUL )
        .setClockType( ClockTypeOption.get("realtime") );

KieFileSystem kfs = kieServices.newKieFileSystem();
kfs.writeKModuleXML(kieModuleModel.toXML());</code></pre></div></div><br class="example-break"/><p>At this point it is also necessary to add to the <code class="code">KieFileSystem</code>, through its
    fluent API, all others Kie artifacts composing your project. These artifacts have to be added
    in the same position of a corresponding usual Maven project.</p><div class="example"><a id="d0e2791"/><p class="title"><strong>Example 4.9. Adding Kie artifacts to a KieFileSystem</strong></p><div class="example-contents"><pre><code class="language-java">KieFileSystem kfs = ...
kfs.write( "src/main/resources/KBase1/ruleSet1.drl", stringContainingAValidDRL )
        .write( "src/main/resources/dtable.xls",
                kieServices.getResources().newInputStreamResource( dtableFileStream ) );</code></pre></div></div><br class="example-break"/><p>This example shows that it is possible to add the Kie artifacts both as plain Strings and
    as <code class="code">Resource</code>s. In the latter case the <code class="code">Resource</code>s can be created by the
    <code class="code">KieResources</code> factory, also provided by the <code class="code">KieServices</code>. The
    <code class="code">KieResources</code> provides many convenient factory methods to convert an <code class="code">InputStream</code>,
    a <code class="code">URL</code>, a <code class="code">File</code>, or a <code class="code">String</code> representing a path of your file
    system to a <code class="code">Resource</code> that can be managed by the <code class="code">KieFileSystem</code>.</p><div class="figure"><a id="d0e2831"/><p class="title"><strong>Figure 4.11. KieResources</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/KieResources.png" alt="KieResources"/></div></div></div><br class="figure-break"/><p>Normally the type of a <code class="code">Resource</code> can be inferred from the extension of the name
    used to add it to the <code class="code">KieFileSystem</code>. However it also possible to not follow the Kie
    conventions about file extensions and explicitly assign a specific <code class="code">ResourceType</code>
    to a <code class="code">Resource</code> as shown below:</p><div class="example"><a id="d0e2851"/><p class="title"><strong>Example 4.10. Creating and adding a Resource with an explicit type</strong></p><div class="example-contents"><pre><code class="language-java">KieFileSystem kfs = ...
kfs.write( "src/main/resources/myDrl.txt",
           kieServices.getResources().newInputStreamResource( drlStream )
                      .setResourceType(ResourceType.DRL) );</code></pre></div></div><br class="example-break"/><p>Add all the resources to the <code class="code">KieFileSystem</code> and build it by passing the <code class="code">KieFileSystem</code>
    to a <code class="code">KieBuilder</code></p><div class="figure"><a id="d0e2866"/><p class="title"><strong>Figure 4.12. KieBuilder</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/KieBuilder.png" alt="KieBuilder"/></div></div></div><br class="figure-break"/><p>When the contents of a <code class="code">KieFileSystem</code> are successfully built, the resulting <code class="code">KieModule</code>
    is automatically added to the <code class="code">KieRepository</code>.
    The <code class="code">KieRepository</code> is a singleton acting as a repository for all the available <code class="code">KieModule</code>s.</p><div class="figure"><a id="d0e2889"/><p class="title"><strong>Figure 4.13. KieRepository</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/KieRepository.png" alt="KieRepository"/></div></div></div><br class="figure-break"/><p>After this it is possible to create through the <code class="code">KieServices</code> a new
    <code class="code">KieContainer</code> for that <code class="code">KieModule</code> using its <code class="code">ReleaseId</code>. However,
    since in this case the <code class="code">KieFileSystem</code> doesn't contain any pom.xml file (it is possible to
    add one using the <code class="code">KieFileSystem.writePomXML</code> method), Kie cannot determine the
    <code class="code">ReleaseId</code> of the <code class="code">KieModule</code> and assign to it a default one. This
    default <code class="code">ReleaseId</code> can be obtained from the <code class="code">KieRepository</code> and used
    to identify the <code class="code">KieModule</code> inside the <code class="code">KieRepository</code> itself.
    The following example shows this whole process.</p><div class="example"><a id="d0e2933"/><p class="title"><strong>Example 4.11. Building the contents of a KieFileSystem and creating a KieContainer</strong></p><div class="example-contents"><pre><code class="language-java">KieServices kieServices = KieServices.Factory.get();
KieFileSystem kfs = ...
kieServices.newKieBuilder( kfs ).buildAll();
KieContainer kieContainer = kieServices.newKieContainer(kieServices.getRepository().getDefaultReleaseId());</code></pre></div></div><br class="example-break"/><p>At this point it is possible to get <code class="code">KieBase</code>s and create new <code class="code">KieSession</code>s
    from this <code class="code">KieContainer</code> exactly in the same way as in the case of a <code class="code">KieContainer</code>
    created directly from the classpath.</p><p>It is a best practice to check the compilation results. The <code class="code">KieBuilder</code>
    reports compilation results of 3 different severities: ERROR, WARNING and INFO. An ERROR
    indicates that the compilation of the project failed and in the case no <code class="code">KieModule</code> is
    produced and nothing is added to the <code class="code">KieRepository</code>. WARNING and INFO results
    can be ignored, but are available for inspection.</p><div class="example"><a id="d0e2963"/><p class="title"><strong>Example 4.12. Checking that a compilation didn't produce any error</strong></p><div class="example-contents"><pre><code class="language-java">KieBuilder kieBuilder = kieServices.newKieBuilder( kfs ).buildAll();
assertEquals( 0, kieBuilder.getResults().getMessages( Message.Level.ERROR ).size() );</code></pre></div></div><br class="example-break"/></div><div class="section" title="4.2.2.5. Changing the Default Build Result Severity"><div class="titlepage"><div><div><h4 class="title"><a id="changingTheDefaultBuildResultSeverity"/>4.2.2.5. Changing the Default Build Result Severity</h4></div></div></div><p>In some cases, it is possible to change the default severity of a
    type of build result. For instance, when a new rule with the same name
    of an existing rule is added to a package, the default behavior is to
    replace the old rule by the new rule and report it as an INFO. This is
    probably ideal for most use cases, but in some deployments the user
    might want to prevent the rule update and report it as an error.</p><p>Changing the default severity for a result type, configured
    like any other option in Drools, can be done by API
    calls, system properties or configuration files. As of this version,
    Drools supports configurable result severity for rule updates and function
    updates. To configure it using system properties or configuration files,
    the user has to use the following properties:</p><div class="example"><a id="d0e2975"/><p class="title"><strong>Example 4.13. Setting the severity using properties</strong></p><div class="example-contents"><pre><code class="no-highlight">// sets the severity of rule updates
drools.kbuilder.severity.duplicateRule = &lt;INFO|WARNING|ERROR&gt;
// sets the severity of function updates
drools.kbuilder.severity.duplicateFunction = &lt;INFO|WARNING|ERROR&gt;</code></pre></div></div><br class="example-break"/></div></div><div class="section" title="4.2.3. Deploying"><div class="titlepage"><div><div><h3 class="title"><a id="KIEDeployingSection"/>4.2.3. Deploying</h3></div></div></div><div class="section" title="4.2.3.1. KieBase"><div class="titlepage"><div><div><h4 class="title"><a id="d0e2984"/>4.2.3.1. KieBase</h4></div></div></div><p>The <code class="code">KieBase</code> is a repository of all the application's knowledge definitions. It will contain
      rules, processes, functions, and type models. The <code class="code">KieBase</code> itself does not contain data; instead,
      sessions are created from the <code class="code">KieBase</code> into which data can be inserted and from which process
      instances may be started. The <code class="code">KieBase</code> can be obtained from the <code class="code">KieContainer</code> containing
      the <code class="code">KieModule</code> where the <code class="code">KieBase</code> has been defined.</p><div class="figure"><a id="d0e3010"/><p class="title"><strong>Figure 4.14. KieBase</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/KieBase.png" alt="KieBase"/></div></div></div><br class="figure-break"/><p>Sometimes, for instance in a OSGi environment, the <code class="code">KieBase</code> needs to resolve types that are not in
      the default class loader. In this case it will be necessary to create a <code class="code">KieBaseConfiguration</code> with an
      additional class loader and pass it to <code class="code">KieContainer</code> when creating a new <code class="code">KieBase</code> from
      it.</p><div class="example"><a id="d0e3030"/><p class="title"><strong>Example 4.14. Creating a new KieBase with a custom ClassLoader</strong></p><div class="example-contents"><pre><code class="language-java">KieServices kieServices = KieServices.Factory.get();
KieBaseConfiguration kbaseConf = kieServices.newKieBaseConfiguration( null, MyType.class.getClassLoader() );
KieBase kbase = kieContainer.newKieBase( kbaseConf );</code></pre></div></div><br class="example-break"/></div><div class="section" title="4.2.3.2. KieSessions and KieBase Modifications"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3035"/>4.2.3.2. KieSessions and KieBase Modifications</h4></div></div></div><p>KieSessions will be discussed in more detail in
    section "Running". The <code class="code">KieBase</code> creates and returns
    <code class="code">KieSession</code> objects, and it may optionally keep
    references to those. When <code class="code">KieBase</code> modifications occur
    those modifications are applied against the data in the sessions. This
    reference is a weak reference and it is also optional, which is controlled
    by a boolean flag.</p></div><div class="section" title="4.2.3.3. KieScanner"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3049"/>4.2.3.3. KieScanner</h4></div></div></div><p>The <code class="code">KieScanner</code> allows continuous monitoring of your Maven repository
    to check whether a new release of a Kie project has been installed. A new release is deployed in
    the <code class="code">KieContainer</code> wrapping that project. The use of the <code class="code">KieScanner</code>
    requires kie-ci.jar to be on the classpath.</p><div class="figure"><a id="d0e3063"/><p class="title"><strong>Figure 4.15. KieScanner</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/KieScanner.png" alt="KieScanner"/></div></div></div><br class="figure-break"/><p>A <code class="code">KieScanner</code> can be registered on a <code class="code">KieContainer</code>
    as in the following example.</p><div class="example"><a id="d0e3077"/><p class="title"><strong>Example 4.15. Registering and starting a KieScanner on a KieContainer</strong></p><div class="example-contents"><pre><code class="language-java">KieServices kieServices = KieServices.Factory.get();
ReleaseId releaseId = kieServices.newReleaseId( "org.acme", "myartifact", "1.0-SNAPSHOT" );
KieContainer kContainer = kieServices.newKieContainer( releaseId );
KieScanner kScanner = kieServices.newKieScanner( kContainer );

// Start the KieScanner polling the Maven repository every 10 seconds
kScanner.start( 10000L );</code></pre></div></div><br class="example-break"/><p>In this example the <code class="code">KieScanner</code> is configured to run with a fixed
    time interval, but it is also possible to run it on demand by invoking the
    <code class="code">scanNow()</code> method on it. If the <code class="code">KieScanner</code> finds, in the
    Maven repository, an updated version of the Kie project used by that <code class="code">KieContainer</code>
    it automatically downloads the new version and triggers an incremental build of the new
    project.
    At this point, existing <code class="code">KieBase</code>s and <code class="code">KieSession</code>s under the control of <code class="code">KieContainer</code>
    will get automatically upgraded with it - specifically, those <code class="code">KieBase</code>s obtained with <code class="code">getKieBase()</code>
    along with their related <code class="code">KieSession</code>s, and any <code class="code">KieSession</code> obtained directly with
    <code class="code">KieContainer.newKieSession()</code> thus referencing the default <code class="code">KieBase</code>.
    Additionally, from this moment on, all the new <code class="code">KieBase</code>s and <code class="code">KieSession</code>s
    created from that <code class="code">KieContainer</code> will use the new project version.
    Please notice however any existing <code class="code">KieBase</code> which was obtained via <code class="code">newKieBase()</code> before the
    KieScanner upgrade, and any of its related <code class="code">KieSession</code>s, will not get automatically upgraded; this is because
    <code class="code">KieBase</code>s obtained via <code class="code">newKieBase()</code> are not under the direct control of the <code class="code">KieContainer</code>.
    </p><p>The <code class="code">KieScanner</code> will only pickup changes to deployed jars if it is using a SNAPSHOT, version range,
    the LATEST, or the RELEASE setting. Fixed versions will not automatically update at runtime.</p></div><div class="section" title="4.2.3.4. Maven Versions and Dependencies"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3155"/>4.2.3.4. Maven Versions and Dependencies</h4></div></div></div><p>Maven supports a number of mechanisms to manage versioning and dependencies within applications. Modules can
      be published with specific version numbers, or they can use the SNAPSHOT suffix. Dependencies can specify version
      ranges to consume, or take avantage of SNAPSHOT mechanism.</p><p>StackOverflow provides a very good description for this, which is reproduced below.</p><p><a class="link" href="http://stackoverflow.com/questions/30571/how-do-i-tell-maven-to-use-the-latest-version-of-a-dependency"> http://stackoverflow.com/questions/30571/how-do-i-tell-maven-to-use-the-latest-version-of-a-dependency
      </a></p><p>If you always want to use the newest version, Maven has two keywords you can use as an alternative to version
      ranges. You should use these options with care as you are no longer in control of the plugins/dependencies you are
      using. </p><p>When you depend on a plugin or a dependency, you can use the a version value of LATEST or RELEASE. LATEST
      refers to the latest released or snapshot version of a particular artifact, the most recently deployed artifact in
      a particular repository. RELEASE refers to the last non-snapshot release in the repository. In general, it is not
      a best practice to design software which depends on a non-specific version of an artifact. If you are developing
      software, you might want to use RELEASE or LATEST as a convenience so that you don't have to update version
      numbers when a new release of a third-party library is released. When you release software, you should always make
      sure that your project depends on specific versions to reduce the chances of your build or your project being
      affected by a software release not under your control. Use LATEST and RELEASE with caution, if at all. </p><p>See the POM Syntax section of the Maven book for more details. </p><p><a class="link" href="http://books.sonatype.com/mvnref-book/reference/pom-relationships-sect-pom-syntax.html">http://books.sonatype.com/mvnref-book/reference/pom-relationships-sect-pom-syntax.html </a></p><p><a class="link" href="http://books.sonatype.com/mvnref-book/reference/pom-relationships-sect-project-dependencies.html">http://books.sonatype.com/mvnref-book/reference/pom-relationships-sect-project-dependencies.html</a></p><p>Here's an example illustrating the various options. In the Maven repository, com.foo:my-foo has the following
      metadata:</p><pre><code class="language-xml">&lt;metadata&gt;
  &lt;groupId&gt;com.foo&lt;/groupId&gt;
  &lt;artifactId&gt;my-foo&lt;/artifactId&gt;
  &lt;version&gt;2.0.0&lt;/version&gt;
  &lt;versioning&gt;
    &lt;release&gt;1.1.1&lt;/release&gt;
    &lt;versions&gt;
      &lt;version&gt;1.0&lt;/version&gt;
      &lt;version&gt;1.0.1&lt;/version&gt;
      &lt;version&gt;1.1&lt;/version&gt;
      &lt;version&gt;1.1.1&lt;/version&gt;
      &lt;version&gt;2.0.0&lt;/version&gt;
    &lt;/versions&gt;
    &lt;lastUpdated&gt;20090722140000&lt;/lastUpdated&gt;
  &lt;/versioning&gt;
&lt;/metadata&gt;</code></pre><p>If a dependency on that artifact is required, you have the following options (other version ranges can be
      specified of course, just showing the relevant ones here): Declare an exact version (will always resolve to
      1.0.1): </p><pre><code class="no-highlight">&lt;version&gt;[1.0.1]&lt;/version&gt;</code></pre><p> Declare an explicit version (will
      always resolve to 1.0.1 unless a collision occurs, when Maven will select a matching version):
      </p><pre><code class="no-highlight">&lt;version&gt;1.0.1&lt;/version&gt;</code></pre><p> Declare a version range for all 1.x (will
      currently resolve to 1.1.1): </p><pre><code class="no-highlight">&lt;version&gt;[1.0.0,2.0.0)&lt;/version&gt;</code></pre><p> Declare
      an open-ended version range (will resolve to 2.0.0):
      </p><pre><code class="no-highlight">&lt;version&gt;[1.0.0,)&lt;/version&gt;</code></pre><p> Declare the version as LATEST (will
      resolve to 2.0.0): </p><pre><code class="no-highlight">&lt;version&gt;LATEST&lt;/version&gt;</code></pre><p> Declare the version as
      RELEASE (will resolve to 1.1.1): </p><pre><code class="no-highlight">&lt;version&gt;RELEASE&lt;/version&gt;</code></pre><p>Note that
      by default your own deployments will update the "latest" entry in the Maven metadata, but to update the "release"
      entry, you need to activate the "release-profile" from the Maven super POM. You can do this with either
      "-Prelease-profile" or "-DperformRelease=true" </p></div><div class="section" title="4.2.3.5. Settings.xml and Remote Repository Setup"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3201"/>4.2.3.5. Settings.xml and Remote Repository Setup</h4></div></div></div><p>The maven settings.xml is used to configure Maven execution. Detailed instructions can be found at the Maven
      website:</p><p><a class="link" href="http://maven.apache.org/settings.html">http://maven.apache.org/settings.html</a></p><p>The settings.xml file can be located in 3 locations, the actual settings used is a merge of those 3
      locations.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The Maven install: <code class="literal">$M2_HOME/conf/settings.xml</code></p></li><li class="listitem"><p>A user's install: <code class="literal">${user.home}/.m2/settings.xml</code></p></li><li class="listitem"><p>Folder location specified by the system property <code class="literal">kie.maven.settings.custom</code></p></li></ul></div><p>The settings.xml is used to specify the location of remote repositories. It is important that you activate the
      profile that specifies the remote repository, typically this can be done using "activeByDefault":</p><pre><code class="language-xml">&lt;profiles&gt;
  &lt;profile&gt;
    &lt;id&gt;profile-1&lt;/id&gt;
    &lt;activation&gt;
      &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
    &lt;/activation&gt;
    ...
  &lt;/profile&gt;
&lt;/profiles&gt;
    </code></pre><p>Maven provides detailed documentation on using multiple remote repositories:</p><p><a class="link" href="http://maven.apache.org/guides/mini/guide-multiple-repositories.html">http://maven.apache.org/guides/mini/guide-multiple-repositories.html</a></p></div></div><div class="section" title="4.2.4. Running"><div class="titlepage"><div><div><h3 class="title"><a id="KIERunningSection"/>4.2.4. Running</h3></div></div></div><p/><div class="section" title="4.2.4.1. KieBase"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3240"/>4.2.4.1. KieBase</h4></div></div></div><p>The <code class="code">KieBase</code> is a repository of all the
    application's knowledge definitions. It will contain rules, processes,
    functions, and type models. The <code class="code">KieBase</code> itself does not contain
    data; instead, sessions are created from the <code class="code">KieBase</code>
    into which data can be inserted and from which process instances may be
    started. The <code class="code">KieBase</code> can be obtained from the <code class="code">KieContainer</code>
    containing the <code class="code">KieModule</code> where the <code class="code">KieBase</code> has been defined.</p><div class="example"><a id="d0e3266"/><p class="title"><strong>Example 4.16. Getting a KieBase from a KieContainer</strong></p><div class="example-contents"><pre><code class="language-java">KieBase kBase = kContainer.getKieBase();</code></pre></div></div><br class="example-break"/></div><div class="section" title="4.2.4.2. KieSession"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3271"/>4.2.4.2. KieSession</h4></div></div></div><p>The <code class="code">KieSession</code> stores and executes on the
    runtime data. It is created from the <code class="code">KieBase</code>.</p><div class="figure"><a id="d0e3282"/><p class="title"><strong>Figure 4.16. KieSession</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/KieSession.png" alt="KieSession"/></div></div></div><br class="figure-break"/><div class="example"><a id="d0e3288"/><p class="title"><strong>Example 4.17. Create a KieSession from a KieBase</strong></p><div class="example-contents"><pre><code class="language-java">KieSession ksession = kbase.newKieSession();</code></pre></div></div><br class="example-break"/></div><div class="section" title="4.2.4.3. KieRuntime"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3293"/>4.2.4.3. KieRuntime</h4></div></div></div><div class="section" title="4.2.4.3.1. KieRuntime"><div class="titlepage"><div><div><h5 class="title"><a id="d0e3296"/>4.2.4.3.1. KieRuntime</h5></div></div></div><p>The <code class="code">KieRuntime</code> provides methods that
      are applicable to both rules and processes, such as setting globals and
      registering channels. ("Exit point" is an obsolete synonym for "channel".)</p><div class="figure"><a id="d0e3304"/><p class="title"><strong>Figure 4.17. KieRuntime</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/KieRuntime.png" alt="KieRuntime"/></div></div></div><br class="figure-break"/><div class="section" title="4.2.4.3.1.1. Globals"><div class="titlepage"><div><div><h6 class="title"><a id="d0e3310"/>4.2.4.3.1.1. Globals</h6></div></div></div><p>Globals are named objects that are made visible to the rule engine,
        but in a way that is fundamentally different from the one for facts:
        changes in the object backing a global do not trigger reevaluation of
        rules. Still, globals are useful for providing static information,
        as an object offering services that are used in the RHS of a rule, or
        as a means to return objects from the rule engine. When you use
        a global on the LHS of a rule, make sure it is immutable, or, at least,
        don't expect changes to have any effect on the behavior of your rules.</p><p>A global must be declared in a rules file, and then it needs to be
        backed up with a Java object.</p><pre><code class="no-highlight">global java.util.List list</code></pre><p>With the Knowledge Base now aware of the global identifier and
        its type, it is now possible to call <code class="code">ksession.setGlobal()</code>
        with the global's name and an object, for any session, to associate
        the object with the global. Failure to declare the global type and
        identifier in DRL code will result in an exception being thrown from
        this call.</p><pre><code class="language-java">List list = new ArrayList();
ksession.setGlobal("list", list);           </code></pre><p>Make sure to set any global before it is used in the evaluation
        of a rule. Failure to do so results in a <code class="code">NullPointerException</code>.</p></div></div></div><div class="section" title="4.2.4.4. Event Model"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3331"/>4.2.4.4. Event Model</h4></div></div></div><p>The event package provides means to be notified of rule engine
      events, including rules firing, objects being asserted, etc. This allows
      separation of logging and auditing activities from the
      main part of your application (and the rules).</p><p>The <code class="code">KieRuntimeEventManager</code> interface is
      implemented by the <code class="code">KieRuntime</code> which provides two
      interfaces, <code class="code">RuleRuntimeEventManager</code> and
      <code class="code">ProcessEventManager</code>. We will only cover the
      <code class="code">RuleRuntimeEventManager</code> here.</p><div class="figure"><a id="d0e3353"/><p class="title"><strong>Figure 4.18. KieRuntimeEventManager</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/KieRuntimeEventManager.png" alt="KieRuntimeEventManager"/></div></div></div><br class="figure-break"/><p>The <code class="code">RuleRuntimeEventManager</code> allows for listeners to
      be added and removed, so that events for the working memory and the agenda
      can be listened to.</p><div class="figure"><a id="d0e3364"/><p class="title"><strong>Figure 4.19. RuleRuntimeEventManager</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/RuleRuntimeEventManager.png" alt="RuleRuntimeEventManager"/></div></div></div><br class="figure-break"/><p>The following code snippet shows how a simple agenda listener is
      declared and attached to a session. It will print matches after they
      have fired.</p><div class="example"><a id="d0e3372"/><p class="title"><strong>Example 4.18. Adding an AgendaEventListener</strong></p><div class="example-contents"><pre><code class="language-java">ksession.addEventListener( new DefaultAgendaEventListener() {
    public void afterMatchFired(AfterMatchFiredEvent event) {
        super.afterMatchFired( event );
        System.out.println( event );
    }
});</code></pre></div></div><br class="example-break"/><p>Drools also provides <code class="code">DebugRuleRuntimeEventListener</code>
      and <code class="code">DebugAgendaEventListener</code> which implement each method with
      a debug print statement. To print all Working Memory events, you add a
      listener like this:</p><div class="example"><a id="d0e3385"/><p class="title"><strong>Example 4.19. Adding a DebugRuleRuntimeEventListener</strong></p><div class="example-contents"><pre><code class="language-java">ksession.addEventListener( new DebugRuleRuntimeEventListener() );</code></pre></div></div><br class="example-break"/><p>All emitted events implement the <code class="code">KieRuntimeEvent</code>
    interface which can be used to retrieve the actual
    <code class="code">KnowlegeRuntime</code> the event originated from.</p><div class="figure"><a id="d0e3398"/><p class="title"><strong>Figure 4.20. KieRuntimeEvent</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/KieRuntimeEvent.png" alt="KieRuntimeEvent"/></div></div></div><br class="figure-break"/><p>The events currently supported are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>MatchCreatedEvent</p></li><li class="listitem"><p>MatchCancelledEvent</p></li><li class="listitem"><p>BeforeMatchFiredEvent</p></li><li class="listitem"><p>AfterMatchFiredEvent</p></li><li class="listitem"><p>AgendaGroupPushedEvent</p></li><li class="listitem"><p>AgendaGroupPoppedEvent</p></li><li class="listitem"><p>ObjectInsertEvent</p></li><li class="listitem"><p>ObjectDeletedEvent</p></li><li class="listitem"><p>ObjectUpdatedEvent</p></li><li class="listitem"><p>ProcessCompletedEvent</p></li><li class="listitem"><p>ProcessNodeLeftEvent</p></li><li class="listitem"><p>ProcessNodeTriggeredEvent</p></li><li class="listitem"><p>ProcessStartEvent</p></li></ul></div></div><div class="section" title="4.2.4.5. KieRuntimeLogger"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3446"/>4.2.4.5. KieRuntimeLogger</h4></div></div></div><p>The KieRuntimeLogger uses the comprehensive event system in
    Drools to create an audit log that can be used to log the execution of an
    application for later inspection, using tools such as the Eclipse audit
    viewer.</p><div class="figure"><a id="d0e3451"/><p class="title"><strong>Figure 4.21. KieLoggers</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/KieLoggers.png" alt="KieLoggers"/></div></div></div><br class="figure-break"/><div class="example"><a id="d0e3457"/><p class="title"><strong>Example 4.20. FileLogger</strong></p><div class="example-contents"><pre><code class="language-java">KieRuntimeLogger logger =
  KieServices.Factory.get().getLoggers().newFileLogger(ksession, "logdir/mylogfile");
...
logger.close();</code></pre></div></div><br class="example-break"/></div><div class="section" title="4.2.4.6. Commands and the CommandExecutor"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3462"/>4.2.4.6. Commands and the CommandExecutor</h4></div></div></div><p>KIE has the concept of stateful or stateless sessions. Stateful sessions have already been
      covered, which use the standard KieRuntime, and can be worked with iteratively over time.
      Stateless is a one-off execution of a KieRuntime with a provided data set. It may return some
      results, with the session being disposed at the end, prohibiting further iterative
      interactions. You can think of stateless as treating an engine like a function call with
      optional return results.</p><p>The foundation for this is the <code class="code">CommandExecutor</code> interface, which both the
      stateful and stateless interfaces extend. This returns an
      <code class="code">ExecutionResults</code>:</p><div class="figure"><a id="d0e3475"/><p class="title"><strong>Figure 4.22. CommandExecutor</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/CommandExecutor.png" alt="CommandExecutor"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e3481"/><p class="title"><strong>Figure 4.23. ExecutionResults</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/ExecutionResults.png" alt="ExecutionResults"/></div></div></div><br class="figure-break"/><p>The <code class="code">CommandExecutor</code> allows for commands to be executed on those sessions, the
      only difference being that the StatelessKieSession executes <code class="code">fireAllRules()</code> at the
      end before disposing the session.  The commands can be created using the
        <code class="code">CommandExecutor</code> .The Javadocs provide the full list of the allowed comands
      using the <code class="code">CommandExecutor</code>.</p><p>setGlobal and getGlobal are two commands relevant to both Drools and jBPM. </p><p>Set Global calls setGlobal underneath. The optional boolean indicates whether the
      command should return the global's value as part of the <code class="code">ExecutionResults</code>. If true it uses the
      same name as the global name. A String can be used instead of the boolean, if an alternative
      name is desired.</p><p>
      </p><div class="example"><a id="d0e3510"/><p class="title"><strong>Example 4.21. Set Global Command</strong></p><div class="example-contents"><pre><code class="language-java">StatelessKieSession ksession = kbase.newStatelessKieSession();
ExecutionResults bresults =
    ksession.execute( CommandFactory.newSetGlobal( "stilton", new Cheese( "stilton" ), true);
Cheese stilton = bresults.getValue( "stilton" );
</code></pre></div></div><p><br class="example-break"/>
    </p><p>Allows an existing global to be returned. The second optional String argument allows for
      an alternative return name.</p><div class="example"><a id="d0e3518"/><p class="title"><strong>Example 4.22. Get Global Command</strong></p><div class="example-contents"><pre><code class="language-java">StatelessKieSession ksession = kbase.newStatelessKieSession();
ExecutionResults bresults =
    ksession.execute( CommandFactory.getGlobal( "stilton" );
Cheese stilton = bresults.getValue( "stilton" );
</code></pre></div></div><br class="example-break"/><p>All the above examples execute single commands.  The <code class="code">BatchExecution</code>
      represents a composite command, created from a list of commands. It will iterate over the list
      and execute each command in turn. This means you can insert some objects, start a process,
      call fireAllRules and execute a query, all in a single <code class="code">execute(...)</code> call, which
      is quite powerful.</p><p>The StatelessKieSession will execute <code class="code">fireAllRules()</code> automatically at the end.
      However the keen-eyed reader probably has already noticed the <code class="code">FireAllRules</code>
      command and wondered how that works with a StatelessKieSession. The <code class="code">FireAllRules</code>
      command is allowed, and using it will disable the automatic execution at the end; think of
      using it as a sort of manual override function.</p><p>Any command, in the batch, that has an out identifier set will add its results to the
      returned <code class="code">ExecutionResults</code> instance. Let's look at a simple example to see how
      this works. The example presented includes command from the Drools and jBPM, for the sake of
      illustration. They are covered in more detail in the Drool and jBPM specific sections.</p><div class="example"><a id="d0e3547"/><p class="title"><strong>Example 4.23. BatchExecution Command</strong></p><div class="example-contents"><pre><code class="language-java">StatelessKieSession ksession = kbase.newStatelessKieSession();

List cmds = new ArrayList();
cmds.add( CommandFactory.newInsertObject( new Cheese( "stilton", 1), "stilton") );
cmds.add( CommandFactory.newStartProcess( "process cheeses" ) );
cmds.add( CommandFactory.newQuery( "cheeses" ) );
ExecutionResults bresults = ksession.execute( CommandFactory.newBatchExecution( cmds ) );
Cheese stilton = ( Cheese ) bresults.getValue( "stilton" );
QueryResults qresults = ( QueryResults ) bresults.getValue( "cheeses" );
</code></pre></div></div><br class="example-break"/><p>In the above example multiple commands are executed, two of which populate the
        <code class="code">ExecutionResults</code>. The query command defaults to use the same identifier as the
      query name, but it can also be mapped to a different identifier.</p><p>All commands support XML and jSON marshalling using XStream, as well as JAXB marshalling.
      This is covered in section <a class="link" href="#CommandsAPISection" title="11.1. API">Commands API</a>.
    </p></div><div class="section" title="4.2.4.7. StatelessKieSession"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3562"/>4.2.4.7. StatelessKieSession</h4></div></div></div><p>The <code class="code">StatelessKieSession</code> wraps the
    <code class="code">KieSession</code>, instead of extending it. Its main
    focus is on the decision service type scenarios. It avoids the need to call
    <code class="code">dispose()</code>. Stateless sessions do not support iterative
    insertions and the method call <code class="code">fireAllRules()</code> from Java code;
    the act of calling <code class="code">execute()</code> is a single-shot method that
    will internally instantiate a <code class="code">KieSession</code>, add
    all the user data and execute user commands, call
    <code class="code">fireAllRules()</code>, and then call <code class="code">dispose()</code>. While
    the main way to work with this class is via the
    <code class="code">BatchExecution</code> (a subinterface of <code class="code">Command</code>) as
    supported by the <code class="code">CommandExecutor</code> interface, two convenience
    methods are provided for when simple object insertion is all that's
    required. The <code class="code">CommandExecutor</code> and <code class="code">BatchExecution</code>
    are talked about in detail in their own section.</p><div class="figure"><a id="d0e3606"/><p class="title"><strong>Figure 4.24. StatelessKieSession</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/StatelessKieSession.png" alt="StatelessKieSession"/></div></div></div><br class="figure-break"/><p>Our simple example shows a stateless session executing a given
    collection of Java objects using the convenience API. It will iterate the
    collection, inserting each element in turn.</p><div class="example"><a id="d0e3614"/><p class="title"><strong>Example 4.24. Simple StatelessKieSession execution with a Collection</strong></p><div class="example-contents"><pre><code class="language-java">StatelessKieSession ksession = kbase.newStatelessKieSession();
ksession.execute( collection );</code></pre></div></div><br class="example-break"/><p>If this was done as a single Command it would be as follows:</p><div class="example"><a id="d0e3621"/><p class="title"><strong>Example 4.25. Simple StatelessKieSession execution with InsertElements Command</strong></p><div class="example-contents"><pre><code class="language-java">ksession.execute( CommandFactory.newInsertElements( collection ) );  </code></pre></div></div><br class="example-break"/><p>If you wanted to insert the collection itself, and the collection's
    individual elements, then
    <code class="code">CommandFactory.newInsert(collection)</code> would do the job.</p><p>Methods of the <code class="code">CommandFactory</code> create the supported
    commands, all of which can be marshalled using XStream and the
    <code class="code">BatchExecutionHelper</code>. <code class="code">BatchExecutionHelper</code>
    provides details on the XML format as well as how to use Drools Pipeline
    to automate the marshalling of <code class="code">BatchExecution</code> and
    <code class="code">ExecutionResults</code>.</p><p><code class="code">StatelessKieSession</code> supports globals, scoped in a
    number of ways. We cover the non-command way first, as commands are
    scoped to a specific execution call. Globals can be resolved in three
    ways.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The StatelessKieSession method <code class="code">getGlobals()</code>
        returns a Globals instance which provides access to the session's
        globals. These are shared for <span class="emphasis"><em>all</em></span> execution
        calls. Exercise caution regarding mutable globals because execution
        calls can be executing simultaneously in different threads.</p><div class="example"><a id="d0e3662"/><p class="title"><strong>Example 4.26. Session scoped global</strong></p><div class="example-contents"><pre><code class="language-java">StatelessKieSession ksession = kbase.newStatelessKieSession();
// Set a global hbnSession, that can be used for DB interactions in the rules.
ksession.setGlobal( "hbnSession", hibernateSession );
// Execute while being able to resolve the "hbnSession" identifier.
ksession.execute( collection ); </code></pre></div></div><br class="example-break"/></li><li class="listitem"><p>Using a delegate is another way of global resolution. Assigning
        a value to a global (with <code class="code">setGlobal(String, Object)</code>)
        results in the value being stored in an internal collection mapping
        identifiers to values. Identifiers in this internal collection will
        have priority over any supplied delegate. Only if an identifier cannot
        be found in this internal collection, the delegate global (if any)
        will be used.</p></li><li class="listitem"><p>The third way of resolving globals is to have execution scoped
        globals. Here, a <code class="code">Command</code> to set a global is passed to the
        <code class="code">CommandExecutor</code>.</p></li></ul></div><p>The <code class="code">CommandExecutor</code> interface also offers the ability
    to export data via "out" parameters. Inserted facts, globals and query
    results can all be returned.</p><div class="example"><a id="d0e3687"/><p class="title"><strong>Example 4.27. Out identifiers</strong></p><div class="example-contents"><pre><code class="language-java">// Set up a list of commands
List cmds = new ArrayList();
cmds.add( CommandFactory.newSetGlobal( "list1", new ArrayList(), true ) );
cmds.add( CommandFactory.newInsert( new Person( "jon", 102 ), "person" ) );
cmds.add( CommandFactory.newQuery( "Get People" "getPeople" );

// Execute the list
ExecutionResults results =
  ksession.execute( CommandFactory.newBatchExecution( cmds ) );

// Retrieve the ArrayList
results.getValue( "list1" );
// Retrieve the inserted Person fact
results.getValue( "person" );
// Retrieve the query as a QueryResults instance.
results.getValue( "Get People" );</code></pre></div></div><br class="example-break"/></div><div class="section" title="4.2.4.8. Marshalling"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3692"/>4.2.4.8. Marshalling</h4></div></div></div><p>The <code class="code">KieMarshallers</code> are used to marshal and unmarshal
    KieSessions.</p><div class="figure"><a id="d0e3700"/><p class="title"><strong>Figure 4.25. KieMarshallers</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/KieMarshallers.png" alt="KieMarshallers"/></div></div></div><br class="figure-break"/><p>An instance of the <code class="code">KieMarshallers</code> can be retrieved from the <code class="code">KieServices</code>.
    A simple example is shown below:</p><div class="example"><a id="d0e3714"/><p class="title"><strong>Example 4.28. Simple Marshaller Example</strong></p><div class="example-contents"><pre><code class="language-java">// ksession is the KieSession
// kbase is the KieBase
ByteArrayOutputStream baos = new ByteArrayOutputStream();
Marshaller marshaller = KieServices.Factory.get().getMarshallers().newMarshaller( kbase );
marshaller.marshall( baos, ksession );
baos.close();
</code></pre></div></div><br class="example-break"/><p>However, with marshalling, you will need more flexibility when dealing
    with referenced user data. To achieve this use the
    <code class="code">ObjectMarshallingStrategy</code> interface. Two implementations are
    provided, but users can implement their own. The two supplied strategies
    are <code class="code">IdentityMarshallingStrategy</code> and
    <code class="code">SerializeMarshallingStrategy</code>.
    <code class="code">SerializeMarshallingStrategy</code> is the default, as shown in the
    example above, and it just calls the <code class="code">Serializable</code> or
    <code class="code">Externalizable</code> methods on a user instance.
    <code class="code">IdentityMarshallingStrategy</code> creates an integer id for
    each user object and stores them in a Map, while the id is written to the
    stream. When unmarshalling it accesses the
    <code class="code">IdentityMarshallingStrategy</code> map to retrieve the instance.
    This means that if you use the <code class="code">IdentityMarshallingStrategy</code>,
    it is stateful for the life of the Marshaller instance and will create ids
    and keep references to all objects that it attempts to marshal. Below is
    the code to use an Identity Marshalling Strategy.</p><div class="example"><a id="d0e3748"/><p class="title"><strong>Example 4.29. IdentityMarshallingStrategy</strong></p><div class="example-contents"><pre><code class="language-java">ByteArrayOutputStream baos = new ByteArrayOutputStream();
KieMarshallers kMarshallers = KieServices.Factory.get().getMarshallers()
ObjectMarshallingStrategy oms = kMarshallers.newIdentityMarshallingStrategy()
Marshaller marshaller =
        kMarshallers.newMarshaller( kbase, new ObjectMarshallingStrategy[]{ oms } );
marshaller.marshall( baos, ksession );
baos.close();
</code></pre></div></div><br class="example-break"/><p>Im most cases, a single strategy is insufficient. For added flexibility, the
    <code class="code">ObjectMarshallingStrategyAcceptor</code> interface can be used.
    This Marshaller has a chain of strategies,
    and while reading or writing a user object it iterates the
    strategies asking if they accept responsibility for marshalling the user
    object. One of the provided implementations is
    <code class="code">ClassFilterAcceptor</code>. This allows strings and wild cards to be
    used to match class names. The default is "*.*", so in the above example
    the Identity Marshalling Strategy is used which has a default "*.*"
    acceptor.</p><p>Assuming that we want to serialize all classes except for one given
    package, where we will use identity lookup, we could do the
    following:</p><div class="example"><a id="d0e3763"/><p class="title"><strong>Example 4.30. IdentityMarshallingStrategy with Acceptor</strong></p><div class="example-contents"><pre><code class="language-java">ByteArrayOutputStream baos = new ByteArrayOutputStream();
KieMarshallers kMarshallers = KieServices.Factory.get().getMarshallers()
ObjectMarshallingStrategyAcceptor identityAcceptor =
        kMarshallers.newClassFilterAcceptor( new String[] { "org.domain.pkg1.*" } );
ObjectMarshallingStrategy identityStrategy =
        kMarshallers.newIdentityMarshallingStrategy( identityAcceptor );
ObjectMarshallingStrategy sms = kMarshallers.newSerializeMarshallingStrategy();
Marshaller marshaller =
        kMarshallers.newMarshaller( kbase,
                                    new ObjectMarshallingStrategy[]{ identityStrategy, sms } );
marshaller.marshall( baos, ksession );
baos.close();
</code></pre></div></div><br class="example-break"/><p>Note that the acceptance checking order is in the natural order of
    the supplied elements.</p><p>Also note that if you are using scheduled matches (i.e. some
    of your rules use timers or calendars) they are marshallable only if,
    before you use it, you configure your KieSession to use a
    trackable timer job factory manager as follows:</p><div class="example"><a id="d0e3772"/><p class="title"><strong>Example 4.31. Configuring a trackable timer job factory manager</strong></p><div class="example-contents"><pre><code class="language-java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
ksconf.setOption(TimerJobFactoryOption.get("trackable"));
KSession ksession = kbase.newKieSession(ksconf, null);</code></pre></div></div><br class="example-break"/></div><div class="section" title="4.2.4.9. Persistence and Transactions"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3777"/>4.2.4.9. Persistence and Transactions</h4></div></div></div><p>Longterm out of the box persistence with Java Persistence API (JPA)
    is possible with Drools. It is necessary to have some implementation of the
    Java Transaction API (JTA) installed. For development purposes
    the Bitronix Transaction Manager is suggested, as it's simple to set up and
    works embedded, but for production use JBoss Transactions is
    recommended.</p><div class="example"><a id="d0e3782"/><p class="title"><strong>Example 4.32. Simple example using transactions</strong></p><div class="example-contents"><pre><code class="language-java">KieServices kieServices = KieServices.Factory.get();
Environment env = kieServices.newEnvironment();
env.set( EnvironmentName.ENTITY_MANAGER_FACTORY,
         Persistence.createEntityManagerFactory( "emf-name" ) );
env.set( EnvironmentName.TRANSACTION_MANAGER,
         TransactionManagerServices.getTransactionManager() );

// KieSessionConfiguration may be null, and a default will be used
KieSession ksession =
        kieServices.getStoreServices().newKieSession( kbase, null, env );
int sessionId = ksession.getId();

UserTransaction ut =
  (UserTransaction) new InitialContext().lookup( "java:comp/UserTransaction" );
ut.begin();
ksession.insert( data1 );
ksession.insert( data2 );
ksession.startProcess( "process1" );
ut.commit();</code></pre></div></div><br class="example-break"/><p>To use a JPA, the Environment must be set with both the
    <code class="code">EntityManagerFactory</code> and the <code class="code">TransactionManager</code>.
    If rollback occurs the ksession state is also rolled back, hence it is possible
    to continue to use it after a rollback. To load a previously persisted
    KieSession you'll need the id, as shown below:</p><div class="example"><a id="d0e3795"/><p class="title"><strong>Example 4.33. Loading a KieSession</strong></p><div class="example-contents"><pre><code class="language-java">KieSession ksession =
        kieServices.getStoreServices().loadKieSession( sessionId, kbase, null, env );</code></pre></div></div><br class="example-break"/><p>To enable persistence several classes must be added to your
    persistence.xml, as in the example below:</p><div class="example"><a id="d0e3802"/><p class="title"><strong>Example 4.34. Configuring JPA</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;persistence-unit name="org.drools.persistence.jpa" transaction-type="JTA"&gt;
   &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;
   &lt;jta-data-source&gt;jdbc/BitronixJTADataSource&lt;/jta-data-source&gt;
   &lt;class&gt;org.drools.persistence.info.SessionInfo&lt;/class&gt;
   &lt;class&gt;org.drools.persistence.info.WorkItemInfo&lt;/class&gt;
   &lt;properties&gt;
         &lt;property name="hibernate.dialect" value="org.hibernate.dialect.H2Dialect"/&gt;
         &lt;property name="hibernate.max_fetch_depth" value="3"/&gt;
         &lt;property name="hibernate.hbm2ddl.auto" value="update" /&gt;
         &lt;property name="hibernate.show_sql" value="true" /&gt;
         &lt;property name="hibernate.transaction.manager_lookup_class"
                      value="org.hibernate.transaction.BTMTransactionManagerLookup" /&gt;
   &lt;/properties&gt;
&lt;/persistence-unit&gt;
</code></pre></div></div><br class="example-break"/><p>The jdbc JTA data source would have to be configured first. Bitronix
    provides a number of ways of doing this, and its documentation should be
    consulted for details. For a quick start, here is the programmatic
    approach:</p><div class="example"><a id="d0e3809"/><p class="title"><strong>Example 4.35. Configuring JTA DataSource</strong></p><div class="example-contents"><pre><code class="language-java">PoolingDataSource ds = new PoolingDataSource();
ds.setUniqueName( "jdbc/BitronixJTADataSource" );
ds.setClassName( "org.h2.jdbcx.JdbcDataSource" );
ds.setMaxPoolSize( 3 );
ds.setAllowLocalTransactions( true );
ds.getDriverProperties().put( "user", "sa" );
ds.getDriverProperties().put( "password", "sasa" );
ds.getDriverProperties().put( "URL", "jdbc:h2:mem:mydb" );
ds.init();
</code></pre></div></div><br class="example-break"/><p>Bitronix also provides a simple embedded JNDI service, ideal for
    testing. To use it, add a jndi.properties file to your META-INF folder and add the
    following line to it:</p><div class="example"><a id="d0e3816"/><p class="title"><strong>Example 4.36. JNDI properties</strong></p><div class="example-contents"><pre><code class="no-highlight">java.naming.factory.initial=bitronix.tm.jndi.BitronixInitialContextFactory
</code></pre></div></div><br class="example-break"/></div></div><div class="section" title="4.2.5. Installation and Deployment Cheat Sheets"><div class="titlepage"><div><div><h3 class="title"><a id="KIEDeployCheatSheets"/>4.2.5. Installation and Deployment Cheat Sheets</h3></div></div></div><div class="figure"><a id="d0e3824"/><p class="title"><strong>Figure 4.26. Installation Overview</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/cheatsheet1.png" alt="Installation Overview"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e3830"/><p class="title"><strong>Figure 4.27. Deployment Overview</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/kie/BuildDeployUtilizeAndRun/cheatsheet2.png" alt="Deployment Overview"/></div></div></div><br class="figure-break"/></div><div class="section" title="4.2.6. Build, Deploy and Utilize Examples"><div class="titlepage"><div><div><h3 class="title"><a id="KIEExamplesSection"/>4.2.6. Build,  Deploy and Utilize Examples</h3></div></div></div><p>The best way to learn the new build system is by example. The source project
    "drools-examples-api" contains a number of examples, and can be found at GitHub:</p><p><a class="link" href="https://github.com/droolsjbpm/drools/tree/6.0.x/drools-examples-api">https://github.com/droolsjbpm/drools/tree/6.0.x/drools-examples-api</a></p><p>Each example is described below, the order starts with the simplest (most of the options are defaulted) and working
    its way up to more complex use cases.</p><p>The Deploy use cases shown below all involve <code class="code">mvn install</code>. Remote deployment of JARs in
    Maven is well covered in Maven literature. Utilize refers to the initial act of loading the
    resources and providing access to the KIE runtimes. Where as Run refers to the act of
    interacting with those runtimes.</p><div class="section" title="4.2.6.1. Default KieSession"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3851"/>4.2.6.1. Default KieSession</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Project: default-kesession.</p></li><li class="listitem"><p>Summary: Empty kmodule.xml KieModule on the classpath that includes all resources in a
          single default KieBase. The example shows the retrieval of the default KieSession from
          the classpath.</p></li></ul></div><p>An empty kmodule.xml will produce a single KieBase that includes all files found under
      resources path, be it DRL, BPMN2, XLS etc. That single KieBase is the default and also
      includes a single default KieSession. Default means they can be created without knowing their
      names.</p><div class="example"><a id="d0e3863"/><p class="title"><strong>Example 4.37. Author - kmodule.xml</strong></p><div class="example-contents"><pre><code class="language-xml">
&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"&gt; &lt;/kmodule&gt;
  </code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e3868"/><p class="title"><strong>Example 4.38. Build and Install - Maven</strong></p><div class="example-contents"><pre><code class="no-highlight">mvn install</code></pre></div></div><br class="example-break"/><p>ks.getKieClasspathContainer() returns the KieContainer that contains the KieBases deployed
      onto the environment classpath. kContainer.newKieSession() creates the default KieSession.
      Notice that you no longer need to look up the KieBase, in order to create the KieSession. The
      KieSession knows which KieBase it's associated with, and use that, which in this case is the
      default KieBase.</p><div class="example"><a id="d0e3875"/><p class="title"><strong>Example 4.39. Utilize and Run - Java</strong></p><div class="example-contents"><pre><code class="language-java">
KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.getKieClasspathContainer();

KieSession kSession = kContainer.newKieSession();
kSession.setGlobal("out", out);
kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
kSession.fireAllRules();                
      </code></pre></div></div><br class="example-break"/><p/><p/></div><div class="section" title="4.2.6.2. Named KieSession"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3882"/>4.2.6.2. Named KieSession</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Project: named-kiesession.</p></li><li class="listitem"><p>Summary: kmodule.xml that has one named KieBase and one named KieSession. The examples
          shows the retrieval of the named KieSession from the classpath.</p></li></ul></div><p/><p>kmodule.xml will produce a single named KieBase, 'kbase1' that includes all files found
      under resources path, be it DRL, BPMN2, XLS etc. KieSession 'ksession1' is associated with
      that KieBase and can be created by name.</p><div class="example"><a id="d0e3895"/><p class="title"><strong>Example 4.40. Author - kmodule.xml</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"&gt;
    &lt;kbase name="kbase1"&gt;
        &lt;ksession name="ksession1"/&gt;
    &lt;/kbase&gt;
&lt;/kmodule&gt;</code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e3900"/><p class="title"><strong>Example 4.41. Build and Install - Maven</strong></p><div class="example-contents"><pre><code class="no-highlight">mvn install</code></pre></div></div><br class="example-break"/><p>ks.getKieClasspathContainer() returns the KieContainer that contains the KieBases deployed
      onto the environment classpath. This time the KieSession uses the name 'ksession1'. You do not
      need to lookup the KieBase first, as it knows which KieBase 'ksession1' is assocaited
      with.</p><div class="example"><a id="d0e3907"/><p class="title"><strong>Example 4.42. Utilize and Run - Java</strong></p><div class="example-contents"><pre><code class="language-java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.getKieClasspathContainer();

KieSession kSession = kContainer.newKieSession("ksession1");
kSession.setGlobal("out", out);
kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
kSession.fireAllRules();</code></pre></div></div><br class="example-break"/></div><div class="section" title="4.2.6.3. KieBase Inheritence"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3912"/>4.2.6.3. KieBase Inheritence</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Project: kiebase-inclusion.</p></li><li class="listitem"><p>Summary: 'kmodule.xml' demonstrates that one KieBase can include the resources from
          another KieBase, from another KieModule. In this case it inherits the named KieBase from
          the 'name-kiesession' example. The included KieBase can be from the current KieModule or
          any other KieModule that is in the pom.xml dependency list.</p></li></ul></div><p/><p>kmodule.xml will produce a single named KieBase, 'kbase2' that includes all files found
      under resources path, be it DRL, BPMN2, XLS etc. Further it will include all the resources
      found from the KieBase 'kbase1', due to the use of the 'includes' attribute. KieSession
      'ksession2' is associated with that KieBase and can be created by name.</p><div class="example"><a id="d0e3925"/><p class="title"><strong>Example 4.43. Author - kmodule.xml</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;kbase name="kbase2" includes="kbase1"&gt;
    &lt;ksession name="ksession2"/&gt;
&lt;/kbase&gt;</code></pre></div></div><br class="example-break"/><p>This example requires that the previous example, 'named-kiesession', is built and installed
      to the local Maven repository first. Once installed it can be included as a dependency, using
      the standard Maven &lt;dependencies&gt; element.</p><div class="example"><a id="d0e3932"/><p class="title"><strong>Example 4.44. Author - pom.xml</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;parent&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-examples-api&lt;/artifactId&gt;
    &lt;version&gt;6.0.0/version&gt;
  &lt;/parent&gt;

  &lt;artifactId&gt;kiebase-inclusion&lt;/artifactId&gt;
  &lt;name&gt;Drools API examples - KieBase Inclusion&lt;/name&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.drools&lt;/groupId&gt;
      &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.drools&lt;/groupId&gt;
      &lt;artifactId&gt;named-kiesession&lt;/artifactId&gt;
      &lt;version&gt;6.0.0&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

&lt;/project&gt;</code></pre></div></div><br class="example-break"/><p>Once 'named-kiesession' is built and installed this example can be built and installed as
      normal. Again the act of installing, will force the unit tests to run, demonstrating the use
      case.</p><div class="example"><a id="d0e3939"/><p class="title"><strong>Example 4.45. Build and Install - Maven</strong></p><div class="example-contents"><pre><code class="no-highlight">mvn install</code></pre></div></div><br class="example-break"/><p>ks.getKieClasspathContainer() returns the KieContainer that contains the KieBases deployed
      onto the environment classpath. This time the KieSession uses the name 'ksession2'. You do not
      need to lookup the KieBase first, as it knows which KieBase 'ksession1' is assocaited with.
      Notice two rules fire this time, showing that KieBase 'kbase2' has included the resources from
      the dependency KieBase 'kbase1'.</p><div class="example"><a id="d0e3946"/><p class="title"><strong>Example 4.46. Utilize and Run - Java</strong></p><div class="example-contents"><pre><code class="language-java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.getKieClasspathContainer();
KieSession kSession = kContainer.newKieSession("ksession2");
kSession.setGlobal("out", out);

kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
kSession.fireAllRules();

kSession.insert(new Message("Dave", "Open the pod bay doors, HAL."));
kSession.fireAllRules();</code></pre></div></div><br class="example-break"/></div><div class="section" title="4.2.6.4. Multiple KieBases"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3951"/>4.2.6.4. Multiple KieBases</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Project: 'multiple-kbases.</p></li><li class="listitem"><p>Summary: Demonstrates that the 'kmodule.xml'  can contain any number of KieBase or
          KieSession declarations. Introduces the 'packages' attribute to select the folders for the
          resources to be included in the KieBase.</p></li></ul></div><p>kmodule.xml produces 6 different named KieBases. 'kbase1' includes all resources from the
      KieModule. The other KieBases include resources from other selected folders, via the
      'packages' attribute. Note the use of wildcard '*', to select this package and all packages
      below it. </p><div class="example"><a id="d0e3963"/><p class="title"><strong>Example 4.47. Author - kmodule.xml</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"&gt;

  &lt;kbase name="kbase1"&gt;
    &lt;ksession name="ksession1"/&gt;
  &lt;/kbase&gt;

  &lt;kbase name="kbase2" packages="org.some.pkg"&gt;
    &lt;ksession name="ksession2"/&gt;
  &lt;/kbase&gt;

  &lt;kbase name="kbase3" includes="kbase2" packages="org.some.pkg2"&gt;
    &lt;ksession name="ksession3"/&gt;
  &lt;/kbase&gt;

  &lt;kbase name="kbase4" packages="org.some.pkg, org.other.pkg"&gt;
    &lt;ksession name="ksession4"/&gt;
  &lt;/kbase&gt;

  &lt;kbase name="kbase5" packages="org.*"&gt;
    &lt;ksession name="ksession5"/&gt;
  &lt;/kbase&gt;

  &lt;kbase name="kbase6" packages="org.some.*"&gt;
    &lt;ksession name="ksession6"/&gt;
  &lt;/kbase&gt;
&lt;/kmodule&gt;</code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e3968"/><p class="title"><strong>Example 4.48. Build and Install - Maven</strong></p><div class="example-contents"><pre><code class="no-highlight">mvn install</code></pre></div></div><br class="example-break"/><p>Only part of the example is included below, as there is a test method per KieSession, but
      each one is a repetition of the other, with different list expectations.</p><div class="example"><a id="d0e3975"/><p class="title"><strong>Example 4.49. Utilize and Run - Java</strong></p><div class="example-contents"><pre><code class="language-java">@Test
public void testSimpleKieBase() {
    List&lt;Integer&gt; list = useKieSession("ksession1");
    // no packages imported means import everything
    assertEquals(4, list.size());
    assertTrue( list.containsAll( asList(0, 1, 2, 3) ) );
}

//.. other tests for ksession2 to ksession6 here

private List&lt;Integer&gt; useKieSession(String name) {
    KieServices ks = KieServices.Factory.get();
    KieContainer kContainer = ks.getKieClasspathContainer();
    KieSession kSession = kContainer.newKieSession(name);

    List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;();
    kSession.setGlobal("list", list);
    kSession.insert(1);
    kSession.fireAllRules();

    return list;
}</code></pre></div></div><br class="example-break"/></div><div class="section" title="4.2.6.5. KieContainer from KieRepository"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3980"/>4.2.6.5. KieContainer from KieRepository</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Project: kcontainer-from-repository</p></li><li class="listitem"><p>Summary: The project does not contain a kmodule.xml, nor does the pom.xml have any
          dependencies for other KieModules. Instead the Java code demonstrates the loading of a
          dynamic KieModule from a Maven repository. </p></li></ul></div><p>The pom.xml must include kie-ci as a depdency, to ensure Maven is available at runtime.
      As this uses Maven under the hood you can also use the standard Maven settings.xml
      file.</p><div class="example"><a id="d0e3992"/><p class="title"><strong>Example 4.50. Author - pom.xml</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;parent&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-examples-api&lt;/artifactId&gt;
    &lt;version&gt;6.0.0&lt;/version&gt;
  &lt;/parent&gt;

  &lt;artifactId&gt;kiecontainer-from-kierepo&lt;/artifactId&gt;
  &lt;name&gt;Drools API examples - KieContainer from KieRepo&lt;/name&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.kie&lt;/groupId&gt;
      &lt;artifactId&gt;kie-ci&lt;/artifactId&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

&lt;/project&gt;</code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e3997"/><p class="title"><strong>Example 4.51. Build and Install - Maven</strong></p><div class="example-contents"><pre><code class="no-highlight">mvn install</code></pre></div></div><br class="example-break"/><p>In the previous examples the classpath KieContainer used. This example creates a dynamic
      KieContainer as specified by the  ReleaseId. The ReleaseId uses Maven conventions for group
      id, artifact id and version. It also obeys LATEST and SNAPSHOT for versions.</p><div class="example"><a id="d0e4004"/><p class="title"><strong>Example 4.52. Utilize and Run - Java</strong></p><div class="example-contents"><pre><code class="language-java">KieServices ks = KieServices.Factory.get();

// Install example1 in the local Maven repo before to do this
KieContainer kContainer = ks.newKieContainer(ks.newReleaseId("org.drools", "named-kiesession", "6.0.0-SNAPSHOT"));

KieSession kSession = kContainer.newKieSession("ksession1");
kSession.setGlobal("out", out);

Object msg1 = createMessage(kContainer, "Dave", "Hello, HAL. Do you read me, HAL?");
kSession.insert(msg1);
kSession.fireAllRules();</code></pre></div></div><br class="example-break"/></div><div class="section" title="4.2.6.6. Default KieSession from File"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4009"/>4.2.6.6. Default KieSession from File</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Project: default-kiesession-from-file</p></li><li class="listitem"><p>Summary: Dynamic KieModules can also be loaded from any Resource location. The loaded
          KieModule provides default KieBase and KieSession definitions.</p></li></ul></div><p>No kmodue.xml file exists. The project 'default-kiesession' must be built first, so that
      the resulting JAR, in the target folder, can be referenced as a File.</p><div class="example"><a id="d0e4021"/><p class="title"><strong>Example 4.53. Build and Install - Maven</strong></p><div class="example-contents"><pre><code class="no-highlight">mvn install</code></pre></div></div><br class="example-break"/><p>Any KieModule can be loaded from a Resource location and added to the KieRepository. Once
      deployed in the KieRepository it can be resolved via its ReleaseId. Note neither Maven or kie-ci are
      needed here. It will not set up a transitive dependency parent classloader.</p><div class="example"><a id="d0e4028"/><p class="title"><strong>Example 4.54. Utilize and Run - Java</strong></p><div class="example-contents"><pre><code class="language-java">KieServices ks = KieServices.Factory.get();
KieRepository kr = ks.getRepository();

KieModule kModule = kr.addKieModule(ks.getResources().newFileSystemResource(getFile("default-kiesession")));

KieContainer kContainer = ks.newKieContainer(kModule.getReleaseId());

KieSession kSession = kContainer.newKieSession();
kSession.setGlobal("out", out);

Object msg1 = createMessage(kContainer, "Dave", "Hello, HAL. Do you read me, HAL?");
kSession.insert(msg1);
kSession.fireAllRules();</code></pre></div></div><br class="example-break"/></div><div class="section" title="4.2.6.7. Named KieSession from File"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4033"/>4.2.6.7. Named KieSession from File</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Project: named-kiesession-from-file</p></li><li class="listitem"><p>Summary: Dynamic KieModules can also be loaded from any Resource location. The loaded
          KieModule provides named KieBase and KieSession definitions.</p></li></ul></div><p>No kmodue.xml file exists. The project 'named-kiesession' must be built first, so that the
      resulting JAR, in the target folder, can be referenced as a File.</p><div class="example"><a id="d0e4045"/><p class="title"><strong>Example 4.55. Build and Install - Maven</strong></p><div class="example-contents"><pre><code class="no-highlight">mvn install</code></pre></div></div><br class="example-break"/><p>Any KieModule can be loaded from a Resource location and added to the KieRepository. Once
      in the KieRepository it can be resolved via its ReleaseId. Note neither Maven or kie-ci are
      needed here. It will not setup a transitive dependency parent classloader.</p><div class="example"><a id="d0e4052"/><p class="title"><strong>Example 4.56. Utilize and Run - Java</strong></p><div class="example-contents"><pre><code class="language-java">KieServices ks = KieServices.Factory.get();
KieRepository kr = ks.getRepository();

KieModule kModule = kr.addKieModule(ks.getResources().newFileSystemResource(getFile("named-kiesession")));

KieContainer kContainer = ks.newKieContainer(kModule.getReleaseId());

KieSession kSession = kContainer.newKieSession("ksession1");
kSession.setGlobal("out", out);

Object msg1 = createMessage(kContainer, "Dave", "Hello, HAL. Do you read me, HAL?");
kSession.insert(msg1);
kSession.fireAllRules();</code></pre></div></div><br class="example-break"/></div><div class="section" title="4.2.6.8. KieModule with Dependent KieModule"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4057"/>4.2.6.8. KieModule with Dependent KieModule</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Project: kie-module-form-multiple-files</p></li><li class="listitem"><p>Summary: Programmatically provide the list of dependant KieModules, without using Maven
          to resolve anything.</p></li></ul></div><p>No kmodue.xml file exists. The projects 'named-kiesession' and 'kiebase-include' must be
      built first, so that the resulting JARs, in the target folders, can be referenced as
      Files.</p><div class="example"><a id="d0e4069"/><p class="title"><strong>Example 4.57. Build and Install - Maven</strong></p><div class="example-contents"><pre><code class="no-highlight">mvn install</code></pre></div></div><br class="example-break"/><p>Creates two resources. One is for the main KieModule 'exRes1' the other is for the
      dependency 'exRes2'. Even though kie-ci is not present and thus Maven is not available to resolve
      the dependencies, this shows how you can manually specify the dependent KieModules, for the
      vararg.</p><div class="example"><a id="d0e4076"/><p class="title"><strong>Example 4.58. Utilize and Run - Java</strong></p><div class="example-contents"><pre><code class="language-java">KieServices ks = KieServices.Factory.get();
KieRepository kr = ks.getRepository();

Resource ex1Res = ks.getResources().newFileSystemResource(getFile("kiebase-inclusion"));
Resource ex2Res = ks.getResources().newFileSystemResource(getFile("named-kiesession"));

KieModule kModule = kr.addKieModule(ex1Res, ex2Res);
KieContainer kContainer = ks.newKieContainer(kModule.getReleaseId());

KieSession kSession = kContainer.newKieSession("ksession2");
kSession.setGlobal("out", out);

Object msg1 = createMessage(kContainer, "Dave", "Hello, HAL. Do you read me, HAL?");
kSession.insert(msg1);
kSession.fireAllRules();

Object msg2 = createMessage(kContainer, "Dave", "Open the pod bay doors, HAL.");
kSession.insert(msg2);
kSession.fireAllRules();</code></pre></div></div><br class="example-break"/></div><div class="section" title="4.2.6.9. Programmaticaly build a Simple KieModule with Defaults"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4081"/>4.2.6.9. Programmaticaly build a Simple KieModule with Defaults</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Project: kiemoduelmodel-example</p></li><li class="listitem"><p>Summary: Programmaticaly buid a KieModule from just a single file. The POM and models
          are all defaulted. This is the quickest out of the box approach, but should not be added
          to a Maven repository.</p></li></ul></div><div class="example"><a id="d0e4091"/><p class="title"><strong>Example 4.59. Build and Install - Maven</strong></p><div class="example-contents"><pre><code class="no-highlight">mvn install</code></pre></div></div><br class="example-break"/><p>This programmatically builds a KieModule. It populates the model that represents the
      ReleaseId and  kmodule.xml, and it adds the relevant resources. A pom.xml is generated from
      the ReleaseId.</p><div class="example"><a id="d0e4098"/><p class="title"><strong>Example 4.60. Utilize and Run - Java</strong></p><div class="example-contents"><pre><code class="language-java">KieServices ks = KieServices.Factory.get();
KieRepository kr = ks.getRepository();
KieFileSystem kfs = ks.newKieFileSystem();

kfs.write("src/main/resources/org/kie/example5/HAL5.drl", getRule());

KieBuilder kb = ks.newKieBuilder(kfs);

kb.buildAll(); // kieModule is automatically deployed to KieRepository if successfully built.
if (kb.getResults().hasMessages(Level.ERROR)) {
    throw new RuntimeException("Build Errors:\n" + kb.getResults().toString());
}

KieContainer kContainer = ks.newKieContainer(kr.getDefaultReleaseId());

KieSession kSession = kContainer.newKieSession();
kSession.setGlobal("out", out);

kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
kSession.fireAllRules();</code></pre></div></div><br class="example-break"/></div><div class="section" title="4.2.6.10. Programmaticaly build a KieModule using Meta Models"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4103"/>4.2.6.10. Programmaticaly build a KieModule using Meta Models</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Project: kiemoduelmodel-example</p></li><li class="listitem"><p>Summary: Programmaticaly build a KieModule, by creating its kmodule.xml meta model
          resources. </p></li></ul></div><div class="example"><a id="d0e4113"/><p class="title"><strong>Example 4.61. Build and Install - Maven</strong></p><div class="example-contents"><pre><code class="no-highlight">mvn install</code></pre></div></div><br class="example-break"/><p>This programmatically builds a KieModule. It populates the model that represents the
      ReleaseId and  kmodule.xml, as well as add the relevant resources. A pom.xml is generated from
      the ReleaseId.</p><div class="example"><a id="d0e4120"/><p class="title"><strong>Example 4.62. Utilize and Run - Java</strong></p><div class="example-contents"><pre><code class="language-java">KieServices ks = KieServices.Factory.get();
KieFileSystem kfs = ks.newKieFileSystem();

Resource ex1Res = ks.getResources().newFileSystemResource(getFile("named-kiesession"));
Resource ex2Res = ks.getResources().newFileSystemResource(getFile("kiebase-inclusion"));

ReleaseId rid = ks.newReleaseId("org.drools", "kiemodulemodel-example", "6.0.0-SNAPSHOT");
kfs.generateAndWritePomXML(rid);

KieModuleModel kModuleModel = ks.newKieModuleModel();
kModuleModel.newKieBaseModel("kiemodulemodel")
            .addInclude("kiebase1")
            .addInclude("kiebase2")
            .newKieSessionModel("ksession6");

kfs.writeKModuleXML(kModuleModel.toXML());
kfs.write("src/main/resources/kiemodulemodel/HAL6.drl", getRule());

KieBuilder kb = ks.newKieBuilder(kfs);
kb.setDependencies(ex1Res, ex2Res);
kb.buildAll(); // kieModule is automatically deployed to KieRepository if successfully built.
if (kb.getResults().hasMessages(Level.ERROR)) {
    throw new RuntimeException("Build Errors:\n" + kb.getResults().toString());
}

KieContainer kContainer = ks.newKieContainer(rid);

KieSession kSession = kContainer.newKieSession("ksession6");
kSession.setGlobal("out", out);

Object msg1 = createMessage(kContainer, "Dave", "Hello, HAL. Do you read me, HAL?");
kSession.insert(msg1);
kSession.fireAllRules();

Object msg2 = createMessage(kContainer, "Dave", "Open the pod bay doors, HAL.");
kSession.insert(msg2);
kSession.fireAllRules();

Object msg3 = createMessage(kContainer, "Dave", "What's the problem?");
kSession.insert(msg3);
kSession.fireAllRules();</code></pre></div></div><br class="example-break"/></div></div></div><div class="section" title="4.3. Security"><div class="titlepage"><div><div><h2 class="title"><a id="KIESecuritySection"/>4.3. Security</h2></div></div></div><div class="section" title="4.3.1. Security Manager"><div class="titlepage"><div><div><h3 class="title"><a id="SecurityManager"/>4.3.1. Security Manager</h3></div></div></div><p>The KIE engine is a platform for the modelling and execution of business behavior, using a multitude of
    declarative abstractions and metaphores, like rules, processes, decision tables and etc.</p><p>Many times, the authoring of these metaphores is done by third party groups, be it a different group inside the
    same company, a group from a partner company, or even anonymous third parties on the internet. </p><p>Rules and Processes are designed to execute arbitrary code in order to do their job, but in such cases it might
    be necessary to constrain what they can do. For instance, it is unlikely a rule should be allowed to create a
    classloader (what could open the system to an attack) and certainly it should not be allowed to make a call to
      <code class="code">System.exit()</code>.</p><p>The Java Platform provides a very comprehensive and well defined security framework that allows users to define
    policies for what a system can do. The KIE platform leverages that framework and allow application developers to
    define a specific policy to be applied to any execution of user provided code, be it in rules, processes, work item
    handlers and etc.</p><div class="section" title="4.3.1.1. How to define a KIE Policy"><div class="titlepage"><div><div><h4 class="title"><a id="HowToDefineKiePolicy"/>4.3.1.1. How to define a KIE Policy</h4></div></div></div><p>Rules and processes can run with very restrict permissions, but the engine itself needs to perform many
      complex operations in order to work. Examples are: it needs to create classloaders, read system properties, access
      the file system, etc. </p><p>Once a security manager is installed, though, it will apply restrictions to all the code executing in the JVM
      according to the defined policy. For that reason, KIE allows the user to define two different policy files: one
      for the engine itself and one for the assets deployed into and executed by the engine.</p><p>One easy way to setup the enviroment is to give the engine itself a very permissive policy, while providing a
      constrained policy for rules and processes. </p><p>Policy files follow the standard policy file syntax as described in the Java documentation. For more details,
      see:</p><p>http://docs.oracle.com/javase/6/docs/technotes/guides/security/PolicyFiles.html#FileSyntax</p><p>A permissive policy file for the engine can look like the following:</p><div class="example"><a id="d0e4158"/><p class="title"><strong>Example 4.63. A sample engine.policy file</strong></p><div class="example-contents"><pre><code class="no-highlight">grant { 
    permission java.security.AllPermission;
}</code></pre></div></div><br class="example-break"/><p>An example security policy for rules could be:</p><div class="example"><a id="d0e4165"/><p class="title"><strong>Example 4.64. A sample rules.policy file</strong></p><div class="example-contents"><pre><code class="no-highlight">grant { 
    permission java.util.PropertyPermission "*", "read"; 
    permission java.lang.RuntimePermission "accessDeclaredMembers"; 
}</code></pre></div></div><br class="example-break"/><p>Please note that depending on what the rules and processes are supposed to do, many more permissions might
      need to be granted, like accessing files in the filesystem, databases, etc.</p><p>In order to use these policy files, all that is necessary is to execute the application with these files as
      parameters to the JVM. Three parameters are required:</p><p>
      </p><div class="table"><a id="d0e4176"/><p class="title"><strong>Table 4.3. Parameters</strong></p><div class="table-contents"><table summary="Parameters" border="1"><colgroup><col width="1.0*" class="c1"/><col width="1.0*" class="c2"/></colgroup><thead><tr><th>Parameter</th><th>Meaning</th></tr></thead><tbody><tr><td>
                <p>-Djava.security.manager</p>
              </td><td>Enables the security manager</td></tr><tr><td>
                <p>-Djava.security.policy=&lt;jvm_policy_file&gt;</p>
              </td><td>Defines the global policy file to be applied to the whole application, including the engine</td></tr><tr><td>
                <p>-Dkie.security.policy=&lt;kie_policy_file&gt;</p>
              </td><td>Defines the policy file to be applied to rules and processes</td></tr></tbody></table></div></div><p><br class="table-break"/>
    </p><p>For instance:</p><p><code class="code">java -Djava.security.manager -Djava.security.policy=global.policy -Dkie.security.policy=rules.policy
        foo.bar.MyApp</code></p><p/><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>When executing the engine inside a container, use your container's documentation to find out how to
        configure the Security Manager and how to define the global security policy. Define the kie security policy as
        described above and set the <code class="code">kie.security.policy</code> system property in order to configure the engine to
        use it.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Please note that unless a Security Manager is configured, the <code class="code">kie.security.policy</code> will be
        ignored.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>A Security Manager has a high performance impact in the JVM. Applications with strict performance
        requirements are strongly discouraged of using a Security Manager. An alternative is the use of other security
        procedures like the auditing of rules/processes before testing and deployment to prevent malicious code from
        being deployed to the environment.</p></div></div></div></div></div></div><div class="part" title="Part III. Drools Runtime and Language"><div class="titlepage"><div><div><h1 class="title"><a id="d0e4235"/>Part III. Drools Runtime and Language</h1></div></div></div><div class="partintro" title="Drools Runtime and Language"><div/><p>Drools is a powerful Hybrid Reasoning System. </p><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="chapter"><a href="#HybridReasoningChapter">5. Hybrid Reasoning</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4244">5.1. Artificial Intelligence</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4247">5.1.1. A Little History</a></span></dt><dt><span class="section"><a href="#d0e4333">5.1.2. Knowledge Representation and Reasoning</a></span></dt><dt><span class="section"><a href="#d0e4344">5.1.3. Rule Engines and Production Rule Systems (PRS)</a></span></dt><dt><span class="section"><a href="#d0e4429">5.1.4. Hybrid Reasoning Systems (HRS)</a></span></dt><dt><span class="section"><a href="#d0e4462">5.1.5. Expert Systems</a></span></dt><dt><span class="section"><a href="#d0e4486">5.1.6. Recommended Reading</a></span></dt></dl></dd><dt><span class="section"><a href="#ReteOO">5.2. Rete Algorithm</a></span></dt><dt><span class="section"><a href="#ReteOOSection">5.3. ReteOO Algorithm</a></span></dt><dt><span class="section"><a href="#PHREAK">5.4. PHREAK Algorithm</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e4870">6. User Guide</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4873">6.1. The Basics</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4876">6.1.1. Stateless Knowledge Session</a></span></dt><dt><span class="section"><a href="#d0e5038">6.1.2. Stateful Knowledge Session</a></span></dt><dt><span class="section"><a href="#d0e5213">6.1.3. Methods versus Rules</a></span></dt><dt><span class="section"><a href="#d0e5245">6.1.4. Cross Products</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5270">6.2. Execution Control</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5273">6.2.1. Agenda</a></span></dt><dt><span class="section"><a href="#d0e5306">6.2.2. Rule Matches and Conflict Sets.</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5518">6.3. Inference</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5521">6.3.1. Bus Pass Example</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5589">6.4. Truth Maintenance with  Logical Objects</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5596">6.4.1. Overview</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5713">6.5. Decision Tables in Spreadsheets</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5725">6.5.1. When to Use Decision Tables</a></span></dt><dt><span class="section"><a href="#d0e5743">6.5.2. Overview</a></span></dt><dt><span class="section"><a href="#d0e5785">6.5.3. How Decision Tables Work</a></span></dt><dt><span class="section"><a href="#d0e5871">6.5.4. Spreadsheet Syntax</a></span></dt><dt><span class="section"><a href="#d0e6396">6.5.5. Creating and integrating Spreadsheet based Decision Tables</a></span></dt><dt><span class="section"><a href="#d0e6417">6.5.6. Managing Business Rules in Decision Tables</a></span></dt><dt><span class="section"><a href="#d0e6464">6.5.7. Rule Templates</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e6567">6.6. Logging</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e6607">7. Running</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6612">7.1. KieRuntime</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6615">7.1.1. EntryPoint</a></span></dt><dt><span class="section"><a href="#d0e6790">7.1.2. RuleRuntime</a></span></dt><dt><span class="section"><a href="#d0e6849">7.1.3. StatefulRuleSession</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e6889">7.2. Agenda</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6926">7.2.1. Conflict Resolution</a></span></dt><dt><span class="section"><a href="#d0e6942">7.2.2. AgendaGroup</a></span></dt><dt><span class="section"><a href="#d0e6974">7.2.3. ActivationGroup</a></span></dt><dt><span class="section"><a href="#d0e6990">7.2.4. RuleFlowGroup</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e7006">7.3. Event Model</a></span></dt><dt><span class="section"><a href="#d0e7084">7.4. StatelessKieSession</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7214">7.4.1. Sequential Mode</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e7279">7.5. Rule Execution Modes</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7286">7.5.1. Passive Mode</a></span></dt><dt><span class="section"><a href="#d0e7301">7.5.2. Active Mode</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e7377">7.6. Propagation modes</a></span></dt><dt><span class="section"><a href="#d0e7429">7.7. Commands and the CommandExecutor</a></span></dt></dl></dd><dt><span class="chapter"><a href="#DroolsLanguageReferenceChapter">8. Rule Language Reference</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7602">8.1. Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7610">8.1.1. A rule file</a></span></dt><dt><span class="section"><a href="#d0e7643">8.1.2. What makes a rule</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e7679">8.2. Keywords</a></span></dt><dt><span class="section"><a href="#d0e7874">8.3. Comments</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7879">8.3.1. Single line comment</a></span></dt><dt><span class="section"><a href="#d0e7889">8.3.2. Multi-line comment</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e7902">8.4. Error Messages</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7907">8.4.1. Message format</a></span></dt><dt><span class="section"><a href="#d0e7938">8.4.2. Error Messages Description</a></span></dt><dt><span class="section"><a href="#d0e8093">8.4.3. Other Messages</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e8098">8.5. Package</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8121">8.5.1. import</a></span></dt><dt><span class="section"><a href="#d0e8135">8.5.2. global</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e8178">8.6. Function</a></span></dt><dt><span class="section"><a href="#d0e8212">8.7. Type Declaration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8240">8.7.1. Declaring New Types</a></span></dt><dt><span class="section"><a href="#d0e8397">8.7.2. Declaring Metadata</a></span></dt><dt><span class="section"><a href="#d0e8758">8.7.3. Declaring Metadata for Existing Types</a></span></dt><dt><span class="section"><a href="#d0e8801">8.7.4. Parametrized constructors for declared types</a></span></dt><dt><span class="section"><a href="#d0e8825">8.7.5. Non Typesafe Classes</a></span></dt><dt><span class="section"><a href="#d0e8830">8.7.6. Accessing Declared Types from the Application Code</a></span></dt><dt><span class="section"><a href="#d0e8879">8.7.7. Type Declaration 'extends'</a></span></dt><dt><span class="section"><a href="#d0e8911">8.7.8. Traits</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e9154">8.8. Rule</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e9196">8.8.1. Rule Attributes</a></span></dt><dt><span class="section"><a href="#d0e9356">8.8.2. Timers and Calendars</a></span></dt><dt><span class="section"><a href="#d0e9456">8.8.3. Left Hand Side (when) syntax</a></span></dt><dt><span class="section"><a href="#d0e11687">8.8.4. The Right Hand Side (then)</a></span></dt><dt><span class="section"><a href="#d0e11934">8.8.5. Conditional named consequences</a></span></dt><dt><span class="section"><a href="#d0e11959">8.8.6. A Note on Auto-boxing and Primitive Types</a></span></dt></dl></dd><dt><span class="section"><a href="#QuerySection">8.9. Query</a></span></dt><dt><span class="section"><a href="#d0e12041">8.10. Domain Specific Languages</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12051">8.10.1. When to Use a DSL</a></span></dt><dt><span class="section"><a href="#d0e12058">8.10.2. DSL Basics</a></span></dt><dt><span class="section"><a href="#d0e12127">8.10.3. Adding Constraints to Facts</a></span></dt><dt><span class="section"><a href="#d0e12171">8.10.4. Developing a DSL</a></span></dt><dt><span class="section"><a href="#d0e12184">8.10.5. DSL and DSLR Reference</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#DroolsComplexEventProcessingChapter">9. Complex Event Processing</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12392">9.1. Complex Event Processing</a></span></dt><dt><span class="section"><a href="#d0e12443">9.2. Drools Fusion</a></span></dt><dt><span class="section"><a href="#d0e12545">9.3. Event Semantics</a></span></dt><dt><span class="section"><a href="#d0e12597">9.4. Event Processing Modes</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12604">9.4.1. Cloud Mode</a></span></dt><dt><span class="section"><a href="#d0e12635">9.4.2. Stream Mode</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e12715">9.5. Session Clock</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12746">9.5.1. Available Clock Implementations</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e12773">9.6. Sliding Windows</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12786">9.6.1. Sliding Time Windows</a></span></dt><dt><span class="section"><a href="#d0e12809">9.6.2. Sliding Length Windows</a></span></dt><dt><span class="section"><a href="#d0e12845">9.6.3. Window Declaration</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e12866">9.7. Streams Support</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12888">9.7.1. Declaring and Using Entry Points</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e12922">9.8. Memory Management for Events</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12940">9.8.1. Explicit expiration offset</a></span></dt><dt><span class="section"><a href="#d0e12958">9.8.2. Inferred expiration offset</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e12978">9.9. Temporal Reasoning</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e13050">9.9.1. Temporal Operators</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ExperimentalFeaturesChapter">10. Experimental Features</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e13520">10.1. Declarative Agenda</a></span></dt><dt><span class="section"><a href="#d0e13581">10.2. Browsing graphs of objects with OOPath</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e13688">10.2.1. Reactive and Non-Reactive OOPath</a></span></dt></dl></dd></dl></dd></dl></div></div><div class="chapter" title="Chapter 5. Hybrid Reasoning"><div class="titlepage"><div><div><h2 class="title"><a id="HybridReasoningChapter"/>Chapter 5. Hybrid Reasoning</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e4244">5.1. Artificial Intelligence</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4247">5.1.1. A Little History</a></span></dt><dt><span class="section"><a href="#d0e4333">5.1.2. Knowledge Representation and Reasoning</a></span></dt><dt><span class="section"><a href="#d0e4344">5.1.3. Rule Engines and Production Rule Systems (PRS)</a></span></dt><dt><span class="section"><a href="#d0e4429">5.1.4. Hybrid Reasoning Systems (HRS)</a></span></dt><dt><span class="section"><a href="#d0e4462">5.1.5. Expert Systems</a></span></dt><dt><span class="section"><a href="#d0e4486">5.1.6. Recommended Reading</a></span></dt></dl></dd><dt><span class="section"><a href="#ReteOO">5.2. Rete Algorithm</a></span></dt><dt><span class="section"><a href="#ReteOOSection">5.3. ReteOO Algorithm</a></span></dt><dt><span class="section"><a href="#PHREAK">5.4. PHREAK Algorithm</a></span></dt></dl></div><div class="section" title="5.1. Artificial Intelligence"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4244"/>5.1. Artificial Intelligence</h2></div></div></div><div class="section" title="5.1.1. A Little History"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4247"/>5.1.1. A Little History</h3></div></div></div><p>Over the last few decades <em class="firstterm">artificial
    intelligence</em> (AI) became an unpopular term, with the well-known
    <a class="link" href="http://en.wikipedia.org/wiki/AI_winter">"AI
    Winter"</a>. There were large boasts from scientists and engineers
    looking for funding, which never lived up to expectations, resulting in many
    failed projects. <a class="link" href="http://en.wikipedia.org/wiki/Thinking_Machines_Corporation">Thinking
    Machines Corporation</a> and the <a class="link" href="http://en.wikipedia.org/wiki/Fifth-generation_computer">5th
    Generation Computer</a> (5GP) project probably exemplify best the
    problems at the time.</p><p>Thinking Machines Corporation was one of the leading AI firms in
    1990, it had sales of nearly $65 million. Here is a quote from its
    brochure:</p><p><span class="quote">“<span class="quote">Some day we will build a thinking machine. It will be a truly
    intelligent machine. One that can see and hear and speak. A machine that
    will be proud of us.</span>”</span></p><p>Yet 5 years later it filed for bankruptcy protection under Chapter 11. 
    The site inc.com has a fascinating article titled <a class="link" href="http://www.inc.com/magazine/19950915/2622.html">"The Rise and
    Fall of Thinking Machines"</a>. The article covers the growth of the
    industry and how a cosy relationship with Thinking Machines and <a class="link" href="http://en.wikipedia.org/wiki/DARPA">DARPA</a> over-heated
    the market, to the point of collapse. It explains how and why commerce
    moved away from AI and towards more practical number-crunching super
    computers.</p><p>The 5th Generation Computer project was a USD 400 million project in Japan to build a next generation
      computer. Valves (or Tubes) was the first generation, transistors the second, integrated circuits the third and
      finally microprocessors was the fourth. The fifth was intended to be a machine capable of effective Artificial
      Intelligence. This project spurred an "arms" race with the UK and USA, that caused much of the AI bubble. The 5GP
      would provide massive multi-cpu parallel processing hardware along with powerful knowledge representation and
      reasoning software via <em class="firstterm">Prolog</em>; a type of <em class="firstterm"> expert system</em>. By 1992 the
      project was considered a failure and cancelled. It was the largest and most visible commercial venture for Prolog,
      and many of the failures are pinned on the problems of trying to run a logic based programming language
      concurrently on multi CPU hardware with effective results. Some believe that the failure of the 5GP project
      tainted Prolog and relegated it to academia, see <a class="link" href="http://www.dvorak.org/blog/whatever-happened-to-prolog/">"Whatever Happened to Prolog"</a> by
      John C. Dvorak.</p><p>However while research funding dried up and the term AI became less
    used, many green shoots where planted and continued more quietly under
    discipline specific names: <em class="firstterm">cognitive systems</em>,
    <em class="firstterm">machine learning</em>, <em class="firstterm">intelligent
    systems</em>,<em class="firstterm"> knowledge representation and
    reasoning</em>. Offshoots of these then made their way into
    commercial systems, such as expert systems in the <em class="firstterm">Business
    Rules Management System</em> (BRMS) market.</p><p><em class="firstterm">Imperative</em>, system based languages, languages such as C, C++, Java and C#/.Net have
      dominated the last 20 years, enabled by the practicality of the languages and ability to run with good performance
      on commodity hardware. However many believe there is a renaissance underway in the field of AI, spurred by
      advances in hardware capabilities and AI research. In 2005 Heather Havenstein authored <a class="link" href="http://www.computerworld.com/s/article/99691/Spring_comes_to_AI_winter">"Spring comes to AI
        winter"</a> which outlines a case for this resurgence. Norvig and Russel dedicate several pages to what
      factors allowed the industry to overcome it's problems and the research that came about as a result:</p><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td width="10%" valign="top"> </td><td width="80%" valign="top"><p>
          Recent years have seen a revolution in both the content and
          the methodology of work in artificial intelligence. It is now more common
          to build on existing theories than to propose brand-new ones, to base
          claims on rigorous theorems or hard experimental evidence rather than on
          intuition, and to show relevance to real-world applications rather than
          toy examples.          
        </p></td><td width="10%" valign="top"> </td></tr><tr><td width="10%" valign="top"> </td><td colspan="2" align="right" valign="top">--<span class="attribution">Artificial Intelligence: A Modern Approach</span></td></tr></table></div><p><em class="firstterm">Computer vision</em>, <em class="firstterm">neural networks</em>, <em class="firstterm">machine
        learning</em> and <em class="firstterm">knowledge representation and reasoning</em> (KRR) have made great
      strides towards becoming practical in commercial environments. For example, vision-based systems can now fully map
      out and navigate their environments with strong recognition skills. As a result we now have self-driving cars
      about to enter the commercial market. <em class="firstterm">Ontological</em> research, based around description logic,
      has provided very rich semantics to represent our world. Algorithms such as the tableaux algorithm have made it
      possible to use those rich semantics effectively in large complex ontologies. Early KRR systems, like Prolog in
      5GP, were dogged by the limited semantic capabilities and memory restrictions on the size of those
      ontologies.</p></div><div class="section" title="5.1.2. Knowledge Representation and Reasoning"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4333"/>5.1.2. Knowledge Representation and Reasoning</h3></div></div></div><p>In A Little History talks about AI as a broader subject and touches
    on Knowledge Representation and Reasoning (KRR) and also Expert Systems,
    I'll come back to Expert Systems later.</p><p>KRR is about how we represent our knowledge in symbolic form, i.e. how we describe something. Reasoning is
      about how we go about the act of thinking using this knowledge. System based object-oriented languages, like C++,
      Java and C#, have data definitions called classes for describing the composition and behaviour of modeled
      entities. In Java we call exemplars of these described things beans or instances. However those classification
      systems are limited to ensure computational efficiency. Over the years researchers have developed increasingly
      sophisticated ways to represent our world. Many of you may already have heard of OWL (Web Ontology Language).
      There is always a gap between what can be theoretically represented and what can be used computationally in
      practically timely manner, which is why OWL has different sub-languages from Lite to Full. It is not believed that
      any reasoning system can support OWL Full. However, algorithmic advances continue  to narrow that gap and improve
      the expressiveness available to reasoning engines.</p><p>There are also many approaches to how these systems go about
    thinking. You may have heard discussions comparing the merits of
    forward chaining, which is reactive and data driven, with backward chaining,
    which is passive and query driven. Many other types of reasoning
    techniques exist, each of which enlarges the scope of the problems we can
    tackle declaratively. To list just a few: imperfect reasoning (fuzzy
    logic, certainty factors), defeasible logic, belief systems, temporal
    reasoning and correlation. You don't need to understand all these terms
    to understand and use Drools. They are just there to give
    an idea of the range of scope of research topics, which is actually far
    more extensive, and continues to grow as researchers
    push new boundaries.</p><p>KRR is often referred to as the core of Artificial Intelligence. Even
    when using biological approaches like neural networks, which model the
    brain and are more about pattern recognition than thinking, they still
    build on KRR theory. My first endeavours with Drools were engineering
    oriented, as I had no formal training or understanding of KRR. Learning
    KRR has allowed me to get a much wider theoretical background. Allowing me
    to better understand both what I've done and where I'm going, as it
    underpins nearly all of the theoretical side to our Drools R&amp;D. It
    really is a vast and fascinating subject that will pay dividends for those
    who take the time to learn. I know it did and still does for me. Bracham and
    Levesque have written a seminal piece of work, called "Knowledge
    Representation and Reasoning" that is a must read for anyone wanting to build strong
    foundations. I would also recommend the Russel and Norvig
    book "Artificial Intelligence, a modern approach" which also covers
    KRR.</p></div><div class="section" title="5.1.3. Rule Engines and Production Rule Systems (PRS)"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4344"/>5.1.3. Rule Engines and Production Rule Systems (PRS)</h3></div></div></div><p>We've now covered a brief history of AI and learnt that the core of AI is formed around KRR. We've shown than
      KRR is a vast and fascinating subject which forms the bulk of the theory driving Drools R&amp;D.</p><p>The rule engine is the computer program that delivers KRR
    functionality to the developer. At a high level it has three
    components:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Ontology</p></li><li class="listitem"><p>Rules</p></li><li class="listitem"><p>Data</p></li></ul></div><p>As previously mentioned the ontology is the representation model we
    use for our "things". It could use records or Java classes or full-blown
    OWL based ontologies. The rules perform the reasoning, i.e., they facilitate
    "thinking". The distinction between rules and ontologies blurs a little with
    OWL based ontologies, whose richness is rule based.</p><p>The term "rules engine" is quite ambiguous in that it can be any system that uses rules, in any form, that can
      be applied to data to produce outcomes. This includes simple systems like form validation and dynamic expression
      engines. The book "How to Build a Business Rules Engine" (2004) by Malcolm Chisholm exemplifies this ambiguity.
      The book is actually about how to build and alter a database schema to hold validation rules. The book then shows
      how to generate Visual Basic code from those validation rules to validate data entry. While perfectly valid, this
      is very different to what we are talking about.</p><p>Drools started life as a specific type of rule engine called a
    Production Rule System (PRS) and was based around the Rete algorithm
    (usually pronounced as two syllables, e.g., REH-te or RAY-tay). The
    Rete algorithm, developed by Charles Forgy in 1974, forms the brain of a
    Production Rule System and is able to scale to a large number of rules
    and facts. A Production Rule is a two-part structure: the engine matches
    facts and data against Production Rules - also called Productions or just
    Rules - to infer conclusions which result in actions.</p><pre><code class="language-java">when
    &lt;conditions&gt;
then
    &lt;actions&gt;;</code></pre><p>The process of matching the new or existing facts against Production Rules is called <em class="firstterm">pattern
        matching</em><a id="d0e4373" class="indexterm"/>, which is performed by the <em class="firstterm">inference engine</em><a id="d0e4379" class="indexterm"/>. Actions execute in response to changes in data, like a database trigger; we say this is a
        <em class="firstterm">data driven</em><a id="d0e4385" class="indexterm"/> approach to reasoning. The actions themselves can change data, which in turn could match against
      other rules causing them to fire; this is referred to as <a id="d0e4389" class="indexterm"/>forward chaining</p><p>Drools 5.x implements and extends the <em class="firstterm">Rete</em><a id="d0e4397" class="indexterm"/> algorithm. This extended Rete algorithm is named <em class="firstterm">ReteOO</em><a id="d0e4403" class="indexterm"/>, signifying that Drools has an enhanced and optimized implementation of the
      Rete algorithm for object oriented systems. Other Rete based engines
      also have marketing terms for their proprietary enhancements to Rete, like RetePlus and Rete III. The most common
      enhancements are covered in "Production Matching for Large Learning Systems" (1995) by Robert B. Doorenbos'
      thesis, which presents Rete/UL. Drools 6.x introduces a new lazy algorithm named <em class="firstterm">PHREAK</em><a id="d0e4409" class="indexterm"/>; which is covered in more detail in the PHEAK algorithm section.</p><p>The Rules are stored in the <a id="d0e4415" class="indexterm"/> Production Memory and the facts that the Inference Engine
    matches against are kept in the <a id="d0e4419" class="indexterm"/> Working Memory. Facts are asserted into the Working Memory
    where they may then be modified or retracted. A system with a large number
    of rules and facts may result in many rules being true for the same fact
    assertion; these rules are said to be in conflict. The Agenda manages the
    execution order of these conflicting rules using a Conflict Resolution
    strategy.</p><div class="figure"><a id="d0e4423"/><p class="title"><strong>Figure 5.1. High-level View of a Production Rule System</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/rule-engine-inkscape.png" align="middle" alt="High-level View of a Production Rule System"/></div></div></div><br class="figure-break"/></div><div class="section" title="5.1.4. Hybrid Reasoning Systems (HRS)"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4429"/>5.1.4. Hybrid Reasoning Systems (HRS)</h3></div></div></div><p>You may have read discussions comparing the merits of forward
    chaining (reactive and data driven) or backward chaining (passive query).
    Here is a quick explanation of these two main types of reasoning.</p><p>Forward chaining is "data-driven" and thus reactionary, with facts
    being asserted into working memory, which results in one or more rules
    being concurrently true and scheduled for execution by the Agenda. In
    short, we start with a fact, it propagates through the rules, and we end in a
    conclusion.</p><div class="figure"><a id="d0e4436"/><p class="title"><strong>Figure 5.2. Forward Chaining</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/Forward_Chaining.png" align="middle" alt="Forward Chaining"/></div></div></div><br class="figure-break"/><p>Backward chaining is "goal-driven", meaning that we start with a
    conclusion which the engine tries to satisfy. If it can't, then it searches
    for conclusions that it can satisfy. These are known as subgoals, that
    will help satisfy some unknown part of the current goal. It continues this
    process until either the initial conclusion is proven or there are no more
    subgoals. Prolog is an example of a Backward Chaining engine. Drools can
    also do backward chaining, which we refer to as derivation queries.</p><div class="figure"><a id="d0e4444"/><p class="title"><strong>Figure 5.3. Backward Chaining</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/Backward_Chaining.png" align="middle" alt="Backward Chaining"/></div></div></div><br class="figure-break"/><p>Historically you would have to make a choice between systems like
    OPS5 (forward) or Prolog (backward). Nowadays many modern systems provide both
    types of reasoning capabilities. There are also many other types of
    reasoning techniques, each of which enlarges the scope of the problems we
    can tackle declaratively. To list just a few: imperfect reasoning (fuzzy
    logic, certainty factors), defeasible logic, belief systems, temporal
    reasoning and correlation. Modern systems are merging these capabilities,
    and others not listed, to create <em class="firstterm">hybrid reasoning
    systems</em> (HRS).</p><p>While Drools started out as a PRS, 5.x introduced Prolog style
    backward chaining reasoning as well as some functional programming styles.
    For this reason we now prefer the term Hybrid Reasoning System when describing Drools.
    </p><p>Drools currently provides crisp reasoning, but imperfect reasoning is
    almost ready. Initially this will be imperfect reasoning with fuzzy logic;
    later we'll add support for other types of uncertainty. Work is also under
    way to bring OWL based ontological reasoning, which will integrate with
    our <em class="firstterm">traits</em> system. We also continue to improve our
    functional programming capabilities.</p></div><div class="section" title="5.1.5. Expert Systems"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4462"/>5.1.5. Expert Systems</h3></div></div></div><p>You will often hear the terms <em class="firstterm">expert systems</em>
    used to refer to <em class="firstterm">production rule systems</em> or
    <em class="firstterm">Prolog</em>-like systems. While this is normally
    acceptable, it's technically incorrect as these are frameworks to build expert
    systems with, rather than expert systems themselves. It becomes an
    expert system once there is an ontological model to represent the domain
    and there are facilities for knowledge acquisition and explanation.
    </p><p><em class="firstterm">Mycin</em> is the most famous expert system, built
    during the 70s. It is still heavily covered in academic literature, such
    as the recommended book "Expert Systems" by Peter Jackson.</p><div class="figure"><a id="d0e4480"/><p class="title"><strong>Figure 5.4. Early History of Expert Systems</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/expertsytem_history.png" align="middle" alt="Early History of Expert Systems"/></div></div></div><br class="figure-break"/></div><div class="section" title="5.1.6. Recommended Reading"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4486"/>5.1.6. Recommended Reading</h3></div></div></div><p><span class="bold"><strong>General AI, KRR and Expert System
    Books</strong></span></p><p>For those wanting to get a strong theoretical background in KRR and
    expert systems, I'd strongly recommend the following books. "Artificial
    Intelligence: A Modern Approach" is a must have, for anyone's
    bookshelf.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Introduction to Expert Systems</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Peter Jackson</p></li></ul></div></li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Expert Systems: Principles and Programming</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Joseph C. Giarratano, Gary D. Riley</p></li></ul></div></li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Knowledge Representation and Reasoning</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Ronald J. Brachman, Hector J. Levesque</p></li></ul></div></li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Artificial Intelligence : A Modern Approach.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Stuart Russell and Peter Norvig</p></li></ul></div></li></ul></div><div class="figure"><a id="d0e4526"/><p class="title"><strong>Figure 5.5. Recommended Reading</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/book_recommendations.png" align="middle" alt="Recommended Reading"/></div></div></div><br class="figure-break"/><p><span class="bold"><strong>Papers</strong></span></p><p>Here are some recommended papers that cover interesting areas
    in rule engine research:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Production Matching for Large Learning Systems: Rete/UL
        (1993)</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Robert B. Doorenbos</p></li></ul></div></li><li class="listitem"><p>Advances In Rete Pattern Matching</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Marshall Schor, Timothy P. Daly, Ho Soo Lee, Beth R.
            Tibbitts (AAAI 1986)</p></li></ul></div></li><li class="listitem"><p>Collection-Oriented Match</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Anurag Acharya and Milind Tambe (1993)</p></li></ul></div></li><li class="listitem"><p>The Leaps Algorithm</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Don Batery (1990)</p></li></ul></div></li><li class="listitem"><p>Gator: An Optimized Discrimination Network for Active Database
        Rule Condition Testing</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Eric Hanson , Mohammed S. Hasan (1993)</p></li></ul></div></li></ul></div><p><span class="bold"><strong>Drools Books</strong></span></p><p>There are currently three Drools books, all from Packt
    Publishing.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>JBoss Drools Business Rules</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Paul Browne</p></li></ul></div></li><li class="listitem"><p>Drools JBoss Rules 5.0 Developers Guide</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Michal Bali</p></li></ul></div></li><li class="listitem"><p>Drools Developer's Cookbook</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Lucas Amador</p></li></ul></div></li></ul></div><div class="figure"><a id="d0e4600"/><p class="title"><strong>Figure 5.6. Recommended Reading</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/drools_book_recommendations.png" align="middle" alt="Recommended Reading"/></div></div></div><br class="figure-break"/></div></div><div class="section" title="5.2. Rete Algorithm"><div class="titlepage"><div><div><h2 class="title"><a id="ReteOO"/>5.2. Rete Algorithm</h2></div></div></div><p>The <span class="emphasis"><em>Rete</em></span> algorithm was invented by Dr. Charles
  Forgy and documented in his PhD thesis in 1978-79. A simplified version of
  the paper was published in 1982 (<a class="link" href="http://citeseer.ist.psu.edu/context/505087/0">http://citeseer.ist.psu.edu/context/505087/0</a>).
  The latin word "rete" means "net" or "network". The Rete algorithm can be
  broken into 2 parts: rule compilation and runtime execution.</p><p>The compilation algorithm describes how the Rules in the Production
  Memory are processed to generate an efficient discrimination network. In
  non-technical terms, a discrimination network is used to filter data as it
  propagates through the network. The nodes at the top of the network would
  have many matches, and as we go down the network, there would be fewer
  matches. At the very bottom of the network are the terminal nodes. In Dr.
  Forgy's 1982 paper, he described 4 basic nodes: root, 1-input, 2-input and
  terminal.</p><div class="figure"><a id="d0e4619"/><p class="title"><strong>Figure 5.7. Rete Nodes</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/Rete_Nodes.png" align="middle" alt="Rete Nodes"/></div></div></div><br class="figure-break"/><p>The root node is where all objects enter the network. From there, it
  immediately goes to the ObjectTypeNode. The purpose of the ObjectTypeNode is
  to make sure the engine doesn't do more work than it needs to. For example,
  say we have 2 objects: Account and Order. If the rule engine tried to
  evaluate every single node against every object, it would waste a lot of
  cycles. To make things efficient, the engine should only pass the object to
  the nodes that match the object type. The easiest way to do this is to
  create an ObjectTypeNode and have all 1-input and 2-input nodes descend from
  it. This way, if an application asserts a new Account, it won't propagate to
  the nodes for the Order object. In Drools when an object is asserted it
  retrieves a list of valid ObjectTypesNodes via a lookup in a HashMap from
  the object's Class; if this list doesn't exist it scans all the
  ObjectTypeNodes finding valid matches which it caches in the list. This
  enables Drools to match against any Class type that matches with an
  <code class="literal">instanceof</code> check.</p><div class="figure"><a id="d0e4630"/><p class="title"><strong>Figure 5.8. ObjectTypeNodes</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/Object_Type_Nodes.png" align="middle" alt="ObjectTypeNodes"/></div></div></div><br class="figure-break"/><p>ObjectTypeNodes can propagate to AlphaNodes, LeftInputAdapterNodes and
  BetaNodes. AlphaNodes are used to evaluate literal conditions. Although the
  1982 paper only covers equality conditions, many RETE implementations
  support other operations. For example, <code class="code">Account.name == "Mr
  Trout"</code> is a literal condition. When a rule has multiple literal
  conditions for a single object type, they are linked together. This means
  that if an application asserts an Account object, it must first satisfy the
  first literal condition before it can proceed to the next AlphaNode. In Dr.
  Forgy's paper, he refers to these as IntraElement conditions. The following
  diagram shows the AlphaNode combinations for Cheese( name == "cheddar",
  strength == "strong" ):</p><div class="figure"><a id="d0e4641"/><p class="title"><strong>Figure 5.9. AlphaNodes</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/Alpha_Nodes.png" align="middle" alt="AlphaNodes"/></div></div></div><br class="figure-break"/><p>Drools extends Rete by optimizing the propagation from ObjectTypeNode
  to AlphaNode using hashing. Each time an AlphaNode is added to an
  ObjectTypeNode it adds the literal value as a key to the HashMap with the
  AlphaNode as the value. When a new instance enters the ObjectType node,
  rather than propagating to each AlphaNode, it can instead retrieve the
  correct AlphaNode from the HashMap,thereby avoiding unnecessary literal
  checks.</p><p>There are two two-input nodes, JoinNode and NotNode, and both are
  types of BetaNodes. BetaNodes are used to compare 2 objects, and their
  fields, to each other. The objects may be the same or different types. By
  convention we refer to the two inputs as left and right. The left input for
  a BetaNode is generally a list of objects; in Drools this is a Tuple. The
  right input is a single object. Two Nodes can be used to implement 'exists'
  checks. BetaNodes also have memory. The left input is called the Beta Memory
  and remembers all incoming tuples. The right input is called the Alpha
  Memory and remembers all incoming objects. Drools extends Rete by performing
  indexing on the BetaNodes. For instance, if we know that a BetaNode is
  performing a check on a String field, as each object enters we can do a hash
  lookup on that String value. This means when facts enter from the opposite
  side, instead of iterating over all the facts to find valid joins, we do a
  lookup returning potentially valid candidates. At any point a valid join is
  found the Tuple is joined with the Object; which is referred to as a partial
  match; and then propagated to the next node.</p><div class="figure"><a id="d0e4651"/><p class="title"><strong>Figure 5.10. JoinNode</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/Join_Node.png" align="middle" alt="JoinNode"/></div></div></div><br class="figure-break"/><p>To enable the first Object, in the above case Cheese, to enter the
  network we use a LeftInputNodeAdapter - this takes an Object as an input and
  propagates a single Object Tuple.</p><p>Terminal nodes are used to indicate a single rule having matched all
  its conditions; at this point we say the rule has a full match. A rule with
  an 'or' conditional disjunctive connective results in subrule generation for
  each possible logically branch; thus one rule can have multiple terminal
  nodes.</p><p>Drools also performs node sharing. Many rules repeat the same
  patterns, and node sharing allows us to collapse those patterns so that they
  don't have to be re-evaluated for every single instance. The following two
  rules share the first pattern, but not the last:</p><pre><code class="no-highlight">rule
when
    Cheese( $cheddar : name == "cheddar" )
    $person : Person( favouriteCheese == $cheddar )
then
    System.out.println( $person.getName() + " likes cheddar" );
end</code></pre><pre><code class="no-highlight">rule
when
    Cheese( $cheddar : name == "cheddar" )
    $person : Person( favouriteCheese != $cheddar )
then
    System.out.println( $person.getName() + " does not like cheddar" );
end</code></pre><p>As you can see below, the compiled Rete network shows that the alpha
  node is shared, but the beta nodes are not. Each beta node has its own
  TerminalNode. Had the second pattern been the same it would have also been
  shared.</p><div class="figure"><a id="d0e4669"/><p class="title"><strong>Figure 5.11. Node Sharing</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/Node_Sharing.png" align="middle" alt="Node Sharing"/></div></div></div><br class="figure-break"/></div><div class="section" title="5.3. ReteOO Algorithm"><div class="titlepage"><div><div><h2 class="title"><a id="ReteOOSection"/>5.3. ReteOO Algorithm</h2></div></div></div><p>The <span class="emphasis"><em>ReteOO</em></span> was developed throughout the 3, 4 and 5 series releases. It takes the RETE
    algorithm and applies well known enhancements, all of which are covered by existing academic literature:</p><p>Node sharing</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Sharing is applied to both the alpha and beta network. The beta network sharing is always from the root
          pattern.</p></li></ul></div><p>Alpha indexing</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Alpha Nodes with many children use a hash lookup mechanism, to avoid testing each result.</p></li></ul></div><p>Beta indexing</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Join, Not and Exist nodes indexing their memories using a hash. This reduces the join attempts for equal
          checks. Recently range indexing was added to Not and Exists.</p></li></ul></div><p>Tree based graphs</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Join matches did not contain any references to their parent or children matches. Deletions would have to
          recalculate all join matches again, which involves recreating all those join match objects, to be able to find
          the parts of the network where the tuples should be deleted. This is called symmetrical propagation. A tree
          graph provides parent and children references, so a deletion is just a matter of following those references.
          This is asymmetrical propagation. The result is faster and less impact on the GC, and more robust because
          changes in values will not cause memory leaks if they happen without the engine being notified.</p></li></ul></div><p>Modify-in-place</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Traditional RETE implements a modify as a delete + insert. This causes all join tuples to be GC'd, many of
          which are recreated again as part of the insert. Modify-in-place instead propagates as a single pass, every
          node is inspected </p></li></ul></div><p>Property reactive</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Also called "new trigger condition". Allows more fine grained reactivity to updates. A Pattern can react
          to changes to specific properties and ignore others. This alleviates problems of recursion and also helps with
          performance.</p></li></ul></div><p>Sub-networks</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Not, Exists and Accumulate can each have nested conditional elements, which forms sub networks.</p></li></ul></div><p>Backward Chaining</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Prolog style derivation trees for backward chaining are supported. The implementation is stack based, so
          does not have method recursion issues for large graphs.</p></li></ul></div><p>Lazy Truth Maintenance</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Truth maintenance has a runtime cost, which is incurred whether TMS is used or not. Lazy TMS only turns it
          on, on first use. Further it's only turned on for that object type, so other object types do not incur the
          runtime cost.</p></li></ul></div><p>Heap based agenda</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The agenda uses a binary heap queue to sort rule matches by salience, rather than any linear search or
          maintenance approach.</p></li></ul></div><p>Dynamic Rules</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Rules can be added and removed at runtime, while the engine is still populated with data.</p></li></ul></div></div><div class="section" title="5.4. PHREAK Algorithm"><div class="titlepage"><div><div><h2 class="title"><a id="PHREAK"/>5.4. PHREAK Algorithm</h2></div></div></div><p>Drools 6 introduces a new algorithm, that attempts to address some of the core issues of RETE. The algorithm is
    not a rewrite form scratch and incorporates all of the existing code from ReteOO, and all its enhancements. While
    PHREAK is an evolution of the RETE algorithm, it is no longer classified as a RETE implementation. In the same way
    that once an animal evolves beyond a certain point and key characteristics are changed, the animal becomes
    classified as new species. There are two key RETE characteristics that strongly identify any derivative strains,
    regardless of optimizations. That it is an eager, data oriented algorithm. Where all work is doing done the insert,
    update or delete actions; eagerly producing all partial matches for all rules. PHREAK in contrast is characterised
    as a lazy, goal oriented algorithm; where partial matching is aggressively delayed. </p><p>This eagerness of RETE can lead to a lot of churn in large systems, and much wasted work. Where wasted work is
    classified as matching efforts that do not result in a rule firing.</p><p>PHREAK was heavily inspired by a number of algorithms; including (but not limited to) LEAPS, RETE/UL and
    Collection-Oriented Match. PHREAK has all enhancements listed in the ReteOO section. In addition it adds the
    following set of enhancements, which are explained in more detail in the following paragraphs.</p><p>
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Three layers of contextual memory; Node, Segment and Rule memories.</p></li><li class="listitem"><p>Rule, segment and node based linking.</p></li><li class="listitem"><p>Lazy (delayed) rule evaluation.</p></li><li class="listitem"><p>Isolated rule evaluation.</p></li><li class="listitem"><p>Set oriented propagations.</p></li><li class="listitem"><p>Stack based evaluations, with pause and resume.</p></li></ul></div><p>
  </p><p>When the PHREAK engine is started all rules are said to be unlinked, no rule evaluation can happen while rules
    are unlinked. The insert, update and deletes actions are queued before entering the beta network. A simple
    heuristic, based on the rule most likely to result in firings, is used to select the next rule for evaluation; this
    delays the evaluation and firing of the other rules. Only once a rule has all right inputs populated will the rule
    be considered linked in, although no work is yet done. Instead a goal is created, that represents the rule, and
    placed into a priority queue; which is ordered by salience. Each queue itself is associated with an AgendaGroup.
    Only the active AgendaGroup will inspect its queue, popping the goal for the rule with the highest salience and
    submitting it for evaluation. So the work done shifts from the insert, update, delete phase to the fireAllRules
    phase. Only the rule for which the goal was created is evaluated, other potential rule evaluations from those facts
    are delayed. While individual rules are evaluated, node sharing is still achieved through the process of
    segmentation, which is explained later.</p><p>Each successful join attempt in RETE produces a tuple (or token, or partial match) that will be propagated to
    the child nodes. For this reason it is characterised as a tuple oriented algorithm. For each child node that it
    reaches it will attempt to join with the other side of the node, again each successful join attempt will be
    propagated straight away. This creates a descent recursion effect. Thrashing the network of nodes as it ripples up
    and down, left and right from the point of entry into the beta network to all the reachable leaf nodes.</p><p>PHREAK propagation is set oriented (or collection-oriented), instead of tuple oriented. For the rule being
    evaluated it will visit the first node and process all queued insert, update and deletes. The results are added to a
    set and the set is propagated to the child node. In the child node all queued inset, update and deletes are
    processed, adding the results to the same set. Once finished that set is propagated to the next child node, and so
    on until the terminal node is reached. This creates a single pass, pipeline type effect, that is isolated to the
    current rule being evaluated. This creates a batch process effect which can provide performance advantages for
    certain rule constructs; such as sub-networks with accumulates. In the future it will leans itself to being able to
    exploit multi-core machines in a number of ways.</p><p>The Linking and Unlinking uses a layered bit mask system, based on a network segmentation. When the rule network
    is built segments are created for nodes that are shared by the same set of rules. A rule itself is made up from a
    path of segments, although if there is no sharing that will be a single segment. A bit-mask offset is assigned to
    each node in the segment. Also another bit mask (the layering) is assigned to each segment in the rule's path. When
    there is at least one input (data propagation) the node's bit is set to on. When each node has its bit set to on
    the segment's bit is also set to on. Conversely if any node's bit is set to off, the segment is then also set to
    off. If each segment in the rule's path is set to on, the rule is said to be linked in and a goal is created to
    schedule the rule for evaluation. The same bit-mask technique is used to also track dirty node, segments and rules;
    this allows for a rule already link in to be scheduled for evaluation if it's considered dirty since it was last
    evaluated.</p><p>This ensures that no rule will ever evaluate partial matches, if it's impossible for it to result in rule
    instances because one of the joins has no data. This is possible in RETE and it will merrily churn away producing
    martial match attempts for all nodes, even if the last join is empty.</p><p>While the incremental rule evaluation always starts from the root node, the dirty bit masks are used to allow
    nodes and segments that are not dirty to be skipped.</p><p>Using the existence of at at least one items of data per node, is a fairly basic heuristic. Future work would
    attempt to delay the linking even further; using techniques such as arc consistency to determine whether or not
    matching will result in rule instance firings.</p><p>Where as RETE has just a singe unit of memory, the node memory, PHREAK has 3 levels of memory. This allows for
    much more contextual understanding during evaluation of a Rule.</p><div class="figure"><a id="d0e4796"/><p class="title"><strong>Figure 5.12. PHREAK 3 Layered memory system</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/LayeredMemory.png" align="middle" alt="PHREAK 3 Layered memory system"/></div></div></div><br class="figure-break"/><p>Example 1 shows a single rule, with three patterns; A, B and C. It forms a single segment, with bits 1, 2 and 4
    for the nodes. The single segment has a bit offset of 1.</p><div class="figure"><a id="d0e4804"/><p class="title"><strong>Figure 5.13. Example1: Single rule, no sharing</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/segment1.png" align="middle" alt="Example1: Single rule, no sharing"/></div></div></div><br class="figure-break"/><p>Example 2 demonstrates what happens when another rule is added that shares the pattern A. A is placed in its
    own segment, resulting in two segments per rule. Those two segments form a path, for their respective rules. The
    first segment is shared by both paths. When A is linked the segment becomes linked, it then iterates each path the
    segment is shared by, setting the bit 1 to on. If B and C are later turned on, the second segment for path R1 is
    linked in; this causes bit 2 to be turned on for R1. With bit 1 and bit 2 set to on for R1, the rule is now linked
    and a goal created to schedule the rule for later evaluation and firing.</p><p>When a rule is evaluated it is the segments that allow the results of matching to be shared. Each segment has a
    staging memory to queue all insert, update and deletes for that segment. If R1 was to evaluated it would process A
    and result in a set of tuples. The algorithm detects that there is a segmentation split and will create peered
    tuples for each insert, update and delete in the set and add them to R2's staging memory. Those tuples will be
    merged with any existing staged tuples and wait for R2 to eventually be evaluated.</p><div class="figure"><a id="d0e4814"/><p class="title"><strong>Figure 5.14. Example 2: Two rules, with sharing</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/segment2.png" align="middle" alt="Example 2: Two rules, with sharing"/></div></div></div><br class="figure-break"/><p>Example 3 adds a third rule and demonstrates what happens when A and B are shared. Only the bits for the
    segments are shown this time. Demonstrating that R4 has 3 segments, R3 has 3 segments and R1 has 2 segments. A and B
    are shared by R1, R3 and R4. While D is shared by R3 and R4.</p><div class="figure"><a id="d0e4822"/><p class="title"><strong>Figure 5.15. Example 3: Three rules, with sharing</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/segment3.png" align="middle" alt="Example 3: Three rules, with sharing"/></div></div></div><br class="figure-break"/><p>Sub-networks are formed when a Not, Exists or Accumulate node contain more than one element. In Example 4 "B
    not( C )" forms the sub network, note that "not(C)" is a single element and does not require a sub network and is
    merged inside of the Not node.</p><p>The sub network gets its own segment. R1 still has a path of two segments. The sub network forms another "inner"
    path. When the sub network is linked in, it will link in the outer segment.</p><div class="figure"><a id="d0e4832"/><p class="title"><strong>Figure 5.16. Example 4 : Single rule, with sub-network and no sharing</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/segment4.png" align="middle" alt="Example 4 : Single rule, with sub-network and no sharing"/></div></div></div><br class="figure-break"/><p>Example 5 shows that the sub-network nodes can be shard by a rule that does not have a sub-network. This results
    in the sub-network segment being split into two.</p><div class="figure"><a id="d0e4840"/><p class="title"><strong>Figure 5.17. Example 5: Two rules, one with a sub-network and sharing</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/segment5.png" align="middle" alt="Example 5: Two rules, one with a sub-network and sharing"/></div></div></div><br class="figure-break"/><p>Not nodes with constraints and accumulate nodes have special behaviour and can never unlink a segment, and are
    always considered to have their bits on.</p><p>All rule evaluations are incremental, and will not waste work recomputing matches that it has already
    produced.</p><p>The evaluation algorithm is stack based, instead of method recursion. Evaluation can be paused and resumed at
    any time, via the use of a StackEntry to represent current node being evaluated. </p><p>When a rule evaluation reaches a sub-network a StackEntry is created for the outer path segment and the
    sub-network segment. The sub-network segment is evaluated first, when the set reaches the end of the sub-network
    path it is merged into a staging list for the outer node it feeds into. The previous StackEntry is then resumed
    where it can process the results of the sub network. This has the added benefit that all work is processed in a
    batch, before propagating to the child node; which is much more efficient for accumulate nodes.</p><p>The same stack system can be used for efficient backward chaining. When a rule evaluation reaches a query node
    it again pauses the current evaluation, by placing it on the stack. The query is then evaluated which produces a
    result set, which is saved in a memory location for the resumed StackEntry to pick up and propagate to the child
    node. If the query itself called other queries the process would repeat, with the current query being paused and a
    new evaluation setup for the current query node.</p><p>One final point on performance. One single rule in general will not evaluate any faster with PHREAK than it does
    with RETE. For a given rule and same data set, which using a root context object to enable and disable matching,
    both attempt the same amount of matches and produce the same number of rule instances, and take roughly the same
    time. Except for the use case with subnetworks and accumulates. </p><p>PHREAK can however be considered more forgiving that RETE for poorly written rule bases and with a more graceful
    degradation of performance as the number of rules and complexity increases.</p><p>RETE will also churn away producing partial machines for rules that do not have data in all the joins; where as
    PHREAK will avoid this.</p><p> So it's not that PHREAK is faster than RETE, it just won't slow down as much as your system grows :) </p><p>AgendaGroups did not help in RETE performance, as all rules where evaluated at all times, regardless of the
    group. The same is true for salience. Which is why root context objects are often used, to limit matching attempts.
    PHREAK only evaluates rules for the active AgendaGroup, and within that group will attempt to avoid evaluation of
    rules (via salience) that do not result in rule instance firings. </p><p>With PHREAK AgendaGroups and salience now become useful performance tools. The root context objects are no
    longer needed and potentially counter productive to performance, as they force the flushing and recreation of
    matches for rules.</p><p> </p></div></div><div class="chapter" title="Chapter 6. User Guide"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4870"/>Chapter 6. User Guide</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e4873">6.1. The Basics</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4876">6.1.1. Stateless Knowledge Session</a></span></dt><dt><span class="section"><a href="#d0e5038">6.1.2. Stateful Knowledge Session</a></span></dt><dt><span class="section"><a href="#d0e5213">6.1.3. Methods versus Rules</a></span></dt><dt><span class="section"><a href="#d0e5245">6.1.4. Cross Products</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5270">6.2. Execution Control</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5273">6.2.1. Agenda</a></span></dt><dt><span class="section"><a href="#d0e5306">6.2.2. Rule Matches and Conflict Sets.</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5518">6.3. Inference</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5521">6.3.1. Bus Pass Example</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5589">6.4. Truth Maintenance with  Logical Objects</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5596">6.4.1. Overview</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e5713">6.5. Decision Tables in Spreadsheets</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5725">6.5.1. When to Use Decision Tables</a></span></dt><dt><span class="section"><a href="#d0e5743">6.5.2. Overview</a></span></dt><dt><span class="section"><a href="#d0e5785">6.5.3. How Decision Tables Work</a></span></dt><dt><span class="section"><a href="#d0e5871">6.5.4. Spreadsheet Syntax</a></span></dt><dt><span class="section"><a href="#d0e6396">6.5.5. Creating and integrating Spreadsheet based Decision Tables</a></span></dt><dt><span class="section"><a href="#d0e6417">6.5.6. Managing Business Rules in Decision Tables</a></span></dt><dt><span class="section"><a href="#d0e6464">6.5.7. Rule Templates</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e6567">6.6. Logging</a></span></dt></dl></div><div class="section" title="6.1. The Basics"><div class="titlepage"><div><div><h2 class="title"><a id="d0e4873"/>6.1. The Basics</h2></div></div></div><div class="section" title="6.1.1. Stateless Knowledge Session"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4876"/>6.1.1. Stateless Knowledge Session</h3></div></div></div><p>So where do we get started? There are so many use cases and so much functionality in a rule engine such as
      Drools that it becomes beguiling. Have no fear my intrepid adventurer, the complexity is layered and you can ease
      yourself in with simple use cases.</p><p>Stateless session, not utilising inference, forms the simplest use
    case. A stateless session can be called like a function passing it some
    data and then receiving some results back. Some common use cases for
    stateless sessions are, but not limited to:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Validation</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Is this person eligible for a mortgage?</p></li></ul></div></li><li class="listitem"><p>Calculation</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Compute a mortgage premium.</p></li></ul></div></li><li class="listitem"><p>Routing and Filtering</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Filter incoming messages, such as emails, into
            folders.</p></li><li class="listitem"><p>Send incoming messages to a destination.</p></li></ul></div></li></ul></div><p>So let's start with a very simple example using a driving license
    application.</p><pre><code class="language-java">public class Applicant {
    private String name;
    private int age;
    private boolean valid;
    // getter and setter methods here
}
</code></pre><p>Now that we have our data model we can write our first rule. We
    assume that the application uses rules to reject invalid applications. As
    this is a simple validation use case we will add a single rule to
    disqualify any applicant younger than 18.</p><pre><code class="no-highlight">package com.company.license

rule "Is of valid age"
when
    $a : Applicant( age &lt; 18 )
then
    $a.setValid( false );
end</code></pre><p>To make the engine aware of data, so it can be processed against the
    rules, we have to <span class="emphasis"><em>insert</em></span> the data, much like with a
    database. When the Applicant instance is inserted into the engine it is
    evaluated against the constraints of the rules, in this case just two
    constraints for one rule. We say <span class="emphasis"><em>two</em></span> because the type
    Applicant is the first object type constraint, and <code class="code">age &lt;
    18</code> is the second field constraint. An object type constraint plus
    its zero or more field constraints is referred to as a pattern. When an
    inserted instance satisfies both the object type constraint and all the
    field constraints, it is said to be matched. The <code class="code">$a</code> is a
    binding variable which permits us to reference the matched object in the
    consequence. There its properties can be updated. The dollar character
    ('$') is optional, but it helps to differentiate variable names from field
    names. The process of matching patterns against the inserted data is, not
    surprisingly, often referred to as <span class="emphasis"><em>pattern matching</em></span>.</p><p>To use this rule it is necessary to put it a Drools file, just a plain
    text file with .drl extension , short for "Drools Rule Language". Let's call
    this file licenseApplication.drl, and store it in a Kie Project. A Kie Project
    has the structure of a normal Maven project with an additional file (kmodule.xml)
    defining the <code class="code">KieBase</code>s and <code class="code">KieSession</code>s that can be created.
    This file has to be placed in the resources/META-INF folder of the Maven project
    while all the other Drools artifacts, such as the licenseApplication.drl
    containing the former rule, must be stored in the resources folder or in any
    other subfolder under it.</p><p>Since meaningful defaults have been provided for all configuration aspects, the simplest
    kmodule.xml file can contain just an empty kmodule tag like the following:</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"/&gt;</code></pre><p>At this point it is possible to create a <code class="code">KieContainer</code> that reads
    the files to be built, from the classpath.</p><pre><code class="language-java">KieServices kieServices = KieServices.Factory.get();
KieContainer kContainer = kieServices.getKieClasspathContainer();</code></pre><p>The above code snippet compiles all the DRL files found on the classpath
    and put the result of this compilation, a <code class="code">KieModule</code>, in the <code class="code">KieContainer</code>.
    If there are no errors, we are now ready to create our session from the <code class="code">KieContainer</code>
    and execute against some data:</p><pre><code class="language-java">StatelessKieSession kSession = kContainer.newStatelessKieSession();
Applicant applicant = new Applicant( "Mr John Smith", 16 );
assertTrue( applicant.isValid() );
ksession.execute( applicant );
assertFalse( applicant.isValid() );
</code></pre><p>The preceding code executes the data against the rules. Since the
    applicant is under the age of 18, the application is marked as
    invalid.</p><p>So far we've only used a single instance, but what if we want to use
    more than one? We can execute against any object implementing Iterable,
    such as a collection. Let's add another class called
    <code class="code">Application</code>, which has the date of the application, and we'll
    also move the boolean valid field to the <code class="code">Application</code>
    class.</p><pre><code class="language-java">public class Applicant {
    private String name;
    private int age;
    // getter and setter methods here
}

public class Application {
    private Date dateApplied;
    private boolean valid;
    // getter and setter methods here
}</code></pre><p>We will also add another rule to validate that the application was
    made within a period of time.</p><pre><code class="no-highlight">package com.company.license

rule "Is of valid age"
when
    Applicant( age &lt; 18 )
    $a : Application()     
then
    $a.setValid( false );
end

rule "Application was made this year"
when
    $a : Application( dateApplied &gt; "01-jan-2009" )     
then
    $a.setValid( false );
end
</code></pre><p>Unfortunately a Java array does not implement the
    <code class="code">Iterable</code> interface, so we have to use the JDK converter
    method <code class="code">Arrays.asList(...)</code>. The code shown below executes
    against an iterable list, where all collection elements are inserted
    before any matched rules are fired.</p><pre><code class="language-java">StatelessKieSession kSession = kContainer.newStatelessKieSession();
Applicant applicant = new Applicant( "Mr John Smith", 16 );
Application application = new Application();
assertTrue( application.isValid() );
ksession.execute( Arrays.asList( new Object[] { application, applicant } ) );
assertFalse( application.isValid() );
</code></pre><p>The two execute methods <code class="code">execute(Object object)</code> and
    <code class="code">execute(Iterable objects)</code> are actually convenience methods
    for the interface <code class="code">BatchExecutor</code>'s method
    <code class="code">execute(Command command)</code>.</p><p>The <code class="code">KieCommands</code> commands factory, obtainable from the <code class="code">KieServices</code>
    like all other factories of the KIE API, is used to create commands, so that
    the following is equivalent to <code class="code">execute(Iterable it)</code>:</p><pre><code class="language-java">ksession.execute( kieServices.getCommands().newInsertElements( Arrays.asList( new Object[] { application, applicant } ) );
</code></pre><p>Batch Executor and Command Factory are particularly useful when
    working with multiple Commands and with output identifiers for obtaining
    results.</p><pre><code class="language-java">KieCommands kieCommands = kieServices.getCommands();
List&lt;Command&gt; cmds = new ArrayList&lt;Command&gt;();
cmds.add( kieCommands.newInsert( new Person( "Mr John Smith" ), "mrSmith", true, null ) );
cmds.add( kieCommands.newInsert( new Person( "Mr John Doe" ), "mrDoe", true, null ) );
BatchExecutionResults results = ksession.execute( kieCommands.newBatchExecution( cmds ) );
assertEquals( new Person( "Mr John Smith" ), results.getValue( "mrSmith" ) );
</code></pre><p><code class="code">CommandFactory</code> supports many other Commands that can be
    used in the <code class="code">BatchExecutor</code> like <code class="code">StartProcess</code>,
    <code class="code">Query</code>, and <code class="code">SetGlobal</code>.</p></div><div class="section" title="6.1.2. Stateful Knowledge Session"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5038"/>6.1.2. Stateful Knowledge Session</h3></div></div></div><p>Stateful Sessions are long lived and allow iterative changes over
    time. Some common use cases for Stateful Sessions are, but not limited
    to:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Monitoring</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Stock market monitoring and analysis for semi-automatic
            buying.</p></li></ul></div></li><li class="listitem"><p>Diagnostics</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Fault finding, medical diagnostics</p></li></ul></div></li><li class="listitem"><p>Logistics</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Parcel tracking and delivery provisioning</p></li></ul></div></li><li class="listitem"><p>Compliance</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Validation of legality for market trades.</p></li></ul></div></li></ul></div><p>In contrast to a Stateless Session, the <code class="code">dispose()</code>
    method must be called afterwards to ensure there are no memory leaks, as
    the KieBase contains references to Stateful Knowledge Sessions when
    they are created. Since Stateful Knowledge Session is the most commonly used session type
    it is just named <code class="code">KieSession</code> in the KIE API. <code class="code">KieSession</code> also
    supports the <code class="code">BatchExecutor</code> interface, like
    <code class="code">StatelessKieSession</code>, the only difference being that the
    <code class="code">FireAllRules</code> command is not automatically called at the end
    for a Stateful Session.</p><p>We illustrate the monitoring use case with an example for raising a
    fire alarm. Using just four classes, we represent rooms in a house, each
    of which has one sprinkler. If a fire starts in a room, we represent that
    with a single <code class="code">Fire</code> instance.</p><pre><code class="language-java">public class Room {
    private String name
    // getter and setter methods here
}
public class Sprinkler {
    private Room room;
    private boolean on;
    // getter and setter methods here
}
public class Fire {
    private Room room;
    // getter and setter methods here
}
public class Alarm {
}
</code></pre><p>In the previous section on Stateless Sessions the concepts of
    inserting and matching against data were introduced. That example assumed
    that only a single instance of each object type was ever inserted and thus
    only used literal constraints. However, a house has many rooms, so rules
    must express relationships between objects, such as a sprinkler being in a
    certain room. This is best done by using a binding variable as a
    constraint in a pattern. This "join" process results in what is called
    cross products, which are covered in the next section.</p><p>When a fire occurs an instance of the <code class="code">Fire</code> class is
    created, for that room, and inserted into the session. The rule uses a
    binding on the <code class="code">room</code> field of the <code class="code">Fire</code> object to
    constrain matching to the sprinkler for that room, which is currently off.
    When this rule fires and the consequence is executed the sprinkler is
    turned on.</p><pre><code class="no-highlight">rule "When there is a fire turn on the sprinkler"
when
    Fire($room : room)
    $sprinkler : Sprinkler( room == $room, on == false )
then
    modify( $sprinkler ) { setOn( true ) };
    System.out.println( "Turn on the sprinkler for room " + $room.getName() );
end</code></pre><p>Whereas the Stateless Session uses standard Java syntax to modify a
    field, in the above rule we use the <code class="literal">modify</code> statement,
    which acts as a sort of "with" statement. It may contain a series of comma
    separated Java expressions, i.e., calls to setters of the object selected
    by the <code class="literal">modify</code> statement's control expression. This
    modifies the data, and makes the engine aware of those changes so it can
    reason over them once more. This process is called inference, and it's
    essential for the working of a Stateful Session. Stateless Sessions
    typically do not use inference, so the engine does not need to be aware of
    changes to data. Inference can also be turned off explicitly by using the
    <span class="emphasis"><em>sequential mode</em></span>.</p><p>So far we have rules that tell us when matching data exists, but
    what about when it does <span class="emphasis"><em>not</em></span> exist? How do we
    determine that a fire has been extinguished, i.e., that there isn't a
    <code class="code">Fire</code> object any more? Previously the constraints have been
    sentences according to Propositional Logic, where the engine is
    constraining against individual instances. Drools also has support for
    First Order Logic that allows you to look at sets of data. A pattern under
    the keyword <code class="literal">not</code> matches when something does not exist.
    The rule given below turns the sprinkler off as soon as the fire in that
    room has disappeared.</p><pre><code class="no-highlight">rule "When the fire is gone turn off the sprinkler"
when
    $room : Room( )
    $sprinkler : Sprinkler( room == $room, on == true )
    not Fire( room == $room )
then
    modify( $sprinkler ) { setOn( false ) };
    System.out.println( "Turn off the sprinkler for room " + $room.getName() );
end</code></pre><p>While there is one sprinkler per room, there is just a single alarm
    for the building. An <code class="code">Alarm</code> object is created when a fire
    occurs, but only one <code class="code">Alarm</code> is needed for the entire building,
    no matter how many fires occur. Previously <code class="literal">not</code> was
    introduced to match the absence of a fact; now we use its complement
    <code class="literal">exists</code> which matches for one or more instances of some
    category.</p><pre><code class="no-highlight">rule "Raise the alarm when we have one or more fires"
when
    exists Fire()
then
    insert( new Alarm() );
    System.out.println( "Raise the alarm" );
end</code></pre><p>Likewise, when there are no fires we want to remove the alarm, so
    the <code class="literal">not</code> keyword can be used again.</p><pre><code class="no-highlight">rule "Cancel the alarm when all the fires have gone"
when
    not Fire()
    $alarm : Alarm()
then
    delete( $alarm );
    System.out.println( "Cancel the alarm" );
end

</code></pre><p>Finally there is a general health status message that is printed
    when the application first starts and after the alarm is removed and all
    sprinklers have been turned off.</p><pre><code class="no-highlight">rule "Status output when things are ok"
when
    not Alarm()
    not Sprinkler( on == true ) 
then
    System.out.println( "Everything is ok" );
end</code></pre><p>As we did in the Stateless Session example, the above rules should be placed
    in a single DRL file and saved into the resouces folder of your Maven project
    or any of its subfolder. As before, we can then obtain a <code class="code">KieSession</code> from
    the <code class="code">KieContainer</code>. The only difference is that this time we
    create a Stateful Session, whereas before we created a Stateless Session.</p><pre><code class="language-java">KieServices kieServices = KieServices.Factory.get();
KieContainer kContainer = kieServices.getKieClasspathContainer();
KieSession ksession = kContainer.newKieSession();</code></pre><p>With the session created it is now possible to iteratively work with
    it over time. Four <code class="code">Room</code> objects are created and inserted, as
    well as one <code class="code">Sprinkler</code> object for each room. At this point the
    engine has done all of its matching, but no rules have fired yet. Calling
    <code class="code">ksession.fireAllRules()</code> allows the matched rules to fire, but
    without a fire that will just produce the health message.</p><pre><code class="language-java">String[] names = new String[]{"kitchen", "bedroom", "office", "livingroom"};
Map&lt;String,Room&gt; name2room = new HashMap&lt;String,Room&gt;();
for( String name: names ){
    Room room = new Room( name );
    name2room.put( name, room );
    ksession.insert( room );
    Sprinkler sprinkler = new Sprinkler( room );
    ksession.insert( sprinkler );
}

ksession.fireAllRules();
</code></pre><pre><code class="no-highlight">&gt; Everything is ok</code></pre><p>We now create two fires and insert them; this time a reference is
    kept for the returned <code class="code">FactHandle</code>. A Fact Handle is an
    internal engine reference to the inserted instance and allows instances to
    be retracted or modified at a later point in time. With the fires now in
    the engine, once <code class="code">fireAllRules()</code> is called, the alarm is
    raised and the respective sprinklers are turned on.</p><pre><code class="language-java">Fire kitchenFire = new Fire( name2room.get( "kitchen" ) );
Fire officeFire = new Fire( name2room.get( "office" ) );

FactHandle kitchenFireHandle = ksession.insert( kitchenFire );
FactHandle officeFireHandle = ksession.insert( officeFire );

ksession.fireAllRules();</code></pre><pre><code class="no-highlight">&gt; Raise the alarm
&gt; Turn on the sprinkler for room kitchen
&gt; Turn on the sprinkler for room office</code></pre><p>After a while the fires will be put out and the <code class="code">Fire</code>
    instances are retracted. This results in the sprinklers being turned off,
    the alarm being cancelled, and eventually the health message is printed
    again.</p><pre><code class="language-java">ksession.delete( kitchenFireHandle );
ksession.delete( officeFireHandle );

ksession.fireAllRules();</code></pre><pre><code class="no-highlight">&gt; Cancel the alarm
&gt; Turn off the sprinkler for room office
&gt; Turn off the sprinkler for room kitchen
&gt; Everything is ok</code></pre><p>Everyone still with me? That wasn't so hard and already I'm hoping
    you can start to see the value and power of a declarative rule
    system.</p></div><div class="section" title="6.1.3. Methods versus Rules"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5213"/>6.1.3. Methods versus Rules</h3></div></div></div><p>People often confuse methods and rules, and new rule users often ask, "How do I call a rule?" After the last
      section, you are now feeling like a rule expert and the answer to that is obvious, but let's summarize the
      differences nonetheless.</p><pre><code class="language-java">public void helloWorld(Person person) {
    if ( person.getName().equals( "Chuck" ) ) {
        System.out.println( "Hello Chuck" );
    }
}</code></pre><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Methods are called directly.</p></li><li class="listitem"><p>Specific instances are passed.</p></li><li class="listitem"><p>One call results in a single execution.</p></li></ul></div><pre><code class="no-highlight">rule "Hello World" when
    Person( name == "Chuck" )
then
    System.out.println( "Hello Chuck" );
end</code></pre><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Rules execute by matching against any data as long it is
        inserted into the engine.</p></li><li class="listitem"><p>Rules can never be called directly.</p></li><li class="listitem"><p>Specific instances cannot be passed to a rule.</p></li><li class="listitem"><p>Depending on the matches, a rule may fire once or several times,
        or not at all.</p></li></ul></div></div><div class="section" title="6.1.4. Cross Products"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5245"/>6.1.4. Cross Products</h3></div></div></div><p>Earlier the term "cross product" was mentioned, which is the result of a join. Imagine for a moment that the
      data from the fire alarm example were used in combination with the following rule where there are no field
      constraints:</p><pre><code class="no-highlight">rule "Show Sprinklers" when
    $room : Room()
    $sprinkler : Sprinkler()
then
    System.out.println( "room:" + $room.getName() +
                        " sprinkler:" + $sprinkler.getRoom().getName() );
end</code></pre><p>In SQL terms this would be like doing <code class="code">select * from Room,
    Sprinkler</code> and every row in the Room table would be joined with
    every row in the Sprinkler table resulting in the following output:</p><pre><code class="no-highlight">room:office sprinkler:office
room:office sprinkler:kitchen
room:office sprinkler:livingroom
room:office sprinkler:bedroom
room:kitchen sprinkler:office
room:kitchen sprinkler:kitchen
room:kitchen sprinkler:livingroom
room:kitchen sprinkler:bedroom
room:livingroom sprinkler:office
room:livingroom sprinkler:kitchen
room:livingroom sprinkler:livingroom
room:livingroom sprinkler:bedroom
room:bedroom sprinkler:office
room:bedroom sprinkler:kitchen
room:bedroom sprinkler:livingroom
room:bedroom sprinkler:bedroom</code></pre><p>These cross products can obviously become huge, and they may very
    well contain spurious data. The size of cross products is often the source
    of performance problems for new rule authors. From this it can be seen
    that it's always desirable to constrain the cross products, which is done
    with the variable constraint.</p><pre><code class="no-highlight">rule
when
    $room : Room()
    $sprinkler : Sprinkler( room == $room )
then
    System.out.println( "room:" + $room.getName() +
                        " sprinkler:" + $sprinkler.getRoom().getName() );
end</code></pre><p>This results in just four rows of data, with the correct Sprinkler
    for each Room. In SQL (actually HQL) the corresponding query would be
    <code class="code">select * from Room, Sprinkler where Room ==
    Sprinkler.room</code>.</p><pre><code class="no-highlight">room:office sprinkler:office
room:kitchen sprinkler:kitchen
room:livingroom sprinkler:livingroom
room:bedroom sprinkler:bedroom</code></pre></div></div><div class="section" title="6.2. Execution Control"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5270"/>6.2. Execution Control</h2></div></div></div><div class="section" title="6.2.1. Agenda"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5273"/>6.2.1. Agenda</h3></div></div></div><p>The Agenda is a <span class="emphasis"><em>Rete</em></span> feature. It maintains set
    of rules that are able to execute, its job is to schedule that execution
    in a deterministic order.</p><p>During actions on the <code class="code">RuleRuntime</code>, rules may become fully matched and eligible for execution; a
      single Rule Runtime Action can result in multiple eligible rules. When a rule is fully matched a Rule Match is
      created, referencing the rule and the matched facts, and placed onto the Agenda. The Agenda controls the execution
      order of these Matches using a Conflict Resolution strategy.</p><p>The engine cycles repeatedly through two phases:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Rule Runtime Actions. This is where most of the work takes place, either in the Consequence (the RHS
          itself) or the main Java application process. Once the Consequence has finished or the main Java application
          process calls <code class="code">fireAllRules()</code> the engine switches to the Agenda Evaluation phase.</p></li><li class="listitem"><p>Agenda Evaluation. This attempts to select a rule to fire. If no rule is found it exits, otherwise it
          fires the found rule, switching the phase back to Rule Runtime Actions.</p></li></ol></div><div class="figure"><a id="d0e5298"/><p class="title"><strong>Figure 6.1. Two Phase Execution</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/UserGuide/Two_Phase.png" align="middle" alt="Two Phase Execution"/></div></div></div><br class="figure-break"/><p>The process repeats until the agenda is clear, in which case control returns to the calling application. When
      Rule Runtime Actions are taking place, no rules are being fired.</p></div><div class="section" title="6.2.2. Rule Matches and Conflict Sets."><div class="titlepage"><div><div><h3 class="title"><a id="d0e5306"/>6.2.2. Rule Matches and Conflict Sets.</h3></div></div></div><div class="section" title="6.2.2.1. Cashflow Example"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5309"/>6.2.2.1. Cashflow Example</h4></div></div></div><p>So far the data and the matching process has been simple and
      small. To mix things up a bit a new example will be explored that
      handles cashflow calculations over date periods. The state of the engine
      will be illustratively shown at key stages to help get a better
      understanding of what is actually going on under the hood. Three classes
      will be used, as shown below. This will help us grow our understanding
      of pattern matching and joins further. We will then use this to
      illustrate different techniques for execution control.</p><pre><code class="language-java">public class CashFlow {
    private Date   date;
    private double amount;
    private int    type;
    long           accountNo;
    // getter and setter methods here
}

public class Account {
    private long   accountNo;
    private double balance;
    // getter and setter methods here
}

public AccountPeriod {
    private Date start;
    private Date end;
    // getter and setter methods here
}</code></pre><p>By now you already know how to create KieBases and how to instantiate facts to populate the
          <code class="code">KieSession</code>, so tables will be used to show the state of the inserted data, as it makes things
        clearer for illustration purposes. The tables below show that a single fact was inserted for the
          <code class="code">Account</code>. Also inserted are a series of debits and credits as <code class="code">CashFlow</code> objects for
        that account, extending over two quarters.</p><div class="figure"><a id="d0e5327"/><p class="title"><strong>Figure 6.2. CashFlows and Account</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/UserGuide/tables1.png" alt="CashFlows and Account"/></div></div></div><br class="figure-break"/><p>Two rules can be used to determine the debit and credit for that
      quarter and update the Account balance. The two rules below constrain
      the cashflows for an account for a given time period. Notice the
      "&amp;&amp;" which use short cut syntax to avoid repeating the field
      name twice.</p><table frame="void" id="d0e5335"><tbody><tr>
            <td align="left" valign="top"><pre><code class="no-highlight">rule "increase balance for credits"
when
  ap : AccountPeriod()
  acc : Account( $accountNo : accountNo )
  CashFlow( type == CREDIT,
            accountNo == $accountNo,
            date &gt;= ap.start &amp;&amp; &lt;= ap.end,
            $amount : amount )
then
  acc.balance  += $amount;
end</code></pre></td>

            <td align="left" valign="top"><pre><code class="no-highlight">rule "decrease balance for debits" 
when 
  ap : AccountPeriod() 
  acc : Account( $accountNo : accountNo ) 
  CashFlow( type == DEBIT, 
            accountNo == $accountNo,
            date &gt;= ap.start &amp;&amp; &lt;= ap.end, 
            $amount : amount ) 
then 
  acc.balance -= $amount; 
end</code></pre></td>
          </tr></tbody></table><p>Earlier we showed how rules would equate to SQL, which can often
      help people with an SQL background to understand rules. The two rules
      above can be represented with two views and a trigger for each view, as
      below:</p><table border="0" id="d0e5349"><tbody><tr>
            <td align="left" valign="top">
              <pre><code class="no-highlight">select * from Account acc,
              Cashflow cf,
              AccountPeriod ap      
where acc.accountNo == cf.accountNo and 
      cf.type == CREDIT and
      cf.date &gt;= ap.start and 
      cf.date &lt;= ap.end</code></pre>
            </td>

            <td align="left" valign="top">
              <pre><code class="no-highlight">select * from Account acc, 
              Cashflow cf,
              AccountPeriod ap 
where acc.accountNo == cf.accountNo and 
      cf.type == DEBIT and
      cf.date &gt;= ap.start and 
      cf.date &lt;= ap.end</code></pre>
            </td>
          </tr><tr>
            <td align="left" valign="top">
              <pre><code class="no-highlight">trigger : acc.balance += cf.amount</code></pre>
            </td>

            <td align="left" valign="top">
              <pre><code class="no-highlight">trigger : acc.balance -= cf.amount</code></pre>
            </td>
          </tr></tbody></table><p>If the <code class="code">AccountPeriod</code> is set to the first quarter we
      constrain the rule "increase balance for credits" to fire on two rows of
      data and "decrease balance for debits" to act on one row of data.</p><div class="figure"><a id="d0e5384"/><p class="title"><strong>Figure 6.3. AccountingPeriod, CashFlows and Account</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/UserGuide/tables2.png" alt="AccountingPeriod, CashFlows and Account"/></div></div></div><br class="figure-break"/><p>The two cashflow tables above represent the matched data for the two rules. The data is matched during the
        insertion stage and, as you discovered in the previous chapter, does not fire straight away, but only after
          <code class="code">fireAllRules()</code> is called. Meanwhile, the rule plus its matched data is placed on the Agenda and
        referred to as an RuIe Match or Rule Instance. The Agenda is a table of Rule Matches that are able to fire and
        have their consequences executed, as soon as fireAllRules() is called. Rule Matches on the Agenda are referred
        to as a <em class="firstterm">conflict set</em> and their execution is determine by a conflict resolution strategy.
        Notice that the order of execution so far is considered arbitrary.</p><div class="figure"><a id="d0e5398"/><p class="title"><strong>Figure 6.4. CashFlows and Account</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/UserGuide/tables7.png" alt="CashFlows and Account"/></div></div></div><br class="figure-break"/><p>After all of the above activations are fired, the account has a
      balance of -25.</p><div class="figure"><a id="d0e5406"/><p class="title"><strong>Figure 6.5. CashFlows and Account</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/UserGuide/tables3.png" alt="CashFlows and Account"/></div></div></div><br class="figure-break"/><p>If the <code class="code">AccountPeriod</code> is updated to the second quarter, we have just a single matched row of
        data, and thus just a single Rule Match on the Agenda.</p><p>The firing of that Activation results in a balance of 25.</p><div class="figure"><a id="d0e5419"/><p class="title"><strong>Figure 6.6. CashFlows and Account</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/UserGuide/tables4.png" alt="CashFlows and Account"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e5425"/><p class="title"><strong>Figure 6.7. CashFlows and Account</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/UserGuide/tables5.png" alt="CashFlows and Account"/></div></div></div><br class="figure-break"/></div><div class="section" title="6.2.2.2. Conflict Resolution"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5431"/>6.2.2.2. Conflict Resolution</h4></div></div></div><p>What if you don't want the order of rule execution to be arbitrary? When there is one or more Rule Match on
        the Agenda they are said to be in conflict, and a conflict resolution strategy is used to determine the order of
        execution. The Drools strategy is very simple and based around a salience value, which assigns a priority to a
        rule. Each rule has a default value of 0, the higher the value the higher the priority. </p><p>As a general rule, it is a good idea not to count on rules firing
      in any particular order, and to author the rules without worrying about
      a "flow". However when a flow is needed a number of possibilities exist
      beyond salience: agenda groups, rule flow groups, activation groups and
      control/semaphore facts. </p><p>As of Drools 6.0 rule definition order in the source file is used to set priority after salience.</p></div><div class="section" title="6.2.2.3. Salience"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5440"/>6.2.2.3. Salience</h4></div></div></div><p>To illustrate Salience we add a rule to print the account balance,
      where we want this rule to be executed after all the debits and credits
      have been applied for all accounts. We achieve this by assigning a
      negative salience to this rule so that it fires after all rules with the
      default salience 0.</p><table border="0" id="d0e5445"><tbody><tr>
            <td>
              <pre><code class="no-highlight">rule "Print balance for AccountPeriod"
        salience -50
    when
        ap : AccountPeriod()
        acc : Account()        
    then
        System.out.println( acc.accountNo + " : " + acc.balance );    
end</code></pre>
            </td>
          </tr></tbody></table><p>The table below depicts the resulting Agenda. The three debit and
      credit rules are shown to be in arbitrary order, while the print rule is
      ranked last, to execute afterwards.</p><div class="figure"><a id="d0e5457"/><p class="title"><strong>Figure 6.8. CashFlows and Account</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/UserGuide/tables6.png" alt="CashFlows and Account"/></div></div></div><br class="figure-break"/></div><div class="section" title="6.2.2.4. Agenda Groups"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5463"/>6.2.2.4. Agenda Groups</h4></div></div></div><p>Agenda groups allow you to place rules into groups, and to place
      those groups onto a stack. The stack has push/pop bevaviour. Calling
      "setFocus" places the group onto the stack:</p><pre><code class="language-java">ksession.getAgenda().getAgendaGroup( "Group A" ).setFocus();</code></pre><p>The agenda always evaluates the top of the stack. When all the
      rules have fired for a group, it is poped from the stack and the next
      group is evaluated.</p><table border="0" id="d0e5472"><tbody><tr>
            <td align="left" valign="top">
              <pre><code class="no-highlight">rule "increase balance for credits"
  agenda-group "calculation"
when
  ap : AccountPeriod()
  acc : Account( $accountNo : accountNo )
  CashFlow( type == CREDIT,
            accountNo == $accountNo,
            date &gt;= ap.start &amp;&amp; &lt;= ap.end,
            $amount : amount )
then
  acc.balance  += $amount;
end</code></pre>
            </td>

            <td align="left" valign="top">
              <pre><code class="no-highlight">rule "Print balance for AccountPeriod"
  agenda-group "report"
when
  ap : AccountPeriod()
  acc : Account()
then
  System.out.println( acc.accountNo +
                      " : " + acc.balance );    
end</code></pre>
            </td>
          </tr></tbody></table><p>First set the focus to the "report" group and then by placing the
      focus on "calculation" we ensure that group is evaluated first.</p><pre><code class="language-java">Agenda agenda = ksession.getAgenda();
agenda.getAgendaGroup( "report" ).setFocus();
agenda.getAgendaGroup( "calculation" ).setFocus();
ksession.fireAllRules();</code></pre></div><div class="section" title="6.2.2.5. Rule Flow"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5492"/>6.2.2.5. Rule Flow</h4></div></div></div><p>Drools also features ruleflow-group attributes which allows
      workflow diagrams to declaratively specify when rules are allowed to
      fire. The screenshot below is taken from Eclipse using the Drools
      plugin. It has two ruleflow-group nodes which ensures that the
      calculation rules are executed before the reporting rules.</p><div class="mediaobject"><img src="images/UserGuide/ruleflow.png"/></div><p>The use of the ruleflow-group attribute in a rule is shown
      below.</p><table border="0" id="d0e5502"><tbody><tr>
            <td align="left" valign="top">
              <pre><code class="no-highlight">rule "increase balance for credits"
  ruleflow-group "calculation"
when
  ap : AccountPeriod()
  acc : Account( $accountNo : accountNo )
  CashFlow( type == CREDIT,
            accountNo == $accountNo,
            date &gt;= ap.start &amp;&amp; &lt;= ap.end,
            $amount : amount )
then
  acc.balance  += $amount;
end</code></pre>
            </td>

            <td align="left" valign="top">
              <pre><code class="no-highlight">rule "Print balance for AccountPeriod"
  ruleflow-group "report"
when
  ap : AccountPeriod()
  acc : Account()
then
  System.out.println( acc.accountNo +
                      " : " + acc.balance );    
end</code></pre>
            </td>
          </tr></tbody></table></div></div></div><div class="section" title="6.3. Inference"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5518"/>6.3. Inference</h2></div></div></div><div class="section" title="6.3.1. Bus Pass Example"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5521"/>6.3.1. Bus Pass Example</h3></div></div></div><p>Inference has a bad name these days, as something not relevant to business use cases and just too complicated
      to be useful. It is true that contrived and complicated examples occur with inference, but that should not detract
      from the fact that simple and useful ones exist too. But more than this, correct use of inference can crate more
      agile and less error prone business rules, which are easier to maintain.</p><p>So what is inference? Something is inferred when we gain knowledge
    of something from using previous knowledge. For example, given a Person
    fact with an age field and a rule that provides age policy control, we can
    infer whether a Person is an adult or a child and act on this.</p><pre><code class="no-highlight">rule "Infer Adult"
when
  $p : Person( age &gt;= 18 )
then
  insert( new IsAdult( $p ) )
end</code></pre><p>Due to the preceding rule, every Person who is 18 or over will have an
    instance of IsAdult inserted for them. This fact is special in that it is known
    as a relation. We can use this inferred relation in any rule:</p><pre><code class="no-highlight">$p : Person()
IsAdult( person == $p )</code></pre><p>So now we know what inference is, and have a basic example, how does
    this facilitate good rule design and maintenance?</p><p>Let's take a government department that are responsible for issuing
    ID cards when children become adults, henceforth referred to as ID
    department. They might have a decision table that includes logic like
    this, which says when an adult living in London is 18 or over, issue the
    card:</p><div class="mediaobject"><img src="images/UserGuide/monolithic.png"/></div><p>However the ID department does not set the policy on who an adult
    is. That's done at a central government level. If the central government
    were to change that age to 21, this would initiate a change management process.
    Someone would have to liaise with the ID department and make sure their systems
    are updated, in time for the law going live.</p><p>This change management process and communication between departments
    is not ideal for an agile environment, and change becomes costly and error
    prone. Also the card department is managing more information than it needs
    to be aware of with its "monolithic" approach to rules management which is
    "leaking" information better placed elsewhere. By this I mean that it
    doesn't care what explicit "age &gt;= 18" information determines whether
    someone is an adult, only that they are an adult.</p><p>In contrast to this, let's pursue an approach where we split (de-couple)
    the authoring responsibilities, so that both the central government and the ID
    department maintain their own rules.</p><p>It's the central government's job to determine who is an adult.
    If they change the law they just update their central repository with the
    new rules, which others use:</p><div class="mediaobject"><img src="images/UserGuide/InferIsAdult.png"/></div><p>The IsAdult fact, as discussed previously, is inferred from the
    policy rules. It encapsulates the seemingly arbitrary piece of logic "age
    &gt;= 18" and provides semantic abstractions for its meaning. Now if
    anyone uses the above rules, they no longer need to be aware of explicit
    information that determines whether someone is an adult or not. They can
    just use the inferred fact:</p><div class="mediaobject"><img src="images/UserGuide/IssueIdCard.png"/></div><p>While the example is very minimal and trivial it illustrates some
    important points. We started with a monolithic and leaky approach to our
    knowledge engineering. We created a single decision table that had all
    possible information in it and that leaks information from central government
    that the ID department did not care about and did not want to
    manage.</p><p>We first de-coupled the knowledge process so each department was
    responsible for only what it needed to know. We then encapsulated this
    leaky knowledge using an inferred fact IsAdult. The use of the term
    IsAdult also gave a semantic abstraction to the previously arbitrary logic
    "age &gt;= 18".</p><p>So a general rule of thumb when doing your knowledge engineering
    is:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Bad</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Monolithic</p></li><li class="listitem"><p>Leaky</p></li></ul></div></li><li class="listitem"><p><span class="bold"><strong>Good</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>De-couple knowledge responsibilities</p></li><li class="listitem"><p>Encapsulate knowledge</p></li><li class="listitem"><p>Provide semantic abstractions for those
            encapsulations</p></li></ul></div></li></ul></div></div></div><div class="section" title="6.4. Truth Maintenance with Logical Objects"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5589"/>6.4. Truth Maintenance with <a id="d0e5592" class="indexterm"/> Logical Objects</h2></div></div></div><div class="section" title="6.4.1. Overview"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5596"/>6.4.1. Overview</h3></div></div></div><p>After regular inserts you have to retract facts explicitly. With
    <span class="emphasis"><em>logical</em></span> assertions, the fact that was asserted will
    be automatically retracted when the conditions that asserted it in the
    first place are no longer true. Actually, it's even cleverer then that,
    because it will be retracted only if there isn't any single condition that
    supports the logical assertion.</p><p>Normal insertions are said to be <span class="emphasis"><em>stated</em></span>, i.e.,
    just like the intuitive meaning of "stating a fact" implies. Using a
    <code class="code">HashMap</code> and a counter, we track how many times a particular
    equality is <span class="emphasis"><em>stated</em></span>; this means we count how many
    different instances are equal.</p><p>When we <span class="emphasis"><em>logically</em></span> insert an object during a RHS
    execution we are said to <span class="emphasis"><em>justify</em></span> it, and it is
    considered to be justified by the firing rule. For each logical insertion
    there can only be one equal object, and each subsequent equal logical
    insertion increases the justification counter for this logical assertion.
    A justification is removed by the LHS of the creating rule becoming
    untrue, and the counter is decreased accordingly. As soon as we have no
    more justifications the logical object is automatically retracted.</p><p>If we try to <span class="emphasis"><em>logically</em></span> insert an object when
    there is an equal <span class="emphasis"><em>stated</em></span> object, this will fail and
    return null. If we <span class="emphasis"><em>state</em></span> an object that has an
    existing equal object that is <span class="emphasis"><em>justified</em></span> we override
    the Fact; how this override works depends on the configuration setting
    <code class="code">WM_BEHAVIOR_PRESERVE</code>. When the property is set to discard we
    use the existing handle and replace the existing instance with the new
    Object, which is the default behavior; otherwise we override it to
    <span class="emphasis"><em>stated</em></span> but we create an new
    <code class="code">FactHandle</code>.</p><p>This can be confusing on a first read, so hopefully the flow charts
    below help. When it says that it returns a new <code class="code">FactHandle</code>,
    this also indicates the <code class="code">Object</code> was propagated through the
    network.</p><div class="figure"><a id="d0e5654"/><p class="title"><strong>Figure 6.9. Stated Insertion</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/Stated_Assertion.png" align="middle" alt="Stated Insertion"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e5660"/><p class="title"><strong>Figure 6.10. Logical Insertion</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/HybridReasoning/Logical_Assertion.png" align="middle" alt="Logical Insertion"/></div></div></div><br class="figure-break"/><div class="section" title="6.4.1.1. Bus Pass Example With Inference and TMS"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5666"/>6.4.1.1. Bus Pass Example With Inference and TMS</h4></div></div></div><p>The previous example was issuing ID cards to over 18s, in this
      example we now issue bus passes, either a child or adult pass.</p><pre><code class="no-highlight">rule "Issue Child Bus Pass" when
    $p : Person( age &lt; 16 )
then
    insert(new ChildBusPass( $p ) );
end
 
rule "Issue Adult Bus Pass" when
    $p : Person( age &gt;= 16 )
then
    insert(new AdultBusPass( $p ) );
end</code></pre><p>As before the above example is considered monolithic, leaky and
      providing poor separation of concerns.</p><p>As before we can provide a more robust application with a
      separation of concerns using inference. Notice this time we don't just
      insert the inferred object, we use "insertLogical":</p><pre><code class="no-highlight">rule "Infer Child" when
    $p : Person( age &lt; 16 )
then
    insertLogical( new IsChild( $p ) )
end
rule "Infer Adult" when
    $p : Person( age &gt;= 16 )
then
    insertLogical( new IsAdult( $p ) )
end</code></pre><p>A "insertLogical" is part of the Drools Truth Maintenance System (TMS). When a fact is logically inserted,
        this fact is dependant on the truth of the "when" clause. It means that when the rule becomes false the fact is
        automatically retracted. This works particularly well as the two rules are mutually exclusive. So in the above
        rules if the person is under 16 it inserts an IsChild fact, once the person is 16 or over the IsChild fact is
        automatically retracted and the IsAdult fact inserted.</p><p>Returning to the code to issue bus passes, these two rules can + logically insert the ChildBusPass and
        AdultBusPass facts, as the TMS + supports chaining of logical insertions for a cascading set of retracts.</p><pre><code class="no-highlight">rule "Issue Child Bus Pass" when
    $p : Person( )
         IsChild( person == $p )
then
    insertLogical(new ChildBusPass( $p ) );
end
 
rule "Issue Adult Bus Pass" when
    $p : Person( age &gt;= 16 )
         IsAdult( person =$p )
then
    insertLogical(new AdultBusPass( $p ) );
end</code></pre><p>Now when a person changes from being 15 to 16, not only is the IsChild fact automatically retracted, so is
        the person's ChildBusPass fact. For bonus points we can combine this with the 'not' conditional element to
        handle notifications, in this situation, a request for the returning of the pass. So when the TMS automatically
        retracts the ChildBusPass object, this rule triggers and sends a request to the person:</p><pre><code class="no-highlight">rule "Return ChildBusPass Request "when
    $p : Person( )
         not( ChildBusPass( person == $p ) )
then
    requestChildBusPass( $p );
end</code></pre></div><div class="section" title="6.4.1.2. Important note: Equality for Java objects"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5689"/>6.4.1.2. Important note: Equality for Java objects</h4></div></div></div><p>It is important to note that for Truth Maintenance (and logical
      assertions) to work at all, your Fact objects (which may be JavaBeans)
      must override equals and hashCode methods (from java.lang.Object)
      correctly. As the truth maintenance system needs to know when two
      different physical objects are equal in value, <span class="emphasis"><em>both</em></span>
      equals and hashCode must be overridden correctly, as per the Java
      standard.</p><p>Two objects are equal if and only if their equals methods return
      true for each other and if their hashCode methods return the same
      values. See the Java API for more details (but do keep in mind you
      <span class="emphasis"><em>MUST</em></span> override both equals and hashCode).</p><p>TMS behaviour is not affected by theruntime configuration of
      Identity vs Equality, TMS is always equality.</p></div><div class="section" title="6.4.1.3. Deleting stated or logically asserted facts from the working memory"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5704"/>6.4.1.3. Deleting stated or logically asserted facts from the working memory</h4></div></div></div><p>By default when a fact is deleted from the working memory Drools attempts to remove
      it both from the set of stated facts and also from the Truth Maintenance System in case it has
      been logically asserted. However, using an overload of the delete method, it is also
      possible to remove it only from one of the 2. For instance invoking:</p><pre><code class="no-highlight">ksession.delete( factHandle, FactHandle.State.LOGICAL );</code></pre><p>the fact is removed only if it has been logically asserted, but not if it is a
      stated fact. In this case, if the fact has been stated its deletion fails silently
      and it is ignored.</p></div></div></div><div class="section" title="6.5. Decision Tables in Spreadsheets"><div class="titlepage"><div><div><h2 class="title"><a id="d0e5713"/>6.5. Decision Tables in Spreadsheets</h2></div></div></div><p>Decision tables are a "precise yet compact" (ref. Wikipedia) way of representing conditional logic, and are well
  suited to <span class="emphasis"><em>business</em></span> level rules.</p><p>Drools supports managing rules in a spreadsheet format. Supported formats are Excel (XLS), and CSV, which means
  that a variety of spreadsheet programs (such as Microsoft Excel, OpenOffice.org Calc amongst others) can be utilized.
  It is expected that web based decision table editors will be included in a near future release.</p><p>Decision tables are an old concept (in software terms) but have proven useful over the years. Very briefly
  speaking, in Drools decision tables are a way to generate rules driven from the data entered into a spreadsheet. All
  the usual features of a spreadsheet for data capture and manipulation can be taken advantage of.</p><div class="section" title="6.5.1. When to Use Decision Tables"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5725"/>6.5.1. When to Use Decision Tables</h3></div></div></div><p>Consider decision tables as a course of action if rules exist that can be expressed as rule templates and
    data: each row of a decision table provides data that is combined with a template to generate a rule.</p><p>Many businesses already use spreadsheets for managing data, calculations, etc. If you are happy to continue
    this way, you can also manage your business rules this way. This also assumes you are happy to manage packages of
    rules in <code class="filename">.xls</code> or <code class="filename">.csv</code> files. Decision tables are not recommended for rules
    that do not follow a set of templates, or where there are a small number of rules (or if there is a dislike towards
    software like Excel or OpenOffice.org). They are ideal in the sense that there can be control over what
    <span class="emphasis"><em>parameters</em></span> of rules can be edited, without exposing the rules directly.</p><p>Decision tables also provide a degree of insulation from the underlying object model.</p></div><div class="section" title="6.5.2. Overview"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5743"/>6.5.2. Overview</h3></div></div></div><p>Here are some examples of real world decision tables (slightly edited to protect the
      innocent).</p><div class="figure"><a id="d0e5748"/><p class="title"><strong>Figure 6.11.  Using Excel to edit a decision table </strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/DecisionTables/excel.png" alt="Using Excel to edit a decision table"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e5755"/><p class="title"><strong>Figure 6.12.  Multiple actions for a rule row </strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/DecisionTables/actions.png" alt="Multiple actions for a rule row"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e5762"/><p class="title"><strong>Figure 6.13.  Using OpenOffice.org </strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/DecisionTables/open_office.png" alt="Using OpenOffice.org"/></div></div></div></div><br class="figure-break"/><p>In the above examples, the technical aspects of the decision table have been collapsed
      away (using a standard spreadsheet feature).</p><p>The rules start from row 17, with each row resulting in a rule. The conditions are in
      columns C, D, E, etc., the actions being off-screen. The values in the cells are quite simple,
      and their meaning is indicated by the headers in Row 16. Column B is just a description. It is
      customary to use color to make it obvious what the different areas of the table mean.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Note that although the decision tables look like they process top down, this is not
        necessarily the case. Ideally, rules are authored without regard for the order of rows,
        simply because this makes maintenance easier, as rows will not need to be shifted around all
        the time.</p></div><p>As each row is a rule, the same principles apply. As the rule engine processes the facts,
      any rules that match may fire. (Some people are confused by this. It is possible to clear the
      agenda when a rule fires and simulate a very simple decision table where only the first match
      effects an action.) Also note that you can have multiple tables on one spreadsheet. This way,
      rules can be grouped where they share common templates, yet at the end of the day they are all
      combined into one rule package. Decision tables are essentially a tool to generate DRL rules
      automatically.</p><div class="figure"><a id="d0e5778"/><p class="title"><strong>Figure 6.14.  A real world example using multiple tables for grouping like rules </strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/DecisionTables/multi_table.png" alt="A real world example using multiple tables for grouping like rules"/></div></div></div></div><br class="figure-break"/></div><div class="section" title="6.5.3. How Decision Tables Work"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5785"/>6.5.3. How Decision Tables Work</h3></div></div></div><p>The key point to keep in mind is that in a decision table each row is a rule, and each
      column in that row is either a condition or action for that rule.</p><div class="figure"><a id="d0e5790"/><p class="title"><strong>Figure 6.15.  Rows and columns </strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/DecisionTables/row_col.png" alt="Rows and columns"/></div></div></div></div><br class="figure-break"/><p>The spreadsheet looks for the <em class="firstterm">RuleTable</em> keyword to indicate the
      start of a rule table (both the starting row and column). Other keywords are also used to
      define other package level attributes (covered later). It is important to keep the keywords in
      one column. By convention the second column ("B") is used for this, but it can be any column
      (convention is to leave a margin on the left for notes). In the following diagram, C is
      actually the column where it starts. Everything to the left of this is ignored.</p><p>If we expand the hidden sections, it starts to make more sense how it works; note the
      keywords in column C.</p><div class="figure"><a id="d0e5804"/><p class="title"><strong>Figure 6.16.  Expanded for rule templates </strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/DecisionTables/expanded.png" alt="Expanded for rule templates"/></div></div></div></div><br class="figure-break"/><p>Now the hidden magic which makes it work can be seen. The RuleSet keyword indicates the
      name to be used in the <span class="emphasis"><em>rule package</em></span> that will encompass all the rules.
      This name is optional, using a default, but it <span class="emphasis"><em>must</em></span> have the
        <span class="emphasis"><em>RuleSet</em></span> keyword in the cell immediately to the right.</p><p>The other keywords visible in Column C are Import and Sequential which will be covered
      later. The RuleTable keyword is important as it indicates that a chunk of rules will follow,
      based on some rule templates. After the RuleTable keyword there is a name, used to prefix the
      names of the generated rules. The sheet name and row numbers are appended to guarantee unique
      rule names.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>The RuleTable name combined with the sheet name must be unique across all spreadsheet
        files in the same KieBase. If that's not the case, some rules might have the same name
        and only 1 of them will be applied. To show such ignored rules, <a class="link" href="#changingTheDefaultBuildResultSeverity" title="4.2.2.5. Changing the Default Build Result Severity">raise the severity of such rule name
          conflicts</a>.</p></div><p> The column of RuleTable indicates the column in which the rules start; columns to the
      left are ignored.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>In general the keywords make up name-value pairs.</p></div><p>Referring to row 14 (the row immediately after RuleTable), the keywords CONDITION and
      ACTION indicate that the data in the columns below are for either the LHS or the RHS parts of
      a rule. There are other attributes on the rule which can also be optionally set this
      way.</p><p>Row 15 contains declarations of <em class="firstterm">ObjectTypes</em>. The content in this
      row is optional, but if this option is not in use, the row must be left blank; however this
      option is usually found to be quite useful. When using this row, the values in the cells below
      (row 16) become constraints on that object type. In the above case, it generates
        <code class="code">Person(age=="42")</code> and <code class="code">Cheese(type=="stilton")</code>, where 42 and
      "stilton" come from row 18. In the above example, the "==" is implicit; if just a field name
      is given the translator assumes that it is to generate an exact match.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>An ObjectType declaration can span columns (via merged cells), meaning that all columns
        below the merged range are to be combined into one set of constraints within a single
        pattern matching a single fact at a time, as opposed to non-merged cells containing the same
        ObjectType, but resulting in different patterns, potentially matching different or identical
        facts.</p></div><p>Row 16 contains the rule templates themselves. They can use the "$param" placeholder to
      indicate where data from the cells below should be interpolated. (For multiple insertions, use
      "$1", "$2", etc., indicating parameters from a comma-separated list in a cell below.) Row 17
      is ignored; it may contain textual descriptions of the column's purpose.</p><p>Rows 18 and 19 show data, which will be combined (interpolated) with the templates in row
      15, to generate rules. If a cell contains no data, then its template is ignored. (This would
      mean that some condition or action does not apply for that rule row.) Rule rows are read until
      there is a blank row. Multiple RuleTables can exist in a sheet. Row 20 contains another
      keyword, and a value. The row positions of keywords like this do not matter (most people put
      them at the top) but their column should be the same one where the RuleTable or RuleSet
      keywords should appear. In our case column C has been chosen to be significant, but any other
      column could be used instead.</p><p>In the above example, rules would be rendered like the following (as it uses the
      "ObjectType" row):</p><pre class="screen">//row 18
rule "Cheese_fans_18"
when
    Person(age=="42")
    Cheese(type=="stilton")
then
    list.add("Old man stilton");
end
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The constraints <code class="code">age=="42"</code> and <code class="code">type=="stilton"</code> are interpreted
        as single constraints, to be added to the respective ObjectType in the cell above. If the
        cells above were spanned, then there could be multiple constraints on one "column".</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>Very large decision tables may have very large memory requirements.</p></div></div><div class="section" title="6.5.4. Spreadsheet Syntax"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5871"/>6.5.4. Spreadsheet Syntax</h3></div></div></div><div class="section" title="6.5.4.1. Spreadsheet Structure"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5874"/>6.5.4.1. Spreadsheet Structure</h4></div></div></div><p>There are two types of rectangular areas defining data that is used for generating a DRL file. One, marked
      by a cell labelled <code class="code">RuleSet</code>, defines all DRL items except rules. The other one may occur repeatedly
      and is to the right and below a cell whose contents begin with <code class="code">RuleTable</code>. These areas represent the
      actual decision tables, each area resulting in a set of rules of similar structure.</p><p>A Rule Set area may contain cell pairs, one below the <code class="code">RuleSet</code> cell and containing a keyword
      designating the kind of value contained in the other one that follows in the same row.</p><p>The columns of a Rule Table area define patterns and constraints for the left hand sides of the rules
      derived from it, actions for the consequences of the rules, and the values of individual rule attributes. Thus, a
      Rule Table area should contain one or more columns, both for conditions and actions, and an arbitrary selection of
      columns for rule attributes, at most one column for each of these. The first four rows following the row with the
      cell marked with <code class="code">RuleTable</code> are earmarked as header area, mostly used for the definition of code to
      construct the rules. It is any additional row below these four header rows that spawns another rule, with its data
      providing for variations in the code defined in the Rule Table header.</p><p>All keywords are case insensitive.</p><p>Only the first worksheet is examined for decision tables.</p></div><div class="section" title="6.5.4.2. Rule Set Entries"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5899"/>6.5.4.2. Rule Set Entries</h4></div></div></div><p>Entries in a Rule Set area may define DRL constructs (except rules), and specify rule attributes. While
      entries for constructs may be used repeatedly, each rule attribute may be given at most once, and it applies to
      all rules unless it is overruled by the same attribute being defined within the Rule Table area.</p><p>Entries must be given in a vertically stacked sequence of cell pairs. The first one contains a keyword and
      the one to its right the value, as shown in the table below. This sequence of cell pairs may be interrupted by
      blank rows or even a Rule Table, as long as the column marked by <code class="code">RuleSet</code> is upheld as the one
      containing the keyword.</p><div class="table"><a id="d0e5909"/><p class="title"><strong>Table 6.5. Entries in the Rule Set area</strong></p><div class="table-contents"><table summary="Entries in the Rule Set area" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Keyword</th><th>Value</th><th>Usage</th></tr></thead><tbody><tr><td>RuleSet</td><td>The package name for the generated DRL file. Optional, the default is
              <code class="code">rule_table</code>.</td><td>Must be First entry.</td></tr><tr><td>Sequential</td><td>"true" or "false". If "true", then salience is used to ensure that rules fire from the top
              down.</td><td>Optional, at most once. If omitted, no firing order is imposed.</td></tr><tr><td>EscapeQuotes</td><td>"true" or "false". If "true", then quotation marks are escaped so that they appear literally in the
              DRL.</td><td>Optional, at most once. If omitted, quotation marks are escaped.</td></tr><tr><td>Import</td><td>A comma-separated list of Java classes to import.</td><td>Optional, may be used repeatedly.</td></tr><tr><td>Variables</td><td>Declarations of DRL globals, i.e., a type followed by a variable name. Multiple global definitions
              must be separated with a comma.</td><td>Optional, may be used repeatedly.</td></tr><tr><td>Functions</td><td>One or more function definitions, according to DRL syntax.</td><td>Optional, may be used repeatedly.</td></tr><tr><td>Queries</td><td>One or more query definitions, according to DRL syntax.</td><td>Optional, may be used repeatedly.</td></tr><tr><td>Declare</td><td>One or more declarative types, according to DRL syntax.</td><td>Optional, may be used repeatedly.</td></tr></tbody></table></div></div><br class="table-break"/><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>In some locales, MS Office, LibreOffice and OpenOffice will encode a double quoth <code class="literal">"</code>
        differently, which will cause a compilation error. The difference is often hard to see. For example:
        <code class="literal">“A”</code> will fail, but <code class="literal">"A"</code> will work.</p></div><p>For defining rule attributes that apply to all rules in the generated DRL file you can use any of the
      entries in the following table. Notice, however, that the proper keyword must be used. Also, each of these
      attributes may be used only once.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>Rule attributes specified in a Rule Set area will affect all rule assets in the same package (not only
          in the spreadsheet). Unless you are sure that the spreadsheet is the only one rule asset in the package, the
          recommendation is to specify rule attributes not in a Rule Set area but in a Rule Table columns for each
          rule instead.</p></div><div class="table"><a id="d0e5998"/><p class="title"><strong>Table 6.6. Rule attribute entries in the Rule Set area</strong></p><div class="table-contents"><table summary="Rule attribute entries in the Rule Set area" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Keyword</th><th>Initial</th><th>Value</th></tr></thead><tbody><tr><td>PRIORITY</td><td>P</td><td>An integer defining the "salience" value for the rule. Overridden by the "Sequential" flag.</td></tr><tr><td>DURATION</td><td>D</td><td>A long integer value defining the "duration" value for the rule.</td></tr><tr><td>TIMER</td><td>T</td><td>A timer definition. See "Timers and Calendars".</td></tr><tr><td>ENABLED</td><td>B</td><td>A Boolean value. "true" enables the rule; "false" disables the rule.</td></tr><tr><td>CALENDARS</td><td>E</td><td>A calendars definition. See "Timers and Calendars".</td></tr><tr><td>NO-LOOP</td><td>U</td><td>A Boolean value. "true" inhibits looping of rules due to changes made by its consequence.</td></tr><tr><td>LOCK-ON-ACTIVE</td><td>L</td><td>A Boolean value. "true" inhibits additional activations of all rules with this flag set within the
              same ruleflow or agenda group.</td></tr><tr><td>AUTO-FOCUS</td><td>F</td><td>A Boolean value. "true" for a rule within an agenda group causes activations of the rule to
              automatically give the focus to the group.</td></tr><tr><td>ACTIVATION-GROUP</td><td>X</td><td>A string identifying an activation (or XOR) group. Only one rule within an activation group will
              fire, i.e., the first one to fire cancels any existing activations of other rules within the same
              group.</td></tr><tr><td>AGENDA-GROUP</td><td>G</td><td>A string identifying an agenda group, which has to be activated by giving it the "focus", which is
              one way of controlling the flow between groups of rules.</td></tr><tr><td>RULEFLOW-GROUP</td><td>R</td><td>A string identifying a rule-flow group.</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="section" title="6.5.4.3. Rule Tables"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6088"/>6.5.4.3. Rule Tables</h4></div></div></div><p>All Rule Tables begin with a cell containing "RuleTable", optionally followed by a string within the same
      cell. The string is used as the initial part of the name for all rules derived from this Rule Table, with the row
      number appended for distinction. (This automatic naming can be overridden by using a NAME column.) All other cells
      defining rules of this Rule Table are below and to the right of this cell.</p><p>The next row defines the column type, with each column resulting in a part of the condition or the
      consequence, or providing some rule attribute, the rule name or a comment. The table below shows which column
      headers are available; additional columns may be used according to the table showing rule attribute entries given
      in the preceding section. Note that each attribute column may be used at most once. For a column header, either
      use the keyword or any other word beginning with the letter given in the "Initial" column of these tables.</p><div class="table"><a id="d0e6095"/><p class="title"><strong>Table 6.7. Column Headers in the Rule Table</strong></p><div class="table-contents"><table summary="Column Headers in the Rule Table" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th>Keyword</th><th>Initial</th><th>Value</th><th>Usage</th></tr></thead><tbody><tr><td>NAME</td><td>N</td><td>Provides the name for the rule generated from that row. The default is constructed from the text
              following the RuleTable tag and the row number.</td><td>At most one column</td></tr><tr><td>DESCRIPTION</td><td>I</td><td>A text, resulting in a comment within the generated rule.</td><td>At most one column</td></tr><tr><td>CONDITION</td><td>C</td><td>Code snippet and interpolated values for constructing a constraint within a pattern in a
              condition.</td><td>At least one per rule table</td></tr><tr><td>ACTION</td><td>A</td><td>Code snippet and interpolated values for constructing an action for the consequence of the
              rule.</td><td>At least one per rule table</td></tr><tr><td>METADATA</td><td>@</td><td>Code snippet and interpolated values for constructing a metadata entry for the rule.</td><td>Optional, any number of columns</td></tr></tbody></table></div></div><br class="table-break"/><p>Given a column headed CONDITION, the cells in successive lines result in a conditional element.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Text in the first cell below CONDITION develops into a pattern for the rule condition, with the snippet
          in the next line becoming a constraint. If the cell is merged with one or more neighbours, a single pattern
          with multiple constraints is formed: all constraints are combined into a parenthesized list and appended to
          the text in this cell. The cell may be left blank, which means that the code snippet in the next row must
          result in a valid conditional element on its own.</p><p>To include a pattern without constraints, you can write the pattern in front of the text for another
          pattern.</p><p>The pattern may be written with or without an empty pair of parentheses. A "from" clause may be appended
          to the pattern.</p><p>If the pattern ends with "eval", code snippets are supposed to produce boolean expressions for inclusion
          into a pair of parentheses after "eval".</p></li><li class="listitem"><p>Text in the second cell below CONDITION is processed in two steps.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The code snippet in this cell is modified by interpolating values from cells farther down in the
              column. If you want to create a constraint consisting of a comparison using "==" with the value from the
              cells below, the field selector alone is sufficient. Any other comparison operator must be specified as
              the last item within the snippet, and the value from the cells below is appended. For all other constraint
              forms, you must mark the position for including the contents of a cell with the symbol
              <code class="code">$param</code>. Multiple insertions are possible by using the symbols <code class="code">$1</code>,
              <code class="code">$2</code>, etc., and a comma-separated list of values in the cells below.</p><p>A text according to the pattern
              <code class="code">forall(</code><span class="emphasis"><em>delimiter</em></span><code class="code">){</code><span class="emphasis"><em>snippet</em></span><code class="code">}</code>
              is expanded by repeating the <span class="emphasis"><em>snippet</em></span> once for each of the values of the
              comma-separated list of values in each of the cells below, inserting the value in place of the symbol
              <code class="code">$</code> and by joining these expansions by the given <span class="emphasis"><em>delimiter</em></span>. Note that the
              forall construct may be surrounded by other text.</p></li><li class="listitem"><p>If the cell in the preceding row is not empty, the completed code snippet is added to the
              conditional element from that cell. A pair of parentheses is provided automatically, as well as a
              separating comma if multiple constraints are added to a pattern in a merged cell.</p><p>If the cell above is empty, the interpolated result is used as is.</p></li></ol></div></li><li class="listitem"><p>Text in the third cell below CONDITION is for documentation only. It should be used to indicate the
          column's purpose to a human reader.</p></li><li class="listitem"><p>From the fourth row on, non-blank entries provide data for interpolation as described above. A blank
          cell results in the omission of the conditional element or constraint for this rule.</p></li></ul></div><p>Given a column headed ACTION, the cells in successive lines result in an action statement.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Text in the first cell below ACTION is optional. If present, it is interpreted as an object
          reference.</p></li><li class="listitem"><p>Text in the second cell below ACTION is processed in two steps.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The code snippet in this cell is modified by interpolating values from cells farther down in the
              column. For a singular insertion, mark the position for including the contents of a cell with the symbol
              <code class="code">$param</code>. Multiple insertions are possible by using the symbols <code class="code">$1</code>,
              <code class="code">$2</code>, etc., and a comma-separated list of values in the cells below.</p><p>A method call without interpolation can be achieved by a text without any marker symbols. In this
              case, use any non-blank entry in a row below to include the statement.</p><p>The forall construct is available here, too.</p></li><li class="listitem"><p>If the first cell is not empty, its text, followed by a period, the text in the second cell and a
              terminating semicolon are stringed together, resulting in a method call which is added as an action
              statement for the consequence.</p><p>If the cell above is empty, the interpolated result is used as is.</p></li></ol></div></li><li class="listitem"><p>Text in the third cell below ACTION is for documentation only. It should be used to indicate the
          column's purpose to a human reader.</p></li><li class="listitem"><p>From the fourth row on, non-blank entries provide data for interpolation as described above. A blank
          cell results in the omission of the action statement for this rule.</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Using <code class="code">$1</code> instead of <code class="code">$param</code> works in most cases, but it will fail if the
        replacement text contains a comma: then, only the part preceding the first comma is inserted. Use this
        "abbreviation" judiciously.</p></div><p>Given a column headed METADATA, the cells in successive lines result in a metadata annotation for the
      generated rules.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Text in the first cell below METADATA is ignored.</p></li><li class="listitem"><p>Text in the second cell below METADATA is subject to interpolation, as described above, using values
          from the cells in the rule rows. The metadata marker character <code class="code">@</code> is prefixed automatically, and
          thus it should not be included in the text for this cell.</p></li><li class="listitem"><p>Text in the third cell below METADATA is for documentation only. It should be used to indicate the
          column's purpose to a human reader.</p></li><li class="listitem"><p>From the fourth row on, non-blank entries provide data for interpolation as described above. A blank
          cell results in the omission of the metadata annotation for this rule.</p></li></ul></div></div><div class="section" title="6.5.4.4. Examples"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6280"/>6.5.4.4. Examples</h4></div></div></div><p>The various interpolations are illustrated in the following example.</p><div class="example"><a id="d0e6285"/><p class="title"><strong>Example 6.1. Interpolating cell data</strong></p><div class="example-contents"><p>If the template is <code class="code">Foo(bar == $param)</code> and the cell is <code class="code">42</code>,
          then the result is <code class="code">Foo(bar == 42)</code>.</p><p>If the template is <code class="code">Foo(bar &lt; $1, baz == $2)</code> and the cell contains
            <code class="code">42,43</code>, the result will be <code class="code">Foo(bar &lt; 42, baz ==43)</code>.</p><p>The template <code class="code">forall(&amp;&amp;){bar != $}</code> with a cell containing
            <code class="code">42,43</code> results in <code class="code">bar != 42 &amp;&amp; bar != 43</code>.</p></div></div><br class="example-break"/><p>The next example demonstrates the joint effect of a cell defining the pattern type and
        the code snippet below it. </p><div class="screenshot"><div class="mediaobject"><img src="images/DecisionTables/spanned_column.png"/></div></div><p> This spreadsheet section shows how the <code class="code">Person</code> type declaration
        spans 2 columns, and thus both constraints will appear as <code class="code">Person(age == ..., type ==
          ...)</code>. Since only the field names are present in the snippet, they imply an equality
        test.</p><p>In the following example the marker symbol <code class="code">$param</code> is used. </p><div class="screenshot"><div class="mediaobject"><img src="images/DecisionTables/with_param.png"/></div></div><p> The result of this column is the pattern <code class="code">Person(age == "42"))</code>.
        You may have noticed that the marker and the operator "==" are redundant.</p><p>The next example illustrates that a trailing insertion marker can be omitted. </p><div class="screenshot"><div class="mediaobject"><img src="images/DecisionTables/operator_completion.png"/></div></div><p> Here, appending the value from the cell is implied, resulting in
          <code class="code">Person(age &lt; "42")).</code></p><p>You can provide the definition of a binding variable, as in the example below. . </p><div class="screenshot"><div class="mediaobject"><img src="images/DecisionTables/with_binding.png"/></div></div><p> Here, the result is <code class="code">c: Cheese(type == "stilton").</code> Note that the
        quotes are provided automatically. Actually, anything can be placed in the object type row.
        Apart from the definition of a binding variable, it could also be an additional pattern that
        is to be inserted literally.</p><p>A simple construction of an action statement with the insertion of a single value is
        shown below. </p><div class="screenshot"><div class="mediaobject"><img src="images/DecisionTables/consequence.png"/></div></div><p> The cell below the ACTION header is left blank. Using this style, anything can
        be placed in the consequence, not just a single method call. (The same technique is
        applicable within a CONDITION column as well.)</p><p>Below is a comprehensive example, showing the use of various column headers. It is not
        an error to have no value below a column header (as in the NO-LOOP column): here, the
        attribute will not be applied in any of the rules. </p><div class="figure"><a id="d0e6375"/><p class="title"><strong>Figure 6.17.  Example usage of keywords for imports, headers, etc. </strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/DecisionTables/Key.png" alt="Example usage of keywords for imports, headers, etc."/></div></div></div></div><p><br class="figure-break"/>
      </p><p>And, finally, here is an example of Import, Variables and Functions. </p><div class="figure"><a id="d0e6385"/><p class="title"><strong>Figure 6.18.  Example usage of keywords for functions, etc. </strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/DecisionTables/keywords.png" alt="Example usage of keywords for functions, etc."/></div></div></div></div><p><br class="figure-break"/> Multiple package names within the same cell must be separated by a comma. Also,
        the pairs of type and variable names must be comma-separated. Functions, however, must be
        written as they appear in a DRL file. This should appear in the same column as the "RuleSet"
        keyword; it could be above, between or below all the rule rows.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>It may be more convenient to use Import, Variables, Functions and Queries repeatedly
          rather than packing several definitions into a single cell.</p></div></div></div><div class="section" title="6.5.5. Creating and integrating Spreadsheet based Decision Tables"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6396"/>6.5.5. Creating and integrating Spreadsheet based Decision Tables</h3></div></div></div><p>The API to use spreadsheet based decision tables is in the drools-decisiontables module. There is really only
    one class to look at: <code class="literal">SpreadsheetCompiler</code>. This class will take spreadsheets in various formats,
    and generate rules in DRL (which you can then use in the normal way). The <code class="literal">SpreadsheetCompiler</code> can
    just be used to generate partial rule files if it is wished, and assemble it into a complete rule package after the
    fact (this allows the separation of technical and non-technical aspects of the rules if needed).</p><p>To get started, a sample spreadsheet can be used as a base. Alternatively, if the plug-in
      is being used (Rule Workbench IDE), the wizard can generate a spreadsheet from a template (to
      edit it an xls compatible spreadsheet editor will need to be used). 
      </p><div class="figure"><a id="d0e6409"/><p class="title"><strong>Figure 6.19.  Wizard in the IDE </strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/DecisionTables/wizard.png" alt="Wizard in the IDE"/></div></div></div></div><p><br class="figure-break"/>
    </p></div><div class="section" title="6.5.6. Managing Business Rules in Decision Tables"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6417"/>6.5.6. Managing Business Rules in Decision Tables</h3></div></div></div><div class="section" title="6.5.6.1. Workflow and Collaboration"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6420"/>6.5.6.1. Workflow and Collaboration</h4></div></div></div><p>Spreadsheets are well established business tools (in use for over 25 years). Decision tables lend themselves
      to close collaboration between IT and domain experts, while making the business rules clear to business analysts,
      it is an ideal separation of concerns.</p><p>Typically, the whole process of authoring rules (coming up with a new decision table) would be something
      like:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Business analyst takes a template decision table (from a repository, or from IT)</p></li><li class="listitem"><p>Decision table business language descriptions are entered in the table(s)</p></li><li class="listitem"><p>Decision table rules (rows) are entered (roughly)</p></li><li class="listitem"><p>Decision table is handed to a technical resource, who maps the business language (descriptions) to
          scripts (this may involve software development of course, if it is a new application or data model)</p></li><li class="listitem"><p>Technical person hands back and reviews the modifications with the business analyst.</p></li><li class="listitem"><p>The business analyst can continue editing the rule rows as needed (moving columns around is also fine
          etc).</p></li><li class="listitem"><p>In parallel, the technical person can develop test cases for the rules (liaising with business analysts)
          as these test cases can be used to verify rules and rule changes once the system is running.</p></li></ol></div></div><div class="section" title="6.5.6.2. Using spreadsheet features"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6449"/>6.5.6.2. Using spreadsheet features</h4></div></div></div><p>Features of applications like Excel can be used to provide assistance in entering data
        into spreadsheets, such as validating fields. Lists that are stored in other worksheets can
        be used to provide valid lists of values for cells, like in the following diagram. 
        </p><div class="figure"><a id="d0e6454"/><p class="title"><strong>Figure 6.20. </strong></p><div class="figure-contents"><div class="screenshot"><span style="color: red">&lt;title&gt; Wizard in the IDE &lt;/title&gt;</span><div class="mediaobject"><img src="images/DecisionTables/lists.png"/></div></div></div></div><p><br class="figure-break"/>
      </p><p>Some applications provide a limited ability to keep a history of changes, but it is recommended to use an
      alternative means of revision control. When changes are being made to rules over time, older versions are archived
      (many open source solutions exist for this, such as Subversion or Git).</p></div></div><div class="section" title="6.5.7. Rule Templates"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6464"/>6.5.7. Rule Templates</h3></div></div></div><p>Related to decision tables (but not necessarily requiring a spreadsheet) are "Rule
      Templates" (in the drools-templates module). These use any tabular data source as a source of
      rule data - populating a template to generate many rules. This can allow both for more
      flexible spreadsheets, but also rules in existing databases for instance (at the cost of
      developing the template up front to generate the rules).</p><p>With Rule Templates the data is separated from the rule and there are no restrictions on
      which part of the rule is data-driven. So whilst you can do everything you could do in
      decision tables you can also do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>store your data in a database (or any other format)</p></li><li class="listitem"><p>conditionally generate rules based on the values in the data</p></li><li class="listitem"><p>use data for any part of your rules (e.g. condition operator, class name, property
          name)</p></li><li class="listitem"><p>run different templates over the same data</p></li></ul></div><p>As an example, a more classic decision table is shown, but without any hidden rows for the
      rule meta data (so the spreadsheet only contains the raw data to generate the rules).</p><div class="figure"><a id="d0e6486"/><p class="title"><strong>Figure 6.21.  Template data </strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/DecisionTables/template1.png" alt="Template data"/></div></div></div></div><br class="figure-break"/><p>See the <code class="filename">ExampleCheese.xls</code> in the examples download for the above
      spreadsheet.</p><p>If this was a regular decision table there would be hidden rows before row 1 and between
      rows 1 and 2 containing rule metadata. With rule templates the data is completely separate
      from the rules. This has two handy consequences - you can apply multiple rule templates to the
      same data and your data is not tied to your rules at all. So what does the template look
      like?</p><pre><code class="no-highlight">
1  template header
2  age
3  type
4  log
5
6  package org.drools.examples.templates;
7
8  global java.util.List list;
9
10 template "cheesefans"
11
12 rule "Cheese fans_@{row.rowNumber}"
13 when
14    Person(age == @{age})
15    Cheese(type == "@{type}")
16 then
17    list.add("@{log}");
18 end
19
20 end template
</code></pre><p>Annotations to the preceding program listing: </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Line 1: All rule templates start with <code class="code">template header</code>.</p></li><li class="listitem"><p>Lines 2-4: Following the header is the list of columns in the order they appear in
            the data. In this case we are calling the first column <code class="code">age</code>, the second
              <code class="code">type</code> and the third <code class="code">log</code>.</p></li><li class="listitem"><p>Line 5: An empty line signifies the end of the column definitions.</p></li><li class="listitem"><p>Lines 6-9: Standard rule header text. This is standard rule DRL and will appear at
            the top of the generated DRL. Put the package statement and any imports and global and
            function definitions into this section.</p></li><li class="listitem"><p>Line 10: The keyword <code class="code">template</code> signals the start of a rule template.
            There can be more than one template in a template file, but each template should have a
            unique name.</p></li><li class="listitem"><p>Lines 11-18: The rule template - see below for details.</p></li><li class="listitem"><p>Line 20: The keywords <code class="code">end template</code> signify the end of the
            template.</p></li></ul></div><p>The rule templates rely on MVEL to do substitution using the syntax @{token_name}. There
      is currently one built-in expression, @{row.rowNumber} which gives a unique number for each
      row of data and enables you to generate unique rule names. For each row of data a rule will be
      generated with the values in the data substituted for the tokens in the template.</p><p>A rule template has to be included in a file with extension .drt and associated to
      the corresponding decision table when defining the kbase in the kmodule.xml file as in
      the following example</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;kmodule xmlns="http://drools.org/xsd/kmodule"&gt;
  &lt;kbase name="TemplatesKB" packages="org.drools.examples.templates"&gt;
    &lt;ruleTemplate dtable="org/drools/examples/templates/ExampleCheese.xls"
                  template="org/drools/examples/templates/Cheese.drt"
                  row="2" col="2"/&gt;
      &lt;ksession name="TemplatesKS"/&gt;
      &lt;/kbase&gt;
&lt;/kmodule&gt;
</code></pre><p>With the example data above the following rule file would be generated:</p><pre><code class="no-highlight">
package org.drools.examples.templates;

global java.util.List list;

rule "Cheese fans_1"
when
  Person(age == 42)
  Cheese(type == "stilton")
then
  list.add("Old man stilton");
end

rule "Cheese fans_2"
when
  Person(age == 21)
  Cheese(type == "cheddar")
then
  list.add("Young man cheddar");
end
</code></pre><p>At this point the <code class="code">KieSession</code> named "TemplatesKS" and containing the rules
      generated from the template can be simply created from the <code class="code">KieContainer</code>
      and used as any other <code class="code">KieSession</code>.</p><pre><code class="language-java">
KieSession ksession = kc.newKieSession( "TemplatesKS" );

//now create some test data
ksession.insert( new Cheese( "stilton", 42 ) );
ksession.insert( new Person( "michael", "stilton", 42 ) );
final List&lt;String&gt; list = new ArrayList&lt;String&gt;();
ksession.setGlobal( "list", list );

ksession.fireAllRules();
</code></pre></div></div><div class="section" title="6.6. Logging"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6567"/>6.6. Logging</h2></div></div></div><p>One way to illuminate the black box that is a rule engine, is to play with the logging level.</p><p>Everything is logged to <a class="link" href="http://www.slf4j.org/">SLF4J</a>, which is a simple logging facade
  that can delegate any log to Logback, Apache Commons Logging, Log4j or java.util.logging. Add a dependency to the
  logging adaptor for your logging framework of choice. If you're not using any logging framework yet, you can use
  Logback by adding this Maven dependency:</p><pre><code class="language-xml">    &lt;dependency&gt;
      &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
      &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
      &lt;version&gt;1.x&lt;/version&gt;
    &lt;/dependency&gt;</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If you're developing for an ultra light environment, use <code class="literal">slf4j-nop</code> or
    <code class="literal">slf4j-simple</code> instead.</p></div><p>Configure the logging level on the package <code class="literal">org.drools</code>. For example:</p><p>In Logback, configure it in your <code class="filename">logback.xml</code> file:</p><pre><code class="language-xml">&lt;configuration&gt;

    &lt;logger name="org.drools" level="debug"/&gt;

    ...

&lt;configuration&gt;</code></pre><p>In Log4J, configure it in your <code class="filename">log4j.xml</code> file:</p><pre><code class="language-xml">&lt;log4j:configuration xmlns:log4j="http://jakarta.apache.org/log4j/"&gt;

    &lt;category name="org.drools"&gt;
      &lt;priority value="debug" /&gt;
    &lt;/category&gt;

    ...

&lt;/log4j:configuration&gt;</code></pre></div></div><div class="chapter" title="Chapter 7. Running"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6607"/>Chapter 7. Running</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e6612">7.1. KieRuntime</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6615">7.1.1. EntryPoint</a></span></dt><dt><span class="section"><a href="#d0e6790">7.1.2. RuleRuntime</a></span></dt><dt><span class="section"><a href="#d0e6849">7.1.3. StatefulRuleSession</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e6889">7.2. Agenda</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6926">7.2.1. Conflict Resolution</a></span></dt><dt><span class="section"><a href="#d0e6942">7.2.2. AgendaGroup</a></span></dt><dt><span class="section"><a href="#d0e6974">7.2.3. ActivationGroup</a></span></dt><dt><span class="section"><a href="#d0e6990">7.2.4. RuleFlowGroup</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e7006">7.3. Event Model</a></span></dt><dt><span class="section"><a href="#d0e7084">7.4. StatelessKieSession</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7214">7.4.1. Sequential Mode</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e7279">7.5. Rule Execution Modes</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7286">7.5.1. Passive Mode</a></span></dt><dt><span class="section"><a href="#d0e7301">7.5.2. Active Mode</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e7377">7.6. Propagation modes</a></span></dt><dt><span class="section"><a href="#d0e7429">7.7. Commands and the CommandExecutor</a></span></dt></dl></div><p>Ths sections extends the KIE Running section, which should be read first, with specifics for the Drools runtime.</p><div class="section" title="7.1. KieRuntime"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6612"/>7.1. KieRuntime</h2></div></div></div><div class="section" title="7.1.1. EntryPoint"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6615"/>7.1.1. EntryPoint</h3></div></div></div><p>The <code class="code">EntryPoint</code> provides the methods around inserting, updating and deleting
        facts. The term "entry point" is related to the fact that we have multiple partitions in a
        Working Memory and you can choose which one you are inserting into. The use of multiple
        entry points is more common in event processing use cases, but they can be used by pure rule
        applications as well. </p><p>The <code class="code">KieRuntime</code> interface provides the main
      interaction with the engine. It is available in rule consequences and
      process actions. In this manual the focus is on the methods and
      interfaces related to rules, and the methods pertaining to processes
      will be ignored for now. But you'll notice that the
      <code class="code">KieRuntime</code> inherits methods from both the
      <code class="code">WorkingMemory</code> and the <code class="code">ProcessRuntime</code>, thereby
      providing a unified API to work with processes and rules. When working
      with rules, three interfaces form the <code class="code">KieRuntime</code>:
      <code class="code">EntryPoint</code>, <code class="code">WorkingMemory</code> and the
      <code class="code">KieRuntime</code> itself.</p><div class="figure"><a id="d0e6649"/><p class="title"><strong>Figure 7.1. EntryPoint</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/ApiReference/EntryPoint.png" alt="EntryPoint"/></div></div></div><br class="figure-break"/><div class="section" title="7.1.1.1. Insert"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6655"/>7.1.1.1. Insert</h4></div></div></div><p>In order for a fact to be evaluated against the rules in a <code class="code">KieBase</code>, it
          has to be inserted into the session. This is done by calling the method
            <code class="code">insert(yourObject)</code>. When a fact is inserted into the session, some of its
          properties might be immediately evaluated (eager evaluation) and some might be deferred
          for later evaluation (lazy evaluation). The exact behaviour depends on the rules engine
          algorithm being used. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Expert systems typically use the term <span class="emphasis"><em>assert</em></span> or
              <span class="emphasis"><em>assertion</em></span> to refer to facts made available to the system.
            However, due to "assert" being a keyword in most languages, we have decided to use the
              <code class="literal">insert</code> keyword; In this manual, the two terms are used
            interchangeably.</p></div><p>When an Object is inserted it returns a <code class="code">FactHandle</code>.
        This <code class="code">FactHandle</code> is the token used to represent your
        inserted object within the <code class="code">WorkingMemory</code>. It is also used
        for interactions with the <code class="code">WorkingMemory</code> when you wish to
        delete or modify an object.</p><pre><code class="language-java">Cheese stilton = new Cheese("stilton");
FactHandle stiltonHandle = ksession.insert( stilton );      </code></pre><p>As mentioned in the KieBase section, a Working Memory may operate in two assertion
          modes: either equality or identity. Identity is the default.</p><p><span class="emphasis"><em>Identity</em></span> means that the Working Memory uses
        an <code class="code">IdentityHashMap</code> to store all asserted objects. New
        instance assertions always result in the return of new
        <code class="code">FactHandle</code>, but if an instance is asserted again then it
        returns the original fact handle, i.e., it ignores repeated insertions
        for the same object.</p><p><span class="emphasis"><em>Equality</em></span> means that the Working Memory uses a
            <code class="code">HashMap</code> to store all asserted objects. An object instance assertion will
          only return a new <code class="code">FactHandle</code> if the inserted object is not equal (according
          to its <code class="code">equal()/hashcode()</code> methods) to an already existing fact.</p></div><div class="section" title="7.1.1.2. Delete"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6720"/>7.1.1.2. Delete</h4></div></div></div><p>In order to remove a fact from the session, the method <code class="code">delete()</code> is used.
          When a fact is deleted,  any matches that are active and depend on that fact will be
          cancelled. Note that it is possible to have rules that depend on the nonexistence of a
          fact, in which case deleting a fact may cause a rule to activate. (See the
            <code class="code">not</code> and <code class="code">exists</code> keywords). </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Expert systems typically use the term <span class="emphasis"><em>retract</em></span> or
              <span class="emphasis"><em>retraction</em></span> to refer to the operation of removing facts from the
            Working Memory. Drools prefers the keyword <code class="literal">delete</code> for symmetry with
            the keyword <code class="code">insert</code>; Drools also supports the keyword <code class="code">retract</code>,
            but it was deprecated in favor of <code class="code">delete</code>. In this manual, the two terms are
            used interchangeably.</p></div><p>Retraction may be done using the <code class="code">FactHandle</code> that was returned by the
          insert call. On the right hand side of a rule the <code class="literal">delete</code> statement is
          used, which works with a simple object reference.</p><pre><code class="language-java">Cheese stilton = new Cheese("stilton");
FactHandle stiltonHandle = ksession.insert( stilton );
....
ksession.delete( stiltonHandle );            </code></pre></div><div class="section" title="7.1.1.3. Update"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6765"/>7.1.1.3. Update</h4></div></div></div><p>The Rule Engine must be notified of modified facts, so that they
        can be reprocessed. You must use the <code class="code">update()</code> method to
        notify the <code class="code">WorkingMemory</code> of changed objects for those
        objects that are not able to notify the <code class="code">WorkingMemory</code>
        themselves. Notice that <code class="code">update()</code> always takes the
        modified object as a second parameter, which allows you to specify new
        instances for immutable objects. On the right hand side of a rule the
        <code class="code">modify</code> statement is recommended, as it makes the
        changes and notifies the engine in a single statement. Alternatively,
        after changing a fact object's field values through calls of setter
        methods you must invoke <code class="code">update</code> immediately, event
        before changing another fact, or you will cause problems with the
        indexing within the rule engine. The modify statement avoids this
        problem.</p><pre><code class="language-java">Cheese stilton = new Cheese("stilton");
FactHandle stiltonHandle = workingMemory.insert( stilton );
...
stilton.setPrice( 100 );
workingMemory.update( stiltonHandle, stilton );              </code></pre></div></div><div class="section" title="7.1.2. RuleRuntime"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6790"/>7.1.2. RuleRuntime</h3></div></div></div><p>The RuleRuntime provides access to the Agenda, permits query
      executions, and lets you access named Entry Points.</p><div class="figure"><a id="d0e6795"/><p class="title"><strong>Figure 7.2. RuleRuntime</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/ApiReference/RuleRuntime.png" alt="RuleRuntime"/></div></div></div><br class="figure-break"/><div class="section" title="7.1.2.1. Query"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6801"/>7.1.2.1. Query</h4></div></div></div><p>Queries are used to retrieve fact sets based on patterns, as
        they are used in rules. Patterns may make use of optional parameters.
        Queries can be defined in the Knowledge Base, from where they are
        called up to return the matching results. While iterating over the
        result collection, any identifier bound in the query can be used to
        access the corresponding fact or fact field by calling the
        <code class="code">get</code> method with the binding variable's name as its
        argument. If the binding refers to a fact object, its FactHandle can
        be retrieved by calling <code class="code">getFactHandle</code>, again with the
        variable's name as the parameter.</p><div class="figure"><a id="d0e6812"/><p class="title"><strong>Figure 7.3. QueryResults</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/ApiReference/QueryResults.png" alt="QueryResults"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e6818"/><p class="title"><strong>Figure 7.4. QueryResultsRow</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/ApiReference/QueryResultsRow.png" alt="QueryResultsRow"/></div></div></div><br class="figure-break"/><div class="example"><a id="d0e6824"/><p class="title"><strong>Example 7.1. Simple Query Example</strong></p><div class="example-contents"><pre><code class="language-java">QueryResults results =
    ksession.getQueryResults( "my query", new Object[] { "string" } );
for ( QueryResultsRow row : results ) {
    System.out.println( row.get( "varName" ) );
}</code></pre></div></div><br class="example-break"/></div><div class="section" title="7.1.2.2. Live Queries"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6829"/>7.1.2.2. Live Queries</h4></div></div></div><p>Invoking queries and processing the results by iterating over
        the returned set is not a good way to monitor changes over
        time.</p><p>To alleviate this, Drools provides Live Queries, which have a
        listener attached instead of returning an iterable result set. These
        live queries stay open by creating a view and publishing change events for
        the contents of this view. To activate, you start your query with
        parameters and listen to changes in the resulting view. The
        <code class="code">dispose</code> method terminates the query and discontinues this
        reactive scenario.</p><div class="example"><a id="d0e6839"/><p class="title"><strong>Example 7.2. Implementing ViewChangedEventListener</strong></p><div class="example-contents"><pre><code class="language-java">final List updated = new ArrayList();
final List removed = new ArrayList();
final List added = new ArrayList();

ViewChangedEventListener listener = new ViewChangedEventListener() {
 public void rowUpdated(Row row) {
  updated.add( row.get( "$price" ) );
 }

 public void rowRemoved(Row row) {
  removed.add( row.get( "$price" ) );
 }

 public void rowAdded(Row row) {
  added.add( row.get( "$price" ) );
 }
};

// Open the LiveQuery
LiveQuery query = ksession.openLiveQuery( "cheeses",
                                          new Object[] { "cheddar", "stilton" },
                                          listener );
...
...
query.dispose() // calling dispose to terminate the live query</code></pre></div></div><br class="example-break"/><p>A Drools blog article contains an example of Glazed Lists
        integration for live queries:</p><p><a class="link" href="http://blog.athico.com/2010/07/glazed-lists-examples-for-drools-live.html">http://blog.athico.com/2010/07/glazed-lists-examples-for-drools-live.html</a></p></div></div><div class="section" title="7.1.3. StatefulRuleSession"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6849"/>7.1.3. StatefulRuleSession</h3></div></div></div><p>The <code class="code">StatefulRuleSession</code> is inherited by the
      <code class="code">KieSession</code> and provides the rule related
      methods that are relevant from outside of the engine.</p><div class="figure"><a id="d0e6860"/><p class="title"><strong>Figure 7.5. StatefulRuleSession</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/ApiReference/StatefulRuleSession.png" alt="StatefulRuleSession"/></div></div></div><br class="figure-break"/><div class="section" title="7.1.3.1. Agenda Filters"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6866"/>7.1.3.1. Agenda Filters</h4></div></div></div><div class="figure"><a id="d0e6869"/><p class="title"><strong>Figure 7.6. AgendaFilters</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/ApiReference/AgendaFilter.png" align="middle" alt="AgendaFilters"/></div></div></div><br class="figure-break"/><p><code class="code">AgendaFilter</code> objects are optional implementations
        of the filter interface which are used to allow or deny the firing of
        a match. What you filter on is entirely up to the
        implementation. Drools 4.0 used to supply some out of the box filters,
        which have not be exposed in drools 5.0 knowledge-api, but they are
        simple to implement and the Drools 4.0 code base can be referred
        to.</p><p>To use a filter specify it while calling
        <code class="code">fireAllRules()</code>. The following example permits only rules
        ending in the string <code class="code">"Test"</code>. All others will be filtered
        out.</p><pre><code class="language-java">ksession.fireAllRules( new RuleNameEndsWithAgendaFilter( "Test" ) );</code></pre></div></div></div><div class="section" title="7.2. Agenda"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6889"/>7.2. Agenda</h2></div></div></div><p>The Agenda is a <span class="emphasis"><em>Rete</em></span> feature. During actions on
    the <code class="code">WorkingMemory</code>, rules may become fully matched and
    eligible for execution; a single Working Memory Action can result in
    multiple eligible rules. When a rule is fully matched a Match is
    created, referencing the rule and the matched facts, and placed onto the
    Agenda. The Agenda controls the execution order of these Matches using
    a Conflict Resolution strategy.</p><p>The engine cycles repeatedly through two phases:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Working Memory Actions. This is where most of the work takes
        place, either in the Consequence (the RHS itself) or the main Java
        application process. Once the Consequence has finished or the main
        Java application process calls <code class="code">fireAllRules()</code> the engine
        switches to the Agenda Evaluation phase.</p></li><li class="listitem"><p>Agenda Evaluation. This attempts to select a rule to fire. If no
        rule is found it exits, otherwise it fires the found rule, switching
        the phase back to Working Memory Actions.</p></li></ol></div><div class="figure"><a id="d0e6912"/><p class="title"><strong>Figure 7.7. Two Phase Execution</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Rule_Engine/Two_Phase.png" align="middle" alt="Two Phase Execution"/></div></div></div><br class="figure-break"/><p>The process repeats until the agenda is clear, in which case control
    returns to the calling application. When Working Memory Actions are taking
    place, no rules are being fired.</p><div class="figure"><a id="d0e6920"/><p class="title"><strong>Figure 7.8. Agenda</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/ApiReference/Agenda.png" alt="Agenda"/></div></div></div><br class="figure-break"/><div class="section" title="7.2.1. Conflict Resolution"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6926"/>7.2.1. Conflict Resolution</h3></div></div></div><p>Conflict resolution is required when there are multiple rules on
      the agenda. (The basics to this are covered in chapter "Quick Start".)
      As firing a rule may have side effects on the working memory, the rule
      engine needs to know in what order the rules should fire (for instance,
      firing ruleA may cause ruleB to be removed from the agenda).</p><p>The default conflict resolution strategies employed by Drools are:
      Salience and LIFO (last in, first out).</p><p>The most visible one is <span class="emphasis"><em>salience</em></span> (or
      priority), in which case a user can specify that a certain rule has a
      higher priority (by giving it a higher number) than other rules. In that
      case, the rule with higher salience will be preferred. LIFO priorities
      are based on the assigned Working Memory Action counter value, with all
      rules created during the same action receiving the same value. The
      execution order of a set of firings with the same priority value is
      arbitrary.</p><p>As a general rule, it is a good idea not to count on rules firing
      in any particular order, and to author the rules without worrying about
      a "flow". However when a flow is needed a number of possibilities exist,
      including but not limited to: agenda groups, rule flow groups,
      activation groups, control/semaphore facts. These are discussed in later
      sections.</p><p>Drools 4.0 supported custom conflict resolution strategies; while
      this capability still exists in Drools it has not yet been exposed to
      the end user via knowledge-api in Drools 5.0.</p></div><div class="section" title="7.2.2. AgendaGroup"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6942"/>7.2.2. AgendaGroup</h3></div></div></div><div class="figure"><a id="d0e6945"/><p class="title"><strong>Figure 7.9. AgendaGroup</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/ApiReference/AgendaGroup.png" alt="AgendaGroup"/></div></div></div><br class="figure-break"/><p>Agenda groups are a way to partition rules (matches, actually)
      on the agenda. At any one time, only one group has "focus" which means
      that matches for rules in that group only will take effect. You can
      also have rules with "auto focus" which means that the focus is taken
      for its agenda group when that rule's conditions are true.</p><p>Agenda groups are known as "modules" in CLIPS terminology. While
      it best to design rules that do not need control flow, this is not
      always possible. Agenda groups provide a handy way to create a "flow"
      between grouped rules. You can switch the group which has focus either
      from within the rule engine, or via the API. If your rules have a clear
      need for multiple "phases" or "sequences" of processing, consider using
      agenda-groups for this purpose.</p><p>Each time <code class="code">setFocus()</code> is called it pushes that Agenda
      Group onto a stack. When the focus group is empty it is popped from the
      stack and the focus group that is now on top evaluates. An Agenda Group
      can appear in multiple locations on the stack. The default Agenda Group
      is "MAIN", with all rules which do not specify an Agenda Group being in
      this group. It is also always the first group on the stack, given focus
      initially, by default.</p><pre><code class="language-java">ksession.getAgenda().getAgendaGroup( "Group A" ).setFocus();</code></pre><p>The <code class="code">clear()</code> method can be used to cancel all the activations
      generated by the rules belonging to a given Agenda Group before one has had a chance
      to fire.</p><pre><code class="language-java">ksession.getAgenda().getAgendaGroup( "Group A" ).clear();</code></pre><p>Note that, due to the lazy nature of the phreak algorithm used by Drools,
      the activations are by default materialized only at firing time, but it is possible
      to anticipate the evaluation and then the activation of a given rule at the
      moment when a fact is inserted into the session by annotating it with
      <code class="code">@Propagation(IMMEDIATE)</code> as explained in the Propagation modes section.</p></div><div class="section" title="7.2.3. ActivationGroup"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6974"/>7.2.3. ActivationGroup</h3></div></div></div><div class="figure"><a id="d0e6977"/><p class="title"><strong>Figure 7.10. ActivationGroup</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/ApiReference/ActivationGroup.png" alt="ActivationGroup"/></div></div></div><br class="figure-break"/><p>An activation group is a set of rules bound together by the same
      "activation-group" rule attribute. In this group only one rule can fire,
      and after that rule has fired all the other rules are cancelled from the
      agenda. The <code class="code">clear()</code> method can be called at any time, which
      cancels all of the activations before one has had a chance to
      fire.</p><pre><code class="language-java">ksession.getAgenda().getActivationGroup( "Group B" ).clear();</code></pre></div><div class="section" title="7.2.4. RuleFlowGroup"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6990"/>7.2.4. RuleFlowGroup</h3></div></div></div><div class="figure"><a id="d0e6993"/><p class="title"><strong>Figure 7.11. RuleFlowGroup</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/ApiReference/RuleFlowGroup.png" alt="RuleFlowGroup"/></div></div></div><br class="figure-break"/><p>A rule flow group is a group of rules associated by the
      "ruleflow-group" rule attribute. These rules can only fire when the
      group is activate. The group itself can only become active when the
      elaboration of the ruleflow diagram reaches the node representing the
      group. Here too, the <code class="code">clear()</code> method can be called at any
      time to cancels all matches still remaining on the Agenda.</p><pre><code class="language-java">ksession.getAgenda().getRuleFlowGroup( "Group C" ).clear();</code></pre></div></div><div class="section" title="7.3. Event Model"><div class="titlepage"><div><div><h2 class="title"><a id="d0e7006"/>7.3. Event Model</h2></div></div></div><p>The event package provides means to be notified of rule engine
    events, including rules firing, objects being asserted, etc. This allows
    you, for instance, to separate logging and auditing activities from the
    main part of your application (and the rules).</p><p>The <code class="code">WorkingMemoryEventManager</code> allows for listeners to be added and removed,
      so that events for the working memory and the agenda can be listened to.</p><div class="figure"><a id="d0e7016"/><p class="title"><strong>Figure 7.12. WorkingMemoryEventManager</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/ApiReference/WorkingMemoryEventManager.png" alt="WorkingMemoryEventManager"/></div></div></div><br class="figure-break"/><p>The following code snippet shows how a simple agenda listener is
    declared and attached to a session. It will print matches after they
    have fired.</p><div class="example"><a id="d0e7024"/><p class="title"><strong>Example 7.3. Adding an AgendaEventListener</strong></p><div class="example-contents"><pre><code class="language-java">ksession.addEventListener( new DefaultAgendaEventListener() {
   public void afterMatchFired(AfterMatchFiredEvent event) {
       super.afterMatchFired( event );
       System.out.println( event );
   }
});     </code></pre></div></div><br class="example-break"/><p>Drools also provides <code class="code">DebugRuleRuntimeEventListener</code>
    and <code class="code">DebugAgendaEventListener</code> which implement each method with
    a debug print statement. To print all Working Memory events, you add a
    listener like this:</p><div class="example"><a id="d0e7037"/><p class="title"><strong>Example 7.4. Adding a DebugRuleRuntimeEventListener</strong></p><div class="example-contents"><pre><code class="language-java">ksession.addEventListener( new DebugRuleRuntimeEventListener() );     </code></pre></div></div><br class="example-break"/><p>The events currently supported are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>MatchCreatedEvent</p></li><li class="listitem"><p>MatchCancelledEvent</p></li><li class="listitem"><p>BeforeMatchFiredEvent</p></li><li class="listitem"><p>AfterMatchFiredEvent</p></li><li class="listitem"><p>AgendaGroupPushedEvent</p></li><li class="listitem"><p>AgendaGroupPoppedEvent</p></li><li class="listitem"><p>ObjectInsertEvent</p></li><li class="listitem"><p>ObjectDeletedEvent</p></li><li class="listitem"><p>ObjectUpdatedEvent</p></li><li class="listitem"><p>ProcessCompletedEvent</p></li><li class="listitem"><p>ProcessNodeLeftEvent</p></li><li class="listitem"><p>ProcessNodeTriggeredEvent</p></li><li class="listitem"><p>ProcessStartEvent</p></li></ul></div></div><div class="section" title="7.4. StatelessKieSession"><div class="titlepage"><div><div><h2 class="title"><a id="d0e7084"/>7.4. StatelessKieSession</h2></div></div></div><p>The <code class="code">StatelessKieSession</code> wraps the
    <code class="code">KieSession</code>, instead of extending it. Its main
    focus is on decision service type scenarios. It avoids the need to call
    <code class="code">dispose()</code>. Stateless sessions do not support iterative
    insertions and the method call <code class="code">fireAllRules()</code> from Java code;
    the act of calling <code class="code">execute()</code> is a single-shot method that
    will internally instantiate a <code class="code">KieSession</code>, add
    all the user data and execute user commands, call
    <code class="code">fireAllRules()</code>, and then call <code class="code">dispose()</code>. While
    the main way to work with this class is via the
    <code class="code">BatchExecution</code> (a subinterface of <code class="code">Command</code>) as
    supported by the <code class="code">CommandExecutor</code> interface, two convenience
    methods are provided for when simple object insertion is all that's
    required. The <code class="code">CommandExecutor</code> and <code class="code">BatchExecution</code>
    are talked about in detail in their own section.</p><div class="figure"><a id="d0e7128"/><p class="title"><strong>Figure 7.13. StatelessKieSession</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/ApiReference/StatelessKieSession.png" alt="StatelessKieSession"/></div></div></div><br class="figure-break"/><p>Our simple example shows a stateless session executing a given
    collection of Java objects using the convenience API. It will iterate the
    collection, inserting each element in turn.</p><div class="example"><a id="d0e7136"/><p class="title"><strong>Example 7.5. Simple StatelessKieSession execution with a Collection</strong></p><div class="example-contents"><pre><code class="language-java">StatelessKieSession ksession = kbase.newStatelessKieSession();
ksession.execute( collection );</code></pre></div></div><br class="example-break"/><p>If this was done as a single Command it would be as follows:</p><div class="example"><a id="d0e7143"/><p class="title"><strong>Example 7.6. Simple StatelessKieSession execution with InsertElements Command</strong></p><div class="example-contents"><pre><code class="language-java">ksession.execute( CommandFactory.newInsertElements( collection ) );  </code></pre></div></div><br class="example-break"/><p>If you wanted to insert the collection itself, and the collection's
    individual elements, then
    <code class="code">CommandFactory.newInsert(collection)</code> would do the job.</p><p>Methods of the <code class="code">CommandFactory</code> create the supported
    commands, all of which can be marshalled using XStream and the
    <code class="code">BatchExecutionHelper</code>. <code class="code">BatchExecutionHelper</code>
    provides details on the XML format as well as how to use Drools Pipeline
    to automate the marshalling of <code class="code">BatchExecution</code> and
    <code class="code">ExecutionResults</code>.</p><p><code class="code">StatelessKieSession</code> supports globals, scoped in a
    number of ways. I'll cover the non-command way first, as commands are
    scoped to a specific execution call. Globals can be resolved in three
    ways.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The StatelessKieSession method <code class="code">getGlobals()</code>
        returns a Globals instance which provides access to the session's
        globals. These are shared for <span class="emphasis"><em>all</em></span> execution
        calls. Exercise caution regarding mutable globals because execution
        calls can be executing simultaneously in different threads.</p><div class="example"><a id="d0e7184"/><p class="title"><strong>Example 7.7. Session scoped global</strong></p><div class="example-contents"><pre><code class="language-java">StatelessKieSession ksession = kbase.newStatelessKieSession();
// Set a global hbnSession, that can be used for DB interactions in the rules.
ksession.setGlobal( "hbnSession", hibernateSession );
// Execute while being able to resolve the "hbnSession" identifier.
ksession.execute( collection ); </code></pre></div></div><br class="example-break"/></li><li class="listitem"><p>Using a delegate is another way of global resolution. Assigning
        a value to a global (with <code class="code">setGlobal(String, Object)</code>)
        results in the value being stored in an internal collection mapping
        identifiers to values. Identifiers in this internal collection will
        have priority over any supplied delegate. Only if an identifier cannot
        be found in this internal collection, the delegate global (if any)
        will be used.</p></li><li class="listitem"><p>The third way of resolving globals is to have execution scoped
        globals. Here, a <code class="code">Command</code> to set a global is passed to the
        <code class="code">CommandExecutor</code>.</p></li></ul></div><p>The <code class="code">CommandExecutor</code> interface also offers the ability
    to export data via "out" parameters. Inserted facts, globals and query
    results can all be returned.</p><div class="example"><a id="d0e7209"/><p class="title"><strong>Example 7.8. Out identifiers</strong></p><div class="example-contents"><pre><code class="language-java">// Set up a list of commands
List cmds = new ArrayList();
cmds.add( CommandFactory.newSetGlobal( "list1", new ArrayList(), true ) );
cmds.add( CommandFactory.newInsert( new Person( "jon", 102 ), "person" ) );
cmds.add( CommandFactory.newQuery( "Get People" "getPeople" );

// Execute the list
ExecutionResults results =
  ksession.execute( CommandFactory.newBatchExecution( cmds ) );

// Retrieve the ArrayList
results.getValue( "list1" );
// Retrieve the inserted Person fact
results.getValue( "person" );
// Retrieve the query as a QueryResults instance.
results.getValue( "Get People" );</code></pre></div></div><br class="example-break"/><div class="section" title="7.4.1. Sequential Mode"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7214"/>7.4.1. Sequential Mode</h3></div></div></div><p>With Rete you have a stateful session where objects can be
      asserted and modified over time, and where rules can also be added and
      removed. Now what happens if we assume a stateless session, where after
      the initial data set no more data can be asserted or modified and rules
      cannot be added or removed? Certainly it won't be necessary to
      re-evaluate rules, and the engine will be able to operate in a
      simplified way.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Order the Rules by salience and position in the ruleset (by
          setting a sequence attribute on the rule terminal node).</p></li><li class="listitem"><p>Create an elements, one element for each possible rule
          match; element position indicates firing order.</p></li><li class="listitem"><p>Turn off all node memories, except the right-input Object
          memory.</p></li><li class="listitem"><p>Disconnect the Left Input Adapter Node propagation, and let
          the Object plus the Node be referenced in a Command object, which is
          added to a list on the Working Memory for later execution.</p></li><li class="listitem"><p>Assert all objects, and, when all assertions are finished and
          thus right-input node memories are populated, check the Command list
          and execute each in turn.</p></li><li class="listitem"><p>All resulting Matches should be placed in the elements, based
          upon the determined sequence number of the Rule. Record the first
          and last populated elements, to reduce the iteration range.</p></li><li class="listitem"><p>Iterate the elements of Matches, executing populated element
          in turn.</p></li><li class="listitem"><p>If we have a maximum number of allowed rule executions, we can
          exit our network evaluations early to fire all the rules in the
          elements.</p></li></ol></div><p>The <code class="code">LeftInputAdapterNode</code> no longer creates a Tuple,
      adding the Object, and then propagate the Tuple – instead a Command
      object is created and added to a list in the Working Memory. This
      Command object holds a reference to the
      <code class="code">LeftInputAdapterNode</code> and the propagated object. This stops
      any left-input propagations at insertion time, so that we know that a
      right-input propagation will never need to attempt a join with the
      left-inputs (removing the need for left-input memory). All nodes have
      their memory turned off, including the left-input Tuple memory but
      excluding the right-input object memory, which means that the only node
      remembering an insertion propagation is the right-input object memory.
      Once all the assertions are finished and all right-input memories
      populated, we can then iterate the list of
      <code class="code">LeftInputAdatperNode</code> Command objects calling each in turn.
      They will propagate down the network attempting to join with the
      right-input objects, but they won't be remembered in the left input as
      we know there will be no further object assertions and thus propagations
      into the right-input memory.</p><p>There is no longer an Agenda, with a priority queue to schedule
      the Tuples; instead, there is simply an elements for the number of rules.
      The sequence number of the <code class="code">RuleTerminalNode</code> indicates the
      element within the elements where to place the Match. Once all Command
      objects have finished we can iterate our elements, checking each element in
      turn, and firing the Matches if they exist. To improve performance,
      we remember the first and the last populated cell in the elements. The
      network is constructed, with each <code class="code">RuleTerminalNode</code> being
      given a sequence number based on a salience number and its order of
      being added to the network.</p><p>Typically the right-input node memories are Hash Maps, for fast
      object deletion; here, as we know there will be no object deletions,
      we can use a list when the values of the object are not indexed. For
      larger numbers of objects indexed Hash Maps provide a performance
      increase; if we know an object type has only a few instances, indexing
      is probably not advantageous, and a list can be used.</p><p>Sequential mode can only be used with a Stateless Session and is
      off by default. To turn it on, either call
      <code class="code">RuleBaseConfiguration.setSequential(true)</code>, or set the
      rulebase configuration property <code class="code">drools.sequential</code> to true.
      Sequential mode can fall back to a dynamic agenda by calling
      <code class="code">setSequentialAgenda</code> with
      <code class="code">SequentialAgenda.DYNAMIC</code>. You may also set the
      "drools.sequential.agenda" property to "sequential" or "dynamic".</p></div></div><div class="section" title="7.5. Rule Execution Modes"><div class="titlepage"><div><div><h2 class="title"><a id="d0e7279"/>7.5. Rule Execution Modes</h2></div></div></div><p>Drools provides two modes for rule execution - passive and active.</p><p>As a general guideline, Passive Mode is most suitable for Rule Engine applications which need to
    explicitly control when the engine shall evaluate and fire the rules, or for CEP applications making use
    of the Pseudo Clock. Active Mode is most effective for Rule Engine applications which delegate control
    of when rules are evaluated and fired to the engine, or for typical CEP application making use of the
    Real Time Clock.</p><div class="section" title="7.5.1. Passive Mode"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7286"/>7.5.1. Passive Mode</h3></div></div></div><p>With Passive mode not only is the user responsible for working memory operations, such as <code class="code">insert()</code>,
      but also for when the rules are to evaluate the data and fire the resulting rule instantiations -
      using <code class="code">fireAllRules()</code></p><p>An example outline of Drools code for a CEP application making use of Passive Mode:</p><pre><code class="language-java">KieSessionConfiguration config = KieServices.Factory.get().newKieSessionConfiguration();
config.setOption( ClockTypeOption.get("pseudo") );
KieSession session = kbase.newKieSession( conf, null );
SessionPseudoClock clock = session.getSessionClock();

session.insert( tick1 );
session.fireAllRules();

clock.advanceTime(1, TimeUnit.SECONDS);
session.insert( tick2 );
session.fireAllRules();

clock.advanceTime(1, TimeUnit.SECONDS);
session.insert( tick3 );
session.fireAllRules();

session.dispose();</code></pre></div><div class="section" title="7.5.2. Active Mode"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7301"/>7.5.2. Active Mode</h3></div></div></div><p>Drools offers a <code class="code">fireUntilHalt()</code> method, that starts the engine in Active Mode, which is
      asynchronous in behavior, where rules will be continually evaluated and fired, until a
      <code class="code">halt()</code> call is made. </p><p>This is specially useful for CEP scenarios that require what is commonly known as "active queries".</p><p>Please note calling <code class="code">fireUntilHalt()</code> blocks the current thread, while the engine will
      start and continue running asynchronously until the <code class="code">halt()</code> is called on the KieSession. It is
      suggested therefore to call <code class="code">fireUntilHalt()</code> from a dedicated thread, so the current thread does
      not get blocked indefinitely; this also enable the current thread to call <code class="code">halt()</code> at a later
      stage, ref. examples below.</p><p>An example outline of Drools code for a CEP application making use of Active Mode:</p><pre><code class="language-java">KieSessionConfiguration config = KieServices.Factory.get().newKieSessionConfiguration();
config.setOption( ClockTypeOption.get("realtime") );
KieSession session = kbase.newKieSession( conf, null );

new Thread( new Runnable() {
  @Override
  public void run() {
      session.fireUntilHalt();
  }
} ).start();

session.insert( tick1 );

... Thread.sleep( 1000L ); ...

session.insert( tick2 );

... Thread.sleep( 1000L ); ...

session.insert( tick3 );

session.halt();
session.dispose();</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Generally, it is not recommended mixing <code class="code">fireAllRules()</code> and
        <code class="code">fireUntilHalt()</code> , especially from different threads. However the engine is able to handle
        such situations safely, thanks to the internal state machine. If <code class="code">fireAllRules()</code> is
        running and a call <code class="code">fireUntilHalt()</code> is made, the engine will wait until the
        <code class="code">fireAllRules()</code> is finished and then start <code class="code">fireUntilHalt()</code> . However if
        <code class="code">fireUntilHalt()</code> is running and <code class="code">fireAllRules()</code> is called, the later is
        ignored and will just return directly. For more details about thread-safety and the internal state
        machine, reference section "Improved multi-threading behaviour".</p></div><div class="section" title="7.5.2.1. Performing KieSession operations atomically when in Active Mode"><div class="titlepage"><div><div><h4 class="title"><a id="d0e7359"/>7.5.2.1. Performing KieSession operations atomically when in Active Mode</h4></div></div></div><p>When in Active Mode, the Drools engine is in control of when the rule shall be evaluated and
          fired; therefore it is important that operations on the KieSession are performed in a thread-safe manner.
          Additionally, from a client-side perspective, there might be the need for more than one operations to be
          called on the KieSession in between rule evaluations, but for engine to consider these as an atomic
          operation: for example, inserting more than one Fact at a given time, but for the engine to await until
          all the inserts are done, before evaluating the rules again.</p><p>Drools offers a submit() method to group and perform operations on the KieSession as a thread-safe
          atomic action, while in Active Mode.</p><p>An example outline of Drools code to perform KieSession operations atomically when in Active Mode:</p><pre><code class="language-java">KieSession session = ...;

new Thread( new Runnable() {
  @Override
  public void run() {
      session.fireUntilHalt();
  }
} ).start();

final FactHandle fh = session.insert( fact_a );

... Thread.sleep( 1000L ); ...

session.submit( new KieSession.AtomicAction() {
  @Override
  public void execute( KieSession kieSession ) {
    fact_a.setField("value");
    kieSession.update( fh, fact_a );
    kieSession.insert( fact_1 );
    kieSession.insert( fact_2 );
    kieSession.insert( fact_3 );
  }
} );

... Thread.sleep( 1000L ); ...

session.insert( fact_z );

session.halt();
session.dispose();</code></pre><p>As a reminder example, the fact handle could also be retrieved from the KieSession:</p><pre><code class="language-java">...
session.insert( fact_a );

... Thread.sleep( 1000L ); ...

session.submit( new KieSession.AtomicAction() {
  @Override
  public void execute( KieSession kieSession ) {
    final FactHandle fh = kieSession.getFactHandle( fact_a );
    fact_a.setField("value");
    kieSession.update( fh, fact_a );
    kieSession.insert( fact_1 );
    kieSession.insert( fact_2 );
    kieSession.insert( fact_3 );
  }
} );

...</code></pre></div></div></div><div class="section" title="7.6. Propagation modes"><div class="titlepage"><div><div><h2 class="title"><a id="d0e7377"/>7.6. Propagation modes</h2></div></div></div><p>The introduction of PHREAK as default algorithm for the Drools engine made the rules' evaluation
    lazy. This new Drools lazy behavior allowed a relevant performance boost but, in some very specific cases,
    breaks the semantic of a few Drools features.</p><p>More precisely in some circumstances it is necessary to propagate the insertion of new fact into th
    session immediately. For instance Drools allows a query to be executed in pull only (or passive) mode by
    prepending a '?' symbol to its invocation as in the following example:</p><div class="example"><a id="d0e7384"/><p class="title"><strong>Example 7.9. A passive query</strong></p><div class="example-contents"><pre><code class="language-java">query Q (Integer i)
    String( this == i.toString() )
end
rule R when
    $i : Integer()
    ?Q( $i; )
then
    System.out.println( $i );
end</code></pre></div></div><br class="example-break"/><p>In this case, since the query is passive, it shouldn't react to the insertion of a String
    matching the join condition in the query itself. In other words this sequence of commands</p><pre><code class="language-java">KieSession ksession = ...
ksession.insert(1);
ksession.insert("1");
ksession.fireAllRules();</code></pre><p>shouldn't cause the rule R to fire because the String satisfying the query condition has
    been inserted after the Integer and the passive query shouldn't react to this insertion.
    Conversely the rule should fire if the insertion sequence is inverted because the insertion
    of the Integer, when the passive query can be satisfied by the presence of an already existing
    String, will trigger it.</p><p>Unfortunately the lazy nature of PHREAK doesn't allow the engine to make any
    distinction regarding the insertion sequence of the two facts, so the rule will fire
    in both cases. In circumstances like this it is necessary to evaluate the rule eagerly as
    done by the old RETEOO-based engine.</p><p>In other cases it is required that the propagation is eager, meaning that it is not immedate,
    but anyway has to happen before the engine/agenda starts scheduled evaluations. For instance this
    is necessary when a rule has the no-loop or the lock-on-active attribute and in fact when this
    happens this propagation mode is automatically enforced by the engine.</p><p>To cover these use cases, and in all other situations where an immediate or eager rule
    evaluation is required, it is possible to declaratively specify so by annotating the rule
    itself with <span class="bold"><strong>@Propagation(Propagation.Type)</strong></span>, where
    Propagation.Type is an enumeration with 3 possible values:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>IMMEDIATE</strong></span> means that the propagation is performed immediately.</p></li><li class="listitem"><p><span class="bold"><strong>EAGER</strong></span> means that the propagation is performed lazily but
          eagerly evaluated before scheduled evaluations.</p></li><li class="listitem"><p><span class="bold"><strong>LAZY</strong></span> means that the propagation is totally lazy and this is
          default PHREAK behaviour</p></li></ul></div><p>This means that the following drl:</p><div class="example"><a id="d0e7422"/><p class="title"><strong>Example 7.10. A data-driven rule using a passive query</strong></p><div class="example-contents"><pre><code class="language-java">query Q (Integer i)
    String( this == i.toString() )
end
rule R @Propagation(IMMEDIATE) when
    $i : Integer()
    ?Q( $i; )
then
    System.out.println( $i );
end</code></pre></div></div><br class="example-break"/><p>will make the rule R to fire if and only if the Integer is inserted after the String, thus
    behaving in accordance with the semantic of the passive query.</p></div><div class="section" title="7.7. Commands and the CommandExecutor"><div class="titlepage"><div><div><h2 class="title"><a id="d0e7429"/>7.7. Commands and the CommandExecutor</h2></div></div></div><p>The <code class="code">CommandFactory</code> allows for commands to be executed
    on those sessions, the only difference being that the Stateless Knowledge
    Session executes <code class="code">fireAllRules()</code> at the end before disposing
    the session. The currently supported commands are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>FireAllRules</p></li><li class="listitem"><p>GetGlobal</p></li><li class="listitem"><p>SetGlobal</p></li><li class="listitem"><p>InsertObject</p></li><li class="listitem"><p>InsertElements</p></li><li class="listitem"><p>Query</p></li><li class="listitem"><p>StartProcess</p></li><li class="listitem"><p>BatchExecution</p></li></ul></div><p><code class="code">InsertObject</code> will insert a single object, with an
    optional "out" identifier. <code class="code">InsertElements</code> will iterate an
    Iterable, inserting each of the elements. What this means is that a
    Stateless Knowledge Session is no longer limited to just inserting
    objects, it can now start processes or execute queries, and do this in any
    order.</p><div class="example"><a id="d0e7472"/><p class="title"><strong>Example 7.11. Insert Command</strong></p><div class="example-contents"><pre><code class="language-java">StatelessKieSession ksession = kbase.newStatelessKieSession();
ExecutionResults bresults =
  ksession.execute( CommandFactory.newInsert( new Cheese( "stilton" ), "stilton_id" ) );
Stilton stilton = bresults.getValue( "stilton_id" );
</code></pre></div></div><br class="example-break"/><p>The execute method always returns an <code class="code">ExecutionResults</code>
    instance, which allows access to any command results if they specify an
    out identifier such as the "stilton_id" above.</p><div class="example"><a id="d0e7482"/><p class="title"><strong>Example 7.12. InsertElements Command</strong></p><div class="example-contents"><pre><code class="language-java">StatelessKieSession ksession = kbase.newStatelessKieSession();
Command cmd = CommandFactory.newInsertElements( Arrays.asList( Object[] {
                  new Cheese( "stilton" ),
                  new Cheese( "brie" ),
                  new Cheese( "cheddar" ),
              });
ExecutionResults bresults = ksession.execute( cmd );
</code></pre></div></div><br class="example-break"/><p>The execute method only allows for a single command. That's where
    <code class="code">BatchExecution</code> comes in, which represents a composite
    command, created from a list of commands. Now, execute will iterate over
    the list and execute each command in turn. This means you can insert some
    objects, start a process, call fireAllRules and execute a query, all in a
    single <code class="code">execute(...)</code> call, which is quite powerful.</p><p>As mentioned previosly, the StatelessKieSession will execute
    <code class="code">fireAllRules()</code> automatically at the end. However the
    keen-eyed reader probably has already noticed the
    <code class="code">FireAllRules</code> command and wondered how that works with a
    StatelessKieSession. The <code class="code">FireAllRules</code> command is
    allowed, and using it will disable the automatic execution at the end;
    think of using it as a sort of manual override function.</p><p>A custom XStream marshaller can be used with the Drools Pipeline to
    achieve XML scripting, which is perfect for services. Here are two simple
    XML samples, one for the BatchExecution and one for the
    <code class="code">ExecutionResults</code>.</p><div class="example"><a id="d0e7511"/><p class="title"><strong>Example 7.13. Simple BatchExecution XML</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;batch-execution&gt;
   &lt;insert out-identifier='outStilton'&gt;
      &lt;org.drools.compiler.Cheese&gt;
         &lt;type&gt;stilton&lt;/type&gt;
         &lt;price&gt;25&lt;/price&gt;
         &lt;oldPrice&gt;0&lt;/oldPrice&gt;
      &lt;/org.drools.compiler.Cheese&gt;
   &lt;/insert&gt;
&lt;/batch-execution&gt;
</code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e7516"/><p class="title"><strong>Example 7.14. Simple ExecutionResults XML</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;execution-results&gt;
   &lt;result identifier='outStilton'&gt;
      &lt;org.drools.compiler.Cheese&gt;
         &lt;type&gt;stilton&lt;/type&gt;
         &lt;oldPrice&gt;25&lt;/oldPrice&gt;
         &lt;price&gt;30&lt;/price&gt;
      &lt;/org.drools.compiler.Cheese&gt;
   &lt;/result&gt;
&lt;/execution-results&gt;
</code></pre></div></div><br class="example-break"/><p>Spring and Camel, covered in the integrations book, facilitate
    declarative services.</p><div class="example"><a id="d0e7523"/><p class="title"><strong>Example 7.15. BatchExecution Marshalled to XML</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;batch-execution&gt;
  &lt;insert out-identifier="stilton"&gt;
    &lt;org.drools.compiler.Cheese&gt;
      &lt;type&gt;stilton&lt;/type&gt;
      &lt;price&gt;1&lt;/price&gt;
      &lt;oldPrice&gt;0&lt;/oldPrice&gt;
    &lt;/org.drools.compiler.Cheese&gt;
  &lt;/insert&gt;
  &lt;query out-identifier='cheeses2' name='cheesesWithParams'&gt;
    &lt;string&gt;stilton&lt;/string&gt;
    &lt;string&gt;cheddar&lt;/string&gt;
  &lt;/query&gt;
&lt;/batch-execution&gt;
</code></pre></div></div><br class="example-break"/><p>The <code class="code">CommandExecutor</code> returns an
    <code class="code">ExecutionResults</code>, and this is handled by the pipeline code
    snippet as well. A similar output for the &lt;batch-execution&gt; XML
    sample above would be:</p><div class="example"><a id="d0e7536"/><p class="title"><strong>Example 7.16. ExecutionResults Marshalled to XML</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;execution-results&gt;
  &lt;result identifier="stilton"&gt;
    &lt;org.drools.compiler.Cheese&gt;
      &lt;type&gt;stilton&lt;/type&gt;
      &lt;price&gt;2&lt;/price&gt;
    &lt;/org.drools.compiler.Cheese&gt;
  &lt;/result&gt;
  &lt;result identifier='cheeses2'&gt;
    &lt;query-results&gt;
      &lt;identifiers&gt;
        &lt;identifier&gt;cheese&lt;/identifier&gt;
      &lt;/identifiers&gt;
      &lt;row&gt;
        &lt;org.drools.compiler.Cheese&gt;
          &lt;type&gt;cheddar&lt;/type&gt;
          &lt;price&gt;2&lt;/price&gt;
          &lt;oldPrice&gt;0&lt;/oldPrice&gt;
        &lt;/org.drools.compiler.Cheese&gt;
      &lt;/row&gt;
      &lt;row&gt;
        &lt;org.drools.compiler.Cheese&gt;
          &lt;type&gt;cheddar&lt;/type&gt;
          &lt;price&gt;1&lt;/price&gt;
          &lt;oldPrice&gt;0&lt;/oldPrice&gt;
        &lt;/org.drools.compiler.Cheese&gt;
      &lt;/row&gt;
    &lt;/query-results&gt;
  &lt;/result&gt;
&lt;/execution-results&gt;
</code></pre></div></div><br class="example-break"/><p>The <code class="code">BatchExecutionHelper</code> provides a configured XStream
    instance to support the marshalling of Batch Executions, where the
    resulting XML can be used as a message format, as shown above. Configured
    converters only exist for the commands supported via the Command Factory.
    The user may add other converters for their user objects. This is very
    useful for scripting stateless or stateful knowledge sessions, especially
    when services are involved.</p><p>There is currently no XML schema to support schema validation. The
    basic format is outlined here, and the drools-pipeline module has an
    illustrative unit test in the <code class="code">XStreamBatchExecutionTest</code> unit
    test. The root element is &lt;batch-execution&gt; and it can contain zero
    or more commands elements.</p><div class="example"><a id="d0e7551"/><p class="title"><strong>Example 7.17. Root XML element</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;batch-execution&gt;
...
&lt;/batch-execution&gt;
</code></pre></div></div><br class="example-break"/><p>This contains a list of elements that represent commands, the
    supported commands is limited to those Commands provided by the Command
    Factory. The most basic of these is the &lt;insert&gt; element, which
    inserts objects. The contents of the insert element is the user object, as
    dictated by XStream.</p><div class="example"><a id="d0e7558"/><p class="title"><strong>Example 7.18. Insert</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;batch-execution&gt;
   &lt;insert&gt;
      ...&lt;!-- any user object --&gt;
   &lt;/insert&gt;
&lt;/batch-execution&gt;
</code></pre></div></div><br class="example-break"/><p>The insert element features an "out-identifier" attribute, demanding
    that the inserted object will also be returned as part of the result
    payload.</p><div class="example"><a id="d0e7565"/><p class="title"><strong>Example 7.19. Insert with Out Identifier Command</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;batch-execution&gt;
   &lt;insert out-identifier='userVar'&gt;
      ...
   &lt;/insert&gt;
&lt;/batch-execution&gt;
</code></pre></div></div><br class="example-break"/><p>It's also possible to insert a collection of objects using the
    &lt;insert-elements&gt; element. This command does not support an
    out-identifier. The <code class="code">org.domain.UserClass</code> is just an
    illustrative user object that XStream would serialize.</p><div class="example"><a id="d0e7575"/><p class="title"><strong>Example 7.20. Insert Elements command</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;batch-execution&gt;
   &lt;insert-elements&gt;
      &lt;org.domain.UserClass&gt;
         ...
      &lt;/org.domain.UserClass&gt;
      &lt;org.domain.UserClass&gt;
         ...
      &lt;/org.domain.UserClass&gt;
      &lt;org.domain.UserClass&gt;
         ...
      &lt;/org.domain.UserClass&gt;
   &lt;/insert-elements&gt;
&lt;/batch-execution&gt;
</code></pre></div></div><br class="example-break"/><p>While the <code class="literal">out</code> attribute is useful in returning
    specific instances as a result payload, we often wish to run actual
    queries. Both parameter and parameterless queries are supported. The
    <code class="literal">name</code> attribute is the name of the query to be called,
    and the <code class="literal">out-identifier</code> is the identifier to be used for
    the query results in the <code class="code">&lt;execution-results&gt;</code>
    payload.</p><div class="example"><a id="d0e7594"/><p class="title"><strong>Example 7.21. Query Command</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;batch-execution&gt;
   &lt;query out-identifier='cheeses' name='cheeses'/&gt;
   &lt;query out-identifier='cheeses2' name='cheesesWithParams'&gt;
      &lt;string&gt;stilton&lt;/string&gt;
      &lt;string&gt;cheddar&lt;/string&gt;
   &lt;/query&gt;
&lt;/batch-execution&gt;
</code></pre></div></div><br class="example-break"/></div></div><div class="chapter" title="Chapter 8. Rule Language Reference"><div class="titlepage"><div><div><h2 class="title"><a id="DroolsLanguageReferenceChapter"/>Chapter 8. Rule Language Reference</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e7602">8.1. Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7610">8.1.1. A rule file</a></span></dt><dt><span class="section"><a href="#d0e7643">8.1.2. What makes a rule</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e7679">8.2. Keywords</a></span></dt><dt><span class="section"><a href="#d0e7874">8.3. Comments</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7879">8.3.1. Single line comment</a></span></dt><dt><span class="section"><a href="#d0e7889">8.3.2. Multi-line comment</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e7902">8.4. Error Messages</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7907">8.4.1. Message format</a></span></dt><dt><span class="section"><a href="#d0e7938">8.4.2. Error Messages Description</a></span></dt><dt><span class="section"><a href="#d0e8093">8.4.3. Other Messages</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e8098">8.5. Package</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8121">8.5.1. import</a></span></dt><dt><span class="section"><a href="#d0e8135">8.5.2. global</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e8178">8.6. Function</a></span></dt><dt><span class="section"><a href="#d0e8212">8.7. Type Declaration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8240">8.7.1. Declaring New Types</a></span></dt><dt><span class="section"><a href="#d0e8397">8.7.2. Declaring Metadata</a></span></dt><dt><span class="section"><a href="#d0e8758">8.7.3. Declaring Metadata for Existing Types</a></span></dt><dt><span class="section"><a href="#d0e8801">8.7.4. Parametrized constructors for declared types</a></span></dt><dt><span class="section"><a href="#d0e8825">8.7.5. Non Typesafe Classes</a></span></dt><dt><span class="section"><a href="#d0e8830">8.7.6. Accessing Declared Types from the Application Code</a></span></dt><dt><span class="section"><a href="#d0e8879">8.7.7. Type Declaration 'extends'</a></span></dt><dt><span class="section"><a href="#d0e8911">8.7.8. Traits</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e9154">8.8. Rule</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e9196">8.8.1. Rule Attributes</a></span></dt><dt><span class="section"><a href="#d0e9356">8.8.2. Timers and Calendars</a></span></dt><dt><span class="section"><a href="#d0e9456">8.8.3. Left Hand Side (when) syntax</a></span></dt><dt><span class="section"><a href="#d0e11687">8.8.4. The Right Hand Side (then)</a></span></dt><dt><span class="section"><a href="#d0e11934">8.8.5. Conditional named consequences</a></span></dt><dt><span class="section"><a href="#d0e11959">8.8.6. A Note on Auto-boxing and Primitive Types</a></span></dt></dl></dd><dt><span class="section"><a href="#QuerySection">8.9. Query</a></span></dt><dt><span class="section"><a href="#d0e12041">8.10. Domain Specific Languages</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12051">8.10.1. When to Use a DSL</a></span></dt><dt><span class="section"><a href="#d0e12058">8.10.2. DSL Basics</a></span></dt><dt><span class="section"><a href="#d0e12127">8.10.3. Adding Constraints to Facts</a></span></dt><dt><span class="section"><a href="#d0e12171">8.10.4. Developing a DSL</a></span></dt><dt><span class="section"><a href="#d0e12184">8.10.5. DSL and DSLR Reference</a></span></dt></dl></dd></dl></div><div class="section" title="8.1. Overview"><div class="titlepage"><div><div><h2 class="title"><a id="d0e7602"/>8.1. Overview</h2></div></div></div><p>Drools has a "native" rule language. 
  This format is very light in terms of punctuation, and supports
  natural and domain specific languages via "expanders" that allow the
  language to morph to your problem domain. This chapter is mostly concerted
  with this native rule format. The diagrams used to present the syntax are
  known as "railroad" diagrams, and they are basically flow charts for the
  language terms. The
  technically very keen may also refer to <code class="filename">DRL.g</code> which is 
  the Antlr3
  grammar for the rule language. If you use the Rule Workbench, a lot of the
  rule structure is done for you with content assistance, for example, type
  "ru" and press ctrl+space, and it will build the rule structure for
  you.</p><div class="section" title="8.1.1. A rule file"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7610"/>8.1.1. A rule file</h3></div></div></div><p>A rule file is typically a file with a .drl extension. In a DRL file
    you can have multiple rules, queries and functions, as well as some
    resource declarations like imports, globals and attributes that are
    assigned and used by your rules and queries. However, you are also able to
    spread your rules across multiple rule files (in that case, the extension
    .rule is suggested, but not required) - spreading rules across files can
    help with managing large numbers of rules. A DRL file is simply a text
    file.</p><p>The overall structure of a rule file is:</p><div class="example"><a id="d0e7617"/><p class="title"><strong>Example 8.1. Rules file</strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>package </strong></span><em class="replaceable"><code>package-name</code></em>

<em class="replaceable"><code>imports</code></em>

<em class="replaceable"><code>globals</code></em>

<em class="replaceable"><code>functions</code></em>

<em class="replaceable"><code>queries</code></em>

<em class="replaceable"><code>rules</code></em>
</code></pre></div></div><br class="example-break"/><p>The order in which the elements are declared is not important,
    except for the package name that, if declared, must be the first element
    in the rules file. All elements are optional, so you will use only those
    you need. We will discuss each of them in the following sections.</p></div><div class="section" title="8.1.2. What makes a rule"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7643"/>8.1.2. What makes a rule</h3></div></div></div><p>For the impatient, just as an early view, a rule has the following
    rough structure:</p><pre><code class="no-highlight"><span class="bold"><strong>rule</strong></span> <em class="replaceable"><code>"name"</code></em>
    <em class="replaceable"><code>attributes</code></em>
    <span class="bold"><strong>when</strong></span>
        <em class="replaceable"><code>LHS</code></em>
    <span class="bold"><strong>then</strong></span>
        <em class="replaceable"><code>RHS</code></em>
<span class="bold"><strong>end</strong></span>
</code></pre><p>It's really that simple. Mostly punctuation is not needed,
    even the double quotes for "name" are optional, as are newlines.
    Attributes are simple (always optional) hints to how the rule should
    behave. LHS is the conditional parts of the rule, which follows a certain
    syntax which is covered below. RHS is basically a block that allows
    dialect specific semantic code to be executed.</p><p>It is important to note that white space is not important,
      <span class="emphasis"><em>except</em></span> in
    the case of domain specific languages, where lines are processed
    one by one and spaces may be significant to the domain language.</p></div></div><div class="section" title="8.2. Keywords"><div class="titlepage"><div><div><h2 class="title"><a id="d0e7679"/>8.2. Keywords</h2></div></div></div><p>Drools 5 introduces the concept of <span class="emphasis"><em>hard</em></span> and
  <span class="emphasis"><em>soft</em></span> keywords.</p><p>Hard keywords are reserved, you cannot use any hard keyword when
  naming your domain objects, properties, methods, functions and other
  elements that are used in the rule text.</p><p>Here is the list of hard keywords that must be avoided as identifiers
  when writing rules:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">true</code></p></li><li class="listitem"><p><code class="literal">false</code></p></li><li class="listitem"><p><code class="literal">null</code></p></li></ul></div><p>Soft keywords are just recognized in their context, enabling you to
  use these words in any other place if you wish, although, it is still
  recommended to avoid them, to avoid confusions, if possible. Here is a list
  of the soft keywords:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">lock-on-active</code></p></li><li class="listitem"><p><code class="literal">date-effective</code></p></li><li class="listitem"><p><code class="literal">date-expires</code></p></li><li class="listitem"><p><code class="literal">no-loop</code></p></li><li class="listitem"><p><code class="literal">auto-focus</code></p></li><li class="listitem"><p><code class="literal">activation-group</code></p></li><li class="listitem"><p><code class="literal">agenda-group</code></p></li><li class="listitem"><p><code class="literal">ruleflow-group</code></p></li><li class="listitem"><p><code class="literal">entry-point</code></p></li><li class="listitem"><p><code class="literal">duration</code></p></li><li class="listitem"><p><code class="literal">package</code></p></li><li class="listitem"><p><code class="literal">import</code></p></li><li class="listitem"><p><code class="literal">dialect</code></p></li><li class="listitem"><p><code class="literal">salience</code></p></li><li class="listitem"><p><code class="literal">enabled</code></p></li><li class="listitem"><p><code class="literal">attributes</code></p></li><li class="listitem"><p><code class="literal">rule</code></p></li><li class="listitem"><p><code class="literal">extend</code></p></li><li class="listitem"><p>when</p></li><li class="listitem"><p>then</p></li><li class="listitem"><p><code class="literal">template</code></p></li><li class="listitem"><p><code class="literal">query</code></p></li><li class="listitem"><p><code class="literal">declare</code></p></li><li class="listitem"><p><code class="literal">function</code></p></li><li class="listitem"><p><code class="literal">global</code></p></li><li class="listitem"><p><code class="literal">eval</code></p></li><li class="listitem"><p><code class="literal">not</code></p></li><li class="listitem"><p><code class="literal">in</code></p></li><li class="listitem"><p><code class="literal">or</code></p></li><li class="listitem"><p><code class="literal">and</code></p></li><li class="listitem"><p><code class="literal">exists</code></p></li><li class="listitem"><p><code class="literal">forall</code></p></li><li class="listitem"><p>accumulate</p></li><li class="listitem"><p>collect</p></li><li class="listitem"><p>from</p></li><li class="listitem"><p><code class="literal">action</code></p></li><li class="listitem"><p><code class="literal">reverse</code></p></li><li class="listitem"><p><code class="literal">result</code></p></li><li class="listitem"><p><code class="literal">end</code></p></li><li class="listitem"><p>over</p></li><li class="listitem"><p><code class="literal">init</code></p></li></ul></div><p>Of course, you can have these (hard and soft) words as part of a
  method name in camel case, like notSomething() or accumulateSomething() -
  there are no issues with that scenario.</p><p>Although the 3 hard keywords above are unlikely to be used in your
  existing domain models, if you absolutely need to use them as identifiers
  instead of keywords, the DRL language provides the ability to escape hard
  keywords on rule text. To escape a word, simply enclose it in grave accents,
  like this:</p><pre><code class="no-highlight">Holiday( `true` == "yes" ) // please note that Drools will resolve that reference to the method Holiday.isTrue()</code></pre></div><div class="section" title="8.3. Comments"><div class="titlepage"><div><div><h2 class="title"><a id="d0e7874"/>8.3. Comments</h2></div></div></div><p>Comments are sections of text that are ignored by the rule engine.
  They are stripped out when they are encountered, except inside semantic code
  blocks, like the RHS of a rule.</p><div class="section" title="8.3.1. Single line comment"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7879"/>8.3.1. Single line comment</h3></div></div></div><p>To create single line comments, you can use '//'. The parser will
    ignore anything in the line after the comment symbol. Example:</p><pre><code class="no-highlight">rule "Testing Comments"
when
    // this is a single line comment
    eval( true ) // this is a comment in the same line of a pattern
then
    // this is a comment inside a semantic code block
end
</code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p> '#' for comments has been removed.</p></div></div><div class="section" title="8.3.2. Multi-line comment"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7889"/>8.3.2. Multi-line comment</h3></div></div></div><div class="figure"><a id="d0e7892"/><p class="title"><strong>Figure 8.1. Multi-line comment</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/multi_line_comment.png" align="middle" alt="Multi-line comment"/></div></div></div><br class="figure-break"/><p>Multi-line comments are used to comment blocks of text, both in and
    outside semantic code blocks. Example:</p><pre><code class="no-highlight">rule "Test Multi-line Comments"
when
    /* this is a multi-line comment
       in the left hand side of a rule */
    eval( true )
then
    /* and this is a multi-line comment
       in the right hand side of a rule */
end </code></pre></div></div><div class="section" title="8.4. Error Messages"><div class="titlepage"><div><div><h2 class="title"><a id="d0e7902"/>8.4. Error Messages</h2></div></div></div><p>Drools 5 introduces standardized error messages. This standardization
  aims to help users to find and resolve problems in a easier and faster way.
  In this section you will learn how to identify and interpret those error
  messages, and you will also receive some tips on how to solve the problems
  associated with them.</p><div class="section" title="8.4.1. Message format"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7907"/>8.4.1. Message format</h3></div></div></div><p>The standardization includes the error message format and to better
    explain this format, let's use the following example:</p><div class="figure"><a id="d0e7912"/><p class="title"><strong>Figure 8.2. Error Message Format</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/error_message.png" align="middle" alt="Error Message Format"/></div></div></div><br class="figure-break"/><p><span class="bold"><strong>1st Block:</strong></span> This area identifies the
    error code.</p><p><span class="bold"><strong>2nd Block:</strong></span> Line and column
    information.</p><p><span class="bold"><strong>3rd Block:</strong></span> Some text describing the
    problem.</p><p><span class="bold"><strong>4th Block:</strong></span> This is the first
    context. Usually indicates the rule, function, template or query where the
    error occurred. This block is not mandatory.</p><p><span class="bold"><strong>5th Block:</strong></span> Identifies the pattern
    where the error occurred. This block is not mandatory.</p></div><div class="section" title="8.4.2. Error Messages Description"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7938"/>8.4.2. Error Messages Description</h3></div></div></div><div class="section" title="8.4.2.1. 101: No viable alternative"><div class="titlepage"><div><div><h4 class="title"><a id="d0e7941"/>8.4.2.1. 101: No viable alternative</h4></div></div></div><p>Indicates the most common errors, where the parser came to a
      decision point but couldn't identify an alternative. Here are some
      examples:</p><div class="example"><a id="d0e7946"/><p class="title"><strong>Example 8.2. </strong></p><div class="example-contents"><pre><code class="no-highlight">1: rule one
2:   when
3:     exists Foo()
4:     <span class="bold"><strong>exits</strong></span> Bar()
5:   then
6: end
</code></pre></div></div><br class="example-break"/><p>The above example generates this message:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>[ERR 101] Line 4:4 no viable alternative at input 'exits' in
          rule one</p></li></ul></div><p>At first glance this seems to be valid syntax, but it is not
      (exits != exists). Let's take a look at next example:</p><div class="example"><a id="d0e7960"/><p class="title"><strong>Example 8.3. </strong></p><div class="example-contents"><pre><code class="no-highlight">1: package org.drools.examples;
2: rule
3:   when
4:     Object()
5:   then
6:     System.out.println("A RHS");
7: end
</code></pre></div></div><br class="example-break"/><p>Now the above code generates this message:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>[ERR 101] Line 3:2 no viable alternative at input
          'WHEN'</p></li></ul></div><p>This message means that the parser encountered the token <span class="bold"><strong>WHEN</strong></span>, actually a hard keyword, but it's in the
      wrong place since the the rule name is missing.</p><p>The error "no viable alternative" also occurs when you make a
      simple lexical mistake. Here is a sample of a lexical problem:</p><div class="example"><a id="d0e7976"/><p class="title"><strong>Example 8.4. </strong></p><div class="example-contents"><pre><code class="no-highlight">1: rule simple_rule
2:   when
3:     Student( name == "Andy )
4:   then
5: end
</code></pre></div></div><br class="example-break"/><p>The above code misses to close the quotes and because of this the
      parser generates this error message:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>[ERR 101] Line 0:-1 no viable alternative at input
          '&lt;eof&gt;' in rule simple_rule in pattern Student</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Usually the Line and Column information are accurate, but in
        some cases (like unclosed quotes), the parser generates a 0:-1
        position. In this case you should check whether you didn't forget to
        close quotes, apostrophes or parentheses.</p></div></div><div class="section" title="8.4.2.2. 102: Mismatched input"><div class="titlepage"><div><div><h4 class="title"><a id="d0e7989"/>8.4.2.2. 102: Mismatched input</h4></div></div></div><p>This error indicates that the parser was looking for a particular
      symbol that it didn't ﬁnd at the current input position. Here are some
      samples:</p><div class="example"><a id="d0e7994"/><p class="title"><strong>Example 8.5. </strong></p><div class="example-contents"><pre><code class="no-highlight">1: rule simple_rule
2:   when
3:     foo3 : Bar(
</code></pre></div></div><br class="example-break"/><p>The above example generates this message:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>[ERR 102] Line 0:-1 mismatched input '&lt;eof&gt;' expecting
          ')' in rule simple_rule in pattern Bar</p></li></ul></div><p>To fix this problem, it is necessary to complete the rule
      statement.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Usually when you get a 0:-1 position, it means that parser
        reached the end of source.</p></div><p>The following code generates more than one error message:</p><div class="example"><a id="d0e8010"/><p class="title"><strong>Example 8.6. </strong></p><div class="example-contents"><pre><code class="no-highlight">1: package org.drools.examples;
2:
3: rule "Avoid NPE on wrong syntax"
4:   when
5:     not( Cheese( ( type == "stilton", price == 10 ) || ( type == "brie", price == 15 ) ) from $cheeseList )
6:   then
7:     System.out.println("OK");
8: end
</code></pre></div></div><br class="example-break"/><p>These are the errors associated with this source:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>[ERR 102] Line 5:36 mismatched input ',' expecting ')' in rule
          "Avoid NPE on wrong syntax" in pattern Cheese</p></li><li class="listitem"><p>[ERR 101] Line 5:57 no viable alternative at input 'type' in
          rule "Avoid NPE on wrong syntax"</p></li><li class="listitem"><p>[ERR 102] Line 5:106 mismatched input ')' expecting 'then' in
          rule "Avoid NPE on wrong syntax"</p></li></ul></div><p>Note that the second problem is related to the first. To fix it,
      just replace the commas (',') by AND operator ('&amp;&amp;').</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>In some situations you can get more than one error message. Try
        to fix one by one, starting at the first one. Some error messages are
        generated merely as consequences of other errors.</p></div></div><div class="section" title="8.4.2.3. 103: Failed predicate"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8030"/>8.4.2.3. 103: Failed predicate</h4></div></div></div><p>A validating semantic predicate evaluated to false. Usually these
      semantic predicates are used to identify soft keywords. This sample
      shows exactly this situation:</p><div class="example"><a id="d0e8035"/><p class="title"><strong>Example 8.7. </strong></p><div class="example-contents"><pre><code class="no-highlight"> 1: package nesting;
 2: dialect "mvel"
 3:
 4: import org.drools.compiler.Person
 5: import org.drools.compiler.Address
 6: 
 7: <span class="bold"><strong>fdsfdsfds</strong></span>
 8: 
 9: rule "test something"
10:   when
11:     p: Person( name=="Michael" )
12:   then
13:     p.name = "other";
14:     System.out.println(p.name);
15: end
</code></pre></div></div><br class="example-break"/><p>With this sample, we get this error message:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>[ERR 103] Line 7:0 rule 'rule_key' failed predicate:
          {(validateIdentifierKey(DroolsSoftKeywords.RULE))}? in rule</p></li></ul></div><p>The <span class="bold"><strong>fdsfdsfds</strong></span> text is invalid and
      the parser couldn't identify it as the soft keyword
      <code class="literal">rule</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>This error is very similar to 102: Mismatched input, but usually
        involves soft keywords.</p></div></div><div class="section" title="8.4.2.4. 104: Trailing semi-colon not allowed"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8058"/>8.4.2.4. 104: Trailing semi-colon not allowed</h4></div></div></div><p>This error is associated with the <code class="literal">eval</code> clause,
      where its expression may not be terminated with a semicolon. Check this
      example:</p><div class="example"><a id="d0e8066"/><p class="title"><strong>Example 8.8. </strong></p><div class="example-contents"><pre><code class="no-highlight">1: rule simple_rule
2:   when
3:     eval(abc();)
4:   then
5: end
</code></pre></div></div><br class="example-break"/><p>Due to the trailing semicolon within eval, we get this error
      message:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>[ERR 104] Line 3:4 trailing semi-colon not allowed in rule
          simple_rule</p></li></ul></div><p>This problem is simple to fix: just remove the semi-colon.</p></div><div class="section" title="8.4.2.5. 105: Early Exit"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8077"/>8.4.2.5. 105: Early Exit</h4></div></div></div><p>The recognizer came to a subrule in the grammar that must match an
      alternative at least once, but the subrule did not match anything.
      Simply put: the parser has entered a branch from where there is no way
      out. This example illustrates it:</p><div class="example"><a id="d0e8082"/><p class="title"><strong>Example 8.9. </strong></p><div class="example-contents"><pre><code class="no-highlight">1: template test_error
2:   aa s  11;
3: end
</code></pre></div></div><br class="example-break"/><p>This is the message associated to the above sample:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>[ERR 105] Line 2:2 required (...)+ loop did not match anything
          at input 'aa' in template test_error</p></li></ul></div><p>To fix this problem it is necessary to remove the numeric value as
      it is neither a valid data type which might begin a new template slot
      nor a possible start for any other rule file construct.</p></div></div><div class="section" title="8.4.3. Other Messages"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8093"/>8.4.3. Other Messages</h3></div></div></div><p>Any other message means that something bad has happened, so please
    contact the development team.</p></div></div><div class="section" title="8.5. Package"><div class="titlepage"><div><div><h2 class="title"><a id="d0e8098"/>8.5. Package</h2></div></div></div><p>A package is a collection of rules and other related constructs, such
  as imports and globals. The package members are typically related to each
  other - perhaps HR rules, for instance. A package represents a namespace,
  which ideally is kept unique for a given grouping of rules. The package name
  itself is the namespace, and is not related to files or folders in any
  way.</p><p>It is possible to assemble rules from multiple rule sources, and have
  one top level package configuration that all the rules are kept under (when
  the rules are assembled). Although, it is not possible to merge into the
  same package resources declared under different names. A single Rulebase
  may, however, contain multiple packages built on it. A common structure is to
  have all the rules for a package in the same file as the package declaration
  (so that is it entirely self-contained).</p><p>The following railroad diagram shows all the components that may make
  up a package. Note that a package <span class="emphasis"><em>must</em></span> have a namespace and be declared
  using standard Java conventions for package names; i.e., no spaces, unlike
  rule names which allow spaces. In terms of the order of elements, they can
  appear in any order in the rule file, with the exception of the <code class="literal">package</code>
  statement, which must be at the top of the file. In all cases, the semicolons are
  optional.</p><div class="figure"><a id="d0e8113"/><p class="title"><strong>Figure 8.3. package</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/package.png" align="middle" alt="package"/></div></div></div><br class="figure-break"/><p>Notice that any rule attribute (as described the section Rule Attributes)
  may also be written at package level, superseding the attribute's default value.
  The modified default may still be replaced by an attribute setting within
  a rule.</p><div class="section" title="8.5.1. import"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8121"/>8.5.1. import</h3></div></div></div><div class="figure"><a id="d0e8124"/><p class="title"><strong>Figure 8.4. import</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/LanguageReference/import.png" alt="import"/></div></div></div><br class="figure-break"/><p>Import statements work like import statements in Java. You need to
    specify the fully qualified paths and type names for any objects you want
    to use in the rules. Drools automatically imports classes from the
    Java package of the same name, and also from the package
    <code class="code">java.lang</code>.</p></div><div class="section" title="8.5.2. global"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8135"/>8.5.2. global</h3></div></div></div><div class="figure"><a id="d0e8138"/><p class="title"><strong>Figure 8.5. global</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/LanguageReference/global.png" alt="global"/></div></div></div><br class="figure-break"/><p>With <code class="literal">global</code> you define global variables. They are used to make
    application objects available to the rules. Typically, they are used
    to provide data or services that the rules use, especially application
    services used in rule consequences, and to return data from the rules,
    like logs or values added in rule consequences, or for the rules to
    interact with the application, doing callbacks. Globals are not 
    inserted into the Working Memory, and therefore a global should never be
    used to establish conditions in rules except when it has a
    constant immutable value. The engine cannot be notified about value
    changes of globals and does not track their changes. Incorrect use
    of globals in constraints may yield surprising results - surprising
    in a bad way.</p><p>If multiple packages declare globals with the same identifier they
    must be of the same type and all of them will reference the same global
    value.</p><p>In order to use globals you must:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Declare your global variable in your rules file and use it in
        rules. Example:</p><pre><code class="no-highlight">global java.util.List myGlobalList;

rule "Using a global"
when
    eval( true )
then
    myGlobalList.add( "Hello World" );
end
</code></pre></li><li class="listitem"><p>Set the global value on your working memory. It is a best
        practice to set all global values before asserting any fact to the
        working memory. Example:</p><pre><code class="language-java">List list = new ArrayList();
KieSession kieSession = kiebase.newKieSession();
kieSession.setGlobal( "myGlobalList", list );
</code></pre></li></ol></div><p>Note that these are just named instances of objects that you pass in
    from your application to the working memory. This means you can pass in
    any object you want: you could pass in a service locator, or perhaps a
    service itself. With the new <code class="literal">from</code> element it is now common to pass a
    Hibernate session as a global, to allow <code class="literal">from</code> to pull data from a named
    Hibernate query.</p><p>One example may be an instance of a Email service. In your
    integration code that is calling the rule engine, you obtain your
    emailService object, and then set it in the working memory. In the DRL,
    you declare that you have a global of type EmailService, and give it the
    name "email". Then in your rule consequences, you can use things like
    email.sendSMS(number, message).</p><p>Globals are not designed to share data between rules and they should
    never be used for that purpose. Rules always reason and react to the
    working memory state, so if you want to pass data from rule to rule, assert
    the data as facts into the working memory.</p><p>Care must be taken when changing data held by globals because
    the rule engine is not aware of those changes, hence cannot react to them.</p></div></div><div class="section" title="8.6. Function"><div class="titlepage"><div><div><h2 class="title"><a id="d0e8178"/>8.6. Function</h2></div></div></div><div class="figure"><a id="d0e8181"/><p class="title"><strong>Figure 8.6. function</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/function.png" align="middle" alt="function"/></div></div></div><br class="figure-break"/><p>Functions are a way to put semantic code in your rule source file, as
  opposed to in normal Java classes. They can't do anything more than what you
  can do with helper classes. (In fact, the compiler generates the helper class
  for you behind the scenes.) The main advantage of using functions in a rule
  is that you can keep the logic all in one place, and you can change the
  functions as needed (which can be a good or a bad thing). Functions are most
  useful for invoking actions on the consequence (<code class="literal">then</code>) part of a rule,
  especially if that particular action is used over and over again, perhaps
  with only differing parameters for each rule.</p><p>A typical function declaration looks like:</p><pre><code class="no-highlight">function String hello(String name) {
    return "Hello "+name+"!";
}
</code></pre><p>Note that the <code class="literal">function</code> keyword is used, even though its not really
  part of Java. Parameters to the function are defined as for a method, and
  you don't have to have parameters if they are not needed. The return type
  is defined just like in a regular method.</p><p>Alternatively, you could use a static method in a helper class,
  e.g., <code class="code">Foo.hello()</code>. Drools supports the use of
  function imports, so all you would need to do is:</p><pre><code class="no-highlight">import function my.package.Foo.hello</code></pre><p>Irrespective of the way the function is defined or imported, you
  use a function by calling it by its name, in the consequence or inside
  a semantic code block. Example:</p><pre><code class="no-highlight">rule "using a static function"
when 
    eval( true )
then
    System.out.println( hello( "Bob" ) );
end
</code></pre></div><div class="section" title="8.7. Type Declaration"><div class="titlepage"><div><div><h2 class="title"><a id="d0e8212"/>8.7. Type Declaration</h2></div></div></div><div class="figure"><a id="d0e8215"/><p class="title"><strong>Figure 8.7. meta_data</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/meta_data.png" align="middle" alt="meta_data"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e8221"/><p class="title"><strong>Figure 8.8. type_declaration</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/type_declaration.png" align="middle" alt="type_declaration"/></div></div></div><br class="figure-break"/><p>Type declarations have two main goals in the rules engine: to allow
  the declaration of new types, and to allow the declaration of metadata for
  types.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Declaring new types:</strong></span> Drools works
      out of the box with plain Java objects as facts. Sometimes, however,
      users may want to define the model directly to the rules engine, without
      worrying about creating models in a lower level language like Java. At
      other times, there is a domain model already built, but eventually the
      user wants or needs to complement this model with additional entities
      that are used mainly during the reasoning process.</p></li><li class="listitem"><p><span class="bold"><strong>Declaring metadata:</strong></span> facts may
      have meta information associated to them. Examples of meta information
      include any kind of data that is not represented by the fact attributes
      and is consistent among all instances of that fact type. This meta
      information may be queried at runtime by the engine and used in the
      reasoning process.</p></li></ul></div><div class="section" title="8.7.1. Declaring New Types"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8240"/>8.7.1. Declaring New Types</h3></div></div></div><p>To declare a new type, all you need to do is use the keyword
    <code class="literal">declare</code>, followed by the list of fields, and the
    keyword <code class="literal">end</code>. A new fact must have a list of fields,
    otherwise the engine will look for an existing fact class in the classpath
    and raise an error if not found.</p><div class="example"><a id="d0e8251"/><p class="title"><strong>Example 8.10. Declaring a new fact type: Address</strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>declare</strong></span> Address
   number : int
   streetName : String
   city : String
<span class="bold"><strong>end</strong></span>
</code></pre></div></div><br class="example-break"/><p>The previous example declares a new fact type called
    <code class="code">Address</code>. This fact type will have three attributes:
    <code class="code">number</code>, <code class="code">streetName</code> and <code class="code">city</code>. Each
    attribute has a type that can be any valid Java type, including any other
    class created by the user or even other fact types previously
    declared.</p><p>For instance, we may want to declare another fact type
    <code class="code">Person</code>:</p><div class="example"><a id="d0e8280"/><p class="title"><strong>Example 8.11. declaring a new fact type: Person</strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>declare</strong></span> Person
    name : String
    dateOfBirth : java.util.Date
    address : Address
<span class="bold"><strong>end</strong></span>
</code></pre></div></div><br class="example-break"/><p>As we can see on the previous example, <code class="code">dateOfBirth</code> is
    of type <code class="code">java.util.Date</code>, from the Java API, while
    <code class="code">address</code> is of the previously defined fact type
    Address.</p><p>You may avoid having to write the fully qualified name of a class
    every time you write it by using the <code class="literal">import</code> clause, as
    previously discussed.</p><div class="example"><a id="d0e8306"/><p class="title"><strong>Example 8.12. Avoiding the need to use fully qualified class names by using
      import</strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>import</strong></span> java.util.Date

<span class="bold"><strong>declare</strong></span> Person
    name : String
    dateOfBirth : Date
    address : Address
<span class="bold"><strong>end</strong></span></code></pre></div></div><br class="example-break"/><p>When you declare a new fact type, Drools will, at compile time,
    generate bytecode that implements a Java class representing the fact type.
    The generated Java class will be a one-to-one Java Bean mapping of the
    type definition. So, for the previous example, the generated Java class
    would be:</p><div class="example"><a id="d0e8320"/><p class="title"><strong>Example 8.13. generated Java class for the previous Person fact type
      declaration</strong></p><div class="example-contents"><pre><code class="language-java">public class Person implements Serializable {
    private String name;
    private java.util.Date dateOfBirth;
    private Address address;

    // empty constructor
    public Person() {...}

    // constructor with all fields 
    public Person( String name, Date dateOfBirth, Address address ) {...}

    // if keys are defined, constructor with keys
    public Person( ...keys... ) {...}

    // getters and setters
    // equals/hashCode
    // toString
}
</code></pre></div></div><br class="example-break"/><p>Since the generated class is a simple Java class, it can be used
    transparently in the rules, like any other fact.</p><div class="example"><a id="d0e8327"/><p class="title"><strong>Example 8.14. Using the declared types in rules</strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>rule</strong></span> "Using a declared Type"
<span class="bold"><strong>when</strong></span> 
    $p : Person( name == "Bob" )
<span class="bold"><strong>then</strong></span>
    <span class="emphasis"><em>// Insert Mark, who is Bob's mate.</em></span>
    Person mark = new Person();
    mark.setName("Mark");
    insert( mark );
<span class="bold"><strong>end</strong></span>
</code></pre></div></div><br class="example-break"/><div class="section" title="8.7.1.1. Declaring enumerative types"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8346"/>8.7.1.1. Declaring enumerative types</h4></div></div></div><p>DRL also supports the declaration of enumerative types. Such type declarations require the additional keyword
			  <span class="emphasis"><em>enum</em></span>, followed by a comma separated list of admissible values terminated by a semicolon.
		  </p><div class="example"><a id="d0e8354"/><p class="title"><strong>Example 8.15. </strong></p><div class="example-contents"><pre><code class="no-highlight">
<span class="bold"><strong>declare enum</strong></span> DaysOfWeek
   SUN,MON,TUE,WED,THU,FRI,SAT;
<span class="bold"><strong>end</strong></span>
</code></pre></div></div><br class="example-break"/><p>The compiler will generate a valid Java enum, with static methods valueOf() and values(), as well as instance methods
			  ordinal(), compareTo() and name().</p><p>Complex enums are also partially supported, declaring the internal fields similarly to a regular type declaration.
			  Notice that as of version 6.x, enum fields do <span class="emphasis"><em>NOT</em></span> support other declared types or enums</p><div class="example"><a id="d0e8370"/><p class="title"><strong>Example 8.16. </strong></p><div class="example-contents"><pre><code class="no-highlight">
<span class="bold"><strong>declare enum</strong></span> DaysOfWeek
   SUN("Sunday"),MON("Monday"),TUE("Tuesday"),WED("Wednesday"),THU("Thursday"),FRI("Friday"),SAT("Saturday");

   fullName : String
<span class="bold"><strong>end</strong></span>
			  </code></pre></div></div><br class="example-break"/><p>Enumeratives can then be used in rules</p><div class="example"><a id="d0e8381"/><p class="title"><strong>Example 8.17. Using declarative enumerations in rules</strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>rule</strong></span> "Using a declared Enum"
<span class="bold"><strong>when</strong></span>
   $p : Employee( dayOff == DaysOfWeek.MONDAY )
<span class="bold"><strong>then</strong></span>
   ...
<span class="bold"><strong>end</strong></span>
</code></pre></div></div><br class="example-break"/></div></div><div class="section" title="8.7.2. Declaring Metadata"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8397"/>8.7.2. Declaring Metadata</h3></div></div></div><p>Metadata may be assigned to several different constructions in
    Drools: fact types, fact attributes and rules. Drools uses the at sign
    ('@') to introduce metadata, and it always uses the form:</p><pre><code class="no-highlight">@<span class="emphasis"><em>metadata_key</em></span>( <span class="emphasis"><em>metadata_value</em></span> )</code></pre><p>The parenthesized <span class="emphasis"><em>metadata_value</em></span> is
    optional.</p><p>For instance, if you want to declare a metadata attribute like
    <code class="code">author</code>, whose value is <span class="emphasis"><em>Bob</em></span>, you could
    simply write:</p><div class="example"><a id="d0e8423"/><p class="title"><strong>Example 8.18. Declaring a metadata attribute</strong></p><div class="example-contents"><pre><code class="no-highlight">@author( Bob )</code></pre></div></div><br class="example-break"/><p>Drools allows the declaration of any arbitrary metadata attribute,
    but some will have special meaning to the engine, while others are simply
    available for querying at runtime. Drools allows the declaration of
    metadata both for fact types and for fact attributes. Any metadata that is
    declared before the attributes of a fact type are assigned to the fact
    type, while metadata declared after an attribute are assigned to that
    particular attribute.</p><div class="example"><a id="d0e8430"/><p class="title"><strong>Example 8.19. Declaring metadata attributes for fact types and
      attributes</strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>import</strong></span> java.util.Date

<span class="bold"><strong>declare</strong></span> Person
    <span class="emphasis"><em>@author</em></span>( Bob )
    <span class="emphasis"><em>@dateOfCreation</em></span>( 01-Feb-2009 )

    name : String <span class="emphasis"><em>@key @maxLength</em></span>( 30 )
    dateOfBirth : Date 
    address : Address
<span class="bold"><strong>end</strong></span></code></pre></div></div><br class="example-break"/><p>In the previous example, there are two metadata items declared for
    the fact type (<code class="code">@author</code> and <code class="code">@dateOfCreation</code>) and
    two more defined for the name attribute (<code class="code">@key</code> and
    <code class="code">@maxLength</code>). Please note that the <code class="code">@key</code> metadata
    has no required value, and so the parentheses and the value were
    omitted.:</p><div class="section" title="8.7.2.1. Predefined class level annotations"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8468"/>8.7.2.1. Predefined class level annotations</h4></div></div></div><p>Some annotations have predefined semantics that are interpreted by
      the engine. The following is a list of some of these predefined
      annotations and their meaning.</p><div class="section" title="8.7.2.1.1. @role( &lt;fact | event&gt; )"><div class="titlepage"><div><div><h5 class="title"><a id="d0e8473"/>8.7.2.1.1. @role( &lt;fact | event&gt; )</h5></div></div></div><p>The @role annotation defines how the engine should handle instances of that type:
          either as regular facts or as events. It accepts two possible values:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>fact : this is the default, declares that the type is to be
              handled as a regular fact.</p></li><li class="listitem"><p>event : declares that the type is to be handled as an
              event.</p></li></ul></div><p>The following example declares that the fact type StockTick in a stock broker
          application is to be handled as an event.</p><div class="example"><a id="d0e8487"/><p class="title"><strong>Example 8.20. declaring a fact type as an event</strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>import</strong></span> some.package.StockTick

<span class="bold"><strong>declare</strong></span> StockTick
    <span class="emphasis"><em>@role</em></span>( event )
<span class="bold"><strong>end</strong></span>
</code></pre></div></div><br class="example-break"/><p>The same applies to facts declared inline. If StockTick was a fact type declared in
          the DRL itself, instead of a previously existing class, the code would be:</p><div class="example"><a id="d0e8505"/><p class="title"><strong>Example 8.21. declaring a fact type and assigning it the event role</strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>declare</strong></span> StockTick 
    <span class="emphasis"><em>@role</em></span>( event )

    datetime : java.util.Date
    symbol : String
    price : double
<span class="bold"><strong>end</strong></span>
</code></pre></div></div><br class="example-break"/></div><div class="section" title="8.7.2.1.2. @typesafe( &lt;boolean&gt; )"><div class="titlepage"><div><div><h5 class="title"><a id="d0e8518"/>8.7.2.1.2. @typesafe( &lt;boolean&gt; )</h5></div></div></div><p>By default all type declarations are compiled with type safety
        enabled; @typesafe( false ) provides a means to override this
        behaviour by permitting a fall-back, to type unsafe evaluation where
        all constraints are generated as MVEL constraints and executed
        dynamically. This can be important when dealing with collections that
        do not have any generics or mixed type collections.</p></div><div class="section" title="8.7.2.1.3. @timestamp( &lt;attribute name&gt; )"><div class="titlepage"><div><div><h5 class="title"><a id="d0e8523"/>8.7.2.1.3. @timestamp( &lt;attribute name&gt; )</h5></div></div></div><p>Every event has an associated timestamp assigned to it. By default,
          the timestamp for a given event is read from the Session Clock and
          assigned to the event at the time the event is inserted into the working
          memory. Although, sometimes, the event has the timestamp as one of its
          own attributes. In this case, the user may tell the engine to use the
          timestamp from the event's attribute instead of reading it from the
          Session Clock.</p><pre><code class="no-highlight"><span class="emphasis"><em>@timestamp</em></span>( &lt;attributeName&gt; )</code></pre><p>To tell the engine what attribute to use as the source of the
          event's timestamp, just list the attribute name as a parameter to the
          @timestamp tag.</p><div class="example"><a id="d0e8534"/><p class="title"><strong>Example 8.22. declaring the VoiceCall timestamp attribute</strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>declare</strong></span> VoiceCall
    <span class="emphasis"><em>@role</em></span>( event )
    <span class="emphasis"><em>@timestamp</em></span>( callDateTime )
<span class="bold"><strong>end</strong></span>
</code></pre></div></div><br class="example-break"/></div><div class="section" title="8.7.2.1.4. @duration( &lt;attribute name&gt; )"><div class="titlepage"><div><div><h5 class="title"><a id="d0e8550"/>8.7.2.1.4. @duration( &lt;attribute name&gt; )</h5></div></div></div><p>Drools supports both event semantics: point-in-time events and
          interval-based events. A point-in-time event is represented as an
          interval-based event whose duration is zero. By default, all events have
          duration zero. The user may attribute a different duration for an event by
          declaring which attribute in the event type contains the duration of the
          event.</p><pre><code class="no-highlight"><span class="emphasis"><em>@duration</em></span>( &lt;attributeName&gt; )</code></pre><p>So, for our VoiceCall fact type, the declaration would be:</p><div class="example"><a id="d0e8561"/><p class="title"><strong>Example 8.23. declaring the VoiceCall duration attribute</strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>declare</strong></span> VoiceCall
    <span class="emphasis"><em>@role</em></span>( event )
    <span class="emphasis"><em>@timestamp</em></span>( callDateTime )
    <span class="emphasis"><em>@duration</em></span>( callDuration )
<span class="bold"><strong>end</strong></span></code></pre></div></div><br class="example-break"/></div><div class="section" title="8.7.2.1.5. @expires( &lt;time interval&gt; )"><div class="titlepage"><div><div><h5 class="title"><a id="d0e8579"/>8.7.2.1.5. @expires( &lt;time interval&gt; )</h5></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>This tag is only considered when running the engine in STREAM
            mode. Also, additional discussion on the effects of using this tag is
            made on the Memory Management section. It is included here for
            completeness.</p></div><p>Events may be automatically expired after some time in the working
          memory. Typically this happens when, based on the existing rules in the
          knowledge base, the event can no longer match and activate any rules.
          Although, it is possible to explicitly define when an event should
          expire.</p><pre><code class="no-highlight"><span class="emphasis"><em>@expires</em></span>( &lt;timeOffset&gt; )</code></pre><p>The value of <span class="emphasis"><em>timeOffset</em></span> is a temporal interval
          in the form:</p><pre><code class="no-highlight">[#d][#h][#m][#s][#[ms]]</code></pre><p>Where <span class="emphasis"><em>[ ]</em></span> means an optional parameter and
          <span class="emphasis"><em>#</em></span> means a numeric value.</p><p>So, to declare that the VoiceCall facts should be expired after 1
          hour and 35 minutes after they are inserted into the working memory, the
          user would write:</p><div class="example"><a id="d0e8608"/><p class="title"><strong>Example 8.24. declaring the expiration offset for the VoiceCall events</strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>declare</strong></span> VoiceCall
    <span class="emphasis"><em>@role</em></span>( event )
    <span class="emphasis"><em>@timestamp</em></span>( callDateTime )
    <span class="emphasis"><em>@duration</em></span>( callDuration )
    <span class="emphasis"><em>@expires</em></span>( 1h35m )
<span class="bold"><strong>end</strong></span></code></pre></div></div><br class="example-break"/><p>The @expires policy will take precedence and override the implicit
          expiration offset calculated from temporal constraints and sliding windows
          in the knowledge base.</p></div><div class="section" title="8.7.2.1.6. @propertyChangeSupport"><div class="titlepage"><div><div><h5 class="title"><a id="d0e8631"/>8.7.2.1.6. @propertyChangeSupport</h5></div></div></div><p>Facts that implement support for property changes as defined in
        the Javabean(tm) spec, now can be annotated so that the engine
        register itself to listen for changes on fact properties. The boolean
        parameter that was used in the insert() method in the Drools 4 API is
        deprecated and does not exist in the drools-api module.</p><div class="example"><a id="d0e8636"/><p class="title"><strong>Example 8.25. @propertyChangeSupport</strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>declare</strong></span> Person
  <span class="italic">@propertyChangeSupport</span>
<span class="bold"><strong>end</strong></span></code></pre></div></div><br class="example-break"/></div><div class="section" title="8.7.2.1.7. @propertyReactive"><div class="titlepage"><div><div><h5 class="title"><a id="d0e8648"/>8.7.2.1.7. @propertyReactive</h5></div></div></div><p>Make this type property reactive. See Fine grained property
        change listeners section for details.</p></div></div><div class="section" title="8.7.2.2. Predefined attribute level annotations"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8653"/>8.7.2.2. Predefined attribute level annotations</h4></div></div></div><p>As noted before, Drools also supports annotations in type
      attributes. Here is a list of predefined attribute annotations.</p><div class="section" title="8.7.2.2.1. @key"><div class="titlepage"><div><div><h5 class="title"><a id="d0e8658"/>8.7.2.2.1. @key</h5></div></div></div><p>Declaring an attribute as a key attribute has 2 major effects on
        generated types:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The attribute will be used as a key identifier for the
              type, and as so, the generated class will implement the equals()
              and hashCode() methods taking the attribute into account when
              comparing instances of this type.</p></li><li class="listitem"><p>Drools will generate a constructor using all the key
              attributes as parameters.</p></li></ol></div><p>For instance:</p><div class="example"><a id="d0e8672"/><p class="title"><strong>Example 8.26. example of @key declarations for a type</strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>declare</strong></span> Person
    firstName : String @key
    lastName : String @key
    age : int
<span class="bold"><strong>end</strong></span>
</code></pre></div></div><br class="example-break"/><p>For the previous example, Drools will generate equals() and
        hashCode() methods that will check the firstName and lastName
        attributes to determine if two instances of Person are equal to each
        other, but will not check the age attribute. It will also generate a
        constructor taking firstName and lastName as parameters, allowing one
        to create instances with a code like this:</p><div class="example"><a id="d0e8684"/><p class="title"><strong>Example 8.27. creating an instance using the key constructor</strong></p><div class="example-contents"><pre><code class="no-highlight">Person person = new Person( "John", "Doe" );</code></pre></div></div><br class="example-break"/></div><div class="section" title="8.7.2.2.2. @position"><div class="titlepage"><div><div><h5 class="title"><a id="d0e8689"/>8.7.2.2.2. @position</h5></div></div></div><p>Patterns support positional arguments on type declarations.</p><p>Positional arguments are ones where you don't need to specify the field name, as the
          position maps to a known named field. i.e. Person( name == "mark" ) can be rewritten as
          Person( "mark"; ). The semicolon ';' is important so that the engine knows that everything
          before it is a positional argument. Otherwise we might assume it was a boolean expression,
          which is how it could be interpreted after the semicolon. You can mix positional and named
          arguments on a pattern by using the semicolon ';' to separate them. Any variables used in
          a positional that have not yet been bound will be bound to the field that maps to that
          position.</p><pre><code class="no-highlight"><span class="bold"><strong>declare</strong></span> Cheese
    name : String
    shop : String
    price : int
<span class="bold"><strong>end</strong></span>
</code></pre><p>The default order is the declared order, but this can be overridden using
          @position</p><pre><code class="no-highlight"><span class="bold"><strong>declare</strong></span> Cheese
    name : String <span class="italic">@position(1)</span>
    shop : String <span class="italic">@position(2)</span>
    price : int <span class="italic">@position(0)</span>
<span class="bold"><strong>end</strong></span>
</code></pre><p>The @Position annotation, in the org.drools.definition.type package, can be used to
          annotate original pojos on the classpath. Currently only fields on classes can be
          annotated. Inheritance of classes is supported, but not interfaces of methods yet.</p><p>Example patterns, with two constraints and a binding. Remember semicolon ';' is used
          to differentiate the positional section from the named argument section. Variables and
          literals and expressions using just literals are supported in positional arguments, but
          not variables.</p><pre><code class="no-highlight">
Cheese( "stilton", "Cheese Shop", p; )
Cheese( "stilton", "Cheese Shop"; p : price )
Cheese( "stilton"; shop == "Cheese Shop", p : price )
Cheese( name == "stilton"; shop == "Cheese Shop", p : price )
</code></pre><p>@Position is inherited when beans extend each other; while not recommended, two fields
          may have the same @position value, and not all consecutive values need be declared. If a
          @position is repeated, the conflict is solved using inheritance (fields in the superclass
          have the precedence) and the declaration order. If a @position value is missing, the first
          field without an explicit @position (if any) is selected to fill the gap. As always,
          conflicts are resolved by inheritance and declaration order.</p><pre><code class="no-highlight"><span class="bold"><strong>declare</strong></span> Cheese
    name : String 
    shop : String <span class="italic">@position(2)</span>
    price : int <span class="italic">@position(0)</span>
<span class="bold"><strong>end</strong></span>

<span class="bold"><strong>declare</strong></span> SeasonedCheese <span class="bold"><strong>extends</strong></span> Cheese
    year : Date <span class="italic">@position(0)</span>
    origin : String <span class="italic">@position(6)</span>
    country : String    
<span class="bold"><strong>end</strong></span></code></pre><p>In the example, the field order would be : price (@position 0 in the superclass),
            year (@position 0 in the subclass), name (first field with no @position), shop
            (@position 2), country (second field without @position), origin.</p></div></div></div><div class="section" title="8.7.3. Declaring Metadata for Existing Types"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8758"/>8.7.3. Declaring Metadata for Existing Types</h3></div></div></div><p>Drools allows the declaration of metadata attributes for existing
    types in the same way as when declaring metadata attributes for new fact
    types. The only difference is that there are no fields in that
    declaration.</p><p>For instance, if there is a class org.drools.examples.Person, and
    one wants to declare metadata for it, it's possible to write the following
    code:</p><div class="example"><a id="d0e8765"/><p class="title"><strong>Example 8.28. Declaring metadata for an existing type</strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>import</strong></span> org.drools.examples.Person

<span class="bold"><strong>declare</strong></span> Person
    <span class="emphasis"><em>@author</em></span>( Bob )
    <span class="emphasis"><em>@dateOfCreation</em></span>( 01-Feb-2009 )
<span class="bold"><strong>end</strong></span>
</code></pre></div></div><br class="example-break"/><p>Instead of using the import, it is also possible to reference the
    class by its fully qualified name, but since the class will also be
    referenced in the rules, it is usually shorter to add the import and use
    the short class name everywhere.</p><div class="example"><a id="d0e8786"/><p class="title"><strong>Example 8.29. Declaring metadata using the fully qualified class name</strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>declare</strong></span> org.drools.examples.Person
    <span class="emphasis"><em>@author</em></span>( Bob )
    <span class="emphasis"><em>@dateOfCreation</em></span>( 01-Feb-2009 )
<span class="bold"><strong>end</strong></span></code></pre></div></div><br class="example-break"/></div><div class="section" title="8.7.4. Parametrized constructors for declared types"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8801"/>8.7.4. Parametrized constructors for declared types</h3></div></div></div><p>Generate constructors with parameters for declared types.</p><p>Example: for a declared type like the following:</p><pre><code class="no-highlight"><span class="bold"><strong>declare</strong></span> Person
    firstName : String <span class="italic">@key</span>
    lastName : String <span class="italic">@key</span>
    age : int
<span class="bold"><strong>end</strong></span>
</code></pre><p>The compiler will implicitly generate 3 constructors: one without
    parameters, one with the @key fields, and one with all fields.</p><pre><code class="no-highlight">Person() // parameterless constructor
Person( String firstName, String lastName )
Person( String firstName, String lastName, int age )</code></pre></div><div class="section" title="8.7.5. Non Typesafe Classes"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8825"/>8.7.5. Non Typesafe Classes</h3></div></div></div><p>@typesafe( &lt;boolean&gt;) has been added to type declarations. By
    default all type declarations are compiled with type safety enabled;
    @typesafe( false ) provides a means to override this behaviour by
    permitting a fall-back, to type unsafe evaluation where all constraints
    are generated as MVEL constraints and executed dynamically. This can be
    important when dealing with collections that do not have any generics or
    mixed type collections.</p></div><div class="section" title="8.7.6. Accessing Declared Types from the Application Code"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8830"/>8.7.6. Accessing Declared Types from the Application Code</h3></div></div></div><p>Declared types are usually used inside rules files, while Java
    models are used when sharing the model between rules and applications.
    Although, sometimes, the application may need to access and handle facts
    from the declared types, especially when the application is wrapping the
    rules engine and providing higher level, domain specific user interfaces
    for rules management.</p><p>In such cases, the generated classes can be handled as usual with
    the Java Reflection API, but, as we know, that usually requires a lot of
    work for small results. Therefore, Drools provides a simplified API for
    the most common fact handling the application may want to do.</p><p>The first important thing to realize is that a declared fact will
    belong to the package where it was declared. So, for instance, in the
    example below, <code class="code">Person</code> will belong to the
    <code class="code">org.drools.examples</code> package, and so the fully qualified name
    of the generated class will be
    <code class="code">org.drools.examples.Person</code>.</p><div class="example"><a id="d0e8848"/><p class="title"><strong>Example 8.30. Declaring a type in the org.drools.examples package</strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>package</strong></span> org.drools.examples

<span class="bold"><strong>import</strong></span> java.util.Date

<span class="bold"><strong>declare</strong></span> Person
    name : String
    dateOfBirth : Date
    address : Address
<span class="bold"><strong>end</strong></span></code></pre></div></div><br class="example-break"/><p>Declared types, as discussed previously, are generated at knowledge
    base compilation time, i.e., the application will only have access to them
    at application run time. Therefore, these classes are not available for
    direct reference from the application.</p><p>Drools then provides an interface through which users can handle
    declared types from the application code:
    <code class="code">org.drools.definition.type.FactType</code>. Through this interface,
    the user can instantiate, read and write fields in the declared fact
    types.</p><div class="example"><a id="d0e8870"/><p class="title"><strong>Example 8.31. Handling declared fact types through the API</strong></p><div class="example-contents"><pre><code class="no-highlight">// get a reference to a knowledge base with a declared type:
KieBase kbase = ...

// get the declared FactType
FactType personType = kbase.getFactType( "org.drools.examples",
                                         "Person" );

// handle the type as necessary:
// create instances:
Object bob = personType.newInstance();

// set attributes values
personType.set( bob,
                "name",
                "Bob" );
personType.set( bob,
                "age",
                42 );

// insert fact into a session
KieSession ksession = ...
ksession.insert( bob );
ksession.fireAllRules();

// read attributes
String name = personType.get( bob, "name" );
int age = personType.get( bob, "age" );

</code></pre></div></div><br class="example-break"/><p>The API also includes other helpful methods, like setting all the
    attributes at once, reading values from a Map, or reading all attributes
    at once, into a Map.</p><p>Although the API is similar to Java reflection (yet much simpler to
    use), it does not use reflection underneath, relying on much more
    performant accessors implemented with generated bytecode.</p></div><div class="section" title="8.7.7. Type Declaration 'extends'"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8879"/>8.7.7. Type Declaration 'extends'</h3></div></div></div><p>Type declarations now support 'extends' keyword for
    inheritance</p><p>In order to extend a type declared in Java by a DRL declared
    subtype, repeat the supertype in a declare statement without any
    fields.</p><pre><code class="no-highlight">b org.people.Person

<span class="bold"><strong>declare</strong></span> Person <span class="bold"><strong>end</strong></span>

<span class="bold"><strong>declare</strong></span> Student <span class="bold"><strong>extends</strong></span> Person
    school : String
<span class="bold"><strong>end</strong></span>

<span class="bold"><strong>declare</strong></span> LongTermStudent <span class="bold"><strong>extends</strong></span> Student
    years : int
    course : String
<span class="bold"><strong>end</strong></span></code></pre></div><div class="section" title="8.7.8. Traits"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8911"/>8.7.8. Traits</h3></div></div></div><p>WARNING : this feature is still experimental and subject to changes</p><p>The same fact may have multiple dynamic types which do not fit naturally in a class
      hierarchy. Traits allow to model this very common scenario. A trait is an interface that can
      be applied (and eventually removed) to an individual object at runtime. To create a trait
      rather than a traditional bean, one has to declare them explicitly as in the following
      example:</p><div class="example"><a id="d0e8918"/><p class="title"><strong>Example 8.32. </strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>declare</strong></span> <span class="bold"><strong>trait</strong></span> GoldenCustomer
    // fields will map to getters/setters
    code     : String
    balance  : long
    discount : int
    maxExpense : long
<span class="bold"><strong>end</strong></span></code></pre></div></div><br class="example-break"/><p>At runtime, this declaration results in an interface, which can be used to write patterns,
      but can not be instantiated directly. In order to apply a trait to an object, we provide the
      new don keyword, which can be used as simply as this:</p><div class="example"><a id="d0e8930"/><p class="title"><strong>Example 8.33. </strong></p><div class="example-contents"><pre><code class="no-highlight">when
    $c : Customer()
then
    GoldenCustomer gc = don( $c, GoldenCustomer.class );
end</code></pre></div></div><br class="example-break"/><p>when a core object dons a trait, a proxy class is created on the fly (one such class will
      be generated lazily for each core/trait class combination). The proxy instance, which wraps
      the core object and implements the trait interface, is inserted automatically and will
      possibly activate other rules. An immediate advantage of declaring and using interfaces,
      getting the implementation proxy for free from the engine, is that multiple inheritance
      hierarchies can be exploited when writing rules. The core classes, however, need not implement
      any of those interfaces statically, also facilitating the use of legacy classes as cores. In
      fact, any object can don a trait, provided that they are declared as @Traitable. Notice that
      this annotation used to be optional, but now is mandatory.</p><div class="example"><a id="d0e8935"/><p class="title"><strong>Example 8.34. </strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>import</strong></span> org.drools.core.factmodel.traits.Traitable;
<span class="bold"><strong>declare</strong></span> Customer
    <span class="italic">@Traitable</span>
    code    : String
    balance : long
<span class="bold"><strong>end</strong></span></code></pre></div></div><br class="example-break"/><p>The only connection between core classes and trait interfaces is at the proxy level: a
      trait is not specifically tied to a core class. This means that the same trait can be applied
      to totally different objects. For this reason, the trait does not transparently expose the
      fields of its core object. So, when writing a rule using a trait interface, only the fields of
      the interface will be available, as usual. However, any field in the interface that
      corresponds to a core object field, will be mapped by the proxy class:</p><div class="example"><a id="d0e8950"/><p class="title"><strong>Example 8.35. </strong></p><div class="example-contents"><pre><code class="no-highlight">when
    $o: OrderItem( $p : price, $code : custCode )
    $c: GoldenCustomer( code == $code, $a : balance, $d: discount )
then
    $c.setBalance( $a - $p*$d );
end</code></pre></div></div><br class="example-break"/><p>In this case, the code and balance would be read from the underlying Customer object.
      Likewise, the setAccount will modify the underlying object, preserving a strongly typed access
      to the data structures. A hard field must have the same name and type both in the core class
      and all donned interfaces. The name is used to establish the mapping: if two fields have the
      same name, then they must also have the same declared type. The annotation
      @org.drools.core.factmodel.traits.Alias allows to relax this restriction. If an @Alias is
      provided, its value string will be used to resolve mappings instead of the original field
      name. @Alias can be applied both to traits and core beans. </p><div class="example"><a id="d0e8955"/><p class="title"><strong>Example 8.36. </strong></p><div class="example-contents"><pre><code class="no-highlight">import org.drools.core.factmodel.traits.*;
<span class="bold"><strong>declare</strong></span> <span class="bold"><strong>trait</strong></span> GoldenCustomer
    balance : long <span class="italic">@Alias( "org.acme.foo.accountBalance" )</span>
<span class="bold"><strong>end</strong></span>

<span class="bold"><strong>declare</strong></span> Person
    <span class="italic">@Traitable</span>
    name : String
    savings : long <span class="italic">@Alias( "org.acme.foo.accountBalance" )</span>
<span class="bold"><strong>end</strong></span>

when
    GoldenCustomer( balance &gt; 1000 ) // will react to new Person( 2000 )
then
end
</code></pre></div></div><br class="example-break"/><p>More work is being done on reaxing this constraint (see the experimental section on
      "logical" traits later). Now, one might wonder what happens when a core class does NOT provide
      the implementation for a field defined in an interface. We call hard fields those trait fields
      which are also core fields and thus readily available, while we define soft those fields which
      are NOT provided by the core class. Hidden fields, instead, are fields in the core class not
      exposed by the interface.</p><p>So, while hard field management is intuitive, there remains the problem of soft and hidden
      fields. Hidden fields are normally only accessible using the core class directly. However, the
      "fields" Map can be used on a trait interface to access a hidden field. If the field can't be
      resolved, null will be returned. Notice that this feature is likely to change in the
      future.</p><div class="example"><a id="d0e8986"/><p class="title"><strong>Example 8.37. </strong></p><div class="example-contents"><pre><code class="no-highlight">when
    $sc : GoldenCustomer( fields[ "age" ] &gt; 18 )  // age is declared by the underlying core class, but not by GoldenCustomer
then</code></pre></div></div><br class="example-break"/><p>Soft fields, instead, are stored in a Map-like data structure that is specific to each
      core object and referenced by the proxy(es), so that they are effectively shared even when an
      object dons multiple traits.</p><div class="example"><a id="d0e8991"/><p class="title"><strong>Example 8.38. </strong></p><div class="example-contents"><pre><code class="no-highlight">when
    $sc : GoldenCustomer( $c : code, // hard getter
                          $maxExpense : maxExpense &gt; 1000 // soft getter
    )
then
    $sc.setDiscount( ... ); // soft setter
end</code></pre></div></div><br class="example-break"/><p>A core object also holds a reference to all its proxies, so that it is possible to track
      which type(s) have been added to an object, using a sort of dynamic "instanceof" operator,
      which we called isA. The operator can accept a String, a class literal or a list of class
      literals. In the latter case, the constraint is satisfied only if all the traits have been
      donned. </p><div class="example"><a id="d0e8996"/><p class="title"><strong>Example 8.39. </strong></p><div class="example-contents"><pre><code class="no-highlight">$sc : GoldenCustomer( $maxExpense : maxExpense &gt; 1000,
                      this isA "SeniorCustomer", this isA [ NationalCustomer.class, OnlineCustomer.class ]
)</code></pre></div></div><br class="example-break"/><p>Eventually, the business logic may require that a trait is removed from a wrapped object.
      To this end, we provide two options. The first is a "logical don", which will result in a
      logical insertion of the proxy resulting from the traiting operation. The TMS will ensure that
      the trait is removed when its logical support is removed in the first place.</p><div class="example"><a id="d0e9001"/><p class="title"><strong>Example 8.40. </strong></p><div class="example-contents"><pre><code class="no-highlight">then
    <span class="bold"><strong>don</strong></span>( $x, // core object
         Customer.class, // trait class
         true // optional flag for logical insertion
    )
    </code></pre></div></div><br class="example-break"/><p>The second is the use of the "shed" keyword, which causes the removal of any type that is
      a subtype (or equivalent) of the one passed as an argument. Notice that, as of version 5.5,
      shed would only allow to remove a single specific trait.</p><div class="example"><a id="d0e9009"/><p class="title"><strong>Example 8.41. </strong></p><div class="example-contents"><pre><code class="no-highlight">then
    Thing t = <span class="bold"><strong>shed</strong></span>( $x, GoldenCustomer.class ) // also removes any trait that</code></pre></div></div><br class="example-break"/><p>This operation returns another proxy implementing the org.drools.core.factmodel.traits.Thing interface, where
      the getFields() and getCore()
      methods are defined. Internally, in fact, all declared traits are generated to extend this interface (in addition
      to any others specified).      This allows to preserve the wrapper with the soft fields which would otherwise be lost.</p><p>A trait and its proxies are also correlated in another way. Starting from version 5.6,
      whenever a core object is "modified", its proxies are "modified" automatically as well, to
      allow trait-based patterns to react to potential changes in hard fields. Likewise, whenever a
      trait proxy (mached by a trait pattern) is modified, the modification is propagated to the
      core class and the other traits. Morover, whenever a don operation is performed, the core
      object is also modified automatically, to reevaluate any "isA" operation which may be
      triggered.</p><p>Potentially, this may result in a high number of modifications, impacting performance (and
      correctness) heavily. So two solutions are currently implemented. First, whenever a core
      object is modified, only the most specific traits (in the sense of inheritance between trait
      interfaces) are updated and an internal blocking mechanism is in place to ensure that each
      potentially matching pattern is evaluated once and only once. So, in the following
      situation:</p><pre><code class="no-highlight"><span class="bold"><strong>declare</strong></span> <span class="bold"><strong>trait</strong></span> GoldenCustomer <span class="bold"><strong>end</strong></span>
<span class="bold"><strong>declare</strong></span> <span class="bold"><strong>trait</strong></span> NationalGoldenustomer <span class="bold"><strong>extends</strong></span> GoldenCustomer <span class="bold"><strong>end</strong></span>
<span class="bold"><strong>declare</strong></span> <span class="bold"><strong>trait</strong></span> SeniorGoldenCustomer <span class="bold"><strong>extends</strong></span> GoldenCustomer <span class="bold"><strong>end</strong></span></code></pre><p>a modification of an object that is both a GoldenCustomer, a NationalGoldenCustomer and a
      SeniorGoldenCustomer wold cause only the latter two proxies to be actually modified. The
      first would match any pattern for GoldenCustomer and NationalGoldenCustomer; the latter would
      instead be prevented from rematching GoldenCustomer, but would be allowed to match
      SeniorGoldenCustomer patterns. It is not necessary, instead, to modify the GoldenCustomer
      proxy since it is already covered by at least one other more specific trait.</p><p>The second method, up to the usr, is to mark traits as @PropertyReactive. Property
      reactivity is trait-enabled and takes into account the trait field mappings, so to block
      unnecessary propagations. </p><div class="section" title="8.7.8.1. Cascading traits"><div class="titlepage"><div><div><h4 class="title"><a id="d0e9058"/>8.7.8.1. Cascading traits</h4></div></div></div><p><span class="bold"><strong>WARNING</strong></span> : This feature is extremely experimental and
        subject to changes</p><p>Normally, a hard field must be exposed with its original type by all traits donned by an
        object, to prevent situations such as</p><div class="example"><a id="d0e9067"/><p class="title"><strong>Example 8.42. </strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>declare</strong></span> Person
  @Traitable
  name : String
  id : String
<span class="bold"><strong>end</strong></span>

<span class="bold"><strong>declare</strong></span> <span class="bold"><strong>trait</strong></span> Customer
  id : String
<span class="bold"><strong>end</strong></span>

<span class="bold"><strong>declare</strong></span> <span class="bold"><strong>trait</strong></span> Patient
  id : long  // Person can't don Patient, or an exception will be thrown
<span class="bold"><strong>end</strong></span></code></pre></div></div><br class="example-break"/><p>Should a Person don both Customer and Patient, the type of the hard field id would be
        ambiguous. However, consider the following example, where GoldenCustomers refer their best
        friends so that they become Customers as well:</p><div class="example"><a id="d0e9094"/><p class="title"><strong>Example 8.43. </strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>declare</strong></span> Person
  @Traitable( logical=true )
  bestFriend : Person
<span class="bold"><strong>end</strong></span>

<span class="bold"><strong>declare</strong></span> <span class="bold"><strong>trait</strong></span> Customer <span class="bold"><strong>end</strong></span>
        
<span class="bold"><strong>declare</strong></span> <span class="bold"><strong>trait</strong></span> GoldenCustomer <span class="bold"><strong>extends</strong></span> Customer
  refers : Customer <span class="italic">@Alias( "bestFriend" )</span>
<span class="bold"><strong>end</strong></span>          </code></pre></div></div><br class="example-break"/><p>Aside from the @Alias, a Person-as-GoldenCustomer's best friend might be compatible with
        the requirements of the trait GoldenCustomer, provided that they are some kind of Customer
        themselves. Marking a Person as "logically traitable" - i.e. adding the annotation
        @Traitable( logical = true ) - will instruct the engine to try and preserve the logical
        consistency rather than throwing an exception due to a hard field with different type
        declarations (Person vs Customer). The following operations would then work:</p><div class="example"><a id="d0e9128"/><p class="title"><strong>Example 8.44. </strong></p><div class="example-contents"><pre><code class="no-highlight">Person p1 = new Person();
Person p2 = new Person();
p1.setBestFriend( p2 );
...
Customer c2 = don( p2, Customer.class );
...
GoldenCustomer gc1 = don( p1, GoldenCustomer.class );
...
p1.getBestFriend(); // returns p2
gc1.getRefers(); // returns c2, a Customer proxy wrapping p2</code></pre></div></div><br class="example-break"/><p>Notice that, by the time p1 becomes GoldenCustomer, p2 must have already become a
        Customer themselves, otherwise a runtime exception will be thrown since the very definition
        of GoldenCustomer would have been violated.</p><p>In some cases, however, one might want to infer, rather than verify, that p2 is a
        Customer by virtue that p1 is a GoldenCustomer. This modality can be enabled by marking
        Customer as "logical", using the annotation @org.drools.core.factmodel.traits.Trait( logical
        = true ). In this case, should p2 not be a Customer by the time that p1 becomes a
        GoldenCustomer, it will be automatically don the trait Customer to preserve the logical
        integrity of the system.</p><p>Notice that the annotation on the core class enables the dynamic type management for its
        fields, whereas the annotation on the traits determines whether they will be enforced as
        integrity constraints or cascaded dynamically.</p><div class="example"><a id="d0e9137"/><p class="title"><strong>Example 8.45. </strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>import</strong></span> org.drools.factmodel.traits.*;

<span class="bold"><strong>declare</strong></span> <span class="bold"><strong>trait</strong></span> Customer
    <span class="italic">@Trait( logical = true )</span>
<span class="bold"><strong>end</strong></span>        </code></pre></div></div><br class="example-break"/></div></div></div><div class="section" title="8.8. Rule"><div class="titlepage"><div><div><h2 class="title"><a id="d0e9154"/>8.8. Rule</h2></div></div></div><div class="figure"><a id="d0e9157"/><p class="title"><strong>Figure 8.9. rule</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/rule.png" align="middle" alt="rule"/></div></div></div><br class="figure-break"/><p>A rule specifies that <span class="emphasis"><em>when</em></span> a particular set of
  conditions occur, specified in the Left Hand Side (LHS),
  <span class="emphasis"><em>then</em></span> do what queryis specified as a list of actions in
  the Right Hand Side (RHS). A common question from users is "Why use when
  instead of if?" "When" was chosen over "if" because "if" is normally part of
  a procedural execution flow, where, at a specific point in time, a condition
  is to be checked. In contrast, "when" indicates that the condition
  evaluation is not tied to a specific evaluation sequence or point in time,
  but that it happens continually, at any time during the life time of the
  engine; whenever the condition is met, the actions are executed.</p><p>A rule must have a name, unique within its rule package. If you define
  a rule twice in the same DRL it produces an error while loading. If you add
  a DRL that includes a rule name already in the package, it replaces the
  previous rule. If a rule name is to have spaces, then it will need to be
  enclosed in double quotes (it is best to always use double quotes).</p><p>Attributes - described below - are optional. They are best written one
  per line.</p><p>The LHS of the rule follows the <code class="literal">when</code> keyword
  (ideally on a new line), similarly the RHS follows the
  <code class="literal">then</code> keyword (again, ideally on a newline). The rule is
  terminated by the keyword <code class="literal">end</code>. Rules cannot be
  nested.</p><div class="example"><a id="d0e9186"/><p class="title"><strong>Example 8.46. Rule Syntax Overview</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "&lt;name&gt;"
    &lt;attribute&gt;*
when
    &lt;conditional element&gt;*
then
    &lt;action&gt;*
end</code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e9191"/><p class="title"><strong>Example 8.47. A simple rule</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Approve if not rejected"
  salience -100 
  agenda-group "approval"
    when
        not Rejection() 
        p : Policy(approved == false, policyState:status)
        exists Driver(age &gt; 25)
        Process(status == policyState)
    then
        log("APPROVED: due to no objections."); 
        p.setApproved(true);
end</code></pre></div></div><br class="example-break"/><div class="section" title="8.8.1. Rule Attributes"><div class="titlepage"><div><div><h3 class="title"><a id="d0e9196"/>8.8.1. Rule Attributes</h3></div></div></div><p>Rule attributes provide a declarative way to influence the behavior
    of the rule. Some are quite simple, while others are part of complex
    subsystems such as ruleflow. To get the most from Drools you should make
    sure you have a proper understanding of each attribute.</p><div class="figure"><a id="d0e9201"/><p class="title"><strong>Figure 8.10. rule attributes</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/rule_attributes.png" align="middle" alt="rule attributes"/></div></div></div><br class="figure-break"/><div class="variablelist"><dl><dt><span class="term"><code class="literal">no-loop</code></span></dt><dd><p>default value: <code class="literal">false</code></p><p>type: Boolean</p><p>When a rule's consequence modifies a fact it may cause the
          rule to activate again, causing an infinite loop. Setting no-loop to
          true will skip the creation of another Activation for the rule with
          the current set of facts.</p></dd><dt><span class="term"><code class="literal">ruleflow-group</code></span></dt><dd><p>default value: N/A</p><p>type: String</p><p>Ruleflow is a Drools feature that lets you exercise control
          over the firing of rules. Rules that are assembled by the same
          ruleflow-group identifier fire only when their group is
          active.</p></dd><dt><span class="term"><code class="literal">lock-on-active</code></span></dt><dd><p>default value: <code class="literal">false</code></p><p>type: Boolean</p><p>Whenever a ruleflow-group becomes active or an agenda-group
          receives the focus, any rule within that group that has
          lock-on-active set to true will not be activated any more;
          irrespective of the origin of the update, the activation of a
          matching rule is discarded. This is a stronger version of no-loop,
          because the change could now be caused not only by the rule itself.
          It's ideal for calculation rules where you have a number of rules
          that modify a fact and you don't want any rule re-matching and
          firing again. Only when the ruleflow-group is no longer active or
          the agenda-group loses the focus those rules with lock-on-active set
          to true become eligible again for their activations to be placed
          onto the agenda.</p></dd><dt><span class="term"><code class="literal">salience</code></span></dt><dd><p>default value: <code class="literal">0</code></p><p>type: integer</p><p>Each rule has an integer salience attribute which defaults to
          zero and can be negative or positive. Salience is a form of priority
          where rules with higher salience values are given higher priority
          when ordered in the Activation queue.</p><p>Drools also supports dynamic salience where you can use an
          expression involving bound variables.</p><div class="example"><a id="d0e9260"/><p class="title"><strong>Example 8.48. Dynamic Salience</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Fire in rank order 1,2,.."
        salience( -$rank )
    when
        Element( $rank : rank,... )
    then
        ...
end</code></pre></div></div><br class="example-break"/></dd><dt><span class="term"><code class="literal">agenda-group</code></span></dt><dd><p>default value: MAIN</p><p>type: String</p><p>Agenda groups allow the user to partition the Agenda providing
          more execution control. Only rules in the agenda group that has
          acquired the focus are allowed to fire.</p></dd><dt><span class="term"><code class="literal">auto-focus</code></span></dt><dd><p>default value: <code class="literal">false</code></p><p>type: Boolean</p><p>When a rule is activated where the <code class="code">auto-focus</code>
          value is true and the rule's agenda group does not have focus yet,
          then it is given focus, allowing the rule to potentially
          fire.</p></dd><dt><span class="term"><code class="literal">activation-group</code></span></dt><dd><p>default value: N/A</p><p>type: String</p><p>Rules that belong to the same activation-group, identified by
          this attribute's string value, will only fire exclusively. More
          precisely, the first rule in an activation-group to fire will
          cancel all pending activations of all rules in the group, i.e., stop
          them from firing.</p><p>Note: This used to be called Xor group, but technically it's
          not quite an Xor. You may still hear people mention Xor group; just
          swap that term in your mind with activation-group.</p></dd><dt><span class="term"><code class="literal">dialect</code></span></dt><dd><p>default value: as specified by the package</p><p>type: String</p><p>possible values: "java" or "mvel"</p><p>The dialect species the language to be used for any code
          expressions in the LHS or the RHS code block. Currently two dialects
          are available, Java and MVEL. While the dialect can be specified at
          the package level, this attribute allows the package definition to
          be overridden for a rule.</p></dd><dt><span class="term"><code class="literal">date-effective</code></span></dt><dd><p>default value: N/A</p><p>type: String, containing a date and time definition</p><p>A rule can only activate if the current date and time is after
          date-effective attribute.</p></dd><dt><span class="term"><code class="literal">date-expires</code></span></dt><dd><p>default value: N/A</p><p>type: String, containing a date and time definition</p><p>A rule cannot activate if the current date and time is after
          the date-expires attribute.</p></dd><dt><span class="term"><code class="literal">duration</code></span></dt><dd><p>default value: no default value</p><p>type: long</p><p>The duration dictates that the rule will fire after a
          specified duration, if it is still true.</p></dd></dl></div><div class="example"><a id="d0e9351"/><p class="title"><strong>Example 8.49. Some attribute examples</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "my rule"
  salience 42
  agenda-group "number 1"
    when ...</code></pre></div></div><br class="example-break"/></div><div class="section" title="8.8.2. Timers and Calendars"><div class="titlepage"><div><div><h3 class="title"><a id="d0e9356"/>8.8.2. Timers and Calendars</h3></div></div></div><p>Rules now support both interval and cron based timers, which replace
    the now deprecated duration attribute.</p><div class="example"><a id="d0e9361"/><p class="title"><strong>Example 8.50. Sample timer attribute uses</strong></p><div class="example-contents"><pre><code class="language-java">timer ( int: &lt;initial delay&gt; &lt;repeat interval&gt;? )
timer ( int: 30s )
timer ( int: 30s 5m )

timer ( cron: &lt;cron expression&gt; )
timer ( cron:* 0/15 * * * ? )</code></pre></div></div><br class="example-break"/><p>Interval (indicated by "int:") timers follow the semantics of
    java.util.Timer objects, with an initial delay and an optional repeat
    interval. Cron (indicated by "cron:") timers follow standard Unix cron
    expressions:</p><div class="example"><a id="d0e9368"/><p class="title"><strong>Example 8.51. A Cron Example</strong></p><div class="example-contents"><pre><code class="language-java">rule "Send SMS every 15 minutes"
    timer (cron:* 0/15 * * * ?)
when
    $a : Alarm( on == true )
then
    channels[ "sms" ].insert( new Sms( $a.mobileNumber, "The alarm is still on" );
end</code></pre></div></div><br class="example-break"/><p>A rule controlled by a timer becomes active when it matches, and
    once for each individual match. Its consequence is executed
    repeatedly, according to the timer's settings. This stops as soon
    as the condition doesn't match any more.</p><p>Consequences are executed even after control returns from a call
    to fireUntilHalt. Moreover, the Engine remains reactive to any
    changes made to the Working Memory. For instance, removing a fact
    that was involved in triggering the timer rule's execution causes
    the repeated execution to terminate, or inserting a fact so that
    some rule matches will cause that rule to fire. But the Engine is
    not continually active, only after a rule fires, for whatever
    reason. Thus, reactions to an insertion done asynchronously will
    not happen until the next execution of a timer-controlled rule.
    Disposing a session puts an end to all timer activity.</p><p>Conversely when the rule engine runs in passive mode (i.e.: using fireAllRules
    instead of fireUntilHalt) by default it doesn't fire consequences of timed rules
    unless fireAllRules isn't invoked again. However it is possible to change this
    default behavior by configuring the KieSession with a <code class="code">TimedRuleExectionOption</code>
    as shown in the following example.</p><div class="example"><a id="d0e9382"/><p class="title"><strong>Example 8.52. Configuring a KieSession to automatically execute timed rules</strong></p><div class="example-contents"><pre><code class="language-java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
ksconf.setOption( TimedRuleExectionOption.YES );
KSession ksession = kbase.newKieSession(ksconf, null);</code></pre></div></div><br class="example-break"/><p>It is also possible to have a finer grained control on the timed rules that have to be
    automatically executed. To do this it is necessary to set a <code class="code">FILTERED</code>
    <code class="code">TimedRuleExectionOption</code> that allows to define a callback to filter those
    rules, as done in the next example.</p><div class="example"><a id="d0e9395"/><p class="title"><strong>Example 8.53. Configuring a filter to choose which timed rules should be automatically executed</strong></p><div class="example-contents"><pre><code class="language-java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
conf.setOption( new TimedRuleExectionOption.FILTERED(new TimedRuleExecutionFilter() {
    public boolean accept(Rule[] rules) {
        return rules[0].getName().equals("MyRule");
    }
}) );</code></pre></div></div><br class="example-break"/><p>For what regards interval timers it is also possible to define both the delay
    and interval as an expression instead of a fixed value. To do that it is necessary to
    use an expression timer (indicated by "expr:") as in the following example:</p><div class="example"><a id="d0e9402"/><p class="title"><strong>Example 8.54. An Expression Timer Example</strong></p><div class="example-contents"><pre><code class="language-java">declare Bean
    delay   : String = "30s"
    period  : long = 60000
end

rule "Expression timer"
    timer( expr: $d, $p )
when
    Bean( $d : delay, $p : period )
then
end</code></pre></div></div><br class="example-break"/><p>The expressions, $d and $p in this case, can use any variable defined in the
    pattern matching part of the rule and can be any String that can be parsed in a time
    duration or any numeric value that will be internally converted in a long representing
    a duration expressed in milliseconds.</p><p>Both interval and expression timers can have 3 optional parameters named
    "start", "end" and "repeat-limit". When one or more of these parameters are used the first
    part of the timer definition must be followed by a semicolon ';' and the parameters have
    to be separated by a comma ',' as in the following example:</p><div class="example"><a id="d0e9411"/><p class="title"><strong>Example 8.55. An Interval Timer with a start and an end</strong></p><div class="example-contents"><pre><code class="language-java">timer (int: 30s 10s; start=3-JAN-2010, end=5-JAN-2010)</code></pre></div></div><br class="example-break"/><p>The value for start and end parameters can be a Date, a String representing
    a Date or a long, or more in general any Number, that will be transformed in a Java Date
    applying the following conversion:</p><pre><code class="language-java">new Date( ((Number) n).longValue() )</code></pre><p>Conversely the repeat-limit can be only an integer and it defines the maximum
    number of repetitions allowed by the timer. If both the end and the repeat-limit parameters
    are set the timer will stop when the first of the two will be matched.</p><p>The using of the start parameter implies the definition of a phase for the timer,
    where the beginning of the phase is given by the start itself plus the eventual delay.
    In other words in this case the timed rule will then be scheduled at times:</p><pre><code class="language-java">start + delay + n*period</code></pre><p>for up to repeat-limit times and no later than the end timestamp (whichever first).
    For instance the rule having the following interval timer</p><pre><code class="language-java">timer ( int: 30s 1m; start="3-JAN-2010" )</code></pre><p>will be scheduled at the 30th second of every minute after the midnight of the
    3-JAN-2010. This also means that if for example you turn the system on at midnight of
    the 3-FEB-2010 it won't be scheduled immediately but will preserve the phase defined by
    the timer and so it will be scheduled for the first time 30 seconds after the midnight.
    If for some reason the system is paused (e.g. the session is serialized and then deserialized
    after a while) the rule will be scheduled only once to recover from missing activations
    (regardless of how many activations we missed) and subsequently it will be scheduled
    again in phase with the timer.</p><p>Calendars are used to control when rules can fire. The Calendar API
    is modelled on <a class="link" href="http://www.quartz-scheduler.org/">Quartz</a>:</p><div class="example"><a id="d0e9437"/><p class="title"><strong>Example 8.56. Adapting a Quartz Calendar</strong></p><div class="example-contents"><pre><code class="language-java">Calendar weekDayCal = QuartzHelper.quartzCalendarAdapter(org.quartz.Calendar quartzCal)</code></pre></div></div><br class="example-break"/><p>Calendars are registered with the KieSession:</p><div class="example"><a id="d0e9444"/><p class="title"><strong>Example 8.57. Registering a Calendar</strong></p><div class="example-contents"><pre><code class="language-java">ksession.getCalendars().set( "weekday", weekDayCal );</code></pre></div></div><br class="example-break"/><p>They can be used in conjunction with normal rules and rules
    including timers. The rule attribute "calendars" may contain one or more
    comma-separated calendar names written as string literals.</p><div class="example"><a id="d0e9451"/><p class="title"><strong>Example 8.58. Using Calendars and Timers together</strong></p><div class="example-contents"><pre><code class="language-java">rule "weekdays are high priority"
   calendars "weekday"
   timer (int:0 1h)
when 
    Alarm()
then
    send( "priority high - we have an alarm" );
end 

rule "weekend are low priority"
   calendars "weekend"
   timer (int:0 4h)
when 
    Alarm()
then
    send( "priority low - we have an alarm" );
end</code></pre></div></div><br class="example-break"/></div><div class="section" title="8.8.3. Left Hand Side (when) syntax"><div class="titlepage"><div><div><h3 class="title"><a id="d0e9456"/>8.8.3. Left Hand Side (when) syntax</h3></div></div></div><div class="section" title="8.8.3.1. What is the Left Hand Side?"><div class="titlepage"><div><div><h4 class="title"><a id="d0e9459"/>8.8.3.1. What is the Left Hand Side?</h4></div></div></div><p>The Left Hand Side (LHS) is a common name for the conditional part
      of the rule. It consists of zero or more Conditional Elements. If the
      LHS is empty, it will be considered as a condition element that is
      always true and it will be activated once, when a new WorkingMemory
      session is created.</p><div class="figure"><a id="d0e9464"/><p class="title"><strong>Figure 8.11. Left Hand Side</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/lhs.png" align="middle" alt="Left Hand Side"/></div></div></div><br class="figure-break"/><div class="example"><a id="d0e9470"/><p class="title"><strong>Example 8.59. Rule without a Conditional Element</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "no CEs"
when
    // empty
then
    ... // actions (executed once)
end

// The above rule is internally rewritten as:

rule "eval(true)"
when
    eval( true )
then
    ... // actions (executed once)
end</code></pre></div></div><br class="example-break"/><p>Conditional elements work on one or more
      <span class="emphasis"><em>patterns</em></span> (which are described below). The most
      common conditional element is "<code class="literal">and"</code>. Therefore it is
      implicit when you have multiple patterns in the LHS of a rule that are
      not connected in any way:</p><div class="example"><a id="d0e9483"/><p class="title"><strong>Example 8.60. Implicit and</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "2 unconnected patterns"
when
    Pattern1()
    Pattern2()
then
    ... // actions
end

// The above rule is internally rewritten as:

rule "2 and connected patterns"
when
    Pattern1()
    and Pattern2()
then
    ... // actions
end</code></pre></div></div><br class="example-break"/><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>An "<code class="literal">and"</code> cannot have a leading declaration
        binding (unlike for example <code class="literal">or</code>). This is obvious,
        since a declaration can only reference a single fact at a time, and
        when the "<code class="literal">and"</code> is satisfied it matches both facts -
        so which fact would the declaration bind to?</p><pre><code class="no-highlight">// Compile error
$person : (Person( name == "Romeo" ) and Person( name == "Juliet"))</code></pre></div></div><div class="section" title="8.8.3.2. Pattern (conditional element)"><div class="titlepage"><div><div><h4 class="title"><a id="d0e9502"/>8.8.3.2. Pattern (conditional element)</h4></div></div></div><div class="section" title="8.8.3.2.1. What is a pattern?"><div class="titlepage"><div><div><h5 class="title"><a id="d0e9505"/>8.8.3.2.1. What is a pattern?</h5></div></div></div><p>A pattern element is the most important Conditional Element. It
        can potentially match on each fact that is inserted in the working
        memory.</p><p>A pattern contains of zero or more constraints and has an
        optional pattern binding. The railroad diagram below shows the syntax
        for this.</p><div class="figure"><a id="d0e9512"/><p class="title"><strong>Figure 8.12. Pattern</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/pattern.png" align="middle" alt="Pattern"/></div></div></div><br class="figure-break"/><p>In its simplest form, with no constraints, a pattern matches
        against a fact of the given type. In the following case the type is
        <code class="code">Cheese</code>, which means that the pattern will match against
        all <code class="code">Person</code> objects in the Working Memory:</p><pre><code class="no-highlight">Person()</code></pre><p>The type need not be the actual class of some fact object.
        Patterns may refer to superclasses or even interfaces, thereby
        potentially matching facts from many different classes.</p><pre><code class="no-highlight">Object() // matches all objects in the working memory</code></pre><p>Inside of the pattern parenthesis is where all the action
        happens: it defines the constraints for that pattern. For example,
        with a age related constraint:</p><pre><code class="no-highlight">Person( age == 100 )</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>For backwards compatibility reasons it's allowed to suffix
          patterns with the <code class="literal">;</code> character. But it is not
          recommended to do that.</p></div></div><div class="section" title="8.8.3.2.2. Pattern binding"><div class="titlepage"><div><div><h5 class="title"><a id="d0e9542"/>8.8.3.2.2. Pattern binding</h5></div></div></div><p>For referring to the matched object, use a pattern binding
        variable such as <code class="code">$p</code>.</p><div class="example"><a id="d0e9550"/><p class="title"><strong>Example 8.61. Pattern with a binding variable</strong></p><div class="example-contents"><pre><code class="no-highlight">rule ...
when
    $p : Person()
then
    System.out.println( "Person " + $p );
end</code></pre></div></div><br class="example-break"/><p>The prefixed dollar symbol (<code class="literal">$</code>) is just a
        convention; it can be useful in complex rules where it helps to easily
        differentiate between variables and fields, but it is not
        mandatory.</p></div></div><div class="section" title="8.8.3.3. Constraint (part of a pattern)"><div class="titlepage"><div><div><h4 class="title"><a id="d0e9560"/>8.8.3.3. Constraint (part of a pattern)</h4></div></div></div><div class="section" title="8.8.3.3.1. What is a constraint?"><div class="titlepage"><div><div><h5 class="title"><a id="d0e9563"/>8.8.3.3.1. What is a constraint?</h5></div></div></div><p>A constraint is an expression that returns
        <code class="literal">true</code> or <code class="literal">false</code>. This example has
        a constraint that states <span class="emphasis"><em>5 is smaller than
        6</em></span>:</p><pre><code class="no-highlight">Person( 5 &lt; 6 )  // just an example, as constraints like this would be useless in a real pattern</code></pre><p>In essence, it's a Java expression with some enhancements (such
        as property access) and a few differences (such as
        <code class="literal">equals()</code> semantics for <code class="literal">==</code>).
        Let's take a deeper look.</p></div><div class="section" title="8.8.3.3.2. Property access on Java Beans (POJO's)"><div class="titlepage"><div><div><h5 class="title"><a id="d0e9587"/>8.8.3.3.2. Property access on Java Beans (POJO's)</h5></div></div></div><p>Any bean property can be used directly. A bean property is
        exposed using a standard Java bean getter: a method
        <code class="literal">getMyProperty()</code> (or
        <code class="literal">isMyProperty()</code> for a primitive boolean) which takes
        no arguments and return something. For example: the age property is
        written as <code class="literal">age</code> in DRL instead of the getter
        <code class="literal">getAge()</code>:</p><pre><code class="no-highlight">Person( age == 50 )

// this is the same as:
Person( getAge() == 50 )</code></pre><p>Drools uses the standard JDK <code class="literal">Introspector</code>
        class to do this mapping, so it follows the standard Java bean
        specification.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>We recommend using property access (<code class="literal">age</code>)
          over using getters explicitly (<code class="literal">getAge()</code>) because
          of performance enhancements through field indexing.</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>Property accessors must not change the state of the object in
          a way that may effect the rules. Remember that the rule engine
          effectively caches the results of its matching in between
          invocations to make it faster.</p><pre><code class="no-highlight">public int getAge() {
    age++; // Do NOT do this
    return age;
}</code></pre><pre><code class="no-highlight">public int getAge() {
    Date now = DateUtil.now(); // Do NOT do this
    return DateUtil.differenceInYears(now, birthday);
}</code></pre><p>To solve this latter case, insert a fact that wraps the
          current date into working memory and update that fact between
          <code class="literal">fireAllRules</code> as needed.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The following fallback applies: if the getter of a property
          cannot be found, the compiler will resort to using the property name
          as a method name and without arguments:</p><pre><code class="no-highlight">Person( age == 50 )

// If Person.getAge() does not exists, this falls back to:
Person( age() == 50 )</code></pre></div><p>Nested property access is also supported:</p><pre><code class="no-highlight">Person( address.houseNumber == 50 )

// this is the same as:
Person( getAddress().getHouseNumber() == 50 )</code></pre><p>Nested properties are also indexed.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>In a stateful session, care should be taken when using nested
          accessors as the Working Memory is not aware of any of the nested
          values, and does not know when they change. Either consider them
          immutable while any of their parent references are inserted into the
          Working Memory. Or, instead, if you wish to modify a nested value
          you should mark all of the outer facts as updated. In the above
          example, when the <code class="literal">houseNumber</code> changes, any
          <code class="literal">Person</code> with that <code class="literal">Address</code> must
          be marked as updated.</p></div></div><div class="section" title="8.8.3.3.3. Java expression"><div class="titlepage"><div><div><h5 class="title"><a id="d0e9655"/>8.8.3.3.3. Java expression</h5></div></div></div><p>You can use any Java expression that returns a
        <code class="literal">boolean</code> as a constraint inside the parentheses of a
        pattern. Java expressions can be mixed with other expression
        enhancements, such as property access:</p><pre><code class="no-highlight">Person( age == 50 )</code></pre><p>It is possible to change the evaluation priority by using
        parentheses, as in any logic or mathematical expression:</p><pre><code class="no-highlight">Person( age &gt; 100 &amp;&amp; ( age % 10 == 0 ) )</code></pre><p>It is possible to reuse Java methods:</p><pre><code class="no-highlight">Person( Math.round( weight / ( height * height ) ) &lt; 25.0 )</code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>As for property accessors, methods must not change the state
          of the object in a way that may affect the rules. Any method
          executed on a fact in the LHS should be a <span class="emphasis"><em>read
          only</em></span> method.</p><pre><code class="no-highlight">Person( incrementAndGetAge() == 10 ) // Do NOT do this</code></pre></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>The state of a fact should not change between rule invocations
          (unless those facts are marked as updated to the working memory on
          every change):</p><pre><code class="no-highlight">Person( System.currentTimeMillis() % 1000 == 0 ) // Do NOT do this</code></pre></div><p>Normal Java operator precedence applies, see the operator
        precedence list below.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>All operators have normal Java semantics except for
          <code class="literal">==</code> and <code class="literal">!=</code>.</p><p>The <code class="literal">==</code> operator has null-safe
          <code class="literal">equals()</code> semantics:</p><pre><code class="no-highlight">// Similar to: java.util.Objects.equals(person.getFirstName(), "John")
// so (because "John" is not null) similar to:
// "John".equals(person.getFirstName())
Person( firstName == "John" )</code></pre><p>The <code class="literal">!=</code> operator has null-safe
          <code class="literal">!equals()</code> semantics:</p><pre><code class="no-highlight">// Similar to: !java.util.Objects.equals(person.getFirstName(), "John")
Person( firstName != "John" )</code></pre></div><p>Type coercion is always attempted if the field and the value are
        of different types; exceptions will be thrown if a bad coercion is
        attempted. For instance, if "ten" is provided as a string in a numeric
        evaluator, an exception is thrown, whereas "10" would coerce to a
        numeric 10. Coercion is always in favor of the field type and not the
        value type:</p><pre><code class="no-highlight">Person( age == "10" ) // "10" is coerced to 10</code></pre></div><div class="section" title="8.8.3.3.4. Comma separated AND"><div class="titlepage"><div><div><h5 class="title"><a id="d0e9721"/>8.8.3.3.4. Comma separated AND</h5></div></div></div><p>The comma character ('<code class="literal">,</code>') is used to separate
        constraint groups. It has implicit <span class="emphasis"><em>AND</em></span> connective
        semantics.</p><pre><code class="no-highlight">// Person is at least 50 and weighs at least 80 kg
Person( age &gt; 50, weight &gt; 80 )</code></pre><pre><code class="no-highlight">// Person is at least 50, weighs at least 80 kg and is taller than 2 meter.
Person( age &gt; 50, weight &gt; 80, height &gt; 2 )</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Although the <code class="literal">&amp;&amp;</code> and
          <code class="literal">,</code> operators have the same semantics, they are
          resolved with different priorities: The
          <code class="literal">&amp;&amp;</code> operator precedes the
          <code class="literal">||</code> operator. Both the
          <code class="literal">&amp;&amp;</code> and <code class="literal">||</code> operator
          precede the <code class="literal">,</code> operator. See the operator
          precedence list below.</p><p>The comma operator should be preferred at the top level
          constraint, as it makes constraints easier to read and the engine
          will often be able to optimize them better.</p></div><p>The comma (<code class="literal">,</code>) operator cannot be embedded in
        a composite constraint expression, such as parentheses:</p><pre><code class="no-highlight">Person( ( age &gt; 50, weight &gt; 80 ) || height &gt; 2 ) // Do NOT do this: compile error

// Use this instead
Person( ( age &gt; 50 &amp;&amp; weight &gt; 80 ) || height &gt; 2 )</code></pre></div><div class="section" title="8.8.3.3.5. Binding variables"><div class="titlepage"><div><div><h5 class="title"><a id="d0e9769"/>8.8.3.3.5. Binding variables</h5></div></div></div><p>A property can be bound to a variable:</p><pre><code class="no-highlight">// 2 persons of the same age
Person( $firstAge : age ) // binding
Person( age == $firstAge ) // constraint expression</code></pre><p>The prefixed dollar symbol (<code class="literal">$</code>) is just a
        convention; it can be useful in complex rules where it helps to easily
        differentiate between variables and fields.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>For backwards compatibility reasons, It's allowed (but not
          recommended) to mix a constraint binding and constraint expressions
          as such:</p><pre><code class="no-highlight">// Not recommended
Person( $age : age * 2 &lt; 100 )</code></pre><pre><code class="no-highlight">// Recommended (separates bindings and constraint expressions)
Person( age * 2 &lt; 100, $age : age )</code></pre></div><p>Bound variable restrictions using the operator
        <code class="literal">==</code> provide for very fast execution as it use hash
        indexing to improve performance.</p></div><div class="section" title="8.8.3.3.6. Unification"><div class="titlepage"><div><div><h5 class="title"><a id="d0e9793"/>8.8.3.3.6. Unification</h5></div></div></div><p>Drools does not allow bindings to the same declaration. However
        this is an important aspect to derivation query unification. While
        positional arguments are always processed with unification a special
        unification symbol, ':=', was introduced for named arguments named
        arguments. The following "unifies" the age argument across two
        people.</p><pre><code class="no-highlight">Person( $age := age ) 
Person( $age := age) </code></pre><p>In essence unification will declare a binding for the first
        occurrence and constrain to the same value of the bound field for
        sequence occurrences.</p></div><div class="section" title="8.8.3.3.7. Grouped accessors for nested objects"><div class="titlepage"><div><div><h5 class="title"><a id="d0e9802"/>8.8.3.3.7. Grouped accessors for nested objects</h5></div></div></div><p>Often it happens that it is necessary to access multiple properties
        of a nested object as in the following example</p><pre><code class="no-highlight">Person( name == "mark", address.city == "london", address.country == "uk" )</code></pre><p>These accessors to nested objects can be grouped with a '.(...)'
        syntax providing more readable rules as in</p><pre><code class="no-highlight">Person( name == "mark", address.( city == "london", country == "uk") )</code></pre><p>Note the '.' prefix, this is necessary to differentiate the nested
        object constraints from a method call.</p></div><div class="section" title="8.8.3.3.8. Inline casts and coercion"><div class="titlepage"><div><div><h5 class="title"><a id="d0e9815"/>8.8.3.3.8. Inline casts and coercion</h5></div></div></div><p>When dealing with nested objects, it also quite common the need to
        cast to a subtype. It is possible to do that via the # symbol as in:</p><pre><code class="no-highlight">Person( name == "mark", address#LongAddress.country == "uk" )</code></pre><p>This example casts Address to LongAddress, making its getters available.
        If the cast is not possible (instanceof returns false), the evaluation will
        be considered false. Also fully qualified names are supported:</p><pre><code class="no-highlight">Person( name == "mark", address#org.domain.LongAddress.country == "uk" )</code></pre><p>It is possible to use multiple inline casts in the same expression:</p><pre><code class="no-highlight">Person( name == "mark", address#LongAddress.country#DetailedCountry.population &gt; 10000000 )</code></pre><p>moreover, since we also support the instanceof operator, if that is used
        we will infer its results for further uses of that field, within that pattern:</p><pre><code class="no-highlight">Person( name == "mark", address instanceof LongAddress, address.country == "uk" )</code></pre></div><div class="section" title="8.8.3.3.9. Special literal support"><div class="titlepage"><div><div><h5 class="title"><a id="d0e9834"/>8.8.3.3.9. Special literal support</h5></div></div></div><p>Besides normal Java literals (including Java 5 enums), this
        literal is also supported:</p><div class="section" title="8.8.3.3.9.1. Date literal"><div class="titlepage"><div><div><h6 class="title"><a id="d0e9839"/>8.8.3.3.9.1. Date literal</h6></div></div></div><p>The date format <code class="literal">dd-mmm-yyyy</code> is supported by
          default. You can customize this by providing an alternative date
          format mask as the System property named
          <code class="code">drools.dateformat</code>. If more control is required, use a
          restriction.</p><div class="example"><a id="d0e9850"/><p class="title"><strong>Example 8.62. Date Literal Restriction</strong></p><div class="example-contents"><pre><code class="no-highlight">Cheese( bestBefore &lt; "27-Oct-2009" )</code></pre></div></div><br class="example-break"/></div></div><div class="section" title="8.8.3.3.10. List and Map access"><div class="titlepage"><div><div><h5 class="title"><a id="d0e9855"/>8.8.3.3.10. List and Map access</h5></div></div></div><p>It's possible to directly access a <code class="literal">List</code> value
        by index:</p><pre><code class="no-highlight">// Same as childList(0).getAge() == 18
Person( childList[0].age == 18 )</code></pre><p>It's also possible to directly access a <code class="literal">Map</code>
        value by key:</p><pre><code class="no-highlight">// Same as credentialMap.get("jsmith").isValid()
Person( credentialMap["jsmith"].valid )</code></pre></div><div class="section" title="8.8.3.3.11. Abbreviated combined relation condition"><div class="titlepage"><div><div><h5 class="title"><a id="d0e9872"/>8.8.3.3.11. Abbreviated combined relation condition</h5></div></div></div><p>This allows you to place more than one restriction on a field
        using the restriction connectives <code class="literal">&amp;&amp;</code> or
        <code class="literal">||</code>. Grouping via parentheses is permitted,
        resulting in a recursive syntax pattern.</p><div class="figure"><a id="d0e9883"/><p class="title"><strong>Figure 8.13. Abbreviated combined relation condition</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/abbreviatedCombinedRelationCondition.png" align="middle" alt="Abbreviated combined relation condition"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e9889"/><p class="title"><strong>Figure 8.14. Abbreviated combined relation condition with
          parentheses</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/abbreviatedCombinedRelationConditionGroup.png" align="middle" alt="Abbreviated combined relation condition with parentheses"/></div></div></div><br class="figure-break"/><pre><code class="no-highlight">// Simple abbreviated combined relation condition using a single &amp;&amp;
Person( age &gt; 30 &amp;&amp; &lt; 40 )</code></pre><pre><code class="no-highlight">// Complex abbreviated combined relation using groupings
Person( age ( (&gt; 30 &amp;&amp; &lt; 40) ||
              (&gt; 20 &amp;&amp; &lt; 25) ) )</code></pre><pre><code class="no-highlight">// Mixing abbreviated combined relation with constraint connectives
Person( age &gt; 30 &amp;&amp; &lt; 40 || location == "london" )</code></pre></div><div class="section" title="8.8.3.3.12. Special DRL operators"><div class="titlepage"><div><div><h5 class="title"><a id="d0e9901"/>8.8.3.3.12. Special DRL operators</h5></div></div></div><div class="figure"><a id="d0e9904"/><p class="title"><strong>Figure 8.15. Operators</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/operator.png" align="middle" alt="Operators"/></div></div></div><br class="figure-break"/><p>Coercion to the correct value for the evaluator and the field
        will be attempted.</p><div class="section" title="8.8.3.3.12.1. The operators &lt; &lt;= &gt; &gt;="><div class="titlepage"><div><div><h6 class="title"><a id="d0e9912"/>8.8.3.3.12.1. The operators <code class="literal">&lt;</code>
          <code class="literal">&lt;=</code> <code class="literal">&gt;</code>
          <code class="literal">&gt;=</code></h6></div></div></div><p>These operators can be used on properties with natural
          ordering. For example, for Date fields, <code class="literal">&lt;</code>
          means <span class="emphasis"><em>before</em></span>, for <code class="literal">String</code>
          fields, it means alphabetically lower.</p><pre><code class="no-highlight">Person( firstName &lt; $otherFirstName )</code></pre><pre><code class="no-highlight">Person( birthDate &lt; $otherBirthDate )</code></pre><p>Only applies on <code class="literal">Comparable</code>
          properties.</p></div><div class="section" title="8.8.3.3.12.2. Null-safe dereferencing operator"><div class="titlepage"><div><div><h6 class="title"><a id="d0e9946"/>8.8.3.3.12.2. Null-safe dereferencing operator</h6></div></div></div><p>The !. operator allows to derefencing in a null-safe way.
          More in details the matching algorithm requires the value to the left
          of the !. operator to be not null in order to give a positive result
          for pattern matching itself. In other words the pattern:</p><pre><code class="no-highlight">Person( $streetName : address!.street )</code></pre><p>will be internally translated in:</p><pre><code class="no-highlight">Person( address != null, $streetName : address.street )</code></pre></div><div class="section" title="8.8.3.3.12.3. The operator matches"><div class="titlepage"><div><div><h6 class="title"><a id="d0e9957"/>8.8.3.3.12.3. The operator <code class="literal">matches</code></h6></div></div></div><p>Matches a field against any valid Java <a id="d0e9964" class="indexterm"/>Regular Expression. Typically that regexp is a string
          literal, but variables that resolve to a valid regexp are also
          allowed.</p><div class="example"><a id="d0e9968"/><p class="title"><strong>Example 8.63. Regular Expression Constraint</strong></p><div class="example-contents"><pre><code class="no-highlight">Cheese( type matches "(Buffalo)?\\S*Mozarella" )</code></pre></div></div><br class="example-break"/><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Like in Java, regular expressions written as string literals
            <span class="emphasis"><em>need to escape '<code class="literal">\</code></em></span>'.</p></div><p>Only applies on <code class="literal">String</code> properties.
          Using <code class="literal">matches</code> against a <code class="literal">null</code> value
          always evaluates to false.</p></div><div class="section" title="8.8.3.3.12.4. The operator not matches"><div class="titlepage"><div><div><h6 class="title"><a id="d0e9992"/>8.8.3.3.12.4. The operator <code class="literal">not matches</code></h6></div></div></div><p>The operator returns true if the String does not match the
          regular expression. The same rules apply as for the
          <code class="literal">matches</code> operator. Example:</p><div class="example"><a id="d0e10002"/><p class="title"><strong>Example 8.64. Regular Expression Constraint</strong></p><div class="example-contents"><pre><code class="no-highlight">Cheese( type not matches "(Buffulo)?\\S*Mozarella" )</code></pre></div></div><br class="example-break"/><p>Only applies on <code class="literal">String</code> properties.
          Using <code class="literal">not matches</code> against a <code class="literal">null</code> value
          always evaluates to true.</p></div><div class="section" title="8.8.3.3.12.5. The operator contains"><div class="titlepage"><div><div><h6 class="title"><a id="d0e10018"/>8.8.3.3.12.5. The operator <code class="literal">contains</code></h6></div></div></div><p>The operator <code class="literal">contains</code> is used to check
          whether a field that is a <a id="d0e10028" class="indexterm"/>Collection or elements contains the specified
          value.</p><div class="example"><a id="d0e10032"/><p class="title"><strong>Example 8.65. Contains with Collections</strong></p><div class="example-contents"><pre><code class="no-highlight">CheeseCounter( cheeses contains "stilton" ) // contains with a String literal
CheeseCounter( cheeses contains $var ) // contains with a variable</code></pre></div></div><br class="example-break"/><p>Only applies on <code class="literal">Collection</code>
          properties.</p><p>The operator <code class="literal">contains</code> can also be used in place of <code class="literal">String.contains()</code>
          constraints checks.</p><div class="example"><a id="d0e10050"/><p class="title"><strong>Example 8.66. Contains with String literals</strong></p><div class="example-contents"><pre><code class="no-highlight">Cheese( name contains "tilto" )
Person( fullName contains "Jr" )
String( this contains "foo" )</code></pre></div></div><br class="example-break"/></div><div class="section" title="8.8.3.3.12.6. The operator not contains"><div class="titlepage"><div><div><h6 class="title"><a id="d0e10055"/>8.8.3.3.12.6. The operator <code class="literal">not contains</code></h6></div></div></div><p>The operator <code class="literal">not contains</code> is used to check
          whether a field that is a <a id="d0e10065" class="indexterm"/>Collection or elements does <span class="emphasis"><em>not</em></span>
          contain the specified value.</p><div class="example"><a id="d0e10072"/><p class="title"><strong>Example 8.67. Literal Constraint with Collections</strong></p><div class="example-contents"><pre><code class="no-highlight">CheeseCounter( cheeses not contains "cheddar" ) // not contains with a String literal
CheeseCounter( cheeses not contains $var ) // not contains with a variable</code></pre></div></div><br class="example-break"/><p>Only applies on <code class="literal">Collection</code>
          properties.</p><div class="blockquote"><blockquote class="blockquote"><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>For backward compatibility, the
              <code class="literal">excludes</code> operator is supported as a synonym
              for <code class="literal">not contains</code>.</p></div></blockquote></div><p>The operator <code class="literal">not contains</code> can also be used in place of the logical negation of <code class="literal">String.contains()</code>
          for constraints checks - i.e.: <code class="literal">! String.contains()</code></p><div class="example"><a id="d0e10102"/><p class="title"><strong>Example 8.68. Contains with String literals</strong></p><div class="example-contents"><pre><code class="no-highlight">Cheese( name not contains "tilto" )
Person( fullName not contains "Jr" )
String( this not contains "foo" )</code></pre></div></div><br class="example-break"/></div><div class="section" title="8.8.3.3.12.7. The operator memberOf"><div class="titlepage"><div><div><h6 class="title"><a id="d0e10107"/>8.8.3.3.12.7. The operator <code class="literal">memberOf</code></h6></div></div></div><p>The operator <code class="literal">memberOf</code> is used to check
          whether a field is a member of a collection or elements; that
          collection must be a variable.</p><div class="example"><a id="d0e10117"/><p class="title"><strong>Example 8.69. Literal Constraint with Collections</strong></p><div class="example-contents"><pre><code class="no-highlight">CheeseCounter( cheese memberOf $matureCheeses )</code></pre></div></div><br class="example-break"/></div><div class="section" title="8.8.3.3.12.8. The operator not memberOf"><div class="titlepage"><div><div><h6 class="title"><a id="d0e10122"/>8.8.3.3.12.8. The operator <code class="literal">not memberOf</code></h6></div></div></div><p>The operator <code class="literal">not memberOf</code> is used to check
          whether a field is not a member of a collection or elements; that
          collection must be a variable.</p><div class="example"><a id="d0e10132"/><p class="title"><strong>Example 8.70. Literal Constraint with Collections</strong></p><div class="example-contents"><pre><code class="no-highlight">CheeseCounter( cheese not memberOf $matureCheeses )</code></pre></div></div><br class="example-break"/></div><div class="section" title="8.8.3.3.12.9. The operator soundslike"><div class="titlepage"><div><div><h6 class="title"><a id="d0e10137"/>8.8.3.3.12.9. The operator <code class="literal">soundslike</code></h6></div></div></div><p>This operator is similar to <code class="literal">matches</code>, but it
          checks whether a word has almost the same sound (using English
          pronunciation) as the given value. This is based on the Soundex
          algorithm (see
          <code class="code">http://en.wikipedia.org/wiki/Soundex</code>).</p><div class="example"><a id="d0e10150"/><p class="title"><strong>Example 8.71. Test with soundslike</strong></p><div class="example-contents"><pre><code class="no-highlight">// match cheese "fubar" or "foobar"
Cheese( name soundslike 'foobar' )</code></pre></div></div><br class="example-break"/></div><div class="section" title="8.8.3.3.12.10. The operator str"><div class="titlepage"><div><div><h6 class="title"><a id="d0e10155"/>8.8.3.3.12.10. The operator <code class="literal">str</code></h6></div></div></div><p>This operator <code class="literal">str</code> is used to check whether
          a field that is a <code class="literal">String</code> starts with or ends with
          a certain value. It can also be used to check the length of the
          String.</p><pre><code class="no-highlight">Message( routingValue str[startsWith] "R1" )</code></pre><pre><code class="no-highlight">Message( routingValue str[endsWith] "R2" )</code></pre><pre><code class="no-highlight">Message( routingValue str[length] 17 )</code></pre></div><div class="section" title="8.8.3.3.12.11. The operators in and not in (compound value restriction)"><div class="titlepage"><div><div><h6 class="title"><a id="d0e10174"/>8.8.3.3.12.11. The operators <code class="literal">in</code> and <code class="literal">not
          in</code> (compound value restriction)</h6></div></div></div><p>The compound value restriction is used where there is more
          than one possible value to match. Currently only the
          <code class="literal">in</code> and <code class="literal">not in</code> evaluators
          support this. The second operand of this operator must be a
          comma-separated list of values, enclosed in parentheses. Values may
          be given as variables, literals, return values or qualified
          identifiers. Both evaluators are actually <span class="emphasis"><em>syntactic
          sugar</em></span>, internally rewritten as a list of multiple
          restrictions using the operators <code class="literal">!=</code> and
          <code class="literal">==</code>.</p><div class="figure"><a id="d0e10200"/><p class="title"><strong>Figure 8.16. compoundValueRestriction</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/compoundValueRestriction.png" align="middle" alt="compoundValueRestriction"/></div></div></div><br class="figure-break"/><div class="example"><a id="d0e10206"/><p class="title"><strong>Example 8.72. Compound Restriction using "in"</strong></p><div class="example-contents"><pre><code class="no-highlight">Person( $cheese : favouriteCheese )
Cheese( type in ( "stilton", "cheddar", $cheese ) )</code></pre></div></div><br class="example-break"/></div></div><div class="section" title="8.8.3.3.13. Inline eval operator (deprecated)"><div class="titlepage"><div><div><h5 class="title"><a id="d0e10211"/>8.8.3.3.13. Inline eval operator (deprecated)</h5></div></div></div><div class="figure"><a id="d0e10214"/><p class="title"><strong>Figure 8.17. Inline Eval Expression</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/inlineEvalConstraint.png" align="middle" alt="Inline Eval Expression"/></div></div></div><br class="figure-break"/><p>An <a id="d0e10222" class="indexterm"/>inline eval constraint can use any valid dialect
        expression as long as it results to a primitive boolean. The
        expression must be constant over time. Any previously bound variable,
        from the current or previous pattern, can be used; autovivification is
        also used to auto-create field binding variables. When an identifier
        is found that is not a current variable, the builder looks to see if
        the identifier is a field on the current object type, if it is, the
        field binding is auto-created as a variable of the same name. This is
        called autovivification of field variables inside of inline
        eval's.</p><p>This example will find all male-female pairs where the male is 2
        years older than the female; the variable <code class="code">age</code> is
        auto-created in the second pattern by the autovivification
        process.</p><div class="example"><a id="d0e10231"/><p class="title"><strong>Example 8.73. Return Value operator</strong></p><div class="example-contents"><pre><code class="no-highlight">Person( girlAge : age, sex = "F" )
Person( eval( age == girlAge + 2 ), sex = 'M' ) // eval() is actually obsolete in this example</code></pre></div></div><br class="example-break"/><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Inline eval's are effectively obsolete as their inner syntax
          is now directly supported. It's recommended not to use them. Simply
          write the expression without wrapping eval() around it.</p></div></div><div class="section" title="8.8.3.3.14. Operator precedence"><div class="titlepage"><div><div><h5 class="title"><a id="d0e10239"/>8.8.3.3.14. Operator precedence</h5></div></div></div><p>The operators are evaluated in this precedence:</p><div class="table"><a id="d0e10244"/><p class="title"><strong>Table 8.1. Operator precedence</strong></p><div class="table-contents"><table summary="Operator precedence" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">Operator type</th><th align="center">Operators</th><th align="center">Notes</th></tr></thead><tbody><tr><td>(nested / null safe) property access</td><td><code class="literal">.</code> <code class="literal">!.</code></td><td>Not normal Java semantics</td></tr><tr><td>List/Map access</td><td><code class="literal">[ ]</code></td><td>Not normal Java semantics</td></tr><tr><td>constraint binding</td><td><code class="literal">:</code></td><td>Not normal Java semantics</td></tr><tr><td>multiplicative</td><td><code class="literal">*</code> <code class="literal">/</code>
                <code class="literal">%</code></td><td> </td></tr><tr><td>additive</td><td><code class="literal">+</code> <code class="literal">-</code></td><td> </td></tr><tr><td>shift</td><td><code class="literal">&lt;&lt;</code> <code class="literal">&gt;&gt;</code>
                <code class="literal">&gt;&gt;&gt;</code></td><td> </td></tr><tr><td>relational</td><td><code class="literal">&lt;</code> <code class="literal">&gt;</code>
                <code class="literal">&lt;=</code> <code class="literal">&gt;=</code>
                <code class="literal">instanceof</code></td><td> </td></tr><tr><td>equality</td><td><code class="literal">==</code> <code class="literal">!=</code></td><td>Does not use normal Java (<span class="emphasis"><em>not</em></span>)
                <span class="emphasis"><em>same</em></span> semantics: uses
                (<span class="emphasis"><em>not</em></span>) <span class="emphasis"><em>equals</em></span>
                semantics instead.</td></tr><tr><td>non-short circuiting AND</td><td><code class="literal">&amp;</code></td><td> </td></tr><tr><td>non-short circuiting exclusive OR</td><td><code class="literal">^</code></td><td> </td></tr><tr><td>non-short circuiting inclusive OR</td><td><code class="literal">|</code></td><td> </td></tr><tr><td>logical AND</td><td><code class="literal">&amp;&amp;</code></td><td> </td></tr><tr><td>logical OR</td><td><code class="literal">||</code></td><td> </td></tr><tr><td>ternary</td><td><code class="literal">? :</code></td><td> </td></tr><tr><td>Comma separated AND</td><td><code class="literal">,</code></td><td>Not normal Java semantics</td></tr></tbody></table></div></div><br class="table-break"/></div></div><div class="section" title="8.8.3.4. Positional Arguments"><div class="titlepage"><div><div><h4 class="title"><a id="d0e10412"/>8.8.3.4. Positional Arguments</h4></div></div></div><p>Patterns now support positional arguments on type
      declarations.</p><p>Positional arguments are ones where you don't need to specify the
      field name, as the position maps to a known named field. i.e. Person(
      name == "mark" ) can be rewritten as Person( "mark"; ). The semicolon
      ';' is important so that the engine knows that everything before it is a
      positional argument. Otherwise we might assume it was a boolean
      expression, which is how it could be interpreted after the semicolon.
      You can mix positional and named arguments on a pattern by using the
      semicolon ';' to separate them. Any variables used in a positional that
      have not yet been bound will be bound to the field that maps to that
      position.</p><pre><code class="no-highlight">declare Cheese
    name : String
    shop : String
    price : int
end
</code></pre><p>Example patterns, with two constraints and a binding. Remember
      semicolon ';' is used to differentiate the positional section from the
      named argument section. Variables and literals and expressions using
      just literals are supported in positional arguments, but not variables.
      Positional arguments are always resolved using unification.</p><pre><code class="no-highlight">Cheese( "stilton", "Cheese Shop", p; )
Cheese( "stilton", "Cheese Shop"; p : price )
Cheese( "stilton"; shop == "Cheese Shop", p : price )
Cheese( name == "stilton"; shop == "Cheese Shop", p : price )
</code></pre><p>Positional arguments that are given a previously declared binding
      will constrain against that using unification; these are referred to as
      input arguments. If the binding does not yet exist, it will create the
      declaration binding it to the field represented by the position
      argument; these are referred to as output arguments.</p></div><div class="section" title="8.8.3.5. Fine grained property change listeners"><div class="titlepage"><div><div><h4 class="title"><a id="d0e10427"/>8.8.3.5. Fine grained property change listeners</h4></div></div></div><p>When you call modify() (see the modify statement section) on a given object it will trigger a revaluation of all
      patterns of the matching object type in the knowledge base. This can can lead to unwanted and useless evaluations
      and in the worst cases to infinite recursions. The only workaround to avoid it was to split up your objects into
      smaller ones having a 1 to 1 relationship with the original object.</p><p>This feature allows the pattern matching to only react to modification of properties actually
      constrained or bound inside of a given pattern. That will help with performance and recursion and avoid artificial
      object splitting.</p><p>By default this feature is off in order to make the behavior of the rule engine backward compatible with the
      former releases. When you want to activate it on a specific bean you have to annotate it with @propertyReactive.
      This annotation works both on DRL type declarations:</p><pre><code class="no-highlight">declare Person
@propertyReactive
    firstName : String
    lastName : String
end</code></pre><p>and on Java classes:</p><pre><code class="no-highlight">@PropertyReactive
    public static class Person {
    private String firstName;
    private String lastName;
}</code></pre><p>In this way, for instance, if you have a rule like the following:</p><pre><code class="no-highlight">rule "Every person named Mario is a male" when
    $person : Person( firstName == "Mario" )
then
    modify ( $person )  { setMale( true ) }
end</code></pre><p>you won't have to add the no-loop attribute to it in order to avoid an infinite recursion because the engine
      recognizes that the pattern matching is done on the 'firstName' property while the RHS of the rule modifies the
      'male' one. Note that this feature does not work for update(), and this is one of the reasons why we promote
      modify() since it encapsulates the field changes within the statement. Moreover, on Java classes, you can also
      annotate any method to say that its invocation actually modifies other properties. For instance in the former
      Person class you could have a method like:</p><pre><code class="no-highlight">@Modifies( { "firstName", "lastName" } )
public void setName(String name) {
    String[] names = name.split("\\s");
    this.firstName = names[0];
    this.lastName = names[1];
}</code></pre><p>That means that if a rule has a RHS like the following:</p><pre><code class="no-highlight">modify($person) { setName("Mario Fusco") }</code></pre><p>it will correctly recognize that the values of both properties 'firstName' and 'lastName' could have
      potentially been modified and act accordingly, not missing of reevaluating the patterns constrained on them. At
      the moment the usage of @Modifies is not allowed on fields but only on methods. This is coherent with the most
      common scenario where the @Modifies will be used for methods that are not related with a class field as in the
      Person.setName() in the former example. Also note that @Modifies is not transitive, meaning that if another method
      internally invokes the Person.setName() one it won't be enough to annotate it with @Modifies( { "name" } ), but it
      is necessary to use @Modifies( { "firstName", "lastName" } ) even on it. Very likely @Modifies transitivity will
      be implemented in the next release.</p><p>For what regards nested accessors, the engine will be notified only for top level fields. In other words a
      pattern matching like:</p><pre><code class="no-highlight">Person ( address.city.name == "London ) </code></pre><p>will be revaluated only for modification of the 'address' property of a Person object. In the same way the
      constraints analysis is currently strictly limited to what there is inside a pattern. Another example could help
      to clarify this. An LHS like the following:</p><pre><code class="no-highlight">$p : Person( )
Car( owner = $p.name )</code></pre><p>will not listen on modifications of the person's name, while this one will do:</p><pre><code class="no-highlight">Person( $name : name )
Car( owner = $name )</code></pre><p>To overcome this problem it is possible to annotate a pattern with @watch as it follows:</p><pre><code class="no-highlight">$p : Person( ) @watch ( name )
Car( owner = $p.name )</code></pre><p>Indeed, annotating a pattern with @watch allows you to modify the inferred set of properties for which that
      pattern will react. Note that the properties named in the @watch annotation are actually added to the ones
      automatically inferred, but it is also possible to explicitly exclude one or more of them prepending their name
      with a ! and to make the pattern to listen for all or none of the properties of the type used in the pattern
      respectively with the wildcrds * and !*. So, for example, you can annotate a pattern in the LHS of a rule
      like:</p><pre><code class="no-highlight">// listens for changes on both firstName (inferred) and lastName
Person( firstName == $expectedFirstName ) @watch( lastName )

// listens for all the properties of the Person bean
Person( firstName == $expectedFirstName ) @watch( * )

// listens for changes on lastName and explicitly exclude firstName
Person( firstName == $expectedFirstName ) @watch( lastName, !firstName )

// listens for changes on all the properties except the age one
Person( firstName == $expectedFirstName ) @watch( *, !age )</code></pre><p>Since doesn't make sense to use this annotation on a pattern using a type not annotated with
      @PropertyReactive the rule compiler will raise a compilation error if you try to do so. Also the duplicated usage
      of the same property in @watch (for example like in: @watch( firstName, ! firstName ) ) will end up in a
      compilation error. In a next release we will make the automatic detection of the properties to be listened smarter
      by doing analysis even outside of the pattern.</p><p>It also possible to enable this feature by default on all the types of your model or to completely disallow
      it by using on option of the KnowledgeBuilderConfiguration. In particular this new PropertySpecificOption can have
      one of the following 3 values:</p><pre><code class="no-highlight">- DISABLED =&gt; the feature is turned off and all the other related annotations are just ignored
- ALLOWED =&gt; this is the default behavior: types are not property reactive unless they are not annotated with @PropertySpecific
- ALWAYS =&gt; all types are property reactive by default</code></pre><p>So, for example, to have a KnowledgeBuilder generating property reactive types by default you could
      do:</p><pre><code class="no-highlight">KnowledgeBuilderConfiguration config = KnowledgeBuilderFactory.newKnowledgeBuilderConfiguration();
config.setOption(PropertySpecificOption.ALWAYS);
KnowledgeBuilder kbuilder = KnowledgeBuilderFactory.newKnowledgeBuilder(config);</code></pre><p>In this last case it will be possible to disable the property reactivity feature on a specific type by
      annotating it with @ClassReactive.</p></div><div class="section" title="8.8.3.6. Basic conditional elements"><div class="titlepage"><div><div><h4 class="title"><a id="d0e10488"/>8.8.3.6. Basic conditional elements</h4></div></div></div><div class="section" title="8.8.3.6.1. Conditional Element and"><div class="titlepage"><div><div><h5 class="title"><a id="d0e10491"/>8.8.3.6.1. Conditional Element <code class="literal">and</code></h5></div></div></div><p>The Conditional Element <code class="literal">"and"</code> is used to
        group other Conditional Elements into a logical conjunction. Drools
        supports both prefix <code class="literal">and</code> and infix
        <code class="literal">and</code>.</p><div class="figure"><a id="d0e10507"/><p class="title"><strong>Figure 8.18. infixAnd</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/infixAnd.png" align="middle" alt="infixAnd"/></div></div></div><br class="figure-break"/><p>Traditional infix <code class="literal">and</code> is supported:</p><pre><code class="no-highlight">//infixAnd
Cheese( cheeseType : type ) and Person( favouriteCheese == cheeseType )</code></pre><p>Explicit grouping with parentheses is also supported:</p><pre><code class="no-highlight">//infixAnd with grouping
( Cheese( cheeseType : type ) and
  ( Person( favouriteCheese == cheeseType ) or 
    Person( favouriteCheese == cheeseType ) )</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The symbol <code class="literal">&amp;&amp;</code> (as an alternative to
          <code class="literal">and</code>) is deprecated. But it is still supported in
          the syntax for backwards compatibility.</p></div><div class="figure"><a id="d0e10533"/><p class="title"><strong>Figure 8.19. prefixAnd</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/prefixAnd.png" align="middle" alt="prefixAnd"/></div></div></div><br class="figure-break"/><p>Prefix <code class="literal">and</code> is also supported:</p><pre><code class="no-highlight">(and Cheese( cheeseType : type )
     Person( favouriteCheese == cheeseType ) )</code></pre><p>The root element of the LHS is an implicit prefix
        <code class="literal">and</code> and doesn't need to be specified:</p><div class="example"><a id="d0e10551"/><p class="title"><strong>Example 8.74. implicit root prefixAnd</strong></p><div class="example-contents"><pre><code class="no-highlight">when
    Cheese( cheeseType : type )
    Person( favouriteCheese == cheeseType )
then
    ...</code></pre></div></div><br class="example-break"/></div><div class="section" title="8.8.3.6.2. Conditional Element or"><div class="titlepage"><div><div><h5 class="title"><a id="d0e10556"/>8.8.3.6.2. Conditional Element <code class="literal">or</code></h5></div></div></div><p>The Conditional Element <code class="literal">or</code> is used to group
        other Conditional Elements into a logical disjunction. Drools supports
        both prefix <code class="literal">or</code> and infix
        <code class="literal">or</code>.</p><div class="figure"><a id="d0e10572"/><p class="title"><strong>Figure 8.20. infixOr</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/infixOr.png" align="middle" alt="infixOr"/></div></div></div><br class="figure-break"/><p>Traditional infix <code class="literal">or</code> is supported:</p><pre><code class="no-highlight">//infixOr
Cheese( cheeseType : type ) or Person( favouriteCheese == cheeseType )</code></pre><p>Explicit grouping with parentheses is also supported:</p><pre><code class="no-highlight">//infixOr with grouping
( Cheese( cheeseType : type ) or
  ( Person( favouriteCheese == cheeseType ) and
    Person( favouriteCheese == cheeseType ) )</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The symbol <code class="literal">||</code> (as an alternative to
          <code class="literal">or</code>) is deprecated. But it is still supported in
          the syntax for backwards compatibility.</p></div><div class="figure"><a id="d0e10598"/><p class="title"><strong>Figure 8.21. prefixOr</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/prefixOr.png" align="middle" alt="prefixOr"/></div></div></div><br class="figure-break"/><p>Prefix <code class="literal">or</code> is also supported:</p><pre><code class="no-highlight">(or Person( sex == "f", age &gt; 60 )
    Person( sex == "m", age &gt; 65 )</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The behavior of the Conditional Element <code class="literal">or</code>
          is different from the connective <code class="literal">||</code> for
          constraints and restrictions in field constraints. The engine
          actually has no understanding of the Conditional Element
          <code class="literal">or</code>. Instead, via a number of different logic
          transformations, a rule with <code class="literal">or</code> is rewritten as a
          number of subrules. This process ultimately results in a rule that
          has a single <code class="literal">or</code> as the root node and one subrule
          for each of its CEs. Each subrule can activate and fire like any
          normal rule; there is no special behavior or interaction between
          these subrules. - This can be most confusing to new rule
          authors.</p></div><p>The Conditional Element <code class="literal">or</code> also allows for
        optional pattern binding. This means that each resulting subrule will
        bind its pattern to the pattern binding. Each pattern must be bound
        separately, using eponymous variables:</p><pre><code class="no-highlight">pensioner : ( Person( sex == "f", age &gt; 60 ) or Person( sex == "m", age &gt; 65 ) )</code></pre><pre><code class="no-highlight">(or pensioner : Person( sex == "f", age &gt; 60 ) 
    pensioner : Person( sex == "m", age &gt; 65 ) )</code></pre><p>Since the conditional element <code class="literal">or</code> results in
        multiple subrule generation, one for each possible logically outcome,
        the example above would result in the internal generation of two
        rules. These two rules work independently within the Working Memory,
        which means both can match, activate and fire - there is no
        shortcutting.</p><p>The best way to think of the conditional element
        <code class="literal">or</code> is as a shortcut for generating two or more
        similar rules. When you think of it that way, it's clear that for a
        single rule there could be multiple activations if two or more terms
        of the disjunction are true.</p></div><div class="section" title="8.8.3.6.3. Conditional Element not"><div class="titlepage"><div><div><h5 class="title"><a id="d0e10648"/>8.8.3.6.3. Conditional Element <code class="literal">not</code></h5></div></div></div><div class="figure"><a id="d0e10653"/><p class="title"><strong>Figure 8.22. not</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/not.png" align="middle" alt="not"/></div></div></div><br class="figure-break"/><p>The CE <code class="literal">not</code> is first order logic's
        non-existential quantifier and checks for the non-existence of
        something in the Working Memory. Think of "not" as meaning "there must
        be none of...".</p><p>The keyword <code class="literal">not</code> may be followed by
        parentheses around the CEs that it applies to. In the simplest case of
        a single pattern (like below) you may optionally omit the
        parentheses.</p><div class="example"><a id="d0e10669"/><p class="title"><strong>Example 8.75. No Busses</strong></p><div class="example-contents"><pre><code class="no-highlight">not Bus()</code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e10674"/><p class="title"><strong>Example 8.76. No red Busses</strong></p><div class="example-contents"><pre><code class="no-highlight">// Brackets are optional:
not Bus(color == "red")
// Brackets are optional:
not ( Bus(color == "red", number == 42) )
// "not" with nested infix <code class="literal">and</code> - two patterns,
// brackets are requires:
not ( Bus(color == "red") and
      Bus(color == "blue") )</code></pre></div></div><br class="example-break"/></div><div class="section" title="8.8.3.6.4. Conditional Element exists"><div class="titlepage"><div><div><h5 class="title"><a id="d0e10682"/>8.8.3.6.4. Conditional Element <code class="literal">exists</code></h5></div></div></div><div class="figure"><a id="d0e10687"/><p class="title"><strong>Figure 8.23. exists</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/exists.png" align="middle" alt="exists"/></div></div></div><br class="figure-break"/><p>The CE <code class="literal">exists</code> is first order logic's
        existential quantifier and checks for the existence of something in
        the Working Memory. Think of "exists" as meaning "there is at least
        one..". It is different from just having the pattern on its own, which
        is more like saying "for each one of...". If you use
        <code class="literal">exists</code> with a pattern, the rule will only activate
        at most once, regardless of how much data there is in working memory
        that matches the condition inside of the <code class="literal">exists</code>
        pattern. Since only the existence matters, no bindings will be
        established.</p><p>The keyword <code class="literal">exists</code> must be followed by
        parentheses around the CEs that it applies to. In the simplest case of
        a single pattern (like below) you may omit the parentheses.</p><div class="example"><a id="d0e10709"/><p class="title"><strong>Example 8.77. At least one Bus</strong></p><div class="example-contents"><pre><code class="no-highlight">exists Bus()</code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e10714"/><p class="title"><strong>Example 8.78. At least one red Bus</strong></p><div class="example-contents"><pre><code class="no-highlight">exists Bus(color == "red")
// brackets are optional:
exists ( Bus(color == "red", number == 42) )
// "exists" with nested infix <code class="literal">and</code>,
// brackets are required:
exists ( Bus(color == "red") and
         Bus(color == "blue") )</code></pre></div></div><br class="example-break"/></div></div><div class="section" title="8.8.3.7. Advanced conditional elements"><div class="titlepage"><div><div><h4 class="title"><a id="d0e10722"/>8.8.3.7. Advanced conditional elements</h4></div></div></div><div class="section" title="8.8.3.7.1. Conditional Element forall"><div class="titlepage"><div><div><h5 class="title"><a id="d0e10725"/>8.8.3.7.1. Conditional Element <code class="literal">forall</code></h5></div></div></div><div class="figure"><a id="d0e10730"/><p class="title"><strong>Figure 8.24. forall</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/forall.png" align="middle" alt="forall"/></div></div></div><br class="figure-break"/><p>The Conditional Element <code class="literal">forall</code> completes the
        First Order Logic support in Drools. The Conditional Element
        <code class="literal">forall</code> evaluates to true when all facts that match
        the first pattern match all the remaining patterns. Example:</p><pre><code class="no-highlight">rule "All English buses are red"
when
    forall( $bus : Bus( type == 'english') 
                   Bus( this == $bus, color = 'red' ) )
then
    // all English buses are red
end</code></pre><p>In the above rule, we "select" all Bus objects whose type is
        "english". Then, for each fact that matches this pattern we evaluate
        the following patterns and if they match, the forall CE will evaluate
        to true.</p><p>To state that all facts of a given type in the working memory
        must match a set of constraints, <code class="literal">forall</code> can be
        written with a single pattern for simplicity. Example:</p><div class="example"><a id="d0e10753"/><p class="title"><strong>Example 8.79. Single Pattern Forall</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "All Buses are Red"
when
    forall( Bus( color == 'red' ) )
then
    // all Bus facts are red
end</code></pre></div></div><br class="example-break"/><p>Another example shows multiple patterns inside the
        <code class="literal">forall</code>:</p><div class="example"><a id="d0e10763"/><p class="title"><strong>Example 8.80. Multi-Pattern Forall</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "all employees have health and dental care programs"
when
    forall( $emp : Employee()
            HealthCare( employee == $emp )
            DentalCare( employee == $emp )
          )
then
    // all employees have health and dental care
end</code></pre></div></div><br class="example-break"/><p>Forall can be nested inside other CEs. For instance,
        <code class="literal">forall</code> can be used inside a <code class="literal">not</code>
        CE. Note that only single patterns have optional parentheses, so that
        with a nested <code class="literal">forall</code> parentheses must be
        used:</p><div class="example"><a id="d0e10779"/><p class="title"><strong>Example 8.81. Combining Forall with Not CE</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "not all employees have health and dental care"
when 
    not ( forall( $emp : Employee()
                  HealthCare( employee == $emp )
                  DentalCare( employee == $emp ) ) 
        )
then
    // not all employees have health and dental care
end</code></pre></div></div><br class="example-break"/><p>As a side note, <code class="code">forall( p1 p2 p3...)</code> is equivalent
        to writing:</p><pre><code class="no-highlight">not(p1 and not(and p2 p3...))</code></pre><p>Also, it is important to note that <code class="literal">forall</code> is
        a <span class="emphasis"><em>scope delimiter</em></span>. Therefore, it can use any
        previously bound variable, but no variable bound inside it will be
        available for use outside of it.</p></div><div class="section" title="8.8.3.7.2. Conditional Element from"><div class="titlepage"><div><div><h5 class="title"><a id="d0e10799"/>8.8.3.7.2. Conditional Element <code class="literal">from</code></h5></div></div></div><div class="figure"><a id="d0e10804"/><p class="title"><strong>Figure 8.25. from</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/from.png" align="middle" alt="from"/></div></div></div><br class="figure-break"/><p>The Conditional Element <code class="literal">from</code> enables users to
        specify an arbitrary source for data to be matched by LHS patterns.
        This allows the engine to reason over data not in the Working Memory.
        The data source could be a sub-field on a bound variable or the
        results of a method call. It is a powerful construction that allows
        out of the box integration with other application components and
        frameworks. One common example is the integration with data retrieved
        on-demand from databases using hibernate named queries.</p><p>The expression used to define the object source is any
        expression that follows regular MVEL syntax. Therefore, it allows you
        to easily use object property navigation, execute method calls and
        access maps and collections elements.</p><p>Here is a simple example of reasoning and binding on another
        pattern sub-field:</p><pre><code class="no-highlight">rule "validate zipcode"
when
    Person( $personAddress : address ) 
    Address( zipcode == "23920W") from $personAddress 
then
    // zip code is ok
end</code></pre><p>With all the flexibility from the new expressiveness in the
        Drools engine you can slice and dice this problem many ways. This is
        the same but shows how you can use a graph notation with the
        'from':</p><pre><code class="no-highlight">rule "validate zipcode"
when
    $p : Person( ) 
    $a : Address( zipcode == "23920W") from $p.address 
then
    // zip code is ok
end</code></pre><p>Previous examples were evaluations using a single pattern. The
        CE <code class="literal">from</code> also support object sources that return a
        collection of objects. In that case, <code class="literal">from</code> will
        iterate over all objects in the collection and try to match each of
        them individually. For instance, if we want a rule that applies 10%
        discount to each item in an order, we could do:</p><pre><code class="no-highlight">rule "apply 10% discount to all items over US$ 100,00 in an order"
when
    $order : Order()
    $item  : OrderItem( value &gt; 100 ) from $order.items
then
    // apply discount to $item
end</code></pre><p>The above example will cause the rule to fire once for each item
        whose value is greater than 100 for each given order.</p><p>You must take caution, however, when using
        <code class="literal">from</code>, especially in conjunction with the
        <code class="literal">lock-on-active</code> rule attribute as it may produce
        unexpected results. Consider the example provided earlier, but now
        slightly modified as follows:</p><pre><code class="no-highlight">rule "Assign people in North Carolina (NC) to sales region 1"
ruleflow-group "test"
lock-on-active true
when
    $p : Person( ) 
    $a : Address( state == "NC") from $p.address 
then
    modify ($p) {} // Assign person to sales region 1 in a modify block
end

rule "Apply a discount to people in the city of Raleigh"
ruleflow-group "test"
lock-on-active true
when
    $p : Person( ) 
    $a : Address( city == "Raleigh") from $p.address 
then
    modify ($p) {} // Apply discount to person in a modify block
end</code></pre><p>In the above example, persons in Raleigh, NC should be assigned
        to sales region 1 and receive a discount; i.e., you would expect both
        rules to activate and fire. Instead you will find that only the second
        rule fires.</p><p>If you were to turn on the audit log, you would also see that
        when the second rule fires, it deactivates the first rule. Since the
        rule attribute <code class="literal">lock-on-active</code> prevents a rule from
        creating new activations when a set of facts change, the first rule
        fails to reactivate. Though the set of facts have not changed, the use
        of <code class="literal">from</code> returns a new fact for all intents and
        purposes each time it is evaluated.</p><p>First, it's important to review why you would use the above
        pattern. You may have many rules across different rule-flow groups.
        When rules modify working memory and other rules downstream of your
        RuleFlow (in different rule-flow groups) need to be reevaluated, the
        use of <code class="literal">modify</code> is critical. You don't, however, want
        other rules in the same rule-flow group to place activations on one
        another recursively. In this case, the <code class="literal">no-loop</code>
        attribute is ineffective, as it would only prevent a rule from
        activating itself recursively. Hence, you resort to
        <code class="literal">lock-on-active</code>.</p><p>There are several ways to address this issue:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Avoid the use of <code class="literal">from</code> when you can assert
            all facts into working memory or use nested object references in
            your constraint expressions (shown below).</p></li><li class="listitem"><p>Place the variable assigned used in the modify block as the
            last sentence in your condition (LHS).</p></li><li class="listitem"><p>Avoid the use of <code class="literal">lock-on-active</code> when you
            can explicitly manage how rules within the same rule-flow group
            place activations on one another (explained below).</p></li></ul></div><p>The preferred solution is to minimize use of
        <code class="literal">from</code> when you can assert all your facts into
        working memory directly. In the example above, both the Person and
        Address instance can be asserted into working memory. In this case,
        because the graph is fairly simple, an even easier solution is to
        modify your rules as follows:</p><pre><code class="no-highlight">rule "Assign people in North Carolina (NC) to sales region 1"
ruleflow-group "test"
lock-on-active true
when
    $p : Person(address.state == "NC" )  
then
    modify ($p) {} // Assign person to sales region 1 in a modify block
end

rule "Apply a discount to people in the city of Raleigh"
ruleflow-group "test"
lock-on-active true
when
    $p : Person(address.city == "Raleigh" )  
then
    modify ($p) {} //Apply discount to person in a modify block
end</code></pre><p>Now, you will find that both rules fire as expected. However, it
        is not always possible to access nested facts as above. Consider an
        example where a Person holds one or more Addresses and you wish to use
        an existential quantifier to match people with at least one address
        that meets certain conditions. In this case, you would have to resort
        to the use of <code class="literal">from</code> to reason over the
        collection.</p><p>There are several ways to use <code class="literal">from</code> to achieve
        this and not all of them exhibit an issue with the use of
        <code class="literal">lock-on-active</code>. For example, the following use of
        <code class="literal">from</code> causes both rules to fire as expected:</p><pre><code class="no-highlight">rule "Assign people in North Carolina (NC) to sales region 1"
ruleflow-group "test"
lock-on-active true
when
    $p : Person($addresses : addresses)
    exists (Address(state == "NC") from $addresses)  
then
    modify ($p) {} // Assign person to sales region 1 in a modify block
end

rule "Apply a discount to people in the city of Raleigh"
ruleflow-group "test"
lock-on-active true
when
    $p : Person($addresses : addresses)
    exists (Address(city == "Raleigh") from $addresses)  
then
    modify ($p) {} // Apply discount to person in a modify block
end</code></pre><p>However, the following slightly different approach does exhibit
        the problem:</p><pre><code class="no-highlight">rule "Assign people in North Carolina (NC) to sales region 1"
ruleflow-group "test"
lock-on-active true
when
    $assessment : Assessment()
    $p : Person()
    $addresses : List() from $p.addresses
    exists (Address( state == "NC") from $addresses) 
then
    modify ($assessment) {} // Modify assessment in a modify block
end

rule "Apply a discount to people in the city of Raleigh"
ruleflow-group "test"
lock-on-active true
when
    $assessment : Assessment()
    $p : Person()
    $addresses : List() from $p.addresses 
    exists (Address( city == "Raleigh") from $addresses)
then
    modify ($assessment) {} // Modify assessment in a modify block
end</code></pre><p>In the above example, the $addresses variable is returned from
        the use of <code class="literal">from</code>. The example also introduces a new
        object, assessment, to highlight one possible solution in this case.
        If the $assessment variable assigned in the condition (LHS) is moved
        to the last condition in each rule, both rules fire as
        expected.</p><p>Though the above examples demonstrate how to combine the use of
        <code class="literal">from</code> with <code class="literal">lock-on-active</code> where
        no loss of rule activations occurs, they carry the drawback of placing
        a dependency on the order of conditions on the LHS. In addition, the
        solutions present greater complexity for the rule author in terms of
        keeping track of which conditions may create issues.</p><p>A better alternative is to assert more facts into working
        memory. In this case, a person's addresses may be asserted into
        working memory and the use of <code class="literal">from</code> would not be
        necessary.</p><p>There are cases, however, where asserting all data into working
        memory is not practical and we need to find other solutions. Another
        option is to reevaluate the need for
        <code class="literal">lock-on-active</code>. An alternative to
        <code class="literal">lock-on-active</code> is to directly manage how rules
        within the same rule-flow group activate one another by including
        conditions in each rule that prevent rules from activating each other
        recursively when working memory is modified. For example, in the case
        above where a discount is applied to citizens of Raleigh, a condition
        may be added to the rule that checks whether the discount has already
        been applied. If so, the rule does not activate.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The pattern containing a from clause cannot be followed by another
          pattern starting with a parenthesis as in the following example</p><pre><code class="no-highlight">rule R when
    $l : List( )
    String() from $l
    (String() or Number())
then end</code></pre><p>This is because in that case the DRL parser reads the from expression
          as <code class="literal">from $l (String() or Number())</code> and it is impossible to
          disambiguate this expression from a function call. The straightforward fix
          to this is wrapping also the from clause in parenthesis as it follows:</p><pre><code class="no-highlight">rule R when
    $l : List( )
    (String() from $l)
    (String() or Number())
then end</code></pre></div></div><div class="section" title="8.8.3.7.3. Conditional Element collect"><div class="titlepage"><div><div><h5 class="title"><a id="d0e10953"/>8.8.3.7.3. Conditional Element <code class="literal">collect</code></h5></div></div></div><div class="figure"><a id="d0e10958"/><p class="title"><strong>Figure 8.26. collect</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/collect.png" align="middle" alt="collect"/></div></div></div><br class="figure-break"/><p>The Conditional Element <code class="literal">collect</code> allows rules
        to reason over a collection of objects obtained from the given source
        or from the working memory. In First Oder Logic terms this is the
        cardinality quantifier. A simple example:</p><pre><code class="no-highlight">import java.util.ArrayList

rule "Raise priority if system has more than 3 pending alarms"
when
    $system : System()
    $alarms : ArrayList( size &gt;= 3 )
              from collect( Alarm( system == $system, status == 'pending' ) )
then
    // Raise priority, because system $system has
    // 3 or more alarms pending. The pending alarms
    // are $alarms.
end</code></pre><p>In the above example, the rule will look for all pending alarms
        in the working memory for each given system and group them in
        ArrayLists. If 3 or more alarms are found for a given system, the rule
        will fire.</p><p>The result pattern of <code class="literal">collect</code> can be any
        concrete class that implements the <code class="code">java.util.Collection</code>
        interface and provides a default no-arg public constructor. This means
        that you can use Java collections like ArrayList, LinkedList, HashSet,
        etc., or your own class, as long as it implements the
        <code class="code">java.util.Collection</code> interface and provide a default
        no-arg public constructor.</p><p>Both source and result patterns can be constrained as any other
        pattern.</p><p>Variables bound before the <code class="literal">collect</code> CE are in
        the scope of both source and result patterns and therefore you can use
        them to constrain both your source and result patterns. But note that
        <code class="literal">collect</code> is a scope delimiter for bindings, so that
        any binding made inside of it is not available for use outside of
        it.</p><p>Collect accepts nested <code class="literal">from</code> CEs. The
        following example is a valid use of "collect":</p><pre><code class="no-highlight">import java.util.LinkedList;

rule "Send a message to all mothers"
when
    $town : Town( name == 'Paris' )
    $mothers : LinkedList() 
               from collect( Person( gender == 'F', children &gt; 0 ) 
                             from $town.getPeople() 
                           )
then
    // send a message to all mothers
end</code></pre></div><div class="section" title="8.8.3.7.4. Conditional Element accumulate"><div class="titlepage"><div><div><h5 class="title"><a id="d0e11001"/>8.8.3.7.4. Conditional Element <code class="literal">accumulate</code></h5></div></div></div><div class="figure"><a id="d0e11006"/><p class="title"><strong>Figure 8.27. accumulate</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/accumulate.png" align="middle" alt="accumulate"/></div></div></div><br class="figure-break"/><p>The Conditional Element <code class="literal">accumulate</code> is a more flexible and powerful form of
            <code class="literal">collect</code>, in the sense that it can be used to do what <code class="literal">collect</code> does and
          also achieve results that the CE <code class="literal">collect</code> is not capable of achieving. Accumulate allows a
          rule to iterate over a collection of objects, executing custom actions for each of the elements, and at the
          end, it returns a result object.</p><p>Accumulate supports both the use of pre-defined accumulate
        functions, or the use of inline custom code. Inline custom code should
        be avoided though, as it is harder for rule authors to maintain, and
        frequently leads to code duplication. Accumulate functions are easier
        to test and reuse.</p><p>The Accumulate CE also supports multiple different syntaxes. The
        preferred syntax is the top level accumulate, as noted bellow, but all
        other syntaxes are supported for backward compatibility.</p><div class="section" title="8.8.3.7.4.1. Accumulate CE (preferred syntax)"><div class="titlepage"><div><div><h6 class="title"><a id="d0e11030"/>8.8.3.7.4.1. Accumulate CE (preferred syntax)</h6></div></div></div><p>The top level accumulate syntax is the most compact and
          flexible syntax. The simplified syntax is as follows:</p><pre><code class="no-highlight"><code class="literal">accumulate( </code><em class="replaceable"><code>&lt;source pattern&gt;</code></em><code class="literal">; </code><em class="replaceable"><code>&lt;functions&gt;</code></em><code class="literal"> [;</code><em class="replaceable"><code>&lt;constraints&gt;</code></em><code class="literal">] )</code>
</code></pre><p>For instance, a rule to calculate the minimum, maximum and
          average temperature reading for a given sensor and that raises an
          alarm if the minimum temperature is under 20C degrees and the
          average is over 70C degrees could be written in the following way,
          using Accumulate:</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The DRL language defines "<code class="code">acc</code>" as a synonym of "<code class="code">accumulate</code>". The author
              might prefer to use "<code class="code">acc</code>" as a less verbose keyword or the full keyword
                "<code class="code">accumulate</code>" for legibility.</p></div><pre><code class="no-highlight">rule "Raise alarm"
when
    $s : Sensor()
    accumulate( Reading( sensor == $s, $temp : temperature );
                $min : min( $temp ),
                $max : max( $temp ),
                $avg : average( $temp );
                $min &lt; 20, $avg &gt; 70 )
then
    // raise the alarm
end</code></pre><p>In the above example, min, max and average are Accumulate
          Functions and will calculate the minimum, maximum and average
          temperature values over all the readings for each sensor.</p><p>Drools ships with several built-in accumulate functions,
          including:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>average</p></li><li class="listitem"><p>min</p></li><li class="listitem"><p>max</p></li><li class="listitem"><p>count</p></li><li class="listitem"><p>sum</p></li><li class="listitem"><p>collectList</p></li><li class="listitem"><p>collectSet</p></li></ul></div><p>These common functions accept any expression as input. For
          instance, if someone wants to calculate the average profit on all
          items of an order, a rule could be written using the average
          function:</p><pre><code class="no-highlight">rule "Average profit"
when
    $order : Order()
    accumulate( OrderItem( order == $order, $cost : cost, $price : price );
                $avgProfit : average( 1 - $cost / $price ) )
then
    // average profit for $order is $avgProfit
end</code></pre><p>Accumulate Functions are all pluggable. That means that if needed, custom, domain specific functions can
            easily be added to the engine and rules can start to use them without any restrictions. To implement a new
            Accumulate Function all one needs to do is to create a Java class that implements the
              <code class="code">org.drools.core.runtime.rule.TypedAccumulateFunction</code> interface. As an example of an
            Accumulate Function implementation, the following is the implementation of the <code class="literal">average</code>
            function:</p><pre><code class="language-java">/**
 * An implementation of an accumulator capable of calculating average values
 */
public class AverageAccumulateFunction implements org.drools.core.runtime.rule.TypedAccumulateFunction {

    public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException {

    }

    public void writeExternal(ObjectOutput out) throws IOException {

    }

    public static class AverageData implements Externalizable {
        public int    count = 0;
        public double total = 0;

        public AverageData() {}

        public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException {
            count   = in.readInt();
            total   = in.readDouble();
        }

        public void writeExternal(ObjectOutput out) throws IOException {
            out.writeInt(count);
            out.writeDouble(total);
        }

    }

    /* (non-Javadoc)
     * @see org.drools.base.accumulators.AccumulateFunction#createContext()
     */
    public Serializable createContext() {
        return new AverageData();
    }

    /* (non-Javadoc)
     * @see org.drools.core.base.accumulators.AccumulateFunction#init(java.lang.Object)
     */
    public void init(Serializable context) throws Exception {
        AverageData data = (AverageData) context;
        data.count = 0;
        data.total = 0;
    }

    /* (non-Javadoc)
     * @see org.drools.core.base.accumulators.AccumulateFunction#accumulate(java.lang.Object, java.lang.Object)
     */
    public void accumulate(Serializable context,
                           Object value) {
        AverageData data = (AverageData) context;
        data.count++;
        data.total += ((Number) value).doubleValue();
    }

    /* (non-Javadoc)
     * @see org.drools.core.base.accumulators.AccumulateFunction#reverse(java.lang.Object, java.lang.Object)
     */
    public void reverse(Serializable context,
                        Object value) throws Exception {
        AverageData data = (AverageData) context;
        data.count--;
        data.total -= ((Number) value).doubleValue();
    }

    /* (non-Javadoc)
     * @see org.drools.core.base.accumulators.AccumulateFunction#getResult(java.lang.Object)
     */
    public Object getResult(Serializable context) throws Exception {
        AverageData data = (AverageData) context;
        return new Double( data.count == 0 ? 0 : data.total / data.count );
    }

    /* (non-Javadoc)
     * @see org.drools.core.base.accumulators.AccumulateFunction#supportsReverse()
     */
    public boolean supportsReverse() {
        return true;
    }

    /**
     * {@inheritDoc}
     */
    public Class&lt; ? &gt; getResultType() {
        return Number.class;
    }

}
</code></pre><p>The code for the function is very simple, as we could expect, as all the "dirty" integration work is
            done by the engine. Finally, to use the function in the rules, the author can import it using the "import
            accumulate" statement:</p><pre><code class="no-highlight">import accumulate &lt;class_name&gt; &lt;function_name&gt;</code></pre><p>For instance, if one implements the class <code class="code">some.package.VarianceFunction</code> function that
            implements the <code class="code">variance</code> function and wants to use it in the rules, he would do the
            following:</p><div class="example"><a id="d0e11122"/><p class="title"><strong>Example 8.82. Example of importing and using the custom "<code class="code">variance</code>" accumulate function</strong></p><div class="example-contents"><pre><code class="no-highlight"><span class="bold"><strong>import accumulate</strong></span> some.package.VarianceFunction variance

<span class="bold"><strong>rule</strong></span> "Calculate Variance"
<span class="bold"><strong>when</strong></span>
    <span class="bold"><strong>accumulate</strong></span>( Test( $s : score ), $v : variance( $s ) )
<span class="bold"><strong>then</strong></span>
    <span class="italic">// the variance of the test scores is $v</span>
<span class="bold"><strong>end</strong></span></code></pre></div></div><br class="example-break"/><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The built in functions (sum, average, etc) are imported automatically by the engine. Only user-defined
              custom accumulate functions need to be explicitly imported.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>For backward compatibility, Drools still supports the configuration of accumulate functions through
              configuration files and system properties, but this is a deprecated method. In order to configure the
              variance function from the previous example using the configuration file or system property, the user
              would set a property like this:</p><pre><code class="no-highlight">drools.accumulate.function.variance = some.package.VarianceFunction</code></pre><p>Please note that "<code class="code">drools.accumulate.function.</code>" is a prefix that must always be used,
                "<code class="code">variance</code>" is how the function will be used in the drl files, and
                "<code class="code">some.package.VarianceFunction</code>" is the fully qualified name of the class that implements
              the function behavior.</p></div></div><div class="section" title="8.8.3.7.4.2. Alternate Syntax: single function with return type"><div class="titlepage"><div><div><h6 class="title"><a id="d0e11168"/>8.8.3.7.4.2. Alternate Syntax: single function with return type</h6></div></div></div><p>The accumulate syntax evolved over time with the goal of
          becoming more compact and expressive. Nevertheless, Drools still
          supports previous syntaxes for backward compatibility
          purposes.</p><p>In case the rule is using a single accumulate function on a
          given accumulate, the author may add a pattern for the result object
          and use the "from" keyword to link it to the accumulate result.
          Example: a rule to apply a 10% discount on orders over $100 could be
          written in the following way:</p><pre><code class="no-highlight">rule "Apply 10% discount to orders over US$ 100,00"
when
    $order : Order()
    $total : Number( doubleValue &gt; 100 ) 
             from accumulate( OrderItem( order == $order, $value : value ),
                              sum( $value ) )
then
    // apply discount to $order
end</code></pre><p>In the above example, the accumulate element is using only one
          function (sum), and so, the rules author opted to explicitly write a
          pattern for the result type of the accumulate function (Number) and
          write the constraints inside it. There are no problems in using this
          syntax over the compact syntax presented before, except that is is a
          bit more verbose. Also note that it is not allowed to use both the
          return type and the functions binding in the same accumulate statement.</p><p>Compile-time checks are performed in order to ensure the pattern
          used with the "from" keyword is assignable from the result of the
          accumulate function used.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>With this syntax, the "<code class="code">from</code>" binds to the single
           result returned by the accumulate function, and it does not iterate.
           </p></div><p>In the above example, "<code class="code">$total</code>" is bound to the
           result returned by the accumulate <code class="code">sum()</code> function.</p><p>As another example however, if the result of the accumulate 
           function is a collection, "<code class="code">from</code>" still binds to the
           single result and it does not iterate:
           </p><pre><code class="no-highlight">rule "Person names"
when
  $x : Object() from accumulate(MyPerson( $val : name ); 
                                collectList( $val ) )
then
  // $x is a List
end</code></pre><p>
           The binded "<code class="code">$x : Object()</code>" is the List itself,
           returned by the <code class="code">collectList</code> accumulate function used.
           </p><p>This is an important distinction to highlight, as the<code class="code">from</code>
           keyword can also be used separately of <code class="code">accumulate</code>, to 
           iterate over the elements of a collection:
           </p><pre><code class="no-highlight">rule "Iterate the numbers"
when
    $xs : List()
    $x : Integer() from $xs
then
  // $x matches and binds to each Integer in the collection
end</code></pre><p>
           </p><p>While this syntax is still supported for backward compatibility purposes,
           for this and other reasons we encourage rule authors to make use instead of the
           Accumulate CE preferred syntax (described in the previous chapter),
           so to avoid any potential pitfalls, as described by these examples.
           </p></div><div class="section" title="8.8.3.7.4.3. Accumulate with inline custom code"><div class="titlepage"><div><div><h6 class="title"><a id="d0e11222"/>8.8.3.7.4.3. Accumulate with inline custom code</h6></div></div></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>The use of accumulate with inline custom code is not a good
            practice for several reasons, including difficulties on maintaining
            and testing rules that use them, as well as the inability of
            reusing that code. Implementing your own accumulate functions is
            very simple and straightforward, they are easy to unit test and to
            use. This form of accumulate is supported for backward
            compatibility only.</p></div><p>Another possible syntax for the accumulate is to define inline
          custom code, instead of using accumulate functions. As noted on the
          previous warned, this is discouraged though for the stated
          reasons.</p><p>The general syntax of the <code class="literal">accumulate</code> CE
          with inline custom code is:</p><pre><code class="no-highlight"><em class="replaceable"><code>&lt;result pattern&gt;</code></em> <code class="literal">from accumulate(</code> <em class="replaceable"><code>&lt;source pattern&gt;</code></em><code class="literal">,</code>
                                  <code class="literal">init(</code> <em class="replaceable"><code>&lt;init code&gt;</code></em> <code class="literal">),</code>
                                  <code class="literal">action(</code> <em class="replaceable"><code>&lt;action code&gt;</code></em> <code class="literal">),</code>
                                  <code class="literal">reverse(</code> <em class="replaceable"><code>&lt;reverse code&gt;</code></em> <code class="literal">),</code>
                                  <code class="literal">result(</code> <em class="replaceable"><code>&lt;result expression&gt;</code></em> <code class="literal">) )</code>
</code></pre><p>The meaning of each of the elements is the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>&lt;source pattern&gt;</em></span>: the source
              pattern is a regular pattern that the engine will try to match
              against each of the source objects.</p></li><li class="listitem"><p><span class="emphasis"><em>&lt;init code&gt;</em></span>: this is a semantic
              block of code in the selected dialect that will be executed once
              for each tuple, before iterating over the source objects.</p></li><li class="listitem"><p><span class="emphasis"><em>&lt;action code&gt;</em></span>: this is a
              semantic block of code in the selected dialect that will be
              executed for each of the source objects.</p></li><li class="listitem"><p><span class="emphasis"><em>&lt;reverse code&gt;</em></span>: this is an
              optional semantic block of code in the selected dialect that if
              present will be executed for each source object that no longer
              matches the source pattern. The objective of this code block is
              to undo any calculation done in the <span class="emphasis"><em>&lt;action
              code&gt;</em></span> block, so that the engine can do decremental
              calculation when a source object is modified or deleted,
              hugely improving performance of these operations.</p></li><li class="listitem"><p><span class="emphasis"><em>&lt;result expression&gt;</em></span>: this is a
              semantic expression in the selected dialect that is executed
              after all source objects are iterated.</p></li><li class="listitem"><p><span class="emphasis"><em>&lt;result pattern&gt;</em></span>: this is a
              regular pattern that the engine tries to match against the
              object returned from the <span class="emphasis"><em>&lt;result
              expression&gt;</em></span>. If it matches, the
              <code class="literal">accumulate</code> conditional element evaluates to
              <span class="emphasis"><em>true</em></span> and the engine proceeds with the
              evaluation of the next CE in the rule. If it does not matches,
              the <code class="literal">accumulate</code> CE evaluates to
              <span class="emphasis"><em>false</em></span> and the engine stops evaluating CEs
              for that rule.</p></li></ul></div><p>It is easier to understand if we look at an example:</p><pre><code class="no-highlight">rule "Apply 10% discount to orders over US$ 100,00"
when
    $order : Order()
    $total : Number( doubleValue &gt; 100 ) 
             from accumulate( OrderItem( order == $order, $value : value ),
                              init( double total = 0; ),
                              action( total += $value; ),
                              reverse( total -= $value; ),
                              result( total ) )
then
    // apply discount to $order
end</code></pre><p>In the above example, for each <code class="code">Order</code> in the
          Working Memory, the engine will execute the <span class="emphasis"><em>init
          code</em></span> initializing the total variable to zero. Then it
          will iterate over all <code class="code">OrderItem</code> objects for that order,
          executing the <span class="emphasis"><em>action</em></span> for each one (in the
          example, it will sum the value of all items into the total
          variable). After iterating over all <code class="code">OrderItem</code> objects,
          it will return the value corresponding to the <span class="emphasis"><em>result
          expression</em></span> (in the above example, the value of variable
          <code class="code">total</code>). Finally, the engine will try to match the
          result with the <code class="code">Number</code> pattern, and if the double value
          is greater than 100, the rule will fire.</p><p>The example used Java as the semantic dialect, and as such,
          note that the usage of the semicolon as statement delimiter is
          mandatory in the init, action and reverse code blocks. The result is
          an expression and, as such, it does not admit ';'. If the user uses
          any other dialect, he must comply to that dialect's specific
          syntax.</p><p>As mentioned before, the <span class="emphasis"><em>reverse code</em></span> is
          optional, but it is strongly recommended that the user writes it in
          order to benefit from the <span class="emphasis"><em>improved performance on update
          and delete</em></span>.</p><p>The <code class="literal">accumulate</code> CE can be used to execute
          any action on source objects. The following example instantiates and
          populates a custom object:</p><pre><code class="no-highlight">rule "Accumulate using custom objects"
when
    $person   : Person( $likes : likes )
    $cheesery : Cheesery( totalAmount &gt; 100 )
                from accumulate( $cheese : Cheese( type == $likes ),
                                 init( Cheesery cheesery = new Cheesery(); ),
                                 action( cheesery.addCheese( $cheese ); ),
                                 reverse( cheesery.removeCheese( $cheese ); ),
                                 result( cheesery ) );
then
    // do something
end</code></pre></div></div></div><div class="section" title="8.8.3.8. Conditional Element eval"><div class="titlepage"><div><div><h4 class="title"><a id="d0e11381"/>8.8.3.8. Conditional Element <code class="literal">eval</code></h4></div></div></div><div class="figure"><a id="d0e11386"/><p class="title"><strong>Figure 8.28. eval</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/eval.png" align="middle" alt="eval"/></div></div></div><br class="figure-break"/><p>The conditional element <code class="literal">eval</code> is essentially a
      catch-all which allows any semantic code (that returns a primitive
      boolean) to be executed. This code can refer to variables that were
      bound in the LHS of the rule, and functions in the rule package. Overuse
      of eval reduces the declarativeness of your rules and can result in a
      poorly performing engine. While <code class="literal">eval</code> can be used
      anywhere in the patterns, the best practice is to add it as the last
      conditional element in the LHS of a rule.</p><p>Evals cannot be indexed and thus are not as efficient as Field
      Constraints. However this makes them ideal for being used when functions
      return values that change over time, which is not allowed within Field
      Constraints.</p><p>For folks who are familiar with Drools 2.x lineage, the old Drools
      parameter and condition tags are equivalent to binding a variable to an
      appropriate type, and then using it in an eval node.</p><pre><code class="no-highlight">p1 : Parameter()
p2 : Parameter()
eval( p1.getList().containsKey( p2.getItem() ) )</code></pre><pre><code class="no-highlight">p1 : Parameter()
p2 : Parameter()
// call function isValid in the LHS
eval( isValid( p1, p2 ) )</code></pre></div><div class="section" title="8.8.3.9. Railroad diagrams"><div class="titlepage"><div><div><h4 class="title"><a id="d0e11408"/>8.8.3.9. Railroad diagrams</h4></div></div></div><div class="mediaobject"><img src="images/LanguageReference/AccumulateAction.png"/></div><div class="mediaobject"><img src="images/LanguageReference/AccumulateClause.png"/></div><div class="mediaobject"><img src="images/LanguageReference/AccumulateFunction.png"/></div><div class="mediaobject"><img src="images/LanguageReference/AccumulateInit.png"/></div><div class="mediaobject"><img src="images/LanguageReference/AccumulateResult.png"/></div><div class="mediaobject"><img src="images/LanguageReference/AccumulateReverse.png"/></div><div class="mediaobject"><img src="images/LanguageReference/AccumulateSteps.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Accumulations.png"/></div><div class="mediaobject"><img src="images/LanguageReference/AdditiveExpr.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Annotation.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Arguments.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ArrayCreatorRest.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ArrayInitializer.png"/></div><div class="mediaobject"><img src="images/LanguageReference/AssignmentOperator.png"/></div><div class="mediaobject"><img src="images/LanguageReference/BindingPattern.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Block.png"/></div><div class="mediaobject"><img src="images/LanguageReference/BooleanLiteral.png"/></div><div class="mediaobject"><img src="images/LanguageReference/CompilationUnit.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ConditionalAnd.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ConditionalElementAccumulate.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ConditionalElementEval.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ConditionalElementExists.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ConditionalElementForall.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ConditionalElementNot.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ConditionalElement.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ConditionalExpr.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ConditionalOrExpr.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ConditionalOr.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Constraints.png"/></div><div class="mediaobject"><img src="images/LanguageReference/CreatedName.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Creator.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Definition.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Digit.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ExplicitGenericInvocationSuffix.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ExplicitGenericInvocation.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Exponent.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ExpressionList.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Expression.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Field.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Fraction.png"/></div><div class="mediaobject"><img src="images/LanguageReference/FromAccumulateClause.png"/></div><div class="mediaobject"><img src="images/LanguageReference/FromClause.png"/></div><div class="mediaobject"><img src="images/LanguageReference/FromCollectClause.png"/></div><div class="mediaobject"><img src="images/LanguageReference/FunctionDefinition.png"/></div><div class="mediaobject"><img src="images/LanguageReference/GlobalDefinition.png"/></div><div class="mediaobject"><img src="images/LanguageReference/IdentifierSuffix.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ImportDefinition.png"/></div><div class="mediaobject"><img src="images/LanguageReference/InExpr.png"/></div><div class="mediaobject"><img src="images/LanguageReference/InlineListExpr.png"/></div><div class="mediaobject"><img src="images/LanguageReference/InlineMapExpr.png"/></div><div class="mediaobject"><img src="images/LanguageReference/InnerCreator.png"/></div><div class="mediaobject"><img src="images/LanguageReference/InstanceOfExpr.png"/></div><div class="mediaobject"><img src="images/LanguageReference/IntLiteral.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Literal.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ModifyStatement.png"/></div><div class="mediaobject"><img src="images/LanguageReference/NonWildcardTypeArguments.png"/></div><div class="mediaobject"><img src="images/LanguageReference/OrRestriction.png"/></div><div class="mediaobject"><img src="images/LanguageReference/OverClause.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Parameters.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Pattern.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Placeholders.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Primary.png"/></div><div class="mediaobject"><img src="images/LanguageReference/PrimitiveType.png"/></div><div class="mediaobject"><img src="images/LanguageReference/QualifiedName.png"/></div><div class="mediaobject"><img src="images/LanguageReference/QueryDefinition.png"/></div><div class="mediaobject"><img src="images/LanguageReference/QueryOptions.png"/></div><div class="mediaobject"><img src="images/LanguageReference/RealLiteral.png"/></div><div class="mediaobject"><img src="images/LanguageReference/RealTypeSuffix.png"/></div><div class="mediaobject"><img src="images/LanguageReference/RelationalExpr.png"/></div><div class="mediaobject"><img src="images/LanguageReference/RelationalOperator.png"/></div><div class="mediaobject"><img src="images/LanguageReference/RhsStatement.png"/></div><div class="mediaobject"><img src="images/LanguageReference/RuleAttributes.png"/></div><div class="mediaobject"><img src="images/LanguageReference/RuleAttribute.png"/></div><div class="mediaobject"><img src="images/LanguageReference/RuleDefinition.png"/></div><div class="mediaobject"><img src="images/LanguageReference/RuleOptions.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Selector.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ShiftExpr.png"/></div><div class="mediaobject"><img src="images/LanguageReference/SingleRestriction.png"/></div><div class="mediaobject"><img src="images/LanguageReference/SourcePattern.png"/></div><div class="mediaobject"><img src="images/LanguageReference/StringId.png"/></div><div class="mediaobject"><img src="images/LanguageReference/SuperSuffix.png"/></div><div class="mediaobject"><img src="images/LanguageReference/ThenPart.png"/></div><div class="mediaobject"><img src="images/LanguageReference/TypeArguments.png"/></div><div class="mediaobject"><img src="images/LanguageReference/TypeArgument.png"/></div><div class="mediaobject"><img src="images/LanguageReference/TypeDefinition.png"/></div><div class="mediaobject"><img src="images/LanguageReference/TypeOptions.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Type.png"/></div><div class="mediaobject"><img src="images/LanguageReference/UnaryExprNotPlusMinus.png"/></div><div class="mediaobject"><img src="images/LanguageReference/UnaryExpr.png"/></div><div class="mediaobject"><img src="images/LanguageReference/Value.png"/></div><div class="mediaobject"><img src="images/LanguageReference/VariableInitializer.png"/></div><div class="mediaobject"><img src="images/LanguageReference/WhenPart.png"/></div></div></div><div class="section" title="8.8.4. The Right Hand Side (then)"><div class="titlepage"><div><div><h3 class="title"><a id="d0e11687"/>8.8.4. The Right Hand Side (then)</h3></div></div></div><div class="section" title="8.8.4.1. Usage"><div class="titlepage"><div><div><h4 class="title"><a id="d0e11690"/>8.8.4.1. Usage</h4></div></div></div><p>The Right Hand Side (RHS) is a common name for the consequence or
      action part of the rule; this part should contain a list of actions to
      be executed. It is bad practice to use imperative or conditional code in
      the RHS of a rule; as a rule should be atomic in nature - "when this,
      then do this", not "when this, maybe do this". The RHS part of a rule
      should also be kept small, thus keeping it declarative and readable. If
      you find you need imperative and/or conditional code in the RHS, then
      maybe you should be breaking that rule down into multiple rules. The
      main purpose of the RHS is to insert, delete or modify working memory
      data. To assist with that there are a few convenience methods you can
      use to modify working memory; without having to first reference a
      working memory instance.</p><p><code class="literal">update(</code><span class="emphasis"><em>object,
      handle</em></span><code class="literal">);</code> will tell the engine that an
      object has changed (one that has been bound to something on the LHS) and
      rules may need to be reconsidered.</p><p><code class="literal">update(</code><span class="emphasis"><em>object</em></span><code class="literal">);</code>
      can also be used; here the Knowledge Helper will look up the facthandle
      for you, via an identity check, for the passed object. (Note that if you
      provide Property Change Listeners to your Java beans that you are
      inserting into the engine, you can avoid the need to call
      <code class="code">update()</code> when the object changes.). After a fact's field
      values have changed you must call update before changing another fact,
      or you will cause problems with the indexing within the rule engine. The
      modify keyword avoids this problem.</p><p><code class="literal">insert(new</code>
      <span class="emphasis"><em>Something</em></span><code class="literal">());</code> will place a new
      object of your creation into the Working Memory.</p><p><code class="literal">insertLogical(new</code>
      <span class="emphasis"><em>Something</em></span><code class="literal">());</code> is similar to
      insert, but the object will be automatically deleted when there are no
      more facts to support the truth of the currently firing rule.</p><p><code class="literal">delete(</code><span class="emphasis"><em>handle</em></span><code class="literal">);</code>
      removes an object from Working Memory.</p><p>These convenience methods are basically macros that provide short
      cuts to the <code class="code">KnowledgeHelper</code> instance that lets you access
      your Working Memory from rules files. The predefined variable
      <code class="code">drools</code> of type <code class="code">KnowledgeHelper</code> lets you call
      several other useful methods. (Refer to the <code class="code">KnowledgeHelper</code>
      interface documentation for more advanced operations).</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The call <code class="code">drools.halt()</code> terminates rule execution
          immediately. This is required for returning control to the point
          whence the current session was put to work with
          <code class="code">fireUntilHalt()</code>.</p></li><li class="listitem"><p>Methods <code class="code">insert(Object o)</code>, <code class="code">update(Object
          o)</code> and <code class="code">delete(Object o)</code> can be called on
          <code class="code">drools</code> as well, but due to their frequent use they can
          be called without the object reference.</p></li><li class="listitem"><p><code class="code">drools.getWorkingMemory()</code> returns the
          <code class="code">WorkingMemory</code> object.</p></li><li class="listitem"><p><code class="code">drools.setFocus( String s)</code> sets the focus to the
          specified agenda group.</p></li><li class="listitem"><p><code class="code">drools.getRule().getName()</code>, called from a rule's
          RHS, returns the name of the rule.</p></li><li class="listitem"><p><code class="code">drools.getTuple()</code> returns the Tuple that matches
          the currently executing rule, and
          <code class="code">drools.getActivation()</code> delivers the corresponding
          Activation. (These calls are useful for logging and debugging
          purposes.)</p></li></ul></div><p>The full Knowledge Runtime API is exposed through another
      predefined variable, <code class="code">kcontext</code>, of type
      <code class="code">KieContext</code>. Its method <code class="code">getKieRuntime()</code> delivers
      an object of type <code class="code">KieRuntime</code>, which, in turn, provides access to a
      wealth of methods, many of which are quite useful for coding RHS
      logic.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The call <code class="code">kcontext.getKieRuntime().halt()</code>
          terminates rule execution immediately.</p></li><li class="listitem"><p>The accessor <code class="code">getAgenda()</code> returns a reference to
          this session's <code class="code">Agenda</code>, which in turn provides access to
          the various rule groups: activation groups, agenda groups, and rule
          flow groups. A fairly common paradigm is the activation of some
          agenda group, which could be done with the lengthy call:</p><pre><code class="language-java">// give focus to the agenda group CleanUp
kcontext.getKieRuntime().getAgenda().getAgendaGroup( "CleanUp" ).setFocus();</code></pre><p>(You can achieve the same using <code class="code">drools.setFocus(
          "CleanUp" )</code>.)</p></li><li class="listitem"><p>To run a query, you call <code class="code">getQueryResults(String
          query)</code>, whereupon you may process the results, as explained
          in section <a class="link" href="#QuerySection" title="8.9. Query">Query</a>. Using <code class="code">kcontext.getKieRuntime().getQueryResults(...)</code>
          or using <code class="code">drools.getKieRuntime().getQueryResults(...)</code> is the
          proper method of running a query from a rule's RHS, and the only supported way.
          </p></li><li class="listitem"><p>A set of methods dealing with event management lets you, among
          other things, add and remove event listeners for the Working Memory
          and the Agenda.</p></li><li class="listitem"><p>Method <code class="code">getKieBase()</code> returns the
          <code class="code">KieBase</code> object, the backbone of all the Knowledge
          in your system, and the originator of the current session.</p></li><li class="listitem"><p>You can manage globals with <code class="code">setGlobal(...)</code>,
          <code class="code">getGlobal(...)</code> and <code class="code">getGlobals()</code>.</p></li><li class="listitem"><p>Method <code class="code">getEnvironment()</code> returns the runtime's
          <code class="code">Environment</code> which works much like what you know as your
          operating system's environment.</p></li></ul></div></div><div class="section" title="8.8.4.2. The modify Statement"><div class="titlepage"><div><div><h4 class="title"><a id="d0e11890"/>8.8.4.2. The <code class="literal">modify</code> Statement</h4></div></div></div><p>This language extension provides a structured approach to fact
      updates. It combines the update operation with a number of setter calls
      to change the object's fields. This is the syntax schema for the
      <code class="literal">modify</code> statement:</p><pre><code class="no-highlight"><code class="literal">modify ( </code><em class="replaceable"><code>&lt;fact-expression&gt;</code></em><code class="literal"> ) {</code>
    <em class="replaceable"><code>&lt;expression&gt;</code></em> [ <code class="literal">,</code> <em class="replaceable"><code>&lt;expression&gt;</code></em> ]*
<code class="literal">}</code></code></pre><p>The parenthesized <span class="emphasis"><em>&lt;fact-expression&gt;</em></span>
      must yield a fact object reference. The expression list in the block
      should consist of setter calls for the given object, to be written
      without the usual object reference, which is automatically prepended by
      the compiler.</p><p>The example illustrates a simple fact modification.</p><div class="example"><a id="d0e11927"/><p class="title"><strong>Example 8.83. A modify statement</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "modify stilton"
when
    $stilton : Cheese(type == "stilton")
then
    modify( $stilton ){
        setPrice( 20 ),
        setAge( "overripe" )
    }
end</code></pre></div></div><br class="example-break"/><p>The advantages in using the modify statment are particularly clear when
      used in conjuction with fine grained property change listeners.
      See the corresponding section for more details.</p></div></div><div class="section" title="8.8.5. Conditional named consequences"><div class="titlepage"><div><div><h3 class="title"><a id="d0e11934"/>8.8.5. Conditional named consequences</h3></div></div></div><p>Sometimes the constraint of having one single consequence for each rule can
    be somewhat limiting and leads to verbose and difficult to be maintained repetitions
    like in the following example:</p><pre><code class="no-highlight">rule "Give 10% discount to customers older than 60"
when
    $customer : Customer( age &gt; 60 )
then
    modify($customer) { setDiscount( 0.1 ) };
end

rule "Give free parking to customers older than 60"
when
    $customer : Customer( age &gt; 60 )
    $car : Car ( owner == $customer )
then
    modify($car) { setFreeParking( true ) };
end</code></pre><p>It is already possible to partially overcome this problem by making the
    second rule extending the first one like in:</p><pre><code class="no-highlight">rule "Give 10% discount to customers older than 60"
when
    $customer : Customer( age &gt; 60 )
then
    modify($customer) { setDiscount( 0.1 ) };
end

rule "Give free parking to customers older than 60"
    extends "Give 10% discount to customers older than 60"
when
    $car : Car ( owner == $customer )
then
    modify($car) { setFreeParking( true ) };
end</code></pre><p>Anyway this feature makes it possible to define more labelled consequences
    other than the default one in a single rule, so, for example, the 2 former rules
    can be compacted in only one like it follows:</p><pre><code class="no-highlight">rule "Give 10% discount and free parking to customers older than 60"
when
    $customer : Customer( age &gt; 60 )
    do[giveDiscount]
    $car : Car ( owner == $customer )
then
    modify($car) { setFreeParking( true ) };
then[giveDiscount]
    modify($customer) { setDiscount( 0.1 ) };
end</code></pre><p>This last rule has 2 consequences, the usual default one, plus another one
    named "giveDiscount" that is activated, using the keyword do, as soon as a customer
    older than 60 is found in the knowledge base, regardless of the fact that he owns a
    car or not. The activation of a named consequence can be also guarded by an additional
    condition like in this further example:</p><pre><code class="no-highlight">rule "Give free parking to customers older than 60 and 10% discount to golden ones among them"
when
    $customer : Customer( age &gt; 60 )
    if ( type == "Golden" ) do[giveDiscount]
    $car : Car ( owner == $customer )
then
    modify($car) { setFreeParking( true ) };
then[giveDiscount]
    modify($customer) { setDiscount( 0.1 ) };
end</code></pre><p>The condition in the if statement is always evaluated on the pattern immediately
    preceding it. In the end this last, a bit more complicated, example shows how it is
    possible to switch over different conditions using a nested if/else statement:</p><pre><code class="no-highlight">rule "Give free parking and 10% discount to over 60 Golden customer and 5% to Silver ones"
when
    $customer : Customer( age &gt; 60 )
    if ( type == "Golden" ) do[giveDiscount10]
    else if ( type == "Silver" ) break[giveDiscount5]
    $car : Car ( owner == $customer )
then
    modify($car) { setFreeParking( true ) };
then[giveDiscount10]
    modify($customer) { setDiscount( 0.1 ) };
then[giveDiscount5]
    modify($customer) { setDiscount( 0.05 ) };
end</code></pre><p>Here the purpose is to give a 10% discount AND a free parking to Golden customers
    over 60, but only a 5% discount (without free parking) to the Silver ones. This result
    is achieved by activating the consequence named "giveDiscount5" using the keyword break
    instead of do. In fact do just schedules a consequence in the agenda, allowing the
    remaining part of the LHS to continue of being evaluated as per normal, while break also
    blocks any further pattern matching evaluation. Note, of course, that the activation of
    a named consequence not guarded by any condition with break doesn't make sense (and
    generates a compile time error) since otherwise the LHS part following it would be never
    reachable.</p></div><div class="section" title="8.8.6. A Note on Auto-boxing and Primitive Types"><div class="titlepage"><div><div><h3 class="title"><a id="d0e11959"/>8.8.6. A Note on Auto-boxing and Primitive Types</h3></div></div></div><p>Drools attempts to preserve numbers in their primitive or object
    wrapper form, so a variable bound to an int primitive when used in a code
    block or expression will no longer need manual unboxing; unlike Drools 3.0
    where all primitives were autoboxed, requiring manual unboxing. A variable
    bound to an object wrapper will remain as an object; the existing JDK 1.5
    and JDK 5 rules to handle auto-boxing and unboxing apply in this case.
    When evaluating field constraints, the system attempts to coerce one of
    the values into a comparable format; so a primitive is comparable to an
    object wrapper.</p></div></div><div class="section" title="8.9. Query"><div class="titlepage"><div><div><h2 class="title"><a id="QuerySection"/>8.9. Query</h2></div></div></div><div class="figure"><a id="d0e11967"/><p class="title"><strong>Figure 8.29. query</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/LanguageReference/query.png" align="middle" alt="query"/></div></div></div><br class="figure-break"/><p>A query is a simple way to search the working memory for facts that
  match the stated conditions. Therefore, it contains only the structure of
  the LHS of a rule, so that you specify neither "when" nor "then". A query
  has an optional set of parameters, each of which can be optionally typed. If
  the type is not given, the type Object is assumed. The engine will attempt
  to coerce the values as needed. Query names are global to the KieBase;
  so do not add queries of the same name to different packages for the same
  RuleBase.</p><p>To return the results use
  <code class="code">ksession.getQueryResults("name")</code>, where "name" is the query's
  name. This returns a list of query results, which allow you to retrieve the
  objects that matched the query.</p><p>The first example presents a simple query for all the people over the
  age of 30. The second one, using parameters, combines the age limit with a
  location.</p><div class="example"><a id="d0e11982"/><p class="title"><strong>Example 8.84. Query People over the age of 30</strong></p><div class="example-contents"><pre><code class="no-highlight">query "people over the age of 30" 
    person : Person( age &gt; 30 )
end</code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e11987"/><p class="title"><strong>Example 8.85. Query People over the age of x, and who live in y</strong></p><div class="example-contents"><pre><code class="no-highlight">query "people over the age of x"  (int x, String y)
    person : Person( age &gt; x, location == y )
end</code></pre></div></div><br class="example-break"/><p>We iterate over the returned QueryResults using a standard "for" loop.
  Each element is a QueryResultsRow which we can use to access each of the
  columns in the tuple. These columns can be accessed by bound declaration
  name or index position.</p><div class="example"><a id="d0e11994"/><p class="title"><strong>Example 8.86. Query People over the age of 30</strong></p><div class="example-contents"><pre><code class="no-highlight">QueryResults results = ksession.getQueryResults( "people over the age of 30" );
System.out.println( "we have " + results.size() + " people over the age  of 30" );

System.out.println( "These people are are over 30:" );

for ( QueryResultsRow row : results ) {
    Person person = ( Person ) row.get( "person" );
    System.out.println( person.getName() + "\n" );
}</code></pre></div></div><br class="example-break"/><p>Support for positional syntax has been added for more compact code. By
  default the declared type order in the type declaration matches the argument
  position. But it possible to override these using the @position annotation.
  This allows patterns to be used with positional arguments, instead of the
  more verbose named arguments.</p><pre><code class="no-highlight">declare Cheese
    name : String @position(1)
    shop : String @position(2)
    price : int @position(0)
end
</code></pre><p>The @Position annotation, in the org.drools.definition.type package,
  can be used to annotate original pojos on the classpath. Currently only
  fields on classes can be annotated. Inheritance of classes is supported, but
  not interfaces or methods. The isContainedIn query below demonstrates the
  use of positional arguments in a pattern; <code class="literal">Location(x, y;)</code>
  instead of <code class="literal">Location( thing == x, location == y).</code></p><p>Queries can now call other queries, this combined with optional query
  arguments provides derivation query style backward chaining. Positional and
  named syntax is supported for arguments. It is also possible to mix both
  positional and named, but positional must come first, separated by a semi
  colon. Literal expressions can be passed as query arguments, but at this
  stage you cannot mix expressions with variables. Here is an example of a
  query that calls another query. Note that 'z' here will always be an 'out'
  variable. The '?' symbol means the query is pull only, once the results are
  returned you will not receive further results as the underlying data
  changes.</p><pre><code class="no-highlight">declare Location
    thing : String 
    location : String 
end

query isContainedIn( String x, String y ) 
    Location(x, y;)
    or 
    ( Location(z, y;) and ?isContainedIn(x, z;) )
end</code></pre><p>As previously mentioned you can use live "open" queries to reactively
  receive changes over time from the query results, as the underlying data it
  queries against changes. Notice the "look" rule calls the query without
  using '?'.</p><pre><code class="no-highlight">query isContainedIn( String x, String y ) 
    Location(x, y;)
    or 
    ( Location(z, y;) and isContainedIn(x, z;) )
end

rule look when 
    Person( $l : likes ) 
    isContainedIn( $l, 'office'; )
then
   insertLogical( $l 'is in the office' );
end 
</code></pre><p>Drools supports unification for derivation queries, in short this
    means that arguments are optional. It is possible to call queries from Java
    leaving arguments unspecified using the static field
    org.drools.core.runtime.rule.Variable.v - note you must use 'v' and not an
    alternative instance of Variable. These are referred to as 'out' arguments.
    Note that the query itself does not declare at compile time whether an
    argument is in or an out, this can be defined purely at runtime on each use.
    The following example will return all objects contained in the
    office.</p><pre><code class="no-highlight">results = ksession.getQueryResults( "isContainedIn", new Object[] {  Variable.v, "office" } );
l = new ArrayList&lt;List&lt;String&gt;&gt;();
for ( QueryResultsRow r : results ) {
    l.add( Arrays.asList( new String[] { (String) r.get( "x" ), (String) r.get( "y" ) } ) );
}  
</code></pre><p>The algorithm uses stacks to handle recursion, so the method stack
  will not blow up.</p><p>It is also possible to use as input argument for a query both the field of a fact as in:</p><pre><code class="no-highlight">query contains(String $s, String $c)
    $s := String( this.contains( $c ) )
end

rule PersonNamesWithA when
    $p : Person()
    contains( $p.name, "a"; )
then
end</code></pre><p>and more in general any kind of valid expression like in:</p><pre><code class="no-highlight">query checkLength(String $s, int $l)
    $s := String( length == $l )
end

rule CheckPersonNameLength when
    $i : Integer()
    $p : Person()
    checkLength( $p.name, 1 + $i + $p.age; )
then
end</code></pre><p>The following is not yet supported:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>List and Map unification</p></li><li class="listitem"><p>Expression unification - pred( X, X + 1, X * Y / 7 )</p></li></ul></div></div><div class="section" title="8.10. Domain Specific Languages"><div class="titlepage"><div><div><h2 class="title"><a id="d0e12041"/>8.10. Domain Specific Languages</h2></div></div></div><p><a id="d0e12045" class="indexterm"/>Domain Specific Languages (or DSLs) are a way of creating a rule
  language that is dedicated to your problem domain. A set of DSL definitions
  consists of transformations from DSL "sentences" to DRL constructs, which lets
  you use of all the underlying rule language and engine features. Given a
  DSL, you write rules in DSL rule (or DSLR) files, which will be translated
  into DRL files.</p><p>DSL and DSLR files are plain text files, and you can use any text
  editor to create and modify them. But there are also DSL and DSLR editors,
  both in the IDE as well as in the web based BRMS, and you can use those
  as well, although they may not provide you with the full DSL functionality.
  </p><div class="section" title="8.10.1. When to Use a DSL"><div class="titlepage"><div><div><h3 class="title"><a id="d0e12051"/>8.10.1. When to Use a DSL</h3></div></div></div><p>DSLs can serve as a layer of separation between rule authoring (and
    rule authors) and the technical intricacies resulting from the modelling
    of domain object and the rule engine's native language and methods. If your
    rules need to be read and validated by domain experts (such as business
    analysts, for instance) who are not programmers, you should consider 
    using a DSL; it hides implementation details and focuses on the rule logic
    proper. DSL sentences can also act as "templates" for conditional elements and
    consequence actions that are used repeatedly in your rules, possibly with
    minor variations. You may define DSL sentences as being mapped to these
    repeated phrases, with parameters providing a means for accommodating those
    variations.</p><p>DSLs have no impact on the rule engine at runtime, they are just a
    compile time feature, requiring a special parser and transformer.</p></div><div class="section" title="8.10.2. DSL Basics"><div class="titlepage"><div><div><h3 class="title"><a id="d0e12058"/>8.10.2. DSL Basics</h3></div></div></div><p>The Drools DSL mechanism allows you to customise conditional
    expressions and consequence actions. A global substitution mechanism
    ("keyword") is also available.</p><div class="example"><a id="d0e12063"/><p class="title"><strong>Example 8.87. Example <a id="d0e12066" class="indexterm"/>DSL mapping</strong></p><div class="example-contents"><pre><code class="no-highlight">[when]Something is {colour}=Something(colour=="{colour}")</code></pre></div></div><br class="example-break"/><p>In the preceding example, <code class="code">[when]</code> indicates the scope of
    the expression, i.e., whether it is valid for the LHS or the RHS of a rule. The
    part after the bracketed keyword is the expression that you use in the rule;
    typically a natural language expression, but it doesn't have to be. The
    part to the right of the equal sign ("=") is the mapping of the expression into
    the rule language. The form of this string depends on its destination, RHS or 
    LHS. If it is for the LHS, then it ought to be a term according to the regular
    LHS syntax; if it is for the RHS then it might be a Java statement.</p><p>Whenever the DSL parser matches a line from the rule file written in the
    DSL with an expression in the DSL definition, it performs three steps of
    string manipulation. First, it extracts the string values appearing where the
    expression contains variable names in braces (here: <code class="code">{colour}</code>). Then,
    the values obtained from these captures are then interpolated wherever that name,
    again enclosed in braces, occurs on the right hand side of the mapping. Finally, the
    interpolated string replaces whatever was matched by the entire expression
    in the line of the DSL rule file.</p><p>Note that the expressions (i.e., the strings on the left hand side of the
    equal sign) are used as regular expressions in a pattern matching operation
    against a line of the DSL rule file, matching all or part of a line. This means
    you can use (for instance) a '?' to indicate that the preceding character is
    optional. One good reason to use this is to overcome variations in natural language
    phrases of your DSL. But, given that these expressions are regular
    expression patterns, this also means that all "magic" characters of Java's
    pattern syntax have to be escaped with a preceding backslash ('\').</p><p>It is important to note that the compiler transforms DSL rule files
    line by line. In the above example, all the text after "Something is " to
    the end of the line is captured as the replacement value for "{colour}",
    and this is used for interpolating the target string. This may not be exactly
    what you want. For instance, when you intend to merge different DSL
    expressions to generate a composite DRL pattern, you need to transform a DSLR
    line in several independent operations. The best way to achieve this is to
    ensure that the captures are surrounded by characteristic text - words or 
    even single characters. As a result,
    the matching operation done by the parser plucks out a substring from 
    somewhere within the line. In the example below, quotes are used as 
    distinctive characters. Note that the characters that surround the capture
    are not included during interpolation, just the contents between them.</p><p>As a rule of thumb, use quotes for textual data that a rule editor
    may want to enter. You can also enclose the capture with words to ensure
    that the text is correctly matched. Both is illustrated by the following
    example. Note that a single line such as <code class="code">Something is "green" and
    another solid thing</code> is now correctly expanded.</p><div class="example"><a id="d0e12091"/><p class="title"><strong>Example 8.88. Example with quotes</strong></p><div class="example-contents"><pre><code class="no-highlight">[when]something is "{colour}"=Something(colour=="{colour}")
[when]another {state} thing=OtherThing(state=="{state})"</code></pre></div></div><br class="example-break"/><p>It is a good idea to avoid punctuation (other than quotes or
    apostrophes) in your DSL expressions as much as possible. The main reason
    is that punctuation is easy to forget for rule authors using your DSL.
    Another reason is that parentheses, the period and the question mark are magic
    characters, requiring escaping in the DSL definition.</p><p>In a DSL mapping, the braces "{" and "}" should only be used to
    enclose a variable definition or reference, resulting in a capture. If they
    should occur literally, either in the expression or within the replacement
    text on the right hand side, they must be escaped with a preceding backslash
    ("\"):</p><pre><code class="no-highlight">[then]do something= if (foo) \{ doSomething(); \}
    </code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If braces "{" and "}" should appear in the replacement string of a
    DSL definition, escape them with a backslash ('\').</p></div><div class="example"><a id="d0e12105"/><p class="title"><strong>Example 8.89. Examples of DSL mapping entries</strong></p><div class="example-contents"><pre><code class="no-highlight"># This is a comment to be ignored.
[when]There is a person with name of "{name}"=Person(name=="{name}")
[when]Person is at least {age} years old and lives in "{location}"=
      Person(age &gt;= {age}, location=="{location}")
[then]Log "{message}"=System.out.println("{message}");
[when]And = and</code></pre></div></div><br class="example-break"/><p>Given the above DSL examples, the following examples show the expansion of various
    DSLR snippets:</p><div class="example"><a id="d0e12112"/><p class="title"><strong>Example 8.90. Examples of DSL expansions </strong></p><div class="example-contents"><pre><code class="no-highlight">There is a person with name of "Kitty"
   ==&gt; Person(name="Kitty")
Person is at least 42 years old and lives in "Atlanta"
   ==&gt; Person(age &gt;= 42, location="Atlanta")
Log "boo"
   ==&gt; System.out.println("boo");
There is a person with name of "Bob" and Person is at least 30 years old and lives in "Utah"
   ==&gt; Person(name="Bob") and Person(age &gt;= 30, location="Utah")</code></pre></div></div><br class="example-break"/><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Don't forget that if you are capturing plain text from a DSL rule line
    and want to use it as a string literal in the expansion, you must provide
    the quotes on the right hand side of the mapping.</p></div><p>You can chain DSL expressions together on one line, as long as it is
    clear to the parser where one ends and the next one begins and where the
    text representing a parameter ends. (Otherwise you risk getting all the
    text until the end of the line as a parameter value.) The DSL expressions are
    tried, one after the other, according to their order in the DSL definition
    file. After any match, all remaining DSL expressions are investigated,
    too.</p><p>The resulting DRL text may consist of more than one line. Line ends
    are in the replacement text are written as <code class="code">\n</code>.</p></div><div class="section" title="8.10.3. Adding Constraints to Facts"><div class="titlepage"><div><div><h3 class="title"><a id="d0e12127"/>8.10.3. Adding Constraints to Facts</h3></div></div></div><p>A common requirement when writing rule conditions is to be able to
    add an arbitrary combination of constraints to a pattern. Given that a
    fact type may have many fields, having to provide an individual DSL
    statement for each combination would be plain folly.</p><p>The DSL facility allows you to add constraints to a pattern by a
    simple convention: if your DSL expression starts with a hyphen
    (minus character, "-") it is assumed to be a field constraint and,
    consequently, is is added to the last pattern line preceding it.</p><p>For an example, lets take look at class <code class="code">Cheese</code>,
    with the following fields: type, price, age and country. We can
    express some LHS condition in normal DRL like the following</p><pre><code class="no-highlight">Cheese(age &lt; 5, price == 20, type=="stilton", country=="ch")</code></pre><p>The DSL definitions given below result in three DSL phrases which
    may be used to create any combination of constraint involving these fields.</p><pre><code class="no-highlight">[when]There is a Cheese with=Cheese()
[when]- age is less than {age}=age&lt;{age}
[when]- type is '{type}'=type=='{type}'
[when]- country equal to '{country}'=country=='{country}'</code></pre><p>You can then write rules with conditions like the following:
    </p><pre><code class="no-highlight">There is a Cheese with
        - age is less than 42
        - type is 'stilton'</code></pre><p> The parser will pick up a line
    beginning with "-" and add it as a constraint to  the preceding pattern,
    inserting a comma when it is required. For the preceding example, the
    resulting DRL is: </p><pre><code class="no-highlight">Cheese(age&lt;42, type=='stilton')</code></pre><p>
    </p><p>Combining all all numeric fields with all relational operators
    (according to the DSL expression "age is less than..." in the preceding
    example) produces an unwieldy amount of DSL entries. But you can define
    DSL phrases for the various operators and even a generic expression
    that handles any field constraint, as shown below. (Notice that
    the expression definition contains a regular expression in addition
    to the variable name.)</p><pre><code class="no-highlight">[when][]is less than or equal to=&lt;=
[when][]is less than=&lt;
[when][]is greater than or equal to=&gt;=
[when][]is greater than=&gt;
[when][]is equal to===
[when][]equals===
[when][]There is a Cheese with=Cheese()
[when][]- {field:\w*} {operator} {value:\d*}={field} {operator} {value} </code></pre><p>Given these DSL definitions, you can write rules with conditions
    such as:</p><pre><code class="no-highlight">There is a Cheese with
   - age is less than 42
   - rating is greater than 50
   - type equals 'stilton'</code></pre><p>In this specific case, a phrase such as "is less than" is replaced by
    <code class="code">&lt;</code>, and then the line matches the last DSL entry. This
    removes the hyphen, but the final result is still added as a constraint
    to the preceding pattern. After processing all of the lines, the resulting
    DRL text is:</p><pre><code class="no-highlight">Cheese(age&lt;42, rating &gt; 50, type=='stilton')</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The order of the entries in the DSL is important if separate DSL
    expressions are intended to match the same line, one after the other.</p></div></div><div class="section" title="8.10.4. Developing a DSL"><div class="titlepage"><div><div><h3 class="title"><a id="d0e12171"/>8.10.4. Developing a DSL</h3></div></div></div><p>A good way to get started is to write representative samples of the
    rules your application requires, and to test them as you develop. This will
    provide you with a stable framework of conditional elements and their
    constraints. Rules, both in DRL and in DSLR, refer to entities according
    to the data model representing the application data that should be subject
    to the reasoning process defined in rules. Notice that writing rules
    is generally easier if most of the data model's types are facts.</p><p>Given an initial set of rules, it should be possible to identify
    recurring or similar code snippets and to mark variable parts as
    parameters. This provides reliable leads as to what might be a handy
    DSL entry. Also, make sure you have a full grasp of the jargon the 
    domain experts are using, and base your DSL phrases on this vocabulary.</p><p>You may postpone implementation decisions concerning conditions
    and actions during this first design phase by leaving certain conditional
    elements and actions in their DRL form by prefixing a line with a
    greater sign ("&gt;"). (This is also handy for inserting debugging
    statements.)</p><p>During the next development phase, you should find that the DSL
    configuration stabilizes pretty quickly. New rules can be written by
    reusing the existing DSL definitions, or by adding a parameter to an
    existing condition or consequence entry.</p><p>Try to keep the number of DSL entries small. Using parameters
    lets you apply the same DSL sentence for similar rule patterns or
    constraints. But do not exaggerate: authors using the DSL should still
    be able to identify DSL phrases by some fixed text.</p></div><div class="section" title="8.10.5. DSL and DSLR Reference"><div class="titlepage"><div><div><h3 class="title"><a id="d0e12184"/>8.10.5. DSL and DSLR Reference</h3></div></div></div><p>A DSL file is a text file in a line-oriented format. Its
    entries are used for transforming a DSLR file into a file according
    to DRL syntax.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A line starting with "#" or "//"
        (with or without preceding white space) is treated as a comment.
        A comment line starting with "#/" is scanned for
        words requesting a debug option, see below.</p></li><li class="listitem"><p>Any line starting with an opening bracket ("[") is assumed to
        be the first line of a DSL entry definition.</p></li><li class="listitem"><p>Any other line is appended to the preceding DSL entry
        definition, with the line end replaced by a space.</p></li></ul></div><p>A DSL entry consists of the following four parts:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A scope definition, written as one of the keywords
        "when" or "condition", "then" or "consequence", "*"
        and "keyword", enclosed in brackets ("[" and "]"). This indicates
        whether the DSL entry is valid for the condition or the
        consequence of a rule, or both. A scope indication of "keyword"
        means that the entry has global significance, i.e., it is
        recognized anywhere in a DSLR file.</p></li><li class="listitem"><p>A type definition, written as a Java class name,
        enclosed in brackets. This part is optional unless the
        the next part begins with an opening bracket. An empty
        pair of brackets is valid, too.</p></li><li class="listitem"><p>A DSL expression consists of a (Java) regular expression,
        with any number of embedded <span class="emphasis"><em>variable definitions,</em></span>
        terminated by an equal sign ("="). A variable definition is enclosed
        in braces ("{" and "}"). It
        consists of a variable name and two optional attachments, separated
        by colons (":"). If there is one attachment, it is a regular expression
        for matching text that is to be assigned to the variable; if there
        are two attachments, the first one is a hint for the GUI
        editor and the second one the regular expression.</p><p>Note that all characters that are "magic" in regular
        expressions must be escaped with a preceding backslash ("\")
        if they should occur literally within the expression.</p></li><li class="listitem"><p>The remaining part of the line after the delimiting equal
        sign is the replacement text for any DSLR text matching the
        regular expression. It may contain variable references, i.e.,
        a variable name enclosed in braces. Optionally, the variable name
        may be followed by an exclamation mark ("!") and a transformation
        function, see below.</p><p>Note that braces ("{" and "}") must be escaped with a
        preceding backslash ("\") if they should occur literally
        within the replacement string.</p></li></ul></div><p>Debugging of DSL expansion can be turned on, selectively,
    by using a comment line starting with "#/" which
    may contain one or more words from the table presented below.
    The resulting output is written to standard output.</p><div class="table"><a id="d0e12223"/><p class="title"><strong>Table 8.2. Debug options for DSL expansion</strong></p><div class="table-contents"><table summary="Debug options for DSL expansion" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Word</th><th>Description</th></tr></thead><tbody><tr><td>result</td><td>Prints the resulting DRL text, with line numbers.</td></tr><tr><td>steps</td><td>Prints each expansion step of condition and consequence
            lines.</td></tr><tr><td>keyword</td><td>Dumps the internal representation of all DSL entries with
            scope "keyword".</td></tr><tr><td>when</td><td>Dumps the internal representation of all DSL entries with
            scope "when" or "*".</td></tr><tr><td>then</td><td>Dumps the internal representation of all DSL entries with
            scope "then" or "*".</td></tr><tr><td>usage</td><td>Displays a usage statistic of all DSL entries.</td></tr></tbody></table></div></div><br class="table-break"/><p>Below are some sample DSL definitions, with comments describing the
    language features they illustrate.</p><pre><code class="no-highlight"># Comment: DSL examples

#/ debug: display result and usage

# keyword definition: replaces "regula" by "rule"
[keyword][]regula=rule

# conditional element: "T" or "t", "a" or "an", convert matched word
[when][][Tt]here is an? {entity:\w+}=
        ${entity!lc}: {entity!ucfirst} ()

# consequence statement: convert matched word, literal braces
[then][]update {entity:\w+}=modify( ${entity!lc} )\{ \}
</code></pre><p>The transformation of a DSLR file proceeds as follows:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The text is read into memory.</p></li><li class="listitem"><p>Each of the "keyword" entries is applied to the entire text.
        First, the regular expression from the keyword definition is modified
        by replacing white space sequences with a pattern matching any number
        of white space characters, and by replacing variable definitions with
        a capture made from the regular expression provided with the definition,
        or with the default (".*?"). Then, the DSLR text is searched exhaustively
        for occurrences of strings matching the modified regular expression.
        Substrings of a matching string corresponding to variable captures are
        extracted and replace variable references in the corresponding
        replacement text, and this text replaces the matching string in the
        DSLR text.</p></li><li class="listitem"><p>Sections of the DSLR text between "when" and "then", and
        "then" and "end", respectively, are located and processed in a
        uniform manner, line by line, as described below.</p><p>For a line, each DSL entry pertaining to the line's section
        is taken in turn, in the order it appears in the DSL file. Its
        regular expression part is modified: white space is replaced by
        a pattern matching any number of white space characters; variable
        definitions with a regular expression are replaced by a capture
        with this regular expression, its default being ".*?".
        If the resulting regular expression matches all or part of the
        line, the matched part is replaced by the suitably modified
        replacement text.</p><p>Modification of the replacement text is done by replacing
        variable references with the text corresponding to the regular
        expression capture. This text may be modified according to the
        string transformation function given in the variable reference;
        see below for details.</p><p>If there is a variable reference naming a variable that is not
        defined in the same entry, the expander substitutes a value bound to
        a variable of that name, provided it was defined in one of the
        preceding lines of the current rule.</p></li><li class="listitem"><p>If a DSLR line in a condition is written with a leading
        hyphen, the expanded result is inserted into the last line, which
        should contain a pattern CE, i.e., a type name followed by a pair
        of parentheses. if this pair is empty, the expanded line (which
        should contain a valid constraint) is simply inserted, otherwise
        a comma (",") is inserted beforehand.  </p><p>If a DSLR line in a consequence is written with a leading
        hyphen, the expanded result is inserted into the last line, which
        should contain a "modify" statement, ending in a pair of braces
        ("{" and "}"). If this pair is empty, the expanded line (which
        should contain a valid method call) is simply inserted, otherwise
        a comma (",") is inserted beforehand.
        </p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>It is currently <span class="emphasis"><em>not</em></span> possible to use a line
    with a leading hyphen to insert text into other conditional element
    forms (e.g., "accumulate") or it may only work for the first insertion
    (e.g., "eval").</p></div><p>All string transformation functions are described in the following
    table.</p><div class="table"><a id="d0e12299"/><p class="title"><strong>Table 8.3. String transformation functions</strong></p><div class="table-contents"><table summary="String transformation functions" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>uc</td><td>Converts all letters to upper case.</td></tr><tr><td>lc</td><td>Converts all letters to lower case.</td></tr><tr><td>ucfirst</td><td>Converts the first letter to upper case, and
            all other letters to lower case.</td></tr><tr><td>num</td><td>Extracts all digits and "-" from the string. If the
            last two digits in the original string are preceded by "." or
            ",", a decimal period is inserted in the corresponding position.</td></tr><tr><td><span class="emphasis"><em>a</em></span>?<span class="emphasis"><em>b</em></span>/<span class="emphasis"><em>c</em></span></td><td>Compares the string with string <span class="emphasis"><em>a</em></span>, and if they
            are equal, replaces it with <span class="emphasis"><em>b</em></span>, otherwise with
            <span class="emphasis"><em>c</em></span>. But <span class="emphasis"><em>c</em></span> can be another triplet
            <span class="emphasis"><em>a</em></span>, <span class="emphasis"><em>b</em></span>, <span class="emphasis"><em>c</em></span>, so
            that the entire structure is, in fact, a translation table.</td></tr></tbody></table></div></div><br class="table-break"/><p>The following DSL examples show how to use string transformation functions.</p><pre><code class="no-highlight"># definitions for conditions
[when][]There is an? {entity}=${entity!lc}: {entity!ucfirst}()
[when][]- with an? {attr} greater than {amount}={attr} &lt;= {amount!num}
[when][]- with a {what} {attr}={attr} {what!positive?&gt;0/negative?%lt;0/zero?==0/ERROR}</code></pre><p>A file containing a DSL definition has to be put under the resources folder
    or any of its subfolders like any other drools artifact. It must have the extension
    <code class="code">.dsl</code>, or alternatively be marked with type <code class="code">ResourceType.DSL</code>.
    when programmatically added to a <code class="code">KieFileSystem</code>. For a file using DSL
    definition, the extension <code class="code">.dslr</code> should be used, while it can be
    added to a <code class="code">KieFileSystem</code> with type <code class="code">ResourceType.DSLR</code>.</p><p>For parsing and expanding a DSLR file the DSL configuration is read
    and supplied to the parser. Thus, the parser can "recognize" the DSL
    expressions and transform them into native rule language expressions.</p></div></div></div><div class="chapter" title="Chapter 9. Complex Event Processing"><div class="titlepage"><div><div><h2 class="title"><a id="DroolsComplexEventProcessingChapter"/>Chapter 9. Complex Event Processing</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e12392">9.1. Complex Event Processing</a></span></dt><dt><span class="section"><a href="#d0e12443">9.2. Drools Fusion</a></span></dt><dt><span class="section"><a href="#d0e12545">9.3. Event Semantics</a></span></dt><dt><span class="section"><a href="#d0e12597">9.4. Event Processing Modes</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12604">9.4.1. Cloud Mode</a></span></dt><dt><span class="section"><a href="#d0e12635">9.4.2. Stream Mode</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e12715">9.5. Session Clock</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12746">9.5.1. Available Clock Implementations</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e12773">9.6. Sliding Windows</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12786">9.6.1. Sliding Time Windows</a></span></dt><dt><span class="section"><a href="#d0e12809">9.6.2. Sliding Length Windows</a></span></dt><dt><span class="section"><a href="#d0e12845">9.6.3. Window Declaration</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e12866">9.7. Streams Support</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12888">9.7.1. Declaring and Using Entry Points</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e12922">9.8. Memory Management for Events</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e12940">9.8.1. Explicit expiration offset</a></span></dt><dt><span class="section"><a href="#d0e12958">9.8.2. Inferred expiration offset</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e12978">9.9. Temporal Reasoning</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e13050">9.9.1. Temporal Operators</a></span></dt></dl></dd></dl></div><div class="section" title="9.1. Complex Event Processing"><div class="titlepage"><div><div><h2 class="title"><a id="d0e12392"/>9.1. Complex Event Processing</h2></div></div></div><p>There is no broadly accepted definition on the term Complex Event Processing. The term Event
    by itself is frequently overloaded and used to refer to several different things, depending on
    the context it is used. Defining terms is not the goal of this guide and as so, lets adopt a
    loose definition that, although not formal, will allow us to proceed with a common
    understanding.</p><p>So, in the scope of this guide:</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p><a id="d0e12401" class="indexterm"/>
      <span class="bold"><strong>Event</strong></span>, is a record of a significant change of state in the
      application domain at a given point in time.</p></div><p>For instance, on a Stock Broker application, when a sale operation is executed, it causes a
    change of state in the domain. This change of state can be observed on several entities in the
    domain, like the price of the securities that changed to match the value of the operation, the
    ownership of the traded assets that changed from the seller to the buyer, the balance of the
    accounts from both seller and buyer that are credited and debited, etc. Depending on how the
    domain is modelled, this change of state may be represented by a single event, multiple atomic
    events or even hierarchies of correlated events. In any case, in the context of this guide,
    Event is the record of the change of a particular piece of data in the domain.</p><p>Events are processed by computer systems since they were invented, and
  throughout the history, systems responsible for that were given different
  names and different methodologies were employed. It wasn't until the 90's
  though, that a more focused work started on EDA (Event Driven Architecture)
  with a more formal definition on the requirements and goals for event
  processing. Old messaging systems started to change to address such
  requirements and new systems started to be developed with the single purpose
  of event processing. Two trends were born under the names of Event Stream
  Processing and Complex Event Processing.</p><p>In the very beginnings, Event Stream Processing was focused on the capabilities of
    processing streams of events in (near) real time, while the main focus of Complex Event
    Processing was on the correlation and composition of atomic events into complex (compound)
    events. An important (maybe the most important) milestone was the publishing of Dr. David
    Luckham's book "The Power of Events" in 2002. In the book, Dr Luckham introduces the concept of
    Complex Event Processing and how it can be used to enhance systems that deal with events. Over
    the years, both trends converged to a common understanding and today these systems are all
    referred to as CEP systems.</p><p>This is a very simplistic explanation to a really complex and fertile field of research, but
    sets a high level and common understanding of the concepts that this guide will
    introduce.</p><p>The current understanding of what Complex Event Processing is may be
  briefly described as the following quote from Wikipedia:</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td width="10%" valign="top"> </td><td width="80%" valign="top"><p>"<a id="d0e12426" class="indexterm"/><span class="bold"><strong>Complex Event
      Processing</strong></span>, or CEP, is primarily an event processing concept
      that deals with the task of processing multiple events with the goal of
      identifying the meaningful events within the event cloud. CEP employs
      techniques such as detection of complex patterns of many events, event
      correlation and abstraction, event hierarchies, and relationships
      between events such as causality, membership, and timing, and
      event-driven processes."</p></td><td width="10%" valign="top"> </td></tr><tr><td width="10%" valign="top"> </td><td colspan="2" align="right" valign="top">--<span class="attribution"><em class="citetitle"><a class="link" href="http://en.wikipedia.org/wiki/Complex_event_processing">Wikipedia</a></em></span></td></tr></table></div></div><p>In other words, CEP is about detecting and selecting the interesting
  events (and only them) from an event cloud, finding their relationships and
  inferring new data from them and their relationships.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>For the remaining of this guide, we will use the terms 
   <span class="bold"><strong>Complex Event Processing</strong></span>
  and <span class="bold"><strong>CEP</strong></span> as a broad reference for any of 
  the related technologies
  and techniques, including but not limited to, CEP, Complex Event Processing,
  ESP, Event Stream Processing and Event Processing in general.</p></div></div><div class="section" title="9.2. Drools Fusion"><div class="titlepage"><div><div><h2 class="title"><a id="d0e12443"/>9.2. Drools Fusion</h2></div></div></div><p>Event Processing use cases, in general, share several requirements and
  goals with Business Rules use cases. These overlaps happen both on the
  business side and on the technical side.</p><p>On the Business side:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Business rules are frequently defined based on the occurrence of
      scenarios triggered by events. Examples could be:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>On an algorithmic trading application: take an action if the
          security price increases X% compared to the day opening price, where
          the price increases are usually denoted by events on a Stock Trade
          application.</p></li><li class="listitem"><p>On a monitoring application: take an action if the temperature
          on the server room increases X degrees in Y minutes, where sensor
          readings are usually denoted by events.</p></li></ul></div></li><li class="listitem"><p>Both business rules and event processing queries change frequently
      and require immediate response for the business to adapt itself to new
      market conditions, new regulations and new enterprise policies.</p></li></ul></div><p>From a technical perspective:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Both require seamless integration with the enterprise
      infrastructure and applications, specially on autonomous governance,
      including, but not limited to, lifecycle management, auditing, security,
      etc.</p></li><li class="listitem"><p>Both have functional requirements like pattern matching and
      non-functional requirements like response time and query/rule
      explanation.</p></li></ul></div><p>Even sharing requirements and goals, historically, both fields were
  born appart and although the industry evolved and one can find good products
  on the market, they either focus on event processing or on business rules
  management. That is due not only because of historical reasons but also
  because, even overlapping in part, use cases do have some different
  requirements.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>Drools was also born as a rules engine several years ago, but
    following the vision of becoming a single platform for behavioral
    modelling, it soon realized that it could only achieve this goal by
    crediting the same importance to the three complementary business
    modelling techniques:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Business Rules Management</p></li><li class="listitem"><p>Business Processes Management</p></li><li class="listitem"><p>Complex Event Processing</p></li></ul></div></div><p>In this context, Drools Fusion is the module responsible for adding
  event processing capabilities into the platform. </p><p>Supporting Complex Event Processing, though, is much more than simply
  understanding what an event is. CEP scenarios share several common and
  distinguishing characteristics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Usually required to process huge volumes of events, but only a
      small percentage of the events are of real interest.</p></li><li class="listitem"><p>Events are usually immutable, since they are a record of state
      change.</p></li><li class="listitem"><p>Usually the rules and queries on events must run in reactive
      modes, i.e., react to the detection of event patterns.</p></li><li class="listitem"><p>Usually there are strong temporal relationships between related
      events.</p></li><li class="listitem"><p>Individual events are usually not important. The system is
      concerned about patterns of related events and their
      relationships.</p></li><li class="listitem"><p>Usually, the system is required to perform composition and
      aggregation of events.</p></li></ul></div><p>Based on this general common characteristics, Drools Fusion defined a
  set of goals to be achieved in order to support Complex Event Processing
  appropriately:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Support Events, with their proper semantics, as first class
      citizens.</p></li><li class="listitem"><p>Allow detection, correlation, aggregation and composition of
      events.</p></li><li class="listitem"><p>Support processing of Streams of events.</p></li><li class="listitem"><p>Support temporal constraints in order to model the temporal
      relationships between events.</p></li><li class="listitem"><p>Support sliding windows of interesting events.</p></li><li class="listitem"><p>Support a session scoped unified clock.</p></li><li class="listitem"><p>Support the required volumes of events for CEP use cases.</p></li><li class="listitem"><p>Support to (re)active rules.</p></li><li class="listitem"><p>Support adapters for event input into the engine
      (pipeline).</p></li></ul></div><p>The above list of goals are based on the requirements not covered by
  Drools Expert itself, since in a unified platform, all features of one
  module are leveraged by the other modules. This way, Drools Fusion is born
  with enterprise grade features like Pattern Matching, that is paramount to a
  CEP product, but that is already provided by Drools Expert. In the same way,
  all features provided by Drools Fusion are leveraged by Drools Flow (and
  vice-versa) making process management aware of event processing and
  vice-versa.</p><p>For the remaining of this guide, we will go through each of the
  features Drools Fusion adds to the platform. All these features are
  available to support different use cases in the CEP world, and the user is
  free to select and use the ones that will help him model his business use
  case.</p></div><div class="section" title="9.3. Event Semantics"><div class="titlepage"><div><div><h2 class="title"><a id="d0e12545"/>9.3. Event Semantics</h2></div></div></div><p>An <span class="emphasis"><em>event</em></span> is a fact that present a few
  distinguishing characteristics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Usually immutables:</strong></span> since, by the
      previously discussed definition, events are a record of a state change
      in the application domain, i.e., a record of something that already
      happened, and the past can not be "changed", events are immutables. This
      constraint is an important requirement for the development of several
      optimizations and for the specification of the event lifecycle. This
      does not mean that the Java object representing the object must be
      immutable. Quite the contrary, the engine does not enforce immutability
      of the object model, because one of the most common use cases for rules
      is event data enrichment.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>As a best practice, the application is allowed to populate
        un-populated event attributes (to enrich the event with inferred data),
        but already populated attributes should never be changed.</p></div></li><li class="listitem"><p><span class="bold"><strong>Strong temporal constraints:</strong></span>
      rules involving events usually require the correlation of multiple
      events, specially temporal correlations where events are said to happen
      at some point in time relative to other events.</p></li><li class="listitem"><p><span class="bold"><strong>Managed lifecycle:</strong></span> due to their
      immutable nature and the temporal constraints, events usually will only
      match other events and facts during a limited window of time, making it
      possible for the engine to manage the lifecycle of the events
      automatically. In other words, one an event is inserted into the working
      memory, it is possible for the engine to find out when an event can no
      longer match other facts and automatically delete it, releasing its
      associated resources.</p></li><li class="listitem"><p><span class="bold"><strong>Use of sliding windows:</strong></span> since all
      events have timestamps associated to them, it is possible to define and
      use sliding windows over them, allowing the creation of rules on
      aggregations of values over a period of time. Example: average of an
      event value over 60 minutes.</p></li></ul></div><p>Drools supports the declaration and usage of events with both
  semantics: <span class="bold"><strong>point-in-time</strong></span> events and
  <span class="bold"><strong>interval-based</strong></span> events. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>A simplistic way to understand the unitification of the semantics is
    to consider a <span class="emphasis"><em>point-in-time</em></span> event as an
    <span class="emphasis"><em>interval-based</em></span> event whose <span class="emphasis"><em>duration is
    zero</em></span>.</p></div></div><div class="section" title="9.4. Event Processing Modes"><div class="titlepage"><div><div><h2 class="title"><a id="d0e12597"/>9.4. Event Processing Modes</h2></div></div></div><p>Rules engines in general have a well known way of processing data and
  rules and provide the application with the results. Also, there is not many
  requirements on how facts should be presented to the rules engine, specially
  because in general, the processing itself is time independent. That is a
  good assumption for most scenarios, but not for all of them. When the
  requirements include the processing of real time or near real time events,
  time becomes and important variable of the reasoning process.</p><p>The following sections will explain the impact of time on rules
  reasoning and the two modes provided by Drools for the reasoning process.
  </p><div class="section" title="9.4.1. Cloud Mode"><div class="titlepage"><div><div><h3 class="title"><a id="d0e12604"/>9.4.1. Cloud Mode</h3></div></div></div><p>The CLOUD processing mode is the default processing mode. Users of
  rules engine are familiar with this mode because it behaves in exactly the
  same way as any pure forward chaining rules engine, including previous
  versions of Drools.</p><p>When running in CLOUD mode, the engine sees all facts in the working
  memory, does not matter if they are regular facts or events, as a whole.
  There is no notion of flow of time, although events have a timestamp as
  usual. In other words, although the engine knows that a given event was
  created, for instance, on January 1st 2009, at 09:35:40.767, it is not
  possible for the engine to determine how "old" the event is, because there
  is no concept of "now".</p><p>In this mode, the engine will apply its usual many-to-many pattern
  matching algorithm, using the rules constraints to find the matching tuples,
  activate and fire rules as usual.</p><p>This mode does not impose any kind of additional requirements on
  facts. So for instance:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>There is no notion of time. No requirements clock synchronization.
      </p></li><li class="listitem"><p>There is no requirement on event ordering. The engine looks at the
      events as an unordered cloud against which the engine tries to match
      rules.</p></li></ul></div><p>On the other hand, since there is no requirements, some benefits are
  not available either. For instance, in CLOUD mode, it is not possible to use
  sliding windows, because sliding windows are based on the concept of "now"
  and there is no concept of "now" in CLOUD mode. </p><p>Since there is no ordering requirement on events, it is not possible
  for the engine to determine when events can no longer match and as so, there
  is no automatic life-cycle management for events. I.e., the application must
  explicitly delete events when they are no longer necessary, in the same way
  the application does with regular facts.</p><p>Cloud mode is the default execution mode for Drools, but in any case,
  as any other configuration in Drools, it is possible to change this behavior
  either by setting a system property, using configuration property files or
  using the API. The corresponding property is:</p><pre><code class="language-java">KieBaseConfiguration config = KieServices.Factory.get().newKieBaseConfiguration();
config.setOption( EventProcessingOption.CLOUD );</code></pre><p>The equivalent property is:</p><pre><code class="no-highlight">drools.eventProcessingMode = cloud</code></pre><p/></div><div class="section" title="9.4.2. Stream Mode"><div class="titlepage"><div><div><h3 class="title"><a id="d0e12635"/>9.4.2. Stream Mode</h3></div></div></div><p>The STREAM processing mode is the mode of choice when the application
  needs to process streams of events. It adds a few common requirements to the
  regular processing, but enables a whole lot of features that make stream
  event processing a lot simpler.</p><p>The main requirements to use STREAM mode are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Events in each stream must be time-ordered. I.e., inside a given
      stream, events that happened first must be inserted first into the
      engine.</p></li><li class="listitem"><p>The engine will force synchronization between streams through the
      use of the session clock, so, although the application does not need to
      enforce time ordering between streams, the use of non-time-synchronized
      streams may result in some unexpected results.</p></li></ul></div><p>Given that the above requirements are met, the application may enable
  the STREAM mode using the following API:</p><pre><code class="language-java">KieBaseConfiguration config = KieServices.Factory.get().newKieBaseConfiguration();
config.setOption( EventProcessingOption.STREAM );</code></pre><p>Or, the equivalent property: </p><pre><code class="no-highlight">drools.eventProcessingMode = stream</code></pre><p>When using the STREAM, the engine knows the concept of flow of time
  and the concept of "now", i.e., the engine understands how old events are
  based on the current timestamp read from the Session Clock. This
  characteristic allows the engine to provide the following additional
  features to the application:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Sliding Window support</p></li><li class="listitem"><p>Automatic Event Lifecycle Management</p></li><li class="listitem"><p>Automatic Rule Delaying when using Negative Patterns</p></li></ul></div><p>All these features are explained in the following sections.</p><div class="section" title="9.4.2.1. Role of Session Clock in Stream mode"><div class="titlepage"><div><div><h4 class="title"><a id="d0e12671"/>9.4.2.1. Role of Session Clock in Stream mode</h4></div></div></div><p>When running the engine in CLOUD mode, the session clock is used
    only to time stamp the arriving events that don't have a previously
    defined timestamp attribute. Although, in STREAM mode, the Session Clock
    assumes an even more important role.</p><p>In STREAM mode, the session clock is responsible for keeping the
    current timestamp, and based on it, the engine does all the temporal
    calculations on event's aging, synchronizes streams from multiple sources,
    schedules future tasks and so on.</p><p>Check the documentation on the Session Clock section to know how to
    configure and use different session clock implementations.</p></div><div class="section" title="9.4.2.2. Negative Patterns in Stream Mode"><div class="titlepage"><div><div><h4 class="title"><a id="d0e12680"/>9.4.2.2. Negative Patterns in Stream Mode</h4></div></div></div><p>Negative patterns behave different in STREAM mode when compared to
    CLOUD mode. In CLOUD mode, the engine assumes that all facts and events
    are known in advance (there is no concept of flow of time) and so,
    negative patterns are evaluated immediately.</p><p>When running in STREAM mode, negative patterns with temporal
    constraints may require the engine to wait for a time period before
    activating a rule. The time period is automatically calculated by the
    engine in a way that the user does not need to use any tricks to achieve
    the desired result.</p><p>For instance:</p><div class="example"><a id="d0e12689"/><p class="title"><strong>Example 9.1. a rule that activates immediately upon matching</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Sound the alarm"
when
    $f : FireDetected( )
    not( SprinklerActivated( ) )
then
    // sound the alarm
end
</code></pre></div></div><br class="example-break"/><p>The above rule has no temporal constraints that would require
    delaying the rule, and so, the rule activates immediately. The following
    rule on the other hand, must wait for 10 seconds before activating, since
    it may take up to 10 seconds for the sprinklers to activate:</p><div class="example"><a id="d0e12696"/><p class="title"><strong>Example 9.2. a rule that automatically delays activation due to temporal
        constraints</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Sound the alarm"
when
    $f : FireDetected( )
    not( SprinklerActivated( this after[0s,10s] $f ) )
then
    // sound the alarm
end</code></pre></div></div><br class="example-break"/><p>This behaviour allows the engine to keep consistency when
    dealing with negative patterns and temporal constraints at the same time.
    The above would be the same as writing the rule as below, but does not
    burden the user to calculate and explicitly write the appropriate duration
    parameter:</p><div class="example"><a id="d0e12703"/><p class="title"><strong>Example 9.3. same rule with explicit duration parameter</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Sound the alarm"
    duration( 10s )
when
    $f : FireDetected( )
    not( SprinklerActivated( this after[0s,10s] $f ) )
then
    // sound the alarm
end</code></pre></div></div><br class="example-break"/><p>The following rule expects every 10 seconds at least one
	  “Heartbeat” event, if not the rule fires. The special case in this rule
	  is that we use the same type of the object in the first pattern and in
	  the negative pattern. The negative pattern has the temporal constraint to
	  wait between 0 to 10 seconds before firing and it excludes the Heartbeat
	  bound to $h. Excluding the bound Heartbeat is important since the
	  temporal constraint [0s, ...] does not exclude by itself the bound event
	  $h from being matched again, thus preventing the rule to fire.</p><div class="example"><a id="d0e12710"/><p class="title"><strong>Example 9.4. excluding bound events in negative patterns</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Sound the alarm"
when
    $h: Heartbeat( ) from entry-point "MonitoringStream"
    not( Heartbeat( this != $h, this after[0s,10s] $h ) from entry-point "MonitoringStream" )
then
    // Sound the alarm
end</code></pre></div></div><br class="example-break"/></div></div></div><div class="section" title="9.5. Session Clock"><div class="titlepage"><div><div><h2 class="title"><a id="d0e12715"/>9.5. Session Clock</h2></div></div></div><p>Reasoning over time requires a reference clock. Just to mention one
  example, if a rule reasons over the average price of a given stock over the
  last 60 minutes, how the engine knows what stock price changes happened over
  the last 60 minutes in order to calculate the average? The obvious response
  is: by comparing the timestamp of the events with the "current time". How
  the engine knows what <span class="bold"><strong>time is now</strong></span>? Again,
  obviously, by querying the Session Clock.</p><p>The session clock implements a strategy pattern, allowing different
  types of clocks to be plugged and used by the engine. This is very important
  because the engine may be running in an elements of different scenarios that
  may require different clock implementations. Just to mention a few:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Rules testing:</strong></span> testing always
      requires a controlled environment, and when the tests include rules with
      temporal constraints, it is necessary to not only control the input
      rules and facts, but also the flow of time.</p></li><li class="listitem"><p><span class="bold"><strong>Regular execution:</strong></span> usually, when
      running rules in production, the application will require a real time
      clock that allows the rules engine to react immediately to the time
      progression.</p></li><li class="listitem"><p><span class="bold"><strong>Special environments:</strong></span> specific
      environments may have specific requirements on time control. Cluster
      environments may require clock synchronization through heart beats, or
      JEE environments may require the use of an AppServer provided clock,
      etc.</p></li><li class="listitem"><p><span class="bold"><strong>Rules replay or simulation: </strong></span>to
      replay scenarios or simulate scenarios it is necessary that the
      application also controls the flow of time.</p></li></ul></div><div class="section" title="9.5.1. Available Clock Implementations"><div class="titlepage"><div><div><h3 class="title"><a id="d0e12746"/>9.5.1. Available Clock Implementations</h3></div></div></div><p>Drools 5 provides 2 clock implementations out of the box. The default
  real time clock, based on the system clock, and an optional pseudo clock,
  controlled by the application.</p><div class="section" title="9.5.1.1. Real Time Clock"><div class="titlepage"><div><div><h4 class="title"><a id="d0e12751"/>9.5.1.1. Real Time Clock</h4></div></div></div><p>By default, Drools uses a real time clock implementation that
    internally uses the system clock to determine the current
    timestamp.</p><p>To explicitly configure the engine to use the real time clock, just
    set the session configuration parameter to real time:</p><pre><code class="language-java">KieSessionConfiguration config = KieServices.Factory.get().newKieSessionConfiguration();
config.setOption( ClockTypeOption.get("realtime") );
</code></pre></div><div class="section" title="9.5.1.2. Pseudo Clock"><div class="titlepage"><div><div><h4 class="title"><a id="d0e12760"/>9.5.1.2. Pseudo Clock</h4></div></div></div><p>Drools also offers out of the box an implementation of a clock that
    is controlled by the application that is called Pseudo Clock. This clock
    is specially useful for unit testing temporal rules since it can be
    controlled by the application and so the results become
    deterministic.</p><p>To configure the pseudo session clock, do:</p><pre><code class="language-java">KieSessionConfiguration config = KieServices.Factory.get().newKieSessionConfiguration();
config.setOption( ClockTypeOption.get("pseudo") );</code></pre><p>As an example of how to control the pseudo session clock:</p><pre><code class="language-java">KieSessionConfiguration config = KieServices.Factory.get().newKieSessionConfiguration();
conf.setOption( ClockTypeOption.get( "pseudo" ) );
KieSession session = kbase.newKieSession( conf, null );
        
SessionPseudoClock clock = session.getSessionClock();

// then, while inserting facts, advance the clock as necessary:
FactHandle handle1 = session.insert( tick1 );
clock.advanceTime( 10, TimeUnit.SECONDS );
FactHandle handle2 = session.insert( tick2 );
clock.advanceTime( 30, TimeUnit.SECONDS );
FactHandle handle3 = session.insert( tick3 );

</code></pre></div></div></div><div class="section" title="9.6. Sliding Windows"><div class="titlepage"><div><div><h2 class="title"><a id="d0e12773"/>9.6. Sliding Windows</h2></div></div></div><p>Sliding Windows are a way to scope the events of interest by defining
  a window that is constantly moving. The two most common types of sliding
  window implementations are time based windows and length based
  windows.</p><p>The next sections will detail each of them.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>Sliding Windows are only available when running the engine in STREAM
    mode. Check the Event Processing Mode section for details on how the
    STREAM mode works.</p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>Sliding windows start to match immediately and defining a sliding
    window does not imply that the rule has to wait for the sliding window to
    be "full" in order to match. For instance, a rule that calculates the
    average of an event property on a window:length(10) will start calculating
    the average immediately, and it will start at 0 (zero) for no-events, and
    will update the average as events arrive one by one.</p></div><div class="section" title="9.6.1. Sliding Time Windows"><div class="titlepage"><div><div><h3 class="title"><a id="d0e12786"/>9.6.1. Sliding Time Windows</h3></div></div></div><p>Sliding Time Windows allow the user to write rules that will only
  match events occurring in the last X time units.</p><p>For instance, if the user wants to consider only the Stock Ticks that
  happened in the last 2 minutes, the pattern would look like this:</p><pre><code class="no-highlight">StockTick() over window:time( 2m )</code></pre><p>Drools uses the "over" keyword to associate windows to
  patterns.</p><p>On a more elaborate example, if the user wants to sound an alarm in
  case the average temperature over the last 10 minutes read from a sensor is
  above the threshold value, the rule would look like:</p><div class="example"><a id="d0e12799"/><p class="title"><strong>Example 9.5. aggregating values over time windows</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Sound the alarm in case temperature rises above threshold"
when
    TemperatureThreshold( $max : max )
    Number( doubleValue &gt; $max ) from accumulate(
        SensorReading( $temp : temperature ) over window:time( 10m ),
        average( $temp ) )
then
    // sound the alarm
end
</code></pre></div></div><br class="example-break"/><p>The engine will automatically disregard any SensorReading older than
  10 minutes and keep the calculated average consistent.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>Please note that time based windows are considered when calculating
    the interval an event remains in the working memory before being expired,
    but an event falling off a sliding window does not mean by itself that the
    event will be discarded from the working memory, as there might be other
    rules that depend on that event. The engine will discard events only when
    no other rules depend on that event and the expiration policy for that
    event type is fulfilled. </p></div></div><div class="section" title="9.6.2. Sliding Length Windows"><div class="titlepage"><div><div><h3 class="title"><a id="d0e12809"/>9.6.2. Sliding Length Windows</h3></div></div></div><p>Sliding Length Windows work the same way as Time Windows, but consider
  events based on order of their insertion into the session instead of flow of
  time.</p><p>For instance, if the user wants to consider only the last 10 RHT Stock
  Ticks, independent of how old they are, the pattern would look like
  this:</p><pre><code class="no-highlight">StockTick( company == "RHT" ) over window:length( 10 )</code></pre><p>As you can see, the pattern is similar to the one presented in the
  previous section, but instead of using window:time to define the sliding
  window, it uses window:length.</p><p>Using a similar example to the one in the previous section, if the
  user wants to sound an alarm in case the average temperature over the last
  100 readings from a sensor is above the threshold value, the rule would look
  like:</p><div class="example"><a id="d0e12822"/><p class="title"><strong>Example 9.6. aggregating values over length windows</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Sound the alarm in case temperature rises above threshold"
when
    TemperatureThreshold( $max : max )
    Number( doubleValue &gt; $max ) from accumulate(
        SensorReading( $temp : temperature ) over window:length( 100 ),
        average( $temp ) )
then
    // sound the alarm
end</code></pre></div></div><br class="example-break"/><p>The engine will keep only consider the last 100 readings to calculate
  the average temperature.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>Please note that falling off a length based window is not criteria
    for event expiration in the session. The engine disregards events that
    fall off a window when calculating that window, but does not remove the
    event from the session based on that condition alone as there might be
    other rules that depend on that event.</p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>Please note that length based windows do not define temporal
    constraints for event expiration from the session, and the engine will not
    consider them. If events have no other rules defining temporal constraints
    and no explicit expiration policy, the engine will keep them in the
    session indefinitely. </p></div><p>When using a sliding window, alpha constraints are evaluated before
  the window is considered, but beta (join) constraints are evaluated afterwards.
  This usually doesn't make a difference when time windows are concerned, but
  it's important when using a length window. For example this pattern:</p><pre><code class="no-highlight">StockTick( company == "RHT" ) over window:length( 10 )</code></pre><p>defines a window of (at most) 10 StockTicks all having company equal to "RHT",
  while the following one:</p><pre><code class="no-highlight">$s : String()
StockTick( company == $s ) over window:length( 10 )</code></pre><p>first creates a window of (at most) 10 StockTicks regardless of the value of
  their company attribute and then filters among them only the ones having the company
  equal to the String selected from the working memory.</p></div><div class="section" title="9.6.3. Window Declaration"><div class="titlepage"><div><div><h3 class="title"><a id="d0e12845"/>9.6.3. Window Declaration</h3></div></div></div><p>The engine also supports the declaration of Windows. This promotes a clear
  separation between what are the filters applied to the window and what are the
  constraints applied to the result of window. It also allows easy reuse of windows
  among multiple rules.</p><p>Another benefit is a new implementation of the basic window support in the
  engine, increasing the overall performance of the rules that use sliding windows.</p><p>The simplified EBNF to declare a window is:</p><pre><code class="no-highlight">windowDeclaration := DECLARE WINDOW ID annotation* lhsPatternBind END</code></pre><p>For example a window containing only the last 10 stock ticks from a given source
  can be defined like:</p><pre><code class="no-highlight">declare window Ticks
    StockTick( source == "NYSE" )
        over window:length( 10 )
        from entry-point STStream
end</code></pre><p>Rules can then use this declared window by using it as a source for a FROM as in:</p><pre><code class="no-highlight">rule "RHT ticks in the window"
    when
        accumulate( StockTick( company == "RHT" ) from window Ticks,
                    $cnt : count(1) )
    then
        // there has been $cnt RHT ticks over the last 10 ticks
end</code></pre><p>Note that this example also demonstrates how the window declaration allows
  to separate the constraints applied to the window (only the StockTicks having
  "NYSE" as source are among the 10 events included into window) and the constraints
  applied to the window result (among the last 10 events having "NYSE" as source
  only the ones with company equal to "RHT" are selected).</p></div></div><div class="section" title="9.7. Streams Support"><div class="titlepage"><div><div><h2 class="title"><a id="d0e12866"/>9.7. Streams Support</h2></div></div></div><p>Most CEP use cases have to deal with streams of events. The streams
  can be provided to the application in various forms, from JMS queues to flat
  text files, from database tables to raw sockets or even through web service
  calls. In any case, the streams share a common set of
  characteristics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>events in the stream are ordered by a timestamp. The timestamp may
      have different semantics for different streams but they are always
      ordered internally.</p></li><li class="listitem"><p>volumes of events are usually high.</p></li><li class="listitem"><p>atomic events are rarely useful by themselves. Usually meaning is
      extracted from the correlation between multiple events from the stream
      and also from other sources.</p></li><li class="listitem"><p>streams may be homogeneous, i.e. contain a single type of events,
      or heterogeneous, i.e. contain multiple types of events.</p></li></ul></div><p>Drools generalized the concept of a stream as an "entry point" into
  the engine. An entry point is for drools a gate from which facts come. The
  facts may be regular facts or special facts like events.</p><p>In Drools, facts from one entry point (stream) may join with facts
  from any other entry point or event with facts from the working memory.
  Although, they never mix, i.e., they never lose the reference to the entry
  point through which they entered the engine. This is important because one
  may have the same type of facts coming into the engine through several entry
  points, but one fact that is inserted into the engine through entry point A
  will never match a pattern from a entry point B, for example.</p><div class="section" title="9.7.1. Declaring and Using Entry Points"><div class="titlepage"><div><div><h3 class="title"><a id="d0e12888"/>9.7.1. Declaring and Using Entry Points</h3></div></div></div><p>Entry points are declared implicitly in Drools by directly making use
  of them in rules. I.e. referencing an entry point in a rule will make the
  engine, at compile time, to identify and create the proper internal
  structures to support that entry point. </p><p>So, for instance, lets imagine a banking application, where
  transactions are fed into the system coming from streams. One of the streams
  contains all the transactions executed in ATM machines. So, if one of the
  rules says: a withdraw is authorized if and only if the account balance is
  over the requested withdraw amount, the rule would look like:</p><div class="example"><a id="d0e12895"/><p class="title"><strong>Example 9.7. Example of Stream Usage</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "authorize withdraw"
when
    WithdrawRequest( $ai : accountId, $am : amount ) from entry-point "ATM Stream"
    CheckingAccount( accountId == $ai, balance &gt; $am )
then
    // authorize withdraw
end
</code></pre></div></div><br class="example-break"/><p>In the previous example, the engine compiler will identify that
  the pattern is tied to the entry point "ATM Stream" and will both create all
  the necessary structures for the rulebase to support the "ATM Stream" and
  will only match WithdrawRequests coming from the "ATM Stream". In the
  previous example, the rule is also joining the event from the stream with a
  fact from the main working memory (CheckingAccount).</p><p>Now, lets imagine a second rule that states that a fee of $2 must be
  applied to any account for which a withdraw request is placed at a bank
  branch:</p><div class="example"><a id="d0e12904"/><p class="title"><strong>Example 9.8. Using a different Stream</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "apply fee on withdraws on branches"
when
    WithdrawRequest( $ai : accountId, processed == true ) from entry-point "Branch Stream"
    CheckingAccount( accountId == $ai )
then
    // apply a $2 fee on the account
end
</code></pre></div></div><br class="example-break"/><p>The previous rule will match events of the exact same type as
  the first rule (WithdrawRequest), but from two different streams, so an
  event inserted into "ATM Stream" will never be evaluated against the pattern
  on the second rule, because the rule states that it is only interested in
  patterns coming from the "Branch Stream".</p><p>So, entry points, besides being a proper abstraction for streams, are
  also a way to scope facts in the working memory, and a valuable tool for
  reducing cross products explosions. But that is a subject for another
  time.</p><p>Inserting events into an entry point is equally simple. Instead of
  inserting events directly into the working memory, insert them into the
  entry point as shown in the example below:</p><div class="example"><a id="d0e12915"/><p class="title"><strong>Example 9.9. Inserting facts into an entry point</strong></p><div class="example-contents"><pre><code class="language-java">// create your rulebase and your session as usual
KieSession session = ...

// get a reference to the entry point
EntryPoint atmStream = session.getEntryPoint( "ATM Stream" );

// and start inserting your facts into the entry point
atmStream.insert( aWithdrawRequest );
</code></pre></div></div><br class="example-break"/><p>The previous example shows how to manually insert facts into a given
  entry point. Although, usually, the application will use one of the many
  adapters to plug a stream end point, like a JMS queue, directly into the
  engine entry point, without coding the inserts manually. The Drools pipeline
  API has several adapters and helpers to do that as well as examples on how
  to do it.</p></div></div><div class="section" title="9.8. Memory Management for Events"><div class="titlepage"><div><div><h2 class="title"><a id="d0e12922"/>9.8. Memory Management for Events</h2></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>The automatic memory management for events is only performed when
    running the engine in STREAM mode. Check the Event Processing Mode section
    for details on how the STREAM mode works.</p></div><p>One of the benefits of running the engine in STREAM mode is that the
  engine can detect when an event can no longer match any rule due to its
  temporal constraints. When that happens, the engine can safely delete the
  event from the session without side effects and release any resources used
  by that event.</p><p>There are basically 2 ways for the engine to calculate the matching
  window for a given event:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>explicitly, using the expiration policy</p></li><li class="listitem"><p>implicitly, analyzing the temporal constraints on events</p></li></ul></div><p/><div class="section" title="9.8.1. Explicit expiration offset"><div class="titlepage"><div><div><h3 class="title"><a id="d0e12940"/>9.8.1. Explicit expiration offset</h3></div></div></div><p>The first way of allowing the engine to calculate the window of
  interest for a given event type is by explicitly setting it. To do that,
  just use the declare statement and define an expiration for the fact
  type:</p><div class="example"><a id="d0e12945"/><p class="title"><strong>Example 9.10. explicitly defining an expiration offset of 30 minutes for
      StockTick events</strong></p><div class="example-contents"><pre><code class="no-highlight">declare StockTick
    @expires( 30m )
end
</code></pre></div></div><br class="example-break"/><p>The above example declares an expiration offset of 30 minutes
  for StockTick events. After that time, assuming no rule still needs the
  event, the engine will expire and remove the event from the session
  automatically.</p><p>
    </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>An explicit expiration policy for a given event type overrides any inferred expiration offset
      for that same type.</p></div><p>
  </p></div><div class="section" title="9.8.2. Inferred expiration offset"><div class="titlepage"><div><div><h3 class="title"><a id="d0e12958"/>9.8.2. Inferred expiration offset</h3></div></div></div><p>Another way for the engine to calculate the expiration offset for a
  given event is implicitly, by analyzing the temporal constraints in the
  rules. For instance, given the following rule:</p><div class="example"><a id="d0e12963"/><p class="title"><strong>Example 9.11. example rule with temporal constraints</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "correlate orders"
when
    $bo : BuyOrderEvent( $id : id ) 
    $ae : AckEvent( id == $id, this after[0,10s] $bo )
then
    // do something
end
</code></pre></div></div><br class="example-break"/><p>Analyzing the above rule, the engine automatically calculates
  that whenever a BuyOrderEvent matches, it needs to store it for up to 10
  seconds to wait for matching AckEvent's. So, the implicit expiration offset
  for BuyOrderEvent will be 10 seconds. AckEvent, on the other hand, can only
  match existing BuyOrderEvent's, and so its expiration offset will be zero
  seconds.</p><p>The engine will make this analysis for the whole rulebase and find the offset for every
        event type. </p><p>
        </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>An explicit expiration policy for a given event type overrides any inferred expiration offset
                for that same type.</p></div><p>
    </p></div></div><div class="section" title="9.9. Temporal Reasoning"><div class="titlepage"><div><div><h2 class="title"><a id="d0e12978"/>9.9. Temporal Reasoning</h2></div></div></div><p>Temporal reasoning is another requirement of any CEP system. As
  discussed previously, one of the distinguishing characteristics of events is
  their strong temporal relationships.</p><p>Temporal reasoning is an extensive field of research, from its roots
  on Temporal Modal Logic to its more practical applications in business
  systems. There are hundreds of papers and thesis written and approaches are
  described for several applications. Drools once more takes a pragmatic and
  simple approach based on several sources, but specially worth noting the
  following papers:</p><div class="bibliolist"><div class="biblioentry" title="An Interval-based Representation of Temporal Knowledge"><a id="d0e12987"/><p>[<abbr class="abbrev">ALLEN81</abbr>] <span class="author">Allen, J.F.. </span><span class="title"><em>An Interval-based Representation of Temporal Knowledge</em>. </span><span class="pubdate">1981. </span></p></div><div class="biblioentry" title="Maintaining knowledge about temporal intervals"><a id="d0e12998"/><p>[<abbr class="abbrev">ALLEN83</abbr>] <span class="author">Allen, J.F.. </span><span class="title"><em>Maintaining knowledge about temporal intervals</em>. </span><span class="pubdate">1983. </span></p></div><div class="biblioentry" title="A Unifying Semantics for Time and Events"><a id="d0e13009"/><p>[<abbr class="abbrev">BENNE00</abbr>] <span class="authorgroup">Bennet, Brandon and Galton, Antony P.. </span><span class="title"><em>A Unifying Semantics for Time and Events</em>. </span><span class="pubdate">2005. </span></p></div><div class="biblioentry" title="Unified Semantics for Event Correlation Over Time and Space in Hybrid Network Environments"><a id="d0e13024"/><p>[<abbr class="abbrev">YONEK05</abbr>] <span class="authorgroup">Yoneki, Eiko and Bacon, Jean. </span><span class="title"><em>Unified Semantics for Event Correlation Over Time and Space in
      Hybrid Network Environments</em>. </span><span class="pubdate">2005. </span></p></div></div><p>Drools implements the Interval-based Time Event Semantics described by
  Allen, and represents Point-in-Time Events as Interval-based evens with
  duration 0 (zero).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>For all temporal operator intervals, the "*" (star) symbol is used
    to indicate <span class="emphasis"><em>positive infinity</em></span> and the "-*" (minus
    star) is used to indicate <span class="emphasis"><em>negative infinity</em></span>.</p></div><div class="section" title="9.9.1. Temporal Operators"><div class="titlepage"><div><div><h3 class="title"><a id="d0e13050"/>9.9.1. Temporal Operators</h3></div></div></div><p>Drools implements all 13 operators defined by Allen and also their
  logical complement (negation). This section details each of the operators
  and their parameters.</p><div class="section" title="9.9.1.1. After"><div class="titlepage"><div><div><h4 class="title"><a id="d0e13055"/>9.9.1.1. After</h4></div></div></div><p>The after evaluator correlates two events and matches when the
    temporal distance from the current event to the event being correlated
    belongs to the distance range declared for the operator.</p><p>Lets look at an example:</p><pre><code class="no-highlight">$eventA : EventA( this after[ 3m30s, 4m ] $eventB ) </code></pre><p>The previous pattern will match if and only if the temporal distance
    between the time when $eventB finished and the time when $eventA started
    is between ( 3 minutes and 30 seconds ) and ( 4 minutes ). In other
    words:</p><pre><code class="no-highlight"> 3m30s &lt;= $eventA.startTimestamp - $eventB.endTimeStamp &lt;= 4m </code></pre><p>The temporal distance interval for the after operator is
    optional:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If two values are defined (like in the example below), the
        interval starts on the first value and finishes on the second.</p></li><li class="listitem"><p>If only one value is defined, the interval starts on the value
        and finishes on the positive infinity.</p></li><li class="listitem"><p>If no value is defined, it is assumed that the initial value is
        1ms and the final value is the positive infinity.</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>It is possible to define negative distances for this operator.
      Example:</p><pre><code class="no-highlight">$eventA : EventA( this after[ -3m30s, -2m ] $eventB ) </code></pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If the first value is greater than the second value, the engine
      automatically reverses them, as there is no reason to have the first
      value greater than the second value. Example: the following two patterns
      are considered to have the same semantics:</p><pre><code class="no-highlight">$eventA : EventA( this after[ -3m30s, -2m ] $eventB ) 
$eventA : EventA( this after[ -2m, -3m30s ] $eventB ) </code></pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The <span class="emphasis"><em>after</em></span>, <span class="emphasis"><em>before</em></span> and
      <span class="emphasis"><em>coincides</em></span> operators can be used to define
      constraints between events, java.util.Date attributes, and long
      attributes (interpreted as timestamps since epoch) in any combination.
      Example:</p><pre><code class="no-highlight">EventA( this after $someDate )</code></pre></div></div><div class="section" title="9.9.1.2. Before"><div class="titlepage"><div><div><h4 class="title"><a id="d0e13104"/>9.9.1.2. Before</h4></div></div></div><p>The before evaluator correlates two events and matches when the
    temporal distance from the event being correlated to the current
    correlated belongs to the distance range declared for the operator.</p><p>Lets look at an example:</p><pre><code class="no-highlight">$eventA : EventA( this before[ 3m30s, 4m ] $eventB ) </code></pre><p>The previous pattern will match if and only if the temporal distance
    between the time when $eventA finished and the time when $eventB started
    is between ( 3 minutes and 30 seconds ) and ( 4 minutes ). In other
    words:</p><pre><code class="no-highlight"> 3m30s &lt;= $eventB.startTimestamp - $eventA.endTimeStamp &lt;= 4m </code></pre><p>The temporal distance interval for the before operator is
    optional:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If two values are defined (like in the example below), the
        interval starts on the first value and finishes on the second.</p></li><li class="listitem"><p>If only one value is defined, then the interval starts on the
        value and finishes on the positive infinity.</p></li><li class="listitem"><p>If no value is defined, it is assumed that the initial value is
        1ms and the final value is the positive infinity.</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>It is possible to define negative distances for this operator.
      Example:</p><pre><code class="no-highlight">$eventA : EventA( this before[ -3m30s, -2m ] $eventB ) </code></pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If the first value is greater than the second value, the engine
      automatically reverses them, as there is no reason to have the first
      value greater than the second value. Example: the following two patterns
      are considered to have the same semantics:</p><pre><code class="no-highlight">$eventA : EventA( this before[ -3m30s, -2m ] $eventB ) 
$eventA : EventA( this before[ -2m, -3m30s ] $eventB ) </code></pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The <span class="emphasis"><em>after</em></span>, <span class="emphasis"><em>before</em></span> and
      <span class="emphasis"><em>coincides</em></span> operators can be used to define
      constraints between events, java.util.Date attributes, and long
      attributes (interpreted as timestamps since epoch) in any combination.
      Example:</p><pre><code class="no-highlight">EventA( this after $someDate )</code></pre></div></div><div class="section" title="9.9.1.3. Coincides"><div class="titlepage"><div><div><h4 class="title"><a id="d0e13153"/>9.9.1.3. Coincides</h4></div></div></div><p>The coincides evaluator correlates two events and matches when both
    happen at the same time. Optionally, the evaluator accept thresholds for
    the distance between events' start and finish timestamps.</p><p>Lets look at an example:</p><pre><code class="no-highlight">$eventA : EventA( this coincides $eventB ) </code></pre><p>The previous pattern will match if and only if the start timestamps
    of both $eventA and $eventB are the same AND the end timestamp of both
    $eventA and $eventB also are the same.</p><p>Optionally, this operator accepts one or two parameters. These
    parameters are the thresholds for the distance between matching
    timestamps.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If only one parameter is given, it is used for both start and
        end timestamps.</p></li><li class="listitem"><p>If two parameters are given, then the first is used as a
        threshold for the start timestamp and the second one is used as a
        threshold for the end timestamp.</p></li></ul></div><p>In other words:</p><pre><code class="no-highlight">$eventA : EventA( this coincides[15s, 10s] $eventB ) </code></pre><p>Above pattern will match if and only if:</p><pre><code class="no-highlight">abs( $eventA.startTimestamp - $eventB.startTimestamp ) &lt;= 15s &amp;&amp; 
abs( $eventA.endTimestamp - $eventB.endTimestamp ) &lt;= 10s </code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>It makes no sense to use negative interval values for the
      parameters and the engine will raise an error if that happens.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The <span class="emphasis"><em>after</em></span>, <span class="emphasis"><em>before</em></span> and
      <span class="emphasis"><em>coincides</em></span> operators can be used to define
      constraints between events, java.util.Date attributes, and long
      attributes (interpreted as timestamps since epoch) in any combination.
      Example:</p><pre><code class="no-highlight">EventA( this after $someDate )</code></pre></div></div><div class="section" title="9.9.1.4. During"><div class="titlepage"><div><div><h4 class="title"><a id="d0e13198"/>9.9.1.4. During</h4></div></div></div><p>The during evaluator correlates two events and matches when the
    current event happens during the occurrence of the event being
    correlated.</p><p>Lets look at an example:</p><pre><code class="no-highlight">$eventA : EventA( this during $eventB ) </code></pre><p>The previous pattern will match if and only if the $eventA starts
    after $eventB starts and finishes before $eventB finishes.</p><p>In other words:</p><pre><code class="no-highlight">$eventB.startTimestamp &lt; $eventA.startTimestamp &lt;= $eventA.endTimestamp &lt; $eventB.endTimestamp </code></pre><p>The during operator accepts 1, 2 or 4 optional parameters as
    follow:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If one value is defined, this will be the maximum distance
        between the start timestamp of both event and the maximum distance
        between the end timestamp of both events in order to operator match.
        Example:</p><pre><code class="no-highlight">$eventA : EventA( this during[ 5s ] $eventB )</code></pre><p>Will match if and only if:</p><pre><code class="no-highlight">0 &lt; $eventA.startTimestamp - $eventB.startTimestamp &lt;= 5s &amp;&amp; 
0 &lt; $eventB.endTimestamp - $eventA.endTimestamp &lt;= 5s</code></pre></li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If two values are defined, the first value will be the minimum
        distance between the timestamps of both events, while the second value
        will be the maximum distance between the timestamps of both events.
        Example:</p><pre><code class="no-highlight">$eventA : EventA( this during[ 5s, 10s ] $eventB )</code></pre><p>Will match if and only if:</p><pre><code class="no-highlight">5s &lt;= $eventA.startTimestamp - $eventB.startTimestamp &lt;= 10s &amp;&amp; 
5s &lt;= $eventB.endTimestamp - $eventA.endTimestamp &lt;= 10s</code></pre></li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If four values are defined, the first two values will be the
        minimum and maximum distances between the start timestamp of both
        events, while the last two values will be the minimum and maximum
        distances between the end timestamp of both events. Example:</p><pre><code class="no-highlight">$eventA : EventA( this during[ 2s, 6s, 4s, 10s ] $eventB )</code></pre><p>Will match if and only if:</p><pre><code class="no-highlight">2s &lt;= $eventA.startTimestamp - $eventB.startTimestamp &lt;= 6s &amp;&amp; 
4s &lt;= $eventB.endTimestamp - $eventA.endTimestamp &lt;= 10s</code></pre></li></ul></div></div><div class="section" title="9.9.1.5. Finishes"><div class="titlepage"><div><div><h4 class="title"><a id="d0e13245"/>9.9.1.5. Finishes</h4></div></div></div><p>The finishes evaluator correlates two events and matches when the
    current event's start timestamp happens after the correlated event's start
    timestamp, but both end timestamps occur at the same time.</p><p>Lets look at an example:</p><pre><code class="no-highlight">$eventA : EventA( this finishes $eventB ) </code></pre><p>The previous pattern will match if and only if the $eventA starts
    after $eventB starts and finishes at the same time $eventB
    finishes.</p><p>In other words:</p><pre><code class="no-highlight">$eventB.startTimestamp &lt; $eventA.startTimestamp &amp;&amp; 
$eventA.endTimestamp == $eventB.endTimestamp </code></pre><p>The finishes evaluator accepts one optional parameter. If it is
    defined, it determines the maximum distance between the end timestamp of
    both events in order for the operator to match. Example:</p><pre><code class="no-highlight">$eventA : EventA( this finishes[ 5s ] $eventB ) </code></pre><p>Will match if and only if:</p><pre><code class="no-highlight">$eventB.startTimestamp &lt; $eventA.startTimestamp &amp;&amp; 
abs( $eventA.endTimestamp - $eventB.endTimestamp ) &lt;= 5s </code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>It makes no sense to use a negative interval value for the
      parameter and the engine will raise an exception if that happens.</p></div></div><div class="section" title="9.9.1.6. Finished By"><div class="titlepage"><div><div><h4 class="title"><a id="d0e13271"/>9.9.1.6. Finished By</h4></div></div></div><p>The finishedby evaluator correlates two events and matches when the
    current event start timestamp happens before the correlated event start
    timestamp, but both end timestamps occur at the same time. This is the
    symmetrical opposite of finishes evaluator.</p><p>Lets look at an example:</p><pre><code class="no-highlight">$eventA : EventA( this finishedby $eventB ) </code></pre><p>The previous pattern will match if and only if the $eventA starts
    before $eventB starts and finishes at the same time $eventB
    finishes.</p><p>In other words:</p><pre><code class="no-highlight">$eventA.startTimestamp &lt; $eventB.startTimestamp &amp;&amp; 
$eventA.endTimestamp == $eventB.endTimestamp </code></pre><p>The finishedby evaluator accepts one optional parameter. If it is
    defined, it determines the maximum distance between the end timestamp of
    both events in order for the operator to match. Example:</p><pre><code class="no-highlight">$eventA : EventA( this finishedby[ 5s ] $eventB ) </code></pre><p>Will match if and only if:</p><pre><code class="no-highlight">$eventA.startTimestamp &lt; $eventB.startTimestamp &amp;&amp; 
abs( $eventA.endTimestamp - $eventB.endTimestamp ) &lt;= 5s </code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>It makes no sense to use a negative interval value for the
      parameter and the engine will raise an exception if that happens.</p></div></div><div class="section" title="9.9.1.7. Includes"><div class="titlepage"><div><div><h4 class="title"><a id="d0e13297"/>9.9.1.7. Includes</h4></div></div></div><p>The includes evaluator correlates two events and matches when the
    event being correlated happens during the current event. It is the
    symmetrical opposite of during evaluator.</p><p>Lets look at an example:</p><pre><code class="no-highlight">$eventA : EventA( this includes $eventB ) </code></pre><p>The previous pattern will match if and only if the $eventB starts
    after $eventA starts and finishes before $eventA finishes.</p><p>In other words:</p><pre><code class="no-highlight">$eventA.startTimestamp &lt; $eventB.startTimestamp &lt;= $eventB.endTimestamp &lt; $eventA.endTimestamp </code></pre><p>The includes operator accepts 1, 2 or 4 optional parameters as
    follow:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If one value is defined, this will be the maximum distance
        between the start timestamp of both event and the maximum distance
        between the end timestamp of both events in order to operator match.
        Example:</p><pre><code class="no-highlight">$eventA : EventA( this includes[ 5s ] $eventB )</code></pre><p>Will match if and only if:</p><pre><code class="no-highlight">0 &lt; $eventB.startTimestamp - $eventA.startTimestamp &lt;= 5s &amp;&amp; 
0 &lt; $eventA.endTimestamp - $eventB.endTimestamp &lt;= 5s</code></pre></li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If two values are defined, the first value will be the minimum
        distance between the timestamps of both events, while the second value
        will be the maximum distance between the timestamps of both events.
        Example:</p><pre><code class="no-highlight">$eventA : EventA( this includes[ 5s, 10s ] $eventB )</code></pre><p>Will match if and only if:</p><pre><code class="no-highlight">5s &lt;= $eventB.startTimestamp - $eventA.startTimestamp &lt;= 10s &amp;&amp; 
5s &lt;= $eventA.endTimestamp - $eventB.endTimestamp &lt;= 10s</code></pre></li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If four values are defined, the first two values will be the
        minimum and maximum distances between the start timestamp of both
        events, while the last two values will be the minimum and maximum
        distances between the end timestamp of both events. Example:</p><pre><code class="no-highlight">$eventA : EventA( this includes[ 2s, 6s, 4s, 10s ] $eventB )</code></pre><p>Will match if and only if:</p><pre><code class="no-highlight">2s &lt;= $eventB.startTimestamp - $eventA.startTimestamp &lt;= 6s &amp;&amp; 
4s &lt;= $eventA.endTimestamp - $eventB.endTimestamp &lt;= 10s </code></pre></li></ul></div></div><div class="section" title="9.9.1.8. Meets"><div class="titlepage"><div><div><h4 class="title"><a id="d0e13344"/>9.9.1.8. Meets</h4></div></div></div><p>The meets evaluator correlates two events and matches when the
    current event's end timestamp happens at the same time as the correlated
    event's start timestamp.</p><p>Lets look at an example:</p><pre><code class="no-highlight">$eventA : EventA( this meets $eventB ) </code></pre><p>The previous pattern will match if and only if the $eventA finishes
    at the same time $eventB starts.</p><p>In other words:</p><pre><code class="no-highlight">abs( $eventB.startTimestamp - $eventA.endTimestamp ) == 0 </code></pre><p>The meets evaluator accepts one optional parameter. If it is
    defined, it determines the maximum distance between the end timestamp of
    current event and the start timestamp of the correlated event in order for
    the operator to match. Example:</p><pre><code class="no-highlight">$eventA : EventA( this meets[ 5s ] $eventB ) </code></pre><p>Will match if and only if:</p><pre><code class="no-highlight">abs( $eventB.startTimestamp - $eventA.endTimestamp) &lt;= 5s </code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>It makes no sense to use a negative interval value for the
      parameter and the engine will raise an exception if that happens.</p></div></div><div class="section" title="9.9.1.9. Met By"><div class="titlepage"><div><div><h4 class="title"><a id="d0e13370"/>9.9.1.9. Met By</h4></div></div></div><p>The metby evaluator correlates two events and matches when the
    current event's start timestamp happens at the same time as the correlated
    event's end timestamp.</p><p>Lets look at an example:</p><pre><code class="no-highlight">$eventA : EventA( this metby $eventB ) </code></pre><p>The previous pattern will match if and only if the $eventA starts at
    the same time $eventB finishes.</p><p>In other words:</p><pre><code class="no-highlight">abs( $eventA.startTimestamp - $eventB.endTimestamp ) == 0 </code></pre><p>The metby evaluator accepts one optional parameter. If it is
    defined, it determines the maximum distance between the end timestamp of
    the correlated event and the start timestamp of the current event in order
    for the operator to match. Example:</p><pre><code class="no-highlight">$eventA : EventA( this metby[ 5s ] $eventB ) </code></pre><p>Will match if and only if:</p><pre><code class="no-highlight">abs( $eventA.startTimestamp - $eventB.endTimestamp) &lt;= 5s </code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>It makes no sense to use a negative interval value for the
      parameter and the engine will raise an exception if that happens.</p></div></div><div class="section" title="9.9.1.10. Overlaps"><div class="titlepage"><div><div><h4 class="title"><a id="d0e13396"/>9.9.1.10. Overlaps</h4></div></div></div><p>The overlaps evaluator correlates two events and matches when the
    current event starts before the correlated event starts and finishes after
    the correlated event starts, but before the correlated event finishes. In
    other words, both events have an overlapping period.</p><p>Lets look at an example:</p><pre><code class="no-highlight">$eventA : EventA( this overlaps $eventB ) </code></pre><p>The previous pattern will match if and only if:</p><pre><code class="no-highlight">$eventA.startTimestamp &lt; $eventB.startTimestamp &lt; $eventA.endTimestamp &lt; $eventB.endTimestamp </code></pre><p>The overlaps operator accepts 1 or 2 optional parameters as
    follow:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If one parameter is defined, this will be the maximum distance
        between the start timestamp of the correlated event and the end
        timestamp of the current event. Example:</p><pre><code class="no-highlight">$eventA : EventA( this overlaps[ 5s ] $eventB )</code></pre><p>Will match if and only if:</p><pre><code class="no-highlight">$eventA.startTimestamp &lt; $eventB.startTimestamp &lt; $eventA.endTimestamp &lt; $eventB.endTimestamp &amp;&amp; 
0 &lt;= $eventA.endTimestamp - $eventB.startTimestamp &lt;= 5s</code></pre></li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If two values are defined, the first value will be the minimum
        distance and the second value will be the maximum distance between the
        start timestamp of the correlated event and the end timestamp of the
        current event. Example:</p><pre><code class="no-highlight">$eventA : EventA( this overlaps[ 5s, 10s ] $eventB )</code></pre><p>Will match if and only if:</p><pre><code class="no-highlight">$eventA.startTimestamp &lt; $eventB.startTimestamp &lt; $eventA.endTimestamp &lt; $eventB.endTimestamp &amp;&amp; 
5s &lt;= $eventA.endTimestamp - $eventB.startTimestamp &lt;= 10s </code></pre></li></ul></div></div><div class="section" title="9.9.1.11. Overlapped By"><div class="titlepage"><div><div><h4 class="title"><a id="d0e13431"/>9.9.1.11. Overlapped By</h4></div></div></div><p>The overlappedby evaluator correlates two events and matches when
    the correlated event starts before the current event starts and finishes
    after the current event starts, but before the current event finishes. In
    other words, both events have an overlapping period.</p><p>Lets look at an example:</p><pre><code class="no-highlight">$eventA : EventA( this overlappedby $eventB ) </code></pre><p>The previous pattern will match if and only if:</p><pre><code class="no-highlight">$eventB.startTimestamp &lt; $eventA.startTimestamp &lt; $eventB.endTimestamp &lt; $eventA.endTimestamp </code></pre><p>The overlappedby operator accepts 1 or 2 optional parameters as
    follow:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If one parameter is defined, this will be the maximum distance
        between the start timestamp of the current event and the end timestamp
        of the correlated event. Example:</p><pre><code class="no-highlight">$eventA : EventA( this overlappedby[ 5s ] $eventB )</code></pre><p>Will match if and only if:</p><pre><code class="no-highlight">$eventB.startTimestamp &lt; $eventA.startTimestamp &lt; $eventB.endTimestamp &lt; $eventA.endTimestamp &amp;&amp; 
0 &lt;= $eventB.endTimestamp - $eventA.startTimestamp &lt;= 5s</code></pre></li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If two values are defined, the first value will be the minimum
        distance and the second value will be the maximum distance between the
        start timestamp of the current event and the end timestamp of the
        correlated event. Example:</p><pre><code class="no-highlight">$eventA : EventA( this overlappedby[ 5s, 10s ] $eventB )</code></pre><p>Will match if and only if:</p><pre><code class="no-highlight">$eventB.startTimestamp &lt; $eventA.startTimestamp &lt; $eventB.endTimestamp &lt; $eventA.endTimestamp &amp;&amp; 
5s &lt;= $eventB.endTimestamp - $eventA.startTimestamp &lt;= 10s</code></pre></li></ul></div><p/></div><div class="section" title="9.9.1.12. Starts"><div class="titlepage"><div><div><h4 class="title"><a id="d0e13467"/>9.9.1.12. Starts</h4></div></div></div><p>The starts evaluator correlates two events and matches when the
    current event's end timestamp happens before the correlated event's end
    timestamp, but both start timestamps occur at the same time.</p><p>Lets look at an example:</p><pre><code class="no-highlight">$eventA : EventA( this starts $eventB ) </code></pre><p>The previous pattern will match if and only if the $eventA finishes
    before $eventB finishes and starts at the same time $eventB starts.</p><p>In other words:</p><pre><code class="no-highlight">$eventA.startTimestamp == $eventB.startTimestamp &amp;&amp; 
$eventA.endTimestamp &lt; $eventB.endTimestamp </code></pre><p>The starts evaluator accepts one optional parameter. If it is
    defined, it determines the maximum distance between the start timestamp of
    both events in order for the operator to match. Example:</p><pre><code class="no-highlight">$eventA : EventA( this starts[ 5s ] $eventB ) </code></pre><p>Will match if and only if:</p><pre><code class="no-highlight">abs( $eventA.startTimestamp - $eventB.startTimestamp ) &lt;= 5s &amp;&amp; 
$eventA.endTimestamp &lt; $eventB.endTimestamp </code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>It makes no sense to use a negative interval value for the
      parameter and the engine will raise an exception if that happens.</p></div></div><div class="section" title="9.9.1.13. Started By"><div class="titlepage"><div><div><h4 class="title"><a id="d0e13493"/>9.9.1.13. Started By</h4></div></div></div><p>The startedby evaluator correlates two events and matches when the
    correlating event's end timestamp happens before the current event's end
    timestamp, but both start timestamps occur at the same time. Lets look at
    an example:</p><pre><code class="no-highlight">$eventA : EventA( this startedby $eventB ) </code></pre><p>The previous pattern will match if and only if the $eventB finishes
    before $eventA finishes and starts at the same time $eventB starts.</p><p>In other words:</p><pre><code class="no-highlight">$eventA.startTimestamp == $eventB.startTimestamp &amp;&amp; 
$eventA.endTimestamp &gt; $eventB.endTimestamp </code></pre><p>The startedby evaluator accepts one optional parameter. If it is
    defined, it determines the maximum distance between the start timestamp of
    both events in order for the operator to match. Example:</p><pre><code class="no-highlight">$eventA : EventA( this starts[ 5s ] $eventB ) </code></pre><p>Will match if and only if:</p><pre><code class="no-highlight">abs( $eventA.startTimestamp - $eventB.startTimestamp ) &lt;= 5s &amp;&amp; 
$eventA.endTimestamp &gt; $eventB.endTimestamp </code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>It makes no sense to use a negative interval value for the
      parameter and the engine will raise an exception if that happens.</p></div></div></div></div></div><div class="chapter" title="Chapter 10. Experimental Features"><div class="titlepage"><div><div><h2 class="title"><a id="ExperimentalFeaturesChapter"/>Chapter 10. Experimental Features</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e13520">10.1. Declarative Agenda</a></span></dt><dt><span class="section"><a href="#d0e13581">10.2. Browsing graphs of objects with OOPath</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e13688">10.2.1. Reactive and Non-Reactive OOPath</a></span></dt></dl></dd></dl></div><div class="section" title="10.1. Declarative Agenda"><div class="titlepage"><div><div><h2 class="title"><a id="d0e13520"/>10.1. Declarative Agenda</h2></div></div></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>Declarative Agenda is experimental, and all aspects are highly likely to change in the future.
      @Eager and @Direct are temporary annotations to control the behaviour of rules, which will also
      change as Declarative Agenda evolves. Annotations instead of attributes where chosen, to reflect
      their experimental nature.</p></div><p>The declarative agenda allows to use rules to control which other rules can fire and when.
    While this will add a lot more overhead than the simple use of salience, the advantage is it is declarative and
    thus more readable and maintainable and should allow more use cases to be achieved in a simpler fashion.</p><p>This feature is off by default and must be explicitly enabled, that is because it is considered highly
    experimental for the moment and will be subject to change, but can be activated on a given KieBase by adding the
    declarativeAgenda='enabled' attribute in the corresponding kbase tag of the kmodule.xml file as in the following example.
  </p><div class="example"><a id="d0e13530"/><p class="title"><strong>Example 10.1. Enabling the Declarative Agenda</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;kmodule xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns="http://www.drools.org/xsd/kmodule"&gt;
      &lt;kbase name="DeclarativeKBase" declarativeAgenda="enabled"&gt;
      &lt;ksession name="KSession"&gt;
      &lt;/kbase&gt;
      &lt;/kmodule&gt;</code></pre></div></div><br class="example-break"/><p>The basic idea is:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>All rule's Matches are inserted into WorkingMemory as facts. So you can now do pattern matching against a
        Match. The rule's metadata and declarations are available as fields on the Match object.</p></li><li class="listitem"><p>You can use the kcontext.blockMatch( Match match ) for the current rule to block the selected
        match. Only when that rule becomes false will the match be eligible for firing. If it is already
        eligible for firing and is later blocked, it will be removed from the agenda until it is unblocked.</p></li><li class="listitem"><p>A match may have multiple blockers and a count is kept. All blockers must became false for the
        counter to reach zero to enable the Match to be eligible for firing.</p></li><li class="listitem"><p>kcontext.unblockAllMatches( Match match ) is an over-ride rule that will remove all blockers
        regardless</p></li><li class="listitem"><p>An activation may also be cancelled, so it never fires with cancelMatch</p></li><li class="listitem"><p>An unblocked Match is added to the Agenda and obeys normal salience, agenda groups, ruleflow groups
        etc.</p></li><li class="listitem"><p>The @Direct annotations allows a rule to fire as soon as it's matched, this is to be used for
        rules that block/unblock matches, it is not desirable for these rules to have side effects that impact
        else where.</p></li></ul></div><div class="example"><a id="d0e13559"/><p class="title"><strong>Example 10.2. New RuleContext methods</strong></p><div class="example-contents"><pre><code class="no-highlight">void blockMatch(Match match);
      void unblockAllMatches(Match match);
      void cancelMatch(Match match);</code></pre></div></div><br class="example-break"/><p>Here is a basic example that will block all matches from rules that have metadata @department('sales').
    They will stay blocked until the blockerAllSalesRules rule becomes false, i.e. "go2" is retracted.</p><div class="example"><a id="d0e13566"/><p class="title"><strong>Example 10.3. Block rules based on rule metadata</strong></p><div class="example-contents"><pre><code class="no-highlight">rule rule1 @Eager @department('sales') when
      $s : String( this == 'go1' )
      then
      list.add( kcontext.rule.name + ':' + $s );
      end
      rule rule2 @Eager @department('sales') when
      $s : String( this == 'go1' )
      then
      list.add( kcontext.rule.name + ':' + $s );
      end
      rule blockerAllSalesRules @Direct @Eager when
      $s : String( this == 'go2' )
      $i : Match( department == 'sales' )
      then
      list.add( $i.rule.name + ':' + $s  );
      kcontext.blockMatch( $i );
      end</code></pre></div></div><br class="example-break"/><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>Further than annotate the blocking rule with @Direct, it is also necessary to annotate all the rules that
      could be potentially blocked by it with @Eager. This is because, since the Match has to be evaluated by
      the pattern matching of the blocking rule, the potentially blocked ones cannot be evaluated lazily, otherwise
      won't be any Match to be evaluated.</p></div><p>This example shows how you can use active property to count the number of active or inactive (already fired)
    matches.</p><div class="example"><a id="d0e13576"/><p class="title"><strong>Example 10.4. Count the number of active/inactive Matches</strong></p><div class="example-contents"><pre><code class="no-highlight">rule rule1 @Eager @department('sales') when
      $s : String( this == 'go1' )
      then
      list.add( kcontext.rule.name + ':' + $s );
      end
      rule rule2 @Eager @department('sales') when
      $s : String( this == 'go1' )
      then
      list.add( kcontext.rule.name + ':' + $s );
      end
      rule rule3 @Eager @department('sales') when
      $s : String( this == 'go1' )
      then
      list.add( kcontext.rule.name + ':' + $s );
      end
      rule countActivateInActive @Direct @Eager when
      $s : String( this == 'go2' )
      $active : Number( this == 1 ) from accumulate( $a : Match( department == 'sales', active == true ), count( $a ) )
      $inActive : Number( this == 2 ) from  accumulate( $a : Match( department == 'sales', active == false ), count( $a ) )
      then
      kcontext.halt( );
      end </code></pre></div></div><br class="example-break"/></div><div class="section" title="10.2. Browsing graphs of objects with OOPath"><div class="titlepage"><div><div><h2 class="title"><a id="d0e13581"/>10.2. Browsing graphs of objects with OOPath</h2></div></div></div><p>When the field of a fact is a collection it is possible to bind and reason over
    all the items in that collection on by one using the <code class="literal">from</code> keyword.
    Nevertheless, when it is required to browse a graph of object the extensive use of the
    <code class="literal">from</code> conditional element may result in a verbose and cubersome syntax
    like in the following example:
  </p><div class="example"><a id="d0e13592"/><p class="title"><strong>Example 10.5. Browsing a graph of objects with from</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Find all grades for Big Data exam" when
      $student: Student( $plan: plan )
      $exam: Exam( course == "Big Data" ) from $plan.exams
      $grade: Grade() from $exam.grades
      then /* RHS */ end</code></pre></div></div><br class="example-break"/><p>In this example it has been assumed to use a domain model consisting of a
    <code class="literal">Student</code> who has a <code class="literal">Plan</code> of study: a <code class="literal">Plan</code>
    can have zero or more <code class="literal">Exam</code>s and an <code class="literal">Exam</code> zero or more
    <code class="literal">Grade</code>s. Note that only the root object of the graph (the <code class="literal">Student</code>
    in this case) needs to be in the working memory in order to make this works.</p><p>By borrowing ideas from XPath, this syntax can be made more succinct, as XPath has a
    compact notation for navigating through related elements while handling collections and
    filtering constraints. This XPath-inspired notation has been called <code class="literal">OOPath</code>
    since it is explictly intended to browse graph of objects. Using this notation the former
    example can be rewritten as it follows:
  </p><div class="example"><a id="d0e13625"/><p class="title"><strong>Example 10.6. Browsing a graph of objects with OOPath</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Find all grades for Big Data exam" when
      Student( $grade: /plan/exams{course == "Big Data"}/grades )
      then /* RHS */ end</code></pre></div></div><br class="example-break"/><p>Formally, the core grammar of an <code class="literal">OOPath</code> expression can be defined in EBNF notation in this way.</p><pre><code class="no-highlight">OOPExpr = ( "/" | "?/" ) OOPSegment { ( "/" | "?/" | "." ) OOPSegment } ;
    OOPSegment = [ID ( ":" | ":=" )] ID ["[" Number "]"] ["{" Constraints "}"];</code></pre><p>In practice an <code class="literal">OOPath</code> expression has the following features.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>It has to start with <code class="literal">/</code> or with a <code class="literal">?/</code> in case of a completely
        non-reactive OOPath (see below).</p></li><li class="listitem"><p>It can dereference a single property of an object with the <code class="literal">.</code> operator</p></li><li class="listitem"><p>It can dereference a multiple property of an object using the <code class="literal">/</code> operator.
        If a collection is returned, it will iterate over the values in the collection</p></li><li class="listitem"><p>While traversing referenced objects it can filter away those not satisfying
        one or more constraints, written as predicate expressions between curly
        brackets like in:</p><pre><code class="no-highlight">Student( $grade: /plan/exams{ course == "Big Data" }/grades )</code></pre></li><li class="listitem"><p>A constraint can also have a beckreference to an object of the graph traversed before the
        currently iterated one. For example the following OOPath:</p><pre><code class="no-highlight">Student( $grade: /plan/exams/grades{ result &gt; ../averageResult } )</code></pre><p>will match only the grades having a result above the average for the passed exam.</p></li><li class="listitem"><p>A constraint can also recursively be another OOPath as it follows:</p><pre><code class="no-highlight">Student( $exam: /plan/exams{ /grades{ result &gt; 20 } } )</code></pre></li><li class="listitem"><p>Items can also be accessed by their index by putting it between square brackets
        like in:</p><pre><code class="no-highlight">Student( $grade: /plan/exams[0]/grades )</code></pre><p>To adhere to Java convention OOPath indexes are 0-based, compared to XPath 1-based</p></li></ul></div><div class="section" title="10.2.1. Reactive and Non-Reactive OOPath"><div class="titlepage"><div><div><h3 class="title"><a id="d0e13688"/>10.2.1. Reactive and Non-Reactive OOPath</h3></div></div></div><p>At the moment Drools is not able to react to updates involving a deeply nested object traversed
      during the evaluation of an <code class="literal">OOPath</code> expression. To make these objects reactive
      to changes it is then necessary to make them extend the class
      <code class="literal">org.drools.core.phreak.ReactiveObject</code>. It is planned to overcome this
      limitation by implementing a mechanism that automatically instruments the classes belonging
      to a specific domain model.</p><p>Having extendend that class, the domain objects can notify the engine when one of
      its field has been updated by invoking the inherited method <code class="literal">notifyModification</code>
      as in the following example:</p><div class="example"><a id="d0e13704"/><p class="title"><strong>Example 10.7. Notifying the engine that an exam has been moved to a different course</strong></p><div class="example-contents"><pre><code class="no-highlight">public void setCourse(String course) {
        this.course = course;
        notifyModification(this);
        }</code></pre></div></div><br class="example-break"/><p>In this way when using an OOPath like the following:</p><pre><code class="no-highlight">Student( $grade: /plan/exams{ course == "Big Data" }/grades )</code></pre><p>if an exam is moved to a different course, the rule is re-triggered and the list of grades
      matching the rule recomputed.</p><p>It is also possible to have reactivity only in one subpart of the OOPath as in:</p><pre><code class="no-highlight">Student( $grade: /plan/exams{ course == "Big Data" }?/grades )</code></pre><p>Here, using the <code class="literal">?/</code> separator instead of the <code class="literal">/</code> one, the engine will
      react to a change made to an exam, or if an exam is added to the plan, but not if a new grade is added to an
      existing exam. Of course if a OOPath chunk is not reactive, all remaining part of the OOPath from there till
      the end of the expression will be non-reactive as well. For instance the following OOPath</p><pre><code class="no-highlight">Student( $grade: ?/plan/exams{ course == "Big Data" }/grades )</code></pre><p>will be completely non-reactive. For this reason it is not allowed to use the
      <code class="literal">?/</code> separator more than once in the same OOPath so an expression like:</p><pre><code class="no-highlight">Student( $grade: /plan?/exams{ course == "Big Data" }?/grades )</code></pre><p>will cause a compile time error.</p></div></div></div></div><div class="part" title="Part IV. Drools Integration"><div class="titlepage"><div><div><h1 class="title"><a id="d0e13738"/>Part IV. Drools Integration</h1></div></div></div><div class="partintro" title="Drools Integration"><div/><p>Integration Documentation</p><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="chapter"><a href="#ch.commands">11. Drools Commands</a></span></dt><dd><dl><dt><span class="section"><a href="#CommandsAPISection">11.1. API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e13764">11.1.1. XStream</a></span></dt><dt><span class="section"><a href="#d0e13780">11.1.2. JSON</a></span></dt><dt><span class="section"><a href="#d0e13796">11.1.3. JAXB</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e13824">11.2. Commands supported</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e13904">11.2.1. BatchExecutionCommand</a></span></dt><dt><span class="section"><a href="#d0e13972">11.2.2. InsertObjectCommand</a></span></dt><dt><span class="section"><a href="#d0e14054">11.2.3. RetractCommand</a></span></dt><dt><span class="section"><a href="#d0e14121">11.2.4. ModifyCommand</a></span></dt><dt><span class="section"><a href="#d0e14188">11.2.5. GetObjectCommand</a></span></dt><dt><span class="section"><a href="#d0e14256">11.2.6. InsertElementsCommand</a></span></dt><dt><span class="section"><a href="#d0e14334">11.2.7. FireAllRulesCommand</a></span></dt><dt><span class="section"><a href="#d0e14409">11.2.8. StartProcessCommand</a></span></dt><dt><span class="section"><a href="#d0e14479">11.2.9. SignalEventCommand</a></span></dt><dt><span class="section"><a href="#d0e14548">11.2.10. CompleteWorkItemCommand</a></span></dt><dt><span class="section"><a href="#d0e14615">11.2.11. AbortWorkItemCommand</a></span></dt><dt><span class="section"><a href="#d0e14676">11.2.12. QueryCommand</a></span></dt><dt><span class="section"><a href="#d0e14748">11.2.13. SetGlobalCommand</a></span></dt><dt><span class="section"><a href="#d0e14826">11.2.14. GetGlobalCommand</a></span></dt><dt><span class="section"><a href="#d0e14894">11.2.15. GetObjectsCommand</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#CDIChapter">12. CDI</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e14965">12.1. Introduction</a></span></dt><dt><span class="section"><a href="#d0e14972">12.2. Annotations</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e14977">12.2.1. @KReleaseId</a></span></dt><dt><span class="section"><a href="#d0e14982">12.2.2. @KContainer</a></span></dt><dt><span class="section"><a href="#d0e15002">12.2.3. @KBase</a></span></dt><dt><span class="section"><a href="#d0e15029">12.2.4. @KSession for KieSession</a></span></dt><dt><span class="section"><a href="#d0e15056">12.2.5. @KSession for StatelessKieSession</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e15083">12.3. API Example Comparison</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ch.kie.spring">13. Integration with Spring</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e15103">13.1. Important Changes for Drools 6.0</a></span></dt><dt><span class="section"><a href="#d0e15157">13.2. Integration with Drools Expert</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e15165">13.2.1. KieModule</a></span></dt><dt><span class="section"><a href="#d0e15212">13.2.2. KieBase</a></span></dt><dt><span class="section"><a href="#d0e15312">13.2.3. IMPORTANT NOTE</a></span></dt><dt><span class="section"><a href="#d0e15337">13.2.4. KieSessions</a></span></dt><dt><span class="section"><a href="#d0e15425">13.2.5. Kie:ReleaseId</a></span></dt><dt><span class="section"><a href="#d0e15482">13.2.6. Kie:Import</a></span></dt><dt><span class="section"><a href="#d0e15565">13.2.7. Annotations</a></span></dt><dt><span class="section"><a href="#d0e15688">13.2.8. Event Listeners</a></span></dt><dt><span class="section"><a href="#d0e15844">13.2.9. Loggers</a></span></dt><dt><span class="section"><a href="#d0e15933">13.2.10. Defining Batch Commands</a></span></dt><dt><span class="section"><a href="#d0e16013">13.2.11. Persistence</a></span></dt><dt><span class="section"><a href="#d0e16043">13.2.12. Leveraging Other Spring Features</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e16083">13.3. Integration with jBPM Human Task</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16088">13.3.1. How to configure Spring with jBPM Human task</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ch.kie.android">14. Android Integration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16206">14.1. Integration with Drools Expert</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16214">14.1.1. Pre-serialized Rules</a></span></dt><dt><span class="section"><a href="#d0e16242">14.1.2. KieContainer API with drools-compiler dependency</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e16257">14.2. Integration with Roboguice</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16260">14.2.1. Pre-serialized Rules with Roboguice</a></span></dt><dt><span class="section"><a href="#d0e16290">14.2.2. KieContainer with drools-compiler dependency and Roboguice</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ch.camel">15. Apache Camel Integration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16370">15.1. Camel</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ch.server">16. Drools Camel Server</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16423">16.1. Introduction</a></span></dt><dt><span class="section"><a href="#d0e16428">16.2. Deployment</a></span></dt><dt><span class="section"><a href="#d0e16433">16.3. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16473">16.3.1. REST/Camel Services configuration</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#RHQChapter">17. JMX monitoring with RHQ/JON</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16550">17.1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16555">17.1.1. Enabling JMX monitoring in a Drools application</a></span></dt><dt><span class="section"><a href="#d0e16574">17.1.2. Installing and running the RHQ/JON plugin</a></span></dt></dl></dd></dl></dd></dl></div></div><div class="chapter" title="Chapter 11. Drools Commands"><div class="titlepage"><div><div><h2 class="title"><a id="ch.commands"/>Chapter 11. Drools Commands</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#CommandsAPISection">11.1. API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e13764">11.1.1. XStream</a></span></dt><dt><span class="section"><a href="#d0e13780">11.1.2. JSON</a></span></dt><dt><span class="section"><a href="#d0e13796">11.1.3. JAXB</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e13824">11.2. Commands supported</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e13904">11.2.1. BatchExecutionCommand</a></span></dt><dt><span class="section"><a href="#d0e13972">11.2.2. InsertObjectCommand</a></span></dt><dt><span class="section"><a href="#d0e14054">11.2.3. RetractCommand</a></span></dt><dt><span class="section"><a href="#d0e14121">11.2.4. ModifyCommand</a></span></dt><dt><span class="section"><a href="#d0e14188">11.2.5. GetObjectCommand</a></span></dt><dt><span class="section"><a href="#d0e14256">11.2.6. InsertElementsCommand</a></span></dt><dt><span class="section"><a href="#d0e14334">11.2.7. FireAllRulesCommand</a></span></dt><dt><span class="section"><a href="#d0e14409">11.2.8. StartProcessCommand</a></span></dt><dt><span class="section"><a href="#d0e14479">11.2.9. SignalEventCommand</a></span></dt><dt><span class="section"><a href="#d0e14548">11.2.10. CompleteWorkItemCommand</a></span></dt><dt><span class="section"><a href="#d0e14615">11.2.11. AbortWorkItemCommand</a></span></dt><dt><span class="section"><a href="#d0e14676">11.2.12. QueryCommand</a></span></dt><dt><span class="section"><a href="#d0e14748">11.2.13. SetGlobalCommand</a></span></dt><dt><span class="section"><a href="#d0e14826">11.2.14. GetGlobalCommand</a></span></dt><dt><span class="section"><a href="#d0e14894">11.2.15. GetObjectsCommand</a></span></dt></dl></dd></dl></div><div class="section" title="11.1. API"><div class="titlepage"><div><div><h2 class="title"><a id="CommandsAPISection"/>11.1. API</h2></div></div></div><p>XML marshalling/unmarshalling of the Drools Commands requires the use
  of special classes, which are going to be described in the following
  sections.</p><p>The following urls show sample script examples for jaxb, xstream and
  json marshalling using:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/jaxb.mvt?r=HEAD</p></li><li class="listitem"><p>http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/jaxb.mvt?r=HEAD</p></li><li class="listitem"><p>http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/xstream.mvt?r=HEAD</p></li></ul></div><div class="section" title="11.1.1. XStream"><div class="titlepage"><div><div><h3 class="title"><a id="d0e13764"/>11.1.1. XStream</h3></div></div></div><p>To use the XStream commands marshaller you need to use the
    DroolsHelperProvider to obtain an XStream instance. We need to use this
    because it has the commands converters registered.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Marshalling</p><p>BatchExecutionHelperProviderImpl.newXStreamMarshaller().toXML(command);</p></li><li class="listitem"><p>Unmarshalling</p><p>BatchExecutionHelperProviderImpl.newXStreamMarshaller().fromXML(xml)</p></li></ul></div></div><div class="section" title="11.1.2. JSON"><div class="titlepage"><div><div><h3 class="title"><a id="d0e13780"/>11.1.2. JSON</h3></div></div></div><p>JSON API to marshalling/unmarshalling is similar to XStream
    API:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Marshalling</p><p>BatchExecutionHelper.newJSonMarshaller().toXML(command);</p></li><li class="listitem"><p>Unmarshalling</p><p>BatchExecutionHelper.newJSonMarshaller().fromXML(xml)</p></li></ul></div></div><div class="section" title="11.1.3. JAXB"><div class="titlepage"><div><div><h3 class="title"><a id="d0e13796"/>11.1.3. JAXB</h3></div></div></div><p>There are two options for using JAXB, you can define your model in
    an XSD file or you can have a POJO model. In both cases you have to
    declare your model inside JAXBContext, and in order to do that you need to
    use Drools Helper classes. Once you have the JAXBContext you need to
    create the Unmarshaller/Marshaller as needed.</p><div class="section" title="11.1.3.1. Using an XSD file to define the model"><div class="titlepage"><div><div><h4 class="title"><a id="d0e13801"/>11.1.3.1. Using an XSD file to define the model</h4></div></div></div><p>With your model defined in a XSD file you need to have a
      KnowledgeBase that has your XSD model added as a resource.</p><p>To do this, the XSD file must be added as a XSD ResourceType into
      the KnowledgeBuilder. Finally you can create the JAXBContext using the
      KnowledgeBase created with the KnowledgeBuilder  </p><pre><code class="language-java">Options xjcOpts = new Options();
xjcOpts.setSchemaLanguage(Language.XMLSCHEMA);
JaxbConfiguration jaxbConfiguration = KnowledgeBuilderFactory.newJaxbConfiguration( xjcOpts, "xsd" );
kbuilder.add(ResourceFactory.newClassPathResource("person.xsd", getClass()), ResourceType.XSD, jaxbConfiguration);
KnowledgeBase kbase = kbuilder.newKnowledgeBase();

List&lt;String&gt; classesName = new ArrayList&lt;String&gt;();
classesName.add("org.drools.compiler.test.Person");
   
JAXBContext jaxbContext = KnowledgeBuilderHelper.newJAXBContext(classesName.toArray(new String[classesName.size()]), kbase);</code></pre></div><div class="section" title="11.1.3.2. Using a POJO model"><div class="titlepage"><div><div><h4 class="title"><a id="d0e13810"/>11.1.3.2. Using a POJO model</h4></div></div></div><p>In this case you need to use DroolsJaxbHelperProviderImpl to create the
      JAXBContext. This class has two parameters:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>classNames: A List with the canonical name of the classes that
          you want to use in the marshalling/unmarshalling process.</p></li><li class="listitem"><p>properties: JAXB custom properties</p></li></ol></div><pre><code class="language-java">List&lt;String&gt; classNames = new ArrayList&lt;String&gt;();
classNames.add("org.drools.compiler.test.Person");
JAXBContext jaxbContext = DroolsJaxbHelperProviderImpl.createDroolsJaxbContext(classNames, null);
Marshaller marshaller = jaxbContext.createMarshaller();</code></pre></div></div></div><div class="section" title="11.2. Commands supported"><div class="titlepage"><div><div><h2 class="title"><a id="d0e13824"/>11.2. Commands supported</h2></div></div></div><p>Currently, the following commands are supported:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>BatchExecutionCommand</p></li><li class="listitem"><p>InsertObjectCommand</p></li><li class="listitem"><p>RetractCommand</p></li><li class="listitem"><p>ModifyCommand</p></li><li class="listitem"><p>GetObjectCommand</p></li><li class="listitem"><p>InsertElementsCommand</p></li><li class="listitem"><p>FireAllRulesCommand</p></li><li class="listitem"><p>StartProcessCommand</p></li><li class="listitem"><p>SignalEventCommand</p></li><li class="listitem"><p>CompleteWorkItemCommand</p></li><li class="listitem"><p>AbortWorkItemCommand</p></li><li class="listitem"><p>QueryCommand</p></li><li class="listitem"><p>SetGlobalCommand</p></li><li class="listitem"><p>GetGlobalCommand</p></li><li class="listitem"><p>GetObjectsCommand</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>In the next snippets code we are going to use a POJO org.drools.compiler.test.Person that has two fields</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>name: String</p></li><li class="listitem"><p>age: Integer</p></li></ul></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>In the next examples, to marshall the commands we have used the next snippet codes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>XStream</p><pre><code class="language-java">String xml = BatchExecutionHelper.newXStreamMarshaller().toXML(command);</code></pre></li><li class="listitem"><p>JSON</p><pre><code class="language-java">String xml = BatchExecutionHelper.newJSonMarshaller().toXML(command);</code></pre></li><li class="listitem"><p>JAXB</p><pre><code class="language-java">Marshaller marshaller = jaxbContext.createMarshaller();
StringWriter xml = new StringWriter();
marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, true);
marshaller.marshal(command, xml);</code></pre></li></ul></div></div><div class="section" title="11.2.1. BatchExecutionCommand"><div class="titlepage"><div><div><h3 class="title"><a id="d0e13904"/>11.2.1. BatchExecutionCommand</h3></div></div></div><p/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Description: The command that contains a list of commands, which
      will be sent and executed.</p></li><li class="listitem"><p>Attributes</p><div class="table"><a id="d0e13915"/><p class="title"><strong>Table 11.1. BatchExecutionCommand attributes</strong></p><div class="table-contents"><table summary="BatchExecutionCommand attributes" border="1"><colgroup><col align="center"/><col/><col/></colgroup><thead><tr><th align="center">Name</th><th align="center">Description</th><th align="center">required</th></tr></thead><tbody><tr><td align="center">lookup</td><td>Sets the knowledge session id on which the commands are
              going to be executed</td><td>true</td></tr><tr><td align="center">commands</td><td>List of commands to be executed</td><td>false</td></tr></tbody></table></div></div><br class="table-break"/></li><li class="listitem"><p>Command creation</p><pre><code class="language-java">BatchExecutionCommand command = new BatchExecutionCommand();
command.setLookup("ksession1");
InsertObjectCommand insertObjectCommand = new InsertObjectCommand(new Person("john", 25));
FireAllRulesCommand fireAllRulesCommand = new FireAllRulesCommand();
command.getCommands().add(insertObjectCommand);
command.getCommands().add(fireAllRulesCommand);</code></pre><p/></li><li class="listitem"><p>XML output</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>XStream</p><pre><code class="language-xml">&lt;batch-execution lookup="ksession1"&gt;
  &lt;insert&gt;
    &lt;org.drools.compiler.test.Person&gt;
      &lt;name&gt;john&lt;/name&gt;
      &lt;age&gt;25&lt;/age&gt;
    &lt;/org.drools.compiler.test.Person&gt;
  &lt;/insert&gt;
  &lt;fire-all-rules/&gt;
&lt;/batch-execution&gt;</code></pre><p/></li><li class="listitem"><p>JSON</p><pre><code class="no-highlight">{"batch-execution":{"lookup":"ksession1","commands":[{"insert":{"object":{"org.drools.compiler.test.Person":{"name":"john","age":25}}}},{"fire-all-rules":""}]}} </code></pre><p/></li><li class="listitem"><p>JAXB</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;batch-execution lookup="ksession1"&gt;
    &lt;insert&gt;
        &lt;object xsi:type="person" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
            &lt;age&gt;25&lt;/age&gt;
            &lt;name&gt;john&lt;/name&gt;
        &lt;/object&gt;
    &lt;/insert&gt;
    &lt;fire-all-rules max="-1"/&gt;
&lt;/batch-execution&gt;</code></pre><p/></li></ul></div></li></ul></div><p/></div><div class="section" title="11.2.2. InsertObjectCommand"><div class="titlepage"><div><div><h3 class="title"><a id="d0e13972"/>11.2.2. InsertObjectCommand</h3></div></div></div><p/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Description: Insert an object in the knowledge session.</p></li><li class="listitem"><p>Attributes</p><div class="table"><a id="d0e13983"/><p class="title"><strong>Table 11.2. InsertObjectCommand attributes</strong></p><div class="table-contents"><table summary="InsertObjectCommand attributes" border="1"><colgroup><col align="center"/><col/><col/></colgroup><thead><tr><th align="center">Name</th><th align="center">Description</th><th align="center">required</th></tr></thead><tbody><tr><td align="center">object</td><td>The object to be inserted</td><td>true</td></tr><tr><td align="center">outIdentifier</td><td>Id to identify the FactHandle created in the object
              insertion and added to the execution results</td><td>false</td></tr><tr><td align="center">returnObject</td><td>Boolean to establish if the object must be returned in
              the execution results. Default value: true</td><td>false</td></tr><tr><td align="center">entryPoint</td><td>Entrypoint for the insertion</td><td>false</td></tr></tbody></table></div></div><br class="table-break"/></li><li class="listitem"><p>Command creation</p><pre><code class="language-java">List&lt;Command&gt; cmds = ArrayList&lt;Command&gt;();

Command insertObjectCommand = CommandFactory.newInsert(new Person("john", 25), "john", false, null);
cmds.add( insertObjectCommand );

BatchExecutionCommand command = CommandFactory.createBatchExecution(cmds, "ksession1" );
</code></pre><p/></li><li class="listitem"><p>XML output</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>XStream</p><pre><code class="language-xml">&lt;batch-execution lookup="ksession1"&gt;
  &lt;insert out-identifier="john" entry-point="my stream" return-object="false"&gt;
    &lt;org.drools.compiler.test.Person&gt;
      &lt;name&gt;john&lt;/name&gt;
      &lt;age&gt;25&lt;/age&gt;
    &lt;/org.drools.compiler.test.Person&gt;
  &lt;/insert&gt;
&lt;/batch-execution&gt;</code></pre><p/></li><li class="listitem"><p>JSON</p><pre><code class="no-highlight">{"batch-execution":{"lookup":"ksession1","commands":{"insert":{"entry-point":"my stream", "out-identifier":"john","return-object":false,"object":{"org.drools.compiler.test.Person":{"name":"john","age":25}}}}}}
</code></pre><p/></li><li class="listitem"><p>JAXB</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;batch-execution lookup="ksession1"&gt;
    &lt;insert out-identifier="john" entry-point="my stream" &gt;
        &lt;object xsi:type="person" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
            &lt;age&gt;25&lt;/age&gt;
            &lt;name&gt;john&lt;/name&gt;
        &lt;/object&gt;
    &lt;/insert&gt;
&lt;/batch-execution&gt;</code></pre><p/></li></ul></div></li></ul></div><p/></div><div class="section" title="11.2.3. RetractCommand"><div class="titlepage"><div><div><h3 class="title"><a id="d0e14054"/>11.2.3. RetractCommand</h3></div></div></div><p/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Description: Retract an object from the knowledge session.</p></li><li class="listitem"><p>Attributes</p><div class="table"><a id="d0e14065"/><p class="title"><strong>Table 11.3. RetractCommand attributes</strong></p><div class="table-contents"><table summary="RetractCommand attributes" border="1"><colgroup><col align="center"/><col/><col/></colgroup><thead><tr><th align="center">Name</th><th align="center">Description</th><th align="center">required</th></tr></thead><tbody><tr><td align="center">handle</td><td>The FactHandle associated to the object to be
              retracted</td><td>true</td></tr></tbody></table></div></div><br class="table-break"/></li><li class="listitem"><p>Command creation: we have two options, with the same output
      result:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Create the Fact Handle from a string</p><pre><code class="language-java">BatchExecutionCommand command = new BatchExecutionCommand();
command.setLookup("ksession1");
RetractCommand retractCommand = new RetractCommand();
retractCommand.setFactHandleFromString("123:234:345:456:567");
command.getCommands().add(retractCommand);</code></pre></li><li class="listitem"><p>Set the Fact Handle that you received when the object was
          inserted</p><pre><code class="language-java">BatchExecutionCommand command = new BatchExecutionCommand();
command.setLookup("ksession1");
RetractCommand retractCommand = new RetractCommand(factHandle);
command.getCommands().add(retractCommand);</code></pre></li></ol></div><p/></li><li class="listitem"><p>XML output</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>XStream</p><pre><code class="language-xml">&lt;batch-execution lookup="ksession1"&gt;
  &lt;retract fact-handle="0:234:345:456:567"/&gt;
&lt;/batch-execution&gt;</code></pre></li><li class="listitem"><p>JSON</p><pre><code class="no-highlight">{"batch-execution":{"lookup":"ksession1","commands":{"retract":{"fact-handle":"0:234:345:456:567"}}}}</code></pre></li><li class="listitem"><p>JAXB</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;batch-execution lookup="ksession1"&gt;
    &lt;retract fact-handle="0:234:345:456:567"/&gt;
&lt;/batch-execution&gt;</code></pre></li></ul></div></li></ul></div><p/></div><div class="section" title="11.2.4. ModifyCommand"><div class="titlepage"><div><div><h3 class="title"><a id="d0e14121"/>11.2.4. ModifyCommand</h3></div></div></div><p/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Description: Allows you to modify a previously inserted object in
      the knowledge session.</p></li><li class="listitem"><p>Attributes</p><div class="table"><a id="d0e14132"/><p class="title"><strong>Table 11.4. ModifyCommand attributes</strong></p><div class="table-contents"><table summary="ModifyCommand attributes" border="1"><colgroup><col align="center"/><col/><col/></colgroup><thead><tr><th align="center">Name</th><th align="center">Description</th><th align="center">required</th></tr></thead><tbody><tr><td align="center">handle</td><td>The FactHandle associated to the object to be
              retracted</td><td>true</td></tr><tr><td align="center">setters</td><td>List of setters object's modifications</td><td>true</td></tr></tbody></table></div></div><br class="table-break"/></li><li class="listitem"><p>Command creation</p><pre><code class="language-java">BatchExecutionCommand command = new BatchExecutionCommand();
command.setLookup("ksession1");
ModifyCommand modifyCommand = new ModifyCommand();
modifyCommand.setFactHandleFromString("123:234:345:456:567");
List&lt;Setter&gt; setters = new ArrayList&lt;Setter&gt;();
setters.add(new SetterImpl("age", "30"));
modifyCommand.setSetters(setters);
command.getCommands().add(modifyCommand);</code></pre><p/></li><li class="listitem"><p>XML output</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>XStream</p><pre><code class="language-xml">&lt;batch-execution lookup="ksession1"&gt;
  &lt;modify fact-handle="0:234:345:456:567"&gt;
    &lt;set accessor="age" value="30"/&gt;
  &lt;/modify&gt;
&lt;/batch-execution&gt;</code></pre><p/></li><li class="listitem"><p>JSON</p><pre><code class="no-highlight">{"batch-execution":{"lookup":"ksession1","commands":{"modify":{"fact-handle":"0:234:345:456:567","setters":{"accessor":"age","value":30}}}}} </code></pre></li><li class="listitem"><p>JAXB</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;batch-execution lookup="ksession1"&gt;
    &lt;modify fact-handle="0:234:345:456:567"&gt;
        &lt;set value="30" accessor="age"/&gt;
    &lt;/modify&gt;
&lt;/batch-execution&gt;</code></pre><p/></li></ul></div></li></ul></div><p/></div><div class="section" title="11.2.5. GetObjectCommand"><div class="titlepage"><div><div><h3 class="title"><a id="d0e14188"/>11.2.5. GetObjectCommand</h3></div></div></div><p/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Description: Used to get an object from a knowledge session</p></li><li class="listitem"><p>Attributes</p><div class="table"><a id="d0e14199"/><p class="title"><strong>Table 11.5. GetObjectCommand attributes</strong></p><div class="table-contents"><table summary="GetObjectCommand attributes" border="1"><colgroup><col align="center"/><col/><col/></colgroup><thead><tr><th align="center">Name</th><th align="center">Description</th><th align="center">required</th></tr></thead><tbody><tr><td align="center">factHandle</td><td>The FactHandle associated to the object to be
              retracted</td><td>true</td></tr><tr><td align="center">outIdentifier</td><td>Id to identify the FactHandle created in the object
              insertion and added to the execution results</td><td>false</td></tr></tbody></table></div></div><br class="table-break"/></li><li class="listitem"><p>Command creation</p><pre><code class="language-java">BatchExecutionCommand command = new BatchExecutionCommand();
command.setLookup("ksession1");
GetObjectCommand getObjectCommand = new GetObjectCommand();
getObjectCommand.setFactHandleFromString("123:234:345:456:567");
getObjectCommand.setOutIdentifier("john");
command.getCommands().add(getObjectCommand);</code></pre><p/></li><li class="listitem"><p>XML output</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>XStream</p><pre><code class="language-xml">&lt;batch-execution lookup="ksession1"&gt;
  &lt;get-object fact-handle="0:234:345:456:567" out-identifier="john"/&gt;
&lt;/batch-execution&gt;</code></pre><p/></li><li class="listitem"><p>JSON</p><pre><code class="no-highlight">{"batch-execution":{"lookup":"ksession1","commands":{"get-object":{"fact-handle":"0:234:345:456:567","out-identifier":"john"}}}}
</code></pre><p/></li><li class="listitem"><p>JAXB</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;batch-execution lookup="ksession1"&gt;
    &lt;get-object out-identifier="john" fact-handle="0:234:345:456:567"/&gt;
&lt;/batch-execution&gt;</code></pre><p/></li></ul></div></li></ul></div><p/></div><div class="section" title="11.2.6. InsertElementsCommand"><div class="titlepage"><div><div><h3 class="title"><a id="d0e14256"/>11.2.6. InsertElementsCommand</h3></div></div></div><p/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Description: Used to insert a list of objects.</p></li><li class="listitem"><p>Attributes</p><div class="table"><a id="d0e14267"/><p class="title"><strong>Table 11.6. InsertElementsCommand attributes</strong></p><div class="table-contents"><table summary="InsertElementsCommand attributes" border="1"><colgroup><col align="center"/><col/><col/></colgroup><thead><tr><th align="center">Name</th><th align="center">Description</th><th align="center">required</th></tr></thead><tbody><tr><td align="center">objects</td><td>The list of objects to be inserted on the knowledge
              session</td><td>true</td></tr><tr><td align="center">outIdentifier</td><td>Id to identify the FactHandle created in the object
              insertion and added to the execution results</td><td>false</td></tr><tr><td align="center">returnObject</td><td>Boolean to establish if the object must be returned in
              the execution results. Default value: true</td><td>false</td></tr><tr><td align="center">entryPoint</td><td>Entrypoint for the insertion</td><td>false</td></tr></tbody></table></div></div><br class="table-break"/></li><li class="listitem"><p>Command creation</p><pre><code class="language-java">List&lt;Command&gt; cmds = ArrayList&lt;Command&gt;();

List&lt;Object&gt; objects = new ArrayList&lt;Object&gt;();
objects.add(new Person("john", 25));
objects.add(new Person("sarah", 35));

Command insertElementsCommand = CommandFactory.newInsertElements( objects );
cmds.add( insertElementsCommand );

BatchExecutionCommand command = CommandFactory.createBatchExecution(cmds, "ksession1" );</code></pre><p/></li><li class="listitem"><p>XML output</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>XStream</p><pre><code class="language-xml">&lt;batch-execution lookup="ksession1"&gt;
  &lt;insert-elements&gt;
    &lt;org.drools.compiler.test.Person&gt;
      &lt;name&gt;john&lt;/name&gt;
      &lt;age&gt;25&lt;/age&gt;
    &lt;/org.drools.compiler.test.Person&gt;
    &lt;org.drools.compiler.test.Person&gt;
      &lt;name&gt;sarah&lt;/name&gt;
      &lt;age&gt;35&lt;/age&gt;
    &lt;/org.drools.compiler.test.Person&gt;
  &lt;/insert-elements&gt;
&lt;/batch-execution&gt;</code></pre></li><li class="listitem"><p>JSON</p><pre><code class="no-highlight">{"batch-execution":{"lookup":"ksession1","commands":{"insert-elements":{"objects":[{"containedObject":{"@class":"org.drools.compiler.test.Person","name":"john","age":25}},{"containedObject":{"@class":"Person","name":"sarah","age":35}}]}}}} </code></pre></li><li class="listitem"><p>JAXB</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;batch-execution lookup="ksession1"&gt;
    &lt;insert-elements return-objects="true"&gt;
        &lt;list&gt;
            &lt;element xsi:type="person" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
                &lt;age&gt;25&lt;/age&gt;
                &lt;name&gt;john&lt;/name&gt;
            &lt;/element&gt;
            &lt;element xsi:type="person" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
                &lt;age&gt;35&lt;/age&gt;
                &lt;name&gt;sarah&lt;/name&gt;
            &lt;/element&gt;
        &lt;list&gt;
    &lt;/insert-elements&gt;
&lt;/batch-execution&gt;</code></pre></li></ul></div></li></ul></div></div><div class="section" title="11.2.7. FireAllRulesCommand"><div class="titlepage"><div><div><h3 class="title"><a id="d0e14334"/>11.2.7. FireAllRulesCommand</h3></div></div></div><p/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Description: Allow execution of the rules activations
      created.</p></li><li class="listitem"><p>Attributes</p><div class="table"><a id="d0e14345"/><p class="title"><strong>Table 11.7. FireAllRulesCommand attributes</strong></p><div class="table-contents"><table summary="FireAllRulesCommand attributes" border="1"><colgroup><col align="center"/><col/><col/></colgroup><thead><tr><th align="center">Name</th><th align="center">Description</th><th align="center">required</th></tr></thead><tbody><tr><td align="center">max</td><td>The max number of rules activations to be executed.
              default is -1 and will not put any restriction on
              execution</td><td>false</td></tr><tr><td align="center">outIdentifier</td><td>Add the number of rules activations fired on the
              execution results</td><td>false</td></tr><tr><td align="center">agendaFilter</td><td>Allow the rules execution using an Agenda Filter</td><td>false</td></tr></tbody></table></div></div><br class="table-break"/></li><li class="listitem"><p>Command creation</p><pre><code class="language-java">BatchExecutionCommand command = new BatchExecutionCommand();
command.setLookup("ksession1");
FireAllRulesCommand fireAllRulesCommand = new FireAllRulesCommand();
fireAllRulesCommand.setMax(10);
fireAllRulesCommand.setOutIdentifier("firedActivations");
command.getCommands().add(fireAllRulesCommand);</code></pre><p/></li><li class="listitem"><p>XML output</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>XStream</p><pre><code class="language-xml">&lt;batch-execution lookup="ksession1"&gt;
  &lt;fire-all-rules max="10" out-identifier="firedActivations"/&gt;
&lt;/batch-execution&gt;
</code></pre><p/></li><li class="listitem"><p>JSON</p><pre><code class="no-highlight">{"batch-execution":{"lookup":"ksession1","commands":{"fire-all-rules":{"max":10,"out-identifier":"firedActivations"}}}}</code></pre><p/></li><li class="listitem"><p>JAXB</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;batch-execution lookup="ksession1"&gt;
   &lt;fire-all-rules out-identifier="firedActivations" max="10"/&gt;
&lt;/batch-execution&gt;</code></pre><p/></li></ul></div></li></ul></div><p/></div><div class="section" title="11.2.8. StartProcessCommand"><div class="titlepage"><div><div><h3 class="title"><a id="d0e14409"/>11.2.8. StartProcessCommand</h3></div></div></div><p/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Description: Allows you to start a process using the ID. Also you
      can pass parameters and initial data to be inserted.</p></li><li class="listitem"><p>Attributes</p><div class="table"><a id="d0e14420"/><p class="title"><strong>Table 11.8. StartProcessCommand attributes</strong></p><div class="table-contents"><table summary="StartProcessCommand attributes" border="1"><colgroup><col align="center"/><col/><col/></colgroup><thead><tr><th align="center">Name</th><th align="center">Description</th><th align="center">required</th></tr></thead><tbody><tr><td align="center">processId</td><td>The ID of the process to be started</td><td>true</td></tr><tr><td align="center">parameters</td><td>A Map&lt;String, Object&gt; to pass parameters in the
              process startup</td><td>false</td></tr><tr><td align="center">data</td><td>A list of objects to be inserted in the knowledge session
              before the process startup</td><td>false</td></tr></tbody></table></div></div><br class="table-break"/></li><li class="listitem"><p>Command creation</p><pre><code class="language-java">BatchExecutionCommand command = new BatchExecutionCommand();
command.setLookup("ksession1");
StartProcessCommand startProcessCommand = new StartProcessCommand();
startProcessCommand.setProcessId("org.drools.task.processOne");
command.getCommands().add(startProcessCommand);</code></pre></li><li class="listitem"><p>XML output</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>XStream</p><pre><code class="language-xml">&lt;batch-execution lookup="ksession1"&gt;
  &lt;start-process processId="org.drools.task.processOne"/&gt;
&lt;/batch-execution&gt;</code></pre></li><li class="listitem"><p>JSON</p><pre><code class="no-highlight">{"batch-execution":{"lookup":"ksession1","commands":{"start-process":{"process-id":"org.drools.task.processOne"}}}} </code></pre></li><li class="listitem"><p>JAXB</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;batch-execution lookup="ksession1"&gt;
    &lt;start-process processId="org.drools.task.processOne"&gt;
        &lt;parameter/&gt;
    &lt;/start-process&gt;
&lt;/batch-execution&gt;</code></pre></li></ul></div></li></ul></div></div><div class="section" title="11.2.9. SignalEventCommand"><div class="titlepage"><div><div><h3 class="title"><a id="d0e14479"/>11.2.9. SignalEventCommand</h3></div></div></div><p/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Description: Send a signal event.</p></li><li class="listitem"><p>Attributes</p><div class="table"><a id="d0e14490"/><p class="title"><strong>Table 11.9. SignalEventCommand attributes</strong></p><div class="table-contents"><table summary="SignalEventCommand attributes" border="1"><colgroup><col align="center"/><col/><col/></colgroup><thead><tr><th align="center">Name</th><th align="center">Description</th><th align="center">required</th></tr></thead><tbody><tr><td align="center">event-type</td><td> </td><td>true</td></tr><tr><td align="center">processInstanceId</td><td> </td><td>false</td></tr><tr><td align="center">event</td><td> </td><td>false</td></tr></tbody></table></div></div><br class="table-break"/></li><li class="listitem"><p>Command creation</p><pre><code class="language-java">BatchExecutionCommand command = new BatchExecutionCommand();
command.setLookup("ksession1");
SignalEventCommand signalEventCommand = new SignalEventCommand();
signalEventCommand.setProcessInstanceId(1001);
signalEventCommand.setEventType("start");
signalEventCommand.setEvent(new Person("john", 25));
command.getCommands().add(signalEventCommand);</code></pre></li><li class="listitem"><p>XML output</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>XStream</p><pre><code class="language-xml">&lt;batch-execution lookup="ksession1"&gt;
  &lt;signal-event process-instance-id="1001" event-type="start"&gt;
    &lt;org.drools.pipeline.camel.Person&gt;
      &lt;name&gt;john&lt;/name&gt;
      &lt;age&gt;25&lt;/age&gt;
    &lt;/org.drools.pipeline.camel.Person&gt;
  &lt;/signal-event&gt;
&lt;/batch-execution&gt;</code></pre><p/></li><li class="listitem"><p>JSON</p><pre><code class="no-highlight">{"batch-execution":{"lookup":"ksession1","commands":{"signal-event":{"process-instance-id":1001,"@event-type":"start","event-type":"start","object":{"org.drools.pipeline.camel.Person":{"name":"john","age":25}}}}}}</code></pre></li><li class="listitem"><p>JAXB</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;batch-execution lookup="ksession1"&gt;
    &lt;signal-event event-type="start" process-instance-id="1001"&gt;
        &lt;event xsi:type="person" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
            &lt;age&gt;25&lt;/age&gt;
            &lt;name&gt;john&lt;/name&gt;
        &lt;/event&gt;
    &lt;/signal-event&gt;
&lt;/batch-execution&gt;</code></pre></li></ul></div></li></ul></div><p/></div><div class="section" title="11.2.10. CompleteWorkItemCommand"><div class="titlepage"><div><div><h3 class="title"><a id="d0e14548"/>11.2.10. CompleteWorkItemCommand</h3></div></div></div><p/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Description: Allows you to complete a WorkItem.</p></li><li class="listitem"><p>Attributes</p><div class="table"><a id="d0e14559"/><p class="title"><strong>Table 11.10. CompleteWorkItemCommand attributes</strong></p><div class="table-contents"><table summary="CompleteWorkItemCommand attributes" border="1"><colgroup><col align="center"/><col/><col/></colgroup><thead><tr><th align="center">Name</th><th align="center">Description</th><th align="center">required</th></tr></thead><tbody><tr><td align="center">workItemId</td><td>The ID of the WorkItem to be completed</td><td>true</td></tr><tr><td align="center">results</td><td> </td><td>false</td></tr></tbody></table></div></div><br class="table-break"/></li><li class="listitem"><p>Command creation</p><pre><code class="language-java">BatchExecutionCommand command = new BatchExecutionCommand();
command.setLookup("ksession1");
CompleteWorkItemCommand completeWorkItemCommand = new CompleteWorkItemCommand();
completeWorkItemCommand.setWorkItemId(1001);
command.getCommands().add(completeWorkItemCommand);</code></pre><p/></li><li class="listitem"><p>XML output</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>XStream</p><pre><code class="language-xml">&lt;batch-execution lookup="ksession1"&gt;
  &lt;complete-work-item id="1001"/&gt;
&lt;/batch-execution&gt;</code></pre><p/></li><li class="listitem"><p>JSON</p><pre><code class="no-highlight">{"batch-execution":{"lookup":"ksession1","commands":{"complete-work-item":{"id":1001}}}} </code></pre><p/></li><li class="listitem"><p>JAXB</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;batch-execution lookup="ksession1"&gt;
    &lt;complete-work-item id="1001"/&gt;
&lt;/batch-execution&gt;</code></pre><p/></li></ul></div></li></ul></div><p/></div><div class="section" title="11.2.11. AbortWorkItemCommand"><div class="titlepage"><div><div><h3 class="title"><a id="d0e14615"/>11.2.11. AbortWorkItemCommand</h3></div></div></div><p/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Description: Allows you abort an WorkItem. The same as
      session.getWorkItemManager().abortWorkItem(workItemId)</p></li><li class="listitem"><p>Attributes</p><div class="table"><a id="d0e14626"/><p class="title"><strong>Table 11.11. AbortWorkItemCommand attributes</strong></p><div class="table-contents"><table summary="AbortWorkItemCommand attributes" border="1"><colgroup><col align="center"/><col/><col/></colgroup><thead><tr><th align="center">Name</th><th align="center">Description</th><th align="center">required</th></tr></thead><tbody><tr><td align="center">workItemId</td><td>The ID of the WorkItem to be completed</td><td>true</td></tr></tbody></table></div></div><br class="table-break"/></li><li class="listitem"><p>Command creation</p><pre><code class="language-java">BatchExecutionCommand command = new BatchExecutionCommand();
command.setLookup("ksession1");
AbortWorkItemCommand abortWorkItemCommand = new AbortWorkItemCommand();
abortWorkItemCommand.setWorkItemId(1001);
command.getCommands().add(abortWorkItemCommand);</code></pre><p/></li><li class="listitem"><p>XML output</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>XStream</p><pre><code class="language-xml">&lt;batch-execution lookup="ksession1"&gt;
  &lt;abort-work-item id="1001"/&gt;
&lt;/batch-execution&gt;</code></pre><p/></li><li class="listitem"><p>JSON</p><pre><code class="no-highlight">{"batch-execution":{"lookup":"ksession1","commands":{"abort-work-item":{"id":1001}}}} </code></pre><p/></li><li class="listitem"><p>JAXB</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;batch-execution lookup="ksession1"&gt;
    &lt;abort-work-item id="1001"/&gt;
&lt;/batch-execution&gt;</code></pre><p/></li></ul></div></li></ul></div><p/></div><div class="section" title="11.2.12. QueryCommand"><div class="titlepage"><div><div><h3 class="title"><a id="d0e14676"/>11.2.12. QueryCommand</h3></div></div></div><p/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Description: Executes a query defined in knowledge base.</p></li><li class="listitem"><p>Attributes</p><div class="table"><a id="d0e14687"/><p class="title"><strong>Table 11.12. QueryCommand attributes</strong></p><div class="table-contents"><table summary="QueryCommand attributes" border="1"><colgroup><col align="center"/><col/><col/></colgroup><thead><tr><th align="center">Name</th><th align="center">Description</th><th align="center">required</th></tr></thead><tbody><tr><td align="center">name</td><td>The query name</td><td>true</td></tr><tr><td align="center">outIdentifier</td><td>The identifier of the query results. The query results
              are going to be added in the execution results with this
              identifier</td><td>false</td></tr><tr><td align="center">arguments</td><td>A list of objects to be passed as a query
              parameter</td><td>false</td></tr></tbody></table></div></div><br class="table-break"/></li><li class="listitem"><p>Command creation</p><pre><code class="language-java">BatchExecutionCommand command = new BatchExecutionCommand();
command.setLookup("ksession1");
QueryCommand queryCommand = new QueryCommand();
queryCommand.setName("persons");
queryCommand.setOutIdentifier("persons");
command.getCommands().add(queryCommand);</code></pre></li><li class="listitem"><p>XML output</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>XStream</p><pre><code class="language-xml">&lt;batch-execution lookup="ksession1"&gt;
  &lt;query out-identifier="persons" name="persons"/&gt;
&lt;/batch-execution&gt;</code></pre><p/></li><li class="listitem"><p>JSON</p><pre><code class="no-highlight">{"batch-execution":{"lookup":"ksession1","commands":{"query":{"out-identifier":"persons","name":"persons"}}}} </code></pre></li><li class="listitem"><p>JAXB</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;batch-execution lookup="ksession1"&gt;
    &lt;query name="persons" out-identifier="persons"/&gt;
&lt;/batch-execution&gt;</code></pre></li></ul></div></li></ul></div><p/></div><div class="section" title="11.2.13. SetGlobalCommand"><div class="titlepage"><div><div><h3 class="title"><a id="d0e14748"/>11.2.13. SetGlobalCommand</h3></div></div></div><p/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Description: Allows you to set a global.</p></li><li class="listitem"><p>Attributes</p><div class="table"><a id="d0e14759"/><p class="title"><strong>Table 11.13. SetGlobalCommand attributes</strong></p><div class="table-contents"><table summary="SetGlobalCommand attributes" border="1"><colgroup><col align="center"/><col/><col/></colgroup><thead><tr><th align="center">Name</th><th align="center">Description</th><th align="center">required</th></tr></thead><tbody><tr><td align="center">identifier</td><td>The identifier of the global defined in the knowledge
              base</td><td>true</td></tr><tr><td align="center">object</td><td>The object to be set into the global</td><td>false</td></tr><tr><td align="center">out</td><td>A boolean to add, or not, the set global result into the
              execution results</td><td>false</td></tr><tr><td align="center">outIdentifier</td><td>The identifier of the global execution result</td><td>false</td></tr></tbody></table></div></div><br class="table-break"/></li><li class="listitem"><p>Command creation</p><pre><code class="language-java">BatchExecutionCommand command = new BatchExecutionCommand();
command.setLookup("ksession1");
SetGlobalCommand setGlobalCommand = new SetGlobalCommand();
setGlobalCommand.setIdentifier("helper");
setGlobalCommand.setObject(new Person("kyle", 30));
setGlobalCommand.setOut(true);
setGlobalCommand.setOutIdentifier("output");
command.getCommands().add(setGlobalCommand);</code></pre></li><li class="listitem"><p>XML output</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>XStream</p><pre><code class="language-xml">&lt;batch-execution lookup="ksession1"&gt;
  &lt;set-global identifier="helper" out-identifier="output"&gt;
    &lt;org.drools.compiler.test.Person&gt;
      &lt;name&gt;kyle&lt;/name&gt;
      &lt;age&gt;30&lt;/age&gt;
    &lt;/org.drools.compiler.test.Person&gt;
  &lt;/set-global&gt;
&lt;/batch-execution&gt;</code></pre></li><li class="listitem"><p>JSON</p><pre><code class="no-highlight">{"batch-execution":{"lookup":"ksession1","commands":{"set-global":{"identifier":"helper","out-identifier":"output","object":{"org.drools.compiler.test.Person":{"name":"kyle","age":30}}}}}}</code></pre></li><li class="listitem"><p>JAXB</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;batch-execution lookup="ksession1"&gt;
    &lt;set-global out="true" out-identifier="output" identifier="helper"&gt;
        &lt;object xsi:type="person" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
            &lt;age&gt;30&lt;/age&gt;
            &lt;name&gt;kyle&lt;/name&gt;
        &lt;/object&gt;
    &lt;/set-global&gt;
&lt;/batch-execution&gt;</code></pre></li></ul></div></li></ul></div><p/></div><div class="section" title="11.2.14. GetGlobalCommand"><div class="titlepage"><div><div><h3 class="title"><a id="d0e14826"/>11.2.14. GetGlobalCommand</h3></div></div></div><p/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Description: Allows you to get a global previously defined.</p></li><li class="listitem"><p>Attributes</p><div class="table"><a id="d0e14837"/><p class="title"><strong>Table 11.14. GetGlobalCommand attributes</strong></p><div class="table-contents"><table summary="GetGlobalCommand attributes" border="1"><colgroup><col align="center"/><col/><col/></colgroup><thead><tr><th align="center">Name</th><th align="center">Description</th><th align="center">required</th></tr></thead><tbody><tr><td align="center">identifier</td><td>The identifier of the global defined in the knowledge
              base</td><td>true</td></tr><tr><td align="center">outIdentifier</td><td>The identifier to be used in the execution
              results</td><td>false</td></tr></tbody></table></div></div><br class="table-break"/></li><li class="listitem"><p>Command creation</p><pre><code class="language-java">BatchExecutionCommand command = new BatchExecutionCommand();
command.setLookup("ksession1");
GetGlobalCommand getGlobalCommand = new GetGlobalCommand();
getGlobalCommand.setIdentifier("helper");
getGlobalCommand.setOutIdentifier("helperOutput");
command.getCommands().add(getGlobalCommand);</code></pre><p/></li><li class="listitem"><p>XML output</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>XStream</p><pre><code class="language-xml">&lt;batch-execution lookup="ksession1"&gt;
  &lt;get-global identifier="helper" out-identifier="helperOutput"/&gt;
&lt;/batch-execution&gt;</code></pre><p/></li><li class="listitem"><p>JSON</p><pre><code class="no-highlight">{"batch-execution":{"lookup":"ksession1","commands":{"get-global":{"identifier":"helper","out-identifier":"helperOutput"}}}} </code></pre><p/></li><li class="listitem"><p>JAXB</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;batch-execution lookup="ksession1"&gt;
    &lt;get-global out-identifier="helperOutput" identifier="helper"/&gt;
&lt;/batch-execution&gt;</code></pre><p/></li></ul></div></li></ul></div><p/></div><div class="section" title="11.2.15. GetObjectsCommand"><div class="titlepage"><div><div><h3 class="title"><a id="d0e14894"/>11.2.15. GetObjectsCommand</h3></div></div></div><p/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Description: Returns all the objects from the current session as a
      Collection.</p></li><li class="listitem"><p>Attributes</p><div class="table"><a id="d0e14905"/><p class="title"><strong>Table 11.15. GetObjectsCommand attributes</strong></p><div class="table-contents"><table summary="GetObjectsCommand attributes" border="1"><colgroup><col align="center"/><col/><col/></colgroup><thead><tr><th align="center">Name</th><th align="center">Description</th><th align="center">required</th></tr></thead><tbody><tr><td align="center">objectFilter</td><td>An ObjectFilter to filter the objects returned from the
              current session</td><td>false</td></tr><tr><td align="center">outIdentifier</td><td>The identifier to be used in the execution
              results</td><td>false</td></tr></tbody></table></div></div><br class="table-break"/></li><li class="listitem"><p>Command creation</p><pre><code class="language-java">BatchExecutionCommand command = new BatchExecutionCommand();
command.setLookup("ksession1");
GetObjectsCommand getObjectsCommand = new GetObjectsCommand();
getObjectsCommand.setOutIdentifier("objects");
command.getCommands().add(getObjectsCommand);</code></pre><p/></li><li class="listitem"><p>XML output</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>XStream</p><pre><code class="language-xml">&lt;batch-execution lookup="ksession1"&gt;
  &lt;get-objects out-identifier="objects"/&gt;
&lt;/batch-execution&gt;</code></pre><p/></li><li class="listitem"><p>JSON</p><pre><code class="no-highlight">{"batch-execution":{"lookup":"ksession1","commands":{"get-objects":{"out-identifier":"objects"}}}}</code></pre><p/></li><li class="listitem"><p>JAXB</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;batch-execution lookup="ksession1"&gt;
    &lt;get-objects out-identifier="objects"/&gt;
&lt;/batch-execution&gt;</code></pre><p/></li></ul></div></li></ul></div><p/></div></div></div><div class="chapter" title="Chapter 12. CDI"><div class="titlepage"><div><div><h2 class="title"><a id="CDIChapter"/>Chapter 12. CDI</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e14965">12.1. Introduction</a></span></dt><dt><span class="section"><a href="#d0e14972">12.2. Annotations</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e14977">12.2.1. @KReleaseId</a></span></dt><dt><span class="section"><a href="#d0e14982">12.2.2. @KContainer</a></span></dt><dt><span class="section"><a href="#d0e15002">12.2.3. @KBase</a></span></dt><dt><span class="section"><a href="#d0e15029">12.2.4. @KSession for KieSession</a></span></dt><dt><span class="section"><a href="#d0e15056">12.2.5. @KSession for StatelessKieSession</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e15083">12.3. API Example Comparison</a></span></dt></dl></div><div class="section" title="12.1. Introduction"><div class="titlepage"><div><div><h2 class="title"><a id="d0e14965"/>12.1. Introduction</h2></div></div></div><p><a class="link" href="http://www.cdi-spec.org">CDI</a>, Contexts and  Dependency Injection,
      is Java specification that provides declarative controls and strucutres to an application. KIE
      can use it to automatically instantiate and bind things, without the need to use the
      programmatic API. </p></div><div class="section" title="12.2. Annotations"><div class="titlepage"><div><div><h2 class="title"><a id="d0e14972"/>12.2. Annotations</h2></div></div></div><p>@KContainer, @KBase and @KSession all support an optional 'name' attribute. CDI typically
      does "getOrCreate" when it injects, all injections receive the same instance for the same set
      of annotations. the 'name' annotation forces a unique instance for each name, although all
      instance for that name will be identity equals.</p><div class="section" title="12.2.1. @KReleaseId"><div class="titlepage"><div><div><h3 class="title"><a id="d0e14977"/>12.2.1. @KReleaseId</h3></div></div></div><p>Used to bind an instance to a specific version of a KieModule. If kie-ci is on the
        classpath this will resolve dependencies automatically, downloading from remote
        repositories.</p></div><div class="section" title="12.2.2. @KContainer"><div class="titlepage"><div><div><h3 class="title"><a id="d0e14982"/>12.2.2. @KContainer</h3></div></div></div><p>@KContainer is optional as it can be detected and added by the use of @Inject and
        variable type inferrence.</p><div class="figure"><a id="d0e14987"/><p class="title"><strong>Figure 12.1. Injects Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
private KieContainer kContainer;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e14992"/><p class="title"><strong>Figure 12.2. Injects KieContainer for Dynamic KieModule</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KReleaseId(groupId = "jar1", artifactId = "art1", version = "1.1")
private KieContainer kContainer;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e14997"/><p class="title"><strong>Figure 12.3. Injects named KieContainer for Dynamic KieModule</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KContainer(name = "kc1")
@KReleaseId(groupId = "jar1", artifactId = "art1", version = "1.1")
private KieContainer kContainer;</code></pre></div></div><br class="figure-break"/></div><div class="section" title="12.2.3. @KBase"><div class="titlepage"><div><div><h3 class="title"><a id="d0e15002"/>12.2.3. @KBase</h3></div></div></div><p>@KBase is optional as it can be detected and added by the use of @Inject and variable
        type inference.</p><p>The default argument, if given, maps to the value attribute and specifies the name of the KieBase from the
        kmodule.xml file.</p><div class="figure"><a id="d0e15009"/><p class="title"><strong>Figure 12.4. Injects the Default KieBase from the Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
private KieBase kbase;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15014"/><p class="title"><strong>Figure 12.5. Injects the Default KieBase from a Dynamic KieModule</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")   
private KieBase kbase;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15019"/><p class="title"><strong>Figure 12.6. Side by side version loading for 'jar1.KBase1' KieBase</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KBase("kbase1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase1v10;

@Inject
@KBase("kbase1") 
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.1")
private KieBase kbase1v10;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15024"/><p class="title"><strong>Figure 12.7. Use 'name' attribute to force new Instance for 'jar1.KBase1' KieBase</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KSession(value="kbase1", name="kb1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase1kb1;

@Inject  
@KSession(value="kbase1", name="kb2")    
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase1kb2;</code></pre></div></div><br class="figure-break"/></div><div class="section" title="12.2.4. @KSession for KieSession"><div class="titlepage"><div><div><h3 class="title"><a id="d0e15029"/>12.2.4. @KSession for KieSession</h3></div></div></div><p>@KSession is optional as it can be detected and added by the use of @Inject and variable
        type inference.</p><p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the
        kmodule.xml file</p><div class="figure"><a id="d0e15036"/><p class="title"><strong>Figure 12.8. Injects the Default KieSession from the Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
private KieSession ksession;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15041"/><p class="title"><strong>Figure 12.9. Injects the Default KieSession from a Dynamic KieModule</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")   
private KieSession ksession;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15046"/><p class="title"><strong>Figure 12.10. Side by side version loading for 'jar1.KBase1' KieBase</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KSession("ksession1") 
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksessionv10;

@Inject
@KSession("ksession1") 
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.1")
private KieSession ksessionv11;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15051"/><p class="title"><strong>Figure 12.11. Use 'name' attribute to force new Instance for 'jar1.KBase1' KieSession</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KSession(value="ksession1", name="ks1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession1ks1

@Inject  
@KSession(value="ksession1", name="ks2")    
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession1ks2</code></pre></div></div><br class="figure-break"/></div><div class="section" title="12.2.5. @KSession for StatelessKieSession"><div class="titlepage"><div><div><h3 class="title"><a id="d0e15056"/>12.2.5. @KSession for StatelessKieSession</h3></div></div></div><p>@KSession is optional as it can be detected and added by the use of @Inject and variable
        type inference.</p><p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the
        kmodule.xml file.</p><div class="figure"><a id="d0e15063"/><p class="title"><strong>Figure 12.12. Injects the Default StatelessKieSession from the Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
private StatelessKieSession ksession;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15068"/><p class="title"><strong>Figure 12.13. Injects the Default StatelessKieSession from a Dynamic KieModule</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")   
private StatelessKieSession ksession;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15073"/><p class="title"><strong>Figure 12.14. Side by side version loading for 'jar1.KBase1' KieBase</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KSession("ksession1") 
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.0")
private StatelessKieSession ksessionv10;

@Inject
@KSession("ksession1") 
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.1")
private StatelessKieSession ksessionv11;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15078"/><p class="title"><strong>Figure 12.15. Use 'name' attribute to force new Instance for 'jar1.KBase1'
          StatelessKieSession</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KSession(value="ksession1", name="ks1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession1ks1

@Inject  
@KSession(value="ksession1", name="ks2")    
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession1ks2</code></pre></div></div><br class="figure-break"/></div></div><div class="section" title="12.3. API Example Comparison"><div class="titlepage"><div><div><h2 class="title"><a id="d0e15083"/>12.3. API Example Comparison</h2></div></div></div><p>CDI can inject instances into fields, or even pass them as arguments. In this example field injection is
      used.</p><div class="figure"><a id="d0e15088"/><p class="title"><strong>Figure 12.16. CDI example for a named KieSession</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KSession("ksession1")
KieSession kSession;

public void go(PrintStream out) {
    kSession.setGlobal("out", out);
    kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
    kSession.fireAllRules();
}</code></pre></div></div><br class="figure-break"/><p>This is less code and more declarative than the API approach.</p><div class="figure"><a id="d0e15095"/><p class="title"><strong>Figure 12.17. API equivalent example for a named KieSession</strong></p><div class="figure-contents"><pre><code class="language-java">public void go(PrintStream out) {
    KieServices ks = KieServices.Factory.get();
    KieContainer kContainer = ks.getKieClasspathContainer();

    KieSession kSession = kContainer.newKieSession("ksession1");
    kSession.setGlobal("out", out);
    kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
    kSession.fireAllRules();
}</code></pre></div></div><br class="figure-break"/></div></div><div class="chapter" title="Chapter 13. Integration with Spring"><div class="titlepage"><div><div><h2 class="title"><a id="ch.kie.spring"/>Chapter 13. Integration with Spring</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e15103">13.1. Important Changes for Drools 6.0</a></span></dt><dt><span class="section"><a href="#d0e15157">13.2. Integration with Drools Expert</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e15165">13.2.1. KieModule</a></span></dt><dt><span class="section"><a href="#d0e15212">13.2.2. KieBase</a></span></dt><dt><span class="section"><a href="#d0e15312">13.2.3. IMPORTANT NOTE</a></span></dt><dt><span class="section"><a href="#d0e15337">13.2.4. KieSessions</a></span></dt><dt><span class="section"><a href="#d0e15425">13.2.5. Kie:ReleaseId</a></span></dt><dt><span class="section"><a href="#d0e15482">13.2.6. Kie:Import</a></span></dt><dt><span class="section"><a href="#d0e15565">13.2.7. Annotations</a></span></dt><dt><span class="section"><a href="#d0e15688">13.2.8. Event Listeners</a></span></dt><dt><span class="section"><a href="#d0e15844">13.2.9. Loggers</a></span></dt><dt><span class="section"><a href="#d0e15933">13.2.10. Defining Batch Commands</a></span></dt><dt><span class="section"><a href="#d0e16013">13.2.11. Persistence</a></span></dt><dt><span class="section"><a href="#d0e16043">13.2.12. Leveraging Other Spring Features</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e16083">13.3. Integration with jBPM Human Task</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16088">13.3.1. How to configure Spring with jBPM Human task</a></span></dt></dl></dd></dl></div><div class="section" title="13.1. Important Changes for Drools 6.0"><div class="titlepage"><div><div><h2 class="title"><a id="d0e15103"/>13.1. Important Changes for Drools 6.0</h2></div></div></div><p>Drools Spring integration has undergone a complete makeover inline
    with the changes for Drools 6.0. The following are some of the major
    changes</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The recommended prefix for the Drools Spring has changed from
        'drools:' to 'kie:'</p></li><li class="listitem"><p>New Top Level Tags in 6.0</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>kie:kmodule</p></li><li class="listitem"><p>kie:import (from version 6.2)</p></li><li class="listitem"><p>kie:releaseId (from version 6.2)</p></li></ul></div></li><li class="listitem"><p>The following tags are no longer valid as top level tags.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>kie:kbase - A child of the <span class="emphasis"><em>kie:kmodule</em></span>
            tag.</p></li><li class="listitem"><p>kie:ksession - A child of the <span class="emphasis"><em>kie:kbase</em></span>
            tag.</p></li></ul></div></li><li class="listitem"><p>Removed Tags from previous versions Drools 5.x</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>drools:resources</p></li><li class="listitem"><p>drools:resource</p></li><li class="listitem"><p>drools:grid</p></li><li class="listitem"><p>drools:grid-node</p></li></ul></div></li></ul></div></div><div class="section" title="13.2. Integration with Drools Expert"><div class="titlepage"><div><div><h2 class="title"><a id="d0e15157"/>13.2. Integration with Drools Expert</h2></div></div></div><p>In this section we will explain the <span class="emphasis"><em>kie</em></span>
    namespace.</p><div class="section" title="13.2.1. KieModule"><div class="titlepage"><div><div><h3 class="title"><a id="d0e15165"/>13.2.1. KieModule</h3></div></div></div><p>
      </p><p>The <span class="emphasis"><em>&lt;kie:kmodule&gt;</em></span> defines a collection
      of KieBase and associated KieSession's. The <span class="emphasis"><em>kmodule</em></span>
      tag has one MANDATORY parameter 'id'.</p><div class="table"><a id="d0e15178"/><p class="title"><strong>Table 13.1. Sample</strong></p><div class="table-contents"><table summary="Sample" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Description</th><th align="center">Required</th></tr></thead><tbody><tr><td align="left">id</td><td align="left">Bean's <span class="emphasis"><em>id</em></span> is the name to be
              referenced from other beans. Standard Spring ID semantics
              apply.</td><td align="left">Yes</td></tr></tbody></table></div></div><br class="table-break"/><p>A <span class="emphasis"><em>kmodule</em></span> tag can contain only the following
      tags as children.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>kie:kbase</p></li></ul></div><p>Refer to the documentation of kmodule.xml in the Drools Expert
      documentation for detailed explanation of the need for kmodule.</p></div><div class="section" title="13.2.2. KieBase"><div class="titlepage"><div><div><h3 class="title"><a id="d0e15212"/>13.2.2. KieBase</h3></div></div></div><div class="section" title="13.2.2.1. &lt;kie:kbase&gt;'s parameters as attributes:"><div class="titlepage"><div><div><h4 class="title"><a id="d0e15215"/>13.2.2.1. &lt;kie:kbase&gt;'s parameters as attributes:</h4></div></div></div><div class="table"><a id="d0e15218"/><p class="title"><strong>Table 13.2. Sample</strong></p><div class="table-contents"><table summary="Sample" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Description</th><th align="center">Required</th></tr></thead><tbody><tr><td align="left">name</td><td align="left">Name of the KieBase</td><td align="left">Yes</td></tr><tr><td align="left">packages</td><td align="left">Comma separated list of resource packages to be
                included in this kbase</td><td align="left">No</td></tr><tr><td align="left">includes</td><td align="left">kbase names to be included. All resources from the
                corresponding kbase are included in this kbase.</td><td align="left">No</td></tr><tr><td align="left">default</td><td align="left">Boolean (TRUE/FALSE). Default kbase, if not provided,
                it is assumed to be FALSE</td><td align="left">No</td></tr><tr><td align="left">scope</td><td align="left">prototype | singleton. If not provided assumed to be singleton (default)</td><td align="left">No</td></tr><tr><td align="left">eventProcessingMode</td><td align="left">Event Processing Mode. Valid options are STREAM,
                CLOUD</td><td align="left">No</td></tr><tr><td align="left">equalsBehavior</td><td align="left">Valid options are IDENTITY, EQUALITY</td><td align="left">No</td></tr><tr><td align="left">declarativeAgenda</td><td align="left">Valid options are enabled, disabled, true,
                false</td><td align="left">No</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="section" title="13.2.2.2. A kbase tag can contain only the following tags as children."><div class="titlepage"><div><div><h4 class="title"><a id="d0e15287"/>13.2.2.2. A <span class="emphasis"><em>kbase</em></span> tag can contain only the following
        tags as children.</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>kie:ksession</p></li></ul></div></div><div class="section" title="13.2.2.3. &lt;kie:kbase&gt;'s definition example"><div class="titlepage"><div><div><h4 class="title"><a id="d0e15297"/>13.2.2.3. &lt;kie:kbase&gt;'s definition example</h4></div></div></div><p>A kmodule can contain multiple (1..n) kbase elements.</p><div class="example"><a id="d0e15302"/><p class="title"><strong>Example 13.1. kbase definition example</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;kie:kmodule id="sample_module"&gt;
   &lt;kie:kbase name="kbase1" packages="org.drools.spring.sample"&gt;
     ...
   &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor" 
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="13.2.2.4. Spring Bean Scope (for KieBase and KieSession)"><div class="titlepage"><div><div><h4 class="title"><a id="d0e15307"/>13.2.2.4. Spring Bean Scope (for KieBase and KieSession)</h4></div></div></div><p>
          When defining a KieBase or a KieSession, you have the option of declaring a scope for that bean.
          For example, To force Spring to produce a new bean instance each time one is needed, you should declare the bean's scope
          attribute to be 'prototype'.
          Similar way if you want Spring to return the same bean instance each time one is needed,
          you should declare the bean's scope attribute to be 'singleton'.
        </p></div></div><div class="section" title="13.2.3. IMPORTANT NOTE"><div class="titlepage"><div><div><h3 class="title"><a id="d0e15312"/>13.2.3. IMPORTANT NOTE</h3></div></div></div><p>For proper initialization of the kmodule objects (kbase/ksession),
      it is mandatory for a bean of type
      <code class="code">org.kie.spring.KModuleBeanFactoryPostProcessor</code> or
        <code class="code">org.kie.spring.annotations.KModuleAnnotationPostProcessor</code> be
      defined.</p><div class="example"><a id="d0e15323"/><p class="title"><strong>Example 13.2. Regular kie-spring post processorbean definition</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;bean id="kiePostProcessor" 
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre></div></div><br class="example-break"/><p/><div class="example"><a id="d0e15329"/><p class="title"><strong>Example 13.3. kie-spring post processorbean definition when annotations are used</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;bean id="kiePostProcessor"
          class="org.kie.spring.annotations.KModuleAnnotationPostProcessor"/&gt;</code></pre></div></div><br class="example-break"/><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Without the
      org.kie.spring.KModuleBeanFactoryPostProcessor or org.kie.spring.annotations.KModuleAnnotationPostProcessor bean
      definition, the kie-spring integration will fail to work.</p></div></div><div class="section" title="13.2.4. KieSessions"><div class="titlepage"><div><div><h3 class="title"><a id="d0e15337"/>13.2.4. KieSessions</h3></div></div></div><p>&lt;kie:ksession&gt; element defines KieSessions. The same tag is
      used to define both Stateful
      (<span class="emphasis"><em>org.kie.api.runtime.KieSession</em></span>) and Stateless
      (<span class="emphasis"><em>org.kie.api.runtime.StatelessKieSession</em></span>)
      sessions.</p><div class="section" title="13.2.4.1. &lt;kie:ksession&gt;'s parameters as attributes:"><div class="titlepage"><div><div><h4 class="title"><a id="d0e15348"/>13.2.4.1. &lt;kie:ksession&gt;'s parameters as attributes:</h4></div></div></div><div class="table"><a id="d0e15351"/><p class="title"><strong>Table 13.3. Sample</strong></p><div class="table-contents"><table summary="Sample" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Description</th><th align="center">Required</th></tr></thead><tbody><tr><td align="left">name</td><td align="left">ksession's name.</td><td align="left">Yes</td></tr><tr><td align="left">type</td><td align="left">is the session <span class="emphasis"><em>stateful</em></span> or
                <span class="emphasis"><em>stateless?</em></span>. If this attribute is empty or
                missing, the session is assumed to be of type
                Stateful.</td><td align="left">No</td></tr><tr><td align="left">default</td><td align="left">Is this the default session?</td><td align="left">no</td></tr><tr><td align="left">scope</td><td align="left">prototype | singleton. If not provided assumed to be singleton (default)</td><td align="left">no</td></tr><tr><td align="left">clockType</td><td align="left">REALTIME or PSEUDO</td><td align="left">no</td></tr><tr><td align="left">listeners-ref</td><td align="left">Specifies the reference to the event listeners group
                (see <a class="link" href="#kie-grouping-listeners" title="13.2.8.2. Defining a Group of listeners:">'Defining a Group
                of listeners'</a> section below).</td><td align="left">no</td></tr></tbody></table></div></div><br class="table-break"/><div class="example"><a id="d0e15415"/><p class="title"><strong>Example 13.4. ksession definition example</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;kie:kmodule id="sample-kmodule"&gt;
  &lt;kie:kbase name="drl_kiesample3" packages="drl_kiesample3"&gt;
    &lt;kie:ksession name="ksession1" type="stateless"/&gt;
    &lt;kie:ksession name="ksession2"/&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor" 
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="13.2.4.2. Spring Bean Scope (for KieBase and KieSession)"><div class="titlepage"><div><div><h4 class="title"><a id="d0e15420"/>13.2.4.2. Spring Bean Scope (for KieBase and KieSession)</h4></div></div></div><p>
          When defining a KieBase or a KieSession, you have the option of declaring a scope for that bean.
          For example, To force Spring to produce a new bean instance each time one is needed, you should declare the bean's scope
          attribute to be 'prototype'.
          Similar way if you want Spring to return the same bean instance each time one is needed,
          you should declare the bean's scope attribute to be 'singleton'.
        </p></div></div><div class="section" title="13.2.5. Kie:ReleaseId"><div class="titlepage"><div><div><h3 class="title"><a id="d0e15425"/>13.2.5. Kie:ReleaseId</h3></div></div></div><p>
      </p><div class="section" title="13.2.5.1. &lt;kie:releaseId&gt;'s parameters as attributes:"><div class="titlepage"><div><div><h4 class="title"><a id="d0e15430"/>13.2.5.1. &lt;kie:releaseId&gt;'s parameters as attributes:</h4></div></div></div><div class="table"><a id="d0e15433"/><p class="title"><strong>Table 13.4. Sample</strong></p><div class="table-contents"><table summary="Sample" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Description</th><th align="center">Required</th></tr></thead><tbody><tr><td align="left">id</td><td align="left">Bean's <span class="emphasis"><em>id</em></span> is the name to be
                  referenced from other beans. Standard Spring ID semantics
                  apply.</td><td align="left">Yes</td></tr><tr><td align="left">groupId</td><td align="left">groupId from Maven GAV</td><td align="left">Yes</td></tr><tr><td align="left">artifactId</td><td align="left">artifactId from Maven GAV</td><td align="left">Yes</td></tr><tr><td align="left">version</td><td align="left">version from Maven GAV</td><td align="left">Yes</td></tr></tbody></table></div></div><br class="table-break"/><div class="example"><a id="d0e15477"/><p class="title"><strong>Example 13.5. releaseId definition example</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;kie:releaseId id="beanId" groupId="org.kie.spring"
            artifactId="named-artifactId" version="1.0.0-SNAPSHOT"/&gt;</code></pre></div></div><br class="example-break"/></div></div><div class="section" title="13.2.6. Kie:Import"><div class="titlepage"><div><div><h3 class="title"><a id="d0e15482"/>13.2.6. Kie:Import</h3></div></div></div><p>Starting with version 6.2, kie-spring allows for importing of kie objects from kjars found on the classpath. Two modes of importing the kie objects are currently supported.</p><div class="table"><a id="d0e15487"/><p class="title"><strong>Table 13.5. </strong></p><div class="table-contents"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Description</th><th align="center">Required</th></tr></thead><tbody><tr><td align="left">releaseId</td><td align="left">Reference to a Bean ID. Standard Spring ID semantics
                apply.</td><td align="left">No</td></tr><tr><td align="left">enableScanner</td><td align="left">Enable Scanner. This attribute is used only if 'releaseId' is specified.</td><td align="left">No</td></tr><tr><td align="left">scannerInterval</td><td align="left">Scanning Interval in milli seconds. This attribute is used only if 'releaseId' is specified.</td><td align="left">No</td></tr></tbody></table></div></div><br class="table-break"/><div class="section" title="13.2.6.1. Global Import"><div class="titlepage"><div><div><h4 class="title"><a id="d0e15519"/>13.2.6.1. Global Import</h4></div></div></div><p>The <span class="emphasis"><em>import</em></span> tag will force the automatic scan of all the jars on the classpath, initialize the Kie Objects (Kbase/KSessions) and import these objects into the spring context.</p><div class="figure"><a id="d0e15527"/><p class="title"><strong>Figure 13.1. Global Import</strong></p><div class="figure-contents"><pre><code class="language-xml">&lt;kie:import /&gt;</code></pre></div></div><br class="figure-break"/></div><div class="section" title="13.2.6.2. Specific Import - ReleaseId"><div class="titlepage"><div><div><h4 class="title"><a id="d0e15532"/>13.2.6.2. Specific Import - ReleaseId</h4></div></div></div><p>Using the <span class="emphasis"><em>releaseId-ref</em></span> attribute on the import tag will initialize the specific Kie Objects (Kbase/KSessions) and import these objects into the spring context.</p><div class="figure"><a id="d0e15540"/><p class="title"><strong>Figure 13.2. Import Kie Objects using a releaseId</strong></p><div class="figure-contents"><pre><code class="language-xml">&lt;kie:import releaseId-ref="namedKieSession"/&gt;
&lt;kie:releaseId id="namedKieSession" groupId="org.drools"
            artifactId="named-kiesession" version="6.5.0.Final"/&gt;
          </code></pre></div></div><br class="figure-break"/><p>Kie Scanning feature can be enabled for KieBase's imported with a specific releaseId. This feature is currently not available for global imports.</p><div class="figure"><a id="d0e15547"/><p class="title"><strong>Figure 13.3. Import Kie Objects using a releaseId - Enable Scanner</strong></p><div class="figure-contents"><pre><code class="language-xml">&lt;kie:import releaseId-ref="namedKieSession"
            enableScanner="true" scannerInterval="1000"/&gt;

&lt;kie:releaseId id="namedKieSession" groupId="org.drools"
            artifactId="named-kiesession" version="6.5.0.Final"/&gt;
          </code></pre></div></div><br class="figure-break"/><p>If the scanner is defined and enabled, an implicit <span class="emphasis"><em>KieScanner</em></span> object is created and inserted into the spring context. It can be retrived from the
        spring context.</p><div class="figure"><a id="d0e15557"/><p class="title"><strong>Figure 13.4. Retriving the KieScanner from Spring Context</strong></p><div class="figure-contents"><pre><code class="language-java">
// the implicit name would be releaseId#scanner
KieScanner releaseIdScanner = context.getBean("namedKieSession#scanner", KieScanner.class);
releaseIdScanner.scanNow();
          </code></pre></div></div><br class="figure-break"/><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>kie-ci must be available on the classpath for the releaseId importing feature to work.</p></div></div></div><div class="section" title="13.2.7. Annotations"><div class="titlepage"><div><div><h3 class="title"><a id="d0e15565"/>13.2.7. Annotations</h3></div></div></div><p>@KContainer, @KBase and @KSession all support an optional 'name' attribute. Spring typically
        does "get" when it injects, all injections receive the same instance for the same set
        of annotations. the 'name' annotation forces a unique instance for each name, although all
        instance for that name will be identity equals.</p><div class="section" title="13.2.7.1. @KReleaseId"><div class="titlepage"><div><div><h4 class="title"><a id="d0e15570"/>13.2.7.1. @KReleaseId</h4></div></div></div><p>Used to bind an instance to a specific version of a KieModule. If kie-ci is on the
          classpath this will resolve dependencies automatically, downloading from remote
          repositories.</p></div><div class="section" title="13.2.7.2. @KContainer"><div class="titlepage"><div><div><h4 class="title"><a id="d0e15575"/>13.2.7.2. @KContainer</h4></div></div></div><div class="figure"><a id="d0e15578"/><p class="title"><strong>Figure 13.5. Injects Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@KContainer
private KieContainer kContainer;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15583"/><p class="title"><strong>Figure 13.6. Injects KieContainer for Dynamic KieModule</strong></p><div class="figure-contents"><pre><code class="language-java">@KContainer
@KReleaseId(groupId = "jar1", artifactId = "art1", version = "1.1")
private KieContainer kContainer;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15588"/><p class="title"><strong>Figure 13.7. Injects named KieContainer for Dynamic KieModule</strong></p><div class="figure-contents"><pre><code class="language-java">@KContainer(name = "kc1")
@KReleaseId(groupId = "jar1", artifactId = "art1", version = "1.1")
private KieContainer kContainer;</code></pre></div></div><br class="figure-break"/></div><div class="section" title="13.2.7.3. @KBase"><div class="titlepage"><div><div><h4 class="title"><a id="d0e15593"/>13.2.7.3. @KBase</h4></div></div></div><p>The default argument, if given, maps to the value attribute and specifies the name of the KieBase from the
          spring xml file.</p><div class="figure"><a id="d0e15598"/><p class="title"><strong>Figure 13.8. Injects the Default KieBase from the Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@KBase
private KieBase kbase;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15603"/><p class="title"><strong>Figure 13.9. Injects the Default KieBase from a Dynamic KieModule</strong></p><div class="figure-contents"><pre><code class="language-java">@KBase
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15608"/><p class="title"><strong>Figure 13.10. Side by side version loading for 'jar1.KBase1' KieBase</strong></p><div class="figure-contents"><pre><code class="language-java">@KBase("kbase1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase1v10;

@KBase("kbase1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.1")
private KieBase kbase1v11;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15613"/><p class="title"><strong>Figure 13.11. Side by side version loading for 'jar1.ksession1' KieSession</strong></p><div class="figure-contents"><pre><code class="language-java">@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession11kb2;

@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.1")
private KieSession ksession11kb2;</code></pre></div></div><br class="figure-break"/></div><div class="section" title="13.2.7.4. @KSession for KieSession"><div class="titlepage"><div><div><h4 class="title"><a id="d0e15618"/>13.2.7.4. @KSession for KieSession</h4></div></div></div><p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the
          kmodule.xml or spring xml file</p><div class="figure"><a id="d0e15623"/><p class="title"><strong>Figure 13.12. Injects the Default KieSession from the Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@KSession
private KieSession ksession;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15628"/><p class="title"><strong>Figure 13.13. Injects the Default KieSession from a Dynamic KieModule</strong></p><div class="figure-contents"><pre><code class="language-java">@KSession
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15633"/><p class="title"><strong>Figure 13.14. Side by side version loading for 'jar1.KBase1' KieBase</strong></p><div class="figure-contents"><pre><code class="language-java">@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksessionv10;

@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.1")
private KieSession ksessionv11;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15638"/><p class="title"><strong>Figure 13.15. Use 'name' attribute to force new Instance for 'jar1.KBase1' KieSession</strong></p><div class="figure-contents"><pre><code class="language-java">@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession1ks1

@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession1ks2</code></pre></div></div><br class="figure-break"/></div><div class="section" title="13.2.7.5. @KSession for StatelessKieSession"><div class="titlepage"><div><div><h4 class="title"><a id="d0e15643"/>13.2.7.5. @KSession for StatelessKieSession</h4></div></div></div><p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the
          kmodule.xml or spring xml file.</p><div class="figure"><a id="d0e15648"/><p class="title"><strong>Figure 13.16. Injects the Default StatelessKieSession from the Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@KSession
private StatelessKieSession ksession;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15653"/><p class="title"><strong>Figure 13.17. Injects the Default StatelessKieSession from a Dynamic KieModule</strong></p><div class="figure-contents"><pre><code class="language-java">@KSession
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15658"/><p class="title"><strong>Figure 13.18. Side by side version loading for 'jar1.KBase1' KieBase</strong></p><div class="figure-contents"><pre><code class="language-java">@KSession("ksession1")
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.0")
private StatelessKieSession ksessionv10;

@KSession("ksession1")
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.1")
private StatelessKieSession ksessionv11;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e15663"/><p class="title"><strong>Figure 13.19. </strong></p><div class="figure-contents"><pre><code class="language-java">@KSession(value="ksession1", name="ks1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession1ks1

@KSession(value="ksession1", name="ks2")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession1ks2</code></pre></div></div><br class="figure-break"/></div><div class="section" title="13.2.7.6. IMPORTANT NOTE"><div class="titlepage"><div><div><h4 class="title"><a id="d0e15666"/>13.2.7.6. IMPORTANT NOTE</h4></div></div></div><p>When annotations are used, For proper initialization of the kmodule objects (kbase/ksession),
          it is mandatory for either a bean of type
          <code class="code">org.kie.spring.annotations.KModuleAnnotationPostProcessor</code> be
          defined</p> or spring component-scan be enabled. One of the code snippets as shown below is required.

        <div class="example"><a id="d0e15675"/><p class="title"><strong>Example 13.6. kie-spring annotations post processor bean definition</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;bean id="kiePostProcessor"
            class="org.kie.spring.annotations.KModuleAnnotationPostProcessor"/&gt;</code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e15680"/><p class="title"><strong>Example 13.7. kie-spring annotations - Component Scanning</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;context:component-scan base-package="org.kie.spring.annotations"/&gt;</code></pre></div></div><br class="example-break"/><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The post processor is different when annotations are used.</p></div></div></div><div class="section" title="13.2.8. Event Listeners"><div class="titlepage"><div><div><h3 class="title"><a id="d0e15688"/>13.2.8. Event Listeners</h3></div></div></div><p>Drools supports adding 3 types of listeners to KieSessions -
      <span class="emphasis"><em>AgendaListener</em></span>,
      <span class="emphasis"><em>WorkingMemoryListener</em></span>,
      <span class="emphasis"><em>ProcessEventListener</em></span></p><p>The kie-spring module allows you to configure these listeners to
      KieSessions using XML tags. These tags have identical names as the
      actual listener interfaces i.e., &lt;kie:agendaEventListener....&gt;,
      &lt;kie:ruleRuntimeEventListener....&gt; and
      &lt;kie:processEventListener....&gt;.</p><p>kie-spring provides features to define the listeners as standalone
      (individual) listeners and also to define them as a group.</p><div class="section" title="13.2.8.1. Defining Stand alone Listeners:"><div class="titlepage"><div><div><h4 class="title"><a id="d0e15705"/>13.2.8.1. Defining Stand alone Listeners:</h4></div></div></div><div class="section" title="13.2.8.1.1. Attributes:"><div class="titlepage"><div><div><h5 class="title"><a id="d0e15708"/>13.2.8.1.1. Attributes:</h5></div></div></div><div class="table"><a id="d0e15711"/><p class="title"><strong>Table 13.6. Sample</strong></p><div class="table-contents"><table summary="Sample" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required</th><th align="center">Description</th></tr></thead><tbody><tr><td align="left">ref</td><td align="left">No</td><td align="left">A reference to another declared bean.</td></tr></tbody></table></div></div><br class="table-break"/><div class="example"><a id="d0e15731"/><p class="title"><strong>Example 13.8. Listener configuration example - using a bean:ref.</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;
&lt;bean id="mock-rr-listener" class="mocks.MockRuleRuntimeEventListener"/&gt;
&lt;bean id="mock-process-listener" class="mocks.MockProcessEventListener"/&gt;

&lt;kie:kmodule id="listeners_kmodule"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksession2"&gt;
      &lt;kie:agendaEventListener ref="mock-agenda-listener"/&gt;
      &lt;kie:processEventListener ref="mock-process-listener"/&gt;
      &lt;kie:ruleRuntimeEventListener ref="mock-rr-listener"/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor" 
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="13.2.8.1.2. Nested Elements:"><div class="titlepage"><div><div><h5 class="title"><a id="d0e15736"/>13.2.8.1.2. Nested Elements:</h5></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>bean</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>class = String</p></li><li class="listitem"><p>name = String (optional)</p></li></ul></div></li></ul></div><div class="example"><a id="d0e15750"/><p class="title"><strong>Example 13.9. Listener configuration example - using nested bean.</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;kie:kmodule id="listeners_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
   &lt;kie:ksession name="ksession1"&gt;
	  &lt;kie:agendaEventListener&gt;
      &lt;bean class="mocks.MockAgendaEventListener"/&gt;
      &lt;/kie:agendaEventListener&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor" 
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="13.2.8.1.3. Empty Tag : Declaration with no 'ref' and without a nested bean"><div class="titlepage"><div><div><h5 class="title"><a id="d0e15755"/>13.2.8.1.3. Empty Tag : Declaration with no 'ref' and without a nested
          bean</h5></div></div></div><p>When a listener is defined without a reference to a
          implementing bean and does not contain a nested bean,
          <span class="emphasis"><em>&lt;drools:ruleRuntimeEventListener/&gt;</em></span> the
          underlying implementation adds the Debug version of the listener
          defined in the API.</p><p>The debug listeners print the corresponding Event toString
          message to <span class="emphasis"><em>System.err. </em></span></p><div class="example"><a id="d0e15767"/><p class="title"><strong>Example 13.10. Listener configuration example - defaulting to the debug
            versions provided by the Knowledge-API .</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;
&lt;bean id="mock-rr-listener" class="mocks.MockRuleRuntimeEventListener"/&gt;
&lt;bean id="mock-process-listener" class="mocks.MockProcessEventListener"/&gt;

&lt;kie:kmodule id="listeners_module"&gt;
 &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksession2"&gt;
      &lt;kie:agendaEventListener /&gt; 
      &lt;kie:processEventListener /&gt;
      &lt;kie:ruleRuntimeEventListener /&gt;
    &lt;/kie:ksession&gt;
 &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor" 
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="13.2.8.1.4. Mix and Match of different declaration styles"><div class="titlepage"><div><div><h5 class="title"><a id="d0e15772"/>13.2.8.1.4. Mix and Match of different declaration styles</h5></div></div></div><p>The drools-spring module allows you to mix and match the
          different declarative styles within the same KieSession. The
          below sample provides more clarity.</p><div class="example"><a id="d0e15777"/><p class="title"><strong>Example 13.11. Listener configuration example - mix and match of
            'ref'/nested-bean/empty styles.</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;
&lt;bean id="mock-rr-listener" class="mocks.MockRuleRuntimeEventListener"/&gt;
&lt;bean id="mock-process-listener" class="mocks.MockProcessEventListener"/&gt;

&lt;kie:kmodule id="listeners_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksession1"&gt;
      &lt;kie:agendaEventListener&gt;
          &lt;bean class="org.kie.spring.mocks.MockAgendaEventListener"/&gt;
      &lt;/kie:agendaEventListener&gt;
    &lt;/kie:ksession&gt;
    &lt;kie:ksession name="ksession2"&gt;
      &lt;kie:agendaEventListener ref="mock-agenda-listener"/&gt;
      &lt;kie:processEventListener ref="mock-process-listener"/&gt;
      &lt;kie:ruleRuntimeEventListener ref="mock-rr-listener"/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor" 
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="13.2.8.1.5. Defining multiple listeners of the same type"><div class="titlepage"><div><div><h5 class="title"><a id="d0e15782"/>13.2.8.1.5. Defining multiple listeners of the same type</h5></div></div></div><p>It is also valid to define multiple beans of the same event
          listener types for a KieSession.</p><div class="example"><a id="d0e15787"/><p class="title"><strong>Example 13.12. Listener configuration example - multiple listeners of the
            same type.</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;

&lt;kie:kmodule id="listeners_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksession1"&gt;
      &lt;kie:agendaEventListener ref="mock-agenda-listener"/&gt;
      &lt;kie:agendaEventListener&gt;
          &lt;bean class="org.kie.spring.mocks.MockAgendaEventListener"/&gt;
      &lt;/kie:agendaEventListener&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor" 
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre></div></div><br class="example-break"/></div></div><div class="section" title="13.2.8.2. Defining a Group of listeners:"><div class="titlepage"><div><div><h4 class="title"><a id="kie-grouping-listeners"/>13.2.8.2. Defining a Group of listeners:</h4></div></div></div><p>drools-spring allows for grouping of listeners. This is
        particularly useful when you define a set of listeners and want to
        attach them to multiple sessions. The grouping feature is also very
        useful, when we define a set of listeners for 'testing' and then want
        to switch them for 'production' use.</p><div class="section" title="13.2.8.2.1. Attributes:"><div class="titlepage"><div><div><h5 class="title"><a id="d0e15797"/>13.2.8.2.1. Attributes:</h5></div></div></div><div class="table"><a id="d0e15800"/><p class="title"><strong>Table 13.7. Sample</strong></p><div class="table-contents"><table summary="Sample" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required</th><th align="center">Description</th></tr></thead><tbody><tr><td align="left">ID</td><td align="left">yes</td><td align="left">Unique identifier</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="section" title="13.2.8.2.2. Nested Elements:"><div class="titlepage"><div><div><h5 class="title"><a id="d0e15820"/>13.2.8.2.2. Nested Elements:</h5></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>kie:agendaEventListener...</p></li><li class="listitem"><p>kie:ruleRuntimeEventListener...</p></li><li class="listitem"><p>kie:processEventListener...</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The above mentioned child elements can be declared in any
          order. Only one declaration of each type is allowed in a
          group.</p></div></div><div class="section" title="13.2.8.2.3. Example:"><div class="titlepage"><div><div><h5 class="title"><a id="d0e15836"/>13.2.8.2.3. Example:</h5></div></div></div><div class="example"><a id="d0e15839"/><p class="title"><strong>Example 13.13. Group of listeners - example</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;
&lt;bean id="mock-rr-listener" class="mocks.MockRuleRuntimeEventListener"/&gt;
&lt;bean id="mock-process-listener" class="mocks.MockProcessEventListener"/&gt;

&lt;kie:kmodule id="listeners_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="statelessWithGroupedListeners" type="stateless" 
             listeners-ref="debugListeners"/&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

  &lt;kie:eventListeners id="debugListeners"&gt;
  &lt;kie:agendaEventListener ref="mock-agenda-listener"/&gt;
  &lt;kie:processEventListener ref="mock-process-listener"/&gt;
  &lt;kie:ruleRuntimeEventListener ref="mock-rr-listener"/&gt;
&lt;/kie:eventListeners&gt;

&lt;bean id="kiePostProcessor" 
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre></div></div><br class="example-break"/></div></div></div><div class="section" title="13.2.9. Loggers"><div class="titlepage"><div><div><h3 class="title"><a id="d0e15844"/>13.2.9. Loggers</h3></div></div></div><p>Drools supports adding 2 types of loggers to KieSessions -
      <span class="emphasis"><em>ConsoleLogger</em></span>,
      <span class="emphasis"><em>FileLogger.</em></span></p><p>The kie-spring module allows you to configure these loggers to
      KieSessions using XML tags. These tags have identical names as the
      actual logger interfaces i.e., &lt;kie:consoleLogger....&gt; and
      &lt;kie:fileLogger....&gt;.</p><div class="section" title="13.2.9.1. Defining a console logger:"><div class="titlepage"><div><div><h4 class="title"><a id="d0e15856"/>13.2.9.1. Defining a console logger:</h4></div></div></div><p>A console logger can be attached to a KieSession by using the
        <span class="emphasis"><em>&lt;kie:consoleLogger/&gt;</em></span> tag. This tag has no
        attributes and must be present directly under a
        &lt;kie:ksession....&gt; element.</p><div class="example"><a id="d0e15864"/><p class="title"><strong>Example 13.14. Defining a console logger - example</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;kie:kmodule id="loggers_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ConsoleLogger-statefulSession" type="stateful"&gt;
      &lt;kie:consoleLogger/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor" 
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="13.2.9.2. Defining a file logger:"><div class="titlepage"><div><div><h4 class="title"><a id="d0e15869"/>13.2.9.2. Defining a file logger:</h4></div></div></div><p>A file logger can be attached to a KieSession by using the
        <span class="emphasis"><em>&lt;kie:fileLogger/&gt;</em></span> tag. This tag has the
        following attributes and must be present directly under a
        &lt;kie:ksession....&gt; element.</p><div class="table"><a id="d0e15877"/><p class="title"><strong>Table 13.8. Sample</strong></p><div class="table-contents"><table summary="Sample" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">Attribute</th><th align="center">Required</th><th align="center">Description</th></tr></thead><tbody><tr><td align="left">ID</td><td align="left">yes</td><td align="left">Unique identifier</td></tr><tr><td align="left">file</td><td align="left">yes</td><td align="left">Path to the actual file on the disk</td></tr><tr><td align="left">threaded</td><td align="left">no</td><td align="left">Defaults to false. Valid values are 'true'or
                'false'</td></tr><tr><td align="left">interval</td><td align="left">no</td><td align="left">Integer. Specifies the interval for flushing the
                contents from memory to the disk.</td></tr></tbody></table></div></div><br class="table-break"/><div class="example"><a id="d0e15918"/><p class="title"><strong>Example 13.15. Defining a file logger - example</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;kie:kmodule id="loggers_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ConsoleLogger-statefulSession" type="stateful"&gt;
      &lt;kie:fileLogger id="fl_logger" file="#{ systemProperties['java.io.tmpdir'] }/log1"/&gt;
      &lt;kie:fileLogger id="tfl_logger" file="#{ systemProperties['java.io.tmpdir'] }/log2" 
                          threaded="true" interval="5"/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor" 
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre></div></div><br class="example-break"/><div class="section" title="13.2.9.2.1. Closing a FileLogger"><div class="titlepage"><div><div><h5 class="title"><a id="d0e15923"/>13.2.9.2.1. Closing a FileLogger</h5></div></div></div><p>To prevent leaks, it is advised to close the
          <span class="emphasis"><em>&lt;kie:fileLogger ...&gt; </em></span>
          programmatically.</p><pre><code class="language-java">LoggerAdaptor adaptor = (LoggerAdaptor) context.getBean("fl_logger");
adaptor.close();</code></pre></div></div></div><div class="section" title="13.2.10. Defining Batch Commands"><div class="titlepage"><div><div><h3 class="title"><a id="d0e15933"/>13.2.10. Defining Batch Commands</h3></div></div></div><p>A <span class="emphasis"><em>&lt;kie:batch&gt;</em></span> element can be used to
      define a set of batch commands for a given ksession.This tag has no
      attributes and must be present directly under a &lt;kie:ksession....&gt;
      element. The commands supported are</p><div class="figure"><a id="d0e15941"/><p class="title"><strong>Figure 13.20. Initialization Batch Commands</strong></p><div class="figure-contents"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>insert-object</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>ref = String (optional)</p></li><li class="listitem"><p>Anonymous bean</p></li></ul></div></li><li class="listitem"><p>set-global</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>identifier = String (required)</p></li><li class="listitem"><p>reg = String (optional)</p></li><li class="listitem"><p>Anonymous bean</p></li></ul></div></li><li class="listitem"><p>fire-all-rules</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>max : n</p></li></ul></div></li><li class="listitem"><p>fire-until-halt</p></li><li class="listitem"><p>start-process</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>parameter</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>identifier = String (required)</p></li><li class="listitem"><p>ref = String (optional)</p></li><li class="listitem"><p>Anonymous bean</p></li></ul></div></li></ul></div></li><li class="listitem"><p>signal-event</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>ref = String (optional)</p></li><li class="listitem"><p>event-type = String (required)</p></li><li class="listitem"><p>process-instance-id =n (optional)</p></li></ul></div></li></ul></div></div></div><br class="figure-break"/><div class="example"><a id="d0e16008"/><p class="title"><strong>Example 13.16. Batch commands - example</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;kie:kmodule id="batch_commands_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksessionForCommands" type="stateful"&gt;
      &lt;kie:batch&gt;
        &lt;kie:insert-object ref="person2"/&gt;
        &lt;kie:set-global identifier="persons" ref="personsList"/&gt;
        &lt;kie:fire-all-rules max="10"/&gt;
      &lt;/kie:batch&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor" 
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="13.2.11. Persistence"><div class="titlepage"><div><div><h3 class="title"><a id="d0e16013"/>13.2.11. Persistence</h3></div></div></div><div class="figure"><a id="d0e16016"/><p class="title"><strong>Figure 13.21. Persistence Configuration Options</strong></p><div class="figure-contents"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>jpa-persistence</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>transaction-manager</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>ref = String</p></li></ul></div></li><li class="listitem"><p>entity-manager-factory</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>ref = String</p></li></ul></div></li></ul></div></li></ul></div></div></div><br class="figure-break"/><div class="example"><a id="d0e16038"/><p class="title"><strong>Example 13.17. ksession JPA configuration example</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;kie:kstore id="kstore" /&gt; &lt;!-- provides KnowledgeStoreService implementation --&gt;

&lt;bean id="myEmf" 
       class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
   &lt;property name="dataSource" ref="ds" /&gt;
   &lt;property name="persistenceUnitName" 
       value="org.drools.persistence.jpa.local" /&gt;
&lt;/bean&gt;

&lt;bean id="txManager" class="org.springframework.orm.jpa.JpaTransactionManager"&gt;
   &lt;property name="entityManagerFactory" ref="myEmf" /&gt;
&lt;/bean&gt;

&lt;kie:kmodule id="persistence_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="jpaSingleSessionCommandService"&gt;
      &lt;kie:configuration&gt;
         &lt;kie:jpa-persistence&gt;
           &lt;kie:transaction-manager ref="txManager"/&gt;
           &lt;kie:entity-manager-factory ref="myEmf"/&gt;
         &lt;/kie:jpa-persistence&gt;
      &lt;/kie:configuration&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor" 
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;
</code></pre></div></div><br class="example-break"/></div><div class="section" title="13.2.12. Leveraging Other Spring Features"><div class="titlepage"><div><div><h3 class="title"><a id="d0e16043"/>13.2.12. Leveraging Other Spring Features</h3></div></div></div><p>This section provides details on leveraging other standard spring features when integrating with Drools Expert.</p><div class="section" title="13.2.12.1. Using Spring Expressions (Spel)"><div class="titlepage"><div><div><h4 class="title"><a id="d0e16048"/>13.2.12.1. Using Spring Expressions (Spel) </h4></div></div></div><p/><pre><code class="language-xml">&lt;kie:kmodule id="batch_commands_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="#{packageRepository.packages}"&gt;
    &lt;kie:ksession name="ksessionForCommands" type="stateful"/&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
      class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;

&lt;bean id="packageRepository" class="sample.package.class.PackageRepo"&gt;
  &lt;property name="packages" value="drl_kiesample3"&gt;
&lt;/bean&gt;
          </code></pre><p/><pre><code class="language-xml">&lt;kie:kmodule id="loggers_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ConsoleLogger-statefulSession" type="stateful"&gt;
      &lt;kie:fileLogger id="fl" file="#{ systemProperties['java.io.tmpdir'] }/log1"/&gt;
      &lt;kie:fileLogger id="tfl" file="#{ systemProperties['java.io.tmpdir'] }/log2"
            threaded="true" interval="5"/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
            class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre></div><div class="section" title="13.2.12.2. Using Spring Profiles"><div class="titlepage"><div><div><h4 class="title"><a id="d0e16057"/>13.2.12.2. Using Spring Profiles </h4></div></div></div><p>Spring 3.1 introduces a new profile attribute to the beans element of the spring-beans schema.
          This attribute acts as a switch when enabling and disabling profiles in different environments. One potential use of this attribute
        can be to have the same kbase defined with debug loggers in 'dev' environment and without loggers in 'prod' environment.</p><p>
          The below code snippet illustrates the concept of 'profiles'.
        </p><pre><code class="language-xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns:kie="http://drools.org/schema/kie-spring"
xsi:schemaLocation="http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
http://drools.org/schema/kie-spring http://drools.org/schema/kie-spring.xsd"&gt;
  &lt;beans profile="development"&gt;
    &lt;kie:kmodule id="test-kmodule"&gt;
      &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
        &lt;kie:ksession name="ksession1" type="stateless"&gt;
            &lt;kie:consoleLogger /&gt;
        &lt;/kie:ksession&gt;
      &lt;/kie:kbase&gt;
    &lt;/kie:kmodule&gt;
    ...
  &lt;/beans&gt;

  &lt;beans profile="production"&gt;
    &lt;kie:kmodule id="test-kmodule"&gt;
      &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
        &lt;kie:ksession name="ksession1" type="stateless"/&gt;
      &lt;/kie:kbase&gt;
    &lt;/kie:kmodule&gt;
    ...
  &lt;/beans&gt;
&lt;/beans&gt;</code></pre></div><p>
        As shown above, the Spring XML contains the definition of the profiles. While loading the <span class="emphasis"><em>ApplicationContext</em></span>
        you have to tell Spring which profile you’re loading.
      </p><p>
        There are several ways of selecting your profile and the most useful is by using the "spring.profiles.active" system property.
      </p><pre><code class="no-highlight">System.setProperty("spring.profiles.active", "development");
ApplicationContext ctx = new ClassPathXmlApplicationContext("beans.xml");</code></pre><p>
        Obviously, it is not a good practice to hard code things as shown above and the recommended practice is to keep the system
        properties definitions independent of the application.
      </p><pre><code class="no-highlight">-Dspring.profiles.active="development"</code></pre><p>
        The profiles can also be loaded and enabled programmtically
      </p><pre><code class="no-highlight">...
GenericXmlApplicationContext ctx = new GenericXmlApplicationContext("beans.xml");
ConfigurableEnvironment env = ctx.getEnvironment();
env.setActiveProfiles("development");
ctx.refresh();
...
      </code></pre></div></div><div class="section" title="13.3. Integration with jBPM Human Task"><div class="titlepage"><div><div><h2 class="title"><a id="d0e16083"/>13.3. Integration with jBPM Human Task</h2></div></div></div><p>This chapter describes the infrastructure used when configuring a
    human task server with Spring as well as a little bit about the
    infrastructure used when doing this.</p><div class="section" title="13.3.1. How to configure Spring with jBPM Human task"><div class="titlepage"><div><div><h3 class="title"><a id="d0e16088"/>13.3.1. How to configure Spring with jBPM Human task</h3></div></div></div><p>The jBPM human task server can be configured to use Spring
      persistence. <a class="xref" href="#kie-spring-human-task-example" title="Example 13.18. Configuring Human Task with Spring">Example 13.18, “Configuring Human Task with Spring”</a> is an
      example of this which uses local transactions and Spring's thread-safe
      EntityManager proxy.</p><p>The following diagram shows the dependency graph used in <a class="xref" href="#kie-spring-human-task-example" title="Example 13.18. Configuring Human Task with Spring">Example 13.18, “Configuring Human Task with Spring”</a>.</p><div class="figure"><a id="d0e16099"/><p class="title"><strong>Figure 13.22. Spring Human Task integration injection dependencies</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Spring/ht-spring-deps.png" align="middle" alt="Spring Human Task integration injection dependencies"/></div></div></div><br class="figure-break"/><p>A <code class="code">TaskService</code> instance is dependent on two other bean
      types: a drools <code class="code">SystemEventListener</code> bean as well as a
      <code class="code">TaskSessionSpringFactoryImpl</code> bean. The
      <code class="code">TaskSessionSpringFactoryImpl</code> bean is howerver
      <span class="emphasis"><em>not</em></span> injected into the <code class="code">TaskService</code> bean
      because this would cause a circular dependency. To solve this problem,
      when the <code class="code">TaskService</code> bean is injected into the
      <code class="code">TaskSessionSpringFactoryImpl</code> bean, the setter method used
      secretly injects the <code class="code">TaskSessionSpringFactoryImpl</code> instance
      back into the <code class="code">TaskService</code> bean and initializes the
      <code class="code">TaskService</code> bean as well.</p><p>The <code class="code">TaskSessionSpringFactoryImpl</code> bean is responsible
      for creating all the internal instances in human task that deal with
      transactions and persistence context management. Besides a
      <code class="code">TaskService</code> instance, this bean also requires a transaction
      manager and a persistence context to be injected. Specifically, it
      requires an instance of a <code class="code">HumanTaskSpringTransactionManager</code>
      bean (as a transaction manager) and an instance of a
      <code class="code">SharedEntityManagerBean</code> bean (as a persistence context
      instance).</p><p>We also use some of the standard Spring beans in order to
      configure persistence: there's a bean to hold the
      <code class="code">EntityManagerFactory</code> instance as well as the
      <code class="code">SharedEntityManagerBean</code> instance. The
      <code class="code">SharedEntityManagerBean</code> provides a shared, thread-safe
      proxy for the actual <code class="code">EntityManager</code>.</p><p>The <code class="code">HumanTaskSpringTransactionManager</code> bean serves as
      a wrapper around the Spring transaction manager, in this case the
      <code class="code">JpaTransactionManager</code>. An instance of a
      <code class="code">JpaTransactionManager</code> bean is also instantiated because of
      this.</p><div class="example"><a id="kie-spring-human-task-example"/><p class="title"><strong>Example 13.18. Configuring Human Task with Spring</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jbpm="http://drools.org/schema/drools-spring"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       http://drools.org/schema/drools-spring org/drools/container/spring/drools-spring-1.2.0.xsd"&gt;

  &lt;!-- persistence &amp; transactions--&gt;
  &lt;bean id="htEmf" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
    &lt;property name="persistenceUnitName" value="org.jbpm.task" /&gt;
  &lt;/bean&gt;

  &lt;bean id="htEm" class="org.springframework.orm.jpa.support.SharedEntityManagerBean"&gt;
    &lt;property name="entityManagerFactory" ref="htEmf"/&gt;
  &lt;/bean&gt;

  &lt;bean id="jpaTxMgr" class="org.springframework.orm.jpa.JpaTransactionManager"&gt;
    &lt;property name="entityManagerFactory" ref="htEmf" /&gt;
    &lt;!-- this must be true if using the SharedEntityManagerBean, and false otherwise --&gt;
    &lt;property name="nestedTransactionAllowed" value="true"/&gt;
  &lt;/bean&gt;

  &lt;bean id="htTxMgr" class="org.drools.container.spring.beans.persistence.HumanTaskSpringTransactionManager"&gt;
    &lt;constructor-arg ref="jpaTxMgr" /&gt;
  &lt;/bean&gt;

  &lt;!-- human-task beans --&gt;

  &lt;bean id="systemEventListener" class="org.drools.SystemEventListenerFactory" factory-method="getSystemEventListener" /&gt;

  &lt;bean id="taskService" class="org.jbpm.task.service.TaskService" &gt;
    &lt;property name="systemEventListener" ref="systemEventListener" /&gt;
  &lt;/bean&gt;

  &lt;bean id="springTaskSessionFactory" class="org.jbpm.task.service.persistence.TaskSessionSpringFactoryImpl"
        init-method="initialize" depends-on="taskService" &gt;
    &lt;!-- if using the SharedEntityManagerBean, make sure to enable nested transactions --&gt;
    &lt;property name="entityManager" ref="htEm" /&gt;
    &lt;property name="transactionManager" ref="htTxMgr" /&gt;
    &lt;property name="useJTA" value="false" /&gt;
    &lt;property name="taskService" ref="taskService" /&gt;
  &lt;/bean&gt;

&lt;/beans&gt;
</code></pre></div></div><br class="example-break"/><p>When using the <code class="code">SharedEntityManagerBean</code> instance, it's
      important to configure the Spring transaction manager to use nested
      transactions. This is because the <code class="code">SharedEntityManagerBean</code>
      is a <span class="emphasis"><em>transactional</em></span> persistence context and will
      close the persistence context after every operation. However, the human
      task server needs to be able to access (persisted) entities after
      operations. Nested transactions allow us to still have access to
      entities that otherwise would have been detached and are no longer
      accessible, especially when using an ORM framework that uses
      lazy-initialization of entities.</p><p>Also, while the <code class="code">TaskSessionSpringFactoryImpl</code> bean
      takes an <span class="quote">“<span class="quote">useJTA</span>”</span> parameter, at the moment, JTA
      transactions with Spring have not yet been fully tested.</p></div></div></div><div class="chapter" title="Chapter 14. Android Integration"><div class="titlepage"><div><div><h2 class="title"><a id="ch.kie.android"/>Chapter 14. Android Integration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e16206">14.1. Integration with Drools Expert</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16214">14.1.1. Pre-serialized Rules</a></span></dt><dt><span class="section"><a href="#d0e16242">14.1.2. KieContainer API with drools-compiler dependency</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e16257">14.2. Integration with Roboguice</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16260">14.2.1. Pre-serialized Rules with Roboguice</a></span></dt><dt><span class="section"><a href="#d0e16290">14.2.2. KieContainer with drools-compiler dependency and Roboguice</a></span></dt></dl></dd></dl></div><div class="section" title="14.1. Integration with Drools Expert"><div class="titlepage"><div><div><h2 class="title"><a id="d0e16206"/>14.1. Integration with Drools Expert</h2></div></div></div><p>
        Drools Android integration comes in two flavors, with or without the <span class="emphasis"><em>drools-compiler</em></span> dependency.
        Without the drools-compiler dependency the knowledge bases are pre-serialized at buildtime using the
        kie-maven-plugin. They can be then deserialized using the API, or directly injected using Roboguice.
        When using the drools-compiler dependency there are two options: (1) standard KieContainer API or
        (2) CDI-like injection with Roboguice.
    </p><div class="section" title="14.1.1. Pre-serialized Rules"><div class="titlepage"><div><div><h3 class="title"><a id="d0e16214"/>14.1.1. Pre-serialized Rules</h3></div></div></div><p>
            It is possible to use Drools without the drools-compiler dependency, which results in a smaller apk, by
            pre-serializing the compiled knowledge bases during build-time and then de-serializing them at runtime.
        </p><div class="section" title="14.1.1.1. Maven Configuration"><div class="titlepage"><div><div><h4 class="title"><a id="d0e16219"/>14.1.1.1. Maven Configuration</h4></div></div></div><p>The KieBase must be serialized during build time using <span class="emphasis"><em>kie-maven-plugin</em></span>.</p><div class="example"><a id="d0e16227"/><p class="title"><strong>Example 14.1. Pre-serialized KieBase Maven pom.xml</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.drools&lt;/groupId&gt;
      &lt;artifactId&gt;drools-bom&lt;/artifactId&gt;
      &lt;version&gt;6.5.0.Final&lt;/version&gt;
      &lt;type&gt;pom&lt;/type&gt;
      &lt;scope&gt;import&lt;/scope&gt;
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-android&lt;/artifactId&gt;
    &lt;exclusions&gt;
     &lt;exclusion&gt;
       &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
       &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
    &lt;/exclusions&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-core&lt;/artifactId&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;
&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.kie&lt;/groupId&gt;
      &lt;artifactId&gt;kie-maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;6.5.0.Final&lt;/version&gt;
      &lt;configuration&gt;
        &lt;kiebases&gt;
        &lt;kiebase&gt;HelloKB&lt;/kiebase&gt;
        &lt;/kiebases&gt;
        &lt;resDirectory&gt;${basedir}/src/main/res/raw&lt;/resDirectory&gt;
      &lt;/configuration&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;touch&lt;/id&gt;
            &lt;goals&gt;
              &lt;goal&gt;touch&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;phase&gt;initialize&lt;/phase&gt;
          &lt;/execution&gt;
          &lt;execution&gt;
            &lt;id&gt;compile-kbase&lt;/id&gt;
              &lt;goals&gt;
                &lt;goal&gt;build&lt;/goal&gt;
              &lt;/goals&gt;
              &lt;phase&gt;compile&lt;/phase&gt;
          &lt;/execution&gt;
          &lt;execution&gt;
            &lt;id&gt;serialize&lt;/id&gt;
            &lt;goals&gt;
              &lt;goal&gt;serialize&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;phase&gt;compile&lt;/phase&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
     &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;
                  </code></pre></div></div><br class="example-break"/></div><div class="section" title="14.1.1.2. Loading the KieBase"><div class="titlepage"><div><div><h4 class="title"><a id="d0e16232"/>14.1.1.2. Loading the KieBase</h4></div></div></div><p>The KieBase must be de-serialized before creating the sessions.</p><div class="figure"><a id="d0e16237"/><p class="title"><strong>Figure 14.1. Loading serialized KieBase</strong></p><div class="figure-contents"><pre><code class="language-java">private class LoadKieBaseTask extends AsyncTask&lt;InputStream, Void, KieBase&gt; {
   @Override
   protected KieBase doInBackground(InputStream... params) {
      try {
         logger.debug("Loading knowledge base");
         final KnowledgeBase kbase = KnowledgeBaseFactory.newKnowledgeBase();
         kbase.addKnowledgePackages((List&lt;KnowledgePackage&gt;) DroolsStreamUtils.streamIn(params[0]));
         return kbase;
      }catch(Exception e) {
         logger.error("Drools exception", e);
         return null;
      }
   }
}
                  </code></pre></div></div><br class="figure-break"/></div></div><div class="section" title="14.1.2. KieContainer API with drools-compiler dependency"><div class="titlepage"><div><div><h3 class="title"><a id="d0e16242"/>14.1.2. KieContainer API with drools-compiler dependency</h3></div></div></div><p>
            With the drools-compiler dependency standard KieContainer API can be used. This comes at a cost of a larger
            apk. To avoid the 65K limit, multidex (or proguard) can be used.
        </p><div class="section" title="14.1.2.1. Maven Configuration with drools-compiler and multidex"><div class="titlepage"><div><div><h4 class="title"><a id="d0e16247"/>14.1.2.1. Maven Configuration with drools-compiler and multidex</h4></div></div></div><p>
                  The kie-maven-plugin must be configured to build the kiebase. Multidex must be used to allow for the
                  increased dependencies. There are also some settings for merging various Drools XML files within the
                  apk.
              </p><div class="example"><a id="d0e16252"/><p class="title"><strong>Example 14.2. pom.xml with drools-compiler and multidex</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.drools&lt;/groupId&gt;
      &lt;artifactId&gt;drools-bom&lt;/artifactId&gt;
      &lt;version&gt;6.5.0.Final&lt;/version&gt;
      &lt;type&gt;pom&lt;/type&gt;
      &lt;scope&gt;import&lt;/scope&gt;
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-android&lt;/artifactId&gt;
    &lt;exclusions&gt;
      &lt;exclusion&gt;
        &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
        &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
      &lt;/exclusion&gt;
    &lt;/exclusions&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
    &lt;exclusions&gt;
      &lt;exclusion&gt;
         &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
         &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
      &lt;/exclusion&gt;
      &lt;exclusion&gt;
         &lt;groupId&gt;xmlpull&lt;/groupId&gt;
         &lt;artifactId&gt;xmlpull&lt;/artifactId&gt;
      &lt;/exclusion&gt;
      &lt;exclusion&gt;
         &lt;groupId&gt;xpp3&lt;/groupId&gt;
         &lt;artifactId&gt;xpp3_min&lt;/artifactId&gt;
      &lt;/exclusion&gt;
      &lt;exclusion&gt;
         &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
         &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
      &lt;/exclusion&gt;
      &lt;exclusion&gt;
         &lt;groupId&gt;org.eclipse.jdt.core.compiler&lt;/groupId&gt;
         &lt;artifactId&gt;ecj&lt;/artifactId&gt;
      &lt;/exclusion&gt;
    &lt;/exclusions&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;
&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.kie&lt;/groupId&gt;
      &lt;artifactId&gt;kie-maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;6.5.0.Final&lt;/version&gt;
      &lt;executions&gt;
        &lt;execution&gt;
          &lt;id&gt;compile-kbase&lt;/id&gt;
          &lt;goals&gt;
            &lt;goal&gt;build&lt;/goal&gt;
          &lt;/goals&gt;
          &lt;phase&gt;compile&lt;/phase&gt;
        &lt;/execution&gt;
      &lt;/executions&gt;
    &lt;/plugin&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;com.simpligility.maven.plugins&lt;/groupId&gt;
      &lt;artifactId&gt;android-maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;4.2.1&lt;/version&gt;
      &lt;extensions&gt;true&lt;/extensions&gt;
      &lt;configuration&gt;
        &lt;sdk&gt;
          &lt;platform&gt;21&lt;/platform&gt;
        &lt;/sdk&gt;
        &lt;dex&gt;
          &lt;coreLibrary&gt;true&lt;/coreLibrary&gt;
          &lt;jvmArguments&gt;&lt;jvmArgument&gt;-Xmx2048m&lt;/jvmArgument&gt;&lt;/jvmArguments&gt;
          &lt;multiDex&gt;true&lt;/multiDex&gt;
          &lt;mainDexList&gt;maindex.txt&lt;/mainDexList&gt;
        &lt;/dex&gt;
        &lt;extractDuplicates&gt;true&lt;/extractDuplicates&gt;
        &lt;apk&gt;
          &lt;metaInf&gt;
            &lt;includes&gt;
              &lt;include&gt;services/**&lt;/include&gt;
              &lt;include&gt;kmodule.*&lt;/include&gt;
              &lt;include&gt;HelloKB/**&lt;/include&gt;
              &lt;include&gt;drools**&lt;/include&gt;
              &lt;include&gt;maven/${project.groupId}/${project.artifactId}/**&lt;/include&gt;
            &lt;/includes&gt;
          &lt;/metaInf&gt;
        &lt;/apk&gt;
      &lt;/configuration&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;
                  </code></pre></div></div><br class="example-break"/></div></div></div><div class="section" title="14.2. Integration with Roboguice"><div class="titlepage"><div><div><h2 class="title"><a id="d0e16257"/>14.2. Integration with Roboguice</h2></div></div></div><div class="section" title="14.2.1. Pre-serialized Rules with Roboguice"><div class="titlepage"><div><div><h3 class="title"><a id="d0e16260"/>14.2.1. Pre-serialized Rules with Roboguice</h3></div></div></div><p>With Roboguice pre-serialized knowledge bases can be injected using the @KBase annotation.</p><div class="section" title="14.2.1.1. Annotations"><div class="titlepage"><div><div><h4 class="title"><a id="d0e16265"/>14.2.1.1. Annotations</h4></div></div></div><p>
                  @KBase supports an optional 'name' attribute. CDI typically
                  does "getOrCreate" when it injects, all injections receive the same instance for the same set
                  of annotations. the 'name' annotation forces a unique instance for each name, although all
                  instances for that name will be identity equals.
              </p><div class="section" title="14.2.1.1.1. @KBase"><div class="titlepage"><div><div><h5 class="title"><a id="d0e16270"/>14.2.1.1.1. @KBase</h5></div></div></div><p>The default argument maps to the value attribute and specifies the name of the KieBase from the
                      kmodule.xml file.</p><div class="figure"><a id="d0e16275"/><p class="title"><strong>Figure 14.2. Injects KieBase by name from pre-serialized resource</strong></p><div class="figure-contents"><pre><code class="language-java">@KBase("kbase1")
private KieBase kbase;</code></pre></div></div><br class="figure-break"/></div></div><div class="section" title="14.2.1.2. AndroidManifest.xml configuration"><div class="titlepage"><div><div><h4 class="title"><a id="d0e16280"/>14.2.1.2. AndroidManifest.xml configuration</h4></div></div></div><p>The Roboguice module needs to be specified in the manifest.</p><div class="example"><a id="d0e16285"/><p class="title"><strong>Example 14.3. Roboguice manifest with pre-serialized knowledge base </strong></p><div class="example-contents"><pre><code class="language-xml">&lt;application
   android:largeHeap="true"
   android:allowBackup="true"
   android:icon="@drawable/ic_launcher"
   android:label="@string/app_name"
   android:theme="@style/AppTheme"&gt;
      &lt;meta-data
         android:name="roboguice.modules"
         android:value="org.drools.android.roboguice.DroolsModule"/&gt;
      &lt;activity
         android:label="@string/app_name"
         android:name="org.drools.examples.android.SplashActivity"&gt;
      &lt;intent-filter&gt;
         &lt;action android:name="android.intent.action.MAIN"/&gt;
         &lt;category android:name="android.intent.category.LAUNCHER"/&gt;
      &lt;/intent-filter&gt;
   &lt;/activity&gt;
&lt;/application&gt;
                  </code></pre></div></div><br class="example-break"/></div></div><div class="section" title="14.2.2. KieContainer with drools-compiler dependency and Roboguice"><div class="titlepage"><div><div><h3 class="title"><a id="d0e16290"/>14.2.2. KieContainer with drools-compiler dependency and Roboguice</h3></div></div></div><p>With Roboguice and drools-compiler almost the full CDI syntax can be used to inject KieContainers, KieBases, and KieSessions.</p><div class="section" title="14.2.2.1. Annotations"><div class="titlepage"><div><div><h4 class="title"><a id="d0e16295"/>14.2.2.1. Annotations</h4></div></div></div><p>@KContainer, @KBase and @KSession all support an optional 'name' attribute. CDI typically
                  does "getOrCreate" when it injects, all injections receive the same instance for the same set
                  of annotations. the 'name' annotation forces a unique instance for each name, although all
                  instance for that name will be identity equals.</p><div class="section" title="14.2.2.1.1. @KContainer"><div class="titlepage"><div><div><h5 class="title"><a id="d0e16300"/>14.2.2.1.1. @KContainer</h5></div></div></div><div class="figure"><a id="d0e16303"/><p class="title"><strong>Figure 14.3. Injects Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
private KieContainer kContainer;</code></pre></div></div><br class="figure-break"/></div><div class="section" title="14.2.2.1.2. @KBase"><div class="titlepage"><div><div><h5 class="title"><a id="d0e16308"/>14.2.2.1.2. @KBase</h5></div></div></div><p>The default argument, if given, maps to the value attribute and specifies the name of the KieBase from the
                      kmodule.xml file.</p><div class="figure"><a id="d0e16313"/><p class="title"><strong>Figure 14.4. Injects the Default KieBase from the Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
private KieBase kbase;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e16318"/><p class="title"><strong>Figure 14.5. Injects KieBase by name from the Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KBase("kbase1")
private KieBase kbase;</code></pre></div></div><br class="figure-break"/></div><div class="section" title="14.2.2.1.3. @KSession for KieSession"><div class="titlepage"><div><div><h5 class="title"><a id="d0e16323"/>14.2.2.1.3. @KSession for KieSession</h5></div></div></div><p>@KSession is optional as it can be detected and added by the use of @Inject and variable
                      type inference.</p><p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the
                      kmodule.xml file</p><div class="figure"><a id="d0e16330"/><p class="title"><strong>Figure 14.6. Injects the Default KieSession from the Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
private KieSession ksession;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e16335"/><p class="title"><strong>Figure 14.7. Injects StatelessKieSession by name from the Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KSession("ksession1")
private KieSession ksession;</code></pre></div></div><br class="figure-break"/></div><div class="section" title="14.2.2.1.4. @KSession for StatelessKieSession"><div class="titlepage"><div><div><h5 class="title"><a id="d0e16340"/>14.2.2.1.4. @KSession for StatelessKieSession</h5></div></div></div><p>@KSession is optional as it can be detected and added by the use of @Inject and variable
                      type inference.</p><p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the
                      kmodule.xml file.</p><div class="figure"><a id="d0e16347"/><p class="title"><strong>Figure 14.8. Injects the Default StatelessKieSession from the Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
private StatelessKieSession ksession;</code></pre></div></div><br class="figure-break"/><div class="figure"><a id="d0e16352"/><p class="title"><strong>Figure 14.9. Injects StatelessKieSession by name from the Classpath KieContainer</strong></p><div class="figure-contents"><pre><code class="language-java">@Inject
@KSession("ksession1")
private StatelessKieSession ksession;</code></pre></div></div><br class="figure-break"/></div></div><div class="section" title="14.2.2.2. AndroidManifest.xml configuration"><div class="titlepage"><div><div><h4 class="title"><a id="d0e16357"/>14.2.2.2. AndroidManifest.xml configuration</h4></div></div></div><p>The Roboguice module needs to be specified in the manifest.</p><div class="example"><a id="d0e16362"/><p class="title"><strong>Example 14.4. Roboguice manifest configuration</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;application
   android:largeHeap="true"
   android:allowBackup="true"
   android:icon="@drawable/ic_launcher"
   android:label="@string/app_name"
   android:theme="@style/AppTheme"&gt;
   &lt;meta-data
      android:name="roboguice.modules"
      android:value="org.drools.android.roboguice.DroolsContainerModule"/&gt;
   &lt;activity
      android:label="@string/app_name"
      android:name="org.drools.examples.android.SplashActivity"&gt;
      &lt;intent-filter&gt;
         &lt;action android:name="android.intent.action.MAIN"/&gt;
         &lt;category android:name="android.intent.category.LAUNCHER"/&gt;
      &lt;/intent-filter&gt;
   &lt;/activity&gt;
&lt;/application&gt;
                  </code></pre></div></div><br class="example-break"/></div></div></div></div><div class="chapter" title="Chapter 15. Apache Camel Integration"><div class="titlepage"><div><div><h2 class="title"><a id="ch.camel"/>Chapter 15. Apache Camel Integration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e16370">15.1. Camel</a></span></dt></dl></div><div class="section" title="15.1. Camel"><div class="titlepage"><div><div><h2 class="title"><a id="d0e16370"/>15.1. Camel</h2></div></div></div><p>Camel provides a light weight bus framework for getting information
  into and out of Drools.</p><p>Drools introduces two elements to make easy integration.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Drools Policy</p><p>Augments any JAXB or XStream data loaders. For JAXB it adds drools
      related paths ot the contextpath, for XStream it adds custom converters
      and aliases for Drools classes. It also handles setting the ClassLoader
      to the targeted ksession.</p></li><li class="listitem"><p>Drools Endpoint</p><p>Executes the payload against the specified drools session</p></li></ul></div><p>Drools can be configured like any normal camel component, but notice
  the policy that wraps the drools related segments. This will route all
  payloads to ksession1</p><div class="example"><a id="d0e16390"/><p class="title"><strong>Example 15.1. Drools EndPoint configured with the CXFRS producer</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;bean id="kiePolicy" class="org.kie.camel.component.KiePolicy" /&gt;

&lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring"&gt;  
   &lt;route&gt;
      &lt;from uri="cxfrs://bean://rsServer"/&gt;
         &lt;policy ref="kiePolicy"&gt;
            &lt;unmarshal ref="xstream" /&gt;       
            &lt;to uri="kie:ksession1" /&gt;
            &lt;marshal ref="xstream" /&gt;
       &lt;/policy&gt;
    &lt;/route&gt;
&lt;/camelContext&gt;</code></pre></div></div><br class="example-break"/><p>It is possible to not specify the session in the drools endpoint uri,
  and instead "multiplex" based on an attribute or header. In this example the
  policy will check either the header field "DroolsLookup" for the named
  session to execute and if that isn't specified it'll check the "lookup"
  attribute on the incoming payload. </p><div class="example"><a id="d0e16397"/><p class="title"><strong>Example 15.2. Drools EndPoint configured with the CXFRS producer</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;bean id="kiePolicy" class="org.kie.camel.component.KiePolicy" /&gt;

&lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring"&gt;  
   &lt;route&gt;
      &lt;from uri="cxfrs://bean://rsServer"/&gt;
         &lt;policy ref="kiePolicy"&gt;
            &lt;unmarshal ref="xstream" /&gt;       
            &lt;to uri="kie:dynamic" /&gt;
            &lt;marshal ref="xstream" /&gt;
       &lt;/policy&gt;
    &lt;/route&gt;
&lt;/camelContext&gt;</code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e16402"/><p class="title"><strong>Example 15.3. Java Code to execute against Route from a Spring and Camel
    Context</strong></p><div class="example-contents"><pre><code class="no-highlight">public class MyTest extends CamelSpringTestSupport {
    
    @Override
    protected AbstractXmlApplicationContext createApplicationContext() {        
        return new ClassPathXmlApplicationContext("org/drools/camel/component/CxfRsSpring.xml");
    }  

    public void test1() throws Exception {
        String cmd = "";
        cmd += "&lt;batch-execution lookup=\"ksession1\"&gt;\n";
        cmd += "  &lt;insert out-identifier=\"salaboy\"&gt;\n";
        cmd += "      &lt;org.drools.pipeline.camel.Person&gt;\n";
        cmd += "         &lt;name&gt;salaboy&lt;/name&gt;\n";
        cmd += "      &lt;/org.drools.pipeline.camel.Person&gt;\n";
        cmd += "   &lt;/insert&gt;\n";
        cmd += "   &lt;fire-all-rules/&gt;\n";
        cmd += "&lt;/batch-execution&gt;\n";
                
        Object object = this.context.createProducerTemplate().requestBody("direct://client", cmd);
        System.out.println( object ); 
    }
}    </code></pre></div></div><br class="example-break"/><p>The following urls show sample script examples for jaxb, xstream and
  json marshalling using:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/jaxb.mvt?r=HEAD</p></li><li class="listitem"><p>http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/jaxb.mvt?r=HEAD</p></li><li class="listitem"><p>http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/xstream.mvt?r=HEAD</p></li></ul></div></div></div><div class="chapter" title="Chapter 16. Drools Camel Server"><div class="titlepage"><div><div><h2 class="title"><a id="ch.server"/>Chapter 16. Drools Camel Server</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e16423">16.1. Introduction</a></span></dt><dt><span class="section"><a href="#d0e16428">16.2. Deployment</a></span></dt><dt><span class="section"><a href="#d0e16433">16.3. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16473">16.3.1. REST/Camel Services configuration</a></span></dt></dl></dd></dl></div><div class="section" title="16.1. Introduction"><div class="titlepage"><div><div><h2 class="title"><a id="d0e16423"/>16.1. Introduction</h2></div></div></div><p>The drools camel server (drools-camel-server) module is a war which you
  can deploy to execute KnowledgeBases remotely for any sort of client
  application. This is not limited to JVM application clients, but any
  technology that can use HTTP, through a REST interface. This version of the
  execution server supports stateless and stateful sessions in a native
  way.</p></div><div class="section" title="16.2. Deployment"><div class="titlepage"><div><div><h2 class="title"><a id="d0e16428"/>16.2. Deployment</h2></div></div></div><p>Drools Camel Server is a war file, which can be deployed in a application
  server (such as JBoss AS). As the service is stateless, it is possible to
  have have as many of these services deployed as you need to serve the client
  load. Deploy on JBoss AS 4.x / Tomcat 6.x works out-of-the-box, instead some
  external dependencies must be added and the configuration must be changed to
  be deployed in JBoss AS 5</p></div><div class="section" title="16.3. Configuration"><div class="titlepage"><div><div><h2 class="title"><a id="d0e16433"/>16.3. Configuration</h2></div></div></div><p>Inside the war file you will find a few XML configuration
  files.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>beans.xml</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Skeleton XML that imports knowledge-services.xml and
          camel-server.xml</p></li></ul></div></li><li class="listitem"><p>camel-server.xml</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Configures CXF endpoints with Camel Routes</p></li><li class="listitem"><p>Came Routes pipeline messages to various configured knowledge
          services</p></li></ul></div></li><li class="listitem"><p>knowledge-services.xml</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Various Knowledge Bases and Sessions</p></li></ul></div></li><li class="listitem"><p>camel-client.xml</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Sample camel client showing how to send and receive a
          message</p></li><li class="listitem"><p>Used by "out of the box" test.jsp</p></li></ul></div></li></ul></div><div class="section" title="16.3.1. REST/Camel Services configuration"><div class="titlepage"><div><div><h3 class="title"><a id="d0e16473"/>16.3.1. REST/Camel Services configuration</h3></div></div></div><p>The next step is configure the services that are going to be exposed
    through drools-server. You can modify this configuration in
    camel-server.xml file.</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:cxf="http://camel.apache.org/schema/cxf"
  xmlns:jaxrs="http://cxf.apache.org/jaxrs"
  xsi:schemaLocation="
  http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
  http://camel.apache.org/schema/cxf http://camel.apache.org/schema/cxf/camel-cxf.xsd
  http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd
  http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd"&gt;

&lt;import resource="classpath:META-INF/cxf/cxf.xml" /&gt;
&lt;import resource="classpath:META-INF/cxf/cxf-extension-jaxrs-binding.xml"/&gt; 
&lt;import resource="classpath:META-INF/cxf/cxf-servlet.xml" /&gt;

  &lt;!--
   !   If you are running on JBoss you will need to copy a camel-jboss.jar into the lib and set this ClassLoader configuration
   !  http://camel.apache.org/camel-jboss.html
   !   &lt;bean id="jbossResolver" class="org.apache.camel.jboss.JBossPackageScanClassResolver"/&gt;
   --&gt;

  &lt;!--
   !   Define the server end point.
   !   Copy and paste this element, changing id and the address, to expose services on different urls.
   !   Different Camel routes can handle different end point paths.
   --&gt;
  &lt;cxf:rsServer id="rsServer"  
                address="/rest"
                serviceClass="org.kie.jax.rs.CommandExecutorImpl"&gt;
       &lt;cxf:providers&gt;
           &lt;bean class="org.kie.jax.rs.CommandMessageBodyReader"/&gt;
       &lt;/cxf:providers&gt;
  &lt;/cxf:rsServer&gt;  
  
  &lt;cxf:cxfEndpoint id="soapServer"
            address="/soap"
             serviceName="ns:CommandExecutor"
             endpointName="ns:CommandExecutorPort"
          wsdlURL="soap.wsdl"
          xmlns:ns="http://soap.jax.drools.org/" &gt;
    &lt;cxf:properties&gt;
      &lt;entry key="dataFormat" value="MESSAGE"/&gt;
      &lt;entry key="defaultOperationName" value="execute"/&gt;
    &lt;/cxf:properties&gt;
  &lt;/cxf:cxfEndpoint&gt;

  &lt;!-- Leave this, as it's needed to make Camel "drools" aware --&gt;
  &lt;bean id="kiePolicy" class="org.kie.camel.component.KiePolicy" /&gt;

  &lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring"&gt;    
    &lt;!-- 
     ! Routes incoming messages from end point id="rsServer".
     ! Example route unmarshals the messages with xstream and executes against ksession1.
     ! Copy and paste this element, changing marshallers and the 'to' uri, to target different sessions, as needed.
     !--&gt;
     
    &lt;route&gt;
       &lt;from uri="cxfrs://bean://rsServer"/&gt;
       &lt;policy ref="kiePolicy"&gt;
         &lt;unmarshal ref="xstream" /&gt;
         &lt;to uri="kie:ksession1" /&gt;
         &lt;marshal ref="xstream" /&gt;
       &lt;/policy&gt;
    &lt;/route&gt;    

    &lt;route&gt;
      &lt;from uri="cxf://bean://soapServer"/&gt;
      &lt;policy ref="kiePolicy"&gt;
        &lt;unmarshal ref="xstream" /&gt;       
        &lt;to uri="kie:ksession1" /&gt;
        &lt;marshal ref="xstream" /&gt;
      &lt;/policy&gt;
    &lt;/route&gt;
        
  &lt;/camelContext&gt;
  
&lt;/beans&gt; </code></pre><div class="section" title="16.3.1.1. RESTful service endpoint creation"><div class="titlepage"><div><div><h4 class="title"><a id="d0e16480"/>16.3.1.1. RESTful service endpoint creation</h4></div></div></div><p>In the next XML snippet code we are creating a RESTful (JAX-RS)
      endpoint bound to /kservice/rest address and using
      org.drools.jax.rs.CommandExecutorImpl as the service implementer. This
      class is only used to instantiate the service endpoint because all the
      internal implementation is managed by Camel, and you can see in the
      source file that the exposed execute service must be never
      called.</p><p>Also a JAX-RS Provider is provided to determine if the message
      transported can be processed in this service endpoint.</p><pre><code class="language-xml">&lt;cxf:rsServer id="rsServer"  
              address="/rest"
              serviceClass="org.kie.jax.rs.CommandExecutorImpl"&gt;
     &lt;cxf:providers&gt;
         &lt;bean class="org.kie.jax.rs.CommandMessageBodyReader"/&gt;
     &lt;/cxf:providers&gt;
&lt;/cxf:rsServer&gt;  </code></pre><p>Ideally this configuration doesn't need to be modified, at least
      the Service Class and the JAX-RS Provider, but you can add more
      endpoints associated to different addresses to use them in other Camel
      Routes.</p><p>After all this initial configuration, you can start config your
      own Knowledge Services.</p></div><div class="section" title="16.3.1.2. Camel Kie Policy &amp; Context creation"><div class="titlepage"><div><div><h4 class="title"><a id="d0e16493"/>16.3.1.2. Camel Kie Policy &amp; Context creation</h4></div></div></div><p>KiePolicy is used to add Drools support in Camel, basically what
      it does is to add interceptors into the camel route to create Camel
      Processors on the fly and modify the internal navigation route. If you
      want to have SOAP support you need to create your custom Drools Policy,
      but it's going to be added in the next release.</p><p>But you don’t need to know more internal details, only instantiate
      this bean:</p><pre><code class="language-xml">&lt;bean id="kiePolicy" class="org.kie.camel.component.KiePolicy" /&gt;</code></pre><p>The next is create the camel route that will have the
      responsibility to execute the commands sent through JAX-RS. Basically we
      create a route definition associated with the JAX-RS definition as the
      data input, the camel policy to be used and inside the “execution route”
      or ProcessorDefinitions. As you can see, we set XStream as the
      marshaller/unmarshaller and the drools execution route definition</p><pre><code class="language-xml">&lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring"&gt;    
   &lt;route&gt;
      &lt;from uri="cxfrs://bean://rsServer"/&gt;
      &lt;policy ref="kiePolicy"&gt;
        &lt;unmarshal ref="xstream" /&gt;
        &lt;to uri="kie:ksession1" /&gt;
        &lt;marshal ref="xstream" /&gt;
      &lt;/policy&gt;
   &lt;/route&gt;    
   &lt;route&gt;
     &lt;from uri="cxf://bean://soapServer"/&gt;
     &lt;policy ref="kiePolicy"&gt;
       &lt;unmarshal ref="xstream" /&gt;       
       &lt;to uri="kie:ksession1" /&gt;
       &lt;marshal ref="xstream" /&gt;
     &lt;/policy&gt;
   &lt;/route&gt;
&lt;/camelContext&gt;</code></pre><p>The drools endpoint creation has the next arguments</p><pre><code class="language-xml">&lt;to uri="kie:{1}/{2}" /&gt;</code></pre><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Execution Node identifier that is registered in the
          CamelContext</p></li><li class="listitem"><p>Knowledge Session identifier that was registered in the
          Execution Node with identifier {1}</p></li></ol></div><p>Both parameters are configured in knowledge-services.xml
      file.</p></div><div class="section" title="16.3.1.3. Knowledge Services configuration"><div class="titlepage"><div><div><h4 class="title"><a id="d0e16520"/>16.3.1.3. Knowledge Services configuration</h4></div></div></div><p>The next step is create the Knowledge Sessions that you are going
      to use.</p><pre><code class="language-xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:kie="http://drools.org/schema/kie-spring"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                          http://drools.org/schema/kie-spring http://drools.org/schema/kie-spring.xsd"&gt;

  &lt;kie:kmodule id="drools-camel-server"&gt;
    &lt;kie:kbase name="kbase1" packages="org.drools.server"&gt;
      &lt;kie:ksession name="ksession1" type="stateless"/&gt;
    &lt;/kie:kbase&gt;
  &lt;/kie:kmodule&gt;

  &lt;bean id="kiePostProcessor" 
            class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;

&lt;/beans&gt;</code></pre><p>The execution-node is a context or registered kbases and
      ksessions, here kbase1 and ksession1 are planed in the node1 context.
      The kbase itself consists of two knowledge definitions, a DRL and an XSD.
      The Spring documentation contains a lot more information on configuring
      these knowledge services.</p></div><div class="section" title="16.3.1.4. Test"><div class="titlepage"><div><div><h4 class="title"><a id="d0e16529"/>16.3.1.4. Test</h4></div></div></div><p>With drools-server war unzipped you should be able to see a
      test.jsp and run it. This example just executes a simple "echo" type
      application. It sends a message to the rule server that pre-appends the
      word "echo" to the front and sends it back. By default the message is
      "Hello World", different messages can be passed using the url parameter
      msg - test.jsp?msg="My Custom Message".</p><p>Under the hood the jsp invokes the Test.java class, this then
      calls out to Camel which is where the meet happens. The camel-client.xml
      defines the client with just a few lines of XML:</p><pre><code class="language-xml">&lt;!-- Leave this, as it's needed to make Camel "drools" aware --&gt;
&lt;bean id="kiePolicy" class="org.kie.camel.component.KiePolicy" /&gt;
  
&lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring"&gt;
  &lt;route&gt;
     &lt;from uri="direct://kservice/rest"/&gt;
     &lt;policy ref="kiePolicy"&gt;
       &lt;to uri="cxfrs://http://localhost:8080/drools-server/kservice/rest"/&gt;
     &lt;/policy&gt;
  &lt;/route&gt;
  &lt;route&gt;
    &lt;from uri="direct://kservice/soap"/&gt;
    &lt;policy ref="kiePolicy"&gt;
      &lt;to uri="cxfrs://http://localhost:8080/drools-server/kservice/soap"/&gt;
    &lt;/policy&gt;
  &lt;/route&gt;
&lt;/camelContext&gt;</code></pre><p>"direct://kservice" is just a named hook, allowing Java to grab a
      reference and push data into it. In this example the data is already in
      XML, so we don't need to add any <code class="code">DataFormat</code>s to do the marshalling. The
      KiePolicy adds some smarts to the route and you'll see it used on the
      server side too. If JAXB or XStream were used, it would inject custom
      paths and converters, it can also set the ClassLoader too on the server
      side, on the client side it automatically unwraps the Response
      object.</p><p>The rule itself can be found here: test.drl. Notice the type
      Message is declared part of the DRL and is thus not present on the
      Classpath.</p><pre><code class="no-highlight">declare Message
   text : String
end
    
  
rule "echo" dialect "mvel"
when
   $m : Message();
then
   $m.text = "echo:" + $m.text;
end
</code></pre></div></div></div></div><div class="chapter" title="Chapter 17. JMX monitoring with RHQ/JON"><div class="titlepage"><div><div><h2 class="title"><a id="RHQChapter"/>Chapter 17. JMX monitoring with RHQ/JON</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e16550">17.1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e16555">17.1.1. Enabling JMX monitoring in a Drools application</a></span></dt><dt><span class="section"><a href="#d0e16574">17.1.2. Installing and running the RHQ/JON plugin</a></span></dt></dl></dd></dl></div><div class="section" title="17.1. Introduction"><div class="titlepage"><div><div><h2 class="title"><a id="d0e16550"/>17.1. Introduction</h2></div></div></div><p>The Drools engine supports runtime monitoring through JMX standard
      MBeans. These MBeans expose configuration and metrics data, from live
      knowledge bases and sessions, to internal details like rule execution times.
      Any JMX compatible console can be used to access that data. This chapter
      details how to use RHQ/JON to do it, but similar steps can be used for any
      other console.</p><div class="section" title="17.1.1. Enabling JMX monitoring in a Drools application"><div class="titlepage"><div><div><h3 class="title"><a id="d0e16555"/>17.1.1. Enabling JMX monitoring in a Drools application</h3></div></div></div><p>To enable JMX monitoring in a Drools application, it is necessary to
        enable remote monitoring in the JVM. There are several tutorials on how to
        do that in the internet, but we recommend that you check the documentation
        of your specific JVM. Using the Oracle/Sun JVM, it can be as simple as
        running the engine with a few command line system properties.</p><p>For instance, to enable remote monitoring on port 19988 with
        disabled authentication (should be only used for tests/demos, as in
        production authentication should be enabled), just run the application
        with the following command line parameters:</p><pre><code class="language-xml"> -Dcom.sun.management.jmxremote.port=19988 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false
</code></pre><p>The second step is to enable the Drools MBeans. As any Drools
        configuration, that can be done by setting a system property, or adding
        the property to a configuration file, or using the API.</p><p>To enable it in the command line, use:</p><pre><code class="language-xml"> -Dkie.mbeans=enabled</code></pre><p>To enable id using the API, use:</p><pre><code class="language-xml"> KieBaseConfiguration conf = ...
 conf.setOption( MBeansOption.ENABLED );</code></pre></div><div class="section" title="17.1.2. Installing and running the RHQ/JON plugin"><div class="titlepage"><div><div><h3 class="title"><a id="d0e16574"/>17.1.2. Installing and running the RHQ/JON plugin</h3></div></div></div><p>The following sequence of steps can be used to configure JON to
        monitor a Drools application:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Download the JON server and agent.</p></li><li class="listitem"><p>Download Drools plugin included in the "Drools and jBPM tools"
            bundle (http://www.jboss.org/drools/downloads.html).</p></li><li class="listitem"><p>Install server, agent, and the plugin. </p></li><li class="listitem"><p>Check that the server is running, agent is running and plugin is
            installed.</p></li><li class="listitem"><p>Execute the drools application [see details in the previous
            section].</p></li><li class="listitem"><p>On the agent console, type "discovery" command for the agent to
            find the drools application, which it will find on port 19988. </p></li><li class="listitem"><p>On JON console, click on auto-discovery queue.</p></li><li class="listitem"><p>Select the JMX Server process that is showing there, running on
            port 19988.</p></li><li class="listitem"><p>Click import.</p></li><li class="listitem"><p>Click on Resources-&gt;servers.</p></li><li class="listitem"><p>Click on the JMX Server.</p></li><li class="listitem"><p>Under JMXServer on the left hand side, you have Drools
            Service.</p></li></ol></div></div></div></div></div><div class="part" title="Part V. Drools Workbench"><div class="titlepage"><div><div><h1 class="title"><a id="d0e16616"/>Part V. Drools Workbench</h1></div></div></div><div class="partintro" title="Drools Workbench"><div/><p>The Drools workbench is built with the UberFire framework and uses the Guvnor plugin. Drools provides an
        additional rich set of plugins for rule authoring metaphors.</p><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="chapter"><a href="#wb.Workbench">18. Workbench (General)</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.Installation">18.1. Installation</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.warInstallation">18.1.1. War installation</a></span></dt><dt><span class="section"><a href="#wb.workbenchData">18.1.2. Workbench data</a></span></dt><dt><span class="section"><a href="#wb.systemProperties">18.1.3. System properties</a></span></dt><dt><span class="section"><a href="#wb.troubleShooting">18.1.4. Trouble shooting</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.QuickStart">18.2. Quick Start</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.QuickStartAddRepository">18.2.1. Add repository</a></span></dt><dt><span class="section"><a href="#wb.QuickStartAddProject">18.2.2. Add project</a></span></dt><dt><span class="section"><a href="#wb.QuickStartDefineDataModel">18.2.3. Define Data Model</a></span></dt><dt><span class="section"><a href="#wb.QuickStartDefineRule">18.2.4. Define Rule</a></span></dt><dt><span class="section"><a href="#wb.QuickStartBuildAndDeloy">18.2.5. Build and Deploy</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.Administration">18.3. Administration</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.administrationOverview">18.3.1. Administration overview</a></span></dt><dt><span class="section"><a href="#wb.OrganizationalUnit">18.3.2. Organizational unit</a></span></dt><dt><span class="section"><a href="#wb.VFSRepository">18.3.3. Repositories</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.Configuration">18.4. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.UserManagement">18.4.1. Basic user management</a></span></dt><dt><span class="section"><a href="#wb.Roles">18.4.2. Roles</a></span></dt><dt><span class="section"><a href="#wb.RestrictedAccess">18.4.3. Restricting access to repositories </a></span></dt><dt><span class="section"><a href="#wb.CommandLineConfig">18.4.4. Command line config tool</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.Introduction">18.5. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.LogInAndLogOut">18.5.1. Log in and log out</a></span></dt><dt><span class="section"><a href="#wb.HomeScreen">18.5.2. Home screen</a></span></dt><dt><span class="section"><a href="#wb.WorkbenchConcepts">18.5.3. Workbench concepts</a></span></dt><dt><span class="section"><a href="#wb.InitialLayout">18.5.4. Initial layout</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ChangingLayout">18.6. Changing the layout</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.Resizing">18.6.1. Resizing</a></span></dt><dt><span class="section"><a href="#wb.Repositioning">18.6.2. Repositioning</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.Authoring">18.7. Authoring (General)</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.ArtifactRepository">18.7.1. Artifact Repository</a></span></dt><dt><span class="section"><a href="#wb.AssetEditor">18.7.2. Asset Editor</a></span></dt><dt><span class="section"><a href="#wb.TagsEditor">18.7.3. Tags Editor</a></span></dt><dt><span class="section"><a href="#wb.ProjectExplorer">18.7.4. Project Explorer</a></span></dt><dt><span class="section"><a href="#wb.ProjectEditor">18.7.5. Project Editor</a></span></dt><dt><span class="section"><a href="#wb.Validation">18.7.6. Validation</a></span></dt><dt><span class="section"><a href="#wb.DataModeller">18.7.7. Data Modeller</a></span></dt><dt><span class="section"><a href="#wb.DataSets">18.7.8. Data Sets</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.UserAndGroupMgmt">18.8. User and group management</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e19602">18.8.1. Introduction</a></span></dt><dt><span class="section"><a href="#d0e19623">18.8.2. Security management providers</a></span></dt><dt><span class="section"><a href="#d0e19730">18.8.3. Installation and setup</a></span></dt><dt><span class="section"><a href="#d0e19860">18.8.4. Usage</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.Embedding">18.9. Embedding Workbench In Your Application</a></span></dt><dt><span class="section"><a href="#wb.AssetManagement">18.10. Asset Management</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.assetMgmtOverview">18.10.1. Asset Management Overview</a></span></dt><dt><span class="section"><a href="#wb.assetMgmtManagedVsUnmanaged">18.10.2. Managed vs Unmanaged Repositories</a></span></dt><dt><span class="section"><a href="#wb.assetMgmtProcesses">18.10.3. Asset Management Processes</a></span></dt><dt><span class="section"><a href="#wb.assetMgmtUsageFlow">18.10.4. Usage Flow</a></span></dt><dt><span class="section"><a href="#wb.assetMgmtRepositoryStructure">18.10.5. Repository Structure</a></span></dt><dt><span class="section"><a href="#wb.assetMgmtManagedRepositoryOperations">18.10.6. Managed Repositories Operations</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ExecServerUI">18.11. Execution Server Management UI</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.ExecServerUITemplate">18.11.1. Server Templates</a></span></dt><dt><span class="section"><a href="#wb.ExecServerUIContainer">18.11.2. Container</a></span></dt><dt><span class="section"><a href="#wb.ExecServerUIRemoteServer">18.11.3. Remote Server</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#drools.AuthoringAssets">19. Authoring Rule Assets</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.NewPackage">19.1. Creating a package</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e20580">19.1.1. Empty package</a></span></dt><dt><span class="section"><a href="#d0e20599">19.1.2. Copy, Rename and Delete Packages</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.GuidedRuleEditor">19.2. Business rules with the guided editor</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.GuidedRuleEditorParts">19.2.1. Parts of the Guided Rule Editor</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorLHS">19.2.2. The "WHEN" (left-hand side) of a Rule</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorRHS">19.2.3. The "THEN" (right-hand side) of a Rule</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorOptionalAttributes">19.2.4. Optional attributes</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorToolbar">19.2.5. Pattern/Action toolbar</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorEnumerations">19.2.6. User driven drop down lists</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorDSL">19.2.7. Augmenting with DSL sentences</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorComplexExample">19.2.8. A more complex example:</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.GuidedRuleTemplateEditor">19.3. Templates of assets/rules</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.GuidedRuleTemplateEditorCreating">19.3.1. Creating a rule template</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleTemplateEditorDefining">19.3.2. Define the template</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleTemplateEditorDefiningData">19.3.3. Defining the template data</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleTemplateEditorGeneratedDRL">19.3.4. Generated DRL</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.GuidedDecisionTableEditor">19.4. Guided decision tables (web based)</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.GuidedDecisionTableEditorTypesOfDecisionTable">19.4.1. Types of decision table</a></span></dt><dt><span class="section"><a href="#drools.GuidedDecisionTableEditorConcepts">19.4.2. Main components\concepts</a></span></dt><dt><span class="section"><a href="#drools.GuidedDecisionTableEditorDefining">19.4.3. Defining a web based decision table</a></span></dt><dt><span class="section"><a href="#drools.GuidedDecisionTableEditorRuleDefinitions">19.4.4. Rule definition</a></span></dt><dt><span class="section"><a href="#drools.GuidedDecisionTableEditorAuditLog">19.4.5. Audit Log</a></span></dt><dt><span class="section"><a href="#drools.GuidedDecisionTableEditorVerification">19.4.6. Real Time Validation and Verification</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.GuidedDecisionTreeEditor">19.5. Guided Decision Trees</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e21644">19.5.1. The initial editor layout</a></span></dt><dt><span class="section"><a href="#d0e21692">19.5.2. First steps</a></span></dt><dt><span class="section"><a href="#d0e21730">19.5.3. Editing Data Object nodes</a></span></dt><dt><span class="section"><a href="#d0e21743">19.5.4. Editing Field Constraint nodes</a></span></dt><dt><span class="section"><a href="#d0e21756">19.5.5. Editing Action nodes</a></span></dt><dt><span class="section"><a href="#d0e21789">19.5.6. Managing the tree</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.XLSDecisionTable">19.6. Spreadsheet decision tables</a></span></dt><dt><span class="section"><a href="#drools.GuidedScoreCardEditor">19.7. Scorecards</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.GuidedScoreCardEditorSetupParameters">19.7.1. (a) Setup Parameters</a></span></dt><dt><span class="section"><a href="#drools.GuidedScoreCardEditorCharacteristics">19.7.2. (b) Characteristics</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.TestScenarioEditor">19.8. Test Scenario</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.KSessionSelector">19.8.1. Knowledge Session Selector</a></span></dt><dt><span class="section"><a href="#drools.TestScenarioEditorGivenSection">19.8.2. Given Section</a></span></dt><dt><span class="section"><a href="#drools.TestScenarioEditorExpectedSection">19.8.3. Expect Section</a></span></dt><dt><span class="section"><a href="#drools.TestScenarioEditorGlobalSection">19.8.4. Global Section</a></span></dt><dt><span class="section"><a href="#drools.TestScenarioEditorInpuotSection">19.8.5. New Input Section</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.FunctionEditor">19.9. Functions</a></span></dt><dt><span class="section"><a href="#drools.DSLEditor">19.10. DSL editor</a></span></dt><dt><span class="section"><a href="#drools.EnumerationEditor">19.11. Data enumerations (drop down list configurations)</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.AdvancedEnumConcepts">19.11.1. Advanced enumeration concepts</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.DRLEditor">19.12. Technical rules (DRL)</a></span></dt></dl></dd><dt><span class="chapter"><a href="#wb.WorkbenchIntegration">20. Workbench Integration</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.WorkbenchRemoteAPI">20.1. REST</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e22427">20.1.1. Job calls</a></span></dt><dt><span class="section"><a href="#d0e22531">20.1.2. Repository calls</a></span></dt><dt><span class="section"><a href="#d0e22706">20.1.3. Organizational unit calls</a></span></dt><dt><span class="section"><a href="#d0e22837">20.1.4. Maven calls</a></span></dt><dt><span class="section"><a href="#d0e22953">20.1.5. REST summary</a></span></dt></dl></dd><dt><span class="section"><a href="#kie.KeycloakSSOIntegration">20.2. Keycloak SSO integration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e23153">20.2.1. Scenario</a></span></dt><dt><span class="section"><a href="#d0e23178">20.2.2. Install and setup a Keycloak server</a></span></dt><dt><span class="section"><a href="#d0e23222">20.2.3. Create and setup the demo realm</a></span></dt><dt><span class="section"><a href="#d0e23351">20.2.4. Install and setup jBPM Workbench</a></span></dt><dt><span class="section"><a href="#d0e23519">20.2.5. Securing workbench remote services via Keycloak</a></span></dt><dt><span class="section"><a href="#d0e23565">20.2.6. Securing workbench's file system services via Keycloak</a></span></dt><dt><span class="section"><a href="#d0e23668">20.2.7. Execution server</a></span></dt><dt><span class="section"><a href="#d0e23850">20.2.8. Consuming remote services</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#wb.WorkbenchHighAvailability">21. Workbench High Availability</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.HighAvailability">21.1. </a></span></dt><dd><dl><dt><span class="section"><a href="#wb.vfsClustering">21.1.1. VFS clustering</a></span></dt><dt><span class="section"><a href="#d0e24193">21.1.2. jBPM clustering</a></span></dt></dl></dd></dl></dd></dl></div></div><div class="chapter" title="Chapter 18. Workbench (General)"><div class="titlepage"><div><div><h2 class="title"><a id="wb.Workbench"/>Chapter 18. Workbench (General)</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#wb.Installation">18.1. Installation</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.warInstallation">18.1.1. War installation</a></span></dt><dt><span class="section"><a href="#wb.workbenchData">18.1.2. Workbench data</a></span></dt><dt><span class="section"><a href="#wb.systemProperties">18.1.3. System properties</a></span></dt><dt><span class="section"><a href="#wb.troubleShooting">18.1.4. Trouble shooting</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.QuickStart">18.2. Quick Start</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.QuickStartAddRepository">18.2.1. Add repository</a></span></dt><dt><span class="section"><a href="#wb.QuickStartAddProject">18.2.2. Add project</a></span></dt><dt><span class="section"><a href="#wb.QuickStartDefineDataModel">18.2.3. Define Data Model</a></span></dt><dt><span class="section"><a href="#wb.QuickStartDefineRule">18.2.4. Define Rule</a></span></dt><dt><span class="section"><a href="#wb.QuickStartBuildAndDeloy">18.2.5. Build and Deploy</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.Administration">18.3. Administration</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.administrationOverview">18.3.1. Administration overview</a></span></dt><dt><span class="section"><a href="#wb.OrganizationalUnit">18.3.2. Organizational unit</a></span></dt><dt><span class="section"><a href="#wb.VFSRepository">18.3.3. Repositories</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.Configuration">18.4. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.UserManagement">18.4.1. Basic user management</a></span></dt><dt><span class="section"><a href="#wb.Roles">18.4.2. Roles</a></span></dt><dt><span class="section"><a href="#wb.RestrictedAccess">18.4.3. Restricting access to repositories </a></span></dt><dt><span class="section"><a href="#wb.CommandLineConfig">18.4.4. Command line config tool</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.Introduction">18.5. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.LogInAndLogOut">18.5.1. Log in and log out</a></span></dt><dt><span class="section"><a href="#wb.HomeScreen">18.5.2. Home screen</a></span></dt><dt><span class="section"><a href="#wb.WorkbenchConcepts">18.5.3. Workbench concepts</a></span></dt><dt><span class="section"><a href="#wb.InitialLayout">18.5.4. Initial layout</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ChangingLayout">18.6. Changing the layout</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.Resizing">18.6.1. Resizing</a></span></dt><dt><span class="section"><a href="#wb.Repositioning">18.6.2. Repositioning</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.Authoring">18.7. Authoring (General)</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.ArtifactRepository">18.7.1. Artifact Repository</a></span></dt><dt><span class="section"><a href="#wb.AssetEditor">18.7.2. Asset Editor</a></span></dt><dt><span class="section"><a href="#wb.TagsEditor">18.7.3. Tags Editor</a></span></dt><dt><span class="section"><a href="#wb.ProjectExplorer">18.7.4. Project Explorer</a></span></dt><dt><span class="section"><a href="#wb.ProjectEditor">18.7.5. Project Editor</a></span></dt><dt><span class="section"><a href="#wb.Validation">18.7.6. Validation</a></span></dt><dt><span class="section"><a href="#wb.DataModeller">18.7.7. Data Modeller</a></span></dt><dt><span class="section"><a href="#wb.DataSets">18.7.8. Data Sets</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.UserAndGroupMgmt">18.8. User and group management</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e19602">18.8.1. Introduction</a></span></dt><dt><span class="section"><a href="#d0e19623">18.8.2. Security management providers</a></span></dt><dt><span class="section"><a href="#d0e19730">18.8.3. Installation and setup</a></span></dt><dt><span class="section"><a href="#d0e19860">18.8.4. Usage</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.Embedding">18.9. Embedding Workbench In Your Application</a></span></dt><dt><span class="section"><a href="#wb.AssetManagement">18.10. Asset Management</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.assetMgmtOverview">18.10.1. Asset Management Overview</a></span></dt><dt><span class="section"><a href="#wb.assetMgmtManagedVsUnmanaged">18.10.2. Managed vs Unmanaged Repositories</a></span></dt><dt><span class="section"><a href="#wb.assetMgmtProcesses">18.10.3. Asset Management Processes</a></span></dt><dt><span class="section"><a href="#wb.assetMgmtUsageFlow">18.10.4. Usage Flow</a></span></dt><dt><span class="section"><a href="#wb.assetMgmtRepositoryStructure">18.10.5. Repository Structure</a></span></dt><dt><span class="section"><a href="#wb.assetMgmtManagedRepositoryOperations">18.10.6. Managed Repositories Operations</a></span></dt></dl></dd><dt><span class="section"><a href="#wb.ExecServerUI">18.11. Execution Server Management UI</a></span></dt><dd><dl><dt><span class="section"><a href="#wb.ExecServerUITemplate">18.11.1. Server Templates</a></span></dt><dt><span class="section"><a href="#wb.ExecServerUIContainer">18.11.2. Container</a></span></dt><dt><span class="section"><a href="#wb.ExecServerUIRemoteServer">18.11.3. Remote Server</a></span></dt></dl></dd></dl></div><div class="section" title="18.1. Installation"><div class="titlepage"><div><div><h2 class="title"><a id="wb.Installation"/>18.1. Installation</h2></div></div></div><div class="section" title="18.1.1. War installation"><div class="titlepage"><div><div><h3 class="title"><a id="wb.warInstallation"/>18.1.1. War installation</h3></div></div></div><p>Use the <code class="literal">war</code> from the workbench distribution zip that corrsponds to your
      application server. The differences between these <code class="literal">war</code> files are mainly
      superficial. For example, some JARs might be excluded if the application server already
      supplies them.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">eap6_4</code>: tailored for Red Hat JBoss Enterprise Application Platform
          6.4</p></li><li class="listitem"><p><code class="literal">tomcat7</code>: tailored for Apache Tomcat 7</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Apache Tomcat requires additional configuration to correctly install the Workbench.
            Please consult the <code class="literal">README.md</code> in the <code class="literal">war</code> for the
            most up to date procedure.</p></div></li><li class="listitem"><p><code class="literal">was8</code>: tailored for IBM WebSphere Application Server 8</p></li><li class="listitem"><p><code class="literal">weblogic12</code>: tailored for Oracle WebLogic Server 12c</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Oracle WebLogic requires additional configuration to correctly install the
            Workbench. Please consult the <code class="literal">README.md</code> in the <code class="literal">war</code>
            for the most up to date procedure.</p></div></li><li class="listitem"><p><code class="literal">wildfly8</code>: tailored for Red Hat JBoss Wildfly 8</p></li></ul></div></div><div class="section" title="18.1.2. Workbench data"><div class="titlepage"><div><div><h3 class="title"><a id="wb.workbenchData"/>18.1.2. Workbench data</h3></div></div></div><p>The workbench stores its data, by default in the directory
        <code class="literal">$WORKING_DIRECTORY/.niogit</code>, for example
        <code class="literal">wildfly-8.0.0.Final/bin/.niogit</code>, but it can be overridden with the <a class="link" href="#wb.systemProperties" title="18.1.3. System properties">system property</a>
      <code class="literal">-Dorg.uberfire.nio.git.dir</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>In production, make sure to back up the workbench data directory.</p></div></div><div class="section" title="18.1.3. System properties"><div class="titlepage"><div><div><h3 class="title"><a id="wb.systemProperties"/>18.1.3. System properties</h3></div></div></div><p>Here's a list of all system properties:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.nio.git.dir</code></strong></span>: Location
          of the directory <code class="literal">.niogit</code>. Default: working directory</p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.nio.git.daemon.enabled</code></strong></span>: Enables/disables git
          daemon. Default: <code class="literal">true</code></p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.nio.git.daemon.host</code></strong></span>:
          If git daemon enabled, uses this property as local host identifier. Default:
            <code class="literal">localhost</code></p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.nio.git.daemon.port</code></strong></span>:
          If git daemon enabled, uses this property as port number. Default:
          <code class="literal">9418</code></p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.nio.git.ssh.enabled</code></strong></span>:
          Enables/disables ssh daemon. Default: <code class="literal">true</code></p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.nio.git.ssh.host</code></strong></span>: If
          ssh daemon enabled, uses this property as local host identifier. Default:
            <code class="literal">localhost</code></p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.nio.git.ssh.port</code></strong></span>: If
          ssh daemon enabled, uses this property as port number. Default:
          <code class="literal">8001</code></p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.nio.git.ssh.cert.dir</code></strong></span>:
          Location of the directory <code class="literal">.security</code> where local certificates will be
          stored. Default: working directory</p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.nio.git.hooks</code></strong></span>: Location of the directory that contains 
			Git hook scripts that are installed into each repository created (or cloned) in the Workbench. Default: N/A</p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.nio.git.ssh.passphrase</code></strong></span>:
          Passphrase to access your Operating Systems public keystore when cloning <code class="literal">git</code> repositories with <code class="literal">scp</code> style URLs;
          e.g. <code class="literal">git@github.com:user/repository.git</code>.</p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.metadata.index.dir</code></strong></span>:
          Place where Lucene <code class="literal">.index</code> folder will be stored. Default: working
          directory</p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.cluster.id</code></strong></span>: Name of
          the helix cluster, for example: <code class="literal">kie-cluster</code></p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.cluster.zk</code></strong></span>:
          Connection string to zookeeper. This is of the form
            <code class="literal">host1:port1,host2:port2,host3:port3</code>, for example:
            <code class="literal">localhost:2188</code></p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.cluster.local.id</code></strong></span>:
          Unique id of the helix cluster node, note that '<code class="literal">:</code>' is replaced with
            '<code class="literal">_</code>', for example: <code class="literal">node1_12345</code></p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.cluster.vfs.lock</code></strong></span>:
          Name of the resource defined on helix cluster, for example:
          <code class="literal">kie-vfs</code></p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.cluster.autostart</code></strong></span>:
          Delays VFS clustering until the application is fully initialized to avoid conflicts when
          all cluster members create local clones. Default: <code class="literal">false</code></p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.sys.repo.monitor.disabled</code></strong></span>: Disable
          configuration monitor (do not disable unless you know what you're doing). Default:
            <code class="literal">false</code></p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.secure.key</code></strong></span>: Secret
          password used by password encryption. Default:
          <code class="literal">org.uberfire.admin</code></p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.secure.alg</code></strong></span>: Crypto
          algorithm used by password encryption. Default: <code class="literal">PBEWithMD5AndDES</code></p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.uberfire.domain</code></strong></span>:
          security-domain name used by uberfire. Default: <code class="literal">ApplicationRealm</code></p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.guvnor.m2repo.dir</code></strong></span>: Place where
          Maven repository folder will be stored. Default: working-directory/repositories/kie</p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.guvnor.project.gav.check.disabled</code></strong></span>: Disable GAV checks. Default: <code class="literal">false</code></p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.kie.example.repositories</code></strong></span>:
          Folder from where demo repositories will be cloned. The demo repositories need to have
          been obtained and placed in this folder. Demo repositories can be obtained from the
          kie-wb-6.2.0-SNAPSHOT-example-repositories.zip artifact. This System Property takes
          precedence over org.kie.demo and org.kie.example. Default: Not used.</p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.kie.demo</code></strong></span>: Enables external
          clone of a demo application from GitHub. This System Property takes precedence over
          org.kie.example. Default: <code class="literal">true</code></p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.kie.example</code></strong></span>: Enables example
          structure composed by Repository, Organization Unit and Project. Default:
            <code class="literal">false</code></p></li><li class="listitem"><p><span class="bold"><strong><code class="literal">org.kie.build.disable-project-explorer</code></strong></span>: Disable automatic
          build of selected Project in Project Explorer. Default: <code class="literal">false</code></p></li></ul></div><p>To change one of these system properties in a WildFly or JBoss EAP cluster:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Edit the file <code class="literal">$JBOSS_HOME/domain/configuration/host.xml</code>.</p></li><li class="listitem"><p>Locate the XML elements <code class="literal">server</code> that belong to the
            <code class="literal">main-server-group</code> and add a system property, for example:</p><pre><code class="language-xml">&lt;system-properties&gt;
  &lt;property name="org.uberfire.nio.git.dir" value="..." boot-time="false"/&gt;
  ...
&lt;/system-properties&gt;</code></pre></li></ol></div></div><div class="section" title="18.1.4. Trouble shooting"><div class="titlepage"><div><div><h3 class="title"><a id="wb.troubleShooting"/>18.1.4. Trouble shooting</h3></div></div></div><div class="section" title="18.1.4.1. Loading.. does not disappear and Workbench fails to show"><div class="titlepage"><div><div><h4 class="title"><a id="wb.troubleShootingLoadingSpinner"/>18.1.4.1. Loading.. does not disappear and Workbench fails to show</h4></div></div></div><p>There have been reports that Firewalls in between the server and the browser can
        interfere with Server Sent Events (SSE) used by the Workbench.</p><p>The issue results in the "Loading..." spinner remaining visible and the Workbench
        failing to materialize.</p><p>The workaround is to disable the Workbench's use of Server Sent Events by adding file
          <code class="literal">/WEB-INF/classes/ErraiService.properties</code> to the exploded WAR containing
        the value <code class="literal">errai.bus.enable_sse_support=false</code>. Re-package the WAR and
        re-deploy.</p></div></div></div><div class="section" title="18.2. Quick Start"><div class="titlepage"><div><div><h2 class="title"><a id="wb.QuickStart"/>18.2. Quick Start</h2></div></div></div><p>These steps help you get started with minimum of effort.</p><p>They should not be a substitute for reading the documentation in
  full.</p><div class="section" title="18.2.1. Add repository"><div class="titlepage"><div><div><h3 class="title"><a id="wb.QuickStartAddRepository"/>18.2.1. Add repository</h3></div></div></div><p>Create a new repository to hold your project by selecting the
    Administration Perspective.</p><div class="figure"><a id="d0e16980"/><p class="title"><strong>Figure 18.1. Selecting Administration perspective</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/QuickStart/QuickStart1.png" align="middle" alt="Selecting Administration perspective"/></div></div></div><br class="figure-break"/><p>Select the "New repository" option from the menu.</p><div class="figure"><a id="d0e16988"/><p class="title"><strong>Figure 18.2. Creating new repository</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/QuickStart/QuickStart2.png" align="middle" alt="Creating new repository"/></div></div></div><br class="figure-break"/><p>Enter the required information.</p><div class="figure"><a id="d0e16996"/><p class="title"><strong>Figure 18.3. Entering repository information step 1/2</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/QuickStart/QuickStart3.png" align="middle" alt="Entering repository information step 1/2"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e17002"/><p class="title"><strong>Figure 18.4. Entering repository information step 2/2 (only for managed repositories)</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/QuickStart/QuickStart3b.png" align="middle" alt="Entering repository information step 2/2 (only for managed repositories)"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.2.2. Add project"><div class="titlepage"><div><div><h3 class="title"><a id="wb.QuickStartAddProject"/>18.2.2. Add project</h3></div></div></div><p>Select the Authoring Perspective to create a new project.</p><div class="figure"><a id="d0e17013"/><p class="title"><strong>Figure 18.5. Selecting Authoring perspective</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/QuickStart/QuickStart4.png" align="middle" alt="Selecting Authoring perspective"/></div></div></div><br class="figure-break"/><p>Select "Project" from the "New Item" menu.</p><div class="figure"><a id="d0e17021"/><p class="title"><strong>Figure 18.6. Creating new project</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/QuickStart/QuickStart5.png" align="middle" alt="Creating new project"/></div></div></div><br class="figure-break"/><p>Enter a project name first.</p><div class="figure"><a id="d0e17029"/><p class="title"><strong>Figure 18.7. Entering project name</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/QuickStart/QuickStart6.png" align="middle" alt="Entering project name"/></div></div></div><br class="figure-break"/><p>Enter the project details next.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Group ID follows Maven conventions.</p></li><li class="listitem"><p>Artifact ID is pre-populated from the project name.</p></li><li class="listitem"><p>Version is set as 1.0 by default.</p></li></ul></div><div class="figure"><a id="d0e17047"/><p class="title"><strong>Figure 18.8. Entering project details</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/QuickStart/QuickStart7.png" align="middle" alt="Entering project details"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.2.3. Define Data Model"><div class="titlepage"><div><div><h3 class="title"><a id="wb.QuickStartDefineDataModel"/>18.2.3. Define Data Model</h3></div></div></div><p>After a project has been created you need to define Types to be used
    by your rules.</p><p>Select "Data Object" from the "New Item" menu.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>You can also use types contained in existing JARs.</p><p>Please consult the full documentation for details.</p></div><div class="figure"><a id="d0e17065"/><p class="title"><strong>Figure 18.9. Creating "Data Object"</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/QuickStart/QuickStart8.png" align="middle" alt="Creating &#34;Data Object&#34;"/></div></div></div><br class="figure-break"/><p>Set the name and select a package for the new type.</p><div class="figure"><a id="d0e17073"/><p class="title"><strong>Figure 18.10. Creating a new type</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/QuickStart/QuickStart9.png" align="middle" alt="Creating a new type"/></div></div></div><br class="figure-break"/><p>Set field name and type and click on "Create" to create a field for the type.</p><div class="figure"><a id="d0e17081"/><p class="title"><strong>Figure 18.11. Click "Create" and add the field</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/QuickStart/QuickStart10.png" align="middle" alt="Click &#34;Create&#34; and add the field"/></div></div></div><br class="figure-break"/><p>Click "Save" to update the model.</p><div class="figure"><a id="d0e17089"/><p class="title"><strong>Figure 18.12. Clicking "Save"</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/QuickStart/QuickStart11.png" align="middle" alt="Clicking &#34;Save&#34;"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.2.4. Define Rule"><div class="titlepage"><div><div><h3 class="title"><a id="wb.QuickStartDefineRule"/>18.2.4. Define Rule</h3></div></div></div><p>Select "DRL file" (for example) from the "New Item" menu.</p><div class="figure"><a id="d0e17100"/><p class="title"><strong>Figure 18.13. Selecting "DRL file" from the "New Item" menu</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/QuickStart/QuickStart12.png" align="middle" alt="Selecting &#34;DRL file&#34; from the &#34;New Item&#34; menu"/></div></div></div><br class="figure-break"/><p>Enter a file name for the new rule.</p><div class="figure"><a id="d0e17108"/><p class="title"><strong>Figure 18.14. Entering file name for rule</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/QuickStart/QuickStart13.png" align="middle" alt="Entering file name for rule"/></div></div></div><br class="figure-break"/><p>Enter a definition for the rule.</p><p>The definition process differs from asset type to asset type.</p><p>The full documentation has details about the different
    editors.</p><div class="figure"><a id="d0e17120"/><p class="title"><strong>Figure 18.15. Defining a rule</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/QuickStart/QuickStart14.png" align="middle" alt="Defining a rule"/></div></div></div><br class="figure-break"/><p>Once the rule has been defined it will need to be saved.</p><div class="figure"><a id="d0e17128"/><p class="title"><strong>Figure 18.16. Saving the rule</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/QuickStart/QuickStart15.png" align="middle" alt="Saving the rule"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.2.5. Build and Deploy"><div class="titlepage"><div><div><h3 class="title"><a id="wb.QuickStartBuildAndDeloy"/>18.2.5. Build and Deploy</h3></div></div></div><p>Once rules have been defined within a project; the project can be
    built and deployed to the Workbench's Maven Artifact Repository.</p><p>To build a project select the "Project Editor" from the "Project"
    menu.</p><div class="figure"><a id="d0e17141"/><p class="title"><strong>Figure 18.17. Selecting "Project Editor"</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/QuickStart/QuickStart16.png" align="middle" alt="Selecting &#34;Project Editor&#34;"/></div></div></div><br class="figure-break"/><p>Click "Build and Deploy" to build the project and deploy it to the
    Workbench's Maven Artifact Repository.</p><p>When you select Build &amp; Deploy the workbench will deploy to any repositories defined
      in the Dependency Management section of the pom in your workbench project. You can edit the
      pom.xml file associated with your workbench project under the Repository View of the project
      explorer. Details on dependency management in maven can be found here :
      http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html</p><p>If there are errors during the build process they will be reported
    in the "Problems Panel".</p><div class="figure"><a id="d0e17153"/><p class="title"><strong>Figure 18.18. Building and deploying a project</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/QuickStart/QuickStart17.png" align="middle" alt="Building and deploying a project"/></div></div></div><br class="figure-break"/><p>Now the project has been built and deployed; it can be referenced
    from your own projects as any other Maven Artifact.</p><p>The full documentation contains details about integrating projects
    with your own applications.</p></div></div><div class="section" title="18.3. Administration"><div class="titlepage"><div><div><h2 class="title"><a id="wb.Administration"/>18.3. Administration</h2></div></div></div><div class="section" title="18.3.1. Administration overview"><div class="titlepage"><div><div><h3 class="title"><a id="wb.administrationOverview"/>18.3.1. Administration overview</h3></div></div></div><p>A workbench is structured with Organization Units, VFS repositories and projects:</p><div class="mediaobject"><img src="images/Workbench/Administration/workbenchStructureOverview.png"/></div></div><div class="section" title="18.3.2. Organizational unit"><div class="titlepage"><div><div><h3 class="title"><a id="wb.OrganizationalUnit"/>18.3.2. Organizational unit</h3></div></div></div><p>Organization units are useful to model departments and divisions.</p><p>An organization unit can hold multiple repositories.</p><div class="mediaobject"><img src="images/Workbench/Administration/organizationalUnitManager.png"/></div></div><div class="section" title="18.3.3. Repositories"><div class="titlepage"><div><div><h3 class="title"><a id="wb.VFSRepository"/>18.3.3. Repositories</h3></div></div></div><p>Repositories are the place where assets are stored and each repository is organized by projects and belongs to
      a single organization unit. </p><p>Repositories are in fact a Virtual File System based storage, that by default uses GIT as backend. Such setup
      allows workbench to work with multiple backends and, in the same time, take full advantage of backend specifics
      features like in GIT case versioning, branching and even external access.</p><div class="mediaobject"><img src="images/Workbench/Administration/repositoriesEditor.png"/></div><p>A new repository can be created from scratch or cloned from an existing repository.</p><p>One of the biggest advantages of using GIT as backend is the ability to clone a repository from external and
      use your preferred tools to edit and build your assets.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p><span class="bold"><strong>Never</strong></span> clone your repositories directly from <a class="link" href="#wb.systemProperties" title="18.1.3. System properties">.niogit</a> directory. Use always the available protocol(s) displayed in
        repositories editor.</p></div><div class="section" title="18.3.3.1. Repository Editor"><div class="titlepage"><div><div><h4 class="title"><a id="wb.VFSRepositoryEditor"/>18.3.3.1. Repository Editor</h4></div></div></div><p>One additional advantage to use GIT as backend is the possibility to revert your repository to a previous
        state. You can do it directly from the repository editor by browsing its commit history and clicking the
          <span class="bold"><strong>Revert</strong></span> button.</p><div class="mediaobject"><img src="images/Workbench/Administration/repositoryEditor.png"/></div></div></div></div><div class="section" title="18.4. Configuration"><div class="titlepage"><div><div><h2 class="title"><a id="wb.Configuration"/>18.4. Configuration</h2></div></div></div><div class="section" title="18.4.1. Basic user management"><div class="titlepage"><div><div><h3 class="title"><a id="wb.UserManagement"/>18.4.1. Basic user management</h3></div></div></div><p>The workbench authenticates its users against the application server's authentication and authorization
                     (JAAS).</p><p>On JBoss EAP and WildFly, add a user with the script <code class="literal">$JBOSS_HOME/bin/add-user.sh</code> (or
                     <code class="literal">.bat</code>):</p><pre><code class="no-highlight">$ ./add-user.sh
// Type: Application User
// Realm: empty (defaults to ApplicationRealm)
// Role: admin</code></pre><p>There is no need to restart the application server.</p></div><div class="section" title="18.4.2. Roles"><div class="titlepage"><div><div><h3 class="title"><a id="wb.Roles"/>18.4.2. Roles</h3></div></div></div><p>The Workbench uses the following roles:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>admin</p></li><li class="listitem"><p>analyst</p></li><li class="listitem"><p>developer</p></li><li class="listitem"><p>manager</p></li><li class="listitem"><p>user</p></li></ul></div><div class="section" title="18.4.2.1. Admin"><div class="titlepage"><div><div><h4 class="title"><a id="d0e17258"/>18.4.2.1. Admin</h4></div></div></div><p>Administrates the BPMS system.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Manages users</p></li><li class="listitem"><p>Manages VFS Repositories</p></li><li class="listitem"><p>Has full access to make any changes necessary</p></li></ul></div></div><div class="section" title="18.4.2.2. Developer"><div class="titlepage"><div><div><h4 class="title"><a id="d0e17273"/>18.4.2.2. Developer</h4></div></div></div><p>Developer can do almost everything admin can do, except clone repositories.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Manages rules, models, process flows, forms and dashboards</p></li><li class="listitem"><p>Manages the asset repository</p></li><li class="listitem"><p>Can create, build and deploy projects</p></li><li class="listitem"><p>Can use the JBDS connection to view processes</p></li></ul></div></div><div class="section" title="18.4.2.3. Analyst"><div class="titlepage"><div><div><h4 class="title"><a id="d0e17291"/>18.4.2.3. Analyst</h4></div></div></div><p>Analyst is a weaker version of developer and does not have access to the asset repository or the
        ability to deploy projects.</p></div><div class="section" title="18.4.2.4. Business user"><div class="titlepage"><div><div><h4 class="title"><a id="d0e17296"/>18.4.2.4. Business user</h4></div></div></div><p>Daily user of the system to take actions on business tasks that are required for the processes to
        continue forward. Works primarily with the task lists.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Does process management</p></li><li class="listitem"><p>Handles tasks and dashboards</p></li></ul></div></div><div class="section" title="18.4.2.5. Manager/Viewer-only User"><div class="titlepage"><div><div><h4 class="title"><a id="d0e17308"/>18.4.2.5. Manager/Viewer-only User</h4></div></div></div><p>Viewer of the system that is interested in statistics around the business processes and their
        performance, business indicators, and other reporting of the system and people who interact with the system.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Only has access to dashboards</p></li></ul></div></div></div><div class="section" title="18.4.3. Restricting access to repositories"><div class="titlepage"><div><div><h3 class="title"><a id="wb.RestrictedAccess"/>18.4.3. Restricting access to repositories </h3></div></div></div><p>It is possible to restrict access to repositories using roles and organizational groups. To let an user access
      a repository. </p><p>The user either has to belong into a role that has access to the repository or to a role that belongs into an
      organizational group that has access to the repository. These restrictions can be managed with the command line
      config tool.</p></div><div class="section" title="18.4.4. Command line config tool"><div class="titlepage"><div><div><h3 class="title"><a id="wb.CommandLineConfig"/>18.4.4. Command line config tool</h3></div></div></div><p>Provides capabilities to manage the system repository from command line. System repository contains the data
      about general workbench settings: how editors behave, organizational groups, security and other settings that are
      not editable by the user. System repository exists in the .niogit folder, next to all the repositories that have
      been created or cloned into the workbench.</p><div class="section" title="18.4.4.1. Config Tool Modes"><div class="titlepage"><div><div><h4 class="title"><a id="d0e17329"/>18.4.4.1. Config Tool Modes</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Online (default and recommended) - Connects to the Git repository on startup, using Git server provided
            by the KIE Workbench. All changes are made locally and published to upstream when:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>"push-changes" command is explicitly executed</p></li><li class="listitem"><p>"exit" is used to close the tool</p></li></ul></div></li><li class="listitem"><p>Offline - Creates and manipulates system repository directly on the server (no discard option)</p></li></ul></div></div><div class="section" title="18.4.4.2. Available Commands"><div class="titlepage"><div><div><h4 class="title"><a id="d0e17346"/>18.4.4.2. Available Commands</h4></div></div></div><div class="table"><a id="d0e17349"/><p class="title"><strong>Table 18.1. Available Commands</strong></p><div class="table-contents"><table summary="Available Commands" border="1"><colgroup><col/><col/></colgroup><tbody><tr><td align="left">exit</td><td align="left">Publishes local changes, cleans up temporary directories and quits the command line tool</td></tr><tr><td align="left">discard</td><td align="left">Discards local changes without publishing them, cleans up temporary directories and quits the command
                line tool</td></tr><tr><td align="left">help</td><td align="left">Prints a list of available commands</td></tr><tr><td align="left">list-repo</td><td align="left">List available repositories</td></tr><tr><td align="left">list-org-units</td><td align="left">List available organizational units</td></tr><tr><td align="left">list-deployment</td><td align="left">List available deployments</td></tr><tr><td align="left">create-org-unit</td><td align="left">Creates new organizational unit</td></tr><tr><td align="left">remove-org-unit</td><td align="left">Removes existing organizational unit</td></tr><tr><td align="left">add-deployment</td><td align="left">Adds new deployment unit</td></tr><tr><td align="left">remove-deployment</td><td align="left">Removes existing deployment</td></tr><tr><td align="left">create-repo</td><td align="left">Creates new git repository</td></tr><tr><td align="left">remove-repo</td><td align="left">Removes existing repository ( only from config )</td></tr><tr><td align="left">add-repo-org-unit</td><td align="left">Adds repository to the organizational unit</td></tr><tr><td align="left">remove-repo-org-unit</td><td align="left">Removes repository from the organizational unit</td></tr><tr><td align="left">add-role-repo</td><td align="left">Adds role(s) to repository</td></tr><tr><td align="left">remove-role-repo</td><td align="left">Removes role(s) from repository</td></tr><tr><td align="left">add-role-org-unit</td><td align="left">Adds role(s) to organizational unit</td></tr><tr><td align="left">remove-role-org-unit</td><td align="left">Removes role(s) from organizational unit</td></tr><tr><td align="left">add-role-project</td><td align="left">Adds role(s) to project</td></tr><tr><td align="left">remove-role-project</td><td align="left">Removes role(s) from project</td></tr><tr><td align="left">push-changes</td><td align="left">Pushes changes to upstream repository (only in online mode)</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="section" title="18.4.4.3. How to use"><div class="titlepage"><div><div><h4 class="title"><a id="d0e17459"/>18.4.4.3. How to use</h4></div></div></div><p>The tool can be found from kie-config-cli-${version}-dist.zip. Execute the kie-config-cli.sh script and by
        default it will start in online mode asking for a Git url to connect to ( the default value is
        ssh://localhost/system ). To connect to a remote server, replace the host and port with appropriate values, e.g.
        ssh://kie-wb-host/system.</p><pre><code class="no-highlight">./kie-config-cli.sh </code></pre><p>To operate in offline mode, append the offline parameter to the kie-config-cli.sh command. This will change
        the behaviour and ask for a folder where the .niogit (system repository) is. If .niogit does not yet exist, the
        folder value can be left empty and a brand new setup is created. </p><pre><code class="no-highlight">./kie-config-cli.sh offline</code></pre></div></div></div><div class="section" title="18.5. Introduction"><div class="titlepage"><div><div><h2 class="title"><a id="wb.Introduction"/>18.5. Introduction</h2></div></div></div><div class="section" title="18.5.1. Log in and log out"><div class="titlepage"><div><div><h3 class="title"><a id="wb.LogInAndLogOut"/>18.5.1. Log in and log out</h3></div></div></div><p>Create a user with the role <code class="literal">admin</code> and log in with those credentials.</p><p>After successfully logging in, the account username is displayed at the top right. Click on it to review the
      roles of the current account.</p></div><div class="section" title="18.5.2. Home screen"><div class="titlepage"><div><div><h3 class="title"><a id="wb.HomeScreen"/>18.5.2. Home screen</h3></div></div></div><p>After logging in, the home screen shows. The actual content of the home screen depends on the workbench
      variant (Drools, jBPM, ...).</p><div class="mediaobject"><img src="images/Workbench/General/home.png"/></div></div><div class="section" title="18.5.3. Workbench concepts"><div class="titlepage"><div><div><h3 class="title"><a id="wb.WorkbenchConcepts"/>18.5.3. Workbench concepts</h3></div></div></div><p>The Workbench is comprised of different logical entities:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Part</p><p>A Part is a screen or editor with which the user can interact to perform
        operations.</p><p>Example Parts are "Project Explorer", "Project Editor", "Guided Rule Editor" etc.
        Parts can be repositioned.</p></li><li class="listitem"><p>Panel</p><p>A Panel is a container for one or more Parts.</p><p>Panels can be resized.</p></li><li class="listitem"><p>Perspective</p><p>A perspective is a logical grouping of related Panels and Parts. </p><p>The user can switch between perspectives by clicking on one of the top-level menu
        items; such as "Home", "Authoring", "Deploy" etc.</p></li></ul></div><p>
  </p></div><div class="section" title="18.5.4. Initial layout"><div class="titlepage"><div><div><h3 class="title"><a id="wb.InitialLayout"/>18.5.4. Initial layout</h3></div></div></div><p>The Workbench consists of three main sections to begin; however its layout and content can
    be changed.</p><div class="figure"><a id="d0e17524"/><p class="title"><strong>Figure 18.19. The Workbench</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/General/workbench.png" align="middle" alt="The Workbench"/></div></div></div><br class="figure-break"/><p>The initial Workbench shows the following components:- </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Project Explorer</p><p>This provides the ability for the user to browse their configuration; of
          Organizational Units (in the above  "example" is the Organizational Unit), Repositories
          (in the above "uf-playground" is the Repository) and Project (in the above "mortgages" is
          the Project).</p></li><li class="listitem"><p>Problems</p><p>This provides the user with real-time feedback about errors in the active
          Project.</p></li><li class="listitem"><p>Empty space</p><p>This empty space will contain an editor for assets selected from the Project
          Explorer.</p><p>Other screens will also occupy this space by default; such as the Project
          Editor.</p></li></ul></div></div></div><div class="section" title="18.6. Changing the layout"><div class="titlepage"><div><div><h2 class="title"><a id="wb.ChangingLayout"/>18.6. Changing the layout</h2></div></div></div><p>The default layout may not be suitable for a user. Panels can therefore be either resized or repositioned.</p><p>This, for example, could be useful when running tests; as the test defintion and rule can be repositioned side-by-side.</p><div class="section" title="18.6.1. Resizing"><div class="titlepage"><div><div><h3 class="title"><a id="wb.Resizing"/>18.6.1. Resizing</h3></div></div></div><p>The following screenshot shows a Panel being resized.</p><p>Move the mouse pointer over the panel splitter (a grey horizontal or vertical line in between
      panels). </p><p>The cursor will changing indicating it is positioned correctly over the splitter. Press
      and hold the left mouse button and drag the splitter to the required position; then release the
      left mouse button.</p><div class="figure"><a id="d0e17566"/><p class="title"><strong>Figure 18.20. Resizing</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/General/workbench-resizing.png" align="middle" alt="Resizing"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.6.2. Repositioning"><div class="titlepage"><div><div><h3 class="title"><a id="wb.Repositioning"/>18.6.2. Repositioning</h3></div></div></div><p>The following screenshot shows a Panel being repositioned.</p><p>Move the mouse pointer over the Panel title ("Guided Editor [No bad credit checks]" in
      this example).</p><p>The cursor will change indicating it is positioned correctly over the Panel title. Press
      and hold the left mouse button. Drag the mouse to the required location. The target position
      is indicated with a pale blue rectangle. Different positions can be chosen by hovering the
      mouse pointer over the different blue arrows.</p><div class="figure"><a id="d0e17581"/><p class="title"><strong>Figure 18.21. Repositioning - dragging</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/General/workbench-repositioning-before.png" align="middle" alt="Repositioning - dragging"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e17587"/><p class="title"><strong>Figure 18.22. Repositioning - complete</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/General/workbench-repositioning-after.png" align="middle" alt="Repositioning - complete"/></div></div></div><br class="figure-break"/></div></div><div class="section" title="18.7. Authoring (General)"><div class="titlepage"><div><div><h2 class="title"><a id="wb.Authoring"/>18.7. Authoring (General)</h2></div></div></div><div class="section" title="18.7.1. Artifact Repository"><div class="titlepage"><div><div><h3 class="title"><a id="wb.ArtifactRepository"/>18.7.1. Artifact Repository</h3></div></div></div><p>Projects often need external artifacts in their classpath in order to build, for example a domain model JARs.
    The artifact repository holds those artifacts.</p><p>The Artifact Repository is a full blown Maven repository. It follows the semantics of a Maven remote repository:
  all snapshots are timestamped. But it is often stored on the local hard drive.</p><p>By default the artifact repository is stored under <code class="literal">$WORKING_DIRECTORY/repositories/kie</code>, but
    it can be overridden with the <a class="link" href="#wb.systemProperties" title="18.1.3. System properties">system property</a>
    <code class="literal">-Dorg.guvnor.m2repo.dir</code>. There is only 1 Maven repository per installation.</p><p>The Artifact Repository screen shows a list of the artifacts in the Maven repository:</p><div class="mediaobject"><img src="images/Workbench/Authoring/ArtifactRepository/mavenRepositoryExplorer.png"/></div><p>To add a new artifact to that Maven repository, either:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Use the upload button and select a JAR. If the JAR contains a POM file under
      <code class="literal">META-INF/maven</code> (which every JAR build by Maven has), no further information is needed.
      Otherwise, a groupId, artifactId and version need be given too.</p><div class="mediaobject"><img src="images/Workbench/Authoring/ArtifactRepository/mavenRepositoryUpload.png"/></div></li><li class="listitem"><p>Using Maven, <code class="literal">mvn deploy</code> to that Maven repository. Refresh the list to make it show
      up.</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>This remote Maven repository is relatively simple. It does not support proxying, mirroring, ... like Nexus or
    Archiva.</p></div></div><div class="section" title="18.7.2. Asset Editor"><div class="titlepage"><div><div><h3 class="title"><a id="wb.AssetEditor"/>18.7.2. Asset Editor</h3></div></div></div><p> The Asset Editor is the principle component of the workbench User-Interface. It consists of two main views Editor and
    Overview. </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The views</p><div class="figure"><a id="d0e17649"/><p class="title"><strong>Figure 18.23. The Asset Editor - Editor tab</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/Authoring/AssetEditor/AssetEditor-edit.png" align="middle" alt="The Asset Editor - Editor tab"/></div></div></div><br class="figure-break"/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p> A : The editing area - exactly what form the editor takes depends on the Asset
            type. An asset can only be edited by one user at a time to avoid conflicts. When a user
            begins to edit an asset, a lock will automatically be acquired. This is indicated by a
            lock symbol appearing on the asset title bar as well as in the project explorer view
            (see <a class="xref" href="#wb.ProjectExplorer" title="18.7.4. Project Explorer">Section 18.7.4, “Project Explorer”</a> for details). If a user starts editing an
            already locked asset a pop-up notification will appear to inform the user that the asset
            can't currently be edited, as it is being worked on by another user. Changes will be
            prevented until the editing user saves or closes the asset, or logs out of the workbench.
            Session timeouts will also cause locks to be released. Every user further has the option
            to force a lock release, if required (see the Metadata section below).</p></li><li class="listitem"><p> B : This menu bar contains various actions for the Asset; such as Save, Rename,
            Copy etc. Note that saving, renaming and deleting are deactivated if the asset is locked
            by a different user.</p></li><li class="listitem"><p>C : Different views for asset content or asset information.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Editor shows the main editor for the asset</p></li><li class="listitem"><p>Overview contains the metadata and conversation views for this editor. Explained in more detail below.</p></li><li class="listitem"><p>Source shows the asset in plain DRL. Note: This tab is only visible if the asset content can be
                generated into DRL.</p></li><li class="listitem"><p>Data Objects contains the model available for authoring. By default only Data Objects that
                reside within the same package as the asset are available for authoring. Data
                Objects outside of this package can be imported to become available for authoring
                the asset.</p></li></ul></div></li></ul></div><div class="figure"><a id="d0e17680"/><p class="title"><strong>Figure 18.24. The Asset Editor - Data Objects tab</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/Authoring/AssetEditor/AssetEditor-dataobjects.png" align="middle" alt="The Asset Editor - Data Objects tab"/></div></div></div><br class="figure-break"/></li><li class="listitem"><p>Overview</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A : General information about the asset and the asset's description.</p><p>"Type:" The format name of the type of Asset.</p><p>"Description:" Description for the asset.</p><p>"Used in projects:" Names the projects where this rule is used.</p><p>"Last Modified:" Who made the last change and when.</p><p>"Created on:" Who created the asset and when.</p></li><li class="listitem"><p>B : Version history for the asset. Selecting a version loads the selected version into this editor.</p></li><li class="listitem"><p>C : Meta data (from the "Dublin Core" standard)</p></li><li class="listitem"><p>D : Comments regarding the development of the Asset can be recorded here.</p></li></ul></div><div class="figure"><a id="d0e17712"/><p class="title"><strong>Figure 18.25. The Asset Editor - Overview tab</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/Authoring/AssetEditor/Overview.png" align="middle" alt="The Asset Editor - Overview tab"/></div></div></div><br class="figure-break"/></li><li class="listitem"><p>Metadata</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A : Meta data:-</p><p>"Tags:" A tagging system for grouping the assets.</p><p>"Note:" A comment made when the Asset was last updated (i.e. why a change was made)</p><p>"URI:" URI to the asset inside the Git repository.</p><p>"Subject/Type/External link/Source" : Other miscellaneous meta data for the Asset.</p><p>"Lock status" : Shows the lock status of the asset and, if locked, allows to force
            unlocking the asset.</p></li></ul></div><div class="figure"><a id="d0e17735"/><p class="title"><strong>Figure 18.26. The Metadata tab</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/Authoring/AssetEditor/Metadata.png" align="middle" alt="The Metadata tab"/></div></div></div><br class="figure-break"/></li><li class="listitem"><p>Locking</p><p>The Workbench supports pessimistic locking of assets. When one User starts editing an
        asset it is locked to change by other Users. The lock is held until a period of inactivity
        lapses, the Editor is closed or the application stopped and restarted. Locks can also be
        forcibly removed on the MetaData section of the Overview tab. </p><p>A "padlock" icon is shown in the Editor's title bar and beside the asset in the Project Explorer when an asset is locked.</p><div class="figure"><a id="d0e17748"/><p class="title"><strong>Figure 18.27. The Asset Editor - Locked assets cannot be edited by other users</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/Authoring/AssetEditor/AssetEditor-locked.png" align="middle" alt="The Asset Editor - Locked assets cannot be edited by other users"/></div></div></div><br class="figure-break"/></li></ul></div></div><div class="section" title="18.7.3. Tags Editor"><div class="titlepage"><div><div><h3 class="title"><a id="wb.TagsEditor"/>18.7.3. Tags Editor</h3></div></div></div><p>Tags allow assets to be labelled with any number of tags that you define. These tags can be used to
    filter assets on the Project Explorer enabling "Tag filtering".</p><div class="section" title="18.7.3.1. Creating Tags"><div class="titlepage"><div><div><h4 class="title"><a id="wb.managingTags"/>18.7.3.1. Creating Tags</h4></div></div></div><p>
      To create tags you simply have to write them on the Tags input and press the "Add new Tag/s" button.
      The Tag Editor allows creating tags one by one or writing more than one separated with a white space.
    </p><div class="figure"><a id="d0e17764"/><p class="title"><strong>Figure 18.28. Creating Tags</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/Authoring/TagsEditor/CreatingTags.png" align="middle" alt="Creating Tags"/></div></div></div><br class="figure-break"/><p>
      Once you created new Tags they will appear over the Editor allowing you to remove them by pressing on them
      if you want.
    </p><div class="figure"><a id="d0e17772"/><p class="title"><strong>Figure 18.29. Existing Tags</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/Authoring/TagsEditor/ExistingTags.png" align="middle" alt="Existing Tags"/></div></div></div><br class="figure-break"/></div></div><div class="section" title="18.7.4. Project Explorer"><div class="titlepage"><div><div><h3 class="title"><a id="wb.ProjectExplorer"/>18.7.4. Project Explorer</h3></div></div></div><p>The Project Explorer provides the ability to browse different Organizational Units,
    Repositories, Projects and their files.</p><div class="section" title="18.7.4.1. Initial view"><div class="titlepage"><div><div><h4 class="title"><a id="wb.ProjectExplorerEmpty"/>18.7.4.1. Initial view</h4></div></div></div><p>The initial view could be empty when first opened.</p><div class="figure"><a id="d0e17788"/><p class="title"><strong>Figure 18.30. An empty initial view</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/Authoring/ProjectExplorer/ProjectExplorer-Empty.png" alt="An empty initial view"/></div></div></div><br class="figure-break"/><p>The user may have to select an Organizational Unit, Repository and Project from the
      drop-down boxes.</p><div class="figure"><a id="d0e17796"/><p class="title"><strong>Figure 18.31. Selecting a repository</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/Authoring/ProjectExplorer/ProjectExplorer-Selecting-Repository.png" alt="Selecting a repository"/></div></div></div><br class="figure-break"/><p>The default configuration hides Package details from view.</p><p>In order to reveal packages click on the icon as indicated in the following
      screen-shot.</p><div class="figure"><a id="d0e17806"/><p class="title"><strong>Figure 18.32. Showing packages</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/Authoring/ProjectExplorer/ProjectExplorer-Project-Show-Packages.png" alt="Showing packages"/></div></div></div><br class="figure-break"/><p>After a suitable combination of Organizational Unit, Repository, Project and Package have
      been selected the Project Explorer will show the contents. The exact combination of selections
      depends wholly on the structures defined within the Workbench installation and projects. Each
      section contains groups of related files. If a file is currently being edited by another user,
      a lock symbol will be displayed in front of the file name. The symbol is blue in case the lock
      is owned by the currently authenticated user, otherwise black. Moving the mouse pointer over
      the lock symbol will display a tooltip providing the name of the user who is currently editing
      the file (and therefore owning the lock). To learn more about locking see <a class="xref" href="#wb.AssetEditor" title="18.7.2. Asset Editor">Section 18.7.2, “Asset Editor”</a> for details.</p><div class="figure"><a id="d0e17816"/><p class="title"><strong>Figure 18.33. Expanded asset group</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/Authoring/ProjectExplorer/ProjectExplorer-Project-Expanded.png" alt="Expanded asset group"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.7.4.2. Different views"><div class="titlepage"><div><div><h4 class="title"><a id="wb.ProjectExplorerSwitchingView"/>18.7.4.2. Different views</h4></div></div></div><p>Project Explorer supports multiple views.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Project View</p><p>A simplified view of the underlying project structure. Certain system files are
          hidden from view.</p></li><li class="listitem"><p>Repository View</p><p>A complete view of the underlying project structure including all files; either
          user-defined or system generated.</p></li></ul></div><p>Views can be selected by clicking on the icon within the Project Explorer, as shown
      below.</p><p>Both Project and Repository Views can be further refined by selecting either "Show as Folders" or "Show as
      Links".</p><div class="figure"><a id="d0e17842"/><p class="title"><strong>Figure 18.34. Switching view</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/Authoring/ProjectExplorer/ProjectExplorer-Switching-View.png" alt="Switching view"/></div></div></div><br class="figure-break"/><div class="section" title="18.7.4.2.1. Project View examples"><div class="titlepage"><div><div><h5 class="title"><a id="wb.ProjectExplorerBusinessView"/>18.7.4.2.1. Project View examples</h5></div></div></div><div class="figure"><a id="d0e17851"/><p class="title"><strong>Figure 18.35. Project View - Folders</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/Authoring/ProjectExplorer/ProjectExplorer-Project-Folders.png" alt="Project View - Folders"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e17857"/><p class="title"><strong>Figure 18.36. Project View - Links</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/Authoring/ProjectExplorer/ProjectExplorer-Project-Links.png" alt="Project View - Links"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.7.4.2.2. Repository View examples"><div class="titlepage"><div><div><h5 class="title"><a id="wb.ProjectExplorerTechnicalView"/>18.7.4.2.2. Repository View examples</h5></div></div></div><div class="figure"><a id="d0e17866"/><p class="title"><strong>Figure 18.37. Repository View - Folders</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/Authoring/ProjectExplorer/ProjectExplorer-Repository-Folders.png" alt="Repository View - Folders"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e17872"/><p class="title"><strong>Figure 18.38. Repository View - Links</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/Authoring/ProjectExplorer/ProjectExplorer-Repository-Links.png" alt="Repository View - Links"/></div></div></div><br class="figure-break"/></div></div><div class="section" title="18.7.4.3. Download Project or Repository"><div class="titlepage"><div><div><h4 class="title"><a id="wb.ProjectExplorerDownloads"/>18.7.4.3. Download Project or Repository</h4></div></div></div><p>Download Project and Download Repository make it possible to download the project or repository as a zip file.</p><div class="figure"><a id="d0e17883"/><p class="title"><strong>Figure 18.39. Repository and Project Downloads</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/Authoring/ProjectExplorer/ProjectExplorer-Downloads.png" alt="Repository and Project Downloads"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.7.4.4. Branch selector"><div class="titlepage"><div><div><h4 class="title"><a id="wb.ProjectExplorerBranchSelector"/>18.7.4.4. Branch selector</h4></div></div></div><p>A branch selector will be visible if the repository has more than a single branch.</p><div class="figure"><a id="d0e17894"/><p class="title"><strong>Figure 18.40. Branch selector</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/Authoring/ProjectExplorer/ProjectExplorer-Branch-Selector.png" alt="Branch selector"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.7.4.5. Filtering by Tag"><div class="titlepage"><div><div><h4 class="title"><a id="wb.ProjectExplorerFilteringByTag"/>18.7.4.5. Filtering by Tag</h4></div></div></div><p>To make easy view the elements on packages that contain a lot of assets, is possible to enabling the Tag
      filter, which allows you to filter the assets by their tags.</p><p> To see how to add tags to an asset look at: <a class="xref" href="#wb.TagsEditor" title="18.7.3. Tags Editor">Section 18.7.3, “Tags Editor”</a></p><div class="figure"><a id="d0e17908"/><p class="title"><strong>Figure 18.41. Enabling Filter by Tag</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/Authoring/ProjectExplorer/ProjectExplorer-Tag-Filter-Enable.png" alt="Enabling Filter by Tag"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e17914"/><p class="title"><strong>Figure 18.42. Filter by Tag</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/Authoring/ProjectExplorer/ProjectExplorer-Tag-Filter-Show.png" alt="Filter by Tag"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e17920"/><p class="title"><strong>Figure 18.43. Filtering by Tag</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/Authoring/ProjectExplorer/ProjectExplorer-Tag-Filter-Working.png" alt="Filtering by Tag"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.7.4.6. Copy, Rename, Delete and Download Actions"><div class="titlepage"><div><div><h4 class="title"><a id="wb.ProjectExplorerCopyRenameDeleteActions"/>18.7.4.6. Copy, Rename, Delete and Download Actions</h4></div></div></div><p>Copy, rename and delete actions are available on <span class="italic">Links </span>
      mode, for packages (in of Project View) and for files and directories as well (in Repository
      View). Download action is available for directories. Download downloads the
      selected directory as a zip file.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p> A : Copy</p></li><li class="listitem"><p> B : Rename</p></li><li class="listitem"><p> C : Delete</p></li><li class="listitem"><p> D : Download</p></li></ul></div><div class="figure"><a id="d0e17947"/><p class="title"><strong>Figure 18.44. Project View - Package actions</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/Authoring/ProjectExplorer/ProjectExplorer-Project-Links-Copy-Rename-Delete.png" alt="Project View - Package actions"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e17953"/><p class="title"><strong>Figure 18.45. Repository View - Files and directories actions</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/Authoring/ProjectExplorer/ProjectExplorer-Repository-Copy-Rename-Delete.png" alt="Repository View - Files and directories actions"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.7.4.7. "><div class="titlepage"/><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>Workbench roadmap includes a refactoring and an impact analyses tools, but currently
        doesn't have it. Until both tools are provided make sure that your changes
        (copy/rename/delete) on packages, files or directories don't have a major impact on your
        project.</p><p>In cases that your change had an unexpected impact, Workbench allows you to restore
        your repository using the <a class="link" href="#wb.VFSRepositoryEditor" title="18.3.3.1. Repository Editor">Repository
        editor</a>.</p></div><div class="section" title="18.7.4.7.1. "><div class="titlepage"/><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>Files locked by other users as well as directories that contain such files cannot be
          renamed or deleted until the corresponding locks are released. If that is the case the
          rename and delete symbols will be deactivated. To learn more about locking see <a class="xref" href="#wb.AssetEditor" title="18.7.2. Asset Editor">Section 18.7.2, “Asset Editor”</a> for details.</p><div class="mediaobject"><img src="images/Workbench/Authoring/ProjectExplorer/ProjectExplorer-Delete-NotAllowed.png"/></div></div></div></div></div><div class="section" title="18.7.5. Project Editor"><div class="titlepage"><div><div><h3 class="title"><a id="wb.ProjectEditor"/>18.7.5. Project Editor</h3></div></div></div><p>The Project Editor screen can be accessed from Project Explorer. Project Editor shows the settings for the
    currently active project. </p><p>Unlike most of the workbench editors, project  editor edits more than one file. Showing everything that is
    needed for configuring the KIE project in one place.</p><div class="figure"><a id="d0e17984"/><p class="title"><strong>Figure 18.46. Project Screen and the different views</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/Authoring/ProjectEditor/project_editor_menu.png" align="middle" alt="Project Screen and the different views"/></div></div></div><br class="figure-break"/><div class="section" title="18.7.5.1. Build &amp; Deploy"><div class="titlepage"><div><div><h4 class="title"><a id="d0e17990"/>18.7.5.1. Build &amp; Deploy</h4></div></div></div><p>Build &amp; Depoy builds the current project and deploys the KJAR into the workbench internal
      Maven repository.</p></div><div class="section" title="18.7.5.2. Project Settings"><div class="titlepage"><div><div><h4 class="title"><a id="d0e17995"/>18.7.5.2. Project Settings </h4></div></div></div><p>Project Settings edits the pom.xml file used by Maven.</p><div class="section" title="18.7.5.2.1. Project General Settings"><div class="titlepage"><div><div><h5 class="title"><a id="d0e18000"/>18.7.5.2.1. Project General Settings </h5></div></div></div><p>General settings provide tools for project name and GAV-data (Group, Artifact, Version). GAV values are used as
    identifiers to differentiate projects and versions of the same project.</p><div class="figure"><a id="d0e18005"/><p class="title"><strong>Figure 18.47. Project Settings</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/Authoring/ProjectEditor/general_settings.png" align="middle" alt="Project Settings"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.7.5.2.2. Dependencies"><div class="titlepage"><div><div><h5 class="title"><a id="d0e18011"/>18.7.5.2.2. Dependencies</h5></div></div></div><p>The project may have any number of either internal or external dependencies. Dependency is a project that has
    been built and deployed to a Maven repository. Internal dependencies are projects built and deployed in the same
    workbench as the project. External dependencies are retrieved from repositories outside
    of the current workbench. Each dependency uses the GAV-values to specify the project name and version that is used
    by the project. </p><div class="figure"><a id="d0e18016"/><p class="title"><strong>Figure 18.48. Dependencies</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/Authoring/ProjectEditor/dependencies.png" align="middle" alt="Dependencies"/></div></div></div><br class="figure-break"/><div class="section" title="18.7.5.2.2.1. Package Name White List"><div class="titlepage"><div><div><h6 class="title"><a id="d0e18022"/>18.7.5.2.2.1. Package Name White List</h6></div></div></div><p>
         Classes and declared types in white listed packages show up as Data Objects that can be imported in assets. The full list is stored in package-name-white-list file that is stored in each project root.
      </p><p>
         Package white list has three modes: 
        </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>All packages included: Every package defined in this jar is white listed.</p></li></ul></div><p>  
        </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Packages not included: None of the packages listed in this jar are white listed.</p></li></ul></div><p>
        </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Some packages included: Only part of the packages in the jar are white listed.</p></li></ul></div><p>

      </p></div></div><div class="section" title="18.7.5.2.3. Metadata"><div class="titlepage"><div><div><h5 class="title"><a id="d0e18044"/>18.7.5.2.3. Metadata </h5></div></div></div><p>Metadata for the pom.xml file.</p></div></div><div class="section" title="18.7.5.3. Knowledge Base Settings"><div class="titlepage"><div><div><h4 class="title"><a id="d0e18049"/>18.7.5.3. Knowledge Base Settings</h4></div></div></div><p>Knowledge Base Settings edits the kmodule.xml file used by Drools. </p><div class="figure"><a id="d0e18054"/><p class="title"><strong>Figure 18.49. Knowledge Base Settings</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/Authoring/ProjectEditor/kmodule.png" align="middle" alt="Knowledge Base Settings"/></div></div></div><br class="figure-break"/><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>For more information about the Knowledge Base properties, check the Drools Expert documentation for
        kmodule.xml.</p></div><div class="section" title="18.7.5.3.1. Knowledge bases and sessions"><div class="titlepage"><div><div><h5 class="title"><a id="d0e18063"/>18.7.5.3.1. Knowledge bases and sessions </h5></div></div></div><p>Knowledge bases and sessions lists the knowledge bases and the knowledge sessions specified for the project. </p><div class="section" title="18.7.5.3.1.1. Knowledge base list"><div class="titlepage"><div><div><h6 class="title"><a id="d0e18068"/>18.7.5.3.1.1. Knowledge base list</h6></div></div></div><p>Lists all the knowledge bases by name. Only one knowledge base can be set as default. </p></div><div class="section" title="18.7.5.3.1.2. Knowledge base properties"><div class="titlepage"><div><div><h6 class="title"><a id="d0e18073"/>18.7.5.3.1.2. Knowledge base properties</h6></div></div></div><p>Knowledge base can include other knowledge bases. The models, rules and any other content in the included
        knowledge base will be visible and usable by the currently selected knowledge base.</p><p>Rules and models are stored in packages. The packages property specifies what packages are included into
        this knowledge base.</p><p>Equals behavior is explained in the Drools Expert part of the documentation.</p><p>Event processing mode is explained in the Drools Fusion part of the documentation. </p></div><div class="section" title="18.7.5.3.1.3. Knowledge sessions"><div class="titlepage"><div><div><h6 class="title"><a id="d0e18084"/>18.7.5.3.1.3. Knowledge sessions</h6></div></div></div><p>The table lists all the knowledge sessions in the selected knowledge base. There can be only one default of
        each type. The types are stateless and stateful. Clicking the pen-icon opens a popup that shows more properties
        for the knowledge session.</p></div></div><div class="section" title="18.7.5.3.2. Metadata"><div class="titlepage"><div><div><h5 class="title"><a id="d0e18089"/>18.7.5.3.2. Metadata </h5></div></div></div><p>Metadata for the kmodule.xml</p></div></div><div class="section" title="18.7.5.4. Imports"><div class="titlepage"><div><div><h4 class="title"><a id="d0e18094"/>18.7.5.4. Imports </h4></div></div></div><p>Settings edits the project.imports file used by the workbench editors.</p><div class="figure"><a id="d0e18099"/><p class="title"><strong>Figure 18.50. Imports</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/Authoring/ProjectEditor/ExternalDataObjects.png" align="middle" alt="Imports"/></div></div></div><br class="figure-break"/><div class="section" title="18.7.5.4.1. External Data Objects"><div class="titlepage"><div><div><h5 class="title"><a id="d0e18105"/>18.7.5.4.1. External Data Objects </h5></div></div></div><p>Data Objects provided by the Java Runtime environment may need to be registered to be available to rule authoring where such 
      Data Objects are not implicitly available as part of an existing Data Object defined within the Workbench or a Project dependency. 
      For example an Author may want to define a rule that checks for <code class="code">java.util.ArrayList</code> in Working Memory. If a domain Data
      Object has a field of type <code class="code">java.util.ArrayList</code> there is no need create a registration.</p></div><div class="section" title="18.7.5.4.2. Metadata"><div class="titlepage"><div><div><h5 class="title"><a id="d0e18116"/>18.7.5.4.2. Metadata</h5></div></div></div><p>Metadata for the project.imports file.</p></div></div><div class="section" title="18.7.5.5. Duplicate GAV detection"><div class="titlepage"><div><div><h4 class="title"><a id="d0e18121"/>18.7.5.5. Duplicate GAV detection</h4></div></div></div><p>When performing any of the following operations a check is now made against all Maven Repositories, resolved for the Project, 
      for whether the Project's GroupId, ArtifactId and Version pre-exist. If a clash is found the operation is prevented; although this can be overridden by Users
      with the <code class="code">admin</code> role.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The feature can be disabled by setting the System Property <code class="code">org.guvnor.project.gav.check.disabled</code> to <code class="code">true</code>.</p></div><p>Resolved repositories are those discovered in:-
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The Project's <code class="code">POM</code> <code class="code">&lt;repositories&gt;</code> section (or any parent <code class="code">POM</code>).</p></li><li class="listitem"><p>The Project's <code class="code">POM</code> <code class="code">&lt;distributionManagement&gt;</code> section.</p></li><li class="listitem"><p>Maven's global <code class="code">settings.xml</code> configuration file.</p></li></ul></div><p>
    </p><p>Affected operations:-
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Creation of new Managed Repositories.</p></li><li class="listitem"><p>Saving a Project defintion with the Project Editor.</p></li><li class="listitem"><p>Adding new Modules to a Managed Multi-Module Repository.</p></li><li class="listitem"><p>Saving the <code class="code">pom.xml</code> file.</p></li><li class="listitem"><p>Build &amp; installing a Project with the Project Editor.</p></li><li class="listitem"><p>Build &amp; deploying a Project with the Project Editor.</p></li><li class="listitem"><p>Asset Management operations building, installing or deploying Projects.</p></li><li class="listitem"><p><code class="code">REST</code> operations creating, installing or deploying Projects.</p></li></ul></div><p>
    </p><p>Users with the <code class="code">Admin</code> role can override the list of Repositories checked using the "Repositories" settings in the Project Editor.</p><div class="figure"><a id="d0e18207"/><p class="title"><strong>Figure 18.51. Project Editor - Viewing resolved Repositories</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/MavenRepositories1.png" alt="Project Editor - Viewing resolved Repositories"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e18214"/><p class="title"><strong>Figure 18.52. Project Editor - The list of resolved Repositories</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/MavenRepositories2.png" alt="Project Editor - The list of resolved Repositories"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e18221"/><p class="title"><strong>Figure 18.53. Duplicate GAV detected</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/ReleaseNotes/MavenRepositories3.png" alt="Duplicate GAV detected"/></div></div></div></div><br class="figure-break"/></div></div><div class="section" title="18.7.6. Validation"><div class="titlepage"><div><div><h3 class="title"><a id="wb.Validation"/>18.7.6. Validation</h3></div></div></div><p>The Workbench provides a common and consistent service for users to understand whether files authored within the environment are valid.</p><div class="section" title="18.7.6.1. Problem Panel"><div class="titlepage"><div><div><h4 class="title"><a id="wb.ProblemsPanel"/>18.7.6.1. Problem Panel</h4></div></div></div><p>The Problems Panel shows real-time validation results of assets within a Project.</p><p>When a Project is selected from the Project Explorer the Problems Panel will refresh with validation results of the chosen Project.</p><p>When files are created, saved or deleted the Problems Panel content will update to show either new validation errors, or remove existing if a file was deleted.</p><div class="figure"><a id="d0e18242"/><p class="title"><strong>Figure 18.54. The Problems Panel</strong></p><div class="figure-contents"><p>Here an invalid DRL file has been created and saved.</p><p>The Problems Panel shows the validation errors.</p><div class="mediaobject" align="center"><img src="images/Workbench/Authoring/Validation/workbench-problems-panel.png" align="middle" alt="The Problems Panel"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.7.6.2. On demand validation"><div class="titlepage"><div><div><h4 class="title"><a id="wb.OnDemandValidation"/>18.7.6.2. On demand validation</h4></div></div></div><p>It is not always desirable to save a file in order to determine whether it is in a valid state.</p><p>All of the file editors provide the ability to validate the content before it is saved.</p><p>Clicking on the 'Validate' button shows validation errors, if any.</p><div class="mediaobject" align="center"><img src="images/Workbench/Authoring/Validation/workbench-validation.png" align="middle"/></div></div></div><div class="section" title="18.7.7. Data Modeller"><div class="titlepage"><div><div><h3 class="title"><a id="wb.DataModeller"/>18.7.7. Data Modeller</h3></div></div></div><div class="section" title="18.7.7.1. First steps to create a data model"><div class="titlepage"><div><div><h4 class="title"><a id="sect-datamodeler-firstSteps"/>18.7.7.1. First steps to create a data model</h4></div></div></div><p>By default, a data model is always constrained to the context of a
    project. For the purpose of this tutorial, we will assume that a correctly
    configured project already exists and the authoring perspective is open.
  </p><p>To start the creation of a data model inside a project, take the
    following steps:
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>From the home panel, select the authoring perspective and use the project explorer to browse to the given project.
      </p><div class="figure"><a id="d0e18278"/><p class="title"><strong>Figure 18.55. Go to authoring perspective and select a project</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/authoring.jpg" alt="Go to authoring perspective and select a project"/></div></div></div></div><br class="figure-break"/><p/></li><li class="listitem"><p>Open the Data Modeller tool by clicking on a Data Object file, or using the "New Item -&gt; Data Object" menu option.
      </p><div class="figure"><a id="d0e18289"/><p class="title"><strong>Figure 18.56. Click on a Data Object</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/open_data_model.jpg" alt="Click on a Data Object"/></div></div></div></div><br class="figure-break"/><p/></li></ol></div><p>This will start up the Data Modeller tool, which has the following
    general aspect:
  </p><div class="figure"><a id="d0e18299"/><p class="title"><strong>Figure 18.57. Data modeller overview</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/overview.png" alt="Data modeller overview"/></div></div></div></div><br class="figure-break"/><p/><p>The "Editor" tab is divided into the following sections:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The new field section is dedicated to the creation of new fields, and is opened when the "add field" button is pressed.
      </p><div class="figure"><a id="d0e18313"/><p class="title"><strong>Figure 18.58. New field creation</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/create-new-field.png" alt="New field creation"/></div></div></div></div><br class="figure-break"/><p/></li><li class="listitem"><p>The Data Object's "field browser" section displays a list with the data object fields.
      </p><div class="figure"><a id="d0e18324"/><p class="title"><strong>Figure 18.59. The Data Object's field browser</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/data-object-field-browser.png" alt="The Data Object's field browser"/></div></div></div></div><br class="figure-break"/><p/></li><li class="listitem"><p>The "Data Object / Field general properties" section.
        This is the rightmost section of the Data Modeller editor and visualizes the "Data Object" or "Field" general
        properties, depending on user selection.
      </p><p>Data Object general properties can be selected by clicking on the Data Object Selector.</p><div class="figure"><a id="d0e18337"/><p class="title"><strong>Figure 18.60. Data Object selector</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/data-object-selector.png" alt="Data Object selector"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e18344"/><p class="title"><strong>Figure 18.61. Data Object general properties</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/data-object-general-properties.png" alt="Data Object general properties"/></div></div></div></div><br class="figure-break"/><p>Field general properties can be selected by clicking on a field.</p><p/><div class="figure"><a id="d0e18354"/><p class="title"><strong>Figure 18.62. Field selector</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/field-selector.png" alt="Field selector"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e18361"/><p class="title"><strong>Figure 18.63. Field general properties</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/field-general-properties.png" alt="Field general properties"/></div></div></div></div><br class="figure-break"/></li><li class="listitem"><p>On workbench's right side a new "Tool Bar" is provided that enables the selection of different context sensitive
        tool windows that will let the user do domain specific configurations.
        Currently four tool windows are provided for the following domains "Drools &amp; jBPM", "OptaPlanner", "Persistence" and "Advanced"
        configurations.
      </p><div class="figure"><a id="d0e18371"/><p class="title"><strong>Figure 18.64. Data modeller Tool Bar</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/tool-window-selector.png" alt="Data modeller Tool Bar"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e18378"/><p class="title"><strong>Figure 18.65. Drools &amp; jBPM tool window</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/data-object-drools-tool-window.png" alt="Drools &amp; jBPM tool window"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e18385"/><p class="title"><strong>Figure 18.66. OptaPlanner tool window</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/data-object-optaplanner-tool-window.png" alt="OptaPlanner tool window"/></div></div></div></div><br class="figure-break"/><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>To see and use the OptaPlanner tool window, the user needs to have the role <code class="literal">plannermgmt</code>.</p></div><div class="figure"><a id="d0e18398"/><p class="title"><strong>Figure 18.67. Persistence tool window</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/data-object-persistence-tool-window.png" alt="Persistence tool window"/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e18405"/><p class="title"><strong>Figure 18.68. Advanced tool window</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/data-object-or-field-advanced-tool-window.png" alt="Advanced tool window"/></div></div></div></div><br class="figure-break"/></li></ul></div><p/><p>The "Source" tab shows an editor that allows the visualization and modification of the
    generated java code.
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Round trip between the "Editor" and "Source" tabs is possible, and also source code preservation
      is provided. It means that no matter where the Java code was generated (e.g. Eclipse, Data modeller), the data modeller
      will only update the necessary code blocks to maintain the model updated.
    </p><div class="figure"><a id="d0e18419"/><p class="title"><strong>Figure 18.69. Source editor</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/source-editor-tab.png" alt="Source editor"/></div></div></div></div><br class="figure-break"/></li></ul></div><p>The "Overview" tab shows the standard metadata and version information as the other workbench editors.
  </p></div><div class="section" title="18.7.7.2. Data Objects"><div class="titlepage"><div><div><h4 class="title"><a id="sect-datamodeler-entities"/>18.7.7.2. Data Objects</h4></div></div></div><p>A data model consists of data objects which are a logical
    representation of some real-world data. Such data objects have a fixed set
    of modeller (or application-owned) properties, such as its internal
    identifier, a label, description, package etc. Besides those, a data object also
    has a variable set of user-defined fields, which are an abstraction of a
    real-world property of the type of data that this logical data object
    represents.
  </p><p>Creating a data object can be achieved using the workbench "New Item - Data Object" menu option.

  </p><div class="figure"><a id="d0e18435"/><p class="title"><strong>Figure 18.70. New Data Object menu option</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/create-new-data-object.png" alt="New Data Object menu option"/></div></div></div></div><br class="figure-break"/><p/><p>Both resource name and location are mandatory parameters. When the "Ok" button is pressed a new Java file will
    be created and a new editor instance will be opened for the file edition.
    The optional "Persistable" attribute will add by default configurations on the data object in order to make it a
    JPA entity. Use this option if your jBPM project needs to store data object's information in a data base.
  </p><p/></div><div class="section" title="18.7.7.3. Properties &amp; relationships"><div class="titlepage"><div><div><h4 class="title"><a id="sect-datamodeler-propertyRelationships"/>18.7.7.3. Properties &amp; relationships</h4></div></div></div><p>Once the data object has been created, it now has to be completed by
    adding user-defined properties to its definition. This can be achieved by
    pressing the "add field" button. The "New Field" dialog will be opened and the
    new field can be created by pressing the "Create" button. The "Create and continue" button
    will also add the new field to the Data Object, but won't close the dialog. In this way multiple fields
    can be created avoiding the popup opening multiple times.

    The following fields can (or must) be filled out:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The field's internal identifier (mandatory). The value of this
        field must be unique per data object, i.e. if the proposed identifier
        already exists within current data object, an error message will be
        displayed.
      </p></li><li class="listitem"><p>A label (optional): as with the data object definition, the user can
        define a user-friendly label for the data object field which is
        about to be created. This has no further implications on how fields
        from objects of this data object will be treated. If a label is defined, then
        this is how the field will be displayed throughout the data modeller
        tool.
      </p></li><li class="listitem"><p>A field type (mandatory): each data object field needs to be
        assigned with a type.
      </p><p>This type can be either of the following:</p><p/><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>A 'primitive java object' type: these include most of the object
            equivalents of the standard Java primitive types, such as Boolean,
            Short, Float, etc, as well as String, Date, BigDecimal and
            BigInteger.
          </p><div class="figure"><a id="d0e18468"/><p class="title"><strong>Figure 18.71. Primitive object field types</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/create-field-with-primitive-type.png" alt="Primitive object field types"/></div></div></div></div><br class="figure-break"/><p/><p/></li><li class="listitem"><p>A 'data object' type: any user defined data object automatically
            becomes a candidate to be defined as a field type of another
            data object, thus enabling the creation of relationships between
            them. A data object field can be created either in 'single'
            or in 'multiple' form, the latter implying that the field will
            be defined as a collection of this type, which will be indicated by
            selecting "List" checkbox.
          </p><div class="figure"><a id="d0e18480"/><p class="title"><strong>Figure 18.72. Data object field types</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/types_entity.jpg" alt="Data object field types"/></div></div></div></div><br class="figure-break"/><p/><p/></li><li class="listitem"><p>A 'primitive java' type: these include java primitive types byte, short, int, long, float, double, char
            and boolean.
          </p><div class="figure"><a id="d0e18492"/><p class="title"><strong>Figure 18.73. Primitive field types</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/types_primitive.jpg" alt="Primitive field types"/></div></div></div></div><br class="figure-break"/><p/><p/></li></ol></div></li></ul></div><p>When finished introducing the initial information for a new field,
    clicking the 'Create' button will add the newly created field to the end
    of the data object's fields table below:
  </p><div class="figure"><a id="d0e18503"/><p class="title"><strong>Figure 18.74. New field has been created</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/new-field-was-created.png" alt="New field has been created"/></div></div></div></div><br class="figure-break"/><p/><p>The new field will also automatically be selected in the data object's
    field list, and its properties will be shown in the Field general properties editor.
    Additionally the field properties will be loaded in the different tool windows, in this way
    the field will be ready for edition in whatever selected tool window.
  </p><p>At any time, any field (without restrictions) can be deleted from
    a data object definition by clicking on the corresponding 'x' icon in the
    data object's fields table.
  </p><p/></div><div class="section" title="18.7.7.4. Additional options"><div class="titlepage"><div><div><h4 class="title"><a id="sect-datamodeler-additionalOptions"/>18.7.7.4. Additional options</h4></div></div></div><p>As stated before, both Data Objects as well as Fields require
    some of their initial properties to be set upon creation. Additionally there are three domains of properties that
    can be configured for a given Data Object. A domain is basically a set of properties related to a given business area.
    Current available domains are, "Drools &amp; jJBPM", "Persistence" and the "Advanced" domain.
    To work on a given domain the user should select the corresponding "Tool window" (see below) on the right side toolbar.
    Every tool window usually provides two editors, the "Data Object" level editor and the "Field" level editor, that will
    be shown depending on the last selected item, the Data Object or the Field.
  </p><div class="section" title="18.7.7.4.1. Drools &amp; jBPM domain"><div class="titlepage"><div><div><h5 class="title"><a id="d0e18521"/>18.7.7.4.1. Drools &amp; jBPM domain</h5></div></div></div><p>The Drools &amp; jBPM domain editors manages the set of Data Object or Field properties related to
    drools applications.</p><div class="section" title="18.7.7.4.1.1. Drools &amp; jBPM object editor"><div class="titlepage"><div><div><h6 class="title"><a id="d0e18526"/>18.7.7.4.1.1. Drools &amp; jBPM object editor</h6></div></div></div><p>The Drools &amp; jBPM object editor manages the object level drools properties</p><div class="figure"><a id="d0e18531"/><p class="title"><strong>Figure 18.75. The data object's properties</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/data-object-drools-tool-window.png" alt="The data object's properties"/></div></div></div></div><br class="figure-break"/><p/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>TypeSafe: this property allows to enable/disable the type safe behaviour for current type.
            By default all type declarations are compiled with type safety enabled. (See Drools for more information
            on this matter).
          </p></li><li class="listitem"><p>ClassReactive: this property allows to mark this type to be treated as "Class Reactive" by the Drools engine.
            (See Drools for more information on this matter).
          </p></li><li class="listitem"><p>PropertyReactive: this property allows to mark this type to be treated as "Property Reactive" by the Drools engine.
            (See Drools for more information on this matter).
          </p></li><li class="listitem"><p>Role: this property allows to configure how the Drools engine should handle instances of this type: either as
            regular facts or as events. By default all types are handled as a regular fact, so for the time being the
            only value that can be set is "Event" to declare that this type should be handled as an event.
            (See Drools Fusion for more information on this matter).
          </p></li><li class="listitem"><p>Timestamp: this property allows to configure the "timestamp" for an event, by selecting one of his attributes.
            If set the engine will use the timestamp from the given attribute instead of reading it from the Session Clock.
            If not, the engine will automatically assign a timestamp to the event.
            (See Drools Fusion for more information on this matter).
          </p></li><li class="listitem"><p>Duration: this property allows to configure the "duration" for an event, by selecting one of his attributes.
            If set the engine will use the duration from the given attribute instead of using the default event duration = 0.
            (See Drools Fusion for more information on this matter).
          </p></li><li class="listitem"><p>Expires: this property allows to configure the "time offset" for an event expiration.
            If set, this value must be a temporal interval in the form: [#d][#h][#m][#s][#[ms]] Where [ ] means an
            optional parameter and # means a numeric value.
            e.g.: 1d2h, means one day and two hours.
            (See Drools Fusion for more information on this matter).
          </p></li><li class="listitem"><p>Remotable: If checked this property makes the Data Object available to be used with jBPM remote services as
            REST, JMS and WS. (See jBPM for more information on this matter).
          </p><p/></li></ul></div></div><div class="section" title="18.7.7.4.1.2. Drools &amp; jJBPM field editor"><div class="titlepage"><div><div><h6 class="title"><a id="d0e18565"/>18.7.7.4.1.2. Drools &amp; jJBPM field editor</h6></div></div></div><p>The Drools &amp; jBPM object editor manages the field level drools properties</p><div class="figure"><a id="d0e18570"/><p class="title"><strong>Figure 18.76. The data object's field properties</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/field-drools-tool-window.png" alt="The data object's field properties"/></div></div></div></div><br class="figure-break"/><p/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Equals: checking this property for a Data Object field implies
            that it will be taken into account, at the code generation level, for
            the creation of both the equals() and hashCode() methods in the
            generated Java class. We will explain this in more detail in the
            following section.
          </p></li><li class="listitem"><p>Position: this field requires a zero or positive integer. When
            set, this field will be interpreted by the Drools engine as a
            positional argument (see the section below and also the Drools
            documentation for more information on this subject).
          </p></li></ul></div></div></div><div class="section" title="18.7.7.4.2. Persistence domain"><div class="titlepage"><div><div><h5 class="title"><a id="d0e18585"/>18.7.7.4.2. Persistence domain</h5></div></div></div><p>The Persistence domain editors manages the set of Data Object or Field properties related to persistence.</p><div class="section" title="18.7.7.4.2.1. Persistence domain object editor"><div class="titlepage"><div><div><h6 class="title"><a id="d0e18590"/>18.7.7.4.2.1. Persistence domain object editor</h6></div></div></div><p>Persistence domain object editor manages the object level persistence properties</p><div class="figure"><a id="d0e18595"/><p class="title"><strong>Figure 18.77. The data object's properties</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/data-object-persistence-tool-window.png" alt="The data object's properties"/></div></div></div></div><br class="figure-break"/><p/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Persistable: this property allows to configure current Data Object as persistable.</p></li><li class="listitem"><p>Table name: this property allows to set a user defined database table name for current Data Object.</p></li></ul></div></div><div class="section" title="18.7.7.4.2.2. Persistence domain field editor"><div class="titlepage"><div><div><h6 class="title"><a id="d0e18610"/>18.7.7.4.2.2. Persistence domain field editor</h6></div></div></div><p>The persistence domain field editor manages the field level persistence properties and is divided in
        three sections.</p><div class="figure"><a id="d0e18615"/><p class="title"><strong>Figure 18.78. Persistence domain field editor sections</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/field-persistence-tool-window-sections.png" alt="Persistence domain field editor sections"/></div></div></div></div><br class="figure-break"/><p/><div class="section" title="18.7.7.4.2.2.1. Identifier:"><div class="titlepage"><div><div><h6 class="title"><a id="d0e18623"/>18.7.7.4.2.2.1. Identifier:</h6></div></div></div><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/field-persistence-tool-window-sections-identifier.png"/></div></div><p>A persistable Data Object should have one and only one field defined as the Data Object identifier. The identifier
          is typically a unique number that distinguishes a given Data Object instance from all other instances of the same class.
        </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Is Identifier: marks current field as the Data Object identifier.
              A persistable Data Object should have one and only one field marked as identifier, and it should be a base java type,
              like String, Integer, Long, etc.
              A field that references a Data Object, or is a multiple field can not be marked as identifier. And also
              composite identifiers are not supported in this version.
              When a persistable Data Object is created an identifier field is created by default with the properly initializations,
              it's strongly recommended to use this identifier.
            </p></li><li class="listitem"><p>Generation Strategy: the generation strategy establishes how the identifier values will be automatically
              generated when the Data Object instances are created and stored in a database. (e.g. by the forms associated to jBPM processes human tasks.)
              When the by default Identifier field is created, the generation strategy will be also automatically set
              and it's strongly recommended to use this configuration.
            </p></li><li class="listitem"><p>Sequence Generator: the generator represents the seed for the values that will be used by the Generation Strategy.
              When the by default Identifier field is created the Sequence Generator will be also automatically generated
              and properly configured to be used by the Generation Strategy.
            </p></li></ul></div></div><div class="section" title="18.7.7.4.2.2.2. Column Properties:"><div class="titlepage"><div><div><h6 class="title"><a id="d0e18642"/>18.7.7.4.2.2.2. Column Properties:</h6></div></div></div><p>
          The column properties section enables the customization of some properties of the database column that will
          store the field value.
        </p><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/field-persistence-tool-window-sections-column.png"/></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Column name: optional value that sets the database column name for the given field.
            </p></li><li class="listitem"><p>Unique: When checked the unique property establishes that current field value should be a unique
              key when stored in the database. (if not set the default value is false)
            </p></li><li class="listitem"><p>Nullable: When checked establishes that current field value can be null when stored in a database.
              (if not set the default value is true)
            </p></li><li class="listitem"><p>Insertable: When checked establishes that column will be included in SQL INSERT statements generated
              by the persistence provider. (if not set the default value is true)
            </p></li><li class="listitem"><p>Updatable: When checked establishes that the column will be included SQL UPDATE statements generated
              by the persistence provider. (if not set the default value is true)
            </p></li></ul></div></div><div class="section" title="18.7.7.4.2.2.3. Relationship Properties:"><div class="titlepage"><div><div><h6 class="title"><a id="d0e18667"/>18.7.7.4.2.2.3. Relationship Properties:</h6></div></div></div><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/field-persistence-tool-window-sections-relationship.png"/></div></div><p>
        When the field's type is a Data Object type, or a list of a Data Object type a relationship type should be
        set in order to let the persistence provider to manage the relation. Fortunately this relation type is
        automatically set when such kind of fields are added to an already marked as persistable Data Object.
        The relationship type is set by the following popup.
      </p><div class="figure"><a id="d0e18676"/><p class="title"><strong>Figure 18.79. Relationship configuration popup</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/field-persistence-tool-window-sections-relationship-dialog.png" alt="Relationship configuration popup"/></div></div></div></div><br class="figure-break"/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Relationship type: sets the type of relation from one of the following options:
          </p><p>
            One to one: typically used for 1:1 relations where "A is related to one instance of B", and B exists only when A exists.
            e.g. PurchaseOrder -&gt; PurchaseOrderHeader (a PurchaseOrderHeader exists only if the PurchaseOrder exists)
          </p><p>
            One to many: typically used for 1:N relations where "A is related to N instances of B", and the related
            instances of B exists only when A exists.
            e.g. PurchaseOrder -&gt; PurchaseOrderLine (a PurchaseOrderLine exists only if the PurchaseOrder exists)
          </p><p>
            Many to one: typically used for 1:1 relations where "A is related to one instance of B", and B can exist even without A.
            e.g. PurchaseOrder -&gt; Client (a Client can exist in the database even without an associated PurchaseOrder)
          </p><p>
            Many to many: typically used for N:N relations where "A can be related to N instances of B, and B can be
            related to M instances of A at the same time", and both B an A instances can exits in the database independently
            of the related instances.
            e.g. Course -&gt; Student. (Course can be related to N Students, and a given Student can attend to M courses)
          </p><p>
            When a field of type "Data Object" is added to a given persistable Data Object, the "Many to One" relationship type is generated by default.
          </p><p>
            And when a field of type "list of Data Object" is added to a given persistable Data Object , the "One to Many" relationship
            is generated by default.
          </p></li><li class="listitem"><p>Cascade mode: Defines the set of cascadable operations that are propagated to the associated entity.
            The value cascade=ALL is equivalent to cascade={PERSIST, MERGE, REMOVE, REFRESH}.
            e.g. when A -&gt; B, and cascade "PERSIST or ALL" is set, if A is saved, then B will be also saved.
          </p><p>
            The by default cascade mode created by the data modeller is "ALL" and it's strongly recommended to use this
            mode when Data Objects are being used by jBPM processes and forms.
          </p></li><li class="listitem"><p>Fetch mode: Defines how related data will be fetched from database at reading time.
          </p><p>
            EAGER: related data will be read at the same time. e.g. If A -&gt; B, when A is read from database B will be
            read at the same time.
          </p><p>
            LAZY: reading of related data will be delayed usually to the moment they are required. e.g. If PurchaseOrder -&gt; PurchaseOrderLine
            the lines reading will be postponed until a method "getLines()" is invoked on a PurchaseOrder instance.
          </p><p>
            The default fetch mode created by the data modeller is "EAGER" and it's strongly recommended to use this
            mode when Data Objects are being used by jBPM processes and forms.
          </p></li><li class="listitem"><p>Optional: establishes if the right side member of a relationship can be null.
          </p></li><li class="listitem"><p>Mapped by: used for reverse relations.
          </p></li></ul></div></div></div></div><div class="section" title="18.7.7.4.3. Advanced domain"><div class="titlepage"><div><div><h5 class="title"><a id="d0e18719"/>18.7.7.4.3. Advanced domain</h5></div></div></div><p>The advanced domain enables the configuration of whatever parameter set by the other domains as well as
      the adding of arbitrary parameters. As it will be shown in the code generation section every "Data Object / Field"
      parameter is represented by a java annotation. The advanced mode enables the configuration of this annotations.</p><div class="section" title="18.7.7.4.3.1. Advanced domain Data Object / Field editor."><div class="titlepage"><div><div><h6 class="title"><a id="d0e18724"/>18.7.7.4.3.1. Advanced domain Data Object / Field editor.</h6></div></div></div><p>The advanced domain editor has the same shape for both Data Object and Field.</p><div class="figure"><a id="d0e18729"/><p class="title"><strong>Figure 18.80. Advanced domain editor.</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/data-object-or-field-advanced-tool-window.png" alt="Advanced domain editor."/></div></div></div></div><br class="figure-break"/><p/><p>The following operations are available</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>delete: enables the deletion of a given Data Object or Field annotation.
          </p></li><li class="listitem"><p>clear: clears a given annotation parameter value.
          </p></li><li class="listitem"><p>edit: enables the edition of a given annotation parameter value.
          </p></li><li class="listitem"><p>add annotation: The add annotation button will start a wizard that will let the addition of whatever
            java annotation available in the project dependencies.
          </p><p>
            Add annotation wizard step #1: the first step of the wizard requires the entering of a fully qualified class
            name of an annotation, and by pressing the "search" button the annotation definition will be loaded into the wizard.
            Additionally when the annotation definition is loaded, different wizard steps will be created in order to
            enable the completion of the different annotation parameters. Required parameters will be marked with "*".
          </p><div class="figure"><a id="d0e18754"/><p class="title"><strong>Figure 18.81. 
              Annotation definition loaded into the wizard.
            </strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/add-annotation-wizard-step1-annotation-loaded.png" alt="Annotation definition loaded into the wizard."/></div></div></div></div><br class="figure-break"/><p>Whenever it's possible the wizard will provide a suitable editor for the given parameters.
          </p><div class="figure"><a id="d0e18763"/><p class="title"><strong>Figure 18.82. 
              Automatically generated enum values editor for an Enumeration annotation parameter.
            </strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/add-annotation-wizard-step2-enum-param-editor.png" alt="Automatically generated enum values editor for an Enumeration annotation parameter."/></div></div></div></div><br class="figure-break"/><p>A generic parameter editor will be provided when it's not possible to calculate a customized editor</p><div class="figure"><a id="d0e18772"/><p class="title"><strong>Figure 18.83. 
              Generic annotation parameter editor
            </strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/add-annotation-wizard-step2-generic-param-editor.png" alt="Generic annotation parameter editor"/></div></div></div></div><br class="figure-break"/><p>When all required parameters have been entered and validated, the finish button will be enabled and the wizard can be completed by adding the annotation to the given Data Object or Field.
          </p></li></ul></div></div></div></div><div class="section" title="18.7.7.5. Generate data model code."><div class="titlepage"><div><div><h4 class="title"><a id="sect-datamodeler-generateCode"/>18.7.7.5. Generate data model code.</h4></div></div></div><p>The data model in itself is merely a visual tool that allows the user
    to define high-level data structures, for them to interact with the Drools
    Engine on the one hand, and the jBPM platform on the other. In order for
    this to become possible, these high-level visual structures have to be
    transformed into low-level artifacts that can effectively be consumed by
    these platforms. These artifacts are Java POJOs (Plain Old Java Objects),
    and they are generated every time the data model is saved, by pressing the
    "Save" button in the top Data Modeller Menu. Additionally when the user round trip
    between the "Editor" and "Source" tab, the code is auto generated to maintain the consistency
    with the Editor view and vice versa.
  </p><div class="figure"><a id="d0e18786"/><p class="title"><strong>Figure 18.84. Save the data model from the top menu</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/save_top.jpg" alt="Save the data model from the top menu"/></div></div></div></div><br class="figure-break"/><p/><p>The resulting code is generated according to the following transformation rules:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The data object's identifier property will become the Java class's
        name. It therefore needs to be a valid Java identifier.
      </p></li><li class="listitem"><p>The data object's package property becomes the Java class's package
        declaration.
      </p></li><li class="listitem"><p>The data object's superclass property (if present) becomes the Java
        class's extension declaration.
      </p></li><li class="listitem"><p>The data object's label and description properties will translate into
        the Java annotations
        "@org.kie.api.definition.type.Label" and
        "@org.kie.api.definition.type.Description",
        respectively. These annotations are merely a way of preserving the
        associated information, and as yet are not processed any further.
      </p></li><li class="listitem"><p>The data object's role property (if present) will be translated into
        the "@org.kie.api.definition.type.Role" Java annotation, that
        <span class="emphasis"><em>IS</em></span>
        interpreted by the application platform, in the
        sense that it marks this Java class as a Drools Event Fact-Type.
      </p></li><li class="listitem"><p>The data object's type safe property (if present) will be translated into
        the "@org.kie.api.definition.type.TypeSafe Java annotation.
        (see Drools)
      </p></li><li class="listitem"><p>The data object's class reactive property (if present) will be translated into
        the "@org.kie.api.definition.type.ClassReactive Java annotation.
        (see Drools)
      </p></li><li class="listitem"><p>The data object's property reactive property (if present) will be translated into
        the "@org.kie.api.definition.type.PropertyReactive Java annotation.
        (see Drools)
      </p></li><li class="listitem"><p>The data object's timestamp property (if present) will be translated into
        the "@org.kie.api.definition.type.Timestamp Java annotation.
        (see Drools)
      </p></li><li class="listitem"><p>The data object's duration property (if present) will be translated into
        the "@org.kie.api.definition.type.Duration Java annotation.
        (see Drools)
      </p></li><li class="listitem"><p>The data object's expires property (if present) will be translated into
        the "@org.kie.api.definition.type.Expires Java annotation.
        (see Drools)
      </p></li><li class="listitem"><p>The data object's remotable property (if present) will be translated into
        the "@org.kie.api.remote.Remotable Java annotation.
        (see jBPM)
      </p></li></ul></div><p/><p>A standard Java default (or no parameter) constructor is generated, as
    well as a full parameter constructor, i.e. a constructor that accepts as
    parameters a value for each of the data object's user-defined fields.
  </p><p>The data object's user-defined fields are translated into Java class
    fields, each one of them with its own getter and setter method, according to
    the following transformation rules:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The data object field's identifier will become the Java field
        identifier. It therefore needs to be a valid Java identifier.
      </p></li><li class="listitem"><p>The data object field's type is directly translated into the Java
        class's field type. In case the field was declared to be
        multiple (i.e. 'List'), then the generated field is of the
        "java.util.List" type.
      </p></li><li class="listitem"><p>The equals property: when it is set for a specific field, then
        this class property will be annotated with the
        "@org.kie.api.definition.type.Key" annotation, which is interpreted by
        the Drools Engine, and it will 'participate' in the generated equals()
        method, which overwrites the equals() method of the Object class. The
        latter implies that if the field is a 'primitive' type, the equals
        method will simply compare its value with the value of the
        corresponding field in another instance of the class. If the
        field is a sub-entity or a collection type, then the equals method
        will make a method-call to the equals method of the corresponding
        data object's Java class, or of the java.util.List standard Java class,
        respectively.
      </p><p>If the equals property is checked for
        <span class="emphasis"><em>ANY</em></span>
        of
        the data object's user defined fields, then this also implies that in
        addition to the default generated constructors another constructor is
        generated, accepting as parameters all of the fields that were
        marked with Equals. Furthermore, generation of the equals() method also
        implies that also the Object class's hashCode() method is overwritten,
        in such a manner that it will call the hashCode() methods of the
        corresponding Java class types (be it 'primitive' or user-defined types)
        for all the fields that were marked with Equals in the Data
        Model.
      </p></li><li class="listitem"><p>The position property: this field property is automatically set
        for all user-defined fields, starting from 0, and incrementing by 1
        for each subsequent new field. However the user can freely change
        the position among the fields. At code generation time this property
        is translated into the "@org.kie.api.definition.type.Position"
        annotation, which can be interpreted by the Drools Engine. Also, the
        established property order determines the order of the constructor
        parameters in the generated Java class.
      </p></li></ul></div><p/><p>As an example, the generated Java class code for the Purchase Order
    data object, corresponding to its definition as shown in the following figure
    purchase_example.jpg is visualized in the figure at the bottom of this
    chapter. Note that the two of the data object's fields, namely 'header' and
    'lines' were marked with Equals, and have been assigned with the positions 2
    and 1, respectively).
  </p><div class="figure"><a id="d0e18862"/><p class="title"><strong>Figure 18.85. Purchase Order configuration</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/6.3/generate-purchase-example.png" alt="Purchase Order configuration"/></div></div></div></div><br class="figure-break"/><p/><pre><code class="language-java">

    package org.jbpm.examples.purchases;

    /**
    * This class was automatically generated by the data modeler tool.
    */
    @org.kie.api.definition.type.Label("Purchase Order")
    @org.kie.api.definition.type.TypeSafe(true)
    @org.kie.api.definition.type.Role(org.kie.api.definition.type.Role.Type.EVENT)
    @org.kie.api.definition.type.Expires("2d")
    @org.kie.api.remote.Remotable
    public class PurchaseOrder implements java.io.Serializable
    {

    static final long serialVersionUID = 1L;

    @org.kie.api.definition.type.Label("Total")
    @org.kie.api.definition.type.Position(3)
    private java.lang.Double total;

    @org.kie.api.definition.type.Label("Description")
    @org.kie.api.definition.type.Position(0)
    private java.lang.String description;

    @org.kie.api.definition.type.Label("Lines")
    @org.kie.api.definition.type.Position(2)
    @org.kie.api.definition.type.Key
    private java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines;

    @org.kie.api.definition.type.Label("Header")
    @org.kie.api.definition.type.Position(1)
    @org.kie.api.definition.type.Key
    private org.jbpm.examples.purchases.PurchaseOrderHeader header;

    @org.kie.api.definition.type.Position(4)
    private java.lang.Boolean requiresCFOApproval;

    public PurchaseOrder()
    {
    }

    public java.lang.Double getTotal()
    {
    return this.total;
    }

    public void setTotal(java.lang.Double total)
    {
    this.total = total;
    }

    public java.lang.String getDescription()
    {
    return this.description;
    }

    public void setDescription(java.lang.String description)
    {
    this.description = description;
    }

    public java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; getLines()
    {
    return this.lines;
    }

    public void setLines(java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines)
    {
    this.lines = lines;
    }

    public org.jbpm.examples.purchases.PurchaseOrderHeader getHeader()
    {
    return this.header;
    }

    public void setHeader(org.jbpm.examples.purchases.PurchaseOrderHeader header)
    {
    this.header = header;
    }

    public java.lang.Boolean getRequiresCFOApproval()
    {
    return this.requiresCFOApproval;
    }

    public void setRequiresCFOApproval(java.lang.Boolean requiresCFOApproval)
    {
    this.requiresCFOApproval = requiresCFOApproval;
    }

    public PurchaseOrder(java.lang.Double total, java.lang.String description,
    java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines,
    org.jbpm.examples.purchases.PurchaseOrderHeader header,
    java.lang.Boolean requiresCFOApproval)
    {
    this.total = total;
    this.description = description;
    this.lines = lines;
    this.header = header;
    this.requiresCFOApproval = requiresCFOApproval;
    }

    public PurchaseOrder(java.lang.String description,
    org.jbpm.examples.purchases.PurchaseOrderHeader header,
    java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines,
    java.lang.Double total, java.lang.Boolean requiresCFOApproval)
    {
    this.description = description;
    this.header = header;
    this.lines = lines;
    this.total = total;
    this.requiresCFOApproval = requiresCFOApproval;
    }

    public PurchaseOrder(
    java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines,
    org.jbpm.examples.purchases.PurchaseOrderHeader header)
    {
    this.lines = lines;
    this.header = header;
    }

    @Override
    public boolean equals(Object o)
    {
    if (this == o)
    return true;
    if (o == null || getClass() != o.getClass())
    return false;
    org.jbpm.examples.purchases.PurchaseOrder that = (org.jbpm.examples.purchases.PurchaseOrder) o;
    if (lines != null ? !lines.equals(that.lines) : that.lines != null)
    return false;
    if (header != null ? !header.equals(that.header) : that.header != null)
    return false;
    return true;
    }

    @Override
    public int hashCode()
    {
    int result = 17;
    result = 31 * result + (lines != null ? lines.hashCode() : 0);
    result = 31 * result + (header != null ? header.hashCode() : 0);
    return result;
    }

    }

  </code></pre><p/></div><div class="section" title="18.7.7.6. Using external models"><div class="titlepage"><div><div><h4 class="title"><a id="sect-datamodeler-externalModels"/>18.7.7.6. Using external models</h4></div></div></div><p>Using an external model means the ability to use a set for already defined POJOs in current project context. In
    order to make those POJOs available a dependency to the given JAR should be added. Once the dependency has been
    added the external POJOs can be referenced from current project data model. </p><p>There are two ways to add a dependency to an external JAR file:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Dependency to a JAR file already installed in current local M2 repository (typically associated the the user
        home). </p></li><li class="listitem"><p>Dependency to a JAR file installed in current KIE Workbench/Drools Workbench "Guvnor M2 repository".
        (internal to the application) </p></li></ul></div><div class="section" title="18.7.7.6.1. Dependency to a JAR file in local M2 repository"><div class="titlepage"><div><div><h5 class="title"><a id="d0e18887"/>18.7.7.6.1. Dependency to a JAR file in local M2 repository</h5></div></div></div><p>To add a dependency to a JAR file in local M2 repository follow these steps. </p><div class="section" title="18.7.7.6.1.1. Open the Project Editor for current project and select the Dependencies view."><div class="titlepage"><div><div><h6 class="title"><a id="d0e18892"/>18.7.7.6.1.1. Open the Project Editor for current project and select the Dependencies view. </h6></div></div></div><div class="figure"><a id="d0e18895"/><p class="title"><strong>Figure 18.86. Project editor.</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/add-dependency-1.png" alt="Project editor."/></div></div></div></div><br class="figure-break"/></div><div class="section" title="18.7.7.6.1.2. Click on the &#34;Add&#34; button to add a new dependency line."><div class="titlepage"><div><div><h6 class="title"><a id="d0e18902"/>18.7.7.6.1.2. Click on the "Add" button to add a new dependency line.</h6></div></div></div><div class="figure"><a id="d0e18905"/><p class="title"><strong>Figure 18.87. New dependency line.</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/add-dependency-2.png" alt="New dependency line."/></div></div></div></div><br class="figure-break"/></div><div class="section" title="18.7.7.6.1.3. Complete the GAV for the JAR file already installed in local M2 repository."><div class="titlepage"><div><div><h6 class="title"><a id="d0e18912"/>18.7.7.6.1.3. Complete the GAV for the JAR file already installed in local M2 repository. </h6></div></div></div><div class="figure"><a id="d0e18915"/><p class="title"><strong>Figure 18.88. Dependency line edition.</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/add-dependency-3.png" alt="Dependency line edition."/></div></div></div></div><br class="figure-break"/></div><div class="section" title="18.7.7.6.1.4. Save the project to update its dependencies."><div class="titlepage"><div><div><h6 class="title"><a id="d0e18922"/>18.7.7.6.1.4. Save the project to update its dependencies.</h6></div></div></div><p>When project is saved the POJOs defined in the external file will be available. </p><div class="figure"><a id="d0e18927"/><p class="title"><strong>Figure 18.89. Save project.</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/add-dependency-4.png" alt="Save project."/></div></div></div></div><br class="figure-break"/></div></div><div class="section" title="18.7.7.6.2. Dependency to a JAR file in current &#34;Guvnor M2 repository&#34;."><div class="titlepage"><div><div><h5 class="title"><a id="d0e18934"/>18.7.7.6.2. Dependency to a JAR file in current "Guvnor M2 repository".</h5></div></div></div><p>To add a dependency to a JAR file in current "Guvnor M2 repository" follow these steps. </p><div class="section" title="18.7.7.6.2.1. Open the Maven Artifact Repository editor."><div class="titlepage"><div><div><h6 class="title"><a id="d0e18939"/>18.7.7.6.2.1. Open the Maven Artifact Repository editor.</h6></div></div></div><div class="figure"><a id="d0e18942"/><p class="title"><strong>Figure 18.90. Guvnor M2 Repository editor.</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-1.png" alt="Guvnor M2 Repository editor."/></div></div></div></div><br class="figure-break"/></div><div class="section" title="18.7.7.6.2.2. Browse your local file system and select the JAR file to be uploaded using the Browse button."><div class="titlepage"><div><div><h6 class="title"><a id="d0e18949"/>18.7.7.6.2.2. Browse your local file system and select the JAR file to be uploaded using the Browse button. </h6></div></div></div><div class="figure"><a id="d0e18952"/><p class="title"><strong>Figure 18.91. File browser.</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-2-2.png" alt="File browser."/></div></div></div></div><br class="figure-break"/></div><div class="section" title="18.7.7.6.2.3. Upload the file using the Upload button."><div class="titlepage"><div><div><h6 class="title"><a id="d0e18959"/>18.7.7.6.2.3. Upload the file using the Upload button.</h6></div></div></div><div class="figure"><a id="d0e18962"/><p class="title"><strong>Figure 18.92. File upload success.</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-3.png" alt="File upload success."/></div></div></div></div><br class="figure-break"/></div><div class="section" title="18.7.7.6.2.4. Guvnor M2 repository files."><div class="titlepage"><div><div><h6 class="title"><a id="d0e18969"/>18.7.7.6.2.4. Guvnor M2 repository files.</h6></div></div></div><p>Once the file has been loaded it will be displayed in the repository files list. </p><div class="figure"><a id="d0e18974"/><p class="title"><strong>Figure 18.93. Files list.</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-4.png" alt="Files list."/></div></div></div></div><br class="figure-break"/></div><div class="section" title="18.7.7.6.2.5. Provide a GAV for the uploaded file (optional)."><div class="titlepage"><div><div><h6 class="title"><a id="d0e18981"/>18.7.7.6.2.5. Provide a GAV for the uploaded file (optional).</h6></div></div></div><p>If the uploaded file is not a valid Maven JAR (don't have a pom.xml file) the system will prompt the user in
        order to provide a GAV for the file to be installed. </p><div class="figure"><a id="d0e18986"/><p class="title"><strong>Figure 18.94. Not valid POM.</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-not-gav-1.png" alt="Not valid POM."/></div></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e18993"/><p class="title"><strong>Figure 18.95. Enter GAV manually.</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-not-gav-2.png" alt="Enter GAV manually."/></div></div></div></div><br class="figure-break"/></div><div class="section" title="18.7.7.6.2.6. Add dependency from repository."><div class="titlepage"><div><div><h6 class="title"><a id="d0e19000"/>18.7.7.6.2.6. Add dependency from repository.</h6></div></div></div><p>Open the project editor (see below) and click on the "Add from repository" button to open the JAR selector
        to see all the installed JAR files in current "Guvnor M2 repository". When the desired file is selected the
        project should be saved in order to make the new dependency available. </p><div class="figure"><a id="d0e19005"/><p class="title"><strong>Figure 18.96. Select JAR from "Maven Artifact Repository".</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-5.png" alt="Select JAR from &#34;Maven Artifact Repository&#34;."/></div></div></div></div><br class="figure-break"/></div></div><div class="section" title="18.7.7.6.3. Using the external objects"><div class="titlepage"><div><div><h5 class="title"><a id="d0e19012"/>18.7.7.6.3. Using the external objects</h5></div></div></div><p>When a dependency to an external JAR has been set, the external POJOs can be used in the context of current
      project data model in the following ways: </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>External POJOs can be extended by current model data objects. </p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>External POJOs can be used as field types for current model data objects. </p></li></ul></div><p>The following screenshot shows how external objects are prefixed with the string " -ext- " in order to be
      quickly identified. </p><p/><div class="figure"><a id="d0e19028"/><p class="title"><strong>Figure 18.97. Identifying external objects.</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/add-dependency-select-external-pojo.png" alt="Identifying external objects."/></div></div></div></div><br class="figure-break"/></div></div><div class="section" title="18.7.7.7. Roundtrip and concurrency"><div class="titlepage"><div><div><h4 class="title"><a id="d0e19035"/>18.7.7.7. Roundtrip and concurrency</h4></div></div></div><p>
  Current version implements roundtrip and code preservation between Data modeller and Java source code.
  No matter where the Java code was generated (e.g. Eclipse, Data modeller), the data modeller will only
  create/delete/update the necessary code elements to maintain the model updated, i.e, fields, getter/setters,
  constructors, equals method and hashCode method. Also whatever Type or Field annotation not managed by the
  Data Modeler will be preserved when the Java sources are updated by the Data modeller.
  </p><p>
  Aside from code preservation, like in the other workbench editors, concurrent modification scenarios are still
  possible. Common scenarios are when two different users are updating the model for the same project, e.g. using the
  data modeller or executing a 'git push command' that modifies project sources.
  </p><p>From an application context's perspective, we can basically identify
  two different main scenarios:</p><div class="section" title="18.7.7.7.1. No changes have been undertaken through the application"><div class="titlepage"><div><div><h5 class="title"><a id="d0e19044"/>18.7.7.7.1. No changes have been undertaken through the application</h5></div></div></div><p>In this scenario the application user has basically just been
    navigating through the data model, without making any changes to it.
    Meanwhile, another user modifies the data model externally.</p><p>In this case, no immediate warning is issued to the application
    user. However, as soon as the user tries to make any kind of change, such
    as add or remove data objects or properties, or change any of the existing
    ones, the following pop-up will be shown:</p><div class="figure"><a id="d0e19051"/><p class="title"><strong>Figure 18.98. External changes warning</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/extchanges_reopen_ignore.jpg" alt="External changes warning"/></div></div></div></div><br class="figure-break"/><p/><p>The user can choose to either:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Re-open the data model, thus loading any external changes, and
        then perform the modification he was about to undertake, or</p></li><li class="listitem"><p>Ignore any external changes, and go ahead with the modification
        to the model. In this case, when trying to persist these changes,
        another pop-up warning will be shown:</p><div class="figure"><a id="d0e19068"/><p class="title"><strong>Figure 18.99. Force save / re-open</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/extchanges_forcesave_reopen.jpg" alt="Force save / re-open"/></div></div></div></div><br class="figure-break"/><p>The "Force Save" option will effectively overwrite any external
        changes, while "Re-open" will discard any local changes and reload the
        model.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>"Force Save" overwrites any external changes!</p></div></li></ul></div><p/></div><div class="section" title="18.7.7.7.2. Changes have been undertaken through the application"><div class="titlepage"><div><div><h5 class="title"><a id="d0e19081"/>18.7.7.7.2. Changes have been undertaken through the application</h5></div></div></div><p>The application user has made changes to the data model. Meanwhile,
    another user simultaneously modifies the data model from outside the
    application context.</p><p>In this alternative scenario, immediately after the external user
    commits his changes to the asset repository (or e.g. saves the model with the data modeller in a different session),
    a warning is issued to the application user:</p><div class="figure"><a id="d0e19088"/><p class="title"><strong>Figure 18.100. External changes warning</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/extchanges_reopen_ignore.jpg" alt="External changes warning"/></div></div></div></div><br class="figure-break"/><p/><p>As with the previous scenario, the user can choose to either:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Re-open the data model, thus losing any modifications that where
        made through the application, or</p></li><li class="listitem"><p>Ignore any external changes, and continue working on the
        model.</p><p>One of the following possibilities can now occur:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The user tries to persist the changes he made to the model
            by clicking the "Save" button in the data modeller top level menu.
            This leads to the following warning message:</p><div class="figure"><a id="d0e19111"/><p class="title"><strong>Figure 18.101. Force save / re-open</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataModeller/extchanges_forcesave_reopen.jpg" alt="Force save / re-open"/></div></div></div></div><br class="figure-break"/><p>The "Force Save" option will effectively overwrite any
            external changes, while "Re-open" will discard any local changes
            and reload the model.</p></li></ul></div></li></ul></div></div></div></div><div class="section" title="18.7.8. Data Sets"><div class="titlepage"><div><div><h3 class="title"><a id="wb.DataSets"/>18.7.8. Data Sets</h3></div></div></div><p>A <span class="bold"><strong>data set</strong></span> is basically a set of columns populated with some rows, a matrix of data composed of timestamps, texts and numbers.
    A data set can be stored in different systems: a database, an excel file, in memory or in a lot of other different systems. On the other hand, a
    <span class="bold"><strong>data set definition</strong></span> tells the workbench modules how such data can be accessed, read and parsed.
  </p><p>
    Notice, it's very important to make crystal clear the difference between a data set and its definition since the workbench does not take care of storing any data,
    it just provides a standard way to define access to those data sets regardless where the data is stored.
  </p><p>Let's take for instance the data stored in a remote database. A valid data set could be, for example, an entire database table or the result of an SQL query.
    In both cases, the database will return a bunch of columns and rows. Now, imagine we want to get access to such data to feed some charts in a new workbench perspective.
    First thing is to create and register a data set definition in order to indicate the following:
  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>where the data set is stored,</p></li><li class="listitem"><p>how can be accessed, read and parsed and</p></li><li class="listitem"><p>what columns contains and of which type.</p></li></ul></div><p>
    This chapter introduces the available workbench tools for registering and handling data set definitions and how these definitions can be consumed in other workbench modules
    like, for instance, the Perspective Editor.
  </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>
      For simplicity sake we will be using the term <span class="emphasis"><em>data set</em></span> to refer to the actual data set definitions as <span class="emphasis"><em>Data set</em></span> and
      <span class="emphasis"><em>Data set definition</em></span> can be considered synonyms under the data set authoring context.
    </p></div><div class="section" title="18.7.8.1. Data Set Authoring Perspective"><div class="titlepage"><div><div><h4 class="title"><a id="wb.DataSetAuthoringPerspective"/>18.7.8.1. Data Set Authoring Perspective</h4></div></div></div><p>Everything related to the authoring of data sets can be found under the <span class="emphasis"><em>Data Set Authoring</em></span> perspective which
      is accessible from the following top level menu entry: <span class="emphasis"><em>Extensions&gt;Data Sets</em></span>, as shown in the following screenshot.</p><div class="figure"><a id="d0e19171"/><p class="title"><strong>Figure 18.102. Data Set Authoring Perspective</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataSets/DataSetAuthoringPerspective.png" alt="Data Set Authoring Perspective"/></div></div></div></div><br class="figure-break"/><p>
      The center panel, shows a welcome screen, whilst the left panel contains the <span class="emphasis"><em>Data Set Explorer</em></span> listing all the data
      sets available
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>
        This perspective is only intended to Administrator users, since defining data sets can be considered a low level task.
      </p></div></div><div class="section" title="18.7.8.2. Data Set Explorer"><div class="titlepage"><div><div><h4 class="title"><a id="wb.DataSetExplorer"/>18.7.8.2. Data Set Explorer</h4></div></div></div><p>
      The <span class="emphasis"><em>Data Set Explorer</em></span> lists the data sets present in the system. Every time the user clicks on the data set it shows a brief summary alongside the
      following information:
    </p><div class="figure"><a id="d0e19194"/><p class="title"><strong>Figure 18.103. Data Set Explorer</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataSets/DataSetExplorer.png" alt="Data Set Explorer"/></div></div></div></div><br class="figure-break"/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>(1) A button for creating a new Data set</p></li><li class="listitem"><p>(2) The list of currently available Data sets</p></li><li class="listitem"><p>(3) An icon that represents the Data set's provider type (Bean, SQL, CSV, etc)</p></li><li class="listitem"><p>(4) Details of current cache and refresh policy status</p></li><li class="listitem"><p>(5) Details of current size on backend (unit as rows) and current size on client side (unit in bytes)</p></li><li class="listitem"><p>(6) The button for editing the Data set. Once clicked the Data set editor screen is opened on the center panel</p></li></ul></div><p>
      The next sections explain how to create, edit and fine tune data set definitions.
    </p></div><div class="section" title="18.7.8.3. Data Set Creation"><div class="titlepage"><div><div><h4 class="title"><a id="wb.DataSetCreation"/>18.7.8.3. Data Set Creation</h4></div></div></div><p>
      Clicking on the <span class="emphasis"><em>New Data Set</em></span> button opens a new screen from which the user is
      able to create a new data set definition in three steps:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          <span class="emphasis"><em>Provider type selection</em></span>
          </p><p>
            Specify the kind of the remote storage system (BEAN, SQL, CSV, ElasticSearch)
          </p><p>
        </p></li><li class="listitem"><p>
          <span class="emphasis"><em>Provider configuration</em></span>
          </p><p>
            Specify the attributes for being able to look up data from the remote system.
            The configuration varies depending on the data provider type selected.
          </p><p>
        </p></li><li class="listitem"><p>
          <span class="emphasis"><em>Data set columns &amp; filter</em></span>
          </p><p>
            Live data preview, column types and initial filter configuration.
          </p><p>
        </p></li></ul></div><div class="section" title="18.7.8.3.1. Step 1: Provider type selection"><div class="titlepage"><div><div><h5 class="title"><a id="wb.DataSetCreationTypeSelection"/>18.7.8.3.1. Step 1: Provider type selection</h5></div></div></div><p>
        Allows the user's specify the type of data provider of the data set being created.
      </p><p>
        This screen lists all the current available data provider types and helper popovers with descriptions. Each data provider is represented with a descriptive image:
      </p><div class="figure"><a id="d0e19266"/><p class="title"><strong>Figure 18.104. Provider type selection</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataSets/DataSetDefTypeSelection.png" alt="Provider type selection"/></div></div></div></div><br class="figure-break"/><p>
        Four types are currently supported:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Bean (Java class) - To generate a data set directly from Java</p></li><li class="listitem"><p>SQL - For getting data from any ANSI-SQL compliant database</p></li><li class="listitem"><p>CSV - To upload the contents of a remote or local CSV file</p></li><li class="listitem"><p>Elastic Search - To query and get documents stored on Elastic Search nodes as data sets</p></li></ul></div><p>
        Once a type is selected, click on Next button to continue with the next workflow step.
      </p></div><div class="section" title="18.7.8.3.2. Step 2: Configuration"><div class="titlepage"><div><div><h5 class="title"><a id="wb.DataSetCreationConfiguration"/>18.7.8.3.2. Step 2: Configuration</h5></div></div></div>

      The screenshot below shows a CSV data set configuration form. Once all the required settings are filled
      click on Test button. The system will try to fetch a small amount of data before moving to the next workflow step.

      <div class="figure"><a id="d0e19294"/><p class="title"><strong>Figure 18.105. CSV Configuration</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataSets/DataSetDefConfigScreen.png" alt="CSV Configuration"/></div></div></div></div><br class="figure-break"/><p>
      The provider type selected in the previous step will determine which configuration settings the system asks for.
      </p><div class="figure"><a id="d0e19303"/><p class="title"><strong>Figure 18.106. Configuration screen per data set type</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataSets/DataSetDefConfigTypes.png" alt="Configuration screen per data set type"/></div></div></div></div><br class="figure-break"/><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>
          The UUID attribute is a read only field as it's generated by the system. It's only intended for usage in API calls or specific operations.
        </p></div></div><div class="section" title="18.7.8.3.3. Step 3: Data set columns and preview"><div class="titlepage"><div><div><h5 class="title"><a id="wb.DataSetCreationPreview"/>18.7.8.3.3. Step 3: Data set columns and preview</h5></div></div></div><p>
        After clicking on the <span class="emphasis"><em>Test</em></span> button (see previous step), the system executes a data set
        lookup test call in order to check if the remote system is up and the data is available. If everything goes ok
        the user will see the following screen:
      </p><div class="figure"><a id="d0e19321"/><p class="title"><strong>Figure 18.107. Data set preview</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataSets/DataSetDefLivePreview.png" alt="Data set preview"/></div></div></div></div><br class="figure-break"/><p>
        This screen shows a live data preview along with the columns the user wants to be part of the resulting data set. The user can also navigate through
        the data and apply some changes to the data set structure. Once finished, we can click on the <span class="emphasis"><em>Save</em></span> button in order
        to register the new data set definition.
      </p><p>
        We can also change the configuration settings at any time just by going back to the configuration tab. We can repeat the
        <span class="emphasis"><em>Configuration&gt;Test&gt;Preview</em></span> cycle as may times as needed until we consider it's ready to be saved.
      </p><p>
        <span class="bold"><strong>Columns</strong></span>
      </p><p>
        In the <span class="emphasis"><em>Columns</em></span> tab area the user can select what columns are part of the resulting data set definition.
      </p><div class="figure"><a id="d0e19349"/><p class="title"><strong>Figure 18.108. Data set columns</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataSets/DataSetDefColumns.png" alt="Data set columns"/></div></div></div></div><br class="figure-break"/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            (1) To add or remove columns. Select only those columns you want to be part of the resulting data set
          </p></li><li class="listitem"><p>
            (2) Use the drop down image selector to change the column type
          </p></li></ul></div><p>
        A data set may only contain columns of any of the following 4 types:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            Label - For text values supporting group operations (similar to the SQL "group by" operator) which means you can perform data lookup calls and get one row per distinct value.
          </p></li><li class="listitem"><p>
            Text - For text values NOT supporting group operations. Typically for modeling large text columns such as abstracts, descriptions and the like.
          </p></li><li class="listitem"><p>
            Number - For numeric values. It does support aggregation functions on data lookup calls: sum, min, max, average, count, disctinct.
          </p></li><li class="listitem"><p>
            Date - For date or timestamp values. It does support time based group operations by different time intervals: minute, hour, day, month, year, ...
          </p></li></ul></div><p>
        No matter which remote system you want to retrieve data from, the resulting data set will always return a set of columns of one of the four types above.
        There exists, by default, a mapping between the remote system column types and the data set types. The user is able to modify the type for some columns, depending
        on the data provider and the column type of the remote system. The system supports the following changes to column types:
      </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
            Label &lt;&gt; Text - Useful when we want to enable/disable the categorization (grouping) for the target column. For instance, imagine a database table called
            "document" containing a large text column called "abstract". As we do not want the system to treat such column as a "label" we might change its column type to "text".
            Doing so, we are optimizing the way the system handles the data set and
          </p></li><li class="listitem"><p>
            Number &lt;&gt; Label - Useful when we want to treat numeric columns as labels. This can be used for instance to indicate that a given numeric column is not a numeric
            value that can be used in aggregation functions. Despite its values are stored as numbers we want to handle the column as a "label". One example of such columns are:
            an item's code, an appraisal id., ...
          </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>
          BEAN data sets do not support changing column types as it's up to the developer to decide which are the concrete types for each column.
        </p></div><p>
        <span class="bold"><strong>Filter</strong></span>
      </p><p>
        A data set definition may define a filter. The goal of the filter is to leave out rows the user does not consider necessary. The filter feature works on any data provider type
        and it lets the user to apply filter operations on any of the data set columns available.
      </p><div class="figure"><a id="d0e19398"/><p class="title"><strong>Figure 18.109. Data set filter</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataSets/DataSetDefFilter.png" alt="Data set filter"/></div></div></div></div><br class="figure-break"/><p>
        While adding or removing filter conditions and operations, the preview table on central area is updated with live data that reflects the current filter status.
      </p><p>
        There exists two strategies for filtering data sets and it's also important to note that choosing between the two have important implications. Imagine a dashboard
        with some charts feeding from a expense reports data set where such data set is built on top of an SQL table. Imagine also we only want to retrieve the
        expense reports from the "London" office. You may define a data set containing the filter "office=London" and then having several charts feeding from
        such data set. This is the recommended approach. Another option is to define a data set with no initial filter and then let the individual charts to specify their own filter.
        It's up to the user to decide on the best approach.
      </p><p>
        Depending on the case it might be better to define the filter at a data set level for reusing across other modules. The decision may also have impact on the performance
        since a filtered cached data set will have far better performance than a lot of individual non-cached data set lookup requests. (See the next section for more information about
        caching data sets).
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>
          Notice, for SQL data sets, the user can use both the filter feature introduced or, alternatively, just add custom filter criteria to the SQL sentence. Although, the first
          approach is more appropriated for non technical users since they might not have the required SQL language skills.
        </p></div></div></div><div class="section" title="18.7.8.4. Data set editor"><div class="titlepage"><div><div><h4 class="title"><a id="wb.DataSetDefEditor"/>18.7.8.4. Data set editor</h4></div></div></div><p>
      To edit an existing data set definition go the data set explorer, expand the desired data set definition and click on the <span class="emphasis"><em>Edit</em></span> button.
      This will cause a new editor panel to be opened and placed on the center of the screen, as shown in the next screenshot:
    </p><div class="figure"><a id="d0e19423"/><p class="title"><strong>Figure 18.110. Data set definition editor</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataSets/DataSetDefEditor.png" alt="Data set definition editor"/></div></div></div></div><br class="figure-break"/>

    Every time we edit an item its editor is added to the center panel. We can navigate through the list of opened editors just by clicking on the down arrow icon placed at the
    editor's toolbar in the top right corner.

    <div class="figure"><a id="d0e19431"/><p class="title"><strong>Figure 18.111. Editor selector</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataSets/DataSetDefEditorSelector.png" alt="Editor selector"/></div></div></div></div><br class="figure-break"/>

    The editor provides all the features described in previous sections. We can change the configuration settings, test our data set definition and modify the resulting data set
    structure. Additionally, the editor provides some extra buttons in its toolbar:

    <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          Save - To validate the current changes and store the data set definition.
        </p></li><li class="listitem"><p>
          Delete - To remove permanently from storage the data set definition. Any client module referencing the data set may be affected.
        </p></li><li class="listitem"><p>
          Validate - To check that all the required parameters exist and are correct, as well as to validate the data set can be retrieved with no issues.
        </p></li><li class="listitem"><p>
          Copy - To create a brand new definition as a copy of the current one.
        </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>
        Data set definitions are stored in the underlying GIT repository as JSON files. Any action performed is registered in the repository logs so it is possible to audit
        the change log later on.
      </p></div></div><div class="section" title="18.7.8.5. Advanced settings"><div class="titlepage"><div><div><h4 class="title"><a id="wb.DataSetAdvancedSettings"/>18.7.8.5. Advanced settings</h4></div></div></div><p>
      In the <span class="emphasis"><em>Advanced settings</em></span> tab area the user can specify caching and refresh settings. Those are very important for making the most of the system capabilities
      thus improving the performance and having better application responsive levels.
    </p><div class="figure"><a id="d0e19464"/><p class="title"><strong>Figure 18.112. Advanced settings</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataSets/DataSetDefAdvanced.png" alt="Advanced settings"/></div></div></div></div><br class="figure-break"/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          (1) To enable or disable the client cache and specify the maximum size (bytes).
        </p></li><li class="listitem"><p>
          (2) To enable or disable the backend cache and specify the maximum cache size (number of rows).
        </p></li><li class="listitem"><p>
          (3) To enable or disable automatic refresh for the Data set and the refresh period.
        </p></li><li class="listitem"><p>
          (4) To enable or disable the refresh on stale data setting.
        </p></li></ul></div><p>
      Let's dig into more details about the meaning of these settings.
    </p></div><div class="section" title="18.7.8.6. Caching"><div class="titlepage"><div><div><h4 class="title"><a id="wb.DataSetCacheSettings"/>18.7.8.6. Caching</h4></div></div></div><p>
      The system provides caching mechanisms out-of-the-box for holding data sets and performing data operations using in-memory strategies. The use of these features brings a lot of
      advantages, like reducing the network traffic, remote system payload, processing times etc. On the other hand, it's up to the user to fine tune properly the caching settings
      to avoid hitting performance issues.
    </p><p>
      Two cache levels are supported:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          Client level
        </p></li><li class="listitem"><p>
          Backend level
        </p></li></ul></div><p>
      The following diagram shows how caching is involved in any data set operation:
    </p><div class="figure"><a id="d0e19503"/><p class="title"><strong>Figure 18.113. Data set caching</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataSets/DataSetCacheArchitecture.png" alt="Data set caching"/></div></div></div></div><br class="figure-break"/><p>
      Any data look up call produces a resulting data set, so the use of the caching techniques determines where the data lookup calls are executed and where the resulting data set is
      located.
    </p><p>
      <span class="bold"><strong>Client cache</strong></span>
    </p><p>
      If ON then the data set involved in a look up operation is pushed into the web browser so that all the components that feed from this data set
      <span class="bold"><strong>do not need to perform any requests to the backend</strong></span> since data set operations are resolved at a client side:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          The data set is stored in the web browser's memory
        </p></li><li class="listitem"><p>
          The client components feed from the data set stored in the browser
        </p></li><li class="listitem"><p>
          Data set operations (grouping, aggregations, filters and sort) are processed within the web browser, by means of a Javascript data set operation engine.
        </p></li></ul></div><p>
      If you know beforehand that your data set will remain small, you can enable the client cache. It will reduce the number of backend requests, including the requests to
      the storage system.  On the other hand, if you consider that your data set will be quite big, disable the client cache so as to not hitting with browser issues such as slow
      performance or intermittent hangs.
    </p><p>
      <span class="bold"><strong>Backend cache</strong></span>
    </p><p>
      Its goal is to provide a caching mechanism for data sets on backend side.
    </p><p>
      This feature allows to <span class="bold"><strong>reduce the number of requests to the remote storage system</strong></span> , by holding the data set in memory and performing group,
      filter and sort operations using the in-memory engine.
    </p><p>It's useful for data sets that do not change very often and their size can be considered acceptable to be held and processed in memory. It can be also helpful on low latency
      connectivity issues with the remote storage. On the other hand, if your data set is going to be updated frequently, it's better to disable the backend cache and perform the
      requests to the remote storage on each look up request, so the storage system is in charge of resolving the data set lookup request.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>
        BEAN and CSV data providers relies by default on the backend cache, as in both cases the data set must be always loaded into memory in order to resolve any data lookup operation
        using the in-memory engine. This is the reason why the backend settings are not visible in the Advanced settings tab.
      </p></div></div><div class="section" title="18.7.8.7. Refresh"><div class="titlepage"><div><div><h4 class="title"><a id="wb.DataSetRefreshSettings"/>18.7.8.7. Refresh</h4></div></div></div><p>
      The refresh feature allows for the invalidation of any cached data when certain conditions are meet.
    </p><div class="figure"><a id="d0e19559"/><p class="title"><strong>Figure 18.114. Refresh settings</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Workbench/Authoring/DataSets/DataSetDefRefreshSettings.png" alt="Refresh settings"/></div></div></div></div><br class="figure-break"/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          (1) To enable or disable the refresh feature.
        </p></li><li class="listitem"><p>
          (2) To specify the refresh interval.
        </p></li><li class="listitem"><p>
          (3) To enable or disable data set invalidation when the data is outdated.
        </p></li></ul></div><p>
      The data set refresh policy is tightly related to data set caching, detailed in previous section. This invalidation mechanism determines the cache life-cycle.
    </p><p>
      Depending on the nature of the data there exist three main use cases:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          <span class="bold"><strong>Source data changes predictable</strong></span> - Imagine a database being updated every night. In that case, the suggested configuration is to use a
          "refresh interval = 1 day" and disable "refresh on stale data". That way, the system will always invalidate the cached data set every day. This is the right configuration
          when we know in advance that the data is going to change.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong>Source data changes unpredictable</strong></span> - On the other hand, if we do not know whether the database is updated every day, the suggested
          configuration is to use a "refresh interval = 1 day" and enable "refresh on stale data". If so the system, before invalidating any data, will check for modifications.
          On data modifications, the system will invalidate the current stale data set so that the cache is populated with fresh data on the next data set lookup call.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong>Real time scenarios</strong></span> - In real time scenarios caching makes no sense as data is going to be updated constantly. In this kind of scenarios
          the data sent to the client has to be constantly updated, so rather than enabling the refresh settings (remember this settings affect the caching, and caching is not enabled)
          it's up to the clients consuming the data set to decide when to refresh. When the client is a dashboard then it's just a matter of modifying the refresh settings in the
          Displayer Editor configuration screen and set a proper refresh period, "refresh interval = 1 second" for example.
        </p></li></ul></div></div></div></div><div class="section" title="18.8. User and group management"><div class="titlepage"><div><div><h2 class="title"><a id="wb.UserAndGroupMgmt"/>18.8. User and group management</h2></div></div></div><div class="section" title="18.8.1. Introduction"><div class="titlepage"><div><div><h3 class="title"><a id="d0e19602"/>18.8.1. Introduction</h3></div></div></div><p>This section describes a feature that allows the administration of the application's users
      and groups using an intuitive and friendly user interface that comes integrated in both jBPM
      and Drools Workbenches.</p><div class="figure"><a id="d0e19607"/><p class="title"><strong>Figure 18.115. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/home.png"/></div></div></div><p><br class="figure-break"/></p><p>Before the installation, setup and usage of this feature, this section talks about some
      previous concepts that need to be completely understood for the further usage:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Security management providers and capabilities</p></li><li class="listitem"><p>Installation and setup</p></li><li class="listitem"><p>Usage</p></li></ul></div></div><div class="section" title="18.8.2. Security management providers"><div class="titlepage"><div><div><h3 class="title"><a id="d0e19623"/>18.8.2. Security management providers</h3></div></div></div><p>A security environment is usually provided by the use of a <span class="emphasis"><em>realm</em></span>.
      Realms are used to restrict the access for the different application's resources. So realms
      contains information about the users, groups, roles, permissions and and any other related
      information.</p><p>In most of the typical scenarios the application's security is delegated to the
      container's security mechanism, which consumes a given realm at same time. It's important to
      consider that there exist several realm implementations, for example Wildfly provides a realm
      based on the
        <span class="emphasis"><em>application-users.properties</em></span>/<span class="emphasis"><em>application-roles.properties</em></span>
      files, Tomcat provides a realm based on the <span class="emphasis"><em>tomcat-users.xml</em></span> file, etc.
      So keep in mind that there is no single security realm to rely on, it can be different in each
      installation.</p><p>The jBPM and Drools workbenches are not an exception, they're build on top Uberfire
      framework (aka UF), which delegates the authorization and authentication to the underlying
      container's security environment as well, so the consumed realm is given by the concrete
      deployment configuration.</p><div class="section" title="18.8.2.1. Security management providers"><div class="titlepage"><div><div><h4 class="title"><a id="d0e19644"/>18.8.2.1. Security management providers</h4></div></div></div><p>Due to the potential different security environments that have to be supported, the
        users and groups management provides a well defined management services API with some
        default built-in security management providers. A <span class="bold"><strong>security management
          provider</strong></span> is the formal name given to a concrete user and group management
        service implementation for a given realm.</p><p>At this moment, by default there are two security management providers available:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Wildfly / EAP security management provider</strong></span> - For
              Wildfly or EAP realms based on properties files.</p></li><li class="listitem"><p><span class="bold"><strong>Tomcat security management provider</strong></span> - For Tomcat
              realms based on XML files.</p></li></ul></div><p>If the built-in providers do not fit with the application's security realm, it is easy
        to build and register your own security management provider.</p></div><div class="section" title="18.8.2.2. Secutiry management provider capabilities"><div class="titlepage"><div><div><h4 class="title"><a id="d0e19667"/>18.8.2.2. Secutiry management provider capabilities</h4></div></div></div><p>Each security realm can provide support different operations. For example consider the
        use of a Wildfly's realm based on properties files, The contents for the
        applications-users.properties is
        like:</p><pre><code class="no-highlight">admin=207b6e0cc556d7084b5e2db7d822555c
salaboy=d4af256e7007fea2e581d539e05edd1b
maciej=3c8609f5e0c908a8c361ca633ed23844
kris=0bfd0f47d4817f2557c91cbab38bb92d
katy=fd37b5d0b82ce027bfad677a54fbccee
john=afda4373c6021f3f5841cd6c0a027244
jack=984ba30e11dda7b9ed86ba7b73d01481
director=6b7f87a92b62bedd0a5a94c98bd83e21
user=c5568adea472163dfc00c19c6348a665
guest=b5d048a237bfd2874b6928e1f37ee15e
kiewb=78541b7b451d8012223f29ba5141bcc2
kieserver=16c6511893651c9b4b57e0c027a96075</code></pre><p>Note that it's based on key-value pairs where the key is the
          <span class="emphasis"><em>username</em></span>, and the value is the hashed value for the user's
          <span class="emphasis"><em>password</em></span>. So a user is just defined by the key, by its username, it
        does not have a name nor address or any other meta information.</p><p>On the other hand, consider the use of a realm provided by a Keycloak server. The
        information for a user is composed by more user meta-data, such as surname, address, etc, as
        in the following image:</p><div class="figure"><a id="d0e19684"/><p class="title"><strong>Figure 18.116. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/admin_user_view.png"/></div></div></div><br class="figure-break"/><p>So the different services and client side components from the users and group management
        API are based on <span class="emphasis"><em>capabilities</em></span>.<span class="bold"><strong>Capabilities</strong></span> are used to expose or restrict the available functionality
        provided by the different services and client side components. Examples of capabilities are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Create a user</p></li><li class="listitem"><p>Update a user</p></li><li class="listitem"><p>Delete a user</p></li><li class="listitem"><p>Update user's attributes</p></li><li class="listitem"><p>Create a group</p></li><li class="listitem"><p>Update a group</p></li><li class="listitem"><p>Assign groups to a user</p></li><li class="listitem"><p>Assign roles to a user</p></li></ul></div><p>Each security management provider must specify a set of capabilities supported. From the
        previous examples you can note that the Wildfly security management provider does not
        support the capability for the management of the attributes for a user - the user is only
        composed by the user name. On the other hand the Keycloak provider does support this
        capability.</p><p>The different views and user interface components rely on the capabilities supported by
        each provider, so if a capability is not supported by the provider in use, the UI does not
        provide the views for the management of that capability. As an example, consider that a
        concrete provider does not support deleting users - the delete user button on the user
        interface will be not available.</p><p>Please take a look at the concrete service provider documentation to check all the
        supported capabilities for each one, the default ones can be found <a class="link" href="https://github.com/uberfire/uberfire-extensions/tree/master/uberfire-security/uberfire-security-management">here</a>.</p></div></div><div class="section" title="18.8.3. Installation and setup"><div class="titlepage"><div><div><h3 class="title"><a id="d0e19730"/>18.8.3. Installation and setup</h3></div></div></div><p>Before considering the installation and setup steps please note the following Drools and
      jBPM distributions come with built-in, pre-installed security management providers by default:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Wildfly / EAP distribution</strong></span> - Both distributions use
            the <a class="link" href="https://github.com/uberfire/uberfire-extensions/tree/master/uberfire-security/uberfire-security-management/uberfire-security-management-wildfly">Wildfly security management provider</a> configured for the use of the default
            realm files <span class="italic">application-users.properties</span> and
              <span class="italic">application-roles.properties</span></p></li><li class="listitem"><p><span class="bold"><strong>Tomcat distribution</strong></span> - It uses the <a class="link" href="https://github.com/uberfire/uberfire-extensions/tree/master/uberfire-security/uberfire-security-management/uberfire-security-management-tomcat">Tomcat security management provider</a> configured for the use of the default
            realm file <span class="italic">tomcat-users.xml</span></p></li></ul></div><p>Please read each <a class="link" href="https://github.com/uberfire/uberfire-extensions/tree/master/uberfire-security/uberfire-security-management">provider's documentation</a> in order to apply the concrete settings for the target
      deployment environment.</p><p>On the other hand, if using a custom security management provider or need to include it on
      an existing application, consider the following installation options:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Enable the security management feature on an existing WAR distribution</p></li><li class="listitem"><p>Setup and installation in an existing or new project</p></li></ul></div><p><span class="emphasis"><em>NOTE</em></span>: If no security management provider is installed in the
      application, there will be no available user interface for managing the security realm. Once a
      security management provider is installed and setup, the user and group management user
      interfaces are automatically enabled and accessible from the main menu.</p><div class="section" title="18.8.3.1. Enable the security management feature on an existing WAR distribution"><div class="titlepage"><div><div><h4 class="title"><a id="d0e19777"/>18.8.3.1. Enable the security management feature on an existing WAR distribution</h4></div></div></div><p>Given an existing WAR distribution of either Drools and jBPM workbenches, follow these
        steps in order to install and enable the user management feature:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Ensure the following libraries are present on <span class="italic">WEB-INF/lib</span>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>WEB-INF/lib/uberfire-security-management-api-6.4.0.Final..jar</p></li><li class="listitem"><p>WEB-INF/lib/uberfire-security-management-backend-6.4.0.Final..jar</p></li></ul></div></li><li class="listitem"><p>Add the concrete library for the security management provider to use in <span class="italic">WEB-INF/lib</span>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Eg: WEB-INF/lib/uberfire-security-management-wildfly-6.4.0.Final..jar</p></li><li class="listitem"><p>If the concrete provider you're using requires more libraries, add those as
                    well. Please read each <a class="link" href="https://github.com/uberfire/uberfire-extensions/tree/master/uberfire-security/uberfire-security-management">provider's documentation</a> for more information</p></li></ul></div></li><li class="listitem"><p>Replace the whole content for file <span class="italic">WEB-INF/classes/security-management.properties</span>, or if not present,
              create it. The settings present on this file depend on the concrete implementation
              you're using. Please read each <a class="link" href="https://github.com/uberfire/uberfire-extensions/tree/master/uberfire-security/uberfire-security-management">provider's documentation</a> for more information.</p></li><li class="listitem"><p>If you're deploying on Wildfly or EAP, please check if the <span class="italic">WEB-INF/jboss-deployment-structure.xml </span>requires any update. Please read
              each <a class="link" href="https://github.com/uberfire/uberfire-extensions/tree/master/uberfire-security/uberfire-security-management">provider's documentation</a> for more information.</p></li></ul></div></div><div class="section" title="18.8.3.2. Setup and installation in an existing or new project"><div class="titlepage"><div><div><h4 class="title"><a id="d0e19830"/>18.8.3.2. Setup and installation in an existing or new project</h4></div></div></div><p>If you're building an <a class="link" href="http://uberfireframework.org/">Uberfire</a>
        based web application and you want to include the user and group management feature, please
        read <a class="link" href="https://github.com/uberfire/uberfire-extensions/blob/master/uberfire-security/uberfire-security-management/uberfire-security-management-client-wb/README.md">this instructions</a>.</p></div><div class="section" title="18.8.3.3. Disabling the security management feature"><div class="titlepage"><div><div><h4 class="title"><a id="d0e19841"/>18.8.3.3. Disabling the security management feature</h4></div></div></div><p>The security management feature can be disabled, and thus no services or user interface
        will be available, by any of:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Uninstalling the security management provider from the application</p><p>When no concrete security management provider installed on the application, the
              user and group management feature will be disabled and no services or user interface
              will be presented to the user.</p></li><li class="listitem"><p>Removing or commenting the security management configuration file</p><p>Removing or commenting all the lines in the configuration file located at<span class="italic"> WEB-INF/classes/security-management.properties</span> will
              disable the user and group management feature and no services or user interface will
              be presented to the user.</p></li></ul></div></div></div><div class="section" title="18.8.4. Usage"><div class="titlepage"><div><div><h3 class="title"><a id="d0e19860"/>18.8.4. Usage</h3></div></div></div><p>The user and group management feature is presented using two different perspectives that
      are available from the main <span class="italic">Home </span>menu (considering that the
      feature is enabled) as:</p><div class="figure"><a id="d0e19868"/><p class="title"><strong>Figure 18.117. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/main_menu.png"/></div></div></div><br class="figure-break"/><p>Read the following sections for using both user and group management perspectives.</p><div class="section" title="18.8.4.1. User management"><div class="titlepage"><div><div><h4 class="title"><a id="d0e19874"/>18.8.4.1. User management</h4></div></div></div><p>The user management interface is available from the <span class="italic">User
          management</span> menu entry in the <span class="italic">Home</span>
        menu.</p><p>The interface is presented using two main panels: the users explorer on the west panel
        and the user editor on the center one:</p><div class="figure"><a id="d0e19887"/><p class="title"><strong>Figure 18.118. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/users_perspective.png"/></div></div></div><br class="figure-break"/><p>The <span class="bold"><strong>users explorer</strong></span>, on west panel, lists by default all
        the users present on the application's security realm:</p><div class="figure"><a id="d0e19896"/><p class="title"><strong>Figure 18.119. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/users_explorer.png"/></div></div></div><br class="figure-break"/><p>In addition to listing all users, the users explorer allows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Searching for users</strong></span></p><p>When specifying the search pattern in the search box the users list will be
              reduced and will display only the users that match the search pattern.</p><div class="figure"><a id="d0e19909"/><p class="title"><strong>Figure 18.120. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/users_explorer_search.png"/></div></div></div><br class="figure-break"/><p>Search patterns depend on the concrete security management provider being used by
              the application's. Please read each <a class="link" href="https://github.com/uberfire/uberfire-extensions/tree/master/uberfire-security/uberfire-security-management">provider's documentation</a> for more information.</p></li><li class="listitem"><p><span class="bold"><strong>Creating new users</strong></span></p><p>By clicking on the <span class="italic">Create new user </span>button, a
              new screen will be presented on the center panel to perform a new user
              creation.</p><div class="figure"><a id="d0e19927"/><p class="title"><strong>Figure 18.121. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/create_new_user.png"/></div></div></div><br class="figure-break"/></li></ul></div><p>The <span class="bold"><strong>user editor</strong></span>, on the center panel, is used to
        create, view, update or delete users. Once creating a new user o clicking an existing user
        on the users explorer, the user editor screen is opened.</p><p>To <span class="bold"><strong>view an existing user</strong></span>,  click on an existing user in
        the Users Explorer to open the User Editor screen. For example, viewing the <span class="italic">admin</span> user when using the Wildfly security management provider
        results in this screen:</p><div class="figure"><a id="d0e19944"/><p class="title"><strong>Figure 18.122. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/admin_user_view_wf.png"/></div></div></div><br class="figure-break"/><p>Same admin user view operation but when using the Keycloak security management provider,
        instead of the Wildfly's one, results in this screen:</p><div class="figure"><a id="d0e19950"/><p class="title"><strong>Figure 18.123. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/admin_user_view.png"/></div></div></div><br class="figure-break"/><p>Note that the user editor, when using the Keycloak sec. management provider, includes
        the user attributes management section, but it's not present when using the Wildfly's one.
        So remember that the information and actions available on the user interface depends on each
        provider's capabilities (as explained in previous sections).</p><p>Viewing a user in the user editor provides the following information (if provider
        supports it):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The user name</p></li><li class="listitem"><p>The user's attributes</p></li><li class="listitem"><p>The assigned groups</p></li><li class="listitem"><p>The assigned roles</p></li></ul></div><p>In order to <span class="bold"><strong>update or delete an existing user</strong></span>, click on
        the <span class="italic">Edit</span> button present near to the username in the user
        editor screen:</p><div class="figure"><a id="d0e19979"/><p class="title"><strong>Figure 18.124. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/admin_user_edit.png"/></div></div></div><br class="figure-break"/><p>Once the user editor presented in edit mode, different operations can be done (if the
        security management provider in use supports it):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Update the user's attributes</strong></span></p><p>A group selection popup is presented when clicking on <span class="italic">Add
                to groups</span> button:</p><div class="figure"><a id="d0e19995"/><p class="title"><strong>Figure 18.125. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/kc_user_attributes.png"/></div></div></div><br class="figure-break"/><p>This popup screen allows the user to search and select or deselect the groups
              assigned for the user currently being edited.</p></li><li class="listitem"><p><span class="bold"><strong>Update assigned groups</strong></span></p><p>A group selection popup is presented when clicking on <span class="italic">Add
                to groups</span> button:</p><div class="figure"><a id="d0e20010"/><p class="title"><strong>Figure 18.126. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/groups_selection.png"/></div></div></div><br class="figure-break"/><p>This popup screen allows the user to search and select or deselect the groups
              assigned for the user currently being edited.</p></li><li class="listitem"><p><span class="bold"><strong>Update assigned roles</strong></span></p><p>A role selection popup is presented when clicking on <span class="italic">Add
                to roles</span> button:</p><div class="figure"><a id="d0e20025"/><p class="title"><strong>Figure 18.127. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/roles_selection.png"/></div></div></div><br class="figure-break"/><p>This popup screen allows the user to search and select or deselect the roles
              assigned for the user currently being edited.</p></li><li class="listitem"><p><span class="bold"><strong>Change user's password</strong></span></p><p>A change password popup screen is presented when clicking on the <span class="italic">Change password</span> button:</p><div class="figure"><a id="d0e20040"/><p class="title"><strong>Figure 18.128. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/change_password.png"/></div></div></div><br class="figure-break"/></li><li class="listitem"><p><span class="bold"><strong>Delete user</strong></span></p><p>The user currently being edited can be deleted from the realm by clicking on the
                <span class="italic">Delete</span> button.</p></li></ul></div></div><div class="section" title="18.8.4.2. Group management"><div class="titlepage"><div><div><h4 class="title"><a id="d0e20053"/>18.8.4.2. Group management</h4></div></div></div><p>The group management interface is available from the <span class="italic">Group
          management</span> menu entry in the <span class="italic">Home</span>
        menu.</p><p>The interface is presented using two main panels: the groups explorer on the west panel
        and the group editor on the center one:</p><div class="figure"><a id="d0e20066"/><p class="title"><strong>Figure 18.129. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/group_management_perspective.png"/></div></div></div><br class="figure-break"/><p>The <span class="bold"><strong>groups explorer</strong></span>, on west panel, lists by default
        all the groups present on the application's security realm:</p><div class="figure"><a id="d0e20075"/><p class="title"><strong>Figure 18.130. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/groups_explorer.png"/></div></div></div><br class="figure-break"/><p>In addition to listing all groups, the groups explorer allows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Searching for groups</strong></span></p><p>When specifying the search pattern in the search box the users list will be
              reduced and will display only the users that match the search pattern.</p><div class="figure"><a id="d0e20088"/><p class="title"><strong>Figure 18.131. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/groups_explorer_search.png"/></div></div></div><br class="figure-break"/><p>Search patterns depend on the concrete security management provider being used by
              the application's. Please read each <a class="link" href="https://github.com/uberfire/uberfire-extensions/tree/master/uberfire-security/uberfire-security-management">provider's documentation</a> for more information.</p></li><li class="listitem"><p><span class="bold"><strong>Create new groups</strong></span></p><p>By clicking on the <span class="italic">Create new group </span>button, a
              new screen will be presented on the center panel to perform a new group creation. Once
              the new group has been created, it allows to assign users to it:</p><div class="figure"><a id="d0e20106"/><p class="title"><strong>Figure 18.132. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/new_group_assign_users.png"/></div></div></div><br class="figure-break"/></li></ul></div><p>The <span class="bold"><strong>group editor</strong></span>, on the center panel, is used to
        create, view or delete groups. Once creating a new group o clicking an existing group on the
        groups explorer, the group editor screen is opened. </p><p>To <span class="bold"><strong>view an existing group</strong></span>, click on an existing user in
        the Groups Explorer to open the Group Editor screen. For example, viewing the <span class="italic">sales</span> group results in this screen:</p><div class="figure"><a id="d0e20123"/><p class="title"><strong>Figure 18.133. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/UserAndGroupManagement/group_view.png"/></div></div></div><br class="figure-break"/><p>To <span class="bold"><strong>delete an existing group</strong></span> just click on the <span class="italic">Delete</span> button.</p></div></div></div><div class="section" title="18.9. Embedding Workbench In Your Application"><div class="titlepage"><div><div><h2 class="title"><a id="wb.Embedding"/>18.9. Embedding Workbench In Your Application</h2></div></div></div><p>As we already know, Workbench provides a set of editors to author assets in different formats. According to
    asset’s format a specialized editor is used.</p><p>One additional feature provided by Workbench is the ability to embed it in your own (Web) Applications thru it's
      <span class="bold"><strong>standalone</strong></span> mode. So, if you want to edit rules, processes, decision tables,
    etc... in your own applications without switch to Workbench, you can.</p><p>In order to embed Workbench in your application all you'll need is the Workbench application deployed and
    running in a web/application server and, from within your own web applications, an iframe with proper HTTP query
    parameters as described in the following table.</p><div class="table"><a id="d0e20147"/><p class="title"><strong>Table 18.2. HTTP query parameters for standalone mode</strong></p><div class="table-contents"><table summary="HTTP query parameters for standalone mode" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center">Parameter Name</th><th align="center">Explanation</th><th align="center">Allow multiple values</th><th align="center">Example</th></tr></thead><tbody><tr><td align="center">standalone</td><td>With just the presence of this parameter workbench will switch to standalone mode.</td><td align="center">no</td><td>(none)</td></tr><tr><td align="center">path</td><td>Path to the asset to be edited. Note that asset should already exists.</td><td align="center">no</td><td>git://master@uf-playground/todo.md</td></tr><tr><td align="center">perspective</td><td>Reference to an existing perspective name.</td><td align="center">no</td><td>org.guvnor.m2repo.client.perspectives.GuvnorM2RepoPerspective</td></tr><tr><td align="center">header</td><td>Defines the name of the header that should be displayed (useful for context menu headers).</td><td align="center">yes</td><td>ComplementNavArea</td></tr></tbody></table></div></div><br class="table-break"/><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Path and Perspective parameters are mutually exclusive, so can't be used together.</p></div></div><div class="section" title="18.10. Asset Management"><div class="titlepage"><div><div><h2 class="title"><a id="wb.AssetManagement"/>18.10. Asset Management</h2></div></div></div><div class="section" title="18.10.1. Asset Management Overview"><div class="titlepage"><div><div><h3 class="title"><a id="wb.assetMgmtOverview"/>18.10.1. Asset Management Overview</h3></div></div></div><p>This section of the documentation describes the main features included that contribute to the Asset Management
            functionality provided in the KIE Workbench and KIE Drools Workbench. All the features described here are entirely optional,
            but the usage is recommended if you are planning to have multiple projects. All the Asset Management features try to impose 
            good practices on the repository structure that will make the maintainace, versioning and distribution of the projects simple and based on standards. 
            All the Asset Management features are implemented using jBPM Business Processes, which means that the 
            logic can be reused for external applications as well as adapted for domain specific requirements when needed.
        </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>You must set the "kiemgmt" role to your user to be able to use the Asset Management Features</p></div></div><div class="section" title="18.10.2. Managed vs Unmanaged Repositories"><div class="titlepage"><div><div><h3 class="title"><a id="wb.assetMgmtManagedVsUnmanaged"/>18.10.2. Managed vs Unmanaged Repositories</h3></div></div></div><p>
        Since the creation of the assets management features repositories can be classified into Managed or Unmanaged.
      </p><div class="section" title="18.10.2.1. Managed Repositories"><div class="titlepage"><div><div><h4 class="title"><a id="wb.assetMgmtManagedRepositories"/>18.10.2.1. Managed Repositories</h4></div></div></div><p>All new assets management  features are available for this type of repositories. Additionally a managed
          repository can be "Single Project" or "Multi Project".
        </p><p>A "Single Project" managed repository will contain just one Project. And a "Multi Project" managed
          repository can contain multiple Projects. All of them related through the same parent, and they will share the
          same group and version information.
        </p></div><div class="section" title="18.10.2.2. Unmanaged Repositories"><div class="titlepage"><div><div><h4 class="title"><a id="wb.assetMgmtUnManagedRepositories"/>18.10.2.2. Unmanaged Repositories</h4></div></div></div><p>Assets management features are not available for this type or repositories and they basically behave the
          same as the repositories created with previous workbench versions.</p></div></div><div class="section" title="18.10.3. Asset Management Processes"><div class="titlepage"><div><div><h3 class="title"><a id="wb.assetMgmtProcesses"/>18.10.3. Asset Management Processes</h3></div></div></div><p>There are 4 main processes which represent the stages of the Asset Management feature: Configure Repository, Promote Changes, Build and Release.</p><div class="section" title="18.10.3.1. Configure Repository"><div class="titlepage"><div><div><h4 class="title"><a id="wb.assetMgmtConfigureProcess"/>18.10.3.1. Configure Repository</h4></div></div></div><p>The Configure Repository process is in charge of the post initialization of the repository. This process will be automatically triggered if the user selects 
                to create a Managed Repository on the New repository wizzard. If they decide to use the governance feature the process will kick in and as soon as 
                the repository is created. A new development and release branches will be created. Notice that the first time that this process is called, 
                the master branch is picked and both branches (dev and release) will be based on it. 
            </p><div class="mediaobject"><img src="images/Workbench/AssetManagement/asset-mgmt-create-repo.png"/></div><p>By default the asset management feature is not enabled so make sure to select Managed Repository on the New Repository Wizzard.
                When we work inside a managed repository, the development branch is selected for the users to work on. 
                If multiple dev branches are created, the user will need to pick one.
            </p></div><div class="section" title="18.10.3.2. Promote Changes Process"><div class="titlepage"><div><div><h4 class="title"><a id="wb.assetMgmtPromoteProcess"/>18.10.3.2. Promote Changes Process</h4></div></div></div><p>
                When some work is done in the developments branch and the users reach a point where the changes needs to be tested before going into 
                production, they will start a new Promote Changes process so a more technical user can decide and review what needs to be promoted.
                The users belonging to the "kiemgmt" group will see a new Task in their Group Task List which will contain all the files that
                had been changed.

                The user needs to select the assets that will be promoting via the UI. The underlying process will be cherry-picking the commits selected by 
                the user to the release branch. The user can specify that a review is needed by a more technical user.
            </p><p>
                This process can be repeated multiple times if needed before creating the artifacts for the release.
            </p><div class="mediaobject"><img src="images/Workbench/AssetManagement/asset-mgmt-promote.png"/></div></div><div class="section" title="18.10.3.3. Build Process"><div class="titlepage"><div><div><h4 class="title"><a id="wb.assetMgmtBuildProcess"/>18.10.3.3. Build Process</h4></div></div></div><p>
                The Build process can be triggered to build our projects from different branches. This allows us to have a more flexible way to 
                build and deploy our projects to different runtimes. 
            </p><div class="mediaobject"><img src="images/Workbench/AssetManagement/asset-mgmt-build.png"/></div><p>

            </p></div><div class="section" title="18.10.3.4. Release Process"><div class="titlepage"><div><div><h4 class="title"><a id="wb.assetMgmtReleaseProcess"/>18.10.3.4. Release Process</h4></div></div></div><p>
                The release process is triggered at any time when the user decided that it is time to generate a release of the project that he/she 
                is working on. This process will build the project (calling the Build Process) and it will update all the maven artifacts to the next version. 
            </p><div class="mediaobject"><img src="images/Workbench/AssetManagement/asset-mgmt-release.png"/></div></div></div><div class="section" title="18.10.4. Usage Flow"><div class="titlepage"><div><div><h3 class="title"><a id="wb.assetMgmtUsageFlow"/>18.10.4. Usage Flow</h3></div></div></div><p>This section describes the common usage flow for the asset management features showing all the 
            screens involved. 
        </p><p>The first contact with the Asset Management features starts on the Repository creation.</p><div class="mediaobject"><img src="images/Workbench/AssetManagement/new-repo-1page-wizzard.png"/></div><p>If the user chooses to create a Managed Respository a new page in the wizzard is enabled:</p><div class="mediaobject"><img src="images/Workbench/AssetManagement/new-repo-2page-wizzard.png"/></div><p>When a managed repository is created the assets management configuration process is automatically launched
          in order to create the repository branches, and the corresponding project structure is also created.</p></div><div class="section" title="18.10.5. Repository Structure"><div class="titlepage"><div><div><h3 class="title"><a id="wb.assetMgmtRepositoryStructure"/>18.10.5. Repository Structure</h3></div></div></div><p>Once a repository has been created it can be managed through the Repository Structure Screen.</p><p>To open the Repository Structure Screen for a given repository open the Project Authoring Perspective,
        browse to the given repository and select the "Repository -&gt; Repository Structure" menu option.</p><div class="figure"><a id="d0e20296"/><p class="title"><strong>Figure 18.134. Repository Structure Menu</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/AssetManagement/repo-structure-screen-menu.png" alt="Repository Structure Menu"/></div></div></div><br class="figure-break"/><div class="section" title="18.10.5.1. Single Project Managed Repository"><div class="titlepage"><div><div><h4 class="title"><a id="wb.assetMgmtRepositoryStructureManagedSingle"/>18.10.5.1. Single Project Managed Repository</h4></div></div></div><p>The following picture shows an example of a single project managed repository structure.</p><div class="figure"><a id="d0e20307"/><p class="title"><strong>Figure 18.135. Single Project Managed Repository</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/AssetManagement/repo-structure-screen-managed-single.png" alt="Single Project Managed Repository"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.10.5.2. Multi Project Managed Repository"><div class="titlepage"><div><div><h4 class="title"><a id="wb.assetMgmtRepositoryStructureManagedMulti"/>18.10.5.2. Multi Project Managed Repository</h4></div></div></div><p>The following picture shows an example of a multi project managed repository structure.</p><div class="figure"><a id="d0e20318"/><p class="title"><strong>Figure 18.136. Multi Project Managed Repository</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/AssetManagement/repo-structure-screen-managed-multi.png" alt="Multi Project Managed Repository"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.10.5.3. Unmanaged Repository"><div class="titlepage"><div><div><h4 class="title"><a id="wb.assetMgmtRepositoryStructureUnmanaged"/>18.10.5.3. Unmanaged Repository</h4></div></div></div><p>The following picture shows an example of an unmanaged repository structure.</p><div class="figure"><a id="d0e20329"/><p class="title"><strong>Figure 18.137. Unmanaged Repository</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/AssetManagement/repo-structure-screen-unmanaged.png" alt="Unmanaged Repository"/></div></div></div><br class="figure-break"/></div></div><div class="section" title="18.10.6. Managed Repositories Operations"><div class="titlepage"><div><div><h3 class="title"><a id="wb.assetMgmtManagedRepositoryOperations"/>18.10.6. Managed Repositories Operations</h3></div></div></div><p>The following picture shows the screen areas related to managed repositories operations.</p><div class="figure"><a id="d0e20340"/><p class="title"><strong>Figure 18.138. Managed Repositories Operations</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/AssetManagement/repo-structure-screen-operation-areas.png" alt="Managed Repositories Operations"/></div></div></div><br class="figure-break"/><div class="section" title="18.10.6.1. Branch Selector"><div class="titlepage"><div><div><h4 class="title"><a id="wb.assetMgmtManagedRepositoryOperationsBranchSelector"/>18.10.6.1. Branch Selector</h4></div></div></div><p>The branch selector lets to switch between the different branches created by the Configure Repository Process.</p><div class="figure"><a id="d0e20351"/><p class="title"><strong>Figure 18.139. Branch Selector</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/AssetManagement/repo-structure-screen-operation-branch-selector.png" alt="Branch Selector"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.10.6.2. Project Operations"><div class="titlepage"><div><div><h4 class="title"><a id="wb.assetMgmtManagedRepositoryAddProjectEditDelete"/>18.10.6.2. Project Operations</h4></div></div></div><p>From the repository structure screen it's also possible to create, edit or delete projects from current repository.</p><div class="figure"><a id="d0e20362"/><p class="title"><strong>Figure 18.140. Add Project to current structure</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/AssetManagement/repo-structure-screen-operation-add-project.png" alt="Add Project to current structure"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e20368"/><p class="title"><strong>Figure 18.141. Edit/Delete projects from current structure</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/AssetManagement/repo-structure-screen-operation-edit-delete-project.png" alt="Edit/Delete projects from current structure"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.10.6.3. Launch Assets Management Processes"><div class="titlepage"><div><div><h4 class="title"><a id="wb.assetMgmtManagedRepositoryCallProcess"/>18.10.6.3. Launch Assets Management Processes</h4></div></div></div><p>The assets management processes can also be launched from the Project Structure Screen.</p><div class="figure"><a id="d0e20379"/><p class="title"><strong>Figure 18.142. Launch Assets Management Processes</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/AssetManagement/repo-structure-screen-operation-lauch-processes.png" alt="Launch Assets Management Processes"/></div></div></div><br class="figure-break"/><div class="section" title="18.10.6.3.1. Launch the Configure Repository Process"><div class="titlepage"><div><div><h5 class="title"><a id="wb.assetMgmtManagedRepositoryCallConfigureProcess"/>18.10.6.3.1. Launch the Configure Repository Process</h5></div></div></div><p>Filling the parameters bellow a new instance of the Configure Repository can be started. (see Configure Repository Process)</p><div class="figure"><a id="d0e20390"/><p class="title"><strong>Figure 18.143. Configure Repository Process Parameters</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/AssetManagement/repo-structure-screen-operation-launch-configure-process.png" alt="Configure Repository Process Parameters"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.10.6.3.2. Launch the Promote Changes Process"><div class="titlepage"><div><div><h5 class="title"><a id="wb.assetMgmtManagedRepositoryCallPromoteProcess"/>18.10.6.3.2. Launch the Promote Changes Process</h5></div></div></div><p>Filling the parameters bellow a new instance of the Promote Changes Process can be started. (see Promote Changes Process)</p><div class="figure"><a id="d0e20401"/><p class="title"><strong>Figure 18.144. Promote Changes Process Parameters</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/AssetManagement/repo-structure-screen-operation-launch-promote-changes-process.png" alt="Promote Changes Process Parameters"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.10.6.3.3. Launch the Release Process"><div class="titlepage"><div><div><h5 class="title"><a id="wb.assetMgmtManagedRepositoryCallReleaseProcess"/>18.10.6.3.3. Launch the Release Process</h5></div></div></div><p>Filling the parameters bellow a new instance of the Release Process can be started. (see Release Process)</p><div class="figure"><a id="d0e20412"/><p class="title"><strong>Figure 18.145. Release Process Parameters</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/AssetManagement/repo-structure-screen-operation-launch-release-process.png" alt="Release Process Parameters"/></div></div></div><br class="figure-break"/></div></div></div></div><div class="section" title="18.11. Execution Server Management UI"><div class="titlepage"><div><div><h2 class="title"><a id="wb.ExecServerUI"/>18.11. Execution Server Management UI</h2></div></div></div><p>The Execution Server Management UI allows users create and modify Server Templates and Containers, it also allows
    users manage Remote Servers. This screen is available via Deploy -&gt; Rule Deployments menu.
  </p><div class="figure"><a id="d0e20423"/><p class="title"><strong>Figure 18.146. Execution Server Management</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/ExecServer/NewExecServerUI.png" alt="Execution Server Management"/></div></div></div><br class="figure-break"/><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The management UI is only available for KIE Managed Servers.</p></div><div class="section" title="18.11.1. Server Templates"><div class="titlepage"><div><div><h3 class="title"><a id="wb.ExecServerUITemplate"/>18.11.1. Server Templates</h3></div></div></div><p>Server templates are used to define a common configuration that can be used for multiple servers, thus the name: Template.</p><p>Server Templates can be created directly from the management UI or it's automatically created when a server connects to controller
      and there isn't a template definition for that remote server. Server templates may have one or more capabilities, such capabilities can't
      be modified, if you need modify the capabilities you'll have to create a new template. Here is the list of current capabilities:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          Rule (Drools)
        </p></li><li class="listitem"><p>
          Process (jBPM)
        </p></li><li class="listitem"><p>
          Planning (Optaplanner)
        </p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>For Planner capability it's mandatory to enable Rule's capability too.</p></div><p>In order to create a new Server Template you have to click at New Server Template button and
      follow the wizard. It's also possible to create a container during Wizard, but for now let's limit
      to just the template.
    </p><div class="figure"><a id="d0e20454"/><p class="title"><strong>Figure 18.147. New Server Template Wizard</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/ExecServer/NewServerTemplateWizard.png" alt="New Server Template Wizard"/></div></div></div><br class="figure-break"/><p>Once created you'll get the new Template listed on the left hand side, with the new
      Server Template highlighted. On the right hand side you get the 2nd level navigation
      that lists Containers and Remote Servers that are related to selected Server Template.
    </p><div class="figure"><a id="d0e20462"/><p class="title"><strong>Figure 18.148. Server Templates</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/ExecServer/ServerTemplates.png" alt="Server Templates"/></div></div></div><br class="figure-break"/><p>On top of the navigation is also possible to delete the current Server Template or
      create a copy of it.
    </p><div class="figure"><a id="d0e20470"/><p class="title"><strong>Figure 18.149. Server Template Actions</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/ExecServer/ServerTemplateActions.png" alt="Server Template Actions"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.11.2. Container"><div class="titlepage"><div><div><h3 class="title"><a id="wb.ExecServerUIContainer"/>18.11.2. Container</h3></div></div></div><p>A Container is a KIE Container configuration of the Server Template.
      Click the Add Container button to create a new container for the current Server Template.
    </p><p>The search area can help users find an specific KJARs that they are looking for.</p><div class="figure"><a id="d0e20483"/><p class="title"><strong>Figure 18.150. New Container Wizard</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/ExecServer/NewContainerWizard.png" alt="New Container Wizard"/></div></div></div><br class="figure-break"/><p>For Server Templates that have Process capabilities enabled, the Wizard has a 2nd optional step
      where users can configure some process related behaviors.
    </p><div class="figure"><a id="d0e20491"/><p class="title"><strong>Figure 18.151. Process Configuration</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/ExecServer/ProcessConfigNewContainerWizard.png" alt="Process Configuration"/></div></div></div><br class="figure-break"/><p>Once created the new Container will be displayed on the containers list just
      above the list of remote servers. Just after created a container is by default Stopped
      which is the only state that allows users to remove it.
    </p><div class="figure"><a id="d0e20499"/><p class="title"><strong>Figure 18.152. Container</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/ExecServer/Container.png" alt="Container"/></div></div></div><br class="figure-break"/><p>A Container has the following tabs available for management and/or configuration:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
          Status
        </p></li><li class="listitem"><p>
          Version Configuration
        </p></li><li class="listitem"><p>
          Process Configuration
        </p></li></ul></div><p>Status tab lists all the Remote Servers that are running the active Container.
      Each Remote Server is rendered as a Card, which displays to users status
      and endpoint.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Only started Containers are deployed to remote servers.</p></div><div class="figure"><a id="d0e20522"/><p class="title"><strong>Figure 18.153. Status Container</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/ExecServer/ContainerStatus.png" alt="Status Container"/></div></div></div><br class="figure-break"/><p>Version Configuration tab allow users change the current version of the
      Container. User's can upgrade manually to a specific version using the "Upgrade" button,
      or enable/disable the Scanner. It's also possible to execute a ScanNow operation, that
      will scan for new versions only once.
    </p><div class="figure"><a id="d0e20530"/><p class="title"><strong>Figure 18.154. Version Configuration</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/ExecServer/ContainerVersionConfiguration.png" alt="Version Configuration"/></div></div></div><br class="figure-break"/><p>Process Configuration is the same form that is displayed during New Container Wizard
      for Template Servers that have Process Capability. If Template Server doesn't have such
      capability, the action buttons will be disabled.
    </p><div class="figure"><a id="d0e20538"/><p class="title"><strong>Figure 18.155. Process Configuration</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/ExecServer/ContainerProcessConfiguration.png" alt="Process Configuration"/></div></div></div><br class="figure-break"/></div><div class="section" title="18.11.3. Remote Server"><div class="titlepage"><div><div><h3 class="title"><a id="wb.ExecServerUIRemoteServer"/>18.11.3. Remote Server</h3></div></div></div><p>Remote Server is a Managed KIE Server instance running that has a controller configured.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>By default Workbench comes with a Controller embedded.</p></div><p>The list of Remote Servers are displayed just under the list of Containers.
      Once selected the screens reveals the Remote Server details and a list of cards,
      each card represents a running Container.
    </p><div class="figure"><a id="d0e20554"/><p class="title"><strong>Figure 18.156. Remote Servers</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/ExecServer/RemoteServers.png" alt="Remote Servers"/></div></div></div><br class="figure-break"/></div></div></div><div class="chapter" title="Chapter 19. Authoring Rule Assets"><div class="titlepage"><div><div><h2 class="title"><a id="drools.AuthoringAssets"/>Chapter 19. Authoring Rule Assets</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#drools.NewPackage">19.1. Creating a package</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e20580">19.1.1. Empty package</a></span></dt><dt><span class="section"><a href="#d0e20599">19.1.2. Copy, Rename and Delete Packages</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.GuidedRuleEditor">19.2. Business rules with the guided editor</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.GuidedRuleEditorParts">19.2.1. Parts of the Guided Rule Editor</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorLHS">19.2.2. The "WHEN" (left-hand side) of a Rule</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorRHS">19.2.3. The "THEN" (right-hand side) of a Rule</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorOptionalAttributes">19.2.4. Optional attributes</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorToolbar">19.2.5. Pattern/Action toolbar</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorEnumerations">19.2.6. User driven drop down lists</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorDSL">19.2.7. Augmenting with DSL sentences</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleEditorComplexExample">19.2.8. A more complex example:</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.GuidedRuleTemplateEditor">19.3. Templates of assets/rules</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.GuidedRuleTemplateEditorCreating">19.3.1. Creating a rule template</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleTemplateEditorDefining">19.3.2. Define the template</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleTemplateEditorDefiningData">19.3.3. Defining the template data</a></span></dt><dt><span class="section"><a href="#drools.GuidedRuleTemplateEditorGeneratedDRL">19.3.4. Generated DRL</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.GuidedDecisionTableEditor">19.4. Guided decision tables (web based)</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.GuidedDecisionTableEditorTypesOfDecisionTable">19.4.1. Types of decision table</a></span></dt><dt><span class="section"><a href="#drools.GuidedDecisionTableEditorConcepts">19.4.2. Main components\concepts</a></span></dt><dt><span class="section"><a href="#drools.GuidedDecisionTableEditorDefining">19.4.3. Defining a web based decision table</a></span></dt><dt><span class="section"><a href="#drools.GuidedDecisionTableEditorRuleDefinitions">19.4.4. Rule definition</a></span></dt><dt><span class="section"><a href="#drools.GuidedDecisionTableEditorAuditLog">19.4.5. Audit Log</a></span></dt><dt><span class="section"><a href="#drools.GuidedDecisionTableEditorVerification">19.4.6. Real Time Validation and Verification</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.GuidedDecisionTreeEditor">19.5. Guided Decision Trees</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e21644">19.5.1. The initial editor layout</a></span></dt><dt><span class="section"><a href="#d0e21692">19.5.2. First steps</a></span></dt><dt><span class="section"><a href="#d0e21730">19.5.3. Editing Data Object nodes</a></span></dt><dt><span class="section"><a href="#d0e21743">19.5.4. Editing Field Constraint nodes</a></span></dt><dt><span class="section"><a href="#d0e21756">19.5.5. Editing Action nodes</a></span></dt><dt><span class="section"><a href="#d0e21789">19.5.6. Managing the tree</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.XLSDecisionTable">19.6. Spreadsheet decision tables</a></span></dt><dt><span class="section"><a href="#drools.GuidedScoreCardEditor">19.7. Scorecards</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.GuidedScoreCardEditorSetupParameters">19.7.1. (a) Setup Parameters</a></span></dt><dt><span class="section"><a href="#drools.GuidedScoreCardEditorCharacteristics">19.7.2. (b) Characteristics</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.TestScenarioEditor">19.8. Test Scenario</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.KSessionSelector">19.8.1. Knowledge Session Selector</a></span></dt><dt><span class="section"><a href="#drools.TestScenarioEditorGivenSection">19.8.2. Given Section</a></span></dt><dt><span class="section"><a href="#drools.TestScenarioEditorExpectedSection">19.8.3. Expect Section</a></span></dt><dt><span class="section"><a href="#drools.TestScenarioEditorGlobalSection">19.8.4. Global Section</a></span></dt><dt><span class="section"><a href="#drools.TestScenarioEditorInpuotSection">19.8.5. New Input Section</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.FunctionEditor">19.9. Functions</a></span></dt><dt><span class="section"><a href="#drools.DSLEditor">19.10. DSL editor</a></span></dt><dt><span class="section"><a href="#drools.EnumerationEditor">19.11. Data enumerations (drop down list configurations)</a></span></dt><dd><dl><dt><span class="section"><a href="#drools.AdvancedEnumConcepts">19.11.1. Advanced enumeration concepts</a></span></dt></dl></dd><dt><span class="section"><a href="#drools.DRLEditor">19.12. Technical rules (DRL)</a></span></dt></dl></div><div class="section" title="19.1. Creating a package"><div class="titlepage"><div><div><h2 class="title"><a id="drools.NewPackage"/>19.1. Creating a package</h2></div></div></div><p>Configuring packages is generally something that is done once, and by
  someone with some experience with rules/models. Generally speaking, very few
  people will need to configure packages, and once they are setup, they can be
  copied over and over if needed. Package configuration is most definitely a
  technical task that requires the appropriate expertise.</p><p>All assets live in "packages" in Drools Workbench - a package is like a
  folder (it also serves as a "namespace"). A home folder for rule assets to
  live in. Rules in particular need to know what the fact model is, what the
  namespace is etc.</p><p>So while rules (and assets in general) can appear in any number of
    categories, they only live in one package. If you think of Drools Workbench as a
  file system, then each package is a folder, and the assets live in that
  folder - as one big happy list of files.</p><p>To create an empty package select "Package" from the "New item" menu.</p><div class="figure"><a id="d0e20574"/><p class="title"><strong>Figure 19.1. New Package</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/newItemMenu.png" align="middle" alt="New Package"/></div></div></div><br class="figure-break"/><div class="section" title="19.1.1. Empty package"><div class="titlepage"><div><div><h3 class="title"><a id="d0e20580"/>19.1.1. Empty package</h3></div></div></div><p>An empty package can be created by simply specifying a name.</p><div class="figure"><a id="d0e20585"/><p class="title"><strong>Figure 19.2. New empty Package</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/newItem-package.png" align="middle" alt="New empty Package"/></div></div></div><br class="figure-break"/><p>Once the Package has been created it will appear in the Project Explorer.</p><div class="figure"><a id="d0e20593"/><p class="title"><strong>Figure 19.3. Project Explorer showing new Package</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/newItem-package-project-explorer.png" align="middle" alt="Project Explorer showing new Package"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.1.2. Copy, Rename and Delete Packages"><div class="titlepage"><div><div><h3 class="title"><a id="d0e20599"/>19.1.2. Copy, Rename and Delete Packages</h3></div></div></div><p>As already mentioned on <a class="link" href="#wb.ProjectExplorerCopyRenameDeleteActions" title="18.7.4.6. Copy, Rename, Delete and Download Actions">Project Explorer</a>
      section, users can copy, rename or delete a package directly from Project Explorer.</p><p>As you can see in the following screenshots, those operations behave very similar to counter part actions in
      most workbench editors.</p><div class="figure"><a id="d0e20609"/><p class="title"><strong>Figure 19.4. Copying a Package</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/package-copy.png" align="middle" alt="Copying a Package"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e20615"/><p class="title"><strong>Figure 19.5. Renaming a Package</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/package-rename.png" align="middle" alt="Renaming a Package"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e20621"/><p class="title"><strong>Figure 19.6. Excluding a Package</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/package-delete.png" align="middle" alt="Excluding a Package"/></div></div></div><br class="figure-break"/></div></div><div class="section" title="19.2. Business rules with the guided editor"><div class="titlepage"><div><div><h2 class="title"><a id="drools.GuidedRuleEditor"/>19.2. Business rules with the guided editor</h2></div></div></div><p>Guided Rules are authored with a UI to control and prompt user input based on knowledge of the object
    model.</p><p>This can also be augmented with DSL sentences.</p><div class="section" title="19.2.1. Parts of the Guided Rule Editor"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedRuleEditorParts"/>19.2.1. Parts of the Guided Rule Editor</h3></div></div></div><p>The Guided Rule Editor is composed of three main sections.</p><p>The following diagram shows the editor in action. The following descriptions apply to the lettered boxes in
    the diagram:-</p><div class="figure"><a id="d0e20641"/><p class="title"><strong>Figure 19.7. The guided BRL editor</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/GuidedEditor-overview.png" align="middle" alt="The guided BRL editor"/></div></div></div><br class="figure-break"/><p>A : The different parts of a rule:-</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The "WHEN" part, or conditions, of the rule.</p></li><li class="listitem"><p>The "THEN" action part of the rule.</p></li><li class="listitem"><p>Optional attributes that may effect the operation of the rule.</p></li></ul></div></div><div class="section" title="19.2.2. The &#34;WHEN&#34; (left-hand side) of a Rule"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedRuleEditorLHS"/>19.2.2. The "WHEN" (left-hand side) of a Rule</h3></div></div></div><p>B : This shows a pattern which is declaring that the rule is looking for a "LoanApplication" fact (the fields
    are listed below, in this case none). Another pattern, "Applicant", is listed below "LoanApplication". Fields
    "creditRating" and "applicationDate" are listed. Clicking on the fact name ("LoanApplication") will pop-up a list of
    options to add to the fact declaration:-</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Add more fields (e.g. their "location").</p></li><li class="listitem"><p>Assign a variable name to the fact (which you can use later on if needs be)</p></li><li class="listitem"><p>Add "multiple field" constraints - i.e. constraints that span across fields (e.g. age &gt; 42 or risk
          &gt; 2).</p></li></ul></div><p>C : The "minus" icon ("[-]") indicates you can remove something. In this case it would remove the whole
    "LoanApplication" fact declaration. Depending upon the placement of the icon different components of the rule
    declaration can be removed, for example a Fact Pattern, Field Constraint, other Conditional Element ("exists", "not
    exists", "from" etc) or an Action.</p><p>D : The "plus" icon ("+") allows you to add more patterns to the condition or the action part of the rule, or
    more attributes. In all cases, a popup option box is provided. For the "WHEN" part of the rule, you can choose from
    a list of Conditional Elements to add: </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A Constraint on a Fact: it will give you a list of facts.</p></li><li class="listitem"><p>"The following does not exist": the fact plus constraints must not exist.</p></li><li class="listitem"><p>"The following exists": at least one match should exist (but there only needs to be one - it will not
          trigger for each match).</p></li><li class="listitem"><p>"Any of the following are true": any of the patterns can match (you then add patterns to these higher
          level patterns).</p></li><li class="listitem"><p>"From": this will insert a new From Conditional Element to the rule.</p></li><li class="listitem"><p>"From Accumulate": this will insert a new Accumulate Conditional Element to the rule.</p></li><li class="listitem"><p>"From Collect": this will insert a new Collect Conditional Element to the rule.</p></li><li class="listitem"><p>"From Entry-point": this allows you to define an Entry Point for the pattern.</p></li><li class="listitem"><p>"Free Form DRL": this will let you insert a free chunk of DRL.</p></li></ul></div><p> If you just put a fact (like is shown above) then all the patterns are combined together so they
    are all true ("and").</p><p>E : This shows the constraint for the "creditRating" field. Looking from left to right you find:-</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The field name: "creditRating". Clicking on it you can assign a variable name to it, or access nested
          properties of it.</p></li><li class="listitem"><p>A list of constraint operations ("equal to" being selected): The content of this list changes depending
          on the field's data type.</p></li><li class="listitem"><p>The value field: It could be one of the following:-</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>A literal value: depending on the field's data type different components will be displayed:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>String -&gt; Textbox</p></li><li class="listitem"><p>Any numerical value -&gt; Textbox restricting entry to values valid for the numerical sub-type
                  (e.g. a byte can hold values from -128 to 127). BigDecimal and BigInteger data-types are also
                  supported. Please ensure the appropriate Class has been imported in the Package configuration. The
                  import will be added automatically if a POJO model has been uploaded that exposes an accessor or
                  mutator for a BigDecimal or BigInteger field. BigDecimal values are automatically suffixed with "B"
                  indicating to the underlying Engine that the literal value should be interpreted as a BigDecimal.
                  BigIntegers are suffixed with "I". The user does not need to enter the suffix.</p></li><li class="listitem"><p>Date -&gt; Calendar</p></li><li class="listitem"><p>Enumeration -&gt; Listbox</p></li><li class="listitem"><p>Boolean -&gt; Checkbox</p></li></ul></div></li><li class="listitem"><p>A "formula": this is an expression which is calculated (this is for advanced users only)</p></li><li class="listitem"><p>An Expression - this will let you use an Expression Builder to build up a full mvel expression. (At
              the moment only basic expressions are supported)</p></li></ol></div></li></ul></div><p>F : This shows the constraint for the "applicationDate" field. Looking from left to right you find:
    </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The field name: "applicationDate".</p></li><li class="listitem"><p>A list of constraint operations: "after" being selected.</p></li><li class="listitem"><p>A "clock" icon. Since the "applicationDate" is a Date data-type the list of available operators includes
          those relating to Complex Event Processing (CEP). When a CEP operator is used this additional icon is
          displayed to allow you to enter additional CEP operator parameters. Clicking the "clock" will cycle the
          available combinations of CEP operator parameters.</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Complex Event Processing operators are also available when the Fact has been declared as an event. Refer
          to the "Fact Model" chapter of this user-guide for details on how to add annotations to your Fact
          model. Events
          have access to the full range of CEP operators; Date field-types are restricted to "after", "before" and
          "coincides".</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Facts annotated as Events can also have CEP sliding windows defined.</p></div><div class="section" title="19.2.2.1. Adding Patterns"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedRuleEditorAddingPatterns"/>19.2.2.1. Adding Patterns</h4></div></div></div><p>When clicking on the + button of the WHEN section, a new popup will appear letting you to add a new Pattern
      to the Rule. The popup will looks similar to the image below. In this popup you could select the type of Pattern
      to add by selecting one of the list items. In the list you will have an entry for each defined Fact Type, in
      addition to the already mentioned Conditional Elements like "exists", "doesn't exist", "from", "collect",
      "accumulate", "from entry-point" and "free form DRL". Once you have selected one of these elements, you can add a
      new Pattern by clicking on the "Ok" button. The new pattern will be added at the bottom of the rule's left hand
      side. If you want to choose a different position, you can use the combobox placed at the top of the popup.</p><p>You can also open this popup by clicking in the [+] button from a Pattern's action toolbar. If that is the
      case, the pop-up that appears wouldn't constraint the position combobox, because the new Pattern will be added just
      after the Pattern where you clicked.</p><div class="figure"><a id="d0e20770"/><p class="title"><strong>Figure 19.8. Adding Patterns</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/GuidedLHSPatterns.png" align="middle" alt="Adding Patterns"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.2.2.2. Adding constraints"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedRuleEditorAddingConstraints"/>19.2.2.2. Adding constraints</h4></div></div></div><p>The below dialog is what you will get when you want to add constraints to a fact. In the top half are the
      simple options: you can either add a field constraint straight away (a list of fields of the applicable fact will
      be shown), or you can add a "Multiple field constraint" using AND or OR operands. In the bottom half of the window
      you have the Advanced options: you can add a formula (which resolves to True or False - this is like in the
      example above: "... salary &gt; (2500 * 4.1)". You can also assign a Variable name to the fact (which means you
      can then access that variable on the action part of the rule, to set a value etc).</p><div class="figure"><a id="d0e20781"/><p class="title"><strong>Figure 19.9. Adding constraints</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/GuidedLHSConstraints.png" align="middle" alt="Adding constraints"/></div></div></div><br class="figure-break"/></div></div><div class="section" title="19.2.3. The &#34;THEN&#34; (right-hand side) of a Rule"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedRuleEditorRHS"/>19.2.3. The "THEN" (right-hand side) of a Rule</h3></div></div></div><p>H : This shows an "action" of the rule, the Right Hand Side of a rule consists in a list of actions. In this
    case, we are updating the "explanation" field of the "LoanApplication" fact. There are quite a few other types of
    actions you can use:-</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Insert a completely new Fact and optionally set a field on the Fact.</p><p>The value field can be one of the following:-</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>A literal value: depending on the field's data type different components will be displayed:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>String -&gt; Textbox</p></li><li class="listitem"><p>Any numerical value -&gt; Textbox restricting entry to values valid for the numerical sub-type
                  (e.g. a byte can hold values from -128 to 127). BigDecimal and BigInteger data-types are also
                  supported. Please ensure the appropriate Class has been imported in the Package configuration. The
                  import will be added automatically if a POJO model has been uploaded that exposes an accessor or
                  mutator for a BigDecimal or BigInteger field. BigDecimal values are automatically suffixed with "B"
                  indicating to the underlying Engine that the literal value should be interpreted as a BigDecimal.
                  BigIntegers are suffixed with "I". The user does not need to enter the suffix.</p></li><li class="listitem"><p>Date -&gt; Calendar</p></li><li class="listitem"><p>Enumeration -&gt; Listbox</p></li><li class="listitem"><p>Boolean -&gt; Checkbox</p></li></ul></div></li><li class="listitem"><p>A variable bound to a Fact or Field in the left-hand side. The data-type of the field being set must
              match the data-type of the variable.</p></li><li class="listitem"><p>A "formula": this is an expression which is calculated (this is for advanced users only)</p></li></ol></div></li><li class="listitem"><p>Logically insert a completely new Fact (see "Truth Maintenance" in the Expert documentation) and
          optionally set a field on the Fact.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>A literal value: depending on the field's data type different components will be displayed:</p><p>The value field can be one of the following:-</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>A literal value: depending on the field's data type different components will be
                  displayed:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>String -&gt; Textbox</p></li><li class="listitem"><p>Any numerical value -&gt; Textbox restricting entry to values valid for the numerical
                      sub-type (e.g. a byte can hold values from -128 to 127). BigDecimal and BigInteger data-types are
                      also supported. Please ensure the appropriate Class has been imported in the Package
                      configuration. The import will be added automatically if a POJO model has been uploaded that
                      exposes an accessor or mutator for a BigDecimal or BigInteger field. BigDecimal values are
                      automatically suffixed with "B" indicating to the underlying Engine that the literal value should
                      be interpreted as a BigDecimal. BigIntegers are suffixed with "I". The user does not need to enter
                      the suffix.</p></li><li class="listitem"><p>Date -&gt; Calendar</p></li><li class="listitem"><p>Enumeration -&gt; Listbox</p></li><li class="listitem"><p>Boolean -&gt; Checkbox</p></li></ul></div></li><li class="listitem"><p>A variable bound to a Fact or Field in the left-hand side. The data-type of the field being set
                  must match the data-type of the variable.</p></li><li class="listitem"><p>A "formula": this is an expression which is calculated (this is for advanced users only)</p></li></ol></div></li><li class="listitem"><p>A variable bound to a Fact or Field in the left-hand side. The data-type of the field being set must
              match the data-type of the variable.</p></li><li class="listitem"><p>A "formula": this is an expression which is calculated (this is for advanced users only)</p></li></ol></div></li><li class="listitem"><p>Modify a field of an existing fact (which tells the engine the fact has changed).</p><p>The value field can be one of the following:-</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>A literal value: depending on the field's data type different components will be displayed:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>String -&gt; Textbox</p></li><li class="listitem"><p>Any numerical value -&gt; Textbox restricting entry to values valid for the numerical sub-type
                  (e.g. a byte can hold values from -128 to 127). BigDecimal and BigInteger data-types are also
                  supported. Please ensure the appropriate Class has been imported in the Package configuration. The
                  import will be added automatically if a POJO model has been uploaded that exposes an accessor or
                  mutator for a BigDecimal or BigInteger field. BigDecimal values are automatically suffixed with "B"
                  indicating to the underlying Engine that the literal value should be interpreted as a BigDecimal.
                  BigIntegers are suffixed with "I". The user does not need to enter the suffix.</p></li><li class="listitem"><p>Date -&gt; Calendar</p></li><li class="listitem"><p>Enumeration -&gt; Listbox</p></li><li class="listitem"><p>Boolean -&gt; Checkbox</p></li></ul></div></li><li class="listitem"><p>A variable bound to a Fact or Field in the left-hand side. The data-type of the field being set must
              match the data-type of the variable.</p></li><li class="listitem"><p>A "formula": this is an expression which is calculated (this is for advanced users only)</p></li></ol></div></li><li class="listitem"><p>Set a field on a fact (in which case the engine doesn't know about the change - normally because you are
          setting a result).</p><p>The value field can be one of the following:-</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>A literal value: depending on the field's data type different components will be displayed:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>String -&gt; Textbox</p></li><li class="listitem"><p>Any numerical value -&gt; Textbox restricting entry to values valid for the numerical sub-type
                  (e.g. a byte can hold values from -128 to 127). BigDecimal and BigInteger data-types are also
                  supported. Please ensure the appropriate Class has been imported in the Package configuration. The
                  import will be added automatically if a POJO model has been uploaded that exposes an accessor or
                  mutator for a BigDecimal or BigInteger field. BigDecimal values are automatically suffixed with "B"
                  indicating to the underlying Engine that the literal value should be interpreted as a BigDecimal.
                  BigIntegers are suffixed with "I". The user does not need to enter the suffix.</p></li><li class="listitem"><p>Date -&gt; Calendar</p></li><li class="listitem"><p>Enumeration -&gt; Listbox</p></li><li class="listitem"><p>Boolean -&gt; Checkbox</p></li></ul></div></li><li class="listitem"><p>A variable bound to a Fact or Field in the left-hand side. The data-type of the field being set must
              match the data-type of the variable.</p></li><li class="listitem"><p>A "formula": this is an expression which is calculated (this is for advanced users only)</p></li></ol></div></li><li class="listitem"><p>Delete a fact from the Engine's Working Memory.</p></li><li class="listitem"><p>Add Facts to existing global lists.</p></li><li class="listitem"><p>Call a method on a variable.</p></li><li class="listitem"><p>Write a chunk of free form code.</p></li></ul></div></div><div class="section" title="19.2.4. Optional attributes"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedRuleEditorOptionalAttributes"/>19.2.4. Optional attributes</h3></div></div></div><p>The attributes section of a rule provides the means to define metadata and attributes (such as "salience",
    "no-loop" etc).</p><p>Click on the "+" icon to add a new metadata or attribute definition. Each defined will appear listed in this
    section.</p><p>Click on the "-" icon beside each metadata or attribute to remove it.</p><div class="section" title="19.2.4.1. Salience"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedRuleEditorOptionalAttributesSalience"/>19.2.4.1. Salience</h4></div></div></div><p>
			Each rule has a salience value which is an integer value that defaults to zero. The salience value 
			represents the priority of the rule with higher salience values representing higher priority. Salience 
			values can be positive or negative.
		</p></div></div><div class="section" title="19.2.5. Pattern/Action toolbar"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedRuleEditorToolbar"/>19.2.5. Pattern/Action toolbar</h3></div></div></div><p>G : Next to each Pattern or Action you will find a toolbar containing 3 buttons.</p><p>The first "+" icon lets you insert a new Pattern/Action at an arbitrary location. The other "+" icons allow
    you to insert a new Pattern/Action below that you have selected.</p><p>The remaining arrow icons allow you to move the current Pattern/Action up or down.</p></div><div class="section" title="19.2.6. User driven drop down lists"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedRuleEditorEnumerations"/>19.2.6. User driven drop down lists</h3></div></div></div><div class="figure"><a id="d0e20965"/><p class="title"><strong>Figure 19.10. Data enumeration showing as a drop down list</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/EnumDropDown.png" align="middle" alt="Data enumeration showing as a drop down list"/></div></div></div><br class="figure-break"/><p>Note that is it possible to limit field values to items in a pre-configured list. This list is either defined
    by a Java enumeration or configured as part of the package (using a data enumeration to provide values for the drop
    down list). These values can be a fixed list, or (for example) loaded from a database. This is useful for codes, and
    other fields where there are set values. It is also possible to have what is displayed on screen, in a drop down, be
    different to the value (or code) used in a rule. See the section on data enumerations for how these are
    configured.</p><p>It is possible to define a list of values for one field that are dependent upon the value of one or more other
    fields, on the same Fact (e.g. a list of "Cities" depending on the selected "Country region"). Please refer to the
    section on "Enumerations" for more information.</p></div><div class="section" title="19.2.7. Augmenting with DSL sentences"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedRuleEditorDSL"/>19.2.7. Augmenting with DSL sentences</h3></div></div></div><p>If the package the rule is part of has a DSL configuration, when you add conditions or actions, then it
    will provide a list of "DSL Sentences" which you can choose from - when you choose one, it will add a row to the
    rule - where the DSL specifies values come from a user, then a edit box (text) will be shown (so it ends up looking
    a bit like a form). This is optional, and there is another DSL editor. Please note that the DSL capabilities in this
    editor are slightly less then the full set of DSL features (basically you can do [when] and [then] sections of the
    DSL only - which is no different to drools 3 in effect).</p><p>The following diagram shows the DSL sentences in action in the guided editor:</p><div class="figure"><a id="d0e20982"/><p class="title"><strong>Figure 19.11. DSL in guided editor</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/GuidedDSL.png" align="middle" alt="DSL in guided editor"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.2.8. A more complex example:"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedRuleEditorComplexExample"/>19.2.8. A more complex example:</h3></div></div></div><div class="figure"><a id="d0e20991"/><p class="title"><strong>Figure 19.12. A more complex BRL example</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/GuidedComplex.png" align="middle" alt="A more complex BRL example"/></div></div></div><br class="figure-break"/><p>In the above example, you can see how to use a mixture of Conditional Elements, literal values, and formulas.
    The rule has 4 "top level" Patterns and 1 Action. The "top level" Patterns are:</p><div class="orderedlist"><ol class="orderedlist" type="1" compact="compact"><li class="listitem"><p>A Fact Pattern on Person. This Pattern contains two field constraints: one for birthDate field and the
        other one is a formula. Note that the value of the birthDate restriction is selected from a calendar. Another
        thing to note is that you can make calculations and use nested fields in the formula restriction (i.e.
        car.brand). Finally, we are setting a variable name ($p) to the Person Fact Type. You can then use this variable
        in other Patterns.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The generated DRL from this Pattern will be:</p><pre><code class="no-highlight">$p : Person( birthDate &lt; "19-Dec-1982" , eval( car.brand == "Ford" &amp;&amp; salary &gt; (2500 * 4.1) ))</code></pre></div></li><li class="listitem"><p>A From Pattern. This condition will create a match for every Address whose street name is "Elm St." from
        the Person's list of addresses. The left side of the from is a regular Fact Pattern and the right side is an
        Expression Builder that let us inspect variable's fields.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The generated DRL from this Pattern will be: <code class="code">Address( street == "Elm St." ) from
          $p.addresses</code></p></div></li><li class="listitem"><p>A "Not Exist" Conditional Element. This condition will match when its content doesn't create a match. In
        this case, its content is a regular Fact Pattern (on Person). In this Fact Pattern you can see how variables
        ($p) could be used inside a formula value.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The generated DRL from this Pattern will be: <code class="code">not Person( salary == ( $p.salary * 2 )
          )</code></p></div></li><li class="listitem"><p>A "From Accumulate" Conditional Element. This is maybe one of the most complex Patterns you can use. It
        consist in a Left Pattern (It must be a Fact Pattern. In this case is a Number Pattern. The Number is named
        $totalAddresses), a Source Pattern (Which could be a Fact Pattern, From, Collect or Accumulate conditional
        elements. In this case is an Address Pattern Restriction with a field restriction in its zip field) and a
        Formula Section where you can use any built-in or custom Accumulate Function (in this example a count() function
        is used). Basically, this Conditional Element will count the addresses having a zip code of 43240 from the
        Person's list of addresses.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The generated DRL from this Pattern will be: <code class="code">$totalAddresses : Number() from accumulate ($a :
          Address( zipCode == " 43240") from $p.addresses, count($a)) </code></p></div></li></ol></div></div></div><div class="section" title="19.3. Templates of assets/rules"><div class="titlepage"><div><div><h2 class="title"><a id="drools.GuidedRuleTemplateEditor"/>19.3. Templates of assets/rules</h2></div></div></div><p>The guided rule editor is great when you need to define a single rule,
  however if you need to define multiple rules following the same structure
  but with different values in field constraints or action sections a "Rule
  Template" is a valuable asset. Rule templates allow the user to define a
  rule structure with place-holders for values that are to be interpolated
  from a table of data. Literal values, formulae and expressions can also
  continue to be used.</p><p>Rule Templates can often be used as an alternative for Decision Tables
    in Drools Workbench.</p><div class="section" title="19.3.1. Creating a rule template"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedRuleTemplateEditorCreating"/>19.3.1. Creating a rule template</h3></div></div></div><p>To create a template for a rule simply select the "Guided Rule
    Template" from the "New Item" menu.</p></div><div class="section" title="19.3.2. Define the template"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedRuleTemplateEditorDefining"/>19.3.2. Define the template</h3></div></div></div><p>Once a rule template has been created the editor is displayed. The
    editor takes the form of the standard guided editor explained in more
    detail under the "Rule Authoring" section. As the rule is constructed you
    are given the ability to insert "Template Keys" as place-holders within
    your field constraints and action sections. Literal values, formulae and
    expressions can continue to be used as in the standard guided
    editor.</p><div class="figure"><a id="d0e21049"/><p class="title"><strong>Figure 19.13. Template Key popup</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/guided-template1.png" align="middle" alt="Template Key popup"/></div></div></div><br class="figure-break"/><p>The following screenshot illustrates a simple rule that has been
    defined with a "Template Key" for the applicants' maximum age, minimum age
    and credit rating. The template keys have been defined as "$max_age",
    "$min_age" and "$cr" respectively.</p><div class="figure"><a id="d0e21057"/><p class="title"><strong>Figure 19.14. Rule template in the guided editor</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/guided-template2.png" align="middle" alt="Rule template in the guided editor"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.3.3. Defining the template data"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedRuleTemplateEditorDefiningData"/>19.3.3. Defining the template data</h3></div></div></div><p>When you have completed the definition of your rule template you
    need to enter the data that will be used to interpolate the "Template Key"
    place-holders. Drools Workbench provides the facility to enter data in a
    flexible grid within the guided editor screen. The data entry section is located on the Data tab within the editor.</p><p>The rule template data grid is very flexible; with different pop-up
    editors for the underlying fields' data-types. Columns can be resized and
    sorted; and cells can be merged and grouped to facilitate rapid data
    entry.</p><p>One row of data interpolates the "Template Key" place-holders for a
    single rule; thus one row becomes one rule.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If any cells for a row are left blank a rule for the applicable
      row is not generated.</p></div><div class="figure"><a id="d0e21075"/><p class="title"><strong>Figure 19.15. Template data grid</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/guided-template3.png" align="middle" alt="Template data grid"/></div></div></div><br class="figure-break"/><div class="section" title="19.3.3.1. Cell merging"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedRuleTemplateEditorCellMerging"/>19.3.3.1. Cell merging</h4></div></div></div><p>The icon in the top left of the grid toggles cell merging on and
      off. When cells are merged those in the same column with identical
      values are merged into a single cell. This simplifies changing the value
      of multiple cells that shared the same original value. When cells are
      merged they also gain an icon in the top-left of the cell that allows
      rows spanning the merged cell to be grouped.</p><div class="figure"><a id="d0e21086"/><p class="title"><strong>Figure 19.16. Cell merging</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/guided-template4.png" align="middle" alt="Cell merging"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.3.3.2. Cell grouping"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedRuleTemplateEditorCellGrouping"/>19.3.3.2. Cell grouping</h4></div></div></div><p>Cells that have been merged can be further collapsed into a single
      row. Clicking the [+\-] icon in the top left of a merged cell collapses
      the corresponding rows into a single entry. Cells in other columns
      spanning the collapsed rows that have identical values are shown
      unchanged. Cells in other columns spanning the collapsed rows that have
      different values are highlighted and the first value displayed.</p><div class="figure"><a id="d0e21097"/><p class="title"><strong>Figure 19.17. Cell grouping</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/guided-template5.png" align="middle" alt="Cell grouping"/></div></div></div><br class="figure-break"/><p>When the value of a grouped cell is altered all cells that have
      been collapsed also have their values updated.</p></div></div><div class="section" title="19.3.4. Generated DRL"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedRuleTemplateEditorGeneratedDRL"/>19.3.4. Generated DRL</h3></div></div></div><p>Whilst not necessary, rule authors can view the DRL that will be generated for a "Rule Template" and
      associated data. This feature and its operation is no different to that for other assets. Select the "Source" tab
      from the bottom of the editor screen. The DRL for all rules will be displayed.</p><div class="figure"><a id="d0e21110"/><p class="title"><strong>Figure 19.18. Generated DRL</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/guided-template6.png" align="middle" alt="Generated DRL"/></div></div></div><br class="figure-break"/></div></div><div class="section" title="19.4. Guided decision tables (web based)"><div class="titlepage"><div><div><h2 class="title"><a id="drools.GuidedDecisionTableEditor"/>19.4. Guided decision tables (web based)</h2></div></div></div><p>The guided decision table feature allows decision tables to be edited in place on the web. This works similar to
  the guided editor by introspecting what facts and fields are available to guide the creation of a decision table. Rule
  attributes, meta-data, conditions and actions can be defined in a tabular format thus facilitating rapid entry of
  large sets of related rules. Web-based decision table rules are compiled into DRL like all other rule assets.</p><div class="section" title="19.4.1. Types of decision table"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedDecisionTableEditorTypesOfDecisionTable"/>19.4.1. Types of decision table</h3></div></div></div><p>There are broadly two different types of decision table, both of which are supported in Drools Workbench:-</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Extended Entry</p></li><li class="listitem"><p>Limited Entry</p></li></ul></div><div class="section" title="19.4.1.1. Extended Entry"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedDecisionTableEditorExtendedEntryDecisionTable"/>19.4.1.1. Extended Entry</h4></div></div></div><p>An Extended Entry decision table is one for which the column definitions, or stubs, specify Pattern, Field
      and operator but not value. The values, or states, are themselves held in the body of the decision table. It is
      normal, but not essential, for the range of possible values to be restricted by limiting entry to values from a
      list. Drools Workbench supports use of Java enumerations, Drools Workbench enumerations or decision table "optional value lists" to
      restrict value entry.</p><div class="figure"><a id="d0e21138"/><p class="title"><strong>Figure 19.19. Extended Entry Decision table</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-complete1.png" align="middle" alt="Extended Entry Decision table"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.4.1.2. Limited Entry"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedDecisionTableEditorLimitedEntryDecisionTable"/>19.4.1.2. Limited Entry</h4></div></div></div><p>A Limited Entry decision table is one for which the column definitions specify value in addition to Pattern,
      Field and operator. The decision table states, held in the body of the table, are boolean where a positive value
      (a checked tick-box) has the effect of meaning the column should apply, or be matched. A negative value (a cleared
      tick-box) means the column does not apply.</p><div class="figure"><a id="d0e21149"/><p class="title"><strong>Figure 19.20. Limited Entry Decision table</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-complete2.png" align="middle" alt="Limited Entry Decision table"/></div></div></div><br class="figure-break"/></div></div><div class="section" title="19.4.2. Main components\concepts"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedDecisionTableEditorConcepts"/>19.4.2. Main components\concepts</h3></div></div></div><p>The guided decision table is split into two main sections:-</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The upper section allows table columns to be defined representing rule attributes, meta-data, conditions
        and actions.</p></li><li class="listitem"><p>The lower section contains the actual table itself; where individual rows define separate rules.</p></li></ul></div><div class="figure"><a id="d0e21167"/><p class="title"><strong>Figure 19.21. Main components</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-sections.png" align="middle" alt="Main components"/></div></div></div><br class="figure-break"/><div class="section" title="19.4.2.1. Navigation"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedDecisionTableEditorNavigation"/>19.4.2.1. Navigation</h4></div></div></div><p>Cells can be selected in a variety of ways:-</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Firstly individual cells can be double-clicked and a pop-up editor corresponding to the underlying
          data-type will appear. Groups of cells in the same column can be selected by either clicking in the first and
          dragging the mouse pointer or clicking in the first and clicking the extent of the required range with the
          shift key pressed.</p></li><li class="listitem"><p>Secondly the keyboard cursor keys can be used to navigate around the table. Pressing the enter key will
          pop-up the corresponding editor. Ranges can be selected by pressing the shift key whilst extending the range
          with the cursor keys.</p></li></ul></div><p>Columns can be resized by hovering over the corresponding divider in the table header. The mouse cursor will
      change and then the column width dragged either narrower or wider.</p></div><div class="section" title="19.4.2.2. Cell merging"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedDecisionTableEditorCellMerging"/>19.4.2.2. Cell merging</h4></div></div></div><p>The icon in the top left of the decision table toggles cell merging on and off. When cells are merged those
      in the same column with identical values are merged into a single cell. This simplifies changing the value of
      multiple cells that shared the same original value. When cells are merged they also gain an icon in the top-left
      of the cell that allows rows spanning the merged cell to be grouped.</p><div class="figure"><a id="d0e21192"/><p class="title"><strong>Figure 19.22. Cell merging</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-merged.png" align="middle" alt="Cell merging"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.4.2.3. Cell grouping"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedDecisionTableEditorCellGrouping"/>19.4.2.3. Cell grouping</h4></div></div></div><p>Cells that have been merged can be further collapsed into a single row. Clicking the [+\-] icon in the top
      left of a merged cell collapses the corresponding rows into a single entry. Cells in other columns spanning the
      collapsed rows that have identical values are shown unchanged. Cells in other columns spanning the collapsed rows
      that have different values are highlighted and the first value displayed.</p><div class="figure"><a id="d0e21203"/><p class="title"><strong>Figure 19.23. Cell grouping</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-grouped.png" align="middle" alt="Cell grouping"/></div></div></div><br class="figure-break"/><p>When the value of a grouped cell is altered all cells that have been collapsed also have their values
      updated.</p></div><div class="section" title="19.4.2.4. Operation of &#34;otherwise&#34;"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedDecisionTableEditorOtherwiseOperation"/>19.4.2.4. Operation of "otherwise"</h4></div></div></div><p>Condition columns defined with literal values that use either the equality (==) or inequality (!=) operators
      can take advantage of a special decision table cell value of "otherwise". This special value allows a rule to be
      defined that matches on all values not explicitly defined in all other rules defined in the table. This is best
      illustrated with an example:-</p><pre><code class="no-highlight">when
  Cheese( name not in ("Cheddar", "Edam", "Brie") )
  ...
then
  ...
end</code></pre><pre><code class="no-highlight">when
  Cheese( name in ("Cheddar", "Edam", "Brie") )
  ...
then
  ...
end</code></pre></div><div class="section" title="19.4.2.5. Re-arranging columns"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedDecisionTableEditorRearrangeColumns"/>19.4.2.5. Re-arranging columns</h4></div></div></div><p>Whole patterns and individual conditions can be re-arranged by dragging and dropping them in the
      configuration section of the screen. This allows constraints to be re-ordered to maximise performance of the
      resulting rules, by placing generalised constraints before more specific. Action columns can also be re-arranged
      by dragging and dropping them.</p><div class="figure"><a id="d0e21225"/><p class="title"><strong>Figure 19.24. Re-arranging Condition patterns</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-rearranging-patterns.png" align="middle" alt="Re-arranging Condition patterns"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e21231"/><p class="title"><strong>Figure 19.25. Re-arranging columns</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-rearranging-columns.png" align="middle" alt="Re-arranging columns"/></div></div></div><br class="figure-break"/></div></div><div class="section" title="19.4.3. Defining a web based decision table"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedDecisionTableEditorDefining"/>19.4.3. Defining a web based decision table</h3></div></div></div><div class="section" title="19.4.3.1. Manual creation"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedDecisionTableEditorDefiningManually"/>19.4.3.1. Manual creation</h4></div></div></div><p>When a new empty decision table has been created you need to define columns for Facts, their constraints and
      corresponding actions.</p><div class="section" title="19.4.3.1.1. Column configuration"><div class="titlepage"><div><div><h5 class="title"><a id="drools.GuidedDecisionTableEditorDefiningManuallyColumns"/>19.4.3.1.1. Column configuration</h5></div></div></div><p>Expand the "Decision table" element and you will see three further sections for "Conditions", "Actions"
        and "Options". Expanding either the "Conditions" or "Actions" sections reveals the "New column" icon. This can
        be used to add new column definitions to the corresponding section. Existing columns can be removed by clicking
        the "-" icon beside each column name, or edited by clicking the "pencil" icon also beside each column name. The
        "Options" section functions slightly differently however the principle is the same: clicking the "Add
        Attribute/Metadata" icon allows columns for table attributes to be defined (such as "salience", "no-loop" etc)
        or metadata added.</p><div class="figure"><a id="d0e21250"/><p class="title"><strong>Figure 19.26. Column configuration</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-column-config.png" align="middle" alt="Column configuration"/></div></div></div><br class="figure-break"/><div class="section" title="19.4.3.1.1.1. Utility columns"><div class="titlepage"><div><div><h6 class="title"><a id="drools.GuidedDecisionTableEditorDefinitionUtilityColumns"/>19.4.3.1.1.1. Utility columns</h6></div></div></div><p>All decision table contain two utility columns containing rule number and rule description.</p></div><div class="section" title="19.4.3.1.1.2. Adding columns"><div class="titlepage"><div><div><h6 class="title"><a id="drools.GuidedDecisionTableEditorAddingColumns"/>19.4.3.1.1.2. Adding columns</h6></div></div></div><p>To add a column click on the "New column" icon.</p><p>You are presented with the following column type selection popup.</p><div class="figure"><a id="d0e21268"/><p class="title"><strong>Figure 19.27. Column type popup</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-column-type-popup.png" align="middle" alt="Column type popup"/></div></div></div><br class="figure-break"/><p>By default the column type popup only shows the following simple types:-</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Add a new Metadata\Attribute column</p></li><li class="listitem"><p>Add a simple Condition</p></li><li class="listitem"><p>Set the value of a field</p></li><li class="listitem"><p>Set the value of a field on a new fact</p></li><li class="listitem"><p>Delete an existing fact</p></li></ul></div><p>Clicking on "Include advanced options" adds the following additional "advanced" column types for more
          advanced use cases:-</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Add a Condition BRL fragment</p></li><li class="listitem"><p>Execute a Work Item</p></li><li class="listitem"><p>Set the value of a field with a Work Item parameter</p></li><li class="listitem"><p>Set the value of a field on a new Fact with a Work Item parameter</p></li><li class="listitem"><p>Add an Action BRL fragment</p></li></ul></div></div><div class="section" title="19.4.3.1.1.3. Simple column types"><div class="titlepage"><div><div><h6 class="title"><a id="drools.GuidedDecisionTableEditorSimpleColumns"/>19.4.3.1.1.3. Simple column types</h6></div></div></div><div class="section" title="19.4.3.1.1.3.1. Metadata"><div class="titlepage"><div><div><h6 class="title"><a id="drools.GuidedDecisionTableEditorMetaDataColumns"/>19.4.3.1.1.3.1. Metadata</h6></div></div></div><p>Zero or more meta-data columns can be defined, each represents the normal meta-data annotation on DRL
            rules.</p></div><div class="section" title="19.4.3.1.1.3.2. Attributes"><div class="titlepage"><div><div><h6 class="title"><a id="drools.GuidedDecisionTableEditorAttributeColumns"/>19.4.3.1.1.3.2. Attributes</h6></div></div></div><p>Zero or more attribute columns representing any of the DRL rule attributes (e.g. salience, timer,
            enabled etc) can be added. An additional pseudo attribute is provided in the guided decision table editor to
            "negate" a rule. Use of this attribute allows complete rules to be negated. For example the following simple
            rule can be negated as also shown.</p><pre><code class="no-highlight">when
  $c : Cheese( name == "Cheddar" )
then
  ...
end</code></pre><pre><code class="no-highlight">when
  not Cheese( name == "Cheddar" )
then
  ...
end</code></pre></div><div class="section" title="19.4.3.1.1.3.3. Simple Condition"><div class="titlepage"><div><div><h6 class="title"><a id="drools.GuidedDecisionTableEditorSimpleCondition"/>19.4.3.1.1.3.3. Simple Condition</h6></div></div></div><p>Conditions represent constraints on Fact Patterns defined in the left-hand side, or "when" portion, of
            a rule. To define a condition column you must first select or define a Fact Pattern bound to a model class.
            You can choose to negate the pattern. Once this has been completed you can define field constraints. If two
            or more columns are defined using the same fact pattern binding the field constraints become composite field
            constraints on the same pattern. If you define multiple bindings for a single model class each binding
            becomes a separate model class in the left-hand side of the rule.</p><p>When you edit or create a new column, you will be given a choice of the type of constraint:-</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Literal : The value in the cell will be compared with the field using the operator.</p></li><li class="listitem"><p>Formula: The expression in the cell will be evaluated and then compared with the field.</p></li><li class="listitem"><p>Predicate : No field is needed, the expression will be evaluated to true or false.</p></li></ul></div><div class="figure"><a id="d0e21344"/><p class="title"><strong>Figure 19.28. Simple Condition popup</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-column-condition-popup.png" align="middle" alt="Simple Condition popup"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.4.3.1.1.3.4. Set the value of a field"><div class="titlepage"><div><div><h6 class="title"><a id="drools.DecisionTableSetField"/>19.4.3.1.1.3.4. Set the value of a field</h6></div></div></div><p>An Action to set the value of a field on previously bound fact. You have the option to notify the Rule
            Engine of the modified values which could lead to other rules being re-activated.</p><div class="figure"><a id="d0e21355"/><p class="title"><strong>Figure 19.29. Set the value of a field popup</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-column-setField-popup.png" align="middle" alt="Set the value of a field popup"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.4.3.1.1.3.5. Set the value of a field on a new fact"><div class="titlepage"><div><div><h6 class="title"><a id="drools.GuidedDecisionTableEditorSetFieldOnNewFact"/>19.4.3.1.1.3.5. Set the value of a field on a new fact</h6></div></div></div><p>An Action to insert a new Fact into the Rule Engine Working Memory and set the a value of one of the
            new Facts' fields. You can choose to have the new Fact "logically inserted" meaning it will be automatically
            deleted should the conditions leading to the action being invoked cease to be true. Please refer to the
            Drools Expert documentation for details on Truth Maintenance and Logical insertions.</p><div class="figure"><a id="d0e21366"/><p class="title"><strong>Figure 19.30. Set the value of a field on a new fact popup</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-column-insertField-popup.png" align="middle" alt="Set the value of a field on a new fact popup"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.4.3.1.1.3.6. Delete an existing fact"><div class="titlepage"><div><div><h6 class="title"><a id="drools.GuidedDecisionTableEditorDeleteFact"/>19.4.3.1.1.3.6. Delete an existing fact</h6></div></div></div><p>An Action to delete a bound Fact.</p><div class="figure"><a id="d0e21377"/><p class="title"><strong>Figure 19.31. Delete an existing fact popup</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-column-deleteFact-popup.png" align="middle" alt="Delete an existing fact popup"/></div></div></div><br class="figure-break"/></div></div><div class="section" title="19.4.3.1.1.4. Advanced column types"><div class="titlepage"><div><div><h6 class="title"><a id="drools.GuidedDecisionTableEditorAdvancedColumns"/>19.4.3.1.1.4. Advanced column types</h6></div></div></div><div class="section" title="19.4.3.1.1.4.1. Condition BRL fragments"><div class="titlepage"><div><div><h6 class="title"><a id="drools.GuidedDecisionTableEditorConditionBRL"/>19.4.3.1.1.4.1. Condition BRL fragments</h6></div></div></div><p>A construct that allows a BRL fragment to be used in the left-hand side of a rule. A BRL fragment is
            authored using the Guided Rule Editor and hence all features available in that editor can be used to define
            a decision table column; such as "from", "collect" and "accumulate" etc. When using the embedded Guided Rule
            Editor field values defined as "Template Keys" will form columns in the decision table. Facts and Fact's
            fields bound in the BRL fragment can be referenced by the simpler column types and vice-versa.</p><p>In the following example two Template Keys have been defined and hence two columns appear in the
            decision table.</p><div class="figure"><a id="d0e21393"/><p class="title"><strong>Figure 19.32. Defining a Condition with BRL</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-column-condition-brl1-popup.png" align="middle" alt="Defining a Condition with BRL"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e21399"/><p class="title"><strong>Figure 19.33. The resulting decision table</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-column-condition-brl2-popup.png" align="middle" alt="The resulting decision table"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.4.3.1.1.4.2. Execute a Work Item"><div class="titlepage"><div><div><h6 class="title"><a id="drools.GuidedDecisionTableEditorExecuteWorkItem"/>19.4.3.1.1.4.2. Execute a Work Item</h6></div></div></div><p>An Action invoking a jBPM Work Item Handler setting its input parameters to bound Facts\Facts fields
            values.</p></div><div class="section" title="19.4.3.1.1.4.3. Set the value of a field with a Work Item parameter"><div class="titlepage"><div><div><h6 class="title"><a id="drools.GuidedDecisionTableEditorSetWorkItemParameter"/>19.4.3.1.1.4.3. Set the value of a field with a Work Item parameter</h6></div></div></div><p>An Action setting the value of a Fact's field to that of a jBPM Work Item Handler's result
            parameter.</p></div><div class="section" title="19.4.3.1.1.4.4. Set the value of a field on a new Fact with a Work Item parameter"><div class="titlepage"><div><div><h6 class="title"><a id="drools.GuidedDecisionTableEditorSetFactFromWorkItemParameter"/>19.4.3.1.1.4.4. Set the value of a field on a new Fact with a Work Item parameter</h6></div></div></div><p>An Action setting the value of a new Fact's field to that of a jBPM Work Item Handler's result
            parameter.</p></div><div class="section" title="19.4.3.1.1.4.5. Action BRL fragment"><div class="titlepage"><div><div><h6 class="title"><a id="drools.GuidedDecisionTableEditorActionBRL"/>19.4.3.1.1.4.5. Action BRL fragment</h6></div></div></div><p>A construct that allows a BRL fragment to be used in the right-hand side of a rule. A BRL fragment is
            authored using the Guided Rule Editor and hence all features available in that editor can be used to define
            a decision table column. When using the embedded Guided Rule Editor field values defined as "Template Keys"
            will form columns in the decision table. Facts bound in the BRL fragment can be referenced by the simpler
            column types and vice-versa.</p><p>In the following example two Template Keys have been defined and hence two columns appear in the
            decision table.</p><div class="figure"><a id="d0e21427"/><p class="title"><strong>Figure 19.34. Defining an Action with BRL</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-column-action-brl1-popup.png" align="middle" alt="Defining an Action with BRL"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e21433"/><p class="title"><strong>Figure 19.35. The resulting decision table</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-column-action-brl2-popup.png" align="middle" alt="The resulting decision table"/></div></div></div><br class="figure-break"/></div></div></div></div><div class="section" title="19.4.3.2. Using a Wizard"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedDecisionTableEditorWizard"/>19.4.3.2. Using a Wizard</h4></div></div></div><p>A Wizard can also be used to assist with defining the decision table columns.</p><p>The wizard can be chosen when first electing to create a new rule. The wizard provides a number of pages to
      define the table:-</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Summary</p></li><li class="listitem"><p>Add Fact Patterns</p></li><li class="listitem"><p>Add Constraints</p></li><li class="listitem"><p>Add Actions to update facts</p></li><li class="listitem"><p>Add Actions to insert facts</p></li><li class="listitem"><p>Columns to expand</p></li></ul></div><div class="section" title="19.4.3.2.1. Selecting the wizard"><div class="titlepage"><div><div><h5 class="title"><a id="drools.GuidedDecisionTableEditorSelectingWizard"/>19.4.3.2.1. Selecting the wizard</h5></div></div></div><p>The "New Wizard" dialog shows a "Use wizard" checkbox.</p><div class="figure"><a id="d0e21470"/><p class="title"><strong>Figure 19.36. Selecting the wizard</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-wizard1.png" align="middle" alt="Selecting the wizard"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.4.3.2.2. Summary page"><div class="titlepage"><div><div><h5 class="title"><a id="drools.GuidedDecisionTableEditorWizardSummaryPage"/>19.4.3.2.2. Summary page</h5></div></div></div><p>The summary page shows a few basic details about the decision table and allows the asset name to be
          changed.</p><div class="figure"><a id="d0e21481"/><p class="title"><strong>Figure 19.37. Summary page</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-wizard2.png" align="middle" alt="Summary page"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.4.3.2.3. Add Fact Patterns page"><div class="titlepage"><div><div><h5 class="title"><a id="drools.GuidedDecisionTableEditorWizardFactPatternsPage"/>19.4.3.2.3. Add Fact Patterns page</h5></div></div></div><p>This page allows Fact types to be defined that will form the "When" columns of the rules. Fact types that
        are available in your model will be shown in the left-hand listbox. Select a Fact type and use the "&gt;&gt;"
        button to add it to your list of chosen facts on the right-hand listbox. Removal is a similar process: the Fact
        that is no longer required can be selected in the right-hand listbox and the "&lt;&lt;" button used to remove
        it. All Fact types need to be bound to a variable. Incomplete Fact types will be highlighted and a warning
        message displayed. You will be unable to finish your definition until all warnings have been resolved.</p><div class="figure"><a id="d0e21492"/><p class="title"><strong>Figure 19.38. Add Fact Patterns page</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-wizard3a.png" align="middle" alt="Add Fact Patterns page"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e21498"/><p class="title"><strong>Figure 19.39. Example of an incomplete Fact definition</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-wizard3b.png" align="middle" alt="Example of an incomplete Fact definition"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.4.3.2.4. Add Constraints page"><div class="titlepage"><div><div><h5 class="title"><a id="drools.GuidedDecisionTableEditorWizardAddConstraintPage"/>19.4.3.2.4. Add Constraints page</h5></div></div></div><p>This page allows field constraints on the Fact types you have chosen to use in the decision table to be
        defined. Fact types chosen on the previous Wizard page are listed in the right-hand listbox. Selecting a Fact
        type by clicking on it will result in a list of available fields being shown in the middle listbox together with
        an option to create a predicate that do not require a specific field. Fields can be added to the pattern's
        constraints by clicking on the field and then the "&gt;&gt;" button. Fields can be removed from the pattern
        definition by clicking on the Condition in the right-hand listbox and then the "&lt;&lt;" button. All fields
        need to have a column header and operator. Incomplete fields will be highlighted and a warning message
        displayed. You will be unable to finish your definition until all warnings have been resolved.</p><div class="figure"><a id="d0e21509"/><p class="title"><strong>Figure 19.40. Add Constraints page</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-wizard4.png" align="middle" alt="Add Constraints page"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.4.3.2.5. Add Actions to update facts page"><div class="titlepage"><div><div><h5 class="title"><a id="drools.GuidedDecisionTableEditorWizardUpdateFactsPage"/>19.4.3.2.5. Add Actions to update facts page</h5></div></div></div><p>Fact types that have been defined can be updated in the consequence, or action, part of a rule. This page
        allows such actions to be defined. Fact types added to the decision table definition are listed in the left-hand
        listbox. Selecting a Fact type by clicking on it will result in a list of available fields being shown in the
        middle listbox. Fields that need to be updated by the rule can be added by selecting an available field and
        pressing the "&gt;&gt;" button. Fields can be removed similarly by clicking on a chosen field and then the
        "&lt;&lt;" button. All actions require a column header. Any incomplete actions will be highlighted and a warning
        message displayed. You will be unable to finish your definition until all warnings have been resolved.</p><div class="figure"><a id="d0e21520"/><p class="title"><strong>Figure 19.41. Add Actions to update facts page</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-wizard5.png" align="middle" alt="Add Actions to update facts page"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.4.3.2.6. Add Actions to insert facts page"><div class="titlepage"><div><div><h5 class="title"><a id="drools.GuidedDecisionTableEditorWizardInsertFactsPage"/>19.4.3.2.6. Add Actions to insert facts page</h5></div></div></div><p>Actions can also be defined to insert new Facts into the Rule Engine. A list of Fact types available in
        your model are listed in the left-hand listbox. Select those you wish to include in your decision table
        definition by clicking on them and pressing the "&gt;&gt;" button between the left most listbox and that titled
        "Chosen patterns". Removal is a similar process whereby a chosen pattern can be selected and removed by pressing
        the "&lt;&lt;" button. Selection of a chosen pattern presents the user with a list of available fields. Fields
        that need to have values set by the action can be added by selecting them and pressing the "&gt;&gt;" button
        between the "Available fields" and "Chosen fields" listbox. Removal is a similar process as already described.
        New Facts need to be bound to a variable and have a column heading specified. Incomplete Facts and\or fields
        will be highlighted and a warning message displayed. You will be unable to finish your definition until all
        warnings have been resolved.</p><div class="figure"><a id="d0e21531"/><p class="title"><strong>Figure 19.42. Add Actions to insert facts page</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-wizard6.png" align="middle" alt="Add Actions to insert facts page"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.4.3.2.7. Columns to expand page"><div class="titlepage"><div><div><h5 class="title"><a id="drools.GuidedDecisionTableEditorWizardExpandColumnsPage"/>19.4.3.2.7. Columns to expand page</h5></div></div></div><p>This page controls how the decision table, based upon Conditions defined on the prior pages, will be
        created. Condition columns defined with an optional list of permitted values can be used to create rows in the
        decision table. Where a number of Condition columns have been defined with lists of permitted values the
        resulting table will contain a row for every combination of values; i.e. the decision table will be in expanded
        form. By default all Condition columns defined with value lists will be included in the expansion however you
        are able to select a sub-set of columns if so required. This can be accomplished by unticking the "Fully expand"
        checkbox and adding columns to the right-hand listbox. If no expansion is required untick the "Fully expand"
        checkbox and ensure zero columns are added to the right-hand listbox.</p><div class="figure"><a id="d0e21542"/><p class="title"><strong>Figure 19.43. Columns to expand page</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-wizard7a.png" align="middle" alt="Columns to expand page"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e21548"/><p class="title"><strong>Figure 19.44. Example of a Condition column with optional values defined</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-wizard7b.png" align="middle" alt="Example of a Condition column with optional values defined"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e21554"/><p class="title"><strong>Figure 19.45. Example of a decision table generated with expanded columns</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-wizard7c.png" align="middle" alt="Example of a decision table generated with expanded columns"/></div></div></div><br class="figure-break"/></div></div></div><div class="section" title="19.4.4. Rule definition"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedDecisionTableEditorRuleDefinitions"/>19.4.4. Rule definition</h3></div></div></div><p>This section allows individual rules to be defined using the columns defined earlier.</p><p>Rows can be appended to the end of the table by selecting the "Add Row" button. Rows can also be inserted by
    clicking the "+" icon beside an existing row. The "-" icon can be used to delete rows.</p><div class="figure"><a id="d0e21567"/><p class="title"><strong>Figure 19.46. Rule definition</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/dtable-body.png" align="middle" alt="Rule definition"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.4.5. Audit Log"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedDecisionTableEditorAuditLog"/>19.4.5. Audit Log</h3></div></div></div><p>An audit log has been added to the web-guided Decision Table editor to track additions, deletions and
    modifications.</p><p>By default the audit log is not configured to record any events, however, users can easily select the events
    in which they are interested.</p><p>The audit log is persisted whenever the asset is checked in.</p><div class="figure"><a id="d0e21582"/><p class="title"><strong>Figure 19.47. An empty audit log</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/guided-dtable-audit-log1.png" align="middle" alt="An empty audit log"/></div></div></div><br class="figure-break"/><p>Once the capture of events has been enabled all susbsequent operations are recorded. Users are able to perform
    the following:-</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Record an explanatory note beside each event.</p></li><li class="listitem"><p>Delete an event from the log. Event details remain in the underlying repository.</p></li></ul></div><div class="figure"><a id="d0e21597"/><p class="title"><strong>Figure 19.48. Example of audit events</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/guided-dtable-audit-log2.png" align="middle" alt="Example of audit events"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.4.6. Real Time Validation and Verification"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedDecisionTableEditorVerification"/>19.4.6. Real Time Validation and Verification</h3></div></div></div><p>Decision tables are validated after each cell change. If any issues are found the results will be shown in the column on the right side of the table. Validation and verification covers the following issues:</p><div class="section" title="19.4.6.1. Redundancy"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedDecisionTableEditorVerificationRedundancy"/>19.4.6.1. Redundancy</h4></div></div></div><p>Redundancy exists between two rows when both rows execute the same actions when given the same set of facts.</p><p>Redundancy might not be a problem if the redundant rules are setting a value on an existing fact, this just sets the value twice. Problems occur when the two rules increase a counter or add more facts into the working memory, since this causes unwanted side effects. In both cases the other row is not needed.</p></div><div class="section" title="19.4.6.2. Subsumption"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedDecisionTableEditorVerificationSubsumption"/>19.4.6.2. Subsumption</h4></div></div></div><p>Subsumption exists when one row executes the same action as another row when given the same set of facts. The rows are not redundant since the another row is more complicated and it can fire with a set of facts that do not fire the subsumptant row.</p><p>The problems with subsumption are similar to the case with redundancy.</p></div><div class="section" title="19.4.6.3. Conflicts"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedDecisionTableEditorVerificationConflicts"/>19.4.6.3. Conflicts</h4></div></div></div><p>Conflicts can exist either on a single row or between rows.</p><p>A single row conflict prevents the row actions from ever being executed.</p><p>Conflict between two rows exists when the conditions of two rules are met with a same set of facts, but the actions set fact fields to different values. The conditions can be redundant or just subsumptant. Conflicts are a problem because it is impossible to know what action is made last. Conditions might set a loan to both approbed and rejected. The end result may be different on each time the rules are ran and with each rule engine software version.</p></div><div class="section" title="19.4.6.4. Missing Columns"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedDecisionTableEditorVerificationMissingRHSLHS"/>19.4.6.4. Missing Columns</h4></div></div></div><p>In some cases, usually by accident, the user can delete all the condition or action columns. When the conditions are removed all the actions are executed and when the actions columns are missing the rows do nothing. </p></div></div></div><div class="section" title="19.5. Guided Decision Trees"><div class="titlepage"><div><div><h2 class="title"><a id="drools.GuidedDecisionTreeEditor"/>19.5. Guided Decision Trees</h2></div></div></div><p>The Workbench supports authoring of simple Decision Trees.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The editor does not support nested Data Objects at present. It is therefore advised to
      only use Guided Decision Trees with flat Data Object models.</p></div><div class="section" title="19.5.1. The initial editor layout"><div class="titlepage"><div><div><h3 class="title"><a id="d0e21644"/>19.5.1. The initial editor layout</h3></div></div></div><p>When a new Guided Decision Tree is created the editor is initially blank.</p><p>The left-hand side is a palette of available Data Objects, their fields and
      Actions.</p><p>The right-hand side is the area where you can drag and drop Data Objects, their fields or
      Actions to build a tree.</p><p>The editor will show a connector between the node being dragged and applicable children to
      which it can be attached. When the drag is complete the new node will be attached to the
      applicable child. Root nodes will not have a connector shown when being dragged to an empty
      tree. Completing the drag positions the root node in the centre of the editor.</p><p>There are various restrictions when composing a tree:- </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>A tree must have a Data Object at the root.</p></li><li class="listitem"><p>A tree can only have one root.</p></li><li class="listitem"><p>Data Objects can have either other Data Objects, field constraints or Actions as
            children.</p><p>The field constraints must be on fields of the same Data Object as the parent
            node.</p></li><li class="listitem"><p>Field constraints can have either other field constraints or Actions as
            children.</p><p>The field constraints must be on fields of the same Data Object as the parent
            node.</p></li><li class="listitem"><p>Actions can only have other Actions as children.</p></li></ol></div><p>
    </p><div class="figure"><a id="d0e21678"/><p class="title"><strong>Figure 19.49. Guided Decision Trees - Empty editor</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/GuidedDecisionTreeEditor1.png" align="middle" alt="Guided Decision Trees - Empty editor"/></div></div></div><br class="figure-break"/><p>Expanding the palette reveals Tree Nodes for the Data Object and its fields.</p><div class="figure"><a id="d0e21686"/><p class="title"><strong>Figure 19.50. Guided Decision Trees - Expanded palette</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/GuidedDecisionTreeEditor2.png" align="middle" alt="Guided Decision Trees - Expanded palette"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.5.2. First steps"><div class="titlepage"><div><div><h3 class="title"><a id="d0e21692"/>19.5.2. First steps</h3></div></div></div><p>Drag a Data Object on to the tree authoring area.</p><div class="figure"><a id="d0e21697"/><p class="title"><strong>Figure 19.51. Guided Decision Trees - Data Object root node</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/GuidedDecisionTreeEditor3.png" align="middle" alt="Guided Decision Trees - Data Object root node"/></div></div></div><br class="figure-break"/><p>Clicking on a node selects it.</p><p>Icons to manipulate the node appear when the node is selected.</p><p>The icons are: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Delete</p><p>Deleting a node will also delete all children.</p></li><li class="listitem"><p>Edit</p><p>Collapsed nodes cannot be edited as they contain numerous children.</p></li><li class="listitem"><p>Collapse</p></li></ol></div><p>
    </p><div class="figure"><a id="d0e21724"/><p class="title"><strong>Figure 19.52. Guided Decision Trees - Selected node</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/GuidedDecisionTreeEditor4.png" align="middle" alt="Guided Decision Trees - Selected node"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.5.3. Editing Data Object nodes"><div class="titlepage"><div><div><h3 class="title"><a id="d0e21730"/>19.5.3. Editing Data Object nodes</h3></div></div></div><p>Selecting a Data Object node and clicking the edit icon shows a popup to manage the
      node.</p><p>The popup shows the Data Object type and allows it to be bound to a variable. Bound Data
      Objects can be modified or retracted by Actions.</p><div class="figure"><a id="d0e21737"/><p class="title"><strong>Figure 19.53. Guided Decision Trees - Data Object Editor</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/GuidedDecisionTreeEditor5.png" align="middle" alt="Guided Decision Trees - Data Object Editor"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.5.4. Editing Field Constraint nodes"><div class="titlepage"><div><div><h3 class="title"><a id="d0e21743"/>19.5.4. Editing Field Constraint nodes</h3></div></div></div><p>Selecting a Field Constraint node and clicking the edit icon shows a popup to manage
      the node.</p><p>The popup shows the Data Object type and field and allows the field to be bound to a
      variable. An operator, applicable to the Data Model field's data-type, can be selected and a
      corresponding value entered.</p><div class="figure"><a id="d0e21750"/><p class="title"><strong>Figure 19.54. Guided Decision Trees - Field Constraint Editor</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/GuidedDecisionTreeEditor6.png" align="middle" alt="Guided Decision Trees - Field Constraint Editor"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.5.5. Editing Action nodes"><div class="titlepage"><div><div><h3 class="title"><a id="d0e21756"/>19.5.5. Editing Action nodes</h3></div></div></div><p>Selecting an Insert Action node and clicking the edit icon shows a popup to manage the
      node.</p><p>The popup allows selection of the Data Object to be inserted and whether it's insertion is
      "logical". Please refer to Drools documentation regarding Truth Maintenance for more
      information. Fields for the new Data Object can have values set.</p><div class="figure"><a id="d0e21763"/><p class="title"><strong>Figure 19.55. Guided Decision Trees - Action "Insert" Editor</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/GuidedDecisionTreeEditorActionInsert.png" align="middle" alt="Guided Decision Trees - Action &#34;Insert&#34; Editor"/></div></div></div><br class="figure-break"/><p>Selecting an Insert Retract node and clicking the edit icon shows a popup to manage the
      node.</p><p>The popup allows any Data Object bound in the path from the selected node to the root node
      to be selected for retraction.</p><div class="figure"><a id="d0e21773"/><p class="title"><strong>Figure 19.56. Guided Decision Trees - Action "Retract" Editor</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/GuidedDecisionTreeEditorActionRetract.png" align="middle" alt="Guided Decision Trees - Action &#34;Retract&#34; Editor"/></div></div></div><br class="figure-break"/><p>Selecting an Insert Update node and clicking the edit icon shows a popup to manage the
      node.</p><p>The popup allows any Data Object bound in the path from the selected node to the root node
      to be modified. Fields for the modified Data Object can have values set.</p><div class="figure"><a id="d0e21783"/><p class="title"><strong>Figure 19.57. Guided Decision Trees - Action "Update" Editor</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/GuidedDecisionTreeEditorActionUpdate.png" align="middle" alt="Guided Decision Trees - Action &#34;Update&#34; Editor"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.5.6. Managing the tree"><div class="titlepage"><div><div><h3 class="title"><a id="d0e21789"/>19.5.6. Managing the tree</h3></div></div></div><p>Even simple trees can grow in size and become difficult to maintain.</p><p>It is therefore possible to collapse parts of the tree, giving more space in the user interface to maintain different parts of the tree.</p><p>If a node has children, when selected, it will have an icon to collapse the children. Clicking this icon will collapse children.</p><p>A collapsed node can equally be expanded by selecting it and clicking on the exapnd icon. A collapsed node cannot be edited as it contains numerous children. Deleting a collapsed node deletes all children too.</p><div class="figure"><a id="d0e21800"/><p class="title"><strong>Figure 19.58. Guided Decision Trees - Collapsing nodes</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/GuidedDecisionTreeEditorCollapse1.png" align="middle" alt="Guided Decision Trees - Collapsing nodes"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e21806"/><p class="title"><strong>Figure 19.59. Guided Decision Trees - Collapsed node</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/GuidedDecisionTreeEditorCollapse2.png" align="middle" alt="Guided Decision Trees - Collapsed node"/></div></div></div><br class="figure-break"/></div></div><div class="section" title="19.6. Spreadsheet decision tables"><div class="titlepage"><div><div><h2 class="title"><a id="drools.XLSDecisionTable"/>19.6. Spreadsheet decision tables</h2></div></div></div><p>Multiple rules can be stored in a spreadsheet. Each row in the spreadsheet is a rule, and each column is either
    a condition, an action, or an option. The Drools Expert section of this document discusses spreadsheet decision
    tables in more detail.</p><div class="figure"><a id="d0e21817"/><p class="title"><strong>Figure 19.60. Spreadsheet decision table</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/DecisionTable.png" align="middle" alt="Spreadsheet decision table"/></div></div></div><br class="figure-break"/><p>To use a spreadsheet, you upload an XLS file. To create a new decision table: launch the new "Decision Table
    (Spreadsheet)" wizard, you will get an option to upload one.</p></div><div class="section" title="19.7. Scorecards"><div class="titlepage"><div><div><h2 class="title"><a id="drools.GuidedScoreCardEditor"/>19.7. Scorecards</h2></div></div></div><p>A scorecard is a graphical representation of a formula used to calculate an overall score. A scorecard can
    be used to predict the likelihood or probability of a certain outcome. Drools now supports additive scorecards. An
    additive scorecard calculates an overall score by adding all partial scores assigned to individual rule
    conditions.
  </p><p>Additionally, Drools Scorecards will allows for reason codes to be set, which help in identifying the
    specific rules (buckets) that have contributed to the overall score. Drools Scorecards will be based on the PMML
    4.1 Standard.
  </p><p>The New Item menu now allows for creation of scorecard assets.</p><div class="figure"><a id="d0e21834"/><p class="title"><strong>Figure 19.61. Scorecard Asset - Guided Editor</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/scorecard_asset_webeditor.png" align="middle" alt="Scorecard Asset - Guided Editor"/></div></div></div><br class="figure-break"/><p>
    The above image shows a scorecard with one characteristic. Each scorecard consists of two sections (a) Setup
    Parameters (b) Characteristic Section
  </p><div class="section" title="19.7.1. (a) Setup Parameters"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedScoreCardEditorSetupParameters"/>19.7.1. (a) Setup Parameters</h3></div></div></div><p>
      The setup section consits of parameters that define the overall behaviour of this scorecard.
    </p><div class="orderedlist"><ol class="orderedlist" type="1" compact="compact"><li class="listitem"><p>Facts: This dropdown shows a list of facts that are visible for this asset. </p></li><li class="listitem"><p>
          Resultant Score Field: Shows a list of fields from the selected fact. Only fields of type 'double' are shown.
          If this dropdown is empty double check your fact model.
          The final calculated score will be stored in this field.
        </p></li><li class="listitem"><p>Initial Score: Numeric Text Field to capture the initial score. The generated rules will initialize the
          'Resultant Score Field' with this score
          and then is added to the overall score whenever partial scores are summed up.
        </p></li><li class="listitem"><p>Use Reason Codes: Boolean indicator to compute reason codes along with the final score. Selecting Yes/No
          in this field will enable/disable the
          'Resultant Reason Codes Field', 'Reason Code Algorithm' and the 'Baseline Score' field.
        </p></li><li class="listitem"><p>Resultant Reason Codes Field: Shows a list of fields from the selected fact. Only fields of type
          'java.util.List' are shown. This collection will hold
          the reason codes selected by this scorecard.
        </p></li><li class="listitem"><p>Reason Code Algorithm: May be "none", "pointsAbove" or "pointsBelow", describing how reason codes shall be
          ranked, relative to the
          baseline score of each Characteristic, or as set at the top-level scorecard.
        </p></li><li class="listitem"><p>Baseline Score: A single value to use as the baseline comparison score for all characteristics, when
          determining reason code ranking. Alternatively,
          unique baseline scores may be set for each individual Characteristic as shown below. This value is required
          only when UseReasonCodes is "true"
          and baselineScore is not given for each Characteristic.
        </p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>
        If UseReasonCodes is "true", then BaselineScore must be defined at the Scorecard level or for each
        Characteristic, and ReasonCode must be provided for each Characteristic or for each of its input Attributes. If UseReasonCodes
        is "false", then baselineScore and reasonCode are not required.
      </p></div></div><div class="section" title="19.7.2. (b) Characteristics"><div class="titlepage"><div><div><h3 class="title"><a id="drools.GuidedScoreCardEditorCharacteristics"/>19.7.2. (b) Characteristics</h3></div></div></div><p>
      On Clicking the 'New Characteristic' button, a new empty characteristic editor is added to the scorecard. Defines
      the point allocation strategy for each scorecard characteristic (numeric or categorical). Each scorecard characteristic
      is assigned a single partial score which is used to compute the overall score. The overall score is simply the sum
      of all partial scores. Partial scores are assumed to be continuous values of type "double".
    </p><div class="section" title="19.7.2.1. Creating Characterstics"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedScoreCardEditorCreatingCharacteristics"/>19.7.2.1. Creating Characterstics</h4></div></div></div><p>Every scorecard must have at least one characteristic</p><div class="figure"><a id="d0e21882"/><p class="title"><strong>Figure 19.62. New Characteristic</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/scorecards_new_characteristic.png" align="middle" alt="New Characteristic"/></div></div></div><br class="figure-break"/><div class="orderedlist"><ol class="orderedlist" type="1" compact="compact"><li class="listitem"><p>Name: Descriptive name for this characteristic. For informational reasons only.
          </p></li><li class="listitem"><p>
            Remove Charteristic: Will remove this characteristic from the scorecard after a confirmation dialog is
            shown.
          </p></li><li class="listitem"><p>
            Add Attribute: Will add a line entry for an attribute (bin).
          </p></li><li class="listitem"><p>
            Fact: Select the class which will be evaluated for calculating the partial score.
          </p></li><li class="listitem"><p>
            Characteristic: Shows the list of fields from the selected Fact. Only fields of type "String", "int",
            "double", "boolean" are shown.
          </p></li><li class="listitem"><p>
            Baseline Score: Sets the characteristic's baseline score against which to compare the actual partial score
            when determining the ranking of reason codes. This value is required when useReasonCodes attribute is "true" and
            baselineScore is not defined in element Scorecard. Whenever baselineScore is defined for a Characteristic,
            it takes precedence over the baselineScore value defined in element Scorecard.
          </p></li><li class="listitem"><p>
            Reason Code: Contains the characteristic's reason code, usually associated with an adverse decision.
          </p></li></ol></div></div><div class="section" title="19.7.2.2. Creating Attributes"><div class="titlepage"><div><div><h4 class="title"><a id="drools.GuidedScoreCardEditorCreatingAttributes"/>19.7.2.2. Creating Attributes</h4></div></div></div><p>
        On Clicking the 'New Attribute' button, a new empty attribute editor. In scorecard models, all the elements defining the Attributes for a particular Characteristic must all reference a
        single field.
      </p><div class="figure"><a id="d0e21915"/><p class="title"><strong>Figure 19.63. New Attribute</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/scorecards_new_attribute.png" align="middle" alt="New Attribute"/></div></div></div><br class="figure-break"/><div class="orderedlist"><ol class="orderedlist" type="1" compact="compact"><li class="listitem"><p>
            Operator: The condition upon which the mapping between input attribute and partial score takes place. The
            operator dropdown will show different values depending on the datatype of the selected Field.
            </p><div class="orderedlist"><ol class="orderedlist" type="a" compact="compact"><li class="listitem"><p>
                  DataType Strings: "=", "in".
                </p></li><li class="listitem"><p>
                  DataType Integers: "=", "&gt;", "&lt;", "&gt;=", "&lt;=", "&gt;..&lt;", "&gt;=..&lt;", "&gt;=..&lt;=", "&gt;..&lt;=".
                </p></li><li class="listitem"><p>
                  DataType Boolean: "true", "false".
                </p></li></ol></div><p>
            Refer to the next sub-section (values) for more details.
          </p></li><li class="listitem"><p>
            Value: Basis the operator selected the value specified can either be a single value or a set of values separated by comma (",").
            The value field is disabled for operator type boolean.
            </p><table id="d0e21939"><caption>Table 19.1. Operators / Values</caption><thead><tr>
                  <td>Data Type</td>
                  <td>Operator</td>
                  <td>Value</td>
                  <td>Remarks</td>
                </tr></thead><tbody><tr>
                  <td>String</td>
                  <td>=</td>
                  <td>Single Value</td>
                  <td>will look for an exact match</td>
                </tr><tr>
                  <td>String</td>
                  <td>in</td>
                  <td>Comma Separated Values (a,b,c,...)</td>
                  <td>The operator 'in' indicates an evaluation to TRUE if the field value is contained in the comma separated list of values</td>
                </tr><tr>
                  <td>Boolean</td>
                  <td>is true</td>
                  <td>N/A</td>
                  <td>Value Field is uneditable (readonly)</td>
                </tr><tr>
                  <td>Boolean</td>
                  <td>is false</td>
                  <td>N/A</td>
                  <td>Value Field is uneditable (readonly)</td>
                </tr><tr>
                  <td>Numeric</td>
                  <td>=</td>
                  <td>Single Value</td>
                  <td>Equals Operator</td>
                </tr><tr>
                  <td>Numeric</td>
                  <td>&gt;</td>
                  <td>Single Value</td>
                  <td>Greater Than Operator</td>
                </tr><tr>
                  <td>Numeric</td>
                  <td>&lt;</td>
                  <td>Single Value</td>
                  <td>Less Than Operator</td>
                </tr><tr>
                  <td>Numeric</td>
                  <td>&gt;=</td>
                  <td>Single Value</td>
                  <td>Greater than or equal To</td>
                </tr><tr>
                  <td>Numeric</td>
                  <td>&lt;=</td>
                  <td>Single Value</td>
                  <td>Less than or equal To</td>
                </tr><tr>
                  <td>Numeric</td>
                  <td>&gt;..&lt;</td>
                  <td>Comma Separated Values (a,b)</td>
                  <td>(Greater than Value 'a') and (less than value 'b')</td>
                </tr><tr>
                  <td>Numeric</td>
                  <td>&gt;=..&lt;</td>
                  <td>Comma Separated Values (a,b)</td>
                  <td>(Greater than or equal to Value 'a') and (less than value 'b')</td>
                </tr><tr>
                  <td>Numeric</td>
                  <td>&gt;=..&lt;=</td>
                  <td>Comma Separated Values (a,b)</td>
                  <td>(Greater than or equal to Value 'a') and (less than or equal to value 'b')</td>
                </tr><tr>
                  <td>Numeric</td>
                  <td>&gt;..&lt;=</td>
                  <td>Comma Separated Values (a,b)</td>
                  <td>(Greater than Value 'a') and (less than or equal to value 'b')</td>
                </tr></tbody></table></li><li class="listitem"><p>
            Partial Score: Defines the score points awarded to the Attribute.
          </p></li><li class="listitem"><p>
            Reason Code: Defines the attribute's reason code. If the reasonCode attribute is used in this level, it takes precedence over the ReasonCode associated with the Characteristic element.
          </p></li><li class="listitem"><p>
            Actions: Delete this attribute. Prompts the user for confirmation.
          </p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>
          If Use Reason Codes is "true", then Baseline Score must be defined at the Scorecard level or for each Characteristic, and Reason Code must be provided for each Characteristic or for each of its input Attributes. If Use Reason Codes is "false", then BaselineScore and ReasonCode are not required.
        </p></div></div></div></div><div class="section" title="19.8. Test Scenario"><div class="titlepage"><div><div><h2 class="title"><a id="drools.TestScenarioEditor"/>19.8. Test Scenario</h2></div></div></div><p>Test Scenarios are used to validate that rules and knowledge base work as expected. When the knowledge base
    evolves, Test Scenarios guard against regression.</p><div class="figure"><a id="d0e22157"/><p class="title"><strong>Figure 19.64. Example Test Scenario</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/TestScenario.png" align="middle" alt="Example Test Scenario"/></div></div></div><br class="figure-break"/><p>Given section lists the facts needed for the behaviour. Expect section lists the expected changes and actions
    done by the behaviour. Given facts are passed for the Test Scenario before execution. During the rule execution,
    changes in the knowledge base are recorded. After the execution ends the recorded actions, existing facts in the
    knowledge base and knowledge base output is compared against the expectations.</p><div class="figure"><a id="d0e22165"/><p class="title"><strong>Figure 19.65. Example Test Scenario after execution</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/TestScenarioAfterRunningIt.png" align="middle" alt="Example Test Scenario after execution"/></div></div></div><br class="figure-break"/><div class="section" title="19.8.1. Knowledge Session Selector"><div class="titlepage"><div><div><h3 class="title"><a id="drools.KSessionSelector"/>19.8.1. Knowledge Session Selector</h3></div></div></div><div class="figure"><a id="d0e22174"/><p class="title"><strong>Figure 19.66. Knowledge Session Selector</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/KSessionSelector.png" align="middle" alt="Knowledge Session Selector"/></div></div></div><br class="figure-break"/><p>
      Knowledge session selector is used to select the session that the rules are ran against. The knowledge session needs to be stateful and use the pseudo clock when simulated time is used. Knowledge sessions are defined in the Project Editor, in the Knowledge bases and Sessions section.
    </p></div><div class="section" title="19.8.2. Given Section"><div class="titlepage"><div><div><h3 class="title"><a id="drools.TestScenarioEditorGivenSection"/>19.8.2. Given Section</h3></div></div></div><div class="figure"><a id="d0e22185"/><p class="title"><strong>Figure 19.67. Given popup</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/GivenSection.png" align="middle" alt="Given popup"/></div></div></div><br class="figure-break"/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Insert a new fact - Adds a new fact that will be inserted into the knowledge base before execution.</p></li><li class="listitem"><p>Modify an existing fact - Allows editing a fact between knowledge base executions.</p></li><li class="listitem"><p>Delete an existing fact - Allows removing facts between executions.</p></li><li class="listitem"><p>Activate rule flow group - Allows rules from a rule flow group to be tested, by activating the group in
          advance.</p></li></ul></div></div><div class="section" title="19.8.3. Expect Section"><div class="titlepage"><div><div><h3 class="title"><a id="drools.TestScenarioEditorExpectedSection"/>19.8.3. Expect Section</h3></div></div></div><div class="figure"><a id="d0e22207"/><p class="title"><strong>Figure 19.68. Expect popup</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/ExpectSection.png" align="middle" alt="Expect popup"/></div></div></div><br class="figure-break"/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Rule - Validate that a certain rule fired.</p></li><li class="listitem"><p>Fact value - Validate fact values for a fact created in the Given section.</p></li><li class="listitem"><p>Any fact that matches - Validate that there is at least one fact in the knowledge base with the specified
          field values.</p></li></ul></div></div><div class="section" title="19.8.4. Global Section"><div class="titlepage"><div><div><h3 class="title"><a id="drools.TestScenarioEditorGlobalSection"/>19.8.4. Global Section</h3></div></div></div><div class="figure"><a id="d0e22226"/><p class="title"><strong>Figure 19.69. Global popup</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/NewGlobal.png" align="middle" alt="Global popup"/></div></div></div><br class="figure-break"/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Global - Validate that the global field values.</p></li></ul></div></div><div class="section" title="19.8.5. New Input Section"><div class="titlepage"><div><div><h3 class="title"><a id="drools.TestScenarioEditorInpuotSection"/>19.8.5. New Input Section</h3></div></div></div><div class="figure"><a id="d0e22239"/><p class="title"><strong>Figure 19.70. New Input popup</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/NewInput.png" align="middle" alt="New Input popup"/></div></div></div><br class="figure-break"/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Call method on an existing fact - Call a method from a fact in the beginning of the rule execution.</p></li></ul></div></div></div><div class="section" title="19.9. Functions"><div class="titlepage"><div><div><h2 class="title"><a id="drools.FunctionEditor"/>19.9. Functions</h2></div></div></div><p>Functions are another asset type. They are NOT rules, and should only
  be used when necessary. The function editor is a textual editor.
  Functions</p><div class="figure"><a id="d0e22254"/><p class="title"><strong>Figure 19.71. Function</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/Function.png" align="middle" alt="Function"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.10. DSL editor"><div class="titlepage"><div><div><h2 class="title"><a id="drools.DSLEditor"/>19.10. DSL editor</h2></div></div></div><p>The DSL editor allows DSL Sentences to be authored. The reader should
  take time to explore DSL features in the Drools Expert documentation; as the
  syntax in Drools Workbench's DSL Editor is identical. The normal syntax is extended to
  provide "hints" to control how the DSL variable is rendered and validated
  within the user-interface.</p><p>The following "hints" are supported:-</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>{&lt;varName&gt;:&lt;regular expression&gt;}</p><p>This will render a text field in place of the DSL variable when
      the DSL Sentence is used in the guided editor. The content of the text
      field will be validated against the regular expression.</p></li><li class="listitem"><p>{&lt;varName&gt;:ENUM:&lt;factType.fieldName&gt;}</p><p>This will render an enumeration in place of the DSL variable when
      the DSL Sentence is used in the guided editor.
      &lt;factType.fieldName&gt; binds the enumeration to the model Fact and
      Field enumeration definition. This could be either a "Drools Workbench
      enumeration" (i.e. defined within the Workbench) or a Java
      enumeration (i.e. defined in a model POJO JAR file).</p></li><li class="listitem"><p>{&lt;varName&gt;:DATE:&lt;dateFormat&gt;}</p><p>This will render a Date selector in place of the DSL variable when
      the DSL Sentence is used in the guided editor.</p></li><li class="listitem"><p>{&lt;varName&gt;:BOOLEAN:&lt;[checked | unchecked]&gt;}</p><p>This will render a dropdown selector in place of the DSL variable,
      providing boolean choices, when the DSL Sentence is used in the guided
      editor.</p></li><li class="listitem"><p>{&lt;varName&gt;:CF:&lt;factType.fieldName&gt;}</p><p>This will render a button that will allow you to set the value of
      this variable using a Custom Form. In order to use this feature, a 
      Working-Set containing a Custom Form Configuration for factType.fieldName
      must be active. If there is no such Working-Set, a simple text box
      is used (just like a regular variable).</p><p>For more information, please read more about Working-Sets and
      Custom Form Configurations.</p></li></ul></div><div class="figure"><a id="d0e22295"/><p class="title"><strong>Figure 19.72. DSL rule</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/DSLEditor.png" align="middle" alt="DSL rule"/></div></div></div><br class="figure-break"/></div><div class="section" title="19.11. Data enumerations (drop down list configurations)"><div class="titlepage"><div><div><h2 class="title"><a id="drools.EnumerationEditor"/>19.11. Data enumerations (drop down list configurations)</h2></div></div></div><p>Data enumerations are an optional asset type that technical folk can
  configure to provide drop down lists for the guided editor. These are stored
  and edited just like any other asset, and apply to the package that they
  belong to.</p><p>The contents of an enum config are a mapping of <code class="code">Fact.field</code> to a list
  of values to be used in a drop down. The strings are either a value to be shown in a drop down, or a mapping from
  the code value (what ends up used in the rule) and a display value.</p><div class="figure"><a id="d0e22311"/><p class="title"><strong>Figure 19.73. Data enumeration</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/EnumConfig.png" align="middle" alt="Data enumeration"/></div></div></div><br class="figure-break"/><p>If you wish to use a mapping between value used in the rule and the value shown in the UI you
    need to separate the code value and display value with an equals sign. For
    example:</p><pre><code class="no-highlight">'Person.gender' : ['M=Male','F=Female']</code></pre><p>In this example
      <code class="code">F</code> will be used in the rules but <code class="code">Female</code> shown in the UI.</p><p>Drop down lists can also depend on other field values.</p><p>Lets imagine a simple fact model, we have a class called Vehicle, which has 2 fields:
    <code class="code">engineType</code> and <code class="code">fuelType</code>. We want to have a choice for the <code class="code">engineType</code>
    of "Petrol" or "Diesel". Now, obviously the choice type for fuel must be
    dependent on the engine type (so for Petrol we have ULP and PULP, and for
    Diesel we have BIO and NORMAL). We can express this dependency in an
    enumeration as:</p><div class="figure"><a id="d0e22341"/><p class="title"><strong>Figure 19.74. </strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/EnumVehicleEngine.png" align="middle"/></div></div></div><br class="figure-break"/><p>This shows how it is possible to make the choices dependent on other
    field values. Note that once you pick the engineType, the choice list for
    the fuelType will be determined.</p><div class="section" title="19.11.1. Advanced enumeration concepts"><div class="titlepage"><div><div><h3 class="title"><a id="drools.AdvancedEnumConcepts"/>19.11.1. Advanced enumeration concepts</h3></div></div></div><p>There are a few other advanced things you can do with data enumerations.</p><div class="section" title="19.11.1.1. External data-sources"><div class="titlepage"><div><div><h4 class="title"><a id="drools.AdvanceEnumConcepts.external"/>19.11.1.1. External data-sources</h4></div></div></div><p>Instead of defining a static list you can retrieve the list from an external data-source
        by using a helper class.</p><p>The helper class must be on the Project's classpath; by adding a JAR containng the class
        as a project dependency. The helper class must be instantiable and have a non-static method
        that returns a <code class="code">java.util.List</code>. Population of the list is implementation
        specific.</p><p>For
        example:</p><pre><code class="no-highlight">'Person.age' : (new org.yourco.DataHelper()).getListOfAges()</code></pre><p>In some other cases you may want to load the enumeration data entirely from an external
        data source (such as a relational database). To do this, you can implement a class that
        returns a <code class="code">Map&lt;String, List&lt;String&gt;&gt;</code>. The key of the map is the <code class="code">Fact.field</code> 
        and the value is a <code class="code">java.util.List&lt;String&gt;</code> of values to be used.</p><pre><code class="language-java">public class SampleDataSource2 {

  public Map&lt;String&gt;, List&lt;String&gt; loadData() {
    Map data = new HashMap();

    List d = new ArrayList();
    d.add("value1");
    d.add("value2");
    data.put("Fact.field", d);

    return data;
  }

}</code></pre><p>The enumeration definition would simply be as follows (with no reference to fact or
        field names):</p><pre><code class="language-java">=(new SampleDataSource2()).loadData()</code></pre><p>The <code class="code">=</code> operator informs the workbench to load all enumeration data from the
        helper class.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The helper methods will be statically evaluated when the
          enumeration definition is requested for use in an editor.</p></div></div><div class="section" title="19.11.1.2. Dynamic lookup"><div class="titlepage"><div><div><h4 class="title"><a id="drools.AdvanceEnumConcepts.dynamic"/>19.11.1.2. Dynamic lookup</h4></div></div></div><p>All of the above cases retrieve the list of values by statically evaluating the
        enumeration definition when enumerations are required by an editor.</p><p>It is also possible to load
        dependent enumeration definitions dynamically from a helper class by enclosing the call to
        the helper class within quotation marks. For
        example:</p><pre><code class="no-highlight">'Country.region[countryCode]' : '(new org.yourco.DataHelper()).getListOfRegions("@{countryCode}")'</code></pre></div></div></div><div class="section" title="19.12. Technical rules (DRL)"><div class="titlepage"><div><div><h2 class="title"><a id="drools.DRLEditor"/>19.12. Technical rules (DRL)</h2></div></div></div><p>Technical (DRL) rules are stored as text - they can be managed in Drools Workbench. 
    A DRL can either be a whole chunk of rules, or an individual rule.
  If it's an individual rule, no package statement or imports are required (in
  fact, you can skip the "rule" statement altogether, just use "when" and
  "then" to mark the condition and action sections respectively). Normally you
  would use the IDE to edit raw DRL files, since it has all the advanced
  tooling and content assistance and debugging. However, there are times when
  a rule may have to deal with something fairly technical in a package in
  Drools Workbench. In any typical package of rules, you generally have a need for some
  "technical rules" - you can mix and match all the rule types together of
  course.</p><div class="figure"><a id="d0e22405"/><p class="title"><strong>Figure 19.75. DRL technical rule</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Workbench/AuthoringAssets/DRLRule.png" align="middle" alt="DRL technical rule"/></div></div></div><br class="figure-break"/></div></div><div class="chapter" title="Chapter 20. Workbench Integration"><div class="titlepage"><div><div><h2 class="title"><a id="wb.WorkbenchIntegration"/>Chapter 20. Workbench Integration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#drools.WorkbenchRemoteAPI">20.1. REST</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e22427">20.1.1. Job calls</a></span></dt><dt><span class="section"><a href="#d0e22531">20.1.2. Repository calls</a></span></dt><dt><span class="section"><a href="#d0e22706">20.1.3. Organizational unit calls</a></span></dt><dt><span class="section"><a href="#d0e22837">20.1.4. Maven calls</a></span></dt><dt><span class="section"><a href="#d0e22953">20.1.5. REST summary</a></span></dt></dl></dd><dt><span class="section"><a href="#kie.KeycloakSSOIntegration">20.2. Keycloak SSO integration</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e23153">20.2.1. Scenario</a></span></dt><dt><span class="section"><a href="#d0e23178">20.2.2. Install and setup a Keycloak server</a></span></dt><dt><span class="section"><a href="#d0e23222">20.2.3. Create and setup the demo realm</a></span></dt><dt><span class="section"><a href="#d0e23351">20.2.4. Install and setup jBPM Workbench</a></span></dt><dt><span class="section"><a href="#d0e23519">20.2.5. Securing workbench remote services via Keycloak</a></span></dt><dt><span class="section"><a href="#d0e23565">20.2.6. Securing workbench's file system services via Keycloak</a></span></dt><dt><span class="section"><a href="#d0e23668">20.2.7. Execution server</a></span></dt><dt><span class="section"><a href="#d0e23850">20.2.8. Consuming remote services</a></span></dt></dl></dd></dl></div><div class="section" title="20.1. REST"><div class="titlepage"><div><div><h2 class="title"><a id="drools.WorkbenchRemoteAPI"/>20.1. REST</h2></div></div></div><p>REST API calls to Knowledge Store allow you to manage the Knowledge Store content and manipulate the static data in the repositories of 
          the Knowledge Store. The calls are asynchronous, that is, they continue their execution after the call was performed as a job. The job ID 
          is returned by every calls to allow after the REST API call was performed to request the job status and verify whether the job finished 
          successfully. Parameters of these calls are provided in the form of JSON entities. </p><p>When using Java code to interface with the REST API, the classes used in POST operations
          or otherwise returned by various operations can be found in the <code class="code">(org.kie.workbench.services:)kie-wb-common-services</code> JAR. All 
          of the classes mentioned below can be found in the <code class="code">org.kie.workbench.common.services.shared.rest</code> package in that JAR.</p><div class="section" title="20.1.1. Job calls"><div class="titlepage"><div><div><h3 class="title"><a id="d0e22427"/>20.1.1. Job calls</h3></div></div></div><p>Every Knowledge Store REST call returns its job ID after it was sent. This is necessary as the calls are asynchronous and you need 
               to be able to reference the job to check its status as it goes through its lifecycle. During its lifecycle, a job can have the 
               following statuses:
          </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="code">ACCEPTED</code>: the job was accepted and is being processed</p></li><li class="listitem"><p><code class="code">BAD_REQUEST</code>: the request was not accepted as it contained incorrect content</p></li><li class="listitem"><p><code class="code">RESOURCE_NOT_EXIST</code>: the requested resource (path) does not exist</p></li><li class="listitem"><p><code class="code">DUPLICATE_RESOURCE</code>: the resource already exists</p></li><li class="listitem"><p><code class="code">SERVER_ERROR</code>: an error on the server occurred</p></li><li class="listitem"><p><code class="code">SUCCESS</code>: the job finished successfully</p></li><li class="listitem"><p><code class="code">FAIL</code>: the job failed</p></li><li class="listitem"><p><code class="code">DENIED</code>: the job was denied</p></li><li class="listitem"><p><code class="code">GONE</code>: the job ID could not be found</p><p>A job can be GONE in the following cases:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The job was explicitly removed</p></li><li class="listitem"><p>The job finished and has been deleted from the status cache (the job is removed from status cache after the cache 
                              has reached its maximum capacity)</p></li><li class="listitem"><p>The job never existed</p></li></ul></div></li></ul></div><p>The following <code class="code">job</code> calls are provided:</p><div class="variablelist"><dl><dt><a id="url-get-job"/><span class="term">[GET] <span class="command"><strong>/jobs/<span class="emphasis"><em>{jobID}</em></span></strong></span></span></dt><dd><p>Returns the job status</p><p>Returns a <code class="code">JobResult</code> instance</p><div class="example"><a id="d0e22511"/><p class="title"><strong>Example 20.1. An example (formatted) response body to the get job call on a
                                   repository clone request</strong></p><div class="example-contents"><pre><code class="no-highlight">"{
  "status":"SUCCESS",
  "jodId":"1377770574783-27",
  "result":"Alias: testInstallAndDeployProject, Scheme: git, Uri: git://testInstallAndDeployProject",
  "lastModified":1377770578194,"detailedResult":null
}"</code></pre></div></div><br class="example-break"/></dd><dt><a id="url-delete-job"/><span class="term">[DELETE] <span class="command"><strong>/jobs/<span class="emphasis"><em>{jobID}</em></span></strong></span></span></dt><dd><p>Removes the job: If the job is not yet being processed, this will
                              remove the job from the job queue. However, this will not cancel or
                              stop an ongoing job</p><p>Returns a <code class="code">JobResult</code> instance</p></dd></dl></div></div><div class="section" title="20.1.2. Repository calls"><div class="titlepage"><div><div><h3 class="title"><a id="d0e22531"/>20.1.2. Repository calls</h3></div></div></div><p>Repository calls are calls to the Knowledge Store that allow you to manage its Git repositories and their projects.</p><p>The following <code class="code">repositories</code> calls are provided:</p><div class="variablelist"><dl><dt><a id="url-get-repositories"/><span class="term">[GET] <span class="command"><strong>/repositories</strong></span></span></dt><dd><p>Gets information about the repositories in the Knowledge Store</p><p>Returns a <code class="code">Collection&lt;Map&lt;String, String&gt;&gt;</code> or <code class="code">Collection&lt;RepositoryRequest&gt;</code> instance,  
                               depending on the JSON serialization library being used. The keys used in the <code class="code">Map&lt;String, String&gt;</code> instance match
                               the fields in the <code class="code">RepositoryRequest</code> class</p><div class="example"><a id="d0e22564"/><p class="title"><strong>Example 20.2. An example (formatted) response body to the get repositories
                                   call</strong></p><div class="example-contents"><pre><code class="no-highlight">[
  {
    "name":"wb-assets",
    "description":"generic assets",
    "userName":null,
    "password":null,
    "requestType":null,
    "gitURL":"git://bpms-assets"
 },
 {
   "name":"loanProject",
   "description":"Loan processes and rules",
   "userName":null,
   "password":null,
   "requestType":null,
   "gitURL":"git://loansProject"
 }
]</code></pre></div></div><br class="example-break"/></dd><dt><a id="url-get-repository"/><span class="term">[GET] <span class="command"><strong>/repositories/{repositoryName}</strong></span></span></dt><dd><p>Gets information about a repository</p><p>Returns a <code class="code">Map&lt;String, String&gt;</code> or <code class="code">RepositoryRequest</code> instance, depending on the JSON serialization library being used. The keys used in the <code class="code">Map&lt;String, String&gt;</code> instance match the fields in the <code class="code">RepositoryRequest</code> class</p><div class="example"><a id="d0e22591"/><p class="title"><strong>Example 20.3. An example (formatted) response body to the get repository call</strong></p><div class="example-contents"><pre><code class="no-highlight">{
  "name":"wb-assets",
  "description":"generic assets",
  "userName":null,
  "password":null,
  "requestType":null,
  "gitURL":"git://bpms-assets"
}</code></pre></div></div><br class="example-break"/></dd><dt><a id="url-create-repository"/><span class="term">[POST] <span class="command"><strong>/repositories</strong></span></span></dt><dd><p>Creates a new empty repository or a new repository cloned from an existing (git) repository</p><p>Consumes a <code class="code">RepositoryRequest</code> instance</p><p>Returns a <code class="code">CreateOrCloneRepositoryRequest</code> instance</p><div class="example"><a id="d0e22614"/><p class="title"><strong>Example 20.4. An example (formatted) response body to the create repositories
                                   call</strong></p><div class="example-contents"><pre><code class="no-highlight">{
  "name":"new-project-repo",
  "description":"repo for my new project",
  "userName":null,"password":null,
  "requestType":"new",
  "gitURL":null
}</code></pre></div></div><br class="example-break"/></dd><dt><a id="url-delete-repository"/><span class="term">[DELETE] <span class="command"><strong>/repositories/<span class="emphasis"><em>{repositoryName}</em></span></strong></span></span></dt><dd><p>Removes the repository from the Knowledge Store</p><p>Returns a <code class="code">RemoveRepositoryRequest</code> instance</p></dd><dt><a id="url-create-project"/><span class="term">[POST] <span class="command"><strong>/repositories/<span class="emphasis"><em>{repositoryName}</em></span>/projects/</strong></span></span></dt><dd><p>Creates a project in the repository</p><p>Consumes an <code class="code">Entity</code> instance</p><p>Returns a <code class="code">CreateProjectRequest</code> instance</p><div class="example"><a id="d0e22655"/><p class="title"><strong>Example 20.5. An example (formatted) request body that defines the project to be created</strong></p><div class="example-contents"><pre><code class="no-highlight">{
  "name":"myProject",
  "description": "my project"
}</code></pre></div></div><br class="example-break"/></dd><dt><a id="url-delete-project"/><span class="term">[DELETE] <span class="command"><strong>/repositories/<span class="emphasis"><em>{repositoryName}</em></span>/projects/</strong></span></span></dt><dd><p>Deletes the project in the repository</p><p>Returns a <code class="code">DeleteProjectRequest</code> instance</p></dd><dt><a id="url-get-projects"/><span class="term">[GET] <span class="command"><strong>/repositories/<span class="emphasis"><em>{repositoryName}</em></span>/projects/</strong></span></span></dt><dd><p>Gets information about the projects</p><p>Returns a <code class="code">Collection&lt;Map&lt;String, String&gt;&gt;</code> or <code class="code">Collection&lt;ProjectResponse&gt;</code> instance, depending on the JSON serialization library being used. The keys used in the <code class="code">Map&lt;String, String&gt;</code> instance match the fields in the <code class="code">ProjectResponse</code> class</p><div class="example"><a id="d0e22701"/><p class="title"><strong>Example 20.6. An example (formatted) response body to the get projects call</strong></p><div class="example-contents"><pre><code class="no-highlight">[
  {
    "name":"wb-assets",
    "description":"generic assets",
    "groupId":"org.test",
    "version":"1.0"
 },
 {
   "name":"loanProject",
   "description":"Loan processes and rules",
    "groupId":"com.bank",
    "version":"3.7"
 }
]</code></pre></div></div><br class="example-break"/></dd></dl></div></div><div class="section" title="20.1.3. Organizational unit calls"><div class="titlepage"><div><div><h3 class="title"><a id="d0e22706"/>20.1.3. Organizational unit calls</h3></div></div></div><p>Organizational unit calls are calls to the Knowledge Store that allow you to manage its organizational units, so as to organize the 
                connected Git repositories.
          </p><p>The following <code class="code">organizationalUnits</code> calls are provided:</p><div class="variablelist"><dl><dt><a id="url-create-org-unit"/><span class="term">[POST] <span class="command"><strong>/organizationalunits</strong></span></span></dt><dd><p>Creates an organizational unit in the Knowledge Store</p><p>Consumes an <code class="code">OrganizationalUnit</code> instance</p><p>Returns a <code class="code">CreateOrganizationalUnitRequest</code> instance</p><div class="example"><a id="d0e22735"/><p class="title"><strong>Example 20.7. An example (formatted) request body defining a new organizational unit to be created</strong></p><div class="example-contents"><pre><code class="no-highlight">{
  "name":"testgroup",
  "description":"",
  "owner":"tester",
  "repositories":["testGroupRepository"]
}</code></pre></div></div><br class="example-break"/></dd><dt><a id="url-get-org-unit"/><span class="term">[GET] <span class="command"><strong>/organizationalunits/{orgUnitName}</strong></span></span></dt><dd><p>Creates an organizational unit</p><p>Consumes an <code class="code">OrganizationalUnit</code> instance</p><p>Returns a <code class="code">CreateOrganizationalUnitRequest</code> instance</p><div class="example"><a id="d0e22758"/><p class="title"><strong>Example 20.8. An example (formatted) request body defining a new organizational unit to be created</strong></p><div class="example-contents"><pre><code class="no-highlight">{
  "name":"testgroup",
  "description":"",
  "owner":"tester",
  "repositories":["testGroupRepository"]
}</code></pre></div></div><br class="example-break"/></dd><dt><a id="url-update-org-unit"/><span class="term">[POST] <span class="command"><strong>/organizationalunits/{orgUnitName}</strong></span></span></dt><dd><p>Creates an organizational unit in the Knowledge Store</p><p>Consumes an <code class="code">UpdateOrganizationalUnit</code> instance</p><p>Returns a <code class="code">UpdateOrganizationalUnitRequest</code> instance</p><div class="example"><a id="d0e22781"/><p class="title"><strong>Example 20.9. An example (formatted) request body defining a new organizational unit to be created</strong></p><div class="example-contents"><pre><code class="no-highlight">{
  "name":"testgroup",
  "description":"",
  "owner":"tester",
  "repositories":["testGroupRepository"]
}</code></pre></div></div><br class="example-break"/></dd><dt><a id="url-remove-org-unit"/><span class="term">[DELETE] <span class="command"><strong>/organizationalunits/<span class="emphasis"><em>{organizationalUnitName}</em></span></strong></span></span></dt><dd><p>Deletes a organizational unit</p><p>Returns a <code class="code">RemoveOrganizationalUnitRequest</code> instance</p></dd><dt><a id="url-add-repo-to-org-unit"/><span class="term">[POST] <span class="command"><strong>/organizationalunits/<span class="emphasis"><em>{organizationalUnitName}</em></span>/repositories/<span class="emphasis"><em>{repositoryName}</em></span></strong></span></span></dt><dd><p>Adds the repository to the organizational unit</p><p>Returns a <code class="code">AddRepositoryToOrganizationalUnitRequest</code> instance</p></dd><dt><a id="url-remove-repo-to-org-unit"/><span class="term">[DELETE] <span class="command"><strong>/organizationalunits/<span class="emphasis"><em>{organizationalUnitName}</em></span>/repositories/<span class="emphasis"><em>{repositoryName}</em></span></strong></span></span></dt><dd><p>Removes the repository from the organizational unit</p><p>Returns a <code class="code">RemoveRepositoryFromOrganizationalUnitRequest</code> instance</p></dd></dl></div></div><div class="section" title="20.1.4. Maven calls"><div class="titlepage"><div><div><h3 class="title"><a id="d0e22837"/>20.1.4. Maven calls</h3></div></div></div><p>Maven calls are calls to a Project in the Knowledge Store that allow you compile and deploy the Project resources.</p><p>The following <code class="code">maven</code> calls are provided:</p><div class="variablelist"><dl><dt><a id="url-compile-project"/><span class="term"> [POST] <span class="command"><strong>/repositories/<span class="emphasis"><em>{repositoryName}</em></span>/projects/<span class="emphasis"><em>{projectName}</em></span>/maven/compile</strong></span></span></dt><dd><p>Compiles the project (equivalent to <code class="code">mvn compile</code>)</p><p>Consumes a <code class="code">BuildConfig</code> instance. While this must be supplied, it's not needed for the operation and may be left blank.</p><p>Returns a <code class="code">CompileProjectRequest</code> instance</p></dd><dt><a id="url-install-project"/><span class="term">[POST] <span class="command"><strong>/repositories/<span class="emphasis"><em>{repositoryName}</em></span>/projects/<span class="emphasis"><em>{projectName}</em></span>/maven/install</strong></span></span></dt><dd><p>Installs the project (equivalent to <code class="code">mvn install</code>)</p><p>Consumes a <code class="code">BuildConfig</code> instance. While this must be supplied, it's not needed for the operation and may be left blank.</p><p>Returns a <code class="code">InstallProjectRequest</code> instance</p></dd><dt><a id="url-test-project"/><span class="term">[POST] <span class="command"><strong>/repositories/<span class="emphasis"><em>{repositoryName}</em></span>/projects/<span class="emphasis"><em>{projectName}</em></span>/maven/test</strong></span></span></dt><dd><p>Compiles the project runs a test as part of compilation</p><p>Consumes a <code class="code">BuildConfig</code> instance</p><p>Returns a <code class="code">TestProjectRequest</code> instance</p></dd><dt><a id="url-deploy-project"/><span class="term">[POST] <span class="command"><strong>/repositories/<span class="emphasis"><em>{repositoryName}</em></span>/projects/<span class="emphasis"><em>{projectName}</em></span>/maven/deploy</strong></span></span></dt><dd><p>Deploys the project (equivalent to  <code class="code">mvn deploy</code>)</p><p>Consumes a <code class="code">BuildConfig</code> instance. While this must be supplied, it's not needed for the operation and may be left blank.</p><p>Returns a <code class="code">DeployProjectRequest</code> instance</p></dd></dl></div></div><div class="section" title="20.1.5. REST summary"><div class="titlepage"><div><div><h3 class="title"><a id="d0e22953"/>20.1.5. REST summary</h3></div></div></div><p>
        The URL templates in the table below are relative the following URL: 
        </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p> 
              <code class="code">http://server:port/business-central/rest</code>
            </p></li></ul></div><p>
      </p><div class="table"><a id="kstore_rest_api_calls"/><p class="title"><strong>Table 20.1. Knowledge Store REST calls</strong></p><div class="table-contents"><table summary="Knowledge Store REST calls" border="1"><colgroup><col width="62*" align="left" class="c1"/><col width="8*" align="left" class="c2"/><col width="30*" align="left" class="c3"/></colgroup><thead><tr><th align="left">URL Template</th><th align="left">Type</th><th align="left">Description</th></tr></thead><tbody><tr valign="top"><td align="left" valign="top">/jobs/{jobID}</td><td align="left" valign="top">GET</td><td align="left" valign="top">return the job status</td></tr><tr valign="top"><td align="left" valign="top">/jobs/{jobID}</td><td align="left" valign="top">DELETE</td><td align="left" valign="top">remove the job</td></tr><tr valign="top"><td align="left" valign="top">/organizationalunits</td><td align="left" valign="top">GET</td><td align="left" valign="top">return a list of organizational units</td></tr><tr valign="top"><td align="left" valign="top">/organizationalunits</td><td align="left" valign="top">POST</td><td align="left" valign="top">
              <p>create an organizational unit in the Knowledge Store described by the JSON <code class="code">OrganizationalUnit</code> entity</p>
            </td></tr><tr valign="top"><td align="left" valign="top">/organizationalunits/{organizationalUnitName}/repositories/{repositoryName}</td><td align="left" valign="top">POST</td><td align="left" valign="top">add a repository to an organizational unit</td></tr><tr valign="top"><td align="left" valign="top">/organizationalunits/{organizationalUnitName}/repositories/{repositoryName}</td><td align="left" valign="top">DELETE</td><td align="left" valign="top">remove a repository from an organizational unit</td></tr><tr valign="top"><td align="left" valign="top">/repositories/</td><td align="left" valign="top">POST</td><td align="left" valign="top">
              <p>add the repository to the organizational unit described by the JSON <code class="code">RepositoryReqest</code> entity</p>
            </td></tr><tr valign="top"><td align="left" valign="top">/repositories</td><td align="left" valign="top">GET</td><td align="left" valign="top">return the repositories in the Knowledge Store</td></tr><tr valign="top"><td align="left" valign="top">/repositories/{repositoryName}</td><td align="left" valign="top">DELETE</td><td align="left" valign="top">remove the repository from the Knowledge Store</td></tr><tr valign="top"><td align="left" valign="top">/repositories/</td><td align="left" valign="top">POST</td><td align="left" valign="top">create or clone the repository defined by the JSON <code class="code">RepositoryRequest</code> entity</td></tr><tr valign="top"><td align="left" valign="top">/repositories/{repositoryName}/projects/</td><td align="left" valign="top">POST</td><td align="left" valign="top">create the project defined by the JSON entity in the repository</td></tr><tr valign="top"><td align="left" valign="top">/repositories/{repositoryName}/projects/{projectName}/maven/compile/</td><td align="left" valign="top">POST</td><td align="left" valign="top">compile the project</td></tr><tr valign="top"><td align="left" valign="top">/repositories/{repositoryName}/projects/{projectName}/maven/install</td><td align="left" valign="top">POST</td><td align="left" valign="top">install the project</td></tr><tr valign="top"><td align="left" valign="top">/repositories/{repositoryName}/projects/{projectName}/maven/test/</td><td align="left" valign="top">POST</td><td align="left" valign="top">
              <p>compile the project and run tests as part of compilation</p>
            </td></tr><tr valign="top"><td align="left" valign="top">/repositories/{repositoryName}/projects/{projectName}/maven/deploy/</td><td align="left" valign="top">POST</td><td align="left" valign="top">deploy the project</td></tr></tbody></table></div></div><br class="table-break"/></div></div><div class="section" title="20.2. Keycloak SSO integration"><div class="titlepage"><div><div><h2 class="title"><a id="kie.KeycloakSSOIntegration"/>20.2. Keycloak SSO integration</h2></div></div></div><p>Single Sign On (SSO) and related token exchange mechanisms are becoming the most common
    scenario for the authentication and authorization in different environments on the web,
    specially when moving into the cloud. </p><p>This section talks about the integration of Keycloak with jBPM or Drools applications in
    order to use all the features provided on Keycloak. Keycloak is an integrated SSO and IDM for
    browser applications and RESTful web services. Lean more about it in the <a class="link" href="http://keycloak.jboss.org/">Keycloak's home page</a>.</p><p>The result of the integration with Keycloak has lots of advantages such as:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Provide an integrated SSO and IDM environment for different clients, including jBPM
          and Drools workbenches</p></li><li class="listitem"><p>Social logins - use your Facebook, Google, Linkedin, etc accounts</p></li><li class="listitem"><p>User session management</p></li><li class="listitem"><p>And much more...</p></li></ul></div><p>Next sections cover the following integration points with Keycloak:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Workbench authentication through a Keycloak
          server</strong></span></p><p>It basically consists of securing both web client and remote service clients through
          the Keycloak SSO. So either web interface or remote service consumers ( whether a user or
          a service ) will authenticate into trough KC.</p></li><li class="listitem"><p><span class="bold"><strong>Execution server authentication through a Keycloak
            server</strong></span></p><p>Consists of securing the remote services provided by the execution server (as it does
          not provides web interface). Any remote service consumer ( whether a user or a service )
          will authenticate trough KC.</p></li><li class="listitem"><p><span class="bold"><strong>Consuming remote services</strong></span></p><p>This section describes how a third party clients can consume the remote service
          endpoints provided by both Workbench and Execution Server, such as the REST API or remote file system services.</p></li></ul></div><div class="section" title="20.2.1. Scenario"><div class="titlepage"><div><div><h3 class="title"><a id="d0e23153"/>20.2.1. Scenario</h3></div></div></div><p>Consider the following diagram as the environment for this document's example:</p><p>Keycloak is a standalone process that provides remote authentication, authorization and
      administration services that can be potentially consumed by one or more jBPM applications over
      the network.</p><div class="figure"><a id="d0e23160"/><p class="title"><strong>Figure 20.1. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/KeycloakSSOIntegration/KeyCloak_sso_scenario.png"/></div></div></div><br class="figure-break"/><p>Consider these main steps for building this environment:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Install and setup a Keycloak server</p></li><li class="listitem"><p>Create and setup a Realm for this example - Configure realm's clients, users and
            roles</p></li><li class="listitem"><p>Install and setup the SSO client adapter &amp; jBPM application</p></li></ul></div><p>Note: The resulting environment and the different configurations for this document are
      based on the jBPM (KIE) Workbench, but same ones can also be applied for the KIE Drools
      Workbench as well.</p></div><div class="section" title="20.2.2. Install and setup a Keycloak server"><div class="titlepage"><div><div><h3 class="title"><a id="d0e23178"/>20.2.2. Install and setup a Keycloak server</h3></div></div></div><p>Keycloak provides an extensive documentation and several articles about the installation
      on different environments. This section describes the minimal setup for being able to build
      the integrated environment for the example. Please refer to the <a class="link" href="http://keycloak.jboss.org/docs">Keycloak documentation</a> if you need more
      information.</p><p>Here are the steps for a minimal Keycloak installation and setup:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Download latest version of Keycloak from the <a class="link" href="http://keycloak.jboss.org/downloads">Downloads</a> section. This
            example is based on Keycloak 1.9.0.Final</p></li><li class="listitem"><p>Unzip the downloaded distribution of Keycloak into a folder, let's refer it as
            </p><pre><code class="no-highlight">$KC_HOME</code></pre></li><li class="listitem"><p>Run the KC server - This example is based on running both Keycloak and jBPM on same
            host. In order to avoid port conflicts you can use a port offset for the Keycloak's
            server as:</p><p>
            </p><pre><code class="no-highlight">$KC_HOME/bin/standalone.sh -Djboss.socket.binding.port-offset=100</code></pre><p>
          </p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Create a Keycloak's administration user - Execute the following command to create an
            admin user for this example:</p><p>
            </p><pre><code class="no-highlight">$KC_HOME/bin/add-user.sh -r master -u 'admin' -p 'admin'</code></pre><p>
          </p></li></ul></div><p>The Keycloak administration console will be available at <a class="link" href="http://localhost:8180/auth/admin">http://localhost:8180/auth/admin</a> (use
      the admin/admin for login credentials).</p></div><div class="section" title="20.2.3. Create and setup the demo realm"><div class="titlepage"><div><div><h3 class="title"><a id="d0e23222"/>20.2.3. Create and setup the demo realm</h3></div></div></div><p>Security realms are used to restrict the access for the different application's
      resources.</p><p>Once the Keycloak server is running next step is about creating a realm. This realm will
      provide the different users, roles, sessions, etc for the jBPM application/s.</p><p>Keycloak provides several examples for the realm creation and management, from the <a class="link" href="https://github.com/keycloak/keycloak/tree/master/examples">official
        examples</a> to different articles with more examples.</p><p>Follow these steps in order to create the <span class="italic">demo</span> realm
      used later in this document:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Go to the Keycloak <a class="link" href="http://localhost:8180/auth/admin">administration console</a> and click on <span class="italic">Add
              realm</span> button. Give it the name <span class="italic">demo</span>.</p></li><li class="listitem"><p>Go to the Clients section (from the main admin console menu) and create a new client
            for the <span class="italic">demo</span> realm:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Client ID:  <span class="emphasis"><em>kie</em></span></p></li><li class="listitem"><p>Client protocol: <span class="emphasis"><em>openid-connect</em></span></p></li><li class="listitem"><p>Acces type: <span class="emphasis"><em>confidential</em></span></p></li><li class="listitem"><p>Root URL: <span class="emphasis"><em>http://localhost:8080</em></span></p></li><li class="listitem"><p>Base URL:  <span class="italic">/kie-wb-6.4.0.Final</span></p></li><li class="listitem"><p>Redirect URIs: <span class="italic">/kie-wb-6.4.0.Final/*</span></p></li></ul></div></li></ul></div><p>The resulting <span class="italic">kie</span> client settings screen:</p><div class="figure"><a id="d0e23294"/><p class="title"><strong>Figure 20.2. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/KeycloakSSOIntegration/kie_client_settings.png"/></div></div></div><br class="figure-break"/><p><span class="underline">Note</span>: As you can see in the above settings it's
      being considered the value <span class="italic">kie-wb-6.4.0.Final</span> for the
      application's context path. If your jbpm application will be deployed on a different context
      path, host or port, just use your concrete settings here.</p><p>Last step for being able to use the <span class="italic">demo </span>realm from the
      jBPM workbench is create the application's user and roles:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Go to the Roles section and create the roles <span class="italic">admin,</span>
            <span class="italic">kiemgmt </span>and <span class="italic">rest-all</span></p></li><li class="listitem"><p>Go to the Users section and create the <span class="italic">admin
            </span>user. Set the password with value "password" in the credentials tab, unset
            the temporary switch.</p></li><li class="listitem"><p>In  the Users section navigate to the <span class="italic">Role
              Mappings</span> tab and assign the <span class="italic">admin,
              </span><span class="italic">kiemgmt </span>and <span class="italic">rest-all</span> roles to the <span class="italic">admin</span> user</p><div class="figure"><a id="d0e23345"/><p class="title"><strong>Figure 20.3. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/KeycloakSSOIntegration/admin_user_roles.png"/></div></div></div><br class="figure-break"/></li></ul></div><p>At this point a Keycloak server is running on the host, setup with a minimal configuration
      set. Let's move to the jBPM workbench setup.</p></div><div class="section" title="20.2.4. Install and setup jBPM Workbench"><div class="titlepage"><div><div><h3 class="title"><a id="d0e23351"/>20.2.4. Install and setup jBPM Workbench</h3></div></div></div><p>For this tutorial let's use a Wildfly as the application server for the jBPM workbench, as
      the jBPM installer does by default.</p><p>Let's assume, after running the jBPM installer, the <span class="italic">$JBPM_HOME</span> as the root path for the Wildfly server where the application has
      been deployed.</p><div class="section" title="20.2.4.1. Install the KC adapter"><div class="titlepage"><div><div><h4 class="title"><a id="d0e23361"/>20.2.4.1. Install the KC adapter</h4></div></div></div><p>In order to use the Keycloak's authentication and authorization modules from the jBPM
        application, the <a class="link" href="https://keycloak.github.io/docs/userguide/keycloak-server/html/ch08.html">Keycloak adapter</a> for Wildfly must be installed on our server at <span class="italic">$JBPM_HOME</span>. Keycloak provides multiple adapters for different
        containers out of the box, if you are using another container or need to use another
        adapter, please take a look at the <a class="link" href="https://keycloak.github.io/docs/userguide/keycloak-server/html/ch08.html">adapters configuration </a>from Keycloak docs. Here are the steps to install and setup
        the adapter for Wildfly 8.2.x:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Download the adapter from <a class="link" href="https://repository.jboss.org/nexus/service/local/repositories/central/content/org/keycloak/keycloak-wf8-adapter-dist/1.9.0.Final/keycloak-wf8-adapter-dist-1.9.0.Final.zip">here</a></p></li><li class="listitem"><p>Execute the following commands on your shell:</p><p>
              </p><pre><code class="no-highlight">cd $JBPM_HOME/unzip keycloak-wf8-adapter-dist.zip // Install the KC client adapter

cd $JBPM_HOME/bin
./standalone.sh -c standalone-full.xml // Setup the KC client adapter.

// ** Once server is up, open a new command line terminal and run:
cd $JBPM_HOME/bin
./jboss-cli.sh -c --file=adapter-install.cli</code></pre><p>
            </p></li></ul></div></div><div class="section" title="20.2.4.2. Configure the KC adapter"><div class="titlepage"><div><div><h4 class="title"><a id="d0e23389"/>20.2.4.2. Configure the KC adapter</h4></div></div></div><p>Once installed the KC adapter into Wildfly, next step is to configure the adapter in
        order to specify different settings such as the location for the authentication server, the
        realm to use and so on.</p><p>Keycloak provides two ways of configuring the adapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Per WAR configuration</p></li><li class="listitem"><p>Via Keycloak subsystem</p></li></ul></div><p>In this example let's use the second option, use the Keycloak subsystem, so our WAR is
        free from this kind of settings. If you want to use the per WAR approach, please take a look
          <a class="link" href="https://keycloak.github.io/docs/userguide/keycloak-server/html/ch08.html#d4e932">here</a>.</p><p>Edit the configuration file <span class="italic">$JBPM_HOME/standalone/configuration/standalone-full.xml</span> and locate the
        subsystem configuration section. Add the following content:</p><p>
        </p><pre><code class="no-highlight">&lt;subsystem xmlns="urn:jboss:domain:keycloak:1.1"&gt;
  &lt;secure-deployment name="kie-wb-6.4.0-Final.war"&gt;
    &lt;realm&gt;demo&lt;/realm&gt;
    &lt;realm-public-key&gt;MIIBIjANBgkqhkiG9w0BAQEFAAOCA...&lt;/realm-public-key&gt;
    &lt;auth-server-url&gt;http://localhost:8180/auth&lt;/auth-server-url&gt;
    &lt;ssl-required&gt;external&lt;/ssl-required&gt;
    &lt;resource&gt;kie&lt;/resource&gt;
    &lt;enable-basic-auth&gt;true&lt;/enable-basic-auth&gt;
    &lt;credential name="secret"&gt;925f9190-a7c1-4cfd-8a3c-004f9c73dae6&lt;/credential&gt;
    &lt;principal-attribute&gt;preferred_username&lt;/principal-attribute&gt;
  &lt;/secure-deployment&gt;
&lt;/subsystem&gt;</code></pre><p>
      </p><p>If you have imported the example json files from this document in <span class="italic">step 2</span>, you can just use same configuration as above by using
        your concrete deployment name . Otherwise please use your values for these configurations:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="underline">Name for the secure deployment</span> - Use your
              concrete application's WAR file name</p></li><li class="listitem"><p><span class="underline">Realm</span> - Is the realm that the applications
              will use, in our example, the <span class="italic">demo </span>realm created
              the previous step.</p></li><li class="listitem"><p><span class="underline">Realm Public Key</span> - Provide here the public
              key for the <span class="italic">demo </span>realm. It's not mandatory, if it's
              not specified, it will be retrieved from the server. Otherwise, you can find it in the
              Keycloak admin console -&gt; Realm settings ( for <span class="italic">demo</span>
              realm ) -&gt; Keys</p></li><li class="listitem"><p><span class="underline">Authentication server URL</span> - The URL for the
              Keycloak's authentication server</p></li><li class="listitem"><p><span class="underline">Resource</span> - The name for the client created
              on step 2. In our example, use the value <span class="italic">kie</span>.</p></li><li class="listitem"><p><span class="underline">Enable basic auth </span>- For this example let's
              enable Basic authentication mechanism as well, so clients can use both Token (Baerer)
              and Basic approaches to perform the requests.</p></li><li class="listitem"><p><span class="underline">Credential</span> - Use the password value for the
                <span class="italic">kie </span>client. You can find it in the Keycloak admin
              console -&gt; Clients -&gt; kie -&gt; Credentials tab -&gt; Copy the value for the <span class="italic">secret</span>.</p></li></ul></div><p>For this example you have to take care about using your concrete values for <span class="italic">secure-deployment name</span>, <span class="italic">realm-public-key
        </span>and <span class="italic">credential </span>password. You can find detailed
        information about the KC adapter configurations <a class="link" href="https://keycloak.github.io/docs/userguide/keycloak-server/html/ch08.html#adapter-config">here</a>.</p></div><div class="section" title="20.2.4.3. Run the environment"><div class="titlepage"><div><div><h4 class="title"><a id="d0e23491"/>20.2.4.3. Run the environment</h4></div></div></div><p>At this point a Keycloak server is up and running on the host, and the KC adapter is
        installed and configured for the jBPM application server. You can run the application
        using:</p><p>
        </p><pre><code class="no-highlight">$JBPM_HOME/bin/standalone.sh -c standalone-full.xml</code></pre><p>
      </p><p>You can navigate into the application once the server is up at:</p><p>
        </p><pre><code class="no-highlight"> <a class="link" href="http://localhost:8080/kie-wb-6.4.0.Final">http://localhost:8080/kie-wb-6.4.0.Final</a></code></pre><p>
      </p><div class="figure"><a id="d0e23510"/><p class="title"><strong>Figure 20.4. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/KeycloakSSOIntegration/jbpm_login_screen.png"/></div></div></div><br class="figure-break"/><p>Use your Keycloak's admin user credentials to login: <span class="italic">admin/password</span>.</p></div></div><div class="section" title="20.2.5. Securing workbench remote services via Keycloak"><div class="titlepage"><div><div><h3 class="title"><a id="d0e23519"/>20.2.5. Securing workbench remote services via Keycloak</h3></div></div></div><p>Both jBPM and Drools workbenches provides different remote service endpoints that can be
      consumed by third party clients using the <a class="link" href="http://docs.jboss.org/jbpm/v6.3/userguide/ch17.html">remote API</a>.</p><p>In order to authenticate those services thorough Keycloak the <span class="italic">BasicAuthSecurityFilter</span> must be disabled, apply those modifications for the the
        <span class="italic">WEB-INF/web.xml</span> file (app deployment descriptor) from
      jBPM's WAR file:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Remove the following filter from the deployment descriptor:</p><p>
            </p><pre><code class="no-highlight">&lt;filter&gt;  
  &lt;filter-name&gt;HTTP Basic Auth Filter&lt;/filter-name&gt;
  &lt;filter-class&gt;org.uberfire.ext.security.server.BasicAuthSecurityFilter&lt;/filter-class&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;realmName&lt;/param-name&gt;
    &lt;param-value&gt;KIE Workbench Realm&lt;/param-value&gt;
  &lt;/init-param&gt;
&lt;/filter&gt;

&lt;filter-mapping&gt;
  &lt;filter-name&gt;HTTP Basic Auth Filter&lt;/filter-name&gt;
  &lt;url-pattern&gt;/rest/*&lt;/url-pattern&gt;
  &lt;url-pattern&gt;/maven2/*&lt;/url-pattern&gt;
  &lt;url-pattern&gt;/ws/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;</code></pre><p>
          </p></li><li class="listitem"><p>Constraint the remote services URL patterns as:</p><p>
            </p><pre><code class="no-highlight">&lt;security-constraint&gt;
  &lt;web-resource-collection&gt;
    &lt;web-resource-name&gt;remote-services&lt;/web-resource-name&gt;
    &lt;url-pattern&gt;/rest/*&lt;/url-pattern&gt;
    &lt;url-pattern&gt;/maven2/*&lt;/url-pattern&gt;
    &lt;url-pattern&gt;/ws/*&lt;/url-pattern&gt;
  &lt;/web-resource-collection&gt;
  &lt;auth-constraint&gt;
    &lt;role-name&gt;rest-all&lt;/role-name&gt;
  &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;</code></pre><p>
          </p></li></ul></div><p><span class="underline">Important note</span>: The user that consumes the remote
      services must be member of role <span class="italic">rest-all</span>. As on described
      previous steps, the <span class="italic">admin</span> user in this example it's already
      a member of the <span class="italic">rest-all </span>role.</p></div><div class="section" title="20.2.6. Securing workbench's file system services via Keycloak"><div class="titlepage"><div><div><h3 class="title"><a id="d0e23565"/>20.2.6. Securing workbench's file system services via Keycloak</h3></div></div></div><p>In order to consume other remote services such as the file system ones (e.g. remote GIT), a specific <span class="bold"><strong>Keycloak login module must be used</strong></span>
      for the application's security domain in the <span class="italic">$JBPM_HOME/standalone/configuration/standalone-full.xml</span>
      file. By default the workbench uses the <span class="italic">other</span> security domain, so
      the resulting  configuration on the <span class="italic">$JBPM_HOME/standalone/configuration/standalone-full.xml</span> should be such as:</p><pre><code class="no-highlight">
      &lt;security-domain name="other" cache-type="default"&gt;
        &lt;authentication&gt;
          &lt;login-module code="org.keycloak.adapters.jaas.DirectAccessGrantsLoginModule" flag="required"&gt;
            &lt;!-- Parameter value can be a file system absolute path or a classpath (e.g. "classpath:/some-path/kie-git.json")--&gt;
            &lt;module-option name="keycloak-config-file" value="$JBPM_HOME/kie-git.json"/&gt;
          &lt;/login-module&gt;
        &lt;/authentication&gt;
      &lt;/security-domain&gt;
    </code></pre><p>Note that:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The login modules on the <span class="italic">other</span> security domain in the
          <span class="italic">$JBPM_HOME/standalone/configuration/standalone-full.xml</span> file must be REPLACED by the above given one.</p></li><li class="listitem"><p>Replace <span class="italic">$JBPM_HOME/kie-git.json</span> by the path (on file system) or the classpath (e.g.
           <span class="italic">classpath:/some-path/kie-git.json</span>) for the json configuration file used for the
        remote services client. Please continue reading in order to create this Keycloak client and how to obtain this json file.</p></li></ul></div><p>At this point, remote services that use JAAS for the authentication process, such as the file system ones ( e.g. GIT ), are
      secured by Keycloak using the client specified in the above json configuration file. So let's create this client on Keycloak and
      generate the required JSON file:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Navigate to the <a class="link" href="http://localhost:8180/auth/admin">KC administration console</a> and create a new
          client for the <span class="italic">demo</span> realm using <span class="italic">kie-git</span> as name.</p></li><li class="listitem"><p>Enable
          <span class="italic">Direct Access Grants Enabled</span> option, disable
          <span class="italic">Standard Flow Enabled</span> and use a
          <span class="italic">confidential</span> access type for this client. See below image as example:</p><div class="figure"><a id="d0e23632"/><p class="title"><strong>Figure 20.5. </strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Workbench/KeycloakSSOIntegration/kie_git_client_settings.png"/></div></div></div><br class="figure-break"/></li><li class="listitem"><p>Go to the <span class="italic">Installation</span> tab in same <span class="italic">kie-git</span> client
        configuration screen and export using the <span class="italic">Keycloak OIDC JSON</span> type.</p></li><li class="listitem"><p>Finally copy this generated JSON file into an accessible directory on the server's file system or add it in the application's
        classpath. Use this path value as the <span class="italic">keycloak-config-file</span> argument for the
          above configuration of the <span class="italic">org.keycloak.adapters.jaas.DirectAccessGrantsLoginModule</span> login
          module.
        </p></li><li class="listitem"><p>More information about Keycloak JAAS Login modules can be found <a class="link" href="https://keycloak.gitbooks.io/securing-client-applications-guide/content/v/2.2/topics/oidc/java/jaas.html">here</a>.</p></li></ul></div><p>At this point, the internal Git repositories can be cloned by all users authenticated via the Keycloak server.
      Command example: </p><pre><code class="no-highlight">git clone ssh://admin@localhost:8001/system</code></pre><p>
    </p></div><div class="section" title="20.2.7. Execution server"><div class="titlepage"><div><div><h3 class="title"><a id="d0e23668"/>20.2.7. Execution server</h3></div></div></div><p>The KIE Execution Server provides a <a class="link" href="https://docs.jboss.org/drools/release/latest/drools-docs/html/ch22.html">REST
        API</a> than can be consumed for any third party clients,. This this section is about how
      to integration the KIE Execution Server with the Keycloak SSO in order to delegate the third
      party clients identity management to the SSO server.</p><p>Consider the above environment running, so consider having:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A Keycloak server running and listening on http://localhost:8180/auth</p></li><li class="listitem"><p>A realm named <span class="italic">demo</span> with a client named <span class="italic">kie</span> for the jBPM Workbench</p></li><li class="listitem"><p>A  jBPM Workbench running at http://localhost:8080/kie-wb-6.4.0-Final</p></li></ul></div><p>Follow these steps in order to add an execution server into this environment:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Create the client for the execution server on Keycloak</p></li><li class="listitem"><p>Install setup and the Execution server ( with the KC client adapter )</p></li></ul></div><div class="section" title="20.2.7.1. Create the execution server's client on Keycloak"><div class="titlepage"><div><div><h4 class="title"><a id="d0e23703"/>20.2.7.1. Create the execution server's client on Keycloak</h4></div></div></div><p>As per each execution server is going to be deployed, you have to create a new client on
        the <span class="italic">demo</span> realm in Keycloak.:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Go to the <a class="link" href="https://mojo.redhat.com/external-link.jspa?url=http%3A%2F%2Flocalhost%3A8180%2Fauth%2Fadmin">KC admin console</a> -&gt; Clients -&gt; New client</p></li><li class="listitem"><p>Name: <span class="italic">kie-execution-server</span></p></li><li class="listitem"><p>Root URL: <span class="emphasis"><em>http://localhost:8280/</em></span></p></li><li class="listitem"><p>Client protocol: <span class="emphasis"><em>openid-connect</em></span></p></li><li class="listitem"><p>Access type: <span class="emphasis"><em>confidential</em></span> ( or <span class="emphasis"><em>public</em></span> if
              you want so, but not recommended for production environments)</p></li><li class="listitem"><p>Valid redirect URIs: <span class="emphasis"><em>/kie-server-6.4.0.Final/*</em></span></p></li><li class="listitem"><p>Base URL: <span class="emphasis"><em>/kie-server-6.4.0.Final</em></span></p></li></ul></div><p>In this example the <span class="italic">admin</span> user already created on
        previous steps is the one used for the client requests. So ensure that the <span class="italic">admin</span> user is member of the role <span class="italic">kie-server</span> in order to use the execution server's remote services. If the role
        does not exist, create it.</p><p>Note: This example considers that the execution server will be configured to run using a
        port offset of 200, so the HTTP port will be available at localhost:8280.</p></div><div class="section" title="20.2.7.2. Install and setup the KC adapter on the execution server"><div class="titlepage"><div><div><h4 class="title"><a id="d0e23765"/>20.2.7.2. Install and setup the KC adapter on the execution server</h4></div></div></div><p>At this point, a client named <span class="italic">kie-execution-server</span> is
        ready on the KC server to use from the execution server. </p><p>Let's install, setup and deploy the execution server:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Install another Wildfly server to use for the execution server and the KC client
              adapter as well. You can follow above instructions for the Workbench or follow the
                <a class="link" href="https://keycloak.github.io/docs/userguide/keycloak-server/html/ch08.html">official adapters documentation</a></p></li><li class="listitem"><p>Edit the <span class="italic">standalone-full.xml</span> file from the
              Wildfly server's configuration path and configure the KC subsystem adapter as:</p><p>
              </p><pre><code class="no-highlight">&lt;secure-deployment name="kie-server-6.4.0.Final.war"&gt;
    &lt;realm&gt;demo&lt;/realm&gt;
    &lt;realm-public-key&gt;MIGfMA0GCSqGSIb...&lt;/realm-public-key&gt;
    &lt;auth-server-url&gt;http://localhost:8180/auth&lt;/auth-server-url&gt;
    &lt;ssl-required&gt;external&lt;/ssl-required&gt;
    &lt;resource&gt;kie-execution-server&lt;/resource&gt;
    &lt;enable-basic-auth&gt;true&lt;/enable-basic-auth&gt;
    &lt;credential name="secret"&gt;e92ec68d-6177-4239-be05-28ef2f3460ff&lt;/credential&gt;
    &lt;principal-attribute&gt;preferred_username&lt;/principal-attribute&gt;
&lt;/secure-deployment&gt;</code></pre><p>
            </p></li></ul></div><p>Consider your concrete environment settings if different from this example:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Secure deployment name -&gt; use the name of the execution server war file being
              deployed</p></li><li class="listitem"><p>Public key -&gt; Use the demo realm public key or leave it blank, the server will
              provide one if so</p></li><li class="listitem"><p>Resource -&gt; This time, instead of the kie client used in the WB configuration, use
              the <span class="italic">kie-execution-server</span> client</p></li><li class="listitem"><p>Enable basic auth -&gt; Up to you. You can enable Basic auth for third party service
              consumers</p></li><li class="listitem"><p>Credential -&gt; Use the secret key for the <span class="italic">kie-execution-server</span> client. You can find it in the <span class="italic">Credentials</span>tab of the KC admin console</p></li></ul></div></div><div class="section" title="20.2.7.3. Deploy and run the execution server"><div class="titlepage"><div><div><h4 class="title"><a id="d0e23819"/>20.2.7.3. Deploy and run the execution server</h4></div></div></div><p>Just deploy the execution server in Wildfly using any of the available mechanisms. Run
        the execution server using this command:</p><p>
        </p><pre><code class="no-highlight">$EXEC_SERVER_HOME/bin/standalone.sh -c standalone-full.xml -Djboss.socket.binding.port-offset=200 -Dorg.kie.server.id=&lt;ID&gt; -Dorg.kie.server.user=&lt;USER&gt; -Dorg.kie.server.pwd=&lt;PWD&gt; -Dorg.kie.server.location=&lt;LOCATION_URL&gt;  -Dorg.kie.server.controller=&lt;CONTROLLER_URL&gt; -Dorg.kie.server.controller.user=&lt;CONTROLLER_USER&gt; -Dorg.kie.server.controller.pwd=&lt;CONTOLLER_PASSWORD&gt;</code></pre><p>
      </p><p>Example:</p><p>
        </p><pre><code class="no-highlight">$EXEC_SERVER_HOME/bin/standalone.sh -c standalone-full.xml -Djboss.socket.binding.port-offset=200 -Dorg.kie.server.id=kieserver1 -Dorg.kie.server.user=admin -Dorg.kie.server.pwd=password -Dorg.kie.server.location=http://localhost:8280/kie-server-6.4.0.Final/services/rest/server -Dorg.kie.server.controller=http://localhost:8080/kie-wb-6.4.0.Final/rest/controller -Dorg.kie.server.controller.user=admin -Dorg.kie.server.controller.pwd=password</code></pre><p>
      </p><p><span class="underline">mportant note</span>: The users that will consume the
        execution server remote service endpoints must have the role kie-server assigned. So create
        and assign this role in the KC admin console for the users that will consume the execution
        server remote services.</p><p>Once up, you can check the server status as (considered using Basic authentication for
        this request, see next<span class="italic">Consuming remote services</span> for more
        information):</p><p>
        </p><pre><code class="no-highlight">curl http://admin:password@localhost:8280/kie-server-6.4.0.Final/services/rest/server/</code></pre><p>
      </p></div></div><div class="section" title="20.2.8. Consuming remote services"><div class="titlepage"><div><div><h3 class="title"><a id="d0e23850"/>20.2.8. Consuming remote services</h3></div></div></div><p>In order to use the different remote services provided by the Workbench or by an Execution
      Server, your client must be authenticated on the KC server and have a valid token to perform
      the requests.</p><p>Remember that in order to use the remote services, the authenticated user must have assigned:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The role <span class="italic">rest-all</span> for using the WB remote
            services</p></li><li class="listitem"><p>The role <span class="italic">kie-server</span> for using the Execution
            Server remote services</p></li></ul></div><p>Please ensure necessary roles are created and assigned to the users that will consume the
      remote services on the Keycloak admin console.</p><p>You have two options to consume the different remove service endpoints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Using basic authentication, if the application's client supports it</p></li><li class="listitem"><p>Using Bearer ( token) based authentication</p></li></ul></div><div class="section" title="20.2.8.1. Using basic authentication"><div class="titlepage"><div><div><h4 class="title"><a id="d0e23881"/>20.2.8.1. Using basic authentication</h4></div></div></div><p>If the KC client adapter configuration has the Basic authentication enabled, as proposed
        in this guide for both WB (<span class="italic">step 3.2</span>) and Execution
        Server, you can avoid the token grant/refresh calls and just call the services as the
        following examples.</p><p>Example for a WB remote repositories endpoint:</p><p>
        </p><pre><code class="no-highlight">curl http://admin:password@localhost:8080/kie-wb-6.4.0.Final/rest/repositories</code></pre><p>
      </p><p>Example to check the status for the Execution Server:</p><p>
        </p><pre><code class="no-highlight">curl http://admin:password@localhost:8280/kie-server-6.4.0.Final/services/rest/server/</code></pre><p>
      </p></div><div class="section" title="20.2.8.2. Using token based authentication"><div class="titlepage"><div><div><h4 class="title"><a id="d0e23903"/>20.2.8.2. Using token based authentication</h4></div></div></div><p>First step is to create a new client on Keycloak that allows the third party remote
        service clients to obtain a token. It can be done as:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Go to the KC admin console and create a <span class="underline">new
                client</span> using this configuration:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Client id: <span class="italic">kie-remote</span></p></li><li class="listitem"><p>Client protocol: <span class="italic">openid-connect</span></p></li><li class="listitem"><p>Access type: <span class="italic">public</span></p></li><li class="listitem"><p>Valid redirect URIs: <span class="italic">http://localhost/</span></p></li></ul></div></li><li class="listitem"><p>As we are going to manually obtain a token and invoke the service let's increase
              the lifespan of tokens slightly. In production access tokens should have a relatively
              low timeout, ideally less than 5 minutes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Go to the KC admin console</p></li><li class="listitem"><p>Click on your Realm Settings</p></li><li class="listitem"><p>Click on Tokens tab</p></li><li class="listitem"><p>Change the value for Access Token Lifespan to 15 minutes ( That should give
                    us plenty of time to obtain a token and invoke the service before it expires
                    )</p></li></ul></div></li></ul></div><p>Once a public client for our remote clients has been created, you can now obtain the
        token by performing an HTTP request to the KC server's tokens endpoint. Here is an example
        for command line:</p><p>
        </p><pre><code class="no-highlight">RESULT=`curl --data "grant_type=password&amp;client_id=kie-remote&amp;username=admin&amp;passwordpassword=&lt;the_client_secret&gt;" http://localhost:8180/auth/realms/demo/protocol/openid-connect/token`</code></pre><p>
        </p><pre><code class="no-highlight">TOKEN=`echo $RESULT | sed 's/.*access_token":"//g' | sed 's/".*//g'`</code></pre><p>
      </p><p>At this point, if you echo the <span class="italic">$TOKEN</span> it will output
        the token string obtained from the KC server, that can be now used to authorize further
        calls to the remote endpoints. For exmple, if you want to check the internal jBPM
        repositories:</p><p>
        </p><pre><code class="no-highlight">curl -H "Authorization: bearer $TOKEN" http://localhost:8080/kie-wb-6.4.0.Final/rest/repositories</code></pre><p>
      </p></div></div></div></div><div class="chapter" title="Chapter 21. Workbench High Availability"><div class="titlepage"><div><div><h2 class="title"><a id="wb.WorkbenchHighAvailability"/>Chapter 21. Workbench High Availability</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#wb.HighAvailability">21.1. </a></span></dt><dd><dl><dt><span class="section"><a href="#wb.vfsClustering">21.1.1. VFS clustering</a></span></dt><dt><span class="section"><a href="#d0e24193">21.1.2. jBPM clustering</a></span></dt></dl></dd></dl></div><div class="section" title="21.1. "><div class="titlepage"/><div class="section" title="21.1.1. VFS clustering"><div class="titlepage"><div><div><h3 class="title"><a id="wb.vfsClustering"/>21.1.1. VFS clustering</h3></div></div></div><p>The <a class="link" href="#wb.VFSRepository" title="18.3.3. Repositories">VFS repositories</a> (usually git repositories) stores all the assets
    (such as rules, decision tables, process definitions, forms, etc). If that VFS resides on each local server, then it
    must be kept in sync between all servers of a cluster.</p><p>Use <a class="link" href="http://zookeeper.apache.org/">Apache Zookeeper</a> and <a class="link" href="http://helix.incubator.apache.org/">Apache Helix</a> to accomplish this. Zookeeper glues all the
    parts together. Helix is the cluster management component that registers all cluster details (nodes, resources and
    the cluster itself). Uberfire (on top of which Workbench is build) uses those 2 components to provide VFS
    clustering.</p><p>To create a VFS cluster:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Download <a class="link" href="http://zookeeper.apache.org/">Apache Zookeeper</a> and <a class="link" href="http://helix.incubator.apache.org/">Apache Helix</a>.</p></li><li class="listitem"><p>Install both:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Unzip Zookeeper into a directory (<code class="literal">$ZOOKEEPER_HOME</code>).</p></li><li class="listitem"><p>In <code class="literal">$ZOOKEEPER_HOME</code>, copy <code class="literal">zoo_sample.conf</code> to
            <code class="literal">zoo.conf</code></p></li><li class="listitem"><p>Edit <code class="literal">zoo.conf</code>. Adjust the settings if needed. Usually only these 2 properties are
            relevant:</p><pre><code class="no-highlight"># the directory where the snapshot is stored.
dataDir=/tmp/zookeeper
# the port at which the clients will connect
clientPort=2181</code></pre></li><li class="listitem"><p>Unzip Helix into a directory (<code class="literal">$HELIX_HOME</code>).</p></li></ol></div></li><li class="listitem"><p>Configure the cluster in Zookeeper:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Go to its <code class="literal">bin</code> directory:</p><pre><code class="no-highlight">$ cd $ZOOKEEPER_HOME/bin</code></pre></li><li class="listitem"><p>Start the Zookeeper server:</p><pre><code class="no-highlight">$ sudo ./zkServer.sh start</code></pre><p>If the server fails to start, verify that the <code class="literal">dataDir</code> (as specified in
            <code class="literal">zoo.conf</code>) is accessible.</p></li><li class="listitem"><p>To review Zookeeper's activities, open <code class="literal">zookeeper.out</code>:</p><pre><code class="no-highlight">$ cat $ZOOKEEPER_HOME/bin/zookeeper.out</code></pre></li></ol></div></li><li class="listitem"><p>Configure the cluster in Helix: </p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Go to its <code class="literal">bin</code> directory:</p><pre><code class="no-highlight">$ cd $HELIX_HOME/bin</code></pre></li><li class="listitem"><p>Create the cluster:</p><pre><code class="no-highlight">$ ./helix-admin.sh --zkSvr localhost:2181 --addCluster kie-cluster</code></pre><p>The <code class="literal">zkSvr</code> value must match the used Zookeeper server. The cluster name
            (<code class="literal">kie-cluster</code>) can be changed as needed.</p></li><li class="listitem"><p>Add nodes to the cluster:</p><pre><code class="no-highlight"># Node 1
$ ./helix-admin.sh --zkSvr localhost:2181 --addNode kie-cluster nodeOne:12345
# Node 2
$ ./helix-admin.sh --zkSvr localhost:2181 --addNode kie-cluster nodeTwo:12346
...</code></pre><p>Usually the number of nodes a in cluster equal the number of application servers in the cluster. The
            node names (<code class="literal">nodeOne:12345</code> , ...) can be changed as needed.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p><code class="literal">nodeOne:12345</code> is the unique identifier of the node, which will be referenced
              later on when configuring application servers. It is not a host and port number, but instead it is used to
              uniquely identify the logical node.</p></div></li><li class="listitem"><p>Add resources to the cluster:</p><pre><code class="no-highlight">$ ./helix-admin.sh --zkSvr localhost:2181 --addResource kie-cluster vfs-repo 1 LeaderStandby AUTO_REBALANCE</code></pre><p>The resource name (<code class="literal">vfs-repo</code>) can be changed as needed.</p></li><li class="listitem"><p>Rebalance the cluster to initialize it:</p><pre><code class="no-highlight">$ ./helix-admin.sh --zkSvr localhost:2181 --rebalance kie-cluster vfs-repo 2</code></pre></li><li class="listitem"><p>Start the Helix controller to manage the cluster:</p><pre><code class="no-highlight">$  ./run-helix-controller.sh --zkSvr localhost:2181 --cluster kie-cluster 2&gt;&amp;1 &gt; /tmp/controller.log &amp;</code></pre></li></ol></div></li><li class="listitem"><p>Configure the security domain correctly on the application server. For example on WildFly and JBoss
        EAP:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Edit the file <code class="literal">$JBOSS_HOME/domain/configuration/domain.xml</code>.</p><p>For simplicity sake, presume we use the default domain configuration which uses the profile
            <code class="literal">full</code> that defines two server nodes as part of
            <code class="literal">main-server-group</code>.</p></li><li class="listitem"><p>Locate the profile <code class="literal">full</code> and add a new security domain by copying the other security
            domain already defined there by default:</p><pre><code class="no-highlight">&lt;security-domain name="kie-ide" cache-type="default"&gt;
    &lt;authentication&gt;
         &lt;login-module code="Remoting" flag="optional"&gt;
             &lt;module-option name="password-stacking" value="useFirstPass"/&gt;
         &lt;/login-module&gt;
         &lt;login-module code="RealmDirect" flag="required"&gt;
             &lt;module-option name="password-stacking" value="useFirstPass"/&gt;
         &lt;/login-module&gt;
    &lt;/authentication&gt;
&lt;/security-domain&gt;</code></pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>The security-domain name is a magic value.</p></div></li></ol></div></li><li class="listitem"><p>Configure the <a class="link" href="#wb.systemProperties" title="18.1.3. System properties">system properties</a> for the cluster on the
        application server. For example on WildFly and JBoss EAP:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Edit the file <code class="literal">$JBOSS_HOME/domain/configuration/host.xml</code>.</p></li><li class="listitem"><p>Locate the XML elements <code class="literal">server</code> that belong to the
            <code class="literal">main-server-group</code> and add the necessary system property.</p><p>For example for nodeOne:</p><pre><code class="language-xml">&lt;system-properties&gt;
  &lt;property name="jboss.node.name" value="nodeOne" boot-time="false"/&gt;
  &lt;property name="org.uberfire.nio.git.dir" value="/tmp/kie/nodeone" boot-time="false"/&gt;
  &lt;property name="org.uberfire.metadata.index.dir" value="/tmp/kie/nodeone" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.id" value="kie-cluster" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.zk" value="localhost:2181" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.local.id" value="nodeOne_12345" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.vfs.lock" value="vfs-repo" boot-time="false"/&gt;
  &lt;!-- If you're running both nodes on the same machine: --&gt;
  &lt;property name="org.uberfire.nio.git.daemon.port" value="9418" boot-time="false"/&gt;
&lt;/system-properties&gt;</code></pre><p>And for nodeTwo:</p><pre><code class="language-xml">&lt;system-properties&gt;
  &lt;property name="jboss.node.name" value="nodeTwo" boot-time="false"/&gt;
  &lt;property name="org.uberfire.nio.git.dir" value="/tmp/kie/nodetwo" boot-time="false"/&gt;
  &lt;property name="org.uberfire.metadata.index.dir" value="/tmp/kie/nodetwo" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.id" value="kie-cluster" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.zk" value="localhost:2181" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.local.id" value="nodeTwo_12346" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.vfs.lock" value="vfs-repo" boot-time="false"/&gt;
  &lt;!-- If you're running both nodes on the same machine: --&gt;
  &lt;property name="org.uberfire.nio.git.daemon.port" value="9419" boot-time="false"/&gt;
&lt;/system-properties&gt;</code></pre><p>Make sure the cluster, node and resource names match those configured in Helix.</p></li></ol></div></li></ol></div></div><div class="section" title="21.1.2. jBPM clustering"><div class="titlepage"><div><div><h3 class="title"><a id="d0e24193"/>21.1.2. jBPM clustering</h3></div></div></div><p>In addition to the information above, jBPM clustering requires additional configuration. See <a class="link" href="http://mswiderski.blogspot.com.br/2013/06/clustering-in-jbpm-v6.html">this blog post</a> to configure
    the database etc correctly.</p></div></div></div></div><div class="part" title="Part VI. KIE Server"><div class="titlepage"><div><div><h1 class="title"><a id="d0e24201"/>Part VI. KIE Server</h1></div></div></div><div class="partintro" title="KIE Server"><div/><p>The KIE Server is a standalone execution server for rules.</p><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="chapter"><a href="#ch.kie.server">22. KIE Execution Server</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e24210">22.1. Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e24254">22.1.1. Glossary</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e24323">22.2. Installing the KIE Server</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e24374">22.2.1. Bootstrap switches</a></span></dt><dt><span class="section"><a href="#d0e24677">22.2.2. Installation details for different containers</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e24798">22.3. Kie Server setup</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e24807">22.3.1. Managed Kie Server </a></span></dt><dt><span class="section"><a href="#d0e24889">22.3.2. Unmanaged KIE Execution Server</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e24914">22.4. Creating a Kie Container</a></span></dt><dt><span class="section"><a href="#d0e24991">22.5. Managing Containers</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e24996">22.5.1. Starting a Container</a></span></dt><dt><span class="section"><a href="#d0e25005">22.5.2. Stopping and Deleting a Container</a></span></dt><dt><span class="section"><a href="#d0e25010">22.5.3. Updating a Container</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e25070">22.6. Kie Server REST API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e25090">22.6.1. [GET] /</a></span></dt><dt><span class="section"><a href="#d0e25100">22.6.2. [POST] /</a></span></dt><dt><span class="section"><a href="#d0e25140">22.6.3. [GET] /containers</a></span></dt><dt><span class="section"><a href="#d0e25171">22.6.4. ⁠[GET] /containers/{id}</a></span></dt><dt><span class="section"><a href="#d0e25184">22.6.5. [PUT] /containers/{id}</a></span></dt><dt><span class="section"><a href="#d0e25207">22.6.6. [DELETE] /containers/{id}</a></span></dt><dt><span class="section"><a href="#d0e25220">22.6.7. [POST] /containers/instances/{id}</a></span></dt><dt><span class="section"><a href="#d0e25288">22.6.8. [GET] /containers/{id}/release-id</a></span></dt><dt><span class="section"><a href="#d0e25298">22.6.9. [POST] /containers/{id}/release-id</a></span></dt><dt><span class="section"><a href="#d0e25315">22.6.10. [GET] /containers/{id}/scanner</a></span></dt><dt><span class="section"><a href="#d0e25325">22.6.11. [POST] /containers/{id}/scanner</a></span></dt><dt><span class="section"><a href="#d0e25350">22.6.12. Native REST client for Execution Server</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e25373">22.7. OptaPlanner REST API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e25410">22.7.1. [GET] /containers/{containerId}/solvers</a></span></dt><dt><span class="section"><a href="#d0e25425">22.7.2. [PUT] /containers/{containerId}/solvers/{solverId}</a></span></dt><dt><span class="section"><a href="#d0e25458">22.7.3. [GET] /containers/{containerId}/solvers/{solverId}</a></span></dt><dt><span class="section"><a href="#d0e25479">22.7.4. [POST] /containers/{containerId}/solvers/{solverId}</a></span></dt><dt><span class="section"><a href="#d0e25530">22.7.5. [GET] /containers/{containerId}/solvers/{solverId}/bestsolution</a></span></dt><dt><span class="section"><a href="#d0e25548">22.7.6. [DELETE] /containers/{containerId}/solvers/{solverId}</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e25569">22.8. Controller REST API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e25587">22.8.1. [GET] /management/servers</a></span></dt><dt><span class="section"><a href="#d0e25597">22.8.2. [GET] /management/server/{id}</a></span></dt><dt><span class="section"><a href="#d0e25607">22.8.3. [PUT] /management/server/{id}</a></span></dt><dt><span class="section"><a href="#d0e25617">22.8.4. [DELETE] /management/server/{id}</a></span></dt><dt><span class="section"><a href="#d0e25622">22.8.5. [GET] /management/server/{id}/containers</a></span></dt><dt><span class="section"><a href="#d0e25632">22.8.6. [GET] /management/server/{id}/containers/{containerId}</a></span></dt><dt><span class="section"><a href="#d0e25642">22.8.7. [PUT] /management/server/{id}/containers/{containerId}</a></span></dt><dt><span class="section"><a href="#d0e25652">22.8.8. [DELETE] /management/server/{id}/containers/{containerId}</a></span></dt><dt><span class="section"><a href="#d0e25657">22.8.9. [POST] /management/server/{id}/containers/{containerId}/status/started</a></span></dt><dt><span class="section"><a href="#d0e25662">22.8.10. [POST] /management/server/{id}/containers/{containerId}/status/stopped</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e25667">22.9. Kie Server Java Client API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e25672">22.9.1. Maven Configuration</a></span></dt><dt><span class="section"><a href="#d0e25690">22.9.2. Client Configuration</a></span></dt><dt><span class="section"><a href="#d0e25753">22.9.3. Server Response</a></span></dt><dt><span class="section"><a href="#d0e25777">22.9.4. Server Capabilities</a></span></dt><dt><span class="section"><a href="#d0e25798">22.9.5. Kie Containers</a></span></dt><dt><span class="section"><a href="#d0e25826">22.9.6. Managing Containers</a></span></dt><dt><span class="section"><a href="#d0e25837">22.9.7. Available Clients for the Decision Server</a></span></dt><dt><span class="section"><a href="#d0e25870">22.9.8. Sending commands to the server</a></span></dt><dt><span class="section"><a href="#d0e25897">22.9.9. Listing available business processes</a></span></dt></dl></dd></dl></dd></dl></div></div><div class="chapter" title="Chapter 22. KIE Execution Server"><div class="titlepage"><div><div><h2 class="title"><a id="ch.kie.server"/>Chapter 22. KIE Execution Server</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e24210">22.1. Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e24254">22.1.1. Glossary</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e24323">22.2. Installing the KIE Server</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e24374">22.2.1. Bootstrap switches</a></span></dt><dt><span class="section"><a href="#d0e24677">22.2.2. Installation details for different containers</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e24798">22.3. Kie Server setup</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e24807">22.3.1. Managed Kie Server </a></span></dt><dt><span class="section"><a href="#d0e24889">22.3.2. Unmanaged KIE Execution Server</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e24914">22.4. Creating a Kie Container</a></span></dt><dt><span class="section"><a href="#d0e24991">22.5. Managing Containers</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e24996">22.5.1. Starting a Container</a></span></dt><dt><span class="section"><a href="#d0e25005">22.5.2. Stopping and Deleting a Container</a></span></dt><dt><span class="section"><a href="#d0e25010">22.5.3. Updating a Container</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e25070">22.6. Kie Server REST API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e25090">22.6.1. [GET] /</a></span></dt><dt><span class="section"><a href="#d0e25100">22.6.2. [POST] /</a></span></dt><dt><span class="section"><a href="#d0e25140">22.6.3. [GET] /containers</a></span></dt><dt><span class="section"><a href="#d0e25171">22.6.4. ⁠[GET] /containers/{id}</a></span></dt><dt><span class="section"><a href="#d0e25184">22.6.5. [PUT] /containers/{id}</a></span></dt><dt><span class="section"><a href="#d0e25207">22.6.6. [DELETE] /containers/{id}</a></span></dt><dt><span class="section"><a href="#d0e25220">22.6.7. [POST] /containers/instances/{id}</a></span></dt><dt><span class="section"><a href="#d0e25288">22.6.8. [GET] /containers/{id}/release-id</a></span></dt><dt><span class="section"><a href="#d0e25298">22.6.9. [POST] /containers/{id}/release-id</a></span></dt><dt><span class="section"><a href="#d0e25315">22.6.10. [GET] /containers/{id}/scanner</a></span></dt><dt><span class="section"><a href="#d0e25325">22.6.11. [POST] /containers/{id}/scanner</a></span></dt><dt><span class="section"><a href="#d0e25350">22.6.12. Native REST client for Execution Server</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e25373">22.7. OptaPlanner REST API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e25410">22.7.1. [GET] /containers/{containerId}/solvers</a></span></dt><dt><span class="section"><a href="#d0e25425">22.7.2. [PUT] /containers/{containerId}/solvers/{solverId}</a></span></dt><dt><span class="section"><a href="#d0e25458">22.7.3. [GET] /containers/{containerId}/solvers/{solverId}</a></span></dt><dt><span class="section"><a href="#d0e25479">22.7.4. [POST] /containers/{containerId}/solvers/{solverId}</a></span></dt><dt><span class="section"><a href="#d0e25530">22.7.5. [GET] /containers/{containerId}/solvers/{solverId}/bestsolution</a></span></dt><dt><span class="section"><a href="#d0e25548">22.7.6. [DELETE] /containers/{containerId}/solvers/{solverId}</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e25569">22.8. Controller REST API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e25587">22.8.1. [GET] /management/servers</a></span></dt><dt><span class="section"><a href="#d0e25597">22.8.2. [GET] /management/server/{id}</a></span></dt><dt><span class="section"><a href="#d0e25607">22.8.3. [PUT] /management/server/{id}</a></span></dt><dt><span class="section"><a href="#d0e25617">22.8.4. [DELETE] /management/server/{id}</a></span></dt><dt><span class="section"><a href="#d0e25622">22.8.5. [GET] /management/server/{id}/containers</a></span></dt><dt><span class="section"><a href="#d0e25632">22.8.6. [GET] /management/server/{id}/containers/{containerId}</a></span></dt><dt><span class="section"><a href="#d0e25642">22.8.7. [PUT] /management/server/{id}/containers/{containerId}</a></span></dt><dt><span class="section"><a href="#d0e25652">22.8.8. [DELETE] /management/server/{id}/containers/{containerId}</a></span></dt><dt><span class="section"><a href="#d0e25657">22.8.9. [POST] /management/server/{id}/containers/{containerId}/status/started</a></span></dt><dt><span class="section"><a href="#d0e25662">22.8.10. [POST] /management/server/{id}/containers/{containerId}/status/stopped</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e25667">22.9. Kie Server Java Client API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e25672">22.9.1. Maven Configuration</a></span></dt><dt><span class="section"><a href="#d0e25690">22.9.2. Client Configuration</a></span></dt><dt><span class="section"><a href="#d0e25753">22.9.3. Server Response</a></span></dt><dt><span class="section"><a href="#d0e25777">22.9.4. Server Capabilities</a></span></dt><dt><span class="section"><a href="#d0e25798">22.9.5. Kie Containers</a></span></dt><dt><span class="section"><a href="#d0e25826">22.9.6. Managing Containers</a></span></dt><dt><span class="section"><a href="#d0e25837">22.9.7. Available Clients for the Decision Server</a></span></dt><dt><span class="section"><a href="#d0e25870">22.9.8. Sending commands to the server</a></span></dt><dt><span class="section"><a href="#d0e25897">22.9.9. Listing available business processes</a></span></dt></dl></dd></dl></div><div class="section" title="22.1. Overview"><div class="titlepage"><div><div><h2 class="title"><a id="d0e24210"/>22.1. Overview</h2></div></div></div><p>The <span class="emphasis"><em>Kie Server</em></span> is a modular, standalone server component that can be
              used to instantiate and execute rules and processes. It exposes this functionality via
              REST, JMS and Java interfaces to client application. It also provides seamless
              integration with the <span class="emphasis"><em>Kie Workbench</em></span>. </p><p>At its core, the <span class="emphasis"><em>Kie Server</em></span> is a configurable web application
              packaged as a WAR file. Distributions are availables for pure web containers (like
              Tomcat) and for JEE 6 and JEE 7 containers.</p><p>Most capabilities on the Kie Server are configurable, and based on the concepts of
              extensions. Each extension can be enabled/disabled independently, allowing the user to
              configure the server to its need. </p><p>The current version of the Kie Server ships with two default extensions: </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>BRM: provides support for the execution of Business Rules using
                                   the Drools rules engine.</p></li><li class="listitem"><p>BPM: provides support for the execution of Business Processes
                                   using the jBPM process engine. It supports:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>process execution</p></li><li class="listitem"><p>task execution</p></li><li class="listitem"><p>assynchronous job execution</p></li></ul></div></li></ul></div><p>Both extensions enabled by default, but can be disabled by setting the corresponding property
              (see configuration chapter for details).</p><p>This server was designed to have a low footprint, with minimal memory consumption, and
              therefore, to be easily deployable on a cloud environment. Each instance of this
              server can open and instantiate multiple <span class="emphasis"><em>Kie Containers</em></span> which
              allows you to execute multiple services in parallel.</p><div class="section" title="22.1.1. Glossary"><div class="titlepage"><div><div><h3 class="title"><a id="d0e24254"/>22.1.1. Glossary</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><a id="docs-internal-guid-81eb08e8-d2fc-a4e7-6584-b666315fc14d"/><strong>Kie Server</strong></span>: execution server purely focusing
                                   on providing runtime environment for both rules and processes.
                                   These capabilities are provided by <span class="emphasis"><em>Kie Server
                                          Extensions</em></span>. More capabilities can be added by
                                   further extensions (e.g. customer could add his own extensions in
                                   case of missing functionality that will then use infrastructure
                                   of the KIE Server). A Kie Server instance is a standalone Kie
                                   Server executing on a given application server/web container. A
                                   Kie Server instantiates and provides support for multiple Kie
                                   Containers.</p></li><li class="listitem"><p><span class="bold"><a id="docs-internal-guid-81eb08e8-d2fc-a4e7-6584-b666315fc14d"/><strong>Kie Server Extension</strong></span>: a "plugin" for the Kie Server that adds
                                   capabilities to the server. The Kie Server ships with two default
                                   kie server extensions: BRM and BPM.</p></li><li class="listitem"><p><span class="bold"><a id="docs-internal-guid-81eb08e8-d2fc-a4e7-6584-b666315fc14d"/><strong>Kie Container</strong></span>: an in-memory instantiation of a kjar, allowing for
                                   the instantiation and usage of its assets (domain models,
                                   processes, rules, etc). A Kie Server exposes Kie Containers
                                   through a standard API over transport protocols like REST and
                                   JMS.</p></li><li class="listitem"><p><span class="bold"><a id="docs-internal-guid-81eb08e8-d2fc-a4e7-6584-b666315fc14d"/><strong>Controller</strong></span>: a server-backed REST endpoint that
                                   will be responsible for managing KIE Server instances. Such end
                                   point must provide following capabilities: </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>respond to connect requests </p></li><li class="listitem"><p>sync all registered containers on the
                                                  corresponding <span class="emphasis"><em>Kie Server
                                                  ID</em></span></p></li><li class="listitem"><p>respond to disconnect requests</p></li></ul></div></li><li class="listitem"><p><span class="bold"><a id="docs-internal-guid-81eb08e8-d2fc-a4e7-6584-b666315fc14d"/><strong>Kie Server state</strong></span>: currently known state of
                                   given Kie Server instance. This is a local storage (by default in
                                   file) that maintains the following information: </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>list of registered controllers </p></li><li class="listitem"><p>list of known containers </p></li><li class="listitem"><p>kie server configuration </p></li></ul></div><p>The server state is persisted upon receival of
                                   events like: <span class="emphasis"><em>Kie Container</em></span> created,
                                          <span class="emphasis"><em>Kie Container</em></span> is disposed, controller
                                   accepts registration of <span class="emphasis"><em>Kie Server</em></span> instance,
                                   etc. </p></li><li class="listitem"><p><span class="bold"><a id="docs-internal-guid-81eb08e8-d2fc-a4e7-6584-b666315fc14d"/><strong>Kie Server ID</strong></span>: an arbitrary assigned
                                   identifier to which configurations are assigned. At boot, each
                                   Kie Server Instance is assigned an ID, and that ID is matched to
                                   a configuration on the controller. The Kie Server Instance
                                   fetches and uses that configuration to setup itself.</p></li></ul></div></div></div><div class="section" title="22.2. Installing the KIE Server"><div class="titlepage"><div><div><h2 class="title"><a id="d0e24323"/>22.2. Installing the KIE Server</h2></div></div></div><p>The KIE Server is distributed as a web application archive (WAR) file. The WAR file comes in
    three different packagings: </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="emphasis"><em>webc</em></span> - WAR for ordinary Web (Servlet) containers like
        Tomcat</li><li class="listitem"><span class="emphasis"><em>ee6</em></span> - WAR for JavaEE 6 containers like JBoss EAP 6.x</li><li class="listitem"><span class="emphasis"><em>ee7</em></span> - WAR for JavaEE 7 containers like WildFly 8.x</li></ul></div><p>
  </p><p>To install the KIE Execution Server and verify it is running, complete the following
    steps:</p><p>
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Deploy the WAR file into your web container.</p></li><li class="listitem"><p>Create a user with the role of <code class="code">kie-server</code> on the container.</p></li><li class="listitem"><p>Test that you can access the execution engine by navigating to the endpoint in a
          browser window: <code class="code">http://SERVER:PORT/CONTEXT/services/rest/server/</code>.</p></li><li class="listitem"><p>When prompted for username/password, type in the username and password that you
          created in step 2.</p></li><li class="listitem"><p>Once authenticated, you will see an XML response in the form of engine status, similar
          to this:</p><div class="example"><a id="d0e24368"/><p class="title"><strong>Example 22.1. Sample handshaking server response</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;response type="SUCCESS" msg="KIE Server info"&gt;
  &lt;kie-server-info&gt;
    &lt;version&gt;6.5.0.Final&lt;/version&gt;
  &lt;/kie-server-info&gt;
&lt;/response&gt;</code></pre></div></div><br class="example-break"/></li></ol></div><p>
  </p><div class="section" title="22.2.1. Bootstrap switches"><div class="titlepage"><div><div><h3 class="title"><a id="d0e24374"/>22.2.1. Bootstrap switches</h3></div></div></div><p>The Kie Server accepts a number of bootstrap switches (system properties) to configure the
      behaviour of the server. The following is a table of all the supported switches.</p><p>
      </p><div class="table"><a id="d0e24381"/><p class="title"><strong>Table 22.1. Kie Server bootstrap switches</strong></p><div class="table-contents"><table summary="Kie Server bootstrap switches" border="1"><colgroup><col width="2.0*" class="c1"/><col width="2.0*" class="c2"/><col width="4.0*" class="c3"/><col width="1.0*" class="c4"/></colgroup><thead><tr><th>Property</th><th>Value</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d278-cdbc-3277-34f586cd28ee"/><strong>org.drools.server.ext.disabled</strong></span></td><td>boolean (default is "false")</td><td>If true, disables the BRM support (i.e. rules support).</td><td>No</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d27a-35ba-25c1-375f7ecf35d9"/><strong>org.jbpm.server.ext.disabled</strong></span></td><td>boolean (default is "false")</td><td>If true, disables the BPM support (i.e. processes support)</td><td>No</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d276-b920-8222-1515def0d382"/><strong>org.kie.server.id</strong></span></td><td>string</td><td>An arbitrary ID to be assigned to this server. If a remote controller is
                configured, this is the ID under which the server will connect to the controller to
                fetch the kie container configurations.</td><td>No. If not provided, an ID is automatically generated.</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d286-e838-9601-f36fb91cf626"/><strong>org.kie.server.user</strong></span></td><td>string (default is "kieserver")</td><td>User name used to connect with the kieserver from the controller, required when
                running in managed mode</td><td>No</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d288-28ab-6e4b-a529f64bf5cf"/><strong>org.kie.server.pwd</strong></span></td><td>string (default is "kieserver1!")</td><td>Password used to connect with the kieserver from the controller, required when
                running in managed mode</td><td>No</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d289-27cd-441b-87c88d1aac84"/><strong>org.kie.server.controller</strong></span></td><td>comma separated list of urls</td><td>List of urls to controller REST endpoint. E.g.:
                  <code class="code">http://localhost:8080/kie-wb/rest/controller</code></td><td>Yes when using a controller</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d28a-a44b-544c-ff3012ddd077"/><strong>org.kie.server.controller.user</strong></span></td><td>string (default is "kieserver")</td><td>Username used to connect to the controller REST api</td><td>Yes when using a controller</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d28b-6920-9056-ad5537e03b3d"/><strong>org.kie.server.controller.pwd</strong></span></td><td>string (default is "kieserver1!")</td><td>Password used to connect to the controller REST api</td><td>Yes when using a controller</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d28c-0bcf-855f-17de4a1a154a"/><strong>org.kie.server.location</strong></span></td><td>URL location of kie server instance</td><td>The URL used by the controller to call back on this server. E.g.:
                  <code class="code">http://localhost:8230/kie-server/services/rest/server</code></td><td>Yes when using a controller</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d290-70e3-4337-c0623e88997d"/><strong>org.kie.server.domain</strong></span></td><td>string</td><td>JAAS LoginContext domain that shall be used to authenticate users when using
                JMS</td><td>No</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d291-35f6-a580-d9d9091ec570"/><strong>org.kie.server.bypass.auth.user</strong></span></td><td>boolean (default is "false")</td><td>Allows to bypass the authenticated user for task related operations e.g.
                queries</td><td>No</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d297-a4e6-1f15-48a5fe5d736b"/><strong>org.kie.server.repo</strong></span></td><td>valid file system path (default is ".")</td><td>Location on local file system where kie server state files will be
                stored</td><td>No</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d298-77f0-49d2-43c1bdf73d67"/><strong>org.kie.server.persistence.ds</strong></span></td><td>string</td><td>Datasource JNDI name</td><td>Yes when BPM support enabled</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d299-3d38-fcd9-3f423d7fecce"/><strong>org.kie.server.persistence.tm</strong></span></td><td>string</td><td>Transaction manager platform for Hibernate properties set</td><td>Yes when BPM support enabled</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d29a-a314-2bf7-907d924fceae"/><strong>org.kie.server.persistence.dialect</strong></span></td><td>string</td><td>Hibernate dialect to be used</td><td>Yes when BPM support enabled</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d29b-24df-ead1-cf206900593d"/><strong>org.jbpm.ht.callback</strong></span></td><td>string</td><td>One of supported callbacks for Task Service (default jaas)</td><td>No</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d29b-bb9f-8a9d-ab034d736caf"/><strong>org.jbpm.ht.custom.callback</strong></span></td><td>string</td><td>Custom implementation of UserGroupCallback in case org.jbpm.ht.callback was set
                to ‘custom’</td><td>No</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d29c-2bab-5ef7-13cbec1d5a68"/><strong>kie.maven.settings.custom</strong></span></td><td>valid file system path </td><td>Location of custom settings.xml for maven configuration</td><td>No</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d29d-4700-7f41-91fa6d386ecd"/><strong>org.kie.executor.interval</strong></span></td><td>integer (default is 3)</td><td>Number of time units between polls by executor</td><td>No</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d29d-ee54-02a8-274ef9383f41"/><strong>org.kie.executor.pool.size</strong></span></td><td>integer (default is 1)</td><td>Number of threads in the pool for async work</td><td>No</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d29e-9d32-e7ba-421f2a23128d"/><strong>org.kie.executor.retry.count</strong></span></td><td>integer (default is 3)</td><td>Number of retries to handle errors</td><td>No</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d2e4-4418-249a-eb8a85fb5da4"/><strong>org.kie.executor.timeunit</strong></span></td><td>TimeUnit (default is "SECONDS")</td><td>TimeUnit representing interval</td><td>No</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d2e5-23da-b5d3-f24703b68742"/><strong>org.kie.executor.disabled</strong></span></td><td>boolean (default is "false")</td><td>Disables executor completely</td><td>No</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d2e5-d59e-d87d-48a3630399a9"/><strong>kie.server.jms.queues.response</strong></span></td><td>string (default is "queue/KIE.SERVER.RESPONSE")</td><td>JNDI name of response queue for JMS</td><td>No</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d2e6-a4d9-d10c-e3b89262924b"/><strong>org.kie.server.controller.connect</strong></span></td><td>long (default is 10000)</td><td>Waiting time in milliseconds between repeated attempts to connect kie server to
                controller when kie server starts up</td><td>No</td></tr><tr><td><span class="bold"><a id="docs-internal-guid-81eb08e8-d2e6-a4d9-d10c-e3b89262924b"/><strong>org.drools.server.filter.classes</strong></span></td><td>boolean (default is "false")</td><td>If true, accept only classes which are annotated with @org.kie.api.remote.Remotable
                or @javax.xml.bind.annotation.XmlRootElement as extra JAXB classes</td><td>No</td></tr><tr><td> </td><td> </td><td> </td><td> </td></tr></tbody></table></div></div><p><br class="table-break"/>
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>If you are running both KIE Server and KIE Workbench you must configure KIE Server to use a different Data Source to KIE Workbench using the
          <span class="bold"><strong>org.kie.server.persistence.ds</strong></span> property. KIE Workbench uses a jBPM Executor Service that can conflict with
          KIE Server if they share the same Data Source.</p></div><p>
    </p></div><div class="section" title="22.2.2. Installation details for different containers"><div class="titlepage"><div><div><h3 class="title"><a id="d0e24677"/>22.2.2. Installation details for different containers</h3></div></div></div><div class="section" title="22.2.2.1. Tomcat 7.x/8.x"><div class="titlepage"><div><div><h4 class="title"><a id="d0e24680"/>22.2.2.1. Tomcat 7.x/8.x</h4></div></div></div><p>
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Download and unzip the Tomcat distribution. Let's call the root of the
              distribution <code class="code">TOMCAT_HOME</code>. This directory is named after the Tomcat
              version, so for example <code class="code">apache-tomcat-7.0.55</code>.</p></li><li class="listitem"><p>Download <span class="emphasis"><em>kie-server-6.5.0.Final-webc.war</em></span> and place it
              into <code class="code">TOMCAT_HOME/webapps</code>.</p></li><li class="listitem"><p>Configure user(s) and role(s). Make sure that file
                <code class="code">TOMCAT_HOME/conf/tomcat-users.xml</code> contains the following username and
              role definition. You can of course choose different username and password, just make
              sure that the user has role <code class="code">kie-server</code>: </p><div class="example"><a id="d0e24713"/><p class="title"><strong>Example 22.2. Username and role definition for Tomcat</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;role rolename="kie-server"/&gt;
&lt;user username="serveruser" password="my.s3cr3t.pass" roles="kie-server"/&gt;</code></pre></div></div><p><br class="example-break"/>
            </p></li><li class="listitem"><p>Start the server by running <code class="code">TOMCAT_HOME/bin/startup.[sh|bat]</code>. You can
              check out the Tomcat logs in <code class="code">TOMCAT_HOME/logs</code> to see if the application
              deployed successfully. Please read the table above for the bootstrap switches that can
              be used to properly configure the instance. For
              instance:</p><pre><code class="no-highlight">./startup.sh -Dorg.kie.server.id=first-kie-server
             -Dorg.kie.server.location=http://localhost:8080/kie-server/services/rest/server</code></pre></li><li class="listitem"><p>Verify the server is running. Go to
                <code class="code">http://SERVER:PORT/CONTEXT/services/rest/server/</code> and type the specified
              username and password. You should see simple XML message with basic information about
              the server.</p></li></ol></div><p>
        </p><p>
          </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2>You can not leverage the JMS interface when running on Tomcat, or any other Web
            container. The Web container version of the WAR contains only the REST interface.
          </div><p>
        </p><p>
      </p></div><div class="section" title="22.2.2.2. WildFly 8.x"><div class="titlepage"><div><div><h4 class="title"><a id="d0e24743"/>22.2.2.2. WildFly 8.x</h4></div></div></div><p>
        </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Download and unzip the WildFly distribution. Let's call the root of the
              distribution <code class="code">WILDFLY_HOME</code>. This directory is named after the WildFly
              version, so for example <code class="code">wildfly-8.2.0.Final</code>. </p></li><li class="listitem"><p>Download <span class="emphasis"><em>kie-server-6.5.0.Final-ee7.war</em></span> and place it
              into <code class="code">WILDFLY_HOME/standalone/deployments</code>. </p></li><li class="listitem"><p>Configure user(s) and role(s). Execute the following command <code class="code">
                WILDFLY_HOME/bin/add-user.[sh|bat] -a -u 'kieserver' -p 'kieserver1!' -ro
                'kie-server'</code>. You can of course choose different username and password, just
              make sure that the user has role <code class="code">kie-server</code>. </p></li><li class="listitem"><p>Start the server by running <code class="code">WILDFLY_HOME/bin/standalone.[sh|bat] -c
                standalone-full.xml &lt;bootstrap_switches&gt;</code>. You can check out the standard
              output or WildFly logs in <code class="code">WILDFLY_HOME/standalone/logs</code> to see if the
              application deployed successfully. Please read the table above for the bootstrap
              switches that can be used to properly configure the instance. For
              instance:</p><pre><code class="no-highlight">./standalone.sh  --server-config=standalone-full.xml
                 -Djboss.socket.binding.port-offset=150
                 -Dorg.kie.server.id=first-kie-server
                 -Dorg.kie.server.location=http://localhost:8230/kie-server/services/rest/server</code></pre></li><li class="listitem"><p>Verify the server is running. Go to
                <code class="code">http://SERVER:PORT/CONTEXT/services/rest/server/</code> and type the specified
              username and password. You should see simple XML message with basic information about
              the server. </p><div class="screenshot"><div class="mediaobject"><img src="shared/images/KieServer/kie-server-info.png"/></div></div></li></ol></div><p>
      </p></div></div></div><div class="section" title="22.3. Kie Server setup"><div class="titlepage"><div><div><h2 class="title"><a id="d0e24798"/>22.3. Kie Server setup</h2></div></div></div><p>
              </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>Server setup and registration changed significantly from versions 6.2 and
                            before. The following applies only to version 6.3 and forward.</p></div><p>
       </p><div class="section" title="22.3.1. Managed Kie Server"><div class="titlepage"><div><div><h3 class="title"><a id="d0e24807"/>22.3.1. Managed Kie Server </h3></div></div></div><p>A managed instance is one that requires a controller to be available to properly
                     startup the Kie Server instance. </p><p>A Controller is a component responsible for keeping and managing a Kie Server
                     Configuration in centralized way. Each controller can manager multiple
                     configurations at once and there can be multiple controllers in the
                     environment. Managed KIE Servers can be configured with a list of controllers
                     but will connect to only one at a time.</p><p>
                     </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2>It's important to mention that even though there can be multiple
                            controllers they should be kept in sync to make sure that regardless
                            which one of them is contacted by KIE Server instance it will provide
                            same set of configuration.</div><p>
              </p><p>At startup, if a Kie Server is configured with a list of controllers, it will
                     try succesivelly to connect to each of them until a connection is successfully
                     stablished with one of them. If for any reason a connection can't be
                     stablished, the server will not start, even if there is local storage available
                     with configuration. This happens by design in order to ensure consistency. For
                     instance, if the Kie  Server was down and the configuration has changed, this
                     restriction guarantees that it will run with up to date configuration or not at
                     all. </p><p>
                     </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2>In order to run the Kie Server in standalone mode, without connecting to
                            any controllers, please see "Unmanaged Kie Server". </div><p>
              </p><p>The configuration sets, among other things: </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>kie containers to be deployed and started</p></li><li class="listitem"><p>configuration items - currently this is a place holder for
                                          further enhancements that will allow remotely configure
                                          KIE Execution Server components - timers, persistence, etc
                                   </p></li></ul></div><p>The Controller, besides providing configuration management, is
                     also responsible for overall management of Kie Servers. It provides a REST api
                     that is divided into two parts:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>the controller itself that is exposed to interact with KIE
                                          Execution Server instances</p></li><li class="listitem"><p>an administration API that allows to remotely manage Kie
                                          Server instances:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>add/remove servers </p></li><li class="listitem"><p>add/remove containers to/from the
                                                  servers</p></li><li class="listitem"><p>start/stop containers on servers </p></li></ul></div></li></ul></div><p>The controller deals only with the Kie Server configuration or definition to put
                     it differently. It does not handle any runtime components of KIE Execution
                     Server instances. They are always considered remote to controller. The
                     controller is responsible for persisting the configuration to preserve restarts
                     of the controller itself. It should manage the synchronization as well in case
                     multiple controllers are configured to keep all definitions up to date on all
                     instances of the controller. </p><p>By default controller is shipped with Kie Workbench and provides a fully
                     featured management interface (both REST api and UI). It uses underlying git
                     repository as persistent store and thus when GIT repositories are clustered
                     (using Apache Zookeeper and Apache Helix) it will cover the controllers
                     synchronization as well. </p><div class="screenshot"><div class="mediaobject"><img src="shared/images/KieServer/kie-server-simple-architecture.png"/></div></div><p>The diagram above illustrates the single controller (workbench) setup with
                     multiple Kie Server instances managed by it. </p><p>The diagram below illustrates the clustered setup where there are multiple
                     instances of controller synchronized over Zookeeper. </p><div class="screenshot"><div class="mediaobject"><img src="shared/images/KieServer/kie-server-architecture.png"/></div></div><p>In the above diagram we can see that the Kie Server instances are capable of
                     connecting to any controllers, but they will connect to only one. Each instance
                     will attempt to connect to controller as long as it can reach one. Once
                     connection is established with one of the controllers it will skip the others. </p><div class="section" title="22.3.1.1. Working with managed servers"><div class="titlepage"><div><div><h4 class="title"><a id="d0e24873"/>22.3.1.1. Working with managed servers </h4></div></div></div><p>There are two approaches that users can take when working with managed
                            KIE Server instances: </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>Configuration first: </em></span>with this approach, a user will start working with
                                          the controller (either UI or REST api) and create and
                                          configure Kie Server definitions. That consists basically
                                          of an identification for the server definition (id and
                                          name + optionally version for improved readability) and
                                          the configuration for the Kie Containers to run on the
                                          server.</p></li><li class="listitem"><p><span class="emphasis"><em>Registration first:</em></span> with this approach, the Kie Server instances are
                                          started first and auto register themselves on controller.
                                          The user then can configure the Kie Containers. This
                                          option simply skips the registration step done in the
                                          first approach and populates it with server id, name and
                                          version directly upon auto registration. There are no
                                          other differences between the two approaches.</p></li></ul></div></div></div><div class="section" title="22.3.2. Unmanaged KIE Execution Server"><div class="titlepage"><div><div><h3 class="title"><a id="d0e24889"/>22.3.2. Unmanaged KIE Execution Server</h3></div></div></div><p>An unmanaged Kie Server is in turn just a standalone instance, and thus must be
                     configured individually using REST/JMS api from the Kie Server itself. There is
                     no controller involved. The configuration is automatically persisted by the
                     server into a file and that is used as the internal server state, in case of
                     restarts. </p><p>The configuration is updated during the following operations: </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>deploy Kie Container </p></li><li class="listitem"><p>undeploy Kie Container </p></li><li class="listitem"><p>start Kie Container </p></li><li class="listitem"><p>stop Kie Container</p></li></ul></div><p>
                     </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2>if the Kie Server is restarted, it will try to restablish the same state
                     that was persisted before shutdown. That means that Kie Containers that were 
                     running, will be started, but the ones that were stopped/disposed before, will not.
                     </div><p>In most use cases, the Kie Server should be executed in managed mode as that
                     provides some benefits, like a web user interface (if using the workbench as a
                     controller) and some facilities for clustering.</p></div></div><div class="section" title="22.4. Creating a Kie Container"><div class="titlepage"><div><div><h2 class="title"><a id="d0e24914"/>22.4. Creating a Kie Container</h2></div></div></div><p>Once your Execution Server is registered, you can start adding <span class="bold"><strong>Kie Containers</strong></span> to it. </p><p><span class="bold"><strong>Kie Containers</strong></span> are self contained environments that have been provisioned to hold
              instances of your packaged and deployed rule instances.</p><p>
              </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Start by clicking the <span class="bold"><strong>+</strong></span> icon next to the Execution Server where
                                   you want to deploy your Container. This will bring up the New
                                   Container screen.</p></li><li class="listitem"><p>If you know the <span class="bold"><strong>Group Name</strong></span>,
                                          <span class="bold"><strong>Artifact Id</strong></span> and <span class="bold"><strong>Version</strong></span> (GAV) of your deployed
                                   package, then you can enter those details and click the Ok button
                                   to select that instance (and provide a name for the
                                   Container);</p></li><li class="listitem"><p>If you don't know these values, you can search KIE Workbench
                                   for all packages that can be deployed. Click the <span class="bold"><strong>Search</strong></span> button
                                   without entering any value in the search field (you can narrow
                                   your search by entering any term that you know exists in the
                                   package that you want to deploy).</p><p>
                                   </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>INSERT
                                                 SCREENSHOT HERE</p></div><p>
                            </p><p>The figure above shows that there are three deployable packages
                                   available to be used as containers on the Execution Server.
                                   Select the one that you want by clicking the Select button. This
                                   will auto-populate the <span class="bold"><strong>GAV</strong></span> and you can then click the <span class="bold"><strong>Ok</strong></span> button
                                   to use this deployable as the new Container.</p></li><li class="listitem"><p>Enter a name for this Container at the top and then press the Ok
                                   button. </p><p>
                                   </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>The Container name must be unique inside each
                                                 execution server and must not contain any
                                                 spaces.</p></div><p>
                            </p></li></ol></div><p>
       </p><p>
              </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Just below the <span class="bold"><strong>GAV</strong></span> row, you will see an uneditable row that shows you the
                            <span class="bold"><strong>URL</strong></span> for your Container against which you will be able to execute REST
                            commands.</p></div><p>
       </p></div><div class="section" title="22.5. Managing Containers"><div class="titlepage"><div><div><h2 class="title"><a id="d0e24991"/>22.5. Managing Containers</h2></div></div></div><p>Containers within the Execution Server can be started, stopped and updated from within
              KIE Workbench.⁠ </p><div class="section" title="22.5.1. Starting a Container"><div class="titlepage"><div><div><h3 class="title"><a id="d0e24996"/>22.5.1. Starting a Container</h3></div></div></div><p>Once registered, a Container is in the 'Stopped' mode. It can be started by
                     first selecting it and then clicking the Start button. You can also select
                     multiple Containers and start them all at the same time. </p><p>Once the Container is in the 'Running' mode, a green arrow appears next to it.
                     If there are any errors starting the Container(s), red icons appear next to
                     Containers and the Execution Server that they are deployed on. </p><p>You should check the logs of both the Execution Server and the current Business
                     Central to see what the errors are before redeploying the Containers (and
                     possibly the Execution Server).⁠</p></div><div class="section" title="22.5.2. Stopping and Deleting a Container"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25005"/>22.5.2. Stopping and Deleting a Container</h3></div></div></div><p>Similar to starting a Container, select the Container(s) that you want to
                     stop (or delete) and click the Stop button (which replaces the Start button for that
                     Container once it has entered the 'Running' mode) or the Delete button.⁠</p></div><div class="section" title="22.5.3. Updating a Container"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25010"/>22.5.3. Updating a Container</h3></div></div></div><p>You can update deployed <code class="code">KieContainers</code> without restarting the
                     Execution Server. This is useful in cases where the Business Rules change,
                     creating new versions of packages to be provisioned.</p><p>You can have multiple versions of the same package provisioned and deployed,
                     each to a different <code class="code">KieContainer</code>. </p><p>To update deployments in a <code class="code">KieContainer</code> dynamically, click on the
                     icon next to the Container. This will open up the Container Info screen. An
                     example of this screen is shown here:</p><p>
                     </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>INSERT
                                   SCREENSHOT HERE</p></div><p>
              </p><p>The Container Info screen is a useful tool because it not only allows you to see
                     the endpoint for this <code class="code">KieContainer</code>, but it also allows you to
                     either manually or automatically refresh the provision if an update is
                     available. The update can be manual or automatic:</p><p><span class="bold"><strong>Manual Update:</strong></span> To manually update a
                            <code class="code">KieContainer</code>, enter the new Version number in the Version
                     box and click on the <span class="bold"><strong>Update</strong></span> button. You can of
                     course, update the Group Id or the Artifact Id , if these have changed as well.
                     Once updated, the Execution server updates the container and shows you the
                     resolved GAV attributes at the bottom of the screen in the <span class="bold"><strong>Resolved Release Id</strong></span> section. </p><p><span class="bold"><strong>Automatic Update:</strong></span> If you want a deployed
                     Container to always have the latest version of your deployment without manually
                     editing it, you will need to set the Version property to the value of
                            <code class="code">LATEST</code> and start a <code class="code">Scanner</code>. This will ensure
                     that the deployed provision always contains the latest version. The Scanner can
                     be started just once on demand by clicking the Scan Now button or you can start
                     it in the background with scans happening at a specified interval (in
                     seconds).You can also set this value to <code class="code">LATEST</code> when you are first
                     creating this deployment. The <span class="bold"><strong>Resolved Release
                            Id</strong></span> in this case will show you the actual, latest version
                     number.</p></div></div><div class="section" title="22.6. Kie Server REST API"><div class="titlepage"><div><div><h2 class="title"><a id="d0e25070"/>22.6. Kie Server REST API</h2></div></div></div><p>The Execution Server supports the following commands via the REST API. </p><p>Please note the following before using these commands: </p><p>
              </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The base URL for these will remain as the endpoint defined earlier
                                   (for example:
                                          <code class="code">http://SERVER:PORT/CONTEXT/services/rest/server/</code>
                                   )</p></li><li class="listitem"><p>All requests require basic HTTP Authentication for the role
                                   kie-server as indicated earlier.</p></li></ul></div><p>
       </p><div class="section" title="22.6.1. [GET] /"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25090"/>22.6.1. [GET] /</h3></div></div></div><p>Returns the Execution Server information</p><div class="example"><a id="d0e25095"/><p class="title"><strong>Example 22.3. Example Server Response</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;response type="SUCCESS" msg="KIE Server info"&gt;
  &lt;kie-server-info&gt; 
    &lt;version&gt;6.2.0.redhat-1&lt;/version&gt; 
  &lt;/kie-server-info&gt; 
&lt;/response&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="22.6.2. [POST] /"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25100"/>22.6.2. [POST] /</h3></div></div></div><p>Using POST HTTP method, you can execute various commands on the Execution
                     Server. E.g: create-container, list-containers, dispose-container and call-container.</p>
                     Following is the full list of commands:
              <p>
                </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>CreateContainerCommand</p></li><li class="listitem"><p>GetServerInfoCommand</p></li><li class="listitem"><p>ListContainersCommand</p></li><li class="listitem"><p>CallContainerCommand</p></li><li class="listitem"><p>DisposeContainerCommand</p></li><li class="listitem"><p>GetContainerInfoCommand</p></li><li class="listitem"><p>GetScannerInfoCommand</p></li><li class="listitem"><p>UpdateScannerCommand</p></li><li class="listitem"><p>UpdateReleaseIdCommand</p></li></ul></div><p>
                The commands itself can be found in the <code class="code">org.kie.server.api.commands</code> package.
              </p></div><div class="section" title="22.6.3. [GET] /containers"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25140"/>22.6.3. [GET] /containers</h3></div></div></div><p>Returns a list of containers that have been created on this Execution
                     Server.</p><div class="example"><a id="d0e25145"/><p class="title"><strong>Example 22.4. Example Server Response</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;response type="SUCCESS" msg="List of created containers"&gt;
  &lt;kie-containers&gt; 
    &lt;kie-container container-id="MyProjectContainer" status="STARTED"&gt; 
      &lt;release-id&gt;
        &lt;artifact-id&gt;Project1&lt;/artifact-id&gt; 
        &lt;group-id&gt;com.redhat&lt;/group-id&gt;
        &lt;version&gt;1.0&lt;/version&gt; 
      &lt;/release-id&gt; 
      &lt;resolved-release-id&gt;
        &lt;artifact-id&gt;Project1&lt;/artifact-id&gt; 
        &lt;group-id&gt;com.redhat&lt;/group-id&gt;
        &lt;version&gt;1.0&lt;/version&gt; 
      &lt;/resolved-release-id&gt; 
    &lt;/kie-container&gt;
  &lt;/kie-containers&gt; 
&lt;/response&gt;</code></pre></div></div><br class="example-break"/><p>
             The endpoint supports also filtering based on <code class="code">ReleaseId</code> and container status. Examples:
             </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="code">/containers?groupId=org.example</code> - returns only containers with the specified groupId</li><li class="listitem"><code class="code">/containers?groupId=org.example&amp;artifactId=project1&amp;version=1.0.0.Final</code>
                     - returns only containers with the specified <code class="code">ReleaseId</code></li><li class="listitem"><code class="code">/containers?status=started,failed</code> - returns containers which are either started or failed</li></ul></div><p>
           </p></div><div class="section" title="22.6.4. ⁠[GET] /containers/{id}"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25171"/>22.6.4. ⁠[GET] /containers/{id}</h3></div></div></div><p>Returns the status and information about a particular container. For example,
                     executing
                            <code class="code">http://SERVER:PORT/CONTEXT/services/rest/server/containers/MyProjectContainer</code>
                     could return the following example container info.</p><div class="example"><a id="d0e25179"/><p class="title"><strong>Example 22.5. Example Server Response</strong></p><div class="example-contents"><pre><code class="language-xml">⁠&lt;response type="SUCCESS" msg="Info for container MyProjectContainer"&gt;
  &lt;kie-container container-id="MyProjectContainer" status="STARTED"&gt; 
    &lt;release-id&gt;
      &lt;artifact-id&gt;Project1&lt;/artifact-id&gt; 
      &lt;group-id&gt;com.redhat&lt;/group-id&gt;
      &lt;version&gt;1.0&lt;/version&gt; 
    &lt;/release-id&gt; 
    &lt;resolved-release-id&gt;
      &lt;artifact-id&gt;Project1&lt;/artifact-id&gt; 
      &lt;group-id&gt;com.redhat&lt;/group-id&gt;
      &lt;version&gt;1.0&lt;/version&gt; 
    &lt;/resolved-release-id&gt; 
  &lt;/kie-container&gt;
&lt;/response&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="22.6.5. [PUT] /containers/{id}"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25184"/>22.6.5. [PUT] /containers/{id}</h3></div></div></div><p>Allows you to create a new Container in the Execution Server. For example, to
                     create a Container with the id of <span class="bold"><strong>MyRESTContainer</strong></span> the complete endpoint will be:
                            <code class="code">http://SERVER:PORT/CONTEXT/services/rest/server/containers/MyRESTContainer</code>.
                     An example of request is:⁠</p><div class="example"><a id="d0e25195"/><p class="title"><strong>Example 22.6. Example Request to create a container</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;kie-container container-id="MyRESTContainer"&gt;
  &lt;release-id&gt;
    &lt;artifact-id&gt;Project1&lt;/artifact-id&gt; 
    &lt;group-id&gt;com.redhat&lt;/group-id&gt;
    &lt;version&gt;1.0&lt;/version&gt; 
  &lt;/release-id&gt; 
&lt;/kie-container&gt;</code></pre></div></div><br class="example-break"/><p>And the response from the server, if
                     successful, would be be:</p><div class="example"><a id="d0e25202"/><p class="title"><strong>Example 22.7. Example Server Response when creating a container</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;response type="SUCCESS" msg="Container MyRESTContainer successfully deployed with module com.redhat:Project1:1.0"&gt;
  &lt;kie-container container-id="MyProjectContainer" status="STARTED"&gt; 
    &lt;release-id&gt;
      &lt;artifact-id&gt;Project1&lt;/artifact-id&gt; 
      &lt;group-id&gt;com.redhat&lt;/group-id&gt;
      &lt;version&gt;1.0&lt;/version&gt; 
    &lt;/release-id&gt; 
    &lt;resolved-release-id&gt;
      &lt;artifact-id&gt;Project1&lt;/artifact-id&gt; 
      &lt;group-id&gt;com.redhat&lt;/group-id&gt;
      &lt;version&gt;1.0&lt;/version&gt; 
    &lt;/resolved-release-id&gt; 
  &lt;/kie-container&gt;
&lt;/response&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="22.6.6. [DELETE] /containers/{id}"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25207"/>22.6.6. [DELETE] /containers/{id}</h3></div></div></div><p>⁠Disposes the Container specified by the id. For example, executing
                            <code class="code">http://SERVER:PORT/CONTEXT/services/rest/server/containers/MyProjectContainer</code>
                     using the DELETE HTTP method will return the following server response:⁠</p><div class="example"><a id="d0e25215"/><p class="title"><strong>Example 22.8. Example Server Response disposing a container</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;response type="SUCCESS" msg="Container MyProjectContainer successfully disposed."/&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="22.6.7. [POST] /containers/instances/{id}"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25220"/>22.6.7. [POST] /containers/instances/{id}</h3></div></div></div><p>Executes operations and commands against the specified Container. You can send
      commands to this Container in the body of the POST request. For example, to fire all rules for
      Container with id MyRESTContainer
        (<code class="code">http://SERVER:PORT/CONTEXT/services/rest/server/containers/instances/MyRESTContainer</code>),
      you would send the fire-all-rules command to it as shown below (in the body of the POST
      request):</p><div class="example"><a id="d0e25228"/><p class="title"><strong>Example 22.9. Example Server Request to fire all rules</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;fire-all-rules/&gt;</code></pre></div></div><br class="example-break"/><p>Following is the list of supported commands:
              
                </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>AgendaGroupSetFocusCommand</p></li><li class="listitem"><p>ClearActivationGroupCommand</p></li><li class="listitem"><p>ClearAgendaCommand</p></li><li class="listitem"><p>ClearAgendaGroupCommand</p></li><li class="listitem"><p>ClearRuleFlowGroupCommand</p></li><li class="listitem"><p>DeleteCommand</p></li><li class="listitem"><p>InsertObjectCommand</p></li><li class="listitem"><p>ModifyCommand</p></li><li class="listitem"><p>GetObjectCommand</p></li><li class="listitem"><p>InsertElementsCommand</p></li><li class="listitem"><p>FireAllRulesCommand</p></li><li class="listitem"><p>QueryCommand</p></li><li class="listitem"><p>SetGlobalCommand</p></li><li class="listitem"><p>GetGlobalCommand</p></li><li class="listitem"><p>GetObjectsCommand</p></li><li class="listitem"><p>BatchExecutionCommand</p></li></ul></div><p>
                These commands can be found in the <code class="code">org.drools.core.command.runtime</code> package.
              </p></div><div class="section" title="22.6.8. [GET] /containers/{id}/release-id"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25288"/>22.6.8. [GET] /containers/{id}/release-id</h3></div></div></div><p>Returns the full
                     release id for the Container specified by the id.</p><div class="example"><a id="d0e25293"/><p class="title"><strong>Example 22.10. Example Server Response</strong></p><div class="example-contents"><pre><code class="language-xml">⁠&lt;response type="SUCCESS" msg="ReleaseId for container MyProjectContainer"&gt;
  &lt;release-id&gt;
    &lt;artifact-id&gt;Project1&lt;/artifact-id&gt; 
    &lt;group-id&gt;com.redhat&lt;/group-id&gt;
    &lt;version&gt;1.0&lt;/version&gt; 
  &lt;/release-id&gt; 
&lt;/response&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="22.6.9. [POST] /containers/{id}/release-id"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25298"/>22.6.9. [POST] /containers/{id}/release-id</h3></div></div></div><p>Allows you to update the release id of
                     the container deployment. Send the new complete release id to the Server.</p><div class="example"><a id="d0e25303"/><p class="title"><strong>Example 22.11. Example Server Request</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;release-id&gt;
  &lt;artifact-id&gt;Project1&lt;/artifact-id&gt;
  &lt;group-id&gt;com.redhat&lt;/group-id&gt;    
  &lt;version&gt;1.1&lt;/version&gt;
&lt;/release-id&gt; </code></pre></div></div><br class="example-break"/><p>The Server will respond with a success or error message, similar to
                     the one below:⁠</p><div class="example"><a id="d0e25310"/><p class="title"><strong>Example 22.12. Example Server Response</strong></p><div class="example-contents"><pre><code class="no-highlight">&lt;response type="SUCCESS" msg="Release id successfully updated."&gt;
  &lt;release-id&gt;
    &lt;artifact-id&gt;Project1&lt;/artifact-id&gt; 
    &lt;group-id&gt;com.redhat&lt;/group-id&gt;
    &lt;version&gt;1.0&lt;/version&gt; 
  &lt;/release-id&gt; 
&lt;/response&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="22.6.10. [GET] /containers/{id}/scanner"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25315"/>22.6.10. [GET] /containers/{id}/scanner</h3></div></div></div><p>Returns information about the scanner for this Container's
                     automatic updates.⁠</p><div class="example"><a id="d0e25320"/><p class="title"><strong>Example 22.13. Example Server Response</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;response type="SUCCESS" msg="Scanner info successfully retrieved"&gt;
  &lt;kie-scanner status="DISPOSED"/&gt; 
&lt;/response&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="22.6.11. [POST] /containers/{id}/scanner"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25325"/>22.6.11. [POST] /containers/{id}/scanner</h3></div></div></div><p>Allows you to start or stop a scanner that controls polling for updated
                     Container deployments. To start the scanner, send a request similar to:
                            <code class="code">http://SERVER:PORT/CONTEXT/services/rest/server/containers/{container-id}/scanner</code>
                     with the following POST data.⁠</p><div class="example"><a id="d0e25333"/><p class="title"><strong>Example 22.14. Example Server Request to start the scanner</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;kie-scanner status="STARTED" poll-interval="20"/&gt;</code></pre></div></div><br class="example-break"/><p>⁠The poll-interval attribute is in seconds. The response from the server will be similar
                     to:⁠</p><div class="example"><a id="d0e25340"/><p class="title"><strong>Example 22.15. Example Server Response</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;response type="SUCCESS" msg="Kie scanner successfully created."&gt;
  &lt;kie-scanner status="STARTED"/&gt; 
&lt;/response&gt;</code></pre></div></div><br class="example-break"/><p>To stop the Scanner, replace the status with <code class="code">DISPOSED</code> and remove
                     the poll-interval attribute.</p></div><div class="section" title="22.6.12. Native REST client for Execution Server"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25350"/>22.6.12. Native REST client for Execution Server</h3></div></div></div><p>
       Commands outlined in this section can be sent with any REST client, whether it is curl, RESTEasy or .NET based application. However, when sending requests from Java based application, users
       can utilize out of the box native client for remote communication with Execution Server. This client is part of the <span class="bold"><strong>org.kie:kie-server-client</strong></span> project. It doesn't allow creating XML request, therefore
       it is necessary generate them before, for example, using Drools API.
       </p><div class="example"><a id="d0e25358"/><p class="title"><strong>Example 22.16. Generate XML request</strong></p><div class="example-contents"><pre><code class="language-java"> 
import java.util.ArrayList;
import java.util.List;

import org.drools.core.command.impl.GenericCommand;
import org.drools.core.command.runtime.BatchExecutionCommandImpl;
import org.drools.core.command.runtime.rule.FireAllRulesCommand;
import org.drools.core.command.runtime.rule.InsertObjectCommand;
import org.kie.api.command.BatchExecutionCommand;
import org.kie.internal.runtime.helper.BatchExecutionHelper;

public class DecisionClient {

public static void main(String args[]) {
        Bean1 bean1 = new Bean1();
        bean1.setName("Robert");

        InsertObjectCommand insertObjectCommand = new InsertObjectCommand(bean1, "f1");
        FireAllRulesCommand fireAllRulesCommand = new FireAllRulesCommand("myFireCommand");

        List&lt;GenericCommand&lt;?&gt;&gt; commands = new ArrayList&lt;GenericCommand&lt;?&gt;&gt;();
        commands.add(insertObjectCommand);
        commands.add(fireAllRulesCommand);
        BatchExecutionCommand command = new BatchExecutionCommandImpl(commands);

        String xStreamXml = BatchExecutionHelper.newXStreamMarshaller().toXML(command); // actual XML request
	}
}
         </code></pre></div></div><br class="example-break"/><p>Once the request is generated it can be sent using <span class="bold"><strong>kie-server-client</strong></span> as follows:</p><div class="example"><a id="d0e25368"/><p class="title"><strong>Example 22.17. Sending XML request with kie-server-client</strong></p><div class="example-contents"><pre><code class="language-java"> 
import org.kie.server.api.model.ServiceResponse;
import org.kie.server.client.KieServicesClient;
import org.kie.server.client.KieServicesConfiguration;
import org.kie.server.client.KieServicesFactory;

//user "anton" must have role "kie-server" assigned
KieServicesConfiguration config =  KieServicesFactory.
        newRestConfiguration("http://localhost:8080/kie-server/services/rest/server",
        "anton",
        "password1!");
 KieServicesClient client = KieServicesFactory.newKieServicesClient(config);
// the request "xStreamXml" we generated in previous step
// "ListenerReproducer" is the name of the Container
ServiceResponse&lt;String&gt; response = client.executeCommands("ListenerReproducer", xStreamXml); 
System.out.println(response.getResult());
			 </code></pre></div></div><br class="example-break"/></div></div><div class="section" title="22.7. OptaPlanner REST API"><div class="titlepage"><div><div><h2 class="title"><a id="d0e25373"/>22.7. OptaPlanner REST API</h2></div></div></div><p>When the Planner capability is enabled, the Kie Server supports the following additional REST APIs. As usual,
  all these APIs are also available through JMS and the Java client API. Please also note:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The base URL for these will remain as the endpoint defined earlier (for example
        <code class="code">http://SERVER:PORT/CONTEXT/services/rest/server/</code> ).</p></li><li class="listitem"><p>All requests require basic HTTP Authentication for the role kie-server as indicated earlier.</p></li><li class="listitem"><p>To get a specific marshalling format, add the HTTP headers <code class="literal">Content-Type</code> and optional
        <code class="literal">X-KIE-ContentType</code> in the HTTP request. For example:</p><pre><code class="no-highlight">Content-Type: application/xml
X-KIE-ContentType: xstream</code></pre></li></ul></div><p>The example requests and responses used below presume that a kie container is build using the optacloud example
  of OptaPlanner Workbench, by calling a <code class="literal">PUT</code> on
  <code class="literal">/services/rest/server/containers/optacloud-kiecontainer-1</code> with this content:</p><pre><code class="language-xml">&lt;kie-container container-id="optacloud-kiecontainer-1"&gt;
  &lt;release-id&gt;
    &lt;group-id&gt;opta&lt;/group-id&gt;
    &lt;artifact-id&gt;optacloud&lt;/artifact-id&gt; 
    &lt;version&gt;1.0.0&lt;/version&gt; 
  &lt;/release-id&gt; 
&lt;/kie-container&gt;</code></pre><div class="section" title="22.7.1. [GET] /containers/{containerId}/solvers"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25410"/>22.7.1. [GET] /containers/{containerId}/solvers</h3></div></div></div><p>Returns the list of solvers created in the container.</p><div class="example"><a id="d0e25415"/><p class="title"><strong>Example 22.18. Example Server Response (XStream)</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;org.kie.server.api.model.ServiceResponse&gt;
  &lt;type&gt;SUCCESS&lt;/type&gt;
  &lt;msg&gt;Solvers list successfully retrieved from container 'optacloud-kiecontainer-1'&lt;/msg&gt;
  &lt;result class="org.kie.server.api.model.instance.SolverInstanceList"&gt;
    &lt;solvers&gt;
      &lt;solver-instance&gt;
        &lt;container-id&gt;optacloud-kiecontainer-1&lt;/container-id&gt;
        &lt;solver-id&gt;solver1&lt;/solver-id&gt;
        &lt;solver-config-file&gt;opta/optacloud/cloudSolverConfig.solver.xml&lt;/solver-config-file&gt;
        &lt;status&gt;NOT_SOLVING&lt;/status&gt;
      &lt;/solver-instance&gt;
      &lt;solver-instance&gt;
        &lt;container-id&gt;optacloud-kiecontainer-1&lt;/container-id&gt;
        &lt;solver-id&gt;solver2&lt;/solver-id&gt;
        &lt;solver-config-file&gt;opta/optacloud/cloudSolverConfig.solver.xml&lt;/solver-config-file&gt;
        &lt;status&gt;NOT_SOLVING&lt;/status&gt;
      &lt;/solver-instance&gt;
    &lt;/solvers&gt;
  &lt;/result&gt;
&lt;/org.kie.server.api.model.ServiceResponse&gt;</code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e25420"/><p class="title"><strong>Example 22.19. Example Server Response (JSON)</strong></p><div class="example-contents"><pre><code class="language-json">{
  "type" : "SUCCESS",
  "msg" : "Solvers list successfully retrieved from container 'optacloud-kiecontainer-1'",
  "result" : {
    "solver-instance-list" : {
      "solver" : [ {
        "status" : "NOT_SOLVING",
        "container-id" : "optacloud-kiecontainer-1",
        "solver-id" : "solver1",
        "solver-config-file" : "opta/optacloud/cloudSolverConfig.solver.xml"
      }, {
        "status" : "NOT_SOLVING",
        "container-id" : "optacloud-kiecontainer-1",
        "solver-id" : "solver2",
        "solver-config-file" : "opta/optacloud/cloudSolverConfig.solver.xml"
      } ]
    }
  }
}           </code></pre></div></div><br class="example-break"/></div><div class="section" title="22.7.2. [PUT] /containers/{containerId}/solvers/{solverId}"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25425"/>22.7.2. [PUT] /containers/{containerId}/solvers/{solverId}</h3></div></div></div><p>Creates a new solver with the given <code class="code">{solverId}</code> in the container <code class="code">{containerId}</code>. The
    request's body is a marshalled SolverInstance entity that must specify the solver configuration file.</p><p>The following is an example of the request and the corresponding response.</p><div class="example"><a id="d0e25438"/><p class="title"><strong>Example 22.20. Example Server Request (XStream)</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;solver-instance&gt;
  &lt;solver-config-file&gt;opta/optacloud/cloudSolverConfig.solver.xml&lt;/solver-config-file&gt;
&lt;/solver-instance&gt;          </code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e25443"/><p class="title"><strong>Example 22.21. Example Server Response (XStream)</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;org.kie.server.api.model.ServiceResponse&gt;
  &lt;type&gt;SUCCESS&lt;/type&gt;
  &lt;msg&gt;Solver 'solver1' successfully created in container 'optacloud-kiecontainer-1'&lt;/msg&gt;
  &lt;result class="solver-instance"&gt;
    &lt;container-id&gt;optacloud-kiecontainer-1&lt;/container-id&gt;
    &lt;solver-id&gt;solver1&lt;/solver-id&gt;
    &lt;solver-config-file&gt;opta/optacloud/cloudSolverConfig.solver.xml&lt;/solver-config-file&gt;
    &lt;status&gt;NOT_SOLVING&lt;/status&gt;
  &lt;/result&gt;
&lt;/org.kie.server.api.model.ServiceResponse&gt;         </code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e25448"/><p class="title"><strong>Example 22.22. Example Server Request (JSON)</strong></p><div class="example-contents"><pre><code class="language-json">{
  "solver-config-file" : "opta/optacloud/cloudSolverConfig.solver.xml"
}           </code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e25453"/><p class="title"><strong>Example 22.23. Example Server Response (JSON)</strong></p><div class="example-contents"><pre><code class="language-json">{
  "type" : "SUCCESS",
  "msg" : "Solver 'solver1' successfully created in container 'optacloud-kiecontainer-1'",
  "result" : {
    "solver-instance" : {
      "container-id" : "optacloud-kiecontainer-1",
      "solver-id" : "solver1",
      "solver-config-file" : "opta/optacloud/cloudSolverConfig.solver.xml",
      "status" : "NOT_SOLVING"
    }
  }
}</code></pre></div></div><br class="example-break"/></div><div class="section" title="22.7.3. [GET] /containers/{containerId}/solvers/{solverId}"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25458"/>22.7.3. [GET] /containers/{containerId}/solvers/{solverId}</h3></div></div></div><p>Returns the current state of the solver <code class="code">{solverId}</code> in container
    <code class="code">{containerId}</code>.</p><div class="example"><a id="d0e25469"/><p class="title"><strong>Example 22.24. Example Server Response (XStream)</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;org.kie.server.api.model.ServiceResponse&gt;
  &lt;type&gt;SUCCESS&lt;/type&gt;
  &lt;msg&gt;Solver 'solver1' state successfully retrieved from container 'optacloud-kiecontainer-1'&lt;/msg&gt;
  &lt;result class="solver-instance"&gt;
    &lt;container-id&gt;optacloud-kiecontainer-1&lt;/container-id&gt;
    &lt;solver-id&gt;solver1&lt;/solver-id&gt;
    &lt;solver-config-file&gt;opta/optacloud/cloudSolverConfig.solver.xml&lt;/solver-config-file&gt;
    &lt;status&gt;NOT_SOLVING&lt;/status&gt;
  &lt;/result&gt;
&lt;/org.kie.server.api.model.ServiceResponse&gt;</code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e25474"/><p class="title"><strong>Example 22.25. Example Server Response (JSON)</strong></p><div class="example-contents"><pre><code class="language-json">{
  "type" : "SUCCESS",
  "msg" : "Solver 'solver1' state successfully retrieved from container 'optacloud-kiecontainer-1'",
  "result" : {
    "solver-instance" : {
      "container-id" : "optacloud-kiecontainer-1",
      "solver-id" : "solver1",
      "solver-config-file" : "opta/optacloud/cloudSolverConfig.solver.xml",
      "status" : "NOT_SOLVING"
    }
  }
}</code></pre></div></div><br class="example-break"/></div><div class="section" title="22.7.4. [POST] /containers/{containerId}/solvers/{solverId}"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25479"/>22.7.4. [POST] /containers/{containerId}/solvers/{solverId}</h3></div></div></div><p>Updates the state of the {solverId} in container {containerId}, most notably to start solving. The request's
    body is a marshalled <code class="code">SolverInstance</code> and can either request the solver to solve a planning problem or to
    stop solving one. The SolverInstance state determines which operation should be executed and can be set one of two
    possible values:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>SOLVING: starts the solver if it is not executing yet. The request's body must also contain the problem's
        data to be solved.</p></li><li class="listitem"><p>NOT_SOLVING: requests the solver to terminate early, if it is running. All other attributes are
        ignored.</p></li></ul></div><div class="section" title="22.7.4.1. Start solving"><div class="titlepage"><div><div><h4 class="title"><a id="d0e25494"/>22.7.4.1. Start solving</h4></div></div></div><p>For example, to solve an optacloud problem with 2 computers and 1 process:</p><div class="example"><a id="d0e25499"/><p class="title"><strong>Example 22.26. Example Server Request (XStream)</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;solver-instance&gt;
  &lt;status&gt;SOLVING&lt;/status&gt;
  &lt;planning-problem class="opta.optacloud.CloudSolution"&gt;
    &lt;computerList&gt;
      &lt;opta.optacloud.Computer&gt;
        &lt;cpuPower&gt;10&lt;/cpuPower&gt;
        &lt;memory&gt;4&lt;/memory&gt;
        &lt;networkBandwidth&gt;100&lt;/networkBandwidth&gt;
        &lt;cost&gt;1000&lt;/cost&gt;
      &lt;/opta.optacloud.Computer&gt;
      &lt;opta.optacloud.Computer&gt;
        &lt;cpuPower&gt;20&lt;/cpuPower&gt;
        &lt;memory&gt;8&lt;/memory&gt;
        &lt;networkBandwidth&gt;100&lt;/networkBandwidth&gt;
        &lt;cost&gt;3000&lt;/cost&gt;
      &lt;/opta.optacloud.Computer&gt;
    &lt;/computerList&gt;
    &lt;processList&gt;
      &lt;opta.optacloud.Process&gt;
        &lt;requiredCpuPower&gt;1&lt;/requiredCpuPower&gt;
        &lt;requiredMemory&gt;7&lt;/requiredMemory&gt;
        &lt;requiredNetworkBandwidth&gt;1&lt;/requiredNetworkBandwidth&gt;
      &lt;/opta.optacloud.Process&gt;
    &lt;/processList&gt;
  &lt;/planning-problem&gt;
&lt;/solver-instance&gt;</code></pre></div></div><br class="example-break"/><p>Notice that the response does not contain the best solution yet, because solving can take seconds, minutes,
      hours or days and this would time out the HTTP request:</p><div class="example"><a id="d0e25506"/><p class="title"><strong>Example 22.27. Example Server Response (XStream)</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;org.kie.server.api.model.ServiceResponse&gt;
  &lt;type&gt;SUCCESS&lt;/type&gt;
  &lt;msg&gt;Solver 'solver1' from container 'optacloud-kiecontainer-1' successfully updated.&lt;/msg&gt;
  &lt;result class="solver-instance"&gt;
    &lt;container-id&gt;optacloud-kiecontainer-1&lt;/container-id&gt;
    &lt;solver-id&gt;solver1&lt;/solver-id&gt;
    &lt;solver-config-file&gt;opta/optacloud/cloudSolverConfig.solver.xml&lt;/solver-config-file&gt;
    &lt;status&gt;SOLVING&lt;/status&gt;
  &lt;/result&gt;
&lt;/org.kie.server.api.model.ServiceResponse&gt;</code></pre></div></div><br class="example-break"/><p>Instead, it's solving asynchronously and you need to call the bestsolution URL to get the best
      solution.</p></div><div class="section" title="22.7.4.2. Terminate solving"><div class="titlepage"><div><div><h4 class="title"><a id="d0e25513"/>22.7.4.2. Terminate solving</h4></div></div></div><p>For example, to terminate solving:</p><div class="example"><a id="d0e25518"/><p class="title"><strong>Example 22.28. Example Server Request (XStream)</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;solver-instance&gt;
  &lt;status&gt;NOT_SOLVING&lt;/status&gt;
&lt;/solver-instance&gt;</code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e25523"/><p class="title"><strong>Example 22.29. Example Server Response (XStream)</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;org.kie.server.api.model.ServiceResponse&gt;
  &lt;type&gt;SUCCESS&lt;/type&gt;
  &lt;msg&gt;Solver 'solver1' from container 'optacloud-kiecontainer-1' successfully updated.&lt;/msg&gt;
  &lt;result class="solver-instance"&gt;
    &lt;container-id&gt;optacloud-kiecontainer-1&lt;/container-id&gt;
    &lt;solver-id&gt;solver1&lt;/solver-id&gt;
    &lt;solver-config-file&gt;opta/optacloud/cloudSolverConfig.solver.xml&lt;/solver-config-file&gt;
    &lt;status&gt;TERMINATING_EARLY&lt;/status&gt;
    &lt;score class="org.optaplanner.core.api.score.buildin.hardsoft.HardSoftScore"&gt;
      &lt;hardScore&gt;0&lt;/hardScore&gt;
      &lt;softScore&gt;-3000&lt;/softScore&gt;
    &lt;/score&gt;
  &lt;/result&gt;
&lt;/org.kie.server.api.model.ServiceResponse&gt;</code></pre></div></div><br class="example-break"/><p>This doesn't delete the solver, the best solution can still be retrieved.</p></div></div><div class="section" title="22.7.5. [GET] /containers/{containerId}/solvers/{solverId}/bestsolution"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25530"/>22.7.5. [GET] /containers/{containerId}/solvers/{solverId}/bestsolution</h3></div></div></div><p>Returns the best solution found at the time the request is made. If the solver hasn't terminated yet (so the
    <code class="literal">status</code> field is still <code class="literal">SOLVING</code>), it will return the best solution found up to
    then, but later calls can return a better solution.⁠</p><p>For example, the problem submitted above would return this solution, with the process assigned to the second
    computer (because the first one doesn't have enough memory).</p><div class="example"><a id="d0e25543"/><p class="title"><strong>Example 22.30. Example Server Response (XStream)</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;org.kie.server.api.model.ServiceResponse&gt;
  &lt;type&gt;SUCCESS&lt;/type&gt;
  &lt;msg&gt;Best computed solution for 'solver1' successfully retrieved from container 'optacloud-kiecontainer-1'&lt;/msg&gt;
   &lt;result class="solver-instance"&gt;
    &lt;container-id&gt;optacloud-kiecontainer-1&lt;/container-id&gt;
    &lt;solver-id&gt;solver1&lt;/solver-id&gt;
    &lt;solver-config-file&gt;opta/optacloud/cloudSolverConfig.solver.xml&lt;/solver-config-file&gt;
    &lt;status&gt;SOLVING&lt;/status&gt;
    &lt;score class="org.optaplanner.core.api.score.buildin.hardsoft.HardSoftScore"&gt;
      &lt;hardScore&gt;0&lt;/hardScore&gt;
      &lt;softScore&gt;-3000&lt;/softScore&gt;
    &lt;/score&gt;
    &lt;best-solution class="opta.optacloud.CloudSolution"&gt;
      &lt;score class="org.optaplanner.core.api.score.buildin.hardsoft.HardSoftScore" reference="../../score" /&gt;
      &lt;computerList&gt;
        &lt;opta.optacloud.Computer&gt;
          &lt;cpuPower&gt;10&lt;/cpuPower&gt;
          &lt;memory&gt;4&lt;/memory&gt;
          &lt;networkBandwidth&gt;100&lt;/networkBandwidth&gt;
          &lt;cost&gt;1000&lt;/cost&gt;
        &lt;/opta.optacloud.Computer&gt;
        &lt;opta.optacloud.Computer&gt;
          &lt;cpuPower&gt;20&lt;/cpuPower&gt;
          &lt;memory&gt;8&lt;/memory&gt;
          &lt;networkBandwidth&gt;100&lt;/networkBandwidth&gt;
          &lt;cost&gt;3000&lt;/cost&gt;
        &lt;/opta.optacloud.Computer&gt;
      &lt;/computerList&gt;
      &lt;processList&gt;
        &lt;opta.optacloud.Process&gt;
          &lt;requiredCpuPower&gt;1&lt;/requiredCpuPower&gt;
          &lt;requiredMemory&gt;7&lt;/requiredMemory&gt;
          &lt;requiredNetworkBandwidth&gt;1&lt;/requiredNetworkBandwidth&gt;
          &lt;computer reference="../../../computerList/opta.optacloud.Computer[2]" /&gt;
        &lt;/opta.optacloud.Process&gt;
      &lt;/processList&gt;
    &lt;/best-solution&gt;
  &lt;/result&gt;
&lt;/org.kie.server.api.model.ServiceResponse&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="22.7.6. [DELETE] /containers/{containerId}/solvers/{solverId}"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25548"/>22.7.6. [DELETE] /containers/{containerId}/solvers/{solverId}</h3></div></div></div><p>⁠Disposes the solver <code class="code">{solverId}</code> in container <code class="code">{containerId}</code>. If it hasn't terminated
    yet, it terminates it first.</p><div class="example"><a id="d0e25559"/><p class="title"><strong>Example 22.31. Example Server Response (XStream)</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;org.kie.server.api.model.ServiceResponse&gt;
  &lt;type&gt;SUCCESS&lt;/type&gt;
  &lt;msg&gt;Solver 'solver1' successfully disposed from container 'optacloud-kiecontainer-1'&lt;/msg&gt;
&lt;/org.kie.server.api.model.ServiceResponse&gt;</code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e25564"/><p class="title"><strong>Example 22.32. Example Server Response (JSON)</strong></p><div class="example-contents"><pre><code class="language-json">{
  "type" : "SUCCESS",
  "msg" : "Solver 'solver1' successfully disposed from container 'optacloud-kiecontainer-1'"
}</code></pre></div></div><br class="example-break"/></div></div><div class="section" title="22.8. Controller REST API"><div class="titlepage"><div><div><h2 class="title"><a id="d0e25569"/>22.8. Controller REST API</h2></div></div></div><p>When you have Managed Kie Server setup, you need to manage Kie Servers and Containers via a Controller.
        Generally, it's done by workbench UI but you may also use Controller REST API. </p><p>
              </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The controller base URL is provided by kie-wb war deployment, which
                                  would be the same as org.kie.server.controller property.
                                   (for example:
                                          <code class="code">http://localhost:8080/kie-wb/rest/controller</code>
                                   )</p></li><li class="listitem"><p>All requests require basic HTTP Authentication for the role
                                   kie-server as indicated earlier.</p></li></ul></div><p>
       </p><div class="section" title="22.8.1. [GET] /management/servers"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25587"/>22.8.1. [GET] /management/servers</h3></div></div></div><p>Returns a list of Kie Server templates</p><div class="example"><a id="d0e25592"/><p class="title"><strong>Example 22.33. Example Server Response</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;server-template-list&gt;
    &lt;server-template&gt;
        &lt;server-id&gt;demo&lt;/server-id&gt;
        &lt;server-name&gt;demo&lt;/server-name&gt;
        &lt;container-specs&gt;
            &lt;container-id&gt;hr&lt;/container-id&gt;
            &lt;container-name&gt;hr&lt;/container-name&gt;
            &lt;server-template-key&gt;
                &lt;server-id&gt;demo&lt;/server-id&gt;
            &lt;/server-template-key&gt;
            &lt;release-id&gt;
                &lt;artifact-id&gt;HR&lt;/artifact-id&gt;
                &lt;group-id&gt;org.jbpm&lt;/group-id&gt;
                &lt;version&gt;1.0&lt;/version&gt;
            &lt;/release-id&gt;
            &lt;configs&gt;
                &lt;entry&gt;
                    &lt;key&gt;RULE&lt;/key&gt;
                    &lt;value xsi:type="ruleConfig" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
                        &lt;scanner-status&gt;STOPPED&lt;/scanner-status&gt;
                    &lt;/value&gt;
                &lt;/entry&gt;
                &lt;entry&gt;
                    &lt;key&gt;PROCESS&lt;/key&gt;
                    &lt;value xsi:type="processConfig" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
                        &lt;strategy&gt;Singleton&lt;/strategy&gt;
                        &lt;kie-base-name&gt;&lt;/kie-base-name&gt;
                        &lt;kie-session-name&gt;&lt;/kie-session-name&gt;
                        &lt;merge-mode&gt;Merge Collections&lt;/merge-mode&gt;
                    &lt;/value&gt;
                &lt;/entry&gt;
            &lt;/configs&gt;
            &lt;status&gt;STARTED&lt;/status&gt;
        &lt;/container-specs&gt;
        &lt;configs/&gt;
        &lt;server-instances&gt;
            &lt;server-instance-id&gt;demo@localhost:8230&lt;/server-instance-id&gt;
            &lt;server-name&gt;demo@localhost:8230&lt;/server-name&gt;
            &lt;server-template-id&gt;demo&lt;/server-template-id&gt;
            &lt;server-url&gt;http://localhost:8230/kie-server/services/rest/server&lt;/server-url&gt;
        &lt;/server-instances&gt;
        &lt;capabilities&gt;RULE&lt;/capabilities&gt;
        &lt;capabilities&gt;PROCESS&lt;/capabilities&gt;
        &lt;capabilities&gt;PLANNING&lt;/capabilities&gt;
    &lt;/server-template&gt;
&lt;/server-template-list&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="22.8.2. [GET] /management/server/{id}"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25597"/>22.8.2. [GET] /management/server/{id}</h3></div></div></div><p>Returns a Kie Server template</p><div class="example"><a id="d0e25602"/><p class="title"><strong>Example 22.34. Example Server Response</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;server-template-details&gt;
    &lt;server-id&gt;product-demo&lt;/server-id&gt;
    &lt;server-name&gt;product-demo&lt;/server-name&gt;
    &lt;container-specs&gt;
        &lt;container-id&gt;hr&lt;/container-id&gt;
        &lt;container-name&gt;hr&lt;/container-name&gt;
        &lt;server-template-key&gt;
            &lt;server-id&gt;demo&lt;/server-id&gt;
        &lt;/server-template-key&gt;
        &lt;release-id&gt;
            &lt;artifact-id&gt;HR&lt;/artifact-id&gt;
            &lt;group-id&gt;org.jbpm&lt;/group-id&gt;
            &lt;version&gt;1.0&lt;/version&gt;
        &lt;/release-id&gt;
        &lt;configs&gt;
            &lt;entry&gt;
                &lt;key&gt;RULE&lt;/key&gt;
                &lt;value xsi:type="ruleConfig" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
                    &lt;scanner-status&gt;STOPPED&lt;/scanner-status&gt;
                &lt;/value&gt;
            &lt;/entry&gt;
            &lt;entry&gt;
                &lt;key&gt;PROCESS&lt;/key&gt;
                &lt;value xsi:type="processConfig" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
                    &lt;strategy&gt;Singleton&lt;/strategy&gt;
                    &lt;kie-base-name&gt;&lt;/kie-base-name&gt;
                    &lt;kie-session-name&gt;&lt;/kie-session-name&gt;
                    &lt;merge-mode&gt;Merge Collections&lt;/merge-mode&gt;
                &lt;/value&gt;
            &lt;/entry&gt;
        &lt;/configs&gt;
        &lt;status&gt;STARTED&lt;/status&gt;
    &lt;/container-specs&gt;
    &lt;configs/&gt;
    &lt;server-instances&gt;
        &lt;server-instance-id&gt;demo@localhost:8230&lt;/server-instance-id&gt;
        &lt;server-name&gt;demo@localhost:8230&lt;/server-name&gt;
        &lt;server-template-id&gt;demo&lt;/server-template-id&gt;
        &lt;server-url&gt;http://localhost:8230/kie-server/services/rest/server&lt;/server-url&gt;
    &lt;/server-instances&gt;
    &lt;capabilities&gt;RULE&lt;/capabilities&gt;
    &lt;capabilities&gt;PROCESS&lt;/capabilities&gt;
    &lt;capabilities&gt;PLANNING&lt;/capabilities&gt;
&lt;/server-template-details&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="22.8.3. [PUT] /management/server/{id}"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25607"/>22.8.3. [PUT] /management/server/{id}</h3></div></div></div><p>Creates a new Kie Server template with the specified id</p><div class="example"><a id="d0e25612"/><p class="title"><strong>Example 22.35. Example Request to create a new Kie Server template</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;server-template-details&gt;
    &lt;server-id&gt;test-demo&lt;/server-id&gt;
    &lt;server-name&gt;test-demo&lt;/server-name&gt;    
    &lt;configs/&gt;
    &lt;capabilities&gt;RULE&lt;/capabilities&gt;
    &lt;capabilities&gt;PROCESS&lt;/capabilities&gt;
    &lt;capabilities&gt;PLANNING&lt;/capabilities&gt;
&lt;/server-template-details&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="22.8.4. [DELETE] /management/server/{id}"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25617"/>22.8.4. [DELETE] /management/server/{id}</h3></div></div></div><p>Deletes a Kie Server template with the specified id</p></div><div class="section" title="22.8.5. [GET] /management/server/{id}/containers"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25622"/>22.8.5. [GET] /management/server/{id}/containers</h3></div></div></div><p>Returns all containers on given server</p><div class="example"><a id="d0e25627"/><p class="title"><strong>Example 22.36. Example Server Response</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;container-spec-list&gt;
    &lt;container-spec&gt;
        &lt;container-id&gt;hr&lt;/container-id&gt;
        &lt;container-name&gt;hr&lt;/container-name&gt;
        &lt;server-template-key&gt;
            &lt;server-id&gt;demo&lt;/server-id&gt;
        &lt;/server-template-key&gt;
        &lt;release-id&gt;
            &lt;artifact-id&gt;HR&lt;/artifact-id&gt;
            &lt;group-id&gt;org.jbpm&lt;/group-id&gt;
            &lt;version&gt;1.0&lt;/version&gt;
        &lt;/release-id&gt;
        &lt;configs&gt;
            &lt;entry&gt;
                &lt;key&gt;RULE&lt;/key&gt;
                &lt;value xsi:type="ruleConfig" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
                    &lt;scanner-status&gt;STOPPED&lt;/scanner-status&gt;
                &lt;/value&gt;
            &lt;/entry&gt;
            &lt;entry&gt;
                &lt;key&gt;PROCESS&lt;/key&gt;
                &lt;value xsi:type="processConfig" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
                    &lt;strategy&gt;Singleton&lt;/strategy&gt;
                    &lt;kie-base-name&gt;&lt;/kie-base-name&gt;
                    &lt;kie-session-name&gt;&lt;/kie-session-name&gt;
                    &lt;merge-mode&gt;Merge Collections&lt;/merge-mode&gt;
                &lt;/value&gt;
            &lt;/entry&gt;
        &lt;/configs&gt;
        &lt;status&gt;STARTED&lt;/status&gt;
    &lt;/container-spec&gt;
&lt;/container-spec-list&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="22.8.6. [GET] /management/server/{id}/containers/{containerId}"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25632"/>22.8.6. [GET] /management/server/{id}/containers/{containerId}</h3></div></div></div><p>Returns the Container information including its release id and
      configuration</p><div class="example"><a id="d0e25637"/><p class="title"><strong>Example 22.37. Example Server Response</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;container-spec-details&gt;
    &lt;container-id&gt;hr&lt;/container-id&gt;
    &lt;container-name&gt;hr&lt;/container-name&gt;
    &lt;server-template-key&gt;
        &lt;server-id&gt;demo&lt;/server-id&gt;
    &lt;/server-template-key&gt;
    &lt;release-id&gt;
        &lt;artifact-id&gt;HR&lt;/artifact-id&gt;
        &lt;group-id&gt;org.jbpm&lt;/group-id&gt;
        &lt;version&gt;1.0&lt;/version&gt;
    &lt;/release-id&gt;
    &lt;configs&gt;
        &lt;entry&gt;
            &lt;key&gt;PROCESS&lt;/key&gt;
            &lt;value xsi:type="processConfig" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
                &lt;strategy&gt;Singleton&lt;/strategy&gt;
                &lt;kie-base-name&gt;&lt;/kie-base-name&gt;
                &lt;kie-session-name&gt;&lt;/kie-session-name&gt;
                &lt;merge-mode&gt;Merge Collections&lt;/merge-mode&gt;
            &lt;/value&gt;
        &lt;/entry&gt;
        &lt;entry&gt;
            &lt;key&gt;RULE&lt;/key&gt;
            &lt;value xsi:type="ruleConfig" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
                &lt;scanner-status&gt;STOPPED&lt;/scanner-status&gt;
            &lt;/value&gt;
        &lt;/entry&gt;
    &lt;/configs&gt;
    &lt;status&gt;STARTED&lt;/status&gt;
&lt;/container-spec-details&gt;</code></pre></div></div><br class="example-break"/></div><div class="section" title="22.8.7. [PUT] /management/server/{id}/containers/{containerId}"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25642"/>22.8.7. [PUT] /management/server/{id}/containers/{containerId}</h3></div></div></div><p>Creates a new Container with the specified containerId and the given release id
      and optionally configuration</p><div class="example"><a id="d0e25647"/><p class="title"><strong>Example 22.38. Example Server Request</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;container-spec-details&gt;
    &lt;container-id&gt;hr&lt;/container-id&gt;
    &lt;container-name&gt;hr&lt;/container-name&gt;
    &lt;server-template-key&gt;
        &lt;server-id&gt;demo&lt;/server-id&gt;
    &lt;/server-template-key&gt;
    &lt;release-id&gt;
        &lt;artifact-id&gt;HR&lt;/artifact-id&gt;
        &lt;group-id&gt;org.jbpm&lt;/group-id&gt;
        &lt;version&gt;1.0&lt;/version&gt;
    &lt;/release-id&gt;
    &lt;configs&gt;
        &lt;entry&gt;
            &lt;key&gt;PROCESS&lt;/key&gt;
            &lt;value xsi:type="processConfig" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
                &lt;strategy&gt;Singleton&lt;/strategy&gt;
                &lt;kie-base-name&gt;&lt;/kie-base-name&gt;
                &lt;kie-session-name&gt;&lt;/kie-session-name&gt;
                &lt;merge-mode&gt;Merge Collections&lt;/merge-mode&gt;
            &lt;/value&gt;
        &lt;/entry&gt;
        &lt;entry&gt;
            &lt;key&gt;RULE&lt;/key&gt;
            &lt;value xsi:type="ruleConfig" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
                &lt;scanner-status&gt;STOPPED&lt;/scanner-status&gt;
            &lt;/value&gt;
        &lt;/entry&gt;
    &lt;/configs&gt;
    &lt;status&gt;STARTED&lt;/status&gt;
&lt;/container-spec-details</code></pre></div></div><br class="example-break"/></div><div class="section" title="22.8.8. [DELETE] /management/server/{id}/containers/{containerId}"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25652"/>22.8.8. [DELETE] /management/server/{id}/containers/{containerId}</h3></div></div></div><p>Disposes a Container with the specified containerId</p></div><div class="section" title="22.8.9. [POST] /management/server/{id}/containers/{containerId}/status/started"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25657"/>22.8.9. [POST] /management/server/{id}/containers/{containerId}/status/started</h3></div></div></div><p>Starts the Container. No request body required</p></div><div class="section" title="22.8.10. [POST] /management/server/{id}/containers/{containerId}/status/stopped"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25662"/>22.8.10. [POST] /management/server/{id}/containers/{containerId}/status/stopped</h3></div></div></div><p>Stops the Container. No request body required</p></div></div><div class="section" title="22.9. Kie Server Java Client API"><div class="titlepage"><div><div><h2 class="title"><a id="d0e25667"/>22.9. Kie Server Java Client API</h2></div></div></div><p>The Kie Server has a great Java API to wrap REST or JMS requests to be sent to the server. In this section we
  will explore some of the possibilities of this API.</p><div class="section" title="22.9.1. Maven Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25672"/>22.9.1. Maven Configuration</h3></div></div></div><p>if you are a Maven user, make sure you have at least the following dependencies in the project's
    <span class="emphasis"><em>pom.xml</em></span></p><div class="example"><a id="d0e25679"/><p class="title"><strong>Example 22.39. Maven Dependencies</strong></p><div class="example-contents"><pre><code class="no-highlight">&lt;dependency&gt;
  &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
  &lt;artifactId&gt;kie-server-client&lt;/artifactId&gt;
  &lt;version&gt;${kie.api.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- Logging --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
  &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
  &lt;version&gt;1.1.2&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- Drools Commands --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
  &lt;scope&gt;runtime&lt;/scope&gt;
  &lt;version&gt;${kie.api.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre></div></div><br class="example-break"/><p>The version <span class="emphasis"><em>kie.api.version </em></span>depends on the Kie Server version you are using. For jBPM
    6.3, for example, you can use 6.3.1-SNAPSHOT.</p></div><div class="section" title="22.9.2. Client Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25690"/>22.9.2. Client Configuration</h3></div></div></div><p>The client requires a configuration object where you set most of the server communication aspects, such as the
    protocol (REST and JMS) credentials and the payload format (XStream, JAXB and JSON are the supported formats at the
    moment). The first thing to do is create your configuration then create the <span class="bold"><strong><code class="code">KieServicesClient</code></strong></span> object, the entry point for starting the server communication.
    See the source below where we use a REST client configuration:</p><div class="example"><a id="d0e25700"/><p class="title"><strong>Example 22.40. Client Configuration Example</strong></p><div class="example-contents"><pre><code class="language-java">import org.kie.server.api.marshalling.MarshallingFormat;  
import org.kie.server.client.KieServicesClient;  
import org.kie.server.client.KieServicesConfiguration;  
import org.kie.server.client.KieServicesFactory;  
  
public class DecisionServerTest {  
  
    private static final String URL = "http://localhost:8080/kie-server/services/rest/server";  
    private static final String USER = "kieserver";  
    private static final String PASSWORD = "kieserver1!";  
  
    private static final MarshallingFormat FORMAT = MarshallingFormat.JSON;  
  
    private KieServicesConfiguration conf;  
    private KieServicesClient kieServicesClient;  
  
    public void initialize() {  
        conf = KieServicesFactory.newRestConfiguration(URL, USER, PASSWORD);  
        conf.setMarshallingFormat(FORMAT);  
        kieServicesClient = KieServicesFactory.newKieServicesClient(conf);  
    }  </code></pre></div></div><p><br class="example-break"/></p><div class="section" title="22.9.2.1. JMS interaction patterns"><div class="titlepage"><div><div><h4 class="title"><a id="d0e25706"/>22.9.2.1. JMS interaction patterns</h4></div></div></div><p>In version 6.5 KIE Server Client JMS integration has been enhanced with
                possibility to use various interaction patterns. Currently available are:</p><p>
                </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>request reply (which is the default) - that makes the JMS integration
                            synchronous - it blocks client until it gets the response back - not
                            suited for JMS transactional use case</p></li><li class="listitem"><p>fire and forget - makes the integration one way only, suitable for
                            notification like integration with kie server - makes perfect fit for
                            transactional JMS delivery - deliver message to kie server only if
                            transaction that ckie server client was invoked in was committed
                            successfully</p></li><li class="listitem"><p>async with callback - allows to not block a client after sending
                            message to kie server and receive response asynchronously - can be
                            integrated with transactional JMS delivery</p></li></ul></div><p>
            </p><p>Response handlers can be either set globally - when KieServicesConfiguration is
                created or it can be changed on runtime on individual client instances (like
                RuleServiceClient, ProcessServicesClient, etc)</p><p>While 'fire and forget' and 'request reply' patterns do not require any additional
                configuration 'async with callback' does. And the main thing is actually the
                callback. KIE Server CLient comes with one out of the box -
                `BlockingResponseCallback` that provides basic support backed by blocking queue
                internally. Size of the queue is confgurable and thus allow receiving multiple
                messages, though intention of this callback is that it will only receive one message
                at a time - so it's like one message (request) and then one response per client
                interaction.</p><p>
                </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Kie Server Client when switching response handler is not thread safe,
                        meaning change of the handler will affect all threads using same client
                        instance. So in case of dynamic changes of the handler it's recommended to
                        use separate client instances. A good approach is to maintain set of clients
                        that use dedicated response handler and then use these clients dependeing on
                        which handler is required.</p></div><p>
            </p><p><span class="bold"><strong>Example</strong></span></p><p>client 1 will use fire and forget while client 2 will use request reply. So client
                1 can be used to start processes and client 2 can be used to query for user
                tasks.</p><p>Users can provide their own callbacks by implementing <span class="italic">org.kie.server.client.jms.ResponseCallback</span>
                interface.</p><pre><code class="no-highlight">InitialContext context = ...;
Queue requestQueue = (Queue) context.lookup("jms/queue/KIE.SERVER.REQUEST"));
Queue responseQueue = (Queue) context.lookup("jms/queue/KIE.SERVER.RESPONSE");
ConnectionFactory connectionFactory = (ConnectionFactory) context.lookup("jms/RemoteConnectionFactory");
KieServicesConfiguration jmsConfiguration = KieServicesFactory.newJMSConfiguration( connectionFactory, requestQueue, responseQueue, "user", "password");
// here you set response handler globally
jmsConfiguration.setResponseHandler(new FireAndForgetResponseHandler());</code></pre><p>Alternatively, might be actually more common, is to set the handler on individual
                clients before they are used</p><p>
                </p><pre><code class="no-highlight">ProcessServiceClient processClient = client.getServicesClient(ProcessServicesClient.class);
// change response handler for processClient others are not affected
processClient.setResponseHandler(new FireAndForgetResponseHandler());</code></pre><p>
            </p></div></div><div class="section" title="22.9.3. Server Response"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25753"/>22.9.3. Server Response</h3></div></div></div><p>All the service responses are represented by the object
    <code class="code">org.kie.server.api.model.ServiceResponse&lt;T&gt;</code> where T is the type of the payload. It has the
    following attributes:</p><p><span class="bold"><strong>String msg: </strong></span>The response message;</p><p><code class="code">org.kie.server.api.model.ServiceResponse.ResponseType</code><span class="bold"><strong> type:</strong></span> the
    response type enum, which can be SUCCESS or FAILURE;</p><p><span class="bold"><strong>T result: </strong></span>The actual payload of the response, the requested object.</p><p>Notice that this is the same object returned if you are using REST or JMS, in another words it is agnostic to
    protocol.</p></div><div class="section" title="22.9.4. Server Capabilities"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25777"/>22.9.4. Server Capabilities</h3></div></div></div><p>Decision Server initially only supported rules execution, starting in version 6.3 it started supporting
    business process execution. To know what exactly your server support, you can list the server capabilities by
    accessing the object <code class="code">org.kie.server.api.model.KieServerInfo</code><span class="bold"><strong> </strong></span>using the
    client:</p><div class="example"><a id="d0e25788"/><p class="title"><strong>Example 22.41. Listing Server capabilities</strong></p><div class="example-contents"><pre><code class="language-java">public void listCapabilities() {  
    KieServerInfo serverInfo = kieServicesClient.getServerInfo().getResult();  
    System.out.print("Server capabilities:");  
    for(String capability: serverInfo.getCapabilities()) {  
        System.out.print(" " + capability);  
    }  
    System.out.println();  
}</code></pre></div></div><p><br class="example-break"/>If the server supports rules and process, the following should be printed when you run the code
    above:</p><p><span class="emphasis"><em>Server capabilities: BRM KieServer BPM</em></span></p></div><div class="section" title="22.9.5. Kie Containers"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25798"/>22.9.5. Kie Containers</h3></div></div></div><p>If you want to publish a kjar to receive requests, you must publish it in a container. The container is
    represented in the client by the object <code class="code">org.kie.server.api.model.KieContainerResource</code>, and a list of
    resources is <code class="code">org.kie.server.api.model.KieContainerResourceList</code>. Here's an example of how to print a
    list of containers:</p><div class="example"><a id="d0e25809"/><p class="title"><strong>Example 22.42. Listing Kie Containers</strong></p><div class="example-contents"><pre><code class="language-java">public void listContainers() {  
    KieContainerResourceList containersList = kieServicesClient.listContainers().getResult();  
    List&lt;KieContainerResource&gt; kieContainers = containersList.getContainers();  
    System.out.println("Available containers: ");  
    for (KieContainerResource container : kieContainers) {  
        System.out.println("\t" + container.getContainerId() + " (" + container.getReleaseId() + ")");  
    }  
}</code></pre></div></div><p><br class="example-break"/>
      It is also possible to list the containers based on specific <code class="code">ReleaseId</code> (and its individual parts) or container status:
      </p><div class="example"><a id="d0e25819"/><p class="title"><strong>Example 22.43. Listing Kie Containers with custom filter</strong></p><div class="example-contents"><pre><code class="language-java">public void listContainersWithFilter() {
    // the following filter will match only containers with ReleaseId "org.example:contatner:1.0.0.Final" and status FAILED
    KieContainerResourceFilter filter = new KieContainerResourceFilter.Builder()
            .releaseId("org.example", "container", "1.0.0.Final")
            .status(KieContainerStatus.FAILED)
            .build();
    KieContainerResourceList containersList = kieServicesClient.listContainers(filter).getResult();
    List&lt;KieContainerResource&gt; kieContainers = containersList.getContainers();
    System.out.println("Available containers: ");
    for (KieContainerResource container : kieContainers) {
        System.out.println("\t" + container.getContainerId() + " (" + container.getReleaseId() + ")");
    }
}</code></pre></div></div><p><br class="example-break"/>
    </p></div><div class="section" title="22.9.6. Managing Containers"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25826"/>22.9.6. Managing Containers</h3></div></div></div><p>You can use the client to dispose and create containers. If you dispose a containers, a ServiceResponse will
    be returned with Void payload(no payload) and if you create it, the KieContainerResource object itself will be
    returned in the response. Sample code:</p><div class="example"><a id="d0e25831"/><p class="title"><strong>Example 22.44. Disposing and creating containers</strong></p><div class="example-contents"><pre><code class="language-java">public void disposeAndCreateContainer() {  
    System.out.println("== Disposing and creating containers ==");  
    List&lt;KieContainerResource&gt; kieContainers = kieServicesClient.listContainers().getResult().getContainers();  
    if (kieContainers.size() == 0) {  
        System.out.println("No containers available...");  
        return;  
    }  
    KieContainerResource container = kieContainers.get(0);  
    String containerId = container.getContainerId();  
    ServiceResponse&lt;Void&gt; responseDispose = kieServicesClient.disposeContainer(containerId);  
    if (responseDispose.getType() == ResponseType.FAILURE) {  
        System.out.println("Error disposing " + containerId + ". Message: ");  
        System.out.println(responseDispose.getMsg());  
        return;  
    }  
    System.out.println("Success Disposing container " + containerId);  
    System.out.println("Trying to recreate the container...");  
    ServiceResponse&lt;KieContainerResource&gt; createResponse = kieServicesClient.createContainer(containerId, container);  
    if(createResponse.getType() == ResponseType.FAILURE) {  
        System.out.println("Error creating " + containerId + ". Message: ");  
        System.out.println(responseDispose.getMsg());  
        return;  
    }  
     System.out.println("Container recreated with success!");  
}</code></pre></div></div><p><br class="example-break"/></p></div><div class="section" title="22.9.7. Available Clients for the Decision Server"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25837"/>22.9.7. Available Clients for the Decision Server</h3></div></div></div><p>The KieServicesClient is also the entry point for others clients to perform specific operations, such as send
    BRMS commands and manage processes. Currently from the KieServicesClient you can have access to the following
    services available in <code class="code">org.kie.server.client</code> package:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>JobServicesClient: This client allows you to schedule, cancel, requeue and get job requests;</p></li><li class="listitem"><p>ProcessServicesClient: Allows you to start, signal abort process; complete and abort work items among
        other capabilities;</p></li><li class="listitem"><p>QueryServicesClient: The powerful query client allows you to query process, process nodes and process
        variables;</p></li><li class="listitem"><p>RuleServicesClient: The simple, but powerful rules client can be used to send commands to the server to
        perform rules related operations(insert objects in the working memory, fire rules, get globals...);</p></li><li class="listitem"><p>UserTaskServicesClient: Finally, the user tasks clients allows you to perform all operations with an user
        tasks(start, claim, cancel, etc) and query tasks by certain fields(process instances id, user, etc).</p></li></ul></div><p>For further information about these interfaces check github:
    https://github.com/droolsjbpm/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-remote/kie-server-client/src/main/java/org/kie/server/client</p><p>You can have access to any of these clients using the method <code class="code">getServicesClient</code> in the
    KieServicesClient class. For example: <code class="code">RuleServicesClient rulesClient =
    kieServicesClient.getServicesClient(RuleServicesClient.class); </code></p></div><div class="section" title="22.9.8. Sending commands to the server"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25870"/>22.9.8. Sending commands to the server</h3></div></div></div><p>To build commands to the server you must use the class org.kie.api.command.KieCommands, that can be created
    using <code class="code">org.kie.api.KieServices.get().getCommands()</code>. The command to be send must be a <span class="bold"><strong>BatchExecutionCommand</strong></span> or a single command(if a single command is sent, the server wraps it
    into a BatchExecutionCommand):</p><div class="example"><a id="d0e25882"/><p class="title"><strong>Example 22.45. Sending commands to a container</strong></p><div class="example-contents"><pre><code class="language-java">public void executeCommands() {  
    System.out.println("== Sending commands to the server ==");  
    RuleServicesClient rulesClient = kieServicesClient.getServicesClient(RuleServicesClient.class);  
    KieCommands commandsFactory = KieServices.Factory.get().getCommands();  
    Command&lt;?&gt; insert = commandsFactory.newInsert("Some String OBJ");  
    Command&lt;?&gt; fireAllRules = commandsFactory.newFireAllRules();  
    Command&lt;?&gt; batchCommand = commandsFactory.newBatchExecution(Arrays.asList(insert, fireAllRules));  
    ServiceResponse&lt;String&gt; executeResponse = rulesClient.executeCommands("hello", batchCommand);  
    if(executeResponse.getType() == ResponseType.SUCCESS) {  
        System.out.println("Commands executed with success! Response: ");  
        System.out.println(executeResponse.getResult());  
    }  
    else {  
        System.out.println("Error executing rules. Message: ");  
        System.out.println(executeResponse.getMsg());  
    }  
}  </code></pre><p>The result in this case is a String with the command execution result. In our case it will print the
        following:</p><pre><code class="no-highlight">    == Sending commands to the server ==  
    Commands executed with success! Response:   
    {  
      "results" : [ ],  
      "facts" : [ ]  
    }  </code></pre><p><span class="emphasis"><em>* You must add <span class="bold"><strong>org.drools:drools-compiler</strong></span> dependency
        to have this part working</em></span></p></div></div><p><br class="example-break"/></p></div><div class="section" title="22.9.9. Listing available business processes"><div class="titlepage"><div><div><h3 class="title"><a id="d0e25897"/>22.9.9. Listing available business processes</h3></div></div></div><p>To list process definitions we use the QueryClient. The methods of the QueryClient usually uses pagination,
    which means that besides the query you are making, you must also provide the current page and the number of results
    per page. In the code below the query for process definitions from the given container starts on page 0 and list
    1000 results, in another words, the 1000 first results.</p><div class="example"><a id="d0e25903"/><p class="title"><strong>Example 22.46. Listing Business Processes Definitions Example</strong></p><div class="example-contents"><pre><code class="language-java">public void listProcesses() {  
    System.out.println("== Listing Business Processes ==");  
    QueryServicesClient queryClient = kieServicesClient.getServicesClient(QueryServicesClient.class);  
    List&lt;ProcessDefinition&gt; findProcessesByContainerId = queryClient.findProcessesByContainerId("rewards", 0, 1000);  
    for (ProcessDefinition def : findProcessesByContainerId) {  
        System.out.println(def.getName() + " - " + def.getId() + " v" + def.getVersion());  
    }  
} </code></pre></div></div><p><br class="example-break"/></p></div></div></div></div><div class="part" title="Part VII. Drools Examples"><div class="titlepage"><div><div><h1 class="title"><a id="d0e25909"/>Part VII. Drools Examples</h1></div></div></div><div class="partintro" title="Drools Examples"><div/><p>Examples to help you learn Drools</p><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="chapter"><a href="#d0e25915">23. Examples</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e25918">23.1. Getting the Examples</a></span></dt><dt><span class="section"><a href="#d0e25925">23.2. Hello World</a></span></dt><dt><span class="section"><a href="#d0e26213">23.3. State Example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e26218">23.3.1. Understanding the State Example</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e26472">23.4. Fibonacci Example</a></span></dt><dt><span class="section"><a href="#d0e26678">23.5. Banking Tutorial</a></span></dt><dt><span class="section"><a href="#d0e27005">23.6. Pricing Rule Decision Table Example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e27029">23.6.1. Executing the example</a></span></dt><dt><span class="section"><a href="#d0e27071">23.6.2. The decision table</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e27136">23.7. Pet Store Example</a></span></dt><dt><span class="section"><a href="#d0e27716">23.8. Honest Politician Example</a></span></dt><dt><span class="section"><a href="#d0e27845">23.9. Sudoku Example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e27866">23.9.1. Sudoku Overview</a></span></dt><dt><span class="section"><a href="#d0e27880">23.9.2. Running the Example</a></span></dt><dt><span class="section"><a href="#d0e27953">23.9.3. Java Source and Rules Overview</a></span></dt><dt><span class="section"><a href="#d0e28083">23.9.4. Sudoku Validator Rules (validate.drl)</a></span></dt><dt><span class="section"><a href="#d0e28092">23.9.5. Sudoku Solving Rules (sudoku.drl)</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e28128">23.10. Number Guess</a></span></dt><dt><span class="section"><a href="#d0e28419">23.11. Conway's Game Of Life</a></span></dt><dt><span class="section"><a href="#d0e28568">23.12. Invaders</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e28601">23.12.1. Invaders1Main</a></span></dt><dt><span class="section"><a href="#d0e28613">23.12.2. Invaders2Main</a></span></dt><dt><span class="section"><a href="#d0e28623">23.12.3. Invaders3Main</a></span></dt><dt><span class="section"><a href="#d0e28633">23.12.4. Invaders4Main</a></span></dt><dt><span class="section"><a href="#d0e28643">23.12.5. Invaders5Main</a></span></dt><dt><span class="section"><a href="#d0e28648">23.12.6. Invaders6Main</a></span></dt><dt><span class="section"><a href="#d0e28653">23.12.7. Invaders4Main</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e28663">23.13. Adventures with Drools</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e28691">23.13.1. Using the game.</a></span></dt><dt><span class="section"><a href="#d0e28725">23.13.2. The code</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e28763">23.14. Pong</a></span></dt><dt><span class="section"><a href="#d0e28781">23.15. Wumpus World</a></span></dt><dt><span class="section"><a href="#d0e28828">23.16. Miss Manners and Benchmarking</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e28850">23.16.1. Introduction</a></span></dt><dt><span class="section"><a href="#d0e28936">23.16.2. In depth Discussion</a></span></dt><dt><span class="section"><a href="#d0e29146">23.16.3. Output Summary</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e29201">23.17. Backward-Chaining</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e29215">23.17.1. Backward-Chaining Systems</a></span></dt><dt><span class="section"><a href="#d0e29220">23.17.2. Cloning Transitive Closures</a></span></dt><dt><span class="section"><a href="#d0e29250">23.17.3. Defining a Query</a></span></dt><dt><span class="section"><a href="#d0e29275">23.17.4. Transitive Closure Example</a></span></dt><dt><span class="section"><a href="#d0e29347">23.17.5. Reactive Transitive Queries</a></span></dt><dt><span class="section"><a href="#d0e29372">23.17.6. Queries with Unbound Arguments</a></span></dt><dt><span class="section"><a href="#d0e29391">23.17.7. Multiple Unbound Arguments</a></span></dt></dl></dd></dl></dd></dl></div></div><div class="chapter" title="Chapter 23. Examples"><div class="titlepage"><div><div><h2 class="title"><a id="d0e25915"/>Chapter 23. Examples</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e25918">23.1. Getting the Examples</a></span></dt><dt><span class="section"><a href="#d0e25925">23.2. Hello World</a></span></dt><dt><span class="section"><a href="#d0e26213">23.3. State Example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e26218">23.3.1. Understanding the State Example</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e26472">23.4. Fibonacci Example</a></span></dt><dt><span class="section"><a href="#d0e26678">23.5. Banking Tutorial</a></span></dt><dt><span class="section"><a href="#d0e27005">23.6. Pricing Rule Decision Table Example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e27029">23.6.1. Executing the example</a></span></dt><dt><span class="section"><a href="#d0e27071">23.6.2. The decision table</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e27136">23.7. Pet Store Example</a></span></dt><dt><span class="section"><a href="#d0e27716">23.8. Honest Politician Example</a></span></dt><dt><span class="section"><a href="#d0e27845">23.9. Sudoku Example</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e27866">23.9.1. Sudoku Overview</a></span></dt><dt><span class="section"><a href="#d0e27880">23.9.2. Running the Example</a></span></dt><dt><span class="section"><a href="#d0e27953">23.9.3. Java Source and Rules Overview</a></span></dt><dt><span class="section"><a href="#d0e28083">23.9.4. Sudoku Validator Rules (validate.drl)</a></span></dt><dt><span class="section"><a href="#d0e28092">23.9.5. Sudoku Solving Rules (sudoku.drl)</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e28128">23.10. Number Guess</a></span></dt><dt><span class="section"><a href="#d0e28419">23.11. Conway's Game Of Life</a></span></dt><dt><span class="section"><a href="#d0e28568">23.12. Invaders</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e28601">23.12.1. Invaders1Main</a></span></dt><dt><span class="section"><a href="#d0e28613">23.12.2. Invaders2Main</a></span></dt><dt><span class="section"><a href="#d0e28623">23.12.3. Invaders3Main</a></span></dt><dt><span class="section"><a href="#d0e28633">23.12.4. Invaders4Main</a></span></dt><dt><span class="section"><a href="#d0e28643">23.12.5. Invaders5Main</a></span></dt><dt><span class="section"><a href="#d0e28648">23.12.6. Invaders6Main</a></span></dt><dt><span class="section"><a href="#d0e28653">23.12.7. Invaders4Main</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e28663">23.13. Adventures with Drools</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e28691">23.13.1. Using the game.</a></span></dt><dt><span class="section"><a href="#d0e28725">23.13.2. The code</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e28763">23.14. Pong</a></span></dt><dt><span class="section"><a href="#d0e28781">23.15. Wumpus World</a></span></dt><dt><span class="section"><a href="#d0e28828">23.16. Miss Manners and Benchmarking</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e28850">23.16.1. Introduction</a></span></dt><dt><span class="section"><a href="#d0e28936">23.16.2. In depth Discussion</a></span></dt><dt><span class="section"><a href="#d0e29146">23.16.3. Output Summary</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e29201">23.17. Backward-Chaining</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e29215">23.17.1. Backward-Chaining Systems</a></span></dt><dt><span class="section"><a href="#d0e29220">23.17.2. Cloning Transitive Closures</a></span></dt><dt><span class="section"><a href="#d0e29250">23.17.3. Defining a Query</a></span></dt><dt><span class="section"><a href="#d0e29275">23.17.4. Transitive Closure Example</a></span></dt><dt><span class="section"><a href="#d0e29347">23.17.5. Reactive Transitive Queries</a></span></dt><dt><span class="section"><a href="#d0e29372">23.17.6. Queries with Unbound Arguments</a></span></dt><dt><span class="section"><a href="#d0e29391">23.17.7. Multiple Unbound Arguments</a></span></dt></dl></dd></dl></div><div class="section" title="23.1. Getting the Examples"><div class="titlepage"><div><div><h2 class="title"><a id="d0e25918"/>23.1. Getting the Examples</h2></div></div></div><p>Make sure the Drools Eclipse plugin is installed, which
      needs the Graphical Editing Framework (GEF) dependency installed
                        first. Then download and extract the
      drools-examples zip file, which includes an already created Eclipse
      project. Import that project into a new Eclipse workspace. The rules
      all have example classes that execute the rules. If you want to try
      the examples in another project (or another IDE) then you will need
      to set up the dependencies by hand, of course. Many, but not all of the
      examples are documented below, enjoy!</p><p>Some examples require Java 1.6 to run.</p></div><div class="section" title="23.2. Hello World"><div class="titlepage"><div><div><h2 class="title"><a id="d0e25925"/>23.2. Hello World</h2></div></div></div><pre class="screen"><span class="bold"><strong>Name:</strong></span> Hello World
<span class="bold"><strong>Main class:</strong></span> org.drools.examples.helloworld.HelloWorldExample
<span class="bold"><strong>Module:</strong></span> drools-examples
<span class="bold"><strong>Type:</strong></span> Java application
<span class="bold"><strong>Rules file:</strong></span> HelloWorld.drl
<span class="bold"><strong>Objective:</strong></span> demonstrate basic rules in use</pre><p>The "Hello World" example shows a simple application using rules, written both using the MVEL and the Java
    dialects.</p><p>This example demonstrates how to create and use a <code class="code">KieSession</code>. Also, audit logging and debug outputs
    are shown, which is omitted from other examples as it's all very similar. </p><p>The following code snippet shows how the session is created with only 3 lines of code. </p><div class="example"><a id="d0e25956"/><p class="title"><strong>Example 23.1. HelloWorld: Creating the KieSession</strong></p><div class="example-contents"><pre><code class="language-java">        KieServices ks = KieServices.Factory.get();<a class="co" id="co.helloworld.pl.1" href="#helloworld.pl.1"><img src="images/callouts/1.png" alt="1" border="0"/></a>
        KieContainer kc = ks.getKieClasspathContainer();<a class="co" id="co.helloworld.pl.2" href="#helloworld.pl.2"><img src="images/callouts/2.png" alt="2" border="0"/></a>
        KieSession ksession = kc.newKieSession("HelloWorldKS");<a class="co" id="co.helloworld.pl.3" href="#helloworld.pl.3"><img src="images/callouts/3.png" alt="3" border="0"/></a> </code></pre></div></div><br class="example-break"/><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a id="helloworld.pl.1"/><a href="#co.helloworld.pl.1"><img src="images/callouts/1.png" alt="1" border="0"/></a> </p></td><td valign="top" align="left"><p>Obtains the <code class="code">KieServices</code> factory. This is the main interface applications use to interact with
        the engine.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a id="helloworld.pl.2"/><a href="#co.helloworld.pl.2"><img src="images/callouts/2.png" alt="2" border="0"/></a> </p></td><td valign="top" align="left"><p>Creates a <code class="code">KieContainer</code> from the project classpath. This will look for a
          <code class="filename">/META-INF/kmodule.xml</code> file to configure and instantiate the <code class="code">KieModule</code> into
        the <code class="code">KieContainer</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a id="helloworld.pl.3"/><a href="#co.helloworld.pl.3"><img src="images/callouts/3.png" alt="3" border="0"/></a> </p></td><td valign="top" align="left"><p>Creates a session based on the named "HelloWorldKS" session configuration.</p></td></tr></table></div><p>Drools has an event model that exposes much of what's happening internally. Two default debug listeners are
    supplied, <code class="code">DebugAgendaEventListener</code> and <code class="code">DebugWorkingMemoryEventListener</code> which print out
    debug event information to the <code class="code">System.err</code> stream displayed in the Console window. Adding listeners to a
    Session is trivial, as shown in the next snippet. The <code class="code">KieRuntimeLogger</code> provides execution auditing, the
    result of which can be viewed in a graphical viewer. The logger is actually a specialised implementation built on
    the <code class="code">Agenda</code> and <code class="code">RuleRuntime</code> listeners. When the engine has finished executing,
      <code class="code">logger.close()</code> must be called.</p><p>Most of the examples use the Audit logging features of Drools to
  record execution flow for later inspection.</p><div class="example"><a id="d0e26017"/><p class="title"><strong>Example 23.2. HelloWorld: Event logging and Auditing</strong></p><div class="example-contents"><pre><code class="language-java">        // The application can also setup listeners
        ksession.addEventListener( new DebugAgendaEventListener() );
        ksession.addEventListener( new DebugRuleRuntimeEventListener() );

        // To setup a file based audit logger, uncomment the next line 
        // KieRuntimeLogger logger = ks.getLoggers().newFileLogger( ksession, "./helloworld" );
        
        // To setup a ThreadedFileLogger, so that the audit view reflects events whilst debugging,
        // uncomment the next line
        // KieRuntimeLogger logger = ks.getLoggers().newThreadedFileLogger( ksession, "./helloworld", 1000 );</code></pre></div></div><br class="example-break"/><p>The single class used in this example is very simple. It has two fields: the message, which is a
      <code class="code">String</code> and the status which can be one of the two integers <code class="code">HELLO</code> or
    <code class="code">GOODBYE</code>.</p><div class="example"><a id="d0e26033"/><p class="title"><strong>Example 23.3. HelloWorld example: Message Class</strong></p><div class="example-contents"><pre><code class="language-java">public static class Message {
    public static final int HELLO   = 0;
    public static final int GOODBYE = 1;

    private String          message;
    private int             status; 
    ...
}</code></pre></div></div><br class="example-break"/><p>A single <code class="code">Message</code> object is created with the message text "Hello World" and the status
      <code class="code">HELLO</code> and then inserted into the engine, at which point <code class="code">fireAllRules()</code> is executed. </p><div class="example"><a id="d0e26049"/><p class="title"><strong>Example 23.4. HelloWorld: Execution</strong></p><div class="example-contents"><pre><code class="language-java">        // The application can insert facts into the session
        final Message message = new Message();
        message.setMessage( "Hello World" );
        message.setStatus( Message.HELLO );
        ksession.insert( message );

        // and fire the rules
        ksession.fireAllRules();</code></pre></div></div><br class="example-break"/><p>To execute the example as a Java application:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Open the class <code class="code">org.drools.examples.helloworld.HelloWorldExample</code> in your Eclipse IDE</p></li><li class="listitem"><p>Right-click the class and select "Run as..." and then "Java
      application"</p></li></ol></div><p>If we put a breakpoint on the <code class="code">fireAllRules()</code> method and select the <code class="code">ksession</code> variable,
    we can see that the "Hello World" rule is already activate on the Agenda.</p><div class="figure"><a id="d0e26074"/><p class="title"><strong>Figure 23.1. Hello World: fireAllRules Agenda View</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/HelloWorldExample/helloworld_agenda1.png" alt="Hello World: fireAllRules Agenda View"/></div></div></div><br class="figure-break"/><p>The application print outs go to to <code class="code">System.out</code> while the debug listener print outs go to
      <code class="code">System.err</code>.</p><div class="example"><a id="d0e26088"/><p class="title"><strong>Example 23.5. HelloWorld: System.out in the Console window</strong></p><div class="example-contents"><pre><code class="no-highlight">Hello World
Goodbye cruel world</code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e26093"/><p class="title"><strong>Example 23.6. HelloWorld: System.err in the Console window</strong></p><div class="example-contents"><pre><code class="no-highlight">==&gt;[ActivationCreated(0): rule=Hello World; 
                   tuple=[fid:1:1:org.drools.examples.helloworld.HelloWorldExample$Message@17cec96]]
[ObjectInserted: handle=[fid:1:1:org.drools.examples.helloworld.HelloWorldExample$Message@17cec96];
                 object=org.drools.examples.helloworld.HelloWorldExample$Message@17cec96]
[BeforeActivationFired: rule=Hello World; 
                   tuple=[fid:1:1:org.drools.examples.helloworld.HelloWorldExample$Message@17cec96]]
==&gt;[ActivationCreated(4): rule=Good Bye; 
                   tuple=[fid:1:2:org.drools.examples.helloworld.HelloWorldExample$Message@17cec96]]
[ObjectUpdated: handle=[fid:1:2:org.drools.examples.helloworld.HelloWorldExample$Message@17cec96];
                old_object=org.drools.examples.helloworld.HelloWorldExample$Message@17cec96;
                new_object=org.drools.examples.helloworld.HelloWorldExample$Message@17cec96]
[AfterActivationFired(0): rule=Hello World]
[BeforeActivationFired: rule=Good Bye; 
                   tuple=[fid:1:2:org.drools.examples.helloworld.HelloWorldExample$Message@17cec96]]
[AfterActivationFired(4): rule=Good Bye]  </code></pre></div></div><br class="example-break"/><p>The actual rules are inside the file
      <code class="filename">src/main/resources/org/drools/examples/helloworld/HelloWorld.drl</code>:</p><div class="example"><a id="d0e26103"/><p class="title"><strong>Example 23.7. HelloWorld: rule "Hello World"</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Hello World"
      dialect "mvel"
  when
      m : Message( status == Message.HELLO, message : message )
  then
      System.out.println( message ); 
      modify ( m ) { message = "Goodbye cruel world",
                     status = Message.GOODBYE };
end</code></pre></div></div><br class="example-break"/><p>The LHS (after <code class="literal">when</code>) section of the rule states that it will be activated for each
      <code class="code">Message</code> object inserted into the Rule Runtime whose status is <code class="code">Message.HELLO</code>. Besides
    that, two variable bindings are created: the variable <code class="code">message</code> is bound to the <code class="code">message</code>
    attribute and the variable <code class="code">m</code> is bound to the matched <code class="code">Message</code> object itself.</p><p>The RHS (after <code class="literal">then</code>) or consequence part of the rule is written using the MVEL expression
    language, as declared by the rule's attribute <code class="code">dialect</code>. After printing the content of the bound variable
      <code class="code">message</code> to <code class="code">System.out</code>, the rule changes the values of the <code class="code">message</code> and
      <code class="code">status</code> attributes of the <code class="code">Message</code> object bound to <code class="code">m</code>. This is done using
    MVEL's <code class="literal">modify</code> statement, which allows you to apply a block of assignments in one statement, with
    the engine being automatically notified of the changes at the end of the block.</p><p>It is possible to set a breakpoint into the DRL, on the <code class="literal">modify</code> call, and inspect the Agenda
    view again during the execution of the rule's consequence. This time we start the execution via "Debug As" and
    "Drools application" and not by running a "Java application":</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Open the class <code class="code">org.drools.examples.HelloWorld</code> in your
      Eclipse IDE.</p></li><li class="listitem"><p>Right-click the class and select "Debug as..." and then "Drools
      application".</p></li></ol></div><p>Now we can see that the other rule <code class="code">"Good Bye"</code>, which
  uses the Java dialect, is activated and placed on the Agenda.</p><div class="figure"><a id="d0e26180"/><p class="title"><strong>Figure 23.2. Hello World: rule "Hello World" Agenda View</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/HelloWorldExample/helloworld_agenda2.png" alt="Hello World: rule &#34;Hello World&#34; Agenda View"/></div></div></div><br class="figure-break"/><p>The "Good Bye" rule, which specifies the "java" dialect, is similar
  to the "Hello World" rule except that it matches <code class="code">Message</code>
  objects whose  status is <code class="code">Message.GOODBYE</code>.</p><div class="example"><a id="d0e26194"/><p class="title"><strong>Example 23.8. HelloWorld: rule "Good Bye"</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Good Bye"
      dialect "java"
  when
      Message( status == Message.GOODBYE, message : message )
  then
      System.out.println( message ); 
end</code></pre></div></div><br class="example-break"/><p>The Java code that instantiates the <code class="code">KieRuntimeLogger</code> creates an audit log file that can be loaded
    into the Audit view. The Audit view is used in many of the examples to demonstrate the example execution flow. In
    the view screen shot below we can see that the object is inserted, which creates an activation for the "Hello World"
    rule; the activation is then executed which updates the <code class="code">Message</code> object causing the "Good Bye" rule to
    activate; finally the "Good Bye" rule also executes. Selecting an event in the Audit view highlights the origin
    event in green; therefore the "Activation created" event is highlighted in green as the origin of the "Activation
    executed" event.</p><div class="figure"><a id="d0e26207"/><p class="title"><strong>Figure 23.3. Hello World: Audit View</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/HelloWorldExample/helloworld_auditview1.png" alt="Hello World: Audit View"/></div></div></div><br class="figure-break"/></div><div class="section" title="23.3. State Example"><div class="titlepage"><div><div><h2 class="title"><a id="d0e26213"/>23.3. State Example</h2></div></div></div><p>This example is implemented in two different versions to demonstrate different ways of implementing the same
    basic behavior: forward chaining, i.e., the ability the engine has to evaluate, activate and fire rules in sequence,
    based on changes on the facts in the Working Memory.</p><div class="section" title="23.3.1. Understanding the State Example"><div class="titlepage"><div><div><h3 class="title"><a id="d0e26218"/>23.3.1. Understanding the State Example</h3></div></div></div><pre class="screen"><span class="bold"><strong>Name:</strong></span> State Example
<span class="bold"><strong>Main class:</strong></span> org.drools.examples.state.StateExampleUsingSalience
<span class="bold"><strong>Module:</strong></span> drools-examples
<span class="bold"><strong>Type:</strong></span> Java application
<span class="bold"><strong>Rules file:</strong></span> StateExampleUsingSalience.drl
<span class="bold"><strong>Objective:</strong></span> Demonstrates basic rule use and Conflict Resolution for rule firing priority.</pre><p>Each <code class="code">State</code> class has fields for its name and its current state (see the class
        <code class="code">org.drools.examples.state.State</code>). The two possible states for each objects are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="code">NOTRUN</code></p></li><li class="listitem"><p><code class="code">FINISHED</code></p></li></ul></div><div class="example"><a id="d0e26257"/><p class="title"><strong>Example 23.9. State Class</strong></p><div class="example-contents"><pre><code class="language-java">public class State {
    public static final int NOTRUN   = 0;
    public static final int FINISHED = 1;

    private final PropertyChangeSupport changes =
        new PropertyChangeSupport( this );

    private String name;
    private int    state;

    ... setters and getters go here...
}</code></pre></div></div><br class="example-break"/><p>Ignoring the <code class="code">PropertyChangeSupport</code>, which will be explained later, we see the creation of four
        <code class="code">State</code> objects named A, B, C and D. Initially their states are set to <code class="code">NOTRUN</code>, which is
      default for the used constructor. Each instance is asserted in turn into the Session and then
        <code class="code">fireAllRules()</code> is called.</p><div class="example"><a id="d0e26276"/><p class="title"><strong>Example 23.10. Salience State: Execution</strong></p><div class="example-contents"><pre><code class="language-java">        final State a = new State( "A" );
        final State b = new State( "B" );
        final State c = new State( "C" );
        final State d = new State( "D" );

        ksession.insert( a );
        ksession.insert( b );
        ksession.insert( c );
        ksession.insert( d );

        ksession.fireAllRules();

        ksession.dispose(); // Stateful rule session must always be disposed when finished  </code></pre></div></div><br class="example-break"/><p>To execute the application:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Open the class <code class="code">org.drools.examples.state.StateExampleUsingSalience</code> in your Eclipse
          IDE.</p></li><li class="listitem"><p>Right-click the class and select "Run as..." and then "Java application"</p></li></ol></div><p>You will see the following output in the Eclipse console window:</p><div class="example"><a id="d0e26295"/><p class="title"><strong>Example 23.11. Salience State: Console Output</strong></p><div class="example-contents"><pre><code class="no-highlight">A finished
B finished
C finished
D finished
</code></pre></div></div><br class="example-break"/><p>There are four rules in total. First, the <code class="code">Bootstrap</code> rule fires, setting A to state
        <code class="code">FINISHED</code>, which then causes B to change its state to <code class="code">FINISHED</code>. C and D are both
      dependent on B, causing a conflict which is resolved by the salience values. Let's look at the way this was
      executed.</p><p>The best way to understand what is happening is to use the Audit Logging feature to graphically see the
      results of each operation. To view the Audit log generated by a run of this example:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>If the Audit View is not visible, click on "Window" and then select "Show View", then "Other..." and
          "Drools" and finally "Audit View".</p></li><li class="listitem"><p>In the "Audit View" click the "Open Log" button and select the file
          "&lt;drools-examples-dir&gt;/log/state.log".</p></li></ol></div><p>After that, the "Audit view" will look like the following screenshot:</p><div class="figure"><a id="d0e26322"/><p class="title"><strong>Figure 23.4. Salience State Example Audit View</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/StateExample/state_example_audit1.png" alt="Salience State Example Audit View"/></div></div></div><br class="figure-break"/><p>Reading the log in the "Audit View", top to bottom, we see every action and the corresponding changes in the
      Working Memory. This way we observe that the assertion of the State object A in the state <code class="code">NOTRUN</code>
      activates the <code class="code">Bootstrap</code> rule, while the assertions of the other <code class="code">State</code> objects have no
      immediate effect.</p><div class="example"><a id="d0e26339"/><p class="title"><strong>Example 23.12. Salience State: Rule "Bootstrap"</strong></p><div class="example-contents"><pre><code class="no-highlight">rule Bootstrap
    when
        a : State(name == "A", state == State.NOTRUN )
    then
        System.out.println(a.getName() + " finished" );
        a.setState( State.FINISHED );
end</code></pre></div></div><br class="example-break"/><p>The execution of rule Bootstrap changes the state of A to <code class="code">FINISHED</code>, which, in turn, activates
      rule "A to B".</p><div class="example"><a id="d0e26349"/><p class="title"><strong>Example 23.13. Salience State: Rule "A to B"</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "A to B"
    when
        State(name == "A", state == State.FINISHED )
        b : State(name == "B", state == State.NOTRUN )
    then
        System.out.println(b.getName() + " finished" );
        b.setState( State.FINISHED );
end
</code></pre></div></div><br class="example-break"/><p>The execution of rule "A to B" changes the state of B to <code class="code">FINISHED</code>, which activates both, rules "B
      to C" and "B to D", placing their Activations onto the Agenda. From this moment on, both rules may fire and,
      therefore, they are said to be "in conflict". The conflict resolution strategy allows the engine's Agenda to
      decide which rule to fire. As rule "B to C" has the <span class="bold"><strong>higher salience value</strong></span> (10
      versus the default salience value of 0), it fires first, modifying object C to state <code class="code">FINISHED</code>. The
      Audit view shown above reflects the modification of the <code class="code">State</code> object in the rule "A to B", which
      results in two activations being in conflict. The Agenda view can also be used to investigate the state of the
      Agenda, with debug points being placed in the rules themselves and the Agenda view opened. The screen shot below
      shows the breakpoint in the rule "A to B" and the state of the Agenda with the two conflicting rules.</p><div class="figure"><a id="d0e26368"/><p class="title"><strong>Figure 23.5. State Example Agenda View</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/StateExample/state_example_agenda1.png" alt="State Example Agenda View"/></div></div></div><br class="figure-break"/><div class="example"><a id="d0e26374"/><p class="title"><strong>Example 23.14. Salience State: Rule "B to C"</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "B to C"
        salience 10
    when
        State(name == "B", state == State.FINISHED )
        c : State(name == "C", state == State.NOTRUN )
    then
        System.out.println(c.getName() + " finished" );
        c.setState( State.FINISHED );
end
</code></pre></div></div><br class="example-break"/><p>Rule "B to D" fires last, modifying object D to state <code class="code">FINISHED</code>.</p><div class="example"><a id="d0e26384"/><p class="title"><strong>Example 23.15. Salience State: Rule "B to D"</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "B to D"
    when
        State(name == "B", state == State.FINISHED )
        d : State(name == "D", state == State.NOTRUN )
    then
        System.out.println(d.getName() + " finished" );
        d.setState( State.FINISHED );
end</code></pre></div></div><br class="example-break"/><p>There are no more rules to execute and so the engine stops.</p><p>Another notable concept in this example is the use of <span class="emphasis"><em>dynamic facts</em></span>, based on
        <code class="code">PropertyChangeListener</code> objects. As described in the documentation, in order for the engine to see
      and react to changes of fact properties, the application must tell the engine that changes occurred. This can be
      done explicitly in the rules by using the <code class="literal">modify</code> statement, or implicitly by letting the engine
      know that the facts implement <code class="code">PropertyChangeSupport</code> as defined by the <span class="emphasis"><em>JavaBeans
        specification</em></span>. This example demonstrates how to use <code class="code">PropertyChangeSupport</code> to avoid the
      need for explicit <code class="literal">modify</code> statements in the rules. To make use of this feature, ensure that your
      facts implement <code class="code">PropertyChangeSupport</code>, the same way the class <code class="code">org.drools.example.State</code>
      does, and use the following code in the rules file to configure the engine to listen for property changes on those
      facts:</p><div class="example"><a id="d0e26420"/><p class="title"><strong>Example 23.16. Declaring a Dynamic Fact</strong></p><div class="example-contents"><pre><code class="language-java">declare type State
    @propertyChangeSupport
end</code></pre></div></div><br class="example-break"/><p>When using <code class="code">PropertyChangeListener</code> objects, each setter must implement a little extra code for the
      notification. Here is the setter for <code class="code">state</code> in the class <code class="code">org.drools.examples</code>:</p><div class="example"><a id="d0e26436"/><p class="title"><strong>Example 23.17. Setter Example with PropertyChangeSupport</strong></p><div class="example-contents"><pre><code class="language-java">public void setState(final int newState) {
    int oldState = this.state;
    this.state = newState;
    this.changes.firePropertyChange( "state",
                                     oldState,
                                     newState );
}</code></pre></div></div><br class="example-break"/><p>There are another class in this example: <code class="code">StateExampleUsingAgendaGroup</code>. It executes from A to B to
      C to D, as just shown, but <code class="code">StateExampleUsingAgendaGroup</code> uses agenda-groups to control the rule
      conflict and which one fires first. </p><p>Agenda groups are a way to partition the Agenda into groups and to control which groups can execute. By
      default, all rules are in the agenda group "MAIN". The "agenda-group" attribute lets you specify a different
      agenda group for the rule. Initially, a Working Memory has its focus on the Agenda group "MAIN". A group's rules
      will only fire when the group receives the focus. This can be achieved either ny using the method by
        <code class="code">setFocus()</code> or the rule attribute <code class="literal">auto-focus</code>. "auto-focus" means that the rule
      automatically sets the focus to its agenda group when the rule is matched and activated. It is this "auto-focus"
      that enables rule "B to C" to fire before "B to D".</p><div class="example"><a id="d0e26457"/><p class="title"><strong>Example 23.18. Agenda Group State Example: Rule "B to C"</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "B to C"
      agenda-group "B to C"
      auto-focus true       
  when
      State(name == "B", state == State.FINISHED )      
      c : State(name == "C", state == State.NOTRUN )
  then
      System.out.println(c.getName() + " finished" );
      c.setState( State.FINISHED );
      kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup( "B to D" ).setFocus();
end</code></pre></div></div><br class="example-break"/><p>The rule "B to C" calls <code class="code">setFocus()</code> on the agenda group "B to D", allowing its active rules to
      fire, which allows the rule "B to D" to fire.</p><div class="example"><a id="d0e26467"/><p class="title"><strong>Example 23.19. Agenda Group State Example: Rule "B to D"</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "B to D"
      agenda-group "B to D"
  when
      State(name == "B", state == State.FINISHED )      
      d : State(name == "D", state == State.NOTRUN )
  then
      System.out.println(d.getName() + " finished" );
      d.setState( State.FINISHED );
end</code></pre></div></div><br class="example-break"/></div></div><div class="section" title="23.4. Fibonacci Example"><div class="titlepage"><div><div><h2 class="title"><a id="d0e26472"/>23.4. Fibonacci Example</h2></div></div></div><pre class="screen"><span class="bold"><strong>Name:</strong></span> Fibonacci 
<span class="bold"><strong>Main class:</strong></span> org.drools.examples.fibonacci.FibonacciExample
<span class="bold"><strong>Module:</strong></span> drools-examples
<span class="bold"><strong>Type:</strong></span> Java application
<span class="bold"><strong>Rules file:</strong></span> Fibonacci.drl
<span class="bold"><strong>Objective:</strong></span> Demonstrates Recursion,
  the CE <code class="literal">not</code> and cross product matching</pre><p>The Fibonacci Numbers (see <a class="link" href="http://en.wikipedia.org/wiki/Fibonacci_number">http://en.wikipedia.org/wiki/Fibonacci_number</a>)
      discovered by Leonardo of Pisa (see <a class="link" href="http://en.wikipedia.org/wiki/Fibonacci">http://en.wikipedia.org/wiki/Fibonacci</a>) is a sequence 
    that starts with 0 and 1. The next Fibonacci number is obtained by adding
    the two preceding Fibonacci numbers. The Fibonacci sequence begins with
    0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597,
    2584, 4181, 6765, 10946,... The Fibonacci Example demonstrates recursion
    and conflict resolution with salience values.</p><p>The single fact class <code class="code">Fibonacci</code> is used in this
    example. It has two fields, sequence and value. The sequence field
    is used to indicate the position of the object in the Fibonacci
    number sequence. The value field shows the value of that
    Fibonacci object for that sequence position, using -1 to indicate
    a value that still needs to be computed.</p><div class="example"><a id="d0e26510"/><p class="title"><strong>Example 23.20. Fibonacci Class</strong></p><div class="example-contents"><pre><code class="language-java">public static class Fibonacci {
    private int  sequence;
    private long value;

    public Fibonacci( final int sequence ) {
        this.sequence = sequence;
        this.value = -1;
    }

    ... setters and getters go here...
}</code></pre></div></div><br class="example-break"/><p>Execute the example:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Open the class <code class="classname">org.drools.examples.fibonacci.FibonacciExample</code> in your Eclipse IDE.</p></li><li class="listitem"><p>Right-click the class and select "Run as..." and then
        "Java application"</p></li></ol></div><p>Eclipse shows the following output in its console window (with
    "...snip..." indicating lines that were removed to save space):</p><div class="example"><a id="d0e26529"/><p class="title"><strong>Example 23.21. Fibonacci Example: Console Output</strong></p><div class="example-contents"><pre><code class="no-highlight">recurse for 50
recurse for 49
recurse for 48
recurse for 47
...snip...
recurse for 5
recurse for 4
recurse for 3
recurse for 2
1 == 1
2 == 1
3 == 2
4 == 3
5 == 5
6 == 8
...snip...
47 == 2971215073
48 == 4807526976
49 == 7778742049
50 == 12586269025
</code></pre></div></div><br class="example-break"/><p>To kick this off from Java we only insert a single Fibonacci
    object, with a sequence field of 50. A recursive rule is then used
    to insert the other 49 <code class="code">Fibonacci</code> objects. This example
    doesn't use
    <code class="code">PropertyChangeSupport</code>. It uses the MVEL dialect, which
    means we can use the <code class="literal">modify</code> keyword, which allows a block
    setter action which also notifies the engine of changes.</p><div class="example"><a id="d0e26545"/><p class="title"><strong>Example 23.22. Fibonacci Example: Execution</strong></p><div class="example-contents"><pre><code class="language-java">ksession.insert( new Fibonacci( 50 ) );
ksession.fireAllRules();</code></pre></div></div><br class="example-break"/><p>The rule Recurse is very simple. It matches each asserted
    <code class="code">Fibonacci</code> object with a value of -1, creating and 
    asserting a new <code class="code">Fibonacci</code> object with a sequence of
    one less than the currently matched object. Each time a Fibonacci
    object is added while the one with a sequence field equal to 1
    does not exist, the rule re-matches and fires again. The
    <code class="literal">not</code> conditional element is used to stop the rule's matching
    once we have all 50 Fibonacci objects in memory. The rule also has a
    salience value, because we need to have all 50 <code class="code">Fibonacci</code>
    objects asserted before we execute the Bootstrap rule.</p><div class="example"><a id="d0e26564"/><p class="title"><strong>Example 23.23. Fibonacci Example: Rule "Recurse"</strong></p><div class="example-contents"><pre><code class="no-highlight">rule Recurse
    salience 10
    when
        f : Fibonacci ( value == -1 )
        not ( Fibonacci ( sequence == 1 ) )
    then
        insert( new Fibonacci( f.sequence - 1 ) );
        System.out.println( "recurse for " + f.sequence );
end</code></pre></div></div><br class="example-break"/><p>The Audit view shows the original assertion of the
    <code class="code">Fibonacci</code> object with a sequence field of 50, done from
    Java code. From there on, the Audit view shows the continual
    recursion of the rule, where each asserted <code class="code">Fibonacci</code>
    object causes the Recurse rule to become activated and to fire again.</p><div class="figure"><a id="d0e26577"/><p class="title"><strong>Figure 23.6. Fibonacci Example: "Recurse" Audit View 1</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/FibonacciExample/fibonacci1.png" alt="Fibonacci Example: &#34;Recurse&#34; Audit View 1"/></div></div></div><br class="figure-break"/><p>When a <code class="code">Fibonacci</code> object with a sequence field of 2 is
    asserted the "Bootstrap" rule is matched and activated along with the
    "Recurse" rule. Note the multi-restriction on field
    <code class="code">sequence</code>, testing for equality with 1 or 2.</p><div class="example"><a id="d0e26591"/><p class="title"><strong>Example 23.24. Fibonacci Example: Rule "Bootstrap"</strong></p><div class="example-contents"><pre><code class="no-highlight">rule Bootstrap
    when
        f : Fibonacci( sequence == 1 || == 2, value == -1 ) // multi-restriction
    then 
        modify ( f ){ value = 1 };
        System.out.println( f.sequence + " == " + f.value );
end</code></pre></div></div><br class="example-break"/><p>At this point the Agenda looks as shown below. However,
    the "Bootstrap" rule does not fire because the "Recurse" rule has a higher
    salience.</p><div class="figure"><a id="d0e26598"/><p class="title"><strong>Figure 23.7. Fibonacci Example: "Recurse" Agenda View 1</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/FibonacciExample/fibonacci_agenda1.png" alt="Fibonacci Example: &#34;Recurse&#34; Agenda View 1"/></div></div></div><br class="figure-break"/><p>When a <code class="code">Fibonacci</code> object with a sequence of 1 is
    asserted the Bootstrap rule is matched again, causing two activations
    for this rule. Note that the "Recurse" rule does not match and activate
    because the <code class="literal">not</code> conditional element stops the rule's matching
    as soon as a <code class="code">Fibonacci</code> object with a sequence of 1
    exists.</p><div class="figure"><a id="d0e26615"/><p class="title"><strong>Figure 23.8. Fibonacci Example: "Recurse" Agenda View 2</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/FibonacciExample/fibonacci_agenda2.png" alt="Fibonacci Example: &#34;Recurse&#34; Agenda View 2"/></div></div></div><br class="figure-break"/><p>Once we have two <code class="code">Fibonacci</code> objects with values
    not equal to -1 the "Calculate" rule is able to match. It was
    the "Bootstrap" rule that set the objects with sequence 1 and 2 to
    values of 1. At this point we have 50 Fibonacci objects in the Working
    Memory. Now we need to select a suitable triple to calculate each
    of their values in turn. Using three Fibonacci patterns in a rule without
    field constraints to confine the possible cross products would result
    in 50x49x48 possible combinations, leading to about 125,000 possible rule
    firings, most of them incorrect. The "Calculate" rule uses field
    constraints to correctly constraint the thee Fibonacci patterns in the
    correct order; this
    technique is called <span class="emphasis"><em>cross product matching</em></span>. The
    first pattern finds any Fibonacci with a value != -1 and binds both
    the pattern and the field.  The second Fibonacci does this, too, but
    it adds an additional field constraint to ensure that its sequence is
    greater by one than the Fibonacci bound to <code class="code">f1</code>. When this
    rule fires for the first time, we know that only sequences 1 and 2
    have values of 1, and the two constraints ensure that <code class="code">f1</code>
    references sequence 1 and <code class="code">f2</code> references sequence 2. The
    final pattern finds the Fibonacci with a value equal to -1 and with a
    sequence one greater than <code class="code">f2</code>. At this point, we have
    three <code class="code">Fibonacci</code> objects correctly selected from the
    available cross products, and we can calculate the value for the
    third <code class="code">Fibonacci</code> object that's bound to <code class="code">f3</code>.</p><div class="example"><a id="d0e26650"/><p class="title"><strong>Example 23.25. Fibonacci Example: Rule "Calculate"</strong></p><div class="example-contents"><pre><code class="no-highlight">rule Calculate
    when
        // Bind f1 and s1
        f1 : Fibonacci( s1 : sequence, value != -1 )
        // Bind f2 and v2; refer to bound variable s1
        f2 : Fibonacci( sequence == (s1 + 1), v2 : value != -1 )
        // Bind f3 and s3; alternative reference of f2.sequence
        f3 : Fibonacci( s3 : sequence == (f2.sequence + 1 ), value == -1 )      
    then
        // Note the various referencing techniques.
        modify ( f3 ) { value = f1.value + v2 };
        System.out.println( s3 + " == " + f3.value );
end 
</code></pre></div></div><br class="example-break"/><p>The <code class="literal">modify</code> statement updated the value of the
    <code class="code">Fibonacci</code> object bound to <code class="code">f3</code>. This means
    we now have another new Fibonacci object with a value not equal to -1,
    which allows the "Calculate" rule to rematch and calculate the next
    Fibonacci number. The Audit view below shows how the firing of the
    last "Bootstrap" modifies the <code class="code">Fibonacci</code> object,
    enabling the "Calculate" rule to match, which then modifies
    another Fibonacci object allowing the "Calculate" rule to match again.
    This continues till the value is set for all <code class="code">Fibonacci</code>
    objects.</p><div class="figure"><a id="d0e26672"/><p class="title"><strong>Figure 23.9. Fibonacci Example: "Bootstrap" Audit View</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/FibonacciExample/fibonacci4.png" alt="Fibonacci Example: &#34;Bootstrap&#34; Audit View"/></div></div></div><br class="figure-break"/></div><div class="section" title="23.5. Banking Tutorial"><div class="titlepage"><div><div><h2 class="title"><a id="d0e26678"/>23.5. Banking Tutorial</h2></div></div></div><pre class="screen"><span class="bold"><strong>Name:</strong></span> BankingTutorial
<span class="bold"><strong>Main class:</strong></span> org.drools.examples.banking.BankingExamplesApp.java
<span class="bold"><strong>Module:</strong></span> drools-examples
<span class="bold"><strong>Type:</strong></span> Java application
<span class="bold"><strong>Rules file:</strong></span> org.drools.examples.banking.*.drl
<span class="bold"><strong>Objective:</strong></span> Demonstrate pattern matching, basic sorting and calculation rules.</pre><p>This tutorial demonstrates the process of developing a
    complete personal banking application to handle credits and debits on
    multiple accounts. It uses a set of design patterns that have
    been created for the process.</p><p>The class <code class="code">RuleRunner</code> is a simple harness to execute
    one or more DRL files against a set of data. It compiles the Packages 
    and creates the Knowledge Base for each execution, allowing us to
    easily execute each scenario and inspect the outputs. In reality this
    is not a good solution for a production system, where the Knowledge Base
    should be built just once and cached, but for the purposes of this
    tutorial it shall suffice.</p><div class="example"><a id="d0e26707"/><p class="title"><strong>Example 23.26. Banking Tutorial: RuleRunner</strong></p><div class="example-contents"><pre><code class="language-java">public class RuleRunner {

    public RuleRunner() {
    }

    public void runRules(String[] rules,
                         Object[] facts) throws Exception {

        KnowledgeBase kbase = KnowledgeBaseFactory.newKnowledgeBase();
        KnowledgeBuilder kbuilder = KnowledgeBuilderFactory.newKnowledgeBuilder();

        for ( int i = 0; i &lt; rules.length; i++ ) {
            String ruleFile = rules[i];
            System.out.println( "Loading file: " + ruleFile );
            kbuilder.add( ResourceFactory.newClassPathResource( ruleFile,
                                                                RuleRunner.class ),
                          ResourceType.DRL );
        }

        Collection&lt;KnowledgePackage&gt; pkgs = kbuilder.getKnowledgePackages();
        kbase.addKnowledgePackages( pkgs );
        StatefulKnowledgeSession ksession = kbase.newStatefulKnowledgeSession();

        for ( int i = 0; i &lt; facts.length; i++ ) {
            Object fact = facts[i];
            System.out.println( "Inserting fact: " + fact );
            ksession.insert( fact );
        }

        ksession.fireAllRules();
    }
}</code></pre></div></div><br class="example-break"/><p>The first of our sample Java classes loads and executes a single
    DRL file, <code class="filename">Example.drl</code>, but without inserting any
    data.</p><div class="example"><a id="d0e26717"/><p class="title"><strong>Example 23.27. Banking Tutorial : Java Example1</strong></p><div class="example-contents"><pre><code class="language-java">public class Example1 {
    public static void main(String[] args) throws Exception {
        new RuleRunner().runRules( new String[] { "Example1.drl" },
                                   new Object[0] );
    }
}</code></pre></div></div><br class="example-break"/><p>The first simple rule to execute has a single <code class="literal">eval</code>
    condition that will always be true, so that this rule will match and
    fire, once, after the start.</p><div class="example"><a id="d0e26727"/><p class="title"><strong>Example 23.28. Banking Tutorial: Rule in Example1.drl</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Rule 01"   
    when
        eval( 1==1 )
    then
        System.out.println( "Rule 01 Works" );
end</code></pre></div></div><br class="example-break"/><p>The output for the rule is below, showing that the rule matches
    and executes the single print statement.</p><div class="example"><a id="d0e26734"/><p class="title"><strong>Example 23.29. Banking Tutorial: Output of Example1.java</strong></p><div class="example-contents"><pre><code class="no-highlight">Loading file: Example1.drl
Rule 01 Works</code></pre></div></div><br class="example-break"/><p>The next step is to assert some simple facts and print them
    out.</p><div class="example"><a id="d0e26741"/><p class="title"><strong>Example 23.30. Banking Tutorial: Java Example2</strong></p><div class="example-contents"><pre><code class="language-java">public class Example2 {
    public static void main(String[] args) throws Exception {
        Number[] numbers = new Number[] {wrap(3), wrap(1), wrap(4), wrap(1), wrap(5)};
        new RuleRunner().runRules( new String[] { "Example2.drl" },
                                   numbers );
    }
    
    private static Integer wrap( int i ) {
        return new Integer(i);
    }
}</code></pre></div></div><br class="example-break"/><p>This doesn't use any specific facts but instead asserts a set
    of <code class="code">java.lang.Integer</code> objects. This is not considered
    "best practice" as a number is not a useful fact, but we use it here
    to demonstrate basic techniques before more complexity is added.</p><p>Now we will create a simple rule to print out these numbers.</p><div class="example"><a id="d0e26753"/><p class="title"><strong>Example 23.31. Banking Tutorial: Rule in Example2.drl</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Rule 02"
    when
        Number( $intValue : intValue )
    then
        System.out.println( "Number found with value: " + $intValue ); 
end</code></pre></div></div><br class="example-break"/><p>Once again, this rule does nothing special. It identifies any
    facts that are <code class="code">Number</code> objects and prints out the values.
    Notice the use of the abstract class <code class="code">Number</code>: we inserted
    <code class="code">Integer</code> objects but we now look for any kind of number.
    The pattern matching engine is able to match interfaces and
    superclasses of asserted objects.</p><p>The output shows the DRL being loaded, the facts inserted and
    then the matched and fired rules. We can see that each inserted number
    is matched and fired and thus printed.</p><div class="example"><a id="d0e26771"/><p class="title"><strong>Example 23.32. Banking Tutorial: Output of Example2.java</strong></p><div class="example-contents"><pre><code class="no-highlight">Loading file: Example2.drl
Inserting fact: 3
Inserting fact: 1
Inserting fact: 4
Inserting fact: 1
Inserting fact: 5
Number found with value: 5
Number found with value: 1
Number found with value: 4
Number found with value: 1
Number found with value: 3
</code></pre></div></div><br class="example-break"/><p>There are certainly many better ways to sort numbers than using
    rules, but since we will need to apply some cashflows in date order
    when we start looking at banking rules we'll develop simple rule
    based sorting technique.</p><div class="example"><a id="d0e26778"/><p class="title"><strong>Example 23.33. Banking Tutorial: Example3.java</strong></p><div class="example-contents"><pre><code class="language-java">public class Example3 {
    public static void main(String[] args) throws Exception {
        Number[] numbers = new Number[] {wrap(3), wrap(1), wrap(4), wrap(1), wrap(5)};
        new RuleRunner().runRules( new String[] { "Example3.drl" },
                                   numbers );
    }
    
    private static Integer wrap(int i) {
        return new Integer(i);
    }
}</code></pre></div></div><br class="example-break"/><p>Again we insert our <code class="code">Integer</code> objects, but this time the
    rule is slightly different:</p><div class="example"><a id="d0e26788"/><p class="title"><strong>Example 23.34. Banking Tutorial: Rule in Example3.drl</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Rule 03"
    when
        $number : Number( )
        not Number( intValue &lt; $number.intValue )
    then
        System.out.println("Number found with value: " + $number.intValue() ); 
        retract( $number );
end</code></pre></div></div><br class="example-break"/><p>The first line of the rule identifies a <code class="code">Number</code> and
    extracts the value. The second line ensures that there does not exist
    a smaller number than the one found by the first pattern. We might
    expect to match only one number - the smallest in the set. However,
    the retraction of the number after it has been printed means that the
    smallest number has been removed, revealing the next smallest number,
    and so on. </p><p>The resulting output shows that the numbers are now
    sorted numerically.</p><div class="example"><a id="d0e26800"/><p class="title"><strong>Example 23.35. Banking Tutorial: Output of Example3.java</strong></p><div class="example-contents"><pre><code class="no-highlight">Loading file: Example3.drl
Inserting fact: 3
Inserting fact: 1
Inserting fact: 4
Inserting fact: 1
Inserting fact: 5
Number found with value: 1
Number found with value: 1
Number found with value: 3
Number found with value: 4
Number found with value: 5
</code></pre></div></div><br class="example-break"/><p>We are ready to start moving towards our personal accounting
    rules. The first step is to create a <code class="code">Cashflow</code> object.</p><div class="example"><a id="d0e26810"/><p class="title"><strong>Example 23.36. Banking Tutorial: Class Cashflow</strong></p><div class="example-contents"><pre><code class="language-java">public class Cashflow {
    private Date   date;
    private double amount;

    public Cashflow() {
    }

    public Cashflow(Date date, double amount) {
        this.date = date;
        this.amount = amount;
    }

    public Date getDate() {
        return date;
    }

    public void setDate(Date date) {
        this.date = date;
    }

    public double getAmount() {
        return amount;
    }

    public void setAmount(double amount) {
        this.amount = amount;
    }

    public String toString() {
        return "Cashflow[date=" + date + ",amount=" + amount + "]";
    }
}</code></pre></div></div><br class="example-break"/><p>Class <code class="code">Cashflow</code> has two simple attributes, a date
    and an amount. (Note that using the type <code class="code">double</code> for
    monetary units is generally <span class="emphasis"><em>not</em></span> a good idea
    because floating point numbers cannot represent most numbers accurately.)
    There is also an overloaded constructor to set the values, and a
    method <code class="code">toString</code> to print a cashflow. The Java code of
    <code class="filename">Example4.java</code> inserts five Cashflow objects,
    with varying dates and amounts.</p><div class="example"><a id="d0e26832"/><p class="title"><strong>Example 23.37. Banking Tutorial: Example4.java</strong></p><div class="example-contents"><pre><code class="language-java">public class Example4 {
    public static void main(String[] args) throws Exception {
        Object[] cashflows = {
            new Cashflow(new SimpleDate("01/01/2007"), 300.00),
            new Cashflow(new SimpleDate("05/01/2007"), 100.00),
            new Cashflow(new SimpleDate("11/01/2007"), 500.00),
            new Cashflow(new SimpleDate("07/01/2007"), 800.00),
            new Cashflow(new SimpleDate("02/01/2007"), 400.00),
        };
        
        new RuleRunner().runRules( new String[] { "Example4.drl" },
                                   cashflows );
    }
}</code></pre></div></div><br class="example-break"/><p>The convenience class <code class="code">SimpleDate</code> extends
    <code class="code">java.util.Date</code>, providing a constructor taking
    a String as input and defining a date format. The code is
    listed below</p><div class="example"><a id="d0e26845"/><p class="title"><strong>Example 23.38. Banking Tutorial: Class SimpleDate</strong></p><div class="example-contents"><pre><code class="language-java">public class SimpleDate extends Date {
    private static final SimpleDateFormat format = new SimpleDateFormat("dd/MM/yyyy");
    
    public SimpleDate(String datestr) throws Exception {             
        setTime(format.parse(datestr).getTime());
    }
}</code></pre></div></div><br class="example-break"/><p>Now, let’s look at <code class="filename">Example4.drl</code> to see how
    we print the sorted <code class="code">Cashflow</code> objects:</p><div class="example"><a id="d0e26858"/><p class="title"><strong>Example 23.39. Banking Tutorial: Rule in Example4.drl</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Rule 04"   
    when
        $cashflow : Cashflow( $date : date, $amount : amount )
        not Cashflow( date &lt; $date)
    then
        System.out.println("Cashflow: "+$date+" :: "+$amount);  
        retract($cashflow);
end</code></pre></div></div><br class="example-break"/><p>Here, we identify a <code class="code">Cashflow</code> and extract the date
    and the amount. In the second line of the rule we ensure that there
    is no Cashflow with an earlier date than the one found. In the
    consequence, we print the <code class="code">Cashflow</code> that satisfies the
    rule and then retract it, making way for the next earliest
    <code class="code">Cashflow</code>. So, the output we generate is:</p><div class="example"><a id="d0e26874"/><p class="title"><strong>Example 23.40. Banking Tutorial: Output of Example4.java</strong></p><div class="example-contents"><pre><code class="no-highlight">Loading file: Example4.drl
Inserting fact: Cashflow[date=Mon Jan 01 00:00:00 GMT 2007,amount=300.0]
Inserting fact: Cashflow[date=Fri Jan 05 00:00:00 GMT 2007,amount=100.0]
Inserting fact: Cashflow[date=Thu Jan 11 00:00:00 GMT 2007,amount=500.0]
Inserting fact: Cashflow[date=Sun Jan 07 00:00:00 GMT 2007,amount=800.0]
Inserting fact: Cashflow[date=Tue Jan 02 00:00:00 GMT 2007,amount=400.0]
Cashflow: Mon Jan 01 00:00:00 GMT 2007 :: 300.0
Cashflow: Tue Jan 02 00:00:00 GMT 2007 :: 400.0
Cashflow: Fri Jan 05 00:00:00 GMT 2007 :: 100.0
Cashflow: Sun Jan 07 00:00:00 GMT 2007 :: 800.0
Cashflow: Thu Jan 11 00:00:00 GMT 2007 :: 500.0
</code></pre></div></div><br class="example-break"/><p>Next, we extend our <code class="code">Cashflow</code>, resulting in a
    <code class="code">TypedCashflow</code> which can be a credit or a debit operation.
    (Normally, we would just add this to the <code class="code">Cashflow</code> type, but
    we use extension to keep the previous version of the class intact.)</p><div class="example"><a id="d0e26890"/><p class="title"><strong>Example 23.41. Banking Tutorial: Class TypedCashflow</strong></p><div class="example-contents"><pre><code class="language-java">public class TypedCashflow extends Cashflow {
    public static final int CREDIT = 0;
    public static final int DEBIT  = 1;

    private int             type;

    public TypedCashflow() {
    }

    public TypedCashflow(Date date, int type, double amount) {
        super( date, amount );
        this.type = type;
    }

    public int getType() {
        return type;
    }

    public void setType(int type) {
        this.type = type;
    }

    public String toString() {
        return "TypedCashflow[date=" + getDate() +
               ",type=" + (type == CREDIT ? "Credit" : "Debit") +
               ",amount=" + getAmount() + "]";
    }
}</code></pre></div></div><br class="example-break"/><p>There are lots of ways to improve this code, but for the sake
    of the example this will do.</p><p>Now let's create Example5, a class for running our code.</p><div class="example"><a id="d0e26899"/><p class="title"><strong>Example 23.42. Banking Tutorial: Example5.java</strong></p><div class="example-contents"><pre><code class="language-java">public class Example5 {
    public static void main(String[] args) throws Exception {      
        Object[] cashflows = {
            new TypedCashflow(new SimpleDate("01/01/2007"),    
                              TypedCashflow.CREDIT, 300.00),
            new TypedCashflow(new SimpleDate("05/01/2007"),
                              TypedCashflow.CREDIT, 100.00),
            new TypedCashflow(new SimpleDate("11/01/2007"),
                              TypedCashflow.CREDIT, 500.00),
            new TypedCashflow(new SimpleDate("07/01/2007"),
                              TypedCashflow.DEBIT, 800.00),
            new TypedCashflow(new SimpleDate("02/01/2007"),
                              TypedCashflow.DEBIT, 400.00),
        };
        
        new RuleRunner().runRules( new String[] { "Example5.drl" },
                                   cashflows );
    }
}</code></pre></div></div><br class="example-break"/><p>Here, we simply create a set of <code class="code">Cashflow</code> objects
    which are either credit or debit operations. We supply them and
    <code class="filename">Example5.drl</code> to the RuleEngine. </p><p>Now, let’s look at a rule printing the sorted
    <code class="code">Cashflow</code> objects.</p><div class="example"><a id="d0e26917"/><p class="title"><strong>Example 23.43. Banking Tutorial: Rule in Example5.drl</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Rule 05"  
    when
        $cashflow : TypedCashflow( $date : date,
                                   $amount : amount,
                                   type == TypedCashflow.CREDIT )
        not TypedCashflow( date &lt; $date,
                           type == TypedCashflow.CREDIT )
    then
        System.out.println("Credit: "+$date+" :: "+$amount);   
        retract($cashflow);
end</code></pre></div></div><br class="example-break"/><p>Here, we identify a <code class="code">Cashflow</code> fact with a type
    of <code class="code">CREDIT</code> and extract the date and the amount. In the
    second line of the rule we ensure that there is no <code class="code">Cashflow</code>
    of the same type with an earlier date than the one found. In the
    consequence, we print the cashflow satisfying the patterns and then
    retract it, making way for the next earliest cashflow of type
    <code class="code">CREDIT</code>.</p><p>So, the output we generate is</p><div class="example"><a id="d0e26938"/><p class="title"><strong>Example 23.44. Banking Tutorial: Output of Example5.java</strong></p><div class="example-contents"><pre class="screen">Loading file: Example5.drl
Inserting fact: TypedCashflow[date=Mon Jan 01 00:00:00 GMT 2007,type=Credit,amount=300.0]
Inserting fact: TypedCashflow[date=Fri Jan 05 00:00:00 GMT 2007,type=Credit,amount=100.0]
Inserting fact: TypedCashflow[date=Thu Jan 11 00:00:00 GMT 2007,type=Credit,amount=500.0]
Inserting fact: TypedCashflow[date=Sun Jan 07 00:00:00 GMT 2007,type=Debit,amount=800.0]
Inserting fact: TypedCashflow[date=Tue Jan 02 00:00:00 GMT 2007,type=Debit,amount=400.0]
Credit: Mon Jan 01 00:00:00 GMT 2007 :: 300.0
Credit: Fri Jan 05 00:00:00 GMT 2007 :: 100.0
Credit: Thu Jan 11 00:00:00 GMT 2007 :: 500.0
</pre></div></div><br class="example-break"/><p>Continuing our banking exercise, we are now going to process both
    credits and debits on two bank accounts, calculating the account balance.
    In order to do this, we create two separate <code class="code">Account</code> objects
    and inject them into the <code class="code">Cashflows</code> objects before passing
    them to the Rule Engine. The reason for this is to provide easy access
    to the correct account without having to resort to helper classes. Let’s
    take a look at the <code class="code">Account</code> class first. This is a simple
    Java object with an account number and balance:</p><div class="example"><a id="d0e26954"/><p class="title"><strong>Example 23.45. Banking Tutorial: Class Account</strong></p><div class="example-contents"><pre><code class="language-java">public class Account {
    private long   accountNo;
    private double balance = 0;

    public Account() {
    }

    public Account(long accountNo) {
        this.accountNo = accountNo;
    }

    public long getAccountNo() {
        return accountNo;
    }

    public void setAccountNo(long accountNo) {
        this.accountNo = accountNo;
    }

    public double getBalance() {
        return balance;
    }

    public void setBalance(double balance) {
        this.balance = balance;
    }

    public String toString() {
        return "Account[" + "accountNo=" + accountNo + ",balance=" + balance + "]";
    }
}</code></pre></div></div><br class="example-break"/><p>Now let’s extend our <code class="code">TypedCashflow</code>, resulting in
    <code class="code">AllocatedCashflow</code>, to include an <code class="code">Account</code>
    reference.</p><div class="example"><a id="d0e26970"/><p class="title"><strong>Example 23.46. Banking Tutorial: Class AllocatedCashflow</strong></p><div class="example-contents"><pre><code class="language-java">public class AllocatedCashflow extends TypedCashflow {
    private Account account;

    public AllocatedCashflow() {
    }

    public AllocatedCashflow(Account account, Date date, int type, double amount) {
        super( date, type, amount );
        this.account = account;
    }

    public Account getAccount() {
        return account;
    }

    public void setAccount(Account account) {
        this.account = account;
    }

    public String toString() {
        return "AllocatedCashflow[" +
               "account=" + account +
               ",date=" + getDate() + 
               ",type=" + (getType() == CREDIT ? "Credit" : "Debit") + 
               ",amount=" + getAmount() + "]";
    }
}</code></pre></div></div><br class="example-break"/><p>The Java code of <code class="filename">Example5.java</code> creates 
    two <code class="code">Account</code> objects and passes one of them into each
    cashflow, in the constructor call.</p><div class="example"><a id="d0e26983"/><p class="title"><strong>Example 23.47. Banking Tutorial: Example5.java</strong></p><div class="example-contents"><pre><code class="language-java">public class Example6 {
    public static void main(String[] args) throws Exception {      
        Account acc1 = new Account(1);
        Account acc2 = new Account(2);
           
        Object[] cashflows = {
            new AllocatedCashflow(acc1,new SimpleDate("01/01/2007"),
                                  TypedCashflow.CREDIT, 300.00),
            new AllocatedCashflow(acc1,new SimpleDate("05/02/2007"),
                                  TypedCashflow.CREDIT, 100.00),
            new AllocatedCashflow(acc2,new SimpleDate("11/03/2007"),
                                  TypedCashflow.CREDIT, 500.00),
            new AllocatedCashflow(acc1,new SimpleDate("07/02/2007"),
                                  TypedCashflow.DEBIT,  800.00),
            new AllocatedCashflow(acc2,new SimpleDate("02/03/2007"),
                                  TypedCashflow.DEBIT,  400.00),
            new AllocatedCashflow(acc1,new SimpleDate("01/04/2007"),    
                                  TypedCashflow.CREDIT, 200.00),
            new AllocatedCashflow(acc1,new SimpleDate("05/04/2007"),
                                  TypedCashflow.CREDIT, 300.00),
            new AllocatedCashflow(acc2,new SimpleDate("11/05/2007"),
                                  TypedCashflow.CREDIT, 700.00),
            new AllocatedCashflow(acc1,new SimpleDate("07/05/2007"),
                                  TypedCashflow.DEBIT,  900.00),
            new AllocatedCashflow(acc2,new SimpleDate("02/05/2007"),
                                  TypedCashflow.DEBIT,  100.00)           
        };
        
        new RuleRunner().runRules( new String[] { "Example6.drl" },
                                   cashflows );
    }
}</code></pre></div></div><br class="example-break"/><p>Now, let’s look at the rule in <code class="filename">Example6.drl</code>
    to see how we apply each cashflow in date order and calculate and print
    the balance. </p><div class="example"><a id="d0e26993"/><p class="title"><strong>Example 23.48. Banking Tutorial: Rule in Example6.drl</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Rule 06 - Credit"  
    when
        $cashflow : AllocatedCashflow( $account : account,
                                       $date : date,
                                       $amount : amount,
                                       type == TypedCashflow.CREDIT )
        not AllocatedCashflow( account == $account, date &lt; $date)
    then
        System.out.println("Credit: " + $date + " :: " + $amount);     
        $account.setBalance($account.getBalance()+$amount);
        System.out.println("Account: " + $account.getAccountNo() +
                           " - new balance: " + $account.getBalance());          
        retract($cashflow);
end

rule "Rule 06 - Debit"  
    when
        $cashflow : AllocatedCashflow( $account : account,
                            $date : date,
                            $amount : amount,
                            type == TypedCashflow.DEBIT )
        not AllocatedCashflow( account == $account, date &lt; $date)
    then
        System.out.println("Debit: " + $date + " :: " + $amount);      
        $account.setBalance($account.getBalance() - $amount);
        System.out.println("Account: " + $account.getAccountNo() +
                           " - new balance: " + $account.getBalance());           
        retract($cashflow);
end</code></pre></div></div><br class="example-break"/><p>Although we have separate rules for credits and debits, but we do
    not specify a type when checking for earlier cashflows. This is so that
    all cashflows are applied in date order, regardless of the cashflow type.
    In the conditions we identify the account to work with, and in the
    consequences we update it with the cashflow amount.</p><div class="example"><a id="d0e27000"/><p class="title"><strong>Example 23.49. Banking Tutorial: Output of Example6.java</strong></p><div class="example-contents"><pre><code class="no-highlight">Loading file: Example6.drl
Inserting fact: AllocatedCashflow[account=Account[accountNo=1,balance=0.0],date=Mon Jan 01 00:00:00 GMT 2007,type=Credit,amount=300.0]
Inserting fact: AllocatedCashflow[account=Account[accountNo=1,balance=0.0],date=Mon Feb 05 00:00:00 GMT 2007,type=Credit,amount=100.0]
Inserting fact: AllocatedCashflow[account=Account[accountNo=2,balance=0.0],date=Sun Mar 11 00:00:00 GMT 2007,type=Credit,amount=500.0]
Inserting fact: AllocatedCashflow[account=Account[accountNo=1,balance=0.0],date=Wed Feb 07 00:00:00 GMT 2007,type=Debit,amount=800.0]
Inserting fact: AllocatedCashflow[account=Account[accountNo=2,balance=0.0],date=Fri Mar 02 00:00:00 GMT 2007,type=Debit,amount=400.0]
Inserting fact: AllocatedCashflow[account=Account[accountNo=1,balance=0.0],date=Sun Apr 01 00:00:00 BST 2007,type=Credit,amount=200.0]
Inserting fact: AllocatedCashflow[account=Account[accountNo=1,balance=0.0],date=Thu Apr 05 00:00:00 BST 2007,type=Credit,amount=300.0]
Inserting fact: AllocatedCashflow[account=Account[accountNo=2,balance=0.0],date=Fri May 11 00:00:00 BST 2007,type=Credit,amount=700.0]
Inserting fact: AllocatedCashflow[account=Account[accountNo=1,balance=0.0],date=Mon May 07 00:00:00 BST 2007,type=Debit,amount=900.0]
Inserting fact: AllocatedCashflow[account=Account[accountNo=2,balance=0.0],date=Wed May 02 00:00:00 BST 2007,type=Debit,amount=100.0]
Debit: Fri Mar 02 00:00:00 GMT 2007 :: 400.0
Account: 2 - new balance: -400.0
Credit: Sun Mar 11 00:00:00 GMT 2007 :: 500.0
Account: 2 - new balance: 100.0
Debit: Wed May 02 00:00:00 BST 2007 :: 100.0
Account: 2 - new balance: 0.0
Credit: Fri May 11 00:00:00 BST 2007 :: 700.0
Account: 2 - new balance: 700.0
Credit: Mon Jan 01 00:00:00 GMT 2007 :: 300.0
Account: 1 - new balance: 300.0
Credit: Mon Feb 05 00:00:00 GMT 2007 :: 100.0
Account: 1 - new balance: 400.0
Debit: Wed Feb 07 00:00:00 GMT 2007 :: 800.0
Account: 1 - new balance: -400.0
Credit: Sun Apr 01 00:00:00 BST 2007 :: 200.0
Account: 1 - new balance: -200.0
Credit: Thu Apr 05 00:00:00 BST 2007 :: 300.0
Account: 1 - new balance: 100.0
Debit: Mon May 07 00:00:00 BST 2007 :: 900.0
Account: 1 - new balance: -800.0
</code></pre></div></div><br class="example-break"/></div><div class="section" title="23.6. Pricing Rule Decision Table Example"><div class="titlepage"><div><div><h2 class="title"><a id="d0e27005"/>23.6. Pricing Rule Decision Table Example</h2></div></div></div><p>The Pricing Rule decision table demonstrates the use of a 
    decision table in a spreadsheet, in Excel's XLS format, in calculating
    the retail cost of an insurance policy. The purpose of the provide set
    of rules is to calculate a base price and a discount for a
    car driver applying for a specific policy. The driver's age, history and
    the policy type all contribute to what the basic premium is, and an
    additional chunk of rules deals with refining this with a discount
    percentage.</p><pre><code class="no-highlight"><span class="bold"><strong>Name:</strong></span> Example Policy Pricing
<span class="bold"><strong>Main class:</strong></span> org.drools.examples.decisiontable.PricingRuleDTExample
<span class="bold"><strong>Module:</strong></span> drools-examples
<span class="bold"><strong>Type:</strong></span> Java application
<span class="bold"><strong>Rules file:</strong></span> ExamplePolicyPricing.xls
<span class="bold"><strong>Objective:</strong></span> demonstrate spreadsheet-based decision tables.</code></pre><div class="section" title="23.6.1. Executing the example"><div class="titlepage"><div><div><h3 class="title"><a id="d0e27029"/>23.6.1. Executing the example</h3></div></div></div><p>Open the file <code class="filename">PricingRuleDTExample.java</code> and 
      execute it as a Java application. It should produce the following
      output in the Console window:</p><pre><code class="no-highlight">Cheapest possible
BASE PRICE IS: 120
DISCOUNT IS: 20     </code></pre><p>The code to execute the example follows the usual pattern.
      The rules are loaded, the facts inserted and a Stateless Session is
      created. What is different is how the rules are added.</p><pre><code class="language-java">DecisionTableConfiguration dtableconfiguration =
    KnowledgeBuilderFactory.newDecisionTableConfiguration();
        dtableconfiguration.setInputType( DecisionTableInputType.XLS );

        KnowledgeBuilder kbuilder = KnowledgeBuilderFactory.newKnowledgeBuilder();

        Resource xlsRes = ResourceFactory.newClassPathResource( "ExamplePolicyPricing.xls",
                                                                getClass() );
        kbuilder.add( xlsRes,
                      ResourceType.DTABLE,
                      dtableconfiguration );
</code></pre><p>Note the use of the <code class="code">DecisionTableConfiguration</code> object.
      Its input type is set to <code class="code">DecisionTableInputType.XLS</code>.
      If you use the BRMS, all this is of course taken care of for you.</p><p>There are two fact types used in this example, <code class="code">Driver</code>
      and <code class="code">Policy</code>. Both are used with their default values. The
      <code class="code">Driver</code> is 30 years old, has had no prior claims and
      currently has a risk profile of <code class="code">LOW</code>. The <code class="code">Policy</code>
      being applied for is <code class="code">COMPREHENSIVE</code>, and it has not yet been
      approved.</p></div><div class="section" title="23.6.2. The decision table"><div class="titlepage"><div><div><h3 class="title"><a id="d0e27071"/>23.6.2. The decision table</h3></div></div></div><p>In this decision table, each row is a rule, and each column is
      a condition or an action.</p><div class="figure"><a id="d0e27076"/><p class="title"><strong>Figure 23.10. Decision table configuration</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/PricingExample/DT_Config.png" alt="Decision table configuration"/></div></div></div><br class="figure-break"/><p>Referring to the spreadsheet show above, we have the
      <code class="code">RuleSet</code> declaration, which provides the package name.
      There are also other optional items you can have here, such as
      <code class="code">Variables</code> for global variables, and <code class="code">Imports</code>
      for importing classes. In this case, the namespace of the rules is
      the same as the fact classes we are using, so we can omit it.</p><p>Moving further down, we can see the <code class="code">RuleTable</code>
      declaration. The name after this (Pricing bracket) is used as the
      prefix for all the generated rules. Below that, we have
      "CONDITION or ACTION", indicating the purpose of the column, i.e.,
      whether it forms part of the condition or the consequence of the rule
      that will be generated.</p><p>You can see that there is a driver, his data spanned across three
      cells, which means that the template expressions below it apply to that
      fact. We observe the driver's age range (which uses <code class="code">$1</code> and
      <code class="code">$2</code> with comma-separated values), 
      <code class="code">locationRiskProfile</code>, and <code class="code">priorClaims</code> in the
      respective columns. In the action columns, we are set the policy
      base price and log a message.</p><div class="figure"><a id="d0e27112"/><p class="title"><strong>Figure 23.11. Base price calculation</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/PricingExample/DT_Table1.png" alt="Base price calculation"/></div></div></div><br class="figure-break"/><p>In the preceding spreadsheet section, there are broad category
      brackets, indicated by the comment in the leftmost column. As we know
      the details of our drivers and their policies, we can tell (with a bit
      of thought) that they should match row number 18, as they have no
      prior accidents, and are 30 years old. This gives us a base price
      of 120.</p><div class="figure"><a id="d0e27120"/><p class="title"><strong>Figure 23.12. Discount calculation</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/PricingExample/DT_Table2.png" alt="Discount calculation"/></div></div></div><br class="figure-break"/><p>The above section contains the conditions for the discount we
      might grant our driver. The discount results from the <code class="code">Age</code>
      bracket, the number of prior claims, and the policy type. In our case,
      the driver is 30, with no prior claims, and is applying for a
      <code class="code">COMPREHENSIVE</code> policy, which means we can give a discount
      of 20%. Note that this is actually a separate table, but in the same
      worksheet, so that different templates apply.</p><p>It is important to note that decision tables generate rules.
      This means they aren't simply top-down logic, but more a means to
      capture data resulting in rules. This is a subtle difference that
      confuses some people. The evaluation of the rules is not necessarily
      in the given order, since all the normal mechanics of the rule engine
      still apply.</p></div></div><div class="section" title="23.7. Pet Store Example"><div class="titlepage"><div><div><h2 class="title"><a id="d0e27136"/>23.7. Pet Store Example</h2></div></div></div><pre><code class="no-highlight"><span class="bold"><strong>Name:</strong></span> Pet Store 
<span class="bold"><strong>Main class:</strong></span> org.drools.examples.petstore.PetStoreExample
<span class="bold"><strong>Module:</strong></span> drools-examples
<span class="bold"><strong>Type:</strong></span> Java application
<span class="bold"><strong>Rules file:</strong></span> PetStore.drl
<span class="bold"><strong>Objective:</strong></span> Demonstrate use of Agenda Groups, Global Variables and integration with a GUI,
including callbacks from within the rules
</code></pre><p>The Pet Store example shows how to integrate Rules with a GUI,
      in this case a Swing based desktop application. Within the rules file,
      it demonstrates how to use Agenda groups and auto-focus to control
      which of a set of rules is allowed to fire at any given time. It also
      illustrates the mixing of the Java and MVEL dialects within the rules,
      the use of accumulate functions and the way of calling Java functions
      from within the ruleset.</p><p>All of the Java code is contained in one file,
      <code class="filename">PetStore.java</code>, defining the following principal
      classes (in addition to several classes to handle Swing Events):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="code">Petstore</code> contains the <code class="code">main()</code>
          method that we will look at shortly.</p></li><li class="listitem"><p><code class="code">PetStoreUI</code> is responsible for creating and
          displaying the Swing based GUI. It contains several smaller
          classes, mainly for responding to various GUI events such as
          mouse button clicks.</p></li><li class="listitem"><p><code class="code">TableModel</code> holds the table data. Think of it
          as a JavaBean that extends the Swing class
          <code class="code">AbstractTableModel</code>.</p></li><li class="listitem"><p><code class="code">CheckoutCallback</code> allows the GUI to interact
          with the Rules.</p></li><li class="listitem"><p><code class="code">Ordershow</code> keeps the items that we wish to
          buy.</p></li><li class="listitem"><p><code class="code">Purchase</code> stores details of the order and
          the products we are buying.</p></li><li class="listitem"><p><code class="code">Product</code> is a JavaBean holding details of
          the product available for purchase, and its price.</p></li></ul></div><p>Much of the Java code is either plain JavaBeans or Swing-based.
      Only a few Swing-related points will be discussed in this section,
      but a good tutorial about Swing components can be found at Sun's
      Swing website, in
      <a class="link" href="http://java.sun.com/docs/books/tutorial/uiswing/">http://java.sun.com/docs/books/tutorial/uiswing/</a>.</p><p>The pieces of Java code in <code class="filename">Petstore.java</code>
      that relate to rules and facts are shown below.</p><div class="example"><a id="d0e27217"/><p class="title"><strong>Example 23.50. Creating the PetStore KieContainer in PetStore.main</strong></p><div class="example-contents"><pre><code class="language-java">// KieServices is the factory for all KIE services 
KieServices ks = KieServices.Factory.get();

// From the kie services, a container is created from the classpath
KieContainer kc = ks.getKieClasspathContainer();

// Create the stock.
Vector&lt;Product&gt; stock = new Vector&lt;Product&gt;();
stock.add( new Product( "Gold Fish", 5 ) );
stock.add( new Product( "Fish Tank", 25 ) );
stock.add( new Product( "Fish Food", 2 ) );

// A callback is responsible for populating the
// Working Memory and for firing all rules.
PetStoreUI ui = new PetStoreUI( stock,
                                new CheckoutCallback( kc ) );
ui.createAndShowGUI();
</code></pre></div></div><br class="example-break"/><p>The code shown above create a <code class="code">KieContainer</code> from the classpath and based on the definitions in
    the <code class="filename">kmodule.xml</code> file. Unlike other examples where the facts are asserted and fired straight
    away, this example defers this step to later. The way it does this is via the second last line where a
      <code class="code">PetStoreUI</code> object is created using a constructor accepting the <code class="code">Vector</code> object
      <code class="code">stock</code> collecting our products, and an instance of the <code class="code">CheckoutCallback</code> class containing
    the Rule Base that we have just loaded.</p><p>The Java code that fires the rules is within the 
      <code class="code">CheckoutCallBack.checkout()</code> method. This is triggered
      (eventually) when the Checkout button is pressed by the user.</p><div class="example"><a id="d0e27247"/><p class="title"><strong>Example 23.51. Firing the Rules - extract from CheckoutCallBack.checkout()</strong></p><div class="example-contents"><pre><code class="language-java">public String checkout(JFrame frame, List&lt;Product&gt; items) {
    Order order = new Order();

    // Iterate through list and add to cart
    for ( Product p: items ) {
        order.addItem( new Purchase( order, p ) );
    }

    // Add the JFrame to the ApplicationData to allow for user interaction

    // From the container, a session is created based on  
    // its definition and configuration in the META-INF/kmodule.xml file 
    KieSession ksession = kcontainer.newKieSession("PetStoreKS");

    ksession.setGlobal( "frame", frame );
    ksession.setGlobal( "textArea", this.output );

    ksession.insert( new Product( "Gold Fish", 5 ) );
    ksession.insert( new Product( "Fish Tank", 25 ) );
    ksession.insert( new Product( "Fish Food", 2 ) );

    ksession.insert( new Product( "Fish Food Sample", 0 ) );

    ksession.insert( order );
    ksession.fireAllRules();

    // Return the state of the cart
    return order.toString();
}
</code></pre></div></div><br class="example-break"/><p>Two items get passed into this method. One is the handle to the
      <code class="code">JFrame</code> Swing component surrounding the output text
      frame, at the bottom of the GUI. The second is a list of order items;
      this comes from the <code class="code">TableModel</code> storing the information
      from the "Table" area at the top right section of the GUI.</p><p>The for loop transforms the list of order items coming from the
      GUI into the <code class="code">Order</code> JavaBean, also contained in the
      file <code class="filename">PetStore.java</code>. Note that it would be 
      possible to refer to the Swing dataset directly within the rules,
      but it is better coding practice to do it this way, using simple
      Java objects. It means that we are not tied to Swing if we wanted
      to transform the sample into a Web application.</p><p>It is important to note that <span class="emphasis"><em>all state in this
      example is stored in the Swing components, and that the rules are
      effectively stateless.</em></span> Each time the "Checkout" button is
      pressed, this code copies the contents of the Swing
      <code class="code">TableModel</code> into the Session's Working Memory.</p><p>Within this code, there are nine calls to the <code class="code">KieSession</code>. The first of these creates a new
      <code class="code">KieSession</code> from the <code class="code">KieContainer</code>. Remember that we passed in this
      <code class="code">KieContainer</code> when we created the <code class="code">CheckoutCallBack</code> class in the <code class="code">main()</code>
    method. The next two calls pass in two objects that we will hold as global variables in the rules: the Swing text
    area and the Swing frame used for writing messages.</p><p>More inserts put information on products into the <code class="code">KieSession</code>, as well as the order list. The
    final call is the standard <code class="code">fireAllRules()</code>. Next, we look at what this method causes to happen within
    the rules file.</p><div class="example"><a id="d0e27304"/><p class="title"><strong>Example 23.52. Package, Imports, Globals and Dialect: extract from PetStore.drl</strong></p><div class="example-contents"><pre><code class="language-java">package org.drools.examples

import org.kie.api.runtime.KieRuntime
import org.drools.examples.petstore.PetStoreExample.Order
import org.drools.examples.petstore.PetStoreExample.Purchase
import org.drools.examples.petstore.PetStoreExample.Product
import java.util.ArrayList
import javax.swing.JOptionPane;

import javax.swing.JFrame 
        
global JFrame frame 
global javax.swing.JTextArea textArea</code></pre></div></div><br class="example-break"/><p>The first part of file <code class="filename">PetStore.drl</code>
      contains the standard package and import statements to make various
      Java classes available to the rules. New to us are the two globals
      <code class="code">frame</code> and <code class="code">textArea</code>. They hold references
      to the Swing components <code class="code">JFrame</code> and <code class="code">JTextArea</code>
      components that were previously passed on by the Java code calling
      the <code class="code">setGlobal()</code> method. Unlike  variables in rules,
      which expire as soon as the rule has fired, global variables retain
      their value for the lifetime of the Session.</p><p>The next extract from the file <code class="filename">PetStore.drl</code>
      contains two functions that are referenced by the rules that we will
      look at shortly.</p><div class="example"><a id="d0e27334"/><p class="title"><strong>Example 23.53. Java Functions in the Rules: extract from PetStore.drl</strong></p><div class="example-contents"><pre><code class="language-java">function void doCheckout(JFrame frame, KieRuntime krt) {
        Object[] options = {"Yes",
                            "No"};
                            
        int n = JOptionPane.showOptionDialog(frame,
                                             "Would you like to checkout?",
                                             "",
                                             JOptionPane.YES_NO_OPTION,
                                             JOptionPane.QUESTION_MESSAGE,
                                             null,
                                             options,
                                             options[0]);

       if (n == 0) {
            krt.getAgenda().getAgendaGroup( "checkout" ).setFocus();
       }   
}

function boolean requireTank(JFrame frame, KieRuntime krt, Order order, Product fishTank, int total) {
        Object[] options = {"Yes",
                            "No"};
                            
        int n = JOptionPane.showOptionDialog(frame,
                                             "Would you like to buy a tank for your " + total + " fish?",
                                             "Purchase Suggestion",
                                             JOptionPane.YES_NO_OPTION,
                                             JOptionPane.QUESTION_MESSAGE,
                                             null,
                                             options,
                                             options[0]);
                                             
       System.out.print( "SUGGESTION: Would you like to buy a tank for your "
                           + total + " fish? - " );

       if (n == 0) {
             Purchase purchase = new Purchase( order, fishTank );
             krt.insert( purchase );
             order.addItem( purchase );
             System.out.println( "Yes" );
       } else {
            System.out.println( "No" );
       }      
       return true;
}

</code></pre></div></div><br class="example-break"/><p>Having these functions in the rules file just makes the Pet Store
      example more compact. In real life you probably have the functions
      in a file of their own, within the same rules package, or as a
      static method on a standard Java class, and import them, using
      <code class="code">import function my.package.Foo.hello</code>.</p><p>The purpose of these two functions is:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="code">doCheckout()</code> displays a dialog asking users whether they wish to checkout. If they do,
        focus is set to the <code class="code">checkout</code> agenda-group, allowing rules in that group to (potentially)
        fire.</p></li><li class="listitem"><p><code class="code">requireTank()</code> displays a dialog asking
          users whether they wish to buy a tank. If so, a new fish tank
          <code class="code">Product</code> is added to the order list in Working
          Memory.</p></li></ul></div><p>We'll see the rules that call these functions later on. The
      next set of examples are from the Pet Store rules themselves. The
      first extract is the one that happens to fire first, partly because
      it has the <code class="literal">auto-focus</code> attribute set to true.</p><div class="example"><a id="d0e27368"/><p class="title"><strong>Example 23.54. Putting items into working memory: extract from PetStore.drl</strong></p><div class="example-contents"><pre><code class="no-highlight">// Insert each item in the shopping cart into the Working Memory 
// Insert each item in the shopping cart into the Working Memory
rule "Explode Cart"
    agenda-group "init"
    auto-focus true
    salience 10
    dialect "java"
when
    $order : Order( grossTotal == -1 )
    $item : Purchase() from $order.items
then
    insert( $item );
    kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup( "show items" ).setFocus();
    kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup( "evaluate" ).setFocus();
end</code></pre></div></div><br class="example-break"/><p>This rule matches against all orders that do not yet have their
      <code class="code">grossTotal</code> calculated . It loops for each purchase item
      in that order. Some parts of the "Explode Cart" rule should be familiar:
      the rule name, the salience (suggesting the order for the rules being
      fired) and the dialect set to <code class="code">"java"</code>. There are three
      new features:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">agenda-group</code> <code class="code">"init"</code> defines the name
           of the agenda group. In this case, there is only one rule in the
           group. However, neither the Java code nor a rule consequence sets
           the focus to this group, and therefore it relies on the next
           attribute for its chance to fire.</p></li><li class="listitem"><p><code class="literal">auto-focus</code> <code class="code">true</code> ensures that this rule,
          while being the only rule in the agenda group, gets a chance to fire
          when <code class="code">fireAllRules()</code> is called from the Java code.</p></li><li class="listitem"><p><code class="code">kcontext....setFocus()</code> sets the focus to the
          <code class="code">"show items"</code> and <code class="code">"evaluate"</code> agenda groups
          in turn, permitting their rules to fire. In practice, we loop
          through all items on the order, inserting them into memory, then
          firing the other rules after each insert.</p></li></ul></div><p>The next two listings show the rules within the
      <code class="code">"show items"</code> and <code class="code">evaluate</code> agenda groups.
      We look at them in the order that they are called.</p><div class="example"><a id="d0e27420"/><p class="title"><strong>Example 23.55. Show Items in the GUI - extract from PetStore.drl</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Show Items"
    agenda-group "show items"
    dialect "mvel"
when
    $order : Order( )
    $p : Purchase( order == $order )
then
   textArea.append( $p.product + "\n");
end
</code></pre></div></div><br class="example-break"/><p>The <code class="code">"show items"</code> agenda-group has only one rule,
      called "Show Items" (note the difference in case). For each purchase
      on the order currently in the Working Memory (or Session), it logs
      details to the text area at the bottom of the GUI. The
      <code class="code">textArea</code> variable used to do this is one of the global
      variables we looked at earlier.</p><p>The <code class="code">evaluate</code> Agenda group also gains focus from
      the <code class="code">"Explode Cart"</code> rule listed previously. This
      Agenda group has two rules, <code class="code">"Free Fish Food Sample"</code> and
      <code class="code">"Suggest Tank"</code>, shown below.</p><div class="example"><a id="d0e27447"/><p class="title"><strong>Example 23.56. Evaluate Agenda Group: extract from PetStore.drl</strong></p><div class="example-contents"><pre><code class="no-highlight">// Free Fish Food sample when we buy a Gold Fish if we haven't already bought 
// Fish Food and don't already have a Fish Food Sample
rule "Free Fish Food Sample"
    agenda-group "evaluate"
    dialect "mvel"
when
    $order : Order()
    not ( $p : Product( name == "Fish Food") &amp;amp;&amp;amp; Purchase( product == $p ) )
    not ( $p : Product( name == "Fish Food Sample") &amp;amp;&amp;amp; Purchase( product == $p ) )
    exists ( $p : Product( name == "Gold Fish") &amp;amp;&amp;amp; Purchase( product == $p ) )
    $fishFoodSample : Product( name == "Fish Food Sample" );
then
    System.out.println( "Adding free Fish Food Sample to cart" );
    purchase = new Purchase($order, $fishFoodSample);
    insert( purchase );
    $order.addItem( purchase ); 
end

// Suggest a tank if we have bought more than 5 gold fish and don't already have one
rule "Suggest Tank"
    agenda-group "evaluate"
    dialect "java"
when
    $order : Order()
    not ( $p : Product( name == "Fish Tank") &amp;amp;&amp;amp; Purchase( product == $p ) )
    ArrayList( $total : size &amp;gt; 5 ) from collect( Purchase( product.name == "Gold Fish" ) )
    $fishTank : Product( name == "Fish Tank" )
then
    requireTank(frame, kcontext.getKieRuntime(), $order, $fishTank, $total); 
end
</code></pre></div></div><br class="example-break"/><p>The rule <code class="code">"Free Fish Food Sample"</code> will only fire if</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>we <span class="emphasis"><em>don't </em></span>already have any fish food, <span class="emphasis"><em>and</em></span></p></li><li class="listitem"><p>we <span class="emphasis"><em>don't</em></span> already have a free fish food sample,
          <span class="emphasis"><em>and</em></span></p></li><li class="listitem"><p>we <span class="emphasis"><em>do</em></span> have a Gold Fish in our order.</p></li></ul></div><p>If the rule does fire, it creates a new product (Fish Food Sample), and adds it to the
      order in Working Memory.</p><p>The rule <code class="code">"Suggest Tank"</code> will only fire if</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>we <span class="emphasis"><em>don't </em></span>already have a Fish Tank in our order,
          <span class="emphasis"><em>and</em></span></p></li><li class="listitem"><p>we <span class="emphasis"><em>do</em></span> have more than 5 Gold Fish Products
          in our order.</p></li></ul></div><p>If the rule does fire, it calls the <code class="code">requireTank()</code> function
      that we looked at earlier (showing a Dialog to the user, and adding a Tank to
      the order / working memory if confirmed). When calling the
      <span class="italic">requireTank</span>() function the rule passes
      the global <span class="italic">frame</span> variable so that the
      function has a handle to the Swing GUI.</p><p>The next rule we look at is <code class="code">"do checkout"</code>.</p><div class="example"><a id="d0e27518"/><p class="title"><strong>Example 23.57. Doing the Checkout - extract (6) from PetStore.drl</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "do checkout"
    dialect "java"
    when
    then
        doCheckout(frame, kcontext.getKieRuntime());
end</code></pre></div></div><br class="example-break"/><p>The rule <code class="code">"do checkout"</code> has <span class="bold"><strong>no
      agenda group set and no auto-focus attribute</strong></span>. As such, is is
      deemed part of the default (MAIN) agenda group. This group gets focus by
      default when all the rules in agenda-groups that explicitly had focus set
      to them have run their course.</p><p>There is no LHS to the rule, so the RHS will always call the
      <code class="code">doCheckout()</code> function. When calling the
      <code class="code">doCheckout()</code> function, the rule passes the global
      <code class="code">frame</code> variable to give the function a handle to the Swing GUI.
      As we saw earlier, the <code class="code">doCheckout()</code> function shows a
      confirmation dialog to the user. If confirmed, the function sets the focus
      to the <span class="italic">checkout</span> agenda-group, allowing
      the next lot of rules to fire.</p><div class="example"><a id="d0e27548"/><p class="title"><strong>Example 23.58. Checkout Rules: extract from PetStore.drl</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Gross Total"
    agenda-group "checkout"
    dialect "mvel"
when
   $order : Order( grossTotal == -1)
   Number( total : doubleValue )
       from accumulate( Purchase( $price : product.price ), sum( $price ) )
then
    modify( $order ) { grossTotal = total };
    textArea.append( "\ngross total=" + total + "\n" );
end

rule "Apply 5% Discount"
    agenda-group "checkout"
dialect "mvel"
when
   $order : Order( grossTotal &amp;gt;= 10 &amp;amp;&amp;amp; &amp;lt; 20 )
then
   $order.discountedTotal = $order.grossTotal * 0.95;
   textArea.append( "discountedTotal total=" + $order.discountedTotal + "\n" );
end


rule "Apply 10% Discount"
    agenda-group "checkout"
    dialect "mvel"
when
   $order : Order( grossTotal &amp;gt;= 20 )
then
   $order.discountedTotal = $order.grossTotal * 0.90;
   textArea.append( "discountedTotal total=" + $order.discountedTotal + "\n" );
end
</code></pre></div></div><br class="example-break"/><p>There are three rules in the <span class="italic">checkout</span> agenda-group:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If we haven't already calculated the gross total, <code class="code">Gross Total</code> accumulates the product
        prices into a total, puts this total into the session, and displays it via the Swing <code class="code">JTextArea</code>,
        using the <code class="code">textArea</code> global variable yet again.</p></li><li class="listitem"><p>If our gross total is between 10 and 20, <code class="code">"Apply 5% Discount"</code> calculates the discounted
        total and adds it to the session and displays it in the text area.</p></li><li class="listitem"><p>If our gross total is not less than 20, <code class="code">"Apply 10% Discount"</code> calculates the discounted
        total and adds it to the session and displays it in the text area.</p></li></ul></div><p>Now that we've run through what happens in the code, let's have a
      look at what happens when we actually run the code. The file
      <code class="filename">PetStore.java</code> contains a <code class="code">main()</code> method,
      so that it can be run as a standard Java application, either from the
      command line or via the IDE. This assumes you have your classpath set
      correctly. (See the start of the examples section for more information.)</p><p>The first screen that we see is the Pet Store Demo. It has a list
      of available products (top left), an empty list of selected products
      (top right), checkout and reset buttons (middle) and an empty system
      messages area (bottom).</p><div class="figure"><a id="d0e27593"/><p class="title"><strong>Figure 23.13. PetStore Demo just after Launch</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/PetStoreExample/1-PetStore-Start-Screen.png" alt="PetStore Demo just after Launch"/></div></div></div><br class="figure-break"/><p>To get to this point, the following things have happened:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The <code class="code">main()</code> method has run and loaded the Rule Base
          <span class="emphasis"><em>but not yet fired the rules</em></span>. So far, this is the
          only code in connection with rules that has been run.</p></li><li class="listitem"><p>A new <code class="code">PetStoreUI</code> object has been created and given a
          handle to the Rule Base, for later use.</p></li><li class="listitem"><p>Various Swing components do their stuff, and the above screen
          is shown and <span class="emphasis"><em>waits for user input</em></span>.</p></li></ol></div><p>Clicking on various products from the list might give you a
      screen similar to the one below.</p><div class="figure"><a id="d0e27625"/><p class="title"><strong>Figure 23.14. PetStore Demo with Products Selected</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/PetStoreExample/2-stock-added-to-order-list.png" alt="PetStore Demo with Products Selected"/></div></div></div><br class="figure-break"/><p>Note that <span class="emphasis"><em>no rules code has been fired here</em></span>. This
      is only Swing code, listening for mouse click events, and adding some
      selected product to the <code class="code">TableModel</code> object for display in the
      top right hand section. (As an aside, note that this is a classic use of
      the Model View Controller design pattern).</p><p>It is only when we press the "Checkout" button that we fire our
      business rules, in roughly the same order that we walked through the
      code earlier.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Method <code class="code">CheckOutCallBack.checkout()</code> is called
          (eventually) by the Swing class waiting for the click on the
          "Checkout" button. This inserts the data from the
          <code class="code">TableModel</code> object (top right hand side of the GUI),
          and inserts it into the Session's Working Memory. It then fires
          the rules.</p></li><li class="listitem"><p>The <code class="code">"Explode Cart"</code> rule is the first to fire,
          given that it has <code class="literal">auto-focus</code> set to true. It loops through
          all the products in the cart, ensures that the products are in the
          Working Memory, and then gives the <code class="code">"Show Items"</code> and
          <code class="code">Evaluation</code> agenda groups a chance to fire. The rules
          in these groups add the contents of the cart to the text area
          (at the bottom of the window), decide whether or not to give us free
          fish food, and to ask us whether we want to buy a fish tank. This
          is shown in the figure below.</p></li></ol></div><div class="figure"><a id="d0e27666"/><p class="title"><strong>Figure 23.15. Do we want to buy a fish tank?</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/PetStoreExample/3-purchase-suggestion.png" alt="Do we want to buy a fish tank?"/></div></div></div><br class="figure-break"/><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The <span class="italic">Do Checkout</span> rule is the next to fire as it (a) No other agenda group currently has focus and (b) it is part of the default (MAIN) agenda group. It always calls the<span class="italic"> doCheckout() function </span>which displays a 'Would you like to Checkout?' Dialog Box.</p></li><li class="listitem"><p>The <code class="code">doCheckout()</code> function sets the focus to the
          <code class="code">checkout</code> agenda-group, giving the rules in that group
          the option to fire.</p></li><li class="listitem"><p>The rules in the the <code class="code">checkout</code> agenda-group display
          the contents of the cart and apply the appropriate discount.</p></li><li class="listitem"><p><span class="emphasis"><em>Swing then waits for user input</em></span> to either
          checkout more products (and to cause the rules to fire again), or to
          close the GUI - see the figure below.</p></li></ol></div><div class="figure"><a id="d0e27702"/><p class="title"><strong>Figure 23.16. Petstore Demo after all rules have fired.</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/PetStoreExample/4-Petstore-final-screen.png" alt="Petstore Demo after all rules have fired."/></div></div></div><br class="figure-break"/><p>We could add more System.out calls to demonstrate this flow of
      events. The output, as it currently appears in the Console window, is
      given in the listing below.</p><div class="example"><a id="d0e27710"/><p class="title"><strong>Example 23.59. Console (System.out) from running the PetStore GUI</strong></p><div class="example-contents"><pre><code class="no-highlight">Adding free Fish Food Sample to cart 
SUGGESTION: Would you like to buy a tank for your 6 fish? - Yes</code></pre></div></div><br class="example-break"/></div><div class="section" title="23.8. Honest Politician Example"><div class="titlepage"><div><div><h2 class="title"><a id="d0e27716"/>23.8. Honest Politician Example</h2></div></div></div><pre><code class="no-highlight"><span class="bold"><strong>Name:</strong></span> Honest Politician
<span class="bold"><strong>Main class:</strong></span> org.drools.examples.honestpolitician.HonestPoliticianExample
<span class="bold"><strong>Module:</strong></span> drools-examples
<span class="bold"><strong>Type:</strong></span> Java application
<span class="bold"><strong>Rules file:</strong></span> HonestPoliticianExample.drl
<span class="bold"><strong>Objective:</strong></span> Illustrate the concept of "truth maintenance" based on the logical insertion of facts
</code></pre><p>The Honest Politician example demonstrates truth maintenance with
  logical assertions. The basic premise is that an object can only exist
  while a statement is true. A rule's consequence can logically insert an 
  object with the <code class="code">insertLogical()</code> method. This means the object
  will only remain in the Working Memory as long as the rule that logically
  inserted  it remains true. When the rule is no longer true the object is
  automatically retracted.</p><p>In this example there is the class <code class="code">Politician</code>, with a
  name and a boolean value for being honest. Four politicians with honest
  state set to true are inserted.</p><div class="example"><a id="d0e27748"/><p class="title"><strong>Example 23.60. Class Politician</strong></p><div class="example-contents"><pre><code class="language-java">public class Politician {
    private String name;
    private boolean honest;
    ...
}</code></pre></div></div><br class="example-break"/><div class="example"><a id="d0e27753"/><p class="title"><strong>Example 23.61. Honest Politician: Execution</strong></p><div class="example-contents"><pre><code class="language-java">Politician blair = new Politician("blair", true);
Politician bush = new Politician("bush", true);
Politician chirac = new Politician("chirac", true);
Politician schroder = new Politician("schroder", true);
    
ksession.insert( blair );
ksession.insert( bush );
ksession.insert( chirac );
ksession.insert( schroder );

ksession.fireAllRules();</code></pre></div></div><br class="example-break"/><p>The Console window output shows that, while there is at
    least one honest politician, democracy lives. However, as each
    politician is in turn corrupted by an evil corporation, so that
    all politicians become dishonest, democracy is dead.</p><div class="example"><a id="d0e27760"/><p class="title"><strong>Example 23.62. Honest Politician: Console Output</strong></p><div class="example-contents"><pre><code class="no-highlight">Hurrah!!! Democracy Lives
I'm an evil corporation and I have corrupted schroder
I'm an evil corporation and I have corrupted chirac
I'm an evil corporation and I have corrupted bush
I'm an evil corporation and I have corrupted blair
We are all Doomed!!! Democracy is Dead
</code></pre></div></div><br class="example-break"/><p>As soon as there is at least one honest politician in the
    Working Memory a new <code class="code">Hope</code> object is logically asserted.
    This object will only exist while there is at least one honest
    politician. As soon as all politicians are dishonest, the
    <code class="code">Hope</code> object will be automatically retracted. This rule
    is given a salience of 10 to ensure that it fires before any other
    rule, as at this stage the "Hope is Dead" rule is actually true.</p><div class="example"><a id="d0e27773"/><p class="title"><strong>Example 23.63. Honest Politician: Rule "We have an honest politician"</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "We have an honest Politician"
    salience 10
    when
        exists( Politician( honest == true ) )
    then
        insertLogical( new Hope() );
end</code></pre></div></div><br class="example-break"/><p>As soon as a <code class="code">Hope</code> object exists the "Hope Lives" rule
  matches and fires. It has a salience of 10 so that it takes priority
  over "Corrupt the Honest".</p><div class="example"><a id="d0e27783"/><p class="title"><strong>Example 23.64. Honest Politician: Rule "Hope Lives"</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Hope Lives"
    salience 10
        when
            exists( Hope() )
        then
            System.out.println("Hurrah!!! Democracy Lives");
end</code></pre></div></div><br class="example-break"/><p>Now that there is hope and we have, at the start, four honest
    politicians, we have four activations for this rule, all in conflict.
    They will fire in turn, corrupting each politician so that they are
    no longer honest. When all four politicians have been corrupted we
    have no politicians with the property <code class="code">honest == true</code>.
    Thus, the rule "We have an honest Politician" is no longer true and
    the object it logical inserted (due to the last execution of
    <code class="code">new Hope()</code>) is automatically retracted.</p><div class="example"><a id="d0e27796"/><p class="title"><strong>Example 23.65. Honest Politician: Rule "Corrupt the Honest"</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Corrupt the Honest"
    when
        politician : Politician( honest == true )   
        exists( Hope() )
    then
        System.out.println( "I'm an evil corporation and I have corrupted " + politician.getName() );
        modify ( politician ) { honest = false };
end</code></pre></div></div><br class="example-break"/><p>With the <code class="code">Hope</code> object being automatically retracted,
    via the truth maintenance system, the conditional element <code class="literal">not</code>
    applied to <code class="code">Hope</code> is no longer true so that the following
    rule will match and fire.</p><div class="example"><a id="d0e27812"/><p class="title"><strong>Example 23.66. Honest Politician: Rule "Hope is Dead"</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Hope is Dead"
    when
        not( Hope() )
    then
        System.out.println( "We are all Doomed!!! Democracy is Dead" );
end</code></pre></div></div><br class="example-break"/><p>Let's take a look at the Audit trail for this application:</p><div class="figure"><a id="d0e27819"/><p class="title"><strong>Figure 23.17. Honest Politician Example Audit View</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/HonestPoliticianExample/honest_politician_audit.png" alt="Honest Politician Example Audit View"/></div></div></div><br class="figure-break"/><p>The moment we insert the first politician we have two activations.
    The rule "We have an honest Politician" is activated only once for the first
    inserted politician because it uses an <code class="literal">exists</code> conditional
    element, which matches once for any number. The rule "Hope is Dead" is
    also activated at this stage, because we have not yet inserted the
    <code class="code">Hope</code> object. Rule "We have an honest Politician" fires first,
    as it has a higher salience than "Hope is Dead", which inserts the
    <code class="code">Hope</code> object. (That action is highlighted green.) The
    insertion of the <code class="code">Hope</code> object activates "Hope Lives" and
    de-activates "Hope is Dead"; it also activates "Corrupt the Honest"
    for each inserted honest politician. Rule "Hope Lives" executes,
    printing  "Hurrah!!! Democracy Lives". Then, for each politician, rule
    "Corrupt the Honest" fires, printing "I'm an evil corporation and I
    have corrupted X", where X is the name of the politician, and modifies
    the politician's honest value to false. When the last honest politician
    is corrupted, <code class="code">Hope</code> is automatically retracted, by the truth
    maintenance system, as shown by the blue highlighted area. The green
    highlighted area shows the origin of the currently selected blue
    highlighted area. Once the <code class="code">Hope</code> fact is retracted, "Hope is
    dead" activates and fires printing "We are all Doomed!!! Democracy is
    Dead".</p></div><div class="section" title="23.9. Sudoku Example"><div class="titlepage"><div><div><h2 class="title"><a id="d0e27845"/>23.9. Sudoku Example</h2></div></div></div><pre><code class="no-highlight"><span class="bold"><strong>Name:</strong></span> Sudoku
<span class="bold"><strong>Main class:</strong></span> org.drools.examples.sudoku.SudokuExample
<span class="bold"><strong>Type:</strong></span> Java application
<span class="bold"><strong>Rules file:</strong></span> sudoku.drl, validate.drl
<span class="bold"><strong>Objective:</strong></span> Demonstrates the solving of logic problems, and complex pattern matching.
</code></pre><p>This example demonstrates how Drools can be used to find a solution
    in a large potential solution space based on a number of constraints. We
    use the popular puzzle of Sudoku. This example also shows how Drools can
    be integrated into a graphical interface and how callbacks can be used to
    interact with a running Drools rules engine in order to update the
    graphical interface based on changes in the Working Memory at
    runtime.</p><div class="section" title="23.9.1. Sudoku Overview"><div class="titlepage"><div><div><h3 class="title"><a id="d0e27866"/>23.9.1. Sudoku Overview</h3></div></div></div><p>Sudoku is a logic-based number placement puzzle. The objective is
      to fill a 9x9 grid so that each column, each row, and each of the nine
      3x3 zones contains the digits from 1 to 9, once, and only once.</p><p>The puzzle setter provides a partially completed grid and the
      puzzle solver's task is to complete the grid with these
      constraints.</p><p>The general strategy to solve the problem is to ensure that when
      you insert a new number it should be unique in its particular
      3x3 zone, row and column.</p><p>See <a class="link" href="http://en.wikipedia.org/wiki/Sudoku">Wikipedia</a>
      for a more detailed description.</p></div><div class="section" title="23.9.2. Running the Example"><div class="titlepage"><div><div><h3 class="title"><a id="d0e27880"/>23.9.2. Running the Example</h3></div></div></div><p>Download and install drools-examples as described above and then
      execute <code class="filename">java org.drools.examples.DroolsExamplesApp</code> and
      click on "SudokuExample".</p><p>The window contains an empty grid, but the program comes with a number of grids stored
      internally which can be loaded and solved. Click on "File", then "Samples" and select "Simple"
      to load one of the examples. Note that all buttons are disabled until a grid is loaded. 
      </p><div class="figure"><a id="d0e27890"/><p class="title"><strong>Figure 23.18. Initial screen</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Examples/SudokuExample/sudoku1.png" alt="Initial screen"/></div></div></div></div><p><br class="figure-break"/>
    </p><p>Loading the "Simple" example fills the grid according to the
        puzzle's initial state. </p><div class="figure"><a id="d0e27900"/><p class="title"><strong>Figure 23.19. After loading "Simple"</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Examples/SudokuExample/sudoku2.png" alt="After loading &#34;Simple&#34;"/></div></div></div></div><p><br class="figure-break"/></p><p>Click on the "Solve" button and the Drools-based engine will fill
      out the remaining values, and the buttons are inactive once
      more.</p><div class="figure"><a id="d0e27909"/><p class="title"><strong>Figure 23.20. "Simple" Solved</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Examples/SudokuExample/sudoku3.png" alt="&#34;Simple&#34; Solved"/></div></div></div></div><p><br class="figure-break"/></p><p>Alternatively, you may click on the "Step" button to see the next
      digit found by the rule set. The Console window will display detailed
      information about the rules which are executing to solve the step
      in a human readable form. Some examples of these messages are
      presented below.</p><pre class="screen">
single 8 at [0,1]
column elimination due to [1,2]: remove 9 from [4,2]
hidden single 9 at [1,2]
row elimination due to [2,8]: remove 7 from [2,4]
remove 6 from [3,8] due to naked pair at [3,2] and [3,7]
hidden pair in row at [4,6] and [4,4]
</pre><p>Click on the "Dump" button to see the state of the grid, with
      cells showing either the established value or the remaining 
      possibilitiescandidates.</p><pre class="screen">
       Col: 0     Col: 1     Col: 2     Col: 3     Col: 4     Col: 5     Col: 6     Col: 7     Col: 8     
Row 0:   2 4  7 9   2 456        4567 9   23 56  9  --- 5 ---  --- 1 ---    3  67 9  --- 8 ---     4 67   
Row 1:  12    7 9  --- 8 ---  1    67 9   23  6  9  --- 4 ---   23  67    1 3  67 9    3  67 9  --- 5 --- 
Row 2:  1  4  7 9  1  456     --- 3 ---      56 89      5 78       5678   --- 2 ---     4 67 9  1  4 67   
Row 3:  1234       12345      1  45      12  5  8   --- 6 ---   2  5 78       5 78      45 7    --- 9 --- 
Row 4:  --- 6 ---  --- 7 ---      5      --- 4 ---   2  5  8   --- 9 ---      5  8   --- 1 ---  --- 3 --- 
Row 5:  --- 8 ---  12 45      1  45   9  12  5      --- 3 ---   2  5 7        567       4567     2 4 67   
Row 6:  1 3   7    1 3  6     --- 2 ---    3 56 8       5  8     3 56 8   --- 4 ---    3 567 9  1    678  
Row 7:  --- 5 ---  1 34 6     1  4 678     3  6 8   --- 9 ---    34 6 8   1 3  678   --- 2 ---  1    678  
Row 8:    34       --- 9 ---     4 6 8   --- 7 ---  --- 1 ---   23456 8     3 56 8     3 56          6 8  
</pre><p>Now, let us load a Sudoku grid that is deliberately invalid. Click
      on "File", "Samples" and "!DELIBERATELY BROKEN!". Note that this grid
      starts with some issues, for example the value 5 appears twice in the
      first row.</p><div class="figure"><a id="d0e27928"/><p class="title"><strong>Figure 23.21. Broken initial state</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Examples/SudokuExample/sudoku4.png" alt="Broken initial state"/></div></div></div></div><p><br class="figure-break"/></p><p>A few simple rules perform a sanity check, right after loading
      a grid. In this case, the following messages are printed on
      standard output:</p><pre class="screen">
cell [0,8]: 5 has a duplicate in row 0
cell [0,0]: 5 has a duplicate in row 0
cell [6,0]: 8 has a duplicate in col 0
cell [4,0]: 8 has a duplicate in col 0
Validation complete.
</pre><p>Nevertheless, click on the "Solve" button to apply the solving
      rules to this invalid grid. This will not complete; some cells
      remain empty. </p><div class="figure"><a id="d0e27942"/><p class="title"><strong>Figure 23.22. Broken "solved" state</strong></p><div class="figure-contents"><div class="screenshot"><div class="mediaobject"><img src="images/Examples/SudokuExample/sudoku5.png" alt="Broken &#34;solved&#34; state"/></div></div></div></div><p><br class="figure-break"/></p><p>The solving functionality has been achieved by the use of
      rules that implement standard solving techniques. They are based
      on the sets of values that are still candidates for a cell. If,
      for instance, such a set contains a single value, then this is
      the value for the cell. A little less obvious is the single
      occurrence of a value in one of the groups of nine cells. The
      rules detecting these situations insert a fact of type Setting
      with the solution value for some specific cell. This fact causes the
      elimination of this value from all other cells in any of the
      groups the cell belongs to. Finally, it is retracted.</p><p>Other rules merely reduce the permissible values for some
      cells. Rules "naked pair", "hidden pair in row", "hidden pair in column"
      and "hidden pair in square" merely eliminate possibilities but
      do not establish solutions. More sophisticated eliminations are done by
      "X-wings in rows", "X-wings in columns", "intersection removal row" and
      "intersection removal column".</p></div><div class="section" title="23.9.3. Java Source and Rules Overview"><div class="titlepage"><div><div><h3 class="title"><a id="d0e27953"/>23.9.3. Java Source and Rules Overview</h3></div></div></div><p>The Java source code can be found in the
      /src/main/java/org/drools/examples/sudoku directory, with the two DRL
      files defining the rules located in the
      /src/main/rules/org/drools/examples/sudoku directory.</p><p>The package <code class="code">org.drools.examples.sudoku.swing</code>
      contains a set of classes which implement a framework for Sudoku
      puzzles. Note that this package does not have any dependencies on
      the Drools libraries. <code class="code">SudokuGridModel</code> defines an
      interface which can be implemented to store a Sudoku puzzle as a 9x9
      grid of <code class="code">Cell</code> objects. <code class="code">SudokuGridView</code> is
      a Swing component which can visualize any implementation of
      <code class="code">SudokuGridModel</code>. <code class="code">SudokuGridEvent</code> and
      <code class="code">SudokuGridListener</code> are used to
      communicate state changes between the model and the view: events are
      fired when a cell's value is resolved or changed. If you are familiar
      with the model-view-controller patterns in other Swing components such
      as <code class="code">JTable</code> then this pattern should be familiar.
      <code class="code">SudokuGridSamples</code> provides a number of partially filled
      Sudoku puzzles for demonstration purposes.</p><p>Package <code class="code">org.drools.examples.sudoku.rules</code> contains a
      utility class with a method for compiling DRL files.</p><p>The package <code class="code">org.drools.examples.sudoku</code> contains a
      set of classes implementing the elementary <code class="code">Cell</code> object
      and its various aggregations: the <code class="code">CellFile</code> subtypes
      <code class="code">CellRow</code> and <code class="code">CellCol</code> as well as
      <code class="code">CellSqr</code>, all of which are subtypes of
      <code class="code">CellGroup</code>. It's interesting to note that <code class="code">Cell</code>
      and <code class="code">CellGroup</code> are subclasses of <code class="code">SetOfNine</code>,
      which provides a property <code class="code">free</code> with the
      type <code class="code">Set&lt;Integer&gt;</code>. For a <code class="code">Cell</code> it
      represents the individual candidate set; for a <code class="code">CellGroup</code>
      the set is the union of all candidate sets of its cells, or, simply,
      the set of digits that still need to be allocated.</p><p>With 81 <code class="code">Cell</code> and 27 <code class="code">CellGroup</code> objects and
      the linkage provided by the <code class="code">Cell</code> properties 
      <code class="code">cellRow</code>, <code class="code">cellCol</code> and <code class="code">cellSqr</code>
      and the <code class="code">CellGroup</code> property <code class="code">cells</code>, a list of
      <code class="code">Cell</code> objects, it is possible to write rules that
      detect the specific situations that permit the allocation of a
      value to a cell or the elimination of a value from some candidate 
      set.</p><p>An object of class <code class="code">Setting</code> is used for triggering
      the operations that accompany the allocation of a value: its removal
      from the candidate sets of sibling cells and associated cell groups.
      Moreover, the presence of a <code class="code">Setting</code> fact is used in
      all rules that should detect a new situation; this is to avoid
      reactions to inconsistent intermediary states.</p><p>An object of class <code class="code">Stepping</code> is used in a
      low priority rule to execute an emergency halt when a "Step"
      does not terminate regularly. This indicates that the puzzle
      cannot be solved by the program.</p><p>The class <code class="code">org.drools.examples.sudoku.SudokuExample</code>
      implements a Java application combining the components described.</p></div><div class="section" title="23.9.4. Sudoku Validator Rules (validate.drl)"><div class="titlepage"><div><div><h3 class="title"><a id="d0e28083"/>23.9.4. Sudoku Validator Rules (validate.drl)</h3></div></div></div><p>Validation rules detect duplicate numbers in cell groups.
      They are combined in an agenda group which enables us to activate
      them, explicitly, after loading a puzzle.</p><p>The three rules "duplicate in cell..." are very similar.
      The first pattern locates a cell with an allocated value. The second
      pattern pulls in any of the three cell groups the cell belongs to.
      The final pattern would find a cell (other than the first one) with
      the same value as the first cell and in the same row, column or
      square, respectively.</p><p>Rule "terminate group" fires last. It prints a message and
      calls halt.</p></div><div class="section" title="23.9.5. Sudoku Solving Rules (sudoku.drl)"><div class="titlepage"><div><div><h3 class="title"><a id="d0e28092"/>23.9.5. Sudoku Solving Rules (sudoku.drl)</h3></div></div></div><p>There are three types of rules in this file: one group
      handles the allocation of a number to a cell, another group
      detects feasible allocations, and the third group eliminates
      values from candidate sets.</p><p>Rules  "set a value", "eliminate a value from Cell" and
      "retract setting" depend on the presence of a <code class="code">Setting</code>
      object. The first rule handles the assignment to the cell and the
      operations for removing the value from the "free" sets of the 
      cell's three groups. Also, it decrements a counter that, when
      zero, returns control to the Java application that has called
      <code class="code">fireUntilHalt()</code>. The purpose of rule
      "eliminate a value from Cell" is to reduce the candidate lists
      of all cells that are related to the newly assigned cell. Finally,
      when all eliminations have been made, rule "retract setting"
      retracts the triggering <code class="code">Setting</code> fact.</p><p>There are just two rules that detect a situation where an
      allocation of a number to a cell is possible. Rule "single" fires
      for a <code class="code">Cell</code> with a candidate set containing a single
      number. Rule "hidden single" fires when there is no cell with a
      single candidate but when there is a cell containing a candidate but  
      this candidate is absent from all other cells in one of the three
      groups the cell belongs to. Both rules create and insert a
      <code class="code">Setting</code> fact.</p><p>Rules from the largest group of rules implement, singly or
      in groups of two or three, various solving techniques, as they are
      employed when solving Sudoku puzzles manually.</p><p>Rule "naked pair" detects identical candidate sets of size 2
      in two cells of a group; these two values may be removed from all
      other candidate sets of that group.</p><p>A similar idea motivates the three rules "hidden pair in...";
      here, the rules look for a subset of two numbers in exactly two cells
      of a group, with neither value occurring in any of the other cells of
      this group. This, then, means that all other candidates can be
      eliminated from the two cells harbouring the hidden pair.</p><p>A pair of rules deals with "X-wings" in rows and columns.
      When there are only two possible cells for a value in each of
      two different rows (or columns) and these candidates lie also
      in the same columns (or rows), then all other candidates for 
      this value in the columns (or rows) can be eliminated. If you
      follow the pattern sequence in one of these rules, you will see
      how the conditions that are conveniently expressed by words such as
      "same" or "only" result in patterns with suitable constraints
      or prefixed with "not".</p><p>The rule pair "intersection removal..." is based on the
      restricted occurrence of some number within one square, either
      in a single row or in a single column. This means that this number
      must be in one of those two or three cells of the row or column;
      hence it can be removed from the candidate sets of all other cells
      of the group. The pattern establishes the restricted occurrence
      and then fires for each cell outside the square and within the
      same cell file.</p><p>These rules are sufficient for many but certainly not for all
      Sudoku puzzles. To solve very difficult grids, the rule set would
      need to be extended with more complex rules. (Ultimately, there
      are puzzles that cannot be solved except by trial and error.)</p></div></div><div class="section" title="23.10. Number Guess"><div class="titlepage"><div><div><h2 class="title"><a id="d0e28128"/>23.10. Number Guess</h2></div></div></div><pre><code class="no-highlight"><span class="bold"><strong>Name:</strong></span> Number Guess
<span class="bold"><strong>Main class:</strong></span> org.drools.examples.numberguess.NumberGuessExample
<span class="bold"><strong>Module:</strong></span> droolsjbpm-integration-examples (Note: this is in a different download, the droolsjbpm-integration download.)
<span class="bold"><strong>Type:</strong></span> Java application
<span class="bold"><strong>Rules file:</strong></span> NumberGuess.drl
<span class="bold"><strong>Objective:</strong></span> Demonstrate use of Rule Flow to organise Rules
</code></pre><p>The "Number Guess" example shows the use of Rule Flow, a way of controlling the order in which rules are fired.
  It uses widely understood workflow diagrams for defining the order in which groups of rules will be executed.</p><div class="example"><a id="d0e28152"/><p class="title"><strong>Example 23.67. Creating the Number Guess RuleBase: NumberGuessExample.main() - part 1</strong></p><div class="example-contents"><pre><code class="language-java">final KnowledgeBuilder kbuilder = KnowledgeBuilderFactory.newKnowledgeBuilder();
kbuilder.add( ResourceFactory.newClassPathResource( "NumberGuess.drl",
                                                    ShoppingExample.class ),
              ResourceType.DRL );
kbuilder.add( ResourceFactory.newClassPathResource( "NumberGuess.rf",
                                                    ShoppingExample.class ),
              ResourceType.DRF );

final KnowledgeBase kbase = KnowledgeBaseFactory.newKnowledgeBase();
kbase.addKnowledgePackages( kbuilder.getKnowledgePackages() );</code></pre></div></div><br class="example-break"/><p>The creation of the package and the loading of the rules (using the <code class="code">add()</code> method) is the same as
  the previous examples. There is an additional line to add the Rule Flow (<code class="filename">NumberGuess.rf</code>), which
  provides the option of specifying different rule flows for the same Knowledge Base. Otherwise, the Knowledge Base is
  created in the same manner as before.</p><div class="example"><a id="d0e28165"/><p class="title"><strong>Example 23.68. Starting the RuleFlow: NumberGuessExample.main() - part 2</strong></p><div class="example-contents"><pre><code class="language-java">final StatefulKnowledgeSession ksession = kbase.newStatefulKnowledgeSession();

KnowledgeRuntimeLogger logger =
  KnowledgeRuntimeLoggerFactory.newFileLogger(ksession, "log/numberguess");

ksession.insert( new GameRules( 100, 5 ) );
ksession.insert( new RandomNumber() );
ksession.insert( new Game() );

ksession.startProcess( "Number Guess" );
ksession.fireAllRules();

logger.close();

ksession.dispose();</code></pre></div></div><br class="example-break"/><p>Once we have a Knowledge Base, we can use it to obtain a Stateful Session. Into our session we insert our facts,
  i.e., standard Java objects. (For simplicity, in this sample, these classes are all contained within our
  <code class="filename">NumberGuessExample.java</code> file. Class <code class="code">GameRules</code> provides the maximum range and the
  number of guesses allowed. Class <code class="code">RandomNumber</code> automatically generates a number between 0 and 100 and
  makes it available to our rules, by insertion via the <code class="code">getValue()</code> method. Class <code class="code">Game</code> keeps
  track of the guesses we have made before, and their number.</p><p>Note that before we call the standard <code class="code">fireAllRules()</code> method, we also start the process that we
  loaded earlier, via the <code class="code">startProcess()</code> method. We'll learn where to obtain the parameter we pass ("Number
  Guess", i.e., the identifier of the rule flow) when we talk about the rule flow file and the graphical Rule Flow
  Editor below.</p><p>Before we finish the discussion of our Java code, we note that in some real-life application we would examine
  the final state of the objects. (Here, we could retrieve the number of guesses, to add it to a high score table.) For
  this example we are content to ensure that the Working Memory session is cleared by calling the <code class="code">dispose()</code>
  method.</p><div class="figure"><a id="d0e28200"/><p class="title"><strong>Figure 23.23. RuleFlow for the NumberGuess Example</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/NumberGuessExample/numberguess-ruleflow.png" alt="RuleFlow for the NumberGuess Example"/></div></div></div><br class="figure-break"/><p>If you open the <code class="filename">NumberGuess.rf</code> file in the Drools IDE (provided you have the JBoss Rules
  extensions installed correctly in Eclipse) you should see the above diagram, similar to a standard flowchart. Its
  icons are similar (but not exactly the same) as in the JBoss jBPM workflow product. Should you wish to edit the
  diagram, a menu of available components should be available to the left of the diagram in the IDE, which is called the
  <span class="emphasis"><em>palette</em></span>. This diagram is saved in XML, an (almost) human readable format, using XStream.</p><p>If it is not already open, ensure that the Properties View is visible in the IDE. It can be opened by clicking
  "Window", then "Show View" and "Other", where you can select the "Properties" view. If you do this
  <span class="emphasis"><em>before</em></span> you select any item on the rule flow (or click on the blank space in the rule flow) you
  should be presented with the following set of properties.</p><div class="figure"><a id="d0e28219"/><p class="title"><strong>Figure 23.24. Properties for the Number Guess Rule Flow</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/NumberGuessExample/numberguess-ruleflow-properties.png" alt="Properties for the Number Guess Rule Flow"/></div></div></div><br class="figure-break"/><p>Keep an eye on the Properties View as we progress through the example's rule flow, as it presents valuable
  information. In this case, it provides us with the identification of the Rule Flow Process that we used in our earlier
  code snippet, when we called <code class="code">session.startProcess()</code>.</p><p>In the "Number Guess" Rule Flow we encounter several node types, many of them identified by an icon.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The Start node (white arrow in a green circle) and the End node (red box) mark beginning and end of the
        rule flow.</p></li><li class="listitem"><p>A Rule Flow Group box (yellow, without an icon) represents a Rule Flow Groups defined in our rules (DRL)
        file that we will look at later. For example, when the flow reaches the Rule Flow Group "Too High", only those
        rules marked with an attribute of <code class="literal">ruleflow-group</code> <code class="code">"Too High"</code> can potentially
        fire.</p></li><li class="listitem"><p>Action nodes (yellow, cog-shaped icon) perform standard Java method calls. Most action nodes in this
        example call <code class="code">System.out.println()</code>, indicating the program's progress to the user.</p></li><li class="listitem"><p>Split and Join Nodes (blue ovals, no icon) such as "Guess Correct?" and "More guesses Join" mark places
        where the flow of control can split, according to various conditions, and rejoin, respectively</p></li><li class="listitem"><p>Arrows indicate the flow between the various nodes.</p></li></ul></div><p>The various nodes in combination with the rules make the Number Guess game work. For example, the "Guess" Rule
  Flow Group allows only the rule "Get user Guess" to fire, because only that rule has a matching attribute of
  <code class="literal">ruleflow-group</code> <code class="code">"Guess"</code>.</p><div class="example"><a id="d0e28266"/><p class="title"><strong>Example 23.69. A Rule firing only at a specific point in the Rule Flow: NumberGuess.drl</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Get user Guess"
    ruleflow-group "Guess"
    no-loop
    when
        $r : RandomNumber()
        rules : GameRules( allowed : allowedGuesses )
        game : Game( guessCount &lt; allowed )
        not ( Guess() )
    then
        System.out.println( "You have " + ( rules.allowedGuesses - game.guessCount )
                            + " out of " + rules.allowedGuesses
                            + " guesses left.\nPlease enter your guess from 0 to "
                            + rules.maxRange );
        br = new BufferedReader( new InputStreamReader( System.in ) );
        i = br.readLine();        
        modify ( game ) { guessCount = game.guessCount + 1 }
        insert( new Guess( i ) );
end</code></pre></div></div><br class="example-break"/><p>The rest of this rule is fairly standard. The LHS section (after <code class="literal">when</code>) of the rule states
  that it will be activated for each <code class="code">RandomNumber</code> object inserted into the Working Memory where
  <code class="code">guessCount</code> is less than <code class="code">allowedGuesses</code> from the <code class="code">GameRules</code> object and where the
  user has not guessed the correct number.</p><p>The RHS section (or consequence, after <code class="literal">then</code>) prints a message to the user and then awaits
  user input from <code class="code">System.in</code>. After obtaining this input (the <code class="code">readLine()</code> method call blocks
  until the return key is pressed) it modifies the guess count and inserts the new guess, making both available to the
  Working Memory.</p><p>The rest of the rules file is fairly standard: the package declares the dialect as MVEL, and various Java
  classes are imported. In total, there are five rules in this file:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Get User Guess, the Rule we examined above.</p></li><li class="listitem"><p>A Rule to record the highest guess.</p></li><li class="listitem"><p>A Rule to record the lowest guess.</p></li><li class="listitem"><p>A Rule to inspect the guess and retract it from memory if incorrect.</p></li><li class="listitem"><p>A Rule that notifies the user that all guesses have been used up.</p></li></ol></div><p>One point of integration between the standard Rules and the RuleFlow is via the
  <code class="literal">ruleflow-group</code> attribute on the rules, as discussed above. A <span class="emphasis"><em>second point of integration
  between the rules (.drl) file and the Rules Flow .rf files</em></span> is that the Split Nodes (the blue ovals) can use
  values in the Working Memory (as updated by the rules) to decide which flow of action to take. To see how this works,
  click on the "Guess Correct Node"; then within the Properties View, open the Constraints Editor by clicking the button
  at the right that appears once you click on the "Constraints" property line. You should see something similar to the
  diagram below.</p><div class="figure"><a id="d0e28325"/><p class="title"><strong>Figure 23.25. Edit Constraints for the "Guess Correct" Node</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/NumberGuessExample/numberguess-editconstraints.png" alt="Edit Constraints for the &#34;Guess Correct&#34; Node"/></div></div></div><br class="figure-break"/><p>Click on the "Edit" button beside "To node Too High" and you'll see a dialog like the one below. The values in
  the "Textual Editor" window follow the standard rule format for the LHS and can refer to objects in Working Memory.
  The consequence (RHS) is that the flow of control follows this node (i.e., "To node Too High") if the LHS expression
  evaluates to true.</p><div class="figure"><a id="d0e28333"/><p class="title"><strong>Figure 23.26. Constraint Editor for the "Guess Correct" Node: value too high</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/NumberGuessExample/numberguess-constraint-toohigh.png" alt="Constraint Editor for the &#34;Guess Correct&#34; Node: value too high"/></div></div></div><br class="figure-break"/><p>Since the file <code class="filename">NumberGuess.java</code> contains a <code class="code">main()</code> method, it can be run as a
  standard Java application, either from the command line or via the IDE. A typical game might result in the interaction
  below. The numbers in bold are typed in by the user.</p><div class="example"><a id="d0e28347"/><p class="title"><strong>Example 23.70. Example Console output where the Number Guess Example beat the human!</strong></p><div class="example-contents"><pre><code class="no-highlight">You have 5 out of 5 guesses left.
Please enter your guess from 0 to 100
<span class="bold"><strong>50</strong></span>
Your guess was too high
You have 4 out of 5 guesses left.
Please enter your guess from 0 to 100
<span class="bold"><strong>25</strong></span>
Your guess was too low
You have 3 out of 5 guesses left.
Please enter your guess from 0 to 100
<span class="bold"><strong>37</strong></span>
Your guess was too low
You have 2 out of 5 guesses left.
Please enter your guess from 0 to 100
<span class="bold"><strong>44</strong></span>
Your guess was too low
You have 1 out of 5 guesses left.
Please enter your guess from 0 to 100
<span class="bold"><strong>47</strong></span>
Your guess was too low
You have no more guesses
The correct guess was 48 

</code></pre></div></div><br class="example-break"/><p>A summary of what is happening in this sample is:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The <code class="code">main()</code> method of <code class="filename">NumberGuessExample.java</code> loads a Rule Base, creates a
      Stateful Session and inserts <code class="code">Game</code>, <code class="code">GameRules</code> and <code class="code">RandomNumber</code> (containing
      the target number) objects into it. The method also sets the process flow we are going to use, and fires all
      rules. Control passes to the Rule Flow.</p></li><li class="listitem"><p>File <code class="filename">NumberGuess.rf</code>, the Rule Flow, begins at the "Start" node.</p></li><li class="listitem"><p>Control passes (via the "More guesses" join node) to the Guess node.</p></li><li class="listitem"><p>At the Guess node, the appropriate Rule Flow Group ("Get user Guess") is enabled. In this case the Rule
      "Guess" (in the <code class="filename">NumberGuess.drl</code> file) is triggered. This rule displays a message to the user,
      takes the response, and puts it into Working Memory. Flow passes to the next Rule Flow Node.</p></li><li class="listitem"><p>At the next node, "Guess Correct", constraints inspect the current session and decide which path to
      take.</p><p>If the guess in step 4 was too high or too low, flow proceeds along a path which has an action node with
      normal Java code printing a suitable message and a Rule Flow Group causing a highest guess or lowest guess rule to
      be triggered. Flow passes from these nodes to step 6.</p><p>If the guess in step 4 was right, we proceed along the path towards the end of the Rule Flow. Before we get
      there, an action node with normal Java code prints a statement "you guessed correctly". There is a join node here
      (just before the Rule Flow end) so that our no-more-guesses path (step 7) can also terminate the Rule Flow.</p></li><li class="listitem"><p>Control passes as per the Rule Flow via a join node, a guess incorrect Rule Flow Group (triggering a rule to
      retract a guess from Working Memory) onto the "More guesses" decision node.</p></li><li class="listitem"><p>The "More guesses" decision node (on the right hand side of the rule flow) uses constraints, again looking
      at values that the rules have put into the working memory, to decide if we have more guesses and if so, goto step
      3. If not, we proceed to the end of the rule flow, via a Rule Flow Group that triggers a rule stating "you have no
      more guesses".</p></li><li class="listitem"><p>The loop over steps 3 to 7 continues until the number is guessed correctly, or we run out of guesses.</p></li></ol></div></div><div class="section" title="23.11. Conway's Game Of Life"><div class="titlepage"><div><div><h2 class="title"><a id="d0e28419"/>23.11. Conway's Game Of Life</h2></div></div></div><pre><code class="no-highlight"><span class="bold"><strong>Name:</strong></span> Conway's Game Of Life
<span class="bold"><strong>Main class:</strong></span> org.drools.examples.conway.ConwayAgendaGroupRun
            org.drools.examples.conway.ConwayRuleFlowGroupRun
<span class="bold"><strong>Module:</strong></span> droolsjbpm-integration-examples (Note: this is in a different download, the droolsjbpm-integration download.)
<span class="bold"><strong>Type:</strong></span> Java application
<span class="bold"><strong>Rules file:</strong></span> conway-ruleflow.drl conway-agendagroup.drl
<span class="bold"><strong>Objective:</strong></span> Demonstrates 'accumulate', 'collect' and 'from'</code></pre><p>Conway's Game Of Life, described in <a class="link" href="http://en.wikipedia.org/wiki/Conway's_Game_of_Life">http://en.wikipedia.org/wiki/Conway's_Game_of_Life</a> and in
    <a class="link" href="http://www.math.com/students/wonders/life/life.html">http://www.math.com/students/wonders/life/life.html</a>,
    is a famous cellular automaton conceived in the early 1970's by the
    mathematician John Conway. While the system is well known as "Conway's
    Game Of Life", it really isn't a game at all. Conway's system is more like
    a simulation of a form of life. Don't be intimidated. The system
    is terribly simple and terribly interesting. Math and Computer Science
    students alike have marvelled over Conway's system for more than 30 years
    now. The application
    presented here is a Swing-based implementation of Conway's Game of Life.
    The rules that govern the system are implemented as business rules using
    Drools. This document will explain the rules that drive the simulation and
    discuss the Drools parts of the implementation.</p><p>We'll first introduce the grid view, shown below, designed for the
    visualisation of the game, showing the "arena" where the life simulation
    takes place. Initially the grid is empty, meaning that there are no live
    cells in the system. Each cell is either alive or dead, with live cells
    showing a green ball. Preselected patterns of live cells can be
    chosen from the "Pattern" drop-down list. Alternatively, individual
    cells can be doubled-clicked to toggle them between live and dead. It's
    important to understand that each cell is related to its neighboring cells,
    which is fundamental for the game's rules. Neighbors include not only
    cells to the left, right, top and bottom but also cells that are connected
    diagonally, so that each cell has a total of 8 neighbors. Exceptions
    are the four corner cells which have only three neighbors, and the cells
    along the four border, with five neighbors each.</p><div class="figure"><a id="d0e28451"/><p class="title"><strong>Figure 23.27. Conway's Game of Life: Starting a new game</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/ConwaysGameOfLifeExample/conway1.png" alt="Conway's Game of Life: Starting a new game"/></div></div></div><br class="figure-break"/><p>So what are the basic rules that govern this game? Its goal is to
    show the development of a population, generation by generation. Each
    generation results from the preceding one, based on the simultaneous
    evaluation of all cells. This is the simple set of rules that
    govern what the next generation will look like:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If a live cell has fewer than 2 live neighbors, it dies of
        loneliness.</p></li><li class="listitem"><p>If a live cell has more than 3 live neighbors, it dies from
        overcrowding.</p></li><li class="listitem"><p>If a dead cell has exactly 3 live neighbors, it comes to
        life.</p></li></ul></div><p>That is all there is to it. Any cell that doesn't meet any of those
    criteria is left as is for the next generation. With those simple rules in
    mind, go back and play with the system a little bit more and step through
    some generations, one at a time, and notice these rules taking their
    effect.</p><p>The screenshot below shows an example generation, with a number of
    live cells. Don't worry about matching the exact patterns represented in
    the screen shot. Just get some groups of cells added to the grid. Once you
    have groups of live cells in the grid, or select a pre-designed pattern,
    click the "Next Generation" button and notice what happens. Some of the
    live cells are killed (the green ball disappears) and some dead cells come
    to life (a green ball appears). Step through several generations and see
    if you notice any patterns. If you click on the "Start" button, the system
    will evolve itself so you don't need to click the "Next Generation" button
    over and over. Play with the system a little and then come back here for
    more details of how the application works.</p><div class="figure"><a id="d0e28473"/><p class="title"><strong>Figure 23.28. Conway's Game of Life: A running game</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/ConwaysGameOfLifeExample/conway2.png" alt="Conway's Game of Life: A running game"/></div></div></div><br class="figure-break"/><p>Now lets delve into the code. As this is an advanced example we'll
    assume that by now you know your way around the Drools framework and are
    able to connect the presented highlight, so that we'll just focus at a
    high level overview. The example has two ways to execute, one way 
    uses Agenda Groups to manage execution flow, and the other one uses
    Rule Flow Groups to manage execution flow. These two versions are
    implemented in <code class="code">ConwayAgendaGroupRun</code> and
    <code class="code">ConwayRuleFlowGroupRun</code>, respectively. Here,
    we'll discuss the Rule Flow version, as it's what most people will
    use.</p><p>All the <code class="code">Cell</code> objects are inserted into the Session
    and the rules in the <code class="literal">ruleflow-group</code> "register neighbor" are
    allowed to execute by the Rule Flow process. This group of four rules
    creates <code class="code">Neighbor</code> relations between some cell and its
    northeastern, northern, northwestern and western neighbors. This
    relation is bidirectional, which takes care of the other four directions.
    Border cells don't need any special treatment - they simply won't be
    paired with neighboring cells where there isn't any. By
    the time all activations have fired for these rules, all cells are related
    to all their neighboring cells.</p><div class="example"><a id="d0e28498"/><p class="title"><strong>Example 23.71. Conway's Game of Life: Register Cell Neighbour relations</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "register north east"
    ruleflow-group "register neighbor"
when
    $cell: Cell( $row : row, $col : col )            
    $northEast : Cell( row  == ($row - 1), col == ( $col + 1 ) )    
then                    
    insert( new Neighbor( $cell, $northEast ) );
    insert( new Neighbor( $northEast, $cell ) );        
end

rule "register north"
    ruleflow-group "register neighbor"  
when
    $cell: Cell( $row : row, $col : col )   
    $north : Cell( row  == ($row - 1), col == $col )    
then        
    insert( new Neighbor( $cell, $north ) );
    insert( new Neighbor( $north, $cell ) );        
end

rule "register north west"
    ruleflow-group "register neighbor"
when
    $cell: Cell( $row : row, $col : col )           
    $northWest : Cell( row  == ($row - 1), col == ( $col - 1 ) )                        
then        
    insert( new Neighbor( $cell, $northWest ) );
    insert( new Neighbor( $northWest, $cell ) );        
end

rule "register west"
    ruleflow-group "register neighbor"
when
    $cell: Cell( $row : row, $col : col )          
    $west : Cell( row  == $row, col == ( $col - 1 ) )                       
then        
    insert( new Neighbor( $cell, $west ) );
    insert( new Neighbor( $west, $cell ) );         
end</code></pre></div></div><br class="example-break"/><p>Once all the cells are inserted, some Java code applies the pattern
    to the grid, setting certain cells to Live. Then, when the user clicks
    "Start" or "Next Generation", it executes the "Generation" ruleflow. This
    ruleflow is responsible for the management of all changes of cells in each
    generation cycle.</p><div class="figure"><a id="d0e28505"/><p class="title"><strong>Figure 23.29. Conway's Game of Life: rule flow "Generation"</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/ConwaysGameOfLifeExample/conway_ruleflow_generation.png" alt="Conway's Game of Life: rule flow &#34;Generation&#34;"/></div></div></div><br class="figure-break"/><p>The rule flow process first enters the "evaluate" group, which means
    that any active rule in the group can fire. The rules in this group apply
    the Game-of-Life rules discussed in the beginning of the example,
    determining the cells to be killed and the ones to be given life. We use
    the "phase" attribute to drive the reasoning of the Cell by specific
    groups of rules; typically the phase is tied to a Rule Flow Group in the
    Rule Flow process definition. Notice that it doesn't actually change the
    state of any <code class="code">Cell</code> objectss at this point; this is because 
    it's evaluating the grid in turn and it must complete the full evaluation
    until those changes can be applied. To achieve this, it sets the cell to
    a "phase" which is either <code class="code">Phase.KILL</code> or
    <code class="code">Phase.BIRTH</code>, used later to control actions applied
    to the <code class="code">Cell</code> object.</p><div class="example"><a id="d0e28525"/><p class="title"><strong>Example 23.72. Conway's Game of Life: Evaluate Cells with state changes</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Kill The Lonely"
    ruleflow-group "evaluate"
    no-loop
when
//  A live cell has fewer than 2 live neighbors
    theCell: Cell( liveNeighbors &lt; 2, cellState == CellState.LIVE,
                   phase == Phase.EVALUATE )
then
    modify( theCell ){
        setPhase( Phase.KILL );
    }
end

rule "Kill The Overcrowded"
    ruleflow-group "evaluate"
    no-loop
when
//  A live cell has more than 3 live neighbors
    theCell: Cell( liveNeighbors &gt; 3, cellState == CellState.LIVE,
                   phase == Phase.EVALUATE )
then
    modify( theCell ){
        setPhase( Phase.KILL );
    }
end

rule "Give Birth"
    ruleflow-group "evaluate"
    no-loop
when
//  A dead cell has 3 live neighbors
    theCell: Cell( liveNeighbors == 3, cellState == CellState.DEAD,
                   phase == Phase.EVALUATE )
then
    modify( theCell ){
        theCell.setPhase( Phase.BIRTH );
    }
end
</code></pre></div></div><br class="example-break"/><p>Once all <code class="code">Cell</code> objects in the grid have been evaluated,
    we first clear any calculation activations that occurred from any previous
    data changes. This is done via the "reset calculate" rule, which clears
    any activations in the "calculate" group. We then enter a split in the
    rule flow which allows any activations in both the "kill" and the "birth"
    group to fire. These rules are responsible for applying the state
    change.</p><div class="example"><a id="d0e28535"/><p class="title"><strong>Example 23.73. Conway's Game of Life: Apply the state changes</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "reset calculate"
    ruleflow-group "reset calculate"
when
then
    WorkingMemory wm = drools.getWorkingMemory();
    wm.clearRuleFlowGroup( "calculate" );
end

rule "kill"
    ruleflow-group "kill"
    no-loop
when
    theCell: Cell( phase == Phase.KILL )
then
    modify( theCell ){
        setCellState( CellState.DEAD ),
        setPhase( Phase.DONE );   
    }
end 
 
rule "birth"
    ruleflow-group "birth"
    no-loop
when
    theCell: Cell( phase == Phase.BIRTH )
then
    modify( theCell ){
        setCellState( CellState.LIVE ),
        setPhase( Phase.DONE );
    }
end </code></pre></div></div><br class="example-break"/><p>At this stage, a number of <code class="code">Cell</code> objects have been
    modified with the state changed to either <code class="code">LIVE</code> or
    <code class="code">DEAD</code>. Now we get to see the power of the
    <code class="code">Neighbor</code> facts defining the cell relations. When a cell
    becomes live or dead, we use the <code class="code">Neighbor</code> relation to
    iterate over all surrounding cells, increasing or decreasing the
    <code class="code">liveNeighbor</code> count. Any cell that has its count changed
    is also set to to the <code class="code">EVALUATE</code> phase, to make sure
    it is included in the reasoning during the evaluation stage of the
    Rule Flow Process. Notice that we don't have to do any iteration
    ourselves; simply by applying the relations in the rules we make
    the rule engine do all the hard work for us, with a minimal amount of
    code. Once the live count has been determined and set for all cells,
    the Rule Flow Process comes to and end. If the user has initially
    clicked the "Start" button, the engine will restart the rule flow;
    otherwise the user may request another generation.</p><div class="example"><a id="d0e28563"/><p class="title"><strong>Example 23.74. Conway's Game of Life: Evaluate cells with state changes</strong></p><div class="example-contents"><pre><code class="no-highlight">rule "Calculate Live"
    ruleflow-group "calculate"
    lock-on-active  
when
    theCell: Cell( cellState == CellState.LIVE )
    Neighbor( cell == theCell, $neighbor : neighbor ) 
then
    modify( $neighbor ){
        setLiveNeighbors( $neighbor.getLiveNeighbors() + 1 ),
        setPhase( Phase.EVALUATE );   
    }
end 

rule "Calculate Dead"
    ruleflow-group "calculate"
    lock-on-active  
when
    theCell: Cell( cellState == CellState.DEAD )
    Neighbor( cell == theCell, $neighbor : neighbor )
then
    modify( $neighbor ){
        setLiveNeighbors( $neighbor.getLiveNeighbors() - 1 ),
        setPhase( Phase.EVALUATE );
    }
end </code></pre></div></div><br class="example-break"/></div><div class="section" title="23.12. Invaders"><div class="titlepage"><div><div><h2 class="title"><a id="d0e28568"/>23.12. Invaders</h2></div></div></div><p>A simplifed version of the Space Invaders game. Use the keys Z and K, to move left and right and M to fire a
    misile. The example is built up over 6 projects, each adding slightly more complexity to the last.</p><pre><code class="no-highlight"><span class="bold"><strong>Name:</strong></span> Example Invaders
<span class="bold"><strong>Main class:</strong></span> org.drools.games.invaders.Invaders1Main
<span class="bold"><strong>Main class:</strong></span> org.drools.games.invaders.Invaders2Main
<span class="bold"><strong>Main class:</strong></span> org.drools.games.invaders.Invaders3Main
<span class="bold"><strong>Main class:</strong></span> org.drools.games.invaders.Invaders4Main
<span class="bold"><strong>Main class:</strong></span> org.drools.games.invaders.Invaders5Main
<span class="bold"><strong>Main class:</strong></span> org.drools.games.invaders.Invaders6Main</code></pre><div class="figure"><a id="d0e28595"/><p class="title"><strong>Figure 23.30. Pong Screenshot</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/Invaders/invaders.png" alt="Pong Screenshot"/></div></div></div><br class="figure-break"/><div class="section" title="23.12.1. Invaders1Main"><div class="titlepage"><div><div><h3 class="title"><a id="d0e28601"/>23.12.1. Invaders1Main</h3></div></div></div><p>Invaders1Main creates the frame and attaches the KeyListener, feeding key events into the engine. It also sets up the main game loop which can be found in "Main.drl". 
    The typical convention used through out the example is to have one agenda group per file, and all rules in that file in the same agenda group.</p><p>The Run fact is used to drive the repeat of the Game loop. Initially there are only one groups that is evaluated, Keys. The "keys.drl" file is shared by several examples, and illustrates rule re-use across multipel projects.</p><div class="example"><a id="d0e28608"/><p class="title"><strong>Example 23.75. Game Loop</strong></p><div class="example-contents"><pre><code class="language-drl">
rule "init" when
then
    insert( new Run() );
    setFocus( "Init" );
end

rule GameLoop when
    r : Run()
then
    setFocus( "Keys" );
end


rule Draw when
    r : Run()
then
    ui.show();
    modify( r ) {} // force loop
end        
      </code></pre></div></div><br class="example-break"/></div><div class="section" title="23.12.2. Invaders2Main"><div class="titlepage"><div><div><h3 class="title"><a id="d0e28613"/>23.12.2. Invaders2Main</h3></div></div></div><p>Invaders2Main adds the "Draw" stage to the game loop and draws the SpaceShip</p><div class="example"><a id="d0e28618"/><p class="title"><strong>Example 23.76. Game Loop</strong></p><div class="example-contents"><pre><code class="language-drl">
rule GameLoop when
    r : Run()
then
    setFocus( "Draw" );
    setFocus( "Keys" );
end    
      </code></pre></div></div><br class="example-break"/></div><div class="section" title="23.12.3. Invaders3Main"><div class="titlepage"><div><div><h3 class="title"><a id="d0e28623"/>23.12.3. Invaders3Main</h3></div></div></div><p>Invaders3Main adds move controls to the spaceship, notice the ship moves out of the boundaries of the screen. KeyPressed is detected and that sets a delta of dx on the ship direction. That delta is then repeated applied to the x position of the ship</p><div class="example"><a id="d0e28628"/><p class="title"><strong>Example 23.77. Move Ship</strong></p><div class="example-contents"><pre><code class="language-drl">
rule ShipDeltaMoveLeft agenda-group "Move" when
    s : Ship()
        KeyPressed( keyText == "Z" )
then
    modify( s ) { dx = 0 - s.speed }
end

rule ShipDeltaStopLeft agenda-group "Move" when
    s : Ship()
        not KeyPressed( keyText == "Z" )
then
    modify( s ) { dx = 0 }
end

rule ShipMove agenda-group "Move" when
    s : Ship( dx != 0 )
    Run()
then
    modify( s ) { x = s.x + s.dx }
end
      </code></pre></div></div><br class="example-break"/></div><div class="section" title="23.12.4. Invaders4Main"><div class="titlepage"><div><div><h3 class="title"><a id="d0e28633"/>23.12.4. Invaders4Main</h3></div></div></div><p>Invaders4Main adds boundari control to the ShipMove rule, so it doesn't move off the screen. Notice the use of "@watch( !x )", this ensures that while the rule wil modify
    the x property, it will not react to changes to x, which avoids recursion issues.</p><div class="example"><a id="d0e28638"/><p class="title"><strong>Example 23.78. Move Ship with Boundaries</strong></p><div class="example-contents"><pre><code class="language-drl">
rule ShipMove agenda-group "Move" when
    s : Ship( dx != 0, x + dx &gt; 0,  x + dx + width &lt; conf.windowWidth ) @watch( !x )
    Run()
then
    modify( s ) { x = s.x + s.dx }
end
      </code></pre></div></div><br class="example-break"/></div><div class="section" title="23.12.5. Invaders5Main"><div class="titlepage"><div><div><h3 class="title"><a id="d0e28643"/>23.12.5. Invaders5Main</h3></div></div></div><p>Invaders5Main updates the "Draw" group to draw 5 Invaders.</p></div><div class="section" title="23.12.6. Invaders6Main"><div class="titlepage"><div><div><h3 class="title"><a id="d0e28648"/>23.12.6. Invaders6Main</h3></div></div></div><p>Invaders6Main adds a lot more meat. Pressing the "M" key fires a missile that travels up the screen, while moving collision between the missile and the invader is checked.</p></div><div class="section" title="23.12.7. Invaders4Main"><div class="titlepage"><div><div><h3 class="title"><a id="d0e28653"/>23.12.7. Invaders4Main</h3></div></div></div><p>Invaders4Main adds boundari control to the ShipMove rule, so it doesn't move off the screen. Notice the use of "@watch( !x )", this ensures that while the rule wil modify
        the x property, it will not react to changes to x, which avoids recursion issues.</p><div class="example"><a id="d0e28658"/><p class="title"><strong>Example 23.79. Fire Missile</strong></p><div class="example-contents"><pre><code class="language-drl">
rule InsertBullet agenda-group "Bullet" when
        KeyPressed( keyText == "M" )
    s : Ship()
    not Bullet()
then
    b = new Bullet();
    b.x = s.x + (s.width/2) - (b.width/2);
    b.y = s.y - s.height - b.height;
    b.width = conf.bulletWidth;
    b.height = conf.bulletHeight;
    b.dy = 0 - conf.bulletSpeed;
    insert( b );
end


rule BulletMove agenda-group "Bullet" when
    b : Bullet( y &gt; 0 ) @watch( !y )
    Run()
then
    modify( b ) { y = b.y + b.dy }
end

rule Collision agenda-group "Bullet" when
    b : Bullet( ) @watch( y )
    i : Invader( x &lt; b.x, x + width &gt; b.x, y &gt; b.y)
    Run()
then
    modify( i ) { alive = false }
end
      </code></pre></div></div><br class="example-break"/></div></div><div class="section" title="23.13. Adventures with Drools"><div class="titlepage"><div><div><h2 class="title"><a id="d0e28663"/>23.13. Adventures with Drools</h2></div></div></div><p>Based on the Adventure in Prolog, over at the Amzi website, <a class="link" href="http://www.amzi.com/AdventureInProlog/">http://www.amzi.com/AdventureInProlog/</a>,
  we started to work on a text adventure game for Drools. They are ideal as
  they can start off simple and build in complexity and size over time, they
  also demonstrate key aspects of declarative relational programming.</p><pre><code class="no-highlight"><span class="bold"><strong>Name:</strong></span> Example Text Adventure
<span class="bold"><strong>Main class:</strong></span> org.drools.games.adventure.TextAdventure</code></pre><p>The game allows you to play as the hero or the monster. If you click "New Window" you can open one window as the
    hero and another as the monster, and play them both at the same time. The game allows either character to move
    around rooms, pick up, drop or use things. Doors can be locked and unlocked, by using the key on teh exit room, and
    the hero can kill the monster by using the umbrella on the monster.</p><p>You can view the 8 minute demonstration and introduction for the
  example at <a class="link" href="http://downloads.jboss.org/drools/videos/text-adventures.swf">http://downloads.jboss.org/drools/videos/text-adventures.swf</a>. Be aware the video is now much 
    older than the current improved example.</p><div class="figure"><a id="d0e28685"/><p class="title"><strong>Figure 23.31. Text Adventure Screenshot</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/TextAdventureExample/textadventure.png" alt="Text Adventure Screenshot"/></div></div></div><br class="figure-break"/><div class="section" title="23.13.1. Using the game."><div class="titlepage"><div><div><h3 class="title"><a id="d0e28691"/>23.13.1. Using the game.</h3></div></div></div><p>Each action follows the constructor arguments of the associated Command java class.</p><div class="example"><a id="d0e28696"/><p class="title"><strong>Example 23.80. MoveCommand</strong></p><div class="example-contents"><pre><code class="language-java">
  @PropertyReactive
  public class MoveCommand extends Command {
  
      @Position(1)
      private Character character;
  
      @Position(2)
      private Room      room;
  
      public MoveCommand(Character character, Room room) {
          this.character = character;
          this.room = room;
      }    
    </code></pre></div></div><br class="example-break"/><p>To issue a move action, select the "Move" button, then select the exit room. Notice when you press "Move" it adds the text to the white bar at the bottom.
    When the exit room is selected, it also is added to the white bar. Then press send and the game engine will execute the command. Internally it uses reflection to
    instantiate the Command and insert it into the engine. If you select incorrect arguments, such as pressing exits multiple times, the reflection will fail and you can attempt it again.
  </p><div class="figure"><a id="d0e28703"/><p class="title"><strong>Figure 23.32. Move Action</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/TextAdventureExample/MoveCommand.png" alt="Move Action"/></div></div></div><br class="figure-break"/><p>The Things list displays anything you can see in the room, not all things can be picked up. For instance you can pick up the key and the torch, but not the monster.
  When something is picked up it moves from the Things list to the Inventory List. The reverse is true when something is dropped.</p><div class="figure"><a id="d0e28711"/><p class="title"><strong>Figure 23.33. Pickup Action</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/TextAdventureExample/PickUpCommand.png" alt="Pickup Action"/></div></div></div><br class="figure-break"/><p>The key is in the office, move upstairs and into the office. Then pick up the key. Move back downstairs and into the kitchen. Try and walk into the basement, notice it's locked.</p><p>Select the "Use" action, the select the key and then the basement exit. This will unlock the door and you can now walk through.</p><p>To kill the monster pick up the umbrella from the lounge and then select "Use", then select the imbrella and
      finally select the monster.</p><p>Don't forget to open a "New Window" to play as the monster, although you will not be able to exit the basement
      until the hero has opened it with the key. The monster and the hero can also give items to each other, moving
      items between each playsers inventory.</p></div><div class="section" title="23.13.2. The code"><div class="titlepage"><div><div><h3 class="title"><a id="d0e28725"/>23.13.2. The code</h3></div></div></div><p>The model is written in Java classes. Each classes uses @PropertyReactive and @Position. @PropertyReactive allows control of which fields patterns react to, and @Position maps
      a field to a argument position allowing positional as well as named arguments for patterns.</p><div class="example"><a id="d0e28730"/><p class="title"><strong>Example 23.81. Game World Data Example</strong></p><div class="example-contents"><pre><code class="language-java">
@PropertyReactive
public class Thing {
    @Position(0)
    private long id;

    @Position(1)
    private String name;

    public Thing(long id, String name) {
        this.id = id;
        this.name = name;
    }
    ...
}
    </code></pre></div></div><br class="example-break"/><p>An MVEL data file is used to populate our world, see "data.mvel". You can edit this file to add new rooms,
      items and characters, as well as locks for doors.</p><div class="example"><a id="d0e28737"/><p class="title"><strong>Example 23.82. Game World Data Example</strong></p><div class="example-contents"><pre><code class="language-xml">
rooms = [
    "basement" : new Room("basement"),
    "lounge" : new Room("lounge"),
    "kitchen" : new Room("kitchen"),
    "ground floor hallway" : new Room("ground floor hallway"),
    "bedroom" : new Room("bedroom"),
    "office" : new Room("office"),
    "first floor hallway" : new Room("first floor hallway")
];

doors = [
    "d1" : new Door( rooms["kitchen"], rooms["basement"] ),
    "d2" : new Door( rooms["ground floor hallway"], rooms["lounge"]),
    "d4" : new Door( rooms["ground floor hallway"], rooms["kitchen"]),
    "d5" : new Door( rooms["ground floor hallway"], rooms[ "first floor hallway"] ),
    "d8" : new Door( rooms["first floor hallway"], rooms[ "bedroom"] ),
    "d9" : new Door( rooms["first floor hallway"], rooms[ "office"] )
];

locations = [
    "monster" :  new Location( characters["monster"], rooms["basement"] ),
    "hero" :  new Location( characters["hero"], rooms["ground floor hallway"] ),
    "umbrella" :  new Location( items["umbrella"], rooms["lounge"] ),
    "key1" :  new Location( items["key1"], rooms["office"] )
];
    </code></pre></div></div><br class="example-break"/><p>The game creates commands, which it inserts into the engine. These commands are then used to change the state
      of the world and that state is reflected back in the UI. The commands can be found in the "commands.drl" file. The
      following rule matches the MoveCommand and if it's valid it will make the move happen.</p><div class="example"><a id="d0e28744"/><p class="title"><strong>Example 23.83. Move a Characters</strong></p><div class="example-contents"><pre><code class="language-drl">
rule validMove agenda-group "commands" when
    mc : MoveCommand( c : character, r : room )
    l  : Location( thing == c, ltarget : target ) @watch( !target )
    ?connect( d, r, ltarget; )
then
    exit = new ExitEvent( c, (Room) l.target );
    enter = new EnterEvent( c, r );

    modify( l ) { target = r };

    insert( exit );
    insert( enter );

    mc.session.channels["output"].send( "You have entered the " + l.target.name + "\n" );
end
    </code></pre></div></div><br class="example-break"/><p>In the above rules notice the "connect" pattern, this is actually a query. In the MVEL data file doors are
      only described one way, we can use a query to check connections bi-directionally. The queries can be found in the
      "queries.drl" file.</p><div class="example"><a id="d0e28751"/><p class="title"><strong>Example 23.84. connect</strong></p><div class="example-contents"><pre><code class="language-drl">
query connect( Door $d, Room $x, Room $y )
    $d := Door($id, $name, $x, $y;)
    or 
    $d :=Door($id, $name, $y, $x;)
end
    </code></pre></div></div><br class="example-break"/><p>The UI has its list boxes populated by rules found in "UiView.drl", those rules in turn use queries. Here is
      how the "Things" list box is populated, when ever the world changes.</p><div class="example"><a id="d0e28758"/><p class="title"><strong>Example 23.85. Update the UI</strong></p><div class="example-contents"><pre><code class="language-drl">
rule updateThings salience 5  when                            
    session : UserSession( $char : character )
    things( $char, $things; )                                                      
then
    session.channels["things"].send( $things );
end

query things(Character $char, List $things)
    $char := Character()
    Location( $char, $room; )
    $things := List() from accumulate( Location($thing, $room; thing != $char),
                                       collectList( $thing ) )      
end
    </code></pre></div></div><br class="example-break"/></div></div><div class="section" title="23.14. Pong"><div class="titlepage"><div><div><h2 class="title"><a id="d0e28763"/>23.14. Pong</h2></div></div></div><p>A Conversion for the classic game Pong. Use the keys A, Z and K, M.
  The ball should get faster after each bounce.</p><pre><code class="no-highlight"><span class="bold"><strong>Name:</strong></span> Example Pong
<span class="bold"><strong>Main class:</strong></span> org.drools.games.pong.PongMain</code></pre><div class="figure"><a id="d0e28775"/><p class="title"><strong>Figure 23.34. Pong Screenshot</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/PongExample/pong.png" alt="Pong Screenshot"/></div></div></div><br class="figure-break"/></div><div class="section" title="23.15. Wumpus World"><div class="titlepage"><div><div><h2 class="title"><a id="d0e28781"/>23.15. Wumpus World</h2></div></div></div><pre><code class="no-highlight"><span class="bold"><strong>Name:</strong></span> Example Wumpus World
<span class="bold"><strong>Main class:</strong></span> org.drools.games.wumpus.WumpusWorldMain</code></pre><p>Wumpus World is an AI example covered in the book "Artificial
  Intelligence : A Modern Approach". When the game first starts all the cells
  are greyed out. As you walk around they become visible. The cave has pits, a
  wumpus and gold. When you are next to a pit you will feel a breeze, when you
  are next to the wumpus you will smell a stench and see glitter when next to
  gold. The sensor icons are shown above the move buttons. If you walk into a
  pit or the wumpus, you die. A more detailed overview of Wumpus World can be
  found at <a class="link" href="http://www.cis.temple.edu/~giorgio/cis587/readings/wumpus.shtml">http://www.cis.temple.edu/~giorgio/cis587/readings/wumpus.shtml</a>.
  A 20 minute video showing how the game is created and works is at <a class="link" href="http://www.youtube.com/watch?v=4CvjKqUOEzM">http://www.youtube.com/watch?v=4CvjKqUOEzM.</a></p><div class="figure"><a id="d0e28798"/><p class="title"><strong>Figure 23.35. Wumpus World</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/WumpusWorldExample/wumpus1.png" alt="Wumpus World"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e28804"/><p class="title"><strong>Figure 23.36. Cave Screenshot</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/WumpusWorldExample/wumpus2.png" alt="Cave Screenshot"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e28810"/><p class="title"><strong>Figure 23.37. Signals Screenshot</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/WumpusWorldExample/wumpus3.png" alt="Signals Screenshot"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e28816"/><p class="title"><strong>Figure 23.38. Smell Stench</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/WumpusWorldExample/wumpus4.png" alt="Smell Stench"/></div></div></div><br class="figure-break"/><div class="figure"><a id="d0e28822"/><p class="title"><strong>Figure 23.39. Move Up, Wumpus Collision</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/WumpusWorldExample/wumpus5.png" alt="Move Up, Wumpus Collision"/></div></div></div><br class="figure-break"/></div><div class="section" title="23.16. Miss Manners and Benchmarking"><div class="titlepage"><div><div><h2 class="title"><a id="d0e28828"/>23.16. Miss Manners and Benchmarking</h2></div></div></div><pre><code class="no-highlight"><span class="bold"><strong>Name:</strong></span> Miss Manners
<span class="bold"><strong>Main class:</strong></span> org.drools.benchmark.manners.MannersBenchmark
<span class="bold"><strong>Module:</strong></span> drools-examples
<span class="bold"><strong>Type:</strong></span> Java application
<span class="bold"><strong>Rules file:</strong></span> manners.drl
<span class="bold"><strong>Objective:</strong></span> Advanced walkthrough on the Manners benchmark, covers Depth conflict resolution in depth.</code></pre><div class="section" title="23.16.1. Introduction"><div class="titlepage"><div><div><h3 class="title"><a id="d0e28850"/>23.16.1. Introduction</h3></div></div></div><p>Miss Manners is throwing a party and, being a good host, she wants
      to arrange good seating. Her initial design arranges everyone in 
      male-female pairs, but then she worries about people have things to talk
      about. What is a good host to do? She decides to note the hobby of
      each guest so she can then arrange guests not only pairing them according
      to alternating sex but also ensuring that a guest has someone with a
      common hobby, at least on one side.</p><div class="figure"><a id="d0e28855"/><p class="title"><strong>Figure 23.40. Miss Manners' Guests</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Examples/MannersExample/guests_at_table.png" align="middle" alt="Miss Manners' Guests"/></div></div></div><br class="figure-break"/><div class="section" title="23.16.1.1. BenchMarking"><div class="titlepage"><div><div><h4 class="title"><a id="d0e28861"/>23.16.1.1. BenchMarking</h4></div></div></div><p>Five benchmarks were established in the 1991 paper "Effects of
        Database Size on Rule System Performance: Five Case Studies" by 
        David Brant, Timothy Grose, Bernie Lofaso and Daniel P. Miranker:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Manners</strong></span> uses a 
            depth-first search approach to determine the
            seating arrangements alternating women and men and ensuring
            one common hobby for neighbors.</p></li><li class="listitem"><p><span class="bold"><strong>Waltz</strong></span> establishes
            a three-dimensional interpretation of a line drawing by
            line labeling by constraint propagation.</p></li><li class="listitem"><p><span class="bold"><strong>WaltzDB</strong></span> is a more
            general version of Waltz, supporting junctions of more
            than three lines and using a database.</p></li><li class="listitem"><p><span class="bold"><strong>ARP</strong></span> is a 
            route planner for a robotic air vehicle using the A*
            search algorithm to achieve minimal cost.</p></li><li class="listitem"><p><span class="bold"><strong>Weaver</strong></span> 
            VLSI router for channels and boxes using a black-board
            technique.</p></li></ul></div><p>Manners has become the de facto rule engine benchmark.
        Its behavior, however, is now well known and many engines
        optimize for this, thus negating its usefulness as a benchmark 
        which is why Waltz is becoming more favorable. These five
        benchmarks are also published at the University of Texas <a class="link" href="http://www.cs.utexas.edu/ftp/pub/ops5-benchmark-suite/">http://www.cs.utexas.edu/ftp/pub/ops5-benchmark-suite/</a>.</p></div><div class="section" title="23.16.1.2. Miss Manners Execution Flow"><div class="titlepage"><div><div><h4 class="title"><a id="d0e28897"/>23.16.1.2. Miss Manners Execution Flow</h4></div></div></div><p>After the first seating arrangement has been assigned, a
        depth-first recursion occurs which repeatedly assigns correct
        seating arrangements until the last seat is assigned. Manners
        uses a <code class="code">Context</code> instance to control execution flow.
        The activity diagram is partitioned to show the relation of the
        rule execution to the current <code class="code">Context</code> state.</p><div class="figure"><a id="d0e28908"/><p class="title"><strong>Figure 23.41. Manners Activity Diagram</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Examples/MannersExample/manners_activity_diagram.png" align="middle" alt="Manners Activity Diagram"/></div></div></div><br class="figure-break"/></div><div class="section" title="23.16.1.3. The Data and Results"><div class="titlepage"><div><div><h4 class="title"><a id="d0e28914"/>23.16.1.3. The Data and Results</h4></div></div></div><p>Before going deeper into the rules, let's first take a look
        at the asserted data and the resulting seating arrangement. The
        data is a simple set of five guests who should be arranged so
        that sexes alternate and neighbors have a common hobby.</p><p><span class="bold"><strong>The Data</strong></span></p><p>The data is given in OPS5 syntax, with a parenthesized
        list of name and value pairs for each attribute. Each
        person has only one hobby.</p><div class="literallayout"><p>(guest (name n1) (sex m) (hobby  h1)  )<br/>
(guest (name n2) (sex f) (hobby  h1)  )<br/>
(guest (name n2) (sex f) (hobby  h3)  )<br/>
(guest (name n3) (sex m) (hobby  h3)  )<br/>
(guest (name n4) (sex m) (hobby  h1)  )<br/>
(guest (name n4) (sex f) (hobby  h2)  )<br/>
(guest (name n4) (sex f) (hobby  h3)  )<br/>
(guest (name n5) (sex f) (hobby  h2)  )<br/>
(guest (name n5) (sex f) (hobby  h1)  )<br/>
(last_seat (seat 5)  )</p></div><p><span class="bold"><strong>The Results</strong></span></p><p>Each line of the results list is printed per execution of the
        "Assign Seat" rule. They key bit to notice is that each line has
        a "pid" value one greater than the last. (The significance of this
        will be explained in the discussion of the rule "Assign Seating".)
        The "ls", "rs", "ln" and "rn" refer to the left and right
        seat and neighbor's name, respectively. The actual implementation
        uses longer attribute names (e.g., <code class="code">leftGuestName</code>,
        but here we'll stick to the notation from the original
        implementation.</p><div class="literallayout"><p>[Seating id=1, pid=0, done=true, ls=1, ln=n5, rs=1, rn=n5] <br/>
[Seating id=2, pid=1, done=false, ls=1, ln=n5, rs=2, rn=n4] <br/>
[Seating id=3, pid=2, done=false, ls=2, ln=n4, rs=3, rn=n3] <br/>
[Seating id=4, pid=3, done=false, ls=3, rn=n3, rs=4, rn=n2] <br/>
[Seating id=5, pid=4, done=false, ls=4, ln=n2, rs=5, rn=n1]</p></div></div></div><div class="section" title="23.16.2. In depth Discussion"><div class="titlepage"><div><div><h3 class="title"><a id="d0e28936"/>23.16.2. In depth Discussion</h3></div></div></div><div class="section" title="23.16.2.1. Cheating"><div class="titlepage"><div><div><h4 class="title"><a id="d0e28939"/>23.16.2.1. Cheating</h4></div></div></div><p>Manners has been designed to exercise cross product
        joins and Agenda activities. Many people not understanding this
        tweak the example to achieve better performance, making their
        port of the Manners benchmark pointless. Known cheats or
        porting errors for Miss Manners are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Using arrays for a guests hobbies, instead of asserting each
            one as a single fact massively reduces the cross products.</p></li><li class="listitem"><p>Altering the sequence of data can also reduce the
            amount of matching, increasing execution speed.</p></li><li class="listitem"><p>It's possible to change the <code class="literal">not</code> Conditional
            Element so that the test algorithm only uses the
            "first-best-match", which is, basically, transforming
            the test algorithm to backward chaining. The results are only
            comparable to other backward chaining rule engines or ports of
            Manners.</p></li><li class="listitem"><p>Removing the context so the rule engine matches the guests
            and seats prematurely. A proper port will prevent facts from
            matching using the context start.</p></li><li class="listitem"><p>It's possible to prevent the rule engine from performing
            combinatorial pattern matching.</p></li><li class="listitem"><p>If no facts are retracted in the reasoning cycle, as a
            result of the <code class="literal">not</code> CE, the port is incorrect.</p></li></ul></div></div><div class="section" title="23.16.2.2. Conflict Resolution"><div class="titlepage"><div><div><h4 class="title"><a id="d0e28969"/>23.16.2.2. Conflict Resolution</h4></div></div></div><p>The Manners benchmark was written for OPS5 which has two conflict
        resolution strategies, LEX and MEA. LEX is a chain of several
        strategies including salience, recency and complexity. The recency
        part of the strategy drives the depth first (LIFO) firing order.
        The CLIPS  manual documents the Recency strategy as follows:</p><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td width="10%" valign="top"> </td><td width="80%" valign="top"><p>Every fact and instance is marked internally with a "time tag"
          to indicate its relative recency with respect to every other fact
          and instance in the system. The pattern entities associated with
          each rule activation are sorted in descending order for determining
          placement. An activation with a more recent pattern entity is
          placed before activations with less recent pattern entities. To
          determine the placement order of two activations, compare the sorted
          time tags of the two activations one by one starting with the
          largest time tags. The comparison should continue until one
          activation’s time tag is greater than the other activation’s
          corresponding time tag. The activation with the greater time tag is
          placed before the other activation on the agenda. If one activation
          has more pattern entities than the other activation and the compared
          time tags are all identical, then the activation with more time tags
          is placed before the other activation on the agenda.</p></td><td width="10%" valign="top"> </td></tr><tr><td width="10%" valign="top"> </td><td colspan="2" align="right" valign="top">--<span class="attribution">CLIPS Reference Manual</span></td></tr></table></div><p>However Jess and CLIPS both use the Depth strategy, which is
        simpler and lighter, which Drools also adopted. The CLIPS manual
        documents the Depth strategy as:</p><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td width="10%" valign="top"> </td><td width="80%" valign="top"><p>Newly activated rules are placed above all rules of the same
          salience. For example, given that fact-a activates rule-1 and rule-2
          and fact-b activates rule-3 and rule-4, then if fact-a is asserted
          before fact-b, rule-3 and rule-4 will be above rule-1 and rule-2 on
          the agenda. However, the position of rule-1 relative to rule-2 and
          rule-3 relative to rule-4 will be arbitrary.</p></td><td width="10%" valign="top"> </td></tr><tr><td width="10%" valign="top"> </td><td colspan="2" align="right" valign="top">--<span class="attribution">CLIPS Reference Manual</span></td></tr></table></div><p>The initial Drools implementation for the Depth strategy would
        not work for Manners without the use of salience on the "make_path"
        rule. The CLIPS support team had this to say:</p><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td width="10%" valign="top"> </td><td width="80%" valign="top"><p>The default conflict resolution strategy for CLIPS, Depth, is
          different than the default conflict resolution strategy used by
          OPS5. Therefore if you directly translate an OPS5 program to CLIPS,
          but use the default depth conflict resolution strategy, you're only
          likely to get the correct behavior by coincidence. The LEX and MEA
          conflict resolution strategies are provided in CLIPS to allow you to
          quickly convert and correctly run an OPS5 program in CLIPS.</p></td><td width="10%" valign="top"> </td></tr><tr><td width="10%" valign="top"> </td><td colspan="2" align="right" valign="top">--<span class="attribution">Clips Support Forum</span></td></tr></table></div><p>Investigation into the CLIPS code reveals there is undocumented
        functionality in the Depth strategy. There is an accumulated time tag
        used in this strategy; it's not an extensively fact by fact comparison
        as in the recency strategy, it simply adds the total of all the time
        tags for each activation and compares.</p></div><div class="section" title="23.16.2.3. Rule &#34;assignFirstSeat&#34;"><div class="titlepage"><div><div><h4 class="title"><a id="d0e28995"/>23.16.2.3. Rule "assignFirstSeat"</h4></div></div></div><p>Once the context is changed to <code class="code">START_UP</code>,
        activations are created for all asserted guest. Because all
        activations are created as the result of a single Working Memory
        action, they all have the same Activation time tag. The last
        asserted <code class="code">Guest</code> object would have a higher fact
        time tag, and its Activation would fire because it has the highest
        accumulated fact time tag. The execution order in this rule has little
        importance, but has a big impact in the rule "Assign Seat". The
        activation fires and asserts the first <code class="code">Seating</code>
        arrangement and a <code class="code">Path</code>, and then sets the
        <code class="code">Context</code> attribute <code class="code">state</code> to create 
        an activation for rule <code class="code">findSeating</code>.</p><pre><code class="no-highlight">rule assignFirstSeat
    when
        context : Context( state == Context.START_UP )
        guest : Guest()
        count : Count()
    then
        String guestName = guest.getName();
        
        Seating seating =
          new Seating( count.getValue(), 1, true, 1, guestName, 1, guestName);
        insert( seating );
        
        Path path = new Path( count.getValue(), 1, guestName );
        insert( path );
        
        modify( count ) { setValue ( count.getValue() + 1 )  }

    System.out.println( "assign first seat :  " + seating + " : " + path );

        modify( context ) {
            setState( Context.ASSIGN_SEATS )
        } 
end</code></pre></div><div class="section" title="23.16.2.4. Rule &#34;findSeating&#34;"><div class="titlepage"><div><div><h4 class="title"><a id="d0e29023"/>23.16.2.4. Rule "findSeating"</h4></div></div></div><p>This rule determines each of the <code class="code">Seating</code>
        arrangements. The rule creates cross product solutions for
        <span class="emphasis"><em>all</em></span> asserted <code class="code">Seating</code> arrangements
        against <span class="emphasis"><em>all</em></span> the asserted guests except 
        against itself or any already assigned chosen solutions.</p><pre><code class="no-highlight">rule findSeating
   when 
       context : Context( state == Context.ASSIGN_SEATS )
       $s      : Seating( pathDone == true )
       $g1     : Guest( name == $s.rightGuestName )
       $g2     : Guest( sex != $g1.sex, hobby == $g1.hobby )

       count   : Count()

       not ( Path( id == $s.id, guestName == $g2.name) )
       not ( Chosen( id == $s.id, guestName == $g2.name, hobby == $g1.hobby) )
   then
       int rightSeat = $s.getRightSeat();
       int seatId = $s.getId();
       int countValue = count.getValue();
       
       Seating seating =
         new Seating( countValue, seatId, false, rightSeat,
                      $s.getRightGuestName(), rightSeat + 1, $g2.getName() );
       insert( seating );
                            
       Path path = new Path( countValue, rightSeat + 1, $g2.getName()  );
       insert( path );
       
       Chosen chosen = new Chosen( seatId, $g2.getName(), $g1.getHobby() );
       insert( chosen  );

       System.err.println( "find seating : " + seating + " : " + path +
                           " : " + chosen);

       modify( count ) {setValue(  countValue + 1 )}
       modify( context ) {setState( Context.MAKE_PATH )}
end</code></pre><p>However, as can be seen from the printed results shown earlier,
        it is essential that only the <code class="code">Seating</code> with the highest
        <code class="code">pid</code> cross product be chosen. How can this be possible
        if we have activations, of the same time tag, for nearly all
        existing <code class="code">Seating</code> and <code class="code">Guest</code> objects? For
        example, on the third iteration of <code class="code">findSeating</code> the
        produced activations will be as shown below. Remember, this is from
        a very small data set, and with larger data sets there would be many
        more possible activated <code class="code">Seating</code> solutions, with multiple
        solutions per <code class="code">pid</code>:</p><div class="literallayout"><p>=&gt;[ActivationCreated(35): rule=findSeating <br/>
[fid:19:33]:[Seating id=3, pid=2, done=true, ls=2, ln=n4, rs=3, rn=n3] <br/>
[fid:4:4]:[Guest name=n3, sex=m, hobbies=h3] <br/>
[fid:3:3]:[Guest name=n2, sex=f, hobbies=h3]<br/>
<br/>
=&gt;[ActivationCreated(35): rule=findSeating <br/>
[fid:15:23]:[Seating id=2, pid=1, done=true, ls=1, ln=n5, rs=2, rn=n4] <br/>
[fid:5:5]:[Guest name=n4, sex=m, hobbies=h1] <br/>
[fid:2:2]:[Guest name=n2, sex=f, hobbies=h1] <br/>
<br/>
=&gt;[ActivationCreated(35): rule=findSeating <br/>
[fid:13:13]:[Seating id=1, pid=0, done=true, ls=1, ln=n5, rs=1, rn=n5] <br/>
[fid:9:9]:[Guest name=n5, sex=f, hobbies=h1] <br/>
[fid:1:1]:[Guest name=n1, sex=m, hobbies=h1]</p></div><p>The creation of all these redundant activations might seem
        pointless, but it must be remembered that Manners is not about good
        rule design; it's purposefully designed as a bad ruleset to fully
        stress-test the cross product matching process and the Agenda, which
        this clearly does. Notice that each activation has the same time tag
        of 35, as they were all activated by the change in the
        <code class="code">Context</code> object to <code class="code">ASSIGN_SEATS</code>. With OPS5
        and LEX it would correctly fire the activation with the
        <code class="code">Seating</code> asserted last. With Depth, the accumulated fact
        time tag ensures that the activation with the last asserted
        <code class="code">Seating</code> fires.</p></div><div class="section" title="23.16.2.5. Rules &#34;makePath&#34; and &#34;pathDone&#34;"><div class="titlepage"><div><div><h4 class="title"><a id="d0e29081"/>23.16.2.5. Rules "makePath" and "pathDone"</h4></div></div></div><p>Rule <code class="code">makePath</code> must always fire before
        <code class="code">pathDone</code>. A <code class="code">Path</code> object is asserted for
        each <code class="code">Seating</code> arrangement, up to the last asserted 
        <code class="code">Seating</code>. Notice that the conditions in
        <code class="code">pathDone</code> are a subset of those in
        <code class="code">makePath</code> - so how do we ensure that <code class="code">makePath</code>
        fires first?</p><pre><code class="no-highlight">rule makePath
    when 
        Context( state == Context.MAKE_PATH )
        Seating( seatingId:id, seatingPid:pid, pathDone == false )
        Path( id == seatingPid, pathGuestName:guestName, pathSeat:seat )
        not Path( id == seatingId, guestName == pathGuestName )
    then
        insert( new Path( seatingId, pathSeat, pathGuestName ) );
end</code></pre><pre><code class="no-highlight">rule pathDone
    when
        context : Context( state == Context.MAKE_PATH ) 
        seating : Seating( pathDone == false ) 
    then
        modify( seating ) {setPathDone( true )} 
        
    modify( context ) {setState( Context.CHECK_DONE)}
end</code></pre><div class="figure"><a id="d0e29114"/><p class="title"><strong>Figure 23.42. Rete Diagram</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Examples/MannersExample/make_path.png" align="middle" alt="Rete Diagram"/></div></div></div><br class="figure-break"/><p>Both rules end up on the Agenda in conflict and with identical
        activation time tags. However, the accumulate fact time tag is greater
        for "Make Path" so it gets priority.</p></div><div class="section" title="23.16.2.6. Rules &#34;continue&#34; and &#34;areWeDone&#34;"><div class="titlepage"><div><div><h4 class="title"><a id="d0e29122"/>23.16.2.6. Rules "continue" and "areWeDone"</h4></div></div></div><p>Rule <code class="code">areWeDone</code> only activates when the last seat
        is assigned, at which point both rules will be activated. For the
        same reason that <code class="code">makePath</code> always wins over
        <code class="code">path Done</code>, <code class="code">areWeDone</code> will take
        priority over rule <code class="code">continue</code>.</p><pre><code class="no-highlight">rule areWeDone
    when
        context : Context( state == Context.CHECK_DONE ) 
        LastSeat( lastSeat: seat )
        Seating( rightSeat == lastSeat ) 
    then
        modify( context ) {setState(Context.PRINT_RESULTS )}
end
</code></pre><pre><code class="no-highlight">rule continue
    when
        context : Context( state == Context.CHECK_DONE ) 
    then
        modify( context ) {setState( Context.ASSIGN_SEATS )}
end
</code></pre></div></div><div class="section" title="23.16.3. Output Summary"><div class="titlepage"><div><div><h3 class="title"><a id="d0e29146"/>23.16.3. Output Summary</h3></div></div></div><div class="literallayout"><p><span class="bold"><strong>Assign First seat</strong></span><br/>
=&gt;[fid:13:13]:[Seating id=1, pid=0, done=true, ls=1, ln=n5, rs=1, rn=n5]<br/>
=&gt;[fid:14:14]:[Path id=1, seat=1, guest=n5]<br/>
<br/>
==&gt;[ActivationCreated(16): rule=findSeating<br/>
[fid:13:13]:[Seating id=1, pid=0, done=true, ls=1, ln=n5, rs=1, rn=n5]<br/>
[fid:9:9]:[Guest name=n5, sex=f, hobbies=h1]<br/>
[fid:1:1]:[Guest name=n1, sex=m, hobbies=h1]<br/>
<br/>
==&gt;[ActivationCreated(16): rule=findSeating<br/>
[fid:13:13]:[Seating id=1 , pid=0, done=true, ls=1, ln=n5, rs=1, rn=n5]<br/>
[fid:9:9]:[Guest name=n5, sex=f, hobbies=h1]<br/>
[fid:5:5]:[Guest name=n4, sex=m, hobbies=h1]*<br/>
<br/>
<span class="bold"><strong>Assign Seating</strong></span><br/>
=&gt;[fid:15:17] :[Seating id=2 , pid=1 , done=false, ls=1, lg=n5, rs=2, rn=n4]<br/>
=&gt;[fid:16:18]:[Path id=2, seat=2, guest=n4]<br/>
=&gt;[fid:17:19]:[Chosen id=1, name=n4, hobbies=h1]<br/>
<br/>
=&gt;[ActivationCreated(21): rule=makePath <br/>
[fid:15:17] : [Seating id=2, pid=1, done=false, ls=1, ln=n5, rs=2, rn=n4]<br/>
[fid:14:14] : [Path id=1, seat=1, guest=n5]*<br/>
<br/>
==&gt;[ActivationCreated(21): rule=pathDone<br/>
[Seating id=2, pid=1, done=false, ls=1, ln=n5, rs=2, rn=n4]*<br/>
<br/>
<span class="bold"><strong>Make Path</strong></span><br/>
=&gt;[fid:18:22:[Path id=2, seat=1, guest=n5]]<br/>
<br/>
<span class="bold"><strong>Path Done</strong></span><br/>
<br/>
<span class="bold"><strong>Continue Process</strong></span><br/>
=&gt;[ActivationCreated(25): rule=findSeating<br/>
[fid:15:23]:[Seating id=2, pid=1, done=true, ls=1, ln=n5, rs=2, rn=n4]<br/>
[fid:7:7]:[Guest name=n4, sex=f, hobbies=h3]<br/>
[fid:4:4] : [Guest name=n3, sex=m, hobbies=h3]*<br/>
<br/>
=&gt;[ActivationCreated(25): rule=findSeating<br/>
[fid:15:23]:[Seating id=2, pid=1, done=true, ls=1, ln=n5, rs=2, rn=n4]<br/>
[fid:5:5]:[Guest name=n4, sex=m, hobbies=h1]<br/>
[fid:2:2]:[Guest name=n2, sex=f, hobbies=h1], [fid:12:20] : [Count value=3]<br/>
<br/>
=&gt;[ActivationCreated(25): rule=findSeating<br/>
[fid:13:13]:[Seating id=1, pid=0, done=true, ls=1, ln=n5, rs=1, rn=n5]<br/>
[fid:9:9]:[Guest name=n5, sex=f, hobbies=h1]<br/>
[fid:1:1]:[Guest name=n1, sex=m, hobbies=h1]<br/>
<br/>
<span class="bold"><strong>Assign Seating</strong></span><br/>
=&gt;[fid:19:26]:[Seating id=3, pid=2, done=false, ls=2, lnn4, rs=3, rn=n3]]<br/>
=&gt;[fid:20:27]:[Path id=3, seat=3, guest=n3]]<br/>
=&gt;[fid:21:28]:[Chosen id=2, name=n3, hobbies=h3}]<br/>
<br/>
=&gt;[ActivationCreated(30): rule=makePath<br/>
[fid:19:26]:[Seating id=3, pid=2, done=false, ls=2, ln=n4, rs=3, rn=n3]<br/>
[fid:18:22]:[Path id=2, seat=1, guest=n5]*<br/>
<br/>
=&gt;[ActivationCreated(30): rule=makePath <br/>
[fid:19:26]:[Seating id=3, pid=2, done=false, ls=2, ln=n4, rs=3, rn=n3]<br/>
[fid:16:18]:[Path id=2, seat=2, guest=n4]*<br/>
<br/>
=&gt;[ActivationCreated(30): rule=done <br/>
[fid:19:26]:[Seating id=3, pid=2, done=false, ls=2, ln=n4, rs=3, rn=n3]*<br/>
<br/>
<span class="bold"><strong>Make Path</strong></span><br/>
=&gt;[fid:22:31]:[Path id=3, seat=1, guest=n5]<br/>
<br/>
<span class="bold"><strong>Make Path </strong></span><br/>
=&gt;[fid:23:32] [Path id=3, seat=2, guest=n4]<br/>
<br/>
<span class="bold"><strong>Path Done</strong></span><br/>
<br/>
<span class="bold"><strong>Continue Processing</strong></span><br/>
=&gt;[ActivationCreated(35): rule=findSeating<br/>
[fid:19:33]:[Seating id=3, pid=2, done=true, ls=2, ln=n4, rs=3, rn=n3]<br/>
[fid:4:4]:[Guest name=n3, sex=m, hobbies=h3]<br/>
[fid:3:3]:[Guest name=n2, sex=f, hobbies=h3], [fid:12:29]*<br/>
<br/>
=&gt;[ActivationCreated(35): rule=findSeating <br/>
[fid:15:23]:[Seating id=2, pid=1, done=true, ls=1, ln=n5, rs=2, rn=n4] <br/>
[fid:5:5]:[Guest name=n4, sex=m, hobbies=h1]<br/>
[fid:2:2]:[Guest name=n2, sex=f, hobbies=h1]<br/>
<br/>
=&gt;[ActivationCreated(35): rule=findSeating <br/>
[fid:13:13]:[Seating id=1, pid=0, done=true, ls=1, ln=n5, rs=1, rn=n5] <br/>
[fid:9:9]:[Guest name=n5, sex=f, hobbies=h1], [fid:1:1] : [Guest name=n1, sex=m, hobbies=h1]<br/>
<br/>
<span class="bold"><strong>Assign Seating</strong></span><br/>
=&gt;[fid:24:36]:[Seating id=4, pid=3, done=false, ls=3, ln=n3, rs=4, rn=n2]]<br/>
=&gt;[fid:25:37]:[Path id=4, seat=4, guest=n2]]<br/>
=&gt;[fid:26:38]:[Chosen id=3, name=n2, hobbies=h3]<br/>
<br/>
==&gt;[ActivationCreated(40): rule=makePath <br/>
[fid:24:36]:[Seating id=4, pid=3, done=false, ls=3, ln=n3, rs=4, rn=n2]<br/>
[fid:23:32]:[Path id=3, seat=2, guest=n4]*<br/>
<br/>
==&gt;[ActivationCreated(40): rule=makePath <br/>
[fid:24:36]:[Seating id=4, pid=3, done=false, ls=3, ln=n3, rs=4, rn=n2] <br/>
[fid:20:27]:[Path id=3, seat=3, guest=n3]*<br/>
<br/>
=&gt;[ActivationCreated(40): rule=makePath <br/>
[fid:24:36]:[Seating id=4, pid=3, done=false, ls=3, ln=n3, rs=4, rn=n2]<br/>
[fid:22:31]:[Path id=3, seat=1, guest=n5]*<br/>
<br/>
=&gt;[ActivationCreated(40): rule=done <br/>
[fid:24:36]:[Seating id=4, pid=3, done=false, ls=3, ln=n3, rs=4, rn=n2]*<br/>
<br/>
<span class="bold"><strong>Make Path </strong></span><br/>
=&gt;fid:27:41:[Path id=4, seat=2, guest=n4]<br/>
<br/>
<span class="bold"><strong>Make Path</strong></span><br/>
=&gt;fid:28:42]:[Path id=4, seat=1, guest=n5]]<br/>
<br/>
<span class="bold"><strong>Make Path</strong></span><br/>
=&gt;fid:29:43]:[Path id=4, seat=3, guest=n3]]<br/>
<br/>
<span class="bold"><strong>Path Done</strong></span><br/>
<br/>
<span class="bold"><strong>Continue  Processing</strong></span><br/>
=&gt;[ActivationCreated(46): rule=findSeating <br/>
[fid:15:23]:[Seating id=2, pid=1, done=true, ls=1, ln=n5, rs=2, rn=n4] <br/>
[fid:5:5]:[Guest name=n4, sex=m, hobbies=h1], [fid:2:2]<br/>
[Guest name=n2, sex=f, hobbies=h1]<br/>
<br/>
=&gt;[ActivationCreated(46): rule=findSeating <br/>
[fid:24:44]:[Seating id=4, pid=3, done=true, ls=3, ln=n3, rs=4, rn=n2]<br/>
[fid:2:2]:[Guest name=n2, sex=f, hobbies=h1]<br/>
[fid:1:1]:[Guest name=n1, sex=m, hobbies=h1]*<br/>
<br/>
=&gt;[ActivationCreated(46): rule=findSeating <br/>
[fid:13:13]:[Seating id=1, pid=0, done=true, ls=1, ln=n5, rs=1, rn=n5]<br/>
[fid:9:9]:[Guest name=n5, sex=f, hobbies=h1]<br/>
[fid:1:1]:[Guest name=n1, sex=m, hobbies=h1]<br/>
<br/>
<span class="bold"><strong>Assign Seating</strong></span><br/>
=&gt;[fid:30:47]:[Seating id=5, pid=4, done=false, ls=4, ln=n2, rs=5, rn=n1]<br/>
=&gt;[fid:31:48]:[Path id=5, seat=5, guest=n1]<br/>
=&gt;[fid:32:49]:[Chosen id=4, name=n1, hobbies=h1]<br/>
</p></div></div></div><div class="section" title="23.17. Backward-Chaining"><div class="titlepage"><div><div><h2 class="title"><a id="d0e29201"/>23.17. Backward-Chaining</h2></div></div></div><p>A backward-chaining rule system is goal-driven. This means the system starts with a
    conclusion which the engine tries to satisfy. If it cannot do so it searches for sub-goals,
    that is, conclusions that will complete part of the current goal. It continues this process
    until either the initial conclusion is satisfied or there are no more unsatisfied sub-goals.
    <span class="bold"><strong>Prolog</strong></span> is an example of a backward-chaining engine. </p><div class="figure"><a id="d0e29209"/><p class="title"><strong>Figure 23.43. Backward Chaining Chart</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/BackwardChaining/BackwardChainingChart.png" alt="Backward Chaining Chart"/></div></div></div><br class="figure-break"/><div class="section" title="23.17.1. Backward-Chaining Systems"><div class="titlepage"><div><div><h3 class="title"><a id="d0e29215"/>23.17.1. Backward-Chaining Systems</h3></div></div></div><p>Backward-Chaining is a feature recently added to the JBoss Rules Engine.
      This process is often referred to as derivation queries, and it is not as common
      compared to reactive systems since JBoss Rules is primarily reactive forward chaining.
      That is, it responds to changes in your data. The backward-chaining added to the engine
      is for product-like derivations. </p></div><div class="section" title="23.17.2. Cloning Transitive Closures"><div class="titlepage"><div><div><h3 class="title"><a id="d0e29220"/>23.17.2. Cloning Transitive Closures</h3></div></div></div><div class="figure"><a id="d0e29223"/><p class="title"><strong>Figure 23.44. Reasoning Graph</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/BackwardChaining/ReasoningGraph.png" alt="Reasoning Graph"/></div></div></div><br class="figure-break"/><p>The previous chart demonstrates a House example of transitive items.
      A similar reasoning chart can be created by implementing the following rules: </p><p>1. First, create some java rules to develop reasoning for transitive items.
      It inserts each of the locations.</p><p>2. Next, create the <span class="bold"><strong>Location</strong></span> class; it has the
      item and where it is located. </p><p>3. Type the rules for the House example as depicted below: </p><pre><code class="language-java">ksession.insert( new Location("office", "house") );
ksession.insert( new Location("kitchen", "house") );
ksession.insert( new Location("knife", "kitchen") );
ksession.insert( new Location("cheese", "kitchen") );
ksession.insert( new Location("desk", "office") );
ksession.insert( new Location("chair", "office") );
ksession.insert( new Location("computer", "desk") );
ksession.insert( new Location("drawer", "desk") );</code></pre><p>4. A transitive design is created in which the item is in its designated location
      such as a "desk" located in an "office." </p><div class="figure"><a id="d0e29244"/><p class="title"><strong>Figure 23.45. Transitive Reasoning Graph of a House</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/BackwardChaining/TransitiveReasoningGraph.png" alt="Transitive Reasoning Graph of a House"/></div></div></div><br class="figure-break"/></div><div class="section" title="23.17.3. Defining a Query"><div class="titlepage"><div><div><h3 class="title"><a id="d0e29250"/>23.17.3. Defining a Query</h3></div></div></div><p>1. Create a query to look at the data inserted into the rules engine: </p><pre><code class="no-highlight">query isContainedIn( String x, String y )
  Location( x, y; )
  or
  ( Location( z, y; ) and isContainedIn( x, z; ) )
end</code></pre><p>Notice how the query is recursive and is calling "isContainedIn." </p><p>2. Create a rule to print out every string inserted into the system to see how
      things are implemented. The rule should resemble the following format: </p><pre><code class="no-highlight">rule "go" salience 10
when
  $s : String( )
then
  System.out.println( $s );
end</code></pre><p>3. Using Step 2 as a model, create a rule that calls upon the Step 1 query "isContainedIn." </p><pre><code class="no-highlight">rule "go1"
when
  String( this == "go1" )
  isContainedIn("office", "house"; )
then
  System.out.println( "office is in the house" );
end</code></pre><p>The "go1" rule will fire when the first string is inserted into the engine.
      That is, it asks if the item "office" is in the location "house." Therefore, the
      Step 1 query is evoked by the previous rule when the "go1" String is inserted.  </p><p>4. Create the "go1," insert it into the engine, and call the fireAllRules.  </p><pre><code class="no-highlight">         ksession.insert( "go1" );
ksession.fireAllRules();
---
go1
office is in the house</code></pre><p>The --- line indicates the separation of the output of the engine from
      the firing of the "go" rule and the "go1" rule.  </p></div><div class="section" title="23.17.4. Transitive Closure Example"><div class="titlepage"><div><div><h3 class="title"><a id="d0e29275"/>23.17.4. Transitive Closure Example</h3></div></div></div><p>1. Create a Transitive Closure by implementing the following rule:  </p><pre><code class="no-highlight">rule "go2"
when
  String( this == "go2" )
  isContainedIn("drawer", "house"; )
then
  System.out.println( "Drawer in the House" );
end</code></pre><p>2. Recall from the Cloning Transitive Closure's topic, there was no instance of "drawer"
      in "house." "drawer" was located in "desk."   </p><div class="figure"><a id="d0e29284"/><p class="title"><strong>Figure 23.46. Transitive Reasoning Graph of a Drawer</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Examples/BackwardChaining/TransitiveReasoningGraph2.png" alt="Transitive Reasoning Graph of a Drawer"/></div></div></div><br class="figure-break"/><p>3. Use the previous query for this recursive information.   </p><pre><code class="no-highlight">query isContainedIn( String x, String y )
  Location( x, y; )
  or
  ( Location( z, y; ) and isContainedIn( x, z; ) )
end</code></pre><p>4. Create the "go2," insert it into the engine, and call the fireAllRules.    </p><pre><code class="no-highlight">ksession.insert( "go2" );
ksession.fireAllRules();
---
go2
Drawer in the House</code></pre><p>When the rule is fired, it correctly tells you "go2" has been inserted and
      that the "drawer" is in the "house."  </p><p>5. Check how the engine determined this outcome  </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The query has to recurse down several levels to determine this.</p></li><li class="listitem"><p>Instead of using <span class="bold"><strong>Location( x, y; )</strong></span>,
          The query uses the value of <span class="bold"><strong>(z, y; )</strong></span>
          since "drawer" is not in "house." </p></li><li class="listitem"><p>The <span class="bold"><strong>z</strong></span> is currently unbound which means it
          has no value and will return everything that is in the argument. </p></li><li class="listitem"><p><span class="bold"><strong>y</strong></span> is currently bound to "house," so
          <span class="bold"><strong>z</strong></span> will return "office" and "kitchen." </p></li><li class="listitem"><p>Information is gathered from "office" and checks recursively if the "drawer"
          is in the "office." The following query line is being called for these parameters:
          <span class="bold"><strong>isContainedIn (x ,z; )</strong></span></p></li></ul></div><p>There is no instance of "drawer" in "office;" therefore, it does not match.
      With z being unbound, it will return data that is within the "office," and it will
      gather that <span class="bold"><strong>z == desk</strong></span>. </p><pre><code class="no-highlight">isContainedIn(x==drawer, z==desk)</code></pre><p>isContainedIn recurses three times. On the final recurse, an instance triggers of
      "drawer" in the "desk."  </p><pre><code class="no-highlight"> Location(x==drawer, y==desk)</code></pre><p>This matches on the first location and recurses back up, so we know that "drawer"
      is in the "desk," the "desk" is in the "office," and the "office" is in the "house;"
      therefore, the "drawer" is in the "house" and returns true.  </p></div><div class="section" title="23.17.5. Reactive Transitive Queries"><div class="titlepage"><div><div><h3 class="title"><a id="d0e29347"/>23.17.5. Reactive Transitive Queries</h3></div></div></div><p>1. Create a Reactive Transitive Query by implementing the following rule:  </p><pre><code class="no-highlight">rule "go3"
when
  String( this == "go3" )
  isContainedIn("key", "office"; )
then
  System.out.println( "Key in the Office" );
end</code></pre><p>Reactive Transitive Queries can ask a question even if the answer can not be
      satisfied. Later, if it is satisfied, it will return an answer. </p><p>2. Use the same query for this reactive information. </p><pre><code class="no-highlight">query isContainedIn( String x, String y )
  Location( x, y; )
  or
  ( Location( z, y; ) and isContainedIn( x, z; ) )
end</code></pre><p>3. Create the "go3," insert it into the engine, and call the fireAllRules.  </p><pre><code class="no-highlight">ksession.insert( "go3" );
ksession.fireAllRules();
---
go3</code></pre><p>The first rule that matches any String returns "go3" but nothing else is
      returned because there is no answer; however, while "go3" is inserted in the
      system, it will continuously wait until it is satisfied.  </p><p>4. Insert a new location of "key" in the "drawer":  </p><pre><code class="no-highlight">ksession.insert( new Location("key", "drawer") );
ksession.fireAllRules();
---
Key in the Office</code></pre><p>This new location satisfies the transitive closure because it is monitoring the
      entire graph. In addition, this process now has four recursive levels in which it
      goes through to match and fire the rule. </p></div><div class="section" title="23.17.6. Queries with Unbound Arguments"><div class="titlepage"><div><div><h3 class="title"><a id="d0e29372"/>23.17.6. Queries with Unbound Arguments</h3></div></div></div><p>1. Create a Query with Unbound Arguments by implementing the following rule:</p><pre><code class="no-highlight">rule "go4"
when
  String( this == "go4" )
  isContainedIn(thing, "office"; )
then
  System.out.println( "thing" + thing + "is in the Office" );
end</code></pre><p>This rule is asking for everything in the "office," and it will tell everything
      in all the rows below. The unbound argument (out variable thing) in this example will
      return every possible value; accordingly, it is very similar to the z value used in
      the Reactive Transitive Query example. </p><p>2. Use the query for the unbound arguments. </p><pre><code class="no-highlight">query isContainedIn( String x, String y )
  Location( x, y; )
  or
  ( Location( z, y; ) and isContainedIn( x, z; ) )
end</code></pre><p>3. Create the "go4," insert it into the engine, and call the fireAllRules. </p><pre><code class="no-highlight">ksession.insert( "go4" );
ksession.fireAllRules();
---
go4
thing Key is in the Office
thing Computer is in the Office
thing Drawer is in the Office
thing Desk is in the Office
thing Chair is in the Office</code></pre><p>When "go4" is inserted, it returns all the previous information that is
      transitively below "Office." </p></div><div class="section" title="23.17.7. Multiple Unbound Arguments"><div class="titlepage"><div><div><h3 class="title"><a id="d0e29391"/>23.17.7. Multiple Unbound Arguments</h3></div></div></div><p>1. Create a query with Mulitple Unbound Arguments by implementing the following rule:</p><pre><code class="no-highlight">rule "go5"
when
  String( this == "go5" )
  isContainedIn(thing, location; )
then
  System.out.println( "thing" + thing + "is in" + location );
end</code></pre><p>This rule is asking for everything in the "office," and it will tell everything
      in all the rows below. The unbound argument (out variable thing) in this example will
      return every possible value; accordingly, it is very similar to the z value used in
      the Reactive Transitive Query example. </p><p>Both <span class="bold"><strong>thing</strong></span> and <span class="bold"><strong>location</strong></span>
      are unbound out variables, and without bound arguments, everything is called upon. </p><p>2. Use the query for multiple unbound arguments. </p><pre><code class="no-highlight">query isContainedIn( String x, String y )
  Location( x, y; )
  or
  ( Location( z, y; ) and isContainedIn( x, z; ) )
end</code></pre><p>3. Create the "go5," insert it into the engine, and call the fireAllRules. </p><pre><code class="no-highlight">ksession.insert( "go5" );
ksession.fireAllRules();
---
go5
thing Knife is in House
thing Cheese is in House
thing Key is in House
thing Computer is in House
thing Drawer is in House
thing Desk is in House
thing Chair is in House
thing Key is in Office
thing Computer is in Office
thing Drawer is in Office
thing Key is in Desk
thing Office is in House
thing Computer is in Desk
thing Knife is in Kitchen
thing Cheese is in Kitchen
thing Kitchen is in House
thing Key is in Drawer
thing Drawer is in Desk
thing Desk is in Office
thing Chair is in Office</code></pre><p>When "go5" is called, it returns everything within everything. </p><p/></div></div></div></div></div><script type="text/javascript" src="highlight.js/highlight.pack.js"> </script><script type="text/javascript">hljs.initHighlightingOnLoad();</script></body></html>