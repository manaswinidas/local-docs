<html lang="zh-Hans" ><head></head><body class="book toc2 toc-left" >﻿
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<meta name="author" content="The Drools Team <https://www.drools.org/community/team.html>">
<title>Drools文档</title>
<link rel="stylesheet" href="asset?aid=0">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<!-- Adobe Analytics for Red Hat - DPAL (DTM Property Auto-Loader) - part 1/2 -->
<script id="dpal" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
<!-- Google Analytics for kie team: Global site tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-62250098-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-62250098-1');
</script>

<!-- Collapsed Table of Content -->
<link rel="stylesheet" href="website/jstree/style.css">
<link rel="stylesheet" href="website/toc.css">


<div id="header">
<h1>Drools文档</h1>
<div class="details">
<span id="author" class="author">流口水团队<https: www.drools.org="" community="" team.html=""></https:></span><br>
<span id="revnumber">版本7.30.0。最后</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">目录</div>
<ul class="sectlevel1">
<li><a href="#_welcome">1。介绍</a>
<ul class="sectlevel2">
<li><a href="#_introduction">1.1。介绍</a></li>
<li><a href="#_gettingstarted">1.2。卷入</a>
<ul class="sectlevel3">
<li><a href="#_sign_up_to_jboss_org">1.2.1。注册jboss.org</a></li>
<li><a href="#_sign_the_contributor_agreement">1.2.2。签署贡献者协议</a></li>
<li><a href="#_submitting_issues_via_jira">1.2.3。通过JIRA提交问题</a></li>
<li><a href="#_fork_github">1.2.4。叉GitHub</a></li>
<li><a href="#_writing_tests">1.2.5。写作测试</a></li>
<li><a href="#_commit_with_correct_conventions">1.2.6。遵守正确的约定</a></li>
<li><a href="#_submit_pull_requests">1.2.7。提交拉取请求</a></li>
</ul>
</li>
<li><a href="#_installationandsetup">1.3。安装和设置（Core和IDE）</a>
<ul class="sectlevel3">
<li><a href="#_installing_and_using">1.3.1。安装和使用</a></li>
<li><a href="#_building_from_source">1.3.2。从源头建造</a></li>
<li><a href="#_eclipse">1.3.3。日食</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_kiechapter">2。IE</a>
<ul class="sectlevel2">
<li><a href="#_kieoverviewsection">2.1。总览</a>
<ul class="sectlevel3">
<li><a href="#_kieanatomysection">2.1.1。项目剖析</a></li>
<li><a href="#_kielifecyclessection">2.1.2。生命周期</a></li>
<li><a href="#installation-options-ref_decision-management-architecture">2.1.3。Drools的安装环境选项</a></li>
<li><a href="#decision-authoring-assets-ref_decision-management-architecture">2.1.4。Drools中的决策制定资产</a></li>
<li><a href="#project-storage-version-build-options-ref_decision-management-architecture">2.1.5。Drools的项目存储和构建选项</a></li>
<li><a href="#project-deployment-options-ref_decision-management-architecture">2.1.6。Drools的项目部署选项</a></li>
<li><a href="#project-asset-execution-options-ref_decision-management-architecture">2.1.7。Drools的资产执行选项</a></li>
<li><a href="#architecture-scenarios-ref_decision-management-architecture">2.1.8。Drools的示例决策管理架构</a></li>
</ul>
</li>
<li><a href="#_builddeployutilizeandrunsection">2.2。构建，部署，利用和运行</a>
<ul class="sectlevel3">
<li><a href="#_kiemoduleintroductionbuildingintroductionsection">2.2.1。介绍</a></li>
<li><a href="#_kiebuildingsection">2.2.2。建造</a></li>
<li><a href="#_kiedeployingsection">2.2.3。部署中</a></li>
<li><a href="#_kierunningsection">2.2.4。跑步</a></li>
<li><a href="#_kiedeploycheatsheets">2.2.5。安装和部署备忘单</a></li>
<li><a href="#_kieexamplessection">2.2.6。构建，部署和利用示例</a></li>
<li><a href="#kie-scanner-proc_decision-management-architecture">2.2.7。使用KIE扫描器监视和更新KIE容器</a></li>
</ul>
</li>
<li><a href="#_kiesecuritysection">2.3。安全</a>
<ul class="sectlevel3">
<li><a href="#_securitymanager">2.3.1。安全经理</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#decision-engine-con_decision-engine">3。流口水引擎</a>
<ul class="sectlevel2">
<li><a href="#kie-sessions-con_decision-engine">3.1。KIE会议</a>
<ul class="sectlevel3">
<li><a href="#kie-sessions-stateless-con_decision-engine">3.1.1。无状态KIE会议</a></li>
<li><a href="#kie-sessions-stateful-con_decision-engine">3.1.2。有状态的KIE会议</a></li>
<li><a href="#kie-sessions-pools-con_decision-engine">3.1.3。KIE会话池</a></li>
</ul>
</li>
<li><a href="#inference-and-truth-maintenance_decision-engine">3.2。Drools引擎中的推理和真相维护</a>
<ul class="sectlevel3">
<li><a href="#_government_id_example">3.2.1。政府编号范例</a></li>
<li><a href="#fact-equality-modes-con_decision-engine">3.2.2。Drools引擎中的事实平等模式</a></li>
</ul>
</li>
<li><a href="#execution-control-con_decision-engine">3.3。Drools引擎中的执行控制</a>
<ul class="sectlevel3">
<li><a href="#_salience_for_rules">3.3.1。突出规则</a></li>
<li><a href="#_agenda_groups_for_rules">3.3.2。规则议程小组</a></li>
<li><a href="#_activation_groups_for_rules">3.3.3。规则激活组</a></li>
<li><a href="#rule-execution-modes-con_decision-engine">3.3.4。Drools引擎中的规则执行模式和线程安全</a></li>
<li><a href="#fact-propagation-modes-con_decision-engine">3.3.5。Drools引擎中的事实传播模式</a></li>
<li><a href="#agenda-filters-con_decision-engine">3.3.6。议程评估过滤器</a></li>
<li><a href="#drl-rule-units-con_decision-engine">3.3.7。DRL规则集中的规则单位</a></li>
</ul>
</li>
<li><a href="#phreak-algorithm-con_decision-engine">3.4。Drools引擎中的Phreak规则算法</a>
<ul class="sectlevel3">
<li><a href="#phreak-rule-evaluation-con_decision-engine">3.4.1。Phreak中的规则评估</a></li>
<li><a href="#rule-base-configuration-con_decision-engine">3.4.2。规则库配置</a></li>
<li><a href="#phreak-sequential-mode-con_decision-engine">3.4.3。Phreak中的顺序模式</a></li>
</ul>
</li>
<li><a href="#cep-con_decision-engine">3.5。复杂事件处理（CEP）</a>
<ul class="sectlevel3">
<li><a href="#cep-events-con_decision-engine">3.5.1。复杂事件处理中的事件</a></li>
<li><a href="#cep-events-proc_decision-engine">3.5.2。将事实声明为事件</a></li>
<li><a href="#drl-declarations-metadata-tags-ref_decision-engine">3.5.3。事件的元数据标签</a></li>
<li><a href="#cep-modes-con_decision-engine">3.5.4。Drools引擎中的事件处理模式</a></li>
<li><a href="#property-change-listeners-con_decision-engine">3.5.5。事实类型的属性更改设置和侦听器</a></li>
<li><a href="#cep-temporal-operators_decision-engine">3.5.6。事件的临时运算符</a></li>
<li><a href="#cep-clock-ref_decision-engine">3.5.7。Drools引擎中的会话时钟实现</a></li>
<li><a href="#cep-event-streams-con_decision-engine">3.5.8。事件流和入口点</a></li>
<li><a href="#cep-sliding-windows-con_decision-engine">3.5.9。滑动时间或长度的窗口</a></li>
<li><a href="#cep-memory-management-con_decision-engine">3.5.10。事件的内存管理</a></li>
</ul>
</li>
<li><a href="#engine-queries-con_decision-engine">3.6。Drools引擎查询和实时查询</a></li>
<li><a href="#engine-event-listeners-con_decision-engine">3.7。Drools引擎事件监听器和调试日志记录</a>
<ul class="sectlevel3">
<li><a href="#logging-proc_decision-engine">3.7.1。在Drools引擎中配置日志记录实用程序</a></li>
</ul>
</li>
<li><a href="#performance-tuning-decision-engine-ref_decision-engine">3.8。Drools引擎的性能调整注意事项</a></li>
</ul>
</li>
<li><a href="#_droolslanguagereferencechapter">4。规则语言参考</a>
<ul class="sectlevel2">
<li><a href="#drl-rules-con_drl-rules">4.1。DRL（Drools规则语言）规则</a>
<ul class="sectlevel3">
<li><a href="#drl-packages-con_drl-rules">4.1.1。DRL中的软件包</a></li>
<li><a href="#drl-imports-con_drl-rules">4.1.2。DRL中的导入语句</a></li>
<li><a href="#drl-functions-con_drl-rules">4.1.3。DRL中的功能</a></li>
<li><a href="#drl-queries-con_drl-rules">4.1.4。DRL中的查询</a></li>
<li><a href="#drl-declarations-con_drl-rules">4.1.5。DRL中的类型声明和元数据</a></li>
<li><a href="#drl-globals-con_drl-rules">4.1.6。DRL中的全局变量</a></li>
<li><a href="#rules-attributes-ref_drl-rules">4.1.7。DRL中的规则属性</a></li>
<li><a href="#drl-rules-WHEN-con_drl-rules">4.1.8。DRL中的规则条件（时间）</a></li>
<li><a href="#drl-rules-THEN-con_drl-rules">4.1.9。DRL中的规则操作（THEN）</a></li>
<li><a href="#drl-rules-comments-con_drl-rules">4.1.10。DRL文件中的注释</a></li>
<li><a href="#drl-rules-errors-ref_drl-rules">4.1.11。DRL故障排除的错误消息</a></li>
<li><a href="#drl-rule-units-con_drl-rules">4.1.12。DRL规则集中的规则单位</a></li>
<li><a href="#performance-tuning-drl-ref_drl-rules">4.1.13。DRL的性能调整注意事项</a></li>
</ul>
</li>
<li><a href="#_domain_specific_languages">4.2。领域特定语言</a>
<ul class="sectlevel3">
<li><a href="#_when_to_use_a_dsl">4.2.1。何时使用DSL</a></li>
<li><a href="#_dsl_basics">4.2.2。DSL基础</a></li>
<li><a href="#_adding_constraints_to_facts">4.2.3。向事实添加约束</a></li>
<li><a href="#_developing_a_dsl">4.2.4。开发DSL</a></li>
<li><a href="#_dsl_and_dslr_reference">4.2.5。DSL和DSLR参考</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#drools.DMN">5，决策模型和表示法（DMN）</a>
<ul class="sectlevel2">
<li><a href="#dmn-con_dmn-models">5.1。决策模型和表示法（DMN）</a>
<ul class="sectlevel3">
<li><a href="#dmn-conformance-levels-con_dmn-models">5.1.1。DMN符合性级别</a></li>
<li><a href="#dmn-drd-components-ref_dmn-models">5.1.2。DMN决策需求图（DRD）组件</a></li>
<li><a href="#dmn-feel-con_dmn-models">5.1.3。FEEL中的规则表达式</a></li>
<li><a href="#dmn-boxed-expressions-con_dmn-models">5.1.4。装箱表达式中的DMN决策逻辑</a></li>
<li><a href="#dmn-model-example-ref_dmn-models">5.1.5。DMN模型示例</a></li>
</ul>
</li>
<li><a href="#dmn-support-con_dmn-models">5.2。Drools中的DMN支持</a>
<ul class="sectlevel3">
<li><a href="#dmn-feel-enhancements-ref_dmn-models">5.2.1。在Drools中增强FEEL</a></li>
<li><a href="#dmn-model-enhancements-ref_dmn-models">5.2.2。Drools中的DMN模型增强</a></li>
<li><a href="#dmn-properties-ref_dmn-models">5.2.3。Drools中可配置的DMN属性</a></li>
</ul>
</li>
<li><a href="#dmn-model-creating-proc_dmn-models">5.3。在Business Central中创建和编辑DMN模型</a>
<ul class="sectlevel3">
<li><a href="#dmn-logic-defining-proc_dmn-models">5.3.1。在Business Central中的框式表达式中定义DMN决策逻辑</a></li>
<li><a href="#dmn-data-types-defining-proc_dmn-models">5.3.2。在Business Central中为DMN框式表达式创建自定义数据类型</a></li>
<li><a href="#dmn-included-models-con_dmn-models">5.3.3。Business Central中DMN文件中包含的模型</a></li>
<li><a href="#dmn-documentation-con_dmn-models">5.3.4。Business Central中的DMN模型文档</a></li>
<li><a href="#dmn-designer-nav-ref_dmn-models">5.3.5。Business Central中的DMN设计器导航和属性</a></li>
</ul>
</li>
<li><a href="#dmn-execution-con">5.4。DMN模型执行</a>
<ul class="sectlevel3">
<li><a href="#dmn-execution-embedded-proc">5.4.1。将DMN调用直接嵌入Java应用程序中</a></li>
<li><a href="#dmn-execution-remote-java-proc">5.4.2。使用KIE Server Java客户端API执行DMN服务</a></li>
<li><a href="#dmn-execution-rest-proc">5.4.3。使用KIE Server REST API执行DMN服务</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#drools.PMML">6。预测模型标记语言（PMML）</a>
<ul class="sectlevel2">
<li><a href="#pmml-con_pmml-models">6.1。预测模型标记语言（PMML）</a>
<ul class="sectlevel3">
<li><a href="#pmml-conformance-con_pmml-models">6.1.1。PMML一致性等级</a></li>
</ul>
</li>
<li><a href="#pmml-examples-ref_pmml-models">6.2。PMML模型示例</a></li>
<li><a href="#pmml-support-con_pmml-models">6.3。Drools中的PMML支持</a>
<ul class="sectlevel3">
<li><a href="#pmml-naming-conventions-ref_pmml-models">6.3.1。Drools中的PMML命名约定</a></li>
<li><a href="#pmml-extensions-ref_pmml-models">6.3.2。Drools中的PMML扩展</a></li>
</ul>
</li>
<li><a href="#pmml-invocation-options-con_pmml-models">6.4。PMML模型执行</a>
<ul class="sectlevel3">
<li><a href="#pmml-invocation-embedded-proc_pmml-models">6.4.1。将PMML调用直接嵌入Java应用程序中</a></li>
<li><a href="#pmml-invocation-kie-server-proc_pmml-models">6.4.2。使用KIE Server执行PMML模型</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_experimentalfeatureschapter">7。实验特征</a>
<ul class="sectlevel2">
<li><a href="#_declarative_agenda">7.1。声明性议程</a></li>
<li><a href="#_traits">7.2。特质</a>
<ul class="sectlevel3">
<li><a href="#_cascading_traits">7.2.1。级联特征</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ch.commands">8。口水命令</a>
<ul class="sectlevel2">
<li><a href="#runtime-commands-con_kie-apis">8.1。Drools中的运行时命令</a>
<ul class="sectlevel3">
<li><a href="#runtime-commands-samples-ref_kie-apis">8.1.1。Drools中的示例运行时命令</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_cdichapter">9。CDI</a>
<ul class="sectlevel2">
<li><a href="#_introduction_2">9.1。介绍</a></li>
<li><a href="#_annotations">9.2。注解</a>
<ul class="sectlevel3">
<li><a href="#_kreleaseid">9.2.1。@KReleaseId</a></li>
<li><a href="#_kcontainer">9.2.2。@KContainer</a></li>
<li><a href="#_kbase">9.2.3。@KBase</a></li>
<li><a href="#_ksession_for_kiesession">9.2.4。KieSession的@KSession</a></li>
<li><a href="#_ksession_for_statelesskiesession">9.2.5。@KSession用于StatelessKieSession</a></li>
</ul>
</li>
<li><a href="#_api_example_comparison">9.3。API示例比较</a></li>
</ul>
</li>
<li><a href="#_ch.kie.spring">10。与Spring整合</a>
<ul class="sectlevel2">
<li><a href="#_important_changes_for_drools_6_0">10.1。Drools 6.0的重要更改</a></li>
<li><a href="#_integration_with_drools_expert">10.2。与Drools Expert集成</a>
<ul class="sectlevel3">
<li><a href="#_kiemodule">10.2.1。KieModule</a></li>
<li><a href="#_kiebase_3">10.2.2。凯基</a></li>
<li><a href="#_important_note">10.2.3。重要的提示</a></li>
<li><a href="#_kiesessions">10.2.4。KieSessions</a></li>
<li><a href="#_kiereleaseid">10.2.5。凯：ReleaseId</a></li>
<li><a href="#_kieimport">10.2.6。凯：进口</a></li>
<li><a href="#_annotations_2">10.2.7。注解</a></li>
<li><a href="#_event_listeners">10.2.8。事件监听器</a></li>
<li><a href="#_loggers">10.2.9。记录仪</a></li>
<li><a href="#_defining_batch_commands">10.2.10。定义批处理命令</a></li>
<li><a href="#_persistence">10.2.11。坚持不懈</a></li>
<li><a href="#_leveraging_other_spring_features">10.2.12。利用其他Spring功能</a></li>
</ul>
</li>
<li><a href="#_integration_with_jbpm_human_task">10.3。与jBPM人工任务集成</a>
<ul class="sectlevel3">
<li><a href="#_how_to_configure_spring_with_jbpm_human_task">10.3.1。如何使用jBPM人工任务配置Spring</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ch.kie.blueprint">11。与白羊座蓝图整合</a>
<ul class="sectlevel2">
<li><a href="#_integration_with_drools_expert_2">11.1。与Drools Expert集成</a>
<ul class="sectlevel3">
<li><a href="#_kiemodule_2">11.1.1。KieModule</a></li>
<li><a href="#_kiebase_4">11.1.2。凯基</a></li>
<li><a href="#_kiesessions_2">11.1.3。KieSessions</a></li>
<li><a href="#_kiereleaseid_2">11.1.4。凯：ReleaseId</a></li>
<li><a href="#_kieimport_2">11.1.5。凯：进口</a></li>
<li><a href="#_event_listeners_2">11.1.6。事件监听器</a></li>
<li><a href="#_loggers_2">11.1.7。记录仪</a></li>
<li><a href="#_defining_batch_commands_2">11.1.8。定义批处理命令</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ch.kie.android">12Android整合</a>
<ul class="sectlevel2">
<li><a href="#_integration_with_drools_expert_3">12.1。与Drools Expert集成</a>
<ul class="sectlevel3">
<li><a href="#_pre_serialized_rules">12.1.1。预序列化规则</a></li>
<li><a href="#_kiecontainer_api_with_drools_compiler_dependency">12.1.2。具有drools-compiler依赖性的KieContainer API</a></li>
</ul>
</li>
<li><a href="#_integration_with_roboguice">12.2。与Roboguice集成</a>
<ul class="sectlevel3">
<li><a href="#_pre_serialized_rules_with_roboguice">12.2.1。Roboguice的预序列化规则</a></li>
<li><a href="#_kiecontainer_with_drools_compiler_dependency_and_roboguice">12.2.2。具有流口水编译器依赖性和Roboguice的KieContainer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ch.camel">13Apache Camel集成</a>
<ul class="sectlevel2">
<li><a href="#_camel">13.1。骆驼</a></li>
</ul>
</li>
<li><a href="#_ch.server">14。Drools骆驼服务器</a>
<ul class="sectlevel2">
<li><a href="#_introduction_3">14.1。介绍</a></li>
<li><a href="#_deployment">14.2。部署方式</a></li>
<li><a href="#_configuration">14.3。组态</a>
<ul class="sectlevel3">
<li><a href="#_restcamel_services_configuration">14.3.1。REST /骆驼服务配置</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_wb.workbench">15商务中心（一般）</a>
<ul class="sectlevel2">
<li><a href="#_wb.installation">15.1。安装</a>
<ul class="sectlevel3">
<li><a href="#_wb.warinstallation">15.1.1。战争安装</a></li>
<li><a href="#_wb.workbenchdata">15.1.2。商务中心数据</a></li>
<li><a href="#_wb.troubleshooting">15.1.3。故障排除</a></li>
</ul>
</li>
<li><a href="#business-central-system-properties-ref">15.2。商务中心系统属性</a></li>
<li><a href="#_wb.quickstart">15.3。快速开始</a>
<ul class="sectlevel3">
<li><a href="#_wb.quickstartimportexamples">15.3.1。导入示例</a></li>
<li><a href="#_wb.quickstartaddproject">15.3.2。新增专案</a></li>
<li><a href="#_wb.quickstartdefinedatamodel">15.3.3。定义数据模型</a></li>
<li><a href="#_wb.quickstartdefinerule">15.3.4。定义规则</a></li>
<li><a href="#_wb.quickstartbuildanddeloy">15.3.5。构建和部署</a></li>
</ul>
</li>
<li><a href="#_wb.configuration">15.4。组态</a>
<ul class="sectlevel3">
<li><a href="#_wb.usermanagement">15.4.1。基本用户管理</a></li>
<li><a href="#_wb.roles">15.4.2。的角色</a></li>
</ul>
</li>
<li><a href="#_wb.introduction">15.5。介绍</a>
<ul class="sectlevel3">
<li><a href="#_wb.loginandlogout">15.5.1。登录并注销</a></li>
<li><a href="#_wb.homescreen">15.5.2。主屏幕</a></li>
<li><a href="#_wb.administrationoverview">15.5.3。商务中心概述</a></li>
<li><a href="#_wb.workbenchconcepts">15.5.4。业务中心用户界面概念</a></li>
</ul>
</li>
<li><a href="#_wb.changinglayout">15.6。改变布局</a>
<ul class="sectlevel3">
<li><a href="#_wb.resizing">15.6.1。调整大小</a></li>
</ul>
</li>
<li><a href="#_wb.authoring">15.7。创作（一般）</a>
<ul class="sectlevel3">
<li><a href="#_wb.artifactrepository">15.7.1。工件存储库</a></li>
<li><a href="#_wb.asseteditor">15.7.2。资产编辑器</a></li>
<li><a href="#_wb.tagseditor">15.7.3。标签编辑器</a></li>
<li><a href="#_wb.projectexplorer">15.7.4。项目浏览器</a></li>
<li><a href="#_wb.projecteditor">15.7.5。项目编辑</a></li>
<li><a href="#_wb.validation">15.7.6。验证方式</a></li>
<li><a href="#_wb.datamodeller">15.7.7。数据建模师</a></li>
<li><a href="#_wb.datasets">15.7.8。数据集</a></li>
<li><a href="#_wb.datasources">15.7.9。资料来源管理</a></li>
</ul>
</li>
<li><a href="#_wb.userandgroupmgmt">15.8。安全管理</a>
<ul class="sectlevel3">
<li><a href="#_basic_concepts">15.8.1。基本概念</a></li>
<li><a href="#_installation_and_setup">15.8.2。安装与设定</a></li>
<li><a href="#_usage">15.8.3。用法</a></li>
<li><a href="#_security_settings_editor">15.8.4。安全设置编辑器</a></li>
<li><a href="#_security_policy_storage">15.8.5。安全策略存储</a></li>
</ul>
</li>
<li><a href="#_wb.sshkeystore">15.9。SSH密钥库</a>
<ul class="sectlevel3">
<li><a href="#_introduction_4">15.9.1。介绍</a></li>
<li><a href="#_using_the_ssh_keystore">15.9.2。使用SSH密钥库</a></li>
</ul>
</li>
<li><a href="#_wb.embedding">15.10。在您的应用程序中嵌入Business Central</a></li>
<li><a href="#_wb.execserverui">15.11。执行服务器管理UI</a>
<ul class="sectlevel3">
<li><a href="#_wb.execserveruitemplate">15.11.1。服务器模板</a></li>
<li><a href="#_wb.execserveruicontainer">15.11.2。容器</a></li>
<li><a href="#_wb.execserveruiremoteserver">15.11.3。远端伺服器</a></li>
</ul>
</li>
<li><a href="#_wb.experimentalFeatures">15.12。实验功能框架</a>
<ul class="sectlevel3">
<li><a href="#_introduction_5">15.12.1。介绍</a></li>
<li><a href="#_types_of_experimental_features">15.12.2。<em>实验特征的</em>类型</a></li>
<li><a href="#_experimental_features_editor">15.12.3。实验功能编辑器</a></li>
<li><a href="#_enabling_the_experimental_features_framework">15.12.4。启用实验功能框架</a></li>
</ul>
</li>
<li><a href="#_wb.workbenchProfiles">15.13。商务中心档案</a>
<ul class="sectlevel3">
<li><a href="#_introduction_6">15.13.1。介绍</a></li>
<li><a href="#_selecting_a_profile">15.13.2。选择个人资料</a></li>
</ul>
</li>
<li><a href="#performance-tuning-business-central-ref_kie-apis">15.14。使用Business Central进行性能调整的注意事项</a></li>
</ul>
</li>
<li><a href="#drools.AuthoringAssets">16。创作规则资产</a>
<ul class="sectlevel2">
<li><a href="#_drools.newpackage">16.1。创建一个包</a>
<ul class="sectlevel3">
<li><a href="#_empty_package">16.1.1。空包装</a></li>
<li><a href="#_copy_rename_and_delete_packages">16.1.2。复制，重命名和删除软件包</a></li>
</ul>
</li>
<li><a href="#guided-rules-con_kie-apis">16.2。指导规则</a>
<ul class="sectlevel3">
<li><a href="#guided-rules-create-proc_kie-apis">16.2.1。建立指导性规则</a></li>
<li><a href="#_drools.guidedruleeditordsl">16.2.2。DSL句子增强</a></li>
<li><a href="#guided-rules-options-proc_kie-apis">16.2.3。添加其他规则选项</a></li>
<li><a href="#_drools.guidedruleeditorcomplexexample">16.2.4。一个更复杂的示例：</a></li>
</ul>
</li>
<li><a href="#guided-rule-templates-con">16.3。指导规则模板</a>
<ul class="sectlevel3">
<li><a href="#guided-rule-templates-create-proc">16.3.1。创建指导规则模板</a></li>
<li><a href="#guided-rule-templates-tables-proc">16.3.2。为指导规则模板定义数据表</a></li>
</ul>
</li>
<li><a href="#guided-decision-tables-con">16.4。指导决策表</a>
<ul class="sectlevel3">
<li><a href="#guided-decision-tables-create-proc">16.4.1。创建指导决策表</a></li>
<li><a href="#hit-policies-con">16.4.2。指导决策表的命中策略</a></li>
<li><a href="#guided-decision-tables-columns-create-proc">16.4.3。在指导决策表中添加列</a></li>
<li><a href="#guided-decision-tables-columns-types-con">16.4.4。指导决策表中的列类型</a></li>
<li><a href="#guided-decision-tables-columns-edit-proc">16.4.5。编辑或删除指导决策表中的列</a></li>
<li><a href="#guided-decision-tables-rows-create-proc">16.4.6。在指导决策表中添加行并定义规则</a></li>
<li><a href="#guided-decision-tables-validation-con">16.4.7。实时验证和确认指导决策表</a></li>
<li><a href="#guided-decision-tables-convert-proc">16.4.8。将指导决策表转换为电子表格决策表</a></li>
</ul>
</li>
<li><a href="#_drools.guideddecisiontablegrapheditor">16.5。指导决策表图</a>
<ul class="sectlevel3">
<li><a href="#_editor">16.5.1。编辑</a></li>
<li><a href="#_creating_a_new_graph">16.5.2。创建一个新图</a></li>
<li><a href="#_adding_new_tables_to_the_graph">16.5.3。向图中添加新表</a></li>
<li><a href="#_removing_tables">16.5.4。移除桌子</a></li>
</ul>
</li>
<li><a href="#_drools.guideddecisiontreeeditor">16.6。指导决策树</a>
<ul class="sectlevel3">
<li><a href="#_the_initial_editor_layout">16.6.1。初始编辑器布局</a></li>
<li><a href="#_first_steps">16.6.2。第一步</a></li>
<li><a href="#_editing_data_object_nodes">16.6.3。编辑数据对象节点</a></li>
<li><a href="#_editing_field_constraint_nodes">16.6.4。编辑字段约束节点</a></li>
<li><a href="#_editing_action_nodes">16.6.5。编辑动作节点</a></li>
<li><a href="#_managing_the_tree">16.6.6。管理树</a></li>
</ul>
</li>
<li><a href="#decision-tables-con_decision-tables">16.7。电子表格决策表</a>
<ul class="sectlevel3">
<li><a href="#decision-tables-use-case-con">16.7.1。决策表用例</a></li>
<li><a href="#decision-tables-defining-proc">16.7.2。定义电子表格决策表</a></li>
<li><a href="#_creating_and_integrating_spreadsheet_decision_tables">16.7.3。创建和集成电子表格决策表</a></li>
<li><a href="#_decision_table_workflow_and_collaboration">16.7.4。决策表工作流程和协作</a></li>
<li><a href="#_using_spreadsheet_features">16.7.5。使用电子表格功能</a></li>
<li><a href="#_rule_templates">16.7.6。规则模板</a></li>
<li><a href="#decision-tables-upload-proc">16.7.7。将电子表格决策表上传到Business Central</a></li>
<li><a href="#decision-tables-convert-proc">16.7.8。将上载的电子表格决策表转换为Business Central中的指导决策表</a></li>
</ul>
</li>
<li><a href="#drl-rules-con_drl-rules">16.8。DRL（Drools规则语言）规则</a>
<ul class="sectlevel3">
<li><a href="#drl-rules-central-create-proc">16.8.1。在Business Central中创建DRL规则</a></li>
</ul>
</li>
<li><a href="#_drools.dsleditor">16.9。DSL（特定领域语言）规则</a></li>
<li><a href="#_drools.guidedscorecardeditor">16.10。计分卡</a>
<ul class="sectlevel3">
<li><a href="#_drools.guidedscorecardeditorsetupparameters">16.10.1。 （a）设定参数</a></li>
<li><a href="#_drools.guidedscorecardeditorcharacteristics">16.10.2。 （b）特征</a></li>
</ul>
</li>
<li><a href="#enumerations-define-proc_drl-rules">16.11。定义规则资产中的下拉列表的枚举</a>
<ul class="sectlevel3">
<li><a href="#enumerations-advanced-ref_drl-rules">16.11.1。规则资产的高级枚举选项</a></li>
</ul>
</li>
<li><a href="#test-scenarios-intro-con">16.12。测试场景</a>
<ul class="sectlevel3">
<li><a href="#test-designer-con">16.12.1。Business Central中的测试方案设计器</a></li>
<li><a href="#test-designer-create-test-scenario-template-con">16.12.2。测试方案模板</a></li>
<li><a href="#test-designer-test-template-dmn-based-con">16.12.3。基于DMN的测试方案的测试模板</a></li>
<li><a href="#test-designer-test-scenario-definition-proc">16.12.4。定义测试方案</a></li>
<li><a href="#test-designer-list-map-add-remove-item-proc">16.12.5。在测试场景中使用列表和地图集合</a></li>
<li><a href="#test-designer-expressions-syntax-intro-ref">16.12.6。测试方案中的表达式语法</a></li>
<li><a href="#test-designer-run-test-proc">16.12.7。运行测试方案</a></li>
<li><a href="#test-scenarios-running-locally-proc">16.12.8。在本地运行测试方案</a></li>
<li><a href="#test-designer-create-mortgages-example-proc">16.12.9。使用示例抵押项目创建测试方案</a></li>
<li><a href="#test-scenarios-legacy-designer-con">16.12.10。Business Central中的测试方案（旧版）设计器</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_wb.workbenchintegration">17。商业中心整合</a>
<ul class="sectlevel2">
<li><a href="#knowledge-store-rest-api-con_drl-rules">17.1。适用于Business Central空间和项目的Knowledge Store REST API</a>
<ul class="sectlevel3">
<li><a href="#knowledge-store-rest-api-requests-proc_drl-rules">17.1.1。使用REST客户端或curl实用程序通过Knowledge Store REST API发送请求</a></li>
<li><a href="#knowledge-store-rest-api-endpoints-ref_drl-rules">17.1.2。支持的Knowledge Store REST API端点</a></li>
</ul>
</li>
<li><a href="#_embedded_drools_controller_calls">17.2。嵌入式Drools控制器调用</a></li>
<li><a href="#_kie.keycloakssointegration">17.3。Keycloak SSO集成</a>
<ul class="sectlevel3">
<li><a href="#_scenario">17.3.1。情境</a></li>
<li><a href="#_install_and_set_up_a_keycloak_server">17.3.2。安装和设置Keycloak服务器</a></li>
<li><a href="#_create_and_set_up_the_demo_realm">17.3.3。创建并设置演示领域</a></li>
<li><a href="#_install_and_set_up_business_central">17.3.4。安装和设置Business Central</a></li>
<li><a href="#_securing_business_central_remote_services_via_keycloak">17.3.5。通过Keycloak保护Business Central远程服务</a></li>
<li><a href="#_securing_business_centrals_file_system_services_via_keycloak">17.3.6。通过Keycloak保护Business Central的文件系统服务</a></li>
<li><a href="#_execution_server">17.3.7。执行服务器</a></li>
<li><a href="#consumingRemoteServices">17.3.8。消费远程服务</a></li>
<li><a href="#_keycloak_and_the_business_centrals_security_administration_area">17.3.9。Keycloak和Business Central的安全管理区域</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_wb.workbenchhighavailability">18岁商业中心高可用性</a>
<ul class="sectlevel2">
<li><a href="#_wb.vfsclustering">18.1。VFS群集</a></li>
<li><a href="#_jbpm_clustering">18.2。 jBPM集群</a></li>
</ul>
</li>
<li><a href="#_ch.kie.server">19KIE执行服务器</a>
<ul class="sectlevel2">
<li><a href="#_overview">19.1。总览</a>
<ul class="sectlevel3">
<li><a href="#_glossary">19.1.1。词汇表</a></li>
</ul>
</li>
<li><a href="#_installing_the_kie_server">19.2。安装KIE服务器</a>
<ul class="sectlevel3">
<li><a href="#_installation_details_for_different_containers">19.2.1。不同容器的安装详细信息</a></li>
</ul>
</li>
<li><a href="#kie-server-system-properties-ref_kie-apis">19.3。KIE Server系统属性</a></li>
<li><a href="#kie-server-extensions-con_kie-apis">19.4。KIE Server功能和扩展</a>
<ul class="sectlevel3">
<li><a href="#kie-server-extensions-endpoint-proc_kie-apis">19.4.1。使用自定义REST API端点扩展现有的KIE Server功能</a></li>
<li><a href="#kie-server-extensions-transport-proc_kie-apis">19.4.2。扩展KIE Server以使用自定义数据传输</a></li>
<li><a href="#kie-server-extensions-client-proc_kie-apis">19.4.3。使用自定义客户端API扩展KIE Server客户端</a></li>
</ul>
</li>
<li><a href="#_kie_server_setup">19.5。Kie服务器设置</a>
<ul class="sectlevel3">
<li><a href="#_managed_kie_server">19.5.1。托管Kie服务器</a></li>
<li><a href="#_unmanaged_kie_execution_server">19.5.2。非托管KIE执行服务器</a></li>
</ul>
</li>
<li><a href="#_creating_a_kie_container">19.6。创建一个Kie容器</a></li>
<li><a href="#_managing_containers">19.7。管理容器</a>
<ul class="sectlevel3">
<li><a href="#_starting_a_container">19.7.1。启动容器</a></li>
<li><a href="#_stopping_and_deleting_a_container">19.7.2。停止和删除容器</a></li>
<li><a href="#_updating_a_container">19.7.3。更新容器</a></li>
</ul>
</li>
<li><a href="#kie-server-rest-api-con_kie-apis">19.8。适用于KIE容器和企业资产的KIE Server REST API</a>
<ul class="sectlevel3">
<li><a href="#kie-server-rest-api-requests-proc_kie-apis">19.8.1。使用REST客户端或curl实用程序通过KIE Server REST API发送请求</a></li>
<li><a href="#kie-server-rest-api-requests-swagger-proc_kie-apis">19.8.2。使用Swagger接口通过KIE Server REST API发送请求</a></li>
<li><a href="#kie-server-rest-api-endpoints-ref_kie-apis">19.8.3。支持的KIE Server REST API端点</a></li>
</ul>
</li>
<li><a href="#kie-server-java-api-con_kie-apis">19.9。用于KIE容器和业务资产的KIE Server Java客户端API</a>
<ul class="sectlevel3">
<li><a href="#kie-server-java-api-requests-proc_kie-apis">19.9.1。使用KIE Server Java客户端API发送请求</a></li>
<li><a href="#kie-server-java-clients-ref_kie-apis">19.9.2。支持的KIE Server Java客户端</a></li>
<li><a href="#kie-server-java-api-examples-ref_kie-apis">19.9.3。使用KIE Server Java客户端API的示例请求</a></li>
</ul>
</li>
<li><a href="#kie-server-commands-con_kie-apis">19.10。Drools中的KIE服务器和KIE容器命令</a>
<ul class="sectlevel3">
<li><a href="#kie-server-commands-samples-ref_kie-apis">19.10.1。示例KIE Server和KIE容器命令</a></li>
</ul>
</li>
<li><a href="#runtime-commands-con_kie-apis">19.11。Drools中的运行时命令</a>
<ul class="sectlevel3">
<li><a href="#runtime-commands-samples-ref_kie-apis">19.11.1。Drools中的示例运行时命令</a></li>
</ul>
</li>
<li><a href="#controller-rest-api-con_kie-apis">19.12。适用于KIE Server模板和实例的Drools控制器REST API</a>
<ul class="sectlevel3">
<li><a href="#controller-rest-api-requests-proc_kie-apis">19.12.1。使用REST客户端或curl实用程序使用Drools控制器REST API发送请求</a></li>
<li><a href="#controller-rest-api-requests-swagger-proc_kie-apis">19.12.2。使用Swagger接口通过Drools控制器REST API发送请求</a></li>
<li><a href="#controller-rest-api-endpoints-ref_kie-apis">19.12.3。受支持的Drools控制器REST API端点</a></li>
</ul>
</li>
<li><a href="#controller-java-api-con_kie-apis">19.13。用于KIE Server模板和实例的Drools控制器Java客户端API</a>
<ul class="sectlevel3">
<li><a href="#controller-java-api-requests-proc_kie-apis">19.13.1。使用Drools控制器Java客户端API发送请求</a></li>
<li><a href="#controller-java-clients-ref_kie-apis">19.13.2。受支持的Drools控制器Java客户端</a></li>
<li><a href="#controller-java-api-examples-ref_kie-apis">19.13.3。使用Drools控制器Java客户端API的示例请求</a></li>
</ul>
</li>
<li><a href="#_securing_password_using_key_store">19.14。使用密钥库保护密码</a>
<ul class="sectlevel3">
<li><a href="#_simple_usecase">19.14.1。简单用例</a></li>
<li><a href="#_implementation_and_business_logic">19.14.2。实施和业务逻辑</a></li>
<li><a href="#_system_requirements">19.14.3。系统要求</a></li>
<li><a href="#_initialization_of_a_key_store">19.14.4。密钥库的初始化</a></li>
<li><a href="#_system_parameters_for_loading_key_store">19.14.5。加载密钥库的系统参数</a></li>
<li><a href="#_example_3">19.14.6。例</a></li>
</ul>
</li>
<li><a href="#prometheus-monitoring-con_kie-apis">19.15。Drools中的Prometheus指标监控</a>
<ul class="sectlevel3">
<li><a href="#prometheus-monitoring-proc_kie-apis">19.15.1。为KIE Server配置Prometheus指标监视</a></li>
<li><a href="#prometheus-monitoring-custom-proc_kie-apis">19.15.2。使用自定义指标扩展KIE Server中的Prometheus指标监视</a></li>
</ul>
</li>
<li><a href="#performance-tuning-kie-server-ref_kie-apis">19.16。KIE Server的性能调整注意事项</a></li>
</ul>
</li>
<li><a href="#_examples">20例子</a>
<ul class="sectlevel2">
<li><a href="#decision-examples-IDE-con_drools-examples">20.1。Drools中针对IDE的示例决策</a></li>
<li><a href="#decision-examples-IDE-proc_drools-examples">20.2。在IDE中导入和执行Drools示例决策</a></li>
<li><a href="#decision-examples-helloworld-ref_drools-examples">20.3。Hello World示例决策（基本规则和调试）</a></li>
<li><a href="#decision-examples-state-ref_drools-examples">20.4。说明示例决策（前向链接和冲突解决）</a></li>
<li><a href="#decision-examples-fibonacci-ref_drools-examples">20.5。斐波那契示例决策（递归和冲突解决）</a></li>
<li><a href="#decision-examples-pricing-ref_drools-examples">20.6。定价示例决策（决策表）</a></li>
<li><a href="#decision-examples-petstore-ref_drools-examples">20.7。Pet Store示例决策（议程组，全局变量，回调和GUI集成）</a></li>
<li><a href="#decision-examples-politician-ref_drools-examples">20.8。诚实的政客示例决策（真相维护和显着性）</a></li>
<li><a href="#decision-examples-sudoku-ref_drools-examples">20.9。Sudoku示例决策（复杂模式匹配，回调和GUI集成）</a></li>
<li><a href="#decision-examples-conway-ref_drools-examples">20.10。Conway的“人生游戏”示例决策（规则流组和GUI集成）</a></li>
<li><a href="#decision-examples-doom-ref_drools-examples">20.11。厄运之家示例决策（向后链接和递归）</a></li>
</ul>
</li>
<li><a href="#droolsreleasenoteschapter">21发行说明</a>
<ul class="sectlevel2">
<li><a href="#drools.releasenotesdrools.7.24.0">21.1。Drools 7.24.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#dmn-pmml-support">21.1.1。DMN包含模型中的PMML支持</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesworkbench.7.23.0.final">21.2。Business Central 7.23.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_enhanced_bc_collaboration_features">21.2.1。增强的BC协作功能</a></li>
<li><a href="#_role_based_access_control_for_branches">21.2.2。分支机构基于角色的访问控制</a></li>
<li><a href="#_importing_a_subset_of_branches">21.2.3。导入分支的子集</a></li>
<li><a href="#_dmn_included_models">21.2.4。DMN随附的型号</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesworkbench.7.19.0.final">21.3。Business Central 7.19.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_dmn_automatic_layout">21.3.1。DMN自动版式</a></li>
<li><a href="#_dmn_and_test_scenario_context_menu_keyboard_control">21.3.2。DMN和“测试方案”上下文菜单键盘控件</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.18.0">21.4。Drools 7.18中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_new_builder_options">21.4.1。新的生成器选项</a></li>
<li><a href="#_groupdrlsinkiebasesbyfolderoption">21.4.2。GroupDRLsInKieBasesByFolderOption</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesworkbench.7.18.0.final">21.5。Business Central 7.18.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_guided_rules_designer_filtering">21.5.1。指导规则设计器过滤</a></li>
<li><a href="#_test_scenario_preview_renamed_to_test_scenario_and_listmap_support">21.5.2。测试方案（预览）已重命名为测试方案和列表/地图支持</a></li>
<li><a href="#_development_streamline_lifecycle">21.5.3。开发简化生命周期</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.17.0">21.6。Drools 7.17中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_minor_changes_in_dmn_feel_built_in_functions_parameter_names">21.6.1。DMN FEEL内置函数的参数名称中的较小更改</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesworkbench.7.17.0.final">21.7。Business Central 7.17.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_test_scenario_preview_enabled_by_default">21.7.1。默认情况下启用测试方案（预览）</a></li>
<li><a href="#_test_scenario_dmn_support">21.7.2。测试方案DMN支持</a></li>
<li><a href="#_dmn_decision_service_support">21.7.3。DMN决策服务支持</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesworkbench.7.16.0.final">21.8。Business Central 7.16.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_dmn_and_test_scenario_keyboard_control">21.8.1。DMN和测试方案键盘控制</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.15.0">21.9。Drools 7.15中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_broken_dmn_resources_detected_in_drools_project_builds">21.9.1。在Drools项目构建中检测到损坏的DMN资源</a></li>
<li><a href="#_new_method_for_creating_a_knowledge_run_time">21.9.2。创建知识运行时间的新方法</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.15.0.final">21.10。KIE Workbench 7.15.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_git_hooks_notifications">21.10.1。Git挂钩通知</a></li>
<li><a href="#_kie_workbench_consolidation">21.10.2。KIE Workbench整合</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.14.0">21.11。Drools 7.14中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_file_system_based_kiescanner">21.11.1。基于文件系统的KieScanner</a></li>
<li><a href="#_support_for_executable_models_in_dmn_projects">21.11.2。支持DMN项目中的可执行模型</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.14.0.final">21.12。KIE Workbench 7.14.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_ssh_and_git_daemon_port_assignment_changes">21.12.1。SSH和Git守护程序端口分配更改</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.13.0.final">21.13。KIE Workbench 7.13.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_test_scenarios_preview_editor">21.13.1。测试方案（预览）编辑器</a></li>
<li><a href="#_experimental_features_support">21.13.2。实验功能支持</a></li>
<li><a href="#_ssh_keystore">21.13.3。SSH密钥库</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.13.0">21.14。Drools 7.13中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_allow_to_declare_serialversionuid_on_classes_generated_from_declared_types">21.14.1。允许在从声明的类型生成的类上声明serialVersionUID</a></li>
<li><a href="#_declaratively_set_calendars_on_kiesession_via_kmodule_xml">21.14.2。通过kmodule.xml在KieSession上声明式设置日历</a></li>
<li><a href="#_kiesessions_pool">21.14.3。KieSessions池</a></li>
<li><a href="#_wb.releasenotesworkbench.7.13.0.final">21.14.4。KIE Workbench 7.13.0中的新功能和值得注意的功能</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.12.0">21.15。Drools 7.12中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_end_of_support_for_drools_rhq_plugin_component">21.15.1。终止支持<code>drools-rhq-plugin</code>零件</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.11.0">21.16。Drools 7.11中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_minor_api_changes_of_kie_dmn_open_source_engine">21.16.1。Kie DMN开源引擎的微小API更改</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.11.0.final">21.17。KIE Workbench 7.11.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_multiple_git_branches_support">21.17.1。多个Git分支支持</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.9.0">21.18。Drools 7.9的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_moved_executablecommand_to_kie_public_api">21.18.1。将ExecutableCommand移至KIE公共API</a></li>
<li><a href="#_alpha_network_compiler">21.18.2。Alpha网络编译器</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.8.0.final">21.19。KIE Workbench 7.8.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_new_system_property_for_setting_the_default_maven_repository_in_project_pom_xml_files">21.19.1。用于在项目pom.xml文件中设置默认Maven存储库的新系统属性</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.7.0">21.20。Drools 7.7中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#executable-model-con_N&N-7.7">21.20.1。可执行规则模型</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.7.0.final">21.21。KIE Workbench 7.7.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_project_oriented_workbench">21.21.1。面向项目的工作台</a></li>
<li><a href="#_connecting_to_a_headless_drools_controller">21.21.2。连接到无头Drools控制器</a></li>
<li><a href="#_content_management_enhancements">21.21.3。内容管理增强</a></li>
<li><a href="#_new_migration_tool">21.21.4。新的迁移工具</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.6.0.final">21.22。KIE Workbench 7.6.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_content_management_enhancements_2">21.22.1。内容管理增强</a></li>
</ul>
</li>
<li><a href="#_kieserver.releasenoteskie.7.5.1">21.23。新的Drools控制器客户端API</a></li>
<li><a href="#_breaking_changes_in_kie_server_7_5_1_from_7_0">21.24。从7.0更改Kie Server 7.5.1中的重大更改</a>
<ul class="sectlevel3">
<li><a href="#_drools_controller_api_changes">21.24.1。Drools控制器API更改</a></li>
<li><a href="#_kie_server_api_changes">21.24.2。Kie Server API更改</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.5.0.final">21.25。KIE Workbench 7.5.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_content_management_enhancements_3">21.25.1。内容管理增强</a></li>
<li><a href="#_extra_navigation_components">21.25.2。额外的导航组件</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.4.0.final">21.26。KIE Workbench 7.4.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_guided_decision_table_improvements">21.26.1。指导决策表改进</a></li>
<li><a href="#_disable_experimental_editors">21.26.2。停用实验性编辑器</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.3.0.final">21.27。KIE Workbench 7.3.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_new_home_and_menu_bar">21.27.1。新家和菜单栏</a></li>
<li><a href="#_admin_page_changes">21.27.2。管理员页面更改</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.1.0">21.28。Drools 7.1中的新功能和值得注意的功能</a></li>
<li><a href="#_wb.releasenotesworkbench.7.1.0.final">21.29。KIE Workbench 7.1.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_project_metrics_dashboard">21.29.1。项目指标仪表板</a></li>
<li><a href="#_teams_metrics_dashboard">21.29.2。团队指标仪表板</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.0.0">21.30。Drools 7.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_core_engine">21.30.1。核心引擎</a></li>
<li><a href="#_business_central_2">21.30.2。商业中心</a></li>
</ul>
</li>
<li><a href="#_breaking_changes_in_drools_7_0_from_6_x">21.31。从6.x到Drools 7.0的重大更改</a>
<ul class="sectlevel3">
<li><a href="#_property_reactivity_enabled_by_default">21.31.1。默认情况下启用属性反应</a></li>
<li><a href="#_type_preserving_accumulate_functions">21.31.2。类型保留累加函数</a></li>
<li><a href="#_renaming_timedruleexecutionoption">21.31.3。重命名TimedRuleExecutionOption</a></li>
<li><a href="#_renaming_and_unification_of_configuration_files">21.31.4。重命名和统一配置文件</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.0.0.final">21.32。KIE Workbench 7.0.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_new_authoring_library">21.32.1。新创作（图书馆）</a></li>
<li><a href="#_authoring_imports_of_examples">21.32.2。创作-实例导入</a></li>
<li><a href="#_authoring_pop_ups_improvements">21.32.3。创作-弹出窗口改进</a></li>
<li><a href="#_authoring_project_editor_reimport_button">21.32.4。创作-项目编辑器-重新导入按钮</a></li>
<li><a href="#_security_management">21.32.5。安全管理</a></li>
<li><a href="#_kie_config_cli_has_been_removed">21.32.6。 kie-config-cli已被删除</a></li>
<li><a href="#_user_and_project_admin_pages_and_preferences">21.32.7。用户和项目管理页面和首选项</a></li>
<li><a href="#_gav_conflict_check_and_child_gav_edition">21.32.8。GAV冲突检查和儿童GAV版本</a></li>
<li><a href="#_data_source_management">21.32.9。资料来源管理</a></li>
</ul>
</li>
<li><a href="#_kieserver.releasenoteskie.7.0.0">21.33。从6.x重大更改Kie Server 7.0</a>
<ul class="sectlevel3">
<li><a href="#_serviceresponse_xstream_marshalling_changes">21.33.1。ServiceResponse XStream封送更改</a></li>
<li><a href="#_simplified_planner_rest_api">21.33.2。简化的Planner REST API</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.6.5.0">21.34。Drools 6.5.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_configurable_threadfactory">21.34.1。可配置的ThreadFactory</a></li>
<li><a href="#_use_of_any_expressions_as_input_for_a_query">21.34.2。使用任何表达式作为查询的输入</a></li>
<li><a href="#_update_with_modified_properties">21.34.3。使用修改后的属性更新</a></li>
<li><a href="#_monitoring_framework_improvements">21.34.4。监控框架改进</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.6.4.0">21.35。Drools 6.4.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_better_java_8_compatibility">21.35.1。更好的Java 8兼容性</a></li>
<li><a href="#_more_robust_incremental_compilation">21.35.2。更强大的增量编译</a></li>
<li><a href="#_improved_multi_threading_behaviour">21.35.3。改进的多线程行为</a></li>
<li><a href="#_oopath_improvements_2">21.35.4。OOPath改进</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.6.4.0.final">21.36。KIE Workbench 6.4.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_new_look_and_feel">21.36.1。新外观</a></li>
<li><a href="#_various_ui_improvements">21.36.2。各种UI改进</a></li>
<li><a href="#_new_locales">21.36.3。新地区</a></li>
<li><a href="#_authoring_imports_consistent_terminology">21.36.4。创作-导入-一致的术语</a></li>
<li><a href="#_disable_automatic_build">21.36.5。禁用自动构建</a></li>
<li><a href="#_support_for_scp_style_git_repository_urls">21.36.6。支持<code>SCP</code>样式<code>git</code>储存库网址</a></li>
<li><a href="#_authoring_duplicate_gav_detection">21.36.7。创作-重复的GAV检测</a></li>
<li><a href="#_new_execution_server_management_user_interface">21.36.8。新的执行服务器管理用户界面</a></li>
<li><a href="#_user_and_group_management">21.36.9。用户和组管理</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.6.3.0">21.37。Drools 6.3.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_browsing_graphs_of_objects_with_oopath">21.37.1。使用OOPath浏览对象图</a></li>
<li><a href="#_shared.releasenotes.kienavigator">21.37.2。Eclipse的Kie Navigator View</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.6.3.0.final">21.38。KIE Workbench 6.3.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_real_time_validation_and_verification_for_the_decision_tables">21.38.1。决策表的实时验证和验证</a></li>
<li><a href="#_improved_drl_editor">21.38.2。改进的DRL编辑器</a></li>
<li><a href="#_asset_locking">21.38.3。资产锁定</a></li>
<li><a href="#_data_modeller_tool_windows">21.38.4。数据建模工具Windows</a></li>
<li><a href="#_generation_of_jpa_enabled_data_models">21.38.5。启用JPA的数据模型的生成</a></li>
<li><a href="#_data_set_authoring">21.38.6。数据集创作</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.6.2.0">21.39。Drools 6.2.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_propagation_modes">21.39.1。传播方式</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.6.2.0.final">21.40。KIE Workbench 6.2.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_download_repository_or_part_of_the_repository_as_a_zip">21.40.1。以ZIP格式下载存储库或部分存储库</a></li>
<li><a href="#_project_editor_permissions">21.40.2。项目编辑者权限</a></li>
<li><a href="#_unify_validation_style_in_guided_decision_table_wizard">21.40.3。在“指导决策表向导”中统一验证样式。</a></li>
<li><a href="#_improved_wizards">21.40.4。改进的巫师</a></li>
<li><a href="#_consistent_behaviour_of_xls_guided_decision_tables_and_guided_templates">21.40.5。XLS，指导决策表和指导模板的一致行为</a></li>
<li><a href="#_improved_metadata_tab">21.40.6。改进的元数据选项卡</a></li>
<li><a href="#_improved_data_objects_editor">21.40.7。改进的数据对象编辑器</a></li>
<li><a href="#_execution_server_management_ui">21.40.8。执行服务器管理UI</a></li>
<li><a href="#_social_activities">21.40.9。社交活动</a></li>
<li><a href="#_contributors_dashboard">10.40.10。贡献者仪表板</a></li>
<li><a href="#_package_selector">11.40.11。包选择器</a></li>
<li><a href="#_improved_visual_consistency">12.40.12。改善视觉一致性</a></li>
<li><a href="#_guided_decision_tree_editor">13.40.13。指导决策树编辑器</a></li>
<li><a href="#_create_repository_wizard">14.40.14。创建存储库向导</a></li>
<li><a href="#_repository_structure_screen">21.40.15。仓库结构屏幕</a></li>
</ul>
</li>
<li><a href="#_kie.releasenotesintegration.6.2.0">21.41。集成6.2.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_kie_execution_server">21.41.1。KIE执行服务器</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.6.1.0">21.42。Drools 6.1.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_jmx_support_for_kiescanner">21.42.1。JMX对KieScanner的支持</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.6.1.0">21.43。KIE Workbench 6.1.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_data_modeler_round_trip_and_source_code_preservation">21.43.1。Data Modeler-往返和源代码保存</a></li>
<li><a href="#_data_modeler_improved_annotations">21.43.2。Data Modeler-改进的注释</a></li>
<li><a href="#_standardization_of_the_display_of_tabular_data">21.43.3。表格数据显示的标准化</a></li>
<li><a href="#_generation_of_modifyx_blocks">21.43.4。的产生<code>modify(x) {…​}</code>块</a></li>
</ul>
</li>
<li><a href="#_kie.releasenoteskie.6.0.0">21.44。KIE API 6.0.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_new_kie_name">21.44.1。新的KIE名称</a></li>
<li><a href="#_maven_aligned_projects_and_modules_and_maven_deployment">2144.2。Maven对齐项目和模块以及Maven部署</a></li>
<li><a href="#_configuration_and_convention_based_projects">2144.3。基于配置和约定的项目</a></li>
<li><a href="#_kiebase_inclusion">21.44.4。KieBase包含</a></li>
<li><a href="#_kiemodules_kiecontainer_and_kie_ci">21.44.5。KieModules，KieContainer和KIE-CI</a></li>
<li><a href="#_kiescanner_2">21.44.6。KieScanner</a></li>
<li><a href="#_hierarchical_classloader">21.44.7。分层ClassLoader</a></li>
<li><a href="#_legacy_api_adapter">21.44.8。旧版API适配器</a></li>
<li><a href="#_kie_documentation">21.44.9。KIE文档</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.6.0.0">21.45。Drools 6.0.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_phreak_lazy_rule_matching_algorithm">2145.1。PHREAK-惰性规则匹配算法</a></li>
<li><a href="#_automatically_firing_timed_rule_in_passive_mode">21.45.2。在被动模式下自动触发定时规则</a></li>
<li><a href="#_expression_timers">2145.3。表达计时器</a></li>
<li><a href="#_ruleflowgroups_and_agendagroups_are_merged">21.45.4。RuleFlowGroups和AgendaGroups合并</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.6.0.0">21.46。KIE Workbench 6.0.0中的新功能和值得注意的功能</a></li>
<li><a href="#_kie.releasenotesintegration.6.0.0">21.47。集成6.0.0中的新功能和值得注意的功能</a>
<ul class="sectlevel3">
<li><a href="#_cdi">21.47.1。CDI</a></li>
<li><a href="#_spring">21.47.2。弹簧</a></li>
<li><a href="#_aries_blueprints">21.47.3。白羊座的蓝图</a></li>
<li><a href="#_osgi_ready">21.47.4。准备好OSGi</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./logos/droolsExpertLogo.png" alt="droolsExpertLogo">
</div>
</div>
<h1 id="_welcome" class="discrete">欢迎</h1>
</div>
</div>
<div class="sect1">
<h2 id="_welcome"><a class="anchor" href="#_welcome"></a> <a class="link" href="#_welcome">1。介绍</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction"><a class="anchor" href="#_introduction"></a> <a class="link" href="#_introduction">1.1。介绍</a></h3>
<div class="paragraph">
<p>KIE（知识就是一切）是一个总体项目，旨在将我们的相关技术整合在一起。它也是我们项目之间共享的核心。</p>
</div>
<div class="paragraph">
<p>KIE包含以下不同但相关的项目，为业务自动化和管理提供了完整的解决方案组合：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Drools</strong>是一个业务规则管理系统，具有基于前向链接和后向链接的推理规则引擎，可对业务规则和复杂的事件处理进行快速可靠的评估。规则引擎还是创建专家系统的基本构建块，在人工智能中，该专家系统是模拟人类专家的决策能力的计算机系统。</p>
</li>
<li>
<p><strong>jBPM</strong>是一种灵活的业务流程管理套件，允许您通过描述实现这些目标所需执行的步骤来对业务目标进行建模。</p>
</li>
<li>
<p><strong>OptaPlanner</strong>是一个约束解决器，可以优化用例，例如员工排班，车辆路线，任务分配和云优化。</p>
</li>
<li>
<p><strong>Business Central</strong>是功能齐全的Web应用程序，用于可视化组成自定义业务规则和流程。</p>
</li>
<li>
<p><strong>UberFire</strong>是一个基于Web的工作台框架，其灵感来自Eclipse Rich Client Platform。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>7.x系列将采用更敏捷的方法，并提供更多的常规和迭代版本。对于一系列次要版本，我们计划进行一些比正常情况更大的更改，并且用户需要在采用这些版本之前意识到这些更改。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>UI节和链接将变为面向对象的，而不是面向任务的。 <a href="https://en.wikipedia.org/wiki/Object-oriented_user_interface" class="bare">https://zh.wikipedia.org/wiki/面向对象的用户界面</a></p>
</li>
<li>
<p>作者/库将变为面向项目的，而不是面向存储库的。您将创建，浏览和打开项目而不是存储库。存储库的概念将被推低，例如，在创建项目时将自动创建它。</p>
</li>
<li>
<p>旧的表格建模器将被删除，只有新的表格建模器可用。尽管旧的表格将继续呈现。</p>
</li>
<li>
<p>新设计者将通过更多节点和改进的UXD继续成熟。最终它将成为默认的编辑器，但是直到BPMN2支持中存在功能奇偶校验，我们才会删除旧的编辑器。</p>
</li>
<li>
<p>UXD在许多地方都得到了持续改进。</p>
</li>
<li>
<p>我们将介绍AppFormer项目，这将是对现有项目的重新组织和合并，并导致一些工件重命名。UberFire将成为AppFormer-Core，表单，数据建模器和dashbuilder将归AppFormer管辖。Dashbuilder最有可能被称为Appformer-Insight。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>8.x系列将在今年年底推出。我们正在进行并行的工作，以引入具有改进的git支持的工作区概念，该工作区将具有用于派生和请求请求的内置工作流。这将与水平扩展和提高的高可用性结合在一起。这些更改对于可用性和云可伸缩性很重要，但对于次要版本而言，更改太多，因此升至8.x。</p>
</div>
</div>
<div class="sect2">
<h3 id="_gettingstarted"><a class="anchor" href="#_gettingstarted"></a> <a class="link" href="#_gettingstarted">1.2。卷入</a></h3>
<div class="paragraph">
<p>我们经常被问到“我如何参与”。幸运的是，答案很简单，只需编写一些代码并提交即可：)您不必烦恼，也不必进行秘密握手。我们确实要求最小的“开销”以允许可伸缩的项目开发。下面，我们提供了所需工具和“工作流程”的概述，以及一些常规建议。</p>
</div>
<div class="paragraph">
<p>如果您贡献了一些出色的作品，请不要忘了写博客:)</p>
</div>
<div class="sect3">
<h4 id="_sign_up_to_jboss_org"><a class="anchor" href="#_sign_up_to_jboss_org"></a> <a class="link" href="#_sign_up_to_jboss_org">1.2.1。注册jboss.org</a></h4>
<div class="paragraph">
<p>登录jboss.org将使您可以访问JBoss Wiki，论坛和JIRA。转到<a href="https://www.jboss.org/" class="bare">https://www.jboss.org/</a> ，然后单击“注册”。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./GettingInvolved/sign_jbossorg.png" alt="登录jbossorg">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sign_the_contributor_agreement"><a class="anchor" href="#_sign_the_contributor_agreement"></a> <a class="link" href="#_sign_the_contributor_agreement">1.2.2。签署贡献者协议</a></h4>
<div class="paragraph">
<p>您需要签署的唯一表格是贡献者协议，该协议可以通过网络完全自动化。如下图所示：“这将确定您的贡献的条款和条件，并确保可以适当地许可源代码”</p>
</div>
<div class="paragraph">
<p><a href="https://cla.jboss.org/" class="bare">https://cla.jboss.org/</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./GettingInvolved/sign_contributor.png" alt="标志贡献者">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_submitting_issues_via_jira"><a class="anchor" href="#_submitting_issues_via_jira"></a> <a class="link" href="#_submitting_issues_via_jira">1.2.3。通过JIRA提交问题</a></h4>
<div class="paragraph">
<p>为了能够与核心开发团队进行互动，您将需要使用问题跟踪器JIRA。这样可确保记录所有请求并将其分配给发布计划，并将所有讨论都集中在一个地方。错误报告，错误修复，功能请求和功能提交都应在此处。一般问题应在邮件列表中进行。</p>
</div>
<div class="paragraph">
<p>次要代码提交（例如格式或文档修复）不需要创建关联的JIRA问题。</p>
</div>
<div class="paragraph">
<p><a href="https://issues.jboss.org/browse/DROOLS" class="bare">https://issues.jboss.org/browse/DROOLS</a></p>
</div>
<div class="paragraph">
<p><a href="https://issues.jboss.org/browse/JBPM" class="bare">https://issues.jboss.org/browse/JBPM</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./GettingInvolved/submit_jira.png" alt="提交吉拉">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fork_github"><a class="anchor" href="#_fork_github"></a> <a class="link" href="#_fork_github">1.2.4。叉GitHub</a></h4>
<div class="paragraph">
<p>签署了贡献者协议并将您的请求提交给JIRA之后，您现在就可以开始编写代码了：）创建一个GitHub帐户并派生任何Drools，jBPM或Guvnor存储库。该分支将在您自己的GitHub空间中创建一个副本，您可以按照自己的进度进行操作。如果您输入有误，请放心将其吹走再叉。请注意，每个GitHub存储库都为您提供了克隆（签出）URL，GitHub将为您提供特定于您的fork的URL。</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/kiegroup" class="bare">https://github.com/kiegroup</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./GettingInvolved/fork_github.png" alt="叉子github">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_writing_tests"><a class="anchor" href="#_writing_tests"></a> <a class="link" href="#_writing_tests">1.2.5。写作测试</a></h4>
<div class="paragraph">
<p>编写测试时，请尝试使它们保持在最低限度且自成体系。我们倾向于将DRL片段保留在测试中，因为这样可以更快地进行检查。如果存在大量规则，则使用字符串不切实际，因此一定要将它们放在单独的DRL文件中，而不是从类路径中加载。如果您的测试需要使用模型，请尝试使用其他单元测试已经存在的模型；例如“人”，“奶酪”或“订单”。如果不存在具有所需字段的类，请在添加新类之前尝试更新现有类的字段。</p>
</div>
<div class="paragraph">
<p>有大量的测试可用来了解您的想法，MiscTest是一个不错的起点。</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/kiegroup">https://github.com/kiegroup/drools/blob/master/drools-compiler/src/test/java/org/drools/integrationtests/MiscTest.java</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./GettingInvolved/unit_test.png" alt="单元测试">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_commit_with_correct_conventions"><a class="anchor" href="#_commit_with_correct_conventions"></a> <a class="link" href="#_commit_with_correct_conventions">1.2.6。遵守正确的约定</a></h4>
<div class="paragraph">
<p>提交时，请确保使用正确的约定。提交必须以JIRA问题ID（例如DROOLS-1946）开头。这样可以确保通过JIRA对提交进行交叉引用，因此我们可以在同一位置查看给定问题的所有提交。在ID之后，应该紧接着是问题的标题。然后使用带有短划线的换行符来提供与此提交有关的其他信息。对于要创建的每个单独的点，请使用额外的新行和破折号。您可以在适当的情况下向同一提交添加其他JIRA交叉引用。通常，尝试避免在同一提交中合并无关的问题。</p>
</div>
<div class="paragraph">
<p>别忘了从原始主服务器上重新构建本地分叉，然后将提交推回分叉。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./GettingInvolved/jira_crossreferenced.png" alt="吉拉交叉引用">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_submit_pull_requests"><a class="anchor" href="#_submit_pull_requests"></a> <a class="link" href="#_submit_pull_requests">1.2.7。提交拉取请求</a></h4>
<div class="paragraph">
<p>现在，您的代码已从原始主文件中重新定位并推送到您的个人GitHub区域，现在您可以将您的工作作为请求请求提交。如果您在工作区的GitHub页面顶部查看，将有一个“ Pull Request”按钮。然后选择此项将提供一个gui，以自动执行您的请求请求的提交。</p>
</div>
<div class="paragraph">
<p>然后，pull请求进入队列，以供所有人查看和评论。在下面，您可以看到典型的请求请求。拉取请求允许进行讨论，并且显示所有关联的提交以及每个提交的差异。讨论通常涉及代码审查，这些审查为改进提供了有用的建议，并允许我们在代码的特定部分留下内联注释。如果我们不立即合并，请不要灰心，在接受拉取请求之前，通常可能需要进行多次修订。幸运的是，GitHub非常简单，它可以返回您的代码，再进行一些提交，然后将您的拉取请求更新为最新的最大的请求。</p>
</div>
<div class="paragraph">
<p>我们可能需要一些时间来响应请求请求，因此请耐心等待。提交的带有修复程序的测试通常会很快应用，就像测试通常会这样，直到我们有时间也提交带有修复程序的测试。不要忘了重新设置基础并不时重新提交您的请求，否则随着时间的流逝将出现合并冲突，核心开发人员通常会忽略这些冲突。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./GettingInvolved/submit_pull_request.png" alt="提交拉取请求">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installationandsetup"><a class="anchor" href="#_installationandsetup"></a> <a class="link" href="#_installationandsetup">1.3。安装和设置（Core和IDE）</a></h3>
<div class="sect3">
<h4 id="_installing_and_using"><a class="anchor" href="#_installing_and_using"></a> <a class="link" href="#_installing_and_using">1.3.1。安装和使用</a></h4>
<div class="paragraph">
<p>Drools提供了一个基于Eclipse的IDE（可选），但其核心仅需要Java 1.5（Java SE）。</p>
</div>
<div class="paragraph">
<p>一种简单的入门方法是下载并安装Eclipse插件-这也将需要安装Eclipse GEF框架（如果尚未安装，请参见下文）。这将为您提供开始所需的所有依赖项：您只需创建一个新的规则项目，一切都将为您完成。有关此内容的详细说明，请参阅Business Central和IDE上的章节。安装Eclipse插件通常很简单，只需将文件解压缩到Eclipse插件目录中即可。</p>
</div>
<div class="paragraph">
<p>不需要使用Eclipse插件。规则文件只是文本输入（或视情况而定的电子表格），而IDE（也称为Business Central）只是一种便利。人们以多种方式集成了Drools引擎，没有“一刀切”的功能。</p>
</div>
<div class="paragraph">
<p>或者，您可以下载二进制发行版，并将相关的JAR包含在项目的类路径中。</p>
</div>
<div class="sect4">
<h5 id="_dependencies_and_jars"><a class="anchor" href="#_dependencies_and_jars"></a> <a class="link" href="#_dependencies_and_jars">1.3.1.1。依赖关系和JAR</a></h5>
<div class="paragraph">
<p>Drools分为几个模块，在规则开发/编译过程中需要一些模块，在运行时需要一些模块。在许多情况下，人们只是想在运行时包括所有依赖项，这很好。它使您拥有最大的灵活性。但是，有些人可能希望将其“运行时”精简到最低限度，因为他们将以二进制形式部署规则-这也是可能的。核心的Drools引擎可以非常紧凑，在3个JAR文件中仅需要几百个KB。</p>
</div>
<div class="paragraph">
<p>以下是构成JBoss Drools的重要库的描述</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Knowledge-api.jar-提供接口和工厂。它还有助于清楚地表明什么是用户API，什么仅仅是引擎API。</p>
</li>
<li>
<p>Knowledge-internal-api.jar-提供内部接口和工厂。</p>
</li>
<li>
<p>drools-core.jar-这是Drools核心引擎，运行时组件。同时包含RETE引擎和LEAPS引擎。如果要预编译规则（并通过Package或RuleBase对象进行部署），则这是唯一的运行时依赖项。</p>
</li>
<li>
<p>drools-compiler.jar-它包含编译器/构建器组件，以获取规则源并构建可执行规则库。这通常是应用程序的运行时依赖项，但是如果您正在预编译规则，则不必如此。这取决于流口水的核心。</p>
</li>
<li>
<p>drools-jsr94.jar-这是JSR-94兼容的实现，它实质上是drools-compiler组件上的一层。请注意，由于JSR-94规范的性质，并非所有功能都可以通过此接口轻松公开。在某些情况下，直接进入Drools API会更容易，但是在某些环境中，必须使用JSR-94。</p>
</li>
<li>
<p>drools-decisiontables.jar-这是决策表的“编译器”组件，它使用drools-compiler组件。这支持excel和CSV输入格式。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>上述组件还需要其他一些依赖项，其中大多数依赖于drools-compiler，drools-jsr94或drools-decisiontables模块。需要注意的一些关键是提供电子表格分析功能的“ POI”和提供规则语言本身的分析的“ antlr”。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">如果您在J2EE或servlet容器中使用Drools，并且遇到“ JDT”的类路径问题，则可以切换到janino编译器。设置系统属性“ drools.compiler”：例如：-Ddrools.compiler = JANINO。</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>有关发行版中依赖项的最新信息，请查阅发行的POM，可以在Maven存储库中找到。</p>
</div>
</div>
<div class="sect4">
<h5 id="_use_with_maven_gradle_ivy_buildr_or_ant"><a class="anchor" href="#_use_with_maven_gradle_ivy_buildr_or_ant"></a> <a class="link" href="#_use_with_maven_gradle_ivy_buildr_or_ant">1.3.1.2。与Maven，Gradle，Ivy，Buildr或Ant一起使用</a></h5>
<div class="paragraph">
<p>的罐子也可在<a href="http://search.maven.org/#search|ga|1|org.drools">中央Maven仓库</a> （也在<a href="https://repository.jboss.org/nexus/index.html#nexus-search;gav" class="bare">https://repository.jboss.org/nexus/index.html#nexus-search;gav</a> <sub><sub>org.drools〜[JBoss</sub></sub>的Maven仓库]）。</p>
</div>
<div class="paragraph">
<p>如果使用Maven，则在项目的<em class="path">pom.xml中</em>添加KIE和Drools依赖项，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">  &lt;dependencyManagement&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;org.drools&lt;/groupId&gt;
        &lt;artifactId&gt;drools-bom&lt;/artifactId&gt;
        &lt;type&gt;pom&lt;/type&gt;
        &lt;version&gt;...&lt;/version&gt;
        &lt;scope&gt;import&lt;/scope&gt;
      &lt;/dependency&gt;
      ...
    &lt;/dependencies&gt;
  &lt;/dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.kie&lt;/groupId&gt;
      &lt;artifactId&gt;kie-api&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.drools&lt;/groupId&gt;
      &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
      &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;/dependency&gt;
    ...
  &lt;dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这与Gradle，Ivy和Buildr类似。要确定最新版本，请检查Maven存储库。</p>
</div>
<div class="paragraph">
<p>如果您仍在使用Ant（没有Ivy），请从下载zip的<em class="path">binaries</em>目录中复制所有JAR，然后手动验证您的类路径中是否包含重复的JAR。</p>
</div>
</div>
<div class="sect4">
<h5 id="_runtime"><a class="anchor" href="#_runtime"></a> <a class="link" href="#_runtime">1.3.1.3。运行</a></h5>
<div class="paragraph">
<p>这里提到的“运行时”要求是如果您以规则的二进制形式（以KnowledgePackage对象或KnowledgeBase对象等）的形式部署规则。这是一项可选功能，可以使您的运行时保持良好状态。您可以使用drools-compiler生成“进程外”规则包，然后将其部署到运行时系统。该运行时系统仅需要drools-core.jar和Knowledge-api即可执行。这是一种可选的部署模式，许多人不需要过多地“修剪”他们的应用程序，但是对于某些环境来说，它是理想的选择。</p>
</div>
</div>
<div class="sect4">
<h5 id="_installing_ide_rule_workbench"><a class="anchor" href="#_installing_ide_rule_workbench"></a> <a class="link" href="#_installing_ide_rule_workbench">1.3.1.4。安装IDE（Rule Workbench）</a></h5>
<div class="paragraph">
<p>规则工作台（对于Eclipse）要求您具有Eclipse 3.4或更高版本，以及Eclipse GEF 3.4或更高版本。您可以通过下载插件或使用更新站点来安装它。</p>
</div>
<div class="paragraph">
<p>另一个选择是使用JBoss IDE，它预先包装了所有插件要求，并提供了一些独立于规则的其他工具。您可以选择仅从JBoss IDE附带的“捆绑包”中安装规则。</p>
</div>
<div class="sect5">
<h6 id="_installing_gef_a_required_dependency"><a class="anchor" href="#_installing_gef_a_required_dependency"></a> <a class="link" href="#_installing_gef_a_required_dependency">安装GEF（必需的依赖项）</a></h6>
<div class="paragraph">
<p>GEF是Eclipse图形编辑框架，用于查看插件中的图形。</p>
</div>
<div class="paragraph">
<p>如果未安装GEF，则可以使用内置的更新机制进行安装（或不建议从Eclipse.org网站下载GEF）。JBoss IDE和Eclipse的许多其他“发行版”一样，已经具有GEF，因此对于某些人来说，此步骤可能是多余的。</p>
</div>
<div class="paragraph">
<p>从帮助菜单中打开帮助→软件更新...→可用软件→添加站点....位置是：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>http://download.eclipse.org/tools/gef/updates/releases/</code></pre>
</div>
</div>
<div class="paragraph">
<p>接下来，选择GEF插件：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Install/install_gef.png" alt="安装GEF">
</div>
</div>
<div class="paragraph">
<p>按下一步，并同意安装插件（可能需要重新启动Eclipse）。完成此操作后，即可继续安装规则插件。</p>
</div>
</div>
<div class="sect5">
<h6 id="_installing_gef_from_zip_file"><a class="anchor" href="#_installing_gef_from_zip_file"></a> <a class="link" href="#_installing_gef_from_zip_file">从zip文件安装GEF</a></h6>
<div class="paragraph">
<p>要从zip文件安装，请下载并解压缩该文件。在zip内，您将看到一个插件目录以及插件JAR本身。您将插件JAR放入Eclipse应用程序插件目录，然后重新启动Eclipse。</p>
</div>
</div>
<div class="sect5">
<h6 id="_installing_drools_plug_in_from_zip_file"><a class="anchor" href="#_installing_drools_plug_in_from_zip_file"></a> <a class="link" href="#_installing_drools_plug_in_from_zip_file">从zip文件安装Drools插件</a></h6>
<div class="paragraph">
<p>从下面的链接下载Drools Eclipse IDE插件。将下载的文件解压缩到您的主eclipse文件夹中（不要只是将文件复制到那里，解压缩以便功能部件和插件JAR最终位于eclipse的功能部件和插件目录中），然后（重新）启动Eclipse。</p>
</div>
<div class="paragraph">
<p><a href="https://www.drools.org/download/download.html" class="bare">https://www.drools.org/download/download.html</a></p>
</div>
<div class="paragraph">
<p>要检查安装是否成功，请尝试打开Drools透视图：单击Eclipse窗口右上角的``打开透视图''按钮，选择``其他...''并选择Drools透视图。如果您找不到Drools透视图作为可能的透视图之一，则说明安装可能不成功。检查是否正确执行了每个必需的步骤：您是否具有正确版本的Eclipse（3.4.x）？是否已安装Eclipse GEF（请检查<strong>eclipse根文件夹中的plugins目录中是否<strong>存在 org.eclipse.gef_3.4。.jar <strong>）？您是否正确提取了Drools Eclipse插件（检查Eclipse</strong>根文件夹中的plugins目录中是否</strong>存在org.drools.eclipse_</strong> .jar）？如果您找不到问题，请尝试与我们联系（例如，在irc或用户邮件列表中），可以在这里找到我们主页上没有的更多信息：</p>
</div>
<div class="paragraph">
<p><a href="https://www.drools.org/" class="bare">https://www.drools.org/</a></p>
</div>
</div>
<div class="sect5">
<h6 id="_drools_runtimes"><a class="anchor" href="#_drools_runtimes"></a> <a class="link" href="#_drools_runtimes">流口水运行时</a></h6>
<div class="paragraph">
<p>Drools运行时是文件系统上JAR的集合，代表了Drools项目JAR的一个特定版本。要创建运行时，您必须将IDE指向您选择的版本。如果要基于插件本身中包含的最新Drools项目JAR创建新的运行时，则也可以轻松地做到这一点。您需要为Eclipse工作区指定默认的Drools运行时，但是每个单独的项目都可以覆盖默认值，并为该项目选择适当的运行时。</p>
</div>
<div class="sect6">
<h7 id="_defining_a_drools_runtime"><a class="anchor" href="#_defining_a_drools_runtime"></a> <a class="link" href="#_defining_a_drools_runtime">定义Drools运行时</a></h7>
<div class="paragraph">
<p>您需要使用Eclipse首选项视图定义一个或多个Drools运行时。要打开您的首选项，请在菜单窗口中选择首选项菜单项。新的首选项对话框应显示您的所有首选项。在此对话框的左侧，在Drools类别下，选择“ Installed Drools runtimes”。然后，右侧面板应显示当前定义的Drools运行时。如果尚未定义任何运行时，则应类似于下图所示。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Install/drools-runtimes.png" alt="流口水运行时">
</div>
</div>
<div class="paragraph">
<p>要定义新的Drools运行时，请单击添加按钮。将会弹出一个如下所示的对话框，要求您提供运行时的名称以及在文件系统上可以找到它的位置。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Install/drools-runtimes-add.png" alt="流口水运行时添加">
</div>
</div>
<div class="paragraph">
<p>通常，您有两种选择：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>如果您只想使用Drools Eclipse插件中包含的默认JAR，则可以通过单击``创建新的Drools 5运行时...''按钮来自动创建新的Drools运行时。将显示一个文件浏览器，要求您在文件系统上选择要在其中创建运行时的文件夹。然后，插件将自动将所有必需的依赖项复制到指定的文件夹。选择此文件夹后，对话框应如下图所示。</p>
</li>
<li>
<p>如果要使用Drools项目的一个特定版本，则应在文件系统上创建一个文件夹，其中包含所有必需的Drools库和依赖项。不要像上面解释的那样创建新的Drools运行时，而是给运行时命名并选择包含所有必需JAR的文件夹的位置。</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Install/drools-runtimes-add2.png" alt="流口水运行时add2">
</div>
</div>
<div class="paragraph">
<p>单击确定按钮后，运行时将显示在已安装的Drools运行时表中，如下所示。单击新创建的运行时前面的复选框，将其设置为默认的Drools运行时。默认的Drools运行时将用作所有尚未选择项目特定运行时的Drools项目的运行时。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Install/drools-runtimes2.png" alt="流口水运行时2">
</div>
</div>
<div class="paragraph">
<p>您可以根据需要添加任意数量的Drools运行时。例如，以下屏幕截图显示了已定义三个运行时的配置：Drools 4.0.7运行时，Drools 5.0.0运行时和Drools 5.0.0。SNAPSHOT运行时。Drools 5.0.0运行时被选择为默认运行时。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Install/drools-runtimes3.png" alt="流口水运行时3">
</div>
</div>
<div class="paragraph">
<p>请注意，如果您更改了默认运行时，则需要重新启动Eclipse，并且要确保所有使用默认运行时的项目都相应地更新其类路径。</p>
</div>
</div>
<div class="sect6">
<h7 id="_selecting_a_runtime_for_your_drools_project"><a class="anchor" href="#_selecting_a_runtime_for_your_drools_project"></a> <a class="link" href="#_selecting_a_runtime_for_your_drools_project">为您的Drools项目选择运行时</a></h7>
<div class="paragraph">
<p>每当您创建Drools项目时（使用“ New Drools项目”向导，或者使用在Drools透视图中显示的“转换为Drools项目”操作将现有的Java项目转换为Drools项目，然后右键单击现有项目） Java项目），该插件会自动将所有必需的JAR添加到您项目的类路径中。</p>
</div>
<div class="paragraph">
<p>当创建一个新的Drools项目时，除非您指定一个特定于项目的插件，否则插件将自动使用该项目的默认Drools运行时。您可以在“新建Drools项目”向导的最后一步中执行此操作，如下所示，方法是取消选中“使用默认Drools运行时”复选框，然后在下拉框中选择适当的运行时。如果单击``配置工作空间设置...''链接，将打开显示当前安装的Drools运行时的工作空间首选项，因此您可以在此处添加新的运行时。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Install/drools-runtimes-newproject.png" alt="流口水运行时newproject">
</div>
</div>
<div class="paragraph">
<p>您可以随时打开项目属性（右键单击该项目并选择“属性”），然后选择Drools类别，以随时更改Drools项目的运行时，如下所示。选中“启用项目特定设置”复选框，然后从下拉框中选择适当的运行时。如果单击``配置工作空间设置...''链接，将打开显示当前安装的Drools运行时的工作空间首选项，因此您可以在此处添加新的运行时。如果取消选中“启用项目特定设置”复选框，它将使用全局首选项中定义的默认运行时。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Install/drools-runtimes-project.png" alt="流口水的运行时项目">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_building_from_source"><a class="anchor" href="#_building_from_source"></a> <a class="link" href="#_building_from_source">1.3.2。从源头建造</a></h4>
<div class="sect4">
<h5 id="_getting_the_sources"><a class="anchor" href="#_getting_the_sources"></a> <a class="link" href="#_getting_the_sources">1.3.2.1。获取资源</a></h5>
<div class="paragraph">
<p>每个Maven工件的源代码都可以在JBoss Maven存储库中作为源JAR获得。下载zip文件中还包含相同的源JAR。但是，如果您要从源代码构建，强烈建议从源代码控件获取我们的源代码。</p>
</div>
<div class="paragraph">
<p>Drools和jBPM使用<a href="http://git-scm.com/">Git</a>进行源代码控制。受祝福的git仓库托管在<a href="https://github.com">GitHub上</a> ：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/kiegroup" class="bare">https://github.com/kiegroup</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Git允许您分叉我们的代码，对其进行独立的个人更改，但仍会定期合并我们的最新更改，并可以选择与我们共享您的更改。要了解有关git的更多信息，请阅读免费书籍<a href="http://progit.org/book/">Git Pro</a> 。</p>
</div>
</div>
<div class="sect4">
<h5 id="_building_the_sources"><a class="anchor" href="#_building_the_sources"></a> <a class="link" href="#_building_the_sources">1.3.2.2。建立资源</a></h5>
<div class="paragraph">
<p>从本质上讲，从源代码构建非常容易，例如，如果要构建<em class="term">guvnor</em>项目：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ git clone git@github.com:kiegroup/guvnor.git
...
$ cd guvnor
$ mvn clean install -DskipTests -Dfull
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>但是， <em>存在很多潜在的陷阱</em> ，因此，如果您认真考虑从源代码进行构建并可能为项目做出贡献，请<strong>按照<a href="https://github.com/kiegroup/droolsjbpm-build-bootstrap/blob/master/README.md">droolsjbpm-build-bootstrap中的README文件中</a>的说明进行操作。</strong></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_eclipse"><a class="anchor" href="#_eclipse"></a> <a class="link" href="#_eclipse">1.3.3。日食</a></h4>
<div class="sect4">
<h5 id="_importing_eclipse_projects"><a class="anchor" href="#_importing_eclipse_projects"></a> <a class="link" href="#_importing_eclipse_projects">1.3.3.1。导入Eclipse项目</a></h5>
<div class="paragraph">
<p>生成Eclipse项目文件后，现在可以将它们导入Eclipse。启动Eclipse时，在Subversion检出的根目录中打开工作区。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Install/eclipse_import1.jpg" alt="eclipse import1">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Install/eclipse_import2.jpg" alt="eclipse import2">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Install/eclipse_import3.jpg" alt="eclipse import3">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Install/eclipse_import4.jpg" alt="eclipse import4">
</div>
</div>
<div class="paragraph">
<p>打电话时<code>mvn install</code>所有项目依赖项均已下载并添加到本地Maven存储库。除非您告诉它存储库在哪里，否则Eclipse无法找到那些依赖项。为此， <code>M2_REPO</code>类路径变量。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Install/eclipse_import6.jpg" alt="eclipse import6">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Install/eclipse_import7.jpg" alt="eclipse import7">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Install/eclipse_import8.jpg" alt="eclipse import8">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Install/eclipse_import9.jpg" alt="eclipse import9">
</div>
</div>
<h1 id="_kie" class="discrete">IE</h1>
<div class="paragraph">
<p>KIE是Drools和jBPM的共享核心。它为构建，部署和利用资源提供了统一的方法和编程模型。</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kiechapter"><a class="anchor" href="#_kiechapter"></a> <a class="link" href="#_kiechapter">2。IE</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_kieoverviewsection"><a class="anchor" href="#_kieoverviewsection"></a> <a class="link" href="#_kieoverviewsection">2.1。总览</a></h3>
<div class="sect3">
<h4 id="_kieanatomysection"><a class="anchor" href="#_kieanatomysection"></a> <a class="link" href="#_kieanatomysection">2.1.1。项目剖析</a></h4>
<div class="paragraph">
<p>研究Drools和jBPM的集成知识解决方案的过程仅使用了“ kiegroup”组名。该名称遍布GitHub帐户和Maven POM。随着范围的扩大和新项目的推出，KIE被选为“知识就是一切”的缩写，作为新的小组名称。KIE名称也用于系统的共享方面。例如统一构建，部署和利用。</p>
</div>
<div class="paragraph">
<p>KIE当前包含以下子项目：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/Overview/kie.png" alt="ie">
</div>
<div class="title">图1。KIE解剖</div>
</div>
<div class="paragraph">
<p>OptaPlanner是一种本地搜索和优化工具，它是从Drools Planner衍生出来的，现在是Drools和jBPM的顶级项目。这是自然发展的过程，因为Optaplanner拥有强大的Drools集成，但长期以来一直独立于Drools。</p>
</div>
<div class="paragraph">
<p>收购Polymita以及其他功能后，将提供功能强大的Dashboard Builder，它提供了强大的报告功能。Dashboard Builder当前是一个临时名称，在6.0版本之后，将选择一个新名称。Dashboard Builder完全独立于Drools和jBPM，将在JBoss的许多项目中使用，并希望在JBoss之外使用：)</p>
</div>
<div class="paragraph">
<p>UberFire是新的基础Business Central项目，从头开始进行重写。UberFire提供了类似于Eclipse的工作台功能，其中包含来自插件的面板和页面。该项目独立于Drools和jBPM，任何人都可以将其用作构建灵活而强大的工作台（如Business Central）的基础。UberFire将用于整个JBoss的控制台和工作台开发。</p>
</div>
<div class="paragraph">
<p>可以确定的是Guvnor品牌从其预期角色中泄漏了太多；例如决策表之类的创作隐喻，被视为Guvnor组件而不是Drools组件。Guvnor在5.x中使用的整体项目结构对此无济于事。在6.0中，Guvnor的重点已缩小到封装UberFire插件集，这些插件提供了构建基于Web的IDE的基础。例如用于构建和部署的Maven集成，通过收件箱管理Maven存储库和活动通知。Drools和jBPM以Uberfire为基础构建Business Central发行版，并包括一组插件（例如Guvnor）以及自己的插件，用于决策表，指导编辑器，BPMN2设计器，人工任务。业务中心称为业务中心。</p>
</div>
<div class="paragraph">
<p>KIE-WB是结合了所有Guvnor，Drools和jBPM插件的uber工作台。由于jBPM-WB实际上并不存在，因此被KIE-WB冗余了，因此已被删除。</p>
</div>
</div>
<div class="sect3">
<h4 id="_kielifecyclessection"><a class="anchor" href="#_kielifecyclessection"></a> <a class="link" href="#_kielifecyclessection">2.1.2。生命周期</a></h4>
<div class="paragraph">
<p>无论是Drools还是jBPM，使用KIE系统的不同方面或生命周期通常可以分为以下几类：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>作者</strong></p>
<div class="ulist">
<ul>
<li>
<p>使用UI隐喻编写知识，例如：DRL，BPMN2，决策表，类模型。</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>建立</strong></p>
<div class="ulist">
<ul>
<li>
<p>将创作的知识构建到可部署的单元中。</p>
</li>
<li>
<p>对于KIE，此单位为JAR。</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>测试</strong></p>
<div class="ulist">
<ul>
<li>
<p>在将KIE知识部署到应用程序之前对其进行测试。</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>部署</strong></p>
<div class="ulist">
<ul>
<li>
<p>将单元部署到应用程序可以利用（消费）它们的位置。</p>
</li>
<li>
<p>KIE使用Maven样式存储库。</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>利用</strong></p>
<div class="ulist">
<ul>
<li>
<p>加载JAR以提供应用程序可以与之交互的KIE会话（KieSession）。</p>
</li>
<li>
<p>KIE在运行时通过KIE容器（KieContainer）公开JAR。</p>
</li>
<li>
<p>从KieContainer创建供运行时交互的KieSessions。</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>跑</strong></p>
<div class="ulist">
<ul>
<li>
<p>通过API与KieSession进行系统交互。</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>工作</strong></p>
<div class="ulist">
<ul>
<li>
<p>用户通过命令行或UI与KieSession进行交互。</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>管理</strong></p>
<div class="ulist">
<ul>
<li>
<p>管理任何KieSession或KieContainer。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="installation-options-ref_decision-management-architecture"><a class="anchor" href="#installation-options-ref_decision-management-architecture"></a> <a class="link" href="#installation-options-ref_decision-management-architecture">2.1.3。Drools的安装环境选项</a></h4>
<div class="paragraph">
<p>使用Drools，您可以设置开发环境来开发业务应用程序，或运行时环境来运行那些应用程序以支持决策，或者两者都设置。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>开发环境</strong> ：通常包括一个Business Central安装和至少一个KIE Server安装。您可以使用Business Central设计决策和其他工件，也可以使用KIE Server执行和测试您创建的工件。</p>
</li>
<li>
<p><strong>运行时环境</strong> ：包含一个或多个带有或不带有Business Central的KIE Server实例。Business Central具有嵌入式Drools控制器。如果安装Business Central，请使用<strong>菜单</strong> → <strong>部署</strong> → <strong>执行服务器</strong>页面创建和维护容器。如果要在没有Business Central的情况下自动进行KIE Server管理，则可以使用无头Drools控制器。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>您还可以将开发环境和运行时环境集群化。集群开发或运行时环境由两个或多个服务器的统一组或“集群”组成。集群化Drools开发环境的主要好处是高可用性和增强的协作，而集群化Drools运行时环境的主要好处是高可用性和负载平衡。高可用性减少了单个服务器发生故障时数据丢失的机会。当服务器发生故障时，另一台服务器通过提供故障服务器上的数据副本来填补空白。当发生故障的服务器再次联机时，它将恢复在群集中的位置。负载平衡在群集的各个节点之间共享计算负载，以提高整体性能。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">当前仅在Red Hat JBoss EAP 7.2上支持运行时环境的集群。Business Central的群集当前是一项技术预览功能，尚不适用于生产。
</td>
</tr>
</tbody></table>
</div>
<div class="ulist">
<div class="title">额外资源</div>
<ul>
<li>
<p><a href="#_installationandsetup">安装和设置（Core和IDE）</a></p>
</li>
<li>
<p><a href="#_wb.advancedsettings">高级设置</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="decision-authoring-assets-ref_decision-management-architecture"><a class="anchor" href="#decision-authoring-assets-ref_decision-management-architecture"></a> <a class="link" href="#decision-authoring-assets-ref_decision-management-architecture">2.1.4。Drools中的决策制定资产</a></h4>
<div class="paragraph">
<p>Drools支持多种资产，可用于为决策服务定义业务决策。每种决策制定资产都有不同的优势，您可能会根据自己的目标和需求，选择使用一种或多种资产的组合。</p>
</div>
<div class="paragraph">
<p>下表重点介绍了Drools项目中支持的主要决策制定资产，可帮助您确定或确认在决策服务中定义决策的最佳方法。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表格1。Drools支持的决策制定资产</caption>
<colgroup>
<col style="width:20%">
<col style="width:40%">
<col style="width:20%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">资产</th>
<th class="tableblock halign-left valign-top">强调</th>
<th class="tableblock halign-left valign-top">创作工具</th>
<th class="tableblock halign-left valign-top">文献资料</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">决策模型和表示法（DMN）模型</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>决策模型是否基于对象管理组（OMG）定义的注释标准</p>
</li>
<li>
<p>使用图形化的决策需求图（DRD）和一个或多个决策需求图（DRG）来跟踪业务决策流程</p>
</li>
<li>
<p>使用允许在DMN兼容平台之间共享DMN模型的XML模式</p>
</li>
<li>
<p>支持友好的足够表达语言（FEEL）以在DMN决策表和其他DMN框式表达式中定义决策逻辑</p>
</li>
<li>
<p>是创建全面，说明性和稳定的决策流程的最佳选择</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">商业中心或其他DMN兼容编辑器</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#dmn-con_dmn-models">决策模型和表示法（DMN）</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">指导决策表</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>是您在Business Central中基于UI的表设计器中创建的规则表</p>
</li>
<li>
<p>是向导主导的电子表格决策表的替代方案</p>
</li>
<li>
<p>提供可接受输入的字段和选项</p>
</li>
<li>
<p>支持模板键和值，用于创建规则模板</p>
</li>
<li>
<p>支持命中策略，实时验证以及其他资产不支持的其他附加功能</p>
</li>
<li>
<p>最适合以受控表格格式创建规则以最大程度地减少编译错误</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">商业中心</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#guided-decision-tables-con">指导决策表</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">电子表格决策表</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>您可以上传到Business Central的XLS或XLSX电子表格决策表</p>
</li>
<li>
<p>支持模板键和值，用于创建规则模板</p>
</li>
<li>
<p>最适合在已经在Business Central外部管理的决策表中创建规则</p>
</li>
<li>
<p>对规则有严格的语法要求，以便在上载时正确编译规则</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">电子表格编辑器</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#decision-tables-con_decision-tables">电子表格决策表</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">指导规则</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>是您在Business Central中基于UI的规则设计器中创建的单个规则</p>
</li>
<li>
<p>提供可接受输入的字段和选项</p>
</li>
<li>
<p>最适合以受控格式创建单个规则以最大程度地减少编译错误</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">商业中心</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#guided-rules-con_kie-apis">指导规则</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">指导规则模板</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>您在Business Central中基于UI的模板设计器中创建的可重用规则结构</p>
</li>
<li>
<p>提供可接受输入的字段和选项</p>
</li>
<li>
<p>用于创建规则模板的支持模板键和值（此资产的用途基础）</p>
</li>
<li>
<p>是创建具有相同规则结构但具有不同定义字段值的许多规则的最佳选择</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">商业中心</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#guided-rule-templates-con">指导规则模板</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DRL规则</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>您直接在其中定义的个别规则<code>.drl</code>文字档</p>
</li>
<li>
<p>为定义规则和规则行为的其他技术提供最大的灵活性</p>
</li>
<li>
<p>可以在某些独立环境中创建并与Drools集成</p>
</li>
<li>
<p>是创建需要高级DRL选项的规则的最佳选择</p>
</li>
<li>
<p>对要正确编译的规则有严格的语法要求</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">商业中心或集成开发环境（IDE）</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#drl-rules-con_decision-tables">[drl-rules-con_decision-tables]</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">预测模型标记语言（PMML）模型</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>是基于数据挖掘小组（DMG）定义的注释标准的预测性数据分析模型</p>
</li>
<li>
<p>使用允许在兼容PMML的平台之间共享PMML模型的XML模式</p>
</li>
<li>
<p>支持回归，记分卡，树，挖掘和其他模型类型</p>
</li>
<li>
<p>可以包含在独立的Drools项目中，也可以导入到Business Central中的项目中</p>
</li>
<li>
<p>是将预测数据纳入Drools决策服务的最佳选择</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PMML或XML编辑器</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#pmml-con_pmml-models">预测模型标记语言（PMML）</a></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="project-storage-version-build-options-ref_decision-management-architecture"><a class="anchor" href="#project-storage-version-build-options-ref_decision-management-architecture"></a> <a class="link" href="#project-storage-version-build-options-ref_decision-management-architecture">2.1.5。Drools的项目存储和构建选项</a></h4>
<div class="paragraph">
<p>在开发Drools项目时，您需要能够使用版本控制的存储库跟踪项目的版本，在稳定的环境中管理项目资产，并构建用于测试和部署的项目。您可以将Business Central用于所有这些任务，或者将Business Central与外部工具和存储库结合使用。Drools支持用于项目版本控制的Git存储库，用于项目管理的Apache Maven，以及各种基于Maven，基于Java或基于定制工具的构建选项。</p>
</div>
<div class="paragraph">
<p>以下选项是Drools项目版本控制，存储和构建的主要方法：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表2。项目版本控制选项（Git）</caption>
<colgroup>
<col style="width:25%">
<col style="width:50%">
<col style="width:25%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">版本控制选项</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">文献资料</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">商务中心Git VFS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business Central包含一个内置的Git虚拟文件系统（VFS），该文件系统存储您在创作环境中创建的所有流程，规则和其他工件。Git是一个分布式版本控制系统，可将修订实现为提交对象。将更改提交到存储库后，将在Git存储库中创建一个新的提交对象。在Business Central中创建项目时，该项目将添加到连接到Business Central的Git存储库中。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">外部Git存储库</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果您在Business Central之外的Git存储库中有Drools项目，则可以将它们导入Drools空间，并使用Git挂钩同步内部和外部Git存储库。</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>不适用</p>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表3。项目管理选项（Maven）</caption>
<colgroup>
<col style="width:25%">
<col style="width:50%">
<col style="width:25%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">管理选项</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">文献资料</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business Central Maven存储库</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Business Central包含一个内置的Maven存储库，该存储库可组织和构建您在创作环境中创建的项目资产。Maven是一个分布式的构建自动化工具，它使用存储库来存储Java库，插件和其他构建工件。在构建项目和原型时，Maven从本地或远程存储库中动态检索Java库和Maven插件，以促进跨项目的共享依赖关系。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">对于生产环境，请考虑使用配置有Business Central的外部Maven存储库。
</td>
</tr>
</tbody></table>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#_wb.artifactrepository">工件存储库</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">外部Maven存储库</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果您在外部Maven存储库（例如Nexus或Artifactory）中拥有Drools项目，则可以创建一个<a href="https://maven.apache.org/settings.html"><code>settings.xml</code></a>带有连接详细信息的<a href="https://maven.apache.org/settings.html">文件</a> ，然后将该文件路径添加到<code>kie.maven.settings.custom</code>项目中的属性<code>standalone-full.xml</code>文件。</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://maven.apache.org/settings.html"><em>Maven设置参考</em></a></p>
</div>
<div class="paragraph">
<p><a href="#_settings_xml_and_remote_repository_setup">Settings.xml和远程存储库设置</a></p>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表4。项目构建选项</caption>
<colgroup>
<col style="width:25%">
<col style="width:50%">
<col style="width:25%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">构建选项</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">文献资料</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">商业中心（KJAR）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business Central将构建存储在内置Maven存储库或已配置的外部Maven存储库中的Drools项目。Business Central中的项目会自动打包为知识JAR（KJAR）文件，其中包含构建项目时部署所需的所有组件。</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#_wb.quickstartbuildanddeloy">构建和部署</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">独立Maven项目（KJAR）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果您在Business Central之外有一个独立的Drools Maven项目，则可以编辑该项目<code>pom.xml</code>文件将您的项目打包为KJAR文件，然后添加一个<code>kmodule.xml</code>文件，其中包含构建项目所需的KIE基础和KIE会话配置。</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#_buildingwithmaven">用Maven构建</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">嵌入式Java应用程序（KJAR）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果您要使用嵌入式Java应用程序来构建Drools项目，则可以使用<code>KieModuleModel</code>以编程方式创建一个实例<code>kmodule.xml</code>具有KIE基本和KIE会话配置的文件，然后将项目中的所有资源添加到KIE虚拟文件系统<code>KieFileSystem</code>建立项目。</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#_definingakiemoduleprogrammatically">以编程方式定义KieModule</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CI / CD工具（KJAR）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果您使用工具进行持续集成和持续交付（CI / CD），则可以配置该工具集以与您的Drools Git存储库集成以构建指定的项目。确保将项目打包并构建为KJAR文件，以确保最佳部署。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="project-deployment-options-ref_decision-management-architecture"><a class="anchor" href="#project-deployment-options-ref_decision-management-architecture"></a> <a class="link" href="#project-deployment-options-ref_decision-management-architecture">2.1.6。Drools的项目部署选项</a></h4>
<div class="paragraph">
<p>在开发，测试和构建Drools项目之后，可以部署该项目以开始使用已创建的业务资产。您可以将Drools项目部署到已配置的KIE Server，嵌入式Java应用程序或Red Hat OpenShift容器平台环境中，以实现增强的容器化实施。</p>
</div>
<div class="paragraph">
<p>以下选项是Drools项目部署的主要方法：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表5。项目部署选项</caption>
<colgroup>
<col style="width:25%">
<col style="width:50%">
<col style="width:25%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">部署选项</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">文献资料</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">部署到KIE服务器</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KIE Server是Drools随附的服务器，用于运行打包和部署的Drools项目（KJAR文件）中的决策服务，流程应用程序和其他可部署资产。这些服务在运行时通过实例化的KIE容器或<em>部署单元使用</em> 。您可以使用Business Central或无头Drools控制器及其关联的REST API（被视为<em>托管</em> KIE Server实例）在KIE Server中部署和维护部署单元。您也可以使用KIE Server REST API或Java客户端API从独立的Maven项目，嵌入式Java应用程序或其他自定义环境（称为<em>非托管</em> KIE Server实例）中部署和维护部署单元。</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#_kiedeployingsection">部署中</a></p>
</div>
<div class="paragraph">
<p><a href="#_ch.kie.server">KIE执行服务器</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">部署到嵌入式Java应用程序</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果要将Drools项目部署到自己的Java虚拟机（JVM）环境，微服务或应用程序服务器中，则可以将应用程序资源捆绑在项目WAR文件中，以创建类似于KIE容器的部署单元。您还可以使用核心KIE API（不是KIE Server API）来配置KIE扫描程序以定期更新KIE容器。</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="http://docs.jboss.org/drools/release/latestFinal/kie-api-javadoc/"><em>KIE公共API</em></a></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="project-asset-execution-options-ref_decision-management-architecture"><a class="anchor" href="#project-asset-execution-options-ref_decision-management-architecture"></a> <a class="link" href="#project-asset-execution-options-ref_decision-management-architecture">2.1.7。Drools的资产执行选项</a></h4>
<div class="paragraph">
<p>在将Drools项目构建并部署到KIE Server或其他环境之后，您可以执行部署的资产进行测试或消耗运行时。除了部署之后，也可以代替在本地执行资产，也可以在本地执行资产。</p>
</div>
<div class="paragraph">
<p>以下选项是Drools资产执行的主要方法：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表6。资产执行选项</caption>
<colgroup>
<col style="width:25%">
<col style="width:50%">
<col style="width:25%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">执行选项</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">文献资料</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">在KIE Server中执行</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果将Drools项目资产部署到KIE Server，则可以使用KIE Server REST API或Java客户端API来执行部署的资产并与之交互。您还可以使用Business Central或Business Central外部的无头Drools控制器来管理与已部署资产关联的KIE Server实例中的配置和KIE容器。</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#_ch.kie.server">KIE执行服务器</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">嵌入式Java应用程序中的执行</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果您在自己的Java虚拟机（JVM）环境，微服务或应用程序服务器中部署了Drools项目资产，则可以使用自定义API或与核心KIE API（不是KIE Server API）的应用程序交互来执行嵌入式引擎中的资产。</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="http://docs.jboss.org/drools/release/latestFinal/kie-api-javadoc/"><em>KIE公共API</em></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">在本地环境中执行以进行扩展测试</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作为开发周期的一部分，您可以在本地执行资产，以确保在Drools中创建的资产按预期运行。部署后，除了执行资产外，还可以使用本地执行来代替执行资产。</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#decision-examples-IDE-proc_drools-examples">在IDE中导入和执行Drools示例决策</a></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="title">智能路由器（KIE服务器路由器）</div>
<div class="paragraph">
<p>根据您的部署和执行环境，您可以使用智能路由器来聚合多个独立的KIE Server实例，就像它们是单个服务器一样。智能路由器是单个端点，可以接收来自客户端应用程序对您的任何服务的呼叫，并将每个呼叫自动路由到运行该服务的KIE服务器。有关智能路由器的更多信息，请参阅《 <a href="http://mswiderski.blogspot.com/2016/12/kie-server-router-even-more-flexibility.html">KIE服务器路由器》</a> 。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="architecture-scenarios-ref_decision-management-architecture"><a class="anchor" href="#architecture-scenarios-ref_decision-management-architecture"></a> <a class="link" href="#architecture-scenarios-ref_decision-management-architecture">2.1.8。Drools的示例决策管理架构</a></h4>
<div class="paragraph">
<p>以下方案说明了决策管理体系结构中Drools安装，资产创作，项目存储，项目部署和资产执行的常见变化。每个部分都总结了所使用的方法和工具以及给定体系结构的优点。这些示例是基本示例，仅是您可能考虑的众多组合中的一部分，具体取决于您对Drools的特定目标和需求。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">使用Business Central和KIE Server的Wildfly上的Drools</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>安装环境</strong> ：Wildfly上的Drools</p>
</li>
<li>
<p><strong>项目存储和构建环境</strong> ：用于外部版本控制的外部Git存储库与使用Git挂钩的Business Central Git存储库同步，用于项目管理和构建的外部Maven存储库通过KIE Server配置</p>
</li>
<li>
<p><strong>资产创作工具</strong> ：Business Central</p>
</li>
<li>
<p><strong>主要资产类型</strong> ：用于决策的决策模型和表示法（DMN）模型</p>
</li>
<li>
<p><strong>项目部署和执行环境</strong> ：KIE服务器</p>
</li>
<li>
<p><strong>方案优势</strong> ：</p>
<div class="ulist">
<ul>
<li>
<p>在本地开发环境中稳定实施Drools</p>
</li>
<li>
<p>访问Business Central中的存储库，资产，资产设计器和项目构建选项</p>
</li>
<li>
<p>使用DMN的标准化资产授权方法可实现最佳集成和稳定性</p>
</li>
<li>
<p>访问用于资产部署和执行的KIE Server功能和KIE API</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./KIE/Overview/architecture-BA-on-wildfly.png" alt="在野蝇上的建筑学学士学位">
</div>
<div class="title">图2。使用Business Central和KIE Server的Wildfly上的Drools</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">带有IDE和KIE服务器的Wildfly上的Drools</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>安装环境</strong> ：Wildfly上的Drools</p>
</li>
<li>
<p><strong>项目存储和构建环境</strong> ：用于项目版本控制的外部Git存储库（不与Business Central同步）和用于项目管理和构建的外部Maven存储库，并使用KIE Server配置</p>
</li>
<li>
<p><strong>资产创作工具</strong> ：集成开发环境（IDE）（例如Eclipse）和电子表格编辑器，或用于其他决策格式的决策模型和表示法（DMN）建模工具</p>
</li>
<li>
<p><strong>主要资产类型</strong> ：Drools规则语言（DRL）规则，电子表格决策表以及用于决策的决策模型和表示法（DMN）模型</p>
</li>
<li>
<p><strong>项目部署和执行环境</strong> ：KIE服务器</p>
</li>
<li>
<p><strong>方案优势</strong> ：</p>
<div class="ulist">
<ul>
<li>
<p>在本地开发环境中灵活实施Drools</p>
</li>
<li>
<p>能够使用外部IDE和您选择的其他资产创作工具来定义业务资产</p>
</li>
<li>
<p>访问用于资产部署和执行的KIE Server功能和KIE API</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./KIE/Overview/architecture-BA-with-IDE.png" alt="具有IDE的体系结构BA">
</div>
<div class="title">图3。带有IDE和KIE服务器的Wildfly上的Drools</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">具有IDE和嵌入式Java应用程序的Drools</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>安装环境</strong> ：嵌入在自定义应用程序中的Drools库</p>
</li>
<li>
<p><strong>项目存储和构建环境</strong> ：用于项目版本控制的外部Git存储库（不与Business Central同步）和用于项目管理和构建的外部Maven存储库（使用嵌入式Java应用程序配置）（未使用KIE Server配置）</p>
</li>
<li>
<p><strong>资产创作工具</strong> ：集成开发环境（IDE）（例如Eclipse）和电子表格编辑器，或用于其他决策格式的决策模型和表示法（DMN）建模工具</p>
</li>
<li>
<p><strong>主要资产类型</strong> ：Drools规则语言（DRL）规则，电子表格决策表以及用于决策的决策模型和表示法（DMN）模型</p>
</li>
<li>
<p><strong>项目部署和执行环境</strong> ：嵌入式Java应用程序，例如Java虚拟机（JVM）环境中的微服务或自定义应用程序服务器</p>
</li>
<li>
<p><strong>方案优势</strong> ：</p>
<div class="ulist">
<ul>
<li>
<p>在具有嵌入式Java应用程序的本地开发环境中自定义实现Drools</p>
</li>
<li>
<p>能够使用外部IDE和您选择的其他资产创作工具来定义业务资产</p>
</li>
<li>
<p>使用自定义API与核心KIE API（不是KIE Server API）进行交互并在嵌入式引擎中执行资产</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./KIE/Overview/architecture-BA-with-custom-app.png" alt="具有自定义应用程序的架构BA">
</div>
<div class="title">图4。具有IDE和嵌入式Java应用程序的Drools</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_builddeployutilizeandrunsection"><a class="anchor" href="#_builddeployutilizeandrunsection"></a> <a class="link" href="#_builddeployutilizeandrunsection">2.2。构建，部署，利用和运行</a></h3>
<div class="sect3">
<h4 id="_kiemoduleintroductionbuildingintroductionsection"><a class="anchor" href="#_kiemoduleintroductionbuildingintroductionsection"></a> <a class="link" href="#_kiemoduleintroductionbuildingintroductionsection">2.2.1。介绍</a></h4>
<div class="paragraph">
<p>6.0引入了一种新的配置和约定方法来构建KIE基础，而不是在5.x中使用程序化生成器方法。该构建器仍可使用，因为它已用于工具集成。</p>
</div>
<div class="paragraph">
<p>现在，Building使用Maven，并与Maven实践保持一致。KIE项目或模块仅仅是Maven Java项目或模块；以及其他元数据文件META-INF / kmodule.xml。kmodule.xml文件是用于选择KIE基础资源并配置这些KIE基础和会话的描述符。通过Spring和OSGi BluePrints还提供了其他XML支持。</p>
</div>
<div class="paragraph">
<p>尽管标准Maven可以构建和打包KIE资源，但它不会在构建时提供验证。有一个Maven插件，建议使用它来进行构建时间验证。该插件还生成许多类，从而使运行时加载也更快。</p>
</div>
<div class="paragraph">
<p>屏幕截图中说明了示例项目布局和Maven POM描述符。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/defaultkiesession.png" alt="违约">
</div>
<div class="title">图5。示例项目布局和Maven POM</div>
</div>
<div class="paragraph">
<p>KIE使用默认值来最大程度地减少配置量。空的kmodule.xml是最简单的配置。必须始终有一个kmodule.xml文件（即使为空），因为该文件用于发现JAR及其内容。</p>
</div>
<div class="paragraph">
<p>Maven可以“ mvn install”将KieModule部署到本地计算机，本地计算机上的所有其他应用程序都可以使用它。或者它可以“ mvn deploy”将KieModule推送到远程Maven存储库。构建应用程序将拉入KieModule并在此过程中填充本地Maven存储库。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/maven.png" alt="专家">
</div>
<div class="title">图6。示例项目布局和Maven POM</div>
</div>
<div class="paragraph">
<p>可以通过以下两种方式之一部署JAR。可以像添加Maven依赖列表中的任何其他JAR一样，添加到类路径中，也可以在运行时动态加载它们。KIE将扫描类路径以找到所有带有kmodule.xml的JAR。每个找到的JAR都由KieModule接口表示。术语类路径KieModule和动态KieModule用于指两种加载方法。动态模块支持并行版本控制，而类路径模块则不支持。此外，一旦模块位于类路径上，就不能动态加载其他版本。</p>
</div>
<div class="paragraph">
<p>API的详细参考资料包含在下一部分中，不耐烦的可以直接跳到示例部分，这在不同的用例上是不言而喻的。</p>
</div>
</div>
<div class="sect3">
<h4 id="_kiebuildingsection"><a class="anchor" href="#_kiebuildingsection"></a> <a class="link" href="#_kiebuildingsection">2.2.2。建造</a></h4>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/builder.png" alt="建造者">
</div>
<div class="title">图7. org.kie.api.core.builder</div>
</div>
<div class="sect4">
<h5 id="_creatingandbuildingakieproject"><a class="anchor" href="#_creatingandbuildingakieproject"></a> <a class="link" href="#_creatingandbuildingakieproject">2.2.2.1。创建和构建Kie项目</a></h5>
<div class="paragraph">
<p>Kie Project具有普通Maven项目的结构，唯一的特点是包括以声明方式定义kmodule.xml文件。 <code>KieBase</code>和<code>KieSession</code>可以从中创建的。该文件必须放置在Maven项目的resources / META-INF文件夹中，而所有其他Kie构件（例如DRL或Excel文件）必须存储在resources文件夹或它下面的任何其他子文件夹中。</p>
</div>
<div class="paragraph">
<p>由于已经为所有配置方面提供了有意义的默认值，因此最简单的kmodule.xml文件只能包含一个空的kmodule标记，如下所示：</p>
</div>
<div class="exampleblock">
<div class="title">范例1。空的kmodule.xml文件</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>这样，kmodule将包含一个默认值<code>KieBase</code> 。存储在资源文件夹或其任何子文件夹下的所有Kie资产将被编译并添加到其中。要触发这些工件的构建，只需创建一个<code>KieContainer</code>为他们。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieContainer.png" alt="KieContainer">
</div>
<div class="title">图8。KieContainer</div>
</div>
<div class="paragraph">
<p>对于这种简单的情况，只需创建一个<code>KieContainer</code>从类路径读取要构建的文件：</p>
</div>
<div class="exampleblock">
<div class="title">示例2从类路径创建一个KieContainer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieContainer kContainer = kieServices.getKieClasspathContainer();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>KieServices是可以访问所有Kie构建和运行时设施的接口：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieServices.png" alt="KieServices">
</div>
<div class="title">图9。KieServices</div>
</div>
<div class="paragraph">
<p>这样，所有Java源代码和Kie资源都被编译并部署到KieContainer中，从而使其内容可在运行时使用。</p>
</div>
</div>
<div class="sect4">
<h5 id="_thekmodulexmlfile"><a class="anchor" href="#_thekmodulexmlfile"></a> <a class="link" href="#_thekmodulexmlfile">2.2.2.2。kmodule.xml文件</a></h5>
<div class="paragraph">
<p>如前一节所述，kmodule.xml文件是可以声明性地配置<code>KieBase</code> （s）和<code>KieSession</code>可以从KIE项目中创建的内容。</p>
</div>
<div class="paragraph">
<p>特别是<code>KieBase</code>是所有应用程序知识定义的存储库。它将包含规则，流程，功能和类型模型。的<code>KieBase</code>本身不包含数据；而是从<code>KieBase</code>可以在其中插入数据以及可以从中启动流程实例。创建<code>KieBase</code>可能很繁重，而会话创建非常简单，因此建议<code>KieBase</code>尽可能缓存以允许重复的会话创建。但是，最终用户通常不必担心，因为该缓存机制已经由<code>KieContainer</code> 。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieBase.png" alt="凯基">
</div>
<div class="title">图10。凯基</div>
</div>
<div class="paragraph">
<p>反之<code>KieSession</code>存储并在运行时数据上执行。它是从<code>KieBase</code>或更容易地可以直接从<code>KieContainer</code>如果已在kmodule.xml文件中定义</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieSession.png" alt="KieSession">
</div>
<div class="title">图11。KieSession</div>
</div>
<div class="paragraph">
<p>kmodule.xml允许定义和配置一个或多个<code>KieBase</code> s和每个<code>KieBase</code>所有不同<code>KieSession</code>可以从中创建的，如以下示例所示：</p>
</div>
<div class="exampleblock">
<div class="title">范例3。一个样本kmodule.xml文件</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://www.drools.org/xsd/kmodule"&gt;
  &lt;configuration&gt;
    &lt;property key="drools.evaluator.supersetOf" value="org.mycompany.SupersetOfEvaluatorDefinition"/&gt;
  &lt;/configuration&gt;
  &lt;kbase name="KBase1" default="true" eventProcessingMode="cloud" equalsBehavior="equality" declarativeAgenda="enabled" packages="org.domain.pkg1"&gt;
    &lt;ksession name="KSession2_1" type="stateful" default="true"/&gt;
    &lt;ksession name="KSession2_2" type="stateless" default="false" beliefSystem="jtms"/&gt;
  &lt;/kbase&gt;
  &lt;kbase name="KBase2" default="false" eventProcessingMode="stream" equalsBehavior="equality" declarativeAgenda="enabled" packages="org.domain.pkg2, org.domain.pkg3" includes="KBase1"&gt;
    &lt;ksession name="KSession3_1" type="stateful" default="false" clockType="realtime"&gt;
      &lt;fileLogger file="drools.log" threaded="true" interval="10"/&gt;
      &lt;workItemHandlers&gt;
        &lt;workItemHandler name="name" type="org.domain.WorkItemHandler"/&gt;
      &lt;/workItemHandlers&gt;
      &lt;calendars&gt;
        &lt;calendar name="monday" type="org.domain.Monday"/&gt;
      &lt;/calendars&gt;
      &lt;listeners&gt;
        &lt;ruleRuntimeEventListener type="org.domain.RuleRuntimeListener"/&gt;
        &lt;agendaEventListener type="org.domain.FirstAgendaListener"/&gt;
        &lt;agendaEventListener type="org.domain.SecondAgendaListener"/&gt;
        &lt;processEventListener type="org.domain.ProcessListener"/&gt;
      &lt;/listeners&gt;
    &lt;/ksession&gt;
  &lt;/kbase&gt;
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>此处的代码包含键值对列表，这些键值对是用于配置<code>KieBase</code>的建设过程。例如，此样本kmodule.xml文件定义了一个名为的附加自定义运算符<code>supersetOf</code>并由<code>org.mycompany.SupersetOfEvaluatorDefinition</code>类。</p>
</div>
<div class="paragraph">
<p>在此之后2 <code>KieBase</code>已定义，可以实例2种不同类型的<code>KieSession</code> s从第一个开始，而只有一个从第二个开始。可以在kbase标记上定义的属性及其含义和默认值的列表如下：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表7. kbase属性</caption>
<colgroup>
<col style="width:25%">
<col style="width:25%">
<col style="width:25%">
<col style="width:25%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性名称</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">允许值</th>
<th class="tableblock halign-left valign-top">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任何</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">从KieContainer检索此KieBase的名称。这是唯一的必需属性。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">包括</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任何用逗号分隔的列表</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">以逗号分隔的列表包含在此kmodule中的其他KieBase。所有这些KieBases的工件也将包括在这一部分中。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">包装</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">所有</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任何用逗号分隔的列表</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认情况下，任何级别的资源文件夹下的所有Drools工件都包含在KieBase中。该属性允许将要在此KieBase中编译的工件限制为仅属于软件包列表的工件。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">假</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">真假</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定义此KieBase是否为该模块的默认模块，因此可以从KieContainer创建它而无需传递任何名称。每个模块中最多可以有一个默认的KieBase。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">等于行为</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">身份</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">身份平等</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定义将新事实插入工作记忆时的Drools行为。有了身份，它总是创建一个新的FactHandle，除非工作存储器中还没有相同的对象，而只有当新插入的对象与现有事实不相等（根据其相等方法）时，才具有相等性。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eventProcessingMode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">云</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">云，流</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在云模式下编译时，KieBase将事件视为正常事实，而在流模式下，则允许对事件进行时间推理。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">声明性议程</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">残障人士</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">禁用启用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定义是否启用声明性议程。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>同样，ksession标记的所有属性（当然，名称除外）也都具有有意义的默认值。下表列出并描述了它们：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表8. ksession属性</caption>
<colgroup>
<col style="width:25%">
<col style="width:25%">
<col style="width:25%">
<col style="width:25%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性名称</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">允许值</th>
<th class="tableblock halign-left valign-top">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任何</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">此KieSession的唯一名称。用于从KieContainer中获取KieSession。这是唯一的必需属性。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类型</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">有状态的</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">有状态的，无状态的</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">有状态会话允许迭代地使用工作内存，而无状态会话是使用提供的数据集一次性执行工作内存。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">假</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">真假</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定义此KieSession是否是该模块的默认值，因此可以从KieContainer创建它而无需传递任何名称。在每个模块中，每种类型最多可以有一个默认的KieSession。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clockType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">即时的</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实时，伪</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定义事件时间戳是由系统时钟还是由应用程序控制的伪时钟确定的。该时钟对于单元测试时间规则特别有用。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">信仰体系</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">简单</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">简单，可行，可行</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定义KieSession使用的信念系统的类型。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>如先前的kmodule.xml示例中概述的那样，也可以在每个声明性地创建<code>KieSession</code>一个文件（或控制台）记录器，一个或多个<code>WorkItemHandler</code>和<code>Calendar</code> s加上一些可以为3种不同类型的侦听器：ruleRuntimeEventListener，议程事件监听器和processEventListener</p>
</div>
<div class="paragraph">
<p>像先前示例中那样定义了一个kmodule.xml，现在可以使用它们的名称从KieContainer中简单地检索KieBases和KieSessions。</p>
</div>
<div class="exampleblock">
<div class="title">示例4从KieContainer检索KieBases和KieSession</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieContainer kContainer = kieServices.getKieClasspathContainer();

KieBase kBase1 = kContainer.getKieBase("KBase1");
KieSession kieSession1 = kContainer.newKieSession("KSession2_1");
StatelessKieSession kieSession2 = kContainer.newStatelessKieSession("KSession2_2");</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>必须注意的是，由于KSession2_1和KSession2_2是2种不同的类型（第一种是有状态的，而第二种是无状态的），因此有必要在KSession2_1和KSession2_2上调用2种不同的方法。 <code>KieContainer</code>根据其声明的类型。如果类型<code>KieSession</code>要求<code>KieContainer</code>与kmodule.xml文件中声明的不对应<code>KieContainer</code>会抛出一个<code>RuntimeException</code> 。也因为<code>KieBase</code>和一个<code>KieSession</code>已被标记为默认值，是否有可能从<code>KieContainer</code>没有传递任何名字。</p>
</div>
<div class="exampleblock">
<div class="title">示例5从KieContainer检索默认的KieBases和KieSessions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieContainer kContainer = ...

KieBase kBase1 = kContainer.getKieBase(); // returns KBase1
KieSession kieSession1 = kContainer.newKieSession(); // returns KSession2_1</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>由于Kie项目也是Maven项目，因此使用pom.xml文件中声明的groupId，artifactId和版本来生成<code>ReleaseId</code>在您的应用程序中唯一标识此项目。这允许通过简单地传递项目从项目创建新的KieContainer <code>ReleaseId</code>到<code>KieServices</code> 。</p>
</div>
<div class="exampleblock">
<div class="title">范例6。通过ReleaseId创建现有项目的KieContainer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
ReleaseId releaseId = kieServices.newReleaseId( "org.acme", "myartifact", "1.0" );
KieContainer kieContainer = kieServices.newKieContainer( releaseId );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_buildingwithmaven"><a class="anchor" href="#_buildingwithmaven"></a> <a class="link" href="#_buildingwithmaven">2.2.2.3。用Maven构建</a></h5>
<div class="paragraph">
<p>Maven的KIE插件可确保对工件资源进行验证和预编译，建议始终使用该资源。要使用该插件，只需将其添加到Maven pom.xml的build部分，并通过使用打包将其激活<code>kjar</code> 。</p>
</div>
<div class="exampleblock">
<div class="title">范例7。将KIE插件添加到Maven pom.xml并激活它</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">  &lt;packaging&gt;kjar&lt;/packaging&gt;
  ...
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.kie&lt;/groupId&gt;
        &lt;artifactId&gt;kie-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;7.30.0.Final&lt;/version&gt;
        &lt;extensions&gt;true&lt;/extensions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>该插件附带了对所有Drools / jBPM知识资源的支持。但是，如果您在Java类中使用特定的KIE注释，例如<code>@kie.api.Position</code> ，您将需要在<code>kie-api</code>进入您的项目。我们建议对所有其他KIE依赖项使用提供的范围。这样，kjar尽可能保持轻量级，而不依赖于任何特定的KIE版本。</p>
</div>
<div class="paragraph">
<p>构建不带Maven插件的KIE模块会将所有资源照原样复制到生成的JAR中。当运行时加载该JAR时，它将尝试构建所有资源。如果存在编译问题，它将返回空KieContainer。它还将编译开销推到了运行时。通常不建议这样做，应该始终使用Maven插件。</p>
</div>
</div>
<div class="sect4">
<h5 id="_definingakiemoduleprogrammatically"><a class="anchor" href="#_definingakiemoduleprogrammatically"></a> <a class="link" href="#_definingakiemoduleprogrammatically">2.2.2.4。以编程方式定义KieModule</a></h5>
<div class="paragraph">
<p>也可以定义<code>KieBase</code>和<code>KieSession</code>通过编程方式属于KieModule而不是kmodule.xml文件中的声明性定义。相同的编程API还允许显式添加包含Kie工件的文件，而不是自动从项目的resources文件夹中读取它们。为此，有必要创建一个<code>KieFileSystem</code> ，一种虚拟文件系统，并将项目中包含的所有资源添加到其中。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieFileSystem.png" alt="KieFileSystem">
</div>
<div class="title">图12。KieFileSystem</div>
</div>
<div class="paragraph">
<p>像所有其他Kie核心组件一样，您可以获取<code>KieFileSystem</code>来自<code>KieServices</code> 。必须将kmodule.xml配置文件添加到文件系统。这是必须执行的步骤。Kie还提供了便捷的流利API，由<code>KieModuleModel</code> ，以编程方式创建此文件。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieModuleModel.png" alt="KieModuleModel">
</div>
<div class="title">图13。KieModuleModel</div>
</div>
<div class="paragraph">
<p>要在实践中做到这一点，有必要创建一个<code>KieModuleModel</code>来自<code>KieServices</code> ，使用所需的配置<code>KieBase</code>和<code>KieSession</code> ，将其转换为XML并将XML添加到<code>KieFileSystem</code> 。以下示例显示了此过程：</p>
</div>
<div class="exampleblock">
<div class="title">范例8。以编程方式创建kmodule.xml并将其添加到KieFileSystem</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieModuleModel kieModuleModel = kieServices.newKieModuleModel();

KieBaseModel kieBaseModel1 = kieModuleModel.newKieBaseModel( "KBase1 ")
        .setDefault( true )
        .setEqualsBehavior( EqualityBehaviorOption.EQUALITY )
        .setEventProcessingMode( EventProcessingOption.STREAM );

KieSessionModel ksessionModel1 = kieBaseModel1.newKieSessionModel( "KSession1" )
        .setDefault( true )
        .setType( KieSessionModel.KieSessionType.STATEFUL )
        .setClockType( ClockTypeOption.get("realtime") );

KieFileSystem kfs = kieServices.newKieFileSystem();
kfs.writeKModuleXML(kieModuleModel.toXML());</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>此时，还需要添加<code>KieFileSystem</code> ，通过其流畅的API，所有其他组成项目的Kie工件。这些工件必须添加到相应的常规Maven项目的相同位置。</p>
</div>
<div class="exampleblock">
<div class="title">范例9。将Kie工件添加到KieFileSystem</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieFileSystem kfs = ...
kfs.write( "src/main/resources/KBase1/ruleSet1.drl", stringContainingAValidDRL )
        .write( "src/main/resources/dtable.xls",
                kieServices.getResources().newInputStreamResource( dtableFileStream ) );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>此示例说明可以将Kie工件既添加为纯字符串也添加为<code>Resource</code> s。在后一种情况下<code>Resource</code>可以由创建<code>KieResources</code>工厂，也由<code>KieServices</code> 。的<code>KieResources</code>提供了许多方便的工厂方法来转换<code>InputStream</code> ， 一种<code>URL</code> ， 一种<code>File</code>或<code>String</code>代表文件系统到<code>Resource</code>可以由<code>KieFileSystem</code> 。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieResources.png" alt="Kie资源">
</div>
<div class="title">图14。Kie资源</div>
</div>
<div class="paragraph">
<p>通常情况下， <code>Resource</code>可以从用于将其添加到<code>KieFileSystem</code> 。但是，也可能不遵循有关文件扩展名的Kie约定，而是明确分配特定的<code>ResourceType</code>到一个<code>Resource</code>如下所示：</p>
</div>
<div class="exampleblock">
<div class="title">示例10创建和添加具有显式类型的资源</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieFileSystem kfs = ...
kfs.write( "src/main/resources/myDrl.txt",
           kieServices.getResources().newInputStreamResource( drlStream )
                      .setResourceType(ResourceType.DRL) );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>将所有资源添加到<code>KieFileSystem</code>并通过传递<code>KieFileSystem</code>到一个<code>KieBuilder</code></p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieBuilder.png" alt="KieBuilder">
</div>
<div class="title">图15。KieBuilder</div>
</div>
<div class="paragraph">
<p>当一个内容<code>KieFileSystem</code>成功构建，结果<code>KieModule</code>自动添加到<code>KieRepository</code> 。的<code>KieRepository</code>是一个单例，充当所有可用资源的存储库<code>KieModule</code> s。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieRepository.png" alt="Kie资料库">
</div>
<div class="title">图16。Kie资料库</div>
</div>
<div class="paragraph">
<p>之后，可以通过创建<code>KieServices</code>一个新的<code>KieContainer</code>为了那个原因<code>KieModule</code>使用其<code>ReleaseId</code> 。但是，由于在这种情况下<code>KieFileSystem</code>不包含任何pom.xml文件（可以使用<code>KieFileSystem.writePomXML</code>方法），Kie无法确定<code>ReleaseId</code>的<code>KieModule</code>并为其分配一个默认值。这个预设<code>ReleaseId</code>可以从<code>KieRepository</code>并用来识别<code>KieModule</code>在 - 的里面<code>KieRepository</code>本身。以下示例显示了整个过程。</p>
</div>
<div class="exampleblock">
<div class="title">示例11构建KieFileSystem的内容并创建KieContainer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieFileSystem kfs = ...
kieServices.newKieBuilder( kfs ).buildAll();
KieContainer kieContainer = kieServices.newKieContainer(kieServices.getRepository().getDefaultReleaseId());</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>在这一点上有可能<code>KieBase</code>并创建新<code>KieSession</code>从这个<code>KieContainer</code>与a情况完全相同<code>KieContainer</code>直接从类路径创建。</p>
</div>
<div class="paragraph">
<p>最佳做法是检查编译结果。的<code>KieBuilder</code>报告3种不同严重程度的编译结果：ERROR，WARNING和INFO。 ERROR表示项目的编译失败，如果不是<code>KieModule</code>产生了什么也没有添加到<code>KieRepository</code> 。警告和信息结果可以忽略，但可以检查。</p>
</div>
<div class="exampleblock">
<div class="title">范例12。检查编译没有产生任何错误</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieBuilder kieBuilder = kieServices.newKieBuilder( kfs ).buildAll();
assertEquals( 0, kieBuilder.getResults().getMessages( Message.Level.ERROR ).size() );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_changingthedefaultbuildresultseverity"><a class="anchor" href="#_changingthedefaultbuildresultseverity"></a> <a class="link" href="#_changingthedefaultbuildresultseverity">2.2.2.5。更改默认构建结果的严重性</a></h5>
<div class="paragraph">
<p>在某些情况下，可以更改某种生成结果的默认严重性。例如，将与现有规则同名的新规则添加到程序包时，默认行为是用新规则替换旧规则，并将其报告为INFO。对于大多数用例来说，这可能是理想的选择，但是在某些部署中，用户可能希望阻止规则更新并将其报告为错误。</p>
</div>
<div class="paragraph">
<p>可以通过API调用，系统属性或配置文件来更改结果类型的默认严重性，就像在Drools中的其他任何选项一样进行配置。从该版本开始，Drools支持规则更新和功能更新的可配置结果严重性。要使用系统属性或配置文件对其进行配置，用户必须使用以下属性：</p>
</div>
<div class="exampleblock">
<div class="title">范例13。使用属性设置严重性</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// sets the severity of rule updates
drools.kbuilder.severity.duplicateRule = &lt;INFO|WARNING|ERROR&gt;
// sets the severity of function updates
drools.kbuilder.severity.duplicateFunction = &lt;INFO|WARNING|ERROR&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_building_and_running_drools_in_a_fat_jar"><a class="anchor" href="#_building_and_running_drools_in_a_fat_jar"></a> <a class="link" href="#_building_and_running_drools_in_a_fat_jar">2.2.2.6。在一个胖子罐中构建并运行Drools</a></h5>
<div class="paragraph">
<p>Drools的许多模块（例如drools-core，drools-compiler）都有一个名为<code>kie.conf</code>包含实现相应模块提供的服务的类的名称。当在胖JAR（例如由Maven Shade插件创建）中运行Drools时， <code>kie.conf</code>文件需要合并，否则，胖JAR单个依赖项将仅包含1 kie.conf，从而导致错误。您可以使用转换器在Maven Shade插件中合并资源，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;transformer implementation="org.apache.maven.plugins.shade.resource.AppendingTransformer"&gt;
    &lt;resource&gt;META-INF/kie.conf&lt;/resource&gt;
&lt;/transformer&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>例如，在Vert.x应用程序中运行Drools时，这是必需的。在这种情况下，可以按照以下方式配置Maven Shade插件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;
    &lt;version&gt;3.1.0&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
                &lt;goal&gt;shade&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
                &lt;transformers&gt;
                    &lt;transformer implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"&gt;
                        &lt;manifestEntries&gt;
                            &lt;Main-Class&gt;io.vertx.core.Launcher&lt;/Main-Class&gt;
                            &lt;Main-Verticle&gt;${main.verticle}&lt;/Main-Verticle&gt;
                        &lt;/manifestEntries&gt;
                    &lt;/transformer&gt;
                    &lt;transformer implementation="org.apache.maven.plugins.shade.resource.AppendingTransformer"&gt;
                        &lt;resource&gt;META-INF/services/io.vertx.core.spi.VerticleFactory&lt;/resource&gt;
                    &lt;/transformer&gt;
                    &lt;transformer implementation="org.apache.maven.plugins.shade.resource.AppendingTransformer"&gt;
                        &lt;resource&gt;META-INF/kie.conf&lt;/resource&gt;
                    &lt;/transformer&gt;
                &lt;/transformers&gt;
                &lt;artifactSet&gt;
                &lt;/artifactSet&gt;
                &lt;outputFile&gt;${project.build.directory}/${project.artifactId}-${project.version}-fat.jar&lt;/outputFile&gt;
            &lt;/configuration&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiedeployingsection"><a class="anchor" href="#_kiedeployingsection"></a> <a class="link" href="#_kiedeployingsection">2.2.3。部署中</a></h4>
<div class="sect4">
<h5 id="_kiebase"><a class="anchor" href="#_kiebase"></a> <a class="link" href="#_kiebase">2.2.3.1。凯基</a></h5>
<div class="paragraph">
<p>的<code>KieBase</code>是所有应用程序知识定义的存储库。它将包含规则，流程，功能和类型模型。的<code>KieBase</code>本身不包含数据；而是从<code>KieBase</code>可以在其中插入数据以及可以从中启动流程实例。的<code>KieBase</code>可以从<code>KieContainer</code>包含<code>KieModule</code>在哪里<code>KieBase</code>已经定义。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieBase.png" alt="凯基">
</div>
<div class="title">图17。凯基</div>
</div>
<div class="paragraph">
<p>有时，例如在OSGi环境中， <code>KieBase</code>需要解析默认类加载器中没有的类型。在这种情况下，有必要创建一个<code>KieBaseConfiguration</code>用一个额外的类加载器，并将其传递给<code>KieContainer</code>当创建一个新的<code>KieBase</code>从中。</p>
</div>
<div class="exampleblock">
<div class="title">范例14。使用自定义的ClassLoader创建新的KieBase</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieBaseConfiguration kbaseConf = kieServices.newKieBaseConfiguration( null, MyType.class.getClassLoader() );
KieBase kbase = kieContainer.newKieBase( kbaseConf );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kiesessions_and_kiebase_modifications"><a class="anchor" href="#_kiesessions_and_kiebase_modifications"></a> <a class="link" href="#_kiesessions_and_kiebase_modifications">2.2.3.2。KieSession和KieBase修改</a></h5>
<div class="paragraph">
<p>KieSessions将在“运行”部分中详细讨论。的<code>KieBase</code>创建并返回<code>KieSession</code>对象，并且可以选择保留对这些对象的引用。什么时候<code>KieBase</code>会发生修改，这些修改将应用于会话中的数据。此引用是弱引用，也是可选的，由布尔标志控制。</p>
</div>
</div>
<div class="sect4">
<h5 id="_kiescanner"><a class="anchor" href="#_kiescanner"></a> <a class="link" href="#_kiescanner">2.2.3.3。KieScanner</a></h5>
<div class="paragraph">
<p>的<code>KieScanner</code>允许持续监视您的Maven存储库以检查是否已安装新版本的Kie项目。新版本已部署在<code>KieContainer</code>包装那个项目。使用<code>KieScanner</code>要求kie-ci.jar位于类路径上。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieScanner.png" alt="KieScanner">
</div>
<div class="title">图18。KieScanner</div>
</div>
<div class="paragraph">
<p>一种<code>KieScanner</code>可以在<code>KieContainer</code>如以下示例所示。</p>
</div>
<div class="exampleblock">
<div class="title">示例15在KieContainer上注册并启动KieScanner</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
ReleaseId releaseId = kieServices.newReleaseId( "org.acme", "myartifact", "1.0-SNAPSHOT" );
KieContainer kContainer = kieServices.newKieContainer( releaseId );
KieScanner kScanner = kieServices.newKieScanner( kContainer );

// Start the KieScanner polling the Maven repository every 10 seconds
kScanner.start( 10000L );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>在这个例子中<code>KieScanner</code>配置为以固定的时间间隔运行，但也可以通过调用以下命令按需运行<code>scanNow()</code>方法就可以了。如果<code>KieScanner</code>在Maven存储库中找到该用户使用的Kie项目的更新版本<code>KieContainer</code>它会自动下载新版本并触发新项目的增量构建。至此，现有<code>KieBase</code>和<code>KieSession</code>在的控制之下<code>KieContainer</code>将会自动升级-特别是那些<code>KieBase</code>由获得<code>getKieBase()</code>与他们相关<code>KieSession</code> s，以及任何<code>KieSession</code>直接获得<code>KieContainer.newKieSession()</code>因此参考默认<code>KieBase</code> 。此外，从现在开始，所有新<code>KieBase</code>和<code>KieSession</code>以此创建<code>KieContainer</code>将使用新的项目版本。请注意任何现有的<code>KieBase</code>通过以下方式获得<code>newKieBase()</code>在KieScanner升级之前，及其任何相关内容<code>KieSession</code> s，不会自动升级；这是因为<code>KieBase</code>通过获得<code>newKieBase()</code>不受...的直接控制<code>KieContainer</code> 。</p>
</div>
<div class="paragraph">
<p>的<code>KieScanner</code>仅当使用SNAPSHOT，版本范围，最新或发布设置时，才会提取对已部署jar的更改。固定版本不会在运行时自动更新。</p>
</div>
<div class="paragraph">
<p>如果您不想安装Maven存储库，也可以使用<code>KieScanner</code>只需从纯文件系统的文件夹中获取更新即可。您可以创建这样的<code>KieScanner</code>就像</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieScanner kScanner = kieServices.newKieScanner( kContainer, "/myrepo/kjars" );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>其中“ / myrepo / kjars”将是<code>KieScanner</code>将寻找kjar更新。放置在此文件夹中的jar文件必须遵循maven约定，然后必须是{artifactId}-{versionId} .jar形式的名称</p>
</div>
</div>
<div class="sect4">
<h5 id="_maven_versions_and_dependencies"><a class="anchor" href="#_maven_versions_and_dependencies"></a> <a class="link" href="#_maven_versions_and_dependencies">2.2.3.4。Maven版本和依赖项</a></h5>
<div class="paragraph">
<p>Maven支持多种机制来管理应用程序中的版本控制和依赖性。可以使用特定的版本号发布模块，也可以使用SNAPSHOT后缀。依赖项可以指定要使用的版本范围，也可以利用SNAPSHOT机制。</p>
</div>
<div class="paragraph">
<p>StackOverflow为此提供了一个很好的描述，下面转载。</p>
</div>
<div class="paragraph">
<p><a href="http://stackoverflow.com/questions/30571/how-do-i-tell-maven-to-use-the-latest-version-of-a-dependency">http://stackoverflow.com/questions/30571/how-do-i-tell-maven-to-use-the-latest-version-of-a-dependency</a></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">由于Maven 3.x的版本转换不再支持RELEASE和LATEST，因此是可复制的版本。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>有关更多详细信息，请参见Maven书籍的POM语法部分。</p>
</div>
<div class="paragraph">
<p><a href="http://books.sonatype.com/mvnref-book/reference/pom-relationships-sect-pom-syntax.html">http://books.sonatype.com/mvnref-book/reference/pom-relationships-sect-pom-syntax.html</a></p>
</div>
<div class="paragraph">
<p><a href="http://books.sonatype.com/mvnref-book/reference/pom-relationships-sect-project-dependencies.html" class="bare">http://books.sonatype.com/mvnref-book/reference/pom-relationships-sect-project-dependencies.html</a></p>
</div>
<div class="paragraph">
<p>这是说明各种选项的示例。在Maven存储库中，com.foo:my-foo具有以下元数据：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;metadata&gt;
  &lt;groupId&gt;com.foo&lt;/groupId&gt;
  &lt;artifactId&gt;my-foo&lt;/artifactId&gt;
  &lt;version&gt;2.0.0&lt;/version&gt;
  &lt;versioning&gt;
    &lt;release&gt;1.1.1&lt;/release&gt;
    &lt;versions&gt;
      &lt;version&gt;1.0&lt;/version&gt;
      &lt;version&gt;1.0.1&lt;/version&gt;
      &lt;version&gt;1.1&lt;/version&gt;
      &lt;version&gt;1.1.1&lt;/version&gt;
      &lt;version&gt;2.0.0&lt;/version&gt;
    &lt;/versions&gt;
    &lt;lastUpdated&gt;20090722140000&lt;/lastUpdated&gt;
  &lt;/versioning&gt;
&lt;/metadata&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果需要依赖该工件，则可以使用以下选项（当然可以指定其他版本范围，只在此处显示相关的版本）：声明一个确切的版本（将始终解析为1.0.1）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;version&gt;[1.0.1]&lt;/version&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Declare an explicit version (will always resolve to 1.0.1 unless a collision occurs, when Maven will select a matching version):</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;version&gt;1.0.1&lt;/version&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Declare a version range for all 1.x (will currently resolve to 1.1.1):</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;version&gt;[1.0.0,2.0.0)&lt;/version&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Declare an open-ended version range (will resolve to 2.0.0):</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;version&gt;[1.0.0,)&lt;/version&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Declare the version as LATEST (will resolve to 2.0.0):</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;version&gt;LATEST&lt;/version&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Declare the version as RELEASE (will resolve to 1.1.1):</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;version&gt;RELEASE&lt;/version&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，默认情况下，您自己的部署将更新Maven元数据中的“最新”条目，但是要更新“发布”条目，则需要从Maven超级POM激活“发布配置文件”。您可以使用“ -Prelease-profile”或“ -DperformRelease = true”来执行此操作</p>
</div>
</div>
<div class="sect4">
<h5 id="_settings_xml_and_remote_repository_setup"><a class="anchor" href="#_settings_xml_and_remote_repository_setup"></a> <a class="link" href="#_settings_xml_and_remote_repository_setup">2.2.3.5。Settings.xml和远程存储库设置</a></h5>
<div class="paragraph">
<p>maven settings.xml用于配置Maven执行。可以在Maven网站上找到详细说明：</p>
</div>
<div class="paragraph">
<p><a href="http://maven.apache.org/settings.html" class="bare">http://maven.apache.org/settings.html</a></p>
</div>
<div class="paragraph">
<p>settings.xml文件可以位于3个位置，实际使用的设置是这3个位置的合并。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven安装：<code>$M2_HOME/conf/settings.xml</code></p>
</li>
<li>
<p>用户的安装：<code>${user.home}/.m2/settings.xml</code></p>
</li>
<li>
<p>系统属性指定的文件夹位置<code>kie.maven.settings.custom</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>settings.xml用于指定远程存储库的位置。激活指定远程存储库的配置文件很重要，通常可以使用“ activeByDefault”完成此操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;profiles&gt;
  &lt;profile&gt;
    &lt;id&gt;profile-1&lt;/id&gt;
    &lt;activation&gt;
      &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
    &lt;/activation&gt;
    ...
  &lt;/profile&gt;
&lt;/profiles&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Maven提供有关使用多个远程存储库的详细文档：</p>
</div>
<div class="paragraph">
<p><a href="http://maven.apache.org/guides/mini/guide-multiple-repositories.html" class="bare">http://maven.apache.org/guides/mini/guide-multiple-repositories.html</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kierunningsection"><a class="anchor" href="#_kierunningsection"></a> <a class="link" href="#_kierunningsection">2.2.4。跑步</a></h4>
<div class="sect4">
<h5 id="_kiebase_2"><a class="anchor" href="#_kiebase_2"></a> <a class="link" href="#_kiebase_2">2.2.4.1。凯基</a></h5>
<div class="paragraph">
<p>的<code>KieBase</code>是所有应用程序知识定义的存储库。它将包含规则，流程，功能和类型模型。的<code>KieBase</code>本身不包含数据；而是从<code>KieBase</code>可以在其中插入数据以及可以从中启动流程实例。的<code>KieBase</code>可以从<code>KieContainer</code>包含<code>KieModule</code>在哪里<code>KieBase</code>已经定义。</p>
</div>
<div class="exampleblock">
<div class="title">示例16。从KieContainer获取KieBase</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieBase kBase = kContainer.getKieBase();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kiesession"><a class="anchor" href="#_kiesession"></a> <a class="link" href="#_kiesession">2.2.4.2。KieSession</a></h5>
<div class="paragraph">
<p>的<code>KieSession</code>存储并在运行时数据上执行。它是从<code>KieBase</code> 。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieSession.png" alt="KieSession">
</div>
<div class="title">图19。KieSession</div>
</div>
<div class="exampleblock">
<div class="title">示例17从KieBase创建一个KieSession</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession ksession = kbase.newKieSession();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kieruntime"><a class="anchor" href="#_kieruntime"></a> <a class="link" href="#_kieruntime">2.2.4.3。KieRuntime</a></h5>
<div class="sect5">
<h6 id="_kieruntime_2"><a class="anchor" href="#_kieruntime_2"></a> <a class="link" href="#_kieruntime_2">KieRuntime</a></h6>
<div class="paragraph">
<p>的<code>KieRuntime</code>提供适用于规则和过程的方法，例如设置全局变量和注册通道。（“出口点”是“渠道”的过时同义词。）</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieRuntime.png" alt="KieRuntime">
</div>
<div class="title">图20。KieRuntime</div>
</div>
<div class="sect6">
<h7 id="_globals"><a class="anchor" href="#_globals"></a> <a class="link" href="#_globals">全球</a></h7>
<div class="paragraph">
<p>全局变量被命名为对Drools引擎可见的对象，但是在某种程度上不同于事实：在支持全局变量的对象中进行更改不会触发规则的重新评估。尽管如此，全局变量对于提供静态信息还是有用的，它可以作为对象提供规则的RHS中使用的服务，也可以作为从Drools引擎返回对象的手段。在规则的LHS上使用全局时，请确保它是不可变的，或者至少不要期望更改对规则的行为有任何影响。</p>
</div>
<div class="paragraph">
<p>必须在规则文件中声明全局变量，然后需要使用Java对象对其进行备份。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>global java.util.List list</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在，借助KIE基础了解全局标识符及其类型，现在可以调用<code>ksession.setGlobal()</code>与全局名称和一个对象（对于任何会话），以将该对象与全局关联。如果未在DRL代码中声明全局类型和标识符，则将导致此调用引发异常。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;String&gt; list = new ArrayList&lt;&gt;();
ksession.setGlobal("list", list);</code></pre>
</div>
</div>
<div class="paragraph">
<p>在评估规则之前，请确保先设置任何全局变量。否则会导致<code>NullPointerException</code> 。</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_event_model"><a class="anchor" href="#_event_model"></a> <a class="link" href="#_event_model">2.2.4.4。事件模型</a></h5>
<div class="paragraph">
<p>事件包提供了通知Drools引擎事件的方法，包括规则触发，声明的对象等。这允许将日志记录和审核活动与应用程序的主要部分（以及规则）分开。</p>
</div>
<div class="paragraph">
<p>的<code>KieRuntimeEventManager</code>接口由<code>KieRuntime</code>它提供了两个接口， <code>RuleRuntimeEventManager</code>和<code>ProcessEventManager</code> 。我们将只涵盖<code>RuleRuntimeEventManager</code>这里。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieRuntimeEventManager.png" alt="KieRuntimeEventManager">
</div>
<div class="title">图21。KieRuntimeEventManager</div>
</div>
<div class="paragraph">
<p>的<code>RuleRuntimeEventManager</code>允许添加和删除侦听器，以便可以侦听工作内存和议程的事件。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/RuleRuntimeEventManager.png" alt="RuleRuntimeEventManager">
</div>
<div class="title">图22。RuleRuntimeEventManager</div>
</div>
<div class="paragraph">
<p>以下代码段显示了如何声明简单的议程侦听器并将其附加到会话。射击后将打印火柴。</p>
</div>
<div class="exampleblock">
<div class="title">示例18添加一个AgendaEventListener</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.addEventListener( new DefaultAgendaEventListener() {
    public void afterMatchFired(AfterMatchFiredEvent event) {
        super.afterMatchFired( event );
        System.out.println( event );
    }
});</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>流口水还提供<code>DebugRuleRuntimeEventListener</code>和<code>DebugAgendaEventListener</code>使用调试打印语句实现每种方法。要打印所有工作内存事件，请添加一个侦听器，如下所示：</p>
</div>
<div class="exampleblock">
<div class="title">示例19添加一个DebugRuleRuntimeEventListener</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.addEventListener( new DebugRuleRuntimeEventListener() );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>所有发出的事件都实现了<code>KieRuntimeEvent</code>可以用来检索实际的接口<code>KnowlegeRuntime</code>事件起源。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieRuntimeEvent.png" alt="KieRuntimeEvent">
</div>
<div class="title">图23。KieRuntimeEvent</div>
</div>
<div class="paragraph">
<p>当前支持的事件是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MatchCreatedEvent</p>
</li>
<li>
<p>MatchCancelledEvent</p>
</li>
<li>
<p>BeforeMatchFiredEvent</p>
</li>
<li>
<p>AfterMatchFiredEvent</p>
</li>
<li>
<p>AgendaGroupPushedEvent</p>
</li>
<li>
<p>AgendaGroupPoppedEvent</p>
</li>
<li>
<p>ObjectInsertEvent</p>
</li>
<li>
<p>ObjectDeletedEvent</p>
</li>
<li>
<p>ObjectUpdatedEvent</p>
</li>
<li>
<p>ProcessCompletedEvent</p>
</li>
<li>
<p>ProcessNodeLeftEvent</p>
</li>
<li>
<p>ProcessNodeTriggeredEvent</p>
</li>
<li>
<p>ProcessStartEvent</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_kieruntimelogger"><a class="anchor" href="#_kieruntimelogger"></a> <a class="link" href="#_kieruntimelogger">2.2.4.5。KieRuntimeLogger</a></h5>
<div class="paragraph">
<p>KieRuntimeLogger使用Drools中的综合事件系统来创建审核日志，该日志可以使用Eclipse审核查看器等工具记录应用程序的执行情况，以供以后检查。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieLoggers.png" alt="记录仪">
</div>
<div class="title">图24。记录仪</div>
</div>
<div class="exampleblock">
<div class="title">示例20文件记录器</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieRuntimeLogger logger =
  KieServices.Factory.get().getLoggers().newFileLogger(ksession, "logdir/mylogfile");
...
logger.close();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_commands_and_the_commandexecutor"><a class="anchor" href="#_commands_and_the_commandexecutor"></a> <a class="link" href="#_commands_and_the_commandexecutor">2.2.4.6。命令和CommandExecutor</a></h5>
<div class="paragraph">
<p>KIE具有状态会话或无状态会话的概念。已经讨论了使用标准KieRuntime的有状态会话，并且可以随着时间的推移反复使用它们。无状态是使用提供的数据集一次性执行KieRuntime。它可能会返回一些结果，而会话将被置于末尾，从而禁止进一步的迭代交互。您可以将无状态视为将引擎视为具有可选返回结果的函数调用。</p>
</div>
<div class="paragraph">
<p>其基础是<code>CommandExecutor</code>接口，有状态接口和无状态接口都将对其进行扩展。这返回一个<code>ExecutionResults</code> ：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/CommandExecutor.png" alt="CommandExecutor">
</div>
<div class="title">图25。CommandExecutor</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/ExecutionResults.png" alt="执行结果">
</div>
<div class="title">图26。执行结果</div>
</div>
<div class="paragraph">
<p>的<code>CommandExecutor</code>允许在这些会话上执行命令，唯一的不同是StatelessKieSession执行<code>fireAllRules()</code>最后，在安排会议之前。可以使用以下命令创建命令<code>CommandExecutor</code> 。Javadocs使用来提供允许的命令的完整列表。 <code>CommandExecutor</code> 。</p>
</div>
<div class="paragraph">
<p>setGlobal和getGlobal是与Drools和jBPM相关的两个命令。</p>
</div>
<div class="paragraph">
<p>Set Global在下面调用setGlobal。可选的布尔值指示命令是否应将全局值返回为<code>ExecutionResults</code> 。如果为true，则使用与全局名称相同的名称。如果需要备用名称，则可以使用字符串代替布尔值。</p>
</div>
<div class="exampleblock">
<div class="title">示例21设置全局命令</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();
ExecutionResults bresults =
    ksession.execute( CommandFactory.newSetGlobal( "stilton", new Cheese( "stilton" ), true);
Cheese stilton = bresults.getValue( "stilton" );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>允许返回现有的全局变量。第二个可选的String参数允许使用其他返回名称。</p>
</div>
<div class="exampleblock">
<div class="title">示例22获取全局命令</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();
ExecutionResults bresults =
    ksession.execute( CommandFactory.getGlobal( "stilton" );
Cheese stilton = bresults.getValue( "stilton" );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>以上所有示例均执行单个命令。的<code>BatchExecution</code>表示从命令列表创建的复合命令。它将遍历列表并依次执行每个命令。这意味着您可以插入一个对象，启动一个流程，调用fireAllRules并执行一个查询<code>execute(…​)</code>通话，功能非常强大。</p>
</div>
<div class="paragraph">
<p>StatelessKieSession将执行<code>fireAllRules()</code>自动结束。但是，敏锐的读者可能已经注意到<code>FireAllRules</code>命令，并想知道如何与StatelessKieSession一起使用。的<code>FireAllRules</code>命令是允许的，使用它会在最后禁用自动执行；考虑将其用作一种手动替代功能。</p>
</div>
<div class="paragraph">
<p>批处理中设置了out标识符的任何命令都将其结果添加到返回的命令中<code>ExecutionResults</code>实例。让我们看一个简单的例子，看看它是如何工作的。为了说明起见，给出的示例包括来自Drools和jBPM的命令。在Drool和jBPM特定部分中将更详细地介绍它们。</p>
</div>
<div class="exampleblock">
<div class="title">示例23BatchExecution命令</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();

List cmds = new ArrayList();
cmds.add( CommandFactory.newInsertObject( new Cheese( "stilton", 1), "stilton") );
cmds.add( CommandFactory.newStartProcess( "process cheeses" ) );
cmds.add( CommandFactory.newQuery( "cheeses" ) );
ExecutionResults bresults = ksession.execute( CommandFactory.newBatchExecution( cmds ) );
Cheese stilton = ( Cheese ) bresults.getValue( "stilton" );
QueryResults qresults = ( QueryResults ) bresults.getValue( "cheeses" );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>在上面的示例中，执行了多个命令，其中两个填充了<code>ExecutionResults</code> 。默认情况下，查询命令使用与查询名称相同的标识符，但是也可以将其映射到其他标识符。</p>
</div>
<div class="paragraph">
<p>所有命令都支持使用XStream进行XML和JSON封送以及JAXB封送。这在<a href="#_ch.commands">Drools命令中有介绍</a> 。</p>
</div>
</div>
<div class="sect4">
<h5 id="_statelesskiesession"><a class="anchor" href="#_statelesskiesession"></a> <a class="link" href="#_statelesskiesession">2.2.4.7。StatelessKieSession</a></h5>
<div class="paragraph">
<p>的<code>StatelessKieSession</code>包装<code>KieSession</code> ，而不是扩展它。它的主要重点是决策服务类型方案。它避免了打电话的需要<code>dispose()</code> 。无状态会话不支持迭代插入和方法调用<code>fireAllRules()</code>来自Java代码；打电话的行为<code>execute()</code>是单次使用的方法，将在内部实例化一个<code>KieSession</code> ，添加所有用户数据并执行用户命令，然后调用<code>fireAllRules()</code> ，然后致电<code>dispose()</code> 。虽然使用此类的主要方法是通过<code>BatchExecution</code> （的子接口<code>Command</code> ）（由<code>CommandExecutor</code>接口，当需要简单的对象插入时，提供了两种便捷的方法。的<code>CommandExecutor</code>和<code>BatchExecution</code>在各自的部分中进行了详细讨论。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/StatelessKieSession.png" alt="StatelessKieSession">
</div>
<div class="title">图27。StatelessKieSession</div>
</div>
<div class="paragraph">
<p>我们的简单示例显示了使用便捷API执行给定Java对象集合的无状态会话。它将迭代集合，依次插入每个元素。</p>
</div>
<div class="exampleblock">
<div class="title">示例24带有集合的简单StatelessKieSession执行</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();
ksession.execute( collection );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>如果将其作为单个命令完成，则将如下所示：</p>
</div>
<div class="exampleblock">
<div class="title">示例25使用InsertElements命令简单执行StatelessKieSession</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.execute( CommandFactory.newInsertElements( collection ) );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>如果要插入集合本身以及集合的各个元素，则<code>CommandFactory.newInsert(collection)</code>会做的工作。</p>
</div>
<div class="paragraph">
<p>方法<code>CommandFactory</code>创建受支持的命令，所有命令都可以使用XStream和<code>BatchExecutionHelper</code> 。 <code>BatchExecutionHelper</code>提供有关XML格式的详细信息，以及如何使用Drools Pipeline自动整理<code>BatchExecution</code>和<code>ExecutionResults</code> 。</p>
</div>
<div class="paragraph">
<p><code>StatelessKieSession</code>支持全局变量，范围有很多种。我们首先介绍非命令方式，因为命令的作用域是特定的执行调用。全局变量可以通过三种方式解决。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>StatelessKieSession方法<code>getGlobals()</code>返回一个Globals实例，该实例提供对会话的Globals的访问。这些用于<em>所有</em>执行调用。请注意有关可变全局变量的注意事项，因为执行调用可以在不同线程中同时执行。</p>
<div class="exampleblock">
<div class="title">示例26。全球范围的会议</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();
// Set a global hbnSession, that can be used for DB interactions in the rules.
ksession.setGlobal( "hbnSession", hibernateSession );
// Execute while being able to resolve the "hbnSession" identifier.
ksession.execute( collection );</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>使用委托是全局解决的另一种方法。为全局值分配<code>setGlobal(String, Object)</code> ）导致值存储在内部集合中，这些标识符将标识符映射到值。此内部集合中的标识符将优先于任何提供的委托。仅当在此内部集合中找不到标识符时，才使用全局委托（如果有）。</p>
</li>
<li>
<p>解决全局变量的第三种方法是使执行范围全局变量。在这里<code>Command</code>设置全局传递给<code>CommandExecutor</code> 。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>的<code>CommandExecutor</code>界面还提供了通过“输出”参数导出数据的功能。插入的事实，全局变量和查询结果都可以返回。</p>
</div>
<div class="exampleblock">
<div class="title">示例27输出标识符</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Set up a list of commands
List cmds = new ArrayList();
cmds.add( CommandFactory.newSetGlobal( "list1", new ArrayList(), true ) );
cmds.add( CommandFactory.newInsert( new Person( "jon", 102 ), "person" ) );
cmds.add( CommandFactory.newQuery( "Get People", "getPeople" ) );

// Execute the list
ExecutionResults results =
  ksession.execute( CommandFactory.newBatchExecution( cmds ) );

// Retrieve the ArrayList
results.getValue( "list1" );
// Retrieve the inserted Person fact
results.getValue( "person" );
// Retrieve the query as a QueryResults instance.
results.getValue( "Get People" );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_marshalling"><a class="anchor" href="#_marshalling"></a> <a class="link" href="#_marshalling">2.2.4.8。编组</a></h5>
<div class="paragraph">
<p>的<code>KieMarshallers</code>用于编组和取消编组KieSessions。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/KieMarshallers.png" alt="基·马歇尔">
</div>
<div class="title">图28。基·马歇尔</div>
</div>
<div class="paragraph">
<p>的实例<code>KieMarshallers</code>可以从<code>KieServices</code> 。下面是一个简单的示例：</p>
</div>
<div class="exampleblock">
<div class="title">示例28。简单的Marshaller示例</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// ksession is the KieSession
// kbase is the KieBase
ByteArrayOutputStream baos = new ByteArrayOutputStream();
Marshaller marshaller = KieServices.Factory.get().getMarshallers().newMarshaller( kbase );
marshaller.marshall( baos, ksession );
baos.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>但是，通过编组，在处理引用的用户数据时将需要更大的灵活性。为此，请使用<code>ObjectMarshallingStrategy</code>接口。提供了两种实现，但用户可以实现自己的实现。提供的两种策略是<code>IdentityMarshallingStrategy</code>和<code>SerializeMarshallingStrategy</code> 。 <code>SerializeMarshallingStrategy</code>是默认值，如上面的示例所示，它只是调用<code>Serializable</code>要么<code>Externalizable</code>用户实例上的方法。 <code>IdentityMarshallingStrategy</code>为每个用户对象创建一个整数ID，并将其存储在Map中，同时将ID写入流中。当解组时，它访问<code>IdentityMarshallingStrategy</code>映射以检索实例。这意味着如果您使用<code>IdentityMarshallingStrategy</code> ，它在Marshaller实例的生命期内是有状态的，并将创建ID并保留对其尝试编组的所有对象的引用。以下是使用身份编组策略的代码。</p>
</div>
<div class="exampleblock">
<div class="title">示例29。身份编组策略</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ByteArrayOutputStream baos = new ByteArrayOutputStream();
KieMarshallers kMarshallers = KieServices.Factory.get().getMarshallers()
ObjectMarshallingStrategy oms = kMarshallers.newIdentityMarshallingStrategy()
Marshaller marshaller =
        kMarshallers.newMarshaller( kbase, new ObjectMarshallingStrategy[]{ oms } );
marshaller.marshall( baos, ksession );
baos.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>在大多数情况下，单一策略是不够的。为了增加灵活性， <code>ObjectMarshallingStrategyAcceptor</code>可以使用接口。该编组器具有一系列策略，并且在读取或写入用户对象时会迭代这些策略，询问它们是否承担编组用户对象的责任。提供的实现之一是<code>ClassFilterAcceptor</code> 。这允许使用字符串和通配符来匹配类名。默认值为“ <strong>。</strong> ”，因此在上面的示例中，使用的身份编组策略具有默认的“ <strong>。</strong> ”接受器。</p>
</div>
<div class="paragraph">
<p>假设我们要序列化除一个给定包以外的所有类，在该包中将使用身份查找，我们可以执行以下操作：</p>
</div>
<div class="exampleblock">
<div class="title">示例30与接受者的身份编组策略</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ByteArrayOutputStream baos = new ByteArrayOutputStream();
KieMarshallers kMarshallers = KieServices.Factory.get().getMarshallers()
ObjectMarshallingStrategyAcceptor identityAcceptor =
        kMarshallers.newClassFilterAcceptor( new String[] { "org.domain.pkg1.*" } );
ObjectMarshallingStrategy identityStrategy =
        kMarshallers.newIdentityMarshallingStrategy( identityAcceptor );
ObjectMarshallingStrategy sms = kMarshallers.newSerializeMarshallingStrategy();
Marshaller marshaller =
        kMarshallers.newMarshaller( kbase,
                                    new ObjectMarshallingStrategy[]{ identityStrategy, sms } );
marshaller.marshall( baos, ksession );
baos.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>请注意，验收检查的顺序是所提供元素的自然顺序。</p>
</div>
</div>
<div class="sect4">
<h5 id="_persistence_and_transactions"><a class="anchor" href="#_persistence_and_transactions"></a> <a class="link" href="#_persistence_and_transactions">2.2.4.9。持久性和交易</a></h5>
<div class="paragraph">
<p>Drools可以实现Java Persistence API（JPA）的长期开箱即用的持久性。必须安装Java事务API（JTA）的某些实现。出于开发目的，建议使用Bitronix事务管理器，因为它易于安装并可以嵌入，但是建议在生产中使用JBoss Transactions。</p>
</div>
<div class="exampleblock">
<div class="title">示例31。使用交易的简单示例</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
Environment env = kieServices.newEnvironment();
env.set( EnvironmentName.ENTITY_MANAGER_FACTORY,
         Persistence.createEntityManagerFactory( "emf-name" ) );
env.set( EnvironmentName.TRANSACTION_MANAGER,
         TransactionManagerServices.getTransactionManager() );

// KieSessionConfiguration may be null, and a default will be used
KieSession ksession =
        kieServices.getStoreServices().newKieSession( kbase, null, env );
int sessionId = ksession.getId();

UserTransaction ut =
  (UserTransaction) new InitialContext().lookup( "java:comp/UserTransaction" );
ut.begin();
ksession.insert( data1 );
ksession.insert( data2 );
ksession.startProcess( "process1" );
ut.commit();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>要使用JPA，必须同时设置环境<code>EntityManagerFactory</code>和<code>TransactionManager</code> 。如果发生回滚，则ksession状态也会回滚，因此可以在回滚后继续使用它。要加载以前持久保存的KieSession，您将需要ID，如下所示：</p>
</div>
<div class="exampleblock">
<div class="title">示例32加载一个KieSession</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession ksession =
        kieServices.getStoreServices().loadKieSession( sessionId, kbase, null, env );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>要启用持久性，必须将几个类添加到persistence.xml中，如下例所示：</p>
</div>
<div class="exampleblock">
<div class="title">例子33。配置JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;persistence-unit name="org.drools.persistence.jpa" transaction-type="JTA"&gt;
   &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;
   &lt;jta-data-source&gt;jdbc/BitronixJTADataSource&lt;/jta-data-source&gt;
   &lt;class&gt;org.drools.persistence.info.SessionInfo&lt;/class&gt;
   &lt;class&gt;org.drools.persistence.info.WorkItemInfo&lt;/class&gt;
   &lt;properties&gt;
         &lt;property name="hibernate.dialect" value="org.hibernate.dialect.H2Dialect"/&gt;
         &lt;property name="hibernate.max_fetch_depth" value="3"/&gt;
         &lt;property name="hibernate.hbm2ddl.auto" value="update" /&gt;
         &lt;property name="hibernate.show_sql" value="true" /&gt;
         &lt;property name="hibernate.transaction.manager_lookup_class"
                      value="org.hibernate.transaction.BTMTransactionManagerLookup" /&gt;
   &lt;/properties&gt;
&lt;/persistence-unit&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>必须首先配置jdbc JTA数据源。Bitronix提供了许多方法来执行此操作，有关详细信息，请查阅其文档。为了快速入门，以下是编程方法：</p>
</div>
<div class="exampleblock">
<div class="title">示例34配置JTA数据源</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">PoolingDataSource ds = new PoolingDataSource();
ds.setUniqueName( "jdbc/BitronixJTADataSource" );
ds.setClassName( "org.h2.jdbcx.JdbcDataSource" );
ds.setMaxPoolSize( 3 );
ds.setAllowLocalTransactions( true );
ds.getDriverProperties().put( "user", "sa" );
ds.getDriverProperties().put( "password", "sasa" );
ds.getDriverProperties().put( "URL", "jdbc:h2:mem:mydb" );
ds.init();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Bitronix还提供简单的嵌入式JNDI服务，非常适合测试。要使用它，请将jndi.properties文件添加到您的META-INF文件夹，并向其中添加以下行：</p>
</div>
<div class="exampleblock">
<div class="title">示例35JNDI属性</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>java.naming.factory.initial=bitronix.tm.jndi.BitronixInitialContextFactory</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiedeploycheatsheets"><a class="anchor" href="#_kiedeploycheatsheets"></a> <a class="link" href="#_kiedeploycheatsheets">2.2.5。安装和部署备忘单</a></h4>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/cheatsheet1.png" alt="备忘单1">
</div>
<div class="title">图29。安装概述</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/BuildDeployUtilizeAndRun/cheatsheet2.png" alt="备忘单2">
</div>
<div class="title">图30。部署概述</div>
</div>
</div>
<div class="sect3">
<h4 id="_kieexamplessection"><a class="anchor" href="#_kieexamplessection"></a> <a class="link" href="#_kieexamplessection">2.2.6。构建，部署和利用示例</a></h4>
<div class="paragraph">
<p>学习新的构建系统的最佳方法是通过示例。源项目“ drools-examples-api”包含许多示例，可以在GitHub上找到：</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/kiegroup/drools/tree/6.0.x/drools-examples-api" class="bare">https://github.com/kiegroup/drools/tree/6.0.x/drools-examples-api</a></p>
</div>
<div class="paragraph">
<p>每个示例如下所述，顺序从最简单的开始（大多数选项都是默认选项），然后逐步扩展到更复杂的用例。</p>
</div>
<div class="paragraph">
<p>下面显示的Deploy用例都涉及<code>mvn install</code> 。Maven文献充分介绍了在Maven中进行JAR的远程部署。利用是指加载资源并提供对KIE运行时的访问的初始操作。而运行是指与这些运行时进行交互的行为。</p>
</div>
<div class="sect4">
<h5 id="_default_kiesession"><a class="anchor" href="#_default_kiesession"></a> <a class="link" href="#_default_kiesession">2.2.6.1。默认KieSession</a></h5>
<div class="ulist">
<ul>
<li>
<p>项目：default-kesession。</p>
</li>
<li>
<p>摘要：类路径上的空kmodule.xml KieModule包含单个默认KieBase中的所有资源。该示例显示了从类路径中检索默认的KieSession。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>空的kmodule.xml将产生一个单一的KieBase，其中包括在资源路径下找到的所有文件，例如DRL，BPMN2，XLS等。该单一的KieBase是默认的，并且还包含一个默认的KieSession。默认表示可以在不知道其名称的情况下创建它们。</p>
</div>
<div class="exampleblock">
<div class="title">示例36。作者-kmodule.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"&gt; &lt;/kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">示例37。构建和安装-Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>ks.getKieClasspathContainer（）返回包含部署到环境类路径上的KieBase的KieContainer。kContainer.newKieSession（）创建默认的KieSession。注意，您不再需要查找KieBase即可创建KieSession。KieSession知道它与哪个KieBase关联，并使用它，在这种情况下，它是默认的KieBase。</p>
</div>
<div class="exampleblock">
<div class="title">示例38。使用并运行-Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.getKieClasspathContainer();

KieSession kSession = kContainer.newKieSession();
kSession.setGlobal("out", out);
kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_named_kiesession"><a class="anchor" href="#_named_kiesession"></a> <a class="link" href="#_named_kiesession">2.2.6.2。名为KieSession</a></h5>
<div class="ulist">
<ul>
<li>
<p>项目：命名为kiesession。</p>
</li>
<li>
<p>简介：kmodule.xml具有一个名为KieBase的名称和一个名为KieSession的名称。这些示例显示了从类路径中检索命名的KieSession。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>kmodule.xml将产生一个名为KieBase的单一名称，即“ kbase1”，其中包括在资源路径下找到的所有文件，无论是DRL，BPMN2，XLS等。KieSession“ ksession1”与该KieBase相关联，可以通过名称创建。</p>
</div>
<div class="exampleblock">
<div class="title">示例39。作者-kmodule.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"&gt;
    &lt;kbase name="kbase1"&gt;
        &lt;ksession name="ksession1"/&gt;
    &lt;/kbase&gt;
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">示例40构建和安装-Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>ks.getKieClasspathContainer（）返回包含部署到环境类路径上的KieBase的KieContainer。这次，KieSession使用名称“ ksession1”。您无需先查找KieBase，因为它知道与哪个KieBase'ksession1'关联。</p>
</div>
<div class="exampleblock">
<div class="title">示例41。使用并运行-Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.getKieClasspathContainer();

KieSession kSession = kContainer.newKieSession("ksession1");
kSession.setGlobal("out", out);
kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kiebase_inheritance"><a class="anchor" href="#_kiebase_inheritance"></a> <a class="link" href="#_kiebase_inheritance">2.2.6.3。KieBase继承</a></h5>
<div class="ulist">
<ul>
<li>
<p>项目：kiebase-inclusion。</p>
</li>
<li>
<p>简介：“ kmodule.xml”演示了一个KieBase可以包含来自另一个KieBase，另一个KieModule的资源。在这种情况下，它从'name-kiesession'示例继承了命名的KieBase。包含的KieBase可以来自当前的KieModule或pom.xml依赖项列表中的任何其他KieModule。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>kmodule.xml将产生一个名为KieBase的名称，即“ kbase2”，其中包括在资源路径下找到的所有文件，例如DRL，BPMN2，XLS等。此外，由于使用的原因，它将包括从KieBase“ kbase1”中找到的所有资源。 “包含”属性的名称。KieSession'ksession2'与该KieBase相关联，可以通过名称创建。</p>
</div>
<div class="exampleblock">
<div class="title">示例42。作者-kmodule.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kbase name="kbase2" includes="kbase1"&gt;
    &lt;ksession name="ksession2"/&gt;
&lt;/kbase&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>此示例要求首先构建先前的示例“ named-kiesession”，并将其安装到本地Maven存储库。安装后，可以使用标准Maven <dependencies>元素</dependencies>将其作为依赖项包含在内<dependencies>。</dependencies></p>
</div>
<div class="exampleblock">
<div class="title">例子43。作者-pom.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;parent&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-examples-api&lt;/artifactId&gt;
    &lt;version&gt;6.0.0/version&gt;
  &lt;/parent&gt;

  &lt;artifactId&gt;kiebase-inclusion&lt;/artifactId&gt;
  &lt;name&gt;Drools API examples - KieBase Inclusion&lt;/name&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.drools&lt;/groupId&gt;
      &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.drools&lt;/groupId&gt;
      &lt;artifactId&gt;named-kiesession&lt;/artifactId&gt;
      &lt;version&gt;6.0.0&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

&lt;/project&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>一旦构建并安装了“ named-kiesession”，就可以正常构建和安装此示例。同样，安装过程将迫使单元测试运行，演示用例。</p>
</div>
<div class="exampleblock">
<div class="title">例子44。构建和安装-Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>ks.getKieClasspathContainer（）返回包含部署到环境类路径上的KieBase的KieContainer。这次，KieSession使用名称“ ksession2”。您无需先查找KieBase，因为它知道与哪个KieBase'ksession1'关联。请注意，这次触发了两个规则，表明KieBase'kbase2'已包含依赖项KieBase'kbase1'的资源。</p>
</div>
<div class="exampleblock">
<div class="title">示例45使用并运行-Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.getKieClasspathContainer();
KieSession kSession = kContainer.newKieSession("ksession2");
kSession.setGlobal("out", out);

kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
kSession.fireAllRules();

kSession.insert(new Message("Dave", "Open the pod bay doors, HAL."));
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_multiple_kiebases"><a class="anchor" href="#_multiple_kiebases"></a> <a class="link" href="#_multiple_kiebases">2.2.6.4。多个KieBase</a></h5>
<div class="ulist">
<ul>
<li>
<p>专案：'multiple-kbases。</p>
</li>
<li>
<p>摘要：演示'kmodule.xml'可以包含任意数量的KieBase或KieSession声明。引入“包”属性以选择要包含在KieBase中的资源的文件夹。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>kmodule.xml产生6个不同的命名KieBases。“ kbase1”包括来自KieModule的所有资源。其他KieBase通过“ packages”属性包括来自其他选定文件夹的资源。请注意使用通配符“ *”来选择此软件包及其下面的所有软件包。</p>
</div>
<div class="exampleblock">
<div class="title">示例46。作者-kmodule.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"&gt;

  &lt;kbase name="kbase1"&gt;
    &lt;ksession name="ksession1"/&gt;
  &lt;/kbase&gt;

  &lt;kbase name="kbase2" packages="org.some.pkg"&gt;
    &lt;ksession name="ksession2"/&gt;
  &lt;/kbase&gt;

  &lt;kbase name="kbase3" includes="kbase2" packages="org.some.pkg2"&gt;
    &lt;ksession name="ksession3"/&gt;
  &lt;/kbase&gt;

  &lt;kbase name="kbase4" packages="org.some.pkg, org.other.pkg"&gt;
    &lt;ksession name="ksession4"/&gt;
  &lt;/kbase&gt;

  &lt;kbase name="kbase5" packages="org.*"&gt;
    &lt;ksession name="ksession5"/&gt;
  &lt;/kbase&gt;

  &lt;kbase name="kbase6" packages="org.some.*"&gt;
    &lt;ksession name="ksession6"/&gt;
  &lt;/kbase&gt;
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">示例47构建和安装-Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>下面仅包含示例的一部分，因为每个KieSession都有一种测试方法，但每个示例都是另一个的重复，具有不同的列表期望。</p>
</div>
<div class="exampleblock">
<div class="title">示例48使用并运行-Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
public void testSimpleKieBase() {
    List&lt;Integer&gt; list = useKieSession("ksession1");
    // no packages imported means import everything
    assertEquals(4, list.size());
    assertTrue( list.containsAll( asList(0, 1, 2, 3) ) );
}

//.. other tests for ksession2 to ksession6 here

private List&lt;Integer&gt; useKieSession(String name) {
    KieServices ks = KieServices.Factory.get();
    KieContainer kContainer = ks.getKieClasspathContainer();
    KieSession kSession = kContainer.newKieSession(name);

    List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;();
    kSession.setGlobal("list", list);
    kSession.insert(1);
    kSession.fireAllRules();

    return list;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kiecontainer_from_kierepository"><a class="anchor" href="#_kiecontainer_from_kierepository"></a> <a class="link" href="#_kiecontainer_from_kierepository">2.2.6.5。来自KieRepository的KieContainer</a></h5>
<div class="ulist">
<ul>
<li>
<p>项目：来自存储库的kcontainer</p>
</li>
<li>
<p>简介：该项目不包含kmodule.xml，pom.xml也没有与其他KieModules依赖。相反，Java代码演示了如何从Maven存储库中加载动态KieModule。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>pom.xml必须包含kie-ci作为依赖项，以确保Maven在运行时可用。由于这是在后台使用Maven的，因此您也可以使用标准的Maven settings.xml文件。</p>
</div>
<div class="exampleblock">
<div class="title">示例49。作者-pom.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;parent&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-examples-api&lt;/artifactId&gt;
    &lt;version&gt;6.0.0&lt;/version&gt;
  &lt;/parent&gt;

  &lt;artifactId&gt;kiecontainer-from-kierepo&lt;/artifactId&gt;
  &lt;name&gt;Drools API examples - KieContainer from KieRepo&lt;/name&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.kie&lt;/groupId&gt;
      &lt;artifactId&gt;kie-ci&lt;/artifactId&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

&lt;/project&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">示例50构建和安装-Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>在前面的示例中，使用了KieContainer类路径。本示例创建一个由ReleaseId指定的动态KieContainer。ReleaseId将Maven约定用于组ID，工件ID和版本。它也遵循LATEST和SNAPSHOT的版本。</p>
</div>
<div class="exampleblock">
<div class="title">例子51。使用并运行-Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();

// Install example1 in the local Maven repo before to do this
KieContainer kContainer = ks.newKieContainer(ks.newReleaseId("org.drools", "named-kiesession", "6.0.0-SNAPSHOT"));

KieSession kSession = kContainer.newKieSession("ksession1");
kSession.setGlobal("out", out);

Object msg1 = createMessage(kContainer, "Dave", "Hello, HAL. Do you read me, HAL?");
kSession.insert(msg1);
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_default_kiesession_from_file"><a class="anchor" href="#_default_kiesession_from_file"></a> <a class="link" href="#_default_kiesession_from_file">2.2.6.6。文件中的默认KieSession</a></h5>
<div class="ulist">
<ul>
<li>
<p>项目：来自文件的default-kiesession-from</p>
</li>
<li>
<p>简介：动态KieModules也可以从任何Resource位置加载。加载的KieModule提供默认的KieBase和KieSession定义。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>没有kmodue.xml文件。必须首先构建项目“ default-kiesession”，以便可以将目标文件夹中生成的JAR引用为文件。</p>
</div>
<div class="exampleblock">
<div class="title">示例52。构建和安装-Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>可以从资源位置加载任何KieModule并将其添加到KieRepository。一旦部署在KieRepository中，就可以通过其ReleaseId进行解析。注意这里不需要Maven或kie-ci。它将不会设置可传递依赖关系父类加载器。</p>
</div>
<div class="exampleblock">
<div class="title">示例53。使用并运行-Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieRepository kr = ks.getRepository();

KieModule kModule = kr.addKieModule(ks.getResources().newFileSystemResource(getFile("default-kiesession")));

KieContainer kContainer = ks.newKieContainer(kModule.getReleaseId());

KieSession kSession = kContainer.newKieSession();
kSession.setGlobal("out", out);

Object msg1 = createMessage(kContainer, "Dave", "Hello, HAL. Do you read me, HAL?");
kSession.insert(msg1);
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_named_kiesession_from_file"><a class="anchor" href="#_named_kiesession_from_file"></a> <a class="link" href="#_named_kiesession_from_file">2.2.6.7。从文件命名为KieSession</a></h5>
<div class="ulist">
<ul>
<li>
<p>项目：从文件命名为kiesession</p>
</li>
<li>
<p>简介：动态KieModules也可以从任何Resource位置加载。加载的KieModule提供了命名的KieBase和KieSession定义。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>没有kmodue.xml文件。必须首先构建项目“ named-kiesession”，以便目标文件夹中的结果JAR可以作为文件引用。</p>
</div>
<div class="exampleblock">
<div class="title">示例54构建和安装-Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>可以从资源位置加载任何KieModule并将其添加到KieRepository。进入KieRepository后，可以通过其ReleaseId进行解析。注意这里不需要Maven或kie-ci。它不会设置可传递依赖关系父类加载器。</p>
</div>
<div class="exampleblock">
<div class="title">例子55。使用并运行-Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieRepository kr = ks.getRepository();

KieModule kModule = kr.addKieModule(ks.getResources().newFileSystemResource(getFile("named-kiesession")));

KieContainer kContainer = ks.newKieContainer(kModule.getReleaseId());

KieSession kSession = kContainer.newKieSession("ksession1");
kSession.setGlobal("out", out);

Object msg1 = createMessage(kContainer, "Dave", "Hello, HAL. Do you read me, HAL?");
kSession.insert(msg1);
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kiemodule_with_dependent_kiemodule"><a class="anchor" href="#_kiemodule_with_dependent_kiemodule"></a> <a class="link" href="#_kiemodule_with_dependent_kiemodule">2.2.6.8。带有从属KieModule的KieModule</a></h5>
<div class="ulist">
<ul>
<li>
<p>项目：kie-module-form-multiple-files</p>
</li>
<li>
<p>简介：以编程方式提供了依赖KieModule的列表，而无需使用Maven来解决任何问题。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>没有kmodue.xml文件。必须首先构建项目“ named-kiesession”和“ kiebase-include”，以便可以将目标文件夹中生成的JAR引用为Files。</p>
</div>
<div class="exampleblock">
<div class="title">例子56。构建和安装-Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>创建两个资源。一个用于主KieModule'exRes1'，另一个用于依赖项'exRes2'。即使不存在kie-ci，因此Maven无法解决依赖关系，这仍显示了如何为vararg手动指定依赖的KieModule。</p>
</div>
<div class="exampleblock">
<div class="title">例子57。使用并运行-Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieRepository kr = ks.getRepository();

Resource ex1Res = ks.getResources().newFileSystemResource(getFile("kiebase-inclusion"));
Resource ex2Res = ks.getResources().newFileSystemResource(getFile("named-kiesession"));

KieModule kModule = kr.addKieModule(ex1Res, ex2Res);
KieContainer kContainer = ks.newKieContainer(kModule.getReleaseId());

KieSession kSession = kContainer.newKieSession("ksession2");
kSession.setGlobal("out", out);

Object msg1 = createMessage(kContainer, "Dave", "Hello, HAL. Do you read me, HAL?");
kSession.insert(msg1);
kSession.fireAllRules();

Object msg2 = createMessage(kContainer, "Dave", "Open the pod bay doors, HAL.");
kSession.insert(msg2);
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_programmatically_build_a_simple_kiemodule_with_defaults"><a class="anchor" href="#_programmatically_build_a_simple_kiemodule_with_defaults"></a> <a class="link" href="#_programmatically_build_a_simple_kiemodule_with_defaults">2.2.6.9。以默认方式以编程方式构建一个简单的KieModule</a></h5>
<div class="ulist">
<ul>
<li>
<p>项目：kiemoduelmodel-example</p>
</li>
<li>
<p>简介：以编程方式从单个文件构建KieModule。POM和模型都是默认的。这是开箱即用的最快方法，但是不应将其添加到Maven存储库中。</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">示例58。构建和安装-Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>这将以编程方式构建KieModule。它填充表示ReleaseId和kmodule.xml的模型，并添加相关资源。从ReleaseId生成pom.xml。</p>
</div>
<div class="exampleblock">
<div class="title">范例59。使用并运行-Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieRepository kr = ks.getRepository();
KieFileSystem kfs = ks.newKieFileSystem();

kfs.write("src/main/resources/org/kie/example5/HAL5.drl", getRule());

KieBuilder kb = ks.newKieBuilder(kfs);

kb.buildAll(); // kieModule is automatically deployed to KieRepository if successfully built.
if (kb.getResults().hasMessages(Level.ERROR)) {
    throw new RuntimeException("Build Errors:\n" + kb.getResults().toString());
}

KieContainer kContainer = ks.newKieContainer(kr.getDefaultReleaseId());

KieSession kSession = kContainer.newKieSession();
kSession.setGlobal("out", out);

kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_programmatically_build_a_kiemodule_using_meta_models"><a class="anchor" href="#_programmatically_build_a_kiemodule_using_meta_models"></a> <a class="link" href="#_programmatically_build_a_kiemodule_using_meta_models">2.2.6.10。使用元模型以编程方式构建KieModule</a></h5>
<div class="ulist">
<ul>
<li>
<p>项目：kiemoduelmodel-example</p>
</li>
<li>
<p>简介：通过创建KieModule的kmodule.xml元模型资源，以编程方式构建它。</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">示例60构建和安装-Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>这将以编程方式构建KieModule。它填充表示ReleaseId和kmodule.xml的模型，并添加相关资源。从ReleaseId生成pom.xml。</p>
</div>
<div class="exampleblock">
<div class="title">例子61。使用并运行-Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieFileSystem kfs = ks.newKieFileSystem();

Resource ex1Res = ks.getResources().newFileSystemResource(getFile("named-kiesession"));
Resource ex2Res = ks.getResources().newFileSystemResource(getFile("kiebase-inclusion"));

ReleaseId rid = ks.newReleaseId("org.drools", "kiemodulemodel-example", "6.0.0-SNAPSHOT");
kfs.generateAndWritePomXML(rid);

KieModuleModel kModuleModel = ks.newKieModuleModel();
kModuleModel.newKieBaseModel("kiemodulemodel")
            .addInclude("kiebase1")
            .addInclude("kiebase2")
            .newKieSessionModel("ksession6");

kfs.writeKModuleXML(kModuleModel.toXML());
kfs.write("src/main/resources/kiemodulemodel/HAL6.drl", getRule());

KieBuilder kb = ks.newKieBuilder(kfs);
kb.setDependencies(ex1Res, ex2Res);
kb.buildAll(); // kieModule is automatically deployed to KieRepository if successfully built.
if (kb.getResults().hasMessages(Level.ERROR)) {
    throw new RuntimeException("Build Errors:\n" + kb.getResults().toString());
}

KieContainer kContainer = ks.newKieContainer(rid);

KieSession kSession = kContainer.newKieSession("ksession6");
kSession.setGlobal("out", out);

Object msg1 = createMessage(kContainer, "Dave", "Hello, HAL. Do you read me, HAL?");
kSession.insert(msg1);
kSession.fireAllRules();

Object msg2 = createMessage(kContainer, "Dave", "Open the pod bay doors, HAL.");
kSession.insert(msg2);
kSession.fireAllRules();

Object msg3 = createMessage(kContainer, "Dave", "What's the problem?");
kSession.insert(msg3);
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kie-scanner-proc_decision-management-architecture"><a class="anchor" href="#kie-scanner-proc_decision-management-architecture"></a> <a class="link" href="#kie-scanner-proc_decision-management-architecture">2.2.7。使用KIE扫描器监视和更新KIE容器</a></h4>
<div class="paragraph">
<p>Drools中的KIE扫描器监视您的Maven存储库中是否有新的<code>SNAPSHOT</code>版本的Drools项目，然后将项目的最新版本部署到指定的KIE容器。您可以在开发环境中使用KIE扫描仪，以在新版本可用时更有效地维护Drools项目部署。</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">
<div class="paragraph">
<p>对于生产环境，请勿使用KIE扫描仪或<code>SNAPSHOT</code>项目版本，以避免意外或意外的项目更新。KIE扫描仪旨在用于使用<code>SNAPSHOT</code>项目版本。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>的<code>kie-ci.jar</code>文件在Drools项目的类路径中可用。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在相关<code>.java</code>您的项目中的类，注册并启动KIE扫描器，如以下示例代码所示：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">注册并启动KIE容器的KIE扫描器</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.KieServices;
import org.kie.api.builder.ReleaseId;
import org.kie.api.runtime.KieContainer;
import org.kie.api.builder.KieScanner;

...

KieServices kieServices = KieServices.Factory.get();
ReleaseId releaseId = kieServices
  .newReleaseId("com.sample", "my-app", "1.0-SNAPSHOT");
KieContainer kContainer = kieServices.newKieContainer(releaseId);
KieScanner kScanner = kieServices.newKieScanner(kContainer);

// Start KIE scanner for polling the Maven repository every 10 seconds (10000 ms)
kScanner.start(10000L);</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，KIE扫描器配置为以固定的时间间隔运行。KIE扫描器的最小轮询间隔为1毫秒（ms），最大轮询间隔为数据类型的最大值<code>long</code> 。轮询间隔为0或更小会导致<code>java.lang.IllegalArgumentException: pollingInterval must be positive</code>错误。您还可以通过调用以下命令将KIE扫描仪配置为按需运行<code>scanNow()</code>方法。</p>
</div>
<div class="paragraph">
<p>示例中的项目组ID，工件ID和版本（GAV）设置定义为<code>com.sample:my-app:1.0-SNAPSHOT</code> 。项目版本必须包含<code>-SNAPSHOT</code>后缀，以使KIE扫描程序能够检索指定工件版本的最新版本。如果更改快照项目的版本号，例如增加到<code>1.0.1-SNAPSHOT</code> ，那么您还必须在KIE扫描仪配置中更新GAV定义中的版本。KIE扫描程序不会检索具有静态版本的项目的更新，例如<code>com.sample:my-app:1.0</code> 。</p>
</div>
</div>
</div>
</li>
<li>
<p>在里面<code>settings.xml</code> Maven存储库的文件，设置<code>updatePolicy</code>配置到<code>always</code>使KIE扫描仪正常运行：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;profile&gt;
  &lt;id&gt;guvnor-m2-repo&lt;/id&gt;
  &lt;repositories&gt;
    &lt;repository&gt;
      &lt;id&gt;guvnor-m2-repo&lt;/id&gt;
      &lt;name&gt;BA Repository&lt;/name&gt;
      &lt;url&gt;http://localhost:8080/business-central/maven2/&lt;/url&gt;
      &lt;layout&gt;default&lt;/layout&gt;
      &lt;releases&gt;
        &lt;enabled&gt;true&lt;/enabled&gt;
        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
      &lt;/releases&gt;
      &lt;snapshots&gt;
        &lt;enabled&gt;true&lt;/enabled&gt;
        &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
      &lt;/snapshots&gt;
    &lt;/repository&gt;
  &lt;/repositories&gt;
&lt;/profile&gt;</code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>KIE扫描程序开始轮询后，如果KIE扫描程序检测到更新版本的<code>SNAPSHOT</code>如果项目位于指定的KIE容器中，则KIE扫描程序会自动下载新项目版本并触发新项目的增量构建。从那时起，所有新<code>KieBase</code>和<code>KieSession</code>从KIE容器创建的对象使用新的项目版本。</p>
</div>
<div class="paragraph">
<p>有关使用KIE Server API启动或停止KIE扫描仪的信息，请参阅<a href="#kie-server-commands-con_kie-apis">Drools中的KIE Server和KIE容器命令</a> 。</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kiesecuritysection"><a class="anchor" href="#_kiesecuritysection"></a> <a class="link" href="#_kiesecuritysection">2.3。安全</a></h3>
<div class="sect3">
<h4 id="_securitymanager"><a class="anchor" href="#_securitymanager"></a> <a class="link" href="#_securitymanager">2.3.1。安全经理</a></h4>
<div class="paragraph">
<p>KIE引擎是使用大量声明性抽象和隐喻（例如规则，流程，决策表等）来对业务行为进行建模和执行的平台。</p>
</div>
<div class="paragraph">
<p>很多时候，这些隐喻的创作是由第三方小组完成的，无论是同一公司内部的不同小组，合伙公司的小组，还是互联网上的匿名第三方。</p>
</div>
<div class="paragraph">
<p>规则和流程旨在执行任意代码以完成其工作，但是在这种情况下，可能有必要限制它们可以做什么。例如，不太可能允许创建类加载器的规则（可能使系统受到攻击的规则），并且当然不应允许它调用<code>System.exit()</code> 。</p>
</div>
<div class="paragraph">
<p>Java平台提供了一个非常全面且定义明确的安全框架，该框架允许用户定义有关系统可以执行的操作的策略。KIE平台利用该框架，并允许应用程序开发人员定义特定的策略，以应用于用户提供的代码的任何执行，无论是在规则，流程，工作项处理程序等中。</p>
</div>
<div class="sect4">
<h5 id="_howtodefinekiepolicy"><a class="anchor" href="#_howtodefinekiepolicy"></a> <a class="link" href="#_howtodefinekiepolicy">2.3.1.1。如何定义KIE策略</a></h5>
<div class="paragraph">
<p>规则和流程可以在非常严格的权限下运行，但是引擎本身需要执行许多复杂的操作才能正常工作。例如：需要创建类加载器，读取系统属性，访问文件系统等。</p>
</div>
<div class="paragraph">
<p>但是，一旦安装了安全管理器，它将根据定义的策略将限制应用于在JVM中执行的所有代码。因此，KIE允许用户定义两个不同的策略文件：一个用于引擎本身，一个用于部署到引擎中并由引擎执行的资产。</p>
</div>
<div class="paragraph">
<p>设置环境的一种简单方法是为引擎本身提供非常宽松的策略，同时为规则和流程提供受约束的策略。</p>
</div>
<div class="paragraph">
<p>策略文件遵循Java文档中描述的标准策略文件语法。有关更多详细信息，请参见：</p>
</div>
<div class="paragraph">
<p><a href="https://docs.oracle.com/javase/6/docs/technotes/guides/security/PolicyFiles.html#FileSyntax" class="bare">https://docs.oracle.com/javase/6/docs/technotes/guides/security/PolicyFiles.html#FileSyntax</a></p>
</div>
<div class="paragraph">
<p>引擎的许可策略文件如下所示：</p>
</div>
<div class="exampleblock">
<div class="title">例子62。一个示例engine.policy文件</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>grant {
    permission java.security.AllPermission;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>规则的示例安全策略可以是：</p>
</div>
<div class="exampleblock">
<div class="title">示例63。一个示例rules.policy文件</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>grant {
    permission java.util.PropertyPermission "*", "read";
    permission java.lang.RuntimePermission "accessDeclaredMembers";
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>请注意，根据规则和流程的意图，可能需要授予更多权限，例如访问文件系统，数据库中的文件等。</p>
</div>
<div class="paragraph">
<p>为了使用这些策略文件，只需将这些文件作为JVM的参数来执行应用程序。需要三个参数：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表9。参量</caption>
<colgroup>
<col style="width:50%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Djava.security.manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">启用安全管理器</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Djava.security.policy =<jvm_policy_file></jvm_policy_file></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定义要应用于整个应用程序（包括引擎）的全局策略文件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dkie.security.policy =<kie_policy_file></kie_policy_file></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定义要应用于规则和流程的策略文件</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>例如：</p>
</div>
<div class="paragraph">
<p><code>java -Djava.security.manager -Djava.security.policy=global.policy -Dkie.security.policy=rules.policy foo.bar.MyApp</code></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在容器内执行引擎时，请使用容器的文档以了解如何配置安全管理器以及如何定义全局安全策略。如上所述定义kie安全策略并设置<code>kie.security.policy</code>系统属性，以便配置引擎以使用它。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>请注意，除非配置了安全管理器，否则<code>kie.security.policy</code>将被忽略。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>安全管理器在JVM中具有较高的性能影响。强烈建议不要对具有严格性能要求的应用程序使用安全管理器。另一种选择是使用其他安全性程序，例如在测试和部署之前对规则/过程进行审核，以防止将恶意代码部署到环境中。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<h1 id="_drools_run_time_and_language" class="discrete">流口水的运行时间和语言</h1>
<div class="paragraph">
<p>Drools是功能强大的混合推理系统，可智能高效地处理规则数据。</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="decision-engine-con_decision-engine"><a class="anchor" href="#decision-engine-con_decision-engine"></a> <a class="link" href="#decision-engine-con_decision-engine">3。流口水引擎</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Drools引擎是Drools中的规则引擎。Drools引擎存储，处理和评估数据以执行您定义的业务规则或决策模型。Drools引擎的基本功能是将传入的数据或<em>事实</em>与规则条件进行匹配，并确定是否以及如何执行规则。</p>
</div>
<div class="paragraph">
<p>Drools引擎使用以下基本组件运行：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>规则：</strong>您定义的业务规则或DMN决策。所有规则都必须至少包含触发该规则的条件以及该规则指示的操作。</p>
</li>
<li>
<p><strong>事实：</strong>在Drools引擎中输入或更改的数据，Drools引擎将其匹配到规则条件以执行适用的规则。</p>
</li>
<li>
<p><strong>生产内存：</strong>在Drools引擎中存储规则的位置。</p>
</li>
<li>
<p><strong>工作内存：</strong>事实存储在Drools引擎中的位置。</p>
</li>
<li>
<p><strong>议程：</strong>已注册激活规则并对其进行排序（如果适用）以准备执行的位置。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>当业务用户或自动化系统在Drools中添加或更新与规则相关的信息时，该信息将以一个或多个事实的形式插入Drools引擎的工作存储器中。Drools引擎将这些事实与存储在生产内存中的规则条件相匹配，以确定合格的规则执行。（将事实与规则进行匹配的过程通常称为<em>模式匹配</em> 。）当满足规则条件时，Drools引擎将激活规则并将其注册到议程中，然后Drools引擎会在其中排序优先级或冲突的规则以准备执行。</p>
</div>
<div class="paragraph">
<p>下图说明了Drools引擎的这些基本组件：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./HybridReasoning/rule-engine-inkscape_enterprise.png" alt="规则引擎inkscape企业">
</div>
<div class="title">图31。基本Drools引擎组件概述</div>
</div>
<div class="paragraph">
<p>这些核心概念可以帮助您更好地了解Drools引擎的其他更高级的组件，流程和子流程，从而在Drools中设计更有效的业务资产。</p>
</div>
<div class="sect2">
<h3 id="kie-sessions-con_decision-engine"><a class="anchor" href="#kie-sessions-con_decision-engine"></a> <a class="link" href="#kie-sessions-con_decision-engine">3.1。KIE会议</a></h3>
<div class="paragraph">
<p>在Drools中，KIE会话存储并执行运行时数据。如果已在KIE模块描述符文件中定义了KIE会话，则可以从KIE基础或直接从KIE容器创建KIE会话（ <code>kmodule.xml</code> ）用于您的项目。</p>
</div>
<div class="listingblock">
<div class="title">示例KIE会话配置<code>kmodule.xml</code>文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule&gt;
  ...
  &lt;kbase&gt;
    ...
    &lt;ksession name="KSession2_1" type="stateless" default="true" clockType="realtime"&gt;
    ...
  &lt;/kbase&gt;
  ...
&lt;/kmodule&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>KIE基础是您在KIE模块描述符文件中定义的存储库（ <code>kmodule.xml</code> ），并且包含在Drools中的所有内容，但不包含任何运行时数据。</p>
</div>
<div class="listingblock">
<div class="title">示例KIE基本配置<code>kmodule.xml</code>文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule&gt;
  ...
  &lt;kbase name="KBase2" default="false" eventProcessingMode="stream" equalsBehavior="equality" declarativeAgenda="enabled" packages="org.domain.pkg2, org.domain.pkg3" includes="KBase1"&gt;
    ...
  &lt;/kbase&gt;
  ...
&lt;/kmodule&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>KIE会话可以是无状态的，也可以是有状态的。在无状态KIE会话中，来自KIE会话的先前调用（先前的会话状态）的数据在会话调用之间被丢弃。在有状态的KIE会话中，将保留该数据。您使用的KIE会话的类型取决于您的项目要求以及希望如何保留来自不同资产调用的数据。</p>
</div>
<div class="sect3">
<h4 id="kie-sessions-stateless-con_decision-engine"><a class="anchor" href="#kie-sessions-stateless-con_decision-engine"></a> <a class="link" href="#kie-sessions-stateless-con_decision-engine">3.1.1。无状态KIE会议</a></h4>
<div class="paragraph">
<p>无状态KIE会话是不使用推断随时间对事实进行迭代更改的会话。在无状态KIE会话中，来自KIE会话的先前调用（先前的会话状态）的数据在会话调用之间被丢弃，而在有状态KIE会话中，该数据被保留。无状态KIE会话的行为与功能类似，因为它产生的结果由KIE基础的内容以及传递到KIE会话中以在特定时间点执行的数据确定。KIE会话不存储先前传递到KIE会话中的任何数据。</p>
</div>
<div class="paragraph">
<p>无状态KIE会话通常用于以下用例：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>验证</strong> ，例如验证某人有资格获得抵押贷款</p>
</li>
<li>
<p><strong>计算</strong> ，例如计算抵押贷款溢价</p>
</li>
<li>
<p><strong>路由和过滤</strong> ，例如将传入电子邮件分类到文件夹中或将传入电子邮件发送到目的地</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如，考虑以下驾驶执照数据模型和示例DRL规则：</p>
</div>
<div class="listingblock">
<div class="title">驾驶执照申请的数据模型</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Applicant {
  private String name;
  private int age;
  private boolean valid;
  // Getter and setter methods
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">驾驶执照申请的示例DRL规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>package com.company.license

rule "Is of valid age"
when
  $a : Applicant(age &lt; 18)
then
  $a.setValid(false);
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>Is of valid age</code>该规则将取消任何未满18岁的申请人的资格。当。。。的时候<code>Applicant</code>将对象插入Drools引擎后，Drools引擎将评估每个规则的约束并搜索匹配项。的<code>"objectType"</code>总是隐含约束，然后评估任何数量的显式字段约束。变量<code>$a</code>是在规则结果中引用匹配对象的绑定变量。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>美元符号（ <code>$</code> ）是可选的，有助于区分变量名和字段名。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>在此示例中，示例规则和<code>~/resources</code> Drools项目的文件夹使用以下代码构建：</p>
</div>
<div class="listingblock">
<div class="title">创建KIE容器</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();

KieContainer kContainer = kieServices.getKieClasspathContainer();</code></pre>
</div>
</div>
<div class="paragraph">
<p>此代码编译在类路径上找到的所有规则文件，并添加此编译的结果， <code>KieModule</code>对象，在<code>KieContainer</code> 。</p>
</div>
<div class="paragraph">
<p>最后， <code>StatelessKieSession</code>对象是从实例化的<code>KieContainer</code>并针对指定数据执行：</p>
</div>
<div class="listingblock">
<div class="title">实例化无状态KIE会话并输入数据</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession kSession = kContainer.newStatelessKieSession();

Applicant applicant = new Applicant("Mr John Smith", 16);

assertTrue(applicant.isValid());

ksession.execute(applicant);

assertFalse(applicant.isValid());</code></pre>
</div>
</div>
<div class="paragraph">
<p>在无状态KIE会话配置中， <code>execute()</code>调用充当实例化<code>KieSession</code>对象，添加所有用户数据并执行用户命令，调用<code>fireAllRules()</code> ，然后调用<code>dispose()</code> 。因此，在无状态KIE会话中，您无需致电<code>fireAllRules()</code>或致电<code>dispose()</code>在会话调用之后，就像处理有状态的KIE会话一样。</p>
</div>
<div class="paragraph">
<p>在这种情况下，指定的申请人未满18岁，因此申请被拒绝。</p>
</div>
<div class="paragraph">
<p>有关更复杂的用例，请参见以下示例。本示例使用无状态KIE会话并针对可迭代对象列表（例如集合）执行规则。</p>
</div>
<div class="listingblock">
<div class="title">用于驾驶执照申请的扩展数据模型</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Applicant {
  private String name;
  private int age;
  // Getter and setter methods
}

public class Application {
  private Date dateApplied;
  private boolean valid;
  // Getter and setter methods
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">扩大了驾驶执照申请的DRL规则集</div>
<div class="content">
<pre class="highlightjs highlight"><code>package com.company.license

rule "Is of valid age"
when
  Applicant(age &lt; 18)
  $a : Application()
then
  $a.setValid(false);
end

rule "Application was made this year"
when
  $a : Application(dateApplied &gt; "01-jan-2009")
then
  $a.setValid(false);
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">在无状态KIE会话中可迭代执行的扩展Java源代码</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKnowledgeSession();
Applicant applicant = new Applicant("Mr John Smith", 16);
Application application = new Application();

assertTrue(application.isValid());
ksession.execute(Arrays.asList(new Object[] { application, applicant }));  <i class="conum" data-value="1"></i><b>(1)</b>
assertFalse(application.isValid());

ksession.execute
  (CommandFactory.newInsertIterable(new Object[] { application, applicant }));  <i class="conum" data-value="2"></i><b>(2)</b>

List&lt;Command&gt; cmds = new ArrayList&lt;Command&gt;();  <i class="conum" data-value="3"></i><b>(3)</b>
cmds.add(CommandFactory.newInsert(new Person("Mr John Smith"), "mrSmith"));
cmds.add(CommandFactory.newInsert(new Person("Mr John Doe"), "mrDoe"));

BatchExecutionResults results = ksession.execute(CommandFactory.newBatchExecution(cmds));
assertEquals(new Person("Mr John Smith"), results.getValue("mrSmith"));</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>对由对象产生的可迭代对象集合执行规则的方法<code>Arrays.asList()</code>方法。在执行任何匹配的规则之前，将插入每个collection元素。的<code>execute(Object object)</code>和<code>execute(Iterable objects)</code>方法是包装<code>execute(Command command)</code>来自的方法<code>BatchExecutor</code>接口。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>使用以下命令执行可迭代对象集合<code>CommandFactory</code>接口。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i> <b>3</b></td>
<td><code>BatchExecutor</code>和<code>CommandFactory</code>用于使用许多不同命令或结果输出标识符的配置。的<code>CommandFactory</code>介面支援您可以在<code>BatchExecutor</code> ， 如<code>StartProcess</code> ， <code>Query</code>和<code>SetGlobal</code> 。</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="kie-sessions-stateless-globals-con_decision-engine"><a class="anchor" href="#kie-sessions-stateless-globals-con_decision-engine"></a> <a class="link" href="#kie-sessions-stateless-globals-con_decision-engine">3.1.1.1。无状态KIE会话中的全局变量</a></h5>
<div class="paragraph">
<p>的<code>StatelessKieSession</code>对象支持全局变量（全局变量），您可以将其配置为解析为会话范围的全局变量，委托全局变量或执行范围的全局变量。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>会话范围的全局变量：</strong>对于会话范围的全局变量，可以使用以下方法<code>getGlobals()</code>返回一个<code>Globals</code>提供访问KIE会话全局变量的实例。这些全局变量用于所有执行调用。对于可变全局变量要格外小心，因为执行调用可以在不同的线程中同时执行。</p>
<div class="listingblock">
<div class="title">会话范围的全局</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.runtime.StatelessKieSession;

StatelessKieSession ksession = kbase.newStatelessKieSession();

// Set a global `myGlobal` that can be used in the rules.
ksession.setGlobal("myGlobal", "I am a global");

// Execute while resolving the `myGlobal` identifier.
ksession.execute(collection);</code></pre>
</div>
</div>
</li>
<li>
<p><strong>委托全局变量：</strong>对于委托全局变量，您可以将值分配给全局变量（带有<code>setGlobal(String, Object)</code> ），以便将值存储在将标识符映射到值的内部集合中。此内部集合中的标识符优先于任何提供的委托。如果在此内部集合中找不到标识符，则使用全局委托（如果有）。</p>
</li>
<li>
<p><strong>执行范围的全局变量：</strong>对于执行范围的全局变量，您可以使用<code>Command</code>设置传递给的全局对象<code>CommandExecutor</code>特定于执行的全局解决方案的接口。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>的<code>CommandExecutor</code>界面还使您可以使用全局标识符，插入的事实和查询结果的标识符导出数据：</p>
</div>
<div class="listingblock">
<div class="title">输出全局标识符，插入的事实和查询结果</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.runtime.ExecutionResults;

// Set up a list of commands.
List cmds = new ArrayList();
cmds.add(CommandFactory.newSetGlobal("list1", new ArrayList(), true));
cmds.add(CommandFactory.newInsert(new Person("jon", 102), "person"));
cmds.add(CommandFactory.newQuery("Get People" "getPeople"));

// Execute the list.
ExecutionResults results = ksession.execute(CommandFactory.newBatchExecution(cmds));

// Retrieve the `ArrayList`.
results.getValue("list1");
// Retrieve the inserted `Person` fact.
results.getValue("person");
// Retrieve the query as a `QueryResults` instance.
results.getValue("Get People");</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kie-sessions-stateful-con_decision-engine"><a class="anchor" href="#kie-sessions-stateful-con_decision-engine"></a> <a class="link" href="#kie-sessions-stateful-con_decision-engine">3.1.2。有状态的KIE会议</a></h4>
<div class="paragraph">
<p>有状态的KIE会话是使用推理随时间对事实进行迭代更改的会话。在有状态的KIE会话中，来自KIE会话的先前调用（先前的会话状态）的数据将在会话调用之间保留，而在无状态的KIE会话中，该数据将被丢弃。</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">确保您致电<code>dispose()</code>在运行有状态的KIE会话之后执行的方法，以便在会话调用之间不会发生内存泄漏。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>有状态的KIE会话通常用于以下用例：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>监视</strong> ，例如监视股票市场和自动化购买过程</p>
</li>
<li>
<p><strong>诊断</strong> ，例如运行故障查找过程或医疗诊断过程</p>
</li>
<li>
<p><strong>物流</strong> ，例如包裹跟踪和配送</p>
</li>
<li>
<p><strong>确保合规性</strong> ，例如验证市场交易的合法性</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如，考虑以下火灾警报数据模型和示例DRL规则：</p>
</div>
<div class="listingblock">
<div class="title">洒水器和火灾报警器的数据模型</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Room {
  private String name;
  // Getter and setter methods
}

public class Sprinkler {
  private Room room;
  private boolean on;
  // Getter and setter methods
}

public class Fire {
  private Room room;
  // Getter and setter methods
}

public class Alarm { }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例DRL规则集，用于激活喷水灭火和警报</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "When there is a fire turn on the sprinkler"
when
  Fire($room : room)
  $sprinkler : Sprinkler(room == $room, on == false)
then
  modify($sprinkler) { setOn(true) };
  System.out.println("Turn on the sprinkler for room "+$room.getName());
end

rule "Raise the alarm when we have one or more fires"
when
    exists Fire()
then
    insert( new Alarm() );
    System.out.println( "Raise the alarm" );
end

rule "Cancel the alarm when all the fires have gone"
when
    not Fire()
    $alarm : Alarm()
then
    delete( $alarm );
    System.out.println( "Cancel the alarm" );
end


rule "Status output when things are ok"
when
    not Alarm()
    not Sprinkler( on == true )
then
    System.out.println( "Everything is ok" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了<code>When there is a fire turn on the sprinkler</code>规则，当发生火灾时， <code>Fire</code>将为该房间创建课程，并将其插入KIE会话。该规则为特定的<code>room</code>匹配<code>Fire</code>实例，以便仅检查该房间的洒水装置。执行此规则后，洒水器启动。其他示例规则确定相应地何时激活或停用警报。</p>
</div>
<div class="paragraph">
<p>无状态KIE会话依赖于标准Java语法来修改字段，而无状态KIE会话则依赖于<code>modify</code>规则中的声明，以将更改通知Drools引擎。然后，Drools引擎对更改进行推理，并评估对后续规则执行的影响。该过程是Drools引擎使用<em>推理</em>和<em>真相维护</em>功能的一部分，并且在有状态KIE会话中至关重要。</p>
</div>
<div class="paragraph">
<p>在此示例中，示例规则和<code>~/resources</code> Drools项目的文件夹使用以下代码构建：</p>
</div>
<div class="listingblock">
<div class="title">创建KIE容器</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieContainer kContainer = kieServices.getKieClasspathContainer();</code></pre>
</div>
</div>
<div class="paragraph">
<p>此代码编译在类路径上找到的所有规则文件，并添加此编译的结果， <code>KieModule</code>对象，在<code>KieContainer</code> 。</p>
</div>
<div class="paragraph">
<p>最后， <code>KieSession</code>对象是从实例化的<code>KieContainer</code>并针对指定数据执行：</p>
</div>
<div class="listingblock">
<div class="title">实例化有状态的KIE会话并输入数据</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession ksession = kContainer.newKieSession();

String[] names = new String[]{"kitchen", "bedroom", "office", "livingroom"};
Map&lt;String,Room&gt; name2room = new HashMap&lt;String,Room&gt;();
for( String name: names ){
    Room room = new Room( name );
    name2room.put( name, room );
    ksession.insert( room );
    Sprinkler sprinkler = new Sprinkler( room );
    ksession.insert( sprinkler );
}

ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">控制台输出</div>
<div class="content">
<pre class="highlightjs highlight"><code>&gt; Everything is ok</code></pre>
</div>
</div>
<div class="paragraph">
<p>添加数据后，Drools引擎将完成所有模式匹配，但尚未执行任何规则，因此将显示已配置的验证消息。当新数据触发规则条件时，Drools引擎将执行规则以激活警报，并随后取消已激活的警报：</p>
</div>
<div class="listingblock">
<div class="title">输入新数据以触发规则</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Fire kitchenFire = new Fire( name2room.get( "kitchen" ) );
Fire officeFire = new Fire( name2room.get( "office" ) );

FactHandle kitchenFireHandle = ksession.insert( kitchenFire );
FactHandle officeFireHandle = ksession.insert( officeFire );

ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">控制台输出</div>
<div class="content">
<pre class="highlightjs highlight"><code>&gt; Raise the alarm
&gt; Turn on the sprinkler for room kitchen
&gt; Turn on the sprinkler for room office</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.delete( kitchenFireHandle );
ksession.delete( officeFireHandle );

ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">控制台输出</div>
<div class="content">
<pre class="highlightjs highlight"><code>&gt; Cancel the alarm
&gt; Turn off the sprinkler for room office
&gt; Turn off the sprinkler for room kitchen
&gt; Everything is ok</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，将保留返回的参考<code>FactHandle</code>宾语。事实句柄是对插入的实例的内部引擎引用，并允许实例在以后撤回或修改。</p>
</div>
<div class="paragraph">
<p>如该示例所示，来自先前状态KIE会话（已激活的警报）的数据和结果会影响后续会话的调用（警报取消）。</p>
</div>
</div>
<div class="sect3">
<h4 id="kie-sessions-pools-con_decision-engine"><a class="anchor" href="#kie-sessions-pools-con_decision-engine"></a> <a class="link" href="#kie-sessions-pools-con_decision-engine">3.1.3。KIE会话池</a></h4>
<div class="paragraph">
<p>在具有大量KIE运行时数据和高系统活动的用例中，可能会非常频繁地创建和处置KIE会话。KIE会话的高周转率并不总是很耗时，但是当周转率重复数百万次时，该过程可能成为瓶颈，需要大量的清理工作。</p>
</div>
<div class="paragraph">
<p>对于这些大批量的情况，可以使用KIE会话池而不是许多单独的KIE会话。要使用KIE会话池，您需要从KIE容器中获取一个KIE会话池，在池中定义KIE会话的初始数量，并照常从该池中创建KIE会话：</p>
</div>
<div class="listingblock">
<div class="title">示例KIE会话池</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Obtain a KIE session pool from the KIE container
KieContainerSessionsPool pool = kContainer.newKieSessionsPool(10);

// Create KIE sessions from the KIE session pool
KieSession kSession = pool.newKieSession();</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，KIE会话池以10个KIE会话开始，但是您可以指定所需的KIE会话数。该整数值是仅在池中最初创建的KIE会话数。如果正在运行的应用程序需要，则池中的KIE会话数可以动态增长到该值之外。</p>
</div>
<div class="paragraph">
<p>定义KIE会话池后，下一次照常使用KIE会话并调用<code>dispose()</code>在它上面，KIE会话被重置并推回池中而不是被销毁。</p>
</div>
<div class="paragraph">
<p>KIE会话池通常适用于有状态的KIE会话，但KIE会话池也可能会影响您在多个状态下重用的无状态KIE会话<code>execute()</code>电话。当您直接从KIE容器创建无状态KIE会话时，KIE会话继续在内部为每个KIE会话创建一个新的KIE会话<code>execute()</code>调用。相反，当您从KIE会话池中创建无状态KIE会话时，KIE会话在内部仅使用池提供的特定KIE会话。</p>
</div>
<div class="paragraph">
<p>使用完KIE会话池后，您可以调用<code>shutdown()</code>避免内存泄漏的方法。或者，您可以致电<code>dispose()</code>在KIE容器上关闭所有从KIE容器创建的池。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="inference-and-truth-maintenance_decision-engine"><a class="anchor" href="#inference-and-truth-maintenance_decision-engine"></a> <a class="link" href="#inference-and-truth-maintenance_decision-engine">3.2。Drools引擎中的推理和真相维护</a></h3>
<div class="paragraph">
<p>Drools引擎的基本功能是将数据与业务规则匹配，并确定是否以及如何执行规则。为了确保将相关数据应用于适当的规则，Drools引擎会根据现有知识进行<em>推断</em> ，并根据推断出的信息执行操作。</p>
</div>
<div class="paragraph">
<p>例如，以下DRL规则确定了成年人的年龄要求，例如公交通行证政策中的要求：</p>
</div>
<div class="listingblock">
<div class="title">定义年龄要求的规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Infer Adult"
when
  $p : Person(age &gt;= 18)
then
  insert(new IsAdult($p))
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>根据此规则，Drools引擎会推断一个人是成人还是儿童，并执行指定的操作（ <code>then</code>后果）。每个18岁以上的人都有一个<code>IsAdult</code>为他们插入工作存储器中。然后，可以在任何规则（例如以下规则段）中调用这种推断的年龄和公交车通行关系：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$p : Person()
IsAdult(person == $p)</code></pre>
</div>
</div>
<div class="paragraph">
<p>在许多情况下，规则系统中的新数据是其他规则执行的结果，而这些新数据可能会影响其他规则的执行。如果Drools引擎由于执行规则而断言数据，则在将推断的信息应用于其他规则时，Drools引擎将使用真值维护来证明断言的合理性并强制实施真相。维护真相还有助于发现矛盾并处理矛盾。例如，如果执行了两个规则并导致矛盾的动作，则Drools引擎将根据先前计算得出的结论中的假设来选择动作。</p>
</div>
<div class="paragraph">
<p>Drools引擎使用陈述或逻辑插入来插入事实：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>声明的插入：</strong>定义为<code>insert()</code> 。在声明插入之后，通常会显式撤回事实。（“ <em>插入</em> ”一词在一般情况下指<em>指定的插入</em> 。）</p>
</li>
<li>
<p><strong>逻辑插入：</strong>定义为<code>insertLogical()</code> 。逻辑插入后，如果插入事实的规则中的条件不再成立，则插入的事实将自动撤回。当没有条件支持逻辑插入时，将撤回事实。Drools引擎认为逻辑上插入的事实是<em>合理</em>的。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如，以下示例DRL规则使用声明的事实插入来确定发行儿童公交通行证或成人公交通行证的年龄要求：</p>
</div>
<div class="listingblock">
<div class="title">发行公交通行证的规则，注明插入</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Issue Child Bus Pass"
when
  $p : Person(age &lt; 18)
then
  insert(new ChildBusPass($p));
end

rule "Issue Adult Bus Pass"
when
  $p : Person(age &gt;= 18)
then
  insert(new AdultBusPass($p));
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>随着公交车驾驶员年龄的增长以及从儿童公交车到成人公交车通行证的普及，在Drools引擎中很难轻易维护这些规则。作为替代方案，可以使用逻辑事实插入将这些规则分为乘车人年龄规则和乘车证类型规则。事实的逻辑插入使事实取决于事实的真实性。 <code>when</code>条款。</p>
</div>
<div class="paragraph">
<p>以下DRL规则使用逻辑插入来确定儿童和成人的年龄要求：</p>
</div>
<div class="listingblock">
<div class="title">儿童和成人年龄要求，符合逻辑</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Infer Child"
when
  $p : Person(age &lt; 18)
then
  insertLogical(new IsChild($p))
end

rule "Infer Adult"
when
  $p : Person(age &gt;= 18)
then
  insertLogical(new IsAdult($p))
end</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">对于逻辑插入，您的事实对象必须覆盖<code>equals</code>和<code>hashCode</code>来自的方法<code>java.lang.Object</code>根据Java标准的对象。如果两个对象相等，则它们相等<code>equals</code>方法返回<code>true</code>对于彼此，如果他们<code>hashCode</code>方法返回相同的值。有关更多信息，请参见您的Java版本的Java API文档。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>当规则中的条件为假时，事实将自动撤回。此行为在此示例中很有用，因为这两个规则是互斥的。在此示例中，如果此人小于18岁，则规则在逻辑上插入<code>IsChild</code>事实。该人年满18岁之后， <code>IsChild</code>事实会自动撤消，并且<code>IsAdult</code>事实已插入。</p>
</div>
<div class="paragraph">
<p>然后，以下DRL规则确定是发行儿童公交车票还是成人公交车票，并在逻辑上插入<code>ChildBusPass</code>和<code>AdultBusPass</code>事实。之所以可以使用此规则，是因为Drools引擎中的真值维护系统支持一系列插入的逻辑插入链接。</p>
</div>
<div class="listingblock">
<div class="title">发行公交通行证，逻辑插入的规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Issue Child Bus Pass"
when
  $p : Person()
    IsChild(person == $p)
then
  insertLogical(new ChildBusPass($p));
end

rule "Issue Adult Bus Pass"
when
  $p : Person()
    IsAdult(person =$p)
then
  insertLogical(new AdultBusPass($p));
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>当一个人年满18岁时， <code>IsChild</code>事实与人的<code>ChildBusPass</code>事实已经收回。对于这些条件，您可以关联另一个规则，该规则规定一个人必须在18岁后归还儿童通行证。当Drools引擎自动缩回<code>ChildBusPass</code>对象，将执行以下规则以向该人发送请求：</p>
</div>
<div class="listingblock">
<div class="title">通知公交通行证持有人新通行证的规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Return ChildBusPass Request"
when
  $p : Person()
    not(ChildBusPass(person == $p))
then
  requestChildBusPass($p);
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>以下流程图说明了陈述性插入和逻辑插入的生命周期：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./HybridReasoning/Stated_Assertion.png" alt="陈述断言">
</div>
<div class="title">图32。指定插入</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./HybridReasoning/Logical_Assertion.png" alt="逻辑断言">
</div>
<div class="title">图33。逻辑插入</div>
</div>
<div class="paragraph">
<p>当Drools引擎在规则执行过程中逻辑上插入对象时，Drools引擎通过执行规则来<em>证明</em>对象是<em>合理</em>的。对于每个逻辑插入，只能存在一个相等的对象，并且随后的每个相等的逻辑插入都会增加该逻辑插入的对正计数器。当规则的条件变为不真实时，将删除理由。如果没有理由，逻辑对象将自动缩回。</p>
</div>
<div class="sect3">
<h4 id="_government_id_example"><a class="anchor" href="#_government_id_example"></a> <a class="link" href="#_government_id_example">3.2.1。政府编号范例</a></h4>
<div class="paragraph">
<p>因此，现在我们知道了什么是推理，并有一个基本示例，这如何促进良好的规则设计和维护？</p>
</div>
<div class="paragraph">
<p>考虑一个政府身份证部门，该部门负责在儿童成年后发行身份证。他们可能有一个包含如下逻辑的决策表，该逻辑说当居住在伦敦的18岁以上的成年人签发该卡：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:25%">
<col style="width:25%">
<col style="width:25%">
<col style="width:25%">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#bfbfbf"></td>
<td class="tableblock halign-center valign-top" colspan="3" style="background-color:#000000"><p class="tableblock"><span class="white">RuleTable身份证</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#bfbfbf"></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc99"><p class="tableblock">条件</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc99"><p class="tableblock">条件</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc99"><p class="tableblock">行动</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#bfbfbf"></td>
<td class="tableblock halign-center valign-top" colspan="2" style="background-color:#ffcc99"><p class="tableblock">p：人</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc99"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#bfbfbf"></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc99"><p class="tableblock">地点</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc99"><p class="tableblock">年龄> = $ 1</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc99"><p class="tableblock">issueIdCard（$ 1）</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#ccffcc"></td>
<td class="tableblock halign-center valign-top" style="background-color:#ccffff"><p class="tableblock">选择人</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ccffff"><p class="tableblock">选择成人</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffff99"><p class="tableblock">发行身份证</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#ffffff"><p class="tableblock">向成人发行身份证</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffffff"><p class="tableblock">伦敦</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffffff"><p class="tableblock">18岁</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffffff"><p class="tableblock">p</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>但是，身份证部门没有为成人设定政策。这是在中央政府一级完成的。如果中央政府将该年龄改为21岁，这将启动变更管理流程。为了使法律生效，必须有人与ID部门保持联系，并确保其系统得到更新。</p>
</div>
<div class="paragraph">
<p>这种变更管理过程和部门之间的通信对于敏捷环境不是理想的选择，变更变得昂贵且容易出错。此外，卡部门正在使用其“整体式”规则管理方法来管理比其需要注意的更多信息，该方法“泄漏”了更好地放置在其他地方的信息。我的意思是，它并不关心显式的“年龄> = 18”信息确定某人是否是成年人，而仅是他们是成年人。</p>
</div>
<div class="paragraph">
<p>与此相反，让我们采用一种方法来划分（分离）创作职责，以便中央政府和ID部门都保持自己的规则。</p>
</div>
<div class="paragraph">
<p>确定谁是成年人是中央政府的工作。如果他们更改了法律，则只需使用新规则更新其中央存储库，其他规则将使用这些新规则：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#bfbfbf"></td>
<td class="tableblock halign-center valign-top" colspan="2" style="background-color:#000000"><p class="tableblock"><span class="white">RuleTable年龄政策</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#bfbfbf"></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc94"><p class="tableblock">条件</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc94"><p class="tableblock">行动</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#bfbfbf"></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc94"><p class="tableblock">p：人</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc94"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#bfbfbf"></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc94"><p class="tableblock">年龄> = $ 1</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc94"><p class="tableblock">插入（$ 1）</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#b9ffca"></td>
<td class="tableblock halign-center valign-top" style="background-color:#ccffff"><p class="tableblock">成人年龄政策</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#f7ff92"><p class="tableblock">添加成人关系</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#ffffff"><p class="tableblock">推断成人</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffffff"><p class="tableblock">18岁</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffffff"><p class="tableblock">新的IsAdult（p）</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>如前所述，IsAdult事实是从策略规则中推断出来的。它封装了看似任意的逻辑“年龄> = 18”，并为其含义提供了语义抽象。现在，如果有人使用上述规则，则他们不再需要知道确定某人是否为成年人的显式信息。他们可以使用推断的事实：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:25%">
<col style="width:25%">
<col style="width:25%">
<col style="width:25%">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#c0c0c0"></td>
<td class="tableblock halign-center valign-top" colspan="3" style="background-color:#000000"><p class="tableblock"><span class="white">RuleTable身份证</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#c0c0c0"></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc99"><p class="tableblock">条件</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc99"><p class="tableblock">条件</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc99"><p class="tableblock">行动</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#c0c0c0"></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc99"><p class="tableblock">p：人</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc99"><p class="tableblock">isAdult</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc99"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#c0c0c0"></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc99"><p class="tableblock">地点</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc99"><p class="tableblock">人== $ 1</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffcc99"><p class="tableblock">issueIdCard（$ 1）</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#ccffcc"></td>
<td class="tableblock halign-center valign-top" style="background-color:#ccffff"><p class="tableblock">选择人</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ccffff"><p class="tableblock">选择成人</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffff99"><p class="tableblock">发行身份证</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#ffffff"><p class="tableblock">向成人发行身份证</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffffff"><p class="tableblock">伦敦</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffffff"><p class="tableblock">p</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#ffffff"><p class="tableblock">p</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>尽管该示例非常简单且琐碎，但它说明了一些要点。我们从整体性和泄漏性的知识工程开始。我们创建了一个决策表，其中包含所有可能的信息，并且从中央政府泄漏了ID部门不关心也不希望管理的信息。</p>
</div>
<div class="paragraph">
<p>我们首先将知识过程解耦，所以每个部门只负责需要知道的内容。然后，我们使用推断的事实IsAdult封装了这种泄漏的知识。IsAdult一词的使用也为先前任意的逻辑“年龄> = 18”提供了语义抽象。</p>
</div>
<div class="paragraph">
<p>因此，进行知识工程时的一般经验法则是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>坏</strong></p>
<div class="ulist">
<ul>
<li>
<p>单片</p>
</li>
<li>
<p>漏水的</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>好</strong></p>
<div class="ulist">
<ul>
<li>
<p>解耦知识责任</p>
</li>
<li>
<p>封装知识</p>
</li>
<li>
<p>为这些封装提供语义抽象</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="fact-equality-modes-con_decision-engine"><a class="anchor" href="#fact-equality-modes-con_decision-engine"></a> <a class="link" href="#fact-equality-modes-con_decision-engine">3.2.2。Drools引擎中的事实平等模式</a></h4>
<div class="paragraph">
<p>Drools引擎支持以下事实平等模式，这些模式确定Drools引擎如何存储和比较插入的事实：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>identity</code> ：（默认）Drools引擎使用<code>IdentityHashMap</code>存储所有插入的事实。对于每个新的事实插入，Drools引擎都会返回一个新的<code>FactHandle</code>宾语。如果再次插入事实，则Drools引擎将返回原始<code>FactHandle</code>对象，忽略相同事实的重复插入。在这种模式下，两个事实对于Drools引擎来说是相同的，只有它们是具有相同标识的完全相同的对象。</p>
</li>
<li>
<p><code>equality</code> ：Drools引擎使用<code>HashMap</code>存储所有插入的事实。Drools引擎返回了新的<code>FactHandle</code>根据插入的对象，仅当插入的事实与现有事实不相等时才对象<code>equals()</code>插入事实的方法。在这种模式下，如果Drools引擎以相同的方式构成两个事实，而与身份无关，则这两个事实是相同的。当您希望基于功能等同性而非显式身份评估对象时，请使用此模式。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>作为事实相等模式的说明，请考虑以下示例事实：</p>
</div>
<div class="listingblock">
<div class="title">事实示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person p1 = new Person("John", 45);
Person p2 = new Person("John", 45);</code></pre>
</div>
</div>
<div class="paragraph">
<p>在<code>identity</code>模式，事实<code>p1</code>和<code>p2</code>是一个不同的实例<code>Person</code>类，并被视为单独的对象，因为它们具有单独的标识。在<code>equality</code>模式，事实<code>p1</code>和<code>p2</code>被视为相同的对象，因为它们的构成方式相同。这种行为上的差异会影响您如何与事实句柄进行交互。</p>
</div>
<div class="paragraph">
<p>例如，假设您插入事实<code>p1</code>和<code>p2</code>进入Drools引擎，稍后您要检索事实句柄<code>p1</code> 。在<code>identity</code>模式，您必须指定<code>p1</code>返回该确切对象的事实句柄，而在<code>equality</code>模式，您可以指定<code>p1</code> ， <code>p2</code> ， 要么<code>new Person("John", 45)</code>返回事实句柄。</p>
</div>
<div class="listingblock">
<div class="title">插入事实并在其中返回事实句柄的示例代码<code>identity</code>模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>ksession.insert(p1);

ksession.getFactHandle(p1);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">插入事实并在其中返回事实句柄的示例代码<code>equality</code>模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>ksession.insert(p1);

ksession.getFactHandle(p1);

// Alternate option:
ksession.getFactHandle(new Person("John", 45));</code></pre>
</div>
</div>
<div class="paragraph">
<p>要设置事实相等模式，请使用以下选项之一：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>设置系统属性<code>drools.equalityBehavior</code>至<code>identity</code> （默认）或<code>equality</code> 。</p>
</li>
<li>
<p>以编程方式创建KIE基础时，设置相等模式：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.get();
KieBaseConfiguration kieBaseConf = ks.newKieBaseConfiguration();
kieBaseConf.setOption(EqualityBehaviorOption.EQUALITY);
KieBase kieBase = kieContainer.newKieBase(kieBaseConf);</code></pre>
</div>
</div>
</li>
<li>
<p>在KIE模块描述符文件中设置相等模式（ <code>kmodule.xml</code> ）用于特定的Drools项目：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule&gt;
  ...
  &lt;kbase name="KBase2" default="false" equalsBehavior="equality" packages="org.domain.pkg2, org.domain.pkg3" includes="KBase1"&gt;
    ...
  &lt;/kbase&gt;
  ...
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="execution-control-con_decision-engine"><a class="anchor" href="#execution-control-con_decision-engine"></a> <a class="link" href="#execution-control-con_decision-engine">3.3。Drools引擎中的执行控制</a></h3>
<div class="paragraph">
<p>当新规则数据进入Drools引擎的工作存储器时，规则可能会完全匹配并有资格执行。单个工作内存操作可以导致多个合格的规则执行。当规则完全匹配时，Drools引擎将创建激活实例，并引用规则和匹配的事实，并将激活添加到Drools引擎议程中。议程使用冲突解决策略控制这些规则激活的执行顺序。</p>
</div>
<div class="paragraph">
<p>第一次致电后<code>fireAllRules()</code>在Java应用程序中，Drools引擎重复经过两个阶段：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>议程评估。</strong> 在此阶段，Drools引擎选择所有可以执行的规则。如果不存在可执行规则，则执行周期结束。如果找到可执行规则，则Drools引擎会将激活记录在议程中，然后进入工作记忆操作阶段以执行规则后果操作。</p>
</li>
<li>
<p><strong>工作记忆动作。</strong> 在此阶段，Drools引擎执行规则结果操作（ <code>then</code>每个规则的一部分）以用于先前已在议程中注册的所有已激活规则。在所有结果操作完成或主要的Java应用程序过程调用之后<code>fireAllRules()</code>再次，Drools引擎返回到议程评估阶段以重新评估规则。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./HybridReasoning/Two_Phase.png" alt="两相">
</div>
<div class="title">图34。Drools引擎中的两阶段执行过程</div>
</div>
<div class="paragraph">
<p>当议程上存在多个规则时，一个规则的执行可能导致另一条规则从议程中删除。为了避免这种情况，您可以定义在Drools引擎中执行规则的方式和时间。定义规则执行顺序的一些常用方法是使用规则显着性，议程组，激活组或DRL规则集的规则单元。</p>
</div>
<div class="sect3">
<h4 id="_salience_for_rules"><a class="anchor" href="#_salience_for_rules"></a> <a class="link" href="#_salience_for_rules">3.3.1。突出规则</a></h4>
<div class="paragraph">
<p>每个规则都有一个整数<code>salience</code>确定执行顺序的属性。在激活队列中排序时，具有较高显着性值的规则将具有较高的优先级。规则的默认显着性值为零，但是显着性可以为负或正。</p>
</div>
<div class="paragraph">
<p>例如，以下示例DRL规则按所示顺序在Drools引擎堆栈中列出：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "RuleA"
salience 95
when
    $fact : MyFact( field1 == true )
then
    System.out.println("Rule2 : " + $fact);
    update($fact);
end

rule "RuleB"
salience 100
when
   $fact : MyFact( field1 == false )
then
   System.out.println("Rule1 : " + $fact);
   $fact.setField1(true);
   update($fact);
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>RuleB</code>规则列在第二位，但其显着性值高于<code>RuleA</code>规则，因此首先执行。</p>
</div>
</div>
<div class="sect3">
<h4 id="_agenda_groups_for_rules"><a class="anchor" href="#_agenda_groups_for_rules"></a> <a class="link" href="#_agenda_groups_for_rules">3.3.2。规则议程小组</a></h4>
<div class="paragraph">
<p>议程组是由同一组规则绑定在一起的一组规则<code>agenda-group</code>规则属性。议程将分区规则分组到Drools引擎议程上。在任何时候，只有一个小组<em>关注的重点</em>是使该小组规则优先于其他议程组中的规则执行。您可以使用<code>setFocus()</code>召集议程小组。您也可以使用<code>auto-focus</code>属性，以便下次激活该规则时，焦点将自动赋予该规则分配到的整个议程组。</p>
</div>
<div class="paragraph">
<p>每次<code>setFocus()</code>调用是在Java应用程序中进行的，Drools引擎将指定的议程组添加到规则堆栈的顶部。默认议程组<code>"MAIN"</code>包含不属于指定议程组的所有规则，并且在堆栈中首先执行，除非另一个组具有焦点。</p>
</div>
<div class="paragraph">
<p>例如，以下示例DRL规则属于指定的议程组，并按所示顺序在Drools引擎堆栈中列出：</p>
</div>
<div class="listingblock">
<div class="title">银行应用程序的示例DRL规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Increase balance for credits"
  agenda-group "calculation"
when
  ap : AccountPeriod()
  acc : Account( $accountNo : accountNo )
  CashFlow( type == CREDIT,
            accountNo == $accountNo,
            date &gt;= ap.start &amp;&amp; &lt;= ap.end,
            $amount : amount )
then
  acc.balance  += $amount;
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "Print balance for AccountPeriod"
  agenda-group "report"
when
  ap : AccountPeriod()
  acc : Account()
then
  System.out.println( acc.accountNo +
                      " : " + acc.balance );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中， <code>"report"</code>议程组必须始终首先执行，并且<code>"calculation"</code>议程小组必须始终第二次执行。然后可以执行其他议程组中的所有其余规则。因此， <code>"report"</code>和<code>"calculation"</code>组必须先获得焦点，然后才能执行其他规则：</p>
</div>
<div class="listingblock">
<div class="title">为议程组的执行顺序设置焦点</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Agenda agenda = ksession.getAgenda();
agenda.getAgendaGroup( "report" ).setFocus();
agenda.getAgendaGroup( "calculation" ).setFocus();
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="paragraph">
<p>您也可以使用<code>clear()</code>在每次执行之前取消属于给定议程组的规则所生成的所有激活的方法：</p>
</div>
<div class="listingblock">
<div class="title">取消所有其他规则激活</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.getAgenda().getAgendaGroup( "Group A" ).clear();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_activation_groups_for_rules"><a class="anchor" href="#_activation_groups_for_rules"></a> <a class="link" href="#_activation_groups_for_rules">3.3.3。规则激活组</a></h4>
<div class="paragraph">
<p>激活组是一组由相同规则绑定在一起的规则<code>activation-group</code>规则属性。在该组中，只能执行一个规则。在满足该组中要执行的规则的条件之后，该激活组中所有其他待执行的规则执行将从议程中删除。</p>
</div>
<div class="paragraph">
<p>例如，以下示例DRL规则属于指定的激活组，并按所示顺序在Drools引擎堆栈中列出：</p>
</div>
<div class="listingblock">
<div class="title">银行DRL规则样本</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Print balance for AccountPeriod1"
  activation-group "report"
when
  ap : AccountPeriod1()
  acc : Account()
then
  System.out.println( acc.accountNo +
                      " : " + acc.balance );
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "Print balance for AccountPeriod2"
  activation-group "report"
when
  ap : AccountPeriod2()
  acc : Account()
then
  System.out.println( acc.accountNo +
                      " : " + acc.balance );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，如果<code>"report"</code>执行激活组后，该组中的第二条规则以及该议程上的所有其他可执行规则将从议程中删除。</p>
</div>
</div>
<div class="sect3">
<h4 id="rule-execution-modes-con_decision-engine"><a class="anchor" href="#rule-execution-modes-con_decision-engine"></a> <a class="link" href="#rule-execution-modes-con_decision-engine">3.3.4。Drools引擎中的规则执行模式和线程安全</a></h4>
<div class="paragraph">
<p>Drools引擎支持以下规则执行模式，这些模式确定Drools引擎执行规则的方式和时间：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>被动模式</strong> ：（默认）当用户或应用程序明确调用时，Drools引擎会评估规则<code>fireAllRules()</code> 。Drools引擎中的被动模式最适合需要直接控制规则评估和执行的应用程序，或者是在Drools引擎中使用伪时钟实现的复杂事件处理（CEP）应用程序的最佳选择。</p>
<div class="listingblock">
<div class="title">Drools引擎在被动模式下的示例CEP应用程序代码</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration config = KieServices.Factory.get().newKieSessionConfiguration();
config.setOption( ClockTypeOption.get("pseudo") );
KieSession session = kbase.newKieSession( conf, null );
SessionPseudoClock clock = session.getSessionClock();

session.insert( tick1 );
session.fireAllRules();

clock.advanceTime(1, TimeUnit.SECONDS);
session.insert( tick2 );
session.fireAllRules();

clock.advanceTime(1, TimeUnit.SECONDS);
session.insert( tick3 );
session.fireAllRules();

session.dispose();</code></pre>
</div>
</div>
</li>
<li>
<p><strong>活动模式</strong> ：如果用户或应用程序调用<code>fireUntilHalt()</code> ，Drools引擎将以活动模式启动并持续评估规则，直到用户或应用程序明确调用<code>halt()</code> 。Drools引擎中的活动模式最适合将规则评估和执行控制权委派给Drools引擎的应用程序，或者最适合使用Drools引擎中的实时时钟实现的复杂事件处理（CEP）应用程序。对于使用活动查询的CEP应用程序，活动模式也是最佳选择。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Drools引擎处于活动模式时的示例CEP应用程序代码</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration config = KieServices.Factory.get().newKieSessionConfiguration();
config.setOption( ClockTypeOption.get("realtime") );
KieSession session = kbase.newKieSession( conf, null );

new Thread( new Runnable() {
  @Override
  public void run() {
      session.fireUntilHalt();
  }
} ).start();

session.insert( tick1 );

... Thread.sleep( 1000L ); ...

session.insert( tick2 );

... Thread.sleep( 1000L ); ...

session.insert( tick3 );

session.halt();
session.dispose();</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个例子调用<code>fireUntilHalt()</code>来自专用执行线程，以防止在Drools引擎继续评估规则时无限期地阻塞当前线程。专用线程还使您可以调用<code>halt()</code>在稍后的应用程序代码中。</p>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>虽然您应该避免同时使用<code>fireAllRules()</code>和<code>fireUntilHalt()</code>调用，尤其是来自不同线程的调用，Drools引擎可以使用线程安全逻辑和内部状态机安全地处理此类情况。如果一个<code>fireAllRules()</code>通话正在进行中，您致电<code>fireUntilHalt()</code> ，Drools引擎将继续以被动模式运行，直到<code>fireAllRules()</code>操作完成，然后响应于<code>fireUntilHalt()</code>呼叫。但是，如果在以下情况下Drools引擎以活动模式运行， <code>fireUntilHalt()</code>打电话，你打电话<code>fireAllRules()</code> ， <code>fireAllRules()</code>调用将被忽略，并且Drools引擎将继续以活动模式运行，直到您调用<code>halt()</code> 。有关线程安全和内部状态机的更多详细信息，请参见<a href="#_improved_multi_threading_behaviour">改进的多线程行为</a> 。</p>
</div>
<div class="paragraph">
<p>为了在活动模式下增加线程安全性，Drools引擎支持<code>submit()</code>可用于在线程安全的原子操作中对KIE会话进行分组和执行操作的方法：</p>
</div>
<div class="listingblock">
<div class="title">示例应用程序代码<code>submit()</code>在活动模式下执行原子操作的方法</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession session = ...;

new Thread( new Runnable() {
  @Override
  public void run() {
      session.fireUntilHalt();
  }
} ).start();

final FactHandle fh = session.insert( fact_a );

... Thread.sleep( 1000L ); ...

session.submit( new KieSession.AtomicAction() {
  @Override
  public void execute( KieSession kieSession ) {
    fact_a.setField("value");
    kieSession.update( fh, fact_a );
    kieSession.insert( fact_1 );
    kieSession.insert( fact_2 );
    kieSession.insert( fact_3 );
  }
} );

... Thread.sleep( 1000L ); ...

session.insert( fact_z );

session.halt();
session.dispose();</code></pre>
</div>
</div>
<div class="paragraph">
<p>从客户端的角度来看，线程安全和原子操作也很有帮助。例如，您可能需要在给定的时间插入多个事实，但是要求Drools引擎将插入视为原子操作，并等待直到所有插入完成后才能再次评估规则。</p>
</div>
</div>
<div class="sect3">
<h4 id="fact-propagation-modes-con_decision-engine"><a class="anchor" href="#fact-propagation-modes-con_decision-engine"></a> <a class="link" href="#fact-propagation-modes-con_decision-engine">3.3.5。Drools引擎中的事实传播模式</a></h4>
<div class="paragraph">
<p>Drools引擎支持以下事实传播模式，这些模式确定Drools引擎如何通过引擎网络处理插入的事实以为规则执行做准备：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>惰性</strong> ：（默认）事实是在规则执行时在批处理集合中传播的，而不是实时的，因为事实是由用户或应用程序单独插入的。结果，事实最终通过Drools引擎传播的顺序可能与事实被单独插入的顺序不同。</p>
</li>
<li>
<p><strong>立即</strong> ：事实按照用户或应用程序插入事实的顺序立即传播。</p>
</li>
<li>
<p><strong>渴望</strong> ：事实（在批处理集合中）延迟传播，但是在规则执行之前传播。Drools引擎将此传播行为用于具有<code>no-loop</code>要么<code>lock-on-active</code>属性。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>默认情况下，Drools引擎中的Phreak规则算法使用惰性事实传播来改善总体规则评估。但是，在极少数情况下，这种惰性传播行为可以更改某些可能需要立即传播或急切传播的规则执行的预期结果。</p>
</div>
<div class="paragraph">
<p>例如，以下规则将指定的查询与<code>?</code>前缀以仅拉动或被动方式调用查询：</p>
</div>
<div class="listingblock">
<div class="title">带有被动查询的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>query Q (Integer i)
    String( this == i.toString() )
end

rule "Rule"
  when
    $i : Integer()
    ?Q( $i; )
  then
    System.out.println( $i );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，仅当<code>String</code>在查询之前插入满足查询条件的<code>Integer</code> ，例如以下示例命令：</p>
</div>
<div class="listingblock">
<div class="title">应触发规则执行的示例命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession ksession = ...
ksession.insert("1");
ksession.insert(1);
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="paragraph">
<p>但是，由于Phreak中默认的延迟传播行为，因此在这种情况下，Drools引擎不会检测到两个事实的插入顺序，因此，无论<code>String</code>和<code>Integer</code>广告订单。对于此示例，期望的规则评估需要立即传播。</p>
</div>
<div class="paragraph">
<p>在这种情况下，要更改Drools引擎传播模式以实现预期的规则评估，您可以添加<code>@Propagation(<type>)</code>标记您的规则并设置<code><type></code>至<code>LAZY</code> ， <code>IMMEDIATE</code> ， 要么<code>EAGER</code> 。</p>
</div>
<div class="paragraph">
<p>在同一示例规则中，立即传播注释仅在以下情况下才可以评估规则： <code>String</code>在查询之前插入满足查询条件的<code>Integer</code> ，如预期：</p>
</div>
<div class="listingblock">
<div class="title">具有被动查询和指定传播模式的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>query Q (Integer i)
    String( this == i.toString() )
end

rule "Rule" @Propagation(IMMEDIATE)
  when
    $i : Integer()
    ?Q( $i; )
  then
    System.out.println( $i );
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="agenda-filters-con_decision-engine"><a class="anchor" href="#agenda-filters-con_decision-engine"></a> <a class="link" href="#agenda-filters-con_decision-engine">3.3.6。议程评估过滤器</a></h4>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./UserGuide/AgendaFilter.png" alt="议程过滤器">
</div>
<div class="title">图35。议程过滤器</div>
</div>
<div class="paragraph">
<p>Drools引擎支持<code>AgendaFilter</code>筛选器界面中的对象，可用于在议程评估期间允许或拒绝对指定规则的评估。您可以将议程过滤器指定为<code>fireAllRules()</code>呼叫。</p>
</div>
<div class="paragraph">
<p>以下示例代码仅允许以字符串结尾的规则<code>"Test"</code>进行评估和执行。所有其他规则都从Drools引擎议程中过滤掉。</p>
</div>
<div class="listingblock">
<div class="title">议程过滤器定义示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.fireAllRules( new RuleNameEndsWithAgendaFilter( "Test" ) );</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="drl-rule-units-con_decision-engine"><a class="anchor" href="#drl-rule-units-con_decision-engine"></a> <a class="link" href="#drl-rule-units-con_decision-engine">3.3.7。DRL规则集中的规则单位</a></h4>
<div class="paragraph">
<p>规则单元是为特定目的共同起作用的数据源，全局变量和DRL规则的组。您可以使用规则单元将规则集划分为较小的单元，将不同的数据源绑定到这些单元，然后执行单个单元。规则单元是规则分组DRL属性（例如规则议程组或用于执行控制的激活组）的增强替代方案。</p>
</div>
<div class="paragraph">
<p>当您要协调规则执行时，规则单元会很有用，这样一个规则单元的完全执行会触发另一个规则单元的开始，依此类推。例如，假定您具有一组用于数据充实的规则，另一组用于处理该数据的规则以及另一组从已处理数据中提取输出的规则。如果将这些规则集添加到三个不同的规则单元中，则可以协调这些规则单元，以便第一个单元的完全执行触发第二个单元的开始，而第二个单元的完全执行触发第三个单元的开始。</p>
</div>
<div class="paragraph">
<p>要定义规则单元，请实施<code>RuleUnit</code>界面如下例所示：</p>
</div>
<div class="listingblock">
<div class="title">规则单位类示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.mypackage.myunit;

public static class AdultUnit implements RuleUnit {
    private int adultAge;
    private DataSource&lt;Person&gt; persons;

    public AdultUnit( ) { }

    public AdultUnit( DataSource&lt;Person&gt; persons, int age ) {
        this.persons = persons;
        this.age = age;
    }

    // A data source of `Persons` in this rule unit:
    public DataSource&lt;Person&gt; getPersons() {
        return persons;
    }

    // A global variable in this rule unit:
    public int getAdultAge() {
        return adultAge;
    }

    // Life-cycle methods:
    @Override
    public void onStart() {
        System.out.println("AdultUnit started.");
    }

    @Override
    public void onEnd() {
        System.out.println("AdultUnit ended.");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子中<code>persons</code>是类型事实的来源<code>Person</code> 。规则单元数据源是由给定规则单元处理的数据的源，并表示Drools引擎用来评估规则单元的入口点。的<code>adultAge</code>可以从属于该规则单元的所有规则访问全局变量。后两种方法是规则单元生命周期的一部分，由Drools引擎调用。</p>
</div>
<div class="paragraph">
<p>Drools引擎为规则单元支持以下可选的生命周期方法：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表10。规则单元生命周期方法</caption>
<colgroup>
<col style="width:50%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">方法</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">何时调用</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>onStart()</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">规则单元开始执行</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>onEnd()</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">规则单元执行结束</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>onSuspend()</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">规则单元执行被暂停（仅用于<code>runUntilHalt()</code> ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>onResume()</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">恢复执行规则单元（仅用于<code>runUntilHalt()</code> ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>onYield(RuleUnit other)</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">规则单元中规则的结果触发另一个规则单元的执行</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>您可以将一个或多个规则添加到规则单元。默认情况下，DRL文件中的所有规则都将自动与遵循DRL文件名命名约定的规则单元相关联。如果DRL文件位于同一包中，并且与实现该文件的类具有相同的名称<code>RuleUnit</code>接口，则该DRL文件中的所有规则都隐式属于该规则单元。例如， <code>AdultUnit.drl</code>文件在<code>org.mypackage.myunit</code>包自动成为规则单元的一部分<code>org.mypackage.myunit.AdultUnit</code> 。</p>
</div>
<div class="paragraph">
<p>要覆盖此命名约定并明确声明DRL文件中的规则所属的规则单元，请使用<code>unit</code> DRL文件中的关键字。的<code>unit</code>声明必须紧随包声明之后，并包含该包中DRL文件中的规则所在的类的名称。</p>
</div>
<div class="listingblock">
<div class="title">DRL文件中的示例规则单位声明</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit AdultUnit

rule Adult
  when
    $p : Person(age &gt;= adultAge) from persons
  then
    System.out.println($p.getName() + " is adult and greater than " + adultAge);
end</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">不要在同一KIE库中混合使用规则单元和不使用规则单元的规则。在KIE基础中混合两个规则范例会导致编译错误。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>您还可以使用OOPath表示法以更方便的方式重写相同的模式，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">使用OOPath表示法的DRL文件中的示例规则单元声明</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit AdultUnit

rule Adult
  when
    $p : /persons[age &gt;= adultAge]
  then
    System.out.println($p.getName() + " is adult and greater than " + adultAge);
end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">OOPath是XPath的面向对象的语法扩展，旨在浏览DRL规则条件约束中的对象图。OOPath使用XPath的紧凑表示法在处理集合和过滤约束时浏览相关元素，尤其适用于对象图。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>在此示例中，规则条件中的所有匹配事实都将从<code>persons</code>在中定义的数据源<code>DataSource</code>规则单元类中的定义。规则条件和动作使用<code>adultAge</code>变量与在DRL文件级别定义全局变量的方式相同。</p>
</div>
<div class="paragraph">
<p>要执行在KIE库中定义的一个或多个规则单元，请创建一个新<code>RuleUnitExecutor</code>绑定到KIE基础的类，从相关数据源创建规则单元，然后运行规则单元执行程序：</p>
</div>
<div class="listingblock">
<div class="title">规则单位执行示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Create a `RuleUnitExecutor` class and bind it to the KIE base:
KieBase kbase = kieContainer.getKieBase();
RuleUnitExecutor executor = RuleUnitExecutor.create().bind( kbase );

// Create the `AdultUnit` rule unit using the `persons` data source and run the executor:
RuleUnit adultUnit = new AdultUnit(persons, 18);
executor.run( adultUnit );</code></pre>
</div>
</div>
<div class="paragraph">
<p>规则由<code>RuleUnitExecutor</code>类。的<code>RuleUnitExecutor</code>类创建KIE会话并添加所需的<code>DataSource</code>对象访问这些会话，然后根据<code>RuleUnit</code>作为参数传递给<code>run()</code>方法。</p>
</div>
<div class="paragraph">
<p>当相关时，示例执行代码将产生以下输出<code>Person</code>事实被插入<code>persons</code>数据源：</p>
</div>
<div class="listingblock">
<div class="title">规则单元执行输出示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>org.mypackage.myunit.AdultUnit started.
Jane is adult and greater than 18
John is adult and greater than 18
org.mypackage.myunit.AdultUnit ended.</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以在执行器中注册规则单元变量，然后将要运行的规则单元类传递给执行器，而不是显式创建规则单元实例，然后执行器创建规则单元的实例。然后，您可以设置<code>DataSource</code>运行规则单元之前，根据需要定义和其他变量。</p>
</div>
<div class="listingblock">
<div class="title">具有注册变量的备用规则单元执行选项</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">executor.bindVariable( "persons", persons );
        .bindVariable( "adultAge", 18 );
executor.run( AdultUnit.class );</code></pre>
</div>
</div>
<div class="paragraph">
<p>您传递给的名称<code>RuleUnitExecutor.bindVariable()</code>方法在运行时用于将变量绑定到具有相同名称的规则单元类的字段。在上一个示例中， <code>RuleUnitExecutor</code>将绑定到的数据源插入到新规则单元中<code>"persons"</code>命名并插入值<code>18</code>绑定到字符串<code>"adultAge"</code>进入具有相应名称的字段<code>AdultUnit</code>类。</p>
</div>
<div class="paragraph">
<p>要覆盖此默认的变量绑定行为，请使用<code>@UnitVar</code>注释，用于为规则单元类的每个字段显式定义逻辑绑定名称。例如，使用其他名称重新定义以下类中的字段绑定：</p>
</div>
<div class="listingblock">
<div class="title">使用以下代码修改变量绑定名称的示例代码<code>@UnitVar</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.mypackage.myunit;

public static class AdultUnit implements RuleUnit {
    @UnitVar("minAge")
    private int adultAge = 18;

    @UnitVar("data")
    private DataSource&lt;Person&gt; persons;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后，您可以使用这些备用名称将变量绑定到执行程序，并运行规则单元：</p>
</div>
<div class="listingblock">
<div class="title">具有修改的变量名称的示例规则单元执行</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">executor.bindVariable( "data", persons );
        .bindVariable( "minAge", 18 );
executor.run( AdultUnit.class );</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以通过以下<em>方式</em>在<em>被动模式下</em>执行规则单元： <code>run()</code>方法（相当于调用<code>fireAllRules()</code>在KIE会话上）或在<em>活动模式下</em>使用<code>runUntilHalt()</code>方法（相当于调用<code>fireUntilHalt()</code>在KIE会议上）。默认情况下，Drools引擎以<em>被动模式</em>运行，并且仅在用户或应用程序明确调用时评估规则单元<code>run()</code> （要么<code>fireAllRules()</code>对于标准规则）。如果用户或应用程序调用<code>runUntilHalt()</code>对于规则单位（或<code>fireUntilHalt()</code>对于标准规则），Drools引擎以<em>活动模式</em>启动并持续评估规则单元，直到用户或应用程序明确调用<code>halt()</code> 。</p>
</div>
<div class="paragraph">
<p>如果您使用<code>runUntilHalt()</code>方法，在单独的执行线程上调用该方法，以避免阻塞主线程：</p>
</div>
<div class="listingblock">
<div class="title">规则单元执行示例<code>runUntilHalt()</code>在单独的线程上</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">new Thread( () -&gt; executor.runUntilHalt( adultUnit ) ).start();</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_data_sources_for_rule_units"><a class="anchor" href="#_data_sources_for_rule_units"></a> <a class="link" href="#_data_sources_for_rule_units">3.3.7.1。规则单位的数据源</a></h5>
<div class="paragraph">
<p>规则单元数据源是由给定规则单元处理的数据的源，并表示Drools引擎用来评估规则单元的入口点。规则单位可以有零个或多个数据源，每个<code>DataSource</code>在规则单元内声明的定义可以对应于规则单元执行程序的另一个入口点。多个规则单元可以共享一个数据源，但是每个规则单元必须使用不同的入口点来插入相同的对象。</p>
</div>
<div class="paragraph">
<p>您可以创建一个<code>DataSource</code>规则单元类中具有一组固定数据的定义，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">数据源定义示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DataSource&lt;Person&gt; persons = DataSource.create( new Person( "John", 42 ),
                                                new Person( "Jane", 44 ),
                                                new Person( "Sally", 4 ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>因为数据源代表规则单元的入口点，所以您可以在规则单元中插入，更新或删除事实：</p>
</div>
<div class="listingblock">
<div class="title">在规则单元中插入，修改和删除事实的示例代码</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Insert a fact:
Person john = new Person( "John", 42 );
FactHandle johnFh = persons.insert( john );

// Modify the fact and optionally specify modified properties (for property reactivity):
john.setAge( 43 );
persons.update( johnFh, john, "age" );

// Delete the fact:
persons.delete( johnFh );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rule_unit_execution_control"><a class="anchor" href="#_rule_unit_execution_control"></a> <a class="link" href="#_rule_unit_execution_control">3.3.7.2。规则单元执行控制</a></h5>
<div class="paragraph">
<p>当您要协调规则执行时，规则单元会很有用，这样一个规则单元的执行会触发另一个规则单元的启动，依此类推。</p>
</div>
<div class="paragraph">
<p>为了促进规则单元执行控制，Drools引擎支持以下规则单元方法，您可以在DRL规则操作中使用这些方法来协调规则单元的执行：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>drools.run()</code> ：触发指定规则单元类的执行。此方法必须中断规则单元的执行并激活其他指定的规则单元。</p>
</li>
<li>
<p><code>drools.guard()</code> ：防止（保护）指定规则单元类的执行，直到满足关联的规则条件为止。此方法以声明方式调度其他指定规则单元的执行。当Drools引擎针对防护规则中的条件产生至少一个匹配项时，该防护规则单元被认为是活动的。一个规则单元可以包含多个保护规则。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>作为一个例子<code>drools.run()</code>方法，请考虑以下DRL规则，每个规则均属于指定的规则单元。的<code>NotAdult</code>规则使用<code>drools.run( AdultUnit.class )</code>触发执行的方法<code>AdultUnit</code>规则单位：</p>
</div>
<div class="listingblock">
<div class="title">使用控制执行的示例DRL规则<code>drools.run()</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit AdultUnit

rule Adult
  when
    Person(age &gt;= 18, $name : name) from persons
  then
    System.out.println($name + " is adult");
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit NotAdultUnit

rule NotAdult
  when
    $p : Person(age &lt; 18, $name : name) from persons
  then
    System.out.println($name + " is NOT adult");
    modify($p) { setAge(18); }
    drools.run( AdultUnit.class );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>该示例还使用了<code>RuleUnitExecutor</code>从KIE基础创建的课程，这些基础是根据这些规则和<code>DataSource</code>的定义<code>persons</code>绑定到它：</p>
</div>
<div class="listingblock">
<div class="title">示例规则执行器和数据源定义</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RuleUnitExecutor executor = RuleUnitExecutor.create().bind( kbase );
DataSource&lt;Person&gt; persons = executor.newDataSource( "persons",
                                                     new Person( "John", 42 ),
                                                     new Person( "Jane", 44 ),
                                                     new Person( "Sally", 4 ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，示例将创建<code>DataSource</code>直接从<code>RuleUnitExecutor</code>类并将其绑定到<code>"persons"</code>单个语句中的变量。</p>
</div>
<div class="paragraph">
<p>当相关时，示例执行代码将产生以下输出<code>Person</code>事实被插入<code>persons</code>数据源：</p>
</div>
<div class="listingblock">
<div class="title">规则单元执行输出示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>Sally is NOT adult
John is adult
Jane is adult
Sally is adult</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>NotAdult</code>评估人时，规则会检测到匹配项<code>"Sally"</code> ，未满18岁。然后，该规则将她的年龄修改为<code>18</code>并使用<code>drools.run( AdultUnit.class )</code>触发执行的方法<code>AdultUnit</code>规则单位。的<code>AdultUnit</code>规则单元包含一个规则，现在可以对这3个规则全部执行<code>persons</code>在里面<code>DataSource</code>定义。</p>
</div>
<div class="paragraph">
<p>作为一个例子<code>drools.guard()</code>方法，请考虑以下<code>BoxOffice</code>类和<code>BoxOfficeUnit</code>规则单元类别：</p>
</div>
<div class="listingblock">
<div class="title">例<code>BoxOffice</code>类</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class BoxOffice {
    private boolean open;

    public BoxOffice( boolean open ) {
        this.open = open;
    }

    public boolean isOpen() {
        return open;
    }

    public void setOpen( boolean open ) {
        this.open = open;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">例<code>BoxOfficeUnit</code>规则单元类</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class BoxOfficeUnit implements RuleUnit {
    private DataSource&lt;BoxOffice&gt; boxOffices;

    public DataSource&lt;BoxOffice&gt; getBoxOffices() {
        return boxOffices;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该示例还使用以下内容<code>TicketIssuerUnit</code>规则单位的类别，只要至少打开一个票房，就可以继续出售该活动的票房。该规则单元使用<code>DataSource</code>的定义<code>persons</code>和<code>tickets</code> ：</p>
</div>
<div class="listingblock">
<div class="title">例<code>TicketIssuerUnit</code>规则单元类</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class TicketIssuerUnit implements RuleUnit {
    private DataSource&lt;Person&gt; persons;
    private DataSource&lt;AdultTicket&gt; tickets;

    private List&lt;String&gt; results;

    public TicketIssuerUnit() { }

    public TicketIssuerUnit( DataSource&lt;Person&gt; persons, DataSource&lt;AdultTicket&gt; tickets ) {
        this.persons = persons;
        this.tickets = tickets;
    }

    public DataSource&lt;Person&gt; getPersons() {
        return persons;
    }

    public DataSource&lt;AdultTicket&gt; getTickets() {
        return tickets;
    }

    public List&lt;String&gt; getResults() {
        return results;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>BoxOfficeUnit</code>规则单元包含一个<code>BoxOfficeIsOpen</code> DRL规则使用<code>drools.guard( TicketIssuerUnit.class )</code>防止执行的方法<code>TicketIssuerUnit</code>分发事件票证的规则单元，如以下DRL规则示例所示：</p>
</div>
<div class="listingblock">
<div class="title">使用控制执行的示例DRL规则<code>drools.guard()</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit;
unit TicketIssuerUnit;

rule IssueAdultTicket when
    $p: /persons[ age &gt;= 18 ]
then
    tickets.insert(new AdultTicket($p));
end
rule RegisterAdultTicket when
    $t: /tickets
then
    results.add( $t.getPerson().getName() );
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit;
unit BoxOfficeUnit;

rule BoxOfficeIsOpen
  when
    $box: /boxOffices[ open ]
  then
    drools.guard( TicketIssuerUnit.class );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，只要至少有一个票房<code>open</code> ，守卫<code>TicketIssuerUnit</code>规则单元处于活动状态并分发事件票证。当没有更多的票房<code>open</code>国家，守卫<code>TicketIssuerUnit</code>阻止执行规则单元。</p>
</div>
<div class="paragraph">
<p>以下示例类说明了更完整的票房情况：</p>
</div>
<div class="listingblock">
<div class="title">票房场景的示例类</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DataSource&lt;Person&gt; persons = executor.newDataSource( "persons" );
DataSource&lt;BoxOffice&gt; boxOffices = executor.newDataSource( "boxOffices" );
DataSource&lt;AdultTicket&gt; tickets = executor.newDataSource( "tickets" );

List&lt;String&gt; list = new ArrayList&lt;&gt;();
executor.bindVariable( "results", list );

// Two box offices are open:
BoxOffice office1 = new BoxOffice(true);
FactHandle officeFH1 = boxOffices.insert( office1 );
BoxOffice office2 = new BoxOffice(true);
FactHandle officeFH2 = boxOffices.insert( office2 );

persons.insert(new Person("John", 40));

// Execute `BoxOfficeIsOpen` rule, run `TicketIssuerUnit` rule unit, and execute `RegisterAdultTicket` rule:
executor.run(BoxOfficeUnit.class);

assertEquals( 1, list.size() );
assertEquals( "John", list.get(0) );
list.clear();

persons.insert(new Person("Matteo", 30));

// Execute `RegisterAdultTicket` rule:
executor.run(BoxOfficeUnit.class);

assertEquals( 1, list.size() );
assertEquals( "Matteo", list.get(0) );
list.clear();

// One box office is closed, the other is open:
office1.setOpen(false);
boxOffices.update(officeFH1, office1);
persons.insert(new Person("Mark", 35));
executor.run(BoxOfficeUnit.class);

assertEquals( 1, list.size() );
assertEquals( "Mark", list.get(0) );
list.clear();

// All box offices are closed:
office2.setOpen(false);
boxOffices.update(officeFH2, office2); // Guarding rule is no longer true.
persons.insert(new Person("Edson", 35));
executor.run(BoxOfficeUnit.class); // No execution

assertEquals( 0, list.size() );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rule_unit_identity_conflicts"><a class="anchor" href="#_rule_unit_identity_conflicts"></a> <a class="link" href="#_rule_unit_identity_conflicts">3.3.7.3。规则单位身份冲突</a></h5>
<div class="paragraph">
<p>在具有受保护规则单元的规则单元执行方案中，一个规则可以保护多个规则单元，并且可以同时保护一个规则单元，然后由多个规则激活。对于这些双向保护方案，规则单元必须具有明确定义的身份，以避免身份冲突。</p>
</div>
<div class="paragraph">
<p>默认情况下，规则单元的标识是规则单元类的名称，并且被规则单元视为单例类。 <code>RuleUnitExecutor</code> 。此识别行为编码在<code>getUnitIdentity()</code>的默认方法<code>RuleUnit</code>接口：</p>
</div>
<div class="listingblock">
<div class="title">中的默认身份方法<code>RuleUnit</code>接口</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">default Identity getUnitIdentity() {
    return new Identity( getClass() );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在某些情况下，您可能需要覆盖此默认标识行为，以避免规则单元之间的标识冲突。</p>
</div>
<div class="paragraph">
<p>例如，以下<code>RuleUnit</code>类包含一个<code>DataSource</code>接受任何对象的定义：</p>
</div>
<div class="listingblock">
<div class="title">例<code>Unit0</code>规则单元类</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Unit0 implements RuleUnit {
    private DataSource&lt;Object&gt; input;

    public DataSource&lt;Object&gt; getInput() {
        return input;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>此规则单元包含以下DRL规则，该规则基于两个条件（以OOPath表示法）保护另一个规则单元：</p>
</div>
<div class="listingblock">
<div class="title">例<code>GuardAgeCheck</code>规则单元中的DRL规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit Unit0

rule GuardAgeCheck
  when
    $i: /input#Integer
    $s: /input#String
  then
    drools.guard( new AgeCheckUnit($i) );
    drools.guard( new AgeCheckUnit($s.length()) );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>守卫<code>AgeCheckUnit</code>规则单元验证一组<code>persons</code> 。的<code>AgeCheckUnit</code>包含一个<code>DataSource</code>的定义<code>persons</code>检查，一个<code>minAge</code>验证所针对的变量，以及<code>List</code>用于收集结果：</p>
</div>
<div class="listingblock">
<div class="title">例<code>AgeCheckUnit</code>规则单位</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AgeCheckUnit implements RuleUnit {
    private final int minAge;
    private DataSource&lt;Person&gt; persons;
    private List&lt;String&gt; results;

    public AgeCheckUnit( int minAge ) {
        this.minAge = minAge;
    }

    public DataSource&lt;Person&gt; getPersons() {
        return persons;
    }

    public int getMinAge() {
        return minAge;
    }

    public List&lt;String&gt; getResults() {
        return results;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>AgeCheckUnit</code>规则单元包含以下DRL规则，用于对<code>persons</code>在数据源中：</p>
</div>
<div class="listingblock">
<div class="title">例<code>CheckAge</code>规则单元中的DRL规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit AgeCheckUnit

rule CheckAge
  when
    $p : /persons{ age &gt; minAge }
  then
    results.add($p.getName() + "&gt;" + minAge);
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>本示例创建一个<code>RuleUnitExecutor</code>类，将该类绑定到包含这两个规则单元的KIE基础，并创建两个<code>DataSource</code>相同规则单位的定义：</p>
</div>
<div class="listingblock">
<div class="title">执行程序和数据源定义示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RuleUnitExecutor executor = RuleUnitExecutor.create().bind( kbase );

DataSource&lt;Object&gt; input = executor.newDataSource( "input" );
DataSource&lt;Person&gt; persons = executor.newDataSource( "persons",
                                                     new Person( "John", 42 ),
                                                     new Person( "Sally", 4 ) );

List&lt;String&gt; results = new ArrayList&lt;&gt;();
executor.bindVariable( "results", results );</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在，您可以将一些对象插入输入数据源并执行<code>Unit0</code>规则单位：</p>
</div>
<div class="listingblock">
<div class="title">带有插入对象的示例规则单元执行</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ds.insert("test");
ds.insert(3);
ds.insert(4);
executor.run(Unit0.class);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">执行中的示例结果列表</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">[Sally&gt;3, John&gt;3]</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，规则单元名为<code>AgeCheckUnit</code>被视为单例类，然后仅执行一次， <code>minAge</code>变量设置为<code>3</code> 。既弦乐<code>"test"</code>和整数<code>4</code>插入到输入数据源中还可以使用<code>minAge</code>变量设置为<code>4</code> 。但是，不会执行第二次执行，因为已经评估了另一个具有相同标识的规则单元。</p>
</div>
<div class="paragraph">
<p>要解决此规则单元身份冲突，请覆盖<code>getUnitIdentity()</code>中的方法<code>AgeCheckUnit</code>类还包括<code>minAge</code>规则单位标识中的变量：</p>
</div>
<div class="listingblock">
<div class="title">改性<code>AgeCheckUnit</code>规则单元来覆盖<code>getUnitIdentity()</code>方法</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AgeCheckUnit implements RuleUnit {

    ...

    @Override
    public Identity getUnitIdentity() {
        return new Identity(getClass(), minAge);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>有了此覆盖后，先前的示例规则单元执行将产生以下输出：</p>
</div>
<div class="listingblock">
<div class="title">执行修改后的规则单元的示例结果列表</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">[John&gt;4, Sally&gt;3, John&gt;3]</code></pre>
</div>
</div>
<div class="paragraph">
<p>规则单位<code>minAge</code>调成<code>3</code>和<code>4</code>现在被认为是两个不同的规则单元，并且都被执行。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="phreak-algorithm-con_decision-engine"><a class="anchor" href="#phreak-algorithm-con_decision-engine"></a> <a class="link" href="#phreak-algorithm-con_decision-engine">3.4。Drools引擎中的Phreak规则算法</a></h3>
<div class="paragraph">
<p>Drools中的Drools引擎使用Phreak算法进行规则评估。Phreak从Rete算法发展而来，包括在面向对象系统的Drools的早期版本中引入的增强的Rete算法ReteOO。总体而言，Phreak比Rete和ReteOO更具可伸缩性，并且在大型系统中速度更快。</p>
</div>
<div class="paragraph">
<p>虽然Rete被认为是急切的（立即规则评估）和面向数据的，但是Phreak被认为是懒惰的（延迟规则评估）和面向目标的。Rete算法在插入，更新和删除操作期间执行许多操作，以便找到所有规则的部分匹配项。在规则匹配期间，Rete算法的这种急切性需要大量时间才能最终执行规则，尤其是在大型系统中。使用Phreak，故意延迟规则的部分匹配，以更有效地处理大量数据。</p>
</div>
<div class="paragraph">
<p>Phreak算法为以前的Rete算法增加了以下增强功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>三层上下文存储器：节点，段和规则存储器类型</p>
</li>
<li>
<p>基于规则，基于段和基于节点的链接</p>
</li>
<li>
<p>懒惰（延迟）规则评估</p>
</li>
<li>
<p>基于堆栈的评估，包括暂停和恢复</p>
</li>
<li>
<p>孤立规则评估</p>
</li>
<li>
<p>面向集合的传播</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="phreak-rule-evaluation-con_decision-engine"><a class="anchor" href="#phreak-rule-evaluation-con_decision-engine"></a> <a class="link" href="#phreak-rule-evaluation-con_decision-engine">3.4.1。Phreak中的规则评估</a></h4>
<div class="paragraph">
<p>当Drools引擎启动时，所有规则都被视为与可能触发规则的模式匹配数据<em>断开链接</em> 。在此阶段，Drools引擎中的Phreak算法不会评估规则。的<code>insert</code> ， <code>update</code>和<code>delete</code>将操作排入队列，然后Phreak根据最有可能导致执行的规则使用启发式算法来计算并选择下一条评估规则。当为规则填充所有必需的输入值时，该规则被视为已<em>链接</em>到相关的模式匹配数据。然后，Phreak创建一个代表该规则的目标，并将该目标放入按规则显着性排序的优先级队列。仅评估为其创建目标的规则，而其他潜在规则评估则被延迟。在评估各个规则时，仍然可以通过分段过程来实现节点共享。</p>
</div>
<div class="paragraph">
<p>与面向元组的Rete不同，Phreak传播面向集合。对于正在评估的规则，Drools引擎访问第一个节点并处理所有排队的插入，更新和删除操作。将结果添加到集合中，并将该集合传播到子节点。在子节点中，将处理所有排队的插入，更新和删除操作，并将结果添加到同一集合中。然后将集合传播到下一个子节点，并重复相同的过程，直到到达终端节点。此循环创建了批处理效果，可以为某些规则构造提供性能优势。</p>
</div>
<div class="paragraph">
<p>规则的链接和取消链接通过基于网络分段的分层位掩码系统进行。构建规则网络后，将为由同一组规则共享的规则网络节点创建分段。规则由段的路径组成。如果某个规则不与任何其他规则共享任何节点，则它将成为单个段。</p>
</div>
<div class="paragraph">
<p>将位掩码偏移量分配给段中的每个节点。根据这些要求，将另一个位掩码分配给规则路径中的每个段：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果存在一个节点的至少一个输入，则将节点位设置为<code>on</code>州。</p>
</li>
<li>
<p>如果段中的每个节点的位都设置为<code>on</code>状态，段位也设置为<code>on</code>州。</p>
</li>
<li>
<p>如果任何节点位设置为<code>off</code>状态，该细分也设置为<code>off</code>州。</p>
</li>
<li>
<p>如果规则路径中的每个细分均设置为<code>on</code>状态，则将规则视为已链接，并创建一个目标来计划该规则以进行评估。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>相同的位掩码技术用于跟踪修改的节点，段和规则。如果自从创建链接规则的评估目标以来对其进行了修改，则此跟踪功能可以使已链接的规则从评估中取消计划。结果，没有规则可以评估部分匹配。</p>
</div>
<div class="paragraph">
<p>在Phreak中，规则评估的过程是可能的，因为与Rete中的单个存储单元不同，Phreak具有三层上下文存储，分别具有节点，段和规则存储类型。此分层可在规则评估期间实现更多的上下文理解。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./HybridReasoning/LayeredMemory.png" alt="分层内存">
</div>
<div class="title">图36。Phreak三层存储系统</div>
</div>
<div class="paragraph">
<p>以下示例说明了在Phreak的三层内存系统中如何组织和评估规则。</p>
</div>
<div class="paragraph">
<p><strong>示例1：</strong>具有三种模式的单个规则（R1）：A，B和C。该规则形成单个段，节点的位1、2和4。单段的位偏移为1。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./HybridReasoning/segment1.png" alt="段1">
</div>
<div class="title">图37。示例1：单条规则</div>
</div>
<div class="paragraph">
<p><strong>示例2：</strong>添加规则R2并共享模式A。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./HybridReasoning/segment2.png" alt="段2">
</div>
<div class="title">图38。示例2：具有模式共享的两个规则</div>
</div>
<div class="paragraph">
<p>模式A放置在其自己的段中，每个规则产生两个段。这两个部分构成了它们各自规则的路径。第一条路段由两条路径共享。当模式A被链接时，该段将被链接。然后，该段会在共享该段的每个路径上进行迭代，将位1设置为<code>on</code> 。如果稍后打开模式B和C，则链接路径R1的第二个段，这将导致R1的位2被打开。在R1的第1位和第2位打开的情况下，现在链接了规则，并创建了一个目标来调度规则以供以后评估和执行。</p>
</div>
<div class="paragraph">
<p>评估规则时，这些细分可以共享匹配结果。每个段都有一个临时存储器，用于将该段的所有插入，更新和删除排队。评估R1时，规则将处理模式A，这将导致一组元组。该算法检测分段拆分，为集合中的每个插入，更新和删除创建对等元组，并将它们添加到R2分段内存中。然后，这些元组与任何现有的暂存元组合并，并在最终评估R2时执行。</p>
</div>
<div class="paragraph">
<p><strong>示例3：</strong>添加规则R3和R4并共享模式A和B。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./HybridReasoning/segment3.png" alt="段3">
</div>
<div class="title">图39。示例3：具有模式共享的三个规则</div>
</div>
<div class="paragraph">
<p>规则R3和R4具有三个段，R1具有两个段。模式A和B由R1，R3和R4共享，而模式D由R3和R4共享。</p>
</div>
<div class="paragraph">
<p><strong>示例4：</strong>具有子网且没有模式共享的单个规则（R1）。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./HybridReasoning/segment4.png" alt="段4">
</div>
<div class="title">图40。示例4：具有子网且没有模式共享的单个规则</div>
</div>
<div class="paragraph">
<p>当<code>Not</code> ， <code>Exists</code> ， 要么<code>Accumulate</code>节点包含多个元素。在此示例中，元素<code>B not( C )</code>形成子网。元素<code>not( C )</code>是不需要子网的单个元素，因此被合并到<code>Not</code>节点。子网使用专用网段。规则R1仍然具有两个段的路径，并且子网形成了另一个内部路径。当子网链接时，它也在外部网段中链接。</p>
</div>
<div class="paragraph">
<p><strong>示例5：</strong>规则R1和规则R2共享的子网。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./HybridReasoning/segment5.png" alt="段5">
</div>
<div class="title">图41。示例5：两个规则，一个规则具有子网和模式共享</div>
</div>
<div class="paragraph">
<p>规则中的子网节点可以由另一个没有子网的规则共享。这种共享导致子网段被分为两个段。</p>
</div>
<div class="paragraph">
<p>受约束的<code>Not</code>节点和<code>Accumulate</code>节点永远无法取消链接段，并且始终认为它们的位已打开。</p>
</div>
<div class="paragraph">
<p>Phreak评估算法是基于堆栈的，而不是基于方法递归的。规则评估可以在以下情况下随时暂停和恢复： <code>StackEntry</code>用于表示当前正在评估的节点。</p>
</div>
<div class="paragraph">
<p>当规则评估到达子网时， <code>StackEntry</code>为外部路径段和子网段创建对象。首先评估子网段，然后当集合到达子网路径的末尾时，将该段合并到该段所馈入的外部节点的暂存列表中。以前的<code>StackEntry</code>然后恢复对象，现在可以处理子网的结果。此过程具有额外的好处，尤其是对于<code>Accumulate</code>在传播到子节点之前，所有工作分批完成。</p>
</div>
<div class="paragraph">
<p>相同的堆栈系统用于有效的反向链接。当规则评估到达查询节点时，评估将暂停并将查询添加到堆栈中。然后评估查询以生成结果集，将其保存在存储位置中以供恢复<code>StackEntry</code>对象以拾取并传播到子节点。如果查询本身调用了其他查询，则该过程将重复，同时暂停当前查询，并为当前查询节点设置新的评估。</p>
</div>
<div class="sect4">
<h5 id="forward-and-backward-chaining-con_decision-engine"><a class="anchor" href="#forward-and-backward-chaining-con_decision-engine"></a> <a class="link" href="#forward-and-backward-chaining-con_decision-engine">3.4.1.1。向前和向后链接的规则评估</a></h5>
<div class="paragraph">
<p>Drools中的Drools引擎是一种混合推理系统，它使用前向链接和后向链接来评估规则。前向链接规则系统是一种数据驱动的系统，它从Drools引擎的工作内存中的一个事实开始，并对这个事实做出反应。将对象插入工作存储器后，所有因更改而变为真的规则条件都将安排在议程中执行。</p>
</div>
<div class="paragraph">
<p>相反，后向链接规则系统是一种目标驱动的系统，其结论是Drools引擎经常使用递归来尝试满足。如果系统无法达到结论或目标，它将搜索子目标，即完成当前目标一部分的结论。系统继续此过程，直到满足初始结论或满足所有子目标为止。</p>
</div>
<div class="paragraph">
<p>下图说明了Drools引擎如何使用整体前向链接和逻辑流程中的后向链接段来评估规则：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/BackwardChaining/RuleEvaluation.png" alt="规则评估">
</div>
<div class="title">图42。使用向前和向后链接的规则评估逻辑</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rule-base-configuration-con_decision-engine"><a class="anchor" href="#rule-base-configuration-con_decision-engine"></a> <a class="link" href="#rule-base-configuration-con_decision-engine">3.4.2。规则库配置</a></h4>
<div class="paragraph">
<p>流口水包含<code>RuleBaseConfiguration.java</code>可用于在Drools引擎中配置异常处理程序设置，多线程执行和顺序模式的对象。</p>
</div>
<div class="paragraph">
<p>有关规则库的配置选项，请参见GitHub上的Drools <a href="https://github.com/kiegroup/drools/blob/7.26.x/drools-core/src/main/java/org/drools/core/RuleBaseConfiguration.java">RuleBaseConfiguration.java</a>页面。</p>
</div>
<div class="paragraph">
<p>以下规则库配置选项可用于Drools引擎：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">drools.consequenceExceptionHandler</dt>
<dd>
<p>配置后，此系统属性将定义用于管理规则后果引发的异常的类。您可以使用此属性为Drools引擎中的规则评估指定自定义异常处理程序。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认值：<code>org.drools.core.runtime.rule.impl.DefaultConsequenceExceptionHandler</code></p>
</div>
<div class="paragraph">
<p>您可以使用以下选项之一指定自定义异常处理程序：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在系统属性中指定异常处理程序：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>drools.consequenceExceptionHandler=org.drools.core.runtime.rule.impl.MyCustomConsequenceExceptionHandler</code></pre>
</div>
</div>
</li>
<li>
<p>以编程方式创建KIE基础时，请指定异常处理程序：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieBaseConfiguration kieBaseConf = ks.newKieBaseConfiguration(); kieBaseConf.setOption(ConsequenceExceptionHandlerOption.get(MyCustomConsequenceExceptionHandler.class));
KieBase kieBase = kieContainer.newKieBase(kieBaseConf);</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">drools.multithreadEvaluation</dt>
<dd>
<p>启用后，此系统属性使Drools引擎可以通过将Phreak规则网络划分为独立的分区来并行评估规则。您可以使用此属性来提高特定规则库的规则评估速度。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认值：<code>false</code></p>
</div>
<div class="paragraph">
<p>您可以使用以下选项之一启用多线程评估：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>启用多线程评估系统属性：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>drools.multithreadEvaluation=true</code></pre>
</div>
</div>
</li>
<li>
<p>以编程方式创建KIE基础时启用多线程评估：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieBaseConfiguration kieBaseConf = ks.newKieBaseConfiguration();
kieBaseConf.setOption(MultithreadEvaluationOption.YES);
KieBase kieBase = kieContainer.newKieBase(kieBaseConf);</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p>并行Drools引擎当前不支持使用查询，显着性或议程组的规则。如果KIE库中存在这些规则元素，则编译器将发出警告并自动切换回单线程评估。但是，在某些情况下，Drools引擎可能无法检测到不受支持的规则元素，并且可能会错误地评估规则。例如，Drools引擎可能无法检测规则何时依赖DRL文件中规则排序所提供的隐式显着性，从而由于不支持的显着性属性而导致评估不正确。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">流口水</dt>
<dd>
<p>启用后，此系统属性将在Drools引擎中启用顺序模式。在顺序模式下，Drools引擎按规则在Drools引擎议程中列出的顺序一次评估规则，而不考虑工作内存的变化。这意味着Drools引擎会忽略任何<code>insert</code> ， <code>modify</code> ， 要么<code>update</code>规则中的语句，并按单个顺序执行规则。结果，在顺序模式下规则执行可能会更快，但是重要的更新可能不会应用于您的规则。如果使用无状态的KIE会话，并且您不希望规则的执行影响议程中的后续规则，则可以使用此属性。顺序模式仅适用于无状态KIE会话。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认值：<code>false</code></p>
</div>
<div class="paragraph">
<p>您可以使用以下选项之一启用顺序模式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>启用顺序模式系统属性：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>drools.sequential=true</code></pre>
</div>
</div>
</li>
<li>
<p>以编程方式创建KIE基础时启用顺序模式：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieBaseConfiguration kieBaseConf = ks.newKieBaseConfiguration();
kieBaseConf.setOption(SequentialOption.YES);
KieBase kieBase = kieContainer.newKieBase(kieBaseConf);</code></pre>
</div>
</div>
</li>
<li>
<p>在KIE模块描述符文件中启用顺序模式（ <code>kmodule.xml</code> ）用于特定的Drools项目：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule&gt;
  ...
  &lt;kbase name="KBase2" default="false" sequential="true" packages="org.domain.pkg2, org.domain.pkg3" includes="KBase1"&gt;
    ...
  &lt;/kbase&gt;
  ...
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="phreak-sequential-mode-con_decision-engine"><a class="anchor" href="#phreak-sequential-mode-con_decision-engine"></a> <a class="link" href="#phreak-sequential-mode-con_decision-engine">3.4.3。Phreak中的顺序模式</a></h4>
<div class="paragraph">
<p>顺序模式是Drools引擎中高级的基于规则的配置，由Phreak支持，该模式使Drools引擎可以按规则在Drools引擎议程中列出的顺序一次评估规则，而无需考虑工作内存的变化。在顺序模式下，Drools引擎会忽略任何<code>insert</code> ， <code>modify</code> ， 要么<code>update</code>规则中的语句，并按单个顺序执行规则。结果，在顺序模式下规则执行可能会更快，但是重要的更新可能不会应用于您的规则。</p>
</div>
<div class="paragraph">
<p>顺序模式仅适用于无状态KIE会话，因为有状态KIE会话固有地使用来自先前调用的KIE会话的数据。如果使用无状态KIE会话，并且希望规则的执行影响议程中的后续规则，则不要启用顺序模式。默认情况下，在Drools引擎中禁用顺序模式。</p>
</div>
<div class="paragraph">
<p>要启用顺序模式，请使用以下选项之一：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>设置系统属性<code>drools.sequential</code>至<code>true</code> 。</p>
</li>
<li>
<p>以编程方式创建KIE基础时启用顺序模式：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieBaseConfiguration kieBaseConf = ks.newKieBaseConfiguration();
kieBaseConf.setOption(SequentialOption.YES);
KieBase kieBase = kieContainer.newKieBase(kieBaseConf);</code></pre>
</div>
</div>
</li>
<li>
<p>在KIE模块描述符文件中启用顺序模式（ <code>kmodule.xml</code> ）用于特定的Drools项目：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule&gt;
  ...
  &lt;kbase name="KBase2" default="false" sequential="true" packages="org.domain.pkg2, org.domain.pkg3" includes="KBase1"&gt;
    ...
  &lt;/kbase&gt;
  ...
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>要将连续模式配置为使用动态议程，请使用以下选项之一：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>设置系统属性<code>drools.sequential.agenda</code>至<code>dynamic</code> 。</p>
</li>
<li>
<p>以编程方式创建KIE基础时，设置顺序议程选项：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieBaseConfiguration kieBaseConf = ks.newKieBaseConfiguration();
kieBaseConf.setOption(SequentialAgendaOption.DYNAMIC);
KieBase kieBase = kieContainer.newKieBase(kieBaseConf);</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>启用顺序模式时，Drools引擎将通过以下方式评估规则：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>规则按显着性和在规则集中的位置排序。</p>
</li>
<li>
<p>将为每个可能的规则匹配创建一个元素。元素位置指示执行顺序。</p>
</li>
<li>
<p>节点存储器被禁用，右输入对象存储器除外。</p>
</li>
<li>
<p>左输入适配器节点的传播已断开，并且带有该节点的对象在<code>Command</code>宾语。的<code>Command</code>对象将添加到工作存储器中的列表中，以供以后执行。</p>
</li>
<li>
<p>声明所有对象，然后声明<code>Command</code>检查并执行对象。</p>
</li>
<li>
<p>执行列表产生的所有匹配项都将根据规则的序列号添加到元素中。</p>
</li>
<li>
<p>包含匹配项的元素按顺序执行。如果您设置规则执行的最大数量，则Drools引擎激活的议程中的规则数量不超过该数量。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>在顺序模式下， <code>LeftInputAdapterNode</code>节点创建一个<code>Command</code>对象并将其添加到Drools引擎的工作内存中的列表中。这个<code>Command</code>对象包含对的引用<code>LeftInputAdapterNode</code>节点和传播的对象。这些引用在插入时停止任何左输入传播，因此右输入传播永远不需要尝试加入左输入。这些参考还避免了需要左输入存储器。</p>
</div>
<div class="paragraph">
<p>关闭所有节点的内存，包括左输入元组内存，但右输入对象内存除外。在完成所有断言并填充所有对象的右输入内存之后，Drools引擎将在以下列表中进行迭代： <code>LeftInputAdatperNode</code><code>Command</code>对象。对象沿网络传播，尝试加入右输入对象，但未保留在左输入中。</p>
</div>
<div class="paragraph">
<p>具有优先级队列以计划元组的议程由每个规则的元素替换。的序号<code>RuleTerminalNode</code>节点指示放置匹配项的元素。毕竟<code>Command</code>对象已完成，将检查元素并执行现有匹配。为了提高性能，保留了元素中的第一个和最后一个填充的单元格。</p>
</div>
<div class="paragraph">
<p>构建网络时，每个<code>RuleTerminalNode</code>节点根据其显着性编号和将其添加到网络的顺序来接收序列号。</p>
</div>
<div class="paragraph">
<p>右输入节点存储器通常是用于快速删除对象的哈希映射。由于不支持删除对象，因此当未索引对象的值时，Phreak将使用对象列表。对于大量对象，索引哈希映射可提高性能。如果对象只有几个实例，则Phreak使用对象列表而不是索引。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cep-con_decision-engine"><a class="anchor" href="#cep-con_decision-engine"></a> <a class="link" href="#cep-con_decision-engine">3.5。复杂事件处理（CEP）</a></h3>
<div class="paragraph">
<p>在Drools中，事件记录了某个时间点应用程序域中状态的重大变化。根据域的建模方式，状态的变化可以由单个事件，多个原子事件或相关事件的层次结构表示。从复杂事件处理（CEP）角度来看，事件是在特定时间点发生的事实或对象的类型，业务规则是如何对来自该事实或对象的数据做出反应的定义。例如，在股票经纪人应用程序中，安全价格的更改，卖方到买方的所有权更改或帐户持有人余额的更改都被视为事件，因为应用程序域的状态已发生更改。在给定的时间。</p>
</div>
<div class="paragraph">
<p>Drools中的Drools引擎使用复杂事件处理（CEP）来检测和处理事件集合中的多个事件，以发现事件之间存在的关系，并从事件及其关系中推断新数据。</p>
</div>
<div class="paragraph">
<p>CEP用例与业务规则用例共享一些需求和目标。</p>
</div>
<div class="paragraph">
<p>从业务角度来看，通常基于事件触发的场景的发生来定义业务规则定义。在以下示例中，事件构成业务规则的基础：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在算法交易应用程序中，如果证券价格比开盘价高出X％，则规则将执行操作。价格上涨由股票交易应用程序上的事件表示。</p>
</li>
<li>
<p>在监视应用程序中，如果服务器机房中的温度在Y分钟内升高X度，则规则将执行操作。传感器读数由事件表示。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>从技术角度来看，业务规则评估和CEP具有以下关键相似之处：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>业务规则评估和CEP都需要与企业基础架构和应用程序无缝集成。这对于生命周期管理，审核和安全性尤为重要。</p>
</li>
<li>
<p>业务规则评估和CEP都具有功能要求（例如模式匹配）和非功能要求（例如响应时间限制和查询规则说明）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>CEP方案具有以下关键特征：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>场景通常处理大量事件，但是只有一小部分事件是相关的。</p>
</li>
<li>
<p>事件通常是不可变的，代表状态变化的记录。</p>
</li>
<li>
<p>规则和查询针对事件运行，并且必须对检测到的事件模式做出反应。</p>
</li>
<li>
<p>相关事件通常具有很强的时间关系。</p>
</li>
<li>
<p>个别事件没有优先级。CEP系统优先处理相关事件的模式及其之间的关系。</p>
</li>
<li>
<p>通常需要对事件进行组合和汇总。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>鉴于这些常见的CEP场景特征，Drools中的CEP系统支持以下功能来优化事件处理：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>具有适当语义的事件处理</p>
</li>
<li>
<p>事件检测，关联，聚合和组合</p>
</li>
<li>
<p>事件流处理</p>
</li>
<li>
<p>时间约束以建模事件之间的时间关系</p>
</li>
<li>
<p>重要事件的滑动窗口</p>
</li>
<li>
<p>会话范围的统一时钟</p>
</li>
<li>
<p>CEP用例所需的事件量</p>
</li>
<li>
<p>反应式规则</p>
</li>
<li>
<p>事件输入到Drools引擎的适配器（管道）</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="cep-events-con_decision-engine"><a class="anchor" href="#cep-events-con_decision-engine"></a> <a class="link" href="#cep-events-con_decision-engine">3.5.1。复杂事件处理中的事件</a></h4>
<div class="paragraph">
<p>在Drools中，事件记录了某个时间点应用程序域中状态的重大变化。根据域的建模方式，状态的变化可以由单个事件，多个原子事件或相关事件的层次结构表示。从复杂事件处理（CEP）角度来看，事件是在特定时间点发生的事实或对象的类型，业务规则是如何对来自该事实或对象的数据做出反应的定义。例如，在股票经纪人应用程序中，安全价格的更改，卖方到买方的所有权更改或帐户持有人余额的更改都被视为事件，因为应用程序域的状态已发生更改。在给定的时间。</p>
</div>
<div class="paragraph">
<p>事件具有以下主要特征：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>是不可变的：</strong>事件是过去某个时间发生的更改记录，无法更改。</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Drools引擎不会对表示事件的Java对象强制执行不变性。此行为使事件数据丰富成为可能。您的应用程序应该能够填充未填充的事件属性，并且Drools引擎使用这些属性来用推断的数据丰富事件。但是，您不应更改已填充的事件属性。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p><strong>具有强大的时间约束：</strong>涉及事件的规则通常需要将发生在彼此不同时间点的多个事件相互关联。</p>
</li>
<li>
<p><strong>拥有可管理的生命周期：</strong>由于事件是不可变的且具有时间限制，因此它们通常仅在指定的时间段内才有意义。这意味着Drools引擎可以自动管理事件的生命周期。</p>
</li>
<li>
<p><strong>可以使用滑动窗口：</strong>您可以使用事件定义时间或长度的滑动窗口。滑动时间窗口是可以处理事件的指定时间段。滑动长度窗口是可以处理的指定数量的事件。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cep-events-proc_decision-engine"><a class="anchor" href="#cep-events-proc_decision-engine"></a> <a class="link" href="#cep-events-proc_decision-engine">3.5.2。将事实声明为事件</a></h4>
<div class="paragraph">
<p>您可以在Java类或DRL规则文件中将事实声明为事件，以便Drools引擎在复杂事件处理期间将事实作为事件进行处理。您可以将事实声明为基于间隔的事件或时间点事件。基于间隔的事件具有持续时间，并持续存在于Drools引擎的工作存储器中，直到其持续时间过去。时间点事件没有持续时间，本质上是持续时间为零的基于间隔的事件。</p>
</div>
<div class="paragraph">
<div class="title">程序</div>
<p>对于Java类或DRL规则文件中的相关事实类型，请输入<code>@role( event )</code>元数据标记和参数。的<code>@role</code>元数据标记接受以下两个值：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fact</code> ：（默认）将类型声明为常规事实</p>
</li>
<li>
<p><code>event</code> ：将类型声明为事件</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如，以下代码段声明<code>StockPoint</code>股票经纪人应用程序中的事实类型必须作为事件处理：</p>
</div>
<div class="listingblock">
<div class="title">将事实类型声明为事件</div>
<div class="content">
<pre class="highlightjs highlight"><code>import some.package.StockPoint

declare StockPoint
  @role( event )
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果<code>StockPoint</code>是在DRL规则文件中而不是在预先存在的类中声明的事实类型，您可以在应用程序代码中内联声明事件：</p>
</div>
<div class="listingblock">
<div class="title">在线声明事实类型并将其分配给事件角色</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare StockPoint
  @role( event )

  datetime : java.util.Date
  symbol : String
  price : double
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="drl-declarations-metadata-tags-ref_decision-engine"><a class="anchor" href="#drl-declarations-metadata-tags-ref_decision-engine"></a> <a class="link" href="#drl-declarations-metadata-tags-ref_decision-engine">3.5.3。事件的元数据标签</a></h4>
<div class="paragraph">
<p>Drools引擎对插入到Drools引擎工作存储器中的事件使用以下元数据标签。您可以根据需要在Java类或DRL规则文件中更改默认的元数据标记值。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>本节中的示例引用了<code>VoiceCall</code>类假定样本应用程序域模型包括以下类详细信息：</p>
</div>
<div class="listingblock">
<div class="title">示例电信域模型中的VoiceCall事实类</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class VoiceCall {
  private String  originNumber;
  private String  destinationNumber;
  private Date    callDateTime;
  private long    callDuration;  // in milliseconds

  // Constructors, getters, and setters
}</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">@角色</dt>
<dd>
<p>该标签确定在复杂事件处理过程中，给定的事实类型是作为常规事实还是在Drools引擎中的事件处理。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认参数：<code>fact</code></p>
</div>
<div class="paragraph">
<p>支持的参数： <code>fact</code> ，<code>event</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@role( fact | event )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例：将VoiceCall声明为事件类型</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @role( event )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@时间戳</dt>
<dd>
<p>该标签会自动分配给Drools引擎中的每个事件。默认情况下，时间由会话时钟提供，并在将事件插入Drools引擎的工作内存时分配给事件。您可以指定自定义时间戳属性，而不是会话时钟添加的默认时间戳。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认参数：Drools引擎会话时钟增加的时间</p>
</div>
<div class="paragraph">
<p>支持的参数：会话时钟时间或自定义时间戳属性</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@timestamp( &lt;attributeName&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例：声明VoiceCall时间戳属性</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @role( event )
  @timestamp( callDateTime )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@持续时间</dt>
<dd>
<p>该标签确定Drools引擎中事件的持续时间。事件可以是基于时间间隔的事件或时间点事件。基于间隔的事件具有持续时间，并持续存在于Drools引擎的工作存储器中，直到其持续时间过去。时间点事件没有持续时间，本质上是持续时间为零的基于间隔的事件。默认情况下，Drools引擎中的每个事件的持续时间为零。您可以指定一个自定义的持续时间属性，而不是默认属性。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认参数：空（零）</p>
</div>
<div class="paragraph">
<p>支持的参数：自定义工期属性</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@duration( &lt;attributeName&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例：声明VoiceCall持续时间属性</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @role( event )
  @timestamp( callDateTime )
  @duration( callDuration )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@expires</dt>
<dd>
<p>该标签确定事件在Drools引擎的工作内存中到期之前的持续时间。默认情况下，当事件不再匹配并激活任何当前规则时，事件就会过期。您可以定义事件应过期的时间。该标签定义还覆盖了根据KIE基础中的时间约束和滑动窗口计算出的隐式过期偏移。仅当Drools引擎以流模式运行时，此标签才可用。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认参数：Null（事件在事件无法匹配和激活规则后过期）</p>
</div>
<div class="paragraph">
<p>支持的参数：自定义<code>timeOffset</code>格式的属性<code>[<mark>#d][#h][#m][#s][</mark>[ms]]</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@expires( &lt;timeOffset&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例：为VoiceCall事件声明过期偏移量</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @role( event )
  @timestamp( callDateTime )
  @duration( callDuration )
  @expires( 1h35m )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="cep-modes-con_decision-engine"><a class="anchor" href="#cep-modes-con_decision-engine"></a> <a class="link" href="#cep-modes-con_decision-engine">3.5.4。Drools引擎中的事件处理模式</a></h4>
<div class="paragraph">
<p>Drools引擎以云模式或流模式运行。在云模式下，Drools引擎将事实作为事实进行处理，没有时间限制，与时间无关，并且没有特定的顺序。在流模式下，Drools引擎实时或接近实时地将事实作为具有强大时间约束的事件进行处理。流模式使用同步使Drools中的事件处理成为可能。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">云模式</dt>
<dd>
<p>云模式是Drools引擎的默认操作模式。在云模式下，Drools引擎将事件视为无序云。事件仍然具有时间戳，但是以云模式运行的Drools引擎无法从时间戳中获取相关性，因为云模式会忽略当前时间。此模式使用规则约束来查找匹配的元组以激活和执行规则。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>云模式不对事实施加任何其他要求。但是，由于在这种模式下的Drools引擎没有时间概念，因此它无法使用诸如滑动窗口或自动生命周期管理之类的临时功能。在云模式下，不再需要事件时，必须显式撤消它们。</p>
</div>
<div class="paragraph">
<p>在云模式下不强加以下要求：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>没有时钟同步，因为Drools引擎没有时间概念</p>
</li>
<li>
<p>没有事件的排序，因为Drools引擎将事件作为无序的云处理，Drools引擎根据该云对规则进行匹配</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>您可以通过在相关配置文件中设置系统属性或使用Java客户端API来指定云模式：</p>
</div>
<div class="listingblock">
<div class="title">使用系统属性设置云模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>drools.eventProcessingMode=cloud</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">使用Java客户端API设置云模式</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.conf.EventProcessingOption;
import org.kie.api.KieBaseConfiguration;
import org.kie.api.KieServices.Factory;

KieBaseConfiguration config = KieServices.Factory.get().newKieBaseConfiguration();

config.setOption(EventProcessingOption.CLOUD);</code></pre>
</div>
</div>
<div class="paragraph">
<p>您也可以使用<code>eventProcessingMode="<mode>"</code> KIE模块描述符文件中的KIE基本属性（ <code>kmodule.xml</code> ）用于特定的Drools项目：</p>
</div>
<div class="listingblock">
<div class="title">使用项目设置云模式<code>kmodule.xml</code>文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule&gt;
  ...
  &lt;kbase name="KBase2" default="false" eventProcessingMode="cloud" packages="org.domain.pkg2, org.domain.pkg3" includes="KBase1"&gt;
    ...
  &lt;/kbase&gt;
  ...
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">流模式</dt>
<dd>
<p>流模式使Drools引擎能够将事件插入到Drools引擎中，并按时间顺序和实时地处理事件。在流模式下，Drools引擎同步事件流（以便可以按时间顺序处理不同流中的事件），实现时间或长度的滑动窗口，并启用自动生命周期管理。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>以下要求适用于流模式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>每个流中的事件必须按时间顺序排序。</p>
</li>
<li>
<p>必须存在会话时钟才能同步事件流。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">您的应用程序不需要在流之间强制执行排序事件，但是使用未同步的事件流可能会导致意外的结果。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>您可以通过在相关配置文件中设置系统属性或使用Java客户端API来指定流模式：</p>
</div>
<div class="listingblock">
<div class="title">使用系统属性设置流模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>drools.eventProcessingMode=stream</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">使用Java客户端API设置流模式</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.conf.EventProcessingOption;
import org.kie.api.KieBaseConfiguration;
import org.kie.api.KieServices.Factory;

KieBaseConfiguration config = KieServices.Factory.get().newKieBaseConfiguration();

config.setOption(EventProcessingOption.STREAM);</code></pre>
</div>
</div>
<div class="paragraph">
<p>您也可以使用<code>eventProcessingMode="<mode>"</code> KIE模块描述符文件中的KIE基本属性（ <code>kmodule.xml</code> ）用于特定的Drools项目：</p>
</div>
<div class="listingblock">
<div class="title">使用项目设置流模式<code>kmodule.xml</code>文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule&gt;
  ...
  &lt;kbase name="KBase2" default="false" eventProcessingMode="stream" packages="org.domain.pkg2, org.domain.pkg3" includes="KBase1"&gt;
    ...
  &lt;/kbase&gt;
  ...
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="cep-negative-patterns_decision-engine"><a class="anchor" href="#cep-negative-patterns_decision-engine"></a> <a class="link" href="#cep-negative-patterns_decision-engine">3.5.4.1。Drools引擎流模式下的负模式</a></h5>
<div class="paragraph">
<p>负模式是不满足条件的模式。例如，如果检测到火灾并且未激活洒水装置，则以下DRL规则会激活火灾警报：</p>
</div>
<div class="listingblock">
<div class="title">带有负模式的火灾报警规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Sound the alarm"
when
  $f : FireDetected()
  not(SprinklerActivated())
then
  // Sound the alarm.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>在云模式下，Drools引擎假定所有事实（常规事实和事件）都是事先已知的，并立即评估否定模式。在流模式下，Drools引擎可以支持对事实的时间约束，以在激活规则之前等待设置的时间。</p>
</div>
<div class="paragraph">
<p>流模式下的相同示例规则将照常激活火灾警报，但会延迟10秒。</p>
</div>
<div class="listingblock">
<div class="title">具有负模式和时间延迟的火灾警报规则（仅适用于流模式）</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Sound the alarm"
when
  $f : FireDetected()
  not(SprinklerActivated(this after[0s,10s] $f))
then
  // Sound the alarm.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>以下修改后的火灾警报规则期望一个<code>Heartbeat</code>事件每10秒发生一次。如果未发生预期事件，则执行规则。该规则在第一个模式和否定模式中使用相同类型的对象。负数模式具有时间限制，要在执行前等待0到10秒，并且排除<code>Heartbeat</code>事件绑定到<code>$h</code>以便可以执行规则。绑定事件<code>$h</code>必须明确排除以执行规则，因为时间限制<code>[0s, …​]</code>不会从本质上排除再次匹配该事件的可能性。</p>
</div>
<div class="listingblock">
<div class="title">火灾警报规则，以否定模式排除绑定事件（仅限流模式）</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Sound the alarm"
when
  $h: Heartbeat() from entry-point "MonitoringStream"
  not(Heartbeat(this != $h, this after[0s,10s] $h) from entry-point "MonitoringStream")
then
  // Sound the alarm.
end</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="property-change-listeners-con_decision-engine"><a class="anchor" href="#property-change-listeners-con_decision-engine"></a> <a class="link" href="#property-change-listeners-con_decision-engine">3.5.5。事实类型的属性更改设置和侦听器</a></h4>
<div class="paragraph">
<p>默认情况下，Drools引擎不会在每次触发规则时重新评估事实类型的所有事实模式，而是仅对约束或限制在给定模式内的修改后的属性做出反应。例如，如果规则调用<code>modify()</code>作为规则操作的一部分，但是该操作不会在KIE库中生成新数据，因此Drools引擎不会自动重新评估所有事实模式，因为未修改任何数据。此属性反应行为可防止在KIE库中发生不必要的递归，并导致更有效的规则评估。此行为还意味着您不必总是使用<code>no-loop</code>规则属性，以避免无限递归。</p>
</div>
<div class="paragraph">
<p>您可以使用以下方法修改或禁用此属性的反应性行为<code>KnowledgeBuilderConfiguration</code>选项，然后在Java类或DRL文件中使用属性更改设置来根据需要微调属性反应性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ALWAYS</code> ：（默认值）所有类型都具有属性反应性，但是您可以通过使用<code>@classReactive</code>属性更改设置。</p>
</li>
<li>
<p><code>ALLOWED</code> ：没有类型是属性反应型的，但是您可以通过使用<code>@propertyReactive</code>属性更改设置。</p>
</li>
<li>
<p><code>DISABLED</code> ：没有类型是属性反应型的。所有属性更改侦听器都将被忽略。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">KnowledgeBuilderConfiguration中的示例属性反应性设置</div>
<div class="content">
<pre class="highlightjs highlight"><code>KnowledgeBuilderConfiguration config = KnowledgeBuilderFactory.newKnowledgeBuilderConfiguration();
config.setOption(PropertySpecificOption.ALLOWED);
KnowledgeBuilder kbuilder = KnowledgeBuilderFactory.newKnowledgeBuilder(config);</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者，您可以更新<code>drools.propertySpecific</code>中的系统属性<code>standalone.xml</code>您的Drools发行文件：</p>
</div>
<div class="listingblock">
<div class="title">系统属性中的示例属性反应性设置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;system-properties&gt;
  ...
  &lt;property name="drools.propertySpecific" value="ALLOWED"/&gt;
  ...
&lt;/system-properties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Drools引擎支持以下属性更改设置和事实类或已声明的DRL事实类型的侦听器：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">@classReactive</dt>
<dd>
<p>如果属性反应性设置为<code>ALWAYS</code>在Drools引擎中（所有类型都是属性反应性的），此标记禁用特定Java类或已声明的DRL事实类型的默认属性反应行为。如果您希望Drools引擎在每次触发规则时重新评估指定事实类型的所有事实模式，而不是仅对在给定模式内受约束或约束的已修改属性做出反应，则可以使用此标记。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">示例：在DRL类型声明中禁用默认属性反应性</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
  @classReactive
    firstName : String
    lastName : String
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例：在Java类中禁用默认属性反应性</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@classReactive
public static class Person {
    private String firstName;
    private String lastName;
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@propertyReactive</dt>
<dd>
<p>如果属性反应性设置为<code>ALLOWED</code>在Drools引擎中（除非指定，否则所有类型都不是属性可响应的），此标记可为特定的Java类或已声明的DRL事实类型启用属性响应。如果您希望Drools引擎仅对指定事实类型的给定模式内受约束或约束的修改属性做出反应，而不是每次触发规则时都重新评估该事实的所有事实模式，则可以使用此标记。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">示例：在DRL类型声明中启用属性反应性（全局禁用反应性时）</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
  @propertyReactive
    firstName : String
    lastName : String
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例：在Java类中启用属性反应性（全局禁用反应性时）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@propertyReactive
public static class Person {
    private String firstName;
    private String lastName;
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@看</dt>
<dd>
<p>此标记可为您在DRL规则中内联指定事实模式的其他属性启用属性反应性。仅当属性反应性设置为时才支持此标签。 <code>ALWAYS</code>在Drools引擎中，或者将属性反应性设置为<code>ALLOWED</code>而相关事实类型使用<code>@propertyReactive</code>标签。您可以在DRL规则中使用此标记，以在属性反应性逻辑中添加或排除特定属性。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认参数：无</p>
</div>
<div class="paragraph">
<p>支持的参数：属性名称， <code>*</code> （所有）， <code>!</code> （不）， <code>!*</code> （无属性）</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;factPattern&gt; @watch ( &lt;property&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例：启用或禁用事实模式中的属性反应性</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Listens for changes in both `firstName` (inferred) and `lastName`:
Person(firstName == $expectedFirstName) @watch( lastName )

// Listens for changes in all properties of the `Person` fact:
Person(firstName == $expectedFirstName) @watch( * )

// Listens for changes in `lastName` and explicitly excludes changes in `firstName`:
Person(firstName == $expectedFirstName) @watch( lastName, !firstName )

// Listens for changes in all properties of the `Person` fact except `age`:
Person(firstName == $expectedFirstName) @watch( *, !age )

// Excludes changes in all properties of the `Person` fact (equivalent to using `@classReactivity` tag):
Person(firstName == $expectedFirstName) @watch( !* )</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您使用Drools引擎生成编译错误， <code>@watch</code>事实类型中使用<code>@classReactive</code>标签（禁用属性反应性）或将属性反应性设置为<code>ALLOWED</code>在Drools引擎中并且相关事实类型未使用<code>@propertyReactive</code>标签。如果您在侦听器批注中复制属性，则还会出现编译错误，例如<code>@watch( firstName, ! firstName )</code> 。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@propertyChangeSupport</dt>
<dd>
<p>对于实现对<a href="https://download.oracle.com/otndocs/jcp/7224-javabeans-1.01-fr-spec-oth-JSpec/">JavaBeans Specification中</a>定义的属性更改的支持的事实，此标签使Drools引擎可以监视事实属性中的更改。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">示例：声明JavaBeans对象中的属性更改支持</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
    @propertyChangeSupport
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="cep-temporal-operators_decision-engine"><a class="anchor" href="#cep-temporal-operators_decision-engine"></a> <a class="link" href="#cep-temporal-operators_decision-engine">3.5.6。事件的临时运算符</a></h4>
<div class="paragraph">
<p>在流模式下，Drools引擎支持以下临时运算符，用于将事件插入Drools引擎的工作存储器中。您可以使用这些运算符来定义在Java类或DRL规则文件中声明的事件的时间推理行为。当Drools引擎以云模式运行时，不支持时间运算符。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>after</code></p>
</li>
<li>
<p><code>before</code></p>
</li>
<li>
<p><code>coincides</code></p>
</li>
<li>
<p><code>during</code></p>
</li>
<li>
<p><code>includes</code></p>
</li>
<li>
<p><code>finishes</code></p>
</li>
<li>
<p><code>finished by</code></p>
</li>
<li>
<p><code>meets</code></p>
</li>
<li>
<p><code>met by</code></p>
</li>
<li>
<p><code>overlaps</code></p>
</li>
<li>
<p><code>overlapped by</code></p>
</li>
<li>
<p><code>starts</code></p>
</li>
<li>
<p><code>started by</code></p>
<div class="dlist">
<dl>
<dt class="hdlist1">后</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>该运算符指定当前事件是否在相关事件之后发生。该运算符还可以定义当前事件可以跟随相关事件之后的时间量，或者定义当前事件可以跟随相关事件之后的限定时间范围。</p>
</div>
<div class="paragraph">
<p>例如，以下模式匹配<code>$eventA</code>在3分钟30秒和4分钟后开始<code>$eventB</code>完成。如果<code>$eventA</code>在3分钟30秒后开始<code>$eventB</code>完成，或晚于4分钟后<code>$eventB</code>完成，则模式不匹配。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this after[3m30s, 4m] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以通过以下方式表示此运算符：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>3m30s &lt;= $eventA.startTimestamp - $eventB.endTimeStamp &lt;= 4m</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>after</code>运算符最多支持两个参数值：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果定义了两个值，则间隔从第一个值（示例中为3分钟30秒）开始，以第二个值（示例中为4分钟）结束。</p>
</li>
<li>
<p>如果仅定义一个值，则间隔从提供的值开始，并无限期地运行，没有结束时间。</p>
</li>
<li>
<p>如果未定义任何值，则间隔从1毫秒开始，并无限期地运行，没有结束时间。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>的<code>after</code>运算符还支持负时间范围：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this after[-3m30s, -2m] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果第一个值大于第二个值，则Drools引擎会自动将其反转。例如，Drools引擎以相同的方式解释以下两种模式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this after[-3m30s, -2m] $eventB)
$eventA : EventA(this after[-2m, -3m30s] $eventB)</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">之前</dt>
<dd>
<p>该运算符指定当前事件是否在相关事件之前发生。该运算符还可以定义当前事件可以在相关事件之前发生的时间量，或者定义当前事件可以在相关事件之前发生的限定时间范围。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例如，以下模式匹配<code>$eventA</code>在3分钟至30秒至4分钟之前结束<code>$eventB</code>开始。如果<code>$eventA</code>在3分30秒之前完成<code>$eventB</code>开始，或晚于4分钟<code>$eventB</code>开始，则模式不匹配。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this before[3m30s, 4m] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以通过以下方式表示此运算符：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>3m30s &lt;= $eventB.startTimestamp - $eventA.endTimeStamp &lt;= 4m</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>before</code>运算符最多支持两个参数值：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果定义了两个值，则间隔从第一个值（示例中为3分钟30秒）开始，以第二个值（示例中为4分钟）结束。</p>
</li>
<li>
<p>如果仅定义一个值，则间隔从提供的值开始，并无限期地运行，没有结束时间。</p>
</li>
<li>
<p>如果未定义任何值，则间隔从1毫秒开始，并无限期地运行，没有结束时间。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>的<code>before</code>运算符还支持负时间范围：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this before[-3m30s, -2m] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果第一个值大于第二个值，则Drools引擎会自动将其反转。例如，Drools引擎以相同的方式解释以下两种模式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this before[-3m30s, -2m] $eventB)
$eventA : EventA(this before[-2m, -3m30s] $eventB)</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">巧合</dt>
<dd>
<p>此运算符指定两个事件是否同时发生，并且开始时间和结束时间相同。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例如，如果以下项的开始和结束时间戳都匹配，则以下模式匹配<code>$eventA</code>和<code>$eventB</code>相同：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this coincides $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>coincides</code>如果事件开始和结束时间之间的距离不同，则运算符最多支持两个参数值：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果仅给出一个参数，则该参数用于设置两个事件的开始时间和结束时间的阈值。</p>
</li>
<li>
<p>如果给出了两个参数，则第一个用作开始时间的阈值，第二个用作结束时间的阈值。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以下模式使用开始和结束时间阈值：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this coincides[15s, 10s] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果满足以下条件，则模式匹配：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>abs($eventA.startTimestamp - $eventB.startTimestamp) &lt;= 15s
&amp;&amp;
abs($eventA.endTimestamp - $eventB.endTimestamp) &lt;= 10s</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">Drools引擎不支持负间隔<code>coincides</code>操作员。如果您使用负间隔，则Drools引擎会生成错误。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">中</dt>
<dd>
<p>该运算符指定当前事件是否在相关事件开始和结束的时间范围内发生。当前事件必须在关联事件开始之后开始，并且必须在关联事件结束之前结束。（随着<code>coincides</code>运算符，开始时间和结束时间相同或几乎相同。）</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例如，以下模式匹配<code>$eventA</code>之后开始<code>$eventB</code>开始和结束之前<code>$eventB</code>结束于：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this during $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以通过以下方式表示此运算符：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventB.startTimestamp &lt; $eventA.startTimestamp &lt;= $eventA.endTimestamp &lt; $eventB.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>during</code>运算符支持一个，两个或四个可选参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果定义了一个值，则该值是两个事件的开始时间之间的最大距离和两个事件的结束时间之间的最大距离。</p>
</li>
<li>
<p>如果定义了两个值，则这些值是一个阈值，相对于相关的事件开始时间和结束时间，当前事件的开始时间和结束时间必须在该阈值之间。</p>
<div class="paragraph">
<p>例如，如果值是<code>5s</code>和<code>10s</code> ，当前事件必须在相关事件开始之后的5到10秒之间开始，并且必须在相关事件结束之前的5到10秒之间结束。</p>
</div>
</li>
<li>
<p>如果定义了四个值，则第一和第二值是事件开始时间之间的最小和最大距离，而第三和第四值是两个事件结束时间之间的最小和最大距离。</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">包括</dt>
<dd>
<p>该运算符指定相关事件是否在当前事件发生的时间范围内发生。相关事件必须在当前事件开始之后开始，并且必须在当前事件结束之前结束。（此运算符的行为与<code>during</code>操作员的行为。）</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例如，以下模式匹配<code>$eventB</code>之后开始<code>$eventA</code>开始和结束之前<code>$eventA</code>结束于：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this includes $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以通过以下方式表示此运算符：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA.startTimestamp &lt; $eventB.startTimestamp &lt;= $eventB.endTimestamp &lt; $eventA.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>includes</code>运算符支持一个，两个或四个可选参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果定义了一个值，则该值是两个事件的开始时间之间的最大距离和两个事件的结束时间之间的最大距离。</p>
</li>
<li>
<p>如果定义了两个值，则这些值是一个阈值，在该阈值之间必须相对于当前事件的开始和结束时间发生相关的事件开始时间和结束时间。</p>
<div class="paragraph">
<p>例如，如果值是<code>5s</code>和<code>10s</code> ，相关事件必须在当前事件开始之后的5到10秒之间开始，并且必须在当前事件结束之前的5到10秒之间结束。</p>
</div>
</li>
<li>
<p>如果定义了四个值，则第一和第二值是事件开始时间之间的最小和最大距离，而第三和第四值是两个事件结束时间之间的最小和最大距离。</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">完成</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>该运算符指定当前事件是否在相关事件之后开始，但是两个事件同时结束。</p>
</div>
<div class="paragraph">
<p>例如，以下模式匹配<code>$eventA</code>之后开始<code>$eventB</code>在以下时间同时开始和结束<code>$eventB</code>结束于：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this finishes $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以通过以下方式表示此运算符：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventB.startTimestamp &lt; $eventA.startTimestamp
&amp;&amp;
$eventA.endTimestamp == $eventB.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>finishes</code>运算符支持一个可选参数，该参数设置两个事件的结束时间之间允许的最长时间：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this finishes[5s] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果满足以下条件，则此模式匹配：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventB.startTimestamp &lt; $eventA.startTimestamp
&amp;&amp;
abs($eventA.endTimestamp - $eventB.endTimestamp) &lt;= 5s</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">Drools引擎不支持负间隔<code>finishes</code>操作员。如果您使用负间隔，则Drools引擎会生成错误。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">完成于</dt>
<dd>
<p>该运算符指定相关事件是否在当前事件之后开始，但是两个事件同时结束。（此运算符的行为与<code>finishes</code>操作员的行为。）</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例如，以下模式匹配<code>$eventB</code>之后开始<code>$eventA</code>在以下时间同时开始和结束<code>$eventA</code>结束于：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this finishedby $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以通过以下方式表示此运算符：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA.startTimestamp &lt; $eventB.startTimestamp
&amp;&amp;
$eventA.endTimestamp == $eventB.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>finished by</code>运算符支持一个可选参数，该参数设置两个事件的结束时间之间允许的最长时间：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this finishedby[5s] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果满足以下条件，则此模式匹配：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA.startTimestamp &lt; $eventB.startTimestamp
&amp;&amp;
abs($eventA.endTimestamp - $eventB.endTimestamp) &lt;= 5s</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">Drools引擎不支持负间隔<code>finished by</code>操作员。如果您使用负间隔，则Drools引擎会生成错误。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">遇见</dt>
<dd>
<p>该运算符指定当前事件是否在相关事件开始的同时结束。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例如，以下模式匹配<code>$eventA</code>结束于<code>$eventB</code>开始：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this meets $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以通过以下方式表示此运算符：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>abs($eventB.startTimestamp - $eventA.endTimestamp) == 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>meets</code>运算符支持一个可选参数，该参数设置当前事件的结束时间与相关事件的开始时间之间允许的最长时间：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this meets[5s] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果满足以下条件，则此模式匹配：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>abs($eventB.startTimestamp - $eventA.endTimestamp) &lt;= 5s</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">Drools引擎不支持负间隔<code>meets</code>操作员。如果您使用负间隔，则Drools引擎会生成错误。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">遇见</dt>
<dd>
<p>该运算符指定相关事件是否在当前事件开始的同时结束。（此运算符的行为与<code>meets</code>操作员的行为。）</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例如，以下模式匹配<code>$eventB</code>结束于<code>$eventA</code>开始：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this metby $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以通过以下方式表示此运算符：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>abs($eventA.startTimestamp - $eventB.endTimestamp) == 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>met by</code>运算符支持一个可选参数，该参数设置相关事件的结束时间与当前事件的开始时间之间的最大距离：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this metby[5s] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果满足以下条件，则此模式匹配：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>abs($eventA.startTimestamp - $eventB.endTimestamp) &lt;= 5s</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">Drools引擎不支持负间隔<code>met by</code>操作员。如果您使用负间隔，则Drools引擎会生成错误。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">重叠</dt>
<dd>
<p>该运算符指定当前事件是否在关联事件开始之前开始，是否在关联事件发生的时间段内结束。当前事件必须在相关事件的开始时间和结束时间之间结束。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例如，以下模式匹配<code>$eventA</code>开始之前<code>$eventB</code>开始然后结束<code>$eventB</code>发生之前<code>$eventB</code>结束于：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this overlaps $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>overlaps</code>运算符最多支持两个参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果定义了一个参数，则该值是相关事件的开始时间与当前事件的结束时间之间的最大距离。</p>
</li>
<li>
<p>如果定义了两个参数，则值为相关事件的开始时间和当前事件的结束时间之间的最小距离（第一个值）和最大距离（第二个值）。</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">重叠</dt>
<dd>
<p>此运算符指定相关事件是否在当前事件开始之前开始，是否在当前事件发生的时间段内结束。相关事件必须在当前事件的开始时间和结束时间之间结束。（此运算符的行为与<code>overlaps</code>操作员的行为。）</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例如，以下模式匹配<code>$eventB</code>开始之前<code>$eventA</code>开始然后结束<code>$eventA</code>发生之前<code>$eventA</code>结束于：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this overlappedby $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>overlapped by</code>运算符最多支持两个参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果定义了一个参数，则该值是当前事件的开始时间与相关事件的结束时间之间的最大距离。</p>
</li>
<li>
<p>如果定义了两个参数，则值是当前事件的开始时间与相关事件的结束时间之间的最小距离（第一个值）和最大距离（第二个值）。</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">开始</dt>
<dd>
<p>该运算符指定两个事件是否同时开始，但是当前事件在相关事件结束之前结束。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例如，以下模式匹配<code>$eventA</code>和<code>$eventB</code>同时开始<code>$eventA</code>结束于<code>$eventB</code>结束于：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this starts $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以通过以下方式表示此运算符：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA.startTimestamp == $eventB.startTimestamp
&amp;&amp;
$eventA.endTimestamp &lt; $eventB.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>starts</code>运算符支持一个可选参数，该参数设置两个事件的开始时间之间的最大距离：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this starts[5s] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果满足以下条件，则此模式匹配：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>abs($eventA.startTimestamp - $eventB.startTimestamp) &lt;= 5s
&amp;&amp;
$eventA.endTimestamp &lt; $eventB.endTimestamp</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">Drools引擎不支持负间隔<code>starts</code>操作员。如果您使用负间隔，则Drools引擎会生成错误。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">开始于</dt>
<dd>
<p>该运算符指定两个事件是否同时开始，但是相关事件在当前事件结束之前结束。（此运算符的行为与<code>starts</code>操作员的行为。）</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例如，以下模式匹配<code>$eventA</code>和<code>$eventB</code>同时开始<code>$eventB</code>结束于<code>$eventA</code>结束于：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA(this startedby $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以通过以下方式表示此运算符：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA.startTimestamp == $eventB.startTimestamp
&amp;&amp;
$eventA.endTimestamp &gt; $eventB.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>started by</code>运算符支持一个可选参数，该参数设置两个事件的开始时间之间的最大距离：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$eventA : EventA( this starts[5s] $eventB)</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果满足以下条件，则此模式匹配：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>abs( $eventA.startTimestamp - $eventB.startTimestamp ) &lt;= 5s
&amp;&amp;
$eventA.endTimestamp &gt; $eventB.endTimestamp</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">Drools引擎不支持负间隔<code>started by</code>操作员。如果您使用负间隔，则Drools引擎会生成错误。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cep-clock-ref_decision-engine"><a class="anchor" href="#cep-clock-ref_decision-engine"></a> <a class="link" href="#cep-clock-ref_decision-engine">3.5.7。Drools引擎中的会话时钟实现</a></h4>
<div class="paragraph">
<p>在复杂的事件处理过程中，Drools引擎中的事件可能具有时间限制，因此需要提供当前时间的会话时钟。例如，如果规则需要确定最近60分钟内给定股票的平均价格，则Drools引擎必须能够将股票价格事件时间戳记与会话时钟中的当前时间进行比较。</p>
</div>
<div class="paragraph">
<p>Drools引擎支持实时时钟和伪时钟。您可以根据情况使用一种或两种时钟类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>规则测试：</strong>测试需要受控的环境，并且当测试包括具有时间限制的规则时，您必须能够控制输入规则和事实以及时间流。</p>
</li>
<li>
<p><strong>定期执行：</strong> Drools引擎会实时响应事件，因此需要实时时钟。</p>
</li>
<li>
<p><strong>特殊环境：</strong>特定环境可能具有特定的时间控制要求。例如，群集环境可能需要时钟同步，或者Java Enterprise Edition（JEE）环境可能需要应用服务器提供的时钟。</p>
</li>
<li>
<p><strong>规则重播或模拟：</strong>为了重播或模拟方案，应用程序必须能够控制时间流。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在决定在Drools引擎中使用实时时钟还是伪时钟时，请考虑您的环境要求。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">实时时钟</dt>
<dd>
<p>实时时钟是Drools引擎中的默认时钟实现，并使用系统时钟来确定时间戳的当前时间。要将Drools引擎配置为使用实时时钟，请将KIE会话配置参数设置为<code>realtime</code> ：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">在KIE会话中配置实时时钟</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.KieServices.Factory;
import org.kie.api.runtime.conf.ClockTypeOption;
import org.kie.api.runtime.KieSessionConfiguration;

KieSessionConfiguration config = KieServices.Factory.get().newKieSessionConfiguration();

config.setOption(ClockTypeOption.get("realtime"));</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">伪时钟</dt>
<dd>
<p>Drools引擎中的伪时钟实现有助于测试时间规则，并且可以由应用程序控制。要将Drools引擎配置为使用伪时钟，请将KIE会话配置参数设置为<code>pseudo</code> ：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">在KIE会话中配置伪时钟</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.runtime.conf.ClockTypeOption;
import org.kie.api.runtime.KieSessionConfiguration;
import org.kie.api.KieServices.Factory;

KieSessionConfiguration config = KieServices.Factory.get().newKieSessionConfiguration();

config.setOption(ClockTypeOption.get("pseudo"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以使用其他配置和事实处理程序来控制伪时钟：</p>
</div>
<div class="listingblock">
<div class="title">控制KIE会话中的伪时钟行为</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.concurrent.TimeUnit;

import org.kie.api.runtime.KieSessionConfiguration;
import org.kie.api.KieServices.Factory;
import org.kie.api.runtime.KieSession;
import org.drools.core.time.SessionPseudoClock;
import org.kie.api.runtime.rule.FactHandle;
import org.kie.api.runtime.conf.ClockTypeOption;

KieSessionConfiguration conf = KieServices.Factory.get().newKieSessionConfiguration();

conf.setOption( ClockTypeOption.get("pseudo"));
KieSession session = kbase.newKieSession(conf, null);

SessionPseudoClock clock = session.getSessionClock();

// While inserting facts, advance the clock as necessary.
FactHandle handle1 = session.insert(tick1);
clock.advanceTime(10, TimeUnit.SECONDS);

FactHandle handle2 = session.insert(tick2);
clock.advanceTime(30, TimeUnit.SECONDS);

FactHandle handle3 = session.insert(tick3);</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="cep-event-streams-con_decision-engine"><a class="anchor" href="#cep-event-streams-con_decision-engine"></a> <a class="link" href="#cep-event-streams-con_decision-engine">3.5.8。事件流和入口点</a></h4>
<div class="paragraph">
<p>Drools引擎可以事件流的形式处理大量事件。在DRL规则声明中，流也称为<em>入口点</em> 。当您在DRL规则或Java应用程序中声明入口点时，Drools引擎在编译时会识别并创建适当的内部结构，以仅使用该入口点的数据来评估该规则。</p>
</div>
<div class="paragraph">
<p>除了Drools引擎的工作内存中已经存在的事实之外，来自一个入口点或流的事实可以将来自任何其他入口点的事实结合起来。事实始终与它们进入Drools引擎的入口点相关联。相同类型的事实可以通过多个入口点进入Drools引擎，但是通过入口点A进入Drools引擎的事实永远无法匹配入口点B的模式。</p>
</div>
<div class="paragraph">
<p>事件流具有以下特征：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>流中的事件按时间戳排序。时间戳对于不同的流可能具有不同的语义，但是它们始终在内部进行排序。</p>
</li>
<li>
<p>事件流通常具有大量事件。</p>
</li>
<li>
<p>流中的原子事件通常不能单独使用，而只能在流中集体使用。</p>
</li>
<li>
<p>事件流可以是同质的并包含单一事件类型，也可以是异质的并包含不同类型的事件。</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="cep-event-streams-proc_decision-engine"><a class="anchor" href="#cep-event-streams-proc_decision-engine"></a> <a class="link" href="#cep-event-streams-proc_decision-engine">3.5.8.1。声明规则数据的入口点</a></h5>
<div class="paragraph">
<p>您可以为事件声明一个入口点（事件流），以便Drools引擎仅使用该入口点的数据来评估规则。您可以通过在DRL规则中隐式地声明入口点，也可以在Java应用程序中显式地声明入口点。</p>
</div>
<div class="paragraph">
<div class="title">程序</div>
<p>使用以下方法之一声明入口点：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在DRL规则文件中，指定<code>from entry-point "<name>"</code>对于插入的事实：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">使用“ ATM流”入口点授权提款规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Authorize withdrawal"
when
  WithdrawRequest($ai : accountId, $am : amount) from entry-point "ATM Stream"
  CheckingAccount(accountId == $ai, balance &gt; $am)
then
  // Authorize withdrawal.
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">通过“分支流”入口点应用费用规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Apply fee on withdraws on branches"
when
  WithdrawRequest($ai : accountId, processed == true) from entry-point "Branch Stream"
  CheckingAccount(accountId == $ai)
then
  // Apply a $2 fee on the account.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>来自银行应用程序的两个示例DRL规则都会插入事件<code>WithdrawalRequest</code>与事实<code>CheckingAccount</code> ，但来自不同的切入点。在运行时，Drools引擎会评估<code>Authorize withdrawal</code>规则仅使用来自<code>"ATM Stream"</code>入口点，并评估<code>Apply fee</code>规则仅使用来自<code>"Branch Stream"</code>入口点。插入到<code>"ATM Stream"</code>永远无法匹配模式<code>"Apply fee"</code>规则，以及插入到<code>"Branch Stream"</code>永远无法匹配模式<code>"Authorize withdrawal rule"</code> 。</p>
</div>
</div>
</div>
</li>
<li>
<p>在Java应用程序代码中，使用<code>getEntryPoint()</code>指定和获取方法的方法<code>EntryPoint</code>对象并将事实相应地插入该入口点：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">具有EntryPoint对象和插入事实的Java应用程序代码</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.runtime.KieSession;
import org.kie.api.runtime.rule.EntryPoint;

// Create your KIE base and KIE session as usual.
KieSession session = ...

// Create a reference to the entry point.
EntryPoint atmStream = session.getEntryPoint("ATM Stream");

// Start inserting your facts into the entry point.
atmStream.insert(aWithdrawRequest);</code></pre>
</div>
</div>
<div class="paragraph">
<p>任何指定的DRL规则<code>from entry-point "ATM Stream"</code>然后仅基于此入口点中的数据评估。</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cep-sliding-windows-con_decision-engine"><a class="anchor" href="#cep-sliding-windows-con_decision-engine"></a> <a class="link" href="#cep-sliding-windows-con_decision-engine">3.5.9。滑动时间或长度的窗口</a></h4>
<div class="paragraph">
<p>在流模式下，Drools引擎可以从时间或长度的指定滑动窗口中处理事件。滑动时间窗口是可以处理事件的指定时间段。滑动长度窗口是可以处理的指定数量的事件。在DRL规则或Java应用程序中声明滑动窗口时，Drools引擎在编译时会识别并创建适当的内部结构，以仅使用该滑动窗口中的数据来评估该规则。</p>
</div>
<div class="paragraph">
<p>例如，以下DRL规则代码段指示Drools引擎仅处理最近2分钟（滑动时间窗口）中的库存点或仅处理最后10个库存点（滑动长度窗口）：</p>
</div>
<div class="listingblock">
<div class="title">从最近2分钟开始处理库存点（滑动时间窗口）</div>
<div class="content">
<pre class="highlightjs highlight"><code>StockPoint() over window:time(2m)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">处理最后10个存货点（滑动长度窗口）</div>
<div class="content">
<pre class="highlightjs highlight"><code>StockPoint() over window:length(10)</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="cep-sliding-windows-proc_decision-engine"><a class="anchor" href="#cep-sliding-windows-proc_decision-engine"></a> <a class="link" href="#cep-sliding-windows-proc_decision-engine">3.5.9.1。声明规则数据的滑动窗口</a></h5>
<div class="paragraph">
<p>您可以为事件声明一个滑动的时间窗口（时间流）或长度（发生次数），以便Drools引擎仅使用该窗口中的数据来评估规则。</p>
</div>
<div class="paragraph">
<div class="title">程序</div>
<p>在DRL规则文件中，指定<code>over window:<time_or_length>(<value>)</code>对于插入的事实。</p>
</div>
<div class="paragraph">
<p>例如，以下两个DRL规则根据平均温度激活火灾警报。但是，第一条规则使用滑动时间窗口来计算最近10分钟的平均值，而第二条规则使用滑动长度窗口来计算最近一百个温度读数的平均值。</p>
</div>
<div class="listingblock">
<div class="title">滑动时间范围内的平均温度</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Sound the alarm if temperature rises above threshold"
when
  TemperatureThreshold($max : max)
  Number(doubleValue &gt; $max) from accumulate(
    SensorReading($temp : temperature) over window:time(10m),
    average($temp))
then
  // Sound the alarm.
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">滑动长度窗口上的平均温度</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Sound the alarm if temperature rises above threshold"
when
  TemperatureThreshold($max : max)
  Number(doubleValue &gt; $max) from accumulate(
    SensorReading($temp : temperature) over window:length(100),
    average($temp))
then
  // Sound the alarm.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Drools引擎会丢弃任何<code>SensorReading</code>事件发生时间超过10分钟或不是最近一百次读数的一部分，并且随着分钟或读数实时“向前滑动”而继续重新计算平均值。</p>
</div>
<div class="paragraph">
<p>Drools引擎不会自动从KIE会话中删除过时的事件，因为其他没有滑动窗口声明的规则可能取决于这些事件。Drools引擎将事件存储在KIE会话中，直到事件通过显式规则声明或基于KIE基础中推断数据的Drools引擎中的隐式推理而终止。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cep-memory-management-con_decision-engine"><a class="anchor" href="#cep-memory-management-con_decision-engine"></a> <a class="link" href="#cep-memory-management-con_decision-engine">3.5.10。事件的内存管理</a></h4>
<div class="paragraph">
<p>在流模式下，Drools引擎使用自动内存管理来维护存储在KIE会话中的事件。Drools引擎可以从KIE会话中撤回由于其时间限制而不再与任何规则匹配的任何事件，并释放由撤回的事件保留的任何资源。</p>
</div>
<div class="paragraph">
<p>Drools引擎使用显式或推断的到期时间来收回过时的事件：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>显式到期：</strong> Drools引擎会删除在声明以下内容的规则中明确设置为到期的事件： <code>@expires</code>标签：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">具有明确到期期限的DRL规则代码段</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare StockPoint
  @expires( 30m )
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>此示例规则设置了<code>StockPoint</code>事件在30分钟后过期，如果没有其他规则使用该事件，则将其从KIE会话中删除。</p>
</div>
</div>
</div>
</li>
<li>
<p><strong>推断的过期时间：</strong> Drools引擎可以通过分析规则中的时间约束来隐式计算给定事件的过期时间偏移：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">具有时间限制的DRL规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Correlate orders"
when
  $bo : BuyOrder($id : id)
  $ae : AckOrder(id == $id, this after[0,10s] $bo)
then
  // Perform an action.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于此示例规则，Drools引擎会自动计算<code>BuyOrder</code>事件发生时，Drools引擎需要将事件存储长达10秒，然后等待匹配<code>AckOrder</code>事件。10秒后，Drools引擎会推断过期时间并将事件从KIE会话中删除。一个<code>AckOrder</code>事件只能与现有事件匹配<code>BuyOrder</code>事件，因此如果没有匹配项，Drools引擎会推断过期时间，并立即删除该事件。</p>
</div>
<div class="paragraph">
<p>Drools引擎将分析整个KIE基数，以找到每种事件类型的偏移量，并确保没有其他规则使用待删除的事件。每当隐式到期与明确的到期值发生冲突时，Drools引擎都会使用两者中较大的时间范围来将事件存储更长的时间。</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="engine-queries-con_decision-engine"><a class="anchor" href="#engine-queries-con_decision-engine"></a> <a class="link" href="#engine-queries-con_decision-engine">3.6。Drools引擎查询和实时查询</a></h3>
<div class="paragraph">
<p>您可以在Drools引擎中使用查询，以根据规则中使用的事实模式检索事实集。模式也可以使用可选参数。</p>
</div>
<div class="paragraph">
<p>要将查询与Drools引擎一起使用，请在DRL文件中添加查询定义，然后在应用程序代码中获取匹配的结果。当查询遍历结果集合时，您可以使用与查询绑定的任何标识符来访问相应的事实或事实字段，方法是调用<code>get()</code>绑定变量名称作为参数的方法。如果绑定引用事实对象，则可以通过调用来检索事实句柄<code>getFactHandle()</code>以变量名作为参数。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./UserGuide/QueryResults.png" alt="查询结果">
</div>
<div class="title">图43。查询结果</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./UserGuide/QueryResultsRow.png" alt="QueryResultsRow">
</div>
<div class="title">图44。QueryResultsRow</div>
</div>
<div class="listingblock">
<div class="title">DRL文件中的示例查询定义</div>
<div class="content">
<pre class="highlightjs highlight"><code>query "people under the age of 21"
    $person : Person( age &lt; 21 )
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">获取和迭代查询结果的示例应用程序代码</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">QueryResults results = ksession.getQueryResults( "people under the age of 21" );
System.out.println( "we have " + results.size() + " people under the age of 21" );

System.out.println( "These people are under the age of 21:" );

for ( QueryResultsRow row : results ) {
    Person person = ( Person ) row.get( "person" );
    System.out.println( person.getName() + "\n" );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>当您监视随时间变化时，通过遍历返回的集合来调用查询和处理结果可能很困难。为了减轻正在进行的查询的难度，Drools提供了<em>实时查询</em> ，该<em>查询</em>使用附加的侦听器进行更改事件，而不是返回可迭代的结果集。实时查询通过创建视图并发布该视图内容的更改事件而保持打开状态。</p>
</div>
<div class="paragraph">
<p>要激活实时查询，请使用参数启动查询并监视结果视图中的更改。您可以使用<code>dispose()</code>方法来终止查询并中止此反应式方案。</p>
</div>
<div class="listingblock">
<div class="title">DRL文件中的示例查询定义</div>
<div class="content">
<pre class="highlightjs highlight"><code>query colors(String $color1, String $color2)
    TShirt(mainColor = $color1, secondColor = $color2, $price: manufactureCost)
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">带有事件侦听器和实时查询的示例应用程序代码</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">final List updated = new ArrayList();
final List removed = new ArrayList();
final List added = new ArrayList();

ViewChangedEventListener listener = new ViewChangedEventListener() {
 public void rowUpdated(Row row) {
  updated.add( row.get( "$price" ) );
 }

 public void rowRemoved(Row row) {
  removed.add( row.get( "$price" ) );
 }

 public void rowAdded(Row row) {
  added.add( row.get( "$price" ) );
 }
};

// Open the live query:
LiveQuery query = ksession.openLiveQuery( "colors",
                                          new Object[] { "red", "blue" },
                                          listener );
...
...

// Terminate the live query:
query.dispose()</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关更多实时查询示例，请参阅<a href="http://blog.athico.com/2010/07/glazed-lists-examples-for-drools-live.html">Drools Live Queries的上釉列表示例</a> 。</p>
</div>
</div>
<div class="sect2">
<h3 id="engine-event-listeners-con_decision-engine"><a class="anchor" href="#engine-event-listeners-con_decision-engine"></a> <a class="link" href="#engine-event-listeners-con_decision-engine">3.7。Drools引擎事件监听器和调试日志记录</a></h3>
<div class="paragraph">
<p>在Drools中，您可以添加或删除Drools引擎事件的侦听器，例如事实插入和规则执行。使用Drools引擎事件侦听器，可以将Drools引擎活动通知您，并将您的日志记录和审核工作与应用程序的核心分开。</p>
</div>
<div class="paragraph">
<p>Drools引擎支持以下默认事件监听器，用于议程和工作内存：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AgendaEventListener</code></p>
</li>
<li>
<p><code>WorkingMemoryEventListener</code></p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./UserGuide/WorkingMemoryEventManager.png" alt="WorkingMemoryEventManager">
</div>
<div class="title">图45。WorkingMemoryEventManager</div>
</div>
<div class="paragraph">
<p>对于每个事件侦听器，Drools引擎还支持您可以指定要监视的以下特定事件：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MatchCreatedEvent</code></p>
</li>
<li>
<p><code>MatchCancelledEvent</code></p>
</li>
<li>
<p><code>BeforeMatchFiredEvent</code></p>
</li>
<li>
<p><code>AfterMatchFiredEvent</code></p>
</li>
<li>
<p><code>AgendaGroupPushedEvent</code></p>
</li>
<li>
<p><code>AgendaGroupPoppedEvent</code></p>
</li>
<li>
<p><code>ObjectInsertEvent</code></p>
</li>
<li>
<p><code>ObjectDeletedEvent</code></p>
</li>
<li>
<p><code>ObjectUpdatedEvent</code></p>
</li>
<li>
<p><code>ProcessCompletedEvent</code></p>
</li>
<li>
<p><code>ProcessNodeLeftEvent</code></p>
</li>
<li>
<p><code>ProcessNodeTriggeredEvent</code></p>
</li>
<li>
<p><code>ProcessStartEvent</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如，以下代码使用<code>DefaultAgendaEventListener</code>侦听器附加到KIE会话并指定<code>AfterMatchFiredEvent</code>要监视的事件。代码在执行（触发）规则后输出模式匹配：</p>
</div>
<div class="listingblock">
<div class="title">监视和打印的示例代码<code>AfterMatchFiredEvent</code>议程中的事件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.addEventListener( new DefaultAgendaEventListener() {
   public void afterMatchFired(AfterMatchFiredEvent event) {
       super.afterMatchFired( event );
       System.out.println( event );
   }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Drools引擎还支持以下议程和工作内存事件侦听器，以进行调试日志记录：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DebugAgendaEventListener</code></p>
</li>
<li>
<p><code>DebugRuleRuntimeEventListener</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这些事件侦听器实现相同的受支持的事件侦听器方法，并且默认情况下包括调试打印语句。您可以添加要监视和记录的特定受支持事件，或者监视所有议程或工作记忆活动。</p>
</div>
<div class="paragraph">
<p>例如，以下代码使用<code>DebugRuleRuntimeEventListener</code>事件监听器，用于监视和打印所有工作内存事件：</p>
</div>
<div class="listingblock">
<div class="title">监视和打印所有工作内存事件的示例代码</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.addEventListener( new DebugRuleRuntimeEventListener() );</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="logging-proc_decision-engine"><a class="anchor" href="#logging-proc_decision-engine"></a> <a class="link" href="#logging-proc_decision-engine">3.7.1。在Drools引擎中配置日志记录实用程序</a></h4>
<div class="paragraph">
<p>Drools引擎使用Java日志记录API SLF4J进行系统日志记录。您可以在Drools引擎中使用以下日志记录实用工具之一来调查Drools引擎的活动，例如用于故障排除或数据收集：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>退回</p>
</li>
<li>
<p>Apache Commons日志记录</p>
</li>
<li>
<p>Apache Log4j</p>
</li>
<li>
<p><code>java.util.logging</code>包</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">程序</div>
<p>对于要使用的日志记录实用程序，将相关的依赖项添加到您的Maven项目中，或将相关的XML配置文件保存在<code>org.drools</code>您的Drools发行套件：</p>
</div>
<div class="listingblock">
<div class="title">示例Maven的Logback依赖关系</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
  &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
  &lt;version&gt;${logback.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">org.drools软件包中的示例logback.xml配置文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;configuration&gt;
  &lt;logger name="org.drools" level="debug"/&gt;
  ...
&lt;configuration&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">org.drools软件包中的示例log4j.xml配置文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;log4j:configuration xmlns:log4j="http://jakarta.apache.org/log4j/"&gt;
  &lt;category name="org.drools"&gt;
    &lt;priority value="debug" /&gt;
  &lt;/category&gt;
  ...
&lt;/log4j:configuration&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">如果您正在为超轻环境而开发，请使用<code>slf4j-nop</code>要么<code>slf4j-simple</code>记录器。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="performance-tuning-decision-engine-ref_decision-engine"><a class="anchor" href="#performance-tuning-decision-engine-ref_decision-engine"></a> <a class="link" href="#performance-tuning-decision-engine-ref_decision-engine">3.8。Drools引擎的性能调整注意事项</a></h3>
<div class="paragraph">
<p>以下关键概念或建议做法可帮助您优化Drools发动机性能。为了方便起见，在本节中汇总了这些概念，并在适用的情况下在交叉引用的文档中进行了详细说明。新版本的Drools将根据需要扩展或更改此部分。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">对不需要重要Drools引擎更新的无状态KIE会话使用顺序模式</dt>
<dd>
<p>顺序模式是Drools引擎中的一种高级规则库配置，它使Drools引擎可以一次评估规则，使其按照在Drools引擎议程中列出的顺序进行，而无需考虑工作内存的变化。结果，在顺序模式下规则执行可能会更快，但是重要的更新可能不会应用于您的规则。顺序模式仅适用于无状态KIE会话。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>要启用顺序模式，请设置系统属性<code>drools.sequential</code>至<code>true</code> 。</p>
</div>
<div class="paragraph">
<p>有关顺序模式或其他启用它的选项的更多信息，请参见<a href="#phreak-sequential-mode-con_decision-engine">Phreak中的顺序模式</a> 。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">对事件监听器使用简单的操作</dt>
<dd>
<p>限制事件侦听器的数量及其执行的操作类型。使用事件侦听器进行简单的操作，例如调试日志记录和设置属性。侦听器中的复杂操作（例如网络调用）可能会阻止规则执行。在完成KIE会话的工作后，请删除附加的事件侦听器，以便可以清理该会话，如以下示例所示：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">使用后示例事件侦听器已删除</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Listener listener = ...;
StatelessKnowledgeSession ksession = createSession();
try {
    ksession.insert(fact);
    ksession.fireAllRules();
    ...
} finally {
    if (session != null) {
        ksession.detachListener(listener);
        ksession.dispose();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关Drools引擎中内置事件监听器和调试日志记录的信息，请参阅<a href="#engine-event-listeners-con_decision-engine">Drools引擎事件监听器和调试日志记录</a> 。</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">﻿<div class="sect1">
<h2 id="_droolslanguagereferencechapter"><a class="anchor" href="#_droolslanguagereferencechapter"></a> <a class="link" href="#_droolslanguagereferencechapter">4。规则语言参考</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="drl-rules-con_drl-rules"><a class="anchor" href="#drl-rules-con_drl-rules"></a> <a class="link" href="#drl-rules-con_drl-rules">4.1。DRL（Drools规则语言）规则</a></h3>
<div class="paragraph">
<p>DRL（Drools规则语言）规则是您直接在其中定义的业务规则<code>.drl</code>文本文件。这些DRL文件是最终呈现Business Central中所有其他规则资产的源。您可以在Business Central界面中创建和管理DRL文件，或者使用Red Hat CodeReady Studio或其他集成开发环境（IDE）作为Maven或Java项目的一部分在外部创建它们。DRL文件可以包含一个或多个规则，这些规则至少定义了规则条件（ <code>when</code> ）和动作（ <code>then</code> ）。Business Central中的DRL设计器提供Java，DRL和XML的语法突出显示。</p>
</div>
<div class="paragraph">
<p>DRL文件包含以下组件：</p>
</div>
<div class="listingblock">
<div class="title">DRL文件中的组件</div>
<div class="content">
<pre class="highlightjs highlight"><code>package

import

function  // Optional

query  // Optional

declare   // Optional

global   // Optional

rule "rule name"
    // Attributes
    when
        // Conditions
    then
        // Actions
end

rule "rule2 name"

...</code></pre>
</div>
</div>
<div class="paragraph">
<p>以下示例DRL规则确定贷款申请决策服务中的年龄限制：</p>
</div>
<div class="listingblock">
<div class="title">贷款申请年龄限制的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Underage"
  salience 15
  agenda-group "applicationGroup"
  when
    $application : LoanApplication()
    Applicant( age &lt; 21 )
  then
    $application.setApproved( false );
    $application.setExplanation( "Underage" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>DRL文件可以包含单个或多个规则，查询和函数，并且可以定义资源声明，例如由规则和查询分配和使用的导入，全局和属性。DRL软件包必须在DRL文件的顶部列出，并且规则通常在最后列出。所有其他DRL组件都可以遵循任何顺序。</p>
</div>
<div class="paragraph">
<p>每个规则在规则包中必须具有唯一的名称。如果在包中的任何DRL文件中多次使用相同的规则名称，则规则将无法编译。规则名称始终用双引号引起来（ <code>rule "rule name"</code> ）以防止可能的编译错误，尤其是在规则名称中使用空格的情况下。</p>
</div>
<div class="paragraph">
<p>与DRL规则相关的所有数据对象必须与Business Central中的DRL文件位于同一项目包中。默认情况下，导入同一包中的资产。可以使用DRL规则导入其他软件包中的现有资产。</p>
</div>
<div class="sect3">
<h4 id="drl-packages-con_drl-rules"><a class="anchor" href="#drl-packages-con_drl-rules"></a> <a class="link" href="#drl-packages-con_drl-rules">4.1.1。DRL中的软件包</a></h4>
<div class="paragraph">
<p>包是Drools中相关资产的文件夹，例如数据对象，DRL文件，决策表和其他资产类型。包还充当每组规则的唯一名称空间。一个规则库可以包含多个程序包。通常，将包的所有规则与包声明存储在同一文件中，以便包是独立的。但是，您可以从要在规则中使用的其他包中导入对象。</p>
</div>
<div class="paragraph">
<p>以下示例是抵押应用程序决策服务中DRL文件的软件包名称和名称空间：</p>
</div>
<div class="listingblock">
<div class="title">DRL文件中的示例软件包定义</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mortgages;</code></pre>
</div>
</div>
<div class="paragraph">
<p>以下铁路图显示了可能构成一个包裹的所有组件：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/package.png" alt="包">
</div>
<div class="title">图46。包</div>
</div>
<div class="paragraph">
<p>请注意，程序包<em>必须</em>具有名称空间，并使用标准Java约定来声明程序包名称。即，没有空格，与允许空格的规则名称不同。就元素的顺序而言，它们可以以任何顺序出现在规则文件中，但<code>package</code>语句，该语句必须位于文件的顶部。在所有情况下，分号都是可选的。</p>
</div>
<div class="paragraph">
<p>注意，任何规则属性（如“规则属性”一节中所述）也可以在包级别编写，以取代该属性的默认值。修改后的默认值仍可以替换为规则中的属性设置。</p>
</div>
</div>
<div class="sect3">
<h4 id="drl-imports-con_drl-rules"><a class="anchor" href="#drl-imports-con_drl-rules"></a> <a class="link" href="#drl-imports-con_drl-rules">4.1.2。DRL中的导入语句</a></h4>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/import.png" alt="进口">
</div>
<div class="title">图47。进口</div>
</div>
<div class="paragraph">
<p>与Java中的import语句类似，DRL文件中的导入标识要在规则中使用的任何对象的标准路径和类型名称。您可以使用以下格式指定包和数据对象<code>packageName.objectName</code> ，并在不同的行上进行多次导入。Drools引擎自动从Java包中导入与DRL包同名的类，并从包中导入类。 <code>java.lang</code> 。</p>
</div>
<div class="paragraph">
<p>以下示例是抵押申请决策服务中贷款申请对象的导入语句：</p>
</div>
<div class="listingblock">
<div class="title">DRL文件中的示例导入语句</div>
<div class="content">
<pre class="highlightjs highlight"><code>import org.mortgages.LoanApplication;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="drl-functions-con_drl-rules"><a class="anchor" href="#drl-functions-con_drl-rules"></a> <a class="link" href="#drl-functions-con_drl-rules">4.1.3。DRL中的功能</a></h4>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/function.png" alt="功能">
</div>
<div class="title">图48。功能</div>
</div>
<div class="paragraph">
<p>DRL文件中的函数将语义代码放入规则源文件中，而不是Java类中。如果操作（ <code>then</code> ）规则的一部分会重复使用，并且每个规则的参数都不同。在DRL文件中的规则上方，您可以声明函数或从帮助程序类中导入静态方法作为函数，然后在操作中按名称使用该函数（ <code>then</code> ）的部分规则。</p>
</div>
<div class="paragraph">
<p>以下示例说明了在DRL文件中声明或导入的函数：</p>
</div>
<div class="listingblock">
<div class="title">带有规则的示例函数声明（选项1）</div>
<div class="content">
<pre class="highlightjs highlight"><code>function String hello(String applicantName) {
    return "Hello " + applicantName + "!";
}

rule "Using a function"
  when
    // Empty
  then
    System.out.println( hello( "James" ) );
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">带规则的示例函数导入（选项2）</div>
<div class="content">
<pre class="highlightjs highlight"><code>import function my.package.applicant.hello;

rule "Using a function"
  when
    // Empty
  then
    System.out.println( hello( "James" ) );
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="drl-queries-con_drl-rules"><a class="anchor" href="#drl-queries-con_drl-rules"></a> <a class="link" href="#drl-queries-con_drl-rules">4.1.4。DRL中的查询</a></h4>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/query.png" alt="询问">
</div>
<div class="title">图49。询问</div>
</div>
<div class="paragraph">
<p>DRL文件中的查询在Drools引擎的工作内存中搜索与DRL文件中的规则相关的事实。您在DRL文件中添加查询定义，然后在应用程序代码中获得匹配的结果。查询搜索一组已定义的条件，不需要<code>when</code>要么<code>then</code>规格。查询名称是KIE基础的全局名称，因此在项目中的所有其他规则查询中必须唯一。要返回查询结果，请构造一个<code>QueryResults</code>定义使用<code>ksession.getQueryResults("name")</code> ，在哪里<code>"name"</code>是查询名称。这将返回查询结果列表，使您能够检索与查询匹配的对象。您可以在DRL文件中的规则上方定义查询和查询结果参数。</p>
</div>
<div class="paragraph">
<p>以下示例是DRL文件中针对抵押贷款申请决策服务中未成年申请人的查询定义，以及随附的应用程序代码：</p>
</div>
<div class="listingblock">
<div class="title">DRL文件中的示例查询定义</div>
<div class="content">
<pre class="highlightjs highlight"><code>query "people under the age of 21"
    $person : Person( age &lt; 21 )
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">获取查询结果的示例应用程序代码</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">QueryResults results = ksession.getQueryResults( "people under the age of 21" );
System.out.println( "we have " + results.size() + " people under the age  of 21" );</code></pre>
</div>
</div>
<div class="paragraph">
<p>您也可以遍历返回的内容<code>QueryResults</code>使用标准<code>for</code>环。每个元素都是<code>QueryResultsRow</code>您可以用来访问元组中的每个列。</p>
</div>
<div class="listingblock">
<div class="title">获取和迭代查询结果的示例应用程序代码</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">QueryResults results = ksession.getQueryResults( "people under the age of 21" );
System.out.println( "we have " + results.size() + " people under the age of 21" );

System.out.println( "These people are under the age of 21:" );

for ( QueryResultsRow row : results ) {
    Person person = ( Person ) row.get( "person" );
    System.out.println( person.getName() + "\n" );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>添加了对位置语法的支持，以获得更紧凑的代码。默认情况下，类型声明中声明的类型顺序与参数位置匹配。但是可以使用@position注释覆盖它们。这允许模式与位置参数一起使用，而不是更冗长的命名参数。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>declare Cheese
    name : String @position(1)
    shop : String @position(2)
    price : int @position(0)
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>org.drools.definition.type包中的@Position批注可用于在类路径上批注原始pojo。当前，仅可以注释类中的字段。支持类的继承，但不支持接口或方法。下面的isContainedIn查询演示了模式中位置参数的使用； <code>Location(x, y;)</code>代替<code>Location( thing == x, location == y).</code></p>
</div>
<div class="paragraph">
<p>查询现在可以调用其他查询，此查询与可选查询参数结合在一起可提供派生查询样式的反向链接。参数支持位置语法和命名语法。也可以将位置和名称混合使用，但是位置必须首先出现，并用半冒号分隔。文字表达式可以作为查询参数传递，但是在此阶段，您不能将表达式与变量混合使用。这是一个调用另一个查询的查询示例。请注意，这里的“ z”将始终是“输出”变量。'？'符号表示查询仅是拉式查询，返回结果后，随着基础数据的更改，您将不会再收到进一步的结果。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>declare Location
    thing : String
    location : String
end

query isContainedIn( String x, String y )
    Location(x, y;)
    or
    ( Location(z, y;) and ?isContainedIn(x, z;) )
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>如前所述，您可以使用实时“开放式”查询来随时间从查询结果中接收更改，作为针对更改查询的基础数据。注意，“ look”规则不使用'？来调用查询。'。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>query isContainedIn( String x, String y )
    Location(x, y;)
    or
    ( Location(z, y;) and isContainedIn(x, z;) )
end

rule look when
    Person( $l : likes )
    isContainedIn( $l, 'office'; )
then
   insertLogical( $l 'is in the office' );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Drools支持派生查询的统一，简而言之，这意味着参数是可选的。可以使用静态字段org.drools.core.runtime.rule从Java调用查询，而无需指定参数。Variable.v-请注意，您必须使用“ v”，而不是Variable的替代实例。这些称为“输出”参数。请注意，查询本身不会在编译时声明参数是in还是out，这可以在每次使用时纯在运行时定义。以下示例将返回办公室中包含的所有对象。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>results = ksession.getQueryResults( "isContainedIn", new Object[] {  Variable.v, "office" } );
l = new ArrayList&lt;List&lt;String&gt;&gt;();
for ( QueryResultsRow r : results ) {
    l.add( Arrays.asList( new String[] { (String) r.get( "x" ), (String) r.get( "y" ) } ) );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该算法使用堆栈来处理递归，因此方法堆栈不会崩溃。</p>
</div>
<div class="paragraph">
<p>也可以将事实的字段用作查询的输入参数，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>query contains(String $s, String $c)
    $s := String( this.contains( $c ) )
end

rule PersonNamesWithA when
    $p : Person()
    contains( $p.name, "a"; )
then
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>通常，还有任何一种有效的表达式，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>query checkLength(String $s, int $l)
    $s := String( length == $l )
end

rule CheckPersonNameLength when
    $i : Integer()
    $p : Person()
    checkLength( $p.name, 1 + $i + $p.age; )
then
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>尚不支持以下功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>列表和地图统一</p>
</li>
<li>
<p>表达式统一-pred（X，X + 1，X * Y / 7）</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="drl-declarations-con_drl-rules"><a class="anchor" href="#drl-declarations-con_drl-rules"></a> <a class="link" href="#drl-declarations-con_drl-rules">4.1.5。DRL中的类型声明和元数据</a></h4>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/type_declaration.png" alt="类型声明">
</div>
<div class="title">图50。类型声明</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/meta_data.png" alt="元数据">
</div>
<div class="title">图51。元数据</div>
</div>
<div class="paragraph">
<p>DRL文件中的声明为DRL文件中的规则使用的事实类型定义了新的事实类型或元数据：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>新事实类型：</strong> <code>java.lang</code> Drools的包装是<code>Object</code> ，但是您可以根据需要在DRL文件中声明其他类型。在DRL文件中声明事实类型使您可以直接在Drools引擎中定义新的事实模型，而无需使用Java之类的低级语言创建模型。您也可以在已经构建域模型并且要用主要在推理过程中使用的其他实体补充该模型时声明新的类型。</p>
</li>
<li>
<p><strong>事实类型的元数据：</strong>您可以采用以下格式关联元数据<code>@key(value)</code>有新的或现有的事实。元数据可以是事实属性未表示的任何类型的数据，并且在该事实类型的所有实例之间是一致的。元数据可以在运行时由Drools引擎查询，并在推理过程中使用。</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="drl-declarations-without-metadata-con_drl-rules"><a class="anchor" href="#drl-declarations-without-metadata-con_drl-rules"></a> <a class="link" href="#drl-declarations-without-metadata-con_drl-rules">4.1.5.1。DRL中没有元数据的类型声明</a></h5>
<div class="paragraph">
<p>声明新事实不需要任何元数据，但必须包含属性或字段的列表。如果类型声明不包含标识属性，则Drools引擎将在类路径中搜索现有的事实类，如果缺少该类，则会引发错误。</p>
</div>
<div class="paragraph">
<p>以下示例是新事实类型的声明<code>Person</code> DRL文件中没有元数据：</p>
</div>
<div class="listingblock">
<div class="title">使用规则声明新事实类型的示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
  name : String
  dateOfBirth : java.util.Date
  address : Address
end

rule "Using a declared type"
  when
    $p : Person( name == "James" )
  then   // Insert Mark, who is a customer of James.
    Person mark = new Person();
    mark.setName( "Mark" );
    insert( mark );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，新事实类型<code>Person</code>具有三个属性<code>name</code> ， <code>dateOfBirth</code>和<code>address</code> 。每个属性的类型都可以是任何有效的Java类型，包括您创建的另一个类或先前声明的事实类型。的<code>dateOfBirth</code>属性具有类型<code>java.util.Date</code> ，来自Java API以及<code>address</code>属性具有先前定义的事实类型<code>Address</code> 。</p>
</div>
<div class="paragraph">
<p>为了避免在每次声明类时都写完全限定名称，可以将完整的类名称定义为类的一部分。 <code>import</code>条款：</p>
</div>
<div class="listingblock">
<div class="title">导入中具有完全限定的类名的示例类型声明</div>
<div class="content">
<pre class="highlightjs highlight"><code>import java.util.Date

declare Person
    name : String
    dateOfBirth : Date
    address : Address
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>当您声明新的事实类型时，Drools引擎会在编译时生成代表该事实类型的Java类。生成的Java类是类型定义的一对一JavaBeans映射。</p>
</div>
<div class="paragraph">
<p>例如，以下Java类是从示例生成的<code>Person</code>类型声明：</p>
</div>
<div class="listingblock">
<div class="title">为Person事实类型声明生成的Java类</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Person implements Serializable {
    private String name;
    private java.util.Date dateOfBirth;
    private Address address;

    // Empty constructor
    public Person() {...}

    // Constructor with all fields
    public Person( String name, Date dateOfBirth, Address address ) {...}

    // If keys are defined, constructor with keys
    public Person( ...keys... ) {...}

    // Getters and setters
    // `equals` and `hashCode`
    // `toString`
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后，您可以像其他任何事实一样在规则中使用生成的类，如前面的规则示例中所示， <code>Person</code>类型声明：</p>
</div>
<div class="listingblock">
<div class="title">使用声明的Person事实类型的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Using a declared type"
  when
    $p : Person( name == "James" )
  then   // Insert Mark, who is a customer of James.
    Person mark = new Person();
    mark.setName( "Mark" );
    insert( mark );
end</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="drl-declarations-enumerative-con_drl-rules"><a class="anchor" href="#drl-declarations-enumerative-con_drl-rules"></a> <a class="link" href="#drl-declarations-enumerative-con_drl-rules">4.1.5.2。DRL中的枚举类型声明</a></h5>
<div class="paragraph">
<p>DRL支持采用以下格式声明枚举类型<code>declare enum <factType></code> ，后跟一个用逗号分隔的以分号结尾的值列表。然后，您可以在DRL文件中的规则中使用枚举列表。</p>
</div>
<div class="paragraph">
<p>例如，以下枚举类型声明定义了员工调度规则的星期几：</p>
</div>
<div class="listingblock">
<div class="title">带有调度规则的示例枚举类型声明</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare enum DaysOfWeek
   SUN("Sunday"),MON("Monday"),TUE("Tuesday"),WED("Wednesday"),THU("Thursday"),FRI("Friday"),SAT("Saturday");

   fullName : String
end

rule "Using a declared Enum"
when
   $emp : Employee( dayOff == DaysOfWeek.MONDAY )
then
   ...
end</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="drl-declarations-extended-con_drl-rules"><a class="anchor" href="#drl-declarations-extended-con_drl-rules"></a> <a class="link" href="#drl-declarations-extended-con_drl-rules">4.1.5.3。DRL中的扩展类型声明</a></h5>
<div class="paragraph">
<p>DRL支持格式的类型声明继承<code>declare <factType1> extends <factType2></code> 。要用DRL中声明的子类型扩展Java中声明的类型，请在没有任何字段的声明语句中重复父类型。</p>
</div>
<div class="paragraph">
<p>例如，以下类型声明扩展了<code>Student</code>从顶层输入<code>Person</code>类型和一个<code>LongTermStudent</code>从中键入<code>Student</code>子类型：</p>
</div>
<div class="listingblock">
<div class="title">扩展类型声明示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>import org.people.Person

declare Person end

declare Student extends Person
    school : String
end

declare LongTermStudent extends Student
    years : int
    course : String
end</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="drl-declarations-with-metadata-con_drl-rules"><a class="anchor" href="#drl-declarations-with-metadata-con_drl-rules"></a> <a class="link" href="#drl-declarations-with-metadata-con_drl-rules">4.1.5.4。DRL中带有元数据的类型声明</a></h5>
<div class="paragraph">
<p>您可以采用以下格式关联元数据<code>@key(value)</code> （值是可选的）以及事实类型或事实属性。元数据可以是事实属性未表示的任何类型的数据，并且在该事实类型的所有实例之间是一致的。元数据可以在运行时由Drools引擎查询，并在推理过程中使用。您在事实类型的属性之前声明的任何元数据都被分配给事实类型，而在属性之后声明的元数据则被分配给该特定属性。</p>
</div>
<div class="paragraph">
<p>在下面的示例中，两个元数据属性<code>@author</code>和<code>@dateOfCreation</code>被宣布为<code>Person</code>事实类型，以及两个元数据项<code>@key</code>和<code>@maxLength</code>被宣布为<code>name</code>属性。的<code>@key</code>元数据属性没有必需的值，因此省略了括号和该值。</p>
</div>
<div class="listingblock">
<div class="title">事实类型和属性的示例元数据声明</div>
<div class="content">
<pre class="highlightjs highlight"><code>import java.util.Date

declare Person
    @author( Bob )
    @dateOfCreation( 01-Feb-2009 )

    name : String @key @maxLength( 30 )
    dateOfBirth : Date
    address : Address
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于现有类型的元数据属性的声明，您可以将完全限定的类名标识为<code>import</code>所有声明或作为个人一部分的条款<code>declare</code>条款：</p>
</div>
<div class="listingblock">
<div class="title">导入类型的元数据声明示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>import org.drools.examples.Person

declare Person
    @author( Bob )
    @dateOfCreation( 01-Feb-2009 )
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">声明类型的元数据声明示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare org.drools.examples.Person
    @author( Bob )
    @dateOfCreation( 01-Feb-2009 )
end</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="drl-declarations-metadata-tags-ref_drl-rules"><a class="anchor" href="#drl-declarations-metadata-tags-ref_drl-rules"></a> <a class="link" href="#drl-declarations-metadata-tags-ref_drl-rules">4.1.5.5。DRL中事实类型和属性声明的元数据标签</a></h5>
<div class="paragraph">
<p>尽管您可以在DRL声明中定义自定义元数据属性，但Drools引擎还支持以下预定义的元数据标签，用于事实类型或事实类型属性的声明。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>本节中的示例引用了<code>VoiceCall</code>类假定样本应用程序域模型包括以下类详细信息：</p>
</div>
<div class="listingblock">
<div class="title">示例电信域模型中的VoiceCall事实类</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class VoiceCall {
  private String  originNumber;
  private String  destinationNumber;
  private Date    callDateTime;
  private long    callDuration;  // in milliseconds

  // Constructors, getters, and setters
}</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">@角色</dt>
<dd>
<p>该标签确定在复杂事件处理过程中，给定的事实类型是作为常规事实还是在Drools引擎中的事件处理。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认参数：<code>fact</code></p>
</div>
<div class="paragraph">
<p>支持的参数： <code>fact</code> ，<code>event</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@role( fact | event )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例：将VoiceCall声明为事件类型</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @role( event )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@时间戳</dt>
<dd>
<p>该标签会自动分配给Drools引擎中的每个事件。默认情况下，时间由会话时钟提供，并在将事件插入Drools引擎的工作内存时分配给事件。您可以指定自定义时间戳属性，而不是会话时钟添加的默认时间戳。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认参数：Drools引擎会话时钟增加的时间</p>
</div>
<div class="paragraph">
<p>支持的参数：会话时钟时间或自定义时间戳属性</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@timestamp( &lt;attributeName&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例：声明VoiceCall时间戳属性</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @role( event )
  @timestamp( callDateTime )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@持续时间</dt>
<dd>
<p>该标签确定Drools引擎中事件的持续时间。事件可以是基于时间间隔的事件或时间点事件。基于间隔的事件具有持续时间，并持续存在于Drools引擎的工作存储器中，直到其持续时间过去。时间点事件没有持续时间，本质上是持续时间为零的基于间隔的事件。默认情况下，Drools引擎中的每个事件的持续时间为零。您可以指定一个自定义的持续时间属性，而不是默认属性。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认参数：空（零）</p>
</div>
<div class="paragraph">
<p>支持的参数：自定义工期属性</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@duration( &lt;attributeName&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例：声明VoiceCall持续时间属性</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @role( event )
  @timestamp( callDateTime )
  @duration( callDuration )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@expires</dt>
<dd>
<p>该标签确定事件在Drools引擎的工作内存中到期之前的持续时间。默认情况下，当事件不再匹配并激活任何当前规则时，事件就会过期。您可以定义事件应过期的时间。该标签定义还覆盖了根据KIE基础中的时间约束和滑动窗口计算出的隐式过期偏移。仅当Drools引擎以流模式运行时，此标签才可用。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认参数：Null（事件在事件无法匹配和激活规则后过期）</p>
</div>
<div class="paragraph">
<p>支持的参数：自定义<code>timeOffset</code>格式的属性<code>[<mark>#d][#h][#m][#s][</mark>[ms]]</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@expires( &lt;timeOffset&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例：为VoiceCall事件声明过期偏移量</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @role( event )
  @timestamp( callDateTime )
  @duration( callDuration )
  @expires( 1h35m )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@typesafe</dt>
<dd>
<p>此选项卡确定是否使用类型安全性编译给定的事实类型。默认情况下，所有类型声明都是在启用类型安全的情况下编译的。您可以将此行为覆盖为类型不安全的评估，在评估中，所有约束都将作为MVEL约束生成并动态执行。在处理没有任何泛型或混合类型集合的集合时，这很有用。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认参数：<code>true</code></p>
</div>
<div class="paragraph">
<p>支持的参数： <code>true</code> ，<code>false</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@typesafe( &lt;boolean&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例：声明VoiceCall以进行类型不安全的评估</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @role( fact )
  @typesafe( false )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@serialVersionUID</dt>
<dd>
<p>该标签定义了一个标识<code>serialVersionUID</code>事实声明中可序列化类的值。如果可序列化的类未明确声明<code>serialVersionUID</code> ，序列化运行时会计算默认值<code>serialVersionUID</code>该值基于类的各个方面，如<a href="https://docs.oracle.com/javase/10/docs/specs/serialization/index.html">Java对象序列化规范中所述</a> 。但是，为了获得最佳的反序列化结果以及与序列化KIE会话的更大兼容性，请设置<code>serialVersionUID</code>根据相关类别或您的DRL声明中的需要。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认参数：空</p>
</div>
<div class="paragraph">
<p>支持的参数：自定义<code>serialVersionUID</code>整数</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@serialVersionUID( &lt;integer&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例：为VoiceCall类声明serialVersionUID</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare VoiceCall
  @serialVersionUID( 42 )
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@键</dt>
<dd>
<p>此标记使事实类型属性可以用作事实类型的键标识符。然后，生成的类可以实现<code>equals()</code>和<code>hashCode()</code>确定类型的两个实例是否相等的方法。Drools引擎还可以使用所有关键属性作为参数来生成构造函数。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认参数：无</p>
</div>
<div class="paragraph">
<p>支持的参数：无</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;attributeDefinition&gt; @key</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例：声明人员类型属性作为键</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
    firstName : String @key
    lastName : String @key
    age : int
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于此示例，Drools引擎会检查<code>firstName</code>和<code>lastName</code>属性，以确定是否有两个实例<code>Person</code>彼此相等，但不检查<code>age</code>属性。Drools引擎还隐式生成了三个构造函数：一个没有参数，一个带有参数。 <code>@key</code>字段，并包含所有字段：</p>
</div>
<div class="listingblock">
<div class="title">键声明的示例构造函数</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person() // Empty constructor

Person( String firstName, String lastName )

Person( String firstName, String lastName, int age )</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后，您可以基于键构造函数创建该类型的实例，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">使用键构造函数的示例实例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Person person = new Person( "John", "Doe" );</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@位置</dt>
<dd>
<p>该标记确定声明的事实类型属性或字段在位置参数中的位置，从而覆盖属性的默认声明顺序。您可以使用此标记来修改模式中的位置约束，同时在类型声明和位置参数中保持一致的格式。您只能将此标签用于类路径上类中的字段。如果单个类中的某些字段使用此标记，而某些字段则不使用，则没有此标记的属性将以声明的顺序位于最后。支持类的继承，但不支持方法的接口。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认参数：无</p>
</div>
<div class="paragraph">
<p>支持的参数：任意整数</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;attributeDefinition&gt; @position ( &lt;integer&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例：声明事实类型并覆盖声明的顺序</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
    firstName : String @position( 1 )
    lastName : String @position( 0 )
    age : int @position( 2 )
    occupation: String
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，按以下顺序在位置参数中对属性进行优先级排序：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>lastName</code></p>
</li>
<li>
<p><code>firstName</code></p>
</li>
<li>
<p><code>age</code></p>
</li>
<li>
<p><code>occupation</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>在位置参数中，不需要指定字段名称，因为位置映射到已知的命名字段。例如，参数<code>Person( lastName == "Doe" )</code>是相同的<code>Person( "Doe"; )</code> ，其中<code>lastName</code>字段在DRL声明中具有最高位置注释。分号<code>;</code>表示之前的所有内容都是位置参数。您可以使用分号将模式中的位置参数和命名参数分开，以将它们分开。位置参数中尚未绑定的所有变量都将绑定到映射到该位置的字段。</p>
</div>
<div class="paragraph">
<p>以下示例模式说明了构造位置参数和命名参数的不同方法。模式具有两个约束和一个绑定，分号将位置部分与命名的参数部分区分开。位置参数支持仅使用文字的变量，文字和表达式，但不单独支持变量。</p>
</div>
<div class="listingblock">
<div class="title">具有位置和命名参数的示例模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( "Doe", "John", $a; )

Person( "Doe", "John"; $a : age )

Person( "Doe"; firstName == "John", $a : age )

Person( lastName == "Doe"; firstName == "John", $a : age )</code></pre>
</div>
</div>
<div class="paragraph">
<p>位置参数可以分为<em>输入参数</em>或<em>输出参数</em> 。输入参数包含一个先前声明的绑定，并使用统一约束该绑定。当绑定尚不存在时，输出参数将生成声明并将其绑定到位置参数表示的字段。</p>
</div>
<div class="paragraph">
<p>在扩展类型声明中，定义时请小心<code>@position</code>注释，因为属性位置是在子类型中继承的。这种继承会导致混合的属性顺序，在某些情况下可能会造成混淆。两个字段可以具有相同的<code>@position</code>值和连续值不需要声明。如果重复某个位置，则使用继承（父类型中的位置值具有优先级），然后使用从第一个声明到最后一个声明的声明顺序来解决冲突。</p>
</div>
<div class="paragraph">
<p>例如，以下扩展类型声明导致混合的位置优先级：</p>
</div>
<div class="listingblock">
<div class="title">具有混合位置注释的示例扩展事实类型</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
    firstName : String @position( 1 )
    lastName : String @position( 0 )
    age : int @position( 2 )
    occupation: String
end

declare Student extends Person
    degree : String @position( 1 )
    school : String @position( 0 )
    graduationDate : Date
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，按以下顺序在位置参数中对属性进行优先级排序：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>lastName</code> （父类型中的位置0）</p>
</li>
<li>
<p><code>school</code> （子类型中的位置0）</p>
</li>
<li>
<p><code>firstName</code> （父类型中的位置1）</p>
</li>
<li>
<p><code>degree</code> （子类型中的位置1）</p>
</li>
<li>
<p><code>age</code> （父类型中的位置2）</p>
</li>
<li>
<p><code>occupation</code> （第一个没有位置注释的字段）</p>
</li>
<li>
<p><code>graduationDate</code> （没有位置注释的第二个字段）</p>
</li>
</ol>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="property-change-listeners-con_drl-rules"><a class="anchor" href="#property-change-listeners-con_drl-rules"></a> <a class="link" href="#property-change-listeners-con_drl-rules">4.1.5.6。事实类型的属性更改设置和侦听器</a></h5>
<div class="paragraph">
<p>默认情况下，Drools引擎不会在每次触发规则时重新评估事实类型的所有事实模式，而是仅对约束或限制在给定模式内的修改后的属性做出反应。例如，如果规则调用<code>modify()</code>作为规则操作的一部分，但是该操作不会在KIE库中生成新数据，因此Drools引擎不会自动重新评估所有事实模式，因为未修改任何数据。此属性反应行为可防止在KIE库中发生不必要的递归，并导致更有效的规则评估。此行为还意味着您不必总是使用<code>no-loop</code>规则属性，以避免无限递归。</p>
</div>
<div class="paragraph">
<p>您可以使用以下方法修改或禁用此属性的反应性行为<code>KnowledgeBuilderConfiguration</code>选项，然后在Java类或DRL文件中使用属性更改设置来根据需要微调属性反应性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ALWAYS</code> ：（默认值）所有类型都具有属性反应性，但是您可以通过使用<code>@classReactive</code>属性更改设置。</p>
</li>
<li>
<p><code>ALLOWED</code> ：没有类型是属性反应型的，但是您可以通过使用<code>@propertyReactive</code>属性更改设置。</p>
</li>
<li>
<p><code>DISABLED</code> ：没有类型是属性反应型的。所有属性更改侦听器都将被忽略。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">KnowledgeBuilderConfiguration中的示例属性反应性设置</div>
<div class="content">
<pre class="highlightjs highlight"><code>KnowledgeBuilderConfiguration config = KnowledgeBuilderFactory.newKnowledgeBuilderConfiguration();
config.setOption(PropertySpecificOption.ALLOWED);
KnowledgeBuilder kbuilder = KnowledgeBuilderFactory.newKnowledgeBuilder(config);</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者，您可以更新<code>drools.propertySpecific</code>中的系统属性<code>standalone.xml</code>您的Drools发行文件：</p>
</div>
<div class="listingblock">
<div class="title">系统属性中的示例属性反应性设置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;system-properties&gt;
  ...
  &lt;property name="drools.propertySpecific" value="ALLOWED"/&gt;
  ...
&lt;/system-properties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Drools引擎支持以下属性更改设置和事实类或已声明的DRL事实类型的侦听器：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">@classReactive</dt>
<dd>
<p>如果属性反应性设置为<code>ALWAYS</code>在Drools引擎中（所有类型都是属性反应性的），此标记禁用特定Java类或已声明的DRL事实类型的默认属性反应行为。如果您希望Drools引擎在每次触发规则时重新评估指定事实类型的所有事实模式，而不是仅对在给定模式内受约束或约束的已修改属性做出反应，则可以使用此标记。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">示例：在DRL类型声明中禁用默认属性反应性</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
  @classReactive
    firstName : String
    lastName : String
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例：在Java类中禁用默认属性反应性</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@classReactive
public static class Person {
    private String firstName;
    private String lastName;
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@propertyReactive</dt>
<dd>
<p>如果属性反应性设置为<code>ALLOWED</code>在Drools引擎中（除非指定，否则所有类型都不是属性可响应的），此标记可为特定的Java类或已声明的DRL事实类型启用属性响应。如果您希望Drools引擎仅对指定事实类型的给定模式内受约束或约束的修改属性做出反应，而不是每次触发规则时都重新评估该事实的所有事实模式，则可以使用此标记。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">示例：在DRL类型声明中启用属性反应性（全局禁用反应性时）</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
  @propertyReactive
    firstName : String
    lastName : String
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例：在Java类中启用属性反应性（全局禁用反应性时）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@propertyReactive
public static class Person {
    private String firstName;
    private String lastName;
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@看</dt>
<dd>
<p>此标记可为您在DRL规则中内联指定事实模式的其他属性启用属性反应性。仅当属性反应性设置为时才支持此标签。 <code>ALWAYS</code>在Drools引擎中，或者将属性反应性设置为<code>ALLOWED</code>而相关事实类型使用<code>@propertyReactive</code>标签。您可以在DRL规则中使用此标记，以在属性反应性逻辑中添加或排除特定属性。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认参数：无</p>
</div>
<div class="paragraph">
<p>支持的参数：属性名称， <code>*</code> （所有）， <code>!</code> （不）， <code>!*</code> （无属性）</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;factPattern&gt; @watch ( &lt;property&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例：启用或禁用事实模式中的属性反应性</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Listens for changes in both `firstName` (inferred) and `lastName`:
Person(firstName == $expectedFirstName) @watch( lastName )

// Listens for changes in all properties of the `Person` fact:
Person(firstName == $expectedFirstName) @watch( * )

// Listens for changes in `lastName` and explicitly excludes changes in `firstName`:
Person(firstName == $expectedFirstName) @watch( lastName, !firstName )

// Listens for changes in all properties of the `Person` fact except `age`:
Person(firstName == $expectedFirstName) @watch( *, !age )

// Excludes changes in all properties of the `Person` fact (equivalent to using `@classReactivity` tag):
Person(firstName == $expectedFirstName) @watch( !* )</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您使用Drools引擎生成编译错误， <code>@watch</code>事实类型中使用<code>@classReactive</code>标签（禁用属性反应性）或将属性反应性设置为<code>ALLOWED</code>在Drools引擎中并且相关事实类型未使用<code>@propertyReactive</code>标签。如果您在侦听器批注中复制属性，则还会出现编译错误，例如<code>@watch( firstName, ! firstName )</code> 。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">@propertyChangeSupport</dt>
<dd>
<p>对于实现对<a href="https://download.oracle.com/otndocs/jcp/7224-javabeans-1.01-fr-spec-oth-JSpec/">JavaBeans Specification中</a>定义的属性更改的支持的事实，此标签使Drools引擎可以监视事实属性中的更改。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">示例：声明JavaBeans对象中的属性更改支持</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
    @propertyChangeSupport
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="drl-declarations-access-con_drl-rules"><a class="anchor" href="#drl-declarations-access-con_drl-rules"></a> <a class="link" href="#drl-declarations-access-con_drl-rules">4.1.5.7。访问应用程序代码中的DRL声明的类型</a></h5>
<div class="paragraph">
<p>DRL中声明的类型通常在DRL文件中使用，而Java模型通常在规则和应用程序之间共享时使用。由于声明的类型是在KIE基本编译时生成的，因此应用程序要等到应用程序运行时才能访问它们。在某些情况下，应用程序需要直接从声明的类型访问和处理事实，尤其是当应用程序包装Drools引擎并为规则管理提供更高级别的特定于域的用户界面时。</p>
</div>
<div class="paragraph">
<p>要直接从应用程序代码处理声明的类型，可以使用<code>org.drools.definition.type.FactType</code> Drools中的API。通过此API，您可以实例化，读取和写入声明的事实类型的字段。</p>
</div>
<div class="paragraph">
<p>以下示例代码修改了<code>Person</code>直接从应用程序获取事实类型：</p>
</div>
<div class="listingblock">
<div class="title">通过FactType API处理声明的事实类型的示例应用程序代码</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.Date;

import org.kie.api.definition.type.FactType;
import org.kie.api.KieBase;
import org.kie.api.runtime.KieSession;

...

// Get a reference to a KIE base with the declared type:
KieBase kbase = ...

// Get the declared fact type:
FactType personType = kbase.getFactType("org.drools.examples", "Person");

// Create instances:
Object bob = personType.newInstance();

// Set attribute values:
personType.set(bob, "name", "Bob" );
personType.set(bob, "dateOfBirth", new Date());
personType.set(bob, "address", new Address("King's Road","London","404"));

// Insert the fact into a KIE session:
KieSession ksession = ...
ksession.insert(bob);
ksession.fireAllRules();

// Read attributes:
String name = (String) personType.get(bob, "name");
Date date = (Date) personType.get(bob, "dateOfBirth");</code></pre>
</div>
</div>
<div class="paragraph">
<p>该API还包括其他有用的方法，例如一次性设置所有属性，从<code>Map</code>集合，或一次将所有属性读入<code>Map</code>采集。</p>
</div>
<div class="paragraph">
<p>尽管API的行为类似于Java反射，但API并未使用反射，而是依赖于使用生成的字节码实现的性能更高的访问器。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="drl-globals-con_drl-rules"><a class="anchor" href="#drl-globals-con_drl-rules"></a> <a class="link" href="#drl-globals-con_drl-rules">4.1.6。DRL中的全局变量</a></h4>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/global.png" alt="全球">
</div>
<div class="title">图52。全球</div>
</div>
<div class="paragraph">
<p>DRL文件中的全局变量通常为规则提供数据或服务，例如规则结果中使用的应用程序服务，并从规则返回数据，例如在规则结果中添加的日志或值。您可以通过KIE会话配置或REST操作在Drools引擎的工作内存中设置全局值，在DRL文件中的规则上方声明全局变量，然后在操作中使用它（ <code>then</code> ）的部分规则。对于多个全局变量，请在DRL文件中使用单独的行。</p>
</div>
<div class="paragraph">
<p>以下示例说明了Drools引擎的全局变量列表配置以及DRL文件中的相应全局变量定义：</p>
</div>
<div class="listingblock">
<div class="title">Drools引擎的示例全局列表配置</div>
<div class="content">
<pre class="highlightjs highlight"><code>List&lt;String&gt; list = new ArrayList&lt;&gt;();
KieSession kieSession = kiebase.newKieSession();
kieSession.setGlobal( "myGlobalList", list );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">带有规则的示例全局变量定义</div>
<div class="content">
<pre class="highlightjs highlight"><code>global java.util.List myGlobalList;

rule "Using a global"
  when
    // Empty
  then
    myGlobalList.add( "My global list" );
end</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p>除非全局变量具有恒定的不变值，否则请勿使用全局变量在规则中建立条件。全局变量未插入Drools引擎的工作存储器中，因此Drools引擎无法跟踪变量的值更改。</p>
</div>
<div class="paragraph">
<p>不要使用全局变量在规则之间共享数据。规则总是会推理并对工作内存状态做出反应，因此，如果您希望将数据从一个规则传递到另一个规则，请将数据作为事实断言到Drools引擎的工作内存中。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>全局变量的用例可能是电子邮件服务的实例。在调用Drools引擎的集成代码中，您将获得<code>emailService</code>对象，然后将其设置在Drools引擎的工作内存中。在DRL文件中，您声明您具有一个全局类型<code>emailService</code>并给它起个名字<code>"email"</code> ，然后在规则后果中，您可以使用诸如<code>email.sendSMS(number, message)</code> 。</p>
</div>
<div class="paragraph">
<p>如果在多个包中声明具有相同标识符的全局变量，则必须将所有包设置为相同的类型，以便它们都引用相同的全局值。</p>
</div>
</div>
<div class="sect3">
<h4 id="rules-attributes-ref_drl-rules"><a class="anchor" href="#rules-attributes-ref_drl-rules"></a> <a class="link" href="#rules-attributes-ref_drl-rules">4.1.7。DRL中的规则属性</a></h4>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/rule_attributes.png" alt="规则属性">
</div>
<div class="title">图53。规则属性</div>
</div>
<div class="paragraph">
<p>规则属性是可以添加到业务规则以修改规则行为的其他规范。在DRL文件中，通常会在规则条件和操作上方定义规则属性，并在不同行上以以下格式定义多个属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "rule_name"
    // Attribute
    // Attribute
    when
        // Conditions
    then
        // Actions
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>下表列出了可以分配给规则的属性的名称和支持的值：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表11。规则属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:70%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>salience</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">定义规则优先级的整数。在激活队列中排序时，具有较高显着性值的规则将具有较高的优先级。</p>
<p class="tableblock">例：<code>salience 10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>enabled</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">布尔值。选择该选项后，将启用规则。未选择该选项时，该规则被禁用。</p>
<p class="tableblock">例：<code>enabled true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>date-effective</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">包含日期和时间定义的字符串。仅当当前日期和时间在<code>date-effective</code>属性。</p>
<p class="tableblock">例：<code>date-effective "4-Sep-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>date-expires</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">包含日期和时间定义的字符串。如果当前日期和时间晚于<code>date-expires</code>属性。</p>
<p class="tableblock">例：<code>date-expires "4-Oct-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>no-loop</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">布尔值。选择该选项后，如果规则的结果重新触发了先前满足的条件，则无法重新激活（循环）规则。如果未选择条件，则在这些情况下可以循环规则。</p>
<p class="tableblock">例：<code>no-loop true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>agenda-group</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个字符串，标识要向其分配规则的议程组。通过议程组，您可以对议程进行分区，以提供对规则组的更多执行控制。只有已获得焦点的议程组中的规则才能被激活。</p>
<p class="tableblock">例：<code>agenda-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>activation-group</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个字符串，用于标识您要向其分配规则的激活（或XOR）组。在激活组中，只能激活一个规则。触发的第一个规则将取消激活组中所有规则的所有未决激活。</p>
<p class="tableblock">例：<code>activation-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个长整数值，定义了如果仍满足规则条件，则可以激活规则的持续时间（以毫秒为单位）。</p>
<p class="tableblock">例：<code>duration 10000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>timer</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">标识任一字符串<code>int</code> （间隔）或<code>cron</code>用于计划规则的计时器定义。</p>
<p class="tableblock">例： <code>timer ( cron:* 0/15 * * * ? )</code> （每15分钟一班）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>calendar</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用于计划规则的<a href="http://www.quartz-scheduler.org/">Quartz</a>日历定义。</p>
<p class="tableblock">例： <code>calendars "* * 0-7,18-23 ? * *"</code> （不包括非营业时间）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>auto-focus</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个布尔值，仅适用于议程组中的规则。选择该选项后，下次激活该规则时，焦点将自动分配给分配了该规则的议程组。</p>
<p class="tableblock">例：<code>auto-focus true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>lock-on-active</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个布尔值，仅适用于规则流组或议程组中的规则。选择该选项后，下一次该规则的规则流组变为活动状态或该规则的议程组获得焦点时，该规则流组将不再处于活动状态或该议程组失去焦点之前，无法再次激活该规则。这是更强大的版本<code>no-loop</code>属性，因为匹配的规则的激活将被丢弃，而不考虑更新的来源（不仅是规则本身）。此属性是计算规则的理想选择，在计算规则中，您有许多修改事实的规则，并且您不希望任何规则重新匹配并再次触发。</p>
<p class="tableblock">例：<code>lock-on-active true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>ruleflow-group</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">标识规则流组的字符串。在规则流组中，只有在相关规则流激活了该组时，规则才能触发。</p>
<p class="tableblock">例：<code>ruleflow-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>dialect</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">标识任一字符串<code>JAVA</code>要么<code>MVEL</code>作为规则中代码表达式所使用的语言。默认情况下，该规则使用在程序包级别指定的方言。此处指定的任何方言都会覆盖规则的打包方言设置。</p>
<p class="tableblock">例：<code>dialect "JAVA"</code></p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="drl-timers-calendars-con_drl-rules"><a class="anchor" href="#drl-timers-calendars-con_drl-rules"></a> <a class="link" href="#drl-timers-calendars-con_drl-rules">4.1.7.1。DRL中的计时器和日历规则属性</a></h5>
<div class="paragraph">
<p>计时器和日历是DRL规则属性，使您可以将排定和时间限制应用于DRL规则。这些属性需要根据使用情况进行其他配置。</p>
</div>
<div class="paragraph">
<p>的<code>timer</code> DRL规则中的attribute是一个字符串，用于标识<code>int</code> （间隔）或<code>cron</code>用于调度规则的计时器定义，并支持以下格式：</p>
</div>
<div class="listingblock">
<div class="title">计时器属性格式</div>
<div class="content">
<pre class="highlightjs highlight"><code>timer ( int: &lt;initial delay&gt; &lt;repeat interval&gt; )

timer ( cron: &lt;cron expression&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">时间间隔计时器属性示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Run after a 30-second delay
timer ( int: 30s )

// Run every 5 minutes after a 30-second delay each time
timer ( int: 30s 5m )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">cron计时器属性示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Run every 15 minutes
timer ( cron:* 0/15 * * * ? )</code></pre>
</div>
</div>
<div class="paragraph">
<p>间隔计时器遵循以下语义<code>java.util.Timer</code>对象，具有初始延迟和可选的重复间隔。Cron计时器遵循标准的Unix cron表达式。</p>
</div>
<div class="paragraph">
<p>以下示例DRL规则使用cron计时器每15分钟发送一次SMS文本消息：</p>
</div>
<div class="listingblock">
<div class="title">具有cron计时器的示例DRL规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Send SMS message every 15 minutes"
  timer ( cron:* 0/15 * * * ? )
  when
    $a : Alarm( on == true )
  then
    channels[ "sms" ].insert( new Sms( $a.mobileNumber, "The alarm is still on." );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>通常，根据计时器设置，当触发规则并重复执行规则结果时，由计时器控制的规则将变为活动状态。当规则条件不再匹配传入事实时，执行将停止。但是，Drools引擎使用计时器处理规则的方式取决于Drools引擎是处于<em>主动模式</em>还是<em>被动模式</em> 。</p>
</div>
<div class="paragraph">
<p>默认情况下，当用户或应用程序显式调用时，Drools引擎以<em>被动模式</em>运行并根据定义的计时器设置评估规则<code>fireAllRules()</code> 。相反，如果用户或应用程序调用<code>fireUntilHalt()</code> ，Drools引擎将以<em>活动模式</em>启动并持续评估规则，直到用户或应用程序明确调用<code>halt()</code> 。</p>
</div>
<div class="paragraph">
<p>当Drools引擎处于活动模式时，即使控制从对的调用返回后，规则后果也会执行<code>fireUntilHalt()</code> Drools引擎对工作内存所做的任何更改保持<em>反应</em> 。例如，删除触发计时器规则执行所涉及的事实会导致重复执行终止，并插入一个事实以使某些规则匹配会导致该规则被执行。但是，Drools引擎不会持续<em>激活</em> ，而是仅在执行规则后才激活。因此，在下一次执行计时器控制的规则之前，Drools引擎不会对异步事实插入做出反应。处置KIE会话将终止所有计时器活动。</p>
</div>
<div class="paragraph">
<p>当Drools引擎处于被动模式时，仅在以下情况下评估定时规则的规则结果<code>fireAllRules()</code>再次被调用。但是，您可以通过将KIE会话配置为以下方式来更改被动模式下的默认计时器执行行为： <code>TimedRuleExecutionOption</code>选项，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">KIE会话配置可在被动模式下自动执行定时规则</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
ksconf.setOption( TimedRuleExecutionOption.YES );
KSession ksession = kbase.newKieSession(ksconf, null);</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以设置一个<code>FILTERED</code>规格<code>TimedRuleExecutionOption</code>选项，使您可以定义一个回调来过滤这些规则，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">KIE会话配置可过滤自动执行哪些定时规则</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
conf.setOption( new TimedRuleExecutionOption.FILTERED(new TimedRuleExecutionFilter() {
    public boolean accept(Rule[] rules) {
        return rules[0].getName().equals("MyRule");
    }
}) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于间隔计时器，您还可以将表达式计时器与<code>expr</code>代替<code>int</code>将延迟和间隔都定义为表达式而不是固定值。</p>
</div>
<div class="paragraph">
<p>以下示例DRL文件使用延迟和时间段声明事实类型，然后在随后的规则中使用表达式计时器使用事实和时间段：</p>
</div>
<div class="listingblock">
<div class="title">带有表达式计时器的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Bean
  delay   : String = "30s"
  period  : long = 60000
end

rule "Expression timer"
  timer ( expr: $d, $p )
  when
    Bean( $d : delay, $p : period )
  then
    // Actions
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>表达式，例如<code>$d</code>和<code>$p</code>在此示例中，可以使用规则的模式匹配部分中定义的任何变量。变量可以是任何<code>String</code>可以解析为持续时间的值或在内部进行转换的任何数值<code>long</code>持续时间（毫秒）的值。</p>
</div>
<div class="paragraph">
<p>时间间隔计时器和表达式计时器都可以使用以下可选参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>start</code>和<code>end</code> ： 一种<code>Date</code>或一个<code>String</code>代表一个<code>Date</code>或一个<code>long</code>值。该值也可以是<code>Number</code>转换成Java <code>Date</code>格式<code>new Date( ((Number) n).longValue() )</code> 。</p>
</li>
<li>
<p><code>repeat-limit</code> ：一个整数，它定义计时器允许的最大重复次数。如果两者<code>end</code>和<code>repeat-limit</code>设置了参数，到达两者中的第一个时计时器停止。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">带有可选属性的示例计时器属性<code>start</code> ， <code>end</code>和<code>repeat-limit</code>参数</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">timer (int: 30s 1h; start=3-JAN-2020, end=4-JAN-2020, repeat-limit=50)</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，规则是每小时安排的，每小时延迟30秒，从2020年1月3日开始，到2020年1月4日结束，或者循环重复50次。</p>
</div>
<div class="paragraph">
<p>如果系统被暂停（例如，会话被序列化，然后再反序列化），则该规则仅计划一次从丢失的激活中恢复，无论在暂停期间错过了多少激活，然后对该规则进行了后续调度继续与计时器设置同步。</p>
</div>
<div class="paragraph">
<p>的<code>calendar</code> DRL规则中的attribute属性是用于调度规则的<a href="http://www.quartz-scheduler.org/">Quartz</a>日历定义，并支持以下格式：</p>
</div>
<div class="listingblock">
<div class="title">日历属性格式</div>
<div class="content">
<pre class="highlightjs highlight"><code>calendars "&lt;definition or registered name&gt;"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">日历属性示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Exclude non-business hours
calendars "* * 0-7,18-23 ? * *"

// Weekdays only, as registered in the KIE session
calendars "weekday"</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以根据Quartz日历API修改Quartz日历，然后在KIE会话中注册日历，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">调整石英日历</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Calendar weekDayCal = QuartzHelper.quartzCalendarAdapter(org.quartz.Calendar quartzCal)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">在KIE会话中注册日历</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.getCalendars().set( "weekday", weekDayCal );</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以将日历与标准规则和使用计时器的规则一起使用。calendar属性可以包含一个或多个逗号分隔的日历名称，写为<code>String</code>文字。</p>
</div>
<div class="paragraph">
<p>以下示例规则同时使用日历和计时器来调度规则：</p>
</div>
<div class="listingblock">
<div class="title">带有日历和计时器的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Weekdays are high priority"
  calendars "weekday"
  timer ( int:0 1h )
  when
    Alarm()
  then
    send( "priority high - we have an alarm" );
end

rule "Weekends are low priority"
  calendars "weekend"
  timer ( int:0 4h )
  when
    Alarm()
  then
    send( "priority low - we have an alarm" );
end</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="drl-rules-WHEN-con_drl-rules"><a class="anchor" href="#drl-rules-WHEN-con_drl-rules"></a> <a class="link" href="#drl-rules-WHEN-con_drl-rules">4.1.8。DRL中的规则条件（时间）</a></h4>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/rule.png" alt="规则">
</div>
<div class="title">图54。规则</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/lhs.png" alt="h">
</div>
<div class="title">图55。规则中的条件元素</div>
</div>
<div class="paragraph">
<p>的<code>when</code> DRL规则的一部分（也称为规则的左手边<em>（LHS）</em> ）包含执行操作必须满足的条件。条件包括一系列陈述的<em>模式</em>和<em>约束</em> ，以及基于包中可用数据对象的可选<em>绑定</em>和受支持的规则条件元素（关键字）。例如，如果银行要求贷款申请人的年龄超过21岁，则<code>when</code>条件<code>"Underage"</code>规则是<code>Applicant( age < 21 )</code> 。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">DRL用途<code>when</code>代替<code>if</code>因为<code>if</code>通常是过程执行流程的一部分，在过程中，在特定时间点检查条件。相反， <code>when</code>表示条件评估不限于特定的评估顺序或时间点，而是在任何时间连续进行。只要满足条件，便会执行操作。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>如果<code>when</code>部分为空，则认为条件为真，并且<code>then</code>该部分在第一次执行时<code>fireAllRules()</code>在Drools引擎中进行调用。如果要使用规则来设置Drools引擎状态，这将很有用。</p>
</div>
<div class="paragraph">
<p>以下示例规则在每次执行规则时使用空条件插入事实：</p>
</div>
<div class="listingblock">
<div class="title">没有条件的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Always insert applicant"
  when
    // Empty
  then   // Actions to be executed once
    insert( new Applicant() );
end

// The rule is internally rewritten in the following way:

rule "Always insert applicant"
  when
    eval( true )
  then
    insert( new Applicant() );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果规则条件使用多个模式且没有定义的关键字连词（例如<code>and</code> ， <code>or</code> ， 要么<code>not</code> ），默认合取为<code>and</code> ：</p>
</div>
<div class="listingblock">
<div class="title">没有关键字连接的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Underage"
  when
    application : LoanApplication()
    Applicant( age &lt; 21 )
  then
    // Actions
end

// The rule is internally rewritten in the following way:

rule "Underage"
  when
    application : LoanApplication()
    and Applicant( age &lt; 21 )
  then
    // Actions
end</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_patterns_and_constraints"><a class="anchor" href="#_patterns_and_constraints"></a> <a class="link" href="#_patterns_and_constraints">4.1.8.1。模式和约束</a></h5>
<div class="paragraph">
<p>DRL规则条件中的<em>模式</em>是Drools引擎要匹配的段。模式可以潜在地匹配插入Drools引擎工作内存中的每个事实。模式还可以包含<em>约束，</em>以进一步定义要匹配的事实。</p>
</div>
<div class="paragraph">
<p>下面的铁路图显示了此语法：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Pattern.png" alt="图案">
</div>
<div class="title">图56。图案</div>
</div>
<div class="paragraph">
<p>在没有约束的最简单形式中，模式匹配给定类型的事实。在以下示例中，类型为<code>Person</code> ，因此该模式将与所有<code>Person</code> Drools引擎的工作内存中的对象：</p>
</div>
<div class="listingblock">
<div class="title">单个事实类型的示例模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person()</code></pre>
</div>
</div>
<div class="paragraph">
<p>类型不必是某些事实对象的实际类。模式可以引用超类甚至接口，可能匹配来自许多不同类的事实。例如，以下模式匹配Drools引擎的工作内存中的所有对象：</p>
</div>
<div class="listingblock">
<div class="title">所有对象的示例模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>Object() // Matches all objects in the working memory</code></pre>
</div>
</div>
<div class="paragraph">
<p>模式的括号括起了约束，例如以下对人的年龄的约束：</p>
</div>
<div class="listingblock">
<div class="title">具有约束的示例模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( age == 50 )</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>约束</em>是返回的表达式<code>true</code>要么<code>false</code> 。DRL中的模式约束本质上是Java表达式，具有一些增强功能（例如，属性访问）和一些差异（例如， <code>equals()</code>和<code>!equals()</code>的语义<code>==</code>和<code>!=</code> （而不是通常的<code>same</code>和<code>not same</code>语义）。</p>
</div>
<div class="paragraph">
<p>可以直接从模式约束中访问任何JavaBeans属性。使用标准JavaBeans getter在内部公开Bean属性，该方法不带任何参数并返回某些内容。例如， <code>age</code>属性写为<code>age</code>在DRL中而不是在getter中<code>getAge()</code> ：</p>
</div>
<div class="listingblock">
<div class="title">具有JavaBeans属性的DRL约束语法</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( age == 50 )

// This is the same as the following getter format:

Person( getAge() == 50 )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Drools使用标准的JDK <code>Introspector</code>类来实现此映射，因此它遵循标准JavaBeans规范。为了获得最佳的Drools引擎性能，请使用属性访问格式，例如<code>age</code> ，而不是显式使用getter，例如<code>getAge()</code> 。</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p>不要使用属性访问器以可能影响规则的方式更改对象的状态，因为Drools引擎会缓存两次调用之间的匹配结果，以提高效率。</p>
</div>
<div class="paragraph">
<p>例如，请勿通过以下方式使用属性访问器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public int getAge() {
    age++; // Do not do this.
    return age;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public int getAge() {
    Date now = DateUtil.now(); // Do not do this.
    return DateUtil.differenceInYears(now, birthday);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>而不是按照第二个示例，而是插入一个将当前日期包装在工作内存中的事实，并在<code>fireAllRules()</code>如所须。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>但是，如果找不到属性的getter，则编译器会将属性名称用作不带参数的后备方法名称：</p>
</div>
<div class="listingblock">
<div class="title">如果找不到对象，则使用备用方法</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( age == 50 )

// If `Person.getAge()` does not exist, the compiler uses the following syntax:

Person( age() == 50 )</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以将访问属性嵌套在模式中，如以下示例所示。嵌套属性由Drools引擎索引。</p>
</div>
<div class="listingblock">
<div class="title">具有嵌套属性访问的示例模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( address.houseNumber == 50 )

// This is the same as the following format:

Person( getAddress().getHouseNumber() == 50 )</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">在有状态的KIE会话中，请谨慎使用嵌套访问器，因为Drools引擎的工作内存不知道任何嵌套值，并且不会检测到它们何时更改。可以将嵌套值的任何父引用插入到工作内存中时将其视为不变，或者，如果要修改嵌套值，请将所有外部事实标记为已更新。在上一个示例中，当<code>houseNumber</code>财产变化，任何<code>Person</code>接着就，随即<code>Address</code>必须标记为已更新。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>您可以使用任何返回以下内容的Java表达式： <code>boolean</code>值作为模式括号内的约束。Java表达式可以与其他表达式增强功能（例如属性访问）混合使用：</p>
</div>
<div class="listingblock">
<div class="title">使用属性访问和Java表达式约束的示例模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( age == 50 )</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以使用括号来更改评估优先级，就像在任何逻辑或数学表达式中一样：</p>
</div>
<div class="listingblock">
<div class="title">约束的示例评估顺序</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( age &gt; 100 &amp;&amp; ( age % 10 == 0 ) )</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以在约束中重用Java方法，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">重用Java方法的示例约束</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( Math.round( weight / ( height * height ) ) &lt; 25.0 )</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p>不要使用约束以可能影响规则的方式更改对象的状态，因为Drools引擎会缓存两次调用之间的匹配结果，以提高效率。在规则条件中对事实执行的任何方法都必须是只读方法。同样，事实的状态不应在规则调用之间更改，除非这些事实在每次更改时都在工作内存中标记为已更新。</p>
</div>
<div class="paragraph">
<p>例如，请勿通过以下方式使用模式约束：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Person( incrementAndGetAge() == 10 ) // Do not do this.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Person( System.currentTimeMillis() % 1000 == 0 ) // Do not do this.</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>标准Java运算符优先级适用于DRL中的约束运算符，并且DRL运算符遵循标准Java语义，但<code>==</code>和<code>!=</code>操作员。</p>
</div>
<div class="paragraph">
<p>的<code>==</code>运算符使用null安全<code>equals()</code>语义而不是通常的<code>same</code>语义。例如图案<code>Person( firstName == "John" )</code>类似于<code>java.util.Objects.equals(person.getFirstName(), "John")</code> ，因为<code>"John"</code>不为null，该模式也类似于<code>"John".equals(person.getFirstName())</code> 。</p>
</div>
<div class="paragraph">
<p>的<code>!=</code>运算符使用null安全<code>!equals()</code>语义而不是通常的<code>not same</code>语义。例如图案<code>Person( firstName != "John" )</code>类似于<code>!java.util.Objects.equals(person.getFirstName(), "John")</code> 。</p>
</div>
<div class="paragraph">
<p>如果字段和约束的值属于不同类型，则Drools引擎将使用类型强制转换解决冲突并减少编译错误。例如，如果<code>"ten"</code>在数字求值器中以字符串形式提供时，会发生编译错误，而<code>"10"</code>强制为数字10。在强制转换中，字段类型始终优先于值类型：</p>
</div>
<div class="listingblock">
<div class="title">具有强制值的示例约束</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( age == "10" ) // "10" is coerced to 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于约束组，可以使用定界逗号<code>,</code>使用隐式<code>and</code>连接语义：</p>
</div>
<div class="listingblock">
<div class="title">具有多个约束的示例模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Person is at least 50 years old and weighs at least 80 kilograms:
Person( age &gt; 50, weight &gt; 80 )

// Person is at least 50 years old, weighs at least 80 kilograms, and is taller than 2 meters:
Person( age &gt; 50, weight &gt; 80, height &gt; 2 )</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">虽然<code>&&</code>和<code>,</code>运算符具有相同的语义，它们的优先级不同。的<code>&&</code>运算符先于<code>||</code>运算符，以及<code>&&</code>和<code>||</code>运算符先于<code>,</code>操作员。在顶级约束条件下使用逗号运算符可实现最佳Drools引擎性能和可读性。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>您不能将逗号运算符嵌入到复合约束表达式中，例如括号中：</p>
</div>
<div class="listingblock">
<div class="title">复合约束表达式中误用逗号的示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Do not use the following format:
Person( ( age &gt; 50, weight &gt; 80 ) || height &gt; 2 )

// Use the following format instead:
Person( ( age &gt; 50 &amp;&amp; weight &gt; 80 ) || height &gt; 2 )</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bound_variables_in_patterns_and_constraints"><a class="anchor" href="#_bound_variables_in_patterns_and_constraints"></a> <a class="link" href="#_bound_variables_in_patterns_and_constraints">4.1.8.2。模式和约束中的绑定变量</a></h5>
<div class="paragraph">
<p>您可以将变量绑定到模式和约束，以引用规则其他部分中的匹配对象。绑定变量可以帮助您更有效或更一致地定义规则，以及如何注释数据模型中的事实。要更轻松地区分规则中的变量和字段，请使用标准格式<code>$variable</code>变量，尤其是在复杂规则中。此约定很有用，但在DRL中不是必需的。</p>
</div>
<div class="paragraph">
<p>例如，以下DRL规则使用变量<code>$p</code>为带有<code>Person</code>事实：</p>
</div>
<div class="listingblock">
<div class="title">具有绑定变量的模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "simple rule"
  when
    $p : Person()
  then
    System.out.println( "Person " + $p );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>同样，您也可以将变量绑定到模式约束中的属性，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// Two persons of the same age:
Person( $firstAge : age ) // Binding
Person( age == $firstAge ) // Constraint expression</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>确保将约束绑定和约束表达式分开以更清晰，更有效的规则定义。尽管支持混合的绑定和表达式，但是它们会使模式复杂化并影响评估效率。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// Do not use the following format:
Person( $age : age * 2 &lt; 100 )

// Use the following format instead:
Person( age * 2 &lt; 100, $age : age )</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Drools引擎不支持对同一声明的绑定，但是支持跨多个属性<em>统一</em>参数。虽然位置参数始终以统一方式处理，但统一符号<code>:=</code>存在命名参数。</p>
</div>
<div class="paragraph">
<p>以下示例模式统一了<code>age</code>跨两个属性<code>Person</code>事实：</p>
</div>
<div class="listingblock">
<div class="title">统一示例模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( $age := age )
Person( $age := age )</code></pre>
</div>
</div>
<div class="paragraph">
<p>统一声明第一次出现的绑定，并约束序列出现的绑定字段的相同值。</p>
</div>
</div>
<div class="sect4">
<h5 id="_nested_constraints_and_inline_casts"><a class="anchor" href="#_nested_constraints_and_inline_casts"></a> <a class="link" href="#_nested_constraints_and_inline_casts">4.1.8.3。嵌套约束和内联强制转换</a></h5>
<div class="paragraph">
<p>在某些情况下，您可能需要访问嵌套对象的多个属性，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">访问多个属性的示例模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( name == "mark", address.city == "london", address.country == "uk" )</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以使用以下语法将这些属性访问器分组为嵌套对象<code>.( <constraints> )</code>有关更易读的规则，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">具有分组约束的示例模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( name == "mark", address.( city == "london", country == "uk") )</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">句点前缀<code>.</code>区分嵌套对象约束和方法调用。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>在模式中使用嵌套对象时，可以使用以下语法<code><type>#<subtype></code>强制转换为子类型，并使父类型的吸气剂可用于该子类型。您可以使用对象名称或完全限定的类名称，并且可以强制转换为一个或多个子类型，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">内联强制转换为子类型的示例模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Inline casting with subtype name:
Person( name == "mark", address#LongAddress.country == "uk" )

// Inline casting with fully qualified class name:
Person( name == "mark", address#org.domain.LongAddress.country == "uk" )

// Multiple inline casts:
Person( name == "mark", address#LongAddress.country#DetailedCountry.population &gt; 10000000 )</code></pre>
</div>
</div>
<div class="paragraph">
<p>这些示例模式<code>Address</code>至<code>LongAddress</code> ，以及<code>DetailedCountry</code>在最后一个示例中，在每种情况下都使父吸气剂可用于子类型。</p>
</div>
<div class="paragraph">
<p>您可以使用<code>instanceof</code>运算符，以在模式中对该字段的后续使用中推断指定类型的结果，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Person( name == "mark", address instanceof LongAddress, address.country == "uk" )</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果无法进行内联强制转换（例如，如果<code>instanceof</code>退货<code>false</code> ），评估被视为<code>false</code> 。</p>
</div>
</div>
<div class="sect4">
<h5 id="_date_literal_in_constraints"><a class="anchor" href="#_date_literal_in_constraints"></a> <a class="link" href="#_date_literal_in_constraints">4.1.8.4。约束中的日期文字</a></h5>
<div class="paragraph">
<p>默认情况下，Drools引擎支持日期格式<code>dd-mmm-yyyy</code> 。您可以通过提供带有系统属性的备用格式掩码来自定义日期格式，如果需要，还可以包括时间格式掩码。 <code>drools.dateformat="dd-mmm-yyyy hh:mm"</code> 。您还可以通过更改语言环境来自定义日期格式<code>drools.defaultlanguage</code>和<code>drools.defaultcountry</code>系统属性（例如，泰国的语言环境设置为<code>drools.defaultlanguage=th</code>和<code>drools.defaultcountry=TH</code> ）。</p>
</div>
<div class="listingblock">
<div class="title">具有日期文字限制的示例模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( bornBefore &lt; "27-Oct-2009" )</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_auto_boxing_and_primitive_types"><a class="anchor" href="#_auto_boxing_and_primitive_types"></a> <a class="link" href="#_auto_boxing_and_primitive_types">4.1.8.5。自动装箱和原始类型</a></h5>
<div class="paragraph">
<p>Drools尝试将数字保留为原始或对象包装形式，因此绑定到int原语的变量在代码块或表达式中使用时，将不再需要手动拆箱。与早期的Drools版本不同，在所有版本中，所有原语都需要自动装箱，因此需要手动拆箱。绑定到对象包装器的变量将保留为对象。在这种情况下，将使用现有的处理自动装箱和拆箱的JDK 1.5和JDK 5规则。在评估字段约束时，系统尝试将其中一个值强制转换为可比较的格式。因此基元可与对象包装器相提并论。</p>
</div>
</div>
<div class="sect4">
<h5 id="drl-operators-ref_drl-rules"><a class="anchor" href="#drl-operators-ref_drl-rules"></a> <a class="link" href="#drl-operators-ref_drl-rules">4.1.8.6。DRL模式约束中受支持的运算符</a></h5>
<div class="paragraph">
<p>DRL支持模式约束中的运算符的标准Java语义，但有一些例外以及DRL中唯一的其他一些运算符。下表总结了在DRL约束中与标准Java语义不同的处理方式或在DRL约束中唯一的运算符。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>.()</code> ，<code>#</code></dt>
<dd>
<p>使用<code>.()</code>运算符可将属性访问器分组为嵌套对象，并使用<code>#</code>运算符，将其转换为嵌套对象中的子类型。强制转换为子类型可使来自父类型的吸气剂可用于该子类型。您可以使用对象名称或完全限定的类名称，并且可以强制转换为一个或多个子类型。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">带有嵌套对象的示例模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Ungrouped property accessors:
Person( name == "mark", address.city == "london", address.country == "uk" )

// Grouped property accessors:
Person( name == "mark", address.( city == "london", country == "uk") )</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">句点前缀<code>.</code>区分嵌套对象约束和方法调用。
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">内联强制转换为子类型的示例模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Inline casting with subtype name:
Person( name == "mark", address#LongAddress.country == "uk" )

// Inline casting with fully qualified class name:
Person( name == "mark", address#org.domain.LongAddress.country == "uk" )

// Multiple inline casts:
Person( name == "mark", address#LongAddress.country#DetailedCountry.population &gt; 10000000 )</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>!.</code></dt>
<dd>
<p>使用此运算符可以以空安全的方式取消引用属性。左侧的值<code>!.</code>运算符不能为空（解释为<code>!= null</code> ），以便为模式匹配提供肯定的结果。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">具有空安全解引用的约束示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( $streetName : address!.street )

// This is internally rewritten in the following way:

Person( address != null, $streetName : address.street )</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>[]</code></dt>
<dd>
<p>使用此运算符访问<code>List</code>按索引值或<code>Map</code>按键值。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">约束示例<code>List</code>和<code>Map</code>访问</div>
<div class="content">
<pre class="highlightjs highlight"><code>// The following format is the same as `childList(0).getAge() == 18`:
Person(childList[0].age == 18)

// The following format is the same as `credentialMap.get("jdoe").isValid()`:
Person(credentialMap["jdoe"].valid)</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code><</code> ， <code><=</code> ， <code>></code> ，<code>>=</code></dt>
<dd>
<p>在具有自然顺序的属性上使用这些运算符。例如，对于<code>Date</code>领域<code><</code>运算符表示<em>在</em>和之前<code>String</code>字段，运算符<em>按字母顺序在之前</em> 。这些属性仅适用于可比较的属性。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">约束示例<code>before</code>算子</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( birthDate &lt; $otherBirthDate )

Person( firstName &lt; $otherFirstName )</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>==</code> ，<code>!=</code></dt>
<dd>
<p>使用这些运算符作为<code>equals()</code>和<code>!equals()</code>约束中的方法，而不是通常的方法<code>same</code>和<code>not same</code>语义。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">具有null安全相等性的示例约束</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( firstName == "John" )

// This is similar to the following formats:

java.util.Objects.equals(person.getFirstName(), "John")
"John".equals(person.getFirstName())</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">空安全不相等的示例约束</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( firstName != "John" )

// This is similar to the following format:

!java.util.Objects.equals(person.getFirstName(), "John")</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>&&</code> ，<code>||</code></dt>
<dd>
<p>使用这些运算符可以创建一个简化的组合关系条件，该条件对一个字段增加了多个限制。您可以用括号将约束分组<code>()</code>创建一个递归语法模式。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">具有简化组合关系的示例约束</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Simple abbreviated combined relation condition using a single `&amp;&amp;`:
Person(age &gt; 30 &amp;&amp; &lt; 40)

// Complex abbreviated combined relation using groupings:
Person(age ((&gt; 30 &amp;&amp; &lt; 40) || (&gt; 20 &amp;&amp; &lt; 25)))

// Mixing abbreviated combined relation with constraint connectives:
Person(age &gt; 30 &amp;&amp; &lt; 40 || location == "london")</code></pre>
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/abbreviatedCombinedRelationCondition.png" alt="缩写CombinedRelationCondition">
</div>
<div class="title">图57。缩写组合关系条件</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/abbreviatedCombinedRelationConditionGroup.png" alt="缩写CombinedRelationConditionGroup">
</div>
<div class="title">图58。带括号的简化组合关系条件</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>matches</code> ，<code>not matches</code></dt>
<dd>
<p>使用这些运算符可以指示字段与指定的Java正则表达式匹配或不匹配。通常，正则表达式是<code>String</code>文字，但也支持解析为有效正则表达式的变量。这些运算符仅适用于<code>String</code>属性。如果您使用<code>matches</code>针对<code>null</code>值，结果评估总是<code>false</code> 。如果您使用<code>not matches</code>针对<code>null</code>值，结果评估总是<code>true</code> 。与Java中一样，您写为的正则表达式<code>String</code>文字必须使用双反斜杠<code>\\</code>逃离。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">匹配或不匹配正则表达式的示例约束</div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( country matches "(USA)?\\S*UK" )

Person( country not matches "(USA)?\\S*UK" )</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>contains</code> ，<code>not contains</code></dt>
<dd>
<p>使用这些运算符可以验证字段是否为<code>Array</code>或一个<code>Collection</code>包含或不包含指定值。这些运算符适用于<code>Array</code>要么<code>Collection</code>属性，但您也可以使用这些运算符代替<code>String.contains()</code>和<code>!String.contains()</code>约束检查。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">约束示例<code>contains</code>和<code>not contains</code>收集</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Collection with a specified field:
FamilyTree( countries contains "UK" )

FamilyTree( countries not contains "UK" )


// Collection with a variable:
FamilyTree( countries contains $var )

FamilyTree( countries not contains $var )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">约束示例<code>contains</code>和<code>not contains</code>对于字符串文字</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Sting literal with a specified field:
Person( fullName contains "Jr" )

Person( fullName not contains "Jr" )


// String literal with a variable:
Person( fullName contains $var )

Person( fullName not contains $var )</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">为了向后兼容， <code>excludes</code>运算符是受支持的同义词<code>not contains</code> 。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>memberOf</code> ，<code>not memberOf</code></dt>
<dd>
<p>使用这些运算符可以验证字段是不是成员还是成员<code>Array</code>或一个<code>Collection</code>被定义为变量。的<code>Array</code>要么<code>Collection</code>必须是一个变量。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">约束示例<code>memberOf</code>和<code>not memberOf</code>与收藏</div>
<div class="content">
<pre class="highlightjs highlight"><code>FamilyTree( person memberOf $europeanDescendants )

FamilyTree( person not memberOf $europeanDescendants )</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>soundslike</code></dt>
<dd>
<p>使用此运算符可验证单词是否使用英语发音作为给定值具有几乎相同的声音（类似于<code>matches</code>运算符）。该运算符使用Soundex算法。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">约束示例<code>soundslike</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>// Match firstName "Jon" or "John":
Person( firstName soundslike "John" )</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>str</code></dt>
<dd>
<p>使用此运算符可验证字段是否为<code>String</code>以指定值开头或结尾。您也可以使用此运算符来验证<code>String</code> 。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">约束示例<code>str</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>// Verify what the String starts with:
Message( routingValue str[startsWith] "R1" )

// Verify what the String ends with:
Message( routingValue str[endsWith] "R2" )

// Verify the length of the String:
Message( routingValue str[length] 17 )</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>in</code> ，<code>notin</code></dt>
<dd>
<p>使用这些运算符可以指定一个以上的可能值来匹配约束（复合值限制）。复合值限制的此功能仅在<code>in</code>和<code>not in</code>操作员。这些运算符的第二个操作数必须是用括号括起来的值的逗号分隔列表。您可以将值提供为变量，文字，返回值或合格的标识符。使用这些运算符在内部将这些运算符重写为多个限制的列表<code>==</code>要么<code>!=</code> 。</p>
<div class="openblock">
<div class="content">
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/compoundValueRestriction.png" alt="复合值限制">
</div>
<div class="title">图59. compoundValueRestriction</div>
</div>
<div class="listingblock">
<div class="title">约束示例<code>in</code>和<code>notin</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>Person( $color : favoriteColor )
Color( type in ( "red", "blue", $color ) )

Person( $color : favoriteColor )
Color( type notin ( "red", "blue", $color ) )</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="drl-operator-precedence-ref_drl-rules"><a class="anchor" href="#drl-operator-precedence-ref_drl-rules"></a> <a class="link" href="#drl-operator-precedence-ref_drl-rules">4.1.8.7。DRL模式约束中的运算符优先级</a></h5>
<div class="paragraph">
<p>DRL支持适用的约束运算符的标准Java运算符优先级，但有一些例外情况以及DRL中唯一的一些附加运算符。下表从最高到最低优先级列出了DRL运算符优先级（如果适用）：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表12。DRL模式约束中的运算符优先级</caption>
<colgroup>
<col style="width:28.5714%">
<col style="width:28.5714%">
<col style="width:42.8572%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">操作员类型</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">经营者</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">笔记</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">嵌套或null安全的属性访问</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>.()</code> ，<code>!.</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">不是标准的Java语义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>List</code>要么<code>Map</code>访问</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>[]</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">不是标准的Java语义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">约束绑定</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>:</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">不是标准的Java语义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">乘性</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>*</code> ，<code>/%</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">添加剂</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>+</code> ，<code>-</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">转移</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>>></code> ， <code>>>></code> ，<code><<</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">关系型</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code><</code> ， <code><=</code> ， <code>></code> ， <code>>=</code> ，<code>instanceof</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">平等</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>== !=</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用途<code>equals()</code>和<code>!equals()</code>语义，不是标准的Java <code>same</code>和<code>not same</code>语义学</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">非短路<code>AND</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>&</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">非短路排他<code>OR</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>^</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">非短路包容性<code>OR</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>|</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">逻辑上<code>AND</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>&&</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">逻辑上<code>OR</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>||</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">三元</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>? :</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">逗号分隔<code>AND</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>,</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">不是标准的Java语义</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="drl-rules-WHEN-elements-ref_drl-rules"><a class="anchor" href="#drl-rules-WHEN-elements-ref_drl-rules"></a> <a class="link" href="#drl-rules-WHEN-elements-ref_drl-rules">4.1.8.8。DRL（关键字）中支持的规则条件元素</a></h5>
<div class="paragraph">
<p>DRL支持以下规则条件元素（关键字），您可以将其与在DRL规则条件中定义的模式一起使用：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>and</code></dt>
<dd>
<p>使用它可以将条件组件分组为逻辑合取。前缀和前缀<code>and</code>支持。您可以使用括号将模式显式分组<code>()</code> 。默认情况下，所有列出的模式都与<code>and</code>未指定任何连词时。</p>
<div class="openblock">
<div class="content">
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/infixAnd.png" alt="infixAnd">
</div>
<div class="title">图60. infixAnd</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/prefixAnd.png" alt="prefixAnd">
</div>
<div class="title">图61. prefixAnd</div>
</div>
<div class="listingblock">
<div class="title">示例模式<code>and</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>//Infix `and`:
Color( colorType : type ) and Person( favoriteColor == colorType )

//Infix `and` with grouping:
(Color( colorType : type ) and (Person( favoriteColor == colorType ) or Person( favoriteColor == colorType ))

// Prefix `and`:
(and Color( colorType : type ) Person( favoriteColor == colorType ))

// Default implicit `and`:
Color( colorType : type )
Person( favoriteColor == colorType )</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>请勿将前导声明绑定与<code>and</code>关键字（您可以使用<code>or</code> ， 例如）。声明一次只能引用一个事实，并且如果您将声明绑定与<code>and</code>然后<code>and</code>如果满足，它会同时符合事实并导致错误。</p>
</div>
<div class="listingblock">
<div class="title">滥用示例<code>and</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>// Causes compile error:
$person : (Person( name == "Romeo" ) and Person( name == "Juliet"))</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>or</code></dt>
<dd>
<p>使用此选项可将条件组件分为逻辑分离。前缀和前缀<code>or</code>支持。您可以使用括号将模式显式分组<code>()</code> 。您还可以将模式绑定与<code>or</code> ，但每个模式必须分别绑定。</p>
<div class="openblock">
<div class="content">
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/infixOr.png" alt="infixOr">
</div>
<div class="title">图62. infixOr</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/prefixOr.png" alt="prefixOr">
</div>
<div class="title">图63. prefixOr</div>
</div>
<div class="listingblock">
<div class="title">示例模式<code>or</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>//Infix `or`:
Color( colorType : type ) or Person( favoriteColor == colorType )

//Infix `or` with grouping:
(Color( colorType : type ) or (Person( favoriteColor == colorType ) and Person( favoriteColor == colorType ))

// Prefix `or`:
(or Color( colorType : type ) Person( favoriteColor == colorType ))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例模式<code>or</code>和图案绑定</div>
<div class="content">
<pre class="highlightjs highlight"><code>pensioner : (Person( sex == "f", age &gt; 60 ) or Person( sex == "m", age &gt; 65 ))

(or pensioner : Person( sex == "f", age &gt; 60 )
    pensioner : Person( sex == "m", age &gt; 65 ))</code></pre>
</div>
</div>
<div class="paragraph">
<p>的行为<code>or</code>条件元素与连接词不同<code>||</code>运算符，用于约束和字段约束中的约束。Drools引擎不会直接解释<code>or</code>元素，但使用逻辑转换来重写规则<code>or</code>作为一些子规则。此过程最终导致一条规则具有单个<code>or</code>作为根节点，并为其每个条件元素分配一个子规则。每个子规则都像任何普通规则一样被激活和执行，子规则之间没有特殊的行为或交互。</p>
</div>
<div class="paragraph">
<p>因此，请考虑<code>or</code> condition元素用于生成两个或多个相似规则的快捷方式，当两个或多个析取项为true时，该规则又可以创建多个激活。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>exists</code></dt>
<dd>
<p>使用它来指定必须存在的事实和约束。仅在第一个匹配项上触发此选项，而不在随后的匹配项上触发。如果您将此元素与多个模式一起使用，请用括号将模式括起来<code>()</code> 。</p>
<div class="openblock">
<div class="content">
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/exists.png" alt="存在">
</div>
<div class="title">图64。存在</div>
</div>
<div class="listingblock">
<div class="title">示例模式<code>exists</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>exists Person( firstName == "John")

exists (Person( firstName == "John", age == 42 ))

exists (Person( firstName == "John" ) and
        Person( lastName == "Doe" ))</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>not</code></dt>
<dd>
<p>使用此选项可以指定不存在的事实和约束。如果您将此元素与多个模式一起使用，请用括号将模式括起来<code>()</code> 。</p>
<div class="openblock">
<div class="content">
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/not.png" alt="不">
</div>
<div class="title">图65。不</div>
</div>
<div class="listingblock">
<div class="title">示例模式<code>not</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>not Person( firstName == "John")

not (Person( firstName == "John", age == 42 ))

not (Person( firstName == "John" ) and
     Person( lastName == "Doe" ))</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>forall</code></dt>
<dd>
<p>使用它来验证是否所有与第一个模式匹配的事实都与所有其余模式匹配。当一个<code>forall</code>构造满意，规则评估为<code>true</code> 。该元素是作用域定界符，因此它可以使用任何以前绑定的变量，但是在其内部没有绑定的变量可在其外部使用。</p>
<div class="openblock">
<div class="content">
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/forall.png" alt="对所有人">
</div>
<div class="title">图66。对所有人</div>
</div>
<div class="listingblock">
<div class="title">规则示例<code>forall</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "All full-time employees have red ID badges"
  when
    forall( $emp : Employee( type == "fulltime" )
                   Employee( this == $emp, badgeColor = "red" ) )
  then
    // True, all full-time employees have red ID badges.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，规则选择了所有<code>Employee</code>类型为的对象<code>"fulltime"</code> 。对于与该模式匹配的每个事实，规则将评估随后的模式（徽章颜色），如果匹配，则规则将评估为<code>true</code> 。</p>
</div>
<div class="paragraph">
<p>要声明Drools引擎的工作内存中给定类型的所有事实都必须匹配一组约束，可以使用<code>forall</code>为了简单起见，使用单一模式。</p>
</div>
<div class="listingblock">
<div class="title">规则示例<code>forall</code>和一个模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "All full-time employees have red ID badges"
  when
    forall( Employee( badgeColor = "red" ) )
  then
    // True, all full-time employees have red ID badges.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以使用<code>forall</code>具有多个模式的结构或将它们与其他条件元素嵌套在一起，例如<code>not</code>元素构造。</p>
</div>
<div class="listingblock">
<div class="title">规则示例<code>forall</code>和多种模式</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "All employees have health and dental care programs"
  when
    forall( $emp : Employee()
            HealthCare( employee == $emp )
            DentalCare( employee == $emp )
          )
  then
    // True, all employees have health and dental care.
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">规则示例<code>forall</code>和<code>not</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Not all employees have health and dental care"
  when
    not ( forall( $emp : Employee()
                  HealthCare( employee == $emp )
                  DentalCare( employee == $emp ) )
        )
  then
    // True, not all employees have health and dental care.
end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">格式<code>forall( p1 p2 p3 …​)</code>相当于<code>not( p1 and not( and p2 p3 …​ ) )</code> 。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>from</code></dt>
<dd>
<p>使用它为模式指定数据源。这使Drools引擎可以对不在工作内存中的数据进行推理。数据源可以是绑定变量上的子字段，也可以是方法调用的结果。用于定义对象源的表达式是遵循常规MVEL语法的任何表达式。因此， <code>from</code>元素使您可以轻松使用对象属性导航，执行方法调用以及访问映射和集合元素。</p>
<div class="openblock">
<div class="content">
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/from.png" alt="从">
</div>
<div class="title">图67。</div>
</div>
<div class="listingblock">
<div class="title">规则示例<code>from</code>和图案绑定</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Validate zipcode"
  when
    Person( $personAddress : address )
    Address( zipcode == "23920W" ) from $personAddress
  then
    // Zip code is okay.
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">规则示例<code>from</code>和图形符号</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Validate zipcode"
  when
    $p : Person()
    $a : Address( zipcode == "23920W" ) from $p.address
  then
    // Zip code is okay.
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">规则示例<code>from</code>遍历所有对象</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Apply 10% discount to all items over US$ 100 in an order"
  when
    $order : Order()
    $item  : OrderItem( value &gt; 100 ) from $order.items
  then
    // Apply discount to `$item`.
end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>对于大型对象集合，与其添加带有Drools引擎必须频繁迭代的大型图形的对象，不如将其直接添加到KIE会话中，然后将其加入条件中，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>when
  $order : Order()
  OrderItem( value &gt; 100, order == $order )</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">规则示例<code>from</code>和<code>lock-on-active</code>规则属性</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Assign people in North Carolina (NC) to sales region 1"
  ruleflow-group "test"
  lock-on-active true
  when
    $p : Person()
    $a : Address( state == "NC" ) from $p.address
  then
    modify ($p) {} // Assign the person to sales region 1.
end

rule "Apply a discount to people in the city of Raleigh"
  ruleflow-group "test"
  lock-on-active true
  when
    $p : Person()
    $a : Address( city == "Raleigh" ) from $p.address
  then
    modify ($p) {} // Apply discount to the person.
end</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">
<div class="paragraph">
<p>使用<code>from</code>与<code>lock-on-active</code> rule属性可能导致规则无法执行。您可以通过以下方式之一解决此问题：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>避免使用<code>from</code>元素，当您可以将所有事实插入Drools引擎的工作存储器中或在约束表达式中使用嵌套对象引用时。</p>
</li>
<li>
<p>将使用的变量放在<code>modify()</code>作为规则条件中的最后一句话进行屏蔽。</p>
</li>
<li>
<p>避免使用<code>lock-on-active</code>您可以显式管理同一规则流组中的规则如何相互激活的规则属性。</p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>包含<code>from</code>子句不能跟以括号开头的其他模式。出现此限制的原因是DRL解析器读取了<code>from</code>表达为<code>"from $l (String() or Number())"</code>并且它无法将此表达式与函数调用区分开。最简单的解决方法是包装<code>from</code>括号中的子句，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">的示例规则<code>from</code>错误和正确使用</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Do not use `from` in this way:
rule R
  when
    $l : List()
    String() from $l
    (String() or Number())
  then
    // Actions
end

// Use `from` in this way instead:
rule R
  when
    $l : List()
    (String() from $l)
    (String() or Number())
  then
    // Actions
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>entry-point</code></dt>
<dd>
<p>使用它来定义与模式的数据源相对应的入口点或<em>事件流</em> 。此元素通常与<code>from</code>条件元素。您可以声明事件的入口点，以便Drools引擎仅使用该入口点的数据来评估规则。您可以通过在DRL规则中隐式地声明入口点，也可以在Java应用程序中显式地声明入口点。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">规则示例<code>from entry-point</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Authorize withdrawal"
  when
    WithdrawRequest( $ai : accountId, $am : amount ) from entry-point "ATM Stream"
    CheckingAccount( accountId == $ai, balance &gt; $am )
  then
    // Authorize withdrawal.
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">具有EntryPoint对象和插入事实的示例Java应用程序代码</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.runtime.KieSession;
import org.kie.api.runtime.rule.EntryPoint;

// Create your KIE base and KIE session as usual:
KieSession session = ...

// Create a reference to the entry point:
EntryPoint atmStream = session.getEntryPoint("ATM Stream");

// Start inserting your facts into the entry point:
atmStream.insert(aWithdrawRequest);</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>collect</code></dt>
<dd>
<p>使用它来定义规则可以用作条件一部分的对象的集合。该规则从指定来源或从Drools引擎的工作内存中获取集合。的结果模式<code>collect</code>元素可以是实现<code>java.util.Collection</code>接口并提供默认的无参数公共构造函数。您可以使用Java集合，例如<code>List</code> ， <code>LinkedList</code>和<code>HashSet</code> ，或您自己的课程。如果变量在<code>collect</code>元素中，您可以使用变量来约束源模式和结果模式。但是，在<code>collect</code>元素不可在其外部使用。</p>
<div class="openblock">
<div class="content">
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/collect.png" alt="搜集">
</div>
<div class="title">图68。搜集</div>
</div>
<div class="listingblock">
<div class="title">规则示例<code>collect</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>import java.util.List

rule "Raise priority when system has more than three pending alarms"
  when
    $system : System()
    $alarms : List( size &gt;= 3 )
              from collect( Alarm( system == $system, status == 'pending' ) )
  then
    // Raise priority because `$system` has three or more `$alarms` pending.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，规则针对每个给定系统评估Drools引擎的工作内存中的所有待处理警报，并将它们分组为<code>List</code> 。如果为给定系统找到三个或更多警报，则执行规则。</p>
</div>
<div class="paragraph">
<p>您也可以使用<code>collect</code>嵌套元素<code>from</code>元素，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">规则示例<code>collect</code>并嵌套<code>from</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>import java.util.LinkedList;

rule "Send a message to all parents"
  when
    $town : Town( name == 'Paris' )
    $mothers : LinkedList()
               from collect( Person( children &gt; 0 )
                             from $town.getPeople()
                           )
  then
    // Send a message to all parents.
end</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>accumulate</code></dt>
<dd>
<p>使用它可以遍历对象集合，对每个元素执行自定义操作，并返回一个或多个结果对象（如果约束评估为<code>true</code> ）。此元素是更灵活，更强大的形式<code>collect</code>条件元素。您可以在自己的计算机中使用预定义的功能<code>accumulate</code>条件或根据需要实现自定义功能。您也可以使用缩写<code>acc</code>对于<code>accumulate</code>在规则条件下。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>使用以下格式定义<code>accumulate</code>规则中的条件：</p>
</div>
<div class="listingblock">
<div class="title">的首选格式<code>accumulate</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>accumulate( &lt;source pattern&gt;; &lt;functions&gt; [;&lt;constraints&gt;] )</code></pre>
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/accumulate.png" alt="积累">
</div>
<div class="title">图69。积累</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">尽管Drools引擎支持替代格式<code>accumulate</code>元素是向后兼容的格式，这种格式是规则和应用程序中最佳性能的首选。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Drools引擎支持以下预定义<code>accumulate</code>功能。这些函数接受任何表达式作为输入。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>average</code></p>
</li>
<li>
<p><code>min</code></p>
</li>
<li>
<p><code>max</code></p>
</li>
<li>
<p><code>count</code></p>
</li>
<li>
<p><code>sum</code></p>
</li>
<li>
<p><code>collectList</code></p>
</li>
<li>
<p><code>collectSet</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在以下示例规则中， <code>min</code> ， <code>max</code>和<code>average</code>是<code>accumulate</code>用于计算每个传感器的所有读数的最小，最大和平均温度值的函数：</p>
</div>
<div class="listingblock">
<div class="title">规则示例<code>accumulate</code>计算温度值</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Raise alarm"
  when
    $s : Sensor()
    accumulate( Reading( sensor == $s, $temp : temperature );
                $min : min( $temp ),
                $max : max( $temp ),
                $avg : average( $temp );
                $min &lt; 20, $avg &gt; 70 )
  then
    // Raise the alarm.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>以下示例规则使用<code>average</code>具有功能<code>accumulate</code>计算订单中所有物品的平均利润：</p>
</div>
<div class="listingblock">
<div class="title">规则示例<code>accumulate</code>计算平均利润</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Average profit"
  when
    $order : Order()
    accumulate( OrderItem( order == $order, $cost : cost, $price : price );
                $avgProfit : average( 1 - $cost / $price ) )
  then
    // Average profit for `$order` is `$avgProfit`.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>要在中使用自定义的，特定于域的功能<code>accumulate</code>条件，请创建一个实现<code>org.kie.api.runtime.rule.AccumulateFunction</code>接口。例如，以下Java类定义了<code>AverageData</code>功能：</p>
</div>
<div class="listingblock">
<div class="title">具有自定义实现的示例Java类<code>average</code>功能</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// An implementation of an accumulator capable of calculating average values

public class AverageAccumulateFunction implements org.kie.api.runtime.rule.AccumulateFunction&lt;AverageAccumulateFunction.AverageData&gt; {

    public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException {

    }

    public void writeExternal(ObjectOutput out) throws IOException {

    }

    public static class AverageData implements Externalizable {
        public int    count = 0;
        public double total = 0;

        public AverageData() {}

        public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException {
            count   = in.readInt();
            total   = in.readDouble();
        }

        public void writeExternal(ObjectOutput out) throws IOException {
            out.writeInt(count);
            out.writeDouble(total);
        }

    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#createContext()
     */
    public AverageData createContext() {
        return new AverageData();
    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#init(java.io.Serializable)
     */
    public void init(AverageData context) {
        context.count = 0;
        context.total = 0;
    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#accumulate(java.io.Serializable, java.lang.Object)
     */
    public void accumulate(AverageData context,
                           Object value) {
        context.count++;
        context.total += ((Number) value).doubleValue();
    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#reverse(java.io.Serializable, java.lang.Object)
     */
    public void reverse(AverageData context, Object value) {
        context.count--;
        context.total -= ((Number) value).doubleValue();
    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#getResult(java.io.Serializable)
     */
    public Object getResult(AverageData context) {
        return new Double( context.count == 0 ? 0 : context.total / context.count );
    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#supportsReverse()
     */
    public boolean supportsReverse() {
        return true;
    }

    /* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#getResultType()
     */
    public Class&lt; ? &gt; getResultType() {
        return Number.class;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>要在DRL规则中使用自定义函数，请使用<code>import accumulate</code>声明：</p>
</div>
<div class="listingblock">
<div class="title">导入自定义功能的格式</div>
<div class="content">
<pre class="highlightjs highlight"><code>import accumulate &lt;class_name&gt; &lt;function_name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">导入的示例规则<code>average</code>功能</div>
<div class="content">
<pre class="highlightjs highlight"><code>import accumulate AverageAccumulateFunction.AverageData average

rule "Average profit"
  when
    $order : Order()
    accumulate( OrderItem( order == $order, $cost : cost, $price : price );
                $avgProfit : average( 1 - $cost / $price ) )
  then
    // Average profit for `$order` is `$avgProfit`.
end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>为了向后兼容，Drools引擎还支持以下配置： <code>accumulate</code>通过配置文件和系统属性来实现功能，但这是不推荐使用的方法。配置<code>average</code>使用配置文件或系统属性，使用上一示例中的函数，设置属性，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>drools.accumulate.function.average = AverageAccumulateFunction.AverageData</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意<code>drools.accumulate.function</code>是必需的前缀， <code>average</code>在DRL文件中如何使用该功能，以及<code>AverageAccumulateFunction.AverageData</code>是实现函数行为的类的完全限定名称。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>accumulate</code>具有返回类型的单个函数的备用语法</dt>
<dd>
<p>累积语法随着时间的推移而发展，目的是变得更加紧凑和富有表现力。尽管如此，Drools仍支持以前的语法以实现向后兼容。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>如果规则在给定的累加上使用单个累加函数，则作者可以为结果对象添加一个模式，并使用“ from”关键字将其链接到累加结果。</p>
</div>
<div class="paragraph">
<p>示例：对订单金额超过100美元的商品应用10％折扣的规则可以通过以下方式编写：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "Apply 10% discount to orders over US$ 100,00"
when
    $order : Order()
    $total : Number( doubleValue &gt; 100 )
             from accumulate( OrderItem( order == $order, $value : value ),
                              sum( $value ) )
then
    // apply discount to $order
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的示例中，accumulate元素仅使用一个函数（求和），因此规则创建者选择为accumulate函数（Number）的结果类型显式编写一个模式，并在其中写入约束。与以前介绍的紧凑语法相比，使用此语法没有任何问题，除了稍微冗长一些。还要注意，不允许在同一累积语句中同时使用返回类型和绑定的函数。</p>
</div>
<div class="paragraph">
<p>进行编译时检查是为了确保与“ <code>from</code> ”关键字可从所使用的累加函数的结果中分配。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>使用这种语法，“ <code>from</code> ”绑定到accumulate函数返回的单个结果，并且不会迭代。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>在上面的示例中， <code>$total</code> ”绑定到累加sum（）函数返回的结果。</p>
</div>
<div class="paragraph">
<p>但是，作为另一个示例，如果accumulate函数的结果是一个集合，则“ <code>from</code> ”仍绑定到单个结果，并且不会迭代：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "Person names"
when
  $x : Object() from accumulate(MyPerson( $val : name );
                                collectList( $val ) )
then
  // $x is a List
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>界限“ <code>$x : Object()</code> ”是列表本身，由使用的collectList累加函数返回。</p>
</div>
<div class="paragraph">
<p>这是一个重要的区别，因为“ <code>from</code>也可以将“”关键字与“累加”分开使用，以迭代集合的元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "Iterate the numbers"
when
    $xs : List()
    $x : Integer() from $xs
then
  // $x matches and binds to each Integer in the collection
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>虽然出于向后兼容的目的仍支持此语法，但是出于此原因和其他原因，我们鼓励规则作者使用而不是首选<code>accumulate</code>语法（如前所述），以避免任何潜在的陷阱。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>accumulate</code>内联自定义代码</dt>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p>内联自定义代码的累加使用不是一个好习惯，这有几个原因，包括难以维护和测试使用它们的规则，以及无法重用该代码。实现自己的累加函数非常简单明了，易于单元测试和使用。仅支持向后兼容的这种形式的累加。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>另一种可能的语法<code>accumulate</code>是定义内联自定义代码，而不是使用累加函数。如前所述，尽管出于上述原因，我们不建议这样做。</p>
</div>
<div class="paragraph">
<p>的一般语法<code>accumulate</code>具有内联定制代码的CE是：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;result pattern&gt; from accumulate( &lt;source pattern&gt;,
                                  init( &lt;init code&gt; ),
                                  action( &lt;action code&gt; ),
                                  reverse( &lt;reverse code&gt; ),
                                  result( &lt;result expression&gt; ) )</code></pre>
</div>
</div>
<div class="paragraph">
<p>每个元素的含义如下：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em><source pattern=""></em> ：源模式是Drools引擎将尝试与每个源对象匹配的常规模式。</p>
</li>
<li>
<p><em><init></init></em> ：这是所选方言中的语义代码块，在遍历源对象之前，将对每个元组执行一次。</p>
</li>
<li>
<p><em><action></action></em> ：这是所选方言中的语义代码块，将为每个源对象执行。</p>
</li>
<li>
<p><em><reverse></reverse></em> ：这是所选方言中的一个可选语义代码块，如果存在，将为与该源模式不再匹配的每个源对象执行该代码块。该代码块的目的是撤销在<em><action></action></em>块，以便Drools引擎在修改或删除源对象时可以进行递减计算，从而极大地提高了这些操作的性能。</p>
</li>
<li>
<p><em><result expression=""></result></em> ：这是所选方言中的语义表达式，在所有源对象都经过迭代之后执行。</p>
</li>
<li>
<p><em><result pattern=""></result></em> ：这是Drools引擎尝试与从的返回对象匹配的常规模式<em><result expression=""></result></em> 。如果匹配，则<code>accumulate</code>条件元素的评估结果为<em>true</em> ，并且Drools引擎继续评估规则中的下一个CE。如果不匹配，则<code>accumulate</code> CE评估为<em>假</em> ，并且Drools引擎停止评估该规则的CE。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果看一个例子，更容易理解：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "Apply 10% discount to orders over US$ 100,00"
when
    $order : Order()
    $total : Number( doubleValue &gt; 100 )
             from accumulate( OrderItem( order == $order, $value : value ),
                              init( double total = 0; ),
                              action( total += $value; ),
                              reverse( total -= $value; ),
                              result( total ) )
then
    // apply discount to $order
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的示例中，对于每个<code>Order</code>在工作内存中，Drools引擎将执行<em>初始化代码，</em>将总变量初始化为零。然后它将遍历所有对象<code>OrderItem</code>顺序的对象，对每个对象执行该<em>操作</em> （在示例中，它将所有项目的值加到total变量中）。遍历所有之后<code>OrderItem</code>对象，它将返回与<em>结果表达式</em>相对应的值（在上面的示例中，变量的值<code>total</code> ）。最后，Drools引擎将尝试将结果与<code>Number</code>模式，如果double值大于100，则规则将触发。</p>
</div>
<div class="paragraph">
<p>该示例使用Java作为语义方言，因此，请注意在初始化，操作和反向代码块中，必须使用分号作为语句定界符。结果是一个表达式，因此，它不接受“;”。如果用户使用任何其他方言，则他必须遵守该方言的特定语法。</p>
</div>
<div class="paragraph">
<p>如前所述， <em>反向代码</em>是可选的，但是强烈建议用户编写<em>反向代码</em> ，以便从<em>update和delete</em>的<em>改进性能中</em>受益。</p>
</div>
<div class="paragraph">
<p>的<code>accumulate</code> CE可用于对源对象执行任何操作。下面的示例实例化并填充一个自定义对象：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "Accumulate using custom objects"
when
    $person   : Person( $likes : likes )
    $cheesery : Cheesery( totalAmount &gt; 100 )
                from accumulate( $cheese : Cheese( type == $likes ),
                                 init( Cheesery cheesery = new Cheesery(); ),
                                 action( cheesery.addCheese( $cheese ); ),
                                 reverse( cheesery.removeCheese( $cheese ); ),
                                 result( cheesery ) );
then
    // do something
end</code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>eval</code></dt>
<dd>
<p>条件元素<code>eval</code>本质上是一个包罗万象的东西，它允许执行任何语义代码（返回原始布尔值）。此代码可以引用规则包中的规则和函数条件中绑定的变量。过度使用<code>eval</code>降低规则的声明性，并可能导致Drools引擎性能不佳。而<code>eval</code>可以在模式中的任何位置使用，通常作为规则条件中的最后一个条件元素添加。</p>
<div class="openblock">
<div class="content">
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/eval.png" alt="评估">
</div>
<div class="title">图70。评估</div>
</div>
<div class="paragraph">
<p>的实例<code>eval</code>无法索引，因此效率不如Field Constraints。但是，这使它们成为函数返回随时间变化的值（字段约束中不允许使用）的理想选择。</p>
</div>
<div class="paragraph">
<p>对于熟悉Drools 2.x血统的人，旧的Drools参数和条件标记等效于将变量绑定到适当的类型，然后在<code>eval</code>节点。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>p1 : Parameter()
p2 : Parameter()
eval( p1.getList().containsKey( p2.getItem() ) )</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>p1 : Parameter()
p2 : Parameter()
// call function isValid in the LHS
eval( isValid( p1, p2 ) )</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="drl-rules-oopath-con_drl-rules"><a class="anchor" href="#drl-rules-oopath-con_drl-rules"></a> <a class="link" href="#drl-rules-oopath-con_drl-rules">4.1.8.9。带有DRL规则条件中的对象图的OOPath语法</a></h5>
<div class="paragraph">
<p>OOPath是XPath的面向对象的语法扩展，旨在浏览DRL规则条件约束中的对象图。OOPath使用XPath的紧凑表示法在处理集合和过滤约束时浏览相关元素，尤其适用于对象图。</p>
</div>
<div class="paragraph">
<p>如果事实字段是集合，则可以使用<code>from</code>条件元素（关键字）一个一个地绑定和推理该集合中的所有项目。如果您需要浏览规则条件约束中的对象图，则可以广泛使用<code>from</code> condition元素导致冗长且重复的语法，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">使用以下规则浏览对象图的示例规则<code>from</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Find all grades for Big Data exam"
  when
    $student: Student( $plan: plan )
    $exam: Exam( course == "Big Data" ) from $plan.exams
    $grade: Grade() from $exam.grades
  then
    // Actions
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，域模型包含一个<code>Student</code>带一个对象<code>Plan</code>研究。的<code>Plan</code>可以有零个或多个<code>Exam</code>实例和<code>Exam</code>可以有零个或多个<code>Grade</code>实例。只有图的根对象<code>Student</code>在这种情况下，该规则设置必须存在于Drools引擎的工作存储器中。</p>
</div>
<div class="paragraph">
<p>作为更广泛使用的替代方法<code>from</code>语句，可以使用缩写的OOPath语法，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">使用OOPath语法浏览对象图的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Find all grades for Big Data exam"
  when
    Student( $grade: /plan/exams[course == "Big Data"]/grades )
  then
    // Actions
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>形式上，OOPath表达式的核心语法以扩展Backus-Naur格式（EBNF）表示法定义，其方式如下：</p>
</div>
<div class="listingblock">
<div class="title">OOPath表达式的EBNF表示法</div>
<div class="content">
<pre class="highlightjs highlight"><code>OOPExpr = [ID ( ":" | ":=" )] ( "/" | "?/" ) OOPSegment { ( "/" | "?/" | "." ) OOPSegment } ;
OOPSegment = ID ["#" ID] ["[" ( Number | Constraints ) "]"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>实际上，OOPath表达式具有以下功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>以正斜杠开头<code>/</code>或带有问号和正斜杠<code>?/</code>如果它是非反应式OOPath表达式（在本节的后面部分中介绍）。</p>
</li>
<li>
<p>可以用句点取消引用对象的单个属性<code>.</code>操作员。</p>
</li>
<li>
<p>可以用正斜杠取消引用对象的多个属性<code>/</code>操作员。如果返回集合，则表达式将迭代集合中的值。</p>
</li>
<li>
<p>可以滤除不满足一个或多个约束的遍历对象。约束写为方括号之间的谓词表达式，如以下示例所示：</p>
<div class="listingblock">
<div class="title">约束作为谓词表达</div>
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams[ course == "Big Data" ]/grades )</code></pre>
</div>
</div>
</li>
<li>
<p>可以将遍历的对象降级为通用集合中声明的类的子类。后续约束也可以安全地访问仅在该子类中声明的属性，如以下示例所示。不是此内联强制转换中指定的类实例的对象将被自动过滤掉。</p>
<div class="listingblock">
<div class="title">向下投射对象的约束</div>
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams#AdvancedExam[ course == "Big Data", level &gt; 3 ]/grades )</code></pre>
</div>
</div>
</li>
<li>
<p>可以反向引用在当前迭代的图形之前遍历的图形对象。例如，以下OOPath表达式仅匹配通过考试的平均成绩之上的成绩：</p>
<div class="listingblock">
<div class="title">带有反向引用对象的约束</div>
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams/grades[ result &gt; ../averageResult ] )</code></pre>
</div>
</div>
</li>
<li>
<p>可以递归地成为另一个OOPath表达式，如以下示例所示：</p>
<div class="listingblock">
<div class="title">递归约束表达式</div>
<div class="content">
<pre class="highlightjs highlight"><code>Student( $exam: /plan/exams[ /grades[ result &gt; 20 ] ] )</code></pre>
</div>
</div>
</li>
<li>
<p>可以通过方括号之间的索引访问对象<code>[]</code> ，如以下示例所示。为了遵守Java约定，OOPath索引从0开始，而XPath索引从1开始。</p>
<div class="listingblock">
<div class="title">限制按索引访问对象</div>
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams[0]/grades )</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>OOPath表达式可以是反应性的也可以是非反应性的。Drools引擎不会对包含在OOPath表达式求值过程中遍历的深层嵌套对象的更新作出反应。</p>
</div>
<div class="paragraph">
<p>要使这些对象对更改有反应，请修改对象以扩展类<code>org.drools.core.phreak.ReactiveObject</code> 。修改对象以扩展对象后<code>ReactiveObject</code>类，域对象调用继承的方法<code>notifyModification</code>在其中一个字段已更新时通知Drools引擎，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">通知Drools引擎考试已转移到其他课程的示例对象方法</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void setCourse(String course) {
        this.course = course;
        notifyModification(this);
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用以下对应的OOPath表达式，当将考试移至其他课程时，将重新执行该规则，并重新计算与该规则匹配的成绩列表：</p>
</div>
<div class="listingblock">
<div class="title">来自“大数据”规则的OOPath表达式示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams[ course == "Big Data" ]/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>您也可以使用<code>?/</code>分隔符而不是<code>/</code>分隔符以仅在OOPath表达式的一个子部分中禁用反应性，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">部分非反应性的示例OOPath表达式</div>
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams[ course == "Big Data" ]?/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，Drools引擎会对对考试所做的更改或是否将考试添加到计划中做出了反应，但如果对现有考试添加了新成绩则没有反应。</p>
</div>
<div class="paragraph">
<p>如果OOPath部分是非反应性的，则OOPath表达式的所有其余部分也将变为非反应性的。例如，以下OOPath表达式是完全非反应性的：</p>
</div>
<div class="listingblock">
<div class="title">完全不反应的示例OOPath表达式</div>
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: ?/plan/exams[ course == "Big Data" ]/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>因此，您不能使用<code>?/</code>在同一OOPath表达式中，分隔符不止一次。例如，以下表达式导致编译错误：</p>
</div>
<div class="listingblock">
<div class="title">示例OOPath表达式具有重复的非反应性标记</div>
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan?/exams[ course == "Big Data" ]?/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>启用OOPath表达式反应性的另一种方法是将专用实现用于<code>List</code>和<code>Set</code> Drools中的界面。这些实现是<code>ReactiveList</code>和<code>ReactiveSet</code>类。一种<code>ReactiveCollection</code>也可以上课。这些实现还通过以下方式为执行可变操作提供了响应式支持： <code>Iterator</code>和<code>ListIterator</code>类。</p>
</div>
<div class="paragraph">
<p>以下示例类使用这些类来配置OOPath表达式反应性：</p>
</div>
<div class="listingblock">
<div class="title">配置OOPath表达式反应性的示例Java类</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class School extends AbstractReactiveObject {
    private String name;
    private final List&lt;Child&gt; children = new ReactiveList&lt;Child&gt;(); <i class="conum" data-value="1"></i><b>(1)</b>

    public void setName(String name) {
        this.name = name;
        notifyModification(); <i class="conum" data-value="2"></i><b>(2)</b>
    }

    public void addChild(Child child) {
        children.add(child); <i class="conum" data-value="3"></i><b>(3)</b>
        // No need to call `notifyModification()` here
    }
  }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>使用<code>ReactiveList</code>对标准Java的反应式支持的实例<code>List</code>实例。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>使用所需<code>notifyModification()</code>在响应式支持中更改字段的方法。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i> <b>3</b></td>
<td>的<code>children</code>字段是<code>ReactiveList</code>因此， <code>notifyModification()</code>不需要方法调用。通知是自动处理的，就像通过<code>children</code>领域。</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="drl-rules-WHEN-elements-diagrams-ref_drl-rules"><a class="anchor" href="#drl-rules-WHEN-elements-diagrams-ref_drl-rules"></a> <a class="link" href="#drl-rules-WHEN-elements-diagrams-ref_drl-rules">4.1.8.10。DRL中规则条件元素的铁路图</a></h5>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/AccumulateAction.png" alt="累积动作">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/AccumulateClause.png" alt="累积条款">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/AccumulateFunction.png" alt="累计功能">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/AccumulateInit.png" alt="累积初始化">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/AccumulateResult.png" alt="累计结果">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/AccumulateReverse.png" alt="累积反向">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/AccumulateSteps.png" alt="累积步骤">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Accumulations.png" alt="积累">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/AdditiveExpr.png" alt="AdditiveExpr">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Annotation.png" alt="注解">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Arguments.png" alt="争论">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ArrayCreatorRest.png" alt="ArrayCreatorRest">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ArrayInitializer.png" alt="ArrayInitializer">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/AssignmentOperator.png" alt="AssignmentOperator">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/BindingPattern.png" alt="绑定模式">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Block.png" alt="块">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/BooleanLiteral.png" alt="布尔文字">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/CompilationUnit.png" alt="编译单元">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ConditionalAnd.png" alt="有条件的">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ConditionalElementAccumulate.png" alt="ConditionalElementAccumulate">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ConditionalElementEval.png" alt="ConditionalElementEval">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ConditionalElementExists.png" alt="条件元素存在">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ConditionalElementForall.png" alt="ConditionalElementForall">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ConditionalElementNot.png" alt="ConditionalElementNot">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ConditionalElement.png" alt="条件元素">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ConditionalExpr.png" alt="条件表达式">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ConditionalOrExpr.png" alt="条件运算器">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ConditionalOr.png" alt="条件或">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Constraints.png" alt="约束条件">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/CreatedName.png" alt="创建名称">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Creator.png" alt="创作者">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Definition.png" alt="定义">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Digit.png" alt="数字">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ExplicitGenericInvocationSuffix.png" alt="显式泛型调用后缀">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ExplicitGenericInvocation.png" alt="显式泛型调用">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Exponent.png" alt="指数">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ExpressionList.png" alt="表达式列表">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Expression.png" alt="表达">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Field.png" alt="领域">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Fraction.png" alt="分数">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/FromAccumulateClause.png" alt="FromAccumulateClause">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/FromClause.png" alt="从条款">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/FromCollectClause.png" alt="FromCollectClause">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/FunctionDefinition.png" alt="功能定义">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/GlobalDefinition.png" alt="全球定义">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/IdentifierSuffix.png" alt="标识符后缀">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ImportDefinition.png" alt="ImportDefinition">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/InExpr.png" alt="专家">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/InlineListExpr.png" alt="InlineListExpr">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/InlineMapExpr.png" alt="InlineMapExpr">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/InnerCreator.png" alt="内在创造者">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/InstanceOfExpr.png" alt="InstanceOfExpr">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/IntLiteral.png" alt="国际文学">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Literal.png" alt="文字">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ModifyStatement.png" alt="修改声明">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/NonWildcardTypeArguments.png" alt="NonWildcardTypeArguments">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/OrRestriction.png" alt="或限制">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/OverClause.png" alt="过度条款">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Parameters.png" alt="参量">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Pattern.png" alt="图案">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Placeholders.png" alt="占位符">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Primary.png" alt="主">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/PrimitiveType.png" alt="原始类型">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/QualifiedName.png" alt="合格名称">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/QueryDefinition.png" alt="查询定义">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/QueryOptions.png" alt="QueryOptions">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/RealLiteral.png" alt="真正的文学">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/RealTypeSuffix.png" alt="RealTypeSuffix">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/RelationalExpr.png" alt="RelationalExpr">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/RelationalOperator.png" alt="关系运算符">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/RhsStatement.png" alt="声明">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/RuleAttributes.png" alt="RuleAttributes">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/RuleAttribute.png" alt="RuleAttribute">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/RuleDefinition.png" alt="规则定义">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/RuleOptions.png" alt="RuleOptions">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Selector.png" alt="选择器">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ShiftExpr.png" alt="ShiftExpr">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/SingleRestriction.png" alt="单一限制">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/SourcePattern.png" alt="源模式">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/StringId.png" alt="StringId">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/SuperSuffix.png" alt="超级后缀">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/ThenPart.png" alt="然后">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/TypeArguments.png" alt="类型参数">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/TypeArgument.png" alt="类型参数">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/TypeDefinition.png" alt="类型定义">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/TypeOptions.png" alt="类型选项">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Type.png" alt="类型">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/UnaryExprNotPlusMinus.png" alt="一元ExprNotPlusMinus">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/UnaryExpr.png" alt="一元专家">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/Value.png" alt="值">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/VariableInitializer.png" alt="VariableInitializer">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/WhenPart.png" alt="当零件">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="drl-rules-THEN-con_drl-rules"><a class="anchor" href="#drl-rules-THEN-con_drl-rules"></a> <a class="link" href="#drl-rules-THEN-con_drl-rules">4.1.9。DRL中的规则操作（THEN）</a></h4>
<div class="paragraph">
<p>的<code>then</code>规则的一部分（也称为规则的<em>右侧（RHS）</em> ）包含在满足规则的条件部分时要执行的操作。操作由一种或多种<em>方法</em>组成，这些<em>方法</em>根据规则条件和程序包中的可用数据对象执行结果。例如，如果银行要求贷款申请人的年龄超过21岁（有规则条件<code>Applicant( age < 21 )</code> ）且贷款申请人未满21岁， <code>then</code>一个动作<code>"Underage"</code>规则是<code>setApproved( false )</code> ，因为申请人未满年龄而拒绝贷款。</p>
</div>
<div class="paragraph">
<p>规则操作的主要目的是在Drools引擎的工作内存中插入，删除或修改数据。有效的规则动作较小，声明性且可读性强。如果需要在规则操作中使用命令性或条件性代码，则将规则分为多个较小的和更具声明性的规则。</p>
</div>
<div class="listingblock">
<div class="title">贷款申请年龄限制的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Underage"
  when
    application : LoanApplication()
    Applicant( age &lt; 21 )
  then
    application.setApproved( false );
    application.setExplanation( "Underage" );
end</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="drl-rules-THEN-methods-ref_drl-rules"><a class="anchor" href="#drl-rules-THEN-methods-ref_drl-rules"></a> <a class="link" href="#drl-rules-THEN-methods-ref_drl-rules">4.1.9.1。DRL中支持的规则操作方法</a></h5>
<div class="paragraph">
<p>DRL支持以下可在DRL规则操作中使用的规则操作方法。您可以使用这些方法来修改Drools引擎的工作内存，而不必首先引用工作内存实例。这些方法充当了由<code>KnowledgeHelper</code>类在您的Drools发行版中。</p>
</div>
<div class="paragraph">
<p>有关所有规则操作方法，请参阅GitHub上的Drools <a href="https://github.com/kiegroup/drools/blob/7.26.x/drools-core/src/main/java/org/drools/core/spi/KnowledgeHelper.java">KnowledgeHelper.java</a>页面。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>set</code></dt>
<dd>
<p>使用此设置字段的值。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>set&lt;field&gt; ( &lt;value&gt; )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">设置贷款申请批准值的规则操作示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>$application.setApproved ( false );
$application.setExplanation( "has been bankrupt" );</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>modify</code></dt>
<dd>
<p>使用它来指定要为事实修改的字段，并将更改通知给Drools引擎。此方法提供了一种用于事实更新的结构化方法。它结合了<code>update</code>使用setter调用进行操作以更改对象字段。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>modify ( &lt;fact-expression&gt; ) {
    &lt;expression&gt;,
    &lt;expression&gt;,
    ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">修改贷款申请金额和批准的规则操作示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>modify( LoanApplication ) {
        setAmount( 100 ),
        setApproved ( true )
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>update</code></dt>
<dd>
<p>使用它来指定字段和要更新的整个相关事实，并将更改通知给Drools引擎。事实改变后，您必须致电<code>update</code>在更改可能受更新值影响的另一个事实之前。为避免此附加步骤，请使用<code>modify</code>方法代替。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>update ( &lt;object, &lt;handle&gt; )  // Informs the Drools engine that an object has changed

update ( &lt;object&gt; )  // Causes `KieSession` to search for a fact handle of the object</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">更新贷款申请金额和批准的规则操作示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>LoanApplication.setAmount( 100 );
update( LoanApplication );</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">如果提供属性更改侦听器，则在对象更改时无需调用此方法。有关属性更改侦听器的更多信息，请参阅<a href="#property-change-listeners-con_decision-engine">事实类型的属性更改设置和侦听器</a> 。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>insert</code></dt>
<dd>
<p>使用此插入<code>new</code>将事实存储到Drools引擎的工作存储器中，并根据事实定义所需的结果字段和值。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>insert( new &lt;object&gt; );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">插入新的贷款申请人对象的规则操作示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>insert( new Applicant() );</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>insertLogical</code></dt>
<dd>
<p>使用此插入<code>new</code>逻辑上将事实纳入Drools引擎。Drools引擎负责事实的插入和撤回的逻辑决策。在常规或声明的插入之后，必须明确撤回事实。逻辑插入后，如果插入事实的规则中的条件不再成立，则插入的事实将自动撤回。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>insertLogical( new &lt;object&gt; );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">逻辑插入新贷款申请人对象的示例规则操作</div>
<div class="content">
<pre class="highlightjs highlight"><code>insertLogical( new Applicant() );</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>delete</code></dt>
<dd>
<p>使用它从Drools引擎中删除对象。关键字<code>retract</code>在DRL中也受支持，并执行相同的操作，但是<code>delete</code>在DRL代码中，通常首选与关键字保持一致<code>insert</code> 。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>delete( &lt;object&gt; );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">删除贷款申请人对象的规则操作示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>delete( Applicant );</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="drl-rules-THEN-methods-variables-ref_drl-rules"><a class="anchor" href="#drl-rules-THEN-methods-variables-ref_drl-rules"></a> <a class="link" href="#drl-rules-THEN-methods-variables-ref_drl-rules">4.1.9.2。的其他规则操作方法<code>drools</code>和<code>kcontext</code>变数</a></h5>
<div class="paragraph">
<p>除标准规则操作方法外，Drools引擎还支持与预定义方法结合使用的方法<code>drools</code>和<code>kcontext</code>您还可以在规则操作中使用的变量。</p>
</div>
<div class="paragraph">
<p>您可以使用<code>drools</code>变量以从中调用方法<code>KnowledgeHelper</code>类在您的Drools发行版中，也是标准规则操作方法所基于的类。对所有人<code>drools</code>规则操作选项，请参阅GitHub上的Drools <a href="https://github.com/kiegroup/drools/blob/7.26.x/drools-core/src/main/java/org/drools/core/spi/KnowledgeHelper.java">KnowledgeHelper.java</a>页面。</p>
</div>
<div class="paragraph">
<p>以下示例是可与<code>drools</code>变量：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>drools.halt()</code> ：如果用户或应用程序先前已调用，则终止规则执行<code>fireUntilHalt()</code> 。当用户或应用程序调用<code>fireUntilHalt()</code> ，Drools引擎将以<em>活动模式</em>启动并持续评估规则，直到用户或应用程序明确调用<code>halt()</code> 。否则，默认情况下，Drools引擎以<em>被动模式</em>运行，并且仅在用户或应用程序显式调用时评估规则<code>fireAllRules()</code> 。</p>
</li>
<li>
<p><code>drools.getWorkingMemory()</code> ：返回<code>WorkingMemory</code>宾语。</p>
</li>
<li>
<p><code>drools.setFocus( "<agenda_group>" )</code> ：将焦点设置为规则所属的指定议程组。</p>
</li>
<li>
<p><code>drools.getRule().getName()</code> ：返回规则的名称。</p>
</li>
<li>
<p><code>drools.getTuple()</code> ， <code>drools.getActivation()</code> ：返回<code>Tuple</code>匹配当前执行的规则，然后提供相应的<code>Activation</code> 。这些调用对于记录和调试目的很有用。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>您可以使用<code>kcontext</code>与变量<code>getKieRuntime()</code>方法从中调用其他方法<code>KieContext</code>类，并通过扩展， <code>RuleContext</code>类在您的Drools发行版中。完整的Knowledge Runtime API通过以下方式公开： <code>kcontext</code>变量并提供广泛的规则操作方法。对所有人<code>kcontext</code>规则操作选项，请参阅GitHub上的Drools <a href="https://github.com/kiegroup/droolsjbpm-knowledge/blob/7.26.x/kie-api/src/main/java/org/kie/api/runtime/rule/RuleContext.java">RuleContext.java</a>页面。</p>
</div>
<div class="paragraph">
<p>以下示例是可与<code>kcontext.getKieRuntime()</code>可变方法组合：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>kcontext.getKieRuntime().halt()</code> ：如果用户或应用程序先前已调用，则终止规则执行<code>fireUntilHalt()</code> 。此方法等效于<code>drools.halt()</code>方法。当用户或应用程序调用<code>fireUntilHalt()</code> ，Drools引擎将以<em>活动模式</em>启动并持续评估规则，直到用户或应用程序明确调用<code>halt()</code> 。否则，默认情况下，Drools引擎以<em>被动模式</em>运行，并且仅在用户或应用程序显式调用时评估规则<code>fireAllRules()</code> 。</p>
</li>
<li>
<p><code>kcontext.getKieRuntime().getAgenda()</code> ：返回对KIE会话的引用<code>Agenda</code> ，进而提供对规则激活组，规则议程组和规则流组的访问。</p>
<div class="listingblock">
<div class="title">调用访问议程组“ CleanUp”并设置焦点的示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">kcontext.getKieRuntime().getAgenda().getAgendaGroup( "CleanUp" ).setFocus();</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个例子相当于<code>drools.setFocus( "CleanUp" )</code> 。</p>
</div>
</li>
<li>
<p><code>kcontext.getKieRuntime().getQueryResults(<string> query)</code> ：运行查询并返回结果。此方法等效于<code>drools.getKieRuntime().getQueryResults()</code> 。</p>
</li>
<li>
<p><code>kcontext.getKieRuntime().getKieBase()</code> ：返回<code>KieBase</code>宾语。KIE基础是规则系统中所有知识的来源，也是当前KIE会话的发起者。</p>
</li>
<li>
<p><code>kcontext.getKieRuntime().setGlobal()</code> ， <code>~.getGlobal()</code> ， <code>~.getGlobals()</code> ：设置或获取全局变量。</p>
</li>
<li>
<p><code>kcontext.getKieRuntime().getEnvironment()</code> ：返回运行时<code>Environment</code> ，类似于您的操作系统环境。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="drl-rules-THEN-advanced-con_drl-rules"><a class="anchor" href="#drl-rules-THEN-advanced-con_drl-rules"></a> <a class="link" href="#drl-rules-THEN-advanced-con_drl-rules">4.1.9.3。具有条件和命名后果的高级规则操作</a></h5>
<div class="paragraph">
<p>通常，有效的规则操作是小的，声明性的和可读的。但是，在某些情况下，对每个规则具有单一结果的局限性可能具有挑战性，并导致冗长且重复的规则语法，如以下示例规则所示：</p>
</div>
<div class="listingblock">
<div class="title">详细和重复语法的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Give 10% discount to customers older than 60"
  when
    $customer : Customer( age &gt; 60 )
  then
    modify($customer) { setDiscount( 0.1 ) };
end

rule "Give free parking to customers older than 60"
  when
    $customer : Customer( age &gt; 60 )
    $car : Car( owner == $customer )
  then
    modify($car) { setFreeParking( true ) };
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>重复的部分解决方案是使第二个规则扩展第一个规则，如以下修改的示例所示：</p>
</div>
<div class="listingblock">
<div class="title">具有扩展条件的部分增强示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Give 10% discount to customers older than 60"
  when
    $customer : Customer( age &gt; 60 )
  then
    modify($customer) { setDiscount( 0.1 ) };
end

rule "Give free parking to customers older than 60"
    extends "Give 10% discount to customers older than 60"
  when
    $car : Car( owner == $customer )
  then
    modify($car) { setFreeParking( true ) };
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>作为更有效的替代方法，可以将两个规则合并为具有修改后的条件并标记为相应的规则操作的单个规则，如以下合并的示例所示：</p>
</div>
<div class="listingblock">
<div class="title">具有条件和命名结果的合并示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Give 10% discount and free parking to customers older than 60"
  when
    $customer : Customer( age &gt; 60 )
    do[giveDiscount]
    $car : Car( owner == $customer )
  then
    modify($car) { setFreeParking( true ) };
  then[giveDiscount]
    modify($customer) { setDiscount( 0.1 ) };
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>此示例规则使用两个操作：通常的默认操作和另一个名为<code>giveDiscount</code> 。的<code>giveDiscount</code>在使用关键字的条件下激活动作<code>do</code>当在KIE基地中找到60岁以上的顾客时，无论该顾客是否拥有汽车。</p>
</div>
<div class="paragraph">
<p>您可以配置带有其他条件的命名结果的激活，例如<code>if</code>以下示例中的语句。中的条件<code>if</code>语句始终根据紧接其前的模式进行评估。</p>
</div>
<div class="listingblock">
<div class="title">具有附加条件的合并示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Give free parking to customers older than 60 and 10% discount to golden ones among them"
  when
    $customer : Customer( age &gt; 60 )
    if ( type == "Golden" ) do[giveDiscount]
    $car : Car( owner == $customer )
  then
    modify($car) { setFreeParking( true ) };
  then[giveDiscount]
    modify($customer) { setDiscount( 0.1 ) };
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以使用嵌套评估不同的规则条件<code>if</code>和<code>else if</code>构造，如以下更复杂的示例所示：</p>
</div>
<div class="listingblock">
<div class="title">条件更复杂的合并示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Give free parking and 10% discount to over 60 Golden customer and 5% to Silver ones"
  when
    $customer : Customer( age &gt; 60 )
    if ( type == "Golden" ) do[giveDiscount10]
    else if ( type == "Silver" ) break[giveDiscount5]
    $car : Car( owner == $customer )
  then
    modify($car) { setFreeParking( true ) };
  then[giveDiscount10]
    modify($customer) { setDiscount( 0.1 ) };
  then[giveDiscount5]
    modify($customer) { setDiscount( 0.05 ) };
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>此示例规则为60岁以上的Golden客户提供10％的折扣和免费停车，但为Silver客户提供5％的折扣而没有免费停车。规则激活名为<code>giveDiscount5</code>与关键字<code>break</code>代替<code>do</code> 。关键字<code>do</code>在Drools引擎议程中安排结果的时间，使规则条件的其余部分得以继续评估，而<code>break</code>阻止进一步的条件评估。如果命名结果不符合任何条件，则<code>do</code>但被激活<code>break</code> ，由于无法达到规则的条件部分，因此规则无法编译。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="drl-rules-comments-con_drl-rules"><a class="anchor" href="#drl-rules-comments-con_drl-rules"></a> <a class="link" href="#drl-rules-comments-con_drl-rules">4.1.10。DRL文件中的注释</a></h4>
<div class="paragraph">
<p>DRL支持以双斜杠为前缀的单行注释<code>//</code>以及用斜杠和星号括起来的多行注释<code>/* …​ */</code> 。您可以使用DRL注释来注释规则或DRL文件中的任何相关组件。处理DRL文件时，Drools引擎将忽略DRL注释。</p>
</div>
<div class="listingblock">
<div class="title">带注释的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Underage"
  // This is a single-line comment.
  when
    $application : LoanApplication()  // This is an in-line comment.
    Applicant( age &lt; 21 )
  then
    /* This is a multi-line comment
    in the rule actions. */
    $application.setApproved( false );
    $application.setExplanation( "Underage" );
end</code></pre>
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/multi_line_comment.png" alt="多行注释">
</div>
<div class="title">图71。多行评论</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">哈希符号<code>#</code>不支持DRL注释。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="drl-rules-errors-ref_drl-rules"><a class="anchor" href="#drl-rules-errors-ref_drl-rules"></a> <a class="link" href="#drl-rules-errors-ref_drl-rules">4.1.11。DRL故障排除的错误消息</a></h4>
<div class="paragraph">
<p>Drools提供有关DRL错误的标准化消息，以帮助您解决和解决DRL文件中的问题。错误消息使用以下格式：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/error_message.png" alt="错误信息">
</div>
<div class="title">图72。DRL文件问题的错误消息格式</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>第一个块：</strong>错误代码</p>
</li>
<li>
<p><strong>第二块：</strong> DRL源中发生错误的行和列</p>
</li>
<li>
<p><strong>第三部分：</strong>问题描述</p>
</li>
<li>
<p><strong>第四块：</strong> DRL源中的组件（规则，函数，查询），发生错误</p>
</li>
<li>
<p><strong>第5块：</strong> DRL源中发生错误的模式（如果适用）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Drools支持以下标准化错误消息：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">101：没有可行的选择</dt>
<dd>
<p>指示解析器已到达决策点，但无法识别替代项。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">拼写错误的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>1: rule "simple rule"
2:   when
3:     exists Person()
4:     exits Student()  // Must be `exists`
5:   then
6: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">错误信息</div>
<div class="content">
<pre class="highlightjs highlight"><code>[ERR 101] Line 4:4 no viable alternative at input 'exits' in rule "simple rule"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">没有规则名称的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>1: package org.drools.examples;
2: rule    // Must be `rule "rule name"` (or `rule rule_name` if no spacing)
3:   when
4:     Object()
5:   then
6:     System.out.println("A RHS");
7: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">错误信息</div>
<div class="content">
<pre class="highlightjs highlight"><code>[ERR 101] Line 3:2 no viable alternative at input 'when'</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，解析器遇到了关键字<code>when</code>但应使用规则名称，因此它会标出<code>when</code>作为不正确的预期令牌。</p>
</div>
<div class="listingblock">
<div class="title">语法不正确的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>1: rule "simple rule"
2:   when
3:     Student( name == "Andy )  // Must be `"Andy"`
4:   then
5: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">错误信息</div>
<div class="content">
<pre class="highlightjs highlight"><code>[ERR 101] Line 0:-1 no viable alternative at input '&lt;eof&gt;' in rule "simple rule" in pattern Student</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">行和列的值为<code>0:-1</code>表示解析器已到达源文件的末尾（ <code><eof></code> ），但通常由于缺少引号而遇到不完整的构造<code>"…​"</code> ，撇号<code>'…​'</code>或括号<code>(…​)</code> 。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">102：输入不匹配</dt>
<dd>
<p>指示解析器期望当前输入位置缺少的特定符号。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">具有不完整规则声明的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>1: rule simple_rule
2:   when
3:     $p : Person(
        // Must be a complete rule statement</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">错误信息</div>
<div class="content">
<pre class="highlightjs highlight"><code>[ERR 102] Line 0:-1 mismatched input '&lt;eof&gt;' expecting ')' in rule "simple rule" in pattern Person</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">行和列的值为<code>0:-1</code>表示解析器已到达源文件的末尾（ <code><eof></code> ），但通常由于缺少引号而遇到不完整的构造<code>"…​"</code> ，撇号<code>'…​'</code>或括号<code>(…​)</code> 。
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">语法不正确的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>1: package org.drools.examples;
2:
3: rule "Wrong syntax"
4:   when
5:     not( Car( ( type == "tesla", price == 10000 ) || ( type == "kia", price == 1000 ) ) from $carList )
       // Must use `&amp;&amp;` operators instead of commas `,`
6:   then
7:     System.out.println("OK");
8: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">错误讯息</div>
<div class="content">
<pre class="highlightjs highlight"><code>[ERR 102] Line 5:36 mismatched input ',' expecting ')' in rule "Wrong syntax" in pattern Car
[ERR 101] Line 5:57 no viable alternative at input 'type' in rule "Wrong syntax"
[ERR 102] Line 5:106 mismatched input ')' expecting 'then' in rule "Wrong syntax"</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此的示例语法问题导致多个错误消息彼此相关。替换逗号的单一解决方案<code>,</code>与<code>&&</code>操作员解决了所有错误。如果遇到多个错误，请一次解决一个，以防错误是先前错误的结果。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">103：谓词失败</dt>
<dd>
<p>指示验证语义谓词的计算结果为<code>false</code> 。这些语义谓词通常用于标识DRL文件中的组件关键字，例如<code>declare</code> ， <code>rule</code> ， <code>exists</code> ， <code>not</code> ， 和别的。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">关键字无效的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code> 1: package nesting;
 2:
 3: import org.drools.compiler.Person
 4: import org.drools.compiler.Address
 5:
 6: Some text  // Must be a valid DRL keyword
 7:
 8: rule "test something"
 9:   when
10:     $p: Person( name=="Michael" )
11:   then
12:     $p.name = "other";
13:     System.out.println(p.name);
14: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">错误信息</div>
<div class="content">
<pre class="highlightjs highlight"><code>[ERR 103] Line 6:0 rule 'rule_key' failed predicate: {(validateIdentifierKey(DroolsSoftKeywords.RULE))}? in rule</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>Some text</code> line无效，因为它不是以DRL关键字构造开头或不是DRL关键字构造的一部分，因此解析器无法验证DRL文件的其余部分。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">此错误类似于<code>102: mismatched input</code> ，但通常涉及DRL关键字。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">104：不允许使用尾部分号</dt>
<dd>
<p>表示<code>eval()</code>规则条件中的子句使用分号<code>;</code>但一定不能使用一个。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">规则示例<code>eval()</code>和尾随分号</div>
<div class="content">
<pre class="highlightjs highlight"><code>1: rule "simple rule"
2:   when
3:     eval( abc(); )  // Must not use semicolon `;`
4:   then
5: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">错误信息</div>
<div class="content">
<pre class="highlightjs highlight"><code>[ERR 104] Line 3:4 trailing semi-colon not allowed in rule "simple rule"</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">105：没有任何匹配</dt>
<dd>
<p>指示解析器到达了语法中的子规则，该子规则必须至少与替代项匹配一次，但该子规则不匹配任何内容。解析器已进入分支而没有出路。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">空条件下带有无效文本的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>1: rule "empty condition"
2:   when
3:     None  // Must remove `None` if condition is empty
4:   then
5:      insert( new Person() );
6: end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">错误信息</div>
<div class="content">
<pre class="highlightjs highlight"><code>[ERR 105] Line 2:2 required (...)+ loop did not match anything at input 'WHEN' in rule "empty condition"</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，条件旨在为空，但单词<code>None</code>用来。通过删除此错误已解决<code>None</code> ，它不是有效的DRL关键字，数据类型或模式构造。</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="drl-rule-units-con_drl-rules"><a class="anchor" href="#drl-rule-units-con_drl-rules"></a> <a class="link" href="#drl-rule-units-con_drl-rules">4.1.12。DRL规则集中的规则单位</a></h4>
<div class="paragraph">
<p>规则单元是为特定目的共同起作用的数据源，全局变量和DRL规则的组。您可以使用规则单元将规则集划分为较小的单元，将不同的数据源绑定到这些单元，然后执行单个单元。规则单元是规则分组DRL属性（例如规则议程组或用于执行控制的激活组）的增强替代方案。</p>
</div>
<div class="paragraph">
<p>当您要协调规则执行时，规则单元会很有用，这样一个规则单元的完全执行会触发另一个规则单元的开始，依此类推。例如，假定您具有一组用于数据充实的规则，另一组用于处理该数据的规则以及另一组从已处理数据中提取输出的规则。如果将这些规则集添加到三个不同的规则单元中，则可以协调这些规则单元，以便第一个单元的完全执行触发第二个单元的开始，而第二个单元的完全执行触发第三个单元的开始。</p>
</div>
<div class="paragraph">
<p>要定义规则单元，请实施<code>RuleUnit</code>界面如下例所示：</p>
</div>
<div class="listingblock">
<div class="title">规则单位类示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.mypackage.myunit;

public static class AdultUnit implements RuleUnit {
    private int adultAge;
    private DataSource&lt;Person&gt; persons;

    public AdultUnit( ) { }

    public AdultUnit( DataSource&lt;Person&gt; persons, int age ) {
        this.persons = persons;
        this.age = age;
    }

    // A data source of `Persons` in this rule unit:
    public DataSource&lt;Person&gt; getPersons() {
        return persons;
    }

    // A global variable in this rule unit:
    public int getAdultAge() {
        return adultAge;
    }

    // Life-cycle methods:
    @Override
    public void onStart() {
        System.out.println("AdultUnit started.");
    }

    @Override
    public void onEnd() {
        System.out.println("AdultUnit ended.");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子中<code>persons</code>是类型事实的来源<code>Person</code> 。规则单元数据源是由给定规则单元处理的数据的源，并表示Drools引擎用来评估规则单元的入口点。的<code>adultAge</code>可以从属于该规则单元的所有规则访问全局变量。后两种方法是规则单元生命周期的一部分，由Drools引擎调用。</p>
</div>
<div class="paragraph">
<p>Drools引擎为规则单元支持以下可选的生命周期方法：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表13。规则单元生命周期方法</caption>
<colgroup>
<col style="width:50%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">方法</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">何时调用</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>onStart()</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">规则单元开始执行</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>onEnd()</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">规则单元执行结束</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>onSuspend()</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">规则单元执行被暂停（仅用于<code>runUntilHalt()</code> ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>onResume()</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">恢复执行规则单元（仅用于<code>runUntilHalt()</code> ）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>onYield(RuleUnit other)</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">规则单元中规则的结果触发另一个规则单元的执行</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>您可以将一个或多个规则添加到规则单元。默认情况下，DRL文件中的所有规则都将自动与遵循DRL文件名命名约定的规则单元相关联。如果DRL文件位于同一包中，并且与实现该文件的类具有相同的名称<code>RuleUnit</code>接口，则该DRL文件中的所有规则都隐式属于该规则单元。例如， <code>AdultUnit.drl</code>文件在<code>org.mypackage.myunit</code>包自动成为规则单元的一部分<code>org.mypackage.myunit.AdultUnit</code> 。</p>
</div>
<div class="paragraph">
<p>要覆盖此命名约定并明确声明DRL文件中的规则所属的规则单元，请使用<code>unit</code> DRL文件中的关键字。的<code>unit</code>声明必须紧随包声明之后，并包含该包中DRL文件中的规则所在的类的名称。</p>
</div>
<div class="listingblock">
<div class="title">DRL文件中的示例规则单位声明</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit AdultUnit

rule Adult
  when
    $p : Person(age &gt;= adultAge) from persons
  then
    System.out.println($p.getName() + " is adult and greater than " + adultAge);
end</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">不要在同一KIE库中混合使用规则单元和不使用规则单元的规则。在KIE基础中混合两个规则范例会导致编译错误。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>您还可以使用OOPath表示法以更方便的方式重写相同的模式，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">使用OOPath表示法的DRL文件中的示例规则单元声明</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit AdultUnit

rule Adult
  when
    $p : /persons[age &gt;= adultAge]
  then
    System.out.println($p.getName() + " is adult and greater than " + adultAge);
end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">OOPath是XPath的面向对象的语法扩展，旨在浏览DRL规则条件约束中的对象图。OOPath使用XPath的紧凑表示法在处理集合和过滤约束时浏览相关元素，尤其适用于对象图。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>在此示例中，规则条件中的所有匹配事实都将从<code>persons</code>在中定义的数据源<code>DataSource</code>规则单元类中的定义。规则条件和动作使用<code>adultAge</code>变量与在DRL文件级别定义全局变量的方式相同。</p>
</div>
<div class="paragraph">
<p>要执行在KIE库中定义的一个或多个规则单元，请创建一个新<code>RuleUnitExecutor</code>绑定到KIE基础的类，从相关数据源创建规则单元，然后运行规则单元执行程序：</p>
</div>
<div class="listingblock">
<div class="title">规则单位执行示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Create a `RuleUnitExecutor` class and bind it to the KIE base:
KieBase kbase = kieContainer.getKieBase();
RuleUnitExecutor executor = RuleUnitExecutor.create().bind( kbase );

// Create the `AdultUnit` rule unit using the `persons` data source and run the executor:
RuleUnit adultUnit = new AdultUnit(persons, 18);
executor.run( adultUnit );</code></pre>
</div>
</div>
<div class="paragraph">
<p>规则由<code>RuleUnitExecutor</code>类。的<code>RuleUnitExecutor</code>类创建KIE会话并添加所需的<code>DataSource</code>对象访问这些会话，然后根据<code>RuleUnit</code>作为参数传递给<code>run()</code>方法。</p>
</div>
<div class="paragraph">
<p>当相关时，示例执行代码将产生以下输出<code>Person</code>事实被插入<code>persons</code>数据源：</p>
</div>
<div class="listingblock">
<div class="title">规则单元执行输出示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>org.mypackage.myunit.AdultUnit started.
Jane is adult and greater than 18
John is adult and greater than 18
org.mypackage.myunit.AdultUnit ended.</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以在执行器中注册规则单元变量，然后将要运行的规则单元类传递给执行器，而不是显式创建规则单元实例，然后执行器创建规则单元的实例。然后，您可以设置<code>DataSource</code>运行规则单元之前，根据需要定义和其他变量。</p>
</div>
<div class="listingblock">
<div class="title">具有注册变量的备用规则单元执行选项</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">executor.bindVariable( "persons", persons );
        .bindVariable( "adultAge", 18 );
executor.run( AdultUnit.class );</code></pre>
</div>
</div>
<div class="paragraph">
<p>您传递给的名称<code>RuleUnitExecutor.bindVariable()</code>方法在运行时用于将变量绑定到具有相同名称的规则单元类的字段。在上一个示例中， <code>RuleUnitExecutor</code>将绑定到的数据源插入到新规则单元中<code>"persons"</code>命名并插入值<code>18</code>绑定到字符串<code>"adultAge"</code>进入具有相应名称的字段<code>AdultUnit</code>类。</p>
</div>
<div class="paragraph">
<p>要覆盖此默认的变量绑定行为，请使用<code>@UnitVar</code>注释，用于为规则单元类的每个字段显式定义逻辑绑定名称。例如，使用其他名称重新定义以下类中的字段绑定：</p>
</div>
<div class="listingblock">
<div class="title">使用以下代码修改变量绑定名称的示例代码<code>@UnitVar</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.mypackage.myunit;

public static class AdultUnit implements RuleUnit {
    @UnitVar("minAge")
    private int adultAge = 18;

    @UnitVar("data")
    private DataSource&lt;Person&gt; persons;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后，您可以使用这些备用名称将变量绑定到执行程序，并运行规则单元：</p>
</div>
<div class="listingblock">
<div class="title">具有修改的变量名称的示例规则单元执行</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">executor.bindVariable( "data", persons );
        .bindVariable( "minAge", 18 );
executor.run( AdultUnit.class );</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以通过以下<em>方式</em>在<em>被动模式下</em>执行规则单元： <code>run()</code>方法（相当于调用<code>fireAllRules()</code>在KIE会话上）或在<em>活动模式下</em>使用<code>runUntilHalt()</code>方法（相当于调用<code>fireUntilHalt()</code>在KIE会议上）。默认情况下，Drools引擎以<em>被动模式</em>运行，并且仅在用户或应用程序明确调用时评估规则单元<code>run()</code> （要么<code>fireAllRules()</code>对于标准规则）。如果用户或应用程序调用<code>runUntilHalt()</code>对于规则单位（或<code>fireUntilHalt()</code>对于标准规则），Drools引擎以<em>活动模式</em>启动并持续评估规则单元，直到用户或应用程序明确调用<code>halt()</code> 。</p>
</div>
<div class="paragraph">
<p>如果您使用<code>runUntilHalt()</code>方法，在单独的执行线程上调用该方法，以避免阻塞主线程：</p>
</div>
<div class="listingblock">
<div class="title">规则单元执行示例<code>runUntilHalt()</code>在单独的线程上</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">new Thread( () -&gt; executor.runUntilHalt( adultUnit ) ).start();</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_data_sources_for_rule_units_2"><a class="anchor" href="#_data_sources_for_rule_units_2"></a> <a class="link" href="#_data_sources_for_rule_units_2">4.1.12.1。规则单位的数据源</a></h5>
<div class="paragraph">
<p>规则单元数据源是由给定规则单元处理的数据的源，并表示Drools引擎用来评估规则单元的入口点。规则单位可以有零个或多个数据源，每个<code>DataSource</code>在规则单元内声明的定义可以对应于规则单元执行程序的另一个入口点。多个规则单元可以共享一个数据源，但是每个规则单元必须使用不同的入口点来插入相同的对象。</p>
</div>
<div class="paragraph">
<p>您可以创建一个<code>DataSource</code>规则单元类中具有一组固定数据的定义，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">数据源定义示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DataSource&lt;Person&gt; persons = DataSource.create( new Person( "John", 42 ),
                                                new Person( "Jane", 44 ),
                                                new Person( "Sally", 4 ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>因为数据源代表规则单元的入口点，所以您可以在规则单元中插入，更新或删除事实：</p>
</div>
<div class="listingblock">
<div class="title">在规则单元中插入，修改和删除事实的示例代码</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Insert a fact:
Person john = new Person( "John", 42 );
FactHandle johnFh = persons.insert( john );

// Modify the fact and optionally specify modified properties (for property reactivity):
john.setAge( 43 );
persons.update( johnFh, john, "age" );

// Delete the fact:
persons.delete( johnFh );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rule_unit_execution_control_2"><a class="anchor" href="#_rule_unit_execution_control_2"></a> <a class="link" href="#_rule_unit_execution_control_2">4.1.12.2。规则单元执行控制</a></h5>
<div class="paragraph">
<p>当您要协调规则执行时，规则单元会很有用，这样一个规则单元的执行会触发另一个规则单元的启动，依此类推。</p>
</div>
<div class="paragraph">
<p>为了促进规则单元执行控制，Drools引擎支持以下规则单元方法，您可以在DRL规则操作中使用这些方法来协调规则单元的执行：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>drools.run()</code> ：触发指定规则单元类的执行。此方法必须中断规则单元的执行并激活其他指定的规则单元。</p>
</li>
<li>
<p><code>drools.guard()</code> ：防止（保护）指定规则单元类的执行，直到满足关联的规则条件为止。此方法以声明方式调度其他指定规则单元的执行。当Drools引擎针对防护规则中的条件产生至少一个匹配项时，该防护规则单元被认为是活动的。一个规则单元可以包含多个保护规则。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>作为一个例子<code>drools.run()</code>方法，请考虑以下DRL规则，每个规则均属于指定的规则单元。的<code>NotAdult</code>规则使用<code>drools.run( AdultUnit.class )</code>触发执行的方法<code>AdultUnit</code>规则单位：</p>
</div>
<div class="listingblock">
<div class="title">使用控制执行的示例DRL规则<code>drools.run()</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit AdultUnit

rule Adult
  when
    Person(age &gt;= 18, $name : name) from persons
  then
    System.out.println($name + " is adult");
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit NotAdultUnit

rule NotAdult
  when
    $p : Person(age &lt; 18, $name : name) from persons
  then
    System.out.println($name + " is NOT adult");
    modify($p) { setAge(18); }
    drools.run( AdultUnit.class );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>该示例还使用了<code>RuleUnitExecutor</code>从KIE基础创建的课程，这些基础是根据这些规则和<code>DataSource</code>的定义<code>persons</code>绑定到它：</p>
</div>
<div class="listingblock">
<div class="title">示例规则执行器和数据源定义</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RuleUnitExecutor executor = RuleUnitExecutor.create().bind( kbase );
DataSource&lt;Person&gt; persons = executor.newDataSource( "persons",
                                                     new Person( "John", 42 ),
                                                     new Person( "Jane", 44 ),
                                                     new Person( "Sally", 4 ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，示例将创建<code>DataSource</code>直接从<code>RuleUnitExecutor</code>类并将其绑定到<code>"persons"</code>单个语句中的变量。</p>
</div>
<div class="paragraph">
<p>当相关时，示例执行代码将产生以下输出<code>Person</code>事实被插入<code>persons</code>数据源：</p>
</div>
<div class="listingblock">
<div class="title">规则单元执行输出示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>Sally is NOT adult
John is adult
Jane is adult
Sally is adult</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>NotAdult</code>评估人时，规则会检测到匹配项<code>"Sally"</code> ，未满18岁。然后，该规则将她的年龄修改为<code>18</code>并使用<code>drools.run( AdultUnit.class )</code>触发执行的方法<code>AdultUnit</code>规则单位。的<code>AdultUnit</code>规则单元包含一个规则，现在可以对这3个规则全部执行<code>persons</code>在里面<code>DataSource</code>定义。</p>
</div>
<div class="paragraph">
<p>作为一个例子<code>drools.guard()</code>方法，请考虑以下<code>BoxOffice</code>类和<code>BoxOfficeUnit</code>规则单元类别：</p>
</div>
<div class="listingblock">
<div class="title">例<code>BoxOffice</code>类</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class BoxOffice {
    private boolean open;

    public BoxOffice( boolean open ) {
        this.open = open;
    }

    public boolean isOpen() {
        return open;
    }

    public void setOpen( boolean open ) {
        this.open = open;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">例<code>BoxOfficeUnit</code>规则单元类</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class BoxOfficeUnit implements RuleUnit {
    private DataSource&lt;BoxOffice&gt; boxOffices;

    public DataSource&lt;BoxOffice&gt; getBoxOffices() {
        return boxOffices;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该示例还使用以下内容<code>TicketIssuerUnit</code>规则单位的类别，只要至少打开一个票房，就可以继续出售该活动的票房。该规则单元使用<code>DataSource</code>的定义<code>persons</code>和<code>tickets</code> ：</p>
</div>
<div class="listingblock">
<div class="title">例<code>TicketIssuerUnit</code>规则单元类</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class TicketIssuerUnit implements RuleUnit {
    private DataSource&lt;Person&gt; persons;
    private DataSource&lt;AdultTicket&gt; tickets;

    private List&lt;String&gt; results;

    public TicketIssuerUnit() { }

    public TicketIssuerUnit( DataSource&lt;Person&gt; persons, DataSource&lt;AdultTicket&gt; tickets ) {
        this.persons = persons;
        this.tickets = tickets;
    }

    public DataSource&lt;Person&gt; getPersons() {
        return persons;
    }

    public DataSource&lt;AdultTicket&gt; getTickets() {
        return tickets;
    }

    public List&lt;String&gt; getResults() {
        return results;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>BoxOfficeUnit</code>规则单元包含一个<code>BoxOfficeIsOpen</code> DRL规则使用<code>drools.guard( TicketIssuerUnit.class )</code>防止执行的方法<code>TicketIssuerUnit</code>分发事件票证的规则单元，如以下DRL规则示例所示：</p>
</div>
<div class="listingblock">
<div class="title">使用控制执行的示例DRL规则<code>drools.guard()</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit;
unit TicketIssuerUnit;

rule IssueAdultTicket when
    $p: /persons[ age &gt;= 18 ]
then
    tickets.insert(new AdultTicket($p));
end
rule RegisterAdultTicket when
    $t: /tickets
then
    results.add( $t.getPerson().getName() );
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit;
unit BoxOfficeUnit;

rule BoxOfficeIsOpen
  when
    $box: /boxOffices[ open ]
  then
    drools.guard( TicketIssuerUnit.class );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，只要至少有一个票房<code>open</code> ，守卫<code>TicketIssuerUnit</code>规则单元处于活动状态并分发事件票证。当没有更多的票房<code>open</code>国家，守卫<code>TicketIssuerUnit</code>阻止执行规则单元。</p>
</div>
<div class="paragraph">
<p>以下示例类说明了更完整的票房情况：</p>
</div>
<div class="listingblock">
<div class="title">票房场景的示例类</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DataSource&lt;Person&gt; persons = executor.newDataSource( "persons" );
DataSource&lt;BoxOffice&gt; boxOffices = executor.newDataSource( "boxOffices" );
DataSource&lt;AdultTicket&gt; tickets = executor.newDataSource( "tickets" );

List&lt;String&gt; list = new ArrayList&lt;&gt;();
executor.bindVariable( "results", list );

// Two box offices are open:
BoxOffice office1 = new BoxOffice(true);
FactHandle officeFH1 = boxOffices.insert( office1 );
BoxOffice office2 = new BoxOffice(true);
FactHandle officeFH2 = boxOffices.insert( office2 );

persons.insert(new Person("John", 40));

// Execute `BoxOfficeIsOpen` rule, run `TicketIssuerUnit` rule unit, and execute `RegisterAdultTicket` rule:
executor.run(BoxOfficeUnit.class);

assertEquals( 1, list.size() );
assertEquals( "John", list.get(0) );
list.clear();

persons.insert(new Person("Matteo", 30));

// Execute `RegisterAdultTicket` rule:
executor.run(BoxOfficeUnit.class);

assertEquals( 1, list.size() );
assertEquals( "Matteo", list.get(0) );
list.clear();

// One box office is closed, the other is open:
office1.setOpen(false);
boxOffices.update(officeFH1, office1);
persons.insert(new Person("Mark", 35));
executor.run(BoxOfficeUnit.class);

assertEquals( 1, list.size() );
assertEquals( "Mark", list.get(0) );
list.clear();

// All box offices are closed:
office2.setOpen(false);
boxOffices.update(officeFH2, office2); // Guarding rule is no longer true.
persons.insert(new Person("Edson", 35));
executor.run(BoxOfficeUnit.class); // No execution

assertEquals( 0, list.size() );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rule_unit_identity_conflicts_2"><a class="anchor" href="#_rule_unit_identity_conflicts_2"></a> <a class="link" href="#_rule_unit_identity_conflicts_2">4.1.12.3。规则单位身份冲突</a></h5>
<div class="paragraph">
<p>在具有受保护规则单元的规则单元执行方案中，一个规则可以保护多个规则单元，并且可以同时保护一个规则单元，然后由多个规则激活。对于这些双向保护方案，规则单元必须具有明确定义的身份，以避免身份冲突。</p>
</div>
<div class="paragraph">
<p>默认情况下，规则单元的标识是规则单元类的名称，并且被规则单元视为单例类。 <code>RuleUnitExecutor</code> 。此识别行为编码在<code>getUnitIdentity()</code>的默认方法<code>RuleUnit</code>接口：</p>
</div>
<div class="listingblock">
<div class="title">中的默认身份方法<code>RuleUnit</code>接口</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">default Identity getUnitIdentity() {
    return new Identity( getClass() );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在某些情况下，您可能需要覆盖此默认标识行为，以避免规则单元之间的标识冲突。</p>
</div>
<div class="paragraph">
<p>例如，以下<code>RuleUnit</code>类包含一个<code>DataSource</code>接受任何对象的定义：</p>
</div>
<div class="listingblock">
<div class="title">例<code>Unit0</code>规则单元类</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Unit0 implements RuleUnit {
    private DataSource&lt;Object&gt; input;

    public DataSource&lt;Object&gt; getInput() {
        return input;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>此规则单元包含以下DRL规则，该规则基于两个条件（以OOPath表示法）保护另一个规则单元：</p>
</div>
<div class="listingblock">
<div class="title">例<code>GuardAgeCheck</code>规则单元中的DRL规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit Unit0

rule GuardAgeCheck
  when
    $i: /input#Integer
    $s: /input#String
  then
    drools.guard( new AgeCheckUnit($i) );
    drools.guard( new AgeCheckUnit($s.length()) );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>守卫<code>AgeCheckUnit</code>规则单元验证一组<code>persons</code> 。的<code>AgeCheckUnit</code>包含一个<code>DataSource</code>的定义<code>persons</code>检查，一个<code>minAge</code>验证所针对的变量，以及<code>List</code>用于收集结果：</p>
</div>
<div class="listingblock">
<div class="title">例<code>AgeCheckUnit</code>规则单位</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AgeCheckUnit implements RuleUnit {
    private final int minAge;
    private DataSource&lt;Person&gt; persons;
    private List&lt;String&gt; results;

    public AgeCheckUnit( int minAge ) {
        this.minAge = minAge;
    }

    public DataSource&lt;Person&gt; getPersons() {
        return persons;
    }

    public int getMinAge() {
        return minAge;
    }

    public List&lt;String&gt; getResults() {
        return results;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>AgeCheckUnit</code>规则单元包含以下DRL规则，用于对<code>persons</code>在数据源中：</p>
</div>
<div class="listingblock">
<div class="title">例<code>CheckAge</code>规则单元中的DRL规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mypackage.myunit
unit AgeCheckUnit

rule CheckAge
  when
    $p : /persons{ age &gt; minAge }
  then
    results.add($p.getName() + "&gt;" + minAge);
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>本示例创建一个<code>RuleUnitExecutor</code>类，将该类绑定到包含这两个规则单元的KIE基础，并创建两个<code>DataSource</code>相同规则单位的定义：</p>
</div>
<div class="listingblock">
<div class="title">执行程序和数据源定义示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RuleUnitExecutor executor = RuleUnitExecutor.create().bind( kbase );

DataSource&lt;Object&gt; input = executor.newDataSource( "input" );
DataSource&lt;Person&gt; persons = executor.newDataSource( "persons",
                                                     new Person( "John", 42 ),
                                                     new Person( "Sally", 4 ) );

List&lt;String&gt; results = new ArrayList&lt;&gt;();
executor.bindVariable( "results", results );</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在，您可以将一些对象插入输入数据源并执行<code>Unit0</code>规则单位：</p>
</div>
<div class="listingblock">
<div class="title">带有插入对象的示例规则单元执行</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ds.insert("test");
ds.insert(3);
ds.insert(4);
executor.run(Unit0.class);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">执行中的示例结果列表</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">[Sally&gt;3, John&gt;3]</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，规则单元名为<code>AgeCheckUnit</code>被视为单例类，然后仅执行一次， <code>minAge</code>变量设置为<code>3</code> 。既弦乐<code>"test"</code>和整数<code>4</code>插入到输入数据源中还可以使用<code>minAge</code>变量设置为<code>4</code> 。但是，不会执行第二次执行，因为已经评估了另一个具有相同标识的规则单元。</p>
</div>
<div class="paragraph">
<p>要解决此规则单元身份冲突，请覆盖<code>getUnitIdentity()</code>中的方法<code>AgeCheckUnit</code>类还包括<code>minAge</code>规则单位标识中的变量：</p>
</div>
<div class="listingblock">
<div class="title">改性<code>AgeCheckUnit</code>规则单元来覆盖<code>getUnitIdentity()</code>方法</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class AgeCheckUnit implements RuleUnit {

    ...

    @Override
    public Identity getUnitIdentity() {
        return new Identity(getClass(), minAge);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>有了此覆盖后，先前的示例规则单元执行将产生以下输出：</p>
</div>
<div class="listingblock">
<div class="title">执行修改后的规则单元的示例结果列表</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">[John&gt;4, Sally&gt;3, John&gt;3]</code></pre>
</div>
</div>
<div class="paragraph">
<p>规则单位<code>minAge</code>调成<code>3</code>和<code>4</code>现在被认为是两个不同的规则单元，并且都被执行。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="performance-tuning-drl-ref_drl-rules"><a class="anchor" href="#performance-tuning-drl-ref_drl-rules"></a> <a class="link" href="#performance-tuning-drl-ref_drl-rules">4.1.13。DRL的性能调整注意事项</a></h4>
<div class="paragraph">
<p>以下关键概念或建议做法可帮助您优化DRL规则和Drools引擎性能。为了方便起见，在本节中汇总了这些概念，并在适用的情况下在交叉引用的文档中进行了详细说明。新版本的Drools将根据需要扩展或更改此部分。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">从左到右定义模式约束的属性和值</dt>
<dd>
<p>在DRL模式约束中，请确保事实属性名称在运算符的左侧，并且值（常量或变量）在右侧。属性名称必须始终是索引中的键，而不是值。例如，写<code>Person( firstName == "John" )</code>代替<code>Person( "John" == firstName )</code> 。从右到左定义约束属性和值可能会影响Drools引擎的性能。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>有关DRL模式和约束的更多信息，请参见<a href="#drl-rules-WHEN-con_drl-rules">DRL（WHEN）中的规则条件</a> 。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">首先列出限制性最强的规则条件</dt>
<dd>
<p>对于具有多个条件的规则，请列出从最高到最低限制的条件，这样，如果不满足更多限制条件，则Drools引擎可以避免评估整个条件集。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例如，以下条件是旅行预订规则的一部分，该规则对同时预订机票和酒店的旅行者实行折扣。在这种情况下，客户很少会预订有航班的酒店来获得此折扣，因此很少满足酒店条件并且很少执行规则。因此，第一条件排序更为有效，因为它可以防止Drools引擎在不满足酒店条件时频繁且不必要地评估飞行条件。</p>
</div>
<div class="listingblock">
<div class="title">首选条件订单：酒店和机票</div>
<div class="content">
<pre class="highlightjs highlight"><code>when
  $h:hotel() // Rarely booked
  $f:flight()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">无效条件顺序：航班和酒店</div>
<div class="content">
<pre class="highlightjs highlight"><code>when
  $f:flight()
  $h:hotel() // Rarely booked</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关DRL模式和约束的更多信息，请参见<a href="#drl-rules-WHEN-con_drl-rules">DRL（WHEN）中的规则条件</a> 。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">避免过多地迭代大量对象<code>from</code>条款</dt>
<dd>
<p>避免使用<code>from</code> DRL规则中的condition元素用于遍历大量对象，如以下示例所示：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">条件示例<code>from</code>条款</div>
<div class="content">
<pre class="highlightjs highlight"><code>when
  $c: Company()
  $e : Employee ( salary &gt; 100000.00) from $c.employees</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，每次对规则条件进行评估时，Drools引擎都会在大型图形上进行迭代，并阻碍规则评估。</p>
</div>
<div class="paragraph">
<p>或者，不添加带有Drools引擎必须频繁迭代的大图的对象，而是将集合直接添加到KIE会话，然后按条件加入集合，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="title">没有条件的示例条件<code>from</code>条款</div>
<div class="content">
<pre class="highlightjs highlight"><code>when
  $c: Company();
  Employee (salary &gt; 100000.00, company == $c)</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，Drools引擎仅对列表进行一次迭代，并且可以更有效地评估规则。</p>
</div>
<div class="paragraph">
<p>有关的更多信息<code>from</code>元素或其他DRL条件元素，请参阅<a href="#drl-rules-WHEN-elements-ref_drl-rules">DRL（关键字）中支持的规则条件元素</a> 。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">使用Drools引擎事件监听器代替<code>System.out.println</code>调试日志记录规则中的语句</dt>
<dd>
<p>您可以使用<code>System.out.println</code>规则操作中的语句用于调试日志记录和控制台输出，但是对许多规则执行此操作会阻碍规则评估。作为更有效的替代方法，请尽可能使用内置的Drools引擎事件监听器。如果这些侦听器不满足您的要求，请使用Drools引擎支持的系统日志记录实用程序，例如Logback，Apache Commons Logging或Apache Log4j。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>有关受支持的Drools引擎事件侦听器和日志记录实用程序的更多信息，请参阅<a href="#engine-event-listeners-con_decision-engine">Drools引擎事件侦听器和调试日志记录</a> 。</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_domain_specific_languages"><a class="anchor" href="#_domain_specific_languages"></a> <a class="link" href="#_domain_specific_languages">4.2。领域特定语言</a></h3>
<div class="paragraph">
<p>域特定语言（或DSL）是一种创建专用于您的问题域的规则语言的方法。一组DSL定义包括从DSL“语句”到DRL结构的转换，这使您可以使用所有潜在的规则语言和引擎功能。在给定DSL的情况下，您可以在DSL规则（或DSLR）文件中编写规则，然后将其转换为DRL文件。</p>
</div>
<div class="paragraph">
<p>DSL和DSLR文件是纯文本文件，您可以使用任何文本编辑器来创建和修改它们。但是，IDE和基于Web的BRMS中也都有DSL和DSLR编辑器，尽管它们可能无法为您提供完整的DSL功能，但您也可以使用它们。</p>
</div>
<div class="sect3">
<h4 id="_when_to_use_a_dsl"><a class="anchor" href="#_when_to_use_a_dsl"></a> <a class="link" href="#_when_to_use_a_dsl">4.2.1。何时使用DSL</a></h4>
<div class="paragraph">
<p>DSL可以充当规则创作（和规则创作者）与域对象建模以及Drools引擎的本地语言和方法所导致的技术复杂性之间的隔离层。如果非程序员的领域专家（例如，业务分析师）需要阅读和验证您的规则，则应考虑使用DSL。它隐藏了实现细节，并专注于适当的规则逻辑。DSL语句还可以用作条件元素和结果操作的“模板”，这些条件元素和结果操作在规则中重复使用，可能会有微小的变化。您可以将DSL句子定义为映射到这些重复的短语，并使用参数来提供适应这些变化的方式。</p>
</div>
<div class="paragraph">
<p>DSL在运行时对Drools引擎没有影响，它们只是编译时功能，需要特殊的解析器和转换器。</p>
</div>
</div>
<div class="sect3">
<h4 id="_dsl_basics"><a class="anchor" href="#_dsl_basics"></a> <a class="link" href="#_dsl_basics">4.2.2。DSL基础</a></h4>
<div class="paragraph">
<p>Drools DSL机制允许您自定义条件表达式和结果操作。全局替换机制（“关键字”）也可用。</p>
</div>
<div class="exampleblock">
<div class="title">示例64。DSL映射示例</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[when]Something is {colour}=Something(colour=="{colour}")</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>在前面的示例中， <code>[when]</code>指示表达式的范围，即，它对于规则的LHS还是RHS有效。方括号关键字之后的部分是您在规则中使用的表达式；通常是自然语言表达，但不一定必须如此。等号（“ =”）右边的部分是表达式到规则语言的映射。该字符串的形式取决于其目的地RHS或LHS。如果是用于LHS，则应该是按照常规LHS语法的术语。如果用于RHS，则可能是Java语句。</p>
</div>
<div class="paragraph">
<p>每当DSL解析器将DSL中写入的规则文件中的一行与DSL定义中的表达式匹配时，它就会执行三个字符串操作步骤。首先，它提取出现在表达式中包含大括号的变量名的字符串值（此处： <code>{colour}</code> ）。然后，将从这些捕获获得的值进行插值，直到该名称（再次用大括号括起来）出现在映射的右侧。最后，内插字符串替换DSL规则文件行中整个表达式所匹配的内容。</p>
</div>
<div class="paragraph">
<p>请注意，表达式（即，等号左侧的字符串）在针对DSL规则文件的一行的模式匹配操作中用作正则表达式，与一行的全部或部分匹配。这意味着您可以（例如）使用'？'表示前面的字符是可选的。使用此功能的一个很好的理由是要克服DSL自然语言短语的变化。但是，由于这些表达式是正则表达式模式，因此这也意味着必须用前面的反斜杠（'\'）来转义Java模式语法的所有“魔术”字符。</p>
</div>
<div class="paragraph">
<p>重要的是要注意，编译器逐行转换DSL规则文件。在上面的示例中，“ Something is”之后到行尾的所有文本均被捕获为“ {colour}”的替换值，并用于插值目标字符串。这可能不完全是您想要的。例如，当您打算合并不同的DSL表达式以生成复合DRL模式时，您需要通过几个独立的操作来转换DSLR线路。实现此目的的最佳方法是确保捕获内容被特征性文本（单词或单个字符）包围。结果，解析器完成的匹配操作从该行中的某处拔出了子字符串。在下面的示例中，引号用作特殊字符。请注意，插值过程中不包括捕获周围的字符，只是它们之间的内容。</p>
</div>
<div class="paragraph">
<p>根据经验，对规则编辑器可能要输入的文本数据使用引号。您也可以用文字将捕获内容括起来，以确保文本正确匹配。以下示例说明了两者。请注意，单行例如<code>Something is "green" and another solid thing</code>现在已正确展开。</p>
</div>
<div class="exampleblock">
<div class="title">示例65。带引号的示例</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[when]something is "{colour}"=Something(colour=="{colour}")
[when]another {state} thing=OtherThing(state=="{state})"</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>最好避免DSL表达式中出现标点符号（引号或撇号除外）。主要原因是使用DSL的规则作者容易忘记标点符号。另一个原因是括号，句号和问号是魔术字符，需要转义DSL定义。</p>
</div>
<div class="paragraph">
<p>在DSL映射中，大括号“ {”和“}”仅应用于封装变量定义或引用，以进行捕获。如果它们应在字面上出现，无论是在表达式中还是在右侧的替换文本中，都必须使用前面的反斜杠（“ \”）进行转义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[then]do something= if (foo) \{ doSomething(); \}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果括号“ {”和“}”应出现在DSL定义的替换字符串中，请用反斜杠（'\'）对其进行转义。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="exampleblock">
<div class="title">例子66。DSL映射条目示例</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># This is a comment to be ignored.
[when]There is a person with name of "{name}"=Person(name=="{name}")
[when]Person is at least {age} years old and lives in "{location}"=
      Person(age &gt;= {age}, location=="{location}")
[then]Log "{message}"=System.out.println("{message}");
[when]And = and</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>给定上述DSL示例，以下示例显示了各种DSLR片段的扩展：</p>
</div>
<div class="exampleblock">
<div class="title">例子67。DSL扩展示例</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>There is a person with name of "Kitty"
   ==&gt; Person(name="Kitty")
Person is at least 42 years old and lives in "Atlanta"
   ==&gt; Person(age &gt;= 42, location="Atlanta")
Log "boo"
   ==&gt; System.out.println("boo");
There is a person with name of "Bob" And Person is at least 30 years old and lives in "Utah"
   ==&gt; Person(name="Bob") and Person(age &gt;= 30, location="Utah")</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>不要忘记，如果要从DSL规则行捕获纯文本，并想在扩展中将其用作字符串文字，则必须在映射的右侧提供引号。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>您可以将DSL表达式链接在一起，只要解析器可以清楚地知道DSL表达式的结束位置和下一句开始的位置以及表示参数的文本的结束位置。（否则，您将冒着将所有文本直到行尾作为参数值的风险。）根据DSL定义文件中的顺序依次尝试DSL表达式。进行任何匹配后，还将调查所有剩余的DSL表达式。</p>
</div>
<div class="paragraph">
<p>生成的DRL文本可能包含多行。行尾在替换文本中写为<code>\n</code> 。</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_constraints_to_facts"><a class="anchor" href="#_adding_constraints_to_facts"></a> <a class="link" href="#_adding_constraints_to_facts">4.2.3。向事实添加约束</a></h4>
<div class="paragraph">
<p>编写规则条件时的一个常见要求是能够向模式添加约束的任意组合。考虑到事实类型可能具有许多字段，必须为每种组合提供单独的DSL语句将是愚蠢的。</p>
</div>
<div class="paragraph">
<p>DSL功能允许您通过简单的约定将约束添加到模式：如果DSL表达式以连字符（减号“-”）开头，则假定它是字段约束，因此被添加到最后一个前面的图案线。</p>
</div>
<div class="paragraph">
<p>例如，让我们看一下课程<code>Cheese</code> ，其中包含以下字段：类型，价格，年龄和国家/地区。我们可以在正常DRL中表达一些LHS条件，如下所示</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Cheese(age &lt; 5, price == 20, type=="stilton", country=="ch")</code></pre>
</div>
</div>
<div class="paragraph">
<p>下面给出的DSL定义产生了三个DSL短语，可用于创建涉及这些字段的约束的任何组合。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[when]There is a Cheese with=Cheese()
[when]- age is less than {age}=age&lt;{age}
[when]- type is '{type}'=type=='{type}'
[when]- country equal to '{country}'=country=='{country}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后，您可以使用以下条件编写规则：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>There is a Cheese with
        - age is less than 42
        - type is 'stilton'</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> The parser will pick up a line beginning with "-" and add it as a constraint to  the preceding pattern, inserting a comma when it is required.
For the preceding example, the resulting DRL is:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Cheese(age&lt;42, type=='stilton')</code></pre>
</div>
</div>
<div class="paragraph">
<p>将所有数字字段与所有关系运算符组合在一起（根据上一示例中的DSL表达式“ age小于...”），将产生大量的DSL条目。但是，您可以为各种运算符甚至是处理任何字段约束的通用表达式定义DSL短语，如下所示。（请注意，表达式定义除变量名外还包含正则表达式。）</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[when][]is less than or equal to=&lt;=
[when][]is less than=&lt;
[when][]is greater than or equal to=&gt;=
[when][]is greater than=&gt;
[when][]is equal to===
[when][]equals===
[when][]There is a Cheese with=Cheese()
[when][]- {field:\w*} {operator} {value:\d*}={field} {operator} {value}</code></pre>
</div>
</div>
<div class="paragraph">
<p>给定这些DSL定义，您可以使用以下条件编写规则：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>There is a Cheese with
   - age is less than 42
   - rating is greater than 50
   - type equals 'stilton'</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种特定情况下，用“小于”等短语替换为<code><</code> ，然后该行与最后一个DSL条目匹配。这样可以除去连字符，但最终结果仍作为约束添加到前面的模式中。处理完所有行后，得到的DRL文本为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Cheese(age&lt;42, rating &gt; 50, type=='stilton')</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果要使单独的DSL表达式一个接一个地匹配同一行，则DSL中条目的顺序很重要。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_developing_a_dsl"><a class="anchor" href="#_developing_a_dsl"></a> <a class="link" href="#_developing_a_dsl">4.2.4。开发DSL</a></h4>
<div class="paragraph">
<p>一个很好的入门方法是编写应用程序所需规则的代表性示例，并在开发时对其进行测试。这将为您提供条件元素及其约束的稳定框架。DRL和DSLR中的规则都是根据表示代表应遵循规则中定义的推理过程的应用程序数据的数据模型来指代实体。注意，如果大多数数据模型的类型都是事实，那么编写规则通常会更容易。</p>
</div>
<div class="paragraph">
<p>给定初始规则集，应该可以识别重复出现的代码段或相似的代码段，并将可变部分标记为参数。这为可能是方便的DSL条目提供了可靠的线索。另外，请确保您充分了解域专家正在使用的术语，并根据此词汇表来使用DSL短语。</p>
</div>
<div class="paragraph">
<p>您可以通过在第一个设计阶段中将某些条件元素和操作以DRL形式保留，并在其前面加上一个大号（“>”）来延迟有关条件和操作的实现决策。（这对于插入调试语句也很方便。）</p>
</div>
<div class="paragraph">
<p>在下一个开发阶段，您应该发现DSL配置可以很快稳定下来。可以通过重用现有的DSL定义或将参数添加到现有条件或结果条目来编写新规则。</p>
</div>
<div class="paragraph">
<p>尝试使DSL条目的数量保持较小。使用参数可以将相同的DSL语句应用于相似的规则模式或约束。但是请不要夸张：使用DSL的作者仍然应该能够通过某些固定文本来识别DSL短语。</p>
</div>
</div>
<div class="sect3">
<h4 id="_dsl_and_dslr_reference"><a class="anchor" href="#_dsl_and_dslr_reference"></a> <a class="link" href="#_dsl_and_dslr_reference">4.2.5。DSL和DSLR参考</a></h4>
<div class="paragraph">
<p>DSL文件是面向行格式的文本文件。它的条目用于根据DRL语法将DSLR文件转换为文件。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>以“ <mark> ”或“ //”（带或不带空格）被视为注释。 以“ </mark> /“被扫描以查找要求调试选项的单词，请参见下文。</p>
</li>
<li>
<p>任何以左方括号（“ [”）开头的行均被视为DSL条目定义的第一行。</p>
</li>
<li>
<p>任何其他行都将附加到前面的DSL条目定义中，并且该行的末尾用空格代替。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>DSL条目包括以下四个部分：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>范围定义，用关键词“ when”或“ condition”，“ then”或“ consequence”，“ *”和“ keyword”之一括在方括号（“ [”和“]”）中。这表明DSL条目对于条件或规则结果是否有效，或两者均有效。作用域指示“关键字”表示该条目具有全局重要性，即，它在DSLR文件中的任何位置都可以识别。</p>
</li>
<li>
<p>用Java类名编写的类型定义，括在方括号中。这部分是可选的，除非下一部分以左方括号开头。一个空的方括号也有效。</p>
</li>
<li>
<p>DSL表达式由（Java）正则表达式组成，该正则表达式具有任意数量的嵌入<em>变量定义，</em>并以等号（“ =”）结尾。变量定义用大括号（“ {”和“}”）括起来。它由变量名和两个可选的附件组成，并用冒号（“：”）分隔。如果有一个附件，则它是一个正则表达式，用于匹配要分配给变量的文本。如果有两个附件，则第一个是GUI编辑器的提示，第二个是正则表达式。</p>
<div class="paragraph">
<p>请注意，如果正则表达式中的所有“魔术”字符都应出现在表达式中，则必须使用反斜杠（“ \”）对其进行转义。</p>
</div>
</li>
<li>
<p>在等号后的行的其余部分是与正则表达式匹配的所有DSLR文本的替换文本。它可能包含变量引用，即用大括号括起来的变量名称。（可选）变量名后可以带有感叹号（“！”“）和转换函数，请参见下文。</p>
<div class="paragraph">
<p>请注意，如果大括号（“ {”和“}”）在字面上出现在替换字符串中，则必须使用反斜杠（“ \”）进行转义。</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>通过使用以“＃/”开头的注释行（可以包含下表中的一个或多个单词），可以有选择地打开DSL扩展的调试。结果输出将写入标准输出。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表14。DSL扩展的调试选项</caption>
<colgroup>
<col style="width:50%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">字</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">结果</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">打印带有行号的结果DRL文本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">脚步</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">打印条件和结果行的每个扩展步骤。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">关键词</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">转储具有范围“关键字”的所有DSL条目的内部表示。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">什么时候</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">转储范围为“ when”或“ *”的所有DSL条目的内部表示。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">然后</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">转储范围为“ then”或“ *”的所有DSL条目的内部表示。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用法</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">显示所有DSL条目的使用情况统计信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>下面是一些DSL定义示例，其中的注释描述了它们说明的语言功能。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># Comment: DSL examples

#/ debug: display result and usage

# keyword definition: replaces "regula" by "rule"
[keyword][]regula=rule

# conditional element: "T" or "t", "a" or "an", convert matched word
[when][][Tt]here is an? {entity:\w+}=
        ${entity!lc}: {entity!ucfirst} ()

# consequence statement: convert matched word, literal braces
[then][]update {entity:\w+}=modify( ${entity!lc} )\{ \}</code></pre>
</div>
</div>
<div class="paragraph">
<p>DSLR文件的转换过程如下：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>文本被读入内存。</p>
</li>
<li>
<p>每个“关键字”条目都应用于整个文本。首先，通过以下方式修改关键字定义的正则表达式：用匹配任意数量的空格字符的模式替换空白序列，并用由定义所提供的正则表达式或默认值（ ”。*？”）。然后，在DSLR文本中详尽搜索与匹配的正则表达式匹配的字符串的出现。提取与变量捕获对应的匹配字符串的子字符串，并替换相应替换文本中的变量引用，并且此文本替换DSLR文本中的匹配字符串。</p>
</li>
<li>
<p>如下所述，分别以统一的方式逐行定位和处理DSLR文本中“何时”和“然后”，“然后”和“结束”之间的部分。</p>
<div class="paragraph">
<p>对于一条线路，与线路部分有关的每个DSL条目都按照在DSL文件中出现的顺序依次获取。修改了它的正则表达式部分：用匹配任意数量空格字符的模式替换空格；具有正则表达式的变量定义将被具有该正则表达式的捕获所替代，其默认值为“。*？”。如果结果正则表达式与行的全部或部分匹配，则将匹配的部分替换为适当修改的替换文本。</p>
</div>
<div class="paragraph">
<p>通过用对应于正则表达式捕获的文本替换变量引用来完成替换文本的修改。可以根据变量参考中提供的字符串转换函数来修改此文本；有关详情，请参见下文。</p>
</div>
<div class="paragraph">
<p>如果在同一条目中有一个变量引用命名未定义的变量，则扩展器将替换绑定到该名称的变量的值，前提是该变量是在当前规则的前几行中定义的。</p>
</div>
</li>
<li>
<p>如果条件中的DSLR行写有前导连字符，则将扩展结果插入到最后一行，该行应包含模式CE，即类型名称后跟一对括号。如果该对为空，则仅插入扩展行（应包含有效约束），否则将事先插入逗号（“，”）。</p>
<div class="paragraph">
<p>如果结果中的DSLR行写有前导连字符，则扩展结果将插入到最后一行，该行应包含“ modify”语句，并以一对大括号（“ {”和“}”）结尾。如果该对为空，则仅插入扩展行（应包含有效的方法调用），否则将事先插入逗号（“，”）。</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>这是目前<em>无法</em>使用符合领先的连字符插入文字等条件元素形式（例如，“收集”），也可以只用第一插入操作（例如，“EVAL”）。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>下表描述了所有字符串转换函数。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表15。字符串转换功能</caption>
<colgroup>
<col style="width:50%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">名称</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">uc</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">将所有字母转换为大写。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">lc</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">将所有字母转换为小写。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">ucfirst</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">将第一个字母转换为大写，并将所有其他字母转换为小写。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">数</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">从字符串中提取所有数字和“-”。如果原始字符串的最后两位数字以“。”开头。或“，”，在相应位置插入一个小数点。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><em>一个</em> ？<em>b</em> / <em>c</em></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">将字符串与字符串<em>a</em>比较，如果相等，则将其替换为<em>b</em> ，否则将其替换为<em>c</em> 。但是<em>c</em>可以是另一个三元组<em>a</em> ， <em>b</em> ， <em>c</em> ，因此整个结构实际上是一个转换表。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>以下DSL示例显示了如何使用字符串转换功能。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># definitions for conditions
[when][]There is an? {entity}=${entity!lc}: {entity!ucfirst}()
[when][]- with an? {attr} greater than {amount}={attr} &lt;= {amount!num}
[when][]- with a {what} {attr}={attr} {what!positive?&gt;0/negative?%lt;0/zero?==0/ERROR}</code></pre>
</div>
</div>
<div class="paragraph">
<p>包含DSL定义的文件必须放置在resources文件夹或其任何子文件夹下，就像其他所有drools工件一样。它必须具有扩展名<code>.dsl</code> ，或者用类型标记<code>ResourceType.DSL</code> 。以编程方式添加到<code>KieFileSystem</code> 。对于使用DSL定义的文件，扩展名<code>.dslr</code>应该使用，但可以将其添加到<code>KieFileSystem</code>与类型<code>ResourceType.DSLR</code> 。</p>
</div>
<div class="paragraph">
<p>为了解析和扩展DSLR文件，需要读取DSL配置并将其提供给解析器。因此，解析器可以“识别” DSL表达式并将其转换为本地规则语言表达式。</p>
</div>
</div>
</div>
</div>
</div></div>
<div class="sect1">
<h2 id="drools.DMN"><a class="anchor" href="#drools.DMN"></a> <a class="link" href="#drools.DMN">5，决策模型和表示法（DMN）</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="dmn-con_dmn-models"><a class="anchor" href="#dmn-con_dmn-models"></a> <a class="link" href="#dmn-con_dmn-models">5.1。决策模型和表示法（DMN）</a></h3>
<div class="paragraph">
<p>决策模型和表示法（DMN）是对象管理小组（OMG）建立的用于描述和建模操作决策的标准。DMN定义了一个XML模式，该模式使DMN兼容平台之间以及整个组织之间可以共享DMN模型，以便业务分析人员和业务规则开发人员可以在设计和实现DMN决策服务时进行协作。DMN标准类似于并可以与业务流程模型和表示法（BPMN）标准一起使用，以设计和建模业务流程。</p>
</div>
<div class="paragraph">
<p>有关DMN的背景和应用的更多信息，请参见OMG <a href="https://www.omg.org/spec/DMN">决策模型和符号规范</a> 。</p>
</div>
<div class="sect3">
<h4 id="dmn-conformance-levels-con_dmn-models"><a class="anchor" href="#dmn-conformance-levels-con_dmn-models"></a> <a class="link" href="#dmn-conformance-levels-con_dmn-models">5.1.1。DMN符合性级别</a></h4>
<div class="paragraph">
<p>DMN规范定义了软件实现中的三个增量符合级别。声称符合一个级别的产品还必须符合任何先前的级别。例如，符合性级别3的实现还必须包括符合性级别1和2中受支持的组件。有关每个一致性级别的正式定义，请参见OMG <a href="https://www.omg.org/spec/DMN">Decision Model and Notation规范</a> 。</p>
</div>
<div class="paragraph">
<p>下表总结了三个DMN一致性级别：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">符合等级1</dt>
<dd>
<p>DMN符合性级别1的实现支持决策需求图（DRD），决策逻辑和决策表，但是决策模型不可执行。可以使用任何语言来定义表达式，包括自然的，非结构化的语言。</p>
</dd>
<dt class="hdlist1">符合等级2</dt>
<dd>
<p>DMN符合性级别2的实现包括符合性级别1的要求，并支持简化友好的足够表达语言（S-FEEL）表达式和完全可执行的决策模型。</p>
</dd>
<dt class="hdlist1">符合等级3</dt>
<dd>
<p>DMN一致性级别3的实现包括一致性级别1和2中的要求，并支持友好的足够表达语言（FEEL）表达式，完整的带框表达式集和完全可执行的决策模型。</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Drools为符合性级别3的DMN 1.2模型提供设计和运行时支持，并为符合性级别3的DMN 1.1模型提供仅运行时支持。您可以直接在Business Central中设计DMN模型，也可以将现有DMN模型导入Drools项目中以进行部署和执行。导入到Business Central中，在DMN设计器中打开并保存的所有DMN 1.1模型都将转换为DMN 1.2模型。</p>
</div>
</div>
<div class="sect3">
<h4 id="dmn-drd-components-ref_dmn-models"><a class="anchor" href="#dmn-drd-components-ref_dmn-models"></a> <a class="link" href="#dmn-drd-components-ref_dmn-models">5.1.2。DMN决策需求图（DRD）组件</a></h4>
<div class="paragraph">
<p>决策需求图（DRD）是DMN模型的直观表示。此图由一个或多个决策需求图（DRG）组成，它们代表整个DRD的特定域。 DRG使用决策节点，业务知识模型，业务知识源，输入数据和决策服务来跟踪业务决策。</p>
</div>
<div class="paragraph">
<p>下表总结了DRD中的组件：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表16。DRD组件</caption>
<colgroup>
<col style="width:20%">
<col style="width:20%">
<col style="width:40%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2" style="background-color:#ffffff">零件</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">符号</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="5" style="background-color:#ffffff"><p class="tableblock">元素</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">决断</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个或多个输入元素根据定义的决策逻辑确定输出的节点。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-node.png" alt="dmn决策节点">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">商业知识模型</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">具有一个或多个决策元素的可重用功能。具有相同逻辑但依赖于不同子输入数据或子决策的决策使用业务知识模型来确定要遵循的过程。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-bkm-node.png" alt="dmn bkm节点">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">知识来源</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">外部机构，文件，委员会或政策，用于管理决策或业务知识模型。知识源是对现实因素的引用，而不是可执行的业务规则。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-knowledge-source-node.png" alt="dmn知识源节点">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">输入数据</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">决策节点或业务知识模型中使用的信息。输入数据通常包括与业务相关的业务级别概念或对象，例如贷款策略中使用的贷款申请人数据。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-input-data-node.png" alt="dmn输入数据节点">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">决策服务</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="paragraph">
<p>顶层决策，包含一组可重用的决策，这些决策已发布为调用服务。可以从外部应用程序或BPMN业务流程中调用决策服务。</p>
</div></div></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-service-node.png" alt="dmn决策服务节点">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3" style="background-color:#ffffff"><p class="tableblock">需求连接器</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">信息要求</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">从输入数据节点或决策节点到需要该信息的另一个决策节点的连接。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-info-connector.png" alt="dmn信息连接器">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">知识要求</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">从业务知识模型到决策节点或到另一个调用决策逻辑的业务知识模型的连接。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-knowledge-connector.png" alt="dmn知识连接器">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">权限要求</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">从输入数据节点或决策节点到从属知识源的连接，或者从知识源到决策节点，业务知识模型或另一个知识源的连接。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-authority-connector.png" alt="dmn授权连接器">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2" style="background-color:#ffffff"><p class="tableblock">伪像</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">文字注解</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">与输入数据节点，决策节点，业务知识模型或知识源关联的说明性注释。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-annotation-node.png" alt="dmn注释节点">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">协会</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">从输入数据节点，决策节点，业务知识模型或知识源到文本注释的连接。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-association-connector.png" alt="dmn关联连接器">
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>下表总结了DRD元素之间允许的连接器：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表17。DRD连接器规则</caption>
<colgroup>
<col style="width:20%">
<col style="width:20%">
<col style="width:20%">
<col style="width:40%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">从开始</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">连接到</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">连接类型</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">例</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">决断</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">决断</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">信息要求</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-to-decision.png" alt="决策决定">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2" style="background-color:#ffffff"><p class="tableblock">商业知识模型</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">决断</p></td>
<td class="tableblock halign-left valign-top" rowspan="2" style="background-color:#ffffff"><p class="tableblock">知识要求</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-bkm-to-decision.png" alt="dmn bkm决定">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">商业知识模型</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-bkm-to-bkm.png" alt="dmn bkm至bkm">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2" style="background-color:#ffffff"><div class="content"><div class="paragraph">
<p>决策服务</p>
</div></div></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">决断</p></td>
<td class="tableblock halign-left valign-top" rowspan="2" style="background-color:#ffffff"><p class="tableblock">知识要求</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-service-to-decision.png" alt="dmn决策服务">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">商业知识模型</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-service-to-bkm.png" alt="dmn决策服务到bkm">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2" style="background-color:#ffffff"><p class="tableblock">输入数据</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">决断</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">信息要求</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-input-to-decision.png" alt="dmn输入决策">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">知识来源</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">权限要求</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-input-to-knowledge-source.png" alt="dmn输入到知识源">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3" style="background-color:#ffffff"><p class="tableblock">知识来源</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">决断</p></td>
<td class="tableblock halign-left valign-top" rowspan="3" style="background-color:#ffffff"><p class="tableblock">权限要求</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-knowledge-source-to-decision.png" alt="dmn决策的知识来源">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">商业知识模型</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-knowledge-source-to-bkm.png" alt="dmn知识源到bkm">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">知识来源</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-knowledge-source-to-knowledge-source.png" alt="dmn知识源到知识源">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">决断</p></td>
<td class="tableblock halign-left valign-top" rowspan="4" style="background-color:#ffffff"><p class="tableblock">文字注解</p></td>
<td class="tableblock halign-left valign-top" rowspan="4" style="background-color:#ffffff"><p class="tableblock">协会</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-to-annotation.png" alt="dmn决定注释">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">商业知识模型</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-bkm-to-annotation.png" alt="dmn bkm到注释">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">知识来源</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-knowledge-source-to-annotation.png" alt="dmn知识来源进行注释">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">输入数据</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><div class="content"><div class="imageblock">
<div class="content">
<img src="./dmn/dmn-input-to-annotation.png" alt="dmn输入注释">
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>下面的示例DRD实际说明了其中的一些DMN组件：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-example-drd.png" alt="dmn示例drd">
</div>
<div class="title">图73。DRD示例：贷款资格预审</div>
</div>
<div class="paragraph">
<p>下面的示例DRD说明了作为可重用决策服务一部分的DMN组件：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-example-drd3.png" alt="dmn示例drd3" width="90%">
</div>
<div class="title">图74。示例DRD：将电话处理作为决策服务</div>
</div>
<div class="paragraph">
<p>在DMN决策服务节点中，最底层的决策节点将来自决策服务外部的输入数据合并到决策服务节点的最上层的最终决策中。然后，可以在DMN模型的任何后续决策或业务知识要求中实施决策服务产生的顶级决策。您可以在其他DMN模型中重用DMN决策服务，以将相同的决策逻辑应用于不同的输入数据和不同的传出连接。</p>
</div>
</div>
<div class="sect3">
<h4 id="dmn-feel-con_dmn-models"><a class="anchor" href="#dmn-feel-con_dmn-models"></a> <a class="link" href="#dmn-feel-con_dmn-models">5.1.3。FEEL中的规则表达式</a></h4>
<div class="paragraph">
<p>友好的足够表达语言（FEEL）是一种由对象管理组（OMG）DMN规范定义的表达语言。FEEL表达式定义了DMN模型中决策的逻辑。FEEL旨在通过将语义分配给决策模型构造来促进决策建模和执行。决策需求图（DRD）中的FEEL表达式占据用于决策节点和业务知识模型的框式表达式中的表格单元。</p>
</div>
<div class="paragraph">
<p>有关DMN中FEEL的更多信息，请参见OMG <a href="https://www.omg.org/spec/DMN">决策模型和符号规范</a> 。</p>
</div>
<div class="sect4">
<h5 id="dmn-names-con_dmn-models"><a class="anchor" href="#dmn-names-con_dmn-models"></a> <a class="link" href="#dmn-names-con_dmn-models">5.1.3.1。FEEL中的变量和函数名称</a></h5>
<div class="paragraph">
<p>与许多传统的表达语言不同，友好的足够表达语言（FEEL）支持空格和一些特殊字符作为变量和函数名称的一部分。FEEL名称必须以<code>letter</code> ， <code>?</code> ， 要么<code>_</code>元件。Unicode字母字符也是允许的。变量名称不能以语言关键字开头，例如<code>and</code> ， <code>true</code> ， 要么<code>every</code> 。变量名称中的其余字符可以是任何起始字符，也可以是<code>digits</code> ，空格和特殊字符，例如<code>+</code> ， <code>-</code> ， <code>/</code> ， <code>*</code> ， <code>'</code>和<code>.</code> 。</p>
</div>
<div class="paragraph">
<p>例如，以下名称都是有效的FEEL名称：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>年龄</p>
</li>
<li>
<p>生日</p>
</li>
<li>
<p>航班234预检查程序</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>FEEL中的变量和函数名称有几个限制：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">歧义性</dt>
<dd>
<p>使用空格，关键字和其他特殊字符作为名称的一部分会使FEEL含糊不清。歧义在表达式的上下文中解决，名称从左到右匹配。解析器将变量名解析为作用域中匹配的最长名称。您可以使用<code>( )</code>如有必要，请消除歧义。</p>
</dd>
<dt class="hdlist1">名称中的空格</dt>
<dd>
<p>DMN规范限制了FEEL名称中空格的使用。根据DMN规范，名称可以包含多个空格，但不能包含两个连续的空格。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>为了使语言更易于使用并避免由于空格引起的常见错误，Drools取消了对连续空格使用的限制。Drools支持使用任意数量的连续空格的变量名，但是将其标准化为单个空格。例如，变量引用<code>First Name</code>与一个空间和<code>First Name</code>在Drools中两个空格都可以接受。</p>
</div>
<div class="paragraph">
<p>Drools还规范了其他空白的使用，例如网页，制表符和换行符中常见的不可中断的空白。从Drools FEEL引擎的角度来看，在处理之前，所有这些字符都被标准化为单个空格。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">关键字<code>in</code></dt>
<dd>
<p>关键字<code>in</code>是该语言中唯一不能用作变量名一部分的关键字。尽管规范允许在变量名中间使用关键字，但使用<code>in</code>变量名称中的“与”的语法定义冲突<code>for</code> ， <code>every</code>和<code>some</code>表达结构。</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="dmn-data-types-ref_dmn-models"><a class="anchor" href="#dmn-data-types-ref_dmn-models"></a> <a class="link" href="#dmn-data-types-ref_dmn-models">5.1.3.2。FEEL中的数据类型</a></h5>
<div class="paragraph">
<p>友好足够表达语言（FEEL）支持以下数据类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>号码</p>
</li>
<li>
<p>弦乐</p>
</li>
<li>
<p>布尔值</p>
</li>
<li>
<p>日期</p>
</li>
<li>
<p>时间</p>
</li>
<li>
<p>日期和时间</p>
</li>
<li>
<p>天数和持续时间</p>
</li>
<li>
<p>持续年月</p>
</li>
<li>
<p>功能</p>
</li>
<li>
<p>语境</p>
</li>
<li>
<p>范围（或间隔）</p>
</li>
<li>
<p>清单</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">DMN规范当前未提供将变量声明为<code>function</code> ， <code>context</code> ， <code>range</code> ， 要么<code>list</code> ，但Drools扩展了DMN内置类型以支持这些类型的变量。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>以下列表描述了每种数据类型：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">号码</dt>
<dd>
<p>FEEL中的数字基于<a href="http://ieeexplore.ieee.org/document/4610935/">IEEE 754-2008</a>十进制128格式，精度为34位。在内部，数字在Java中表示为<a href="https://docs.oracle.com/javase/8/docs/api/java/math/BigDecimal.html"><code>BigDecimals</code></a>与<code>MathContext DECIMAL128</code> 。FEEL仅支持一种数字数据类型，因此同一类型用于表示整数和浮点数。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>感觉数字使用点（ <code>.</code> ）作为小数点分隔符。FEEL不支持<code>-INF</code> ， <code>+INF</code> ， 要么<code>NaN</code> 。FEEL用途<code>null</code>代表无效数字。</p>
</div>
<div class="paragraph">
<p>Drools扩展了DMN规范并支持其他数字符号：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>科学：</strong>您可以在后缀中使用科学符号<code>e<exp></code>要么<code>E<exp></code> 。例如， <code>1.2e3</code>和写表达式一样<code>1.2*10**3</code> ，但是是文字而不是表达式。</p>
</li>
<li>
<p><strong>十六进制：</strong>您可以使用带前缀的十六进制数字<code>0x</code> 。例如， <code>0xff</code>与十进制数字相同<code>255</code> 。支持大写和小写字母。例如， <code>0XFF</code>是相同的<code>0xff</code> 。</p>
</li>
<li>
<p><strong>类型后缀：</strong>您可以使用类型后缀<code>f</code> ， <code>F</code> ， <code>d</code> ， <code>D</code> ， <code>l</code>和<code>L</code> 。这些后缀将被忽略。</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">弦乐</dt>
<dd>
<p>FEEL中的字符串是由双引号分隔的任何字符序列。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>"John Doe"</pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">布尔值</dt>
<dd>
<p>FEEL使用三值布尔逻辑，因此布尔逻辑表达式可能具有值<code>true</code> ， <code>false</code> ， 要么<code>null</code> 。</p>
</dd>
<dt class="hdlist1">日期</dt>
<dd>
<p>FEEL不支持日期文字，但是您可以使用内置的<code>date()</code>函数构造日期值。FEEL中的日期字符串遵循<a href="https://www.w3.org/TR/xmlschema-2/#date">XML架构第2部分：数据类型</a>文档中定义的格式。格式是<code>"YYYY-MM-DD"</code>哪里<code>YYYY</code>是四位数的年份， <code>MM</code>是两位数的月份数，并且<code>DD</code>是一天的数字。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>date( "2017-06-23" )</pre>
</div>
</div>
<div class="paragraph">
<p>日期对象的时间等于<code>"00:00:00"</code> ，这是午夜。日期被认为是本地日期，没有时区。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">时间</dt>
<dd>
<p>FEEL不支持时间文字，但是您可以使用内置的<code>time()</code>函数来构造时间值。FEEL中的时间字符串遵循<a href="https://www.w3.org/TR/xmlschema-2/#time">XML架构第2部分：数据类型</a>文档中定义的格式。格式是<code>"hh:mm:ss[.uuu][(+-)hh:mm]"</code>哪里<code>hh</code>是一天中的小时（从<code>00</code>至<code>23</code> ）， <code>mm</code>是小时中的分钟，并且<code>ss</code>是分钟的秒数。（可选）字符串可以定义毫秒数（ <code>uuu</code> ）内包含一个正号（ <code>+</code> ）或否定（ <code>-</code> ）从UTC时间偏移以定义其时区。除了使用偏移量，您还可以使用字母<code>z</code>代表UTC时间，与UTC的偏移量相同<code>-00:00</code> 。如果未定义偏移量，则该时间被视为本地时间。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>time( "04:25:12" )
time( "14:10:00+02:00" )
time( "22:35:40.345-05:00" )
time( "15:00:30z" )</pre>
</div>
</div>
<div class="paragraph">
<p>不能将定义偏移量或时区的时间值与未定义偏移量或时区的本地时间进行比较。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">日期和时间</dt>
<dd>
<p>FEEL不支持日期和时间文字，但是您可以使用内置的<code>date and time()</code>用于构造日期和时间值的函数。FEEL中的日期和时间字符串遵循<a href="https://www.w3.org/TR/xmlschema-2/#dateTime">XML架构第2部分：数据类型</a>文档中定义的格式。格式是<code>"<date>T<time>"</code> ，在哪里<code><date></code>和<code><time></code>遵循规定的XML模式格式，由<code>T</code> 。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>date and time( "2017-10-22T23:59:00" )
date and time( "2017-06-13T14:10:00+02:00" )
date and time( "2017-02-05T22:35:40.345-05:00" )
date and time( "2017-06-13T15:00:30z" )</pre>
</div>
</div>
<div class="paragraph">
<p>不能将定义偏移量或时区的日期和时间值与未定义偏移量或时区的本地日期和时间值进行比较。</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">如果DMN规范的实现不支持XML模式中的空格，请使用关键字<code>dateTime</code>作为...的同义词<code>date and time</code> 。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">天数和持续时间</dt>
<dd>
<p>FEEL不支持天数和持续时间文字，但是您可以使用内置的<code>duration()</code>用于构造日期和持续时间值。FEEL中的日期和持续时间字符串遵循<a href="https://www.w3.org/TR/xmlschema-2/#duration">XML模式第2部分：数据类型</a>文档中定义的格式，但仅限于几天，几小时，几分钟和几秒钟。不支持月份和年份。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>duration( "P1DT23H12M30S" )
duration( "P23D" )
duration( "PT12H" )
duration( "PT35M" )</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">如果DMN规范的实现不支持XML模式中的空格，请使用关键字<code>dayTimeDuration</code>作为...的同义词<code>days and time duration</code> 。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">持续年月</dt>
<dd>
<p>FEEL不支持年份和月份的持续时间字面量，但是您可以使用内置的<code>duration()</code>用于构造日期和持续时间值。FEEL中的年月持续时间字符串遵循<a href="https://www.w3.org/TR/xmlschema-2/#duration">XML Schema第2部分：数据类型</a>文档中定义的格式，但仅限于年月。不支持天，小时，分钟或秒。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>duration( "P3Y5M" )
duration( "P2Y" )
duration( "P10M" )
duration( "P25M" )</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">如果DMN规范的实现不支持XML模式中的空格，请使用关键字<code>yearMonthDuration</code>作为...的同义词<code>years and months duration</code> 。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">功能</dt>
<dd>
<p>感觉有<code>function</code>可用于创建函数的文字（或匿名函数）。DMN规范当前未提供将变量声明为<code>function</code> ，但Drools扩展了DMN内置类型以支持功能变量。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>function(a, b) a + b</pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，FEEL表达式创建一个添加参数的函数<code>a</code>和<code>b</code>并返回结果。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">语境</dt>
<dd>
<p>感觉有<code>context</code>您可以用来创建上下文的文字。一种<code>context</code> FEEL中的键和值对的列表类似于Java等语言中的映射。DMN规范当前未提供将变量声明为<code>context</code> ，但Drools扩展了DMN内置类型以支持上下文变量。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{ x : 5, y : 3 }</pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，表达式创建具有两个条目的上下文， <code>x</code>和<code>y</code> ，表示图表中的坐标。</p>
</div>
<div class="paragraph">
<p>在DMN 1.2中，创建上下文的另一种方法是创建一个包含键列表作为属性的项目定义，然后将变量声明为具有该项目定义类型。</p>
</div>
<div class="paragraph">
<p>Drools DMN API支持DMN <code>ItemDefinition</code>一个中的结构类型<code>DMNContext</code>有两种表示方式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>用户定义的Java类型：必须是有效的JavaBeans对象，为DMN中的每个组件定义属性和获取器<code>ItemDefinition</code> 。如有必要，您还可以使用<code>@FEELProperty</code>那些表示组件名称的获取方法的注释，这将导致无效的Java标识符。</p>
</li>
<li>
<p><code>java.util.Map</code>界面：映射需要定义适当的条目，其键与DMN中的组件名称相对应<code>ItemDefinition</code> 。</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">范围（或间隔）</dt>
<dd>
<p>感觉有<code>range</code>您可以用来创建范围或间隔的文字。一种<code>range</code> FEEL中的值是一个定义上下限的值，可以打开或关闭。DMN规范当前未提供将变量声明为<code>range</code> ，但Drools扩展了DMN内置类型以支持range变量。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>范围的语法以以下格式定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>range          := interval_start endpoint '..' endpoint interval_end
interval_start := open_start | closed_start
open_start     := '(' | ']'
closed_start   := '['
interval_end   := open_end | closed_end
open_end       := ')' | '['
closed_end     := ']'
endpoint       := expression</pre>
</div>
</div>
<div class="paragraph">
<p>端点的表达式必须返回一个可比较的值，并且下限端点必须小于上限端点。</p>
</div>
<div class="paragraph">
<p>例如，以下文字表达式定义了之间的间隔<code>1</code>和<code>10</code> ，包括边界（两个端点上的闭合间隔）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ 1 .. 10 ]</pre>
</div>
</div>
<div class="paragraph">
<p>以下文字表达式定义了一个介于1小时和12小时之间的时间间隔，包括下边界（封闭的间隔），但不包括上边界（开放的间隔）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ duration("PT1H") .. duration("PT12H") ]</pre>
</div>
</div>
<div class="paragraph">
<p>您可以在决策表中使用范围来测试值的范围，也可以在简单文字表达式中使用范围。例如，以下文字表达式返回<code>true</code>如果变量的值<code>x</code>在。。。之间<code>0</code>和<code>100</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>x in [ 1 .. 100 ]</pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">清单</dt>
<dd>
<p>感觉有<code>list</code>您可以用来创建项目列表的文字。一种<code>list</code>在FEEL中，用方括号括起来的值的逗号分隔列表表示。DMN规范当前未提供将变量声明为<code>list</code> ，但Drools扩展了DMN内置类型以支持列表变量。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ 2, 3, 4, 5 ]</pre>
</div>
</div>
<div class="paragraph">
<p>FEEL中的所有列表都包含相同类型的元素并且是不可变的。列表中的元素可以通过索引访问，其中第一个元素是<code>1</code> 。负索引可以访问从列表末尾开始的元素，这样<code>-1</code>是最后一个元素。</p>
</div>
<div class="paragraph">
<p>例如，以下表达式返回列表的第二个元素<code>x</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>x[2]</pre>
</div>
</div>
<div class="paragraph">
<p>以下表达式返回列表的倒数第二个元素<code>x</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>x[-2]</pre>
</div>
</div>
<div class="paragraph">
<p>列表中的元素也可以通过函数进行计数<code>count</code> ，它使用元素列表作为参数。</p>
</div>
<div class="paragraph">
<p>例如，以下表达式返回<code>4</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>count([ 2, 3, 4, 5 ])</pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dmn-boxed-expressions-con_dmn-models"><a class="anchor" href="#dmn-boxed-expressions-con_dmn-models"></a> <a class="link" href="#dmn-boxed-expressions-con_dmn-models">5.1.4。装箱表达式中的DMN决策逻辑</a></h4>
<div class="paragraph">
<p>DMN中的框式表达式是用于在决策需求图（DRD）或决策需求图（DRG）中定义决策节点和业务知识模型的基础逻辑的表。一些框式表达式可以包含其他框式表达式，但是顶级框式表达式对应于单个DRD工件的决策逻辑。虽然带有一个或多个DRG的DRD表示DMN决策模型的流程，但带框的表达式定义了各个节点的实际决策逻辑。DRD和框式表达式一起形成了完整且功能齐全的DMN决策模型。</p>
</div>
<div class="paragraph">
<p>以下是DMN框式表达式的类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>决策表</p>
</li>
<li>
<p>文字表达</p>
</li>
<li>
<p>语境</p>
</li>
<li>
<p>关系</p>
</li>
<li>
<p>功能</p>
</li>
<li>
<p>调用方式</p>
</li>
<li>
<p>清单</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">Drools在Business Central中不提供盒装列表表达式，但支持FEEL <code>list</code>可以在装箱的文字表达式中使用的数据类型。有关的更多信息<code>list</code>数据类型和在Drools中其他FEEL数据类型，见<a href="#dmn-data-types-ref_dmn-models">在FEEL数据类型</a> 。</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>在盒装表达式中使用的所有友好的足够表达式语言（FEEL）表达式必须符合OMG <a href="https://www.omg.org/spec/DMN">Decision Model and Notation规范中</a>的FEEL语法要求。</p>
</div>
<div class="sect4">
<h5 id="dmn-decision-tables-con_dmn-models"><a class="anchor" href="#dmn-decision-tables-con_dmn-models"></a> <a class="link" href="#dmn-decision-tables-con_dmn-models">5.1.4.1。DMN决策表</a></h5>
<div class="paragraph">
<p>DMN中的决策表是以表格格式直观显示一个或多个业务规则。您可以使用决策表为决策节点定义规则，这些规则将这些规则应用于决策模型中的给定点。每个规则由表中的一行组成，并包括定义该特定行的条件（输入）和结果（输出）的列。每行的定义足够精确，可以使用条件的值得出结果。输入和输出值可以是FEEL表达式或定义的数据类型值。</p>
</div>
<div class="paragraph">
<p>例如，以下决策表根据贷款申请人的信用分数的定义范围确定信用分数等级：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-table-example.png" alt="dmn决策表示例">
</div>
<div class="title">图75。信用评分等级决定表</div>
</div>
<div class="paragraph">
<p>下列决策表根据申请人的贷款资格和局电话类型确定了针对申请人的贷款策略的下一步：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-table-example2.png" alt="dmn决策表example2">
</div>
<div class="title">图76。贷款策略决策表</div>
</div>
<div class="paragraph">
<p>下列决策表将贷款的申请人资格确定为贷款资格预审决策模型中的结论节点：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-table-example3.png" alt="dmn决策表example3">
</div>
<div class="title">图77。贷款资格预审决定表</div>
</div>
<div class="paragraph">
<p>决策表是对规则和决策逻辑进行建模的一种流行方法，并且在许多方法（如DMN）和实现框架（如Drools）中使用。</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">Drools支持DMN决策表和Drools本机决策表，但是它们是具有不同语法要求的不同类型的资产，并且不可互换。有关Drools中Drools本机决策表的更多信息，请参见<a href="#decision-tables-con_decision-tables">Spreadsheet决策表</a> 。
</td>
</tr>
</tbody></table>
</div>
<div class="sect5">
<h6 id="dmn-decision-tables-hit-policies-con_dmn-models"><a class="anchor" href="#dmn-decision-tables-hit-policies-con_dmn-models"></a> <a class="link" href="#dmn-decision-tables-hit-policies-con_dmn-models">DMN决策表中的点击策略</a></h6>
<div class="paragraph">
<p>命中策略确定当决策表中的多个规则与提供的输入值匹配时如何达到结果。例如，如果决策表中的一条规则对军事人员应用了销售折扣，而另一条规则对学生进行了折扣，则当客户既是学生又是军人时，决策表命中策略必须指出是否应用一个折扣打折或另一个打折（ <strong>Unique</strong> ， <strong>First</strong> ）或两个打折（ <strong>Collect Sum</strong> ）。您可以在决策表的左上角指定匹配策略的单个字符（ <strong>U</strong> ， <strong>F</strong> ， <strong>C +</strong> ）。</p>
</div>
<div class="paragraph">
<p>DMN支持以下决策表命中策略：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>唯一（U）：</strong>仅允许匹配一个规则。任何重叠都会引发错误。</p>
</li>
<li>
<p><strong>任意（A）：</strong>允许多个规则匹配，但是它们必须都具有相同的输出。如果多个匹配规则没有相同的输出，则会引发错误。</p>
</li>
<li>
<p><strong>优先级（P）：</strong>允许多个规则匹配，但输出不同。选择输出值列表中第一位的输出。</p>
</li>
<li>
<p><strong>第一（F）：</strong>按规则顺序使用第一匹配。</p>
</li>
<li>
<p><strong>收集（C +，C>，C <，C＃）：</strong>基于聚合函数聚合来自多个规则的输出。</p>
<div class="ulist">
<ul>
<li>
<p><strong>收集（C）：</strong>汇总任意列表中的值。</p>
</li>
<li>
<p><strong>收集总和（C +）：</strong>输出所有收集值的总和。值必须是数字。</p>
</li>
<li>
<p><strong>收集最小值（C <）：</strong>输出匹配项中的最小值。结果值必须是可比较的，例如数字，日期或文本（字典顺序）。</p>
</li>
<li>
<p><strong>收集最大值（C>）：</strong>输出匹配项中的最大值。结果值必须是可比较的，例如数字，日期或文本（字典顺序）。</p>
</li>
<li>
<p><strong>收集计数（C＃）：</strong>输出匹配规则的数量。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dmn-literal-expressions-con_dmn-models"><a class="anchor" href="#dmn-literal-expressions-con_dmn-models"></a> <a class="link" href="#dmn-literal-expressions-con_dmn-models">5.1.4.2。装箱的文字表达</a></h5>
<div class="paragraph">
<p>DMN中的框式文字表达式是文字FEEL表达式，它是表单元格中的文本，通常带有标记的列和分配的数据类型。您可以使用装箱的文字表达式直接在FEEL中为决策中的特定节点定义简单或复杂的节点逻辑或决策数据。文字FEEL表达式必须符合OMG <a href="https://www.omg.org/spec/DMN">Decision Model and Notation规范</a>中的FEEL语法要求。</p>
</div>
<div class="paragraph">
<p>例如，以下框式文字表达式定义了贷款决策中可接受的最小PITI计算（本金，利息，税金和保险），其中<code>acceptable rate</code>是DMN模型中定义的变量：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-literal-expression-example2.png" alt="dmn文字表达式example2">
</div>
<div class="title">图78。装箱的文字表达式可实现最小PITI值</div>
</div>
<div class="paragraph">
<p>以下框式文字表达式根据在线约会应用程序中可能的约会候选者（灵魂伴侣）的年龄，位置和兴趣等标准对他们的得分进行排序：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-literal-expression-example3b.png" alt="dmn文字表达式example3b">
</div>
<div class="title">图79。用于匹配在线约会候选人的盒装文字表达</div>
</div>
</div>
<div class="sect4">
<h5 id="dmn-context-expressions-con_dmn-models"><a class="anchor" href="#dmn-context-expressions-con_dmn-models"></a> <a class="link" href="#dmn-context-expressions-con_dmn-models">5.1.4.3。装箱的上下文表达式</a></h5>
<div class="paragraph">
<p>DMN中的框式上下文表达式是一组变量名称和值以及结果值。每个名称/值对都是一个上下文条目。您可以使用上下文表达式来表示决策逻辑中的数据定义，并为DMN决策模型中的所需决策元素设置一个值。装箱的上下文表达式中的值可以是数据类型值或FEEL表达式，也可以包含任何类型的嵌套子表达式，例如决策表，文字表达式或另一个上下文表达式。</p>
</div>
<div class="paragraph">
<p>例如，以下框式上下文表达式基于定义的数据类型，定义了在航班重新预订决策模型中对延迟旅客进行排序的因素（ <code>tPassengerTable</code> ， <code>tFlightNumberList</code> ）：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-context-expression-example.png" alt="dmn上下文表达式示例">
</div>
<div class="title">图80。航空旅客候补名单的框式上下文表达式</div>
</div>
<div class="paragraph">
<p>以下框式上下文表达式定义了一些因素，这些因素确定贷款申请人是否可以根据本金，利息，税款和保险（PITI）满足最低抵押付款，以子上下文表达式表示为前端比率计算：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-context-expression-example2.png" alt="dmn上下文表达式example2">
</div>
<div class="title">图81。前端客户端PITI比例的框式上下文表达式</div>
</div>
</div>
<div class="sect4">
<h5 id="dmn-relation-expressions-con_dmn-models"><a class="anchor" href="#dmn-relation-expressions-con_dmn-models"></a> <a class="link" href="#dmn-relation-expressions-con_dmn-models">5.1.4.4。盒装关系表达式</a></h5>
<div class="paragraph">
<p>DMN中的框式关系表达式是一种传统的数据表，具有有关给定实体的信息，列为行。您可以使用盒装关系表为特定节点上的决策中的相关实体定义决策数据。盒装关系表达式与上下文表达式的相似之处在于它们设置变量名称和值，但是关系表达式不包含结果值，并且基于每列中定义的单个变量列出所有变量值。</p>
</div>
<div class="paragraph">
<p>例如，以下框式关系表达式提供有关员工名册决策中有关员工的信息：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-relation-expression-example.png" alt="dmn关系表达式示例">
</div>
<div class="title">图82。带员工信息的盒装关系表达式</div>
</div>
</div>
<div class="sect4">
<h5 id="dmn-function-expressions-con_dmn-models"><a class="anchor" href="#dmn-function-expressions-con_dmn-models"></a> <a class="link" href="#dmn-function-expressions-con_dmn-models">5.1.4.5。盒装函数表达式</a></h5>
<div class="paragraph">
<p>DMN中的框式函数表达式是参数化的框式表达式，其中包含文字FEEL表达式，外部JAVA或PMML函数的嵌套上下文表达式或任何类型的嵌套框式表达式。默认情况下，所有业务知识模型都定义为带框的函数表达式。您可以使用带框的函数表达式来调用决策逻辑上的函数并定义所有业务知识模型。</p>
</div>
<div class="paragraph">
<p>例如，以下框式函数表达式确定航班重新预订决策模型中的航空公司航班容量：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-function-expression-example.png" alt="dmn函数表达式示例">
</div>
<div class="title">图83。装箱函数表达式以获取飞行容量</div>
</div>
<div class="paragraph">
<p>下列带框的函数表达式包含一个基本的Java函数，作为上下文表达式，用于确定决策模型计算中的绝对值：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-function-expression-example2.png" alt="dmn函数表达式example2">
</div>
<div class="title">图84。盒装函数表达式的绝对值</div>
</div>
<div class="paragraph">
<p>以下框式函数表达式将每月抵押分期付款确定为贷款决策中的业务知识模型，并且函数值定义为嵌套上下文表达式：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-function-expression-example3.png" alt="dmn函数表达式example3">
</div>
<div class="title">图85。用于商业知识模型中分期付款计算的盒装函数表达式</div>
</div>
<div class="paragraph">
<p>以下框式函数表达式使用DMN文件中包含的PMML模型来定义贷款决策中可接受的最小PITI计算（本金，利息，税金和保险）：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-function-expression-example5.png" alt="dmn函数表达式example5">
</div>
<div class="title">图86。具有商业知识模型中包含的PMML模型的盒装函数表达式</div>
</div>
</div>
<div class="sect4">
<h5 id="dmn-invocation-expressions-con_dmn-models"><a class="anchor" href="#dmn-invocation-expressions-con_dmn-models"></a> <a class="link" href="#dmn-invocation-expressions-con_dmn-models">5.1.4.6。盒装调用表达式</a></h5>
<div class="paragraph">
<p>DMN中的框式调用表达式是调用业务知识模型的框式表达式。装箱的调用表达式包含要调用的业务知识模型的名称和参数绑定的列表。每个绑定都由一行中的两个带方框的表达式表示：左边的框包含参数的名称，右边的框包含绑定表达式，其值分配给参数以评估调用的业务知识模型。您可以使用框式调用在特定决策节点上调用决策模型中定义的业务知识模型。</p>
</div>
<div class="paragraph">
<p>例如，下面的框式调用表达式将调用<code>Reassign Next Passenger</code>业务知识模型作为航班重新预订决策模型中的最终决策节点：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-invocation-example.png" alt="dmn调用示例">
</div>
<div class="title">图87。带框的调用表达式以重新分配飞行乘客</div>
</div>
<div class="paragraph">
<p>以下框内的调用表达式将调用<code>InstallmentCalculation</code>业务知识模型，以在进行可承受性决策之前计算贷款的每月分期付款额：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-invocation-example2.png" alt="dmn调用example2">
</div>
<div class="title">图88。所需每月分期付款的盒装调用表达式</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dmn-model-example-ref_dmn-models"><a class="anchor" href="#dmn-model-example-ref_dmn-models"></a> <a class="link" href="#dmn-model-example-ref_dmn-models">5.1.5。DMN模型示例</a></h4>
<div class="paragraph">
<p>以下是一个真实的DMN模型示例，该示例演示了如何使用决策模型基于输入数据，环境和公司准则来做出决策。在这种情况下，从圣地亚哥到纽约的航班被取消，要求受影响的航空公司为其不便的乘客找到其他安排。</p>
</div>
<div class="paragraph">
<p>首先，航空公司收集必要的信息，以确定如何最好地将旅客带到目的地：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">输入数据</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>航班清单</p>
</li>
<li>
<p>乘客名单</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">决定</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>优先安排将要乘坐新航班的乘客</p>
</li>
<li>
<p>确定将为那些乘客提供哪些航班</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">商业知识模型</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>确定乘客优先级的公司流程</p>
</li>
<li>
<p>任何有空位的航班</p>
</li>
<li>
<p>确定如何最好地重新分配不便乘客的公司规则</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>然后，航空公司使用DMN标准在以下决策需求图（DRD）中为决策流程建模，以确定最佳的重新预订解决方案：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-passenger-rebooking-drd.png" alt="dmn乘客重新预订drd">
</div>
<div class="title">图89。DRD重新预订航班</div>
</div>
<div class="paragraph">
<p>与流程图类似，DRD使用形状表示流程中的不同元素。椭圆包含两个必需的输入数据，矩形包含模型中的决策点，带有截角的矩形（业务知识模型）包含可重复使用的可重复使用的逻辑。</p>
</div>
<div class="paragraph">
<p>DRD从框式表达式中为每个元素绘制逻辑，这些表达式使用FEEL表达式或数据类型值提供变量定义。</p>
</div>
<div class="paragraph">
<p>一些框式表达式是基本的，例如，以下关于建立优先等待列表的决定：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-context-expression-example.png" alt="dmn上下文表达式示例">
</div>
<div class="title">图90。带框的上下文表达式示例，用于优先等待列表</div>
</div>
<div class="paragraph">
<p>一些带框的表达式更加复杂，需要更多详细信息和计算，例如以下用于重新分配下一位延迟乘客的业务知识模型：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-reassign-passenger.png" alt="dmn重新分配乘客">
</div>
<div class="title">图91。盒装函数表达式，用于乘客重新分配</div>
</div>
<div class="paragraph">
<p>以下是此决策模型的DMN源文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dmn:definitions xmlns="https://www.drools.org/kie-dmn/Flight-rebooking" xmlns:dmn="http://www.omg.org/spec/DMN/20151101/dmn.xsd" xmlns:feel="http://www.omg.org/spec/FEEL/20140401" id="_0019_flight_rebooking" name="0019-flight-rebooking" namespace="https://www.drools.org/kie-dmn/Flight-rebooking"&gt;
  &lt;dmn:itemDefinition id="_tFlight" name="tFlight"&gt;
    &lt;dmn:itemComponent id="_tFlight_Flight" name="Flight Number"&gt;
      &lt;dmn:typeRef&gt;feel:string&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
    &lt;dmn:itemComponent id="_tFlight_From" name="From"&gt;
      &lt;dmn:typeRef&gt;feel:string&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
    &lt;dmn:itemComponent id="_tFlight_To" name="To"&gt;
      &lt;dmn:typeRef&gt;feel:string&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
    &lt;dmn:itemComponent id="_tFlight_Dep" name="Departure"&gt;
      &lt;dmn:typeRef&gt;feel:dateTime&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
    &lt;dmn:itemComponent id="_tFlight_Arr" name="Arrival"&gt;
      &lt;dmn:typeRef&gt;feel:dateTime&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
    &lt;dmn:itemComponent id="_tFlight_Capacity" name="Capacity"&gt;
      &lt;dmn:typeRef&gt;feel:number&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
    &lt;dmn:itemComponent id="_tFlight_Status" name="Status"&gt;
      &lt;dmn:typeRef&gt;feel:string&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
  &lt;/dmn:itemDefinition&gt;
  &lt;dmn:itemDefinition id="_tFlightTable" isCollection="true" name="tFlightTable"&gt;
    &lt;dmn:typeRef&gt;tFlight&lt;/dmn:typeRef&gt;
  &lt;/dmn:itemDefinition&gt;
  &lt;dmn:itemDefinition id="_tPassenger" name="tPassenger"&gt;
    &lt;dmn:itemComponent id="_tPassenger_Name" name="Name"&gt;
      &lt;dmn:typeRef&gt;feel:string&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
    &lt;dmn:itemComponent id="_tPassenger_Status" name="Status"&gt;
      &lt;dmn:typeRef&gt;feel:string&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
    &lt;dmn:itemComponent id="_tPassenger_Miles" name="Miles"&gt;
      &lt;dmn:typeRef&gt;feel:number&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
    &lt;dmn:itemComponent id="_tPassenger_Flight" name="Flight Number"&gt;
      &lt;dmn:typeRef&gt;feel:string&lt;/dmn:typeRef&gt;
    &lt;/dmn:itemComponent&gt;
  &lt;/dmn:itemDefinition&gt;
  &lt;dmn:itemDefinition id="_tPassengerTable" isCollection="true" name="tPassengerTable"&gt;
    &lt;dmn:typeRef&gt;tPassenger&lt;/dmn:typeRef&gt;
  &lt;/dmn:itemDefinition&gt;
  &lt;dmn:itemDefinition id="_tFlightNumberList" isCollection="true" name="tFlightNumberList"&gt;
    &lt;dmn:typeRef&gt;feel:string&lt;/dmn:typeRef&gt;
  &lt;/dmn:itemDefinition&gt;
  &lt;dmn:inputData id="i_Flight_List" name="Flight List"&gt;
    &lt;dmn:variable name="Flight List" typeRef="tFlightTable"/&gt;
  &lt;/dmn:inputData&gt;
  &lt;dmn:inputData id="i_Passenger_List" name="Passenger List"&gt;
    &lt;dmn:variable name="Passenger List" typeRef="tPassengerTable"/&gt;
  &lt;/dmn:inputData&gt;
  &lt;dmn:decision name="Prioritized Waiting List" id="d_PrioritizedWaitingList"&gt;
    &lt;dmn:variable name="Prioritized Waiting List" typeRef="tPassengerTable"/&gt;
    &lt;dmn:informationRequirement&gt;
      &lt;dmn:requiredInput href="#i_Passenger_List"/&gt;
    &lt;/dmn:informationRequirement&gt;
    &lt;dmn:informationRequirement&gt;
      &lt;dmn:requiredInput href="#i_Flight_List"/&gt;
    &lt;/dmn:informationRequirement&gt;
    &lt;dmn:knowledgeRequirement&gt;
      &lt;dmn:requiredKnowledge href="#b_PassengerPriority"/&gt;
    &lt;/dmn:knowledgeRequirement&gt;
    &lt;dmn:context&gt;
      &lt;dmn:contextEntry&gt;
        &lt;dmn:variable name="Cancelled Flights" typeRef="tFlightNumberList"/&gt;
        &lt;dmn:literalExpression&gt;
          &lt;dmn:text&gt;Flight List[ Status = "cancelled" ].Flight Number&lt;/dmn:text&gt;
        &lt;/dmn:literalExpression&gt;
      &lt;/dmn:contextEntry&gt;
      &lt;dmn:contextEntry&gt;
        &lt;dmn:variable name="Waiting List" typeRef="tPassengerTable"/&gt;
        &lt;dmn:literalExpression&gt;
          &lt;dmn:text&gt;Passenger List[ list contains( Cancelled Flights, Flight Number ) ]&lt;/dmn:text&gt;
        &lt;/dmn:literalExpression&gt;
      &lt;/dmn:contextEntry&gt;
      &lt;dmn:contextEntry&gt;
        &lt;dmn:literalExpression&gt;
          &lt;dmn:text&gt;sort( Waiting List, passenger priority )&lt;/dmn:text&gt;
        &lt;/dmn:literalExpression&gt;
      &lt;/dmn:contextEntry&gt;
    &lt;/dmn:context&gt;
  &lt;/dmn:decision&gt;
  &lt;dmn:decision name="Rebooked Passengers" id="d_RebookedPassengers"&gt;
    &lt;dmn:variable name="Rebooked Passengers" typeRef="tPassengerTable"/&gt;
    &lt;dmn:informationRequirement&gt;
      &lt;dmn:requiredDecision href="#d_PrioritizedWaitingList"/&gt;
    &lt;/dmn:informationRequirement&gt;
    &lt;dmn:informationRequirement&gt;
      &lt;dmn:requiredInput href="#i_Flight_List"/&gt;
    &lt;/dmn:informationRequirement&gt;
    &lt;dmn:knowledgeRequirement&gt;
      &lt;dmn:requiredKnowledge href="#b_ReassignNextPassenger"/&gt;
    &lt;/dmn:knowledgeRequirement&gt;
    &lt;dmn:invocation&gt;
      &lt;dmn:literalExpression&gt;
        &lt;dmn:text&gt;reassign next passenger&lt;/dmn:text&gt;
      &lt;/dmn:literalExpression&gt;
      &lt;dmn:binding&gt;
        &lt;dmn:parameter name="Waiting List"/&gt;
        &lt;dmn:literalExpression&gt;
          &lt;dmn:text&gt;Prioritized Waiting List&lt;/dmn:text&gt;
        &lt;/dmn:literalExpression&gt;
      &lt;/dmn:binding&gt;
      &lt;dmn:binding&gt;
        &lt;dmn:parameter name="Reassigned Passengers List"/&gt;
        &lt;dmn:literalExpression&gt;
          &lt;dmn:text&gt;[]&lt;/dmn:text&gt;
        &lt;/dmn:literalExpression&gt;
      &lt;/dmn:binding&gt;
      &lt;dmn:binding&gt;
        &lt;dmn:parameter name="Flights"/&gt;
        &lt;dmn:literalExpression&gt;
          &lt;dmn:text&gt;Flight List&lt;/dmn:text&gt;
        &lt;/dmn:literalExpression&gt;
      &lt;/dmn:binding&gt;
    &lt;/dmn:invocation&gt;
  &lt;/dmn:decision&gt;
  &lt;dmn:businessKnowledgeModel id="b_PassengerPriority" name="passenger priority"&gt;
    &lt;dmn:encapsulatedLogic&gt;
      &lt;dmn:formalParameter name="Passenger1" typeRef="tPassenger"/&gt;
      &lt;dmn:formalParameter name="Passenger2" typeRef="tPassenger"/&gt;
      &lt;dmn:decisionTable hitPolicy="UNIQUE"&gt;
        &lt;dmn:input id="b_Passenger_Priority_dt_i_P1_Status" label="Passenger1.Status"&gt;
          &lt;dmn:inputExpression typeRef="feel:string"&gt;
            &lt;dmn:text&gt;Passenger1.Status&lt;/dmn:text&gt;
          &lt;/dmn:inputExpression&gt;
          &lt;dmn:inputValues&gt;
            &lt;dmn:text&gt;"gold", "silver", "bronze"&lt;/dmn:text&gt;
          &lt;/dmn:inputValues&gt;
        &lt;/dmn:input&gt;
        &lt;dmn:input id="b_Passenger_Priority_dt_i_P2_Status" label="Passenger2.Status"&gt;
          &lt;dmn:inputExpression typeRef="feel:string"&gt;
            &lt;dmn:text&gt;Passenger2.Status&lt;/dmn:text&gt;
          &lt;/dmn:inputExpression&gt;
          &lt;dmn:inputValues&gt;
            &lt;dmn:text&gt;"gold", "silver", "bronze"&lt;/dmn:text&gt;
          &lt;/dmn:inputValues&gt;
        &lt;/dmn:input&gt;
        &lt;dmn:input id="b_Passenger_Priority_dt_i_P1_Miles" label="Passenger1.Miles"&gt;
          &lt;dmn:inputExpression typeRef="feel:string"&gt;
            &lt;dmn:text&gt;Passenger1.Miles&lt;/dmn:text&gt;
          &lt;/dmn:inputExpression&gt;
        &lt;/dmn:input&gt;
        &lt;dmn:output id="b_Status_Priority_dt_o" label="Passenger1 has priority"&gt;
          &lt;dmn:outputValues&gt;
            &lt;dmn:text&gt;true, false&lt;/dmn:text&gt;
          &lt;/dmn:outputValues&gt;
          &lt;dmn:defaultOutputEntry&gt;
            &lt;dmn:text&gt;false&lt;/dmn:text&gt;
          &lt;/dmn:defaultOutputEntry&gt;
        &lt;/dmn:output&gt;
        &lt;dmn:rule id="b_Passenger_Priority_dt_r1"&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r1_i1"&gt;
            &lt;dmn:text&gt;"gold"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r1_i2"&gt;
            &lt;dmn:text&gt;"gold"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r1_i3"&gt;
            &lt;dmn:text&gt;&gt;= Passenger2.Miles&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:outputEntry id="b_Passenger_Priority_dt_r1_o1"&gt;
            &lt;dmn:text&gt;true&lt;/dmn:text&gt;
          &lt;/dmn:outputEntry&gt;
        &lt;/dmn:rule&gt;
        &lt;dmn:rule id="b_Passenger_Priority_dt_r2"&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r2_i1"&gt;
            &lt;dmn:text&gt;"gold"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r2_i2"&gt;
            &lt;dmn:text&gt;"silver","bronze"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r2_i3"&gt;
            &lt;dmn:text&gt;-&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:outputEntry id="b_Passenger_Priority_dt_r2_o1"&gt;
            &lt;dmn:text&gt;true&lt;/dmn:text&gt;
          &lt;/dmn:outputEntry&gt;
        &lt;/dmn:rule&gt;
        &lt;dmn:rule id="b_Passenger_Priority_dt_r3"&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r3_i1"&gt;
            &lt;dmn:text&gt;"silver"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r3_i2"&gt;
            &lt;dmn:text&gt;"silver"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r3_i3"&gt;
            &lt;dmn:text&gt;&gt;= Passenger2.Miles&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:outputEntry id="b_Passenger_Priority_dt_r3_o1"&gt;
            &lt;dmn:text&gt;true&lt;/dmn:text&gt;
          &lt;/dmn:outputEntry&gt;
        &lt;/dmn:rule&gt;
        &lt;dmn:rule id="b_Passenger_Priority_dt_r4"&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r4_i1"&gt;
            &lt;dmn:text&gt;"silver"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r4_i2"&gt;
            &lt;dmn:text&gt;"bronze"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r4_i3"&gt;
            &lt;dmn:text&gt;-&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:outputEntry id="b_Passenger_Priority_dt_r4_o1"&gt;
            &lt;dmn:text&gt;true&lt;/dmn:text&gt;
          &lt;/dmn:outputEntry&gt;
        &lt;/dmn:rule&gt;
        &lt;dmn:rule id="b_Passenger_Priority_dt_r5"&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r5_i1"&gt;
            &lt;dmn:text&gt;"bronze"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r5_i2"&gt;
            &lt;dmn:text&gt;"bronze"&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:inputEntry id="b_Passenger_Priority_dt_r5_i3"&gt;
            &lt;dmn:text&gt;&gt;= Passenger2.Miles&lt;/dmn:text&gt;
          &lt;/dmn:inputEntry&gt;
          &lt;dmn:outputEntry id="b_Passenger_Priority_dt_r5_o1"&gt;
            &lt;dmn:text&gt;true&lt;/dmn:text&gt;
          &lt;/dmn:outputEntry&gt;
        &lt;/dmn:rule&gt;
      &lt;/dmn:decisionTable&gt;
    &lt;/dmn:encapsulatedLogic&gt;
    &lt;dmn:variable name="passenger priority" typeRef="feel:boolean"/&gt;
  &lt;/dmn:businessKnowledgeModel&gt;
  &lt;dmn:businessKnowledgeModel id="b_ReassignNextPassenger" name="reassign next passenger"&gt;
    &lt;dmn:encapsulatedLogic&gt;
      &lt;dmn:formalParameter name="Waiting List" typeRef="tPassengerTable"/&gt;
      &lt;dmn:formalParameter name="Reassigned Passengers List" typeRef="tPassengerTable"/&gt;
      &lt;dmn:formalParameter name="Flights" typeRef="tFlightTable"/&gt;
      &lt;dmn:context&gt;
        &lt;dmn:contextEntry&gt;
          &lt;dmn:variable name="Next Passenger" typeRef="tPassenger"/&gt;
          &lt;dmn:literalExpression&gt;
            &lt;dmn:text&gt;Waiting List[1]&lt;/dmn:text&gt;
          &lt;/dmn:literalExpression&gt;
        &lt;/dmn:contextEntry&gt;
        &lt;dmn:contextEntry&gt;
          &lt;dmn:variable name="Original Flight" typeRef="tFlight"/&gt;
          &lt;dmn:literalExpression&gt;
            &lt;dmn:text&gt;Flights[ Flight Number = Next Passenger.Flight Number ][1]&lt;/dmn:text&gt;
          &lt;/dmn:literalExpression&gt;
        &lt;/dmn:contextEntry&gt;
        &lt;dmn:contextEntry&gt;
          &lt;dmn:variable name="Best Alternate Flight" typeRef="tFlight"/&gt;
          &lt;dmn:literalExpression&gt;
            &lt;dmn:text&gt;Flights[ From = Original Flight.From and To = Original Flight.To and Departure &gt; Original Flight.Departure and Status = "scheduled" and has capacity( item, Reassigned Passengers List ) ][1]&lt;/dmn:text&gt;
          &lt;/dmn:literalExpression&gt;
        &lt;/dmn:contextEntry&gt;
        &lt;dmn:contextEntry&gt;
          &lt;dmn:variable name="Reassigned Passenger" typeRef="tPassenger"/&gt;
          &lt;dmn:context&gt;
            &lt;dmn:contextEntry&gt;
              &lt;dmn:variable name="Name" typeRef="feel:string"/&gt;
              &lt;dmn:literalExpression&gt;
                &lt;dmn:text&gt;Next Passenger.Name&lt;/dmn:text&gt;
              &lt;/dmn:literalExpression&gt;
            &lt;/dmn:contextEntry&gt;
            &lt;dmn:contextEntry&gt;
              &lt;dmn:variable name="Status" typeRef="feel:string"/&gt;
              &lt;dmn:literalExpression&gt;
                &lt;dmn:text&gt;Next Passenger.Status&lt;/dmn:text&gt;
              &lt;/dmn:literalExpression&gt;
            &lt;/dmn:contextEntry&gt;
            &lt;dmn:contextEntry&gt;
              &lt;dmn:variable name="Miles" typeRef="feel:number"/&gt;
              &lt;dmn:literalExpression&gt;
                &lt;dmn:text&gt;Next Passenger.Miles&lt;/dmn:text&gt;
              &lt;/dmn:literalExpression&gt;
            &lt;/dmn:contextEntry&gt;
            &lt;dmn:contextEntry&gt;
              &lt;dmn:variable name="Flight Number" typeRef="feel:string"/&gt;
              &lt;dmn:literalExpression&gt;
                &lt;dmn:text&gt;Best Alternate Flight.Flight Number&lt;/dmn:text&gt;
              &lt;/dmn:literalExpression&gt;
            &lt;/dmn:contextEntry&gt;
          &lt;/dmn:context&gt;
        &lt;/dmn:contextEntry&gt;
        &lt;dmn:contextEntry&gt;
          &lt;dmn:variable name="Remaining Waiting List" typeRef="tPassengerTable"/&gt;
          &lt;dmn:literalExpression&gt;
            &lt;dmn:text&gt;remove( Waiting List, 1 )&lt;/dmn:text&gt;
          &lt;/dmn:literalExpression&gt;
        &lt;/dmn:contextEntry&gt;
        &lt;dmn:contextEntry&gt;
          &lt;dmn:variable name="Updated Reassigned Passengers List" typeRef="tPassengerTable"/&gt;
          &lt;dmn:literalExpression&gt;
            &lt;dmn:text&gt;append( Reassigned Passengers List, Reassigned Passenger )&lt;/dmn:text&gt;
          &lt;/dmn:literalExpression&gt;
        &lt;/dmn:contextEntry&gt;
        &lt;dmn:contextEntry&gt;
          &lt;dmn:literalExpression&gt;
            &lt;dmn:text&gt;if count( Remaining Waiting List ) &gt; 0 then reassign next passenger( Remaining Waiting List, Updated Reassigned Passengers List, Flights ) else Updated Reassigned Passengers List&lt;/dmn:text&gt;
          &lt;/dmn:literalExpression&gt;
        &lt;/dmn:contextEntry&gt;
      &lt;/dmn:context&gt;
    &lt;/dmn:encapsulatedLogic&gt;
    &lt;dmn:variable name="reassign next passenger" typeRef="tPassengerTable"/&gt;
    &lt;dmn:knowledgeRequirement&gt;
      &lt;dmn:requiredKnowledge href="#b_HasCapacity"/&gt;
    &lt;/dmn:knowledgeRequirement&gt;
  &lt;/dmn:businessKnowledgeModel&gt;
  &lt;dmn:businessKnowledgeModel id="b_HasCapacity" name="has capacity"&gt;
    &lt;dmn:encapsulatedLogic&gt;
      &lt;dmn:formalParameter name="flight" typeRef="tFlight"/&gt;
      &lt;dmn:formalParameter name="rebooked list" typeRef="tPassengerTable"/&gt;
      &lt;dmn:literalExpression&gt;
        &lt;dmn:text&gt;flight.Capacity &gt; count( rebooked list[ Flight Number = flight.Flight Number ] )&lt;/dmn:text&gt;
      &lt;/dmn:literalExpression&gt;
    &lt;/dmn:encapsulatedLogic&gt;
    &lt;dmn:variable name="has capacity" typeRef="feel:boolean"/&gt;
  &lt;/dmn:businessKnowledgeModel&gt;
&lt;/dmn:definitions&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dmn-support-con_dmn-models"><a class="anchor" href="#dmn-support-con_dmn-models"></a> <a class="link" href="#dmn-support-con_dmn-models">5.2。Drools中的DMN支持</a></h3>
<div class="paragraph">
<p>Drools为符合性级别3的DMN 1.2模型提供设计和运行时支持，并为符合性级别3的DMN 1.1模型提供仅运行时支持。您可以通过以下几种方式将DMN模型与Drools决策服务集成：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用DMN设计器直接在Business Central中设计DMN模型。</p>
</li>
<li>
<p>将DMN文件导入到Business Central中的项目中（ <strong>菜单→设计→项目→导入资产</strong> ）。导入到Business Central中，在DMN设计器中打开并保存的所有DMN 1.1模型都将转换为DMN 1.2模型。</p>
</li>
<li>
<p>不使用Business Central将DMN文件打包为项目知识JAR（KJAR）文件的一部分。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>除了所有DMN一致性级别3要求之外，Drools还包括对FEEL和DMN模型组件的增强和修复，以优化使用Drools实施DMN决策服务的体验。从平台的角度来看，DMN模型与Drools中的任何其他业务资产一样，例如DRL文件或电子表格决策表，您可以将其包含在Drools项目中并部署到KIE Server中以启动DMN决策服务。</p>
</div>
<div class="paragraph">
<p>有关在Drools项目打包和部署方法中包含外部DMN文件的更多信息，请参见<a href="#_builddeployutilizeandrunsection">Build，Deploy，Utilize和Run</a> 。</p>
</div>
<div class="sect3">
<h4 id="dmn-feel-enhancements-ref_dmn-models"><a class="anchor" href="#dmn-feel-enhancements-ref_dmn-models"></a> <a class="link" href="#dmn-feel-enhancements-ref_dmn-models">5.2.1。在Drools中增强FEEL</a></h4>
<div class="paragraph">
<p>Drools在当前DMN实施中包括以下增强功能和FEEL的其他更改：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>空间敏感度</em> ：FEEL语言的DMN实现对空间不敏感。目的是避免基于上下文的不确定行为和基于不可见字符（例如空格）的行为差异。这意味着对于此实现，名为<code>first name</code>一个空格与<code>first name</code>里面有两个空格</p>
</li>
<li>
<p><em>清单功能<code>or()</code>和<code>and()</code></em> ：规范定义了两个列表函数，命名为<code>or()</code>和<code>and()</code> 。但是，根据FEEL语法，这些不是有效的函数名称，因为<code>and</code>和<code>or</code>是保留关键字。此实现将这些功能重命名为<code>any()</code>和<code>all()</code>分别针对DMN 1.2。</p>
</li>
<li>
<p><em>关键词<code>in</code>不能在变量名中使用</em> ：规范定义，任何关键字都可以作为变量名的一部分重用，但是由关键字引起的歧义<code>for …​ in …​ return</code>循环防止重用<code>in</code>关键词。支持所有其他关键字作为变量名的一部分。</p>
</li>
<li>
<p><em>匿名类型的属性中不支持关键字</em> ：FEEL不是强类型语言，并且解析器必须解决匿名类型的属性的名称部分中的歧义。解析器支持可重用关键字作为范围中定义的变量名的一部分，但是解析器不支持匿名类型的属性中的关键字。例如， <code>for item in Order.items return Federal Tax for Item( item )</code>是有效且受支持的FEEL表达式，其中一个名为<code>Federal Tax for Item(…​)</code>可以在范围内正确定义和调用。但是，表达<code>for i in [ {x and y : true, n : 1}, {x and y : false, n: 2} ] return i.x and y</code>不支持，因为匿名类型是在的迭代上下文中定义的<code>for</code>表达式和解析器无法解决歧义。</p>
</li>
<li>
<p><em>支持范围上的日期和时间文字</em> ：根据语法规则＃8，＃18，＃19，＃34和＃62， <code>date and time</code>范围内支持文字（第110-111页）。另一方面，第114页的10.3.2.7章与语法相矛盾，并表示不支持它们。此实现选择遵循语法和支持<code>date and time</code>范围上的文字，以及扩展规范以支持任何任意表达式（请参见下面的扩展）。</p>
</li>
<li>
<p><em>无效的时间语法</em> ：第112页的10.3.2.3.4章和有关<code>time</code>在第131页上，都指出<code>time</code>字符串词法表示法遵循XML Schema数据类型规范以及ISO 8601。根据XML Schema规范（ <a href="https://www.w3.org/TR/xmlschema-2/#time" class="bare">https://www.w3.org/TR/xmlschema-2/#time</a> ），时间的词汇表示遵循以下模式<code>hh:mm:ss.sss</code>没有任何主角。DMN规范在几个示例中使用前导“ T”，我们理解这是一个错字，与标准不符。</p>
</li>
<li>
<p><em>支持科学和十六进制表示法</em> ：此实现支持数字的科学和十六进制表示法。例如， <code>1.2e5</code> （科学计数法）， <code>0xD5</code> （十六进制表示法）。</p>
</li>
<li>
<p><em>支持将表达式作为范围内的</em>端点：此实现支持将表达式作为范围内的端点。例如，<code>[date("2016-11-24")..date("2016-11-27")]</code></p>
</li>
<li>
<p><em>支持其他类型</em> ：规范仅将以下内容定义为语言的基本类型：</p>
<div class="ulist">
<ul>
<li>
<p>数</p>
</li>
<li>
<p>串</p>
</li>
<li>
<p>布尔值</p>
</li>
<li>
<p>天数和持续时间</p>
</li>
<li>
<p>年月</p>
</li>
<li>
<p>时间</p>
</li>
<li>
<p>日期和时间</p>
<div class="paragraph">
<p>为了完整性和正交性，此实现还支持以下类型：</p>
</div>
</li>
<li>
<p>语境</p>
</li>
<li>
<p>清单</p>
</li>
<li>
<p>范围</p>
</li>
<li>
<p>功能</p>
</li>
<li>
<p>一元测试</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>一元测试的支持</em> ：为了完整性和正交性，一元测试以该语言的一等公民身份得到支持。它们是具有隐式单个参数的函数，并且可以与函数相同的方式调用。例如，</p>
<div class="listingblock">
<div class="title">UnaryTestAsFunction.feel</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">  {
      is minor : &lt; 18,
      Bob is minor : is minor( bob.age )
  }</code></pre>
</div>
</div>
</li>
<li>
<p><em>支持其他内置功能</em> ：支持以下其他功能：</p>
<div class="ulist">
<ul>
<li>
<p><code>now()</code> ：返回当前的本地日期和时间。</p>
</li>
<li>
<p><code>today()</code> ：返回当前的本地日期。</p>
</li>
<li>
<p><code>decision table()</code> ：返回一个决策表功能，尽管规范中提到了决策表。第114页上的功能无法按定义实现。</p>
</li>
<li>
<p><code>string( mask, p…​ )</code> ：返回根据掩码设置格式的字符串。有关掩码语法的详细信息，请参见Java String.format（）。例如， <code>string( "%4.2f", 7.1298 )</code>返回字符串<code>"7.12"</code> 。</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>支持其他日期和时间算术</em> ：将两个日期相减会返回一个日期和持续时间，以及两个日期之间的天数，而忽略了夏时制。例如，</p>
<div class="listingblock">
<div class="title">DateArithmetic.feel</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">date( "2017-05-12" ) - date( "2017-04-25" ) = duration( "P17D" )</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="dmn-model-enhancements-ref_dmn-models"><a class="anchor" href="#dmn-model-enhancements-ref_dmn-models"></a> <a class="link" href="#dmn-model-enhancements-ref_dmn-models">5.2.2。Drools中的DMN模型增强</a></h4>
<div class="paragraph">
<p>Drools在当前DMN实现中对DMN模型支持进行了以下增强：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>支持名称上带有空格的类型</em> ：DMN XML架构定义了类型引用，例如QNames。QName不允许使用空格。因此，不可能使用像FEEL这样的类型<code>date and time</code> ， <code>days and time duration</code>要么<code>years and months duration</code> 。此实现确实将此类typeref解析为字符串，并允许类型名称带有空格。但是，为了符合XML模式，它还将以下别名添加到可以代替使用的此类类型中：</p>
<div class="ulist">
<ul>
<li>
<p><code>date and time</code> =<code>dateTime</code></p>
</li>
<li>
<p><code>days and time duration</code> = <code>duration</code>要么<code>dayTimeDuration</code></p>
</li>
<li>
<p><code>years and months duration</code> = <code>duration</code>要么<code>yearMonthDuration</code></p>
<div class="paragraph">
<p>请注意，对于“持续时间”类型，用户可以简单地使用<code>duration</code>并且Drools引擎将推断适当的持续时间，或者<code>days and time duration</code>要么<code>years and months duration</code> 。</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><em>列表支持异构元素类型</em> ：当前，此实现支持具有异构元素类型的列表。这是一个实验性扩展，确实限制了某些功能和过滤器的功能。将来会重新评估该决定。</p>
</li>
<li>
<p><em>决策表和项目定义之间的TypeRef链接</em> ：在决策表/输入子句上，如果未定义任何值列表，则Drools引擎会自动检查类型引用，并在允许的值检查中进行定义。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="dmn-properties-ref_dmn-models"><a class="anchor" href="#dmn-properties-ref_dmn-models"></a> <a class="link" href="#dmn-properties-ref_dmn-models">5.2.3。Drools中可配置的DMN属性</a></h4>
<div class="paragraph">
<p>Drools提供以下DMN属性，您可以在KIE Server或客户端应用程序上执行DMN模型时进行配置：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">org.kie.dmn.strict一致性</dt>
<dd>
<p>启用后，默认情况下，此属性将禁用DMN标准以外提供的任何扩展或配置文件，例如某些辅助功能或DMN 1.2的增强功能，这些功能或向后移植到DMN 1.1的增强功能。您可以使用此属性将Drools引擎配置为仅支持纯DMN功能，例如在运行<a href="https://dmn-tck.github.io/tck/">DMN技术兼容性套件</a> （TCK）时。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认值：<code>false</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Dorg.kie.dmn.strictConformance=true</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">org.kie.dmn.runtime.typecheck</dt>
<dd>
<p>启用后，此属性允许验证符合DMN模型中声明的类型的实际值，作为DRD元素的输入或输出。您可以使用此属性来验证提供给DMN模型或DMN模型产生的数据是否与模型中指定的数据兼容。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认值：<code>false</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Dorg.kie.dmn.runtime.typecheck=true</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">org.kie.dmn.decisionservice.coercesingleton</dt>
<dd>
<p>默认情况下，此属性使定义单个输出决策的决策服务的结果成为输出决策值的单个值。禁用后，此属性会使定义单个输出决策的决策服务的结果成为<code>context</code>与该决定的单一条目。您可以使用此属性根据项目需求调整决策服务输出。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认值：<code>true</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Dorg.kie.dmn.decisionservice.coercesingleton=false</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">org.kie.dmn.profiles。$ PROFILE_NAME</dt>
<dd>
<p>当使用Java完全限定的名称进行赋值时，此属性在启动时将DMN概要文件加载到Drools引擎上。您可以使用此属性来实现预定义的DMN配置文件，其支持的功能不同于或超出DMN标准。例如，如果要使用Signavio DMN建模器创建DMN模型，请使用此属性将Signavio DMN概要文件中的功能实现到DMN决策服务中。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>-Dorg.kie.dmn.profiles.signavio=org.kie.dmn.signavio.KieDMNSignavioProfile</pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">org.kie.dmn.compiler.execmodel</dt>
<dd>
<p>启用后，此属性可使DMN决策表逻辑在运行时编译为可执行规则模型。您可以使用此属性来更有效地评估DMN决策表逻辑。当最初在项目编译期间未执行可执行模型编译时，此属性很有用。启用此属性可能会导致在Drools引擎进行第一次评估时增加了编译时间，但后续编译效率更高。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>默认值：<code>false</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Dorg.kie.dmn.compiler.execmodel=true</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dmn-model-creating-proc_dmn-models"><a class="anchor" href="#dmn-model-creating-proc_dmn-models"></a> <a class="link" href="#dmn-model-creating-proc_dmn-models">5.3。在Business Central中创建和编辑DMN模型</a></h3>
<div class="paragraph">
<p>您可以使用Business Central中的DMN设计器来设计DMN决策需求图（DRD），并为完整的DMN决策模型定义决策逻辑。Drools为3级一致性的DMN 1.2模型提供设计和运行时支持，并包括对FEEL和DMN模型组件的增强和修复，以优化使用Drools实现DMN决策服务的体验。Drools还为一致性级别3的DMN 1.1模型提供仅运行时支持，但是您导入到Business Central中，在DMN设计器中打开并保存的所有DMN 1.1模型都将转换为DMN 1.2模型。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在Business Central中，转到<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> ，然后单击项目名称。</p>
</li>
<li>
<p>在您的Business Central项目中创建或导入DMN文件。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>要创建DMN文件，请单击<strong>添加资产</strong> → <strong>DMN</strong> ，输入信息丰富的DMN型号名称，选择适当的<strong>Package</strong> ，然后单击<strong>Ok</strong> 。</p>
</div>
<div class="paragraph">
<p>要导入现有DMN文件，请点击<strong>导入资产</strong> ，输入DMN型号名称，选择适当的<strong>包</strong> ，选择要上传的DMN文件，然后点击<strong>确定</strong> 。</p>
</div>
<div class="paragraph">
<p>现在，新的DMN文件在“ <strong>项目资源管理器”</strong>的<strong>DMN</strong>面板中列出，并且将显示DMN决策需求图（DRD）画布。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">如果导入的DMN文件不包含布局信息，则导入的决策需求图（DRD）将在DMN设计器中自动格式化。在DMN设计器中单击“ <strong>保存</strong> ”以保存DRD布局。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</li>
<li>
<p>通过单击并拖动左侧工具栏中的DMN节点之一，开始向新的或导入的DMN决策需求图（DRD）添加组件：</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-drag-decision-node.png" alt="dmn拖动决策节点">
</div>
<div class="title">图92。添加DRD组件</div>
</div>
<div class="paragraph">
<p>以下DRD组件可用：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>决策</strong> ：将此节点用于DMN决策，其中一个或多个输入元素根据定义的决策逻辑确定输出。</p>
</li>
<li>
<p><strong>业务知识模型</strong> ：将此节点用于具有一个或多个决策元素的可重用功能。具有相同逻辑但依赖于不同子输入数据或子决策的决策使用业务知识模型来确定要遵循的过程。</p>
</li>
<li>
<p><strong>知识来源</strong> ：将此节点用于规范决策或业务知识模型的外部权限，文档，委员会或策略。知识源是对现实因素的引用，而不是可执行的业务规则。</p>
</li>
<li>
<p><strong>输入数据</strong> ：使用此节点获取决策节点或业务知识模型中使用的信息。输入数据通常包括与业务相关的业务级别概念或对象，例如贷款策略中使用的贷款申请人数据。</p>
</li>
<li>
<p><strong>文本注释</strong> ：使用此节点获取与输入数据节点，决策节点，业务知识模型或知识源相关的解释性注释。</p>
</li>
<li>
<p><strong>决策服务</strong> ：使用此节点可以封装一组实现为决策服务的可重用决策。决策服务可以在其他DMN模型中使用，并且可以从外部应用程序或BPMN业务流程中调用。</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>在DMN设计器画布中，双击新的DRD节点以输入信息性的节点名称。</p>
</li>
<li>
<p>如果节点是决策或业务知识模型，请选择该节点以显示节点选项，然后单击“ <strong>编辑”</strong>图标以打开DMN框式表达式设计器，以定义该节点的决策逻辑：</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-edit.png" alt="dmn决策">
</div>
<div class="title">图93。打开一个新的决策节点框式</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-bkm-edit.png" alt="dmn bkm编辑">
</div>
<div class="title">图94。打开一个新的商业知识模型盒装表达式</div>
</div>
<div class="paragraph">
<p>默认情况下，所有业务知识模型都被定义为包含文字FEEL表达式的框式函数表达式，外部JAVA或PMML函数的嵌套上下文表达式或任何类型的嵌套框式表达式。</p>
</div>
<div class="paragraph">
<p>对于决策节点，请单击未定义表以选择要使用的框式表达式的类型，例如框式文字表达式，框式上下文表达式，决策表或其他DMN框式表达式。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-boxed-expression-options.png" alt="dmn决定框式表达式选项">
</div>
<div class="title">图95。选择决策节点的逻辑类型</div>
</div>
<div class="paragraph">
<p>对于业务知识模型，请单击左上角的功能单元格以选择功能类型，或右键单击功能值单元格，选择<strong>Clear</strong> ，然后选择另一种类型的框式表达式。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-bkm-define.png" alt="dmn bkm定义">
</div>
<div class="title">图96。选择业务知识模型的功能或其他逻辑类型</div>
</div>
</div>
</div>
</li>
<li>
<p>在为决策节点（任何表达式类型）或业务知识模型（函数表达式）选择的带框表达式设计器中，单击适用的表单元格以定义表名称，变量数据类型，变量名称和值，函数参数和绑定，或FEEL表达式包含在决策逻辑中。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>您可以右键单击单元格以执行其他适用的操作，例如，插入或删除表的行和列或清除表的内容。</p>
</div>
<div class="paragraph">
<p>以下是决策节点的示例决策表，该决策节点根据贷款申请人的信用分数的定义范围确定信用分数等级：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-table-example1a.png" alt="dmn决策表example1a">
</div>
<div class="title">图97。信用评分等级的决策节点决策表</div>
</div>
<div class="paragraph">
<p>以下是业务知识模型的示例框式函数表达式，该函数表达式基于本金，利息，税金和保险（PITI）作为文字表达式来计算抵押付款：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-function-expression-example4.png" alt="dmn函数表达式example4">
</div>
<div class="title">图98。用于PITI计算的业务知识模型功能</div>
</div>
</div>
</div>
</li>
<li>
<p>为所选节点定义决策逻辑后，单击“ <strong>返回到<model_name>”</model_name></strong>以返回到DRD视图。</p>
</li>
<li>
<p>对于选定的DRD节点，使用可用的连接选项创建并连接到DRD中的下一个节点，或者单击并将新节点从左侧工具栏拖动到DRD画布上。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>节点类型确定支持哪些连接选项。例如， <strong>输入数据</strong>节点可以使用适用的连接类型连接到决策节点，知识源或文本注释，而<strong>知识源</strong>节点可以连接到任何DRD元素。<strong>决策</strong>节点只能连接到另一个决策或文本注释。</p>
</div>
<div class="paragraph">
<p>根据节点类型，可以使用以下连接类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>信息需求</strong> ：使用从输入数据节点或决策节点到另一个需要信息的决策节点的连接。</p>
</li>
<li>
<p><strong>知识需求</strong> ：使用从业务知识模型到决策节点或调用决策逻辑的另一个业务知识模型的这种连接。</p>
</li>
<li>
<p><strong>权限要求</strong> ：使用从输入数据节点或决策节点到相关知识源或从知识源到决策节点，业务知识模型或其他知识源的此连接。</p>
</li>
<li>
<p><strong>关联</strong> ：使用从输入数据节点，决策节点，业务知识模型或知识源到文本注释的此连接。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-input-connection-example.png" alt="dmn输入连接示例">
</div>
<div class="title">图99。将信用分数输入连接到信用分数评级决策</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-input-connection-example2.png" alt="dmn输入连接示例2">
</div>
</div>
</div>
</div>
</li>
<li>
<p>继续添加并定义决策模型的其余DRD组件。定期单击<strong>保存</strong>在DMN设计，以节省您的工作。</p>
</li>
<li>
<p>添加并定义DRD的所有组件后，单击“ <strong>保存”</strong>以保存并验证已完成的DRD。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>以下是贷款资格预审决策模型的DRD示例：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-example-drd.png" alt="dmn示例drd">
</div>
<div class="title">图100。完成DRD以进行贷款资格预审</div>
</div>
<div class="paragraph">
<p>以下是使用可重用决策服务的电话处理决策模型的示例DRD：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-example-drd3.png" alt="dmn示例drd3" width="90%">
</div>
<div class="title">图101。通过决策服务完成了用于电话呼叫的DRD</div>
</div>
<div class="paragraph">
<p>在DMN决策服务节点中，最底层的决策节点将来自决策服务外部的输入数据合并到决策服务节点的最上层的最终决策中。然后，可以在DMN模型的任何后续决策或业务知识要求中实施决策服务产生的顶级决策。您可以在其他DMN模型中重用DMN决策服务，以将相同的决策逻辑应用于不同的输入数据和不同的传出连接。</p>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="dmn-logic-defining-proc_dmn-models"><a class="anchor" href="#dmn-logic-defining-proc_dmn-models"></a> <a class="link" href="#dmn-logic-defining-proc_dmn-models">5.3.1。在Business Central中的框式表达式中定义DMN决策逻辑</a></h4>
<div class="paragraph">
<p>DMN中的框式表达式是用于在决策需求图（DRD）或决策需求图（DRG）中定义决策节点和业务知识模型的基础逻辑的表。一些框式表达式可以包含其他框式表达式，但是顶级框式表达式对应于单个DRD工件的决策逻辑。虽然带有一个或多个DRG的DRD表示DMN决策模型的流程，但带框的表达式定义了各个节点的实际决策逻辑。DRD和框式表达式一起形成了完整且功能齐全的DMN决策模型。</p>
</div>
<div class="paragraph">
<p>您可以使用Business Central中的DMN设计器使用内置的框式表达式为DRD组件定义决策逻辑。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>DMN文件是在Business Central中创建或导入的。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在Business Central中，转到<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> ，单击项目名称，然后选择要修改的DMN文件。</p>
</li>
<li>
<p>在DMN设计器画布中，选择要定义的决策节点或业务知识模型节点，然后单击“ <strong>编辑”</strong>图标以打开DMN框式表达式设计器：</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-edit.png" alt="dmn决策">
</div>
<div class="title">图102。打开一个新的决策节点框式</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-bkm-edit.png" alt="dmn bkm编辑">
</div>
<div class="title">图103。打开一个新的商业知识模型盒装表达式</div>
</div>
<div class="paragraph">
<p>默认情况下，所有业务知识模型都被定义为包含文字FEEL表达式的框式函数表达式，外部JAVA或PMML函数的嵌套上下文表达式或任何类型的嵌套框式表达式。</p>
</div>
<div class="paragraph">
<p>对于决策节点，请单击未定义表以选择要使用的框式表达式的类型，例如框式文字表达式，框式上下文表达式，决策表或其他DMN框式表达式。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-boxed-expression-options.png" alt="dmn决定框式表达式选项">
</div>
<div class="title">图104。选择决策节点的逻辑类型</div>
</div>
<div class="paragraph">
<p>对于业务知识模型节点，请单击左上角的功能单元格以选择功能类型，或右键单击功能值单元格，选择<strong>Clear</strong> ，然后选择另一种类型的框式表达式。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-bkm-define.png" alt="dmn bkm定义">
</div>
<div class="title">图105。选择业务知识模型的功能或其他逻辑类型</div>
</div>
</div>
</div>
</li>
<li>
<p>对于此示例，使用决策节点，然后选择“ <strong>决策表”</strong>作为框式表达式类型。</p>
<div class="paragraph">
<p>DMN中的决策表是以表格格式直观显示一个或多个规则。每个规则由表中的一行组成，并包括定义该特定行的条件（输入）和结果（输出）的列。</p>
</div>
</li>
<li>
<p>单击输入列标题以定义输入条件的名称和数据类型。例如，将输入列命名为“ <strong>信用评分”。FICO</strong>与<code>number</code>数据类型。此列指定数字信用评分值或贷款申请人的范围。</p>
</li>
<li>
<p>单击输出列标题以定义输出值的名称和数据类型。例如，将输出列命名为“ <strong>信用评分等级”</strong> ，然后在“ <strong>数据类型”</strong>选项旁边，单击“ <strong>管理”</strong>以转到“ <strong>数据类型”</strong>页面，您可以在其中创建以评分等级为约束的自定义数据类型。</p>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-manage-data-types.png" alt="DMN管理数据类型">
</div>
<div class="title">图106。管理列标题值的数据类型</div>
</div>
</li>
<li>
<p>在“ <strong>数据类型”</strong>页上，单击“ <strong>添加”</strong> ，然后<strong>将</strong> <strong>Credit_Score_Rating</strong>数据类型创建为<code>string</code> ：</p>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-custom-data-type-add.png" alt="dmn自定义数据类型添加">
</div>
<div class="title">图107。添加新的数据类型</div>
</div>
</li>
<li>
<p>单击“ <strong>约束”</strong> ，从下拉选项中选择“ <strong>枚举</strong> ”，然后添加以下约束：</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>"Excellent"</code></p>
</li>
<li>
<p><code>"Good"</code></p>
</li>
<li>
<p><code>"Fair"</code></p>
</li>
<li>
<p><code>"Poor"</code></p>
</li>
<li>
<p><code>"Bad"</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-custom-data-type-constraints.png" alt="dmn自定义数据类型约束">
</div>
<div class="title">图108。向新数据类型添加约束</div>
</div>
<div class="paragraph">
<p>有关指定数据类型的约束类型和语法要求的信息，请参阅《 <a href="https://www.omg.org/spec/DMN">决策模型和注释规范》</a> 。</p>
</div>
</div>
</div>
</li>
<li>
<p>单击<strong>确定</strong>以保存约束，然后单击<strong>保存</strong>以保存数据类型。</p>
</li>
<li>
<p>返回“ <strong>信用评分等级”</strong>决策表，单击“ <strong>信用评分等级”</strong>列标题，然后将数据类型设置为此新的自定义数据类型。</p>
</li>
<li>
<p>使用<strong>信用评分。FICO</strong>输入列可定义信用评分值或值范围，并使用“ <strong>信用评分等级”</strong>列指定您在<strong>Credit_Score_Rating</strong>数据类型中定义的相应等级之一。</p>
<div class="paragraph">
<p>右键单击任何值单元格以插入或删除行（规则）或列（子句）。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-table-example1a.png" alt="dmn决策表example1a">
</div>
<div class="title">图109。信用评分等级的决策节点决策表</div>
</div>
</li>
<li>
<p>定义所有规则后，请单击决策表的左上角以定义规则“ <strong>命中策略”</strong>和“ <strong>内置聚合器”</strong> （仅适用于<strong>COLLECT</strong>命中策略）。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>命中策略确定当决策表中的多个规则与提供的输入值匹配时如何获得结果。内置的聚合器确定使用<strong>COLLECT匹配</strong>策略时如何聚合规则值。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-hit-policies.png" alt="dmn热门政策">
</div>
<div class="title">图110。定义决策表命中策略</div>
</div>
<div class="paragraph">
<p>以下示例是一个更复杂的决策表，该表将贷款的申请人资格确定为同一贷款预资格决策模型中的最终决策节点：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-table-example3.png" alt="dmn决策表example3">
</div>
<div class="title">图111。贷款资格预审决定表</div>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>对于除决策表以外的装箱表达式类型，您可以类似地遵循这些准则来导航装箱表达式表并为决策逻辑定义变量和参数，但要根据装箱表达式类型的要求。一些框式表达式（例如框式文字表达式）可以是单列表，而其他框式表达式（例如函数，上下文和调用表达式）可以是具有其他类型嵌套框式表达式的多列表。</p>
</div>
<div class="paragraph">
<p>例如，以下框式上下文表达式定义了参数，这些参数确定贷款申请人是否可以根据本金，利息，税金和保险（PITI）满足最低抵押贷款付款要求，用子上下文表达式表示为前端比率计算：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-context-expression-example2.png" alt="dmn上下文表达式example2">
</div>
<div class="title">图112。前端客户端PITI比例的框式上下文表达式</div>
</div>
<div class="paragraph">
<p>以下框式函数表达式将每月抵押分期付款确定为贷款决策中的业务知识模型，并且函数值定义为嵌套上下文表达式：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-function-expression-example3.png" alt="dmn函数表达式example3">
</div>
<div class="title">图113。用于商业知识模型中分期付款计算的盒装函数表达式</div>
</div>
<div class="paragraph">
<p>有关每种装箱表达式类型的更多信息和示例，请参阅装箱表达式中的<a href="#dmn-boxed-expressions-con_dmn-models">DMN决策逻辑</a> 。</p>
</div>
</div>
<div class="sect3">
<h4 id="dmn-data-types-defining-proc_dmn-models"><a class="anchor" href="#dmn-data-types-defining-proc_dmn-models"></a> <a class="link" href="#dmn-data-types-defining-proc_dmn-models">5.3.2。在Business Central中为DMN框式表达式创建自定义数据类型</a></h4>
<div class="paragraph">
<p>在Business Central的DMN框式表达式中，数据类型确定在框式表达式的关联表，列或字段中使用的数据结构。您可以使用默认的DMN数据类型（例如String，Number，Boolean），也可以创建自定义数据类型来指定要为装箱表达式值实现的其他字段和约束。</p>
</div>
<div class="paragraph">
<p>您为盒装表达式创建的自定义数据类型可以是简单的或结构化的：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>简单</strong>数据类型只有名称和类型分配。例： <code>Age (number)</code> 。</p>
</li>
<li>
<p><strong>结构化</strong>数据类型包含与父数据类型关联的多个字段。示例：单一类型<code>Person</code>包含字段<code>Name (string)</code> ， <code>Age (number)</code> ， <code>Email (string)</code> 。</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>DMN文件是在Business Central中创建或导入的。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在Business Central中，转到<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> ，单击项目名称，然后选择要修改的DMN文件。</p>
</li>
<li>
<p>在DMN设计器画布中，选择要为其定义数据类型的决策节点或业务知识模型，然后单击“ <strong>编辑”</strong>图标以打开DMN框式表达式设计器。</p>
</li>
<li>
<p>如果框式表达式用于尚未定义的决策节点，请单击未定义表以选择要使用的框式表达式的类型，例如框式文字表达式，框式上下文表达式，决策表或其他DMN框式表达式。</p>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-boxed-expression-options.png" alt="dmn决定框式表达式选项">
</div>
<div class="title">图114。选择决策节点的逻辑类型</div>
</div>
</li>
<li>
<p>单击要为其定义数据类型的表标题，列标题或参数字段（取决于框式表达式类型）的单元格，然后单击“ <strong>管理”</strong>转到“ <strong>数据类型”</strong>页面，您可以在其中创建自定义数据类型。</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-manage-data-types.png" alt="DMN管理数据类型">
</div>
<div class="title">图115。管理列标题值的数据类型</div>
</div>
<div class="paragraph">
<p>您还可以通过选择DMN设计器右上角的<strong>图属性</strong>图标来设置和管理指定决策节点或业务知识模型节点的定制数据类型：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-manage-data-types1a.png" alt="DMN管理数据类型">
</div>
<div class="title">图116。管理图属性中的数据类型</div>
</div>
<div class="paragraph">
<p>您为装箱表达式中的指定单元格定义的数据类型决定了在装箱表达式中该关联表，列或字段中使用的数据的结构。</p>
</div>
<div class="paragraph">
<p>在此示例中，DMN决策表的输出列“ <strong>信用评分等级</strong> ”定义了基于申请人的信用评分的一组自定义信用评分等级。</p>
</div>
</div>
</div>
</li>
<li>
<p>在“ <strong>数据类型”</strong>页上，单击“ <strong>添加”</strong> ，然后<strong>将</strong> <strong>Credit_Score_Rating</strong>数据类型创建为<code>string</code> ：</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-custom-data-type-add.png" alt="dmn自定义数据类型添加">
</div>
<div class="title">图117。添加新的数据类型</div>
</div>
<div class="paragraph">
<p>如果数据类型需要项目列表，请启用“ <strong>列表”</strong>设置。</p>
</div>
</div>
</div>
</li>
<li>
<p>单击“ <strong>约束”</strong> ，从下拉选项中选择“ <strong>枚举</strong> ”，然后添加以下约束：</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>"Excellent"</code></p>
</li>
<li>
<p><code>"Good"</code></p>
</li>
<li>
<p><code>"Fair"</code></p>
</li>
<li>
<p><code>"Poor"</code></p>
</li>
<li>
<p><code>"Bad"</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-custom-data-type-constraints.png" alt="dmn自定义数据类型约束">
</div>
<div class="title">图118。向新数据类型添加约束</div>
</div>
<div class="paragraph">
<p>有关指定数据类型的约束类型和语法要求的信息，请参阅《 <a href="https://www.omg.org/spec/DMN">决策模型和注释规范》</a> 。</p>
</div>
</div>
</div>
</li>
<li>
<p>单击<strong>确定</strong>以保存约束，然后单击<strong>保存</strong>以保存数据类型。</p>
</li>
<li>
<p>返回“ <strong>信用评分等级”</strong>决策表，单击“ <strong>信用评分等级”</strong>列标题，将数据类型设置为该新的自定义数据类型，然后使用您指定的<strong>信用</strong>等级约束定义该列的规则值。</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-table-example1a.png" alt="dmn决策表example1a">
</div>
<div class="title">图119。信用评分等级决定表</div>
</div>
<div class="paragraph">
<p>在此业务情景的DMN决策模型中， <strong>信用评分评估</strong>决策将流入以下还需要自定义数据类型的“ <strong>贷款资格预审”</strong>决策：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-manage-data-types-blank.png" alt="dmn管理数据类型为空">
</div>
<div class="title">图120。贷款资格预审决定表</div>
</div>
</div>
</div>
</li>
<li>
<p>继续此示例，返回到“ <strong>数据类型”</strong>窗口，单击“ <strong>添加”</strong> ，然后将<strong>Loan_Qualification</strong>数据类型创建为<code>Structure</code>没有任何限制。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>保存新的结构化数据类型时，将显示第一个子字段，以便您可以开始在此父数据类型中定义嵌套数据字段。您可以在框式表达式中将这些子字段与父结构化数据类型关联使用，例如决策表中的嵌套列标题或上下文或函数表达式中的嵌套表参数。</p>
</div>
<div class="paragraph">
<p>对于其他子字段，在<strong>Loan_Qualification</strong>数据类型旁边，选择设置图标（三个垂直点），然后选择<strong>插入嵌套字段</strong> ：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-manage-data-types-structured.png" alt="dmn管理结构化的数据类型">
</div>
<div class="title">图121。使用嵌套字段添加新的结构化数据类型</div>
</div>
</div>
</div>
</li>
<li>
<p>对于此示例，在结构化的<strong>Loan_Qualification</strong>数据类型下，添加带有以下内容的<strong>Qualification</strong>字段： <code>"Qualified"</code>和<code>"Not Qualified"</code>枚举约束，以及没有约束的<strong>Reason</strong>字段。还添加简单的<strong>Back_End_Ratio</strong>和<strong>Front_End_Ratio</strong>数据类型，两者都<code>"Sufficient"</code>和<code>"Insufficient"</code>枚举约束。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>为您创建的每种数据类型单击<strong>保存</strong> 。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-manage-data-types-structured2.png" alt="dmn管理结构化的数据类型2">
</div>
<div class="title">图122。添加具有约束的嵌套数据类型</div>
</div>
</div>
</div>
</li>
<li>
<p>返回到决策表，对于每一列，单击列标题单元格，将数据类型设置为新的对应自定义数据类型，并根据需要使用指定的约束定义列的规则值（如果适用）。</p>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-table-example3.png" alt="dmn决策表example3">
</div>
<div class="title">图123。贷款资格预审决定表</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>对于除决策表以外的装箱表达式类型，您可以类似地遵循这些准则来导航装箱表达式表并根据需要定义自定义数据类型。</p>
</div>
<div class="paragraph">
<p>例如，以下框式函数表达式使用自定义<code>tCandidate</code>和<code>tProfile</code>结构化数据类型以关联数据以实现在线约会兼容性：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-manage-data-types-structured3.png" alt="dmn管理结构化数据类型3">
</div>
<div class="title">图124。盒装函数表达式可实现在线约会兼容性</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-manage-data-types-structured3a.png" alt="dmn管理structural3a数据类型">
</div>
<div class="title">图125。自定义数据类型定义以实现在线约会兼容性</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-manage-data-types-structured3b.png" alt="DMN管理3D数据类型">
</div>
<div class="title">图126。具有自定义数据类型的参数定义，可实现在线约会兼容性</div>
</div>
</div>
<div class="sect3">
<h4 id="dmn-included-models-con_dmn-models"><a class="anchor" href="#dmn-included-models-con_dmn-models"></a> <a class="link" href="#dmn-included-models-con_dmn-models">5.3.3。Business Central中DMN文件中包含的模型</a></h4>
<div class="paragraph">
<p>在Business Central的DMN设计器中，可以使用“ <strong>包含的模型”</strong>选项卡将项目中的其他DMN模型和预测模型标记语言（PMML）模型包括在指定的DMN文件中。在另一个DMN文件中包含DMN模型时，可以在同一决策需求图（DRD）中使用两个模型的所有节点和逻辑。在DMN文件中包含PMML模型时，可以将该PMML模型作为DMN决策节点或业务知识模型节点的框式函数表达式来调用。</p>
</div>
<div class="paragraph">
<p>您不能在Business Central中包括来自其他项目的DMN或PMML模型。</p>
</div>
<div class="sect4">
<h5 id="dmn-included-models-dmn-proc_dmn-models"><a class="anchor" href="#dmn-included-models-dmn-proc_dmn-models"></a> <a class="link" href="#dmn-included-models-dmn-proc_dmn-models">5.3.3.1。在Business Central的DMN文件中包括其他DMN模型</a></h5>
<div class="paragraph">
<p>在Business Central中，您可以将项目中的其他DMN模型包括在指定的DMN文件中。当在另一个DMN文件中包含DMN模型时，可以在同一决策需求图（DRD）中使用两个模型的所有节点和逻辑，但是不能从包含的模型中编辑节点。要编辑包含模型的节点，必须直接更新包含模型的源文件。如果您为包含的DMN模型更新源文件，请打开包含DMN模型的DMN文件（或关闭重新打开）以验证更改。</p>
</div>
<div class="paragraph">
<p>您不能在Business Central中包括来自其他项目的DMN模型。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>DMN模型已创建或导入（如<code>.dmn</code>文件）在Business Central中与要包含模型的DMN文件位于同一项目中。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在Business Central中，转到<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> ，单击项目名称，然后选择要修改的DMN文件。</p>
</li>
<li>
<p>在DMN设计器中，单击“ <strong>包含的模型”</strong>选项卡。</p>
</li>
<li>
<p>单击<strong>包含型号</strong> ，请从<strong>型号</strong>列表项目中的DMN模式，为包括模型输入唯一的名称，并单击<strong>包括</strong> ：</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-include-model.png" alt="DMN包含模型">
</div>
<div class="title">图127。包括DMN模型</div>
</div>
<div class="paragraph">
<p>DMN模型已添加到此DMN文件，并且包含的模型中的所有DRD节点都列在<strong>Decision Navigator</strong>视图中的<strong>Decision</strong> <strong>Components</strong>下：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-include-model-list.png" alt="dmn包含型号清单">
</div>
<div class="title">图128。具有包含的DMN模型的决策组件的DMN文件</div>
</div>
<div class="paragraph">
<p>DMN文件的“ <strong>数据类型”</strong>选项卡中还列出了包含的模型中的所有数据类型：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-include-model-data-types.png" alt="dmn包含模型数据类型">
</div>
<div class="title">图129。具有包含的DMN模型中的数据类型的DMN文件</div>
</div>
</div>
</div>
</li>
<li>
<p>在DMN设计器的“ <strong>模型”</strong>选项卡中，单击并将包含的DRD组件拖放到画布上，以开始在DRD中实现它们：</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-include-model-drd.png" alt="dmn包括模型drd">
</div>
<div class="title">图130。从包含的DMN模型中添加DRD组件</div>
</div>
<div class="paragraph">
<p>要从包含的模型中编辑DRD节点或数据类型，必须直接更新包含的模型的源文件。如果您为包含的DMN模型更新源文件，请打开包含DMN模型的DMN文件（或关闭重新打开）以验证更改。</p>
</div>
<div class="paragraph">
<p>要编辑包含的模型名称或从DMN文件中删除包含的模型，请使用DMN设计器中的“ <strong>包含的模型”</strong>选项卡。</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">当您删除包含的模型时，DRD中当前使用的该包含的模型中的所有节点也会被删除。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="dmn-included-models-pmml-proc_dmn-models"><a class="anchor" href="#dmn-included-models-pmml-proc_dmn-models"></a> <a class="link" href="#dmn-included-models-pmml-proc_dmn-models">5.3.3.2。在Business Central的DMN文件中包括PMML模型</a></h5>
<div class="paragraph">
<p>在Business Central中，您可以将项目中的预测模型标记语言（PMML）模型包括在指定的DMN文件中。在DMN文件中包含PMML模型时，可以将该PMML模型作为DMN决策节点或业务知识模型节点的框式函数表达式来调用。如果为包含的PMML模型更新源文件，则必须删除DML文件中的PMML模型并将其重新包括在内，以应用源更改。</p>
</div>
<div class="paragraph">
<p>您不能在Business Central中包括来自其他项目的PMML模型。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>导入了PMML模型（如<code>.pmml</code>文件）在Business Central中与要包含模型的DMN文件位于同一项目中。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在您的DMN项目中，将以下依赖项添加到项目中<code>pom.xml</code>文件以启用PMML评估：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Required for the PMML compiler --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;kie-pmml&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;

&lt;!-- Alternative dependencies for JPMML Evaluator, override `kie-pmml` dependency --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie&lt;/groupId&gt;
  &lt;artifactId&gt;kie-dmn-jpmml&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.jpmml&lt;/groupId&gt;
  &lt;artifactId&gt;pmml-evaluator&lt;/artifactId&gt;
  &lt;version&gt;1.4.9&lt;/version&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.jpmml&lt;/groupId&gt;
  &lt;artifactId&gt;pmml-evaluator-extension&lt;/artifactId&gt;
  &lt;version&gt;1.4.9&lt;/version&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>访问项目<code>pom.xml</code>文件在Business Central中，您可以选择项目中的任何现有资产，然后在屏幕左侧的<strong>Project Explorer</strong>菜单中，单击<strong>Customize View</strong>齿轮图标，然后选择<strong>Repository View</strong> → <strong>pom.xml</strong> 。</p>
</div>
<div class="paragraph">
<p>如果要将完整的PMML规范实现与用于PMML的Java Evaluator API（JPMML）一起使用，请在DMN项目中使用另一组JPMML依赖项。如果JPMML依赖项和标准<code>kie-pmml</code>依赖都存在， <code>kie-pmml</code>依赖项已禁用。有关JPMML许可条款的信息，请参见<a href="https://openscoring.io/">Openscoring.io</a> 。</p>
</div>
</div>
</div>
</li>
<li>
<p>如果您在DMN项目中添加了JPMML依赖项以使用JPMML评估程序，请下载以下JAR文件并将其添加到<code>~/kie-server.war/WEB-INF/lib</code>和<code>~/business-central.war/WEB-INF/lib</code> Drools发行版中的目录：</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://mvnrepository.com/artifact/org.kie/kie-dmn-jpmml/7.26.0.Final">KIE JPMML集成7.26.0。在线Maven存储库中的最终</a> JAR文件</p>
</li>
<li>
<p>在线Maven存储库中的<a href="https://mvnrepository.com/artifact/org.jpmml/pmml-evaluator/1.4.9">JPMML Evaluator 1.4.9</a> JAR文件</p>
</li>
<li>
<p>在线Maven存储库中的<a href="https://mvnrepository.com/artifact/org.jpmml/pmml-evaluator-extension/1.4.9">JPMML Evaluator Extensions 1.4.9</a> JAR文件</p>
</li>
</ul>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>需要这些工件才能在KIE Server和Business Central中启用JPMML评估。</p>
</div>
</div>
</div>
</li>
<li>
<p>在Business Central中，转到<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> ，单击项目名称，然后选择要修改的DMN文件。</p>
</li>
<li>
<p>在DMN设计器中，单击“ <strong>包含的模型”</strong>选项卡。</p>
</li>
<li>
<p>点击<strong>Include Model</strong> ，从您的项目的<strong>Models</strong>列表中选择一个PMML模型，为包含的模型输入一个唯一的名称，然后点击<strong>Include</strong> ：</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-include-model-pmml.png" alt="dmn include pmml模型">
</div>
<div class="title">图131。包括PMML模型</div>
</div>
<div class="paragraph">
<p>PMML模型已添加到此DMN文件中：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-include-model-list-pmml.png" alt="dmn包括型号清单pmml">
</div>
<div class="title">图132。包含PMML模型的DMN文件</div>
</div>
</div>
</div>
</li>
<li>
<p>在DMN设计器的“ <strong>模型”</strong>选项卡中，选择或创建要在其中调用PMML模型的决策节点或业务知识模型节点，然后单击“ <strong>编辑”</strong>图标以打开DMN框式表达式设计器：</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-decision-edit.png" alt="dmn决策">
</div>
<div class="title">图133。打开一个新的决策节点框式</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-bkm-edit.png" alt="dmn bkm编辑">
</div>
<div class="title">图134。打开一个新的商业知识模型盒装表达式</div>
</div>
</div>
</div>
</li>
<li>
<p>将表达式类型设置为<strong>Function</strong> （业务知识模型节点的默认值），单击左上角的函数单元格，然后选择<strong>PMML</strong> 。</p>
</li>
<li>
<p>在表的<strong>文档</strong>和<strong>模型</strong>行中，双击未定义的单元格以指定包含的PMML文档以及该文档中的相关PMML模型：</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-include-model-expression-pmml.png" alt="dmn include模型表达式pmml">
</div>
<div class="title">图135。在DMN商业知识模型中添加PMML模型</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-function-expression-example5.png" alt="dmn函数表达式example5">
</div>
<div class="title">图136。DMN商业知识模型中的示例PMML定义</div>
</div>
<div class="paragraph">
<p>如果为包含的PMML模型更新源文件，则必须删除DML文件中的PMML模型并将其重新包括在内，以应用源更改。</p>
</div>
<div class="paragraph">
<p>要编辑包含的模型名称或从DMN文件中删除包含的模型，请使用DMN设计器中的“ <strong>包含的模型”</strong>选项卡。</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dmn-documentation-con_dmn-models"><a class="anchor" href="#dmn-documentation-con_dmn-models"></a> <a class="link" href="#dmn-documentation-con_dmn-models">5.3.4。Business Central中的DMN模型文档</a></h4>
<div class="paragraph">
<p>在Business Central的DMN设计器中，可以使用“ <strong>文档”</strong>选项卡生成DMN模型的报告，您可以将其打印或下载为HTML文件以供离线使用。DMN模型报告包含DMN模型中的所有决策需求图（DRD），数据类型和框式。您可以使用此报告来共享您的DMN模型详细信息，或作为内部报告工作流的一部分。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-documentation.png" alt="DMN文档">
</div>
<div class="title">图137。DMN模型报告示例</div>
</div>
</div>
<div class="sect3">
<h4 id="dmn-designer-nav-ref_dmn-models"><a class="anchor" href="#dmn-designer-nav-ref_dmn-models"></a> <a class="link" href="#dmn-designer-nav-ref_dmn-models">5.3.5。Business Central中的DMN设计器导航和属性</a></h4>
<div class="paragraph">
<p>Business Central中的DMN设计器提供了以下附加功能，以帮助您浏览决策需求图（DRD）的组件和属性。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">DMN文件和图视图</dt>
<dd>
<p>在DMN设计<strong>器的</strong>左上角，选择“ <strong>项目资源管理器”</strong>视图以在所有DMN和其他文件之间导航，或者选择“ <strong>决策导航器”</strong>视图以在所选DRD的决策组件，图形和带框表达式之间导航：</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-designer-project-view.png" alt="dmn designer项目视图">
</div>
<div class="title">图138。项目浏览器视图</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-designer-nav-view.png" alt="dmn designer导航视图">
</div>
<div class="title">图139。决策导航器视图</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-designer-nav-view2.png" alt="dmn designer导航view2">
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">DMN文件（在“ <strong>包括的模型”</strong>选项卡中）所<strong>包含的</strong>任何DMN模型的DRD组件也在DMN文件的“ <strong>决策组件”</strong>面板中列出。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>在DMN设计器的右上角，选择“ <strong>浏览”图</strong>图标以查看选定DRD的提升预览并在选定DRD的节点之间导航：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-designer-preview.png" alt="dmn designer预览">
</div>
<div class="title">图140。探索图视图</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">DRD属性和设计</dt>
<dd>
<p>在DMN设计器的右上角，选择“ <strong>图”属性</strong>图标以修改标识信息，数据类型和所选DRD，DRD节点或框式表达式单元格的外观：</p>
<div class="openblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-designer-properties.png" alt="dmn Designer属性">
</div>
<div class="title">图141。DRD节点属性</div>
</div>
<div class="paragraph">
<p>若要查看整个DRD的属性，请单击DRD画布背景而不是特定节点。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">DRD搜索</dt>
<dd>
<p>在DMN设计器的右上角，使用搜索栏搜索DRD中显示的文本。搜索功能在具有许多节点的复杂DRD中特别有用：</p>
<div class="imageblock">
<div class="content">
<img src="./dmn/dmn-designer-search.png" alt="dmn Designer搜索">
</div>
<div class="title">图142。DRD搜索</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dmn-execution-con"><a class="anchor" href="#dmn-execution-con"></a> <a class="link" href="#dmn-execution-con">5.4。DMN模型执行</a></h3>
<div class="paragraph">
<p>您可以使用Business Central在Drools项目中创建或导入DMN文件，也可以将DMN文件打包为项目知识JAR（KJAR）文件的一部分，而无需Business Central。在Drools项目中实现DMN文件后，可以通过将包含该DIE文件的KIE容器部署到KIE Server进行远程访问，或者通过直接将KIE容器作为调用应用程序的依赖项进行操作，来执行DMN决策服务。还提供了用于创建和部署DMN知识包的其他选项，并且对于所有类型的知识资产（例如DRL文件或流程定义），大多数选项都相似。</p>
</div>
<div class="paragraph">
<p>有关在项目打包和部署方法中包含外部DMN资产的信息，请参阅<a href="#_builddeployutilizeandrunsection">Build，Deploy，Utilize和Run</a> 。</p>
</div>
<div class="sect3">
<h4 id="dmn-execution-embedded-proc"><a class="anchor" href="#dmn-execution-embedded-proc"></a> <a class="link" href="#dmn-execution-embedded-proc">5.4.1。将DMN调用直接嵌入Java应用程序中</a></h4>
<div class="paragraph">
<p>当知识资产直接嵌入到调用程序中或使用KJAR的Maven依赖项在物理上拉入知识资产时，KIE容器是本地的。如果代码的版本与DMN定义的版本之间存在紧密的关系，通常将知识资产直接嵌入到项目中。在有意更新和重新部署应用程序之后，对决策的任何更改都会生效。这种方法的好处是，正确的操作不依赖于运行时的任何外部依赖关系，这可能是锁定环境的限制。</p>
</div>
<div class="paragraph">
<p>使用Maven依赖项可以提供更大的灵活性，因为该决策的特定版本可以动态更改（例如，通过使用系统属性），并且可以定期对其进行扫描以查找更新并自动进行更新。这引入了对服务部署时间的外部依赖性，但是在本地执行决策，从而减少了对运行时可用的外部服务的依赖。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>KIE Server已安装和配置，包括已知用户名和具有<code>kie-server</code>角色。有关安装选项，请参阅<a href="#_installationandsetup">安装和设置（Core和IDE）</a> 。</p>
</li>
<li>
<p>您已将DMN项目构建为KJAR工件并将其部署到KIE Server。理想情况下，您已将DMN项目构建为可执行模型以提高执行效率：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn clean install -DgenerateDMNModel=yes</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关项目打包，部署和可执行模型的更多信息，请参见<a href="#_builddeployutilizeandrunsection">Build，Deploy，Utilize和Run</a> 。</p>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在客户端应用程序中，将以下依赖项添加到Java项目的相关类路径中：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Required for the DMN runtime API --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie&lt;/groupId&gt;
  &lt;artifactId&gt;kie-dmn-core&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- Required if not using classpath KIE container --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie&lt;/groupId&gt;
  &lt;artifactId&gt;kie-ci&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code><version></code>是项目中当前使用的Drools的Maven工件版本（例如7.26.0。Final-redhat-00005）。</p>
</div>
</div>
</div>
</li>
<li>
<p>从创建一个KIE容器<code>classpath</code>要么<code>ReleaseId</code> ：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();

ReleaseId releaseId = kieServices.newReleaseId( "org.acme", "my-kjar", "1.0.0" );
KieContainer kieContainer = kieServices.newKieContainer( releaseId );</code></pre>
</div>
</div>
<div class="paragraph">
<p>替代选项：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();

KieContainer kieContainer = kieServices.getKieClasspathContainer();</code></pre>
</div>
</div>
</li>
<li>
<p>获得<code>DMNRuntime</code>通过使用该模型从KIE容器和要评估的DMN模型的引用中<code>namespace</code>和<code>modelName</code> ：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DMNRuntime dmnRuntime = KieRuntimeFactory.of(kieContainer.getKieBase()).get(DMNRuntime.class);

String namespace = "http://www.redhat.com/_c7328033-c355-43cd-b616-0aceef80e52a";
String modelName = "dmn-movieticket-ageclassification";

DMNModel dmnModel = dmnRuntime.getModel(namespace, modelName);</code></pre>
</div>
</div>
</li>
<li>
<p>为所需模型执行决策服务：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DMNContext dmnContext = dmnRuntime.newContext();  <i class="conum" data-value="1"></i><b>(1)</b>

for (Integer age : Arrays.asList(1,12,13,64,65,66)) {
    dmnContext.set("Age", age);  <i class="conum" data-value="2"></i><b>(2)</b>
    DMNResult dmnResult =
        dmnRuntime.evaluateAll(dmnModel, dmnContext);  <i class="conum" data-value="3"></i><b>(3)</b>

    for (DMNDecisionResult dr : dmnResult.getDecisionResults()) {  <i class="conum" data-value="4"></i><b>(4)</b>
        log.info("Age: " + age + ", " +
                 "Decision: '" + dr.getDecisionName() + "', " +
                 "Result: " + dr.getResult());
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>实例化新的DMN上下文作为模型评估的输入。请注意，此示例多次遍历“年龄分类”决策。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>为输入DMN上下文分配输入变量。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i> <b>3</b></td>
<td>评估DMN模型中定义的所有DMN决策。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i> <b>4</b></td>
<td>每次评估可能会得出一个或多个结果，从而形成循环。</td>
</tr>
</tbody></table>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>本示例输出以下输出：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Age 1 Decision 'AgeClassification' : Child
Age 12 Decision 'AgeClassification' : Child
Age 13 Decision 'AgeClassification' : Adult
Age 64 Decision 'AgeClassification' : Adult
Age 65 Decision 'AgeClassification' : Senior
Age 66 Decision 'AgeClassification' : Senior</pre>
</div>
</div>
<div class="paragraph">
<p>如果先前未将DMN模型编译为可执行模型以提高执行效率，则可以在执行DMN模型时启用以下属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Dorg.kie.dmn.compiler.execmodel=true</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="dmn-execution-remote-java-proc"><a class="anchor" href="#dmn-execution-remote-java-proc"></a> <a class="link" href="#dmn-execution-remote-java-proc">5.4.2。使用KIE Server Java客户端API执行DMN服务</a></h4>
<div class="paragraph">
<p>KIE Server Java客户端API提供了一种轻量级的方法来通过KIE Server的REST或JMS接口调用远程DMN服务。这种方法减少了与KIE基础交互所需的运行时依赖项的数量。通过使调用代码以适当的速度独立进行迭代，还可以将调用代码与决策定义分离，从而提高了灵活性。</p>
</div>
<div class="paragraph">
<p>有关KIE Server Java客户端API的更多信息，请参阅<a href="#kie-server-java-api-con_kie-apis">KIE容器和业务资产的KIE Server Java客户端API</a> 。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>KIE Server已安装和配置，包括已知用户名和具有<code>kie-server</code>角色。有关安装选项，请参阅<a href="#_installationandsetup">安装和设置（Core和IDE）</a> 。</p>
</li>
<li>
<p>您已将DMN项目构建为KJAR工件并将其部署到KIE Server。理想情况下，您已将DMN项目构建为可执行模型以提高执行效率：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn clean install -DgenerateDMNModel=yes</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关项目打包，部署和可执行模型的更多信息，请参见<a href="#_builddeployutilizeandrunsection">Build，Deploy，Utilize和Run</a> 。</p>
</div>
</div>
</div>
</li>
<li>
<p>您具有包含DMN模型的KIE容器的ID。如果存在多个模型，则还必须知道相关模型的模型名称空间和模型名称。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在客户端应用程序中，将以下依赖项添加到Java项目的相关类路径中：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Required for the KIE Server Java client API --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
  &lt;artifactId&gt;kie-server-client&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code><version></code>是项目中当前使用的Drools的Maven工件版本（例如7.26.0。Final-redhat-00005）。</p>
</div>
</div>
</div>
</li>
<li>
<p>实例化一个<code>KieServicesClient</code>具有适当连接信息的实例。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServicesConfiguration conf =
    KieServicesFactory.newRestConfiguration(URL, USER, PASSWORD); <i class="conum" data-value="1"></i><b>(1)</b>

conf.setMarshallingFormat(MarshallingFormat.JSON);  <i class="conum" data-value="2"></i><b>(2)</b>

KieServicesClient kieServicesClient = KieServicesFactory.newKieServicesClient(conf);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>连接信息：<div class="ulist">
<ul>
<li>
<p>范例网址：<code>http://localhost:8080/kie-server/services/rest/server</code></p>
</li>
<li>
<p>凭据应引用具有以下内容的用户<code>kie-server</code>角色。</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>编组格式是<code>org.kie.server.api.marshalling.MarshallingFormat</code> 。它控制消息是JSON还是XML。编组格式的选项为JSON，JAXB或XSTREAM。</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</li>
<li>
<p>获得一个<code>DMNServicesClient</code>通过调用方法从连接到相关KIE服务器的KIE服务器Java客户端访问<code>getServicesClient()</code>在KIE服务器Java客户端实例上：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DMNServicesClient dmnClient = kieServicesClient.getServicesClient(DMNServicesClient.class );</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>dmnClient</code>现在可以在KIE服务器上执行决策服务。</p>
</div>
</li>
<li>
<p>为所需模型执行决策服务。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">for (Integer age : Arrays.asList(1,12,13,64,65,66)) {
    DMNContext dmnContext = dmnClient.newContext(); <i class="conum" data-value="1"></i><b>(1)</b>
    dmnContext.set("Age", age);  <i class="conum" data-value="2"></i><b>(2)</b>
    ServiceResponse&lt;DMNResult&gt; serverResp =   <i class="conum" data-value="3"></i><b>(3)</b>
        dmnClient.evaluateAll($kieContainerId,
                              $modelNamespace,
                              $modelName,
                              dmnContext);

    DMNResult dmnResult = serverResp.getResult();  <i class="conum" data-value="4"></i><b>(4)</b>
    for (DMNDecisionResult dr : dmnResult.getDecisionResults()) {
        log.info("Age: " + age + ", " +
                 "Decision: '" + dr.getDecisionName() + "', " +
                 "Result: " + dr.getResult());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>实例化新的DMN上下文作为模型评估的输入。请注意，此示例多次遍历“年龄分类”决策。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>为输入DMN上下文分配输入变量。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i> <b>3</b></td>
<td>评估DMN模型中定义的所有DMN决策：<div class="ulist">
<ul>
<li>
<p><code>$kieContainerId</code>是部署包含DMN模型的KJAR的容器的ID</p>
</li>
<li>
<p><code>$modelNamespace</code>是模型的名称空间。</p>
</li>
<li>
<p><code>$modelName</code>是模型的名称。</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i> <b>4</b></td>
<td>服务器响应中提供了DMN Result对象。</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>此时， <code>dmnResult</code>包含评估的DMN模型的所有决策结果。</p>
</div>
<div class="paragraph">
<p>您还可以通过使用以下方法来仅执行模型中的特定DMN决策： <code>DMNServicesClient</code> 。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">如果KIE容器仅包含一个DMN模型，则可以省略<code>$modelNamespace</code>和<code>$modelName</code>因为默认情况下，KIE Server API会选择它。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="dmn-execution-rest-proc"><a class="anchor" href="#dmn-execution-rest-proc"></a> <a class="link" href="#dmn-execution-rest-proc">5.4.3。使用KIE Server REST API执行DMN服务</a></h4>
<div class="paragraph">
<p>与KIE Server的REST端点直接交互可在调用代码和决策逻辑定义之间提供最大的隔离。调用代码完全没有直接依赖关系，您可以在一个完全不同的开发平台中实现它，例如<code>Node.js</code>要么<code>.NET</code> 。本节中的示例演示了Nix样式的curl命令，但提供了适用于任何REST客户端的相关信息。</p>
</div>
<div class="paragraph">
<p>有关KIE Server REST API的更多信息，请参阅<a href="#kie-server-rest-api-con_kie-apis">KIE容器和业务资产的KIE Server REST API</a> 。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>KIE Server已安装和配置，包括已知用户名和具有<code>kie-server</code>角色。有关安装选项，请参阅<a href="#_installationandsetup">安装和设置（Core和IDE）</a> 。</p>
</li>
<li>
<p>您已将DMN项目构建为KJAR工件并将其部署到KIE Server。理想情况下，您已将DMN项目构建为可执行模型以提高执行效率：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn clean install -DgenerateDMNModel=yes</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关项目打包，部署和可执行模型的更多信息，请参见<a href="#_builddeployutilizeandrunsection">Build，Deploy，Utilize和Run</a> 。</p>
</div>
</div>
</div>
</li>
<li>
<p>您具有包含DMN模型的KIE容器的ID。如果存在多个模型，则还必须知道相关模型的模型名称空间和模型名称。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>确定用于访问KIE Server REST API端点的基本URL。这要求知道以下值（以默认的本地部署值为例）：</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>主持人（ <code>localhost</code> ）</p>
</li>
<li>
<p>港口 （ <code>8080</code> ）</p>
</li>
<li>
<p>根上下文（ <code>kie-server</code> ）</p>
</li>
<li>
<p>基本REST路径（ <code>services/rest/</code> ）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>本地部署中的示例基本URL：</p>
</div>
<div class="paragraph">
<p><code>http://localhost:8080/kie-server/services/rest/</code></p>
</div>
</div>
</div>
</li>
<li>
<p>确定用户身份验证要求。</p>
<div class="paragraph">
<p>在KIE服务器配置中直接定义用户时，将使用HTTP基本身份验证，并且需要用户名和密码。成功的请求要求用户具有<code>kie-server</code>角色。</p>
</div>
<div class="paragraph">
<p>以下示例演示了如何将凭证添加到curl请求：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u username:password &lt;request&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果KIE Server配置有Red Hat Single Sign-On，则该请求必须包含承载令牌：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">curl -H "Authorization: bearer $TOKEN" &lt;request&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>指定请求和响应的格式。REST API端点可使用JSON和XML格式，并使用请求标头进行设置：</p>
<div class="listingblock">
<div class="title">JSON格式</div>
<div class="content">
<pre class="highlightjs highlight"><code>curl -H "accept: application/json" -H "content-type: application/json"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">XML格式</div>
<div class="content">
<pre class="highlightjs highlight"><code>curl -H "accept: application/xml" -H "content-type: application/xml"</code></pre>
</div>
</div>
</li>
<li>
<p>（可选）在容器中查询已部署决策模型的列表：</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><strong>[得到]</strong> <code>server/containers/{containerId}/dmn</code></p>
</div>
<div class="paragraph">
<p>卷曲请求示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u krisv:krisv -H "accept: application/xml" -X GET "http://localhost:8080/kie-server/services/rest/server/containers/MovieDMNContainer/dmn"</code></pre>
</div>
</div>
<div class="paragraph">
<p>XML输出样例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;response type="SUCCESS" msg="OK models successfully retrieved from container 'MovieDMNContainer'"&gt;
    &lt;dmn-model-info-list&gt;
        &lt;model&gt;
            &lt;model-namespace&gt;http://www.redhat.com/_c7328033-c355-43cd-b616-0aceef80e52a&lt;/model-namespace&gt;
            &lt;model-name&gt;dmn-movieticket-ageclassification&lt;/model-name&gt;
            &lt;model-id&gt;_99&lt;/model-id&gt;
            &lt;decisions&gt;
                &lt;dmn-decision-info&gt;
                    &lt;decision-id&gt;_3&lt;/decision-id&gt;
                    &lt;decision-name&gt;AgeClassification&lt;/decision-name&gt;
                &lt;/dmn-decision-info&gt;
            &lt;/decisions&gt;
        &lt;/model&gt;
    &lt;/dmn-model-info-list&gt;
&lt;/response&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>样本JSON输出：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type" : "SUCCESS",
  "msg" : "OK models successfully retrieved from container 'MovieDMNContainer'",
  "result" : {
    "dmn-model-info-list" : {
      "models" : [ {
        "model-namespace" : "http://www.redhat.com/_c7328033-c355-43cd-b616-0aceef80e52a",
        "model-name" : "dmn-movieticket-ageclassification",
        "model-id" : "_99",
        "decisions" : [ {
          "decision-id" : "_3",
          "decision-name" : "AgeClassification"
        } ]
      } ]
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>执行模型：</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><strong>[POST]</strong> <code>server/containers/{containerId}/dmn</code></p>
</div>
<div class="paragraph">
<p>卷曲请求示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u krisv:krisv -H "accept: application/json" -H "content-type: application/json" -X POST "http://localhost:8080/kie-server/services/rest/server/containers/MovieDMNContainer/dmn" -d "{ \"model-namespace\" : \"http://www.redhat.com/_c7328033-c355-43cd-b616-0aceef80e52a\", \"model-name\" : \"dmn-movieticket-ageclassification\", \"decision-name\" : [ ], \"decision-id\" : [ ], \"dmn-context\" : {\"Age\" : 66}}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>JSON请求示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "model-namespace" : "http://www.redhat.com/_c7328033-c355-43cd-b616-0aceef80e52a",
  "model-name" : "dmn-movieticket-ageclassification",
  "decision-name" : [ ],
  "decision-id" : [ ],
  "dmn-context" : {"Age" : 66}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>XML请求示例（JAXB格式）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;dmn-evaluation-context&gt;
    &lt;model-namespace&gt;http://www.redhat.com/_c7328033-c355-43cd-b616-0aceef80e52a&lt;/model-namespace&gt;
    &lt;model-name&gt;dmn-movieticket-ageclassification&lt;/model-name&gt;
    &lt;dmn-context xsi:type="jaxbListWrapper" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
        &lt;type&gt;MAP&lt;/type&gt;
        &lt;element xsi:type="jaxbStringObjectPair" key="Age"&gt;
            &lt;value xsi:type="xs:int" xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;66&lt;/value&gt;
        &lt;/element&gt;
    &lt;/dmn-context&gt;
&lt;/dmn-evaluation-context&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>无论请求格式如何，请求都需要以下元素：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>模型名称空间</p>
</li>
<li>
<p>型号名称</p>
</li>
<li>
<p>包含输入值的上下文对象</p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>JSON响应示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type" : "SUCCESS",
  "msg" : "OK from container 'MovieDMNContainer'",
  "result" : {
    "dmn-evaluation-result" : {
      "messages" : [ ],
      "model-namespace" : "http://www.redhat.com/_c7328033-c355-43cd-b616-0aceef80e52a",
      "model-name" : "dmn-movieticket-ageclassification",
      "decision-name" : [ ],
      "dmn-context" : {
        "Age" : 66,
        "AgeClassification" : "Senior"
      },
      "decision-results" : {
        "_3" : {
          "messages" : [ ],
          "decision-id" : "_3",
          "decision-name" : "AgeClassification",
          "result" : "Senior",
          "status" : "SUCCEEDED"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>示例XML（JAXB格式）响应：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;response type="SUCCESS" msg="OK from container 'MovieDMNContainer'"&gt;
      &lt;dmn-evaluation-result&gt;
            &lt;model-namespace&gt;http://www.redhat.com/_c7328033-c355-43cd-b616-0aceef80e52a&lt;/model-namespace&gt;
            &lt;model-name&gt;dmn-movieticket-ageclassification&lt;/model-name&gt;
            &lt;dmn-context xsi:type="jaxbListWrapper" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
                  &lt;type&gt;MAP&lt;/type&gt;
                  &lt;element xsi:type="jaxbStringObjectPair" key="Age"&gt;
                        &lt;value xsi:type="xs:int" xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;66&lt;/value&gt;
                  &lt;/element&gt;
                  &lt;element xsi:type="jaxbStringObjectPair" key="AgeClassification"&gt;
                        &lt;value xsi:type="xs:string" xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;Senior&lt;/value&gt;
                  &lt;/element&gt;
            &lt;/dmn-context&gt;
            &lt;messages/&gt;
            &lt;decisionResults&gt;
                  &lt;entry&gt;
                        &lt;key&gt;_3&lt;/key&gt;
                        &lt;value&gt;
                              &lt;decision-id&gt;_3&lt;/decision-id&gt;
                              &lt;decision-name&gt;AgeClassification&lt;/decision-name&gt;
                              &lt;result xsi:type="xs:string" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;Senior&lt;/result&gt;
                              &lt;messages/&gt;
                              &lt;status&gt;SUCCEEDED&lt;/status&gt;
                        &lt;/value&gt;
                  &lt;/entry&gt;
            &lt;/decisionResults&gt;
      &lt;/dmn-evaluation-result&gt;
&lt;/response&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="drools.PMML"><a class="anchor" href="#drools.PMML"></a> <a class="link" href="#drools.PMML">6。预测模型标记语言（PMML）</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="pmml-con_pmml-models"><a class="anchor" href="#pmml-con_pmml-models"></a> <a class="link" href="#pmml-con_pmml-models">6.1。预测模型标记语言（PMML）</a></h3>
<div class="paragraph">
<p>预测模型标记语言（PMML）是由数据挖掘小组（DMG）建立的基于XML的标准，用于定义统计和数据挖掘模型。PMML模型可以在兼容PMML的平台之间以及整个组织之间共享，因此业务分析人员和开发人员可以在设计，分析和实现基于PMML的资产和服务时进行统一。</p>
</div>
<div class="paragraph">
<p>有关PMML的背景和应用的更多信息，请参阅DMG <a href="http://dmg.org/pmml/pmml-v4-2-1.html">PMML规范</a> 。</p>
</div>
<div class="sect3">
<h4 id="pmml-conformance-con_pmml-models"><a class="anchor" href="#pmml-conformance-con_pmml-models"></a> <a class="link" href="#pmml-conformance-con_pmml-models">6.1.1。PMML一致性等级</a></h4>
<div class="paragraph">
<p>PMML规范在软件实现中定义了生产者和消费者符合性级别，以确保PMML模型被可靠地创建和集成。有关每个一致性级别的正式定义，请参见DMG <a href="http://dmg.org/pmml/v4-2-1/Conformance.html">PMML一致性</a>页面。</p>
</div>
<div class="paragraph">
<p>以下列表总结了PMML一致性级别：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">生产者一致性</dt>
<dd>
<p>如果工具或应用程序为至少一种类型的模型生成有效的PMML文档，则它符合生产者要求。满足PMML生产者一致性要求可确保模型定义文档在语法上正确，并定义与模型规范中定义的语义标准一致的模型实例。</p>
</dd>
<dt class="hdlist1">消费者合规</dt>
<dd>
<p>如果应用程序接受至少一种类型的模型的有效PMML文档，则该应用程序符合消费者要求。满足消费者一致性要求可确保根据生产者一致性创建的PMML模型可以集成并按定义使用。例如，如果某个应用程序符合消费者对回归模型类型的要求，则定义由不同的合格生产者生产的这种类型的模型的有效PMML文档将在该应用程序中互换。</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Drools包括针对以下PMML 4.2.1模型类型的消费者一致性支持：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://dmg.org/pmml/v4-2-1/Regression.html">回归模型</a></p>
</li>
<li>
<p><a href="http://dmg.org/pmml/v4-2-1/Scorecard.html">记分卡模型</a></p>
</li>
<li>
<p><a href="http://dmg.org/pmml/v4-2-1/TreeModel.html">树模型</a></p>
</li>
<li>
<p><a href="http://dmg.org/pmml/v4-2-1/MultipleModels.html#xsdElement_MiningModel">挖掘模型</a> （带有子类型<code>modelChain</code> ， <code>selectAll</code>和<code>selectFirst</code> ）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>有关所有PMML模型类型的列表，包括Drools不支持的模型类型，请参阅DMG <a href="http://dmg.org/pmml/v4-2-1/GeneralStructure.html">PMML规范</a> 。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pmml-examples-ref_pmml-models"><a class="anchor" href="#pmml-examples-ref_pmml-models"></a> <a class="link" href="#pmml-examples-ref_pmml-models">6.2。PMML模型示例</a></h3>
<div class="paragraph">
<p>PMML定义了一个<a href="http://dmg.org/pmml/v4-2-1/pmml-4-2.xsd">XML模式</a> ，该<a href="http://dmg.org/pmml/v4-2-1/pmml-4-2.xsd">模式</a>使PMML模型可以在不同的PMML兼容平台之间使用。如果满足生产者和消费者的要求，则PMML规范使多个软件平台可以使用同一文件进行创作，测试和生产执行。</p>
</div>
<div class="paragraph">
<p>以下是PMML回归，记分卡，树和挖掘模型的示例。这些示例说明了可以与Drools中的决策服务集成的支持的模型类型。</p>
</div>
<div class="paragraph">
<p>有关更多PMML示例，请参见DMG <a href="http://dmg.org/pmml/pmml_examples/index.html">PMML示例文件</a>页面。</p>
</div>
<div class="listingblock">
<div class="title">示例PMML回归模型</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;PMML version="4.2" xsi:schemaLocation="http://www.dmg.org/PMML-4_2 http://www.dmg.org/v4-2-1/pmml-4-2.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.dmg.org/PMML-4_2"&gt;
  &lt;Header copyright="JBoss"/&gt;
  &lt;DataDictionary numberOfFields="5"&gt;
    &lt;DataField dataType="double" name="fld1" optype="continuous"/&gt;
    &lt;DataField dataType="double" name="fld2" optype="continuous"/&gt;
    &lt;DataField dataType="string" name="fld3" optype="categorical"&gt;
      &lt;Value value="x"/&gt;
      &lt;Value value="y"/&gt;
    &lt;/DataField&gt;
    &lt;DataField dataType="double" name="fld4" optype="continuous"/&gt;
    &lt;DataField dataType="double" name="fld5" optype="continuous"/&gt;
  &lt;/DataDictionary&gt;
  &lt;RegressionModel algorithmName="linearRegression" functionName="regression" modelName="LinReg" normalizationMethod="logit" targetFieldName="fld4"&gt;
    &lt;MiningSchema&gt;
      &lt;MiningField name="fld1"/&gt;
      &lt;MiningField name="fld2"/&gt;
      &lt;MiningField name="fld3"/&gt;
      &lt;MiningField name="fld4" usageType="predicted"/&gt;
      &lt;MiningField name="fld5" usageType="target"/&gt;
    &lt;/MiningSchema&gt;
    &lt;RegressionTable intercept="0.5"&gt;
      &lt;NumericPredictor coefficient="5" exponent="2" name="fld1"/&gt;
      &lt;NumericPredictor coefficient="2" exponent="1" name="fld2"/&gt;
      &lt;CategoricalPredictor coefficient="-3" name="fld3" value="x"/&gt;
      &lt;CategoricalPredictor coefficient="3" name="fld3" value="y"/&gt;
      &lt;PredictorTerm coefficient="0.4"&gt;
        &lt;FieldRef field="fld1"/&gt;
        &lt;FieldRef field="fld2"/&gt;
      &lt;/PredictorTerm&gt;
    &lt;/RegressionTable&gt;
  &lt;/RegressionModel&gt;
&lt;/PMML&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">PMML记分卡模型示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;PMML version="4.2" xsi:schemaLocation="http://www.dmg.org/PMML-4_2 http://www.dmg.org/v4-2-1/pmml-4-2.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.dmg.org/PMML-4_2"&gt;
  &lt;Header copyright="JBoss"/&gt;
  &lt;DataDictionary numberOfFields="4"&gt;
    &lt;DataField name="param1" optype="continuous" dataType="double"/&gt;
    &lt;DataField name="param2" optype="continuous" dataType="double"/&gt;
    &lt;DataField name="overallScore" optype="continuous" dataType="double" /&gt;
    &lt;DataField name="finalscore" optype="continuous" dataType="double" /&gt;
  &lt;/DataDictionary&gt;
  &lt;Scorecard modelName="ScorecardCompoundPredicate" useReasonCodes="true" isScorable="true" functionName="regression"    baselineScore="15" initialScore="0.8" reasonCodeAlgorithm="pointsAbove"&gt;
    &lt;MiningSchema&gt;
      &lt;MiningField name="param1" usageType="active" invalidValueTreatment="asMissing"&gt;
      &lt;/MiningField&gt;
      &lt;MiningField name="param2" usageType="active" invalidValueTreatment="asMissing"&gt;
      &lt;/MiningField&gt;
      &lt;MiningField name="overallScore" usageType="target"/&gt;
      &lt;MiningField name="finalscore" usageType="predicted"/&gt;
    &lt;/MiningSchema&gt;
    &lt;Characteristics&gt;
      &lt;Characteristic name="ch1" baselineScore="50" reasonCode="reasonCh1"&gt;
        &lt;Attribute partialScore="20"&gt;
          &lt;SimplePredicate field="param1" operator="lessThan" value="20"/&gt;
        &lt;/Attribute&gt;
        &lt;Attribute partialScore="100"&gt;
          &lt;CompoundPredicate booleanOperator="and"&gt;
            &lt;SimplePredicate field="param1" operator="greaterOrEqual" value="20"/&gt;
            &lt;SimplePredicate field="param2" operator="lessOrEqual" value="25"/&gt;
          &lt;/CompoundPredicate&gt;
        &lt;/Attribute&gt;
        &lt;Attribute partialScore="200"&gt;
          &lt;CompoundPredicate booleanOperator="and"&gt;
            &lt;SimplePredicate field="param1" operator="greaterOrEqual" value="20"/&gt;
            &lt;SimplePredicate field="param2" operator="greaterThan" value="25"/&gt;
          &lt;/CompoundPredicate&gt;
        &lt;/Attribute&gt;
      &lt;/Characteristic&gt;
      &lt;Characteristic name="ch2" reasonCode="reasonCh2"&gt;
        &lt;Attribute partialScore="10"&gt;
          &lt;CompoundPredicate booleanOperator="or"&gt;
            &lt;SimplePredicate field="param2" operator="lessOrEqual" value="-5"/&gt;
            &lt;SimplePredicate field="param2" operator="greaterOrEqual" value="50"/&gt;
          &lt;/CompoundPredicate&gt;
        &lt;/Attribute&gt;
        &lt;Attribute partialScore="20"&gt;
          &lt;CompoundPredicate booleanOperator="and"&gt;
            &lt;SimplePredicate field="param2" operator="greaterThan" value="-5"/&gt;
            &lt;SimplePredicate field="param2" operator="lessThan" value="50"/&gt;
          &lt;/CompoundPredicate&gt;
        &lt;/Attribute&gt;
      &lt;/Characteristic&gt;
    &lt;/Characteristics&gt;
  &lt;/Scorecard&gt;
&lt;/PMML&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例PMML树模型</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;PMML version="4.2" xsi:schemaLocation="http://www.dmg.org/PMML-4_2 http://www.dmg.org/v4-2-1/pmml-4-2.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.dmg.org/PMML-4_2"&gt;
  &lt;Header copyright="JBOSS"/&gt;
  &lt;DataDictionary numberOfFields="5"&gt;
    &lt;DataField dataType="double" name="fld1" optype="continuous"/&gt;
    &lt;DataField dataType="double" name="fld2" optype="continuous"/&gt;
    &lt;DataField dataType="string" name="fld3" optype="categorical"&gt;
      &lt;Value value="true"/&gt;
      &lt;Value value="false"/&gt;
    &lt;/DataField&gt;
    &lt;DataField dataType="string" name="fld4" optype="categorical"&gt;
      &lt;Value value="optA"/&gt;
      &lt;Value value="optB"/&gt;
      &lt;Value value="optC"/&gt;
    &lt;/DataField&gt;
    &lt;DataField dataType="string" name="fld5" optype="categorical"&gt;
      &lt;Value value="tgtX"/&gt;
      &lt;Value value="tgtY"/&gt;
      &lt;Value value="tgtZ"/&gt;
    &lt;/DataField&gt;
  &lt;/DataDictionary&gt;
  &lt;TreeModel functionName="classification" modelName="TreeTest"&gt;
    &lt;MiningSchema&gt;
      &lt;MiningField name="fld1"/&gt;
      &lt;MiningField name="fld2"/&gt;
      &lt;MiningField name="fld3"/&gt;
      &lt;MiningField name="fld4"/&gt;
      &lt;MiningField name="fld5" usageType="predicted"/&gt;
    &lt;/MiningSchema&gt;
    &lt;Node score="tgtX"&gt;
      &lt;True/&gt;
      &lt;Node score="tgtX"&gt;
        &lt;SimplePredicate field="fld4" operator="equal" value="optA"/&gt;
        &lt;Node score="tgtX"&gt;
          &lt;CompoundPredicate booleanOperator="surrogate"&gt;
            &lt;SimplePredicate field="fld1" operator="lessThan" value="30.0"/&gt;
            &lt;SimplePredicate field="fld2" operator="greaterThan" value="20.0"/&gt;
          &lt;/CompoundPredicate&gt;
          &lt;Node score="tgtX"&gt;
            &lt;SimplePredicate field="fld2" operator="lessThan" value="40.0"/&gt;
          &lt;/Node&gt;
          &lt;Node score="tgtZ"&gt;
            &lt;SimplePredicate field="fld2" operator="greaterOrEqual" value="10.0"/&gt;
          &lt;/Node&gt;
        &lt;/Node&gt;
        &lt;Node score="tgtZ"&gt;
          &lt;CompoundPredicate booleanOperator="or"&gt;
            &lt;SimplePredicate field="fld1" operator="greaterOrEqual" value="60.0"/&gt;
            &lt;SimplePredicate field="fld1" operator="lessOrEqual" value="70.0"/&gt;
          &lt;/CompoundPredicate&gt;
          &lt;Node score="tgtZ"&gt;
            &lt;SimpleSetPredicate booleanOperator="isNotIn" field="fld4"&gt;
              &lt;Array type="string"&gt;optA optB&lt;/Array&gt;
            &lt;/SimpleSetPredicate&gt;
          &lt;/Node&gt;
        &lt;/Node&gt;
      &lt;/Node&gt;
      &lt;Node score="tgtY"&gt;
        &lt;CompoundPredicate booleanOperator="or"&gt;
          &lt;SimplePredicate field="fld4" operator="equal" value="optA"/&gt;
          &lt;SimplePredicate field="fld4" operator="equal" value="optC"/&gt;
        &lt;/CompoundPredicate&gt;
        &lt;Node score="tgtY"&gt;
          &lt;CompoundPredicate booleanOperator="and"&gt;
            &lt;SimplePredicate field="fld1" operator="greaterThan" value="10.0"/&gt;
            &lt;SimplePredicate field="fld1" operator="lessThan" value="50.0"/&gt;
            &lt;SimplePredicate field="fld4" operator="equal" value="optA"/&gt;
            &lt;SimplePredicate field="fld2" operator="lessThan" value="100.0"/&gt;
            &lt;SimplePredicate field="fld3" operator="equal" value="false"/&gt;
          &lt;/CompoundPredicate&gt;
        &lt;/Node&gt;
        &lt;Node score="tgtZ"&gt;
          &lt;CompoundPredicate booleanOperator="and"&gt;
            &lt;SimplePredicate field="fld4" operator="equal" value="optC"/&gt;
            &lt;SimplePredicate field="fld2" operator="lessThan" value="30.0"/&gt;
          &lt;/CompoundPredicate&gt;
        &lt;/Node&gt;
      &lt;/Node&gt;
    &lt;/Node&gt;
  &lt;/TreeModel&gt;
&lt;/PMML&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例PMML挖掘模型（modelChain）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;PMML version="4.2" xsi:schemaLocation="http://www.dmg.org/PMML-4_2 http://www.dmg.org/v4-2-1/pmml-4-2.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"   xmlns="http://www.dmg.org/PMML-4_2"&gt;
  &lt;Header&gt;
    &lt;Application name="Drools-PMML" version="7.0.0-SNAPSHOT" /&gt;
  &lt;/Header&gt;
  &lt;DataDictionary numberOfFields="7"&gt;
    &lt;DataField name="age" optype="continuous" dataType="double" /&gt;
    &lt;DataField name="occupation" optype="categorical" dataType="string"&gt;
      &lt;Value value="SKYDIVER" /&gt;
      &lt;Value value="ASTRONAUT" /&gt;
      &lt;Value value="PROGRAMMER" /&gt;
      &lt;Value value="TEACHER" /&gt;
      &lt;Value value="INSTRUCTOR" /&gt;
    &lt;/DataField&gt;
    &lt;DataField name="residenceState" optype="categorical" dataType="string"&gt;
      &lt;Value value="AP" /&gt;
      &lt;Value value="KN" /&gt;
      &lt;Value value="TN" /&gt;
    &lt;/DataField&gt;
    &lt;DataField name="validLicense" optype="categorical" dataType="boolean" /&gt;
    &lt;DataField name="overallScore" optype="continuous" dataType="double" /&gt;
    &lt;DataField name="grade" optype="categorical" dataType="string"&gt;
      &lt;Value value="A" /&gt;
      &lt;Value value="B" /&gt;
      &lt;Value value="C" /&gt;
      &lt;Value value="D" /&gt;
      &lt;Value value="F" /&gt;
    &lt;/DataField&gt;
    &lt;DataField name="qualificationLevel" optype="categorical" dataType="string"&gt;
      &lt;Value value="Unqualified" /&gt;
      &lt;Value value="Barely" /&gt;
      &lt;Value value="Well" /&gt;
      &lt;Value value="Over" /&gt;
    &lt;/DataField&gt;
  &lt;/DataDictionary&gt;
  &lt;MiningModel modelName="SampleModelChainMine" functionName="classification"&gt;
    &lt;MiningSchema&gt;
      &lt;MiningField name="age" /&gt;
      &lt;MiningField name="occupation" /&gt;
      &lt;MiningField name="residenceState" /&gt;
      &lt;MiningField name="validLicense" /&gt;
      &lt;MiningField name="overallScore" /&gt;
      &lt;MiningField name="qualificationLevel" usageType="target"/&gt;
    &lt;/MiningSchema&gt;
    &lt;Segmentation multipleModelMethod="modelChain"&gt;
      &lt;Segment id="1"&gt;
        &lt;True /&gt;
        &lt;Scorecard modelName="Sample Score 1" useReasonCodes="true" isScorable="true" functionName="regression"               baselineScore="0.0" initialScore="0.345"&gt;
          &lt;MiningSchema&gt;
            &lt;MiningField name="age" usageType="active" invalidValueTreatment="asMissing" /&gt;
            &lt;MiningField name="occupation" usageType="active" invalidValueTreatment="asMissing" /&gt;
            &lt;MiningField name="residenceState" usageType="active" invalidValueTreatment="asMissing" /&gt;
            &lt;MiningField name="validLicense" usageType="active" invalidValueTreatment="asMissing" /&gt;
            &lt;MiningField name="overallScore" usageType="predicted" /&gt;
          &lt;/MiningSchema&gt;
          &lt;Output&gt;
            &lt;OutputField name="calculatedScore" displayName="Final Score" dataType="double" feature="predictedValue"                     targetField="overallScore" /&gt;
          &lt;/Output&gt;
          &lt;Characteristics&gt;
            &lt;Characteristic name="AgeScore" baselineScore="0.0" reasonCode="ABZ"&gt;
              &lt;Extension name="cellRef" value="$B$8" /&gt;
              &lt;Attribute partialScore="10.0"&gt;
                &lt;Extension name="cellRef" value="$C$10" /&gt;
                &lt;SimplePredicate field="age" operator="lessOrEqual" value="5" /&gt;
              &lt;/Attribute&gt;
              &lt;Attribute partialScore="30.0" reasonCode="CX1"&gt;
                &lt;Extension name="cellRef" value="$C$11" /&gt;
                &lt;CompoundPredicate booleanOperator="and"&gt;
                  &lt;SimplePredicate field="age" operator="greaterOrEqual" value="5" /&gt;
                  &lt;SimplePredicate field="age" operator="lessThan" value="12" /&gt;
                &lt;/CompoundPredicate&gt;
              &lt;/Attribute&gt;
              &lt;Attribute partialScore="40.0" reasonCode="CX2"&gt;
                &lt;Extension name="cellRef" value="$C$12" /&gt;
                &lt;CompoundPredicate booleanOperator="and"&gt;
                  &lt;SimplePredicate field="age" operator="greaterOrEqual" value="13" /&gt;
                  &lt;SimplePredicate field="age" operator="lessThan" value="44" /&gt;
                &lt;/CompoundPredicate&gt;
              &lt;/Attribute&gt;
              &lt;Attribute partialScore="25.0"&gt;
                &lt;Extension name="cellRef" value="$C$13" /&gt;
                &lt;SimplePredicate field="age" operator="greaterOrEqual" value="45" /&gt;
              &lt;/Attribute&gt;
            &lt;/Characteristic&gt;
            &lt;Characteristic name="OccupationScore" baselineScore="0.0"&gt;
              &lt;Extension name="cellRef" value="$B$16" /&gt;
              &lt;Attribute partialScore="-10.0" reasonCode="CX2"&gt;
                &lt;Extension name="description" value="skydiving is a risky occupation" /&gt;
                &lt;Extension name="cellRef" value="$C$18" /&gt;
                &lt;SimpleSetPredicate field="occupation" booleanOperator="isIn"&gt;
                  &lt;Array n="2" type="string"&gt;SKYDIVER ASTRONAUT&lt;/Array&gt;
                &lt;/SimpleSetPredicate&gt;
              &lt;/Attribute&gt;
              &lt;Attribute partialScore="10.0"&gt;
                &lt;Extension name="cellRef" value="$C$19" /&gt;
                &lt;SimpleSetPredicate field="occupation" booleanOperator="isIn"&gt;
                  &lt;Array n="2" type="string"&gt;TEACHER INSTRUCTOR&lt;/Array&gt;
                &lt;/SimpleSetPredicate&gt;
              &lt;/Attribute&gt;
              &lt;Attribute partialScore="5.0"&gt;
                &lt;Extension name="cellRef" value="$C$20" /&gt;
                &lt;SimplePredicate field="occupation" operator="equal" value="PROGRAMMER" /&gt;
              &lt;/Attribute&gt;
            &lt;/Characteristic&gt;
            &lt;Characteristic name="ResidenceStateScore" baselineScore="0.0" reasonCode="RES"&gt;
              &lt;Extension name="cellRef" value="$B$22" /&gt;
              &lt;Attribute partialScore="-10.0"&gt;
                &lt;Extension name="cellRef" value="$C$24" /&gt;
                &lt;SimplePredicate field="residenceState" operator="equal" value="AP" /&gt;
              &lt;/Attribute&gt;
              &lt;Attribute partialScore="10.0"&gt;
                &lt;Extension name="cellRef" value="$C$25" /&gt;
                &lt;SimplePredicate field="residenceState" operator="equal" value="KN" /&gt;
              &lt;/Attribute&gt;
              &lt;Attribute partialScore="5.0"&gt;
                &lt;Extension name="cellRef" value="$C$26" /&gt;
                &lt;SimplePredicate field="residenceState" operator="equal" value="TN" /&gt;
              &lt;/Attribute&gt;
            &lt;/Characteristic&gt;
            &lt;Characteristic name="ValidLicenseScore" baselineScore="0.0"&gt;
              &lt;Extension name="cellRef" value="$B$28" /&gt;
              &lt;Attribute partialScore="1.0" reasonCode="LX00"&gt;
                &lt;Extension name="cellRef" value="$C$30" /&gt;
                &lt;SimplePredicate field="validLicense" operator="equal" value="true" /&gt;
              &lt;/Attribute&gt;
              &lt;Attribute partialScore="-1.0" reasonCode="LX00"&gt;
                &lt;Extension name="cellRef" value="$C$31" /&gt;
                &lt;SimplePredicate field="validLicense" operator="equal" value="false" /&gt;
              &lt;/Attribute&gt;
            &lt;/Characteristic&gt;
          &lt;/Characteristics&gt;
        &lt;/Scorecard&gt;
      &lt;/Segment&gt;
      &lt;Segment id="2"&gt;
        &lt;True /&gt;
        &lt;TreeModel modelName="SampleTree" functionName="classification" missingValueStrategy="lastPrediction" noTrueChildStrategy="returnLastPrediction"&gt;
          &lt;MiningSchema&gt;
            &lt;MiningField name="age" usageType="active" /&gt;
            &lt;MiningField name="validLicense" usageType="active" /&gt;
            &lt;MiningField name="calculatedScore" usageType="active" /&gt;
            &lt;MiningField name="qualificationLevel" usageType="predicted" /&gt;
          &lt;/MiningSchema&gt;
          &lt;Output&gt;
            &lt;OutputField name="qualification" displayName="Qualification Level" dataType="string" feature="predictedValue"                     targetField="qualificationLevel" /&gt;
          &lt;/Output&gt;
          &lt;Node score="Well" id="1"&gt;
            &lt;True/&gt;
            &lt;Node score="Barely" id="2"&gt;
              &lt;CompoundPredicate booleanOperator="and"&gt;
                &lt;SimplePredicate field="age" operator="greaterOrEqual" value="16" /&gt;
                &lt;SimplePredicate field="validLicense" operator="equal" value="true" /&gt;
              &lt;/CompoundPredicate&gt;
              &lt;Node score="Barely" id="3"&gt;
                &lt;SimplePredicate field="calculatedScore" operator="lessOrEqual" value="50.0" /&gt;
              &lt;/Node&gt;
              &lt;Node score="Well" id="4"&gt;
                &lt;CompoundPredicate booleanOperator="and"&gt;
                  &lt;SimplePredicate field="calculatedScore" operator="greaterThan" value="50.0" /&gt;
                  &lt;SimplePredicate field="calculatedScore" operator="lessOrEqual" value="60.0" /&gt;
                &lt;/CompoundPredicate&gt;
              &lt;/Node&gt;
              &lt;Node score="Over" id="5"&gt;
                &lt;SimplePredicate field="calculatedScore" operator="greaterThan" value="60.0" /&gt;
              &lt;/Node&gt;
            &lt;/Node&gt;
            &lt;Node score="Unqualified" id="6"&gt;
              &lt;CompoundPredicate booleanOperator="surrogate"&gt;
                &lt;SimplePredicate field="age" operator="lessThan" value="16" /&gt;
                &lt;SimplePredicate field="calculatedScore" operator="lessOrEqual" value="40.0" /&gt;
                &lt;True /&gt;
              &lt;/CompoundPredicate&gt;
            &lt;/Node&gt;
          &lt;/Node&gt;
        &lt;/TreeModel&gt;
      &lt;/Segment&gt;
    &lt;/Segmentation&gt;
  &lt;/MiningModel&gt;
&lt;/PMML&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pmml-support-con_pmml-models"><a class="anchor" href="#pmml-support-con_pmml-models"></a> <a class="link" href="#pmml-support-con_pmml-models">6.3。Drools中的PMML支持</a></h3>
<div class="paragraph">
<p>Drools包括针对以下PMML 4.2.1模型类型的消费者一致性支持：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://dmg.org/pmml/v4-2-1/Regression.html">回归模型</a></p>
</li>
<li>
<p><a href="http://dmg.org/pmml/v4-2-1/Scorecard.html">记分卡模型</a></p>
</li>
<li>
<p><a href="http://dmg.org/pmml/v4-2-1/TreeModel.html">树模型</a></p>
</li>
<li>
<p><a href="http://dmg.org/pmml/v4-2-1/MultipleModels.html#xsdElement_MiningModel">挖掘模型</a> （带有子类型<code>modelChain</code> ， <code>selectAll</code>和<code>selectFirst</code> ）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>有关所有PMML模型类型的列表，包括Drools不支持的模型类型，请参阅DMG <a href="http://dmg.org/pmml/v4-2-1/GeneralStructure.html">PMML规范</a> 。</p>
</div>
<div class="paragraph">
<p>Drools不包括内置的PMML模型编辑器，但是您可以使用XML或PMML特定的创作工具来创建PMML模型，然后将PMML模型集成到Drools的决策服务中。您可以将PMML文件导入到Business Central中的项目中（ <strong>菜单→设计→项目→导入资产</strong> ），也可以将PMML文件打包为项目知识JAR（KJAR）文件的一部分，而无需Business Central。</p>
</div>
<div class="paragraph">
<p>将PMML文件添加到Drools中的项目时，将生成多个资产。每种类型的PMML模型都会生成一组不同的资产，但是所有PMML模型类型都会生成至少以下一组资产：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>一个DRL文件，其中包含与PMML模型相关的所有规则</p>
</li>
<li>
<p>至少两个Java类：</p>
<div class="ulist">
<ul>
<li>
<p>用作模型类型的默认对象类型的数据类</p>
</li>
<li>
<p>一种<code>RuleUnit</code>用于管理数据源和规则执行的类</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果PMML文件包含<code>MiningModel</code>作为根模型，将生成每个文件的多个实例。</p>
</div>
<div class="paragraph">
<p>有关在项目打包和部署方法中包括资产（例如PMML文件）的更多信息，请参见<a href="#_builddeployutilizeandrunsection">Build，Deploy，Utilize和Run</a> 。</p>
</div>
<div class="sect3">
<h4 id="pmml-naming-conventions-ref_pmml-models"><a class="anchor" href="#pmml-naming-conventions-ref_pmml-models"></a> <a class="link" href="#pmml-naming-conventions-ref_pmml-models">6.3.1。Drools中的PMML命名约定</a></h4>
<div class="paragraph">
<p>以下是生成的PMML包，类和规则的命名约定：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果在PMML模型文件中未提供任何程序包名称，则使用默认程序包名称<code>org.kie.pmml.pmml_4_2</code>前缀为格式的生成规则的模型名称<code>"org.kie.pmml.pmml_4_2"+modelName</code> 。</p>
</li>
<li>
<p>生成的包名称<code>RuleUnit</code> Java类与生成的规则的包名称相同。</p>
</li>
<li>
<p>生成的名称<code>RuleUnit</code> Java类是带有的模型名称<code>RuleUnit</code>以以下格式添加到它<code>modelName+"RuleUnit"</code> 。</p>
</li>
<li>
<p>每个PMML模型都有至少一个生成的数据类。这些类的软件包名称是<code>org.kie.pmml.pmml_4_2.model</code> 。</p>
</li>
<li>
<p>生成的数据类的名称由模型类型确定，并以模型名称作为前缀：</p>
<div class="ulist">
<ul>
<li>
<p>回归模型：一个名为的数据类<code>modelName+"RegressionData"</code></p>
</li>
<li>
<p>记分卡模型：一个名为的数据类<code>modelName+"ScoreCardData"</code></p>
</li>
<li>
<p>树模型：两个数据类，第一个命名<code>modelName+"TreeNode"</code>第二个命名<code>modelName+"TreeToken"</code></p>
</li>
<li>
<p>挖掘模型：一个名为的数据类<code>modelName+"MiningModelData"</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">挖掘模型还生成其每个细分中的所有规则和类。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="pmml-extensions-ref_pmml-models"><a class="anchor" href="#pmml-extensions-ref_pmml-models"></a> <a class="link" href="#pmml-extensions-ref_pmml-models">6.3.2。Drools中的PMML扩展</a></h4>
<div class="paragraph">
<p>PMML规范支持<code>Extension</code>扩展PMML模型内容的元素。您可以在PMML模型定义的几乎每个级别使用扩展，并且可以将其用作模型主要元素的第一个和最后一个子元素，以实现最大的灵活性。有关PMML扩展的更多信息，请参见DMG PMML <a href="http://dmg.org/pmml/v4-2-1/GeneralStructure.html#xsdElement_Extension">扩展机制</a> 。</p>
</div>
<div class="paragraph">
<p>为了优化PMML集成，Drools支持以下其他PMML扩展：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>modelPackage</code> ：为生成的规则和Java类指定程序包名称。将此扩展名包含在<code>Header</code> PMML模型文件部分。</p>
</li>
<li>
<p><code>adapter</code> ：指定构造类型（ <code>bean</code>要么<code>trait</code> ），用于包含规则的输入和输出数据。将此扩展名插入<code>MiningSchema</code>要么<code>Output</code> PMML模型文件的一部分（或两者）。</p>
</li>
<li>
<p><code>externalClass</code> ：与<code>adapter</code>扩展定义<code>MiningField</code>要么<code>OutputField</code> 。此扩展名包含一个类，该类的属性名称与<code>MiningField</code>要么<code>OutputField</code>元件。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pmml-invocation-options-con_pmml-models"><a class="anchor" href="#pmml-invocation-options-con_pmml-models"></a> <a class="link" href="#pmml-invocation-options-con_pmml-models">6.4。PMML模型执行</a></h3>
<div class="paragraph">
<p>您可以使用Business Central（ <strong>菜单→设计→项目→导入资产</strong> ）将PMML文件导入到Drools项目中，也可以将PMML文件打包为项目知识JAR（KJAR）文件的一部分，而无需Business Central。在Drools项目中实现PMML文件后，您可以通过将PMML调用直接嵌入Java应用程序中或通过发送PMML调用来执行基于PMML的决策服务。 <code>ApplyPmmlModelCommand</code>命令到已配置的KIE服务器。</p>
</div>
<div class="paragraph">
<p>有关在项目打包和部署方法中包括PMML资产的更多信息，请参见<a href="#_builddeployutilizeandrunsection">Build，Deploy，Utilize和Run</a> 。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">您还可以在Business Central中将PMML模型作为决策模型和注释（DMN）服务的一部分。在DMN文件中包含PMML模型时，可以将该PMML模型作为DMN决策节点或业务知识模型节点的框式函数表达式来调用。有关在DMN服务中包括PMML模型的更多信息，请参阅<a href="https://access.redhat.com/documentation/en-us/drools/7.5/html-single/designing_a_decision_service_using_dmn_models#dmn-included-models-pmml-proc_dmn-models"><em>使用DMN模型设计决策服务</em></a> 。
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="pmml-invocation-embedded-proc_pmml-models"><a class="anchor" href="#pmml-invocation-embedded-proc_pmml-models"></a> <a class="link" href="#pmml-invocation-embedded-proc_pmml-models">6.4.1。将PMML调用直接嵌入Java应用程序中</a></h4>
<div class="paragraph">
<p>当知识资产直接嵌入到调用程序中或使用KJAR的Maven依赖项在物理上拉入知识资产时，KIE容器是本地的。如果代码版本和PMML定义版本之间存在紧密关系，通常将知识资产直接嵌入到项目中。在有意更新和重新部署应用程序之后，对决策的任何更改都会生效。这种方法的好处是，正确的操作不依赖于运行时的任何外部依赖关系，这可能是锁定环境的限制。</p>
</div>
<div class="paragraph">
<p>使用Maven依赖项可以提供更大的灵活性，因为该决策的特定版本可以动态更改（例如，通过使用系统属性），并且可以定期对其进行扫描以进行更新并自动进行更新。这引入了对服务部署时间的外部依赖性，但是在本地执行决策，从而减少了对运行时可用的外部服务的依赖。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>创建了一个包含要执行的PMML模型的KJAR。有关项目打包的更多信息，请参见<a href="#_builddeployutilizeandrunsection">Build，Deploy，Utilize和Run</a> 。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在客户端应用程序中，将以下依赖项添加到Java项目的相关类路径中：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Required for the PMML compiler --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;kie-pmml&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- Required for the KIE public API --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie&lt;/groupId&gt;
  &lt;artifactId&gt;kie-api&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependencies&gt;

&lt;!-- Required if not using classpath KIE container --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie&lt;/groupId&gt;
  &lt;artifactId&gt;kie-ci&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code><version></code>是项目中当前使用的Drools的Maven工件版本（例如7.26.0。Final-redhat-00005）。</p>
</div>
</div>
</div>
</li>
<li>
<p>从创建一个KIE容器<code>classpath</code>要么<code>ReleaseId</code> ：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();

ReleaseId releaseId = kieServices.newReleaseId( "org.acme", "my-kjar", "1.0.0" );
KieContainer kieContainer = kieServices.newKieContainer( releaseId );</code></pre>
</div>
</div>
<div class="paragraph">
<p>替代选项：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();

KieContainer kieContainer = kieServices.getKieClasspathContainer();</code></pre>
</div>
</div>
</li>
<li>
<p>创建一个实例<code>PMMLRequestData</code>类，它将您的PMML模型应用于一组数据：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class PMMLRequestData {
    private String correlationId; <i class="conum" data-value="1"></i><b>(1)</b>
    private String modelName; <i class="conum" data-value="2"></i><b>(2)</b>
    private String source; <i class="conum" data-value="3"></i><b>(3)</b>
    private List&lt;ParameterInfo&lt;?&gt;&gt; requestParams; <i class="conum" data-value="4"></i><b>(4)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>标识与特定请求或结果关联的数据</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>应该应用于请求数据的模型的名称</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i> <b>3</b></td>
<td>由内部生成<code>PMMLRequestData</code>对象以标识生成请求的细分</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i> <b>4</b></td>
<td>发送输入数据点的默认机制</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</li>
<li>
<p>创建一个实例<code>PMML4Result</code>类，用于保存输出信息，该信息是将基于PMML的规则应用于输入数据的结果：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class PMML4Result {
    private String correlationId;
    private String segmentationId; <i class="conum" data-value="1"></i><b>(1)</b>
    private String segmentId; <i class="conum" data-value="2"></i><b>(2)</b>
    private int segmentIndex; <i class="conum" data-value="3"></i><b>(3)</b>
    private String resultCode; <i class="conum" data-value="4"></i><b>(4)</b>
    private Map&lt;String, Object&gt; resultVariables; <i class="conum" data-value="5"></i><b>(5)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>当模型类型为<code>MiningModel</code> 。的<code>segmentationId</code>用于区分多个细分。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>与<code>segmentationId</code>以确定哪个细分产生了结果。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i> <b>3</b></td>
<td>用于维护段的顺序。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i> <b>4</b></td>
<td>用于确定模型是否成功应用，在哪里<code>OK</code>表示成功。</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i> <b>5</b></td>
<td>包含结果变量的名称及其关联的值。</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>除了正常的吸气方法外， <code>PMML4Result</code>该类还支持以下方法来直接检索结果变量的值：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public &lt;T&gt; Optional&lt;T&gt; getResultValue(String objName, String objField, Class&lt;T&gt; clazz, Object...params)

public Object getResultValue(String objName, String objField, Object...params)</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>创建一个实例<code>ParameterInfo</code>类，用作基本数据类型对象的包装，这些对象用作<code>PMMLRequestData</code>类：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ParameterInfo&lt;T&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
    private String correlationId;
    private String name; <i class="conum" data-value="2"></i><b>(2)</b>
    private String capitalizedName;
    private Class&lt;T&gt; type; <i class="conum" data-value="3"></i><b>(3)</b>
    private T value; <i class="conum" data-value="4"></i><b>(4)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>参数化的类可以处理许多不同的类型</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>预期作为模型输入的变量的名称</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i> <b>3</b></td>
<td>该类是变量的实际类型</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i> <b>4</b></td>
<td>变量的实际值</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</li>
<li>
<p>根据已创建的必需PMML类实例执行PMML模型：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void executeModel(KieBase kbase,
                         Map&lt;String,Object&gt; variables,
                         String modelName,
                         String correlationId,
                         String modelPkgName) {
    RuleUnitExecutor executor = RuleUnitExecutor.create().bind(kbase);
    PMMLRequestData request = new PMMLRequestData(correlationId, modelName);
    PMML4Result resultHolder = new PMML4Result(correlationId);
    variables.entrySet().forEach( es -&gt; {
        request.addRequestParam(es.getKey(), es.getValue());
    });

    DataSource&lt;PMMLRequestData&gt; requestData = executor.newDataSource("request");
    DataSource&lt;PMML4Result&gt; resultData = executor.newDataSource("results");
    DataSource&lt;PMMLData&gt; internalData = executor.newDataSource("pmmlData");

    requestData.insert(request);
    resultData.insert(resultHolder);

    List&lt;String&gt; possiblePackageNames = calculatePossiblePackageNames(modelName,
                                                                    modelPkgName);
    Class&lt;? extends RuleUnit&gt; ruleUnitClass = getStartingRuleUnit("RuleUnitIndicator",
                                                                (InternalKnowledgeBase)kbase,
                                                                possiblePackageNames);

    if (ruleUnitClass != null) {
        executor.run(ruleUnitClass);
        if ( "OK".equals(resultHolder.getResultCode()) ) {
          // extract result variables here
        }
    }
}

protected Class&lt;? extends RuleUnit&gt; getStartingRuleUnit(String startingRule, InternalKnowledgeBase ikb, List&lt;String&gt; possiblePackages) {
    RuleUnitRegistry unitRegistry = ikb.getRuleUnitRegistry();
    Map&lt;String,InternalKnowledgePackage&gt; pkgs = ikb.getPackagesMap();
    RuleImpl ruleImpl = null;
    for (String pkgName: possiblePackages) {
      if (pkgs.containsKey(pkgName)) {
          InternalKnowledgePackage pkg = pkgs.get(pkgName);
          ruleImpl = pkg.getRule(startingRule);
          if (ruleImpl != null) {
              RuleUnitDescr descr = unitRegistry.getRuleUnitFor(ruleImpl).orElse(null);
              if (descr != null) {
                  return descr.getRuleUnitClass();
              }
          }
      }
    }
    return null;
}

protected List&lt;String&gt; calculatePossiblePackageNames(String modelId, String...knownPackageNames) {
    List&lt;String&gt; packageNames = new ArrayList&lt;&gt;();
    String javaModelId = modelId.replaceAll("\\s","");
    if (knownPackageNames != null &amp;&amp; knownPackageNames.length &gt; 0) {
        for (String knownPkgName: knownPackageNames) {
            packageNames.add(knownPkgName + "." + javaModelId);
        }
    }
    String basePkgName = PMML4UnitImpl.DEFAULT_ROOT_PACKAGE+"."+javaModelId;
    packageNames.add(basePkgName);
    return packageNames;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>规则由<code>RuleUnitExecutor</code>类。的<code>RuleUnitExecutor</code>类创建KIE会话并添加所需的<code>DataSource</code>对象访问这些会话，然后根据<code>RuleUnit</code>作为参数传递给<code>run()</code>方法。的<code>calculatePossiblePackageNames</code>和<code>getStartingRuleUnit</code>方法确定<code>RuleUnit</code>传递给<code>run()</code>方法。</p>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>为了方便您执行PMML模型，您还可以使用<code>PMML4ExecutionHelper</code>类在Drools中受支持。有关PMML帮助器类的更多信息，请参见<a href="#pmml-invocation-helper-classes-ref_pmml-models">PMML执行帮助器类</a> 。</p>
</div>
<div class="sect4">
<h5 id="pmml-invocation-helper-classes-ref_pmml-models"><a class="anchor" href="#pmml-invocation-helper-classes-ref_pmml-models"></a> <a class="link" href="#pmml-invocation-helper-classes-ref_pmml-models">6.4.1.1。PMML执行助手类</a></h5>
<div class="paragraph">
<p>流口水提供了<code>PMML4ExecutionHelper</code>有助于创建<code>PMMLRequestData</code> PMML模型执行所需的类，它有助于使用<code>RuleUnitExecutor</code>类。</p>
</div>
<div class="paragraph">
<p>以下是不带和带PMML模型执行的示例<code>PMML4ExecutionHelper</code>类，作为比较：</p>
</div>
<div class="listingblock">
<div class="title">不使用PMML模型的示例执行<code>PMML4ExecutionHelper</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void executeModel(KieBase kbase,
                         Map&lt;String,Object&gt; variables,
                         String modelName,
                         String correlationId,
                         String modelPkgName) {
    RuleUnitExecutor executor = RuleUnitExecutor.create().bind(kbase);
    PMMLRequestData request = new PMMLRequestData(correlationId, modelName);
    PMML4Result resultHolder = new PMML4Result(correlationId);
    variables.entrySet().forEach( es -&gt; {
        request.addRequestParam(es.getKey(), es.getValue());
    });

    DataSource&lt;PMMLRequestData&gt; requestData = executor.newDataSource("request");
    DataSource&lt;PMML4Result&gt; resultData = executor.newDataSource("results");
    DataSource&lt;PMMLData&gt; internalData = executor.newDataSource("pmmlData");

    requestData.insert(request);
    resultData.insert(resultHolder);

    List&lt;String&gt; possiblePackageNames = calculatePossiblePackageNames(modelName,
                                                                    modelPkgName);
    Class&lt;? extends RuleUnit&gt; ruleUnitClass = getStartingRuleUnit("RuleUnitIndicator",
                                                                (InternalKnowledgeBase)kbase,
                                                                possiblePackageNames);

    if (ruleUnitClass != null) {
        executor.run(ruleUnitClass);
        if ( "OK".equals(resultHolder.getResultCode()) ) {
          // extract result variables here
        }
    }
}

protected Class&lt;? extends RuleUnit&gt; getStartingRuleUnit(String startingRule, InternalKnowledgeBase ikb, List&lt;String&gt; possiblePackages) {
    RuleUnitRegistry unitRegistry = ikb.getRuleUnitRegistry();
    Map&lt;String,InternalKnowledgePackage&gt; pkgs = ikb.getPackagesMap();
    RuleImpl ruleImpl = null;
    for (String pkgName: possiblePackages) {
      if (pkgs.containsKey(pkgName)) {
          InternalKnowledgePackage pkg = pkgs.get(pkgName);
          ruleImpl = pkg.getRule(startingRule);
          if (ruleImpl != null) {
              RuleUnitDescr descr = unitRegistry.getRuleUnitFor(ruleImpl).orElse(null);
              if (descr != null) {
                  return descr.getRuleUnitClass();
              }
          }
      }
    }
    return null;
}

protected List&lt;String&gt; calculatePossiblePackageNames(String modelId, String...knownPackageNames) {
    List&lt;String&gt; packageNames = new ArrayList&lt;&gt;();
    String javaModelId = modelId.replaceAll("\\s","");
    if (knownPackageNames != null &amp;&amp; knownPackageNames.length &gt; 0) {
        for (String knownPkgName: knownPackageNames) {
            packageNames.add(knownPkgName + "." + javaModelId);
        }
    }
    String basePkgName = PMML4UnitImpl.DEFAULT_ROOT_PACKAGE+"."+javaModelId;
    packageNames.add(basePkgName);
    return packageNames;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">使用以下示例执行PMML模型<code>PMML4ExecutionHelper</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void executeModel(KieBase kbase,
                         Map&lt;String,Object&gt; variables,
                         String modelName,
                         String modelPkgName,
                         String correlationId) {
   PMML4ExecutionHelper helper = PMML4ExecutionHelperFactory.getExecutionHelper(modelName, kbase);
   helper.addPossiblePackageName(modelPkgName);

   PMMLRequestData request = new PMMLRequestData(correlationId, modelName);
   variables.entrySet().forEach(entry -&gt; {
     request.addRequestParam(entry.getKey(), entry.getValue);
   });

   PMML4Result resultHolder = helper.submitRequest(request);
   if ("OK".equals(resultHolder.getResultCode)) {
     // extract result variables here
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>当您使用<code>PMML4ExecutionHelper</code> ，则无需指定可能的软件包名称，也无需指定<code>RuleUnit</code>类，就像在典型的PMML模型执行中一样。</p>
</div>
<div class="paragraph">
<p>构造一个<code>PMML4ExecutionHelper</code>类，您使用<code>PMML4ExecutionHelperFactory</code>类来确定实例<code>PMML4ExecutionHelper</code>被检索。</p>
</div>
<div class="paragraph">
<p>以下是可用的<code>PMML4ExecutionHelperFactory</code>构造一个<code>PMML4ExecutionHelper</code>类：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">KIE基础中PMML资产的PMML4ExecutionHelperFactory方法</dt>
<dd>
<p>当已编译PMML资产并从现有KIE库中使用它们时，请使用以下方法：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static PMML4ExecutionHelper getExecutionHelper(String modelName, KieBase kbase)

public static PMML4ExecutionHelper getExecutionHelper(String modelName, KieBase kbase, boolean includeMiningDataSources)</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">项目类路径上PMML资产的PMML4ExecutionHelperFactory方法</dt>
<dd>
<p>当PMML资产位于项目类路径上时，请使用这些方法。的<code>classPath</code>参数是PMML文件的项目类路径位置：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static PMML4ExecutionHelper getExecutionHelper(String modelName,  String classPath, KieBaseConfiguration kieBaseConf)

public static PMML4ExecutionHelper getExecutionHelper(String modelName,String classPath, KieBaseConfiguration kieBaseConf, boolean includeMiningDataSources)</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">字节数组中PMML资产的PMML4ExecutionHelperFactory方法</dt>
<dd>
<p>当PMML资产为字节数组形式时，请使用以下方法：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static PMML4ExecutionHelper getExecutionHelper(String modelName, byte[] content, KieBaseConfiguration kieBaseConf)

public static PMML4ExecutionHelper getExecutionHelper(String modelName, byte[] content, KieBaseConfiguration kieBaseConf, boolean includeMiningDataSources)</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">PMML资产中的PMML4ExecutionHelperFactory方法<code>Resource</code></dt>
<dd>
<p>当PMML资产采用以下形式时，请使用这些方法： <code>org.kie.api.io.Resource</code>宾语：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static PMML4ExecutionHelper getExecutionHelper(String modelName, Resource resource, KieBaseConfiguration kieBaseConf)

public static PMML4ExecutionHelper getExecutionHelper(String modelName, Resource resource, KieBaseConfiguration kieBaseConf, boolean includeMiningDataSources)</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">类路径，字节数组和资源<code>PMML4ExecutionHelperFactory</code>方法为生成的规则和Java类创建一个KIE容器。该容器用作KIE基础的来源， <code>RuleUnitExecutor</code>用途。容器未保留。的<code>PMML4ExecutionHelperFactory</code>对于已经在KIE库中的PMML资产，此方法不会以这种方式创建KIE容器。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pmml-invocation-kie-server-proc_pmml-models"><a class="anchor" href="#pmml-invocation-kie-server-proc_pmml-models"></a> <a class="link" href="#pmml-invocation-kie-server-proc_pmml-models">6.4.2。使用KIE Server执行PMML模型</a></h4>
<div class="paragraph">
<p>您可以通过发送以下内容来执行已部署到KIE Server的PMML模型： <code>ApplyPmmlModelCommand</code>命令到已配置的KIE服务器。使用此命令时， <code>PMMLRequestData</code>对象被发送到KIE服务器，并且<code>PMML4Result</code>结果对象作为答复被接收。您可以通过配置的Java类或直接从REST客户端通过KIE Server REST API将PMML请求发送到KIE Server。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>KIE Server已安装和配置，包括已知用户名和具有<code>kie-server</code>角色。有关安装选项，请参阅<a href="#_installationandsetup">安装和设置（Core和IDE）</a> 。</p>
</li>
<li>
<p>KIE容器以包含PMML模型的KJAR形式部署在KIE Server中。有关项目打包的更多信息，请参见<a href="#_builddeployutilizeandrunsection">Build，Deploy，Utilize和Run</a> 。</p>
</li>
<li>
<p>您具有包含PMML模型的KIE容器的容器ID。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在客户端应用程序中，将以下依赖项添加到Java项目的相关类路径中：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Required for the PMML compiler --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;kie-pmml&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- Required for the KIE public API --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie&lt;/groupId&gt;
  &lt;artifactId&gt;kie-api&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependencies&gt;

&lt;!-- Required for the KIE Server Java client API --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
  &lt;artifactId&gt;kie-server-client&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- Required if not using classpath KIE container --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie&lt;/groupId&gt;
  &lt;artifactId&gt;kie-ci&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code><version></code>是项目中当前使用的Drools的Maven工件版本（例如7.26.0。Final-redhat-00005）。</p>
</div>
</div>
</div>
</li>
<li>
<p>从创建一个KIE容器<code>classpath</code>要么<code>ReleaseId</code> ：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();

ReleaseId releaseId = kieServices.newReleaseId( "org.acme", "my-kjar", "1.0.0" );
KieContainer kieContainer = kieServices.newKieContainer( releaseId );</code></pre>
</div>
</div>
<div class="paragraph">
<p>替代选项：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();

KieContainer kieContainer = kieServices.getKieClasspathContainer();</code></pre>
</div>
</div>
</li>
<li>
<p>创建一个类，用于将请求发送到KIE Server并接收响应：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ApplyScorecardModel {
  private static final ReleaseId releaseId =
          new ReleaseId("org.acme","my-kjar","1.0.0");
  private static final String containerId = "SampleModelContainer";
  private static KieCommands commandFactory;
  private static ClassLoader kjarClassLoader; <i class="conum" data-value="1"></i><b>(1)</b>
  private RuleServicesClient serviceClient; <i class="conum" data-value="2"></i><b>(2)</b>

  // Attributes specific to your class instance
  private String rankedFirstCode;
  private Double score;

  // Initialization of non-final static attributes
  static {
    commandFactory = KieServices.Factory.get().getCommands();

    // Specifications for kjarClassLoader, if used
    KieMavenRepository kmp = KieMavenRepository.getMavenRepository();
    File artifactFile = kmp.resolveArtifact(releaseId).getFile();
    if (artifactFile != null) {
      URL urls[] = new URL[1];
      try {
        urls[0] = artifactFile.toURI().toURL();
        classLoader = new KieURLClassLoader(urls,PMML4Result.class.getClassLoader());
      } catch (MalformedURLException e) {
        logger.error("Error getting classLoader for "+containerId);
        logger.error(e.getMessage());
      }
    } else {
      logger.warn("Did not find the artifact file for "+releaseId.toString());
    }
  }

  public ApplyScorecardModel(KieServicesConfiguration kieConfig) {
    KieServicesClient clientFactory = KieServicesFactory.newKieServicesClient(kieConfig);
    serviceClient = clientFactory.getServicesClient(RuleServicesClient.class);
  }
  ...
  // Getters and setters
  ...

  // Method for executing the PMML model on KIE Server
  public void applyModel(String occupation, int age) {
    PMMLRequestData input = new PMMLRequestData("1234","SampleModelName"); <i class="conum" data-value="3"></i><b>(3)</b>
    input.addRequestParam(new ParameterInfo("1234","occupation",String.class,occupation));
    input.addRequestParam(new ParameterInfo("1234","age",Integer.class,age));

    CommandFactoryServiceImpl cf = (CommandFactoryServiceImpl)commandFactory;
    ApplyPmmlModelCommand command = (ApplyPmmlModelCommand) cf.newApplyPmmlModel(request); <i class="conum" data-value="4"></i><b>(4)</b>

    ServiceResponse&lt;ExecutionResults&gt; results =
        ruleClient.executeCommandsWithResults(CONTAINER_ID, command); <i class="conum" data-value="5"></i><b>(5)</b>

    if (results != null) {  <i class="conum" data-value="6"></i><b>(6)</b>
      PMML4Result resultHolder = (PMML4Result)results.getResult().getValue("results");
      if (resultHolder != null &amp;&amp; "OK".equals(resultHolder.getResultCode())) {
        this.score = resultHolder.getResultValue("ScoreCard","score",Double.class).get();
        Map&lt;String,Object&gt; rankingMap =
             (Map&lt;String,Object&gt;)resultHolder.getResultValue("ScoreCard","ranking");
        if (rankingMap != null &amp;&amp; !rankingMap.isEmpty()) {
          this.rankedFirstCode = rankingMap.keySet().iterator().next();
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>如果您没有在客户端项目依赖项中包含KJAR，则定义类加载器</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>标识配置设置中定义的服务客户端，包括KIE Server REST API访问凭据</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i> <b>3</b></td>
<td>初始化一个<code>PMMLRequestData</code>宾语</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i> <b>4</b></td>
<td>创建一个实例<code>ApplyPmmlModelCommand</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i> <b>5</b></td>
<td>使用服务客户端发送命令</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i> <b>6</b></td>
<td>检索执行的PMML模型的结果</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</li>
<li>
<p>执行类实例以将PMML调用请求发送到KIE服务器。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>或者，您可以使用JMS和REST接口发送<code>ApplyPmmlModelCommand</code>命令到KIE服务器。对于REST请求，您可以使用<code>ApplyPmmlModelCommand</code>命令为<code>POST</code>请求<code>http://SERVER:PORT/kie-server/services/rest/server/containers/instances/{containerId}</code> JSON，JAXB或XStream请求格式。</p>
</div>
<div class="listingblock">
<div class="title">POST端点示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>http://localhost:8080/kie-server/services/rest/server/containers/instances/SampleModelContainer</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "apply-pmml-model-command": {
        "outIdentifier": null,
        "packageName": null,
        "hasMining": false,
        "requestData": {
          "correlationId": "123",
          "modelName": "SimpleScorecard",
          "source": null,
          "requestParams": [
            {
              "correlationId": "123",
              "name": "param1",
              "type": "java.lang.Double",
              "value": "10.0"
            },
            {
              "correlationId": "123",
              "name": "param2",
              "type": "java.lang.Double",
              "value": "15.0"
            }
          ]
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">带有端点和主体的示例卷曲请求</div>
<div class="content">
<pre class="highlightjs highlight"><code>curl -X POST "http://localhost:8080/kie-server/services/rest/server/containers/instances/SampleModelContainer" -H "accept: application/json" -H "content-type: application/json" -d "{ \"commands\": [ { \"apply-pmml-model-command\": { \"outIdentifier\": null, \"packageName\": null, \"hasMining\": false, \"requestData\": { \"correlationId\": \"123\", \"modelName\": \"SimpleScorecard\", \"source\": null, \"requestParams\": [ { \"correlationId\": \"123\", \"name\": \"param1\", \"type\": \"java.lang.Double\", \"value\": \"10.0\" }, { \"correlationId\": \"123\", \"name\": \"param2\", \"type\": \"java.lang.Double\", \"value\": \"15.0\" } ] } } } ]}"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JSON响应示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "results" : [ {
    "value" : {"org.kie.api.pmml.DoubleFieldOutput":{
  "value" : 40.8,
  "correlationId" : "123",
  "segmentationId" : null,
  "segmentId" : null,
  "name" : "OverallScore",
  "displayValue" : "OverallScore",
  "weight" : 1.0
}},
    "key" : "OverallScore"
  }, {
    "value" : {"org.kie.api.pmml.PMML4Result":{
  "resultVariables" : {
    "OverallScore" : {
      "value" : 40.8,
      "correlationId" : "123",
      "segmentationId" : null,
      "segmentId" : null,
      "name" : "OverallScore",
      "displayValue" : "OverallScore",
      "weight" : 1.0
    },
    "ScoreCard" : {
      "modelName" : "SimpleScorecard",
      "score" : 40.8,
      "holder" : {
        "modelName" : "SimpleScorecard",
        "correlationId" : "123",
        "voverallScore" : null,
        "moverallScore" : true,
        "vparam1" : 10.0,
        "mparam1" : false,
        "vparam2" : 15.0,
        "mparam2" : false
      },
      "enableRC" : true,
      "pointsBelow" : true,
      "ranking" : {
        "reasonCh1" : 5.0,
        "reasonCh2" : -6.0
      }
    }
  },
  "correlationId" : "123",
  "segmentationId" : null,
  "segmentId" : null,
  "segmentIndex" : 0,
  "resultCode" : "OK",
  "resultObjectName" : null
}},
    "key" : "results"
  } ],
  "facts" : [ ]
}</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_experimentalfeatureschapter"><a class="anchor" href="#_experimentalfeatureschapter"></a> <a class="link" href="#_experimentalfeatureschapter">7。实验特征</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_declarative_agenda"><a class="anchor" href="#_declarative_agenda"></a> <a class="link" href="#_declarative_agenda">7.1。声明性议程</a></h3>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p>声明式议程是实验性的，将来所有方面都可能发生变化。@Eager和@Direct是临时注释，用于控制规则的行为，随着声明式议程的发展，它们也会发生变化。注解而不是属性，以反映其实验性质。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>声明式议程允许使用规则控制哪些其他规则可以触发以及何时触发。虽然这将比简单使用显着性增加更多的开销，但优点是它是声明性的，因此更具可读性和可维护性，并且应允许以更简单的方式实现更多用例。</p>
</div>
<div class="paragraph">
<p>此功能默认情况下处于关闭状态，必须显式启用，这是因为该功能目前被认为是实验性的，并且可能会发生变化，但是可以通过在相应的KieBase上添加declarativeAgenda ='enabled'属性来激活该功能。 kmodule.xml文件的kbase标记，如以下示例所示。</p>
</div>
<div class="exampleblock">
<div class="title">示例68。启用声明性议程</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns="http://www.drools.org/xsd/kmodule"&gt;
      &lt;kbase name="DeclarativeKBase" declarativeAgenda="enabled"&gt;
      &lt;ksession name="KSession"&gt;
      &lt;/kbase&gt;
      &lt;/kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>基本思想是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>所有规则的匹配项都作为事实插入到WorkingMemory中。因此，您现在可以针对“匹配”进行模式匹配。规则的元数据和声明可作为Match对象上的字段使用。</p>
</li>
<li>
<p>您可以对当前规则使用kcontext.blockMatch（Match match）来阻止选定的匹配。只有当该规则变为假时，比赛才有资格被解雇。如果它已经符合触发条件并在以后被阻止，它将从议程中删除，直到被取消阻止为止。</p>
</li>
<li>
<p>一场比赛可能有多个阻止者，并且会保留一个计数。为了使计数器达到零，所有阻止程序都必须变为false，计数器才能触发。</p>
</li>
<li>
<p>kcontext.unblockAllMatches（Match match）是一个覆盖规则，它将删除所有阻止程序，无论</p>
</li>
<li>
<p>激活也可能被取消，因此它永远不会与cancelMatch一起触发</p>
</li>
<li>
<p>无障碍比赛将添加到议程中，并遵循正常的显着性，议程组，规则流组等。</p>
</li>
<li>
<p>@Direct批注允许规则在被匹配后立即触发，这将用于阻止/取消阻止匹配的规则，这些规则不希望有在其他地方产生影响的副作用。</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">示例69。新的RuleContext方法</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>void blockMatch(Match match);
      void unblockAllMatches(Match match);
      void cancelMatch(Match match);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>这是一个基本示例，它将阻止来自具有元数据@department（'sales'）的规则的所有匹配。它们将一直处于阻塞状态，直到blockerAllSalesRules规则变为假，即“ go2”被收回。</p>
</div>
<div class="exampleblock">
<div class="title">示例70。根据规则元数据阻止规则</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule rule1 @Eager @department('sales') when
      $s : String( this == 'go1' )
      then
      list.add( kcontext.rule.name + ':' + $s );
      end
      rule rule2 @Eager @department('sales') when
      $s : String( this == 'go1' )
      then
      list.add( kcontext.rule.name + ':' + $s );
      end
      rule blockerAllSalesRules @Direct @Eager when
      $s : String( this == 'go2' )
      $i : Match( department == 'sales' )
      then
      list.add( $i.rule.name + ':' + $s  );
      kcontext.blockMatch( $i );
      end</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p>除了使用@Direct注释阻止规则之外，还必须使用@Eager注释所有可能被其阻止的规则。这是因为，由于必须通过阻止规则的模式匹配来评估匹配，因此不能懒惰地评估潜在被阻止的匹配，否则就不会是任何要评估的匹配。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>本示例说明了如何使用active属性来计算活动或不活动（已触发）匹配的数量。</p>
</div>
<div class="exampleblock">
<div class="title">例子71。计算有效/无效匹配的数量</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule rule1 @Eager @department('sales') when
      $s : String( this == 'go1' )
      then
      list.add( kcontext.rule.name + ':' + $s );
      end
      rule rule2 @Eager @department('sales') when
      $s : String( this == 'go1' )
      then
      list.add( kcontext.rule.name + ':' + $s );
      end
      rule rule3 @Eager @department('sales') when
      $s : String( this == 'go1' )
      then
      list.add( kcontext.rule.name + ':' + $s );
      end
      rule countActivateInActive @Direct @Eager when
      $s : String( this == 'go2' )
      $active : Number( this == 1 ) from accumulate( $a : Match( department == 'sales', active == true ), count( $a ) )
      $inActive : Number( this == 2 ) from  accumulate( $a : Match( department == 'sales', active == false ), count( $a ) )
      then
      kcontext.halt( );
      end</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_traits"><a class="anchor" href="#_traits"></a> <a class="link" href="#_traits">7.2。特质</a></h3>
<div class="paragraph">
<p>警告：此功能仍处于试验阶段，可能会有所更改</p>
</div>
<div class="paragraph">
<p>同一事实可能具有多个动态类型，这些动态类型自然不适合于类层次结构。特性允许对这种非常常见的情况进行建模。特质是可以在运行时应用于（最终删除）单个对象的接口。要创建特征而不是传统Bean，必须像以下示例中那样显式声明它们：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>declare trait GoldenCustomer
    // fields will map to getters/setters
    code     : String
    balance  : long
    discount : int
    maxExpense : long
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>在运行时，此声明导致一个接口，该接口可用于编写模式，但不能直接实例化。为了将特征应用于对象，我们提供了新的don关键字，该关键字可以这样简单地使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>when
    $c : Customer()
then
    GoldenCustomer gc = don( $c, GoldenCustomer.class );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>当一个核心对象不具有特征时，将立即创建一个代理类（对于每个核心/特征类组合，将懒惰地生成一个这样的类）。包裹核心对象并实现trait接口的代理实例会自动插入，并可能会激活其他规则。声明和使用接口的直接好处是，可以从Drools引擎免费获取实现代理，这是在编写规则时可以利用多个继承层次结构。但是，核心类不需要静态地实现这些接口中的任何一个，也便于将遗留类用作核心。实际上，只要声明为@Traitable，任何对象都可以具有特征。请注意，该注释曾经是可选的，但现在是必需的。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>import org.drools.core.factmodel.traits.Traitable;
declare Customer
    @Traitable
    code    : String
    balance : long
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>核心类和trait接口之间的唯一连接是在代理级别：trait没有专门与核心类相关联。这意味着可以将相同的特征应用于完全不同的对象。因此，特征不能透明地公开其核心对象的字段。因此，当使用特征接口编写规则时，照常只有接口的字段可用。但是，代理类将映射接口中与核心对象字段对应的任何字段：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>when
    $o: OrderItem( $p : price, $code : custCode )
    $c: GoldenCustomer( code == $code, $a : balance, $d: discount )
then
    $c.setBalance( $a - $p*$d );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，将从底层客户对象中读取代码和余额。同样，setAccount将修改基础对象，从而保留对数据结构的强类型访问。硬字段必须在核心类和所有使用的接口中具有相同的名称和类型。该名称用于建立映射：如果两个字段具有相同的名称，则它们还必须具有相同的声明类型。注释@ org.drools.core.factmodel.traits。别名允许放宽此限制。如果提供了@Alias，则将使用其值字符串而不是原始字段名称来解析映射。@Alias可以应用于特征和核心bean。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>import org.drools.core.factmodel.traits.*;
declare trait GoldenCustomer
    balance : long @Alias( "org.acme.foo.accountBalance" )
end

declare Person
    @Traitable
    name : String
    savings : long @Alias( "org.acme.foo.accountBalance" )
end

when
    GoldenCustomer( balance &amp;gt; 1000 ) // will react to new Person( 2000 )
then
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>在放松此约束方面正在进行更多工作（请参阅稍后的“逻辑”特征的实验部分）。现在，您可能会想，如果核心类不提供接口中定义的字段的实现，会发生什么情况。我们将硬性字段称为特征字段，它们也是核心字段，因此易于使用，而我们定义软性字段时，核心类没有提供这些字段。相反，隐藏字段是核心类中的字段未由接口公开。</p>
</div>
<div class="paragraph">
<p>因此，尽管硬域管理是直观的，但仍然存在软域和隐藏域的问题。通常只能直接使用core类访问隐藏字段。但是，可以在特征接口上使用“字段”映射来访问隐藏的字段。如果无法解析该字段，则将返回null。请注意，此功能将来可能会更改。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>when
    $sc : GoldenCustomer( fields[ "age" ] &gt; 18 )  // age is declared by the underlying core class, but not by GoldenCustomer
then</code></pre>
</div>
</div>
<div class="paragraph">
<p>相反，软字段存储在特定于每个核心对象并由代理引用的类似Map的数据结构中，因此即使对象具有多个特征，也可以有效地共享它们。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>when
    $sc : GoldenCustomer( $c : code, // hard getter
                          $maxExpense : maxExpense &gt; 1000 // soft getter
    )
then
    $sc.setDiscount( ... ); // soft setter
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>核心对象还拥有对其所有代理的引用，因此可以使用一种动态的“ instanceof”运算符（我们称为isA）来跟踪已将哪些类型添加到对象。操作员可以接受字符串，类文字或类文字列表。在后一种情况下，仅当所有特征都已被使用时才满足约束条件。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$sc : GoldenCustomer( $maxExpense : maxExpense &gt; 1000,
                      this isA "SeniorCustomer", this isA [ NationalCustomer.class, OnlineCustomer.class ]
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>最终，业务逻辑可能要求从包装的对象中删除特征。为此，我们提供了两种选择。第一个是“逻辑don”，这将导致特征化操作导致代理的逻辑插入。当首先删除其逻辑支持时，TMS将确保删除该特性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>then
    don( $x, // core object
         Customer.class, // trait class
         true // optional flag for logical insertion
    )</code></pre>
</div>
</div>
<div class="paragraph">
<p>第二个是使用“ shed”关键字，该关键字将导致删除作为参数传递的子类型（或等效形式）的任何类型。请注意，从5.5版开始，棚子仅允许删除单个特定特征。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>then
    Thing t = shed( $x, GoldenCustomer.class ) // also removes any trait that</code></pre>
</div>
</div>
<div class="paragraph">
<p>此操作返回另一个实现org.drools.core.factmodel.traits的代理。Thing接口，其中定义了getFields（）和getCore（）方法。实际上，在内部，将生成所有声明的特征以扩展此接口（除了指定的任何其他特征之外）。这样可以保留带有软字段的包装，否则将丢失。</p>
</div>
<div class="paragraph">
<p>特质及其代理也以另一种方式关联。从版本5.6开始，每当“修改”核心对象时，其代理也会自动“修改”，以允许基于特征的模式对硬字段中的潜在更改做出反应。同样，只要修改了特征代理（与特征模式匹配），该修改就会传播到核心类和其他特征。此外，每当执行don操作时，核心对象也会自动修改，以重新评估可能触发的任何“ isA”操作。</p>
</div>
<div class="paragraph">
<p>可能会导致大量修改，从而严重影响性能（和正确性）。因此，当前实施了两种解决方案。首先，只要修改了核心对象，就只会更新最特定的特征（就特征接口之间的继承而言），并采用内部阻止机制来确保每个潜在匹配的模式仅被评估一次。因此，在以下情况下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>declare trait GoldenCustomer end
declare trait NationalGoldenCustomer extends GoldenCustomer end
declare trait SeniorGoldenCustomer extends GoldenCustomer end</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果对对象的修改同时是GoldenCustomer，NationalGoldenCustomer和SeniorGoldenCustomer，则会仅实际修改后两个代理。第一个将匹配GoldenCustomer和NationalGoldenCustomer的任何模式；相反，将阻止后者重新匹配GoldenCustomer，但将允许其匹配SeniorGoldenCustomer模式。相反，没有必要修改GoldenCustomer代理，因为它已经被至少一个其他更特定的特征所涵盖。</p>
</div>
<div class="paragraph">
<p>由用户决定的第二种方法是将特征标记为@PropertyReactive。属性反应性启用了特征，并考虑了特征字段映射，以阻止不必要的传播。</p>
</div>
<div class="sect3">
<h4 id="_cascading_traits"><a class="anchor" href="#_cascading_traits"></a> <a class="link" href="#_cascading_traits">7.2.1。级联特征</a></h4>
<div class="paragraph">
<p><strong>警告</strong> ：此功能是非常实验性的，可能会更改</p>
</div>
<div class="paragraph">
<p>通常，硬字段必须通过对象赋予的所有特征以其原始类型公开，以防止出现诸如</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
  @Traitable
  name : String
  id : String
end

declare trait Customer
  id : String
end

declare trait Patient
  id : long  // Person can't don Patient, or an exception will be thrown
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果人员不同时提供客户和患者，则硬字段ID的类型将是不明确的。但是，请考虑以下示例，在该示例中，GoldenCustomers推荐了他们最好的朋友，以便他们也成为客户：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
  @Traitable( logical=true )
  bestFriend : Person
end

declare trait Customer end

declare trait GoldenCustomer extends Customer
  refers : Customer @Alias( "bestFriend" )
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>除了@Alias之外，Person-as-GoldenCustomer的最好朋友可能与特征GoldenCustomer的要求兼容，只要它们本身是某种客户。将一个人标记为“具有逻辑特征”（即添加注释@Traitable（逻辑= true））将指示Drools引擎尝试保持逻辑一致性，而不是由于具有不同类型声明的硬字段（Person与顾客）。然后将执行以下操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Person p1 = new Person();
Person p2 = new Person();
p1.setBestFriend( p2 );
...
Customer c2 = don( p2, Customer.class );
...
GoldenCustomer gc1 = don( p1, GoldenCustomer.class );
...
p1.getBestFriend(); // returns p2
gc1.getRefers(); // returns c2, a Customer proxy wrapping p2</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，当p1成为GoldenCustomer时，p2必须本身已经成为Customer，否则会因为抛出GoldenCustomer的定义而引发运行时异常。</p>
</div>
<div class="paragraph">
<p>但是，在某些情况下，由于p1是GoldenCustomer，所以您可能想推断而不是验证p2是客户。可以通过使用@ org.drools.core.factmodel.traits批注将Customer标记为“逻辑”来启用此模式。特性（逻辑= true）。在这种情况下，如果在p1成为GoldenCustomer时p2不再是客户，它将自动具有特质Customer以保持系统的逻辑完整性。</p>
</div>
<div class="paragraph">
<p>请注意，核心类上的注释启用了对其字段的动态类型管理，而特征上的注释则确定是将其强制执行为完整性约束还是动态地级联。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>import org.drools.factmodel.traits.*;

declare trait Customer
    @Trait( logical = true )
end</code></pre>
</div>
</div>
<h1 id="_drools_integration" class="discrete">流口水整合</h1>
<div class="paragraph">
<p>整合文件</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.commands"><a class="anchor" href="#_ch.commands"></a> <a class="link" href="#_ch.commands">8。口水命令</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="runtime-commands-con_kie-apis"><a class="anchor" href="#runtime-commands-con_kie-apis"></a> <a class="link" href="#runtime-commands-con_kie-apis">8.1。Drools中的运行时命令</a></h3>
<div class="paragraph">
<p>Drools支持可以将运行时命令发送到KIE Server进行资产相关的操作，例如执行所有规则或在KIE会话中插入或收回对象。支持的运行时命令的完整列表位于<code>org.drools.core.command.runtime</code>打包在您的Drools实例中。</p>
</div>
<div class="paragraph">
<p>在KIE Server REST API中，您可以使用全局<code>org.drools.core.command.runtime</code>命令或特定于规则<code>org.drools.core.command.runtime.rule</code>命令作为请求主体<code>POST</code>要求<code>http://SERVER:PORT/kie-server/services/rest/server/containers/instances/{containerId}</code> 。有关使用KIE Server REST API的更多信息，请参阅<a href="#kie-server-rest-api-con_kie-apis">适用于KIE容器和业务资产的KIE Server REST API</a> 。</p>
</div>
<div class="paragraph">
<p>在KIE Server Java客户端API中，您可以将这些命令与相关的Java客户端一起嵌入到Java应用程序中。例如，对于与规则相关的命令，您可以使用<code>RuleServicesClient</code>带有嵌入式命令的Java客户端。有关使用KIE Server Java客户端API的更多信息，请参阅<a href="#kie-server-java-api-con_kie-apis">KIE容器和业务资产的KIE Server Java客户端API</a> 。</p>
</div>
<div class="sect3">
<h4 id="runtime-commands-samples-ref_kie-apis"><a class="anchor" href="#runtime-commands-samples-ref_kie-apis"></a> <a class="link" href="#runtime-commands-samples-ref_kie-apis">8.1.1。Drools中的示例运行时命令</a></h4>
<div class="paragraph">
<p>以下是可与KIE Server REST API或Java客户端API一起使用的示例运行时命令示例，用于在KIE Server中进行资产相关的操作：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BatchExecutionCommand</code></p>
</li>
<li>
<p><code>InsertObjectCommand</code></p>
</li>
<li>
<p><code>RetractCommand</code></p>
</li>
<li>
<p><code>ModifyCommand</code></p>
</li>
<li>
<p><code>GetObjectCommand</code></p>
</li>
<li>
<p><code>GetObjectsCommand</code></p>
</li>
<li>
<p><code>InsertElementsCommand</code></p>
</li>
<li>
<p><code>FireAllRulesCommand</code></p>
</li>
<li>
<p><code>QueryCommand</code></p>
</li>
<li>
<p><code>SetGlobalCommand</code></p>
</li>
<li>
<p><code>GetGlobalCommand</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>有关受支持的运行时命令的完整列表，请参见<code>org.drools.core.command.runtime</code>打包在您的Drools实例中。</p>
</div>
<div class="paragraph">
<p>本节中的每个命令都包括针对KIE Server REST API的REST请求主体示例（JSON）和针对KIE Server Java客户端API的嵌入式Java命令示例。 Java示例使用一个对象<code>org.drools.compiler.test.Person</code>与田野<code>name</code> （字符串）和<code>age</code> （整数）。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">BatchExecutionCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>包含要一起执行的多个命令。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表18。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">名称</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>commands</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">要执行的命令列表。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>lookup</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">设置将在其上执行命令的KIE会话ID。对于无状态的KIE会话，此属性是必需的。对于有状态的KIE会话，此属性是可选的，如果未指定，则使用默认的KIE会话。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">对于无状态KIE会话是必需的，对于有状态KIE会话是可选的</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">KIE会话ID位于<code>kmodule.xml</code> Drools项目的文件。要在Business Central中查看或添加KIE会话ID以与<code>lookup</code>命令属性，导航到Business Central中的相关项目，然后转到项目<strong>设置</strong> → <strong>KIE基础</strong> → <strong>KIE会话</strong> 。如果不存在KIE基础，请单击<strong>添加KIE基础</strong> → <strong>KIE会话</strong>以定义新的KIE基础和KIE会话。
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "lookup": "ksession1",
  "commands": [ {
      "insert": {
        "object": {
          "org.drools.compiler.test.Person": {
            "name": "john",
            "age": 25
          }
        }
      }
    },
    {
      "fire-all-rules": {
        "max": 10,
        "out-identifier": "firedActivations"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BatchExecutionCommand command = new BatchExecutionCommand();
command.setLookup("ksession1");

InsertObjectCommand insertObjectCommand = new InsertObjectCommand(new Person("john", 25));
FireAllRulesCommand fireAllRulesCommand = new FireAllRulesCommand();

command.getCommands().add(insertObjectCommand);
command.getCommands().add(fireAllRulesCommand);

ksession.execute(command);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": 0,
              "key": "firedActivations"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">InsertObjectCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>将对象插入KIE会话。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表19。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">名称</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>object</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">要插入的对象</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">的ID <code>FactHandle</code>从对象插入创建并添加到执行结果</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>return-object</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">布尔值，确定是否必须在执行结果中返回对象（默认值： <code>true</code> ）</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>entry-point</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">插入的入口点</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选的</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "insert": {
        "entry-point": "my stream",
        "object": {
          "org.drools.compiler.test.Person": {
            "age": 25,
            "name": "john"
          }
        },
        "out-identifier": "john",
        "return-object": false
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Command insertObjectCommand =
  CommandFactory.newInsert(new Person("john", 25), "john", false, null);

ksession.execute(insertObjectCommand);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [],
          "facts": [
            {
              "value": {
                "org.drools.core.common.DefaultFactHandle": {
                  "external-form": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap"
                }
              },
              "key": "john"
            }
          ]
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">缩回命令</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>从KIE会话撤回对象。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表20。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">名称</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>fact-handle</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">的<code>FactHandle</code>与要收回的对象相关联</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "retract": {
        "fact-handle": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令：使用<code>FactHandleFromString</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RetractCommand retractCommand = new RetractCommand();
retractCommand.setFactHandleFromString("123:234:345:456:567");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令：使用<code>FactHandle</code>从插入的对象</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RetractCommand retractCommand = new RetractCommand(factHandle);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container employee-rostering successfully called.",
      "result": {
        "execution-results": {
          "results": [],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">修改命令</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>修改KIE会话中先前插入的对象。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表21。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">名称</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>fact-handle</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">的<code>FactHandle</code>与要修改的对象关联</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>setters</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用于对象修改的设置器列表</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "modify": {
        "fact-handle": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap",
        "setters": {
          "accessor": "age",
          "value": 25
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ModifyCommand modifyCommand = new ModifyCommand(factHandle);

List&lt;Setter&gt; setters = new ArrayList&lt;Setter&gt;();
setters.add(new SetterImpl("age", "25"));

modifyCommand.setSetters(setters);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container employee-rostering successfully called.",
      "result": {
        "execution-results": {
          "results": [],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">GetObjectCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>从KIE会话中检索对象。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表22。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">名称</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>fact-handle</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">的<code>FactHandle</code>与要检索的对象关联</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">的ID <code>FactHandle</code>从对象插入创建并添加到执行结果</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选的</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "get-object": {
        "fact-handle": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap",
        "out-identifier": "john"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">GetObjectCommand getObjectCommand = new GetObjectCommand();
getObjectCommand.setFactHandleFromString("123:234:345:456:567");
getObjectCommand.setOutIdentifier("john");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": null,
              "key": "john"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">GetObjectsCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>从KIE会话中检索所有对象作为集合。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表23。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">名称</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>object-filter</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">筛选从KIE会话返回的对象</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">执行结果中使用的标识符</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选的</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "get-objects": {
        "out-identifier": "objects"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">GetObjectsCommand getObjectsCommand = new GetObjectsCommand();
getObjectsCommand.setOutIdentifier("objects");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": [
                {
                  "org.apache.xerces.dom.ElementNSImpl": "&lt;?xml version=\"1.0\" encoding=\"UTF-16\"?&gt;\n&lt;object xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"person\"&gt;&lt;age&gt;25&lt;/age&gt;&lt;name&gt;john&lt;/name&gt;\n &lt;\/object&gt;"
                },
                {
                  "org.drools.compiler.test.Person": {
                    "name": "john",
                    "age": 25
                  }
                }
              ],
              "key": "objects"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">InsertElementsCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>将对象列表插入KIE会话。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表24。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">名称</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>objects</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">要插入KIE会话的对象列表</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">的ID <code>FactHandle</code>从对象插入创建并添加到执行结果</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>return-object</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用于确定是否必须在执行结果中返回对象的布尔值。默认值： <code>true</code> 。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>entry-point</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">插入的入口点</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选的</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
    "insert-elements": {
        "objects": [
            {
                "containedObject": {
                    "@class": "org.drools.compiler.test.Person",
                    "age": 25,
                    "name": "john"
                }
            },
            {
                "containedObject": {
                    "@class": "Person",
                    "age": 35,
                    "name": "sarah"
                }
            }
        ]
    }
  }
]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;Object&gt; objects = new ArrayList&lt;Object&gt;();
objects.add(new Person("john", 25));
objects.add(new Person("sarah", 35));

Command insertElementsCommand = CommandFactory.newInsertElements(objects);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [],
          "facts": [
            {
              "value": {
                "org.drools.core.common.DefaultFactHandle": {
                  "external-form": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap"
                }
              },
              "key": "john"
            },
            {
              "value": {
                "org.drools.core.common.DefaultFactHandle": {
                  "external-form": "0:4:436792766:-2127720266:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap"
                }
              },
              "key": "sarah"
            }
          ]
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">FireAllRulesCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>执行KIE会话中的所有规则。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表25。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">名称</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>max</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">要执行的最大规则数。默认是<code>-1</code>并且对执行没有任何限制。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用来检索执行结果中激发的规则数的ID。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>agenda-filter</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">议程过滤器，用于规则执行。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选的</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "fire-all-rules": {
        "max": 10,
        "out-identifier": "firedActivations"
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">FireAllRulesCommand fireAllRulesCommand = new FireAllRulesCommand();
fireAllRulesCommand.setMax(10);
fireAllRulesCommand.setOutIdentifier("firedActivations");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": 0,
              "key": "firedActivations"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">QueryCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>执行在KIE库中定义的查询。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表26。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">名称</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">查询名称。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">查询结果的ID。使用此标识符将查询结果添加到执行结果中。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>arguments</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">要作为查询参数传递的对象列表。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选的</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [
    {
      "query": {
        "name": "persons",
        "arguments": [],
        "out-identifier": "persons"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">QueryCommand queryCommand = new QueryCommand();
queryCommand.setName("persons");
queryCommand.setOutIdentifier("persons");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "SUCCESS",
  "msg": "Container stateful-session successfully called.",
  "result": {
    "execution-results": {
      "results": [
        {
          "value": {
            "org.drools.core.runtime.rule.impl.FlatQueryResults": {
              "idFactHandleMaps": {
                "type": "LIST",
                "componentType": null,
                "element": [
                  {
                    "type": "MAP",
                    "componentType": null,
                    "element": [
                      {
                        "value": {
                          "org.drools.core.common.DisconnectedFactHandle": {
                            "id": 1,
                            "identityHashCode": 1809949690,
                            "objectHashCode": 1809949690,
                            "recency": 1,
                            "object": {
                              "org.kie.server.testing.Person": {
                                "fullname": "John Doe",
                                "age": 47
                              }
                            },
                            "entryPointId": "DEFAULT",
                            "traitType": "NON_TRAIT",
                            "external-form": "0:1:1809949690:1809949690:1:DEFAULT:NON_TRAIT:org.kie.server.testing.Person"
                          }
                        },
                        "key": "$person"
                      }
                    ]
                  }
                ]
              },
              "idResultMaps": {
                "type": "LIST",
                "componentType": null,
                "element": [
                  {
                    "type": "MAP",
                    "componentType": null,
                    "element": [
                      {
                        "value": {
                          "org.kie.server.testing.Person": {
                            "fullname": "John Doe",
                            "age": 47
                          }
                        },
                        "key": "$person"
                      }
                    ]
                  }
                ]
              },
              "identifiers": {
                "type": "SET",
                "componentType": null,
                "element": [
                  "$person"
                ]
              }
            }
          },
          "key": "persons"
        }
      ],
      "facts": []
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">SetGlobalCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>将对象设置为全局状态。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表27。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">名称</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">在KIE库中定义的全局变量的ID</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>object</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">要设置为全局变量的对象</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>out</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">布尔值，从执行结果中排除您设置的全局变量</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">全局执行结果的ID</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选的</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [
    {
      "set-global": {
        "identifier": "helper",
        "object": {
          "org.kie.server.testing.Person": {
            "fullname": "kyle",
            "age": 30
          }
        },
        "out-identifier": "output"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">SetGlobalCommand setGlobalCommand = new SetGlobalCommand();
setGlobalCommand.setIdentifier("helper");
setGlobalCommand.setObject(new Person("kyle", 30));
setGlobalCommand.setOut(true);
setGlobalCommand.setOutIdentifier("output");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "SUCCESS",
  "msg": "Container stateful-session successfully called.",
  "result": {
    "execution-results": {
      "results": [
        {
          "value": {
            "org.kie.server.testing.Person": {
              "fullname": "kyle",
              "age": 30
            }
          },
          "key": "output"
        }
      ],
      "facts": []
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">GetGlobalCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>检索先前定义的全局对象。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表28。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">名称</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">在KIE库中定义的全局变量的ID</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">执行结果中使用的ID</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选的</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "get-global": {
        "identifier": "helper",
        "out-identifier": "helperOutput"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">GetGlobalCommand getGlobalCommand = new GetGlobalCommand();
getGlobalCommand.setIdentifier("helper");
getGlobalCommand.setOutIdentifier("helperOutput");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": null,
              "key": "helperOutput"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cdichapter"><a class="anchor" href="#_cdichapter"></a> <a class="link" href="#_cdichapter">9。CDI</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_2"><a class="anchor" href="#_introduction_2"></a> <a class="link" href="#_introduction_2">9.1。介绍</a></h3>
<div class="paragraph">
<p><a href="http://www.cdi-spec.org">CDI</a> （上下文和依赖注入）是Java规范，它为应用程序提供声明性控件和结构。KIE可以使用它来自动实例化和绑定事物，而无需使用编程API。</p>
</div>
</div>
<div class="sect2">
<h3 id="_annotations"><a class="anchor" href="#_annotations"></a> <a class="link" href="#_annotations">9.2。注解</a></h3>
<div class="paragraph">
<p>@ KContainer，@ KBase和@KSession均支持可选的“名称”属性。CDI通常在注入时执行“ getOrCreate”，所有注入针对同一组注解接收相同的实例。“名称”注释会为每个名称强制一个唯一的实例，尽管该名称的所有实例都将具有相同的身份。</p>
</div>
<div class="sect3">
<h4 id="_kreleaseid"><a class="anchor" href="#_kreleaseid"></a> <a class="link" href="#_kreleaseid">9.2.1。@KReleaseId</a></h4>
<div class="paragraph">
<p>用于将实例绑定到KieModule的特定版本。如果kie-ci在类路径中，它将自动解决依赖关系，并从远程存储库下载。</p>
</div>
</div>
<div class="sect3">
<h4 id="_kcontainer"><a class="anchor" href="#_kcontainer"></a> <a class="link" href="#_kcontainer">9.2.2。@KContainer</a></h4>
<div class="paragraph">
<p>@KContainer是可选的，因为可以通过使用@Inject和变量类型推断来检测和添加它。</p>
</div>
<div class="listingblock">
<div class="title">注入Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private KieContainer kContainer;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">为动态KieModule注入KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KReleaseId(groupId = "jar1", artifactId = "art1", version = "1.1")
private KieContainer kContainer;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">为动态KieModule注入名为KieContainer的对象</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KContainer(name = "kc1")
@KReleaseId(groupId = "jar1", artifactId = "art1", version = "1.1")
private KieContainer kContainer;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kbase"><a class="anchor" href="#_kbase"></a> <a class="link" href="#_kbase">9.2.3。@KBase</a></h4>
<div class="paragraph">
<p>@KBase是可选的，因为可以通过使用@Inject和变量类型推断来检测和添加它。</p>
</div>
<div class="paragraph">
<p>如果提供了默认参数，则默认参数会映射到value属性，并从kmodule.xml文件中指定KieBase的名称。</p>
</div>
<div class="listingblock">
<div class="title">从类路径KieContainer注入默认的KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private KieBase kbase;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">从动态KieModule注入默认的KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">“ jar1”的并行版本加载。KBase1'KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KBase("kbase1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase1v10;

@Inject
@KBase("kbase1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.1")
private KieBase kbase1v10;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">使用“名称”属性将新实例强制为“ jar1”。KBase1'KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession(value="kbase1", name="kb1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase1kb1;

@Inject
@KSession(value="kbase1", name="kb2")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase1kb2;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ksession_for_kiesession"><a class="anchor" href="#_ksession_for_kiesession"></a> <a class="link" href="#_ksession_for_kiesession">9.2.4。KieSession的@KSession</a></h4>
<div class="paragraph">
<p>@KSession是可选的，因为可以使用@Inject和变量类型推断来检测和添加它。</p>
</div>
<div class="paragraph">
<p>如果提供了默认参数，则默认参数会映射到value属性，并从kmodule.xml文件中指定KieSession的名称。</p>
</div>
<div class="listingblock">
<div class="title">从类路径KieContainer注入默认KieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private KieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">从动态KieModule注入默认的KieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">“ jar1”的并行版本加载。KBase1'KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksessionv10;

@Inject
@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.1")
private KieSession ksessionv11;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">使用“名称”属性将新实例强制为“ jar1”。KBase1'KieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession(value="ksession1", name="ks1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession1ks1

@Inject
@KSession(value="ksession1", name="ks2")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession1ks2</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ksession_for_statelesskiesession"><a class="anchor" href="#_ksession_for_statelesskiesession"></a> <a class="link" href="#_ksession_for_statelesskiesession">9.2.5。@KSession用于StatelessKieSession</a></h4>
<div class="paragraph">
<p>@KSession是可选的，因为可以使用@Inject和变量类型推断来检测和添加它。</p>
</div>
<div class="paragraph">
<p>如果提供了默认参数，则默认参数会映射到value属性，并从kmodule.xml文件中指定KieSession的名称。</p>
</div>
<div class="listingblock">
<div class="title">从类路径KieContainer注入默认的StatelessKieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private StatelessKieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">从动态KieModule注入默认的StatelessKieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">“ jar1”的并行版本加载。KBase1'KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession("ksession1")
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.0")
private StatelessKieSession ksessionv10;

@Inject
@KSession("ksession1")
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.1")
private StatelessKieSession ksessionv11;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">使用“名称”属性将新实例强制为“ jar1”。KBase1'StatelessKieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession(value="ksession1", name="ks1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession1ks1

@Inject
@KSession(value="ksession1", name="ks2")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession1ks2</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_api_example_comparison"><a class="anchor" href="#_api_example_comparison"></a> <a class="link" href="#_api_example_comparison">9.3。API示例比较</a></h3>
<div class="paragraph">
<p>CDI可以将实例注入字段，甚至可以将其作为参数传递。在此示例中，使用了场注入。</p>
</div>
<div class="listingblock">
<div class="title">名为KieSession的CDI示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession("ksession1")
KieSession kSession;

public void go(PrintStream out) {
    kSession.setGlobal("out", out);
    kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
    kSession.fireAllRules();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>与API方法相比，此代码更少，更具声明性。</p>
</div>
<div class="listingblock">
<div class="title">名为KieSession的API等效示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void go(PrintStream out) {
    KieServices ks = KieServices.Factory.get();
    KieContainer kContainer = ks.getKieClasspathContainer();

    KieSession kSession = kContainer.newKieSession("ksession1");
    kSession.setGlobal("out", out);
    kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
    kSession.fireAllRules();
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.kie.spring"><a class="anchor" href="#_ch.kie.spring"></a> <a class="link" href="#_ch.kie.spring">10。与Spring整合</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_important_changes_for_drools_6_0"><a class="anchor" href="#_important_changes_for_drools_6_0"></a> <a class="link" href="#_important_changes_for_drools_6_0">10.1。Drools 6.0的重要更改</a></h3>
<div class="paragraph">
<p>Drools Spring集成已对Drools 6.0的更改进行了完整的内联转换。以下是一些主要更改</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Drools Spring的建议前缀已从“ drools：”更改为“ kie：”</p>
</li>
<li>
<p>6.0中的新顶级标签</p>
<div class="ulist">
<ul>
<li>
<p>kie：kmodule</p>
</li>
<li>
<p>kie：import（从6.2版开始）</p>
</li>
<li>
<p>kie：releaseId（从6.2版开始）</p>
</li>
</ul>
</div>
</li>
<li>
<p>以下标签不再作为顶级标签有效。</p>
<div class="ulist">
<ul>
<li>
<p>kie：kbase- <em>kie：kmodule</em>标记的<em>子代</em> 。</p>
</li>
<li>
<p>kie：ksession- <em>kie：kbase</em>标记的<em>子代</em> 。</p>
</li>
</ul>
</div>
</li>
<li>
<p>从以前的版本Drools 5.x中删除标签</p>
<div class="ulist">
<ul>
<li>
<p>流口水：资源</p>
</li>
<li>
<p>流口水：资源</p>
</li>
<li>
<p>流口水：网格</p>
</li>
<li>
<p>流口水：网格节点</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_integration_with_drools_expert"><a class="anchor" href="#_integration_with_drools_expert"></a> <a class="link" href="#_integration_with_drools_expert">10.2。与Drools Expert集成</a></h3>
<div class="paragraph">
<p>在本节中，我们将解释<em>kie</em>命名空间。</p>
</div>
<div class="sect3">
<h4 id="_kiemodule"><a class="anchor" href="#_kiemodule"></a> <a class="link" href="#_kiemodule">10.2.1。KieModule</a></h4>
<div class="paragraph">
<p>的<em><kie:kmodule></kie:kmodule></em>定义KieBase和相关KieSession的集合。<em>kmodule</em>标记具有一个MANDATORY参数“ id”。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表29。样品</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需要</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">Bean的<em>ID</em>是要从其他Bean引用的名称。标准Spring ID语义适用。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>kmodule</em>标记只能包含以下标记作为子标记。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>kie：kbase</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>有关对kmodule需求的详细说明，请参阅Drools Expert文档中的kmodule.xml文档。</p>
</div>
</div>
<div class="sect3">
<h4 id="_kiebase_3"><a class="anchor" href="#_kiebase_3"></a> <a class="link" href="#_kiebase_3">10.2.2。凯基</a></h4>
<div class="sect4">
<h5 id="_kiekbases_parameters_as_attributes"><a class="anchor" href="#_kiekbases_parameters_as_attributes"></a> <a class="link" href="#_kiekbases_parameters_as_attributes">10.2.2.1。 <kie:kbase>的参数作为属性：</kie:kbase></a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表30。样品</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需要</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">名称</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">KieBase的名称</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">包装</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用逗号分隔的要包含在此kbase中的资源包列表</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">包括</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">要包括的kbase名称。来自相应kbase的所有资源都包含在此kbase中。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">默认</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">布尔值（TRUE / FALSE）。默认的kbase，如果未提供，则假定为FALSE</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">范围</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">原型|单身人士。如果未提供，则假定为单例（默认）</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">eventProcessingMode</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">事件处理模式。有效选项是STREAM，CLOUD</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">等于行为</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">有效选项是IDENTITY，EQUALITY</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">声明性议程</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">有效选项启用，禁用，true，false</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_a_kbase_tag_can_contain_only_the_followingtags_as_children"><a class="anchor" href="#_a_kbase_tag_can_contain_only_the_followingtags_as_children"></a> <a class="link" href="#_a_kbase_tag_can_contain_only_the_followingtags_as_children">10.2.2.2。<em>kbase</em>标记只能包含以下标记作为子标记。</a></h5>
<div class="ulist">
<ul>
<li>
<p>kie：ksession</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_kiekbases_definition_example"><a class="anchor" href="#_kiekbases_definition_example"></a> <a class="link" href="#_kiekbases_definition_example">10.2.2.3。 <kie:kbase>的定义示例</kie:kbase></a></h5>
<div class="paragraph">
<p>一个kmodule可以包含多个（1..n）kbase元素。</p>
</div>
<div class="exampleblock">
<div class="title">例子72. kbase定义例子</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="sample_module"&gt;
   &lt;kie:kbase name="kbase1" packages="org.drools.spring.sample"&gt;
     ...
   &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_spring_bean_scope_for_kiebase_and_kiesession"><a class="anchor" href="#_spring_bean_scope_for_kiebase_and_kiesession"></a> <a class="link" href="#_spring_bean_scope_for_kiebase_and_kiesession">10.2.2.4。Spring Bean范围（用于KieBase和KieSession）</a></h5>
<div class="paragraph">
<p>定义KieBase或KieSession时，可以选择声明该bean的作用域。例如，要强制Spring每次需要一个新的bean实例时，应将bean的scope属性声明为'prototype'。如果希望Spring每次需要返回相同的bean实例时，以类似的方式，则应将bean的scope属性声明为'singleton'。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_important_note"><a class="anchor" href="#_important_note"></a> <a class="link" href="#_important_note">10.2.3。重要的提示</a></h4>
<div class="paragraph">
<p>为了正确初始化kmodule对象（kbase / ksession），对于类型为的Bean是强制性的<code>org.kie.spring.KModuleBeanFactoryPostProcessor</code>要么<code>org.kie.spring.annotations.KModuleAnnotationPostProcessor</code>被定义。</p>
</div>
<div class="exampleblock">
<div class="title">示例73。常规Kie-Spring Post ProcessorBean定义</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">例子74.使用注释时的kie-spring postprocessorbean定义</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="kiePostProcessor"
          class="org.kie.spring.annotations.KModuleAnnotationPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>没有org.kie.spring。KModuleBeanFactoryPostProcessor或org.kie.spring.annotations。如果使用KModuleAnnotationPostProcessor bean定义，则kie-spring集成将无法正常工作。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_kiesessions"><a class="anchor" href="#_kiesessions"></a> <a class="link" href="#_kiesessions">10.2.4。KieSessions</a></h4>
<div class="paragraph">
<p><kie:ksession>元素定义KieSessions。相同的标记用于定义两个有状态（ <em>org.kie.api.runtime。KieSession</em> ）和无状态（ <em>org.kie.api.runtime。StatelessKieSession</em> ）会话。</kie:ksession></p>
</div>
<div class="sect4">
<h5 id="_kieksessions_parameters_as_attributes"><a class="anchor" href="#_kieksessions_parameters_as_attributes"></a> <a class="link" href="#_kieksessions_parameters_as_attributes">10.2.4.1。 <kie:ksession>的参数作为属性：</kie:ksession></a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表31。样品</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需要</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">名称</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">ksession的名称。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">类型</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">会话是<em>有状态</em>还是<em>无状态？</em> 。如果此属性为空或丢失，则假定该会话为有状态类型。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">默认</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">这是默认会话吗？</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">范围</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">原型|单身人士。如果未提供，则假定为单例（默认）</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">clockType</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">实时或伪</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">听众参考</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">指定对事件侦听器组的引用（请参阅下面的<a href="#_kie_grouping_listeners">“定义</a>侦听器组<a href="#_kie_grouping_listeners">”</a>部分）。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">例子75. ksession定义例子</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="sample-kmodule"&gt;
  &lt;kie:kbase name="drl_kiesample3" packages="drl_kiesample3"&gt;
    &lt;kie:ksession name="ksession1" type="stateless"/&gt;
    &lt;kie:ksession name="ksession2"/&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_spring_bean_scope_for_kiebase_and_kiesession_2"><a class="anchor" href="#_spring_bean_scope_for_kiebase_and_kiesession_2"></a> <a class="link" href="#_spring_bean_scope_for_kiebase_and_kiesession_2">10.2.4.2。Spring Bean范围（用于KieBase和KieSession）</a></h5>
<div class="paragraph">
<p>定义KieBase或KieSession时，可以选择声明该bean的作用域。例如，要强制Spring每次需要一个新的bean实例时，应将bean的scope属性声明为'prototype'。如果希望Spring每次需要返回相同的bean实例时，以类似的方式，则应将bean的scope属性声明为'singleton'。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiereleaseid"><a class="anchor" href="#_kiereleaseid"></a> <a class="link" href="#_kiereleaseid">10.2.5。凯：ReleaseId</a></h4>
<div class="sect4">
<h5 id="_kiereleaseids_parameters_as_attributes"><a class="anchor" href="#_kiereleaseids_parameters_as_attributes"></a> <a class="link" href="#_kiereleaseids_parameters_as_attributes">10.2.5.1。 <kie:releaseid>的参数作为属性：</kie:releaseid></a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表32。样品</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需要</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">Bean的<em>ID</em>是要从其他Bean引用的名称。标准Spring ID语义适用。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">来自Maven GAV的groupId</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">artifactId</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">来自Maven GAV的artifactId</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">版</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">来自Maven GAV的版本</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">例子76. releaseId定义例子</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:releaseId id="beanId" groupId="org.kie.spring"
            artifactId="named-artifactId" version="1.0.0-SNAPSHOT"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kieimport"><a class="anchor" href="#_kieimport"></a> <a class="link" href="#_kieimport">10.2.6。凯：进口</a></h4>
<div class="paragraph">
<p>从6.2版开始，kie-spring允许从类路径中找到的kjars中导入kie对象。当前支持两种导入kie对象的模式。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需要</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">releaseId</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">引用Bean ID。标准Spring ID语义适用。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">enableScanner</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">启用扫描仪。仅当指定了“ releaseId”时，才使用此属性。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">ScannerInterval</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">扫描间隔（以毫秒为单位）。仅当指定了“ releaseId”时，才使用此属性。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_global_import"><a class="anchor" href="#_global_import"></a> <a class="link" href="#_global_import">10.2.6.1。全球进口</a></h5>
<div class="paragraph">
<p><em>import</em>标签将强制自动扫描类路径上的所有jar，初始化Kie对象（Kbase / KSessions）并将这些对象导入spring上下文。</p>
</div>
<div class="listingblock">
<div class="title">全球进口</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:import /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specific_import_releaseid"><a class="anchor" href="#_specific_import_releaseid"></a> <a class="link" href="#_specific_import_releaseid">10.2.6.2。特定导入-ReleaseId</a></h5>
<div class="paragraph">
<p>在import标签上使用<em>releaseId-ref</em>属性将初始化特定的Kie对象（Kbase / KSessions）并将这些对象导入spring上下文。</p>
</div>
<div class="listingblock">
<div class="title">使用releaseId导入Kie对象</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:import releaseId-ref="namedKieSession"/&gt;
&lt;kie:releaseId id="namedKieSession" groupId="org.drools"
            artifactId="named-kiesession" version="7.30.0.Final"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以为使用特定releaseId导入的KieBase启用Kie扫描功能。此功能当前不适用于全局导入。</p>
</div>
<div class="listingblock">
<div class="title">使用releaseId导入Kie对象-启用扫描仪</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:import releaseId-ref="namedKieSession"
            enableScanner="true" scannerInterval="1000"/&gt;

&lt;kie:releaseId id="namedKieSession" groupId="org.drools"
            artifactId="named-kiesession" version="7.30.0.Final"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果定义并启用了扫描程序，则会创建一个隐式<em>KieScanner</em>对象，并将其插入到spring上下文中。可以从spring上下文中检索它。</p>
</div>
<div class="listingblock">
<div class="title">从Spring Context检索KieScanner</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// the implicit name would be releaseId#scanner
KieScanner releaseIdScanner = context.getBean("namedKieSession#scanner", KieScanner.class);
releaseIdScanner.scanNow();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>kie-ci必须在类路径上可用，才能使releaseId导入功能起作用。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_annotations_2"><a class="anchor" href="#_annotations_2"></a> <a class="link" href="#_annotations_2">10.2.7。注解</a></h4>
<div class="paragraph">
<p>@ KContainer，@ KBase和@KSession均支持可选的“名称”属性。Spring通常在注入时会“获取”，所有注入针对同一组注释都接收相同的实例。“名称”注释会为每个名称强制一个唯一的实例，尽管该名称的所有实例都将具有相同的身份。</p>
</div>
<div class="sect4">
<h5 id="_kreleaseid_2"><a class="anchor" href="#_kreleaseid_2"></a> <a class="link" href="#_kreleaseid_2">10.2.7.1。@KReleaseId</a></h5>
<div class="paragraph">
<p>用于将实例绑定到KieModule的特定版本。如果kie-ci在类路径中，它将自动解决依赖关系，并从远程存储库下载。</p>
</div>
</div>
<div class="sect4">
<h5 id="_kcontainer_2"><a class="anchor" href="#_kcontainer_2"></a> <a class="link" href="#_kcontainer_2">10.2.7.2。@KContainer</a></h5>
<div class="listingblock">
<div class="title">注入Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KContainer
private KieContainer kContainer;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">为动态KieModule注入KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KContainer
@KReleaseId(groupId = "jar1", artifactId = "art1", version = "1.1")
private KieContainer kContainer;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">为动态KieModule注入名为KieContainer的对象</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KContainer(name = "kc1")
@KReleaseId(groupId = "jar1", artifactId = "art1", version = "1.1")
private KieContainer kContainer;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kbase_2"><a class="anchor" href="#_kbase_2"></a> <a class="link" href="#_kbase_2">10.2.7.3。@KBase</a></h5>
<div class="paragraph">
<p>如果提供了默认参数，则默认参数将映射到value属性，并从spring xml文件中指定KieBase的名称。</p>
</div>
<div class="listingblock">
<div class="title">从类路径KieContainer注入默认的KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KBase
private KieBase kbase;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">从动态KieModule注入默认的KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KBase
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">“ jar1”的并行版本加载。KBase1'KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KBase("kbase1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieBase kbase1v10;

@KBase("kbase1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.1")
private KieBase kbase1v11;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">“ jar1.ksession1” KieSession的并行版本加载</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession11kb2;

@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.1")
private KieSession ksession11kb2;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ksession_for_kiesession_2"><a class="anchor" href="#_ksession_for_kiesession_2"></a> <a class="link" href="#_ksession_for_kiesession_2">10.2.7.4。KieSession的@KSession</a></h5>
<div class="paragraph">
<p>如果提供默认参数，则默认参数将映射到value属性，并从kmodule.xml或spring xml文件中指定KieSession的名称。</p>
</div>
<div class="listingblock">
<div class="title">从类路径KieContainer注入默认KieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KSession
private KieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">从动态KieModule注入默认的KieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KSession
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">“ jar1”的并行版本加载。KBase1'KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksessionv10;

@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.1")
private KieSession ksessionv11;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">使用“名称”属性将新实例强制为“ jar1”。KBase1'KieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession1ks1

@KSession("ksession1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private KieSession ksession1ks2</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ksession_for_statelesskiesession_2"><a class="anchor" href="#_ksession_for_statelesskiesession_2"></a> <a class="link" href="#_ksession_for_statelesskiesession_2">10.2.7.5。@KSession用于StatelessKieSession</a></h5>
<div class="paragraph">
<p>如果提供了默认参数，则默认参数会映射到value属性，并从kmodule.xml或spring xml文件中指定KieSession的名称。</p>
</div>
<div class="listingblock">
<div class="title">从类路径KieContainer注入默认的StatelessKieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KSession
private StatelessKieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">从动态KieModule注入默认的StatelessKieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KSession
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">“ jar1”的并行版本加载。KBase1'KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KSession("ksession1")
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.0")
private StatelessKieSession ksessionv10;

@KSession("ksession1")
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.1")
private StatelessKieSession ksessionv11;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KSession(value="ksession1", name="ks1")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession1ks1

@KSession(value="ksession1", name="ks2")
@KReleaseId( groupId = "jar1", artifactId = "art1", version = "1.0")
private StatelessKieSession ksession1ks2</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_important_note_2"><a class="anchor" href="#_important_note_2"></a> <a class="link" href="#_important_note_2">10.2.7.6。重要的提示</a></h5>
<div class="paragraph">
<p>当使用批注时，为了正确初始化kmodule对象（kbase / ksession），对于任一类型的Bean都是强制性的<code>org.kie.spring.annotations.KModuleAnnotationPostProcessor</code>被定义</p>
</div>
<div class="exampleblock">
<div class="title">例子77. kie-spring注释后处理器bean的定义</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="kiePostProcessor"
            class="org.kie.spring.annotations.KModuleAnnotationPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">例子78. kie-spring注释-组件扫描</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;context:component-scan base-package="org.kie.spring.annotations"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>使用注释时，后处理器是不同的。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_event_listeners"><a class="anchor" href="#_event_listeners"></a> <a class="link" href="#_event_listeners">10.2.8。事件监听器</a></h4>
<div class="paragraph">
<p>Drools支持向KieSessions添加3种类型的侦听器<em>-AgendaListener</em> ， <em>WorkingMemoryListener</em> ， <em>ProcessEventListener</em></p>
</div>
<div class="paragraph">
<p>通过kie-spring模块，您可以使用XML标签将这些侦听器配置为KieSessions。这些标记的名称与实际的侦听器接口相同，即<kie:agendaeventlistener… .=""><kie:ruleruntimeeventlistener… .="">和<kie:processeventlistener… .="">。</kie:processeventlistener…></kie:ruleruntimeeventlistener…></kie:agendaeventlistener…></p>
</div>
<div class="paragraph">
<p>kie-spring提供了将侦听器定义为独立（个体）侦听器并将它们定义为一组的功能。</p>
</div>
<div class="sect4">
<h5 id="_defining_stand_alone_listeners"><a class="anchor" href="#_defining_stand_alone_listeners"></a> <a class="link" href="#_defining_stand_alone_listeners">10.2.8.1。定义独立的侦听器：</a></h5>

</div>
<div class="sect4">
<h5 id="_attributes"><a class="anchor" href="#_attributes"></a> <a class="link" href="#_attributes">10.2.8.2。属性：</a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表33。样品</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需要</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">参考</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">对另一个声明的bean的引用。</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">示例79。侦听器配置示例-使用bean：ref。</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;
&lt;bean id="mock-rr-listener" class="mocks.MockRuleRuntimeEventListener"/&gt;
&lt;bean id="mock-process-listener" class="mocks.MockProcessEventListener"/&gt;

&lt;kie:kmodule id="listeners_kmodule"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksession2"&gt;
      &lt;kie:agendaEventListener ref="mock-agenda-listener"/&gt;
      &lt;kie:processEventListener ref="mock-process-listener"/&gt;
      &lt;kie:ruleRuntimeEventListener ref="mock-rr-listener"/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_nested_elements"><a class="anchor" href="#_nested_elements"></a> <a class="link" href="#_nested_elements">10.2.8.3。嵌套元素：</a></h5>
<div class="ulist">
<ul>
<li>
<p>豆</p>
<div class="ulist">
<ul>
<li>
<p>类=字符串</p>
</li>
<li>
<p>名称=字符串（可选）</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">示例80。侦听器配置示例-使用嵌套bean。</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="listeners_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
   &lt;kie:ksession name="ksession1"&gt;
	  &lt;kie:agendaEventListener&gt;
      &lt;bean class="mocks.MockAgendaEventListener"/&gt;
      &lt;/kie:agendaEventListener&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_empty_tag_declaration_with_no_ref_and_without_a_nestedbean"><a class="anchor" href="#_empty_tag_declaration_with_no_ref_and_without_a_nestedbean"></a> <a class="link" href="#_empty_tag_declaration_with_no_ref_and_without_a_nestedbean">10.2.8.4。空标签：没有“ ref”且没有nestedbean的声明</a></h5>
<div class="paragraph">
<p>如果定义了侦听器而不引用实现的bean，并且不包含嵌套的bean， <em><drools:ruleruntimeeventlistener></drools:ruleruntimeeventlistener></em>基础实现将添加API中定义的侦听器的Debug版本。</p>
</div>
<div class="paragraph">
<p>调试侦听器将相应的Event toString消息打印到_System.err。_</p>
</div>
<div class="exampleblock">
<div class="title">例子81。侦听器配置示例-默认为Knowledge-API提供的调试版本。</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;
&lt;bean id="mock-rr-listener" class="mocks.MockRuleRuntimeEventListener"/&gt;
&lt;bean id="mock-process-listener" class="mocks.MockProcessEventListener"/&gt;

&lt;kie:kmodule id="listeners_module"&gt;
 &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksession2"&gt;
      &lt;kie:agendaEventListener /&gt;
      &lt;kie:processEventListener /&gt;
      &lt;kie:ruleRuntimeEventListener /&gt;
    &lt;/kie:ksession&gt;
 &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_mix_and_match_of_different_declaration_styles"><a class="anchor" href="#_mix_and_match_of_different_declaration_styles"></a> <a class="link" href="#_mix_and_match_of_different_declaration_styles">10.2.8.5。混合和匹配不同的声明样式</a></h5>
<div class="paragraph">
<p>drools-spring模块允许您在同一KieSession中混合和匹配不同的声明式样式。下面的示例更加清晰。</p>
</div>
<div class="exampleblock">
<div class="title">示例82。侦听器配置示例-混合使用“ ref” /嵌套豆/空样式。</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;
&lt;bean id="mock-rr-listener" class="mocks.MockRuleRuntimeEventListener"/&gt;
&lt;bean id="mock-process-listener" class="mocks.MockProcessEventListener"/&gt;

&lt;kie:kmodule id="listeners_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksession1"&gt;
      &lt;kie:agendaEventListener&gt;
          &lt;bean class="org.kie.spring.mocks.MockAgendaEventListener"/&gt;
      &lt;/kie:agendaEventListener&gt;
    &lt;/kie:ksession&gt;
    &lt;kie:ksession name="ksession2"&gt;
      &lt;kie:agendaEventListener ref="mock-agenda-listener"/&gt;
      &lt;kie:processEventListener ref="mock-process-listener"/&gt;
      &lt;kie:ruleRuntimeEventListener ref="mock-rr-listener"/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_defining_multiple_listeners_of_the_same_type"><a class="anchor" href="#_defining_multiple_listeners_of_the_same_type"></a> <a class="link" href="#_defining_multiple_listeners_of_the_same_type">10.2.8.6。定义多个相同类型的侦听器</a></h5>
<div class="paragraph">
<p>为KieSession定义具有相同事件侦听器类型的多个bean也有效。</p>
</div>
<div class="exampleblock">
<div class="title">示例83。侦听器配置示例-多个相同类型的侦听器。</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;

&lt;kie:kmodule id="listeners_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksession1"&gt;
      &lt;kie:agendaEventListener ref="mock-agenda-listener"/&gt;
      &lt;kie:agendaEventListener&gt;
          &lt;bean class="org.kie.spring.mocks.MockAgendaEventListener"/&gt;
      &lt;/kie:agendaEventListener&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kie_grouping_listeners"><a class="anchor" href="#_kie_grouping_listeners"></a> <a class="link" href="#_kie_grouping_listeners">10.2.8.7。定义一组侦听器：</a></h5>
<div class="paragraph">
<p>drools-spring允许听众分组。当您定义一组侦听器并将其附加到多个会话时，此功能特别有用。当我们定义一组用于“测试”的侦听器，然后想要将其切换为“生产”用途时，分组功能也非常有用。</p>
</div>
</div>
<div class="sect4">
<h5 id="_attributes_2"><a class="anchor" href="#_attributes_2"></a> <a class="link" href="#_attributes_2">10.2.8.8。属性：</a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表34。样品</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需要</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">唯一标识符</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_nested_elements_2"><a class="anchor" href="#_nested_elements_2"></a> <a class="link" href="#_nested_elements_2">10.2.8.9。嵌套元素：</a></h5>
<div class="ulist">
<ul>
<li>
<p>kie：agendaEventListener ...</p>
</li>
<li>
<p>kie：ruleRuntimeEventListener ...</p>
</li>
<li>
<p>kie：processEventListener ...</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>上面提到的子元素可以以任何顺序声明。组中仅允许每种类型的一个声明。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_example"><a class="anchor" href="#_example"></a> <a class="link" href="#_example">10.2.8.10。例：</a></h5>
<div class="exampleblock">
<div class="title">示例84。听众组-示例</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;
&lt;bean id="mock-rr-listener" class="mocks.MockRuleRuntimeEventListener"/&gt;
&lt;bean id="mock-process-listener" class="mocks.MockProcessEventListener"/&gt;

&lt;kie:kmodule id="listeners_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="statelessWithGroupedListeners" type="stateless"
             listeners-ref="debugListeners"/&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

  &lt;kie:eventListeners id="debugListeners"&gt;
  &lt;kie:agendaEventListener ref="mock-agenda-listener"/&gt;
  &lt;kie:processEventListener ref="mock-process-listener"/&gt;
  &lt;kie:ruleRuntimeEventListener ref="mock-rr-listener"/&gt;
&lt;/kie:eventListeners&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_loggers"><a class="anchor" href="#_loggers"></a> <a class="link" href="#_loggers">10.2.9。记录仪</a></h4>
<div class="paragraph">
<p>Drools的支持添加2种类型的记录器，以KieSessions - <em><em>ConsoleLogger，FileLogger。</em></em></p>
</div>
<div class="paragraph">
<p>通过kie-spring模块，您可以使用XML标签将这些记录器配置为KieSessions。这些标签的名称与实际的记录器接口相同，即<kie:consolelogger… .="">和<kie:filelogger… .="">。</kie:filelogger…></kie:consolelogger…></p>
</div>
<div class="sect4">
<h5 id="_defining_a_console_logger"><a class="anchor" href="#_defining_a_console_logger"></a> <a class="link" href="#_defining_a_console_logger">10.2.9.1。定义控制台记录器：</a></h5>
<div class="paragraph">
<p>控制台记录器可以通过使用以下命令附加到KieSession： <em><kie:consolelogger></kie:consolelogger></em>标签。该标签没有属性，必须直接出现在<kie:ksession… .="">元素下。</kie:ksession…></p>
</div>
<div class="exampleblock">
<div class="title">示例85。定义控制台记录器-示例</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="loggers_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ConsoleLogger-statefulSession" type="stateful"&gt;
      &lt;kie:consoleLogger/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_defining_a_file_logger"><a class="anchor" href="#_defining_a_file_logger"></a> <a class="link" href="#_defining_a_file_logger">10.2.9.2。定义文件记录器：</a></h5>
<div class="paragraph">
<p>可以使用以下命令将文件记录器附加到KieSession： <em><kie:filelogger></kie:filelogger></em>标签。此标记具有以下属性，并且必须直接出现在<kie:ksession… .="">元素下。</kie:ksession…></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表35。样品</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需要</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">唯一标识符</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">文件</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">磁盘上实际文件的路径</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">螺纹的</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">默认为false。有效值为'true'或'false'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">间隔</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">整数。指定将内容从内存刷新到磁盘的时间间隔。</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">示例86。定义文件记录器-示例</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="loggers_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ConsoleLogger-statefulSession" type="stateful"&gt;
      &lt;kie:fileLogger id="fl_logger" file="#{ systemProperties['java.io.tmpdir'] }/log1"/&gt;
      &lt;kie:fileLogger id="tfl_logger" file="#{ systemProperties['java.io.tmpdir'] }/log2"
                          threaded="true" interval="5"/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_closing_a_filelogger"><a class="anchor" href="#_closing_a_filelogger"></a> <a class="link" href="#_closing_a_filelogger">10.2.9.3。关闭FileLogger</a></h5>
<div class="paragraph">
<p>为防止泄漏，建议以<kie:filelogger …="">编程方式</kie:filelogger>关闭<kie:filelogger …="">_。</kie:filelogger></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">LoggerAdaptor adaptor = (LoggerAdaptor) context.getBean("fl_logger");
adaptor.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_defining_batch_commands"><a class="anchor" href="#_defining_batch_commands"></a> <a class="link" href="#_defining_batch_commands">10.2.10。定义批处理命令</a></h4>
<div class="paragraph">
<p>一种<em><kie:batch></kie:batch></em>元素可用于为给定的ksession定义一组批处理命令。该标签没有属性，必须直接出现在<kie:ksession… .="">元素下。支持的命令是</kie:ksession…></p>
</div>
<div class="ulist">
<div class="title">初始化批处理命令</div>
<ul>
<li>
<p>插入对象</p>
<div class="ulist">
<ul>
<li>
<p>ref =字符串（可选）</p>
</li>
<li>
<p>匿名豆</p>
</li>
</ul>
</div>
</li>
<li>
<p>全局设置</p>
<div class="ulist">
<ul>
<li>
<p>标识符=字符串（必填）</p>
</li>
<li>
<p>reg =字符串（可选）</p>
</li>
<li>
<p>匿名豆</p>
</li>
</ul>
</div>
</li>
<li>
<p>全面执行</p>
<div class="ulist">
<ul>
<li>
<p>最大：n</p>
</li>
</ul>
</div>
</li>
<li>
<p>直到停火</p>
</li>
<li>
<p>开始过程</p>
<div class="ulist">
<ul>
<li>
<p>参数</p>
<div class="ulist">
<ul>
<li>
<p>标识符=字符串（必填）</p>
</li>
<li>
<p>ref =字符串（可选）</p>
</li>
<li>
<p>匿名豆</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>信号事件</p>
<div class="ulist">
<ul>
<li>
<p>ref =字符串（可选）</p>
</li>
<li>
<p>event-type =字符串（必需）</p>
</li>
<li>
<p>process-instance-id = n（可选）</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">例子87。批处理命令-示例</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="batch_commands_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksessionForCommands" type="stateful"&gt;
      &lt;kie:batch&gt;
        &lt;kie:insert-object ref="person2"/&gt;
        &lt;kie:set-global identifier="persons" ref="personsList"/&gt;
        &lt;kie:fire-all-rules max="10"/&gt;
      &lt;/kie:batch&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_persistence"><a class="anchor" href="#_persistence"></a> <a class="link" href="#_persistence">10.2.11。坚持不懈</a></h4>
<div class="ulist">
<div class="title">持久性配置选项</div>
<ul>
<li>
<p>持久性</p>
<div class="ulist">
<ul>
<li>
<p>交易经理</p>
<div class="ulist">
<ul>
<li>
<p>ref =字串</p>
</li>
</ul>
</div>
</li>
<li>
<p>实体经理工厂</p>
<div class="ulist">
<ul>
<li>
<p>ref =字串</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">例子88. ksession JPA配置例子</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kstore id="kstore" /&gt; &lt;!-- provides KnowledgeStoreService implementation --&gt;

&lt;bean id="myEmf"
       class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
   &lt;property name="dataSource" ref="ds" /&gt;
   &lt;property name="persistenceUnitName"
       value="org.drools.persistence.jpa.local" /&gt;
&lt;/bean&gt;

&lt;bean id="txManager" class="org.springframework.orm.jpa.JpaTransactionManager"&gt;
   &lt;property name="entityManagerFactory" ref="myEmf" /&gt;
&lt;/bean&gt;

&lt;kie:kmodule id="persistence_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="jpaSingleSessionCommandService"&gt;
      &lt;kie:configuration&gt;
         &lt;kie:jpa-persistence&gt;
           &lt;kie:transaction-manager ref="txManager"/&gt;
           &lt;kie:entity-manager-factory ref="myEmf"/&gt;
         &lt;/kie:jpa-persistence&gt;
      &lt;/kie:configuration&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
          class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_leveraging_other_spring_features"><a class="anchor" href="#_leveraging_other_spring_features"></a> <a class="link" href="#_leveraging_other_spring_features">10.2.12。利用其他Spring功能</a></h4>
<div class="paragraph">
<p>本节提供了与Drools Expert集成时如何利用其他标准弹簧功能的详细信息。</p>
</div>
<div class="sect4">
<h5 id="_using_spring_expressions_spel"><a class="anchor" href="#_using_spring_expressions_spel"></a> <a class="link" href="#_using_spring_expressions_spel">10.2.12.1。使用弹簧表达式（拼写）</a></h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="batch_commands_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="#{packageRepository.packages}"&gt;
    &lt;kie:ksession name="ksessionForCommands" type="stateful"/&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
      class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;

&lt;bean id="packageRepository" class="sample.package.class.PackageRepo"&gt;
  &lt;property name="packages" value="drl_kiesample3"&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="loggers_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ConsoleLogger-statefulSession" type="stateful"&gt;
      &lt;kie:fileLogger id="fl" file="#{ systemProperties['java.io.tmpdir'] }/log1"/&gt;
      &lt;kie:fileLogger id="tfl" file="#{ systemProperties['java.io.tmpdir'] }/log2"
            threaded="true" interval="5"/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

&lt;bean id="kiePostProcessor"
            class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_using_spring_profiles"><a class="anchor" href="#_using_spring_profiles"></a> <a class="link" href="#_using_spring_profiles">10.2.12.2。使用Spring配置文件</a></h5>
<div class="paragraph">
<p>Spring 3.1为spring-beans模式的bean元素引入了一个新的profile属性。在不同环境中启用和禁用概要文件时，此属性充当开关。此属性的一个潜在用途是在'dev'环境中使用调试记录器定义相同的kbase，而在'prod'环境中使用记录器定义的kbase。</p>
</div>
<div class="paragraph">
<p>下面的代码段说明了“配置文件”的概念。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns:kie="http://drools.org/schema/kie-spring"
xsi:schemaLocation="http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
http://drools.org/schema/kie-spring http://drools.org/schema/kie-spring.xsd"&gt;
  &lt;beans profile="development"&gt;
    &lt;kie:kmodule id="test-kmodule"&gt;
      &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
        &lt;kie:ksession name="ksession1" type="stateless"&gt;
            &lt;kie:consoleLogger /&gt;
        &lt;/kie:ksession&gt;
      &lt;/kie:kbase&gt;
    &lt;/kie:kmodule&gt;
    ...
  &lt;/beans&gt;

  &lt;beans profile="production"&gt;
    &lt;kie:kmodule id="test-kmodule"&gt;
      &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
        &lt;kie:ksession name="ksession1" type="stateless"/&gt;
      &lt;/kie:kbase&gt;
    &lt;/kie:kmodule&gt;
    ...
  &lt;/beans&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如上所示，Spring XML包含配置文件的定义。在加载<em>ApplicationContext时，</em>您必须告诉Spring您正在加载哪个配置文件。</p>
</div>
<div class="paragraph">
<p>有多种选择配置文件的方法，最有用的是使用“ spring.profiles.active”系统属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>System.setProperty("spring.profiles.active", "development");
ApplicationContext ctx = new ClassPathXmlApplicationContext("beans.xml");</code></pre>
</div>
</div>
<div class="paragraph">
<p>显然，对上面所示的内容进行硬编码不是一个好习惯，建议的做法是使系统属性定义独立于应用程序。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Dspring.profiles.active="development"</code></pre>
</div>
</div>
<div class="paragraph">
<p>还可以以编程方式加载和启用配置文件</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...
GenericXmlApplicationContext ctx = new GenericXmlApplicationContext("beans.xml");
ConfigurableEnvironment env = ctx.getEnvironment();
env.setActiveProfiles("development");
ctx.refresh();
...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_integration_with_jbpm_human_task"><a class="anchor" href="#_integration_with_jbpm_human_task"></a> <a class="link" href="#_integration_with_jbpm_human_task">10.3。与jBPM人工任务集成</a></h3>
<div class="paragraph">
<p>本章描述了在使用Spring配置人工任务服务器时使用的基础结构，以及在进行此操作时使用的基础结构。</p>
</div>
<div class="sect3">
<h4 id="_how_to_configure_spring_with_jbpm_human_task"><a class="anchor" href="#_how_to_configure_spring_with_jbpm_human_task"></a> <a class="link" href="#_how_to_configure_spring_with_jbpm_human_task">10.3.1。如何使用jBPM人工任务配置Spring</a></h4>
<div class="paragraph">
<p>可以将jBPM人工任务服务器配置为使用Spring持久性。以下是使用本地事务和Spring的线程安全EntityManager代理的配置的依赖关系图：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Spring/ht-spring-deps.png" alt="ht春天部门">
</div>
<div class="title">图143。Spring Human Task集成注入依赖项</div>
</div>
<div class="paragraph">
<p>一种<code>TaskService</code>实例依赖于其他两种bean类型：流口水<code>SystemEventListener</code>豆以及<code>TaskSessionSpringFactoryImpl</code>豆。的<code>TaskSessionSpringFactoryImpl</code>豆是<em>没有</em>注入<code>TaskService</code> bean，因为这将导致循环依赖。为了解决这个问题，当<code>TaskService</code>豆被注入<code>TaskSessionSpringFactoryImpl</code>豆，使用的setter方法会秘密注入<code>TaskSessionSpringFactoryImpl</code>实例回到<code>TaskService</code> bean并初始化<code>TaskService</code>豆也是。</p>
</div>
<div class="paragraph">
<p>的<code>TaskSessionSpringFactoryImpl</code> bean负责在人工任务中创建所有内部实例，以处理事务和持久性上下文管理。除了一个<code>TaskService</code>例如，此bean还需要注入事务管理器和持久性上下文。具体来说，它需要一个<code>HumanTaskSpringTransactionManager</code> bean（作为事务管理器）和一个实例<code>SharedEntityManagerBean</code> bean（作为持久性上下文实例）。</p>
</div>
<div class="paragraph">
<p>为了配置持久性，我们还使用了一些标准的Spring bean：有一个bean可以容纳<code>EntityManagerFactory</code>实例以及<code>SharedEntityManagerBean</code>实例。的<code>SharedEntityManagerBean</code>提供实际的共享的线程安全代理<code>EntityManager</code> 。</p>
</div>
<div class="paragraph">
<p>的<code>HumanTaskSpringTransactionManager</code> bean充当Spring事务管理器的包装，在这种情况下， <code>JpaTransactionManager</code> 。一个实例<code>JpaTransactionManager</code>因此也实例化了bean。</p>
</div>
<div class="exampleblock">
<div class="title">示例89。使用Spring配置人工任务</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jbpm="http://drools.org/schema/drools-spring"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       http://drools.org/schema/drools-spring org/drools/container/spring/drools-spring-1.2.0.xsd"&gt;

  &lt;!-- persistence &amp; transactions--&gt;
  &lt;bean id="htEmf" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
    &lt;property name="persistenceUnitName" value="org.jbpm.task" /&gt;
  &lt;/bean&gt;

  &lt;bean id="htEm" class="org.springframework.orm.jpa.support.SharedEntityManagerBean"&gt;
    &lt;property name="entityManagerFactory" ref="htEmf"/&gt;
  &lt;/bean&gt;

  &lt;bean id="jpaTxMgr" class="org.springframework.orm.jpa.JpaTransactionManager"&gt;
    &lt;property name="entityManagerFactory" ref="htEmf" /&gt;
    &lt;!-- this must be true if using the SharedEntityManagerBean, and false otherwise --&gt;
    &lt;property name="nestedTransactionAllowed" value="true"/&gt;
  &lt;/bean&gt;

  &lt;bean id="htTxMgr" class="org.drools.container.spring.beans.persistence.HumanTaskSpringTransactionManager"&gt;
    &lt;constructor-arg ref="jpaTxMgr" /&gt;
  &lt;/bean&gt;

  &lt;!-- human-task beans --&gt;

  &lt;bean id="systemEventListener" class="org.drools.SystemEventListenerFactory" factory-method="getSystemEventListener" /&gt;

  &lt;bean id="taskService" class="org.jbpm.task.service.TaskService" &gt;
    &lt;property name="systemEventListener" ref="systemEventListener" /&gt;
  &lt;/bean&gt;

  &lt;bean id="springTaskSessionFactory" class="org.jbpm.task.service.persistence.TaskSessionSpringFactoryImpl"
        init-method="initialize" depends-on="taskService" &gt;
    &lt;!-- if using the SharedEntityManagerBean, make sure to enable nested transactions --&gt;
    &lt;property name="entityManager" ref="htEm" /&gt;
    &lt;property name="transactionManager" ref="htTxMgr" /&gt;
    &lt;property name="useJTA" value="false" /&gt;
    &lt;property name="taskService" ref="taskService" /&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>使用时<code>SharedEntityManagerBean</code>例如，配置Spring事务管理器以使用嵌套事务很重要。这是因为<code>SharedEntityManagerBean</code>是<em>事务</em>性持久性上下文，它将在每次操作后关闭持久性上下文。但是，人工任务服务器需要能够在操作后访问（持久化）实体。嵌套事务使我们仍然可以访问原本可以分离的实体，并且无法再访问它们，尤其是在使用使用实体的惰性初始化的ORM框架时。</p>
</div>
<div class="paragraph">
<p>另外， <code>TaskSessionSpringFactoryImpl</code> bean具有一个“ useJTA”参数，目前，尚未完全测试与Spring的JTA事务。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.kie.blueprint"><a class="anchor" href="#_ch.kie.blueprint"></a> <a class="link" href="#_ch.kie.blueprint">11。与白羊座蓝图整合</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_integration_with_drools_expert_2"><a class="anchor" href="#_integration_with_drools_expert_2"></a> <a class="link" href="#_integration_with_drools_expert_2">11.1。与Drools Expert集成</a></h3>
<div class="paragraph">
<p>在本节中，我们将解释<em>kie</em>命名空间。</p>
</div>
<div class="sect3">
<h4 id="_kiemodule_2"><a class="anchor" href="#_kiemodule_2"></a> <a class="link" href="#_kiemodule_2">11.1.1。KieModule</a></h4>
<div class="paragraph">
<p>的<em><kie:kmodule></kie:kmodule></em>定义KieBase和相关KieSession的集合。<em>kmodule</em>标记具有一个MANDATORY参数“ id”。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表36。样品</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需要</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">Bean的<em>ID</em>是要从其他Bean引用的名称。适用标准蓝图ID语义。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>kmodule</em>标记只能包含以下标记作为子标记。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>kie：kbase</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>有关对kmodule需求的详细说明，请参阅Drools Expert文档中的kmodule.xml文档。</p>
</div>
</div>
<div class="sect3">
<h4 id="_kiebase_4"><a class="anchor" href="#_kiebase_4"></a> <a class="link" href="#_kiebase_4">11.1.2。凯基</a></h4>
<div class="sect4">
<h5 id="_kiekbases_parameters_as_attributes_2"><a class="anchor" href="#_kiekbases_parameters_as_attributes_2"></a> <a class="link" href="#_kiekbases_parameters_as_attributes_2">11.1.2.1。 <kie:kbase>的参数作为属性：</kie:kbase></a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表37。样品</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需要</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">名称</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">KieBase的名称</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">包装</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用逗号分隔的要包含在此kbase中的资源包列表</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">包括</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">要包括的kbase名称。来自相应kbase的所有资源都包含在此kbase中。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">默认</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">布尔值（TRUE / FALSE）。默认的kbase，如果未提供，则假定为FALSE</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">范围</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">原型|单身人士。如果未提供，则假定为单例（默认）</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">eventProcessingMode</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">事件处理模式。有效选项是STREAM，CLOUD</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">等于行为</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">有效选项是IDENTITY，EQUALITY</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_a_kbase_tag_can_contain_only_the_following_tags_as_children"><a class="anchor" href="#_a_kbase_tag_can_contain_only_the_following_tags_as_children"></a> <a class="link" href="#_a_kbase_tag_can_contain_only_the_following_tags_as_children">11.1.2.2。<em>kbase</em>标记只能包含以下标记作为子标记。</a></h5>
<div class="ulist">
<ul>
<li>
<p>kie：ksession</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_kiekbases_definition_example_2"><a class="anchor" href="#_kiekbases_definition_example_2"></a> <a class="link" href="#_kiekbases_definition_example_2">11.1.2.3。 <kie:kbase>的定义示例</kie:kbase></a></h5>
<div class="paragraph">
<p>一个kmodule可以包含多个（1..n）kbase元素。</p>
</div>
<div class="exampleblock">
<div class="title">例子90. kbase定义例子</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="sample_module"&gt;
   &lt;kie:kbase name="kbase1" packages="org.drools.blueprint.sample"&gt;
     ...
   &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_blueprint_bean_scope_for_kiebase_and_kiesession"><a class="anchor" href="#_blueprint_bean_scope_for_kiebase_and_kiesession"></a> <a class="link" href="#_blueprint_bean_scope_for_kiebase_and_kiesession">11.1.2.4。蓝图Bean范围（用于KieBase和KieSession）</a></h5>
<div class="paragraph">
<p>定义KieBase或KieSession时，可以选择声明该bean的作用域。例如，要强制Blueprint每次需要一个新bean实例时，应将bean的scope属性声明为'prototype'。以类似的方式，如果您希望Blueprint每次需要返回相同的bean实例，则应将bean的scope属性声明为'singleton'。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiesessions_2"><a class="anchor" href="#_kiesessions_2"></a> <a class="link" href="#_kiesessions_2">11.1.3。KieSessions</a></h4>
<div class="paragraph">
<p><kie:ksession>元素定义KieSessions。相同的标记用于定义两个有状态（ <em>org.kie.api.runtime。KieSession</em> ）和无状态（ <em>org.kie.api.runtime。StatelessKieSession</em> ）会话。</kie:ksession></p>
</div>
<div class="sect4">
<h5 id="_kieksessions_parameters_as_attributes_2"><a class="anchor" href="#_kieksessions_parameters_as_attributes_2"></a> <a class="link" href="#_kieksessions_parameters_as_attributes_2">11.1.3.1。 <kie:ksession>的参数作为属性：</kie:ksession></a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表38。样品</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需要</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">名称</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">ksession的名称。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">类型</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">会话是<em>有状态</em>还是<em>无状态？</em> 。如果此属性为空或丢失，则假定该会话为有状态类型。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">默认</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">这是默认会话吗？</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">范围</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">原型|单身人士。如果未提供，则假定为单例（默认）</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">clockType</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">实时或伪</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">听众参考</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">指定对事件侦听器组的引用（请参阅下面的<a href="#_kie_grouping_listeners">“定义</a>侦听器组<a href="#_kie_grouping_listeners">”</a>部分）。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">例子91. ksession定义例子</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="sample-kmodule"&gt;
  &lt;kie:kbase name="drl_kiesample3" packages="drl_kiesample3"&gt;
    &lt;kie:ksession name="ksession1" type="stateless"/&gt;
    &lt;kie:ksession name="ksession2"/&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiereleaseid_2"><a class="anchor" href="#_kiereleaseid_2"></a> <a class="link" href="#_kiereleaseid_2">11.1.4。凯：ReleaseId</a></h4>
<div class="sect4">
<h5 id="_kiereleaseids_parameters_as_attributes_2"><a class="anchor" href="#_kiereleaseids_parameters_as_attributes_2"></a> <a class="link" href="#_kiereleaseids_parameters_as_attributes_2">11.1.4.1。 <kie:releaseid>的参数作为属性：</kie:releaseid></a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表39。样品</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需要</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">Bean的<em>ID</em>是要从其他Bean引用的名称。适用标准蓝图ID语义。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">来自Maven GAV的groupId</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">artifactId</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">来自Maven GAV的artifactId</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">版</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">来自Maven GAV的版本</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">例子92. releaseId定义例子</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:releaseId id="beanId" groupId="org.kie.blueprint"
            artifactId="named-artifactId" version="1.0.0-SNAPSHOT"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kieimport_2"><a class="anchor" href="#_kieimport_2"></a> <a class="link" href="#_kieimport_2">11.1.5。凯：进口</a></h4>
<div class="paragraph">
<p>从6.5版开始，kie-aries-blueprint允许从类路径中找到的kjars中导入kie对象。当前支持两种导入kie对象的模式。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需要</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">releaseId</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">引用Bean ID。适用标准蓝图ID语义。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">enableScanner</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">启用扫描仪。仅当指定了“ releaseId”时，才使用此属性。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">ScannerInterval</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">扫描间隔（以毫秒为单位）。仅当指定了“ releaseId”时，才使用此属性。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_global_import_2"><a class="anchor" href="#_global_import_2"></a> <a class="link" href="#_global_import_2">11.1.5.1。全球进口</a></h5>
<div class="paragraph">
<p><em>import</em>标签将强制自动扫描类路径上的所有jar，初始化Kie对象（Kbase / KSessions）并将这些对象导入到蓝图上下文中。</p>
</div>
<div class="listingblock">
<div class="title">全球进口</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:import /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specific_import_releaseid_2"><a class="anchor" href="#_specific_import_releaseid_2"></a> <a class="link" href="#_specific_import_releaseid_2">11.1.5.2。特定导入-ReleaseId</a></h5>
<div class="paragraph">
<p>在import标签上使用<em>releaseId-ref</em>属性将初始化特定的Kie对象（Kbase / KSessions）并将这些对象导入到蓝图上下文中。</p>
</div>
<div class="listingblock">
<div class="title">使用releaseId导入Kie对象</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:import releaseId-ref="namedKieSession"/&gt;
&lt;kie:releaseId id="namedKieSession" groupId="org.drools"
            artifactId="named-kiesession" version="7.30.0.Final"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以为使用特定releaseId导入的KieBase启用Kie扫描功能。此功能当前不适用于全局导入。</p>
</div>
<div class="listingblock">
<div class="title">使用releaseId导入Kie对象-启用扫描仪</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:import releaseId-ref="namedKieSession"
            enableScanner="true" scannerInterval="1000"/&gt;

&lt;kie:releaseId id="namedKieSession" groupId="org.drools"
            artifactId="named-kiesession" version="7.30.0.Final"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果定义并启用了扫描程序， <em>则将</em>创建一个隐式<em>KieScanner</em>对象，并将其插入到蓝图容器中。可以使用<em>-scanner</em>后缀以编程方式从蓝图容器中检索到它。</p>
</div>
<div class="listingblock">
<div class="title">从蓝图容器中检索KieScanner</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// the implicit name would be releaseId-scanner
KieScanner releaseIdScanner = (KieScanner)container.getComponentInstance("namedKieSession-scanner");
releaseIdScanner.scanNow();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>kie-ci必须在类路径上可用，才能使releaseId导入功能起作用。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_event_listeners_2"><a class="anchor" href="#_event_listeners_2"></a> <a class="link" href="#_event_listeners_2">11.1.6。事件监听器</a></h4>
<div class="paragraph">
<p>Drools支持向KieSessions添加3种类型的侦听器<em>-AgendaListener</em> ， <em>WorkingMemoryListener</em> ， <em>ProcessEventListener</em></p>
</div>
<div class="paragraph">
<p>通过kie-aries-blueprint模块，您可以使用XML标签将这些侦听器配置为KieSessions。这些标记的名称与实际的侦听器接口相同，即<kie:agendaeventlistener… .=""><kie:ruleruntimeeventlistener… .="">和<kie:processeventlistener… .="">。</kie:processeventlistener…></kie:ruleruntimeeventlistener…></kie:agendaeventlistener…></p>
</div>
<div class="paragraph">
<p>kie-aries-blueprint提供了一些功能，可将侦听器定义为独立（个体）侦听器，并将它们定义为一个组。</p>
</div>
<div class="sect4">
<h5 id="_defining_stand_alone_listeners_2"><a class="anchor" href="#_defining_stand_alone_listeners_2"></a> <a class="link" href="#_defining_stand_alone_listeners_2">11.1.6.1。定义独立的侦听器：</a></h5>

</div>
<div class="sect4">
<h5 id="_attributes_3"><a class="anchor" href="#_attributes_3"></a> <a class="link" href="#_attributes_3">11.1.6.2。属性：</a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表40。样品</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需要</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">参考</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">对另一个声明的bean的引用。</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">示例93。侦听器配置示例-使用bean：ref。</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;
&lt;bean id="mock-rr-listener" class="mocks.MockRuleRuntimeEventListener"/&gt;
&lt;bean id="mock-process-listener" class="mocks.MockProcessEventListener"/&gt;

&lt;kie:kmodule id="listeners_kmodule"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksession2"&gt;
      &lt;kie:agendaEventListener ref="mock-agenda-listener"/&gt;
      &lt;kie:processEventListener ref="mock-process-listener"/&gt;
      &lt;kie:ruleRuntimeEventListener ref="mock-rr-listener"/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_defining_multiple_listeners_of_the_same_type_2"><a class="anchor" href="#_defining_multiple_listeners_of_the_same_type_2"></a> <a class="link" href="#_defining_multiple_listeners_of_the_same_type_2">11.1.6.3。定义多个相同类型的侦听器</a></h5>
<div class="paragraph">
<p>为KieSession定义具有相同事件侦听器类型的多个bean也有效。</p>
</div>
<div class="exampleblock">
<div class="title">示例94。侦听器配置示例-多个相同类型的侦听器。</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="mock-agenda-listener1" class="mocks.MockAgendaEventListener"/&gt;
&lt;bean id="mock-agenda-listener2" class="mocks.MockAgendaEventListener"/&gt;

&lt;kie:kmodule id="listeners_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksession1"&gt;
      &lt;kie:agendaEventListener ref="mock-agenda-listener1"/&gt;
      &lt;kie:agendaEventListener ref="mock-agenda-listener2"/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kie_grouping_listeners"><a class="anchor" href="#_kie_grouping_listeners"></a> <a class="link" href="#_kie_grouping_listeners">11.1.6.4。定义一组侦听器：</a></h5>
<div class="paragraph">
<p>kie-aries-blueprinty允许对侦听器进行分组。当您定义一组侦听器并将其附加到多个会话时，此功能特别有用。当我们定义一组用于“测试”的侦听器，然后想要将其切换为“生产”用途时，分组功能也非常有用。</p>
</div>
</div>
<div class="sect4">
<h5 id="_attributes_4"><a class="anchor" href="#_attributes_4"></a> <a class="link" href="#_attributes_4">11.1.6.5。属性：</a></h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表41。样品</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需要</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">唯一标识符</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_nested_elements_3"><a class="anchor" href="#_nested_elements_3"></a> <a class="link" href="#_nested_elements_3">11.1.6.6。嵌套元素：</a></h5>
<div class="ulist">
<ul>
<li>
<p>kie：agendaEventListener ...</p>
</li>
<li>
<p>kie：ruleRuntimeEventListener ...</p>
</li>
<li>
<p>kie：processEventListener ...</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>上面提到的子元素可以以任何顺序声明。组中仅允许每种类型的一个声明。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_example_2"><a class="anchor" href="#_example_2"></a> <a class="link" href="#_example_2">11.1.6.7。例：</a></h5>
<div class="exampleblock">
<div class="title">示例95。听众组-示例</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="mock-agenda-listener" class="mocks.MockAgendaEventListener"/&gt;
&lt;bean id="mock-rr-listener" class="mocks.MockRuleRuntimeEventListener"/&gt;
&lt;bean id="mock-process-listener" class="mocks.MockProcessEventListener"/&gt;

&lt;kie:kmodule id="listeners_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="statelessWithGroupedListeners" type="stateless"
             listeners-ref="debugListeners"/&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;

  &lt;kie:eventListeners id="debugListeners"&gt;
  &lt;kie:agendaEventListener ref="mock-agenda-listener"/&gt;
  &lt;kie:processEventListener ref="mock-process-listener"/&gt;
  &lt;kie:ruleRuntimeEventListener ref="mock-rr-listener"/&gt;
&lt;/kie:eventListeners&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_loggers_2"><a class="anchor" href="#_loggers_2"></a> <a class="link" href="#_loggers_2">11.1.7。记录仪</a></h4>
<div class="paragraph">
<p>Drools的支持添加2种类型的记录器，以KieSessions - <em><em>ConsoleLogger，FileLogger。</em></em></p>
</div>
<div class="paragraph">
<p>通过kie-aries-blueprint模块，您可以使用XML标签将这些记录器配置为KieSessions。这些标签的名称与实际的记录器接口相同，即<kie:consolelogger… .="">和<kie:filelogger… .="">。</kie:filelogger…></kie:consolelogger…></p>
</div>
<div class="sect4">
<h5 id="_defining_a_console_logger_2"><a class="anchor" href="#_defining_a_console_logger_2"></a> <a class="link" href="#_defining_a_console_logger_2">11.1.7.1。定义控制台记录器：</a></h5>
<div class="paragraph">
<p>控制台记录器可以通过使用以下命令附加到KieSession： <em><kie:consolelogger></kie:consolelogger></em>标签。该标签没有属性，必须直接出现在<kie:ksession… .="">元素下。</kie:ksession…></p>
</div>
<div class="exampleblock">
<div class="title">例子96。定义控制台记录器-示例</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="loggers_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ConsoleLogger-statefulSession" type="stateful"&gt;
      &lt;kie:consoleLogger/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_defining_a_file_logger_2"><a class="anchor" href="#_defining_a_file_logger_2"></a> <a class="link" href="#_defining_a_file_logger_2">11.1.7.2。定义文件记录器：</a></h5>
<div class="paragraph">
<p>可以使用以下命令将文件记录器附加到KieSession： <em><kie:filelogger></kie:filelogger></em>标签。此标记具有以下属性，并且必须直接出现在<kie:ksession… .="">元素下。</kie:ksession…></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表42。样品</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">需要</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">唯一标识符</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">文件</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">磁盘上实际文件的路径</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">螺纹的</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">默认为false。有效值为'true'或'false'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">间隔</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">整数。指定将内容从内存刷新到磁盘的时间间隔。</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">示例97。定义文件记录器-示例</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="loggers_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ConsoleLogger-statefulSession" type="stateful"&gt;
      &lt;kie:fileLogger id="fl_logger" file="#{ systemProperties['java.io.tmpdir'] }/log1"/&gt;
      &lt;kie:fileLogger id="tfl_logger" file="#{ systemProperties['java.io.tmpdir'] }/log2"
                          threaded="true" interval="5"/&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_closing_a_filelogger_2"><a class="anchor" href="#_closing_a_filelogger_2"></a> <a class="link" href="#_closing_a_filelogger_2">11.1.7.3。关闭FileLogger</a></h5>
<div class="paragraph">
<p>为防止泄漏，建议关闭<em><kie:filelogger …=""></kie:filelogger></em>以编程方式</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">LoggerAdaptor adaptor = (LoggerAdaptor) container.getComponentInstance("fl_logger");
adaptor.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_defining_batch_commands_2"><a class="anchor" href="#_defining_batch_commands_2"></a> <a class="link" href="#_defining_batch_commands_2">11.1.8。定义批处理命令</a></h4>
<div class="paragraph">
<p>一种<em><kie:batch></kie:batch></em>元素可用于为给定的ksession定义一组批处理命令。该标签没有属性，必须直接出现在<kie:ksession… .="">元素下。支持的命令是</kie:ksession…></p>
</div>
<div class="ulist">
<div class="title">初始化批处理命令</div>
<ul>
<li>
<p>插入对象</p>
<div class="ulist">
<ul>
<li>
<p>ref =字符串（可选）</p>
</li>
<li>
<p>匿名豆</p>
</li>
</ul>
</div>
</li>
<li>
<p>全局设置</p>
<div class="ulist">
<ul>
<li>
<p>标识符=字符串（必填）</p>
</li>
<li>
<p>reg =字符串（可选）</p>
</li>
<li>
<p>匿名豆</p>
</li>
</ul>
</div>
</li>
<li>
<p>全面执行</p>
<div class="ulist">
<ul>
<li>
<p>最大：n</p>
</li>
</ul>
</div>
</li>
<li>
<p>直到停火</p>
</li>
<li>
<p>开始过程</p>
<div class="ulist">
<ul>
<li>
<p>参数</p>
<div class="ulist">
<ul>
<li>
<p>标识符=字符串（必填）</p>
</li>
<li>
<p>ref =字符串（可选）</p>
</li>
<li>
<p>匿名豆</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>信号事件</p>
<div class="ulist">
<ul>
<li>
<p>ref =字符串（可选）</p>
</li>
<li>
<p>event-type =字符串（必需）</p>
</li>
<li>
<p>process-instance-id = n（可选）</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">例子98。批处理命令-示例</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kie:kmodule id="batch_commands_module"&gt;
  &lt;kie:kbase name="drl_kiesample" packages="drl_kiesample"&gt;
    &lt;kie:ksession name="ksessionForCommands" type="stateful"&gt;
      &lt;kie:batch&gt;
        &lt;kie:insert-object ref="person2"/&gt;
        &lt;kie:set-global identifier="persons" ref="personsList"/&gt;
        &lt;kie:fire-all-rules max="10"/&gt;
      &lt;/kie:batch&gt;
    &lt;/kie:ksession&gt;
  &lt;/kie:kbase&gt;
&lt;/kie:kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.kie.android"><a class="anchor" href="#_ch.kie.android"></a> <a class="link" href="#_ch.kie.android">12Android整合</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_integration_with_drools_expert_3"><a class="anchor" href="#_integration_with_drools_expert_3"></a> <a class="link" href="#_integration_with_drools_expert_3">12.1。与Drools Expert集成</a></h3>
<div class="paragraph">
<p>Drools Android集成有两种版本，有无Drools <em>-compiler</em>依赖项。由于没有drools-compiler依赖关系，因此在构建时使用kie-maven-plugin对KIE基础进行了预序列化。然后可以使用API对它们进行反序列化，或者使用Roboguice直接注入它们。使用drools-compiler依赖项时，有两种选择：（1）标准KieContainer API或（2）使用Roboguice进行CDI式注入。</p>
</div>
<div class="sect3">
<h4 id="_pre_serialized_rules"><a class="anchor" href="#_pre_serialized_rules"></a> <a class="link" href="#_pre_serialized_rules">12.1.1。预序列化规则</a></h4>
<div class="paragraph">
<p>通过在构建期间对已编译的KIE基础进行预序列化，然后在运行时对其进行反序列化，可以使用不依赖drools-compiler依赖项的Drools，从而导致apk较小。</p>
</div>
<div class="sect4">
<h5 id="_maven_configuration"><a class="anchor" href="#_maven_configuration"></a> <a class="link" href="#_maven_configuration">12.1.1.1。Maven配置</a></h5>
<div class="paragraph">
<p>必须在构建期间使用<em>kie-maven-plugin</em>序列化KieBase。</p>
</div>
<div class="exampleblock">
<div class="title">示例99。预序列化的KieBase Maven pom.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.drools&lt;/groupId&gt;
      &lt;artifactId&gt;drools-bom&lt;/artifactId&gt;
      &lt;version&gt;7.30.0.Final&lt;/version&gt;
      &lt;type&gt;pom&lt;/type&gt;
      &lt;scope&gt;import&lt;/scope&gt;
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-android&lt;/artifactId&gt;
    &lt;exclusions&gt;
     &lt;exclusion&gt;
       &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
       &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
    &lt;/exclusions&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-core&lt;/artifactId&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;
&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.kie&lt;/groupId&gt;
      &lt;artifactId&gt;kie-maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;7.30.0.Final&lt;/version&gt;
      &lt;configuration&gt;
        &lt;kiebases&gt;
        &lt;kiebase&gt;HelloKB&lt;/kiebase&gt;
        &lt;/kiebases&gt;
        &lt;resDirectory&gt;${basedir}/src/main/res/raw&lt;/resDirectory&gt;
      &lt;/configuration&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;touch&lt;/id&gt;
            &lt;goals&gt;
              &lt;goal&gt;touch&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;phase&gt;initialize&lt;/phase&gt;
          &lt;/execution&gt;
          &lt;execution&gt;
            &lt;id&gt;compile-kbase&lt;/id&gt;
              &lt;goals&gt;
                &lt;goal&gt;build&lt;/goal&gt;
              &lt;/goals&gt;
              &lt;phase&gt;compile&lt;/phase&gt;
          &lt;/execution&gt;
          &lt;execution&gt;
            &lt;id&gt;serialize&lt;/id&gt;
            &lt;goals&gt;
              &lt;goal&gt;serialize&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;phase&gt;compile&lt;/phase&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
     &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_loading_the_kiebase"><a class="anchor" href="#_loading_the_kiebase"></a> <a class="link" href="#_loading_the_kiebase">12.1.1.2。加载KieBase</a></h5>
<div class="paragraph">
<p>创建会话之前，必须对KieBase进行反序列化。</p>
</div>
<div class="listingblock">
<div class="title">加载序列化的KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private class LoadKieBaseTask extends AsyncTask&lt;InputStream, Void, KieBase&gt; {
   @Override
   protected KieBase doInBackground(InputStream... params) {
      try {
         logger.debug("Loading KIE base");
         final KnowledgeBase kbase = KnowledgeBaseFactory.newKnowledgeBase();
         kbase.addKnowledgePackages((List&lt;KnowledgePackage&gt;) DroolsStreamUtils.streamIn(params[0]));
         return kbase;
      }catch(Exception e) {
         logger.error("Drools exception", e);
         return null;
      }
   }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiecontainer_api_with_drools_compiler_dependency"><a class="anchor" href="#_kiecontainer_api_with_drools_compiler_dependency"></a> <a class="link" href="#_kiecontainer_api_with_drools_compiler_dependency">12.1.2。具有drools-compiler依赖性的KieContainer API</a></h4>
<div class="paragraph">
<p>通过drools-compiler依赖关系标准，可以使用KieContainer API。这需要较大的apk成本。为了避免65K限制，可以使用multidex（或proguard）。</p>
</div>
<div class="sect4">
<h5 id="_maven_configuration_with_drools_compiler_and_multidex"><a class="anchor" href="#_maven_configuration_with_drools_compiler_and_multidex"></a> <a class="link" href="#_maven_configuration_with_drools_compiler_and_multidex">12.1.2.1。使用Drools-compiler和multidex的Maven配置</a></h5>
<div class="paragraph">
<p>必须配置kie-maven-plugin才能构建kiebase。必须使用Multidex来增加依赖性。apk中还有一些用于合并各种Drools XML文件的设置。</p>
</div>
<div class="exampleblock">
<div class="title">例子100.带drools-compiler和multidex的pom.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.drools&lt;/groupId&gt;
      &lt;artifactId&gt;drools-bom&lt;/artifactId&gt;
      &lt;version&gt;7.30.0.Final&lt;/version&gt;
      &lt;type&gt;pom&lt;/type&gt;
      &lt;scope&gt;import&lt;/scope&gt;
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-android&lt;/artifactId&gt;
    &lt;exclusions&gt;
      &lt;exclusion&gt;
        &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
        &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
      &lt;/exclusion&gt;
    &lt;/exclusions&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
    &lt;exclusions&gt;
      &lt;exclusion&gt;
         &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
         &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
      &lt;/exclusion&gt;
      &lt;exclusion&gt;
         &lt;groupId&gt;xmlpull&lt;/groupId&gt;
         &lt;artifactId&gt;xmlpull&lt;/artifactId&gt;
      &lt;/exclusion&gt;
      &lt;exclusion&gt;
         &lt;groupId&gt;xpp3&lt;/groupId&gt;
         &lt;artifactId&gt;xpp3_min&lt;/artifactId&gt;
      &lt;/exclusion&gt;
      &lt;exclusion&gt;
         &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
         &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
      &lt;/exclusion&gt;
      &lt;exclusion&gt;
         &lt;groupId&gt;org.eclipse.jdt.core.compiler&lt;/groupId&gt;
         &lt;artifactId&gt;ecj&lt;/artifactId&gt;
      &lt;/exclusion&gt;
    &lt;/exclusions&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;
&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.kie&lt;/groupId&gt;
      &lt;artifactId&gt;kie-maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;7.30.0.Final&lt;/version&gt;
      &lt;executions&gt;
        &lt;execution&gt;
          &lt;id&gt;compile-kbase&lt;/id&gt;
          &lt;goals&gt;
            &lt;goal&gt;build&lt;/goal&gt;
          &lt;/goals&gt;
          &lt;phase&gt;compile&lt;/phase&gt;
        &lt;/execution&gt;
      &lt;/executions&gt;
    &lt;/plugin&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;com.simpligility.maven.plugins&lt;/groupId&gt;
      &lt;artifactId&gt;android-maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;4.2.1&lt;/version&gt;
      &lt;extensions&gt;true&lt;/extensions&gt;
      &lt;configuration&gt;
        &lt;sdk&gt;
          &lt;platform&gt;21&lt;/platform&gt;
        &lt;/sdk&gt;
        &lt;dex&gt;
          &lt;coreLibrary&gt;true&lt;/coreLibrary&gt;
          &lt;jvmArguments&gt;&lt;jvmArgument&gt;-Xmx2048m&lt;/jvmArgument&gt;&lt;/jvmArguments&gt;
          &lt;multiDex&gt;true&lt;/multiDex&gt;
          &lt;mainDexList&gt;maindex.txt&lt;/mainDexList&gt;
        &lt;/dex&gt;
        &lt;extractDuplicates&gt;true&lt;/extractDuplicates&gt;
        &lt;apk&gt;
          &lt;metaInf&gt;
            &lt;includes&gt;
              &lt;include&gt;services/**&lt;/include&gt;
              &lt;include&gt;kmodule.*&lt;/include&gt;
              &lt;include&gt;HelloKB/**&lt;/include&gt;
              &lt;include&gt;drools**&lt;/include&gt;
              &lt;include&gt;maven/${project.groupId}/${project.artifactId}/**&lt;/include&gt;
            &lt;/includes&gt;
          &lt;/metaInf&gt;
        &lt;/apk&gt;
      &lt;/configuration&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_integration_with_roboguice"><a class="anchor" href="#_integration_with_roboguice"></a> <a class="link" href="#_integration_with_roboguice">12.2。与Roboguice集成</a></h3>
<div class="sect3">
<h4 id="_pre_serialized_rules_with_roboguice"><a class="anchor" href="#_pre_serialized_rules_with_roboguice"></a> <a class="link" href="#_pre_serialized_rules_with_roboguice">12.2.1。Roboguice的预序列化规则</a></h4>
<div class="paragraph">
<p>使用Roboguice，可以使用@KBase批注注入预序列化的KIE基础。</p>
</div>
<div class="sect4">
<h5 id="_annotations_3"><a class="anchor" href="#_annotations_3"></a> <a class="link" href="#_annotations_3">12.2.1.1。注解</a></h5>
<div class="paragraph">
<p>@KBase支持可选的“名称”属性。CDI通常在注入时执行“ getOrCreate”，所有注入针对同一组注解接收相同的实例。“名称”注释会为每个名称强制一个唯一的实例，尽管该名称的所有实例都将具有相同的身份。</p>
</div>
</div>
<div class="sect4">
<h5 id="_kbase_3"><a class="anchor" href="#_kbase_3"></a> <a class="link" href="#_kbase_3">12.2.1.2。@KBase</a></h5>
<div class="paragraph">
<p>默认参数映射到value属性，并从kmodule.xml文件中指定KieBase的名称。</p>
</div>
<div class="listingblock">
<div class="title">通过名称从预序列化资源中注入KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@KBase("kbase1")
private KieBase kbase;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_androidmanifest_xml_configuration"><a class="anchor" href="#_androidmanifest_xml_configuration"></a> <a class="link" href="#_androidmanifest_xml_configuration">12.2.1.3。AndroidManifest.xml配置</a></h5>
<div class="paragraph">
<p>Roboguice模块需要在清单中指定。</p>
</div>
<div class="exampleblock">
<div class="title">示例101Roboguice清单具有预序列化的KIE基础</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;application
   android:largeHeap="true"
   android:allowBackup="true"
   android:icon="@drawable/ic_launcher"
   android:label="@string/app_name"
   android:theme="@style/AppTheme"&gt;
      &lt;meta-data
         android:name="roboguice.modules"
         android:value="org.drools.android.roboguice.DroolsModule"/&gt;
      &lt;activity
         android:label="@string/app_name"
         android:name="org.drools.examples.android.SplashActivity"&gt;
      &lt;intent-filter&gt;
         &lt;action android:name="android.intent.action.MAIN"/&gt;
         &lt;category android:name="android.intent.category.LAUNCHER"/&gt;
      &lt;/intent-filter&gt;
   &lt;/activity&gt;
&lt;/application&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiecontainer_with_drools_compiler_dependency_and_roboguice"><a class="anchor" href="#_kiecontainer_with_drools_compiler_dependency_and_roboguice"></a> <a class="link" href="#_kiecontainer_with_drools_compiler_dependency_and_roboguice">12.2.2。具有流口水编译器依赖性和Roboguice的KieContainer</a></h4>
<div class="paragraph">
<p>使用Roboguice和drools-compiler，几乎可以使用完整的CDI语法来注入KieContainers，KieBases和KieSessions。</p>
</div>
<div class="sect4">
<h5 id="_annotations_4"><a class="anchor" href="#_annotations_4"></a> <a class="link" href="#_annotations_4">12.2.2.1。注解</a></h5>
<div class="paragraph">
<p>@ KContainer，@ KBase和@KSession均支持可选的“名称”属性。CDI通常在注入时执行“ getOrCreate”，所有注入针对同一组注解接收相同的实例。“名称”注释会为每个名称强制一个唯一的实例，尽管该名称的所有实例都将具有相同的身份。</p>
</div>
</div>
<div class="sect4">
<h5 id="_kcontainer_3"><a class="anchor" href="#_kcontainer_3"></a> <a class="link" href="#_kcontainer_3">12.2.2.2。@KContainer</a></h5>
<div class="listingblock">
<div class="title">注入Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private KieContainer kContainer;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kbase_4"><a class="anchor" href="#_kbase_4"></a> <a class="link" href="#_kbase_4">12.2.2.3。@KBase</a></h5>
<div class="paragraph">
<p>如果提供了默认参数，则默认参数会映射到value属性，并从kmodule.xml文件中指定KieBase的名称。</p>
</div>
<div class="listingblock">
<div class="title">从类路径KieContainer注入默认的KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private KieBase kbase;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">从类路径KieContainer中按名称注入KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KBase("kbase1")
private KieBase kbase;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ksession_for_kiesession_3"><a class="anchor" href="#_ksession_for_kiesession_3"></a> <a class="link" href="#_ksession_for_kiesession_3">12.2.2.4。KieSession的@KSession</a></h5>
<div class="paragraph">
<p>@KSession是可选的，因为可以使用@Inject和变量类型推断来检测和添加它。</p>
</div>
<div class="paragraph">
<p>如果提供了默认参数，则默认参数会映射到value属性，并从kmodule.xml文件中指定KieSession的名称。</p>
</div>
<div class="listingblock">
<div class="title">从类路径KieContainer注入默认KieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private KieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">从类路径KieContainer中按名称注入StatelessKieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession("ksession1")
private KieSession ksession;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ksession_for_statelesskiesession_3"><a class="anchor" href="#_ksession_for_statelesskiesession_3"></a> <a class="link" href="#_ksession_for_statelesskiesession_3">12.2.2.5。@KSession用于StatelessKieSession</a></h5>
<div class="paragraph">
<p>@KSession是可选的，因为可以使用@Inject和变量类型推断来检测和添加它。</p>
</div>
<div class="paragraph">
<p>如果提供了默认参数，则默认参数会映射到value属性，并从kmodule.xml文件中指定KieSession的名称。</p>
</div>
<div class="listingblock">
<div class="title">从类路径KieContainer注入默认的StatelessKieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
private StatelessKieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">从类路径KieContainer中按名称注入StatelessKieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession("ksession1")
private StatelessKieSession ksession;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_androidmanifest_xml_configuration_2"><a class="anchor" href="#_androidmanifest_xml_configuration_2"></a> <a class="link" href="#_androidmanifest_xml_configuration_2">12.2.2.6。AndroidManifest.xml配置</a></h5>
<div class="paragraph">
<p>Roboguice模块需要在清单中指定。</p>
</div>
<div class="exampleblock">
<div class="title">例子102。Roboguice清单配置</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;application
   android:largeHeap="true"
   android:allowBackup="true"
   android:icon="@drawable/ic_launcher"
   android:label="@string/app_name"
   android:theme="@style/AppTheme"&gt;
   &lt;meta-data
      android:name="roboguice.modules"
      android:value="org.drools.android.roboguice.DroolsContainerModule"/&gt;
   &lt;activity
      android:label="@string/app_name"
      android:name="org.drools.examples.android.SplashActivity"&gt;
      &lt;intent-filter&gt;
         &lt;action android:name="android.intent.action.MAIN"/&gt;
         &lt;category android:name="android.intent.category.LAUNCHER"/&gt;
      &lt;/intent-filter&gt;
   &lt;/activity&gt;
&lt;/application&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.camel"><a class="anchor" href="#_ch.camel"></a> <a class="link" href="#_ch.camel">13Apache Camel集成</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_camel"><a class="anchor" href="#_camel"></a> <a class="link" href="#_camel">13.1。骆驼</a></h3>
<div class="paragraph">
<p>Camel提供了一个轻量级的总线框架，用于将信息传入和传出Drools。</p>
</div>
<div class="paragraph">
<p>Drools引入了两个元素来简化集成。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>流口水政策</p>
<div class="paragraph">
<p>增强任何JAXB或XStream数据加载器。对于JAXB，它向上下文路径添加了与Drools相关的路径，对于XStream，它为Drools类添加了自定义转换器和别名。它还处理将ClassLoader设置为目标ksession。</p>
</div>
</li>
<li>
<p>流口水端点</p>
<div class="paragraph">
<p>针对指定的流口水会话执行有效负载</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>可以像配置任何常规骆驼组件一样配置Drools，但是请注意包装Drools相关段的策略。这会将所有有效负载路由到ksession1</p>
</div>
<div class="exampleblock">
<div class="title">示例103使用CXFRS生产商配置的Drools Endpoint</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="kiePolicy" class="org.kie.camel.component.KiePolicy" /&gt;

&lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring"&gt;
   &lt;route&gt;
      &lt;from uri="cxfrs://bean://rsServer"/&gt;
         &lt;policy ref="kiePolicy"&gt;
            &lt;unmarshal ref="xstream" /&gt;
            &lt;to uri="kie:ksession1" /&gt;
            &lt;marshal ref="xstream" /&gt;
       &lt;/policy&gt;
    &lt;/route&gt;
&lt;/camelContext&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>可以不在drools端点uri中指定会话，而可以基于属性或标头进行“多路复用”。在此示例中，该策略将检查标题字段“ DroolsLookup”以执行要执行的命名会话，如果未指定，则将检查传入有效负载上的“ lookup”属性。</p>
</div>
<div class="exampleblock">
<div class="title">例子104。使用CXFRS生产商配置的Drools Endpoint</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="kiePolicy" class="org.kie.camel.component.KiePolicy" /&gt;

&lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring"&gt;
   &lt;route&gt;
      &lt;from uri="cxfrs://bean://rsServer"/&gt;
         &lt;policy ref="kiePolicy"&gt;
            &lt;unmarshal ref="xstream" /&gt;
            &lt;to uri="kie:dynamic" /&gt;
            &lt;marshal ref="xstream" /&gt;
       &lt;/policy&gt;
    &lt;/route&gt;
&lt;/camelContext&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">例子105。Java代码针对Spring和CamelContext的Route执行</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public class MyTest extends CamelSpringTestSupport {

    @Override
    protected AbstractXmlApplicationContext createApplicationContext() {
        return new ClassPathXmlApplicationContext("org/drools/camel/component/CxfRsSpring.xml");
    }

    public void test1() throws Exception {
        String cmd = "";
        cmd += "&lt;batch-execution lookup=\"ksession1\"&gt;\n";
        cmd += "  &lt;insert out-identifier=\"salaboy\"&gt;\n";
        cmd += "      &lt;org.drools.pipeline.camel.Person&gt;\n";
        cmd += "         &lt;name&gt;salaboy&lt;/name&gt;\n";
        cmd += "      &lt;/org.drools.pipeline.camel.Person&gt;\n";
        cmd += "   &lt;/insert&gt;\n";
        cmd += "   &lt;fire-all-rules/&gt;\n";
        cmd += "&lt;/batch-execution&gt;\n";

        Object object = this.context.createProducerTemplate().requestBody("direct://client", cmd);
        System.out.println( object );
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>以下网址显示了使用以下命令进行jaxb，xstream和json编组的示例脚本示例：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/jaxb.mvt?r=HEAD" class="bare">http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/jaxb.mvt?r=HEAD</a></p>
</li>
<li>
<p><a href="http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/xstream.mvt?r=HEAD" class="bare">http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/xstream.mvt?r=HEAD</a></p>
</li>
<li>
<p><a href="http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/json.mvt?r=HEAD" class="bare">http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/json.mvt?r=HEAD</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.server"><a class="anchor" href="#_ch.server"></a> <a class="link" href="#_ch.server">14。Drools骆驼服务器</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_3"><a class="anchor" href="#_introduction_3"></a> <a class="link" href="#_introduction_3">14.1。介绍</a></h3>
<div class="paragraph">
<p>Drools骆驼服务器（drools-camel-server）模块是一场战争，您可以部署它以远程方式针对任何类型的客户端应用程序执行KnowledgeBase。这不限于JVM应用程序客户端，而是可以通过REST接口使用HTTP的任何技术。此版本的执行服务器以本机方式支持无状态和有状态会话。</p>
</div>
</div>
<div class="sect2">
<h3 id="_deployment"><a class="anchor" href="#_deployment"></a> <a class="link" href="#_deployment">14.2。部署方式</a></h3>
<div class="paragraph">
<p>Drools Camel Server是一个war文件，可以将其部署在应用程序服务器（例如JBoss AS）中。由于该服务是无状态的，因此可以根据您的需要来部署这些服务，以服务于客户端负载。在JBoss AS 4.x上进行部署/ Tomcat 6.x即开即用，相反，必须添加一些外部依赖项，并且必须更改配置才能在JBoss AS 5中进行部署</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration"><a class="anchor" href="#_configuration"></a> <a class="link" href="#_configuration">14.3。组态</a></h3>
<div class="paragraph">
<p>在war文件中，您将找到一些XML配置文件。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>beans.xml</p>
<div class="ulist">
<ul>
<li>
<p>导入Knowledge-services.xml和camel-server.xml的骨架XML</p>
</li>
</ul>
</div>
</li>
<li>
<p>camel-server.xml</p>
<div class="ulist">
<ul>
<li>
<p>使用骆驼路由配置CXF端点</p>
</li>
<li>
<p>将管道消息路由到各种已配置的知识服务</p>
</li>
</ul>
</div>
</li>
<li>
<p>Knowledge-services.xml</p>
<div class="ulist">
<ul>
<li>
<p>各种KIE基础和课程</p>
</li>
</ul>
</div>
</li>
<li>
<p>camel-client.xml</p>
<div class="ulist">
<ul>
<li>
<p>示例骆驼客户端，显示如何发送和接收消息</p>
</li>
<li>
<p>由“开箱即用” test.jsp使用</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_restcamel_services_configuration"><a class="anchor" href="#_restcamel_services_configuration"></a> <a class="link" href="#_restcamel_services_configuration">14.3.1。REST /骆驼服务配置</a></h4>
<div class="paragraph">
<p>下一步是配置将通过drools-server公开的服务。您可以在camel-server.xml文件中修改此配置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:cxf="http://camel.apache.org/schema/cxf"
  xmlns:jaxrs="http://cxf.apache.org/jaxrs"
  xsi:schemaLocation="
  http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
  http://camel.apache.org/schema/cxf http://camel.apache.org/schema/cxf/camel-cxf.xsd
  http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd
  http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd"&gt;

&lt;import resource="classpath:META-INF/cxf/cxf.xml" /&gt;
&lt;import resource="classpath:META-INF/cxf/cxf-extension-jaxrs-binding.xml"/&gt;
&lt;import resource="classpath:META-INF/cxf/cxf-servlet.xml" /&gt;

  &lt;!--
   !   If you are running on JBoss you will need to copy a camel-jboss.jar into the lib and set this ClassLoader configuration
   !  http://camel.apache.org/camel-jboss.html
   !   &lt;bean id="jbossResolver" class="org.apache.camel.jboss.JBossPackageScanClassResolver"/&gt;
   --&gt;

  &lt;!--
   !   Define the server end point.
   !   Copy and paste this element, changing id and the address, to expose services on different urls.
   !   Different Camel routes can handle different end point paths.
   --&gt;
  &lt;cxf:rsServer id="rsServer"
                address="/rest"
                serviceClass="org.kie.jax.rs.CommandExecutorImpl"&gt;
       &lt;cxf:providers&gt;
           &lt;bean class="org.kie.jax.rs.CommandMessageBodyReader"/&gt;
       &lt;/cxf:providers&gt;
  &lt;/cxf:rsServer&gt;

  &lt;cxf:cxfEndpoint id="soapServer"
            address="/soap"
             serviceName="ns:CommandExecutor"
             endpointName="ns:CommandExecutorPort"
          wsdlURL="soap.wsdl"
          xmlns:ns="http://soap.jax.drools.org/" &gt;
    &lt;cxf:properties&gt;
      &lt;entry key="dataFormat" value="MESSAGE"/&gt;
      &lt;entry key="defaultOperationName" value="execute"/&gt;
    &lt;/cxf:properties&gt;
  &lt;/cxf:cxfEndpoint&gt;

  &lt;!-- Leave this, as it's needed to make Camel "drools" aware --&gt;
  &lt;bean id="kiePolicy" class="org.kie.camel.component.KiePolicy" /&gt;

  &lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring"&gt;
    &lt;!--
     ! Routes incoming messages from end point id="rsServer".
     ! Example route unmarshals the messages with xstream and executes against ksession1.
     ! Copy and paste this element, changing marshallers and the 'to' uri, to target different sessions, as needed.
     !--&gt;

    &lt;route&gt;
       &lt;from uri="cxfrs://bean://rsServer"/&gt;
       &lt;policy ref="kiePolicy"&gt;
         &lt;unmarshal ref="xstream" /&gt;
         &lt;to uri="kie:ksession1" /&gt;
         &lt;marshal ref="xstream" /&gt;
       &lt;/policy&gt;
    &lt;/route&gt;

    &lt;route&gt;
      &lt;from uri="cxf://bean://soapServer"/&gt;
      &lt;policy ref="kiePolicy"&gt;
        &lt;unmarshal ref="xstream" /&gt;
        &lt;to uri="kie:ksession1" /&gt;
        &lt;marshal ref="xstream" /&gt;
      &lt;/policy&gt;
    &lt;/route&gt;

  &lt;/camelContext&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_restful_service_endpoint_creation"><a class="anchor" href="#_restful_service_endpoint_creation"></a> <a class="link" href="#_restful_service_endpoint_creation">14.3.1.1。RESTful服务端点创建</a></h5>
<div class="paragraph">
<p>在下一个XML代码段中，我们将创建一个绑定到/ kservice / rest地址的RESTful（JAX-RS）端点，并使用org.drools.jax.rs。CommandExecutorImpl作为服务实现者。此类仅用于实例化服务端点，因为所有内部实现均由Camel管理，并且您可以在源文件中看到必须永远不要调用公开的执行服务。</p>
</div>
<div class="paragraph">
<p>还提供了JAX-RS提供程序来确定是否可以在此服务端点中处理传输的消息。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;cxf:rsServer id="rsServer"
              address="/rest"
              serviceClass="org.kie.jax.rs.CommandExecutorImpl"&gt;
     &lt;cxf:providers&gt;
         &lt;bean class="org.kie.jax.rs.CommandMessageBodyReader"/&gt;
     &lt;/cxf:providers&gt;
&lt;/cxf:rsServer&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>理想情况下，不需要修改此配置，至少不需要修改服务类和JAX-RS提供程序，但是您可以添加更多与不同地址关联的终结点，以在其他骆驼路由中使用它们。</p>
</div>
<div class="paragraph">
<p>完成所有这些初始配置之后，您可以开始配置自己的知识服务。</p>
</div>
</div>
<div class="sect4">
<h5 id="_camel_kie_policy_context_creation"><a class="anchor" href="#_camel_kie_policy_context_creation"></a> <a class="link" href="#_camel_kie_policy_context_creation">14.3.1.2。Camel Kie政策和环境创建</a></h5>
<div class="paragraph">
<p>KiePolicy用于在骆驼中添加Drools支持，基本上它的作用是在骆驼路线中添加拦截器，以动态创建骆驼处理器并修改内部导航路线。如果要获得SOAP支持，则需要创建自定义的Drools策略，但它将在下一个版本中添加。</p>
</div>
<div class="paragraph">
<p>但是您不需要了解更多内部细节，只需实例化此bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bean id="kiePolicy" class="org.kie.camel.component.KiePolicy" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>接下来是创建骆驼路线，该路线将负责执行通过JAX-RS发送的命令。基本上，我们创建一个与JAX-RS定义相关联的路由定义作为数据输入，要使用的骆驼策略以及在“执行路由”或ProcessorDefinitions内部。如您所见，我们将XStream设置为marshaller / unmarshaller和drools执行路线定义</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring"&gt;
   &lt;route&gt;
      &lt;from uri="cxfrs://bean://rsServer"/&gt;
      &lt;policy ref="kiePolicy"&gt;
        &lt;unmarshal ref="xstream" /&gt;
        &lt;to uri="kie:ksession1" /&gt;
        &lt;marshal ref="xstream" /&gt;
      &lt;/policy&gt;
   &lt;/route&gt;
   &lt;route&gt;
     &lt;from uri="cxf://bean://soapServer"/&gt;
     &lt;policy ref="kiePolicy"&gt;
       &lt;unmarshal ref="xstream" /&gt;
       &lt;to uri="kie:ksession1" /&gt;
       &lt;marshal ref="xstream" /&gt;
     &lt;/policy&gt;
   &lt;/route&gt;
&lt;/camelContext&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Drools端点创建具有下一个参数</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;to uri="kie:{1}/{2}" /&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在CamelContext中注册的执行节点标识符</p>
</li>
<li>
<p>已在执行节点中注册的标识符为{1}的KIE会话标识符</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>这两个参数都在Knowledge-services.xml文件中配置。</p>
</div>
</div>
<div class="sect4">
<h5 id="_knowledge_services_configuration"><a class="anchor" href="#_knowledge_services_configuration"></a> <a class="link" href="#_knowledge_services_configuration">14.3.1.3。知识服务配置</a></h5>
<div class="paragraph">
<p>下一步是创建将要使用的KIE会话。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:kie="http://drools.org/schema/kie-spring"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                          http://drools.org/schema/kie-spring http://drools.org/schema/kie-spring.xsd"&gt;

  &lt;kie:kmodule id="drools-camel-server"&gt;
    &lt;kie:kbase name="kbase1" packages="org.drools.server"&gt;
      &lt;kie:ksession name="ksession1" type="stateless"/&gt;
    &lt;/kie:kbase&gt;
  &lt;/kie:kmodule&gt;

  &lt;bean id="kiePostProcessor"
            class="org.kie.spring.KModuleBeanFactoryPostProcessor"/&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>执行节点是注册的kbase和ksession的上下文，此处kbase1和ksession1放在node1上下文中。kbase本身包含两个知识定义：DRL和XSD。 Spring文档包含有关配置这些知识服务的更多信息。</p>
</div>
</div>
<div class="sect4">
<h5 id="_test"><a class="anchor" href="#_test"></a> <a class="link" href="#_test">14.3.1.4。测试</a></h5>
<div class="paragraph">
<p>随着drools-server war的解压缩，您应该能够看到一个test.jsp并运行它。本示例仅执行一个简单的“ echo”类型的应用程序。它向规则服务器发送一条消息，该消息将单词“ echo”预先添加到前面，然后再发送回去。默认情况下，消息为“ Hello World”，可以使用url参数msg-test.jsp传递不同的消息？msg =“我的自定义消息”。</p>
</div>
<div class="paragraph">
<p>在后台，jsp调用Test.java类，然后调用Camel进行相遇。camel-client.xml仅使用几行XML定义客户端：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Leave this, as it's needed to make Camel "drools" aware --&gt;
&lt;bean id="kiePolicy" class="org.kie.camel.component.KiePolicy" /&gt;

&lt;camelContext id="camel" xmlns="http://camel.apache.org/schema/spring"&gt;
  &lt;route&gt;
     &lt;from uri="direct://kservice/rest"/&gt;
     &lt;policy ref="kiePolicy"&gt;
       &lt;to uri="cxfrs://http://localhost:8080/drools-server/kservice/rest"/&gt;
     &lt;/policy&gt;
  &lt;/route&gt;
  &lt;route&gt;
    &lt;from uri="direct://kservice/soap"/&gt;
    &lt;policy ref="kiePolicy"&gt;
      &lt;to uri="cxfrs://http://localhost:8080/drools-server/kservice/soap"/&gt;
    &lt;/policy&gt;
  &lt;/route&gt;
&lt;/camelContext&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>“ direct：// kservice”只是一个命名的钩子，允许Java获取引用并将数据推入其中。在这个例子中，数据已经是XML格式，因此我们不需要添加任何数据<code>DataFormat</code>进行编组。KiePolicy在路由中添加了一些技巧，您还将看到它在服务器端也得到了使用。如果使用JAXB或XStream，它将注入自定义路径和转换器，它也可以在服务器端设置ClassLoader，在客户端它会自动解包Response对象。</p>
</div>
<div class="paragraph">
<p>规则本身可以在这里找到：test.drl。请注意，消息类型声明为DRL的一部分，因此在类路径中不存在。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>declare Message
   text : String
end


rule "echo"
when
   $m : Message();
then
   $m.text = "echo:" + $m.text;
end</code></pre>
</div>
</div>
<h1 id="_business_central" class="discrete">商业中心</h1>
<div class="paragraph">
<p>Drools中的Business Central是使用UberFire框架构建的，并使用Guvnor插件。Drools为规则创作隐喻提供了一组额外的丰富插件。</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">﻿<div class="sect1">
<h2 id="_wb.workbench"><a class="anchor" href="#_wb.workbench"></a> <a class="link" href="#_wb.workbench">15商务中心（一般）</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_wb.installation"><a class="anchor" href="#_wb.installation"></a> <a class="link" href="#_wb.installation">15.1。安装</a></h3>
<div class="sect3">
<h4 id="_wb.warinstallation"><a class="anchor" href="#_wb.warinstallation"></a> <a class="link" href="#_wb.warinstallation">15.1.1。战争安装</a></h4>
<div class="paragraph">
<p>使用<code>war</code>从与您的应用程序服务器相对应的Business Central分发zip中获取。这些之间的区别<code>war</code>文件主要是肤浅的。例如，如果应用程序服务器已经提供了某些JAR，则可能会排除它们。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>eap7</code> ：针对Red Hat JBoss企业应用平台7量身定制</p>
</li>
<li>
<p><code>wildfly14</code> ：专为Wildfly 14设计</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_wb.workbenchdata"><a class="anchor" href="#_wb.workbenchdata"></a> <a class="link" href="#_wb.workbenchdata">15.1.2。商务中心数据</a></h4>
<div class="paragraph">
<p>Business Central默认将其数据存储在目录中<code>$WORKING_DIRECTORY/.niogit</code> ， 例如<code>wildfly-14.0.1.Final/bin/.niogit</code> ，但是可以使用<a href="#_wb.systemproperties">system属性</a>覆盖它<code>-Dorg.uberfire.nio.git.dir</code> 。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在生产中，请确保备份Business Central数据目录。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_wb.troubleshooting"><a class="anchor" href="#_wb.troubleshooting"></a> <a class="link" href="#_wb.troubleshooting">15.1.3。故障排除</a></h4>
<div class="sect4">
<h5 id="_wb.troubleshootingloadingspinner"><a class="anchor" href="#_wb.troubleshootingloadingspinner"></a> <a class="link" href="#_wb.troubleshootingloadingspinner">15.1.3.1。加载中..不会消失，Business Central无法显示</a></h5>
<div class="paragraph">
<p>有报告说，服务器和浏览器之间的防火墙可能会干扰Business Central使用的服务器发送事件（SSE）。</p>
</div>
<div class="paragraph">
<p>该问题导致``正在加载...''微调器仍然可见并且Business Central无法实现。</p>
</div>
<div class="paragraph">
<p>解决方法是通过添加文件来禁止Business Central使用服务器发送事件<code>/WEB-INF/classes/ErraiService.properties</code>到包含值的爆炸WAR <code>errai.bus.enable_sse_support=false</code> 。重新包装WAR，然后重新部署。</p>
</div>
<div class="paragraph">
<p>一些用户还报告说禁用服务器发送事件不能解决问题。发现有效的解决方案是将JVM配置为在Linux上使用其他Entropy Gathering Device，以用于<code>SecureRandom</code> 。可以通过设置系统属性来配置<code>java.security.egd</code>至<code>file:/dev/./urandom</code> 。见<a href="http://stackoverflow.com/questions/33166198/kie-workbench-not-loading-after-login/39110177#39110177">该</a>堆栈溢出职位的详细信息。</p>
</div>
<div class="paragraph">
<p>但是请注意，这会影响JVM的随机数生成，并且在需要强加密的情况下可能会带来其他挑战。谨慎配置。</p>
</div>
</div>
<div class="sect4">
<h5 id="_not_able_to_clone_business_central_git_repository_using_ssh_protocol"><a class="anchor" href="#_not_able_to_clone_business_central_git_repository_using_ssh_protocol"></a> <a class="link" href="#_not_able_to_clone_business_central_git_repository_using_ssh_protocol">15.1.3.2。无法使用ssh协议克隆Business Central Git存储库。</a></h5>
<div class="paragraph">
<p>使用ssh与与Business Central捆绑在一起的Git服务器进行交互的Git客户端通过Uberfire后端服务器一部分的安全API进行身份验证和授权，可以执行git命令。使用LDAP安全领域时，某些git客户端未得到预期的授权。这是由于这样的事实，对于非Web客户端（例如，通过ssh的Git），由应用程序服务器的用户注册表分配给用户的主体（即用户或组）名称是LDAP与该主体相关联的更复杂的DN。 Uberfire后端服务器的逻辑寻找允许角色与返回的主体名称完全匹配，因此失败。</p>
</div>
<div class="paragraph">
<p>现在可以通过system属性控制角色主要匹配</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-property hljs" data-lang="property">org.uberfire.ldap.regex.role_mapper</code></pre>
</div>
</div>
<div class="paragraph">
<p>当将LDAP主体与角色名称匹配时，将使用正则表达式模式作为其值。模式必须包含文字单词变量“ role”。在授权过程中，变量被每个允许应用程序角色替换。如果模式匹配，则将角色添加到用户。</p>
</div>
<div class="paragraph">
<p>例如，如果LDAP中admin组的DN为</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-property hljs" data-lang="property">DN: cn=admin,ou=groups,dc=example,dc=com</code></pre>
</div>
</div>
<div class="paragraph">
<p>它的预期角色是admin，然后设置<code>org.uberfire.ldap.regex.role_mapper</code>有价值</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-regex hljs" data-lang="regex">cn[\\ ]*=[\\ ]*role</code></pre>
</div>
</div>
<div class="paragraph">
<p>会在“ admin”角色上找到匹配项。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="business-central-system-properties-ref"><a class="anchor" href="#business-central-system-properties-ref"></a> <a class="link" href="#business-central-system-properties-ref">15.2。商务中心系统属性</a></h3>
<div class="paragraph">
<p>本节中列出的Business Central系统属性将传递给<code>standalone*.xml</code>文件。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.uberfire.nio.git.dir</code> ：KIE Server Git目录的位置。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.dirname</code> ：KIE Server Git目录的名称。默认值： <code>.niogit</code> 。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.proxy.ssh.over.http</code> ：指定SSH是否应使用HTTP代理。默认值： <code>false</code> 。</p>
</li>
<li>
<p><code>http.proxyHost</code> ：定义HTTP代理的主机名。默认值： <code>null</code> 。</p>
</li>
<li>
<p><code>http.proxyPort</code> ：定义HTTP代理的主机端口（整数值）。默认值： <code>null</code> 。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.proxy.ssh.over.https</code> ：指定SSH是否应使用HTTPS代理。默认值： <code>false</code> 。</p>
</li>
<li>
<p><code>https.proxyHost</code> ：定义HTTPS代理的主机名。默认值： <code>null</code> 。</p>
</li>
<li>
<p><code>https.proxyPort</code> ：定义HTTPS代理的主机端口（整数值）。默认值： <code>null</code> 。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.http.enabled</code> ：启用或禁用HTTP守护程序。默认值： <code>true</code> 。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.http.host</code> ：如果启用了HTTP守护程序，它将使用此属性作为主机标识符。这是一个信息性属性，用于显示如何通过HTTP访问Git存储库。HTTP仍然依赖servlet容器。默认值： <code>localhost</code> 。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.http.hostname</code> ：如果启用了HTTP守护程序，它将使用此属性作为主机名标识符。这是一个信息性属性，用于显示如何通过HTTP访问Git存储库。HTTP仍然依赖servlet容器。默认值： <code>localhost</code> 。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.http.port</code> ：如果启用了HTTP守护程序，它将使用此属性作为端口号。这是一个信息性属性，用于显示如何通过HTTP访问Git存储库。HTTP仍然依赖servlet容器。默认值： <code>8080</code> 。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.https.enabled</code> ：启用或禁用HTTPS守护程序。默认值：<code>false</code></p>
</li>
<li>
<p><code>org.uberfire.nio.git.https.host</code> ：如果启用了HTTPS守护程序，它将使用此属性作为主机标识符。这是一个信息性属性，用于显示如何通过HTTPS访问Git存储库。HTTPS仍然依赖servlet容器。默认值： <code>localhost</code> 。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.https.hostname</code> ：如果启用了HTTPS守护程序，它将使用此属性作为主机名标识符。这是一个信息性属性，用于显示如何通过HTTPS访问Git存储库。HTTPS仍然依赖servlet容器。默认值： <code>localhost</code> 。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.https.port</code> ：如果启用了HTTPS守护程序，它将使用此属性作为端口号。这是一个信息性属性，用于显示如何通过HTTPS访问Git存储库。HTTPS仍然依赖servlet容器。默认值： <code>8080</code> 。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.daemon.enabled</code> ：启用或禁用Git守护程序。默认值： <code>true</code> 。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.daemon.host</code> ：如果启用了Git守护程序，它将使用此属性作为本地主机标识符。默认值： <code>localhost</code> 。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.daemon.hostname</code> ：如果启用了Git守护程序，它将使用此属性作为本地主机名标识符。默认值：<code>localhost</code></p>
</li>
<li>
<p><code>org.uberfire.nio.git.daemon.port</code> ：如果启用了Git守护程序，它将使用此属性作为端口号。默认值： <code>9418</code> 。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.http.sslVerify</code> ：启用或禁用Git存储库的SSL证书检查。默认值： <code>true</code> 。</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">如果默认或分配的端口已在使用中，则会自动选择一个新端口。确保端口可用，并检查日志以获取更多信息。
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p><code>org.uberfire.nio.git.ssh.enabled</code> ：启用或禁用SSH守护程序。默认值： <code>true</code> 。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.ssh.host</code> ：如果启用了SSH守护程序，它将使用此属性作为本地主机标识符。默认值： <code>localhost</code> 。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.ssh.hostname</code> ：如果启用了SSH守护程序，它将使用此属性作为本地主机名标识符。默认值： <code>localhost</code> 。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.ssh.port</code> ：如果启用了SSH守护程序，它将使用此属性作为端口号。默认值： <code>8001</code> 。</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">如果默认或分配的端口已在使用中，则会自动选择一个新端口。确保端口可用，并检查日志以获取更多信息。
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p><code>org.uberfire.nio.git.ssh.cert.dir</code> ：的位置<code>.security</code>存储本地证书的目录。默认值：工作目录。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.ssh.passphrase</code> ：密码短语，用于在使用SCP样式URL克隆git存储库时访问操作系统的公钥存储。例： <code>git@github.com:user/repository.git</code> 。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.ssh.algorithm</code> ：SSH使用的算法。默认值： <code>RSA</code> 。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.ssh.ciphers</code> ：逗号分隔的密码字符串。可用的密码是<code>aes128-ctr</code> ， <code>aes192-ctr</code> ， <code>aes256-ctr</code> ， <code>arcfour128</code> ， <code>arcfour256</code> ， <code>aes192-cbc</code> ， <code>aes256-cbc</code> 。如果未使用该属性，则将加载所有可用密码。</p>
</li>
<li>
<p><code>org.uberfire.nio.git.ssh.macs</code> ：消息验证码（MAC）的逗号分隔字符串。可用的MAC是<code>hmac-md5</code> ， <code>hmac-md5-96</code> ， <code>hmac-sha1</code> ， <code>hmac-sha1-96</code> ， <code>hmac-sha2-256</code> ， <code>hmac-sha2-512</code> 。如果未使用该属性，则将加载所有可用的MAC。</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">如果计划使用RSA或DSA以外的任何算法，请确保将应用程序服务器设置为使用Bouncy Castle JCE库。
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p><code>org.uberfire.metadata.index.dir</code> ：Lucene所在的地方<code>.index</code>目录已存储。默认值：工作目录。</p>
</li>
<li>
<p><code>org.uberfire.ldap.regex.role_mapper</code> ：用于将LDAP主体名称映射到应用程序角色名称的正则表达式模式。请注意，变量角色必须是模式的一部分，因为在将主体值与角色名称匹配时，变量角色将由应用程序角色名称替换。</p>
</li>
<li>
<p><code>org.uberfire.sys.repo.monitor.disabled</code> ：禁用配置监视器。除非确定，否则不要禁用。默认值： <code>false</code> 。</p>
</li>
<li>
<p><code>org.uberfire.secure.key</code> ：密码加密所使用的密码。默认值： <code>org.uberfire.admin</code> 。</p>
</li>
<li>
<p><code>org.uberfire.secure.alg</code> ：密码加密所使用的加密算法。默认值： <code>PBEWithMD5AndDES</code> 。</p>
</li>
<li>
<p><code>org.uberfire.domain</code> ：uberfire使用的安全域名。默认值： <code>ApplicationRealm</code> 。</p>
</li>
<li>
<p><code>org.guvnor.m2repo.dir</code> ：Maven存储库文件夹的存储位置。默认值： <code><working-directory>/repositories/kie</code> 。</p>
</li>
<li>
<p><code>org.guvnor.project.gav.check.disabled</code> ：禁用组ID，工件ID和版本（GAV）检查。默认值： <code>false</code> 。</p>
</li>
<li>
<p><code>org.kie.build.disable-project-explorer</code> ：禁用在项目资源管理器中自动构建所选项目。默认值： <code>false</code> 。</p>
</li>
<li>
<p><code>org.kie.verification.disable-dtable-realtime-verification</code> ：禁用决策表的实时验证和验证。默认值： <code>false</code> 。</p>
</li>
<li>
<p><code>org.kie.server.controller</code> ：URL用于连接Drools控制器。例如， <code>ws://localhost:8080/business-central/websocket/controller</code> 。</p>
</li>
<li>
<p><code>org.kie.server.user</code> ：用于从Drools控制器与KIE Server节点连接的用户名。仅当将此Business Central安装用作Drools控制器时才需要此属性。</p>
</li>
<li>
<p><code>org.kie.server.pwd</code> ：用于从Drools控制器与KIE Server节点连接的密码。仅当将此Business Central安装用作Drools控制器时才需要此属性。</p>
</li>
<li>
<p><code>kie.maven.offline.force</code> ：强制Maven处于脱机状态。如果为true，请禁用在线依赖关系解析。默认值： <code>false</code> 。</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">将此属性仅用于Business Central。如果您与其他任何组件共享运行时环境，请隔离配置并将其仅应用于Business Central。
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p><code>org.uberfire.gzip.enable</code> ：启用或禁用GzipFilter上的Gzip压缩。默认值： <code>true</code> 。</p>
</li>
<li>
<p><code>org.kie.workbench.profile</code> ：选择Business Central配置文件。可能的值为<code>FULL</code>要么<code>PLANNER_AND_RULES</code> 。前缀<code>FULL_</code>将设置个人资料，并从管理员偏好设置中隐藏个人资料偏好设置。默认值：<code>FULL</code></p>
</li>
<li>
<p><code>org.appformer.m2repo.url</code> ：在查找依赖项时，Business Central使用Maven存储库的默认位置。它指向Business Central内部的Maven存储库。例如， <code>http://localhost:8080/business-central/maven2</code> 。在启动Business Central之前，请设置此属性。默认值：内部文件路径<code>m2</code>资料库。</p>
</li>
<li>
<p><code>appformer.ssh.keystore</code> ：通过指定类名称来定义要用于Business Central的自定义SSH密钥库。如果该属性不可用，则使用默认的SSH密钥库。</p>
</li>
<li>
<p><code>appformer.ssh.keys.storage.folder</code> ：使用默认的SSH密钥库时，此属性定义用户的SSH公钥的存储文件夹。如果该属性不可用，则密钥存储在Business Central中<code>.security</code>夹。</p>
</li>
<li>
<p><code>appformer.experimental.features</code> ：启用实验功能框架。</p>
</li>
<li>
<p><code>org.kie.demo</code> ：从GitHub启用演示应用程序的外部克隆。</p>
</li>
<li>
<p><code>org.kie.workbench.controller</code> ：URL用于连接Drools控制器。例如， <code>ws://localhost:8080/kie-server-controller/websocket/controller</code> 。</p>
</li>
<li>
<p><code>org.kie.workbench.controller.user</code> ：用户名用于连接Drools控制器。默认值：kieserver。</p>
</li>
<li>
<p><code>org.kie.workbench.controller.pwd</code> ：密码用于连接Drools控制器。默认值：kieserver1!。</p>
</li>
<li>
<p><code>org.kie.workbench.controller.token</code> ：令牌字符串用于连接Drools控制器。</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">有关如何使用基于令牌的身份验证的更多信息，请参见<a href="#usingTokenBasedAuthentication">使用基于令牌的身份验证</a> 。
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p><code>kie.keystore.keyStoreURL</code> ：URL用于加载Java密码术扩展密钥库（JCEKS）。例如，<code>file:///home/kie/keystores/keystore.jceks.</code></p>
</li>
<li>
<p><code>kie.keystore.keyStorePwd</code> ：密码用于JCEKS。</p>
</li>
<li>
<p><code>kie.keystore.key.ctrl.alias</code> ：默认REST Drools控制器的密钥的别名。</p>
</li>
<li>
<p><code>kie.keystore.key.ctrl.pwd</code> ：默认REST Drools控制器的别名的密码。</p>
</li>
<li>
<p><code>org.jbpm.wb.forms.renderer.ext</code> ：在Business Central和KIE Server之间切换表单呈现。默认情况下，表单呈现是由Business Central完成的。默认值： <code>false</code> 。</p>
</li>
<li>
<p><code>org.jbpm.wb.forms.renderer.name</code> ：此属性允许在Business Central和KIE Server呈现的表单之间切换。默认值： <code>workbench</code> 。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_wb.quickstart"><a class="anchor" href="#_wb.quickstart"></a> <a class="link" href="#_wb.quickstart">15.3。快速开始</a></h3>
<div class="paragraph">
<p>这些步骤可帮助您以最小的努力入门。</p>
</div>
<div class="paragraph">
<p>它们不能代替完整阅读文档。</p>
</div>
<div class="sect3">
<h4 id="_wb.quickstartimportexamples"><a class="anchor" href="#_wb.quickstartimportexamples"></a> <a class="link" href="#_wb.quickstartimportexamples">15.3.1。导入示例</a></h4>
<div class="openblock">
<div class="title">导入示例-快速安装示例</div>
<div class="content">
<div class="paragraph">
<p>如果Business Central为空，则会显示空白页面。单击下面的“尝试示例”按钮将显示可用的示例。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-example1.png" alt="快速入门示例1">
</div>
</div>
<div class="paragraph">
<p>打开“试用样品”页面后，您可以选择一个或多个示例，然后单击“确定”。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-example2.png" alt="快速入门example2">
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>如果Business Central已经包含项目，则可以使用从菜单中找到的“尝试示例”按钮导入示例。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-import-with-pre-existing-projects.png" alt="使用现有项目快速导入">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.quickstartaddproject"><a class="anchor" href="#_wb.quickstartaddproject"></a> <a class="link" href="#_wb.quickstartaddproject">15.3.2。新增专案</a></h4>
<div class="paragraph">
<p>或者，要导入示例，可以在“空间”页面上使用“添加项目”创建一个新的空项目。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-example1.png" alt="快速入门示例1">
</div>
<div class="title">图144。新建项目按钮</div>
</div>
<div class="paragraph">
<p>给项目起一个名字和可选的描述。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-new-project-wizard.png" alt="快速入门新项目向导">
</div>
<div class="title">图145。给项目起个名字</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.quickstartdefinedatamodel"><a class="anchor" href="#_wb.quickstartdefinedatamodel"></a> <a class="link" href="#_wb.quickstartdefinedatamodel">15.3.3。定义数据模型</a></h4>
<div class="paragraph">
<p>创建项目后，您需要定义规则要使用的类型。</p>
</div>
<div class="paragraph">
<p>从“添加资产”菜单中选择“数据对象”。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>您还可以使用现有JAR中包含的类型。</p>
</div>
<div class="paragraph">
<p>有关详细信息，请查阅完整的文档。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-create-a-data-model.png" alt="快速入门创建数据模型">
</div>
<div class="title">图146。创建“数据对象”</div>
</div>
<div class="paragraph">
<p>设置名称并为新类型选择一个包。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-create-data-object-popup.png" alt="快速入门创建数据对象弹出窗口">
</div>
<div class="title">图147。创建一个新类型</div>
</div>
<div class="paragraph">
<p>单击“ +添加字段”按钮并设置字段名称和类型，然后单击“创建”以创建类型的字段。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-create-field.png" alt="快速入门创建字段">
</div>
<div class="title">图148。点击“创建”并添加字段</div>
</div>
<div class="paragraph">
<p>单击“保存”以更新模型。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-confirm-save.png" alt="快速入门确认保存">
</div>
<div class="title">图149。点击“保存”</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.quickstartdefinerule"><a class="anchor" href="#_wb.quickstartdefinerule"></a> <a class="link" href="#_wb.quickstartdefinerule">15.3.4。定义规则</a></h4>
<div class="paragraph">
<p>从“添加资产”菜单中选择“ DRL文件”（例如）。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-create-drl-file.png" alt="快速入门创建drl文件">
</div>
<div class="title">图150。从“添加资产”菜单中选择“ DRL文件”</div>
</div>
<div class="paragraph">
<p>输入新规则的文件名。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>确保选择与规则相同的软件包。可以在不同的程序包中包含规则和数据模型，但是为了演示目的，让我们保持简单。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-new-rule-popup.png" alt="快速入门新规则弹出窗口">
</div>
<div class="title">图151。输入规则的文件名</div>
</div>
<div class="paragraph">
<p>输入规则的定义。</p>
</div>
<div class="paragraph">
<p>定义过程因资产类型而异。</p>
</div>
<div class="paragraph">
<p>完整的文档包含有关不同编辑器的详细信息。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-writing-a-rule.png" alt="快速入门编写规则">
</div>
<div class="title">图152。定义规则</div>
</div>
<div class="paragraph">
<p>一旦定义了规则，就需要以与保存模型相同的方式来保存它。</p>
</div>
</div>
<div class="sect3">
<h4 id="_wb.quickstartbuildanddeloy"><a class="anchor" href="#_wb.quickstartbuildanddeloy"></a> <a class="link" href="#_wb.quickstartbuildanddeloy">15.3.5。构建和部署</a></h4>
<div class="paragraph">
<p>一旦在项目中定义了规则；可以构建该项目并将其部署到Business Central的Maven Artifact信息库。</p>
</div>
<div class="paragraph">
<p>要构建项目，请从项目创作中选择“构建并部署”。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/QuickStart/QuickStart-build-and-deploy.png" alt="快速入门构建和部署">
</div>
<div class="title">图153。建立一个项目</div>
</div>
<div class="paragraph">
<p>单击“构建并部署”以构建项目并将其部署到Business Central的Maven Artifact存储库。</p>
</div>
<div class="paragraph">
<p>当选择Build＆Deploy时，Business Central将部署到Business Central项目pom的Dependency Management部分中定义的任何存储库。您可以在项目浏览器的“存储库视图”下编辑与Business Central项目关联的pom.xml文件。可以在以下位置找到有关Maven中的依赖管理的详细信息： <a href="http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html" class="bare">http</a> : <a href="http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html" class="bare">//maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html</a></p>
</div>
<div class="paragraph">
<p>如果在构建过程中出现错误，则将在“消息”面板中报告这些错误。</p>
</div>
<div class="paragraph">
<p>现在，该项目已构建并部署；可以像其他任何Maven Artifact一样从您自己的项目中引用它。</p>
</div>
<div class="paragraph">
<p>完整的文档包含有关将项目与您自己的应用程序集成的详细信息。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.configuration"><a class="anchor" href="#_wb.configuration"></a> <a class="link" href="#_wb.configuration">15.4。组态</a></h3>
<div class="sect3">
<h4 id="_wb.usermanagement"><a class="anchor" href="#_wb.usermanagement"></a> <a class="link" href="#_wb.usermanagement">15.4.1。基本用户管理</a></h4>
<div class="paragraph">
<p>Business Central会根据应用程序服务器的身份验证和授权（JAAS）对用户进行身份验证。</p>
</div>
<div class="paragraph">
<p>在JBoss EAP和WildFly上，使用脚本添加用户<code>$JBOSS_HOME/bin/add-user.sh</code> （要么<code>.bat</code> ）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ ./add-user.sh
// Type: Application User
// Realm: empty (defaults to ApplicationRealm)
// Role: admin</code></pre>
</div>
</div>
<div class="paragraph">
<p>无需重新启动应用程序服务器。</p>
</div>
</div>
<div class="sect3">
<h4 id="_wb.roles"><a class="anchor" href="#_wb.roles"></a> <a class="link" href="#_wb.roles">15.4.2。的角色</a></h4>
<div class="paragraph">
<p>Business Central使用以下角色：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>管理员</p>
</li>
<li>
<p>分析员</p>
</li>
<li>
<p>开发商</p>
</li>
<li>
<p>经理</p>
</li>
<li>
<p>用户</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_admin"><a class="anchor" href="#_admin"></a> <a class="link" href="#_admin">15.4.2.1。管理员</a></h5>
<div class="paragraph">
<p>管理BPMS系统。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>管理用户</p>
</li>
<li>
<p>管理VFS存储库</p>
</li>
<li>
<p>有权进行任何必要的更改</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_developer"><a class="anchor" href="#_developer"></a> <a class="link" href="#_developer">15.4.2.2。开发者</a></h5>
<div class="paragraph">
<p>除克隆存储库外，开发人员几乎可以执行管理员可以做的所有事情。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>管理规则，模型，流程，表单和仪表板</p>
</li>
<li>
<p>管理资产存储库</p>
</li>
<li>
<p>可以创建，构建和部署项目</p>
</li>
<li>
<p>可以使用JBDS连接来查看进程</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_analyst"><a class="anchor" href="#_analyst"></a> <a class="link" href="#_analyst">15.4.2.3。分析员</a></h5>
<div class="paragraph">
<p>Analyst是开发人员的较弱版本，无法访问资产存储库或部署项目的能力。</p>
</div>
</div>
<div class="sect4">
<h5 id="_business_user"><a class="anchor" href="#_business_user"></a> <a class="link" href="#_business_user">15.4.2.4。业务用户</a></h5>
<div class="paragraph">
<p>系统的日常用户，对流程继续进行所需的业务任务执行操作。主要与任务列表一起使用。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>是否进行流程管理</p>
</li>
<li>
<p>处理任务和仪表板</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_managerviewer_only_user"><a class="anchor" href="#_managerviewer_only_user"></a> <a class="link" href="#_managerviewer_only_user">15.4.2.5。仅限管理员/查看者的用户</a></h5>
<div class="paragraph">
<p>对系统感兴趣的系统查看者，对有关业务流程及其性能，业务指标以及系统的其他报告以及与系统进行交互的人员的统计信息感兴趣。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>仅有权访问仪表板</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.introduction"><a class="anchor" href="#_wb.introduction"></a> <a class="link" href="#_wb.introduction">15.5。介绍</a></h3>
<div class="sect3">
<h4 id="_wb.loginandlogout"><a class="anchor" href="#_wb.loginandlogout"></a> <a class="link" href="#_wb.loginandlogout">15.5.1。登录并注销</a></h4>
<div class="paragraph">
<p>创建一个具有角色的用户<code>admin</code>并使用这些凭据登录。</p>
</div>
<div class="paragraph">
<p>成功登录后，帐户用户名显示在右上角。单击它以查看当前帐户的角色。</p>
</div>
</div>
<div class="sect3">
<h4 id="_wb.homescreen"><a class="anchor" href="#_wb.homescreen"></a> <a class="link" href="#_wb.homescreen">15.5.2。主屏幕</a></h4>
<div class="paragraph">
<p>登录后，显示主屏幕。主屏幕的实际内容取决于Business Central变体（Drools，jBPM等）。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/General/home.png" alt="家">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.administrationoverview"><a class="anchor" href="#_wb.administrationoverview"></a> <a class="link" href="#_wb.administrationoverview">15.5.3。商务中心概述</a></h4>
<div class="paragraph">
<p>商业中心由空间和项目构成：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/General/workbenchStructureOverview.png" alt="workbenchStructureOverview">
</div>
</div>
<div class="sect4">
<h5 id="_wb.space"><a class="anchor" href="#_wb.space"></a> <a class="link" href="#_wb.space">15.5.3.1。空间</a></h5>
<div class="paragraph">
<p>这些空间对于模拟部门和部门很有用。</p>
</div>
<div class="paragraph">
<p>一个空间可以容纳多个项目。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/General/Space.png" alt="空间">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.project"><a class="anchor" href="#_wb.project"></a> <a class="link" href="#_wb.project">15.5.3.2。项目</a></h5>
<div class="paragraph">
<p>项目是存储资产的地方，每个项目都属于一个空间。</p>
</div>
<div class="paragraph">
<p>项目实际上是基于虚拟文件系统的存储，默认情况下使用GIT作为后端。通过这种设置，Business Central可以与多个后端一起使用，同时可以充分利用后端特定功能，例如在GIT案例版本控制，分支甚至外部访问中。</p>
</div>
<div class="paragraph">
<p>可以从头开始创建新项目，也可以从现有存储库中克隆新项目。</p>
</div>
<div class="paragraph">
<p>使用GIT作为后端的最大优势之一是能够从外部克隆存储库，并使用首选工具来编辑和构建资产。</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>切勿</strong>直接从<a href="#_wb.systemproperties">.niogit</a>目录克隆您的存储库。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.workbenchconcepts"><a class="anchor" href="#_wb.workbenchconcepts"></a> <a class="link" href="#_wb.workbenchconcepts">15.5.4。业务中心用户界面概念</a></h4>
<div class="paragraph">
<p>Business Central由不同的逻辑实体组成：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>部分</p>
<div class="paragraph">
<p>部件是用户可以与之交互以执行操作的屏幕或编辑器。</p>
</div>
<div class="paragraph">
<p>示例部件为“项目资源管理器”，“项目编辑器”，“指导规则编辑器”等。</p>
</div>
</li>
<li>
<p>页</p>
<div class="paragraph">
<p>透视图是相关面板和零件的逻辑分组。透视图通常被称为<em>page</em> ，因为它是最终用户更熟悉的术语，而透视图则更面向开发人员。但是请注意，Business Central支持开发人员创建的页面和最终用户通过页面构建器（又称为“内容管理”）工具创建的页面，但通常来说， <em>页面</em>用于同时引用两者。</p>
</div>
<div class="paragraph">
<p>用户可以通过单击顶级菜单项之一来在页面之间切换。例如“首页”，“创作”，“部署”等。</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.changinglayout"><a class="anchor" href="#_wb.changinglayout"></a> <a class="link" href="#_wb.changinglayout">15.6。改变布局</a></h3>
<div class="sect3">
<h4 id="_wb.resizing"><a class="anchor" href="#_wb.resizing"></a> <a class="link" href="#_wb.resizing">15.6.1。调整大小</a></h4>
<div class="paragraph">
<p>将鼠标指针移到面板拆分器上（面板之间的灰色水平或垂直线）。</p>
</div>
<div class="paragraph">
<p>光标将通过更改指示其已正确放置在拆分器上。按住鼠标左键并将分离器拖动到所需位置；然后释放鼠标左键。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.authoring"><a class="anchor" href="#_wb.authoring"></a> <a class="link" href="#_wb.authoring">15.7。创作（一般）</a></h3>
<div class="sect3">
<h4 id="_wb.artifactrepository"><a class="anchor" href="#_wb.artifactrepository"></a> <a class="link" href="#_wb.artifactrepository">15.7.1。工件存储库</a></h4>
<div class="paragraph">
<p>项目通常在类路径中需要外部构件以进行构建，例如域模型JAR。工件存储库保存了这些工件。</p>
</div>
<div class="paragraph">
<p>Artifact资料库是功能齐全的Maven资料库。它遵循Maven远程存储库的语义：所有快照都带有时间戳。但是它通常存储在本地硬盘上。</p>
</div>
<div class="paragraph">
<p>默认情况下，工件存储库存储在<code>$WORKING_DIRECTORY/repositories/kie</code> ，但是可以使用<a href="#_wb.systemproperties">system属性</a>覆盖它<code>-Dorg.guvnor.m2repo.dir</code> 。每个安装只有1个Maven存储库。</p>
</div>
<div class="paragraph">
<p>Artifact存储库屏幕显示了Maven存储库中的工件列表：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/ArtifactRepository/mavenRepositoryExplorer.png" alt="mavenRepositoryExplorer">
</div>
</div>
<div class="paragraph">
<p>要将新工件添加到该Maven存储库，请执行以下任一操作：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用上传按钮，然后选择一个JAR。如果JAR在以下位置包含POM文件<code>META-INF/maven</code> （Maven的每个JAR构建都具有），不需要进一步的信息。否则，也需要给出groupId，artifactId和版本。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/ArtifactRepository/mavenRepositoryUpload.png" alt="mavenRepositoryUpload">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>使用Maven， <code>mvn deploy</code>到那个Maven仓库。刷新列表以使其显示。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>该远程Maven存储库相对简单。它不支持Nexus，Archiva等代理，镜像。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_wb.asseteditor"><a class="anchor" href="#_wb.asseteditor"></a> <a class="link" href="#_wb.asseteditor">15.7.2。资产编辑器</a></h4>
<div class="paragraph">
<p>资产编辑器是Business Central用户界面的主要组件。它由两个主要视图“编辑器”和“概述”组成。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>观点</p>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/AssetEditor/AssetEditor-edit.png" alt="AssetEditor编辑">
</div>
<div class="title">图154。资产编辑器-“编辑器”标签</div>
</div>
<div class="ulist">
<ul>
<li>
<p>答：编辑区域-编辑器采用哪种格式取决于资产类型。一次只能由一位用户编辑资产，以避免冲突。当用户开始编辑资产时，将自动获取锁。这由资产标题栏以及项目浏览器视图中出现的锁定符号指示（有关详细信息，请参阅<a href="#_wb.projectexplorer">Project Explorer</a> ）。如果用户开始编辑已经锁定的资产，则会显示一个弹出通知，通知用户该资产当前无法编辑，因为该资产正在由另一个用户使用。在编辑用户保存或关闭资产或注销Business Central之前，将无法进行更改。会话超时也将导致锁被释放。如果需要，每个用户还可以选择强制释放锁定（请参阅下面的“元数据”部分）。</p>
</li>
<li>
<p>B：此菜单栏包含资产的各种操作；例如保存，重命名，复制等。请注意，如果资产由其他用户锁定，则保存，重命名和删除操作将被停用。</p>
</li>
<li>
<p>C：资产内容或资产信息的不同视图。</p>
<div class="ulist">
<ul>
<li>
<p>编辑器显示资产的主要编辑器</p>
</li>
<li>
<p>概述包含此编辑器的元数据和对话视图。在下面更详细地解释。</p>
</li>
<li>
<p>来源以纯DRL显示资产。注意：仅当可以将资产内容生成到DRL中时，此选项卡才可见。</p>
</li>
<li>
<p>数据对象包含可用于创作的模型。默认情况下，仅与资产位于同一包中的数据对象可用于创作。可以导入此包外部的数据对象以使其可用于创作资产。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/AssetEditor/AssetEditor-dataobjects.png" alt="AssetEditor数据对象">
</div>
<div class="title">图155。资产编辑器-数据对象选项卡</div>
</div>
</li>
<li>
<p>总览</p>
<div class="ulist">
<ul>
<li>
<p>答：有关资产及其描述的一般信息。</p>
<div class="paragraph">
<p>“类型：”资产类型的格式名称。</p>
</div>
<div class="paragraph">
<p>“描述：”资产描述。</p>
</div>
<div class="paragraph">
<p>“在项目中使用：”为使用此规则的项目命名。</p>
</div>
<div class="paragraph">
<p>“上次修改时间：”谁进行了最后一次更改以及何时进行。</p>
</div>
<div class="paragraph">
<p>“创建日期：”创建资产的人和时间。</p>
</div>
</li>
<li>
<p>B：资产的版本历史。选择一个版本会将所选版本加载到该编辑器中。</p>
</li>
<li>
<p>C：元数据（来自“ Dublin Core”标准）</p>
</li>
<li>
<p>D：可以在此处记录有关资产开发的评论。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/AssetEditor/Overview.png" alt="总览">
</div>
<div class="title">图156。资产编辑器-概述标签</div>
</div>
<div class="ulist">
<ul>
<li>
<p>元数据</p>
<div class="ulist">
<ul>
<li>
<p>答：元数据：</p>
<div class="paragraph">
<p>“标签：”用于对资产进行分组的标签系统。</p>
</div>
<div class="paragraph">
<p>“注意：”资产上次更新时发表的评论（即为什么进行更改）</p>
</div>
<div class="paragraph">
<p>“ URI：” Git存储库中资产的URI。</p>
</div>
<div class="paragraph">
<p>“主题/类型/外部链接/来源”：资产的其他各种元数据。</p>
</div>
<div class="paragraph">
<p>“锁定状态”：显示资产的锁定状态，如果锁定，则允许强制解锁资产。</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/AssetEditor/Metadata.png" alt="元数据">
</div>
<div class="title">图157。元数据标签</div>
</div>
<div class="ulist">
<ul>
<li>
<p>锁定</p>
<div class="paragraph">
<p>Business Central支持悲观的资产锁定。当一个用户开始编辑资产时，其他用户将锁定该资产以进行更改。该锁定将一直保持到一段时间不活动，关闭编辑器或应用程序停止并重新启动为止。也可以在“概述”选项卡的“元数据”部分上强制删除锁。</p>
</div>
<div class="paragraph">
<p>当资产被锁定时，“挂锁”图标显示在编辑器的标题栏中以及项目浏览器中资产的旁边。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/AssetEditor/AssetEditor-locked.png" alt="AssetEditor已锁定">
</div>
<div class="title">图158。资产编辑器-锁定资产不能由其他用户编辑</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_wb.tagseditor"><a class="anchor" href="#_wb.tagseditor"></a> <a class="link" href="#_wb.tagseditor">15.7.3。标签编辑器</a></h4>
<div class="paragraph">
<p>标签允许使用您定义的任意数量的标签来标记资产。这些标签可用于在项目浏览器上过滤资产，以启用“标签过滤”。</p>
</div>
<div class="sect4">
<h5 id="_wb.managingtags"><a class="anchor" href="#_wb.managingtags"></a> <a class="link" href="#_wb.managingtags">15.7.3.1。创建标签</a></h5>
<div class="paragraph">
<p>要创建标签，您只需将其写在“标签”输入上，然后按“添加新标签”按钮。标记编辑器允许一一创建标记，也可以编写多个标记，并用空格隔开。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/TagsEditor/CreatingTags.png" alt="创建标签">
</div>
<div class="title">图159。创建标签</div>
</div>
<div class="paragraph">
<p>创建新标签后，它们将出现在编辑器上，允许您通过按需删除它们来将其删除。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/TagsEditor/ExistingTags.png" alt="现有标签">
</div>
<div class="title">图160。现有标签</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.projectexplorer"><a class="anchor" href="#_wb.projectexplorer"></a> <a class="link" href="#_wb.projectexplorer">15.7.4。项目浏览器</a></h4>
<div class="paragraph">
<p>Project Explorer提供了浏览当前Project中文件的功能。打开资源编辑器后，可以从左侧访问Project Explorer。</p>
</div>
<div class="sect4">
<h5 id="_wb.projectexplorerempty"><a class="anchor" href="#_wb.projectexplorerempty"></a> <a class="link" href="#_wb.projectexplorerempty">15.7.4.1。初步观点</a></h5>
<div class="paragraph">
<p>如果当前正在由另一个用户编辑文件，则文件名前将显示一个锁定符号。如果锁由当前经过身份验证的用户拥有，则该符号为蓝色，否则为黑色。将鼠标指针移到锁符号上将显示一个工具提示，其中提供了当前正在编辑文件（因此拥有锁）的用户的名称。要了解有关锁定的更多信息，请参见<a href="#_wb.asseteditor">Asset Editor</a> 。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Project-Expanded.png" alt="ProjectExplorer项目扩展">
</div>
<div class="title">图161。扩大资产组</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.projectexplorerswitchingview"><a class="anchor" href="#_wb.projectexplorerswitchingview"></a> <a class="link" href="#_wb.projectexplorerswitchingview">15.7.4.2。不同的看法</a></h5>
<div class="paragraph">
<p>Project Explorer支持多个视图。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>专案检视</p>
<div class="paragraph">
<p>基础项目结构的简化视图。某些系统文件从视图中隐藏。</p>
</div>
</li>
<li>
<p>仓库视图</p>
<div class="paragraph">
<p>底层项目结构的完整视图，包括所有文件；用户定义的或系统生成的。</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>可以通过单击Project Explorer中的图标来选择视图，如下所示。</p>
</div>
<div class="paragraph">
<p>通过选择“显示为文件夹”或“显示为链接”，可以进一步完善项目视图和存储库视图。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Switching-View.png" alt="ProjectExplorer切换视图">
</div>
<div class="title">图162。切换检视</div>
</div>
<div class="sect5">
<h6 id="_wb.projectexplorertechnicalview"><a class="anchor" href="#_wb.projectexplorertechnicalview"></a> <a class="link" href="#_wb.projectexplorertechnicalview">存储库查看示例</a></h6>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Repository-Folders.png" alt="ProjectExplorer存储库文件夹">
</div>
<div class="title">图163。储存库视图-文件夹</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Repository-Links.png" alt="ProjectExplorer存储库链接">
</div>
<div class="title">图164。存储库视图-链接</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.projectexplorerdownloads"><a class="anchor" href="#_wb.projectexplorerdownloads"></a> <a class="link" href="#_wb.projectexplorerdownloads">15.7.4.3。下载项目或资源库</a></h5>
<div class="paragraph">
<p>下载下载和下载存储库使得可以将项目或存储库下载为zip文件。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Downloads.png" alt="ProjectExplorer下载">
</div>
<div class="title">图165。资料库和项目下载</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.projectexplorerfilteringbytag"><a class="anchor" href="#_wb.projectexplorerfilteringbytag"></a> <a class="link" href="#_wb.projectexplorerfilteringbytag">15.7.4.4。按标签过滤</a></h5>
<div class="paragraph">
<p>要轻松查看包含大量资产的程序包中的元素，可以启用“标记”过滤器，从而允许您通过资产的标记来过滤资产。</p>
</div>
<div class="paragraph">
<p>要查看如何向资产添加标签，请查看： <a href="#_wb.tagseditor">标签编辑器</a></p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Tag-Filter-Enable.png" alt="ProjectExplorer标记过滤器启用">
</div>
<div class="title">图166。启用标签过滤</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Tag-Filter-Show.png" alt="ProjectExplorer标签过滤器显示">
</div>
<div class="title">图167。按标签过滤</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Tag-Filter-Working.png" alt="ProjectExplorer标记过滤器的工作">
</div>
<div class="title">图168。按标签过滤</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.projectexplorercopyrenamedeleteactions"><a class="anchor" href="#_wb.projectexplorercopyrenamedeleteactions"></a> <a class="link" href="#_wb.projectexplorercopyrenamedeleteactions">15.7.4.5。复制，重命名，删除和下载操作</a></h5>
<div class="paragraph">
<p>复制，重命名和删除操作可在“链接”模式下使用，适用于Project View中的程序包以及Repository View中的文件和目录。下载操作可用于目录。下载选项将所选的选定目录下载为zip文件。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>复印件</p>
</li>
<li>
<p>B：重命名</p>
</li>
<li>
<p>C：删除</p>
</li>
<li>
<p>D：下载</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Project-Links-Copy-Rename-Delete.png" alt="ProjectExplorer项目链接复制重命名删除">
</div>
<div class="title">图169。项目视图-打包操作</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Business Central路线图包括重构和影响分析工具，但是目前还没有。在提供这两种工具之前，请确保对包，文件或目录的更改（复制/重命名/删除）对您的项目没有重大影响。</p>
</div>
<div class="paragraph">
<p>如果您的更改产生了意想不到的影响，则可以使用Business Central使用<a href="#_wb.vfsrepositoryeditor">存储库编辑器</a>还原存储<a href="#_wb.vfsrepositoryeditor">库</a> 。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在释放相应的锁之前，不能重命名或删除由其他用户锁定的文件以及包含此类文件的目录。在这种情况下，重命名和删除符号将被禁用。要了解有关锁定的更多信息，请参见<a href="#_wb.asseteditor">Asset Editor</a> 。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/ProjectExplorer/ProjectExplorer-Delete-NotAllowed.png" alt="不允许删除ProjectExplorer">
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.projecteditor"><a class="anchor" href="#_wb.projecteditor"></a> <a class="link" href="#_wb.projecteditor">15.7.5。项目编辑</a></h4>
<div class="paragraph">
<p>可以从Project Explorer访问Project Editor屏幕。项目编辑器显示当前活动项目的设置。</p>
</div>
<div class="paragraph">
<p>与大多数Business Central编辑器不同，项目编辑器可以编辑多个文件。在一处显示配置KIE项目所需的一切。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/ProjectEditor/project_editor_menu.png" alt="项目编辑器菜单">
</div>
<div class="title">图170。项目画面和不同的视图</div>
</div>
<div class="sect4">
<h5 id="_build_deploy"><a class="anchor" href="#_build_deploy"></a> <a class="link" href="#_build_deploy">15.7.5.1。建立与部署</a></h5>
<div class="paragraph">
<p>Build＆Depoy构建当前项目，并将KJAR部署到Business Central内部Maven存储库中。</p>
</div>
</div>
<div class="sect4">
<h5 id="_project_settings"><a class="anchor" href="#_project_settings"></a> <a class="link" href="#_project_settings">15.7.5.2。项目设定</a></h5>
<div class="paragraph">
<p>项目设置可编辑Maven使用的pom.xml文件。</p>
</div>
<div class="sect5">
<h6 id="_project_general_settings"><a class="anchor" href="#_project_general_settings"></a> <a class="link" href="#_project_general_settings">项目常规设置</a></h6>
<div class="paragraph">
<p>常规设置提供了用于项目名称和GAV数据（组，工件，版本）的工具。GAV值用作标识符以区分项目和同一项目的版本。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/ProjectEditor/general_settings.png" alt="通用设置">
</div>
<div class="title">图171。项目设定</div>
</div>
</div>
<div class="sect5">
<h6 id="_dependencies"><a class="anchor" href="#_dependencies"></a> <a class="link" href="#_dependencies">依存关系</a></h6>
<div class="paragraph">
<p>该项目可以具有任意数量的内部或外部依赖项。依赖关系是一个已构建并部署到Maven存储库的项目。内部依赖项是与项目在同一Business Central中构建和部署的项目。从当前Business Central之外的存储库中检索外部依赖项。每个依赖项使用GAV值来指定项目使用的项目名称和版本。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/ProjectEditor/dependencies.png" alt="依存关系">
</div>
<div class="title">图172。依存关系</div>
</div>
<div class="sect6">
<h7 id="_package_name_white_list"><a class="anchor" href="#_package_name_white_list"></a> <a class="link" href="#_package_name_white_list">包装名称白名单</a></h7>
<div class="paragraph">
<p>白名单包中的类和声明的类型显示为可导入资产中的数据对象。完整列表存储在每个项目根目录中存储的package-name-white-list文件中。</p>
</div>
<div class="paragraph">
<p>软件包白名单有三种模式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>包括的所有软件包：此jar中定义的每个软件包都列出了白色。</p>
</li>
<li>
<p>不包含的软件包：此jar中列出的所有软件包均未列入白名单。</p>
</li>
<li>
<p>其中包括一些软件包：jar中仅部分软件包列出了白色。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_metadata"><a class="anchor" href="#_metadata"></a> <a class="link" href="#_metadata">元数据</a></h6>
<div class="paragraph">
<p>pom.xml文件的元数据。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kie_base_settings"><a class="anchor" href="#_kie_base_settings"></a> <a class="link" href="#_kie_base_settings">15.7.5.3。KIE基本设置</a></h5>
<div class="paragraph">
<p>KIE基本设置可编辑Drools使用的kmodule.xml文件。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/ProjectEditor/kmodule.png" alt="模组">
</div>
<div class="title">图173。KIE基本设置</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>有关KIE基本属性的更多信息，请参阅Drools Expert文档中的kmodule.xml。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect5">
<h6 id="_kie_bases_and_sessions"><a class="anchor" href="#_kie_bases_and_sessions"></a> <a class="link" href="#_kie_bases_and_sessions">KIE基础和课程</a></h6>
<div class="paragraph">
<p>KIE基础和会话列出了为项目指定的KIE基础和KIE会话。</p>
</div>
<div class="sect6">
<h7 id="_kie_base_list"><a class="anchor" href="#_kie_base_list"></a> <a class="link" href="#_kie_base_list">KIE基本清单</a></h7>
<div class="paragraph">
<p>按名称列出所有KIE基础。默认只能设置一个KIE基础。</p>
</div>
</div>
<div class="sect6">
<h7 id="_kie_base_properties"><a class="anchor" href="#_kie_base_properties"></a> <a class="link" href="#_kie_base_properties">KIE基本属性</a></h7>
<div class="paragraph">
<p>KIE基础可以包括其他KIE基础。包含的KIE库中的模型，规则和任何其他内容将对当前选择的KIE库可见并可用。</p>
</div>
<div class="paragraph">
<p>规则和模型存储在包中。packages属性指定此KIE基础中包含哪些软件包。</p>
</div>
<div class="paragraph">
<p>文档的Drools Expert部分中说明了均等行为。</p>
</div>
<div class="paragraph">
<p>事件处理模式在文档的Drools Fusion部分中进行了说明。</p>
</div>
</div>
<div class="sect6">
<h7 id="_kie_sessions"><a class="anchor" href="#_kie_sessions"></a> <a class="link" href="#_kie_sessions">KIE会议</a></h7>
<div class="paragraph">
<p>该表列出了所选KIE库中的所有KIE会话。每种类型只能有一个默认值。类型是无状态的和有状态的。单击笔形图标将打开一个弹出窗口，该弹出窗口显示KIE会话的更多属性。</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_metadata_2"><a class="anchor" href="#_metadata_2"></a> <a class="link" href="#_metadata_2">元数据</a></h6>
<div class="paragraph">
<p>kmodule.xml的元数据</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_imports"><a class="anchor" href="#_imports"></a> <a class="link" href="#_imports">15.7.5.4。进口货</a></h5>
<div class="paragraph">
<p>设置编辑<code>project.imports</code> Business Central编辑器使用的文件。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/ProjectEditor/ExternalDataObjects.png" alt="外部数据对象">
</div>
<div class="title">图174。进口货</div>
</div>
<div class="sect5">
<h6 id="_external_data_objects"><a class="anchor" href="#_external_data_objects"></a> <a class="link" href="#_external_data_objects">外部数据对象</a></h6>
<div class="paragraph">
<p>Java Runtime环境提供的数据对象可能需要注册才能用于规则创作，在这种情况下，此类数据对象不是作为Business Central或Project依赖项中定义的现有数据对象的一部分隐式可用的。例如，作者可能想定义一个规则来检查<code>java.util.ArrayList</code>在工作记忆中。如果域数据对象的字段类型为<code>java.util.ArrayList</code>无需创建注册。</p>
</div>
</div>
<div class="sect5">
<h6 id="_metadata_3"><a class="anchor" href="#_metadata_3"></a> <a class="link" href="#_metadata_3">元数据</a></h6>
<div class="paragraph">
<p>project.imports文件的元数据。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_duplicate_gav_detection"><a class="anchor" href="#_duplicate_gav_detection"></a> <a class="link" href="#_duplicate_gav_detection">15.7.5.5。重复GAV检测</a></h5>
<div class="paragraph">
<p>执行以下任何操作时，现在将检查为项目解析的所有Maven存储库，以查看是否存在项目的GroupId，ArtifactId和Version。如果发现冲突，则阻止该操作；尽管用户可以使用<code>admin</code>角色。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>可以通过设置系统属性来禁用该功能<code>org.guvnor.project.gav.check.disabled</code>至<code>true</code> 。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>解析的存储库是在以下位置发现的：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>项目的<code>POM<code></code><repositories></code>部分（或任何父母<code>POM</code> ）。</p>
</li>
<li>
<p>项目的<code>POM<code></code><distributionManagement></code>部分。</p>
</li>
<li>
<p>Maven的全球<code>settings.xml</code>配置文件。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>受影响的操作：-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>创建新的托管存储库。</p>
</li>
<li>
<p>使用项目编辑器保存项目定义。</p>
</li>
<li>
<p>将新模块添加到托管多模块存储库。</p>
</li>
<li>
<p>保存<code>pom.xml</code>文件。</p>
</li>
<li>
<p>使用项目编辑器构建和安装项目。</p>
</li>
<li>
<p>使用项目编辑器构建和部署项目。</p>
</li>
<li>
<p>资产管理部门负责建设，安装或部署项目。</p>
</li>
<li>
<p><code>REST</code>创建，安装或部署项目的操作。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>的用户<code>Admin</code>角色可以覆盖使用项目编辑器中“存储库”设置检查的存储库列表。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/ProjectEditor/validation-menu-item.png" alt="验证菜单项">
</div>
<div class="title">图175。项目编辑器-查看已解决的存储库</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/MavenRepositories2.png" alt="Maven资源库2">
</div>
<div class="title">图176。项目编辑器-解析的存储库列表</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/MavenRepositories3.png" alt="Maven资源库3">
</div>
<div class="title">图177。检测到重复的GAV</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.validation"><a class="anchor" href="#_wb.validation"></a> <a class="link" href="#_wb.validation">15.7.6。验证方式</a></h4>
<div class="paragraph">
<p>Business Central为用户提供了一个通用且一致的服务，以了解在环境中创作的文件是否有效。</p>
</div>
<div class="sect4">
<h5 id="_wb.problemspanel"><a class="anchor" href="#_wb.problemspanel"></a> <a class="link" href="#_wb.problemspanel">15.7.6.1。问题面板</a></h5>
<div class="paragraph">
<p>问题面板显示项目中资产的实时验证结果。</p>
</div>
<div class="paragraph">
<p>从“项目资源管理器”中选择一个项目后，“问题面板”将刷新并显示所选项目的验证结果。</p>
</div>
<div class="paragraph">
<p>在创建，保存或删除文件时，“问题面板”内容将更新以显示新的验证错误，或者在删除文件后删除现有的错误。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/Validation/workbench-problems-panel.png" alt="工作台问题面板">
</div>
<div class="title">图178。问题面板</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.ondemandvalidation"><a class="anchor" href="#_wb.ondemandvalidation"></a> <a class="link" href="#_wb.ondemandvalidation">15.7.6.2。按需验证</a></h5>
<div class="paragraph">
<p>为了确定文件是否处于有效状态，并不总是希望保存文件。</p>
</div>
<div class="paragraph">
<p>所有文件编辑器都可以在保存内容之前对其进行验证。</p>
</div>
<div class="paragraph">
<p>单击“验证”按钮将显示验证错误（如果有）。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/Validation/workbench-validation.png" alt="工作台验证">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.datamodeller"><a class="anchor" href="#_wb.datamodeller"></a> <a class="link" href="#_wb.datamodeller">15.7.7。数据建模师</a></h4>
<div class="sect4">
<h5 id="_sect_datamodeler_firststeps"><a class="anchor" href="#_sect_datamodeler_firststeps"></a> <a class="link" href="#_sect_datamodeler_firststeps">15.7.7.1。创建数据模型的第一步</a></h5>
<div class="paragraph">
<p>默认情况下，数据模型始终受限于项目的上下文。就本教程而言，我们将假定已经存在正确配置的项目，并且打开了创作页面。</p>
</div>
<div class="paragraph">
<p>要在项目内部开始创建数据模型，请执行以下步骤：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>从主页面板中，选择“设计”页面，然后选择给定的项目。</p>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/authoring.jpg" alt="创作">
</div>
<div class="title">图179。转到创作页面并选择一个项目</div>
</div>
</li>
<li>
<p>通过单击数据对象文件或使用“添加资产→数据对象”菜单选项来打开数据建模器工具。将数据对象名称设置为“ PurchaseOrder”，然后单击“确定”。</p>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/open_data_model.jpg" alt="开放数据模型">
</div>
<div class="title">图180。单击数据对象</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>这将启动Data Modeller工具，该工具具有以下一般方面：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/overview.png" alt="概观">
</div>
<div class="title">图181。数据建模器概述</div>
</div>
<div class="paragraph">
<p>“编辑器”选项卡分为以下几部分：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>新字段部分专用于创建新字段，并在按下“添加字段”按钮时打开。</p>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/create-new-field.png" alt="创建新领域">
</div>
<div class="title">图182。新领域的创造</div>
</div>
</li>
<li>
<p>数据对象的“字段浏览器”部分显示带有数据对象字段的列表。</p>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-field-browser.png" alt="数据对象字段浏览器">
</div>
<div class="title">图183。数据对象的字段浏览器</div>
</div>
</li>
<li>
<p>“数据对象/字段的常规属性”部分。这是“数据建模器”编辑器的最右侧部分，根据用户选择，可视化“数据对象”或“字段”常规属性。</p>
<div class="paragraph">
<p>可以通过单击数据对象选择器来选择数据对象的常规属性。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-selector.png" alt="数据对象选择器">
</div>
<div class="title">图184。数据对象选择器</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-general-properties.png" alt="数据对象的常规属性">
</div>
<div class="title">图185。数据对象的常规属性</div>
</div>
<div class="paragraph">
<p>可以通过单击字段来选择字段常规属性。</p>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/field-selector.png" alt="字段选择器">
</div>
<div class="title">图186。字段选择器</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/field-general-properties.png" alt="字段一般属性">
</div>
<div class="title">图187。字段的一般属性</div>
</div>
<div class="ulist">
<ul>
<li>
<p>在Business Central的右侧，提供了一个新的“工具栏”，可以选择不同的上下文相关工具窗口，这些窗口将允许用户执行特定于域的配置。当前为以下域“ Drools＆jBPM”，“ OptaPlanner”，“ Persistence”和“ Advanced”配置提供了四个工具窗口。</p>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/tool-window-selector.png" alt="工具窗口选择器">
</div>
<div class="title">图188。数据建模工具栏</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-drools-tool-window.png" alt="数据对象流口水工具窗口">
</div>
<div class="title">图189。Drools＆jBPM工具窗口</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-optaplanner-tool-window.png" alt="数据对象optaplanner工具窗口">
</div>
<div class="title">图190。OptaPlanner工具窗口</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>要查看和使用OptaPlanner工具窗口，用户需要具有该角色<code>plannermgmt</code> 。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-persistence-tool-window.png" alt="数据对象持久性工具窗口">
</div>
<div class="title">图191。持久性工具窗口</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-or-field-advanced-tool-window.png" alt="数据对象或字段高级工具窗口">
</div>
<div class="title">图192。高级工具窗口</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>“源”选项卡显示一个编辑器，该编辑器允许可视化和修改所生成的Java代码。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>“编辑器”和“源代码”选项卡之间的往返是可能的，并且还提供了源代码保存。这意味着无论在何处生成Java代码（例如Eclipse，数据建模器），数据建模器都将仅更新必要的代码块以维持模型的更新。</p>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/source-editor-tab.png" alt="源代码编辑器选项卡">
</div>
<div class="title">图193。源代码编辑器</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>“概述”选项卡显示标准的元数据和版本信息以及其他工作台编辑器。</p>
</div>
</div>
<div class="sect4">
<h5 id="_sect_datamodeler_entities"><a class="anchor" href="#_sect_datamodeler_entities"></a> <a class="link" href="#_sect_datamodeler_entities">15.7.7.2。数据对象</a></h5>
<div class="paragraph">
<p>数据模型由数据对象组成，这些对象是某些实际数据的逻辑表示。此类数据对象具有一组固定的建模器（或应用程序拥有的）属性，例如其内部标识符，标签，描述，包等。除此之外，数据对象还具有一组可变的用户定义字段，分别是该逻辑数据对象表示的数据类型的真实世界属性的抽象。</p>
</div>
<div class="paragraph">
<p>可以使用Business Central的“新建项目-数据对象”菜单选项来创建数据对象。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/create-new-data-object.png" alt="创建新的数据对象">
</div>
<div class="title">图194。新建数据对象菜单选项</div>
</div>
<div class="paragraph">
<p>资源名称和位置都是必填参数。当按下“确定”按钮时，将创建一个新的Java文件，并为该文件版本打开一个新的编辑器实例。默认情况下，可选的“ Persistable”属性将在数据对象上添加配置，以使其成为JPA实体。如果您的jBPM项目需要在数据库中存储数据对象的信息，请使用此选项。</p>
</div>
</div>
<div class="sect4">
<h5 id="_sect_datamodeler_propertyrelationships"><a class="anchor" href="#_sect_datamodeler_propertyrelationships"></a> <a class="link" href="#_sect_datamodeler_propertyrelationships">15.7.7.3。属性和关系</a></h5>
<div class="paragraph">
<p>创建数据对象后，现在必须通过在其定义中添加用户定义的属性来完成它。这可以通过按下“添加字段”按钮来实现。将打开“新字段”对话框，并可以通过按下“创建”按钮来创建新字段。“创建并继续”按钮也会将新字段添加到数据对象，但不会关闭对话框。这样，可以创建多个字段，避免多次打开弹出窗口。可以（或必须）填写以下字段：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>字段的内部标识符（必填）。该字段的值对于每个数据对象必须是唯一的，即，如果建议的标识符已存在于当前数据对象中，则将显示错误消息。</p>
</li>
<li>
<p>标签（可选）：与数据对象定义一样，用户可以为将要创建的数据对象字段定义用户友好的标签。这对于如何处理该数据对象的对象的字段没有进一步的含义。如果定义了标签，那么这就是在整个数据建模工具中显示字段的方式。</p>
</li>
<li>
<p>字段类型（必填）：每个数据对象字段都需要分配一个类型。</p>
<div class="paragraph">
<p>此类型可以是以下任意一种：</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>“原始Java对象”类型：这些对象包括标准Java基本类型的大多数对象等效项，例如Boolean，Short，Float等，以及String，Date，BigDecimal和BigInteger。</p>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/create-field-with-primitive-type.png" alt="用原始类型创建字段">
</div>
<div class="title">图195。原始对象字段类型</div>
</div>
</li>
<li>
<p>“数据对象”类型：任何用户定义的数据对象都会自动成为要定义为另一个数据对象的字段类型的候选项，从而可以在它们之间创建关系。可以以“单个”或“多个”形式创建数据对象字段，后者表示该字段将被定义为这种类型的集合，这将通过选择“列表”复选框来指示。</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/types_entity.jpg" alt="类型实体">
</div>
<div class="title">图196。数据对象字段类型</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>“原始Java”类型：这些Java基本类型包括byte，short，int，long，float，double，char和boolean。</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/types_primitive.jpg" alt="类型原始">
</div>
<div class="title">图197。原始字段类型</div>
</div>
<div class="paragraph">
<p>完成为新字段引入初始信息后，单击“创建”按钮会将新创建的字段添加到数据对象字段表的末尾，如下所示：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/new-field-was-created.png" alt="新字段已创建">
</div>
<div class="title">图198。新字段已创建</div>
</div>
<div class="paragraph">
<p>新字段也将自动在数据对象的字段列表中选择，其属性将显示在“字段常规属性”编辑器中。另外，字段属性将加载到不同的工具窗口中，这样，无论选择哪个工具窗口，该字段都可以进行编辑。</p>
</div>
<div class="paragraph">
<p>通过单击数据对象的字段表中的相应“ x”图标，可以随时从数据对象定义中删除任何字段（无限制）。</p>
</div>
</div>
<div class="sect4">
<h5 id="_sect_datamodeler_additionaloptions"><a class="anchor" href="#_sect_datamodeler_additionaloptions"></a> <a class="link" href="#_sect_datamodeler_additionaloptions">15.7.7.4。附加选项</a></h5>
<div class="paragraph">
<p>如前所述，数据对象和字段都需要在创建时设置其一些初始属性。此外，可以为给定的数据对象配置三个属性域。域基本上是与给定业务领域相关的一组属性。当前可用的域是“ Drools＆jBPM”，“ Persistence”和“ Advanced”域。要在给定域上工作，用户应在右侧工具栏上选择相应的“工具窗口”（见下文）。每个工具窗口通常都提供两个编辑器，即“数据对象”级别的编辑器和“字段”级别的编辑器，它们将根据最后选择的项目，数据对象或字段来显示。</p>
</div>
<div class="sect5">
<h6 id="_drools_jbpm_domain"><a class="anchor" href="#_drools_jbpm_domain"></a> <a class="link" href="#_drools_jbpm_domain">Drools和jBPM域</a></h6>
<div class="paragraph">
<p>Drools＆jBPM域编辑器管理与Drools应用程序相关的数据对象或字段属性集。</p>
</div>
<div class="sect6">
<h7 id="_drools_jbpm_object_editor"><a class="anchor" href="#_drools_jbpm_object_editor"></a> <a class="link" href="#_drools_jbpm_object_editor">Drools和jBPM对象编辑器</a></h7>
<div class="paragraph">
<p>Drools＆jBPM对象编辑器管理对象级别的Drools属性</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-drools-tool-window.png" alt="数据对象流口水工具窗口">
</div>
<div class="title">图199。数据对象的属性</div>
</div>
<div class="ulist">
<ul>
<li>
<p>TypeSafe：此属性允许启用/禁用当前类型的类型安全行为。默认情况下，所有类型声明都是在启用类型安全的情况下编译的。（有关此问题的更多信息，请参见Drools）。</p>
</li>
<li>
<p>ClassReactive：此属性允许将该类型标记为Drools引擎将其视为“ Class Reactive”。（有关此问题的更多信息，请参见Drools）。</p>
</li>
<li>
<p>PropertyReactive：此属性允许将这种类型标记为Drools引擎将其视为“ Property Reactive”。（有关此问题的更多信息，请参见Drools）。</p>
</li>
<li>
<p>角色：此属性允许配置Drools引擎应如何处理这种类型的实例：作为常规事实还是作为事件。默认情况下，所有类型都作为常规事实处理，因此，目前唯一可以设置的值是“事件”，以声明应将此类型作为事件处理。（有关此问题的更多信息，请参见Drools Fusion）。</p>
</li>
<li>
<p>时间戳：此属性允许通过选择事件的属性之一来配置事件的“时间戳”。如果设置，Drools引擎将使用给定属性中的时间戳，而不是从会话时钟中读取时间戳。否则，Drools引擎将自动为事件分配时间戳。（有关此问题的更多信息，请参见Drools Fusion）。</p>
</li>
<li>
<p>持续时间：此属性允许通过选择事件的属性之一来配置事件的“持续时间”。如果设置，Drools引擎将使用给定属性中的持续时间，而不是使用默认事件持续时间= 0。（有关此问题的更多信息，请参见Drools Fusion）。</p>
</li>
<li>
<p>过期：此属性允许为事件过期配置“时间偏移”。如果设置，则此值必须是以下格式的时间间隔：[ <mark> d] [＃h] [＃m] [＃s] [ </mark> [ms]]其中[]表示可选参数，而＃表示数值。例如：1d2h，表示一天零两个小时。（有关此问题的更多信息，请参见Drools Fusion）。</p>
</li>
<li>
<p>可远程的：如果选中此属性，则数据对象可用于与REST，JMS和WS等jBPM远程服务一起使用。 （有关此问题的更多信息，请参见jBPM。</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="_drools_jbpm_field_editor"><a class="anchor" href="#_drools_jbpm_field_editor"></a> <a class="link" href="#_drools_jbpm_field_editor">Drools＆jBPM现场编辑器</a></h7>
<div class="paragraph">
<p>Drools＆jBPM对象编辑器管理字段级别的Drools属性</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/field-drools-tool-window.png" alt="野外流口水工具窗口">
</div>
<div class="title">图200。数据对象的字段属性</div>
</div>
<div class="ulist">
<ul>
<li>
<p>相等：检查此属性的“数据对象”字段意味着在代码生成级别考虑在生成的Java类中同时创建equals（）和hashCode（）方法时将其考虑在内。我们将在下一节中对此进行更详细的说明。</p>
</li>
<li>
<p>位置：此字段需要零或正整数。设置后，该字段将被Drools引擎解释为位置参数（有关此主题的更多信息，请参见以下部分以及Drools文档）。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_persistence_domain"><a class="anchor" href="#_persistence_domain"></a> <a class="link" href="#_persistence_domain">持久域</a></h6>
<div class="paragraph">
<p>持久性域编辑器管理与持久性相关的数据对象或字段属性集。</p>
</div>
<div class="sect6">
<h7 id="_persistence_domain_object_editor"><a class="anchor" href="#_persistence_domain_object_editor"></a> <a class="link" href="#_persistence_domain_object_editor">持久域对象编辑器</a></h7>
<div class="paragraph">
<p>持久性域对象编辑器管理对象级别的持久性属性</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-persistence-tool-window.png" alt="数据对象持久性工具窗口">
</div>
<div class="title">图201。数据对象的属性</div>
</div>
<div class="ulist">
<ul>
<li>
<p>持久的：此属性允许将当前数据对象配置为可持久。</p>
</li>
<li>
<p>表名：此属性允许为当前数据对象设置用户定义的数据库表名。</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="_persistence_domain_field_editor"><a class="anchor" href="#_persistence_domain_field_editor"></a> <a class="link" href="#_persistence_domain_field_editor">持久性域字段编辑器</a></h7>
<div class="paragraph">
<p>持久性域字段编辑器管理字段级别的持久性属性，并分为三个部分。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/field-persistence-tool-window-sections.png" alt="字段持久性工具窗口部分">
</div>
<div class="title">图202。持久性域字段编辑器部分</div>
</div>
<div class="sect7">
<h8 id="_identifier"><a class="anchor" href="#_identifier"></a> <a class="link" href="#_identifier">识别码：</a></h8>
<div class="paragraph">
<p>一个可持久的数据对象应该只有一个字段定义为数据对象标识符。标识符通常是一个唯一数字，用于将给定的数据对象实例与同一类的所有其他实例区分开。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>是标识符：将当前字段标记为数据对象标识符。一个可持久的数据对象应该只有一个字段标记为标识符，并且它应该是基本的Java类型，例如String，Integer，Long等。引用数据对象的字段或者是多个字段不能被标记作为标识符。而且此版本不支持复合标识符。创建持久性数据对象时，默认情况下会使用正确的初始化创建一个标识符字段，强烈建议使用此标识符。</p>
</li>
<li>
<p>生成策略：生成策略确定在创建数据对象实例并将其存储在数据库中时如何自动生成标识符值。 （例如，通过与jBPM相关的表单来处理人工任务。）在默认情况下创建标识符字段时，也会自动设置生成策略，强烈建议使用此配置。</p>
</li>
<li>
<p>序列生成器：生成器代表将由“生成策略”使用的值的种子。默认情况下，创建标识符字段后，序列生成器也会自动生成并正确配置，以供生成策略使用。</p>
</li>
</ul>
</div>
</div>
<div class="sect7">
<h8 id="_column_properties"><a class="anchor" href="#_column_properties"></a> <a class="link" href="#_column_properties">列属性：</a></h8>
<div class="paragraph">
<p>列属性部分允许自定义将存储字段值的数据库列的某些属性。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>列名：可选值，用于设置给定字段的数据库列名。</p>
</li>
<li>
<p>唯一：选中后，唯一属性会确定当前字段值在存储在数据库中时应该是唯一键。 （如果未设置，则默认值为false）</p>
</li>
<li>
<p>可为空：如果选中，则表明当存储在数据库中时，当前字段值可以为空。 （如果未设置，则默认值为true）</p>
</li>
<li>
<p>可插入的：选中后，将确定该列将包含在持久性提供程序生成的SQL INSERT语句中。 （如果未设置，则默认值为true）</p>
</li>
<li>
<p>可更新：选中后，将确定该列将包含在持久性提供程序生成的SQL UPDATE语句中。 （如果未设置，则默认值为true）</p>
</li>
</ul>
</div>
</div>
<div class="sect7">
<h8 id="_relationship_properties"><a class="anchor" href="#_relationship_properties"></a> <a class="link" href="#_relationship_properties">关系属性：</a></h8>
<div class="paragraph">
<p>当字段的类型是数据对象类型或数据对象类型的列表时，应设置一个关系类型，以使持久性提供程序可以管理该关系。幸运的是，当将这种类型的字段添加到已经标记为可持久性的数据对象时，将自动设置此关系类型。关系类型由以下弹出窗口设置。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/field-persistence-tool-window-sections-relationship-dialog.png" alt="字段持久性工具窗口部分关系对话框">
</div>
<div class="title">图203。关系配置弹出</div>
</div>
<div class="ulist">
<ul>
<li>
<p>关系类型：从以下选项之一设置关系的类型：</p>
<div class="paragraph">
<p>一对一：通常用于1：1关系，其中“ A与B的一个实例相关”，并且B仅在A存在时才存在。例如PurchaseOrder→PurchaseOrderHeader（仅当PurchaseOrder存在时，PurchaseOrderHeader存在）</p>
</div>
<div class="paragraph">
<p>一对多：通常用于1：N关系，其中“ A与B的N个实例相关”，并且B的相关实例仅在A存在时存在。例如，PurchaseOrder→PurchaseOrderLine（仅当PurchaseOrder存在时，PurchaseOrderLine存在）</p>
</div>
<div class="paragraph">
<p>多对一：通常用于1：1关系，其中“ A与B的一个实例有关”，并且即使没有A也可以存在B。例如PurchaseOrder→Client（即使没有关联的PurchaseOrder，客户也可以存在于数据库中）</p>
</div>
<div class="paragraph">
<p>多对多：通常用于N：N关系，其中“ A可以与B的N个实例相关，并且B可以同时与A的M个实例相关”，并且B和A实例都可以存在于数据库中独立于相关实例。例如，课程→学生。（课程可以与N名学生相关，并且指定的学生可以参加M门课程）</p>
</div>
<div class="paragraph">
<p>将类型为“数据对象”的字段添加到给定的可持久数据对象时，默认情况下会生成“多对一”关系类型。</p>
</div>
<div class="paragraph">
<p>并且，将类型为“数据对象列表”的字段添加到给定的持久性数据对象时，默认情况下会生成“一对多”关系。</p>
</div>
</li>
<li>
<p>级联模式：定义一组可级联的操作，这些操作将传播到关联的实体。值层叠=全部等于层叠= {PERSIST，合并，删除，刷新}。例如，当A→B且设置了级联“ PERSIST或ALL”时，如果保存了A，则也将保存B。</p>
<div class="paragraph">
<p>数据建模者默认创建的级联模式为“ ALL”，强烈建议在jBPM流程和表单使用数据对象时使用此模式。</p>
</div>
</li>
<li>
<p>提取模式：定义在读取时如何从数据库中提取相关数据。</p>
<div class="paragraph">
<p>EAGER：相关数据将同时读取。例如，如果A→B，则从数据库B读取A时将同时读取。</p>
</div>
<div class="paragraph">
<p>懒惰：相关数据的读取通常会延迟到需要它们的那一刻。例如，如果PurchaseOrder→PurchaseOrderLine，则将推迟行的读取，直到在PurchaseOrder实例上调用方法“ getLines（）”为止。</p>
</div>
<div class="paragraph">
<p>数据建模者创建的默认获取模式是“ EAGER”，强烈建议在jBPM流程和表单使用数据对象时使用此模式。</p>
</div>
</li>
<li>
<p>可选：确定关系的右侧成员是否可以为null。</p>
</li>
<li>
<p>映射人：用于反向关系。</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_advanced_domain"><a class="anchor" href="#_advanced_domain"></a> <a class="link" href="#_advanced_domain">进阶网域</a></h6>
<div class="paragraph">
<p>通过高级域，可以配置其他域设置的任何参数以及添加任意参数。如代码生成部分所示，每个“数据对象/字段”参数都由一个Java注释表示。高级模式启用此注释的配置。</p>
</div>
<div class="sect6">
<h7 id="_advanced_domain_data_object_field_editor"><a class="anchor" href="#_advanced_domain_data_object_field_editor"></a> <a class="link" href="#_advanced_domain_data_object_field_editor">高级域数据对象/字段编辑器。</a></h7>
<div class="paragraph">
<p>高级域编辑器的数据对象和字段具有相同的形状。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/data-object-or-field-advanced-tool-window.png" alt="数据对象或字段高级工具窗口">
</div>
<div class="title">图204。高级域编辑器。</div>
</div>
<div class="paragraph">
<p>可以进行以下操作</p>
</div>
<div class="ulist">
<ul>
<li>
<p>delete：删除指定的数据对象或字段注释。</p>
</li>
<li>
<p>clear：清除给定的注释参数值。</p>
</li>
<li>
<p>编辑：启用给定注释参数值的版本。</p>
</li>
<li>
<p>添加注释：添加注释按钮将启动一个向导，该向导将允许添加项目依赖项中可用的所有Java注释。</p>
<div class="paragraph">
<p>添加注释向导步骤1：向导的第一步要求输入注释的完全合格的类名称，然后通过按“搜索”按钮，注释定义将被加载到向导中。此外，在加载注释定义时，将创建不同的向导步骤，以使不同注释参数的完成成为可能。必填参数将标有“ *”。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/add-annotation-wizard-step1-annotation-loaded.png" alt="添加注释向导step1注释已加载">
</div>
<div class="title">图205。注释定义已加载到向导中。</div>
</div>
<div class="paragraph">
<p>向导将尽可能为给定的参数提供合适的编辑器。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/add-annotation-wizard-step2-enum-param-editor.png" alt="添加注释向导step2枚举参数编辑器">
</div>
<div class="title">图206。自动为Enumeration注释参数生成的枚举值编辑器。</div>
</div>
<div class="paragraph">
<p>当无法计算自定义编辑器时，将提供通用参数编辑器</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/add-annotation-wizard-step2-generic-param-editor.png" alt="添加注释向导step2通用参数编辑器">
</div>
<div class="title">图207。通用注释参数编辑器</div>
</div>
<div class="paragraph">
<p>输入并验证所有必需参数后，将启用“完成”按钮，并且可以通过将注释添加到给定的“数据对象”或“字段”来完成向导。</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_sect_datamodeler_generatecode"><a class="anchor" href="#_sect_datamodeler_generatecode"></a> <a class="link" href="#_sect_datamodeler_generatecode">15.7.7.5。生成数据模型代码。</a></h5>
<div class="paragraph">
<p>数据模型本身只是一个可视化工具，它允许用户定义高级数据结构，以便它们一方面与Drools引擎交互，另一方面与jBPM平台交互。为了使这成为可能，必须将这些高级视觉结构转换为可被这些平台有效使用的低级工件。这些工件是Java POJO（普通的旧Java对象），它们在每次保存数据模型时都会生成，通过按下顶部的Data Modeller菜单中的“保存”按钮来生成。另外，当用户在“编辑器”和“源”选项卡之间往返时，将自动生成代码以保持与“编辑器”视图的一致性，反之亦然。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/save_top.jpg" alt="保存顶部">
</div>
<div class="title">图208。从顶部菜单保存数据模型</div>
</div>
<div class="paragraph">
<p>根据以下转换规则生成结果代码：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>数据对象的identifier属性将成为Java类的名称。因此，它必须是有效的Java标识符。</p>
</li>
<li>
<p>数据对象的package属性成为Java类的package声明。</p>
</li>
<li>
<p>数据对象的超类属性（如果存在）成为Java类的扩展声明。</p>
</li>
<li>
<p>数据对象的标签和描述属性将转换为Java注释“ @ org.kie.api.definition.type。标签”和“ @ org.kie.api.definition.type”。说明”。这些注释仅仅是保存相关信息的一种方式，目前还没有进一步处理。</p>
</li>
<li>
<p>数据对象的角色属性（如果存在）将转换为“ @ org.kie.api.definition.type”。角色的” Java注解，那<em>就是</em>应用程序平台的解释，在某种意义上说，它标志着这个Java类的Drools的事件事实型。</p>
</li>
<li>
<p>数据对象的类型安全属性（如果存在）将转换为“ @ org.kie.api.definition.type”。TypeSafe Java批注。 （请参阅Drools）</p>
</li>
<li>
<p>数据对象的类反应性属性（如果存在）将转换为“ @ org.kie.api.definition.type”。ClassReactive Java注释。 （请参阅Drools）</p>
</li>
<li>
<p>数据对象的属性反应性属性（如果存在）将转换为“ @ org.kie.api.definition.type”。PropertyReactive Java注释。 （请参阅Drools）</p>
</li>
<li>
<p>数据对象的timestamp属性（如果存在）将转换为“ @ org.kie.api.definition.type”。时间戳记Java注释。 （请参阅Drools）</p>
</li>
<li>
<p>数据对象的duration属性（如果存在）将转换为“ @ org.kie.api.definition.type”。持续时间Java批注。 （请参阅Drools）</p>
</li>
<li>
<p>数据对象的expires属性（如果存在）将转换为“ @ org.kie.api.definition.type”。使Java注释过期。 （请参阅Drools）</p>
</li>
<li>
<p>数据对象的远程属性（如果存在）将转换为“ @ org.kie.api.remote”。远程Java注释。 （请参阅jBPM）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>生成标准的Java默认值（或无参数）构造函数，以及完整的参数构造函数，即，该构造函数接受每个数据对象的用户定义字段的值作为参数。</p>
</div>
<div class="paragraph">
<p>数据对象的用户定义字段将转换为Java类字段，每个字段都有其自己的getter和setter方法，并遵循以下转换规则：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>数据对象字段的标识符将成为Java字段标识符。因此，它必须是有效的Java标识符。</p>
</li>
<li>
<p>数据对象字段的类型直接转换为Java类的字段类型。如果该字段被声明为多个（即“列表”），则生成的字段属于“ java.util”。列表”类型。</p>
</li>
<li>
<p>equals属性：为特定字段设置时，该类属性将使用“ @ org.kie.api.definition.type”进行注释。键”注解，由Drools引擎解释，并将“参与”生成的equals（）方法，该方法将覆盖Object类的equals（）方法。后者意味着如果该字段是“原始”类型，则equals方法将简单地将其值与该类的另一个实例中相应字段的值进行比较。如果该字段是子实体或集合类型，则equals方法将对相应数据对象的Java类或java.util的equals方法进行方法调用。分别列出标准Java类。</p>
<div class="paragraph">
<p>如果在equals属性中检查了数据对象的用户定义字段中的<em>任何</em>字段，则这还意味着除默认生成的构造函数外，还将生成另一个构造函数，将标记有Equals的所有字段作为参数接受。此外，equals（）方法的生成还意味着Object类的hashCode（）方法也将被覆盖，以这种方式将调用相应Java类类型（无论是“原始”还是用户）的hashCode（）方法。定义的类型），用于在数据模型中标记为“等于”的所有字段。</p>
</div>
</li>
<li>
<p>position属性：自动为所有用户定义的字段设置此字段属性，该属性从0开始，并为每个随后的新字段加1。但是，用户可以自由更改字段之间的位置。在代码生成时，此属性被转换为“ @ org.kie.api.definition.type”。位置”注释，可以由Drools引擎解释。同样，已建立的属性顺序确定了生成的Java类中构造函数参数的顺序。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如，在本章底部的图中可视化了为采购订单数据对象生成的Java类代码，该对象对应于其定义，如下图Purchase_example.jpg所示。请注意，数据对象的两个字段，即“标题”和“行”都标记为Equals，并分别分配了位置2和1。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/6.3/generate-purchase-example.png" alt="生成购买示例">
</div>
<div class="title">图209。采购订单配置</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    package org.jbpm.examples.purchases;

    /**
    * This class was automatically generated by the data modeler tool.
    */
    @org.kie.api.definition.type.Label("Purchase Order")
    @org.kie.api.definition.type.TypeSafe(true)
    @org.kie.api.definition.type.Role(org.kie.api.definition.type.Role.Type.EVENT)
    @org.kie.api.definition.type.Expires("2d")
    @org.kie.api.remote.Remotable
    public class PurchaseOrder implements java.io.Serializable
    {

    static final long serialVersionUID = 1L;

    @org.kie.api.definition.type.Label("Total")
    @org.kie.api.definition.type.Position(3)
    private java.lang.Double total;

    @org.kie.api.definition.type.Label("Description")
    @org.kie.api.definition.type.Position(0)
    private java.lang.String description;

    @org.kie.api.definition.type.Label("Lines")
    @org.kie.api.definition.type.Position(2)
    @org.kie.api.definition.type.Key
    private java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines;

    @org.kie.api.definition.type.Label("Header")
    @org.kie.api.definition.type.Position(1)
    @org.kie.api.definition.type.Key
    private org.jbpm.examples.purchases.PurchaseOrderHeader header;

    @org.kie.api.definition.type.Position(4)
    private java.lang.Boolean requiresCFOApproval;

    public PurchaseOrder()
    {
    }

    public java.lang.Double getTotal()
    {
    return this.total;
    }

    public void setTotal(java.lang.Double total)
    {
    this.total = total;
    }

    public java.lang.String getDescription()
    {
    return this.description;
    }

    public void setDescription(java.lang.String description)
    {
    this.description = description;
    }

    public java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; getLines()
    {
    return this.lines;
    }

    public void setLines(java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines)
    {
    this.lines = lines;
    }

    public org.jbpm.examples.purchases.PurchaseOrderHeader getHeader()
    {
    return this.header;
    }

    public void setHeader(org.jbpm.examples.purchases.PurchaseOrderHeader header)
    {
    this.header = header;
    }

    public java.lang.Boolean getRequiresCFOApproval()
    {
    return this.requiresCFOApproval;
    }

    public void setRequiresCFOApproval(java.lang.Boolean requiresCFOApproval)
    {
    this.requiresCFOApproval = requiresCFOApproval;
    }

    public PurchaseOrder(java.lang.Double total, java.lang.String description,
    java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines,
    org.jbpm.examples.purchases.PurchaseOrderHeader header,
    java.lang.Boolean requiresCFOApproval)
    {
    this.total = total;
    this.description = description;
    this.lines = lines;
    this.header = header;
    this.requiresCFOApproval = requiresCFOApproval;
    }

    public PurchaseOrder(java.lang.String description,
    org.jbpm.examples.purchases.PurchaseOrderHeader header,
    java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines,
    java.lang.Double total, java.lang.Boolean requiresCFOApproval)
    {
    this.description = description;
    this.header = header;
    this.lines = lines;
    this.total = total;
    this.requiresCFOApproval = requiresCFOApproval;
    }

    public PurchaseOrder(
    java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines,
    org.jbpm.examples.purchases.PurchaseOrderHeader header)
    {
    this.lines = lines;
    this.header = header;
    }

    @Override
    public boolean equals(Object o)
    {
    if (this == o)
    return true;
    if (o == null || getClass() != o.getClass())
    return false;
    org.jbpm.examples.purchases.PurchaseOrder that = (org.jbpm.examples.purchases.PurchaseOrder) o;
    if (lines != null ? !lines.equals(that.lines) : that.lines != null)
    return false;
    if (header != null ? !header.equals(that.header) : that.header != null)
    return false;
    return true;
    }

    @Override
    public int hashCode()
    {
    int result = 17;
    result = 31 * result + (lines != null ? lines.hashCode() : 0);
    result = 31 * result + (header != null ? header.hashCode() : 0);
    return result;
    }

    }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_sect_datamodeler_externalmodels"><a class="anchor" href="#_sect_datamodeler_externalmodels"></a> <a class="link" href="#_sect_datamodeler_externalmodels">15.7.7.6。使用外部模型</a></h5>
<div class="paragraph">
<p>使用外部模型意味着可以在当前项目上下文中将集合用于已定义的POJO。为了使这些POJO可用，应添加对给定JAR的依赖关系。一旦添加了依赖性，就可以从当前项目数据模型中引用外部POJO。</p>
</div>
<div class="paragraph">
<p>有两种向外部JAR文件添加依赖项的方法：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>对当前本地M2存储库中已安装的JAR文件的依赖（通常与用户主目录关联）。</p>
</li>
<li>
<p>对当前Business Central“ Guvnor M2存储库”中安装的JAR文件的依赖性。 （在应用程序内部）</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_dependency_to_a_jar_file_in_local_m2_repository"><a class="anchor" href="#_dependency_to_a_jar_file_in_local_m2_repository"></a> <a class="link" href="#_dependency_to_a_jar_file_in_local_m2_repository">对本地M2存储库中JAR文件的依赖</a></h6>
<div class="paragraph">
<p>要将依赖项添加到本地M2存储库中的JAR文件中，请遵循以下步骤。</p>
</div>
<div class="sect6">
<h7 id="_open_the_project_editor_for_current_project_and_select_the_dependencies_view"><a class="anchor" href="#_open_the_project_editor_for_current_project_and_select_the_dependencies_view"></a> <a class="link" href="#_open_the_project_editor_for_current_project_and_select_the_dependencies_view">打开当前项目的项目编辑器，然后选择“依赖关系”视图。</a></h7>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-1.png" alt="添加依赖项1">
</div>
<div class="title">图210。项目编辑。</div>
</div>
</div>
<div class="sect6">
<h7 id="_click_the_add_button_to_add_a_new_dependency_line"><a class="anchor" href="#_click_the_add_button_to_add_a_new_dependency_line"></a> <a class="link" href="#_click_the_add_button_to_add_a_new_dependency_line">单击“添加”按钮以添加新的依赖项行。</a></h7>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-2.png" alt="添加依赖项2">
</div>
<div class="title">图211。新的依赖线。</div>
</div>
</div>
<div class="sect6">
<h7 id="_complete_the_gav_for_the_jar_file_already_installed_in_local_m2_repository"><a class="anchor" href="#_complete_the_gav_for_the_jar_file_already_installed_in_local_m2_repository"></a> <a class="link" href="#_complete_the_gav_for_the_jar_file_already_installed_in_local_m2_repository">为本地M2存储库中已安装的JAR文件完成GAV。</a></h7>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-3.png" alt="添加依赖项3">
</div>
<div class="title">图212。依赖线版本。</div>
</div>
</div>
<div class="sect6">
<h7 id="_save_the_project_to_update_its_dependencies"><a class="anchor" href="#_save_the_project_to_update_its_dependencies"></a> <a class="link" href="#_save_the_project_to_update_its_dependencies">保存项目以更新其依赖项。</a></h7>
<div class="paragraph">
<p>保存项目后，将可以使用在外部文件中定义的POJO。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-4.png" alt="添加依赖项4">
</div>
<div class="title">图213。保存项目。</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_dependency_to_a_jar_file_in_current_guvnor_m2_repository"><a class="anchor" href="#_dependency_to_a_jar_file_in_current_guvnor_m2_repository"></a> <a class="link" href="#_dependency_to_a_jar_file_in_current_guvnor_m2_repository">对当前“ Guvnor M2存储库”中的JAR文件的依赖性。</a></h6>
<div class="paragraph">
<p>要将依赖项添加到当前“ Guvnor M2存储库”中的JAR文件中，请遵循以下步骤。</p>
</div>
<div class="sect6">
<h7 id="_open_the_maven_artifact_repository_editor"><a class="anchor" href="#_open_the_maven_artifact_repository_editor"></a> <a class="link" href="#_open_the_maven_artifact_repository_editor">打开Maven Artifact存储库编辑器。</a></h7>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-1.png" alt="添加依赖项guvnor m2 1">
</div>
<div class="title">图214。Guvnor M2存储库编辑器。</div>
</div>
</div>
<div class="sect6">
<h7 id="_browse_your_local_file_system_and_select_the_jar_file_to_be_uploaded_using_the_browse_button"><a class="anchor" href="#_browse_your_local_file_system_and_select_the_jar_file_to_be_uploaded_using_the_browse_button"></a> <a class="link" href="#_browse_your_local_file_system_and_select_the_jar_file_to_be_uploaded_using_the_browse_button">浏览您的本地文件系统，然后使用“浏览”按钮选择要上传的JAR文件。</a></h7>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-2-2.png" alt="添加依赖项guvnor m2 2 2">
</div>
<div class="title">图215。文件浏览器。</div>
</div>
</div>
<div class="sect6">
<h7 id="_upload_the_file_using_the_upload_button"><a class="anchor" href="#_upload_the_file_using_the_upload_button"></a> <a class="link" href="#_upload_the_file_using_the_upload_button">使用“上传”按钮上传文件。</a></h7>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-3.png" alt="添加依赖性guvnor m2 3">
</div>
<div class="title">图216。文件上传成功。</div>
</div>
</div>
<div class="sect6">
<h7 id="_guvnor_m2_repository_files"><a class="anchor" href="#_guvnor_m2_repository_files"></a> <a class="link" href="#_guvnor_m2_repository_files">Guvnor M2存储库文件。</a></h7>
<div class="paragraph">
<p>加载文件后，它将显示在存储库文件列表中。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-4.png" alt="添加依赖项guvnor m2 4">
</div>
<div class="title">图217。文件列表。</div>
</div>
</div>
<div class="sect6">
<h7 id="_provide_a_gav_for_the_uploaded_file_optional"><a class="anchor" href="#_provide_a_gav_for_the_uploaded_file_optional"></a> <a class="link" href="#_provide_a_gav_for_the_uploaded_file_optional">为上载的文件提供GAV（可选）。</a></h7>
<div class="paragraph">
<p>如果上载的文件不是有效的Maven JAR（没有pom.xml文件），系统将提示用户以便为要安装的文件提供GAV。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-not-gav-1.png" alt="添加依赖性guvnor m2而不是gav 1">
</div>
<div class="title">图218。无效的POM。</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-not-gav-2.png" alt="添加依赖guvnor m2而不是gav 2">
</div>
<div class="title">图219。手动输入GAV。</div>
</div>
</div>
<div class="sect6">
<h7 id="_add_dependency_from_repository"><a class="anchor" href="#_add_dependency_from_repository"></a> <a class="link" href="#_add_dependency_from_repository">从存储库添加依赖项。</a></h7>
<div class="paragraph">
<p>打开项目编辑器（请参见下文），然后单击“从存储库添加”按钮以打开JAR选择器，以查看当前“ Guvnor M2存储库”中所有已安装的JAR文件。选择所需的文件后，应保存项目，以使新的依赖项可用。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-guvnor-m2-5.png" alt="添加依赖项guvnor m2 5">
</div>
<div class="title">图220。从“ Maven Artifact存储库”中选择JAR。</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_using_the_external_objects"><a class="anchor" href="#_using_the_external_objects"></a> <a class="link" href="#_using_the_external_objects">使用外部对象</a></h6>
<div class="paragraph">
<p>设置对外部JAR的依赖关系后，可以通过以下方式在当前项目数据模型的上下文中使用外部POJO：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>外部POJO可以由当前模型数据对象扩展。</p>
</li>
<li>
<p>外部POJO可用作当前模型数据对象的字段类型。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以下屏幕截图显示了如何为外部对象添加字符串“ -ext-”作为前缀，以便快速识别它们。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/add-dependency-select-external-pojo.png" alt="添加依赖项选择外部pojo">
</div>
<div class="title">图221。识别外部对象。</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_roundtrip_and_concurrency"><a class="anchor" href="#_roundtrip_and_concurrency"></a> <a class="link" href="#_roundtrip_and_concurrency">15.7.7.7。往返和并发</a></h5>
<div class="paragraph">
<p>当前版本在Data Modeller和Java源代码之间实现往返和代码保存。无论Java代码在哪里生成（例如Eclipse，Data Modeller），数据建模器都只会创建/删除/更新必要的代码元素以保持模型更新，即字段，getter / setter，构造函数，equals方法和hashCode方法。同样，当Java来源由数据建模者更新时，任何不受数据建模者管理的Type或Field注释也将被保留。</p>
</div>
<div class="paragraph">
<p>除了保留代码之外，像其他Business Central编辑器一样，并发修改方案仍然可行。常见的场景是两个不同的用户正在为同一项目更新模型，例如使用数据建模器或执行修改项目源的“ git push命令”。</p>
</div>
<div class="paragraph">
<p>从应用程序上下文的角度来看，我们基本上可以确定两种不同的主要方案：</p>
</div>
<div class="sect5">
<h6 id="_no_changes_have_been_undertaken_through_the_application"><a class="anchor" href="#_no_changes_have_been_undertaken_through_the_application"></a> <a class="link" href="#_no_changes_have_been_undertaken_through_the_application">没有通过应用程序进行任何更改</a></h6>
<div class="paragraph">
<p>在这种情况下，应用程序用户基本上只是浏览数据模型，而没有对其进行任何更改。同时，另一个用户在外部修改数据模型。</p>
</div>
<div class="paragraph">
<p>在这种情况下，不会立即向应用程序用户发出警告。但是，一旦用户尝试进行任何类型的更改（例如添加或删除数据对象或属性，或更改任何现有的对象或属性），就会显示以下弹出窗口：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/extchanges_reopen_ignore.jpg" alt="外部重新打开忽略">
</div>
<div class="title">图222。外部变更警告</div>
</div>
<div class="paragraph">
<p>用户可以选择：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>重新打开数据模型，从而加载所有外部更改，然后执行他将要进行的修改，或者</p>
</li>
<li>
<p>忽略任何外部更改，然后继续对模型进行修改。在这种情况下，当尝试保留这些更改时，将显示另一个弹出警告：</p>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/extchanges_forcesave_reopen.jpg" alt="交换forcesave重新打开">
</div>
<div class="title">图223。强制保存/重新打开</div>
</div>
<div class="paragraph">
<p>“强制保存”选项将有效覆盖所有外部更改，而“重新打开”将放弃所有本地更改并重新加载模型。</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p>“强制保存”将覆盖所有外部更改！</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_changes_have_been_undertaken_through_the_application"><a class="anchor" href="#_changes_have_been_undertaken_through_the_application"></a> <a class="link" href="#_changes_have_been_undertaken_through_the_application">通过应用程序进行了更改</a></h6>
<div class="paragraph">
<p>应用程序用户已对数据模型进行了更改。同时，另一个用户同时从应用程序上下文外部修改数据模型。</p>
</div>
<div class="paragraph">
<p>在此替代方案中，在外部用户将其更改提交到资产存储库后（或例如，在不同的会话中使用数据建模器保存模型）之后，立即向应用程序用户发出警告：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/extchanges_reopen_ignore.jpg" alt="外部重新打开忽略">
</div>
<div class="title">图224。外部变更警告</div>
</div>
<div class="paragraph">
<p>与以前的方案一样，用户可以选择以下任一项：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>重新打开数据模型，从而丢失通过应用程序进行的任何修改，或者</p>
</li>
<li>
<p>忽略任何外部更改，然后继续处理模型。</p>
<div class="paragraph">
<p>现在，可能发生以下情况之一：**用户尝试通过单击数据建模器顶级菜单中的“保存”按钮来保留对模型所做的更改。这将导致以下警告消息：</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataModeller/extchanges_forcesave_reopen.jpg" alt="交换forcesave重新打开">
</div>
<div class="title">图225。强制保存/重新打开</div>
</div>
<div class="paragraph">
<p>“强制保存”选项将有效覆盖所有外部更改，而“重新打开”将放弃所有本地更改并重新加载模型。</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.datasets"><a class="anchor" href="#_wb.datasets"></a> <a class="link" href="#_wb.datasets">15.7.8。数据集</a></h4>
<div class="paragraph">
<p><strong>数据集</strong>基本上是一组由一些行组成的列，这是由时间戳，文本和数字组成的数据矩阵。数据集可以存储在不同的系统中：数据库，excel文件，内存中或许多其他不同的系统中。另一方面， <strong>数据集定义</strong>告诉Business Central模块如何访问，读取和解析此类数据。</p>
</div>
<div class="paragraph">
<p>请注意，弄清数据集及其定义之间的区别非常重要，因为Business Central不会存储任何数据，它只是提供了一种标准方法来定义对这些数据集的访问，而不管数据存储在何处。</p>
</div>
<div class="paragraph">
<p>让我们以存储在远程数据库中的数据为例。有效数据集可以是例如整个数据库表或SQL查询的结果。在这两种情况下，数据库都会返回一堆列和行。现在，假设我们想访问此类数据以在新的Business Central页面中提供一些图表。第一件事是创建并注册数据集定义，以指示以下内容：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>数据集的存储位置</p>
</li>
<li>
<p>如何访问，读取和解析以及</p>
</li>
<li>
<p>哪些列包含哪些类型。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>本章介绍了用于注册和处理数据集定义的可用Business Central工具，以及如何在其他Business Central模块（例如页面编辑器）中使用此定义。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>为简单起见，我们将使用术语<em>数据集</em>来指代实际的数据集定义，因为在数据集创作上下文中， <em>数据集</em>和<em>数据集定义</em>可以视为同义词。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="_wb.datasetauthoringperspective"><a class="anchor" href="#_wb.datasetauthoringperspective"></a> <a class="link" href="#_wb.datasetauthoringperspective">15.7.8.1。数据集创作页面</a></h5>
<div class="paragraph">
<p>与数据集创作有关的所有内容都可以在“ <em>数据集创作”</em>页面下找到，该页面可从以下顶级菜单条目访问： <em>扩展>数据集</em> ，如以下屏幕快照所示。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetAuthoringPerspective.png" alt="DataSetAuthoringPerspective">
</div>
<div class="title">图226。数据集创作页面</div>
</div>
<div class="paragraph">
<p>中间面板显示欢迎屏幕，而左侧面板包含<em>数据集资源管理器，其中</em>列出了所有可用数据集</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>该页面仅适用于管理员用户，因为定义数据集可以被视为低级任务。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasetexplorer"><a class="anchor" href="#_wb.datasetexplorer"></a> <a class="link" href="#_wb.datasetexplorer">15.7.8.2。数据集浏览器</a></h5>
<div class="paragraph">
<p><em>数据集资源管理器</em>列出了系统中存在的数据集。每次用户单击数据集时，它都会显示一个简短的摘要以及以下信息：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetExplorer.png" alt="数据集浏览器">
</div>
<div class="title">图227。数据集浏览器</div>
</div>
<div class="ulist">
<ul>
<li>
<p>（1）用于创建新数据集的按钮</p>
</li>
<li>
<p>（2）当前可用数据集的列表</p>
</li>
<li>
<p>（3）代表数据集提供程序类型（Bean，SQL，CSV等）的图标</p>
</li>
<li>
<p>（4）当前缓存和刷新策略状态的详细信息</p>
</li>
<li>
<p>（5）后端当前大小（以行为单位）和客户端当前大小（以字节为单位）的详细信息</p>
</li>
<li>
<p>（6）用于编辑数据集的按钮。单击后，将在中心面板上打开“数据集编辑器”屏幕。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>下一节将说明如何创建，编辑和微调数据集定义。</p>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasetcreation"><a class="anchor" href="#_wb.datasetcreation"></a> <a class="link" href="#_wb.datasetcreation">15.7.8.3。数据集创建</a></h5>
<div class="paragraph">
<p>单击“ <em>新建数据集”</em>按钮将打开一个新屏幕，用户可以通过该屏幕通过三个步骤来创建新的数据集定义：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>提供者类型选择</em></p>
<div class="paragraph">
<p>指定远程存储系统的类型（BEAN，SQL，CSV，ElasticSearch）</p>
</div>
</li>
<li>
<p><em>提供者配置</em></p>
<div class="paragraph">
<p>指定能够从远程系统中查找数据的属性。该配置因所选的数据提供程序类型而异。</p>
</div>
</li>
<li>
<p><em>数据集列和过滤器</em></p>
<div class="paragraph">
<p>实时数据预览，列类型和初始过滤器配置。</p>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_wb.datasetcreationtypeselection"><a class="anchor" href="#_wb.datasetcreationtypeselection"></a> <a class="link" href="#_wb.datasetcreationtypeselection">步骤1：提供者类型选择</a></h6>
<div class="paragraph">
<p>允许用户指定要创建的数据集的数据提供者的类型。</p>
</div>
<div class="paragraph">
<p>该屏幕列出了所有当前可用的数据提供者类型以及说明的帮助程序弹出窗口。每个数据提供者都用一个描述性图像表示：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefTypeSelection.png" alt="DataSetDefTypeSelection">
</div>
<div class="title">图228。提供者类型选择</div>
</div>
<div class="paragraph">
<p>当前支持四种类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bean（Java类）-直接从Java生成数据集</p>
</li>
<li>
<p>SQL-用于从任何符合ANSI-SQL的数据库中获取数据</p>
</li>
<li>
<p>CSV-上传远程或本地CSV文件的内容</p>
</li>
<li>
<p>Elastic Search-查询和获取存储在Elastic Search节点上的文档作为数据集</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>选择类型后，单击“下一步”继续下一个工作流程步骤。</p>
</div>
</div>
<div class="sect5">
<h6 id="_wb.datasetcreationconfiguration"><a class="anchor" href="#_wb.datasetcreationconfiguration"></a> <a class="link" href="#_wb.datasetcreationconfiguration">步骤2：设定</a></h6>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefConfigScreen.png" alt="DataSetDefConfigScreen">
</div>
<div class="title">图229。CSV配置</div>
</div>
<div class="paragraph">
<p>在上一步中选择的提供者类型将确定系统要求的配置设置。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefConfigTypes.png" alt="DataSetDefConfigTypes">
</div>
<div class="title">图230。每种数据集类型的配置屏幕</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>UUID属性是系统生成的只读字段。仅适用于API调用或特定操作。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_wb.datasetcreationpreview"><a class="anchor" href="#_wb.datasetcreationpreview"></a> <a class="link" href="#_wb.datasetcreationpreview">步骤3：资料集栏和预览</a></h6>
<div class="paragraph">
<p>单击“ <em>测试”</em>按钮（请参阅上一步）后，系统将执行数据集查找测试调用，以检查远程系统是否已启动并且数据是否可用。如果一切正常，用户将看到以下屏幕：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefLivePreview.png" alt="DataSetDefLivePreview">
</div>
<div class="title">图231。数据集预览</div>
</div>
<div class="paragraph">
<p>该屏幕显示实时数据预览以及用户希望成为结果数据集一部分的列。用户还可以浏览数据并将某些更改应用于数据集结构。完成后，我们可以单击“ <em>保存”</em>按钮以注册新的数据集定义。</p>
</div>
<div class="paragraph">
<p>我们还可以随时返回配置标签来随时更改配置设置。我们可以根据需要重复“ <em>配置”>“测试”>“预览”</em>循环，直到我们认为可以将其保存为止。</p>
</div>
<div class="paragraph">
<p><strong>列</strong></p>
</div>
<div class="paragraph">
<p>在“ <em>列”</em>选项卡区域中，用户可以选择哪些列是结果数据集定义的一部分。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefColumns.png" alt="DataSetDefColumns">
</div>
<div class="title">图232。数据集列</div>
</div>
<div class="ulist">
<ul>
<li>
<p>（1）添加或删除列。仅选择要成为结果数据集一部分的那些列</p>
</li>
<li>
<p>（2）使用下拉图像选择器更改列类型</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>数据集只能包含以下4种类型的列：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>标签-对于支持组操作的文本值（类似于SQL“ group by”运算符），这意味着您可以执行数据查找调用并为每个不同的值获取一行。</p>
</li>
<li>
<p>文本-对于不支持组操作的文本值。通常用于建模大型文本列，例如摘要，描述等。</p>
</li>
<li>
<p>数字-用于数字值。它确实支持数据查询调用的聚合功能：求和，最小值，最大值，平均值，计数，不重复。</p>
</li>
<li>
<p>日期-用于日期或时间戳记值。它确实支持通过不同时间间隔进行基于时间的组操作：分钟，小时，天，月，年...</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>无论您要从哪个远程系统检索数据，结果数据集将始终返回上述四种类型之一的一组列。默认情况下，远程系统列类型和数据集类型之间存在映射。用户可以修改某些列的类型，具体取决于数据提供者和远程系统的列类型。系统支持对列类型的以下更改：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>标签<>文本-当我们想要启用/禁用目标列的分类（分组）时很有用。例如，假设有一个名为“文档”的数据库表，其中包含一个名为“抽象”的大文本列。由于我们不希望系统将此类列视为“标签”，因此可以将其列类型更改为“文本”。这样做，我们正在优化系统处理数据集的方式，并</p>
</li>
<li>
<p>数字<>标签-当我们要将数字列视为标签时很有用。例如，这可用于指示给定的数字列不是可在聚合函数中使用的数字值。尽管其值存储为数字，但我们还是希望将列作为“标签”来处理。这样的列的一个示例是：项目的代码，评估ID ....</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>BEAN数据集不支持更改列类型，因为由开发人员决定每个列的具体类型。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><strong>过滤</strong></p>
</div>
<div class="paragraph">
<p>数据集定义可以定义过滤器。过滤器的目标是省略用户认为不必要的行。过滤器功能适用于任何数据提供者类型，它使用户可以对任何可用的数据集列应用过滤器操作。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefFilter.png" alt="DataSetDefFilter">
</div>
<div class="title">图233。数据集过滤器</div>
</div>
<div class="paragraph">
<p>在添加或删除过滤器条件和操作时，中心区域的预览表将使用反映当前过滤器状态的实时数据进行更新。</p>
</div>
<div class="paragraph">
<p>存在两种用于过滤数据集的策略，还需要注意的是，在两者之间进行选择具有重要的意义。想象一下一个仪表板，其中有一些图表是从费用报告数据集中获取的，而该数据集是建立在SQL表之上的。试想一下，我们只想从“伦敦”办公室检索费用报告。您可以定义一个数据集，其中包含过滤器“ office = London”，然后从该数据集中获取多个图表。这是推荐的方法。另一个选择是定义一个没有初始过滤器的数据集，然后让各个图表指定自己的过滤器。由用户决定最佳方法。</p>
</div>
<div class="paragraph">
<p>根据情况，最好在数据集级别定义过滤器以在其他模块之间重用。该决定可能还会影响性能，因为过滤后的缓存数据集将比许多单独的非缓存数据集查找请求具有更好的性能。（有关缓存数据集的更多信息，请参见下一部分）。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>请注意，对于SQL数据集，用户既可以使用引入的过滤器功能，也可以仅向SQL语句添加自定义过滤器条件。虽然，第一种方法更适合非技术用户，因为他们可能没有所需的SQL语言技能。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasetdefeditor"><a class="anchor" href="#_wb.datasetdefeditor"></a> <a class="link" href="#_wb.datasetdefeditor">15.7.8.4。数据集编辑器</a></h5>
<div class="paragraph">
<p>要编辑现有数据集定义，请转到数据集浏览器，展开所需的数据集定义，然后单击“ <em>编辑”</em>按钮。这将导致一个新的编辑器面板被打开并放置在屏幕中央，如以下屏幕截图所示：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefEditor.png" alt="DataSetDefEditor">
</div>
<div class="title">图234。数据集定义编辑器</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefEditorSelector.png" alt="DataSetDefEditorSelector">
</div>
<div class="title">图235。编辑器选择器</div>
</div>
<div class="ulist">
<ul>
<li>
<p>保存-验证当前更改并存储数据集定义。</p>
</li>
<li>
<p>删除-从存储中永久删除数据集定义。任何引用该数据集的客户端模块都可能受到影响。</p>
</li>
<li>
<p>验证-检查所有必需参数是否存在并且正确，以及验证是否可以毫无问题地检索数据集。</p>
</li>
<li>
<p>复制-创建一个全新的定义作为当前定义的副本。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>数据集定义作为JSON文件存储在基础GIT存储库中。所执行的所有操作都会在存储库日志中注册，因此以后可以审核更改日志。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasetadvancedsettings"><a class="anchor" href="#_wb.datasetadvancedsettings"></a> <a class="link" href="#_wb.datasetadvancedsettings">15.7.8.5。高级设置</a></h5>
<div class="paragraph">
<p>在“ <em>高级设置”</em>选项卡区域中，用户可以指定缓存和刷新设置。这些对于充分利用系统功能，提高性能和提高应用程序响应级别非常重要。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefAdvanced.png" alt="DataSetDefAdvanced">
</div>
<div class="title">图236。高级设置</div>
</div>
<div class="ulist">
<ul>
<li>
<p>（1）启用或禁用客户端缓存并指定最大大小（字节）。</p>
</li>
<li>
<p>（2）启用或禁用后端缓存并指定最大缓存大小（行数）。</p>
</li>
<li>
<p>（3）启用或禁用数据集和刷新周期的自动刷新。</p>
</li>
<li>
<p>（4）启用或禁用陈旧数据刷新设置。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>让我们深入了解这些设置的含义。</p>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasetcachesettings"><a class="anchor" href="#_wb.datasetcachesettings"></a> <a class="link" href="#_wb.datasetcachesettings">15.7.8.6。快取</a></h5>
<div class="paragraph">
<p>该系统提供了开箱即用的缓存机制，用于保存数据集并使用内存策略执行数据操作。这些功能的使用带来了很多优势，例如减少了网络流量，远程系统有效负载，处理时间等。另一方面，用户可以适当地调整缓存设置，以避免遇到性能问题。</p>
</div>
<div class="paragraph">
<p>支持两种缓存级别：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>客户等级</p>
</li>
<li>
<p>后端级别</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>下图显示了任何数据集操作如何涉及缓存：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetCacheArchitecture.png" alt="DataSetCacheArchitecture">
</div>
<div class="title">图237。数据集缓存</div>
</div>
<div class="paragraph">
<p>任何数据查找调用都会生成结果数据集，因此缓存技术的使用将确定执行数据查找调用的位置以及结果数据集的位置。</p>
</div>
<div class="paragraph">
<p><strong>客户端缓存</strong></p>
</div>
<div class="paragraph">
<p>如果为ON，则查找操作中涉及的数据集将被推入Web浏览器，从而使从该数据集馈送的所有组件<strong>都无需对后端执行任何请求，</strong>因为数据集操作是在客户端进行解析的：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>数据集存储在Web浏览器的内存中</p>
</li>
<li>
<p>客户端组件从存储在浏览器中的数据集提要</p>
</li>
<li>
<p>数据集操作（分组，聚合，过滤器和排序）是通过Java数据集操作引擎在Web浏览器中进行处理的。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果事先知道数据集将很小，则可以启用客户端缓存。它将减少后端请求的数量，包括对存储系统的请求。另一方面，如果您认为数据集会很大，请禁用客户端缓存，以免出现浏览器问题，例如性能降低或间歇性挂起。</p>
</div>
<div class="paragraph">
<p><strong>后端缓存</strong></p>
</div>
<div class="paragraph">
<p>其目标是为后端的数据集提供一种缓存机制。</p>
</div>
<div class="paragraph">
<p>通过将数据集保存在内存中并使用内存Drools引擎执行分组，过滤和排序操作，此功能可以<strong>减少对远程存储系统的请求数量</strong> 。</p>
</div>
<div class="paragraph">
<p>这对于不经常更改的数据集很有用，并且可以认为它们的大小可以在内存中保存和处理。对于远程存储的低延迟连接问题，它也很有帮助。另一方面，如果您的数据集将经常更新，则最好禁用后端缓存，并在每个查找请求上执行对远程存储的请求，因此存储系统负责解决数据集查找请求。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>默认情况下，BEAN和CSV数据提供程序依赖于后端缓存，因为在两种情况下，必须始终将数据集加载到内存中，才能使用内存Drools引擎解析任何数据查找操作。这就是为什么后端设置在“高级设置”选项卡中不可见的原因。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasetrefreshsettings"><a class="anchor" href="#_wb.datasetrefreshsettings"></a> <a class="link" href="#_wb.datasetrefreshsettings">15.7.8.7。刷新</a></h5>
<div class="paragraph">
<p>刷新功能允许在满足某些条件时使任何缓存的数据无效。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSets/DataSetDefRefreshSettings.png" alt="DataSetDefRefreshSettings">
</div>
<div class="title">图238。刷新设置</div>
</div>
<div class="ulist">
<ul>
<li>
<p>（1）启用或禁用刷新功能。</p>
</li>
<li>
<p>（2）指定刷新间隔。</p>
</li>
<li>
<p>（3）在数据过时时启用或禁用数据集无效。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>数据集刷新策略与数据集缓存紧密相关，在上一节中进行了详细介绍。这种失效机制决定了缓存的生命周期。</p>
</div>
<div class="paragraph">
<p>根据数据的性质，存在三个主要用例：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>源数据的变化是可预测的</strong> -想象一下每晚都有一个数据库被更新。在这种情况下，建议的配置是使用“刷新间隔= 1天”并禁用“刷新陈旧数据”。这样，系统将始终每天使缓存的数据集无效。当我们事先知道数据将要更改时，这是正确的配置。</p>
</li>
<li>
<p><strong>源数据的变化无法预测</strong> -另一方面，如果我们不知道数据库是否每天都在更新，建议的配置是使用“刷新间隔= 1天”并启用“刷新陈旧数据”。如果是这样，系统将在使任何数据无效之前检查修改。在修改数据时，系统将使当前的过时数据集无效，以便在下一个数据集查找调用中用新数据填充缓存。</p>
</li>
<li>
<p><strong>实时方案</strong> -在实时方案中，缓存没有意义，因为数据将不断更新。在这种情况下，必须不断更新发送到客户端的数据，因此，与其启用刷新设置（请记住此设置会影响缓存，并且未启用缓存），不如由客户端使用数据集来决定何时刷新。当客户端是仪表板时，只需在Displayer Editor配置屏幕中修改刷新设置并设置适当的刷新周期即可，例如“刷新间隔= 1秒”。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.datasources"><a class="anchor" href="#_wb.datasources"></a> <a class="link" href="#_wb.datasources">15.7.9。资料来源管理</a></h4>
<div class="paragraph">
<p>数据源管理系统提供了定义数据源以访问外部数据库的功能。以后，其他业务中心组件（如数据集）可以使用此数据源。</p>
</div>
<div class="sect4">
<h5 id="_wb.databasedrivers"><a class="anchor" href="#_wb.databasedrivers"></a> <a class="link" href="#_wb.databasedrivers">15.7.9.1。数据库驱动程序</a></h5>
<div class="paragraph">
<p>为了能够与目标数据库通信，数据源将需要数据库驱动程序来访问它。这就是系统额外提供为数据源操作定义数据库驱动程序的功能的原因。数据库驱动程序基本上是符合JDBC的驱动程序。我们将在下一个主题中看到它们。</p>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasourceauthoringperspective"><a class="anchor" href="#_wb.datasourceauthoringperspective"></a> <a class="link" href="#_wb.datasourceauthoringperspective">15.7.9.2。数据源创作页面</a></h5>
<div class="paragraph">
<p>与数据源和驱动程序创作有关的所有内容都可以在“ <em>数据源创作”</em>页面下找到，可从以下顶级菜单条目访问： <em>扩展>数据源</em> ，如以下屏幕快照所示。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceManagementPerspective.png" alt="数据源管理角度">
</div>
<div class="title">图239。数据源创作页面</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>该页面仅适用于管理员用户，因为定义数据源可以视为低级任务。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasourceexplorer"><a class="anchor" href="#_wb.datasourceexplorer"></a> <a class="link" href="#_wb.datasourceexplorer">15.7.9.3。数据源浏览器</a></h5>
<div class="paragraph">
<p><em>数据源资源管理器</em>列出了系统中当前定义的数据源和驱动程序，同时提供了管理它们所需的操作。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceExplorer.png" alt="数据源浏览器">
</div>
<div class="title">图240。数据源浏览器</div>
</div>
<div class="ulist">
<ul>
<li>
<p>（1）用于创建新数据源的操作链接</p>
</li>
<li>
<p>（2）当前可用数据源列表</p>
</li>
<li>
<p>（3）用于创建新驱动程序的操作链接</p>
</li>
<li>
<p>（4）当前可用的驱动程序列表</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasourcecreation"><a class="anchor" href="#_wb.datasourcecreation"></a> <a class="link" href="#_wb.datasourcecreation">15.7.9.4。新数据源向导</a></h5>
<div class="paragraph">
<p>单击“ <em>新建数据源”</em>操作链接可打开“新建数据源向导”：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/NewDataSourceWizard.png" alt="NewDataSourceWizard">
</div>
<div class="title">图241。新数据源向导</div>
</div>
<div class="paragraph">
<p>以下必需参数定义了数据源：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>名称：数据源定义的唯一名称。</p>
</li>
<li>
<p>连接URL：与所选驱动程序类型兼容的JDBC数据库连接URL。这是PostgreSQL数据库的连接URL的示例： <em>jdbc：postgresql：// localhost：5432 / appformer</em> 。</p>
</li>
<li>
<p>用户：目标数据库中的用户名。</p>
</li>
<li>
<p>密码：相应的用户密码。</p>
</li>
<li>
<p>驱动程序：选择用于连接到目标数据库的JDBC驱动程序。<em>请注意，连接URL格式可能会因驱动程序而异，并且不同的数据库供应商通常会提供不同的驱动程序。</em></p>
</li>
<li>
<p>测试连接：单击后，系统将显示一个类似于以下对话框，显示连接测试状态。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/TestConnectionSuccessful.png" alt="测试连接成功">
</div>
<div class="title">图242。测试连接状态</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>虽然不是必需的，但建议您在完成数据源创建之前使用测试连接按钮检查数据源参数的正确性。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasourceeditor"><a class="anchor" href="#_wb.datasourceeditor"></a> <a class="link" href="#_wb.datasourceeditor">15.7.9.5。数据源编辑器</a></h5>
<div class="paragraph">
<p>通过单击“ <em>数据源资源管理器”</em>中的数据源项目，可以打开“ <em>数据源编辑</em> <em>器”</em> 。</p>
</div>
<div class="paragraph">
<p>以下屏幕截图显示了为上述示例的数据源打开的<em>数据源编辑器</em> 。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceEditor.png" alt="数据源编辑器">
</div>
<div class="title">图243。数据源编辑器</div>
</div>
<div class="ulist">
<ul>
<li>
<p>主面板：基本面板基本上使您可以修改数据源配置参数。</p>
</li>
<li>
<p>测试连接：测试连接。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>建议的做法是在保存修改后的数据源之前测试连接。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasourcecontent"><a class="anchor" href="#_wb.datasourcecontent"></a> <a class="link" href="#_wb.datasourcecontent">15.7.9.6。数据源内容浏览器</a></h5>
<div class="paragraph">
<p>通过单击<em>浏览内容</em>按钮打开数据源内容浏览器，并启用对数据源指向的数据库结构的导航。导航在以下三个级别中执行： <em>模式级别</em> ， <em>当前模式级别</em>和<em>当前表级别</em> 。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>模式级别：列出当前数据源可访问的所有数据库模式。列出哪些模式取决于连接配置中使用的授予用户的数据库访问权限。对于以下项目类似。</p>
</li>
<li>
<p>当前模式级别：显示所选模式的所有数据库表。</p>
</li>
<li>
<p>当前表级别：显示所选表的表内容。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以下屏幕快照显示了实现以下导航步骤的用户在每个级别上显示的信息。选择<em>“公共”</em>模式→选择<em>“国家”</em>表。</p>
</div>
<div class="paragraph">
<p><em>模式选择</em> ：</p>
</div>
<div class="paragraph">
<p>单击“ <em>打开”</em>按钮将打开所选模式的“ <em>当前模式”级别</em> 。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceContentBrowser1.png" alt="DataSourceContentBrowser1">
</div>
<div class="title">图244。数据库模式</div>
</div>
<div class="paragraph">
<p><em>表格选择</em> ：</p>
</div>
<div class="paragraph">
<p>单击“ <em>打开”</em>按钮将打开所选表的<em>当前表级别</em> 。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceContentBrowser2.png" alt="DataSourceContentBrowser2">
</div>
<div class="title">图245。模式表</div>
</div>
<div class="paragraph">
<p><em>表信息</em> ：</p>
</div>
<div class="paragraph">
<p>所选表的行显示在此级别。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceContentBrowser3.png" alt="DataSourceContentBrowser3">
</div>
<div class="title">图246。表格行</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.externaldatasources"><a class="anchor" href="#_wb.externaldatasources"></a> <a class="link" href="#_wb.externaldatasources">15.7.9.7。外部资料来源</a></h5>
<div class="paragraph">
<p>外部数据源通常不在Business Central中定义，而是存在于当前容器中，对于Wildfly 11或JBoss EAP 7服务器等某些容器，它们仍可以只读模式列出。在这种情况下，仅启用<em>数据源内容浏览器</em> 。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/ExternalDataSources.png" alt="外部数据源">
</div>
<div class="title">图247。外部数据源导航</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.drivercreation"><a class="anchor" href="#_wb.drivercreation"></a> <a class="link" href="#_wb.drivercreation">15.7.9.8。新驱动程序向导</a></h5>
<div class="paragraph">
<p>单击“ <em>新驱动程序”</em>操作链接，将打开“新驱动程序向导”：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/NewDriverWizard.png" alt="NewDriver向导">
</div>
<div class="title">图248。新驱动程序向导</div>
</div>
<div class="paragraph">
<p>以下必需参数定义了驱动程序：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>名称：驱动程序定义的唯一名称。</p>
</li>
<li>
<p>驱动程序类名称：实现JDBC驱动程序协定的类的Java完全限定名称。</p>
</li>
<li>
<p>组ID：包含JDBC驱动程序实现的工件的Maven组ID。</p>
</li>
<li>
<p>工件ID：包含JDBC驱动程序实现的工件的Maven工件ID。</p>
</li>
<li>
<p>版本：包含JDBC驱动程序实现的工件的Maven版本。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>一些商业数据库驱动程序（例如Oracle）在maven中央存储库中不可用。您可以通过以下方式使用它们：首先通过<em>Artifact Repository</em>页面上载它们，然后按照maven中央存储库中可用的驱动程序继续进行驱动程序配置。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.drivereditor"><a class="anchor" href="#_wb.drivereditor"></a> <a class="link" href="#_wb.drivereditor">15.7.9.9。驱动程式编辑器</a></h5>
<div class="paragraph">
<p>单击“ <em>数据源资源管理器”中</em>的驱动程序项，可以打开“ <em>驱动程序编辑</em> <em>器”</em> 。</p>
</div>
<div class="paragraph">
<p>以下屏幕截图显示了为上述示例的<em>驱动程序</em>打开的驱动<em>程序编辑器</em> 。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DriverEditor.png" alt="驱动程序编辑器">
</div>
<div class="title">图249。驱动程式编辑器</div>
</div>
<div class="ulist">
<ul>
<li>
<p>主面板：基本面板基本上使您可以修改驱动程序配置参数。请参阅“ <em>新驱动程序向导”</em> 。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_wb.bydefaultdrivers"><a class="anchor" href="#_wb.bydefaultdrivers"></a> <a class="link" href="#_wb.bydefaultdrivers">15.7.9.10。默认驱动程序</a></h5>
<div class="paragraph">
<p>系统附带了一组默认配置的驱动程序，用于最常用的开源数据库。它们与Wildfly 11和JBoss EAP 7服务器支持的最新数据库版本保持一致。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DefaultDrivers.png" alt="DefaultDrivers">
</div>
<div class="title">图250。默认驱动程序</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>可以通过将datasource.management.disableDefaultDrivers配置属性设置为false来启用默认驱动程序初始化。可以通过在datasource-management.properties文件中配置适当的值或将系统属性-Ddatasource.management.disableDefaultDrivers = false传递给JVM来设置它。有关更多信息，请参阅高级设置。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.advancedsettings"><a class="anchor" href="#_wb.advancedsettings"></a> <a class="link" href="#_wb.advancedsettings">15.7.9.11。高级设置</a></h5>
<div class="paragraph">
<p>可以在给定Business Central分发文件的WEB-INF / classes目录中的datasource-management.properties文件中找到数据源管理系统的高级设置。</p>
</div>
<div class="paragraph">
<p>数据源管理系统具有为数据源和驱动程序使用两种不同的内部实现的能力。基于Wildfly / EAP本机数据源和驱动程序的实现，以及与容器无关的实现。默认情况下，Wildfly / EAP Business Central发行版配置为使用本机Wildlfy / EAP容器实现，而Tomcat8发行版配置为使用与容器无关的实现。后一种实现也可以用于Wildfly / EAP容器。</p>
</div>
<div class="paragraph">
<p>有效组合为：</p>
</div>
<div class="paragraph">
<p>WildflyDataSourceProvider + WildflyDriverProvider<br>要么<br>DBCPDataSourceProvider + DBCPDriverProvider</p>
</div>
<div class="paragraph">
<p>datasource.management.wildfly.xxxxx属性仅适用于WildflyXXXProvider。</p>
</div>
</div>
<div class="sect4">
<h5 id="_wb.advancedsettings.wildlfy"><a class="anchor" href="#_wb.advancedsettings.wildlfy"></a> <a class="link" href="#_wb.advancedsettings.wildlfy">15.7.9.12。Business Central Wildlfy / EAP分发的高级设置</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">物业名称</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">默认值</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">数据源管理。数据源提供者</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">WildflyDataSourceProvider</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">请参阅高级设置。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">数据源管理。驱动程序提供者</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">WildflyDriverProvider</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">请参阅高级设置。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">datasource.management.disableDefaultDrivers</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">真正</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">设置为false可启用默认的数据库驱动程序初始化。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">datasource.management.wildfly.host</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">本地主机</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用于Wildlfy服务器管理接口绑定的名称或IP地址。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">datasource.management.wildfly.port</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">9990</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用于Wildlfy服务器管理接口绑定的端口。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">datasource.management.wildfly.admin</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">连接到运行当前Business Central的Wildfly服务器的管理用户。通常，没有必要设置此值，但是当Wildlfy管理接口绑定到与本地主机不同的地址时，可能需要设置该值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">datasource.management.wildfly.password</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">连接到运行当前Business Central的Wildfly服务器的管理用户密码。通常，没有必要设置此值，但是当Wildlfy管理接口绑定到与本地主机不同的地址时，可能需要设置该值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">datasource.management.wildfly.realm</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">管理领域</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用于管理用户身份验证的领域。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">datasource.management.wildfly.profile</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用于启动Wildfly域的配置文件名称，例如默认，完整，全ha等。仅当Business Central以群集模式运行并且使用域配置托管Wildfly服务器时，才必须设置此值。如果Wildlfy服务器作为独立服务器运行，则不要设置。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">datasource.management.wildfly.serverGroup</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">当前Wildfly服务器实例所属的服务器组，例如primary-server-group等。仅当Business Central以群集模式运行并且使用域配置托管Wildfly服务器时，才必须设置此值。如果Wildlfy服务器作为独立服务器运行，则不要设置。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">数据源管理。DefChangeHandler</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">仅当Business Central在群集模式下运行时，才必须设置此值。如果使用域配置了托管Wildfly服务器，则在托管Wildlfy服务器作为独立服务器运行的情况下，必须使用<em>DomainModeChangeHandler</em>以下值，并且必须使用<em>StandaloneModeChangeHandler</em>以下值。必须将使用DBCPXXXProvider的群集安装配置为使用<em>StandaloneModeChangeHandler</em> 。</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>也可以通过使用Java标准机制将系统属性传递给JVM来设置上述属性。例如-Ddatasource.management.wildfly.port = 1234。使用此机制配置的值将覆盖datasource-management.properties文件中配置的值。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.advancedsettings.tomcat"><a class="anchor" href="#_wb.advancedsettings.tomcat"></a> <a class="link" href="#_wb.advancedsettings.tomcat">15.7.9.13。Tomcat发行版的高级设置</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">物业名称</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">默认值</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">数据源管理。数据源提供者</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">DBCPDataSourceProvider</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">这是可用于Tomcat 8发行版的唯一选项，请参阅“高级设置”。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">数据源管理。驱动程序提供者</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">DBCPDriverProvider</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">这是可用于Tomcat 8发行版的唯一选项，请参阅“高级设置”。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">datasource.management.disableDefaultDrivers</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">真正</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">设置为false可启用默认的数据库驱动程序初始化。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">数据源管理。DefChangeHandler</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">仅当Business Central在群集模式下运行时，才必须设置此值。Tomcat发行版仅支持<em>StandaloneModeChangeHandler</em>值。</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>也可以通过使用Java标准机制将系统属性传递给JVM来设置上述属性。例如-Ddatasource.management.wildfly.port = 1234。使用此机制配置的值将覆盖datasource-management.properties文件中配置的值。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.userandgroupmgmt"><a class="anchor" href="#_wb.userandgroupmgmt"></a> <a class="link" href="#_wb.userandgroupmgmt">15.8。安全管理</a></h3>
<div class="paragraph">
<p>本节介绍管理员用户如何使用直观友好的用户界面来管理应用程序的用户，组和权限，以便配置谁可以访问可用的不同资源和功能。</p>
</div>
<div class="sect3">
<h4 id="_basic_concepts"><a class="anchor" href="#_basic_concepts"></a> <a class="link" href="#_basic_concepts">15.8.1。基本概念</a></h4>
<div class="sect4">
<h5 id="_introduction_to_business_central_users_groups_and_roles"><a class="anchor" href="#_introduction_to_business_central_users_groups_and_roles"></a> <a class="link" href="#_introduction_to_business_central_users_groups_and_roles">15.8.1.1。Business Central用户，组和角色简介</a></h5>
<div class="paragraph">
<p>Business Central安全域定义了三种实体： <em>用户</em> ， <em>组</em>和<em>角色</em> 。</p>
</div>
<div class="paragraph">
<p>通过使用某些<em>领域</em>在域中注册了安全实体。领域可以是应用程序服务器的一个领域（Wildfly，EAP，Tomcat），也可以是任何其他受支持的类型，例如，使用某些执行目标领域的Keycloak远程服务器。</p>
</div>
<div class="paragraph">
<p>另一方面，请务必注意，每个领域在安全域上都提供或可能提供其自己的功能，语义或结构。安全域上的此类差异会导致在移入Business Central安全域时不同环境之间的不一致。通过这种方式，存在一些需要理解的约定-声明安全实体的方式以及平台在这种复杂性背后的行为，</p>
</div>
<div class="paragraph">
<p>Business Central从外部领域集成安全实体的方式对应于：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>用户</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在任何受支持的安全环境（Wildfly，EAP，Tomcat，Keycloak等）中，用户而不是属性和任何其他类型的元数据（跨域可能会有所不同）代表相同类型的实体，因此该实体会导致商业中心上的用户</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>角色</strong> / <strong>小组</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>角色和组都是安全实体，但不是用户，域中的语义，行为或结构通常在整个环境中并不常见。例如，考虑存在不同时支持两者的域，或者域的组或角色的语义不同。由于它是特定于域的，因此应用程序的行为方式以及确定实体是否应视为组或角色的方式是通过检查应用程序的角色注册表来进行的。这样，如果实体的标识符出现在应用程序的角色注册表中，则该实体将被视为角色，否则该实体将被视为一个组。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>角色注册表</strong>是应用程序的组件，可在Business Central安全域中提供一组角色。通过使用在应用程序的部署描述符（ <em>web.xml</em> ）的<em>security-constraints</em>部分中声明的实体（ <em>role-name</em> ）来填充它。请参阅源文件<em>org.uberfire.ext.security.server。角色注册</em> 。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>这意味着，根据具体环境的配置，某些实体可以充当角色，取决于Business Central使用的安全环境，但是它会在Business Central安全域中产生一个组，反之亦然。通过检查角色标识符是否存在于角色注册表中，它取决于实体的标识符。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>可以将一个用户分配给多个角色和组，但是必须至少具有一个角色分配，才能在Business Central安全域中将其视为有效。例如，这并不意味着用户能够登录或能够使用远程服务，因为这取决于所分配的具体角色以及如何定义应用程序的角色和权限。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_permissions"><a class="anchor" href="#_permissions"></a> <a class="link" href="#_permissions">15.8.1.2。权限</a></h5>
<div class="paragraph">
<p>基本上，权限是用户可以在应用程序中执行的操作。通常，与特定资源有关的动作。例如：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>查看页面</p>
</li>
<li>
<p>保存项目</p>
</li>
<li>
<p>查看资料库</p>
</li>
<li>
<p>删除仪表板</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>可以授予或拒绝权限，它可以是全局的或特定于资源的。例如：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>全球：“创建新页面”</p>
</li>
<li>
<p>具体：“查看主页”</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如您所见，权限是<code>resource + action</code>对。在页面的具体情况下，我们具有： <em>读取</em> ， <em>更新</em> ， <em>删除</em>和<em>创建</em>为可用操作。这意味着可以为页面授予四种可能的权限。</p>
</div>
<div class="paragraph">
<p>权限不一定需要绑定到资源。有时也有必要保护对特定功能的访问，例如“ <em>生成销售报告</em> ”。这意味着，权限不仅可以用来保护对资源的访问，还可以用来保护应用程序中的自定义功能。</p>
</div>
</div>
<div class="sect4">
<h5 id="_authorization_policy"><a class="anchor" href="#_authorization_policy"></a> <a class="link" href="#_authorization_policy">15.8.1.3。授权政策</a></h5>
<div class="paragraph">
<p>分配给每个角色和/或组的权限集称为授权（或安全）策略。每个应用程序都包含一个安全策略，每次系统检查权限时都会使用该策略。</p>
</div>
<div class="paragraph">
<p>授权策略文件存储在应用程序WAR结构下名为<em>WEB-INF / classes / security-policy.properties</em>的文件中。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">如果未定义任何策略，则禁用授权管理功能，并且该应用程序的行为就像默认情况下所有资源和功能都已被授予一样。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>这是安全策略文件的示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># Role "admin"
role.admin.permission.perspective.read=true
role.admin.permission.perspective.read.Dashboard=false

# Role "user"
role.user.permission.perspective.read=false
role.user.permission.perspective.read.Home=true
role.user.permission.perspective.read.Dashboard=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>每个条目都定义一个分配给角色/组的权限。在应用程序启动时，策略文件将加载并存储到内存中。</p>
</div>
</div>
<div class="sect4">
<h5 id="_security_provider"><a class="anchor" href="#_security_provider"></a> <a class="link" href="#_security_provider">15.8.1.4。安全提供者</a></h5>
<div class="paragraph">
<p>通常通过使用<em>领域</em>来提供安全环境。领域用于限制对不同应用程序资源的访问。因此，领域包含有关用户，组，角色，权限和任何其他相关信息的信息。</p>
</div>
<div class="paragraph">
<p>在大多数典型方案中，应用程序的安全性委派给容器的安全性机制，该机制同时消耗给定领域。重要的是要考虑到存在多个领域实现，例如Wildfly提供了基于<em>application-users.properties</em> / <em>application-roles.properties</em>文件的领域，Tomcat提供了基于<em>tomcat-users.xml</em>文件的领域，等等。没有一个单一的安全领域可以依靠，在每个安装中它可以有所不同。</p>
</div>
<div class="paragraph">
<p>由于必须支持潜在的不同安全环境，因此安全模块提供了定义良好的API和一些默认的内置安全提供程序。<strong>安全提供程序</strong>是给定领域的具体用户和组管理服务实现的正式名称。</p>
</div>
<div class="paragraph">
<p>可用的用户和组管理功能将取决于配置的安全提供程序。如果内置提供程序不适合应用程序的安全领域，则可以轻松构建和注册自己的提供程序。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_installation_and_setup"><a class="anchor" href="#_installation_and_setup"></a> <a class="link" href="#_installation_and_setup">15.8.2。安装与设定</a></h4>
<div class="paragraph">
<p>在撰写本文时，该应用程序提供了两个预安装的安全提供程序：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Wildfly 11 / EAP 7发行版</strong> -两种发行<strong>版</strong>都使用<a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-security-management-wildfly">Wildfly安全提供程序</a> ，该<a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-security-management-wildfly">提供程序</a>配置为使用默认领域文件<em>application-users.properties</em>和<em>application-roles.properties</em></p>
</li>
<li>
<p><strong>Tomcat分发</strong> -使用为默认领域文件<em>tomcat-users.xml</em>的使用而配置的<a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-security-management-tomcat">Tomcat安全提供程序</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请阅读每个<a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">提供商的文档</a> ，以将具体设置应用于目标部署环境。</p>
</div>
<div class="paragraph">
<p>另一方面，在使用自定义安全提供程序或使用其中一个可用程序时，请考虑以下安装选项：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在现有的WAR发行版上启用安全管理功能</p>
</li>
<li>
<p>在现有或新项目中进行设置和安装</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>注意</em> ：如果未安装安全提供程序，将没有可用的用户界面来管理安全领域。安装和设置安全提供程序后，将在安全管理UI中自动启用用户和组管理功能（请参阅下面的“ <a href="#_usage">用法”</a>部分）。</p>
</div>
<div class="sect4">
<h5 id="_enabling_user_group_management"><a class="anchor" href="#_enabling_user_group_management"></a> <a class="link" href="#_enabling_user_group_management">15.8.2.1。启用用户和组管理</a></h5>
<div class="paragraph">
<p>给定现有的WAR发行版，请按照以下步骤操作，以安装并启用用户和组管理功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>确保<em>WEB-INF / lib</em>上存在以下库：</p>
<div class="ulist">
<ul>
<li>
<p>WEB-INF / lib / uberfire-security-management-api-?. jar</p>
</li>
<li>
<p>WEB-INF / lib / uberfire-security-management-backend-?. jar</p>
</li>
</ul>
</div>
</li>
<li>
<p>将安全提供程序库复制到<em>WEB-INF / lib</em> ：</p>
<div class="ulist">
<ul>
<li>
<p>例如：WEB-INF / lib / uberfire-security-management-wildfly-?. jar</p>
</li>
<li>
<p>如果提供程序需要其他库，请也将其复制（有关详细信息，请阅读每个<a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">提供程序的文档</a> ）。</p>
</li>
</ul>
</div>
</li>
<li>
<p>替换<em>WEB-INF / classes / security-management.properties</em>文件的全部内容，如果不存在，则创建它。该文件上存在的设置取决于所使用的具体实现。请阅读每个<a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">提供商的文档</a>以获取更多信息。</p>
</li>
<li>
<p>如果在Wildfly或EAP上进行部署，请检查<em>WEB-INF / jboss-deployment-structure.xml是否</em>需要任何更新（有关详细信息，请阅读每个<a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">提供程序的文档</a> ）。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_disabling_user_group_management"><a class="anchor" href="#_disabling_user_group_management"></a> <a class="link" href="#_disabling_user_group_management">15.8.2.2。禁用用户和组管理</a></h5>
<div class="paragraph">
<p>可以禁用用户和组管理功能，因此，通过以下两种方式之一，将无法使用任何服务或用户界面：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>从应用程序中卸载安全提供程序</p>
<div class="paragraph">
<p>如果未安装任何具体的安全提供程序，则将禁用用户和组管理功能，并且不会向用户显示任何服务或用户界面。例如，在<em>Weblogic</em>和<em>Websphere</em>安装中就是这种情况，因为在撰写本文<em>时尚</em>无安全提供程序实现。</p>
</div>
</li>
<li>
<p>删除或注释安全管理配置文件</p>
<div class="paragraph">
<p>删除或注释位于<em>WEB-INF / classes / security-management.properties</em>的配置文件中的所有行是禁用用户和组管理功能的另一种方法。</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_upgrading_an_existing_installation"><a class="anchor" href="#_upgrading_an_existing_installation"></a> <a class="link" href="#_upgrading_an_existing_installation">15.8.2.3。升级现有安装</a></h5>
<div class="paragraph">
<p>在7之前的版本中，授予对组织单位，存储库或项目等资源的访问权限的唯一方法是指出哪些角色可以访问给定实例。这些角色作为实例持久性状态的一部分存储在GIT中。CLI是用于添加/删除角色的工具：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>remove-role-repo</strong> ：从存储库中删除角色</p>
</li>
<li>
<p><strong>add-role-org-unit</strong> ：将角色添加到组织单位</p>
</li>
<li>
<p><strong>remove-role-org-unit</strong> ：从组织单位中删除角色</p>
</li>
<li>
<p><strong>add-role-project</strong> ：向<strong>项目</strong>添加角色</p>
</li>
<li>
<p><strong>remove-role-project</strong> ：从项目中删除角色</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>从版本7开始，授权策略基于权限。这意味着不再需要为每个资源实例保留角色列表。所需要的是使用安全管理UI在活动授权策略中定义适当的权限条目（请参阅下面的“ <a href="#_usage">用法”</a>部分）。</p>
</div>
<div class="paragraph">
<p>上面的命令不再需要，因此已被删除。基本上，这些命令的作用是设置可以读取特定项目的角色。</p>
</div>
<div class="paragraph">
<p>为了保证向后兼容7之前的版本，应用程序中捆绑了一个自动迁移工具，该工具将分配给任何组织单位，存储库或项目的角色列表转换为安全策略的读取权限条目。</p>
</div>
<div class="paragraph">
<p>在安全策略部署期间，在应用程序首次启动时执行该工具。因此，现有客户不必担心，因为他们将保留其安全设置。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_usage"><a class="anchor" href="#_usage"></a> <a class="link" href="#_usage">15.8.3。用法</a></h4>
<div class="paragraph">
<p>“安全管理”页面位于顶部菜单栏中的“ <em>主页”</em>部分下。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementMenuEntry.png" alt="安全管理菜单条目">
</div>
<div class="title">图251。链接到“安全管理”页面</div>
</div>
<div class="paragraph">
<p>下一个屏幕截图显示了此新页面的外观：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementHome.png" alt="安全管理主页">
</div>
<div class="title">图252。安全管理主页</div>
</div>
<div class="paragraph">
<p>该页面支持：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>列出所有可用的角色，组和用户</p>
</li>
<li>
<p>创建和删除用户和组</p>
</li>
<li>
<p>编辑用户，分配角色或组以及更改用户属性</p>
</li>
<li>
<p>编辑角色和组的安全设置，包括：</p>
<div class="ulist">
<ul>
<li>
<p>登录后将定向到用户的主页</p>
</li>
<li>
<p>授予或拒绝了不同Business Central资源和功能的权限</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>以上所有内容共同提供了完整的用户和组管理子系统，以及用于保护对特定资源或功能的访问的权限配置UI。</p>
</div>
<div class="paragraph">
<p>下一节将深入了解所有这些功能。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">可以完全禁用与用户和组管理相关的功能。请参阅上一节“ <a href="#_disabling_user_group_management">禁用用户和组管理”</a> 。如果是这种情况，则“ <em>组”和“ _用户”</em>选项卡都将对用户隐藏。
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="_user_management"><a class="anchor" href="#_user_management"></a> <a class="link" href="#_user_management">15.8.3.1。用户管理</a></h5>
<div class="paragraph">
<p>通过选择左侧栏中的“ <em>用户”</em>选项卡，应用程序将显示默认情况下出现在应用程序安全领域中的所有用户：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementUsersExplorer.png" alt="安全管理用户浏览器">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>搜索用户</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>除了列出所有用户之外，还可以进行搜索：</p>
</div>
<div class="paragraph">
<p>+在搜索框中指定搜索模式时，列出的用户将减少为仅与搜索模式匹配的用户。</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementUsersSearch.png" alt="安全管理用户搜索">
</div>
</div>
<div class="paragraph">
<p>+搜索模式取决于应用程序所使用的具体安全提供程序。请阅读每个<a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">提供商的文档</a>以获取更多信息。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>创建新用户</strong></p>
<div class="paragraph">
<p>通过单击“ <em>新用户+</em> ”锚点，屏幕右侧将显示一个表单。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementNewUserForm.png" alt="安全管理新用户表单">
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>这是一个类似于界面的向导，在该界面中，应用程序要求输入新的用户名，密码以及要分配的角色/组。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>编辑用户</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>单击左侧边栏中的用户后，将在屏幕右侧打开用户编辑器。</p>
</div>
<div class="paragraph">
<p>例如，使用Wildfly安全提供程序时， <em>管理员</em>用户的详细信息屏幕如下图所示：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementViewUser.png" alt="安全管理视图用户">
</div>
</div>
<div class="paragraph">
<p>屏幕相同，但使用Keycloak安全提供程序时的外观如下：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementViewUserKC.png" alt="SecurityManagementViewUserKC">
</div>
</div>
<div class="paragraph">
<p>请注意，在使用Keycloak提供程序时，会显示一个新的用户属性部分，但在使用Wildfly提供程序时则不存在。这是由于如下事实：可用的信息和操作始终取决于每个提供程序的功能，如下面的“ <a href="#_security_provider_capabilities">安全提供程序功能”</a>部分所述。</p>
</div>
<div class="paragraph">
<p>接下来是在用户的详细信息屏幕中处理的信息类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>用户名</p>
</li>
<li>
<p>用户的属性</p>
</li>
<li>
<p>分配的组</p>
</li>
<li>
<p>分配的角色</p>
</li>
<li>
<p>授予或拒绝的权限</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>为了<strong>更新或删除现有用户</strong> ，请在用户编辑器屏幕中单击用户名旁边的“ <em>编辑”</em>按钮：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementEditUser.png" alt="安全管理编辑用户">
</div>
</div>
<div class="paragraph">
<p>编辑器处于编辑模式后，可以执行不同的操作（只要安全提供程序支持它们）：</p>
</div>
<div class="paragraph">
<p>例如，修改分配给用户的角色和组的集合，或者也更改用户的密码。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>权限摘要</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>权限</em>选项卡显示分配给该特定用户的所有权限的摘要。这是非常有用的视图，因为它允许管理员用户根据其角色和组的安全设置来验证目标用户是否具有正确的权限级别。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementUserPermissions.png" alt="安全管理用户权限">
</div>
</div>
<div class="paragraph">
<p>有关如何为角色和组分配权限的更多详细信息，请参见下面的“ <a href="#_security_settings_editor">安全设置编辑器”</a>部分。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>更新用户的属性</strong></p>
<div class="paragraph">
<p>可以使用属性表中可用的操作来添加或删除用户属性：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementUserAttributes.png" alt="SecurityManagementUserAttributes">
</div>
</div>
</li>
<li>
<p><strong>更新分配的组</strong></p>
<div class="paragraph">
<p>单击“ <em>添加到组”</em>按钮时，从“ <em>组”</em>选项卡中将显示一个组选择弹出窗口：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementGroupsSelection.png" alt="安全管理组选择">
</div>
</div>
<div class="paragraph">
<p>该弹出屏幕允许用户搜索并选择或取消选择分配给该用户的组。</p>
</div>
</li>
<li>
<p><strong>更新分配的角色</strong></p>
<div class="paragraph">
<p>单击“ <em>添加到角色”</em>按钮时，从“ <em>角色”</em>选项卡中将显示一个角色选择弹出窗口：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementRolesSelection.png" alt="安全管理角色选择">
</div>
</div>
<div class="paragraph">
<p>该弹出屏幕允许用户搜索和选择或取消选择分配给该用户的角色。</p>
</div>
</li>
<li>
<p><strong>修改用户密码</strong></p>
<div class="paragraph">
<p>单击<em>更改密码</em>按钮时，将<em>显示</em>一个更改密码弹出屏幕：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementChangePassword.png" alt="安全管理更改密码">
</div>
</div>
</li>
<li>
<p><strong>删除用户</strong></p>
<div class="paragraph">
<p>单击“ <em>删除”</em>按钮可以将当前正在编辑的用户从领域中<em>删除</em> 。</p>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementDeleteUser.png" alt="安全管理删除用户">
</div>
</div>
<div class="sect5">
<h6 id="_security_provider_capabilities"><a class="anchor" href="#_security_provider_capabilities"></a> <a class="link" href="#_security_provider_capabilities">安全提供者功能</a></h6>
<div class="paragraph">
<p>每个安全领域都可以为不同的操作提供支持。例如，考虑基于属性文件使用Wildfly领域。<em>applications-users.properties</em>的内容如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>admin=207b6e0cc556d7084b5e2db7d822555c
salaboy=d4af256e7007fea2e581d539e05edd1b
maciej=3c8609f5e0c908a8c361ca633ed23844
kris=0bfd0f47d4817f2557c91cbab38bb92d
katy=fd37b5d0b82ce027bfad677a54fbccee
john=afda4373c6021f3f5841cd6c0a027244
jack=984ba30e11dda7b9ed86ba7b73d01481
director=6b7f87a92b62bedd0a5a94c98bd83e21
user=c5568adea472163dfc00c19c6348a665
guest=b5d048a237bfd2874b6928e1f37ee15e
kiewb=78541b7b451d8012223f29ba5141bcc2
kieserver=16c6511893651c9b4b57e0c027a96075</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意，它基于键值对，其中键是<em>用户名</em> ，值是用户<em>password</em>的哈希值。因此，用户仅由键及其用户名表示，它没有名称，地址或任何其他元信息。</p>
</div>
<div class="paragraph">
<p>另一方面，请考虑使用Keycloak服务器提供的领域。用户信息由更多的元数据组成，例如姓氏，地址等，如下图所示：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementViewUserKC.png" alt="SecurityManagementViewUserKC">
</div>
</div>
<div class="paragraph">
<p>因此，来自用户和组管理API的不同服务和客户端组件均基于<em>功能</em> 。<strong>功能</strong>用于公开或限制由不同服务和客户端组件提供的可用功能。功能示例包括：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>创建一个用户</p>
</li>
<li>
<p>更新用户</p>
</li>
<li>
<p>删除用户</p>
</li>
<li>
<p>更新用户的属性</p>
</li>
<li>
<p>建立群组</p>
</li>
<li>
<p>更新群组</p>
</li>
<li>
<p>为用户分配组</p>
</li>
<li>
<p>为用户分配角色</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>每个安全提供者必须指定一组支持的功能。从前面的示例中可以注意到，Wildfly安全提供程序不支持属性管理功能-用户仅由用户名组成。另一方面，Keycloak提供程序确实支持此功能。</p>
</div>
<div class="paragraph">
<p>不同的视图和用户界面组件依赖于每个提供程序支持的功能，因此，如果使用中的提供程序不支持该功能，则UI不会提供用于管理该功能的视图。例如，请考虑一个具体的提供者不支持删除用户-用户界面上的删除用户按钮将不可用。</p>
</div>
<div class="paragraph">
<p>请查看具体的服务提供商文档，以检查每种支持的所有功能，可以在<a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">此处</a>找到默认功能。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_group_management"><a class="anchor" href="#_group_management"></a> <a class="link" href="#_group_management">15.8.3.2。集团管理</a></h5>
<div class="paragraph">
<p>通过选择左侧栏中的“ <em>组”</em>选项卡，应用程序将显示默认情况下存在于应用程序安全领域中的所有组：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementGroupsExplorer.png" alt="安全管理组资源管理器">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>搜索组</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>除了列出所有组外，还可以搜索：</p>
</div>
<div class="paragraph">
<p>+在搜索框中指定搜索模式时，列出的组将减少为仅与搜索模式匹配的组。</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementGroupsSearch.png" alt="安全管理组搜索">
</div>
</div>
<div class="paragraph">
<p>+搜索模式取决于应用程序所使用的具体安全提供程序。请阅读每个<a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">提供商的文档</a>以获取更多信息。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>建立新群组</strong></p>
<div class="paragraph">
<p>通过单击“ <em>New group +</em> ”锚，将在中央面板上显示一个新屏幕以执行新的组创建。</p>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementNewGroup.png" alt="安全管理新组">
</div>
</div>
<div class="paragraph">
<p>输入名称并单击<em>Save之后</em> ，下一步是为其分配用户：</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementNewGroupUserSelection.png" alt="安全管理新组用户选择">
</div>
</div>
<div class="paragraph">
<p>+单击“ <em>添加选定的用户</em> ”按钮，完成组创建。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>修改组</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>单击左侧栏中的组后，将在屏幕的右侧打开所选组实例的安全设置编辑器。“ <a href="#_security_settings_editor">安全设置编辑器”</a>部分中的更多详细信息。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>删除群组</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>要删除现有组，只需单击“ <em>删除”</em>按钮。</p>
</div>
</div>
<div class="sect4">
<h5 id="_role_management"><a class="anchor" href="#_role_management"></a> <a class="link" href="#_role_management">15.8.3.3。角色管理</a></h5>
<div class="paragraph">
<p>通过选择左侧栏中的“ <em>角色”</em>选项卡，该应用程序将显示所有应用程序角色：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementRolesExplorer.png" alt="安全管理角色浏览器">
</div>
</div>
<div class="paragraph">
<p>与用户和组不同，角色无法创建或删除，因为它们来自应用程序的web.xml描述符。单击左侧栏中的角色后，将在屏幕的右侧打开角色编辑器，该编辑器与用于组的安全设置编辑器完全相同。“ <a href="#_security_settings_editor">安全设置编辑器”</a>部分中的更多详细信息。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementEditRole.png" alt="安全管理编辑角色">
</div>
</div>
<div class="paragraph">
<p>这意味着可以定义基于角色和基于组的权限。角色和组之间的主要区别是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>角色是应用程序定义的资源。它们被定义为<security-role>应用程序的web.xml描述符中的条目。</security-role></p>
</li>
<li>
<p>组是动态的，可以在运行时定义。已安装的安全提供程序确定组实例的存储位置。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>它们可以一起使用而没有任何麻烦。尽管还是建议使用组，因为组比角色更灵活。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>搜索角色</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>除了列出所有角色，还可以进行搜索：</p>
</div>
<div class="paragraph">
<p>+在搜索框中指定搜索模式时，列出的角色将减少为仅与搜索模式匹配的角色。</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementRolesSearch.png" alt="安全管理角色搜索">
</div>
</div>
<div class="paragraph">
<p>+搜索模式取决于应用程序所使用的具体安全提供程序。请阅读每个<a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">提供商的文档</a>以获取更多信息。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_security_settings_editor"><a class="anchor" href="#_security_settings_editor"></a> <a class="link" href="#_security_settings_editor">15.8.4。安全设置编辑器</a></h4>
<div class="paragraph">
<p>该编辑器用于为角色和组设置多个安全设置。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementSecuritySettsEditor.png" alt="安全管理安全设置编辑器">
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="sect4">
<h5 id="_home_page"><a class="anchor" href="#_home_page"></a> <a class="link" href="#_home_page">15.8.4.1。主页</a></h5>
<div class="paragraph">
<p>这是登录后将用户定向到的页面。由于可以将用户分配给不同的角色或组，因此可以为不同的用户提供不同的主页。</p>
</div>
</div>
<div class="sect4">
<h5 id="_priority"><a class="anchor" href="#_priority"></a> <a class="link" href="#_priority">15.8.4.2。优先</a></h5>
<div class="paragraph">
<p>它用于确定那些分配了多个角色或组的用户优先使用哪些设置（主页，权限等）。</p>
</div>
<div class="paragraph">
<p>没有此设置，将无法确定哪个角色/组应优先。例如，管理角色比非管理角色具有更高的优先级。对于同时授予管理角色和非管理角色的用户，只要管理角色的优先级大于其他角色，则将始终获得管理特权。</p>
</div>
</div>
<div class="sect4">
<h5 id="_permissions_2"><a class="anchor" href="#_permissions_2"></a> <a class="link" href="#_permissions_2">15.8.4.3。权限</a></h5>
<div class="paragraph">
<p>当前，Business Central支持以下权限类别。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>业务中心：常规的业务中心权限，不与任何特定资源类型绑定。</p>
</li>
<li>
<p>页面：如果拒绝访问页面，则该页面将不会显示在任何应用程序菜单中。更新，删除和创建权限会更改页面管理插件编辑器的行为。</p>
</li>
<li>
<p>组织单位：设置谁可以从“管理”页面的“组织单位”部分创建，更新或删除组织单位。还可以在“项目创作”页面的“项目浏览器”中设置哪些组织单位可见。</p>
</li>
<li>
<p>存储库：设置谁可以在“管理”页面的“存储库”部分中创建，更新或删除存储库。还在项目创作页面的项目浏览器中设置可见的存储库。</p>
</li>
<li>
<p>项目：在“项目创作”页面中，设置可以在“项目编辑器”屏幕上创建，更新，删除或构建项目的人员，以及可以在“项目资源管理器”中看到哪些项目。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>对于页面，组织单位，存储库和项目，可以定义全局权限并随后添加单个实例异常。例如，可以授予所有页面<em>读取</em>权限，而拒绝仅访问单个页面。这就是所谓的<em>全都否认一些</em>策略。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementPerspectiveDenied.png" alt="安全管理观点被拒绝">
</div>
</div>
<div class="paragraph">
<p>相反，也<em>否认所有授予一些</em>策略：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementPerspectiveGranted.png" alt="授予安全管理观点">
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">在上面的示例中，“ <em>更新”</em>和“ <em>删除”</em>权限被禁用，因为如果用户甚至无法阅读页面，则定义此类权限就没有意义。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_security_policy_storage"><a class="anchor" href="#_security_policy_storage"></a> <a class="link" href="#_security_policy_storage">15.8.5。安全策略存储</a></h4>
<div class="paragraph">
<p>安全策略存储在Business Central VFS下。最具体的是在称为“安全”的GIT回购中。ACL表存储在“ authz”目录下名为“ security-policy.properties”的文件中。接下来是此文件包含的条目的示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>role.admin.home=HomePage
role.admin.priority=0
role.admin.permission.perspective.read=true
role.admin.permission.perspective.create=true
role.admin.permission.perspective.delete=true
role.admin.permission.perspective.update=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>每次从安全设置UI修改ACL时，所做的更改都会存储到GIT存储库中。</p>
</div>
<div class="paragraph">
<p>最初，当首次部署应用程序时，GIT中没有存储安全策略。但是，应用程序可能需要为每个应用程序角色设置具有不同访问配置文件的默认策略。</p>
</div>
<div class="paragraph">
<p>为了支持默认策略，系统允许将安全策略声明为Webapp内容的一部分。只需在Web应用程序的资源类路径下放置一个security-policy.properties文件即可完成此操作（WAR存档中的WEB-INF / classes目录是有效目录）。在应用启动时，执行以下步骤：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>检查活动策略是否已存储在GIT中</p>
</li>
<li>
<p>如果不是，则检查是否在webapp的类路径下定义了策略</p>
</li>
<li>
<p>如果找到，则该策略存储在GIT下</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>上面是一种自动部署机制，在Business Central中使用该机制来设置其默认安全策略。</p>
</div>
<div class="paragraph">
<p>部署过程的一个细微变化是能够将“ security-policy.properties”文件拆分为小块，以便例如可以为每个角色定义一个文件。拆分文件必须以“ security-module-”前缀开头，例如：“ security-module-admin.properties”。部署机制将读取和部署在类路径上找到的“ security-policy.properties”和所有可选的“ security-module-?. properties”。</p>
</div>
<div class="paragraph">
<p>请注意，尽管使用了拆分方法，但“ security-policy.properties”必须始终存在，因为安全子系统将其用作标记文件，以便找到其他策略文件。这种拆分机制可以更好地组织整个安全策略。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.sshkeystore"><a class="anchor" href="#_wb.sshkeystore"></a> <a class="link" href="#_wb.sshkeystore">15.9。SSH密钥库</a></h3>
<div class="paragraph">
<p>本节概述了Business Central SSH密钥库，并包括针对平台用户的指南。它说明了如何使用Business Central SSH密钥库注册和使用它的SSH公钥。</p>
</div>
<div class="sect3">
<h4 id="_introduction_4"><a class="anchor" href="#_introduction_4"></a> <a class="link" href="#_introduction_4">15.9.1。介绍</a></h4>
<div class="paragraph">
<p>Business Central包含SSH密钥库服务，以为用户提供正确的SSH身份验证。</p>
</div>
<div class="paragraph">
<p>它提供了一个可配置的默认SSH密钥库，可扩展的API以允许自定义实现，支持多种SSH公共密钥格式以及“ <strong>管理”</strong>页面上提供了一个新的UI，以使用户能够注册其SSH公共密钥。</p>
</div>
<div class="sect4">
<h5 id="_the_default_ssh_keystore"><a class="anchor" href="#_the_default_ssh_keystore"></a> <a class="link" href="#_the_default_ssh_keystore">15.9.1.1。默认的SSH密钥库</a></h5>
<div class="paragraph">
<p>Business Central随附的默认SSH密钥库提供了基于文件的存储机制，用于存储用户的SSH公共密钥。</p>
</div>
<div class="paragraph">
<p>默认情况下，它使用Business Central <code>.security</code>文件夹作为根路径。通过设置以下选项，可以使用自定义存储路径<code>appformer.ssh.keys.storage.folder</code>属性以定向到另一个文件夹。</p>
</div>
<div class="paragraph">
<p>SSH公钥存储在<code>{securityFolderPath}/pkeys/{userName}/</code>文件夹结构。</p>
</div>
<div class="paragraph">
<p>每个SSH公钥均由存储文件夹中的一对文件组成：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>{keyId} .pub</strong> ：包含SSH公钥内容的文件。该文件名确定系统上的逻辑键ID，因此在运行时不要修改文件名。例如</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDmak4Wu23RZ6XmN94bOsqecZxuTa4RRhhQmHmTZjMB7HM57/90u/B/gB/GhsPEu1nAXL0npY56tT/MPQ8vRm2C2W9A7CzN5+z5yyL3W01YZy3kzslk77CjULjfhrcfQSL3b2sPG5jv5E5/nyC/swSytucwT/PE7aXTS9H6cHIKUdYPzIt94SHoBxWRIK7PJi9d+eLB+hmDzvbVa1ezu5a8yu2kcHi6NxxfI5iRj2rsceDTp0imC1jMoC6ZDfBvZSxL9FXTMwFdNnmTlJveBtv9nAbnAvIWlilS0VOkdj1s3GxBxeZYAcKbcsK9sJzusptk5dxGsG2Z8vInaglN6OaOQ7b7tcomzCYYwviGQ9gRX8sGsVrw39gsDIGYP2tA4bRr7ecHnlNg1b0HCchA5+QCDk4Hbz1UrnHmPA2Lg9c3WGm2qedvQdVJXuS3mlwYOqL40aXPs6890PvFJUlpiVSznF50djPnwsMxJZEf1HdTXgZD1Bh54ogZf7czyUNfkNkE69yJDbTHjpQd0cKUQnu9tVxqmBzhX31yF4VcsMeADcf2Z8wlA3n4LZnC/GwonYlq5+G93zJpFOkPhme8c2XuPuCXF795lsxyJ8SB/AlwPJAhEtm0y0s0l1l4eWqxsDxkBOgN+ivU0czrVMssHJEJb4o0FLf7iHhOW56/iMdD9w== userName</code></pre>
</div>
</div>
</li>
<li>
<p><strong>。{keyId} .pub.meta</strong> ：包含JSON格式的密钥元数据的文件。如果键没有元数据，则会动态生成一个新的元数据文件。例如：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "name":"Key",
    "creationDate":"Oct 10, 2018 10:10:50 PM",
    "lastTimeUsed":"Oct 11, 2018 12:11:23 PM"
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_using_a_custom_ssh_keystore"><a class="anchor" href="#_using_a_custom_ssh_keystore"></a> <a class="link" href="#_using_a_custom_ssh_keystore">15.9.1.2。使用自定义SSH密钥库</a></h5>
<div class="paragraph">
<p>可以扩展和定制平台默认的SSH密钥库，以满足更多特定要求。</p>
</div>
<div class="paragraph">
<p>使用系统属性<code>appformer.ssh.keystore</code>指定要使用的服务的Java类名称。如果该属性不存在或包含错误的值，则将加载默认的SSH密钥库。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>要创建SSH密钥库的自定义实现，您的Java类必须实现该类<code>org.uberfire.ssh.service.backend.keystore.SSHKeyStore</code>在定义<code>uberfire-ssh-api</code>模块。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_ssh_keystore"><a class="anchor" href="#_using_the_ssh_keystore"></a> <a class="link" href="#_using_the_ssh_keystore">15.9.2。使用SSH密钥库</a></h4>
<div class="paragraph">
<p>本节介绍如何使用SSH密钥库注册自己的密钥以及如何使用它们。</p>
</div>
<div class="sect4">
<h5 id="_the_ssh_keystore_ui"><a class="anchor" href="#_the_ssh_keystore_ui"></a> <a class="link" href="#_the_ssh_keystore_ui">15.9.2.1。SSH密钥库用户界面</a></h5>
<div class="paragraph">
<p>SSH密钥库提供了一个直观的UI，使用户能够在系统上管理其SSH公共密钥。使用“ <strong>SSH密钥”</strong>菜单选项可从“ <strong>管理”</strong>页面进行访问。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-menu.png" alt="ssh密钥库菜单">
</div>
<div class="title">图253。管理员页面上的SSH密钥菜单选项</div>
</div>
<div class="paragraph">
<p>单击“ <strong>SSH密钥”</strong>菜单选项后，“ SSH密钥编辑器”将打开。编辑器将显示一个显示用户SSH公共密钥的表，并提供对主要操作按钮的访问。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>添加SSH密钥</strong> ：用于为用户添加SSH公共密钥。</p>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-editor-new.png" alt="ssh密钥库编辑器新">
</div>
<div class="title">图254。添加新的SSH公钥</div>
</div>
</li>
<li>
<p><strong>删除SSH密钥</strong> ：用于删除现有的SSH公共密钥</p>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-editor-delete.png" alt="ssh密钥库编辑器删除">
</div>
<div class="title">图255。删除SSH公钥</div>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-editor.png" alt="ssh密钥库编辑器">
</div>
<div class="title">图256。SSH密钥库用户界面</div>
</div>
</div>
<div class="sect4">
<h5 id="_adding_ssh_keys"><a class="anchor" href="#_adding_ssh_keys"></a> <a class="link" href="#_adding_ssh_keys">15.9.2.2。添加SSH密钥</a></h5>
<div class="paragraph">
<p>本节逐步说明如何将SSH公钥添加到SSH密钥库。</p>
</div>
<div class="sect5">
<h6 id="_creating_the_ssh_key_on_your_computer"><a class="anchor" href="#_creating_the_ssh_key_on_your_computer"></a> <a class="link" href="#_creating_the_ssh_key_on_your_computer">在计算机上创建SSH密钥</a></h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>打开计算机上的终端</p>
</li>
<li>
<p>跑过<code>ssh-keygen</code>创建密钥的命令：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">ssh-keygen -t rsa -b 4096 -C "&lt;your_user_login_here&gt;"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>密钥库支持的SSH密钥格式为“ ssh-rsa”，“ ssh-dss”，“ ecdsa-sha2-nistp256”，“ ecdsa-sha2-nistp384”和“ ecdsa-sha2-nistp521”。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>出现提示时，按<strong>Enter键</strong>并接受默认的密钥文件位置。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Enter a file in which to save the key (/home/&lt;your_login_here&gt;/.ssh/id_rsa): [Press enter]</code></pre>
</div>
</div>
</li>
<li>
<p>出现提示时，输入要使用的密码。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Enter passphrase (empty for no passphrase): [Type a passphrase]
Enter same passphrase again: [Type passphrase again]</code></pre>
</div>
</div>
</li>
<li>
<p>开始<code>ssh-agent</code> ：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">eval "$(ssh-agent -s)"
Agent pid &lt;any-number-here&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>将新的SSH私钥添加到<code>ssh-agent</code> 。如果您使用其他键名，请替换<code>id_rsa</code>用你的键名</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">ssh-add ~/.ssh/id_rsa</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_registering_your_ssh_public_key_with_the_ssh_keystore"><a class="anchor" href="#_registering_your_ssh_public_key_with_the_ssh_keystore"></a> <a class="link" href="#_registering_your_ssh_public_key_with_the_ssh_keystore">使用SSH密钥库注册SSH公共密钥</a></h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在Business Central中，转到登录旁边的齿轮图标以打开“ <strong>管理”</strong>页面。</p>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-editor-gear.png" alt="ssh密钥库编辑器齿轮">
</div>
<div class="title">图257。访问管理页面</div>
</div>
</li>
<li>
<p>通过单击“ <strong>SSH密钥”</strong>菜单选项打开SSH密钥存储区UI。</p>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-menu.png" alt="ssh密钥库菜单">
</div>
<div class="title">图258。管理员页面上的SSH密钥菜单选项</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-editor-empty.png" alt="ssh密钥库编辑器为空">
</div>
<div class="title">图259。没有密钥的SSH KeysStore UI</div>
</div>
</li>
<li>
<p>将SSH公钥的内容复制到剪贴板上。使用<code>cat</code>命令显示您的关键内容。如果您使用其他键名：请替换<code>id_rsa</code>与您的密钥名称，并复制它。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cat ~/.ssh/id_rsa.pub</code></pre>
</div>
</div>
</li>
<li>
<p>在SSH密钥库用户界面中，按<strong>添加SSH密钥</strong>按钮以打开“ <strong>新建SSH公共密钥”</strong>表单。指定名称，将密钥内容复制到密钥字段中，然后单击“ <strong>添加SSH密钥”</strong>以注册密钥。</p>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-editor-new.png" alt="ssh密钥库编辑器新">
</div>
<div class="title">图260。添加新的SSH公钥</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p><strong>名称</strong>字段不能为空，此字段为用户定义了有意义的名称，以标识SSH公共密钥表上的密钥。</p>
</li>
<li>
<p><strong>密钥</strong>必须是有效的SSH公共密钥，因此不能为空，并且平台必须支持密钥格式。</p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.embedding"><a class="anchor" href="#_wb.embedding"></a> <a class="link" href="#_wb.embedding">15.10。在您的应用程序中嵌入Business Central</a></h3>
<div class="paragraph">
<p>除了各个方面（例如库或内容管理）之外，Business Central还提供了许多用于设计和管理不同格式资产的编辑器。在Business Central中，每种资产类型都有一个对应的编辑器。</p>
</div>
<div class="paragraph">
<p>Business Central提供了使用<strong>独立模式</strong>将透视图和编辑器嵌入到用户应用程序中的可能性。无需实际切换到Business Central，就可以在单独的应用程序中显示透视图并编辑各种资产，例如规则，流程或决策表。</p>
</div>
<div class="paragraph">
<p>要将Business Central的一部分嵌入到应用程序中，必须在Web服务器或应用程序服务器上部署并运行Business Central。然后，在您的应用程序中，包括一个带有适当的HTTP查询参数的<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe">HTML内联框架</a> ，如下表所述。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表43。独立模式的HTTP查询参数</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">参数</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">价值观</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>standalone</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">此参数必须包含在独立模式下将使用的透视图或编辑器的每个URL中。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>perspective</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>LibraryPerspective</code> ， <code>ContentManagerPerspective</code> ，或任何自定义创建的页面</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用于指定要显示的透视图。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>header</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>UberfireBreadcrumbsContainer</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">在页面顶部显示面包屑，可用于导航到库中的空间和项目列表。仅在以下情况下可以使用此参数<code>perspective=LibraryPerspective</code>已指定。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>path</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>default://master@MySpace/Shop/src/main/java/com/Product.java</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">指定要在相应编辑器中打开的资产的路径。路径必须以以下格式指定<code>default://<em>BRANCH</em>@<em>SPACE</em>/<em>PROJECT</em>/<em>PATH_TO_ASSET</em>/<em>ASSET_NAME</em>.<em>FILE_EXTENSION</em></code> 。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表44。用法示例</caption>
<colgroup>
<col style="width:50%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">网址</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><a href="http://localhost:8080/business-central/kie-wb.jsp?standalone&perspective=LibraryPerspective" class="bare">http：// localhost：8080 / business-central / kie-wb.jsp？standalone＆perspective = LibraryPerspective</a></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">打开库，可以在其中选择要管理的项目。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><a href="http://localhost:8080/business-central/kie-wb.jsp?standalone&perspective=LibraryPerspective&header=UberfireBreadcrumbsContainer" class="bare">http：// localhost：8080 / business-central / kie-wb.jsp？standalone＆perspective = LibraryPerspective＆header = UberfireBreadcrumbsContainer</a></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用项目列表打开库。的<code>header</code>参数在页面顶部显示面包屑，允许用户在空格和项目之间切换。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><a href="http://localhost:8080/business-central/kie-wb.jsp?standalone&path=default://master@MySpace/Shop/src/main/java/com/Product.java" class="bare">http：// localhost：8080 / business-central / kie-wb.jsp？standalone＆path = default：//master@MySpace/Shop/src/main/java/com/Product.java</a></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">打开指定资产的编辑器。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><a href="http://localhost:8080/business-central/kie-wb.jsp?standalone&perspective=ContentManagerPerspective" class="bare">http：// localhost：8080 / business-central / kie-wb.jsp？standalone＆perspective = ContentManagerPerspective</a></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">打开“内容管理”透视图，可以在其中创建和管理自定义页面。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><a href="http://localhost:8080/business-central/kie-wb.jsp?standalone&perspective=MyCustomPage" class="bare">http：// localhost：8080 / business-central / kie-wb.jsp？standalone＆perspective = MyCustomPage</a></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">打开使用“内容管理”透视图之前已创建的指定自定义页面。的价值<code>perspective</code>参数必须与页面的实际名称相对应。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_wb.execserverui"><a class="anchor" href="#_wb.execserverui"></a> <a class="link" href="#_wb.execserverui">15.11。执行服务器管理UI</a></h3>
<div class="paragraph">
<p>执行服务器管理UI允许用户创建和修改服务器模板和容器，还允许用户管理远程服务器。可通过部署→规则部署菜单访问此屏幕。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ExecServer/NewExecServerUI.png" alt="NewExecServerUI">
</div>
<div class="title">图261。执行服务器管理</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>管理UI仅适用于KIE受管服务器。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="_wb.execserveruitemplate"><a class="anchor" href="#_wb.execserveruitemplate"></a> <a class="link" href="#_wb.execserveruitemplate">15.11.1。服务器模板</a></h4>
<div class="paragraph">
<p>服务器模板用于定义可用于多台服务器的通用配置，因此名称为：模板。</p>
</div>
<div class="paragraph">
<p>服务器模板可以直接从管理UI创建，也可以在服务器连接到Drools控制器并且该远程服务器没有模板定义时自动创建。服务器模板可能具有一个或多个功能，这些功能无法修改，如果您需要修改功能，则必须创建一个新模板。这是当前功能的列表：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>规则（流口水）</p>
</li>
<li>
<p>流程（jBPM）</p>
</li>
<li>
<p>规划（Optaplanner）</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>对于Planner功能，也必须启用Rule的功能。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>为了创建新的服务器模板，您必须单击“新建服务器模板”按钮，然后按照向导进行操作。也可以在向导中创建一个容器，但是现在我们只限于模板。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ExecServer/NewServerTemplateWizard.png" alt="NewServerTemplateWizard">
</div>
<div class="title">图262。新服务器模板向导</div>
</div>
<div class="paragraph">
<p>创建后，您将在左侧列出新模板，突出显示新服务器模板。在右侧，您将获得第二级导航，该导航列出了与所选服务器模板相关的容器和远程服务器。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ExecServer/ServerTemplates.png" alt="服务器模板">
</div>
<div class="title">图263。服务器模板</div>
</div>
<div class="paragraph">
<p>在导航的顶部还可以删除当前的服务器模板或创建其副本。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ExecServer/ServerTemplateActions.png" alt="ServerTemplateActions">
</div>
<div class="title">图264。服务器模板动作</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.execserveruicontainer"><a class="anchor" href="#_wb.execserveruicontainer"></a> <a class="link" href="#_wb.execserveruicontainer">15.11.2。容器</a></h4>
<div class="paragraph">
<p>容器是服务器模板的KIE容器配置。单击添加容器按钮为当前服务器模板创建一个新容器。</p>
</div>
<div class="paragraph">
<p>搜索区域可以帮助用户找到他们要查找的特定KJAR。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ExecServer/NewContainerWizard.png" alt="新容器向导">
</div>
<div class="title">图265。新容器向导</div>
</div>
<div class="paragraph">
<p>对于启用了“过程”功能的服务器模板，向导具有第二个可选步骤，用户可以在其中配置一些与过程相关的行为。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ExecServer/ProcessConfigNewContainerWizard.png" alt="ProcessConfigNewContainerWizard">
</div>
<div class="title">图266。工艺配置</div>
</div>
<div class="paragraph">
<p><strong>Kie Base Name</strong>确定将使用部署的工件的哪个Kie Base。</p>
</div>
<div class="paragraph">
<p><strong>Kie会话名称</strong>确定将使用所选Kie Base的哪个Kie会话。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>请注意，仅当已部署的项目包含某些业务流程时，此选项卡上的配置才会生效。如果服务器模板启用了进程扩展名是不够的。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>创建新容器后，新容器将显示在远程服务器列表上方的容器列表中。刚创建完容器后，默认情况下为“已停止”，这是允许用户删除容器的唯一状态。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ExecServer/NewContainer.png" alt="新容器">
</div>
<div class="title">图267。容器</div>
</div>
<div class="paragraph">
<p>容器具有以下选项卡可用于管理和/或配置：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>状态</p>
</li>
<li>
<p>版本配置</p>
</li>
<li>
<p>工艺配置</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>“状态”选项卡列出了所有正在运行活动容器的远程服务器。每个远程服务器都呈现为卡，向用户显示状态和终结点。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>只有启动的容器才部署到远程服务器。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ExecServer/ContainerStatus.png" alt="容器状态">
</div>
<div class="title">图268。状态容器</div>
</div>
<div class="paragraph">
<p>对于不具有处理能力的容器，“版本配置”选项卡允许用户更改容器的当前版本。用户可以使用“升级”按钮手动升级到特定版本，或启用/禁用扫描仪。还可以执行“立即扫描”操作，该操作仅扫描一次新版本。</p>
</div>
<div class="paragraph">
<p>要使用最新更改重新部署SNAPSHOT kjar，必须首先删除该版本的所有现有容器。然后执行“构建和部署”将创建一个带有最新SNAPSHOT kjar的容器。但是，这对于发行版本是不可能的。如果kjar的GAV不在，但在发布Maven之后，必须将GAV更新到较新的发行版并部署到其自己的容器中。如果容器不具备处理能力，则新版本也可以用于升级现有容器，如前所述。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ExecServer/ContainerVersionConfiguration.png" alt="ContainerVersionConfiguration">
</div>
<div class="title">图269。版本配置</div>
</div>
<div class="paragraph">
<p>进程配置与具有进程功能的模板服务器的新建容器向导中显示的表单相同。如果Template Server不具备此功能，则将禁用操作按钮。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ExecServer/ContainerProcessConfiguration.png" alt="ContainerProcessConfiguration">
</div>
<div class="title">图270。工艺配置</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.execserveruiremoteserver"><a class="anchor" href="#_wb.execserveruiremoteserver"></a> <a class="link" href="#_wb.execserveruiremoteserver">15.11.3。远端伺服器</a></h4>
<div class="paragraph">
<p>远程服务器是正在运行的托管KIE Server实例，该实例已配置了Drools控制器。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>默认情况下，Business Central内置了Drools控制器。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>远程服务器列表显示在容器列表的正下方。选择后，屏幕将显示“远程服务器”详细信息和卡列表，每个卡代表一个正在运行的容器。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ExecServer/RemoteServers.png" alt="远程服务器">
</div>
<div class="title">图271。远端伺服器</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.experimentalFeatures"><a class="anchor" href="#_wb.experimentalFeatures"></a> <a class="link" href="#_wb.experimentalFeatures">15.12。实验功能框架</a></h3>
<div class="paragraph">
<p>本部分介绍了<em>实验功能框架</em>功能以及使用方法。</p>
</div>
<div class="sect3">
<h4 id="_introduction_5"><a class="anchor" href="#_introduction_5"></a> <a class="link" href="#_introduction_5">15.12.1。介绍</a></h4>
<div class="paragraph">
<p><em>实验功能框架</em>是一项平台服务，允许开发人员提供仍不属于Business Central的功能（例如正在进行的开发，技术预览，POC ...），并将这些功能提供给用户以使他们可以预览什么将来会来。</p>
</div>
<div class="paragraph">
<p><em>实验功能框架</em>提供以下功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>可以在<strong>管理</strong>页面上访问的新编辑器用户界面，用户可以在其中启用和禁用<em>实验功能</em> 。</p>
</li>
<li>
<p>支持用户级功能（存储为每个用户的系统偏好设置）和全局功能（仅适用于<code>admin</code>用户，在编辑器中）</p>
</li>
<li>
<p>能够动态处理Business Central上不同<em>实验资源</em>的可见性。</p>
<div class="ulist">
<ul>
<li>
<p>商业中心观点</p>
</li>
<li>
<p>商务中心屏幕</p>
</li>
<li>
<p>商务中心编辑</p>
</li>
<li>
<p>图书馆资产类型</p>
</li>
<li>
<p>页面构建器布局组件</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_types_of_experimental_features"><a class="anchor" href="#_types_of_experimental_features"></a> <a class="link" href="#_types_of_experimental_features">15.12.2。<em>实验特征的</em>类型</a></h4>
<div class="paragraph">
<p><em>实验功能</em>分为两种类型，每种都有不同的范围：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>用户</strong> ：可以为任何平台用户启用或禁用此类型的功能，从而使该功能可用于单个用户而不会影响其他用户，并将功能状态存储为用户首选项。</p>
</li>
<li>
<p><strong>全局</strong> ：此功能对所有用户都是全局的。只有具有管理员权限的用户user才能启用它们。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_experimental_features_editor"><a class="anchor" href="#_experimental_features_editor"></a> <a class="link" href="#_experimental_features_editor">15.12.3。实验功能编辑器</a></h4>
<div class="paragraph">
<p><em>实验性功能框架</em>提供了一个编辑器，用户可以在其中配置他们要使用的功能。要打开编辑器，请导航至“ <strong>管理”</strong>页面，然后单击“ <strong>实验”</strong>菜单选项。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ExperimentalFeatures/admin-page-experimental-menu-option.png" alt="管理页面实验菜单选项">
</div>
<div class="title">图272。实验功能菜单选项</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>只有在<em>实验性的功能框架</em>启用出现<strong>实验</strong>菜单选项，也有<em>实验性的功能</em>安装在商务中心</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ExperimentalFeatures/admin-page-experimental-editor-screen.png" alt="管理页面实验编辑器屏幕">
</div>
<div class="title">图273。实验功能编辑器</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>本文档中显示的功能和组是示例。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>实验功能编辑器显示安装在Business Central上的所有<em>实验功能</em> 。为了获得更好的用户体验，这些功能按可折叠组进行组织。单击标签以展开或折叠组。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ExperimentalFeatures/admin-page-experimental-editor-feature-group.png" alt="管理页面实验编辑器功能组">
</div>
<div class="title">图274。实验功能组</div>
</div>
<div class="paragraph">
<p>组内的每一行都对应一个实验功能。单击切换按钮以启用或禁用该功能。</p>
</div>
<div class="paragraph">
<p>您还可以通过点击网上论坛的*全部启用/全部禁用按钮来启用或禁用所有网上论坛功能。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ExperimentalFeatures/admin-page-experimental-editor-feature-group-enable-all.png" alt="管理页面实验性编辑器功能组启用全部">
</div>
<div class="title">图275。启用所有群组功能</div>
</div>
</div>
<div class="sect3">
<h4 id="_enabling_the_experimental_features_framework"><a class="anchor" href="#_enabling_the_experimental_features_framework"></a> <a class="link" href="#_enabling_the_experimental_features_framework">15.12.4。启用实验功能框架</a></h4>
<div class="paragraph">
<p>默认情况下， <em>实验功能框架</em>处于禁用状态。您可以通过启动Business Central并设置系统属性来启用它<code>appformer.experimental.features=true</code> 。</p>
</div>
<div class="paragraph">
<p>禁用<em>实验功能框架时</em> ，用户将无法访问Business Central上存在的任何<em>实验功能</em> 。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.workbenchProfiles"><a class="anchor" href="#_wb.workbenchProfiles"></a> <a class="link" href="#_wb.workbenchProfiles">15.13。商务中心档案</a></h3>
<div class="paragraph">
<p>从7.15.0开始。最终，KIE Workbench重命名为Business Central。Business Central包含所有KIE Workbench功能。为了在可用功能集之间进行选择，引入了配置文件的概念。本章介绍配置文件，并说明如何在Business Central中配置它们。</p>
</div>
<div class="sect3">
<h4 id="_introduction_6"><a class="anchor" href="#_introduction_6"></a> <a class="link" href="#_introduction_6">15.13.1。介绍</a></h4>
<div class="paragraph">
<p>启动Business Central应用程序时，默认情况下所有功能均可用。要配置一组功能，可以从配置文件列表中进行选择。</p>
</div>
<div class="paragraph">
<p>配置文件是一组功能，其中包含：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>选单</p>
</li>
<li>
<p>它可以处理的资源</p>
</li>
<li>
<p>特定首页</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>当前，我们有两个配置文件：* <strong>完整</strong> ：将启用所有工作台功能（默认）； * <strong>规划师和规则</strong> ：仅可使用Optaplanner和Drools功能。</p>
</div>
</div>
<div class="sect3">
<h4 id="_selecting_a_profile"><a class="anchor" href="#_selecting_a_profile"></a> <a class="link" href="#_selecting_a_profile">15.13.2。选择个人资料</a></h4>
<div class="paragraph">
<p>通过选择“个人档案”首选项，可以在“管理”页面上选择个人档案。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>仅管理员用户有权访问“个人档案”首选项。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/WorkbenchProfiles/profiles-menu-option.png" alt="配置文件菜单选项">
</div>
<div class="title">图276。配置文件菜单选项</div>
</div>
<div class="paragraph">
<p>也可以使用系统属性选择配置文件<code>org.kie.workbench.profile</code> ，可以具有值<code>FULL</code> （对于<strong>完整</strong>个人资料）和<code>PLANNER_AND_RULES</code> （对于“ <strong>计划者和规则”</strong>配置文件）。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="performance-tuning-business-central-ref_kie-apis"><a class="anchor" href="#performance-tuning-business-central-ref_kie-apis"></a> <a class="link" href="#performance-tuning-business-central-ref_kie-apis">15.14。使用Business Central进行性能调整的注意事项</a></h3>
<div class="paragraph">
<p>以下关键概念或建议做法可帮助您优化Business Central配置和Drools性能。为了方便起见，在本节中汇总了这些概念，并在适用的情况下在交叉引用的文档中进行了详细说明。新版本的Drools将根据需要扩展或更改此部分。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">确保在开发过程中启用开发模式</dt>
<dd>
<p>您可以在Business Central中设置要使用的KIE Server或特定项目<code>production</code>模式或<code>development</code>模式。默认情况下，KIE Server和Business Central中的所有新项目都处于开发模式。此模式提供的功能有助于您的开发体验（例如灵活的项目部署策略），以及在开发过程中优化KIE Server性能的功能（例如禁用重复GAV检测）。使用开发模式，直到建立了Drools环境并完全准备好进入生产模式为止。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>有关配置环境模式或重复GAV检测的更多信息，请参见以下资源：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_development_streamline_lifecycle">开发简化生命周期</a></p>
</li>
<li>
<p><a href="#_duplicate_gav_detection">重复GAV检测</a></p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">禁用验证和验证复杂的指导决策表</dt>
<dd>
<p>默认情况下，Business Central的决策表验证和确认功能处于启用状态。此功能可帮助您验证指导决策表，但对于复杂的指导决策表，此功能可能会妨碍Drools引擎性能。您可以通过设置<code>org.kie.verification.disable-dtable-realtime-verification</code>系统属性值<code>true</code> 。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>有关指导决策表验证的更多信息，请参阅<a href="#guided-decision-tables-validation-disable-proc">禁用指导决策表的验证和验证。</a></p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">如果您有很多大型项目，请禁用自动构建</dt>
<dd>
<p>在Business Central中，当您在“ <strong>项目资源管理器”</strong>侧面板中的<strong>项目</strong>之间导航时，将自动构建所选项目，以便更新“ <strong>警报”</strong>窗口以显示该项目的任何构建错误。如果您有大型项目或经常在处于活跃开发中的多个项目之间切换，则此功能可能会阻碍Business Central和Drools引擎的性能。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>要禁用自动项目构建，请设置<code>org.kie.build.disable-project-explorer</code>系统属性<code>true</code> 。</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div></div>
<div class="sect1">﻿<div class="sect1">
<h2 id="drools.AuthoringAssets"><a class="anchor" href="#drools.AuthoringAssets"></a> <a class="link" href="#drools.AuthoringAssets">16。创作规则资产</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_drools.newpackage"><a class="anchor" href="#_drools.newpackage"></a> <a class="link" href="#_drools.newpackage">16.1。创建一个包</a></h3>
<div class="paragraph">
<p>配置软件包通常是一次完成的工作，并且只有具有一定规则/模型经验的人才能完成。一般而言，很少有人需要配置软件包，并且一旦安装，便可以根据需要一遍又一遍地复制它们。软件包配置绝对是一项需要适当专业知识的技术任务。</p>
</div>
<div class="paragraph">
<p>所有资产都位于Business Central的“程序包”中-程序包就像一个文件夹（它也用作“命名空间”）。用于存放规则资产的主文件夹。规则尤其需要知道事实模型是什么，名称空间是什么等。</p>
</div>
<div class="paragraph">
<p>因此，尽管规则（通常是资产）可以出现在任意多个类别中，但它们仅存在于一个程序包中。如果将Business Central视为文件系统，则每个软件包都是一个文件夹，资产位于该文件夹中-作为文件的一大堆。</p>
</div>
<div class="paragraph">
<p>要创建一个空包，请从“添加资产”菜单中选择“包”。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/newItemMenu.png" alt="newItemMenu">
</div>
<div class="title">图277。新包装</div>
</div>
<div class="sect3">
<h4 id="_empty_package"><a class="anchor" href="#_empty_package"></a> <a class="link" href="#_empty_package">16.1.1。空包装</a></h4>
<div class="paragraph">
<p>只需指定名称即可创建一个空包。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/newItem-package.png" alt="newItem包">
</div>
<div class="title">图278。新的空包</div>
</div>
<div class="paragraph">
<p>创建包后，它将出现在项目资源管理器中。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/newItem-package-project-explorer.png" alt="newItem包项目资源管理器">
</div>
<div class="title">图279。项目浏览器显示新软件包</div>
</div>
</div>
<div class="sect3">
<h4 id="_copy_rename_and_delete_packages"><a class="anchor" href="#_copy_rename_and_delete_packages"></a> <a class="link" href="#_copy_rename_and_delete_packages">16.1.2。复制，重命名和删除软件包</a></h4>
<div class="paragraph">
<p>如“ <a href="#_wb.projectexplorercopyrenamedeleteactions">项目资源管理器”</a>部分所述，用户可以直接从“项目资源管理器”中复制，重命名或删除包。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="guided-rules-con_kie-apis"><a class="anchor" href="#guided-rules-con_kie-apis"></a> <a class="link" href="#guided-rules-con_kie-apis">16.2。指导规则</a></h3>
<div class="paragraph">
<p>指导规则是您在Business Central中基于UI的指导规则设计器中创建的业务规则，可引导您完成规则创建过程。指导的规则设计器根据定义的规则的数据对象提供可接受输入的字段和选项。与其他所有规则资产一样，您定义的指导规则也被编译为Drools规则语言（DRL）规则。</p>
</div>
<div class="paragraph">
<p>与指导规则有关的所有数据对象必须与指导规则位于同一项目包中。默认情况下，导入同一包中的资产。创建必要的数据对象和指导规则之后，可以使用指导规则设计器的“ <strong>数据对象”</strong>选项卡来验证是否列出了所有必需的数据对象，或者通过添加“ <strong>新建”项</strong>来导入其他现有数据对象。</p>
</div>
<div class="sect3">
<h4 id="guided-rules-create-proc_kie-apis"><a class="anchor" href="#guided-rules-create-proc_kie-apis"></a> <a class="link" href="#guided-rules-create-proc_kie-apis">16.2.1。建立指导性规则</a></h4>
<div class="paragraph">
<p>指导规则使您可以基于与规则关联的数据对象以结构化格式定义业务规则。您可以为项目分别创建和定义指导规则。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在Business Central中，转到<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> ，然后单击项目名称。</p>
</li>
<li>
<p>单击<strong>添加资产</strong> → <strong>指导规则</strong> 。</p>
</li>
<li>
<p>输入信息丰富的<strong>指导规则</strong>名称，然后选择适当的“ <strong>程序包”</strong> 。您指定的包必须与已分配或将要分配所需数据对象的包相同。</p>
<div class="paragraph">
<p>如果您的项目中定义了任何特定领域的语言（DSL）资产，也可以选择“ <strong>显示声明的DSL句子”</strong> 。然后，这些DSL资产将成为您在指导规则设计器中定义的条件和操作的可用对象。</p>
</div>
</li>
<li>
<p>单击<strong>确定</strong>以创建规则资产。</p>
<div class="paragraph">
<p>现在，新的指导规则将列在<strong>Project Explorer</strong>的“ <strong>指导规则”</strong>面板中，或者如果您选择了“ <strong>显示已声明的DSL句子”</strong>选项，则将列在“ <strong>指导规则（使用DSL）”</strong>面板中。</p>
</div>
</li>
<li>
<p>单击<strong>数据对象</strong>选项卡，并确认列出了规则所需的所有数据对象。如果不是，请单击“ <strong>新建项目”</strong>以从其他包中导入数据对象，或在包中<a href="#_wb.datamodeller">创建数据对象</a> 。</p>
</li>
<li>
<p>放置完所有数据对象后，返回到指导规则设计器的“ <strong>模型”</strong>选项卡，并使用窗口右侧的按钮基于以下内容添加和定义规则的<strong>WHEN</strong> （条件）和<strong>THEN</strong> （操作）部分。可用的数据对象。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/1140_01.png" alt="指导规则设计师">
</div>
<div class="title">图280。指导规则设计师</div>
</div>
<div class="paragraph">
<p>规则的<strong>WHEN</strong>部分包含执行操作必须满足的条件。例如，如果银行要求贷款申请人有超过21岁，那么一个企业的<strong>WHEN</strong>条件<code>Underage</code>规则是<code>Age | less than | 21</code> 。</p>
</div>
<div class="paragraph">
<p>规则的<strong>THEN</strong>部分包含满足规则的条件部分时要执行的操作。例如，当贷款申请人未满21岁时， <strong>THEN</strong>行动将<code>approved</code>至<code>false</code> ，因为申请人未满年龄而拒绝贷款。</p>
</div>
<div class="paragraph">
<p>您还可以为更复杂的规则指定例外，例如，在涉及担保人的情况下，银行是否批准未成年人的申请。在这种情况下，您将创建或导入<strong>保证人</strong>数据对象，然后将该字段添加到指导规则中。</p>
</div>
</li>
<li>
<p>在定义规则的所有组件，单击<strong>验证</strong>引导规则设计者的右上方工具栏中的验证引导规则。如果规则验证失败，请解决错误消息中描述的所有问题，检查规则中的所有组件，然后再次尝试验证规则，直到规则通过。</p>
</li>
<li>
<p>在指导规则设计器中单击“ <strong>保存</strong> ”以保存您的工作。</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="guided-rules-WHEN-proc_kie-apis"><a class="anchor" href="#guided-rules-WHEN-proc_kie-apis"></a> <a class="link" href="#guided-rules-WHEN-proc_kie-apis">16.2.1.1。在指导规则中添加WHEN条件</a></h5>
<div class="paragraph">
<p>规则的<strong>WHEN</strong>部分包含执行操作必须满足的条件。例如，如果银行要求贷款申请人有超过21岁，那么一个企业的<strong>WHEN</strong>条件<code>Underage</code>规则是<code>Age | less than | 21</code> 。您可以设置简单或复杂的条件，以确定如何以及何时应用规则。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>规则所需的所有数据对象已创建或导入，并在指导规则设计器的“ <strong>数据对象”</strong>选项卡中列出。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在指导规则设计器中，单击加号图标（ <span class="image"><img src="./Workbench/AuthoringAssets/5686.png" alt="5686"></span> ）在右侧<code>WHEN</code>部分。</p>
<div class="paragraph">
<p>将打开带有可用条件元素的“将条件<strong>添加到规则”</strong>窗口。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/5687.png" alt="向规则添加条件">
</div>
<div class="title">图281。向规则添加条件</div>
</div>
<div class="paragraph">
<p>该列表包括指导规则设计器的“ <strong>数据对象”</strong>选项卡中的<strong>数据对象</strong> ，为程序包定义的任何DSL对象（如果在创建此指导规则时选择了“ <strong>显示声明的DSL句子”</strong> ）以及以下标准选项：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>不存在以下内容：</strong>使用它来指定必须不存在的事实和约束。</p>
</li>
<li>
<p><strong>存在以下内容：</strong>使用它来指定必须存在的事实和约束。仅在第一个匹配项上触发此选项，而不在随后的匹配项上触发。</p>
</li>
<li>
<p><strong>以下任何一项为真：</strong>使用它列出必须为真的所有事实或约束。</p>
</li>
<li>
<p><strong>发件人：</strong>使用它来定义<code>From</code>规则的条件元素。</p>
</li>
<li>
<p><strong>来自累积：</strong>使用此来定义<code>Accumulate</code>规则的条件元素。</p>
</li>
<li>
<p><strong>来自收集：</strong>使用此定义<code>Collect</code>规则的条件元素。</p>
</li>
<li>
<p><strong>从入口点：</strong>使用此<strong>点</strong>定义一个<code>Entry Point</code>为模式。</p>
</li>
<li>
<p><strong>自由格式DRL：</strong>使用此<strong>格式</strong>可插入自由格式DRL字段，您可以在其中自由定义条件元素，而无需指导规则设计器。</p>
</li>
</ul>
</div>
</li>
<li>
<p>选择一个条件元素（例如<strong>LoanApplication</strong> ），然后单击<strong>确定</strong> 。</p>
</li>
<li>
<p>在指导规则设计器中单击条件元素，然后使用“ <strong>修改LoanApplication的约束”</strong>窗口在字段上添加约束，应用多个字段约束，添加新的公式样式表达式，应用表达式编辑器或设置变量名称。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/5689.png" alt="修改条件">
</div>
<div class="title">图282。修改条件</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>变量名称使您可以在指导规则内的其他构造中标识事实或字段。例如，您可以将变量设置为<code>LoanApplication</code>至<code>a</code>然后参考<code>a</code>在一个单独的<code>Bankruptcy</code>指定破产所基于的应用程序的约束。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>a : LoanApplication()
Bankruptcy( application == a ).</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>选择约束后，窗口将自动关闭。</p>
</div>
</li>
<li>
<p>选择限制的运算符（例如， <code>greater than</code> ）从添加的限制旁边的下拉菜单中选择。</p>
</li>
<li>
<p>点击修改图标（ <span class="image"><img src="./Workbench/AuthoringAssets/6191.png" alt="6191"></span> ）来定义字段值。字段值可以是文字值，公式或完整的MVEL表达式。</p>
</li>
<li>
<p>要应用多个字段约束，请单击条件，然后在“ <strong>修改LoanApplication的约束”</strong>窗口中，从“ <strong>多个字段约束”</strong>下拉菜单中选择“ <strong>所有（与）</strong>或<strong>任何（或）”</strong> 。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/5688.png" alt="修改条件">
</div>
<div class="title">图283。添加多个字段约束</div>
</div>
</li>
<li>
<p>在指导规则设计器中单击约束，然后进一步定义字段值。</p>
</li>
<li>
<p>在定义规则的所有条件组件，单击<strong>验证</strong>引导规则设计者的右上方工具栏中的验证指导规则条件。如果规则验证失败，请解决错误消息中描述的所有问题，检查规则中的所有组件，然后再次尝试验证规则，直到规则通过。</p>
</li>
<li>
<p>在指导规则设计器中单击“ <strong>保存</strong> ”以保存您的工作。</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="guided-rules-THEN-proc_kie-apis"><a class="anchor" href="#guided-rules-THEN-proc_kie-apis"></a> <a class="link" href="#guided-rules-THEN-proc_kie-apis">16.2.1.2。在指导规则中添加THEN操作</a></h5>
<div class="paragraph">
<p>规则的<strong>THEN</strong>部分包含满足规则的<strong>WHEN</strong>条件时要执行的操作。例如，当贷款申请人未满21岁时， <strong>THEN</strong>行动可能会<code>approved</code>至<code>false</code> ，因为申请人未满年龄而拒绝贷款。您可以设置简单或复杂的操作，以确定如何以及何时应用规则。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>规则所需的所有数据对象已创建或导入，并在指导规则设计器的“ <strong>数据对象”</strong>选项卡中列出。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在指导规则设计器中，单击加号图标（ <span class="image"><img src="./Workbench/AuthoringAssets/5686.png" alt="5686"></span> ）在右侧<code>THEN</code>部分。</p>
<div class="paragraph">
<p>打开带有可用操作元素的“ <strong>添加新操作”</strong>窗口。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/5695.png" alt="向规则添加新操作">
</div>
<div class="title">图284。向规则添加新操作</div>
</div>
<div class="paragraph">
<p>该列表包括插入和修改选项，这些插入和修改选项基于指导规则设计器的“ <strong>数据对象”</strong>选项卡中的<strong>数据对象</strong> ，以及为该程序包定义的任何DSL对象（如果在创建此指导规则时选择了<strong>显示已声明的DSL句子</strong> ）：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>更改以下项的字段值：</strong>使用它来设置事实字段的值（例如<code>LoanApplication</code> ），而不会将更改通知给Drools引擎。</p>
</li>
<li>
<p><strong>删除：</strong>使用此删除事实。</p>
</li>
<li>
<p><strong>修改：</strong>使用它可以指定要为事实修改的字段，并将更改通知给Drools引擎。</p>
</li>
<li>
<p><strong>插入事实：</strong>用于插入事实并定义结果的结果字段和值。</p>
</li>
<li>
<p><strong>逻辑上插入事实：</strong>使用此逻辑将事实逻辑上插入Drools引擎，并定义结果的结果字段和值。Drools引擎负责事实的插入和撤回的逻辑决策。在常规或声明的插入之后，必须明确撤回事实。逻辑插入后，当最初断言事实的条件不再成立时，事实将自动撤回。</p>
</li>
<li>
<p><strong>添加自由格式DRL：</strong>使用此<strong>格式</strong>可插入自由格式DRL字段，您可以在其中自由定义条件元素，而无需指导规则设计者。</p>
</li>
<li>
<p><strong>在以下位置调用方法：</strong>使用它可以从另一个事实调用方法。</p>
</li>
</ul>
</div>
</li>
<li>
<p>选择一个动作元素（例如<strong>Modify</strong> ），然后单击<strong>Ok</strong> 。</p>
</li>
<li>
<p>单击指导规则设计器中的操作元素，然后使用“ <strong>添加字段”</strong>窗口选择一个字段。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/5696.png" alt="新增栏位">
</div>
<div class="title">图285。新增栏位</div>
</div>
<div class="paragraph">
<p>选择字段后，窗口将自动关闭。</p>
</div>
</li>
<li>
<p>点击修改图标（ <span class="image"><img src="./Workbench/AuthoringAssets/6191.png" alt="6191"></span> ）来定义字段值。字段值可以是文字值或公式。</p>
</li>
<li>
<p>在定义规则的所有操作组件，单击<strong>验证</strong>引导规则设计者的右上方工具栏中的验证指导规则操作。如果规则验证失败，请解决错误消息中描述的所有问题，检查规则中的所有组件，然后再次尝试验证规则，直到规则通过。</p>
</li>
<li>
<p>在指导规则设计器中单击“ <strong>保存</strong> ”以保存您的工作。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guidedruleeditordsl"><a class="anchor" href="#_drools.guidedruleeditordsl"></a> <a class="link" href="#_drools.guidedruleeditordsl">16.2.2。DSL句子增强</a></h4>
<div class="paragraph">
<p>如果规则所在的程序包具有DSL配置，则在添加条件或操作时，它将提供“ DSL语句”列表，您可以从中选择-当您选择一个规则包时，它将在规则中添加一行-如果DSL指定值来自用户，则将显示一个编辑框（文本）（因此最终看起来有点像表单）。这是可选的，并且还有另一个DSL编辑器。请注意，此编辑器中的DSL功能略少于全部DSL功能（基本上，您只能执行DSL的[when]和[then]部分，这与实际的Drool 3没有区别）。</p>
</div>
<div class="paragraph">
<p>下图显示了指导编辑器中正在运行的DSL句子：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDSL.png" alt="引导式DSL">
</div>
<div class="title">图286。DSL在向导式编辑器中</div>
</div>
</div>
<div class="sect3">
<h4 id="guided-rules-options-proc_kie-apis"><a class="anchor" href="#guided-rules-options-proc_kie-apis"></a> <a class="link" href="#guided-rules-options-proc_kie-apis">16.2.3。添加其他规则选项</a></h4>
<div class="paragraph">
<p>您还可以使用规则设计器在规则内添加元数据，定义其他规则属性（例如<code>salience</code>和<code>no-loop</code> ），并冻结规则区域以限制对条件或操作的修改。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在规则设计器中，单击<strong>THEN</strong>部分下的<strong>（显示选项...）</strong> 。</p>
</li>
<li>
<p>点击加号图标（ <span class="image"><img src="./Workbench/AuthoringAssets/5686.png" alt="5686"></span> ）在窗口右侧添加选项。</p>
</li>
<li>
<p>选择要添加到规则的选项：</p>
<div class="ulist">
<ul>
<li>
<p><strong>元数据：</strong>输入元数据标签，然后单击加号（ <span class="image"><img src="./Workbench/AuthoringAssets/5686.png" alt="5686"></span> ）。然后在规则设计器中提供的字段中输入所有需要的数据。</p>
</li>
<li>
<p><strong>属性：</strong>从规则属性列表中选择。然后，在规则设计器中显示的字段或选项中进一步定义值。</p>
</li>
<li>
<p><strong>冻结区域以进行编辑：</strong>选择<strong>条件</strong>或<strong>操作</strong>以限制在规则设计器中修改区域。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/1141.png" alt="附加规则选项">
</div>
<div class="title">图287。规则选项</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>在规则设计器中单击“ <strong>保存</strong> ”以保存您的工作。</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="rules-attributes-ref_kie-apis"><a class="anchor" href="#rules-attributes-ref_kie-apis"></a> <a class="link" href="#rules-attributes-ref_kie-apis">16.2.3.1。规则属性</a></h5>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/rule_attributes.png" alt="规则属性">
</div>
<div class="title">图288。规则属性</div>
</div>
<div class="paragraph">
<p>规则属性是可以添加到业务规则以修改规则行为的其他规范。</p>
</div>
<div class="paragraph">
<p>下表列出了可以分配给规则的属性的名称和支持的值：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表45。规则属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:70%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>salience</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">定义规则优先级的整数。在激活队列中排序时，具有较高显着性值的规则将具有较高的优先级。</p>
<p class="tableblock">例：<code>salience 10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>enabled</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">布尔值。选择该选项后，将启用规则。未选择该选项时，该规则被禁用。</p>
<p class="tableblock">例：<code>enabled true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>date-effective</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">包含日期和时间定义的字符串。仅当当前日期和时间在<code>date-effective</code>属性。</p>
<p class="tableblock">例：<code>date-effective "4-Sep-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>date-expires</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">包含日期和时间定义的字符串。如果当前日期和时间晚于<code>date-expires</code>属性。</p>
<p class="tableblock">例：<code>date-expires "4-Oct-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>no-loop</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">布尔值。选择该选项后，如果规则的结果重新触发了先前满足的条件，则无法重新激活（循环）规则。如果未选择条件，则在这些情况下可以循环规则。</p>
<p class="tableblock">例：<code>no-loop true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>agenda-group</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个字符串，标识要向其分配规则的议程组。通过议程组，您可以对议程进行分区，以提供对规则组的更多执行控制。只有已获得焦点的议程组中的规则才能被激活。</p>
<p class="tableblock">例：<code>agenda-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>activation-group</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个字符串，用于标识您要向其分配规则的激活（或XOR）组。在激活组中，只能激活一个规则。触发的第一个规则将取消激活组中所有规则的所有未决激活。</p>
<p class="tableblock">例：<code>activation-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个长整数值，定义了如果仍满足规则条件，则可以激活规则的持续时间（以毫秒为单位）。</p>
<p class="tableblock">例：<code>duration 10000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>timer</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">标识任一字符串<code>int</code> （间隔）或<code>cron</code>用于计划规则的计时器定义。</p>
<p class="tableblock">例： <code>timer ( cron:* 0/15 * * * ? )</code> （每15分钟一班）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>calendar</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用于计划规则的<a href="http://www.quartz-scheduler.org/">Quartz</a>日历定义。</p>
<p class="tableblock">例： <code>calendars "* * 0-7,18-23 ? * *"</code> （不包括非营业时间）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>auto-focus</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个布尔值，仅适用于议程组中的规则。选择该选项后，下次激活该规则时，焦点将自动分配给分配了该规则的议程组。</p>
<p class="tableblock">例：<code>auto-focus true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>lock-on-active</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个布尔值，仅适用于规则流组或议程组中的规则。选择该选项后，下一次该规则的规则流组变为活动状态或该规则的议程组获得焦点时，该规则流组将不再处于活动状态或该议程组失去焦点之前，无法再次激活该规则。这是更强大的版本<code>no-loop</code>属性，因为匹配的规则的激活将被丢弃，而不考虑更新的来源（不仅是规则本身）。此属性是计算规则的理想选择，在计算规则中，您有许多修改事实的规则，并且您不希望任何规则重新匹配并再次触发。</p>
<p class="tableblock">例：<code>lock-on-active true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>ruleflow-group</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">标识规则流组的字符串。在规则流组中，只有在相关规则流激活了该组时，规则才能触发。</p>
<p class="tableblock">例：<code>ruleflow-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>dialect</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">标识任一字符串<code>JAVA</code>要么<code>MVEL</code>作为规则中代码表达式所使用的语言。默认情况下，该规则使用在程序包级别指定的方言。此处指定的任何方言都会覆盖规则的打包方言设置。</p>
<p class="tableblock">例：<code>dialect "JAVA"</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guidedruleeditorcomplexexample"><a class="anchor" href="#_drools.guidedruleeditorcomplexexample"></a> <a class="link" href="#_drools.guidedruleeditorcomplexexample">16.2.4。一个更复杂的示例：</a></h4>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedComplex.png" alt="GuidedComplex">
</div>
<div class="title">图289。一个更复杂的BRL示例</div>
</div>
<div class="paragraph">
<p>在上面的示例中，您可以看到如何混合使用条件元素，文字值和公式。该规则具有4个“顶层”模式和1个操作。“顶级”模式是：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>关于人的事实模式。此模式包含两个字段约束：一个约束是birthDate字段，另一个约束是公式。请注意，birthDate限制的值是从日历中选择的。要注意的另一件事是，您可以进行计算并在公式限制中使用嵌套字段（即car.brand）。最后，我们将变量名称（$ p）设置为“人员事实类型”。然后，您可以在其他模式中使用此变量。</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>从该模式生成的DRL将为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$p : Person( birthDate &lt; "19-Dec-1982" , eval( car.brand == "Ford" &amp;&amp; salary &gt; (2500 * 4.1) ))</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>A从模式。此条件将为街道名称为“ Elm St.”的每个地址创建一个匹配项。从此人的地址列表中。from的左侧是常规的事实模式，右侧是Expression Builder，可让我们检查变量的字段。</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>从该模式生成的DRL将为：<code>Address( street == "Elm St." ) from $p.addresses</code></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>“不存在”条件元素。当其内容未创建匹配项时，此条件将匹配。在这种情况下，其内容是常规的事实模式（基于人员）。在此事实模式中，您可以看到如何在公式值内使用变量（$ p）。</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>从该模式生成的DRL将为：<code>not Person( salary == ( $p.salary * 2 ) )</code></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>“从累积”条件元素。这可能是您可以使用的最复杂的模式之一。它由左模式组成（必须是事实模式。在这种情况下是数字模式。该数字名为$ totalAddresses），一个源模式（可以是事实模式，来自，收集或累积条件元素）。在这种情况下，地址格式限制在其zip字段中具有字段限制）和公式部分，您可以在其中使用任何内置或自定义的累积功能（在此示例中，使用count（）函数）。基本上，此条件元素将从“人”的地址列表中计算邮政编码为43240的地址。</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>从该模式生成的DRL将为：<code>$totalAddresses : Number() from accumulate ( $a : Address( zipCode == " 43240" ) from $p.addresses, count( $a ) )</code></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="guided-rule-templates-con"><a class="anchor" href="#guided-rule-templates-con"></a> <a class="link" href="#guided-rule-templates-con">16.3。指导规则模板</a></h3>
<div class="paragraph">
<p>指导规则模板是具有占位符值（模板键）的业务规则结构，这些占位符值与在单独的数据表中定义的实际值互换。在相应数据表中为该模板定义的每一行值都会产生一条规则。当许多规则具有相同的条件，操作和其他属性，但事实或约束的值不同时，引导规则模板是理想的选择。在这种情况下，您可以创建具有适用于每个规则的规则结构的指导规则模板，而不是创建许多相似的指导规则并在每个规则中定义值，然后仅在数据表中定义不同的值。</p>
</div>
<div class="paragraph">
<p>指导的规则模板设计器根据定义的规则模板的数据对象提供可接受的模板输入的字段和选项，以及在其中添加模板键值的相应数据表。创建引导规则模板并在相应的数据表中添加值之后，与所有其他规则资产一样，您定义的规则将被编译为Drools规则语言（DRL）规则。</p>
</div>
<div class="paragraph">
<p>与指导规则模板相关的所有数据对象必须与指导规则模板位于同一项目包中。默认情况下，导入同一包中的资产。创建必需的数据对象和指导规则模板之后，可以使用指导规则模板设计器的“ <strong>数据对象”</strong>选项卡来验证是否列出了所有必需的数据对象，或者通过添加“ <strong>新建”项</strong>来导入其他现有数据对象。</p>
</div>
<div class="sect3">
<h4 id="guided-rule-templates-create-proc"><a class="anchor" href="#guided-rule-templates-create-proc"></a> <a class="link" href="#guided-rule-templates-create-proc">16.3.1。创建指导规则模板</a></h4>
<div class="paragraph">
<p>您可以使用指导规则模板来定义带有占位符值（模板键）的规则结构，这些占位符值与数据表中定义的实际值相对应。指导规则模板是一种有效的替代方法，可以单独定义使用同一结构的许多指导规则的集合。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在Business Central中，转到<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> ，然后单击项目名称。</p>
</li>
<li>
<p>单击<strong>添加资产</strong> → <strong>指导规则模板</strong> 。</p>
</li>
<li>
<p>输入信息丰富的“ <strong>指导规则模板”</strong>名称，然后选择适当的“ <strong>程序包”</strong> 。您指定的包必须与已分配或将要分配所需数据对象的包相同。</p>
</li>
<li>
<p>单击<strong>确定</strong>以创建规则模板。</p>
<div class="paragraph">
<p>现在，新的指导规则模板在“ <strong>项目资源管理器”</strong>的“ <strong>指导规则模板”</strong>面板中列出。</p>
</div>
</li>
<li>
<p>单击<strong>数据对象</strong>选项卡，并确认列出了规则所需的所有数据对象。如果不是，请单击“ <strong>新建项目”</strong>以从其他包中导入数据对象，或在包中<a href="#_wb.datamodeller">创建数据对象</a> 。</p>
</li>
<li>
<p>放置完所有数据对象后，返回“ <strong>模型”</strong>选项卡，并使用窗口右侧的按钮根据可用的数据对象添加和定义规则模板的<strong>WHEN</strong> （条件）和<strong>THEN</strong> （操作）部分。 。对于随规则变化的字段值，请使用格式为<code>$key</code>以规则设计器或格式<code>@{key}</code>格式为DRL（如果使用）。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-template.png" alt="样本指导规则模板">
</div>
<div class="title">图290。样本指导规则模板</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="title">关于模板键的注意</div>
<div class="paragraph">
<p>模板键是指导规则模板中的基础。模板键使模板中的字段值可以与您在相应数据表中定义的实际值互换，从而根据同一模板生成不同的规则。您可以将其他值类型（如<strong>Literal</strong>或<strong>Formula</strong> ）用于基于该模板的所有规则的规则结构的一部分。但是，对于规则之间不同的任何值，请使用带有指定键的“ <strong>模板键”</strong>字段类型。如果在指导规则模板中没有模板键，则不会在模板设计器中生成相应的数据表，并且该模板实际上起着单独的指导规则的作用。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>规则模板的<strong>WHEN</strong>部分是执行操作必须满足的条件。例如，如果一家电信公司根据客户订购的服务（互联网，电话和电视）向客户收费，则<strong>WHEN</strong>条件之一将是<code>internetService | equal to | $hasInternetService</code> 。模板键<code>$hasInternetService</code>与实际的布尔值互换（ <code>true</code>要么<code>false</code> ）定义在模板的数据表中。</p>
</div>
<div class="paragraph">
<p>规则模板的<strong>THEN</strong>部分是满足规则的条件部分时要执行的操作。例如，如果客户签约只是互联网服务，为<strong>THEN</strong>行动<code>RecurringPayment</code>用模板键<code>$amount</code>将实际的每月金额设置为数据表中为Internet服务费定义的整数值。</p>
</div>
</li>
<li>
<p>定义规则的所有组件之后，请在指导的规则模板设计器中单击“ <strong>保存</strong> ”以保存您的工作。</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="guided-rule-templates-WHEN-proc"><a class="anchor" href="#guided-rule-templates-WHEN-proc"></a> <a class="link" href="#guided-rule-templates-WHEN-proc">16.3.1.1。在指导规则模板中添加WHEN条件</a></h5>
<div class="paragraph">
<p>规则的<strong>WHEN</strong>部分包含执行操作必须满足的条件。例如，如果一家电信公司根据客户订购的服务（互联网，电话和电视）向客户收费，则<strong>WHEN</strong>条件之一将是<code>internetService | equal to | $hasInternetService</code> 。模板键<code>$hasInternetService</code>与实际的布尔值互换（ <code>true</code>要么<code>false</code> ）定义在模板的数据表中。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>规则所需的所有数据对象已创建或导入，并在指导规则模板设计器的“ <strong>数据对象”</strong>选项卡中列出。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在引导式规则模板设计器中，单击加号图标（ <span class="image"><img src="./Workbench/AuthoringAssets/5686.png" alt="5686"></span> ）在右侧<code>WHEN</code>部分。</p>
<div class="paragraph">
<p>将打开带有可用条件元素的“将条件<strong>添加到规则”</strong>窗口。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-templates-add-condition.png" alt="向规则添加条件">
</div>
<div class="title">图291。向规则添加条件</div>
</div>
<div class="paragraph">
<p>该列表包括指导规则模板设计器的“ <strong>数据对象”</strong>选项卡中的<strong>数据对象</strong> ，为该程序包定义的任何DSL对象以及以下标准选项：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>不存在以下内容：</strong>使用它来指定必须不存在的事实和约束。</p>
</li>
<li>
<p><strong>存在以下内容：</strong>使用它来指定必须存在的事实和约束。仅在第一个匹配项上触发此选项，而不在随后的匹配项上触发。</p>
</li>
<li>
<p><strong>以下任何一项为真：</strong>使用它列出必须为真的所有事实或约束。</p>
</li>
<li>
<p><strong>发件人：</strong>使用它来定义<code>From</code>规则的条件元素。</p>
</li>
<li>
<p><strong>来自累积：</strong>使用此来定义<code>Accumulate</code>规则的条件元素。</p>
</li>
<li>
<p><strong>来自收集：</strong>使用此定义<code>Collect</code>规则的条件元素。</p>
</li>
<li>
<p><strong>从入口点：</strong>使用此<strong>点</strong>定义一个<code>Entry Point</code>为模式。</p>
</li>
<li>
<p><strong>自由格式DRL：</strong>使用此<strong>格式</strong>可插入自由格式DRL字段，您可以在其中自由定义条件元素，而无需指导规则设计器。对于自由格式DRL的模板密钥，请使用以下格式<code>@{key}</code> 。</p>
</li>
</ul>
</div>
</li>
<li>
<p>选择一个条件元素（例如<strong>Customer</strong> ），然后单击<strong>Ok</strong> 。</p>
</li>
<li>
<p>单击指导规则模板设计器中的条件元素，然后使用“ <strong>修改客户的约束”</strong>窗口在字段上添加限制，应用多个字段约束，添加新的公式样式表达式，应用表达式编辑器或设置变量名称。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-templates-modify-condition.png" alt="修改条件">
</div>
<div class="title">图292。修改条件</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>变量名称使您可以在指导规则内的其他构造中标识事实或字段。例如，您可以将变量设置为<code>Customer</code>至<code>c</code>然后参考<code>c</code>在一个单独的<code>Applicant</code>约束指定<code>Customer</code>是个<code>Applicant</code> 。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">c : Customer()
Applicant( this == c )</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>选择约束后，窗口将自动关闭。</p>
</div>
</li>
<li>
<p>选择限制的运算符（例如， <code>equal to</code> ）从添加的限制旁边的下拉菜单中选择。</p>
</li>
<li>
<p>点击修改图标（ <span class="image"><img src="./Workbench/AuthoringAssets/6191.png" alt="6191"></span> ）来定义字段值。</p>
</li>
<li>
<p>选择<strong>模板密钥</strong>并以以下格式添加模板密钥<code>$key</code>如果此值在基于此模板的规则之间有所不同。这使字段值可以与您在相应数据表中定义的实际值互换，以从同一模板生成不同的规则。对于在规则之间不变化且属于规则模板的字段值，可以使用任何其他值类型。</p>
</li>
<li>
<p>要应用多个字段约束，请单击条件，然后在“ <strong>修改客户的约束”</strong>窗口中，从“ <strong>多个字段约束”</strong>下拉菜单中选择“ <strong>所有（与）</strong>或<strong>任何一个（或）”</strong> 。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-templates-multiple-constraints.png" alt="添加多个字段约束">
</div>
<div class="title">图293。添加多个字段约束</div>
</div>
</li>
<li>
<p>在指导规则模板设计器中单击约束，然后进一步定义字段值。</p>
</li>
<li>
<p>定义所有条件元素后，请在指导规则模板设计器中单击“ <strong>保存</strong> ”以保存您的工作。</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="guided-rule-templates-THEN-proc"><a class="anchor" href="#guided-rule-templates-THEN-proc"></a> <a class="link" href="#guided-rule-templates-THEN-proc">16.3.1.2。在指导规则模板中添加THEN操作</a></h5>
<div class="paragraph">
<p>规则模板的<strong>THEN</strong>部分是满足规则的条件部分时要执行的操作。例如，如果客户签约只是互联网服务，为<strong>THEN</strong>行动<code>RecurringPayment</code>用模板键<code>$amount</code>将实际的每月金额设置为数据表中为Internet服务费定义的整数值。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>规则所需的所有数据对象已创建或导入，并在指导规则模板设计器的“ <strong>数据对象”</strong>选项卡中列出。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在引导式规则模板设计器中，单击加号图标（ <span class="image"><img src="./Workbench/AuthoringAssets/5686.png" alt="5686"></span> ）在右侧<code>THEN</code>部分。</p>
<div class="paragraph">
<p>打开带有可用操作元素的“ <strong>添加新操作”</strong>窗口。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-templates-add-action.png" alt="向规则添加新操作">
</div>
<div class="title">图294。向规则添加新操作</div>
</div>
<div class="paragraph">
<p>该列表包括插入和修改选项，这些选项基于指导规则模板设计器的“ <strong>数据对象”</strong>选项卡中的<strong>数据对象</strong>以及为程序包定义的任何DSL对象：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>插入事实：</strong>用于插入事实并定义结果的结果字段和值。</p>
</li>
<li>
<p><strong>逻辑上插入事实：</strong>使用此逻辑将事实逻辑上插入Drools引擎，并定义结果的结果字段和值。Drools引擎负责事实的插入和撤回的逻辑决策。在常规或声明的插入之后，必须明确撤回事实。逻辑插入后，当最初断言事实的条件不再成立时，事实将自动撤回。</p>
</li>
<li>
<p><strong>添加自由格式DRL：</strong>使用此<strong>格式</strong>可插入自由格式DRL字段，您可以在其中自由定义条件元素，而无需指导规则设计者。对于自由格式DRL的模板密钥，请使用以下格式<code>@{key}</code> 。</p>
</li>
</ul>
</div>
</li>
<li>
<p>选择一个动作元素（例如， <strong>逻辑上插入事实RecurringPayment</strong> ），然后单击<strong>确定</strong> 。</p>
</li>
<li>
<p>单击指导规则模板设计器中的操作元素，然后使用“ <strong>添加字段”</strong>窗口选择一个字段。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-templates-add-field.png" alt="新增栏位">
</div>
<div class="title">图295。新增栏位</div>
</div>
<div class="paragraph">
<p>选择字段后，窗口将自动关闭。</p>
</div>
</li>
<li>
<p>点击修改图标（ <span class="image"><img src="./Workbench/AuthoringAssets/6191.png" alt="6191"></span> ）来定义字段值。</p>
</li>
<li>
<p>选择<strong>模板密钥</strong>并以以下格式添加模板密钥<code>$key</code>如果此值在基于此模板的规则之间有所不同。这使字段值可以与您在相应数据表中定义的实际值互换，以从同一模板生成不同的规则。对于在规则之间不变化且属于规则模板的字段值，可以使用任何其他值类型。</p>
</li>
<li>
<p>定义所有操作元素后，请在指导规则模板设计器中单击“ <strong>保存</strong> ”以保存您的工作。</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="guided-rules-options-proc_kie-apis"><a class="anchor" href="#guided-rules-options-proc_kie-apis"></a> <a class="link" href="#guided-rules-options-proc_kie-apis">16.3.1.3。添加其他规则选项</a></h5>
<div class="paragraph">
<p>您还可以使用规则设计器在规则内添加元数据，定义其他规则属性（例如<code>salience</code>和<code>no-loop</code> ），并冻结规则区域以限制对条件或操作的修改。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在规则设计器中，单击<strong>THEN</strong>部分下的<strong>（显示选项...）</strong> 。</p>
</li>
<li>
<p>点击加号图标（ <span class="image"><img src="./Workbench/AuthoringAssets/5686.png" alt="5686"></span> ）在窗口右侧添加选项。</p>
</li>
<li>
<p>选择要添加到规则的选项：</p>
<div class="ulist">
<ul>
<li>
<p><strong>元数据：</strong>输入元数据标签，然后单击加号（ <span class="image"><img src="./Workbench/AuthoringAssets/5686.png" alt="5686"></span> ）。然后在规则设计器中提供的字段中输入所有需要的数据。</p>
</li>
<li>
<p><strong>属性：</strong>从规则属性列表中选择。然后，在规则设计器中显示的字段或选项中进一步定义值。</p>
</li>
<li>
<p><strong>冻结区域以进行编辑：</strong>选择<strong>条件</strong>或<strong>操作</strong>以限制在规则设计器中修改区域。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/1141.png" alt="附加规则选项">
</div>
<div class="title">图296。规则选项</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>在规则设计器中单击“ <strong>保存</strong> ”以保存您的工作。</p>
</li>
</ol>
</div>
<div class="sect5">
<h6 id="rules-attributes-ref_kie-apis"><a class="anchor" href="#rules-attributes-ref_kie-apis"></a> <a class="link" href="#rules-attributes-ref_kie-apis">规则属性</a></h6>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/rule_attributes.png" alt="规则属性">
</div>
<div class="title">图297。规则属性</div>
</div>
<div class="paragraph">
<p>规则属性是可以添加到业务规则以修改规则行为的其他规范。</p>
</div>
<div class="paragraph">
<p>下表列出了可以分配给规则的属性的名称和支持的值：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表46。规则属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:70%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">属性</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>salience</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">定义规则优先级的整数。在激活队列中排序时，具有较高显着性值的规则将具有较高的优先级。</p>
<p class="tableblock">例：<code>salience 10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>enabled</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">布尔值。选择该选项后，将启用规则。未选择该选项时，该规则被禁用。</p>
<p class="tableblock">例：<code>enabled true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>date-effective</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">包含日期和时间定义的字符串。仅当当前日期和时间在<code>date-effective</code>属性。</p>
<p class="tableblock">例：<code>date-effective "4-Sep-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>date-expires</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">包含日期和时间定义的字符串。如果当前日期和时间晚于<code>date-expires</code>属性。</p>
<p class="tableblock">例：<code>date-expires "4-Oct-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>no-loop</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">布尔值。选择该选项后，如果规则的结果重新触发了先前满足的条件，则无法重新激活（循环）规则。如果未选择条件，则在这些情况下可以循环规则。</p>
<p class="tableblock">例：<code>no-loop true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>agenda-group</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个字符串，标识要向其分配规则的议程组。通过议程组，您可以对议程进行分区，以提供对规则组的更多执行控制。只有已获得焦点的议程组中的规则才能被激活。</p>
<p class="tableblock">例：<code>agenda-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>activation-group</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个字符串，用于标识您要向其分配规则的激活（或XOR）组。在激活组中，只能激活一个规则。触发的第一个规则将取消激活组中所有规则的所有未决激活。</p>
<p class="tableblock">例：<code>activation-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个长整数值，定义了如果仍满足规则条件，则可以激活规则的持续时间（以毫秒为单位）。</p>
<p class="tableblock">例：<code>duration 10000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>timer</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">标识任一字符串<code>int</code> （间隔）或<code>cron</code>用于计划规则的计时器定义。</p>
<p class="tableblock">例： <code>timer ( cron:* 0/15 * * * ? )</code> （每15分钟一班）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>calendar</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用于计划规则的<a href="http://www.quartz-scheduler.org/">Quartz</a>日历定义。</p>
<p class="tableblock">例： <code>calendars "* * 0-7,18-23 ? * *"</code> （不包括非营业时间）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>auto-focus</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个布尔值，仅适用于议程组中的规则。选择该选项后，下次激活该规则时，焦点将自动分配给分配了该规则的议程组。</p>
<p class="tableblock">例：<code>auto-focus true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>lock-on-active</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个布尔值，仅适用于规则流组或议程组中的规则。选择该选项后，下一次该规则的规则流组变为活动状态或该规则的议程组获得焦点时，该规则流组将不再处于活动状态或该议程组失去焦点之前，无法再次激活该规则。这是更强大的版本<code>no-loop</code>属性，因为匹配的规则的激活将被丢弃，而不考虑更新的来源（不仅是规则本身）。此属性是计算规则的理想选择，在计算规则中，您有许多修改事实的规则，并且您不希望任何规则重新匹配并再次触发。</p>
<p class="tableblock">例：<code>lock-on-active true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>ruleflow-group</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">标识规则流组的字符串。在规则流组中，只有在相关规则流激活了该组时，规则才能触发。</p>
<p class="tableblock">例：<code>ruleflow-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>dialect</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">标识任一字符串<code>JAVA</code>要么<code>MVEL</code>作为规则中代码表达式所使用的语言。默认情况下，该规则使用在程序包级别指定的方言。此处指定的任何方言都会覆盖规则的打包方言设置。</p>
<p class="tableblock">例：<code>dialect "JAVA"</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guided-rule-templates-tables-proc"><a class="anchor" href="#guided-rule-templates-tables-proc"></a> <a class="link" href="#guided-rule-templates-tables-proc">16.3.2。为指导规则模板定义数据表</a></h4>
<div class="paragraph">
<p>创建指导规则模板并为字段值添加模板键之后，指导规则模板设计器的<strong>数据</strong>表中将显示一个数据表。数据表中的每一列都对应于您在指导规则模板中添加的模板键。使用此表逐行定义每个模板密钥的值。您在数据表中为该模板定义的每一行值都会产生一条规则。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在指导的规则模板设计器中，单击“ <strong>数据”</strong>选项卡以查看数据表。数据表中的每一列都对应于您在指导规则模板中添加的模板键。</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">如果您没有向规则模板添加任何模板键，则该数据表不会出现，并且该模板不能用作真正的模板，而实际上可以用作单个指导规则。因此，模板键对于创建指导规则模板至关重要。
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>单击<strong>添加行，</strong>然后为每个模板键列定义数据值以生成该规则（行）。</p>
</li>
<li>
<p>继续添加行并为将要生成的每个规则定义数据值。您可以单击每个新行的<strong>添加行</strong> ，或单击加号（ <span class="image"><img src="./Workbench/AuthoringAssets/5686.png" alt="5686"></span> ）或减号图标可添加或删除行。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-templates-data-table.png" alt="指导规则模板的样本数据表">
</div>
<div class="title">图298。指导规则模板的样本数据表</div>
</div>
<div class="paragraph">
<p>要查看DRL代码，请在指导的规则模板设计器中单击“ <strong>源”</strong>选项卡。</p>
</div>
<div class="paragraph">
<p>例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "PaymentRules_6"
	when
		Customer( internetService == false ,
			phoneService == false ,
			TVService == true )
	then
		RecurringPayment fact0 = new RecurringPayment();
		fact0.setAmount( 5 );
		insertLogical( fact0 );
end

rule "PaymentRules_5"
	when
		Customer( internetService == false ,
			phoneService == true ,
			TVService == false )
	then
		RecurringPayment fact0 = new RecurringPayment();
		fact0.setAmount( 5 );
		insertLogical( fact0 );
end
...
//Other rules omitted for brevity.</code></pre>
</div>
</div>
</li>
<li>
<p>作为视觉辅助，如果需要，请单击数据表左上角的网格图标以打开或关闭单元格合并。同一列中具有相同值的单元格将合并为一个单元格。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-templates-cell-merging.png" alt="合并数据表中的单元格">
</div>
<div class="title">图299。合并数据表中的单元格</div>
</div>
<div class="paragraph">
<p>然后，您可以使用每个新合并的单元格左上角的展开/折叠图标[+/-]折叠与合并的单元格对应的行，或重新展开折叠的行。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-templates-cell-merging-02.png" alt="折叠合并的单元格">
</div>
<div class="title">图300。折叠合并的单元格</div>
</div>
</li>
<li>
<p>您定义的所有规则模板的关键数据，并根据需要调整表显示后，点击<strong>验证</strong>指导规则模板设计器的右上角工具栏中的验证指导规则模板。如果规则模板验证失败，请解决错误消息中描述的所有问题，检查规则模板中的所有组件以及数据表中定义的数据，然后再次尝试验证规则模板，直到规则模板通过。</p>
</li>
<li>
<p>在指导规则模板设计器中单击“ <strong>保存</strong> ”以保存您的工作。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="guided-decision-tables-con"><a class="anchor" href="#guided-decision-tables-con"></a> <a class="link" href="#guided-decision-tables-con">16.4。指导决策表</a></h3>
<div class="paragraph">
<p>引导式决策表是用于以表格格式定义业务规则的电子表格决策表的向导式替代方法。借助指导性决策表，您将由Business Central中基于UI的向导引导，该向导可帮助您基于项目中的指定数据对象定义规则属性，元数据，条件和操作。创建指导性决策表后，与所有其他规则资产一样，将定义的规则编译为Drools规则语言（DRL）规则。</p>
</div>
<div class="paragraph">
<p>与指导决策表相关的所有数据对象必须与指导决策表位于同一项目包中。默认情况下，导入同一包中的资产。创建必要的数据对象和指导决策表之后，可以使用指导决策表设计器的“ <strong>数据对象”</strong>选项卡来验证是否列出了所有必需的数据对象，或者通过添加“ <strong>新建”项</strong>来导入其他现有数据对象。</p>
</div>
<div class="sect3">
<h4 id="guided-decision-tables-create-proc"><a class="anchor" href="#guided-decision-tables-create-proc"></a> <a class="link" href="#guided-decision-tables-create-proc">16.4.1。创建指导决策表</a></h4>
<div class="paragraph">
<p>您可以使用指导性决策表以表格形式定义规则属性，元数据，条件和操作，然后可以将其添加到业务规则项目中。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在Business Central中，转到<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> ，然后单击项目名称。</p>
</li>
<li>
<p>单击<strong>添加资产</strong> → <strong>指导决策表</strong> 。</p>
</li>
<li>
<p>输入信息丰富的“ <strong>指导决策表”</strong>名称，然后选择适当的“ <strong>程序包”</strong> 。您指定的包必须与已分配或将要分配所需数据对象的包相同。</p>
</li>
<li>
<p>选择“ <strong>使用向导”</strong>以完成<strong>向导</strong>中表的设置，或取消选中此选项以完成表的创建并在指导决策表设计器中指定其余配置。</p>
</li>
<li>
<p>选择您希望表中的规则行符合的匹配策略。有关详细信息，请参见<a href="#hit-policies-con">指导决策表的点击策略</a> 。</p>
</li>
<li>
<p>指定您要<strong>扩展条目表</strong>还是<strong>受限条目</strong>表。有关详细信息，请参阅<a href="#guided-decision-tables-types-con">指导决策表的类型</a> 。</p>
</li>
<li>
<p>单击<strong>确定</strong>以完成设置。如果选择了<strong>使用向导</strong> ，则将显示“指导决策表”向导。如果未选择“ <strong>使用向导”</strong>选项，则不会出现此提示，并且您将直接进入表设计器。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例如，以下向导设置适用于贷款申请决策服务中的指导决策表：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/6326_1.png" alt="6326 1">
</div>
<div class="title">图301。创建指导决策表</div>
</div>
</div>
</div>
</li>
<li>
<p>如果使用向导，请添加任何可用的导入，事实模式，约束和操作，然后选择是否应扩展表列。单击<strong>完成</strong>以关闭向导并查看表设计器。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/6328_1.png" alt="6328 1">
</div>
<div class="title">图302。指导决策表向导</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>在指导决策表设计器中，您可以添加或编辑列和行，以及进行其他最终调整。</p>
</div>
</div>
<div class="sect3">
<h4 id="hit-policies-con"><a class="anchor" href="#hit-policies-con"></a> <a class="link" href="#hit-policies-con">16.4.2。指导决策表的命中策略</a></h4>
<div class="paragraph">
<p>命中策略确定应用指导决策表中的规则（行）的顺序，是从上到下，按指定的优先级还是其他选项。</p>
</div>
<div class="paragraph">
<p>提供以下命中策略：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>无：（</strong>默认命中策略）可以执行多行，并且验证会警告发生冲突的行。任何上传的决策表（使用非指导决策表电子表格）将采用此匹配策略。</p>
</li>
<li>
<p><strong>解决的命中：</strong>不论列表顺序如何，根据指定的优先级一次只能执行一行（例如，您可以赋予第10行比第5行优先级）。这意味着您可以保留想要的行的顺序以提高视觉可读性，但是可以指定优先级例外。</p>
</li>
<li>
<p><strong>唯一匹配：</strong>一次只能执行一行，并且每一行必须唯一，且不满足条件重叠。如果执行了多行，那么验证将在开发时产生警告。</p>
</li>
<li>
<p><strong>首次命中：</strong>一次只能按表中从上到下列出的顺序执行一行。</p>
</li>
<li>
<p><strong>规则顺序：</strong>可以执行多行，并且验证不会报告行之间的冲突，因为它们可能会发生。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/hit-policies-image_1.png" alt="热门政策图片1">
</div>
<div class="title">图303。可用的匹配政策</div>
</div>
<div class="sect4">
<h5 id="hit-policies-examples-ref"><a class="anchor" href="#hit-policies-examples-ref"></a> <a class="link" href="#hit-policies-examples-ref">16.4.2.1。热门政策示例：电影票折扣决策表</a></h5>
<div class="paragraph">
<p>以下是示例决策表的一部分，该决策表根据客户年龄，学生身份或军事身份或全部三者来确定电影票的折扣。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表47。电影票可用折扣的决策表示例</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">行号</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">优惠类型</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">折扣</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">1个</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">老年人（60岁以上）</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">10％</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">学生</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">10％</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">军事</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">10％</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>在此示例中，最终要应用的总折扣将根据为该表指定的匹配策略而有所不同：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>无/规则订单：</strong>同时具有“ <strong>无”</strong>和“ <strong>规则订单”</strong>命中策略，所有适用的规则均已合并，在这种情况下，可以为每个客户堆叠折扣。</p>
<div class="paragraph">
<p>示例：既是学生又是军人的老年人，将获得全部三项折扣，总计30％。</p>
</div>
<div class="paragraph">
<p>关键区别：使用<strong>None时</strong> ，将为应用的多行创建警告。使用<strong>Rule Order时</strong> ，不会创建这些警告。</p>
</div>
</li>
<li>
<p><strong>首次匹配/已解决匹配：</strong>对于“ <strong>首次匹配”</strong>和“ <strong>已解决匹配”</strong>策略，只能应用一种折扣。</p>
<div class="paragraph">
<p>对于<strong>First Hit</strong> ，将应用列表中首先满足的折扣，而其他折扣将被忽略。</p>
</div>
<div class="paragraph">
<p>示例：既是学生又是军人的老年人，将仅获得10％的老年人折扣，因为该折扣在表中排在第一位。</p>
</div>
<div class="paragraph">
<p>对于“ <strong>已解决的匹配”</strong> ，需要修改后的表。在表中为优先级例外分配的折扣，无论列出的顺序如何，都将首先应用。要分配此例外，请包括一个新列，该列指定一种折扣（行）相对于其他折扣（行）的优先级。</p>
</div>
<div class="paragraph">
<p>示例：如果优先考虑军事折扣，而不考虑年龄或学生折扣，尽管列出了命令，那么既是学生又是退伍军人的老年人，无论年龄或学生身份如何，都将仅获得10％的军事折扣。</p>
</div>
<div class="paragraph">
<p>考虑下面的修改后的决策表，其中包含“ <strong>解决的命中”</strong>策略：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表48。修改后的决策表，适用于<em>已解决的匹配</em>策略</caption>
<colgroup>
<col style="width:25%">
<col style="width:25%">
<col style="width:25%">
<col style="width:25%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">行号</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">优惠类型</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">优先于行</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">折扣</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">1个</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">老年人（60岁以上）</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">10％</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">学生</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">10％</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">军事</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">1个</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">10％</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>在此修改后的表格中，军事折扣实际上是新的第1行，因此优先于年龄和学生折扣，以及以后添加的任何其他折扣。您无需为行“ 1和2”指定优先级，只需为行“ 1”指定优先级。随着表格的增长，这会将行命中顺序更改为3→1→2→…等等。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">如果您实际将军费折扣移至第1行并将“ <strong>首次命中”</strong>策略应用于表，则行顺序将以相同的方式更改。但是，如果您希望以某种方式列出规则并以不同的方式应用规则（例如，按字母顺序排列的表），则“ <strong>已解决的匹配项”</strong>策略很有用。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>关键区别：对于“ <strong>首次点击”</strong> ，规则将严格按照列出的顺序应用。对于“ <strong>已解决的</strong>匹配”，除非指定了优先级例外，否则将按列出的顺序应用规则。</p>
</div>
</li>
<li>
<p><strong>唯一匹配：</strong>必须修改表。使用“ <strong>唯一匹配”</strong>策略，必须以无法一次满足多个规则的方式来创建行。但是，您仍然可以逐行指定是应用一个规则还是多个规则。这样，通过“ <strong>唯一匹配”</strong>策略，您可以使决策表更精细并防止重叠警告。</p>
<div class="paragraph">
<p>请考虑下面的修改后的决策表，以适应<strong>唯一匹配</strong>策略：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表49。修改后的决策表，可容纳<em>唯一匹配</em>策略</caption>
<colgroup>
<col style="width:20%">
<col style="width:20%">
<col style="width:20%">
<col style="width:20%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">行号</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">是老年人（65岁以上）</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">是学生</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">是军事</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">折扣</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">1个</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">10％</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">10％</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">10％</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">20％</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">20％</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">没有</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">20％</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">30％</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>在此修改表中，每一行都是唯一的，不允许有重叠，并且可以容纳任何单个折扣或折扣的任何组合。</p>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="guided-decision-tables-types-con"><a class="anchor" href="#guided-decision-tables-types-con"></a> <a class="link" href="#guided-decision-tables-types-con">指导决策表的类型</a></h6>
<div class="paragraph">
<p>Drools支持两种类型的决策表：扩展条目表和受限条目表。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>扩展条目：</strong>扩展条目决策表是其中列定义指定模式，字段和运算符而不是值的表。值或状态本身保存在决策表的主体中。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/dtable-extended-entry.png" alt="扩展进入">
</div>
</div>
</li>
<li>
<p><strong>受限条目：</strong> “受限条目”决策表是除“模式”，“字段”和“运算符”外，列定义还为其指定值的表。决策表状态（保留在表的主体中）是布尔值，其中正值（带标记的复选框）具有意味着应应用或匹配该列的效果。负值（清除复选框）表示该列不适用。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/dtable-limited-entry.png" alt="限制进入">
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guided-decision-tables-columns-create-proc"><a class="anchor" href="#guided-decision-tables-columns-create-proc"></a> <a class="link" href="#guided-decision-tables-columns-create-proc">16.4.3。在指导决策表中添加列</a></h4>
<div class="paragraph">
<p>创建指导决策表之后，可以在指导决策表设计器中定义和添加各种类型的列。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>任何将用于列参数的数据对象（例如事实和字段）都已在找到指导决策表的同一程序包中创建，或者已从<strong>数据对象中的</strong>另一个程序包导入→指导决策表的<strong>新项目</strong>设计师。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>有关这些列参数的描述，请参见<a href="#guided-decision-tables-columns-types-con">指导决策表中的</a>列类型中每种列类型的“必需列参数”段。</p>
</div>
<div class="paragraph">
<p>有关创建数据对象的详细信息，请参见<a href="#_wb.datamodeller">Data Modeller</a> 。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在指导型决策表设计器中，单击<strong>列</strong> → <strong>插入列</strong> 。</p>
</li>
<li>
<p>单击<strong>包括高级选项</strong>以查看列选项的完整列表。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-add_1.png" alt="在“添加新列”窗口中查看列选项">
</div>
<div class="title">图304。添加列</div>
</div>
</li>
<li>
<p>选择要添加的列类型，单击“ <strong>下一步”</strong> ，然后按照向导中的步骤指定添加列所需的数据。</p>
<div class="paragraph">
<p>有关每种列类型和设置所需参数的说明，请参阅<a href="#guided-decision-tables-columns-types-con">指导决策表中的列类型</a> 。</p>
</div>
</li>
<li>
<p>单击<strong>完成</strong>以添加配置的列。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>在添加所有列之后，您可以开始添加与列相关的规则行以完成决策表。有关详细信息，请参阅<a href="#guided-decision-tables-rows-create-proc">在指导的决策表中添加行和定义规则</a> 。</p>
</div>
<div class="paragraph">
<p>以下是贷款申请决策服务的决策表示例：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-add_02.png" alt="完整的指导决策表示例">
</div>
<div class="title">图305。完整的指导决策表示例</div>
</div>
</div>
<div class="sect3">
<h4 id="guided-decision-tables-columns-types-con"><a class="anchor" href="#guided-decision-tables-columns-types-con"></a> <a class="link" href="#guided-decision-tables-columns-types-con">16.4.4。指导决策表中的列类型</a></h4>
<div class="paragraph">
<p>用于指导决策表的“ <strong>添加新列”</strong>向导提供以下列选项。（选择“ <strong>包括高级选项”</strong>以查看所有选项。）</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#guided-decision-tables-columns-condition-con">添加条件</a></p>
</li>
<li>
<p><a href="#guided-decision-tables-columns-condition-BRL-con">添加条件BRL片段</a></p>
</li>
<li>
<p><a href="#guided-decision-tables-columns-metadata-con">添加元数据列</a></p>
</li>
<li>
<p><a href="#guided-decision-tables-columns-action-BRL-con">添加操作BRL片段</a></p>
</li>
<li>
<p><a href="#guided-decision-tables-columns-attribute-con">添加属性列</a></p>
</li>
<li>
<p><a href="#guided-decision-tables-columns-delete-fact-con">删除现有事实</a></p>
</li>
<li>
<p><a href="#guided-decision-tables-columns-work-item-con">执行工作项</a></p>
</li>
<li>
<p><a href="#guided-decision-tables-columns-field-con">设置字段的值</a></p>
</li>
<li>
<p><a href="#guided-decision-tables-columns-field-work-item-con">使用工作项结果设置字段的值</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以下各节介绍了这些列类型以及“ <strong>添加新列”</strong>向导中每个列所需的参数。</p>
</div>
<div id="required-data-objects" class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">
<div class="title">重要说明：列参数所需的数据对象</div>
<div class="paragraph">
<p>本节中描述的某些列参数（例如“事实模式”和“字段”）提供的下拉选项仅包含在找到指导决策表的同一程序包中已经定义的数据对象。包的可用数据对象在“项目资源管理器”的“ <strong>数据对象”</strong>面板和指导性决策表设计器的“ <strong>数据对象”</strong>选项卡中列出。您可以根据需要在包中创建其他数据对象，或在指导决策表设计器的“ <strong>数据对象”</strong> →“ <strong>新建”中</strong>从另一个包中导入它们。有关创建数据对象的详细信息，请参见<a href="#_wb.datamodeller">Data Modeller</a> 。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-columns-condition-con"><a class="anchor" href="#guided-decision-tables-columns-condition-con"></a> <a class="link" href="#guided-decision-tables-columns-condition-con">16.4.4.1。 “添加条件”</a></h5>
<div class="paragraph">
<p>条件表示在规则的左侧（“何时”）定义的事实模式。使用此列选项，您可以定义一个或多个条件列，以检查是否存在具有某些字段值的数据对象，并影响规则的操作（“ THEN”）部分。您可以在条件表中为事实定义绑定，或选择先前已定义的绑定。您也可以选择否定模式。</p>
</div>
<div class="listingblock">
<div class="title">规则条件示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>when
  $i : IncomeSource( type == "Asset" ) // Binds the IncomeSource object to the $i variable
then
  ...
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>when
  not IncomeSource( type == "Asset" ) // Negates matching pattern
then
  ...
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>指定绑定后，您可以定义字段约束。如果使用相同的事实模式绑定定义了两个或更多列，则字段约束将成为同一模式上的复合字段约束。如果为单个模型类定义多个绑定，则每个绑定在规则的条件（“何时”）侧将成为一个单独的模型类。</p>
</div>
<div class="paragraph">
<div class="title">必需的列参数</div>
<p>在“ <strong>添加新列”</strong>向导中，需要以下参数来设置此列类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>模式：</strong>从表中条件中已使用的事实模式列表中选择，或创建新的事实模式。事实模式是程序包中可用数据对象（有关详细信息，请参见“ <a href="#required-data-objects">必需的数据对象”</a>的注释）和您指定的模型类绑定的组合。（例子： <code>LoanApplication [application]</code>要么<code>IncomeSource [income]</code>其中方括号部分是给定事实类型的绑定）</p>
</li>
<li>
<p><strong>入口点：</strong>定义事实模式的入口点（如果适用）。入口是事实进入Drools引擎（如果已指定）的通道或流。（例子： <code>Application Stream</code> ， <code>Credit Check Stream</code> ）</p>
</li>
<li>
<p><strong>计算类型：</strong>选择以下计算类型之一：</p>
<div class="ulist">
<ul>
<li>
<p><strong>文字值：</strong>将使用运算符将单元格中的值与该字段进行比较。</p>
</li>
<li>
<p><strong>公式：</strong>将评估单元格中的表达式，然后将其与字段进行比较。</p>
</li>
<li>
<p><strong>谓词：</strong>不需要任何字段；该表达式将被计算为<code>true</code>要么<code>false</code> 。</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>字段：</strong>从先前指定的事实模式中选择一个字段。字段选项在项目的“ <strong>数据对象”</strong>面板中的事实文件中定义。（例子： <code>amount</code>要么<code>lengthYears</code>内的字段<code>LoanApplication</code>事实类型）</p>
</li>
<li>
<p><strong>绑定（可选）：</strong>如果需要，为先前选择的字段定义绑定。（示例：对于图案<code>LoanApplication [application]</code> ，栏位<code>amount</code>和运算符<code>equal to</code> ，如果绑定设置为<code>$amount</code> ，结束条件将是<code>application : LoanAppplication($amount : amount == [value])</code> ）</p>
</li>
<li>
<p><strong>运算符：</strong>选择要应用于先前指定的事实模式和字段的运算符。</p>
</li>
<li>
<p><strong>值列表（可选）：</strong>输入值选项列表，以逗号和空格分隔，以限制规则条件（“ WHEN”）部分的表输入数据。定义此值列表后，这些值将在该列的表格单元中作为下拉列表提供，用户只能从中选择一个选项。（示例列表： <code>Monday, Wednesday, Friday</code>仅指定这三个选项）</p>
</li>
<li>
<p><strong>默认值（可选）：</strong>选择以前定义的值选项之一作为默认值，它将自动出现在单元格中的新行中。如果未指定默认值，则默认情况下表格单元为空白。您还可以从项目中任何先前配置的数据枚举中选择一个默认值，列在“项目资源管理器”的“ <strong>枚举定义”</strong>面板中。（您可以在<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> → <strong><em>[选择项目]</em></strong> → <strong>添加资产</strong> → <strong>枚举中创建枚举</strong> 。）</p>
</li>
<li>
<p><strong>标题（描述）：</strong>添加列的标题文本。</p>
</li>
<li>
<p><strong>隐藏列：</strong>选择此项以隐藏列，或清除此项以显示列。</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="guided-decision-tables-any-other-add-proc"><a class="anchor" href="#guided-decision-tables-any-other-add-proc"></a> <a class="link" href="#guided-decision-tables-any-other-add-proc">插入<code>any other</code>条件列单元格中的值</a></h6>
<div class="paragraph">
<p>对于指导性决策表中的简单条件列，您可以应用<code>any other</code>如果设置了以下参数，则该列中表单元格的值：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>条件列的<strong>计算类型</strong>已设置为<code>Literal value</code> 。</p>
</li>
<li>
<p><strong>运算符</strong>已设置为相等<code>==</code>或不平等<code>!=</code> 。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>的<code>any other</code> value可以为表中已有规则中未明确定义的任何其他字段值定义规则。在DRL来源中， <code>any other</code>被标记为<code>not in</code> 。</p>
</div>
<div class="listingblock">
<div class="title">规则条件示例<code>not in</code>用于<code>any other</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>when
  IncomeSource( type not in ("Asset", "Job") )
  ...
then
  ...
end</code></pre>
</div>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>选择条件列中使用<code>==</code>要么<code>!=</code>操作员。</p>
</li>
<li>
<p>在表设计器的右上工具栏中，单击<strong>编辑</strong> → <strong>插入“其他”值</strong> 。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-columns-condition-BRL-con"><a class="anchor" href="#guided-decision-tables-columns-condition-BRL-con"></a> <a class="link" href="#guided-decision-tables-columns-condition-BRL-con">16.4.4.2。 “添加条件BRL片段”</a></h5>
<div class="paragraph">
<p>业务规则语言（BRL）片段是使用指导规则设计器创建的规则的一部分。条件BRL片段是规则的“ WHEN”部分，而<a href="#guided-decision-tables-columns-action-BRL-con">动作BRL片段</a>是规则的“ THEN”部分。使用此列选项，您可以定义要在规则左侧（“ WHEN”）使用的条件BRL片段。较简单的列类型可以引用BRL片段中绑定的事实和事实字段，反之亦然。</p>
</div>
<div class="paragraph">
<p>以下示例是贷款申请的条件BRL片段：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-condition-BRL.png" alt="指导决策表设计者的条件BRL片段列">
</div>
<div class="title">图306。使用嵌入式指导规则设计器添加条件BRL片段</div>
</div>
<div class="paragraph">
<p>您也可以从条件选项列表中选择<strong>自由格式DRL</strong> ，以定义条件BRL片段，而无需嵌入式指导规则设计器。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-condition-BRL-free.png" alt="指导决策表设计者的条件BRL片段列" width="with free form DRL option">
</div>
<div class="title">图307。添加带有自由格式DRL的条件BRL片段</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-condition-BRL-free-02.png" alt="指导决策表设计者的条件BRL片段列" width="with free form DRL field">
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="title">模板键</div>
<div class="paragraph">
<p>当您为条件BRL片段添加字段时，值选项之一是<strong>Template key</strong> （与<strong>Literal</strong>或<strong>Formula</strong>相对）。模板键是占位符变量，在生成指导决策表时会与指定值互换，并在表中为每个指定的模板键值形成单独的列。虽然文字和公式值在决策表中是静态的，但可以根据需要修改模板键值。</p>
</div>
<div class="paragraph">
<p>在嵌入式指导规则设计器中，可以通过选择“ <strong>模板键</strong>字段”选项并在编辑器中以以下格式输入值来向字段添加模板键值： <code>$key</code> 。例如， <code>$age</code>创建一个<code>$age</code>决策表中的列。</p>
</div>
<div class="paragraph">
<p>在自由格式DRL中，您可以采用以下格式向事实添加模板键值<code>@{key}</code> 。例如， <code>Person( age > @{age} )</code>创建一个<code>$age</code>决策表中的列。</p>
</div>
<div class="paragraph">
<p>对于使用模板键添加的新列，数据类型为String。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<div class="title">必需的列参数</div>
<p>在“ <strong>添加新列”</strong>向导中，需要以下参数来设置此列类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>规则建模器：</strong>为<strong>规则</strong>定义条件BRL片段（“何时”部分）。</p>
</li>
<li>
<p><strong>标题（描述）：</strong>添加列的标题文本。</p>
</li>
<li>
<p><strong>隐藏列：</strong>选择此项以隐藏列，或清除此项以显示列。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-columns-metadata-con"><a class="anchor" href="#guided-decision-tables-columns-metadata-con"></a> <a class="link" href="#guided-decision-tables-columns-metadata-con">16.4.4.3。 “添加元数据列”</a></h5>
<div class="paragraph">
<p>使用此列选项，您可以将元数据元素定义为决策表中的列。每列代表DRL规则中的常规元数据注释。默认情况下，元数据列是隐藏的。若要显示该列，请在指导的决策表设计器中单击“ <strong>编辑列”</strong> ，然后清除“ <strong>隐藏列”</strong>复选框。</p>
</div>
<div class="paragraph">
<div class="title">必填列参数</div>
<p>在“ <strong>添加新列”</strong>向导中，需要以下参数来设置此列类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>元数据：</strong>以Java变量形式输入元数据项的名称（即，它不能以数字开头或包含空格或特殊字符）。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-columns-action-BRL-con"><a class="anchor" href="#guided-decision-tables-columns-action-BRL-con"></a> <a class="link" href="#guided-decision-tables-columns-action-BRL-con">16.4.4.4。 “添加操作BRL片段”</a></h5>
<div class="paragraph">
<p>业务规则语言（BRL）片段是使用指导规则设计器创建的规则的一部分。<a href="#guided-decision-tables-columns-condition-BRL-con">条件BRL片段</a>是规则的“ WHEN”部分，而动作BRL片段是规则的“ THEN”部分。使用此列选项，您可以定义要在规则的右侧（“ THEN”）使用的操作BRL片段。较简单的列类型可以引用BRL片段中绑定的事实和事实字段，反之亦然。</p>
</div>
<div class="paragraph">
<p>以下示例是贷款申请的操作BRL片段：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-action-BRL.png" alt="指导决策表设计器中的操作BRL片段">
</div>
<div class="title">图308。使用嵌入式指导规则设计器添加操作BRL片段</div>
</div>
<div class="paragraph">
<p>您也可以从操作选项列表中选择<strong>添加自由格式DRL</strong> ，以定义没有嵌入式指导规则设计器的操作BRL片段。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-action-BRL-free.png" alt="指导决策表设计者的“动作BRL片段”列" width="with free form DRL option">
</div>
<div class="title">图309。添加带有自由格式DRL的动作BRL片段</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-action-BRL-free-02.png" alt="指导决策表设计者的“动作BRL片段”列" width="with free form DRL field">
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="title">模板键</div>
<div class="paragraph">
<p>当您为操作BRL片段添加字段时，值选项之一是<strong>Template键</strong> （与<strong>Literal</strong>或<strong>Formula</strong>相对）。模板键是占位符变量，在生成指导决策表时会与指定值互换，并在表中为每个指定的模板键值形成单独的列。虽然文字和公式值在决策表中是静态的，但可以根据需要修改模板键值。</p>
</div>
<div class="paragraph">
<p>在嵌入式指导规则设计器中，可以通过选择“ <strong>模板键</strong>字段”选项并在编辑器中以以下格式输入值来向字段添加模板键值： <code>$key</code> 。例如， <code>$age</code>创建一个<code>$age</code>决策表中的列。</p>
</div>
<div class="paragraph">
<p>在自由格式DRL中，您可以采用以下格式向事实添加模板键值<code>@{key}</code> 。例如， <code>Person( age > @{age} )</code>创建一个<code>$age</code>决策表中的列。</p>
</div>
<div class="paragraph">
<p>对于使用模板键添加的新列，数据类型为String。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<div class="title">必需的列参数</div>
<p>在“ <strong>添加新列”</strong>向导中，需要以下参数来设置此列类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>规则建模器：</strong>定义<strong>规则</strong>的操作BRL片段（“ THEN”部分）。</p>
</li>
<li>
<p><strong>标题（描述）：</strong>添加列的标题文本。</p>
</li>
<li>
<p><strong>隐藏列：</strong>选择此项以隐藏列，或清除此项以显示列。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-columns-attribute-con"><a class="anchor" href="#guided-decision-tables-columns-attribute-con"></a> <a class="link" href="#guided-decision-tables-columns-attribute-con">16.4.4.5。 “添加属性列”</a></h5>
<div class="paragraph">
<p>使用此列选项，您可以添加一个或多个代表任何DRL规则属性的属性列，例如Saliance，Enabled，Date-Effective等。</p>
</div>
<div class="paragraph">
<p>例如，以下指导性决策表使用<code>salience</code>属性以指定规则优先级和<code>enabled</code>属性以启用或禁用评估规则。较高的规则<code>salience</code>首先评估值，然后使用<code>enabled</code>仅在选中此复选框后，才评估属性。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-attributes.png" alt="具有“显着性”和“已启用”属性的引导决策表">
</div>
<div class="title">图310。的示例规则<code>salience</code>和<code>enabled</code>定义评估行为的属性</div>
</div>
<div class="listingblock">
<div class="title">具有规则属性的示例规则源</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Row 1 Pricing loans"
  salience 100
  enabled true
  when
    ...
  then
    ...
end
...
rule "Row 3 Pricing loans"
  enabled false
  when
    ...
  then
    ...
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关每个属性的描述，请从向导的列表中选择属性。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="title">命中策略和属性</div>
<div class="paragraph">
<p>请注意，根据您为决策表定义的匹配策略，某些属性可能会被禁用，因为它们在匹配策略内部使用。例如，如果您已为该表分配了“ <strong>已解决的匹配项”</strong>策略，以便根据表中指定的优先级顺序应用行（规则），那么Salience属性将作废。原因在于，“显着性”属性根据定义的显着性值升级规则优先级，并且该值将被表中的“ <strong>已解决的命中”</strong>策略所覆盖。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<div class="title">必填列参数</div>
<p>在“ <strong>添加新列”</strong>向导中，需要以下参数来设置此列类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>属性：</strong>选择要应用于列的属性。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-columns-delete-fact-con"><a class="anchor" href="#guided-decision-tables-columns-delete-fact-con"></a> <a class="link" href="#guided-decision-tables-columns-delete-fact-con">16.4.4.6。 “删除现有事实”</a></h5>
<div class="paragraph">
<p>使用此列选项，您可以实施操作以删除先前作为事实模式添加到表中的事实。创建此列后，事实类型将在该列的表格单元中作为下拉列表提供，用户只能从中选择一个选项。</p>
</div>
<div class="paragraph">
<div class="title">必需的列参数</div>
<p>在“ <strong>添加新列”</strong>向导中，需要以下参数来设置此列类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>标题（描述）：</strong>添加列的标题文本。</p>
</li>
<li>
<p><strong>隐藏列：</strong>选择此项以隐藏列，或清除此项以显示列。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-columns-work-item-con"><a class="anchor" href="#guided-decision-tables-columns-work-item-con"></a> <a class="link" href="#guided-decision-tables-columns-work-item-con">16.4.4.7。 “执行工作项目”</a></h5>
<div class="paragraph">
<p>使用此列选项，您可以基于Business Central中预定义的工作项定义来执行工作项处理程序。（您可以在<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> → <strong><em>[选择项目]</em></strong> → <strong>添加资产</strong> → <strong>工作项定义中</strong>创建工作项。）</p>
</div>
<div class="paragraph">
<div class="title">必需的列参数</div>
<p>在“ <strong>添加新列”</strong>向导中，需要以下参数来设置此列类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>工作项：</strong>从预定义工作项列表中选择。</p>
</li>
<li>
<p><strong>标题（描述）：</strong>添加列的标题文本。</p>
</li>
<li>
<p><strong>隐藏列：</strong>选择此项以隐藏列，或清除此项以显示列。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-columns-field-con"><a class="anchor" href="#guided-decision-tables-columns-field-con"></a> <a class="link" href="#guided-decision-tables-columns-field-con">16.4.4.8。 “设置字段的值”</a></h5>
<div class="paragraph">
<p>使用此列选项，您可以实施操作以为规则的“ THEN”部分的先前绑定的事实设置字段的值。您可以选择将修改后的值通知Drools引擎，这可能导致其他规则被重新激活。</p>
</div>
<div class="paragraph">
<div class="title">必需的列参数</div>
<p>在“ <strong>添加新列”</strong>向导中，需要以下参数来设置此列类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>模式：</strong>从表中的条件或条件BRL片段中已使用的事实模式列表中选择，或创建新的事实模式。事实模式是程序包中可用数据对象（有关详细信息，请参见“ <a href="#required-data-objects">必需的数据对象”</a>的注释）和您指定的模型类绑定的组合。（例子： <code>LoanApplication [application]</code>要么<code>IncomeSource [income]</code>其中方括号部分是给定事实类型的绑定）</p>
</li>
<li>
<p><strong>字段：</strong>从先前指定的事实模式中选择一个字段。字段选项在项目的“ <strong>数据对象”</strong>面板中的事实文件中定义。（例子： <code>amount</code>要么<code>lengthYears</code>内的字段<code>LoanApplication</code>事实类型）</p>
</li>
<li>
<p><strong>值列表（可选）：</strong>输入值选项列表，以逗号和空格分隔，以限制规则的操作（“ THEN”）部分的表输入数据。定义此值列表后，这些值将在该列的表格单元中作为下拉列表提供，用户只能从中选择一个选项。（示例列表： <code>Accepted, Declined, Pending</code> ）</p>
</li>
<li>
<p><strong>默认值（可选）：</strong>选择以前定义的值选项之一作为默认值，它将自动出现在单元格中的新行中。如果未指定默认值，则默认情况下表格单元为空白。您还可以从项目中任何先前配置的数据枚举中选择一个默认值，列在“项目资源管理器”的“ <strong>枚举定义”</strong>面板中。（您可以在<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> → <strong><em>[选择项目]</em></strong> → <strong>添加资产</strong> → <strong>枚举中创建枚举</strong> 。）</p>
</li>
<li>
<p><strong>标题（描述）：</strong>添加列的标题文本。</p>
</li>
<li>
<p><strong>隐藏列：</strong>选择此项以隐藏列，或清除此项以显示列。</p>
</li>
<li>
<p><strong>逻辑插入：</strong>当在指导决策表的另一列中当前未使用选定的事实模式时，将出现此选项（请参阅下一个字段说明）。选择此选项可将事实模式逻辑上插入Drools引擎，或清除该模式以定期插入。Drools引擎负责事实的插入和撤回的逻辑决策。在常规或声明的插入之后，必须明确撤回事实。在进行逻辑插入后，当首先断言事实的条件不再成立时，事实将自动撤回。</p>
</li>
<li>
<p><strong>使用更改更新引擎：</strong>当指导决策表中的另一列中已经使用了选定的事实模式时，将显示此选项。选择此项以使用修改后的字段值更新Drools引擎，或者清除此项以不更新Drools引擎。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-columns-field-work-item-con"><a class="anchor" href="#guided-decision-tables-columns-field-work-item-con"></a> <a class="link" href="#guided-decision-tables-columns-field-work-item-con">16.4.4.9。 “使用工作项结果设置字段的值”</a></h5>
<div class="paragraph">
<p>使用此列选项，您可以实施一项操作以将先前定义的事实字段的值设置为规则的“ THEN”部分的工作项处理程序的结果值。该工作项必须定义与绑定事实上的字段具有相同数据类型的结果参数，以便您将该字段设置为返回参数。（您可以在<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> → <strong><em>[选择项目]</em></strong> → <strong>添加资产</strong> → <strong>工作项定义中</strong>创建工作项。）</p>
</div>
<div class="paragraph">
<p>必须在表中创建“ <em><a href="#guided-decision-tables-columns-work-item-con">执行工作项”</a></em>列，才能创建此列选项。</p>
</div>
<div class="paragraph">
<div class="title">必需的列参数</div>
<p>在“ <strong>添加新列”</strong>向导中，需要以下参数来设置此列类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>模式：</strong>从表中已使用的事实模式列表中进行选择，或创建一个新的事实模式。事实模式是程序包中可用数据对象（有关详细信息，请参见“ <a href="#required-data-objects">必需的数据对象”</a>的注释）和您指定的模型类绑定的组合。（例子： <code>LoanApplication [application]</code>要么<code>IncomeSource [income]</code>其中方括号部分是给定事实类型的绑定）</p>
</li>
<li>
<p><strong>字段：</strong>从先前指定的事实模式中选择一个字段。字段选项在项目的“ <strong>数据对象”</strong>面板中的事实文件中定义。（例子： <code>amount</code>要么<code>lengthYears</code>内的字段<code>LoanApplication</code>事实类型）</p>
</li>
<li>
<p><strong>工作项：</strong>从预定义工作项列表中选择。（工作项必须定义与绑定事实上的字段具有相同数据类型的结果参数，以便您将该字段设置为返回参数。）</p>
</li>
<li>
<p><strong>标题（描述）：</strong>添加列的标题文本。</p>
</li>
<li>
<p><strong>隐藏列：</strong>选择此项以隐藏列，或清除此项以显示列。</p>
</li>
<li>
<p><strong>逻辑插入：</strong>当在指导决策表的另一列中当前未使用选定的事实模式时，将出现此选项（请参阅下一个字段说明）。选择此选项可将事实模式逻辑上插入Drools引擎，或清除该模式以定期插入。Drools引擎负责事实的插入和撤回的逻辑决策。在常规或声明的插入之后，必须明确撤回事实。在进行逻辑插入后，当首先断言事实的条件不再成立时，事实将自动撤回。</p>
</li>
<li>
<p><strong>使用更改更新引擎：</strong>当指导决策表中的另一列中已经使用了选定的事实模式时，将显示此选项。选择此项以使用修改后的字段值更新Drools引擎，或者清除此项以不更新Drools引擎。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guided-decision-tables-columns-edit-proc"><a class="anchor" href="#guided-decision-tables-columns-edit-proc"></a> <a class="link" href="#guided-decision-tables-columns-edit-proc">16.4.5。编辑或删除指导决策表中的列</a></h4>
<div class="paragraph">
<p>您可以随时在指导决策表设计器中编辑或删除已创建的列。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在指导决策表设计器中，单击“ <strong>列”</strong> 。</p>
</li>
<li>
<p>展开适当的部分，然后单击列名称旁边的“ <strong>编辑”</strong>或“ <strong>删除”</strong> 。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-columns-edit.png" alt="在指导决策表设计器中编辑或删除列。">
</div>
<div class="title">图311。编辑或删除列</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">如果现有操作列使用与条件列相同的模式匹配参数，则不能删除条件列。
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>更改任何列后，请在向导中单击“ <strong>完成</strong> ”以保存。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="guided-decision-tables-rows-create-proc"><a class="anchor" href="#guided-decision-tables-rows-create-proc"></a> <a class="link" href="#guided-decision-tables-rows-create-proc">16.4.6。在指导决策表中添加行并定义规则</a></h4>
<div class="paragraph">
<p>在指导决策表中创建列之后，可以在指导决策表设计器中添加行并定义规则。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>已按照<a href="#guided-decision-tables-columns-create-proc">将列添加到引导决策表中的</a>描述<a href="#guided-decision-tables-columns-create-proc">添加了引导决策表的列</a> 。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在指导型决策表设计器中，单击<strong>插入</strong> → <strong>附加行</strong>或<strong>插入行</strong>选项之一。（您也可以单击“ <strong>插入列”</strong>以打开列向导并定义新列。）</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-rows-add.png" alt="在指导决策表设计器中添加行">
</div>
<div class="title">图312。添加行</div>
</div>
</li>
<li>
<p>双击每个单元格并输入数据。对于具有指定值的单元格，请从单元格下拉选项中选择。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-rows-add_02.png" alt="在单个单元格中输入数据">
</div>
<div class="title">图313。在每个单元格中输入输入数据</div>
</div>
</li>
<li>
<p>在指导决策表中定义了所有数据行之后，请在指导决策表设计器的右上工具栏中单击“ <strong>验证”</strong>以验证该表。如果表验证失败，请解决错误消息中描述的所有问题，检查表中的所有组件，然后再次尝试验证表，直到表通过为止。</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">尽管指导决策表具有实时验证和确认，但您仍应手动验证完成的决策表以确保获得最佳结果。
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>在表设计器中单击“ <strong>保存</strong> ”以保存您的更改。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>定义了指导决策表内容之后，在指导决策表设计器的右上角，可以根据需要使用搜索栏搜索出现在指导决策表中的文本。搜索功能在具有许多值的复杂的指导决策表中特别有用：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-search.png" alt="搜索指导决策表内容">
</div>
<div class="title">图314。搜索指导决策表内容</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="guided-decision-tables-validation-con"><a class="anchor" href="#guided-decision-tables-validation-con"></a> <a class="link" href="#guided-decision-tables-validation-con">16.4.7。实时验证和确认指导决策表</a></h4>
<div class="paragraph">
<p>Business Central为指导决策表提供了实时验证和确认功能，以确保您的表完整且无错误。每个单元更改后，将验证引导决策表。如果检测到逻辑问题，则会显示错误通知并描述问题。</p>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-errors-ref"><a class="anchor" href="#guided-decision-tables-errors-ref"></a> <a class="link" href="#guided-decision-tables-errors-ref">16.4.7.1。指导决策表中的问题类型</a></h5>
<div class="paragraph">
<p>验证和验证功能可检测以下类型的问题：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">冗余</dt>
<dd>
<p>当决策表中的两行对同一组事实执行相同的结果时，就会发生冗余。例如，两行检查客户的生日并提供生日折扣可能会导致双倍折扣。</p>
</dd>
<dt class="hdlist1">包容性</dt>
<dd>
<p>归类与冗余类似，当两个规则执行相同的结果，但是一个规则对另一个事实的子集执行时，就会发生归类。例如，考虑以下两个规则：</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><em>当人员年龄> 10时增加计数器</em></p>
</li>
<li>
<p><em>当人员年龄> 20时增加计数器</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，如果一个人15岁，则只有一个规则被解雇；如果一个人20岁，则两个规则都将解雇。这样的情况在运行期间会导致类似冗余的麻烦。</p>
</div>
</dd>
<dt class="hdlist1">矛盾冲突</dt>
<dd>
<p>当两个相似的条件产生不同的结果时，就会发生冲突的情况。决策表中的两行（规则）或两个单元之间可能发生冲突。</p>
<div class="paragraph">
<p>以下示例说明了决策表中两行之间的冲突：</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><em>当存款> 20000时，批准贷款</em></p>
</li>
<li>
<p><em>当存款> 20000，然后拒绝贷款</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，无法知道贷款是否会被批准。</p>
</div>
<div class="paragraph">
<p>以下示例说明了决策表中两个单元之间的冲突：</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><em>当年龄> 25</em></p>
</li>
<li>
<p><em>当年龄<25</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>单元冲突的行永远不会执行。</p>
</div>
</dd>
<dt class="hdlist1"><em>唯一匹配</em>破损政策</dt>
<dd>
<p>将<strong>唯一匹配</strong>策略应用于决策表时，一次只能执行一行，并且每一行必须唯一，且不满足条件重叠。如果执行了不止一行，则验证报告将识别损坏的匹配策略。例如，在确定价格折扣资格的表中考虑以下条件：</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><em>什么时候学生=真</em></p>
</li>
<li>
<p><em>什么时候军事=真</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>如果客户既是学生又是军人，则这两个条件均适用，并且会违反“ <strong>唯一匹配”</strong>政策。因此，必须以不允许一次触发多个规则的方式创建这种类型的表中的行。有关命中策略的详细信息，请参见<a href="#hit-policies-con">指导决策表的命中策略</a> 。</p>
</div>
</dd>
<dt class="hdlist1">不足</dt>
<dd>
<p>缺陷类似于冲突，并且决策表中规则的逻辑不完整。例如，请考虑以下两个不足的规则：</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><em>当年龄> 20，然后批准贷款</em></p>
</li>
<li>
<p><em>当存款<20000时拒绝贷款</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>这两个规则可能会导致20岁以上且存款少于20000的人感到困惑。您可以添加更多约束来避免冲突。</p>
</div>
</dd>
<dt class="hdlist1">缺少列</dt>
<dd>
<p>当删除的列导致逻辑不完整或不正确时，规则将无法正确触发。可以检测到这一点，以便您可以解决缺少的列，或调整逻辑以不依赖于故意删除的条件或操作。</p>
</dd>
<dt class="hdlist1">范围不完整</dt>
<dd>
<p>如果表包含对可能的字段值的约束，但未定义所有可能的值，则字段值的范围不完整。验证报告将识别出所提供的任何不完整范围。例如，如果表中有检查是否批准了申请的检查，则验证报告将提醒您确保您还处理未批准申请的情况。</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-messages-ref"><a class="anchor" href="#guided-decision-tables-messages-ref"></a> <a class="link" href="#guided-decision-tables-messages-ref">16.4.7.2。通知类型</a></h5>
<div class="paragraph">
<p>验证和确认功能使用三种类型的通知：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="image"><img src="./Workbench/AuthoringAssets/gdtValidationVerificationIconError.png" alt="gdtValidationVerificationIconError"></span>错误：一个严重的问题，可能导致指导决策表无法按运行时的设计工作。例如，冲突被报告为错误。</p>
</li>
<li>
<p><span class="image"><img src="./Workbench/AuthoringAssets/gdtValidationVerificationIconWarning.png" alt="gdtValidationVerificationIconWarning"></span>警告：可能是一个严重的问题，可能无法阻止指导决策表正常工作，但需要引起注意。例如，包含被报告为警告。</p>
</li>
<li>
<p><span class="image"><img src="./Workbench/AuthoringAssets/gdtValidationVerificationIconInfo.png" alt="gdtValidationVerificationIconInfo"></span>信息：中等或较小的问题，可能无法阻止指导决策表起作用，但需要引起注意。例如，缺少的列将作为信息报告。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Business Central验证和确认不会阻止您保存不正确的更改。该功能仅在编辑时报告问题，您仍然可以继续忽略这些问题并保存更改。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="guided-decision-tables-validation-disable-proc"><a class="anchor" href="#guided-decision-tables-validation-disable-proc"></a> <a class="link" href="#guided-decision-tables-validation-disable-proc">16.4.7.3。禁用验证和确认指导决策表</a></h5>
<div class="paragraph">
<p>默认情况下，Business Central的决策表验证和确认功能处于启用状态。此功能可帮助您验证指导决策表，但对于复杂的指导决策表，此功能可能会妨碍Drools引擎性能。您可以通过设置<code>org.kie.verification.disable-dtable-realtime-verification</code>系统属性值<code>true</code>在您的Drools发行中。</p>
</div>
<div class="paragraph">
<div class="title">程序</div>
<p>导航<code>~/standalone-full.xml</code>并添加以下系统属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;property name="org.kie.verification.disable-dtable-realtime-verification" value="true"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="guided-decision-tables-convert-proc"><a class="anchor" href="#guided-decision-tables-convert-proc"></a> <a class="link" href="#guided-decision-tables-convert-proc">16.4.8。将指导决策表转换为电子表格决策表</a></h4>
<div class="paragraph">
<p>在Business Central中定义了指导性决策表之后，可以将指导性决策表转换为XLS电子表格决策表文件，以供离线参考和文件共享。指导决策表必须是扩展条目指导决策表才能进行转换。转换工具不支持有限的条目指导决策表。</p>
</div>
<div class="paragraph">
<p>有关电子表格决策表的更多信息，请参阅<a href="#decision-tables-con_decision-tables">电子表格决策表</a> 。</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">指导决策表和电子表格决策表是支持不同功能的不同决策表格式。当您将一种决策表格式转换为另一种决策表格式时，两种决策表格式之间所有受支持的功能都会被修改或丢失。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<div class="title">程序</div>
<p>在Business Central中，导航到要转换的引导式决策表资产，然后在决策表设计器的右上工具栏中，单击“ <strong>转换为XLS”</strong> ：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-decision-tables-convert.png" alt="决策表示例">
</div>
<div class="title">图315。转换上传的决策表</div>
</div>
<div class="paragraph">
<p>转换后，转换后的决策表可作为项目中的电子表格决策表资产使用，您可以下载该资产表以供离线参考。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.guideddecisiontablegrapheditor"><a class="anchor" href="#_drools.guideddecisiontablegrapheditor"></a> <a class="link" href="#_drools.guideddecisiontablegrapheditor">16.5。指导决策表图</a></h3>
<div class="paragraph">
<p>尽管可以编写单个“指导决策表”，但也可以编写相关表的图形，其中一个动作可能提供与另一个状况的潜在匹配。在这种情况下，表被认为是相关的。</p>
</div>
<div class="sect3">
<h4 id="_editor"><a class="anchor" href="#_editor"></a> <a class="link" href="#_editor">16.5.1。编辑</a></h4>
<div class="paragraph">
<p>编辑器本身保留了“指导决策表编辑器”的所有功能，只是增加了在单个视图中可视化多个表及其关系的功能。选择单个表将导致列定义面板，“源”和“数据对象”选项卡将更新以反映所选表。验证和验证报告也将更新以反映所选的表。“概述”选项卡维护整个图的状态。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/dtable-graph-radar.png" alt="稳定图雷达">
</div>
<div class="title">图316。图形编辑器和雷达</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_a_new_graph"><a class="anchor" href="#_creating_a_new_graph"></a> <a class="link" href="#_creating_a_new_graph">16.5.2。创建一个新图</a></h4>
<div class="paragraph">
<p>首次创建新的“指导决策表图”时，将扫描目标软件包以查找现有的单个“指导决策表”。检查找到的那些关系，如果存在，则自动将其添加到新图中。</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_new_tables_to_the_graph"><a class="anchor" href="#_adding_new_tables_to_the_graph"></a> <a class="link" href="#_adding_new_tables_to_the_graph">16.5.3。向图中添加新表</a></h4>
<div class="paragraph">
<p>可以通过单击菜单“ Documents…”将表添加到图形中。这将显示一个工具面板，其中列出了已经属于图形一部分的表。同一面板使用户能够添加新表或打开现有表。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/dtable-documents-selector.png" alt="dtable文档选择器">
</div>
<div class="title">图317。文件弹出</div>
</div>
<div class="sect4">
<h5 id="_adding_new_tables"><a class="anchor" href="#_adding_new_tables"></a> <a class="link" href="#_adding_new_tables">16.5.3.1。添加新表</a></h5>
<div class="paragraph">
<p>单击“新建...”，将启动“新建指导决策表向导”。向导完成后，新表将被添加到图形中，并且将自动添加任何关系。</p>
</div>
</div>
<div class="sect4">
<h5 id="_adding_existing_tables"><a class="anchor" href="#_adding_existing_tables"></a> <a class="link" href="#_adding_existing_tables">16.5.3.2。添加现有表</a></h5>
<div class="paragraph">
<p>单击“打开...”将显示一个文件选择器，从中可以选择一个或多个现有的“指导决策表”并将其添加到图形中。如果未找到其他指导决策表，则会向用户显示一条消息。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/dtable-documents-open.png" alt="dtable文档打开">
</div>
<div class="title">图318。文件弹出式视窗-开启现有档案</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_removing_tables"><a class="anchor" href="#_removing_tables"></a> <a class="link" href="#_removing_tables">16.5.4。移除桌子</a></h4>
<div class="paragraph">
<p>通过打开``文档...''面板并单击表旁边的``X''图标，可以从图形中删除表。从图中删除的表不会从项目中删除，可以继续由Gudied Decision Table Editor编辑。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.guideddecisiontreeeditor"><a class="anchor" href="#_drools.guideddecisiontreeeditor"></a> <a class="link" href="#_drools.guideddecisiontreeeditor">16.6。指导决策树</a></h3>
<div class="paragraph">
<p>Business Central支持创作简单的决策树。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>该编辑器目前不支持嵌套数据对象。因此，建议仅将引导式决策树与平面数据对象模型一起使用。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="_the_initial_editor_layout"><a class="anchor" href="#_the_initial_editor_layout"></a> <a class="link" href="#_the_initial_editor_layout">16.6.1。初始编辑器布局</a></h4>
<div class="paragraph">
<p>创建新的指导决策树时，编辑器最初为空白。</p>
</div>
<div class="paragraph">
<p>左侧是可用数据对象，其字段和操作的调色板。</p>
</div>
<div class="paragraph">
<p>右侧是您可以拖放数据对象，其字段或动作以构建树的区域。</p>
</div>
<div class="paragraph">
<p>编辑器将显示正在拖动的节点与可以连接的子节点之间的连接器。拖动完成后，新节点将附加到适用的子节点。根节点被拖到空树时不会显示连接器。完成拖动后，根节点将位于编辑器的中心。</p>
</div>
<div class="paragraph">
<p>组成树时有各种限制：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>一棵树的根必须有一个数据对象。</p>
</li>
<li>
<p>一棵树只能有一个根。</p>
</li>
<li>
<p>数据对象可以具有其他数据对象，字段约束或动作作为子代。</p>
<div class="paragraph">
<p>字段约束必须位于与父节点相同的数据对象的字段上。</p>
</div>
</li>
<li>
<p>字段约束可以具有其他字段约束，也可以具有“操作”作为子级。</p>
<div class="paragraph">
<p>字段约束必须位于与父节点相同的数据对象的字段上。</p>
</div>
</li>
<li>
<p>动作只能有其他动作作为子代。</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditor1.png" alt="GuidedDecisionTreeEditor1">
</div>
<div class="title">图319。指导决策树-空编辑器</div>
</div>
<div class="paragraph">
<p>展开面板会显示数据对象及其字段的树节点。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditor2.png" alt="GuidedDecisionTreeEditor2">
</div>
<div class="title">图320。指导决策树-扩展的调色板</div>
</div>
</div>
<div class="sect3">
<h4 id="_first_steps"><a class="anchor" href="#_first_steps"></a> <a class="link" href="#_first_steps">16.6.2。第一步</a></h4>
<div class="paragraph">
<p>将数据对象拖到树创作区域上。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditor3.png" alt="GuidedDecisionTreeEditor3">
</div>
<div class="title">图321。指导决策树-数据对象根节点</div>
</div>
<div class="paragraph">
<p>单击一个节点将其选中。</p>
</div>
<div class="paragraph">
<p>选择节点后，将出现用于操作节点的图标。</p>
</div>
<div class="paragraph">
<p>图标是：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>删除</p>
<div class="paragraph">
<p>删除节点也将删除所有子节点。</p>
</div>
</li>
<li>
<p>编辑</p>
<div class="paragraph">
<p>折叠的节点包含多个子节点，因此无法对其进行编辑。</p>
</div>
</li>
<li>
<p>坍方</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditor4.png" alt="GuidedDecisionTreeEditor4">
</div>
<div class="title">图322。指导决策树-选定节点</div>
</div>
</div>
<div class="sect3">
<h4 id="_editing_data_object_nodes"><a class="anchor" href="#_editing_data_object_nodes"></a> <a class="link" href="#_editing_data_object_nodes">16.6.3。编辑数据对象节点</a></h4>
<div class="paragraph">
<p>选择一个数据对象节点并单击编辑图标，将显示一个弹出窗口来管理该节点。</p>
</div>
<div class="paragraph">
<p>弹出窗口显示数据对象类型，并允许将其绑定到变量。绑定数据对象可以通过动作进行修改或收回。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditor5.png" alt="GuidedDecisionTreeEditor5">
</div>
<div class="title">图323。指导决策树-数据对象编辑器</div>
</div>
</div>
<div class="sect3">
<h4 id="_editing_field_constraint_nodes"><a class="anchor" href="#_editing_field_constraint_nodes"></a> <a class="link" href="#_editing_field_constraint_nodes">16.6.4。编辑字段约束节点</a></h4>
<div class="paragraph">
<p>选择一个“字段约束”节点并单击“编辑”图标，将显示一个弹出窗口来管理该节点。</p>
</div>
<div class="paragraph">
<p>弹出窗口显示数据对象类型和字段，并允许将字段绑定到变量。可以选择适用于“数据模型”字段的数据类型的运算符，并输入相应的值。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditor6.png" alt="GuidedDecisionTreeEditor6">
</div>
<div class="title">图324。指导决策树-字段约束编辑器</div>
</div>
</div>
<div class="sect3">
<h4 id="_editing_action_nodes"><a class="anchor" href="#_editing_action_nodes"></a> <a class="link" href="#_editing_action_nodes">16.6.5。编辑动作节点</a></h4>
<div class="paragraph">
<p>选择一个“插入动作”节点并单击“编辑”图标，将显示一个弹出窗口来管理该节点。</p>
</div>
<div class="paragraph">
<p>弹出窗口允许选择要插入的数据对象，以及插入的对象是否为“逻辑”。请参阅有关真实维护的Drools文档以获取更多信息。新数据对象的字段可以设置值。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditorActionInsert.png" alt="GuidedDecisionTreeEditorActionInsert">
</div>
<div class="title">图325。指导决策树-动作“插入”编辑器</div>
</div>
<div class="paragraph">
<p>选择一个插入撤回节点并单击编辑图标，将显示一个弹出窗口来管理该节点。</p>
</div>
<div class="paragraph">
<p>弹出窗口允许选择从选定节点到根节点的路径中绑定的任何数据对象以撤回。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditorActionRetract.png" alt="GuidedDecisionTreeEditorActionRetract">
</div>
<div class="title">图326。指导决策树-动作“撤回”编辑器</div>
</div>
<div class="paragraph">
<p>选择一个插入更新节点，然后单击编辑图标，将显示一个弹出窗口来管理该节点。</p>
</div>
<div class="paragraph">
<p>弹出窗口允许修改从选定节点到根节点的路径中绑定的任何数据对象。修改后的数据对象的字段可以设置值。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditorActionUpdate.png" alt="GuidedDecisionTreeEditorActionUpdate">
</div>
<div class="title">图327。指导决策树-动作“更新”编辑器</div>
</div>
</div>
<div class="sect3">
<h4 id="_managing_the_tree"><a class="anchor" href="#_managing_the_tree"></a> <a class="link" href="#_managing_the_tree">16.6.6。管理树</a></h4>
<div class="paragraph">
<p>即使是简单的树木也可能会长大，变得难以维护。</p>
</div>
<div class="paragraph">
<p>因此，可以折叠树的一部分，从而在用户界面中提供更多空间来维护树的不同部分。</p>
</div>
<div class="paragraph">
<p>如果节点具有子节点，则在选中该节点时，将具有一个用于折叠子节点的图标。单击此图标将折叠孩子。</p>
</div>
<div class="paragraph">
<p>通过选择折叠节点并单击展开图标，可以同样地对其进行展开。折叠的节点包含许多子节点，因此无法进行编辑。删除折叠的节点也会删除所有子节点。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditorCollapse1.png" alt="GuidedDecisionTreeEditorCollapse1">
</div>
<div class="title">图328。指导决策树-折叠节点</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/GuidedDecisionTreeEditorCollapse2.png" alt="GuidedDecisionTreeEditorCollapse2">
</div>
<div class="title">图329。指导决策树-折叠节点</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="decision-tables-con_decision-tables"><a class="anchor" href="#decision-tables-con_decision-tables"></a> <a class="link" href="#decision-tables-con_decision-tables">16.7。电子表格决策表</a></h3>
<div class="paragraph">
<p>电子表格决策表是XLS或XLSX电子表格，其中包含以表格格式定义的业务规则。您可以在独立的Drools项目中包含电子表格决策表，也可以将其上载到Business Central中的项目。决策表中的每一行都是一个规则，而每一列则是一个条件，一个动作或另一个规则属性。创建并上传电子表格决策表后，与其他所有规则资产一样，您定义的规则将被编译为Drools规则语言（DRL）规则。</p>
</div>
<div class="paragraph">
<p>与电子表格决策表相关的所有数据对象必须与电子表格决策表位于同一项目包中。默认情况下，导入同一包中的资产。其他包中的现有资产可以与决策表一起导入。</p>
</div>
<div class="sect3">
<h4 id="decision-tables-use-case-con"><a class="anchor" href="#decision-tables-use-case-con"></a> <a class="link" href="#decision-tables-use-case-con">16.7.1。决策表用例</a></h4>
<div class="paragraph">
<p>一个在线购物网站列出了订购商品的运费。该网站在以下情况下提供免费送货：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>订购的商品数量为4个或更多，且结帐总额为300美元或更多。</p>
</li>
<li>
<p>选择标准运输（自购买之日起4或5个工作日）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以下是这些条件下的运费：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表50。少于$ 300的订单</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">东西的个数</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">交货日</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">以美元为单位的运输费用，N =项目数</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">3以下</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">明天</p>
<p class="tableblock">第二天</p>
<p class="tableblock">标准</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">35</p>
<p class="tableblock">15</p>
<p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">4以上</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">明天</p>
<p class="tableblock">第二天</p>
<p class="tableblock">标准</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">N * 7.50</p>
<p class="tableblock">N * 3.50</p>
<p class="tableblock">N * 2.50</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表51。订单金额超过$ 300</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">东西的个数</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">交货日</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">以美元为单位的运输费用，N =项目数</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">3以下</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">明天</p>
<p class="tableblock">第二天</p>
<p class="tableblock">标准</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">25</p>
<p class="tableblock">10</p>
<p class="tableblock">N * 1.50</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">4以上</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">明天</p>
<p class="tableblock">第二天</p>
<p class="tableblock">标准</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">N * 5</p>
<p class="tableblock">N * 2</p>
<p class="tableblock">自由</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>以下示例电子表格决策表中显示了这些条件和费率：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/decision-table-example-02.png" alt="决策表示例">
</div>
<div class="title">图330。运费决定表</div>
</div>
<div class="paragraph">
<p>为了使决策表可以在Business Central中上载，该表必须符合XLS或XLSX电子表格中的某些结构和语法要求，如本示例所示。有关更多信息，请参阅<a href="#decision-tables-defining-proc">定义电子表格决策表</a> 。</p>
</div>
</div>
<div class="sect3">
<h4 id="decision-tables-defining-proc"><a class="anchor" href="#decision-tables-defining-proc"></a> <a class="link" href="#decision-tables-defining-proc">16.7.2。定义电子表格决策表</a></h4>
<div class="paragraph">
<p>电子表格决策表（XLS或XLSX）需要两个定义规则数据的关键区域： <code>RuleSet</code>面积和<code>RuleTable</code>区域。的<code>RuleSet</code>电子表格的“区域”定义要全局应用于同一包（不仅是电子表格）中的所有规则的元素，例如规则集名称或通用规则属性。的<code>RuleTable</code>区域定义实际规则（行）以及在指定规则集中构成该规则表的条件，操作和其他规则属性（列）。决策表的电子表格可以包含多个<code>RuleTable</code>区域，但只有一个<code>RuleSet</code>区域。</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">通常，您应该仅上传一个决策表电子表格，其中包含所有必要的<code>RuleTable</code>业务中心中每个规则包的定义。您可以为单独的程序包上载单独的决策表电子表格，但是在同一程序包中上载多个电子表格可能会因冲突而导致编译错误<code>RuleSet</code>要么<code>RuleTable</code>属性，因此不建议使用。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>定义决策表时，请参考以下示例电子表格：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/decision-table-example-02.png" alt="决策表示例">
</div>
<div class="title">图331。电子表格决策表样本以收取运费</div>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在新的XLS或XLSX电子表格中，转到第二列或第三列并标记一个单元格<code>RuleSet</code> （例如第1行）。在左侧保留一列或多列用于描述性元数据（可选）。</p>
</li>
<li>
<p>在右侧的下一个单元格中，输入<code>RuleSet</code> 。此命名规则集将包含所有<code>RuleTable</code>规则包中定义的规则。</p>
</li>
<li>
<p>在下面<code>RuleSet</code>单元格，定义要全局应用到包中所有规则表的任何规则属性（每个单元格一个）。在右侧的单元格中指定属性值。例如，您可以输入<code>Import</code>标签，并在右侧的单元格中，指定要导入到决策表程序包中的其他程序包中的相关数据对象（格式为<code>package.name.object.name</code> ）。有关支持的单元格标签和值，请参见<a href="#decision-tables-rule-set-entries-ref">RuleSet定义</a> 。</p>
</li>
<li>
<p>以下<code>RuleSet</code>区域，并与<code>RuleSet</code>单元格，跳过一行并标记一个新单元格<code>RuleTable</code> （例如第7行），然后在同一单元格中输入表名称。该名称用作从该规则表派生的所有规则的名称的开头部分，并附加了行号以进行区分。您可以通过插入一个<code>NAME</code>属性列。</p>
</li>
<li>
<p>根据需要使用接下来的四行定义以下元素（示例中的第8-11行）：</p>
<div class="ulist">
<ul>
<li>
<p><strong>规则属性：</strong>条件，操作或其他属性。有关受支持的单元格标签和值，请参见<a href="#decision-tables-rule-table-entries-ref">RuleTable定义</a> 。</p>
</li>
<li>
<p><strong>对象类型：</strong>规则属性应用于的数据对象。如果将相同的对象类型应用于多个列，则将对象单元格合并到多个列中的一个单元格中（如示例决策表中所示），而不是在多个单元格中重复该对象类型。合并对象类型时，合并范围以下的所有列将合并到单个模式内的一组约束中，以一次匹配单个事实。当对象在单独的列中重复时，单独的列可以创建不同的模式，从而可能匹配不同或相同的事实。</p>
</li>
<li>
<p><strong>约束：</strong>对对象类型的约束。</p>
</li>
<li>
<p><strong>列标签：（</strong>可选）列的任何描述性标签，以作为视觉辅助。如果未使用，请留空。</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">除了填充对象类型和约束单元格之外，还可以保留一个或多个对象类型单元格为空，并在相应的约束单元格中输入完整表达式。例如，代替<code>Order</code>作为对象类型和<code>itemsCount > $1</code>作为约束（单独的单元格），您可以将对象类型单元格留空，然后输入<code>Order( itemsCount > $1 )</code>在约束单元格中，然后对其他约束单元格执行相同操作。
</td>
</tr>
</tbody></table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>定义所有必需的规则属性（列）后，根据需要为每一列逐行输入值以生成规则（示例中为第12-17行）。没有数据的单元格将被忽略（例如，当条件或操作不适用时）。</p>
<div class="paragraph">
<p>如果您需要向此决策表电子表格中添加更多规则表，请在上一个表中的最后一个规则之后跳过一行，并标记另一个<code>RuleTable</code>与上一个单元格在同一列中<code>RuleTable</code>和<code>RuleSet</code>单元格，并按照本节中的相同步骤创建新表（示例中为第19-29行）。</p>
</div>
</li>
<li>
<p>保存您的XLS或XLSX电子表格以完成操作。</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">当您在Business Central中上载电子表格时，只有电子表格工作簿中的第一个工作表将作为决策表处理。每<code>RuleSet</code>名称与<code>RuleTable</code>名称在同一包中的所有决策表文件中必须唯一。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>在Business Central中上传决策表后，这些规则将从示例电子表格中呈现为DRL规则，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>//row 12
rule "Basic_12"
salience 10
  when
    $order : Order( itemsCount &gt; 0, itemsCount &lt;= 3, deliverInDays == 1 )
  then
    insert( new Charge( 35 ) );
end</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="title">启用单元格值中使用的空白</div>
<div class="paragraph">
<p>默认情况下，在Drools引擎处理决策表之前，将删除决策表单元格中值之前或之后的所有空格。要保留在单元格中的值之前或之后有意使用的空白，请设置<code>drools.trimCellsInDTable</code>系统属性<code>false</code>在您的Drools发行中。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="decision-tables-rule-set-entries-ref"><a class="anchor" href="#decision-tables-rule-set-entries-ref"></a> <a class="link" href="#decision-tables-rule-set-entries-ref">16.7.2.1。规则集定义</a></h5>
<div class="paragraph">
<p>中的条目<code>RuleSet</code>决策表的“区域”定义要应用于包中所有规则（不仅是电子表格中）的DRL构造和规则属性。条目必须以垂直堆叠的单元格对顺序进行，其中第一个单元格包含标签，而右侧的单元格包含值。决策表电子表格只能有一个<code>RuleSet</code>区域。</p>
</div>
<div class="paragraph">
<p>下表列出了受支持的标签和值<code>RuleSet</code>定义：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表52。支持的<code>RuleSet</code>定义</caption>
<colgroup>
<col style="width:30%">
<col style="width:40%">
<col style="width:30%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">标签</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">值</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>RuleSet</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">生成的DRL文件的软件包名称。可选，默认为<code>rule_table</code> 。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">必须是第一个条目。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>Sequential</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>true</code>要么<code>false</code> 。如果<code>true</code> ，然后使用显着性来确保规则从上到下执行。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选，最多一次。如果省略，则不施加任何点火命令。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>SequentialMaxPriority</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">整数数值</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选，最多一次。在顺序模式下，此选项用于设置显着性的起始值。如果省略，则默认值为65535。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>SequentialMinPriority</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">整数数值</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选，最多一次。在顺序模式下，此选项用于检查是否违反此最小显着性值。如果省略，则默认值为0。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>EscapeQuotes</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>true</code>要么<code>false</code> 。如果<code>true</code> ，然后转义引号，使它们按字面意义出现在DRL中。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选，最多一次。如果省略，引号将被转义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>Import</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用逗号分隔的Java类列表，用于从另一个包中导入。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选，可以重复使用。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>Variables</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">DRL全局声明（类型后跟变量名）。多个全局定义必须用逗号分隔。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选，可以重复使用。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>Functions</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">根据DRL语法的一个或多个函数定义。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选，可以重复使用。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>Queries</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">根据DRL语法的一个或多个查询定义。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选，可以重复使用。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>Declare</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">根据DRL语法的一种或多种声明性类型。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选，可以重复使用。</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">在某些情况下，Microsoft Office，LibreOffice和OpenOffice可能会对双引号进行不同的编码，从而导致编译错误。例如， <code>“A”</code>会失败，但是<code>"A"</code>将通过。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="decision-tables-rule-table-entries-ref"><a class="anchor" href="#decision-tables-rule-table-entries-ref"></a> <a class="link" href="#decision-tables-rule-table-entries-ref">16.7.2.2。RuleTable定义</a></h5>
<div class="paragraph">
<p>中的条目<code>RuleTable</code>决策表的“区域”为该规则表中的规则定义条件，操作和其他规则属性。决策表的电子表格可以包含多个<code>RuleTable</code>地区。</p>
</div>
<div class="paragraph">
<p>下表列出了受支持的标签（列标题）和值<code>RuleTable</code>定义。对于列标题，可以使用给定标签或以表中列出的字母开头的任何自定义标签。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表53。支持的<code>RuleTable</code>定义</caption>
<colgroup>
<col style="width:25%">
<col style="width:20%">
<col style="width:35%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">标签</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">或以开头的自定义标签</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">值</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>NAME</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">ñ</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">提供从该行生成的规则的名称。默认值是根据<code>RuleTable</code>标签和行号。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">最多一列。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>DESCRIPTION</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一世</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">在生成的规则中产生注释。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">最多一列。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>CONDITION</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">C</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用于在条件中的模式内构造约束的代码段和内插值。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">每个规则表至少一个。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>ACTION</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一种</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">代码段和内插值，用于为规则的结果构造动作。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">每个规则表至少一个。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>METADATA</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">@</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用于构建规则的元数据条目的代码段和内插值。</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">可选，任意数量的列。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>以下各节提供有关条件，操作和元数据列如何使用单元格数据的更多详细信息：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">条件</dt>
<dd>
<p>对于列标题<code>CONDITION</code> ，连续行中的单元格会产生一个条件元素：</p>
<div class="ulist">
<ul>
<li>
<p><strong>第一个单元格：</strong>下面第一个单元格中的文本<code>CONDITION</code>发展为规则条件的模式，并使用下一行中的代码段作为约束。如果该单元与一个或多个相邻单元合并，则形成具有多个约束的单个模式。所有约束都合并到带括号的列表中，并附加到此单元格中的文本中。</p>
<div class="paragraph">
<p>如果此单元格为空，则其下方单元格中的代码段必须单独产生一个有效的条件元素。例如，代替<code>Order</code>作为对象类型和<code>itemsCount > $1</code>作为约束（单独的单元格），您可以将对象类型单元格留空，然后输入<code>Order( itemsCount > $1 )</code>在约束单元格中，然后对任何其他约束单元格执行相同操作。</p>
</div>
<div class="paragraph">
<p>要包括一个没有限制的模式，您可以在另一个模式的文本前面加上或不带一个空括号，然后将该模式写入。您还可以附加一个<code>from</code>模式的子句。</p>
</div>
<div class="paragraph">
<p>如果图案以<code>eval</code> ，代码段会产生布尔表达式，并在之后包含在一对括号中<code>eval</code> 。</p>
</div>
</li>
<li>
<p><strong>第二个单元格：</strong>下面第二个单元格中的文本<code>CONDITION</code>被处理为对第一个单元格中对象引用的约束。通过对列中距离较远的单元格的值进行插值，可以修改此单元格中的代码段。如果要创建一个包含比较的约束，请使用<code>==</code>使用下面单元格中的值，则仅使用字段选择器就足够了。必须将任何其他比较运算符指定为代码段中的最后一项，并附加以下单元格中的值。对于所有其他约束形式，必须用符号标记包含单元格内容的位置<code>$param</code> 。如果使用符号，则可以多次插入<code>$1</code> ， <code>$2</code> ，依此类推，并在下面的单元格中用逗号分隔值列表。但是，不要分开<code>$1</code> ， <code>$2</code>等等，以逗号分隔，否则表将无法处理。</p>
<div class="paragraph">
<p>根据模式扩展文本<code>forall($delimiter){$snippet}</code> ，重复<code>$snippet</code>对于下面每个单元格中每个逗号分隔列表的值，请在符号的位置插入一次<code>$</code> ，并按照给定加入这些扩展<code>$delimiter</code> 。请注意<code>forall</code>构造可能会被其他文本包围。</p>
</div>
<div class="paragraph">
<p>如果第一个单元格包含一个对象，则已完成的代码段将从该单元格添加到条件元素。如果将多个约束添加到合并单元格中的模式，则会自动提供一对括号以及一个逗号分隔。如果第一个单元格为空，则该单元格中的代码段必须单独产生一个有效的条件元素。例如，代替<code>Order</code>作为对象类型和<code>itemsCount > $1</code>作为约束（单独的单元格），您可以将对象类型单元格留空，然后输入<code>Order( itemsCount > $1 )</code>在约束单元格中，然后对任何其他约束单元格执行相同操作。</p>
</div>
</li>
<li>
<p><strong>第三单元格：</strong>下面第三单元格中的文本<code>CONDITION</code>是您为该列定义的描述性标签，以作为视觉辅助。</p>
</li>
<li>
<p><strong>第四个单元格：</strong>从第四行开始，非空白条目为插值提供数据。空白单元格将忽略此规则的条件或约束。</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">动作</dt>
<dd>
<p>对于列标题<code>ACTION</code> ，连续行中的单元格会产生一个动作语句：</p>
<div class="ulist">
<ul>
<li>
<p><strong>第一个单元格：</strong>下面第一个单元格中的文本<code>ACTION</code>是可选的。如果存在，则将文本解释为对象引用。</p>
</li>
<li>
<p><strong>第二个单元格：</strong>下面第二个单元格中的文本<code>ACTION</code>是一个代码片段，可通过对列中距离较远的单元格的值进行插值来修改。对于单数插入，请使用符号标记包含单元格内容的位置<code>$param</code> 。如果使用符号，则可以多次插入<code>$1</code> ， <code>$2</code> ，依此类推，并在下面的单元格中用逗号分隔值列表。但是，不要分开<code>$1</code> ， <code>$2</code>等等，以逗号分隔，否则表将无法处理。</p>
<div class="paragraph">
<p>没有任何标记符号的文本可以执行不带插值的方法调用。在这种情况下，请在单元格下面的一行中使用任何非空白条目来包含该语句。的<code>forall</code>支持构造。</p>
</div>
<div class="paragraph">
<p>如果第一个单元格包含一个对象，则将单元格文本（后跟一个句点），第二个单元格中的文本以及一个终止分号串在一起，从而生成一个方法调用，该方法调用被添加为针对结果的操作语句。如果第一个单元格为空，则该单元格中的代码段必须单独产生一个有效的操作元素。</p>
</div>
</li>
<li>
<p><strong>第三单元格：</strong>下面第三单元格中的文本<code>ACTION</code>是您为该列定义的描述性标签，以作为视觉辅助。</p>
</li>
<li>
<p><strong>第四个单元格：</strong>从第四行开始，非空白条目为插值提供数据。空白单元格将忽略此规则的条件或约束。</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">元数据</dt>
<dd>
<p>对于列标题<code>METADATA</code> ，连续行中的单元格将为生成的规则生成元数据注释：</p>
<div class="ulist">
<ul>
<li>
<p><strong>第一个单元格：</strong>下面第一个单元格中的文本<code>METADATA</code>被忽略。</p>
</li>
<li>
<p><strong>第二个单元格：</strong>下面第二个单元格中的文本<code>METADATA</code>使用来自规则行中单元格的值进行插值。元数据标记字符<code>@</code>会自动添加前缀，因此您无需在此单元格的文本中包含该字符。</p>
</li>
<li>
<p><strong>第三单元格：</strong>下面第三单元格中的文本<code>METADATA</code>是您为该列定义的描述性标签，以作为视觉辅助。</p>
</li>
<li>
<p><strong>第四个单元格：</strong>从第四行开始，非空白条目为插值提供数据。空白单元格将导致该规则的元数据注释遗漏。</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="decision-tables-attributes-ref"><a class="anchor" href="#decision-tables-attributes-ref"></a> <a class="link" href="#decision-tables-attributes-ref">16.7.2.3。RuleSet或RuleTable定义的其他规则属性</a></h5>
<div class="paragraph">
<p>的<code>RuleSet</code>和<code>RuleTable</code>区域还支持其他规则属性的标签和值，例如<code>PRIORITY</code>要么<code>NO-LOOP</code> 。在中指定的规则属性<code>RuleSet</code>区域将影响同一包中的所有规则资产（不仅限于电子表格中）。在中指定的规则属性<code>RuleTable</code>区域将仅影响该规则表中的规则。您只能在一个规则中使用每个规则属性一次<code>RuleSet</code>区域和一次<code>RuleTable</code>区域。如果两者都使用相同的属性<code>RuleSet</code>和<code>RuleTable</code>电子表格中的区域，然后<code>RuleTable</code>拥有优先权，并且<code>RuleSet</code>区域被覆盖。</p>
</div>
<div class="paragraph">
<p>下表列出了受支持的标签（列标题）和其他值<code>RuleSet</code>要么<code>RuleTable</code>定义。对于列标题，可以使用给定标签或以表中列出的字母开头的任何自定义标签。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表54。的其他规则属性<code>RuleSet</code>要么<code>RuleTable</code>定义</caption>
<colgroup>
<col style="width:25%">
<col style="width:20%">
<col style="width:55%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">标签</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">或以开头的自定义标签</th>
<th class="tableblock halign-left valign-top" style="background-color:#ffffff">值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>PRIORITY</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">P</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">定义<code>salience</code>规则的价值。在激活队列中排序时，具有较高显着性值的规则将具有较高的优先级。被覆盖<code>Sequential</code>旗。</p>
<p class="tableblock">例：<code>PRIORITY 10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>DATE-EFFECTIVE</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">V</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">包含日期和时间定义的字符串。仅当当前日期和时间在<code>DATE-EFFECTIVE</code>属性。</p>
<p class="tableblock">例：<code>DATE-EFFECTIVE "4-Sep-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>DATE-EXPIRES</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">ž</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">包含日期和时间定义的字符串。如果当前日期和时间晚于<code>DATE-EXPIRES</code>属性。</p>
<p class="tableblock">例：<code>DATE-EXPIRES "4-Oct-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>NO-LOOP</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">ü</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">布尔值。当此选项设置为<code>true</code> ，如果规则的结果重新触发了先前满足的条件，则无法重新激活（循环）该规则。</p>
<p class="tableblock">例：<code>NO-LOOP true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>AGENDA-GROUP</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">G</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个字符串，标识要向其分配规则的议程组。通过议程组，您可以对议程进行分区，以提供对规则组的更多执行控制。只有已获得焦点的议程组中的规则才能被激活。</p>
<p class="tableblock">例：<code>AGENDA-GROUP "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>ACTIVATION-GROUP</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个字符串，用于标识您要向其分配规则的激活（或XOR）组。在激活组中，只能激活一个规则。触发的第一个规则将取消激活组中所有规则的所有未决激活。</p>
<p class="tableblock">例：<code>ACTIVATION-GROUP "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>DURATION</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">d</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个长整数值，定义了如果仍满足规则条件，则可以激活规则的持续时间（以毫秒为单位）。</p>
<p class="tableblock">例：<code>DURATION 10000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>TIMER</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">Ť</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">标识任一字符串<code>int</code> （间隔）或<code>cron</code>用于计划规则的计时器定义。</p>
<p class="tableblock">例： <code>TIMER "*/5 * * * *"</code> （每5分钟）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>CALENDAR</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">Ë</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">用于计划规则的Quartz日历定义。</p>
<p class="tableblock">例： <code>CALENDAR "* * 0-7,18-23 ? * *"</code> （不包括非营业时间）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>AUTO-FOCUS</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个布尔值，仅适用于议程组中的规则。当此选项设置为<code>true</code> ，下次激活该规则时，焦点将自动分配给分配了该规则的议程组。</p>
<p class="tableblock">例：<code>AUTO-FOCUS true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>LOCK-ON-ACTIVE</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">大号</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">一个布尔值，仅适用于规则流组或议程组中的规则。当此选项设置为<code>true</code> ，下一次该规则的规则流组变为活动状态或该规则的议程组获得焦点时，除非规则流组不再处于活动状态或议程组失去焦点，否则无法再次激活该规则。这是更强大的版本<code>no-loop</code>属性，因为匹配的规则的激活将被丢弃，而不考虑更新的来源（不仅是规则本身）。此属性是计算规则的理想选择，在计算规则中，您有许多修改事实的规则，并且您不希望任何规则重新匹配并再次触发。</p>
<p class="tableblock">例：<code>LOCK-ON-ACTIVE true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock"><code>RULEFLOW-GROUP</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">[R</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#ffffff"><p class="tableblock">标识规则流组的字符串。在规则流组中，只有在相关规则流激活了该组时，规则才能触发。</p>
<p class="tableblock">例：<code>RULEFLOW-GROUP "GroupName"</code></p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/decision-table-example-03.png" alt="带有定义的示例决策表">
</div>
<div class="title">图332。带有属性列的示例决策表电子表格</div>
</div>
</div>
<div class="sect4">
<h5 id="_examples_of_decision_table_data_interpolation"><a class="anchor" href="#_examples_of_decision_table_data_interpolation"></a> <a class="link" href="#_examples_of_decision_table_data_interpolation">16.7.2.4。决策表数据内插的示例</a></h5>
<div class="paragraph">
<p>以下示例说明了决策表中数据的各种插值。</p>
</div>
<div class="exampleblock">
<div class="title">例子106。内插单元数据</div>
<div class="content">
<div class="paragraph">
<p>如果模板是<code>Foo(bar == $param)</code>而细胞是<code>42</code> ，那么结果是<code>Foo(bar == 42)</code> 。</p>
</div>
<div class="paragraph">
<p>如果模板是<code>Foo(bar < $1, baz == $2)</code>并且该单元格包含<code>42,43</code> ，结果将是<code>Foo(bar < 42, baz ==43)</code> 。</p>
</div>
<div class="paragraph">
<p>模板<code>forall(&&){bar != $}</code>与包含<code>42,43</code>结果是<code>bar != 42 && bar != 43</code> 。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>下一个示例演示了一个单元格的定义效果，该单元格定义了模式类型及其下方的代码段。</p>
</div>
<table class="tableblock frame-all grid-all center" style="width:40%">
<colgroup>
<col style="width:50%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2" style="background-color:#ffffff">RuleTable奶酪迷</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#fcedcd"><p class="tableblock">条件</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#fcedcd"><p class="tableblock">条件</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2" style="background-color:#fcedcd"><p class="tableblock">人</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#fcedcd"><p class="tableblock">年龄</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#fcedcd"><p class="tableblock">类型</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#c0edf7"><p class="tableblock">人的年龄</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#c0edf7"><p class="tableblock">奶酪类型</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">42</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">斯蒂尔顿</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">切达干酪</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>此电子表格部分显示了<code>Person</code>类型声明跨越2列，因此两个约束都将显示为<code>Person(age == …​, type == …​)</code> 。由于代码段中仅存在字段名称，因此它们意味着相等性测试。</p>
</div>
<div class="paragraph">
<p>在以下示例中，标记符号<code>$param</code>用来。</p>
</div>
<table class="tableblock frame-all grid-all center" style="width:40%">
<colgroup>
<col style="width:100%">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#fcedcd"><p class="tableblock">条件</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#fcedcd"><p class="tableblock">人</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#fcedcd"><p class="tableblock">年龄== $ param</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#c0edf7"><p class="tableblock">人的年龄</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">42</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该列的结果是模式<code>Person(age == 42))</code> 。您可能已经注意到标记和运算符“ ==”是多余的。</p>
</div>
<div class="paragraph">
<p>下一个示例说明可以省略尾随插入标记。</p>
</div>
<table class="tableblock frame-all grid-all center" style="width:40%">
<colgroup>
<col style="width:100%">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#fcedcd"><p class="tableblock">条件</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#fcedcd"><p class="tableblock">人</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#fcedcd"><p class="tableblock">年龄<</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#c0edf7"><p class="tableblock">人的年龄</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">42</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>在这里，暗示从单元格附加值，导致<code>Person(age < 42)).</code></p>
</div>
<div class="paragraph">
<p>您可以提供绑定变量的定义，如下例所示。</p>
</div>
<table class="tableblock frame-all grid-all center" style="width:40%">
<colgroup>
<col style="width:100%">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#fcedcd"><p class="tableblock">条件</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#fcedcd"><p class="tableblock">c：奶酪</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#fcedcd"><p class="tableblock">类型</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#c0edf7"><p class="tableblock">奶酪类型</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">斯蒂尔顿</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>在这里，结果是<code>c: Cheese(type == "stilton").</code>请注意，引号是自动提供的。实际上，任何东西都可以放在对象类型行中。除了定义绑定变量之外，它还可以是从字面上插入的其他模式。</p>
</div>
<div class="paragraph">
<p>下面显示了带有单个值插入的动作语句的简单构造。</p>
</div>
<table class="tableblock frame-all grid-all center" style="width:40%">
<colgroup>
<col style="width:100%">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#fcedcd"><p class="tableblock">行动</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#fcedcd"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#fcedcd"><p class="tableblock">list.add（“ $ param”）;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#c0edf7"><p class="tableblock">日志记录</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">斯蒂尔顿老人</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>ACTION标头下方的单元格保留为空白。使用这种样式，任何结果都可以放在结果中，而不仅仅是单个方法调用。（相同的技术也适用于CONDITION列。）</p>
</div>
<div class="paragraph">
<p>下面是一个综合示例，显示了各种列标题的用法。在列标题下没有任何值（如在NO-LOOP列中）没有错误是错误的：这里，该属性将不会应用到任何规则中。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./DecisionTables/Key.png" alt="键">
</div>
<div class="title">图333。导入，标题等关键字的示例用法</div>
</div>
<div class="paragraph">
<p>最后，这是导入和函数的示例。</p>
</div>
<table class="tableblock frame-all grid-all center" style="width:80%">
<caption class="title">表55。计算价格和折扣要求的功能示例。</caption>
<colgroup>
<col style="width:25%">
<col style="width:75%">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#000000"><p class="tableblock"><span class="white">规则集</span></p></td>
<td class="tableblock halign-left valign-top" style="background-color:#000000"><p class="tableblock"><span class="white">奶酪价格</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#fcedcd"><p class="tableblock">进口</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#fcedcd"><p class="tableblock">com.sample。奶酪，com.sample。人</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color:#fcedcd"><p class="tableblock">功能</p></td>
<td class="tableblock halign-left valign-top" style="background-color:#fcedcd"><div class="content"><div class="listingblock">
<div class="content">
<pre>function int computePrice(Cheese cheese) {
    if (cheese.getType() == "cheddar") {
        return 10;
    } else if (cheese.getType() == "stilton") {
        return 15;
    } else {
        return 20;
    }
}

function boolean hasDiscount(Person person) {
    if (person.getAge() &gt; 60) {
        return true;
    } else {
        return false;
    }
}</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>同一单元格中的多个软件包名称必须用逗号分隔。另外，类型和变量名称对必须用逗号分隔。但是，必须按照DRL文件中出现的功能编写函数。它应与“ RuleSet”关键字显示在同一列中；它可以在所有规则行的上方，之间或下方。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>重复使用导入，变量，函数和查询可能比将多个定义打包到单个单元格中更为方便。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_and_integrating_spreadsheet_decision_tables"><a class="anchor" href="#_creating_and_integrating_spreadsheet_decision_tables"></a> <a class="link" href="#_creating_and_integrating_spreadsheet_decision_tables">16.7.3。创建和集成电子表格决策表</a></h4>
<div class="paragraph">
<p>使用电子表格决策表的API位于<code>drools-decisiontables</code>模块。实际上只有一堂课可以看： <code>SpreadsheetCompiler</code> 。此类将采用各种格式的电子表格，并以DRL（然后可以按常规方式使用）生成规则。的<code>SpreadsheetCompiler</code>可以仅用于生成部分规则文件（如果需要的话），然后将其组合成一个完整的规则包（如果需要，可以将规则的技术和非技术方面分开）。</p>
</div>
<div class="paragraph">
<p>首先，可以将示例电子表格用作基础。或者，如果正在使用插件，则向导可以从模板生成电子表格（要对其进行编辑，将需要使用与xls兼容的电子表格编辑器）。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./DecisionTables/wizard.png" alt="巫师">
</div>
<div class="title">图334。IDE中的向导</div>
</div>
</div>
<div class="sect3">
<h4 id="_decision_table_workflow_and_collaboration"><a class="anchor" href="#_decision_table_workflow_and_collaboration"></a> <a class="link" href="#_decision_table_workflow_and_collaboration">16.7.4。决策表工作流程和协作</a></h4>
<div class="paragraph">
<p>电子表格是完善的业务工具（已使用25年以上）。决策表可以使IT与领域专家之间保持紧密的协作，同时使业务分析师可以清楚地了解业务规则，这是关注点之间的理想分离。</p>
</div>
<div class="paragraph">
<p>通常，编写规则的整个过程（连同新的决策表）如下所示：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>业务分析师（从存储库或从IT）获取模板决策表</p>
</li>
<li>
<p>决策表业务语言描述输入到表中</p>
</li>
<li>
<p>大致输入决策表规则（行）</p>
</li>
<li>
<p>决策表将交给技术资源，后者将业务语言（描述）映射到脚本（当然，这可能涉及软件开发，如果它是新的应用程序或数据模型）</p>
</li>
<li>
<p>技术人员退回并与业务分析师一起审查修改。</p>
</li>
<li>
<p>业务分析师可以根据需要继续编辑规则行（也可以在列周围移动等）。</p>
</li>
<li>
<p>同时，技术人员可以开发规则的测试用例（与业务分析师联系），因为一旦系统运行，这些测试用例就可以用来验证规则和规则更改。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_using_spreadsheet_features"><a class="anchor" href="#_using_spreadsheet_features"></a> <a class="link" href="#_using_spreadsheet_features">16.7.5。使用电子表格功能</a></h4>
<div class="paragraph">
<p>Excel等应用程序的功能可用于协助将数据输入到电子表格中，例如验证字段。存储在其他工作表中的列表可用于为单元格提供有效的值列表，如下图所示。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./DecisionTables/lists.png" alt="清单">
</div>
</div>
<div class="paragraph">
<p>某些应用程序提供的更改历史记录功能有限，但是建议使用替代版本控制方法。当规则随时间变化时，旧版本将被存档（为此存在许多开源解决方案，例如Subversion或Git）。</p>
</div>
</div>
<div class="sect3">
<h4 id="_rule_templates"><a class="anchor" href="#_rule_templates"></a> <a class="link" href="#_rule_templates">16.7.6。规则模板</a></h4>
<div class="paragraph">
<p>与决策表相关的（但不一定需要电子表格）是“规则模板”（在drools-templates模块中）。它们使用任何表格数据源作为规则数据源-填充模板以生成许多规则。这样既可以使用更灵活的电子表格，也可以使用现有数据库中的规则（例如，需要预先开发模板以生成规则）。</p>
</div>
<div class="paragraph">
<p>使用规则模板，数据与规则是分离的，并且对规则的哪一部分受数据驱动没有限制。因此，尽管您可以做决策表中可以做的所有事情，但是您还可以执行以下操作：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>将您的数据存储在数据库（或任何其他格式）中</p>
</li>
<li>
<p>根据数据中的值有条件地生成规则</p>
</li>
<li>
<p>将数据用于规则的任何部分（例如条件运算符，类名，属性名）</p>
</li>
<li>
<p>对同一数据运行不同的模板</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如，显示了一个更经典的决策表，但没有任何隐藏的规则元数据行（因此，电子表格仅包含用于生成规则的原始数据）。</p>
</div>
<table class="tableblock frame-all grid-all stretch center">
<caption class="title">表56。模板数据</caption>
<colgroup>
<col style="width:25%">
<col style="width:25%">
<col style="width:25%">
<col style="width:25%">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" style="background-color:#c0edf7"><p class="tableblock">案件</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#c0edf7"><p class="tableblock">人年龄</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#c0edf7"><p class="tableblock">奶酪类型</p></td>
<td class="tableblock halign-center valign-top" style="background-color:#c0edf7"><p class="tableblock">日志记录</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">老家伙</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">42</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">斯蒂尔顿</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">斯蒂尔顿老人</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">年轻人</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">切达干酪</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">切达干酪</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>有关上述电子表格，请参见示例下载中的<em class="path">ExampleCheese.xls</em> 。</p>
</div>
<div class="paragraph">
<p>如果这是一个常规决策表，则在第1行之前以及第1和2行之间将包含隐藏的行，其中包含规则元数据。使用规则模板，数据与规则完全分开。这有两个方便的结果-您可以将多个规则模板应用于相同的数据，而您的数据完全不依赖于规则。那么模板是什么样的？</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>1  template header
2  age
3  type
4  log
5
6  package org.drools.examples.templates;
7
8  global java.util.List list;
9
10 template "cheesefans"
11
12 rule "Cheese fans_@{row.rowNumber}"
13 when
14    Person(age == @{age})
15    Cheese(type == "@{type}")
16 then
17    list.add("@{log}");
18 end
19
20 end template</code></pre>
</div>
</div>
<div class="paragraph">
<p>前面程序清单的注释：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>第1行：所有规则模板均以<code>template header</code> 。</p>
</li>
<li>
<p>第2-4行：标题之后是按其在数据中出现的顺序列出的列。在这种情况下，我们称为第一列<code>age</code> ， 第二<code>type</code>第三<code>log</code> 。</p>
</li>
<li>
<p>第5行：空行表示列定义的结尾。</p>
</li>
<li>
<p>第6-9行：标准规则标题文本。这是标准规则DRL，将显示在生成的DRL的顶部。将package语句以及所有导入，全局和函数定义放入此部分。</p>
</li>
<li>
<p>第10行：关键字<code>template</code>表示规则模板的开始。模板文件中可以有多个模板，但是每个模板应具有唯一的名称。</p>
</li>
<li>
<p>第11-18行：规则模板-有关详细信息，请参见下文。</p>
</li>
<li>
<p>第20行：关键字<code>end template</code>表示模板的结尾。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>规则模板依靠MVEL使用@ {token_name}语法进行替换。当前有一个内置表达式@ {row.rowNumber}，它为每行数据提供唯一的编号，并使您能够生成唯一的规则名称。对于每行数据，将生成一条规则，其中数据中的值将替换模板中的标记。</p>
</div>
<div class="paragraph">
<p>如下例所示，在kmodule.xml文件中定义kbase时，规则模板必须包含在扩展名为.drt的文件中并与相应的决策表相关联。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;kmodule xmlns="http://drools.org/xsd/kmodule"&gt;
  &lt;kbase name="TemplatesKB" packages="org.drools.examples.templates"&gt;
    &lt;ruleTemplate dtable="org/drools/examples/templates/ExampleCheese.xls"
                  template="org/drools/examples/templates/Cheese.drt"
                  row="2" col="2"/&gt;
      &lt;ksession name="TemplatesKS"/&gt;
      &lt;/kbase&gt;
&lt;/kmodule&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于上面的示例数据，将生成以下规则文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>package org.drools.examples.templates;

global java.util.List list;

rule "Cheese fans_1"
when
  Person( age == 42 )
  Cheese( type == "stilton" )
then
  list.add( "Old man stilton" );
end

rule "Cheese fans_2"
when
  Person( age == 21 )
  Cheese( type == "cheddar" )
then
  list.add( "Young man cheddar" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>此时， <code>KieSession</code>可以轻松地通过以下方式创建名为“ TemplatesKS”并包含从模板生成的规则的文件<code>KieContainer</code>并用作其他<code>KieSession</code> 。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession ksession = kc.newKieSession("TemplatesKS");

// now create some test data
ksession.insert(new Cheese("stilton", 42));
ksession.insert(new Person("michael", "stilton", 42));
final List&lt;String&gt; list = new ArrayList&lt;String&gt;();
ksession.setGlobal("list", list);

ksession.fireAllRules();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="decision-tables-upload-proc"><a class="anchor" href="#decision-tables-upload-proc"></a> <a class="link" href="#decision-tables-upload-proc">16.7.7。将电子表格决策表上传到Business Central</a></h4>
<div class="paragraph">
<p>在外部XLS或XLSX决策表电子表格中定义规则后，可以将电子表格文件上传到Business Central中的项目。</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">通常，您应该仅上传一个决策表电子表格，其中包含所有必要的<code>RuleTable</code>业务中心中每个规则包的定义。您可以为单独的程序包上载单独的决策表电子表格，但是在同一程序包中上载多个电子表格可能会因冲突而导致编译错误<code>RuleSet</code>要么<code>RuleTable</code>属性，因此不建议使用。
</td>
</tr>
</tbody></table>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在Business Central中，转到<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> ，然后单击项目名称。</p>
</li>
<li>
<p>单击<strong>添加资产</strong> → <strong>决策表（电子表格）</strong> 。</p>
</li>
<li>
<p>输入信息丰富的<strong>决策表</strong>名称，然后选择适当的“ <strong>程序包”</strong> 。</p>
</li>
<li>
<p>选择文件类型（ <strong>xls</strong>或<strong>xlsx</strong> ），单击“ <strong>选择文件”</strong>图标，然后选择电子表格。单击<strong>确定</strong>上传。</p>
</li>
<li>
<p>在决策表设计器，单击<strong>验证</strong>右上方的工具栏来验证表。如果表验证失败，请打开XLS或XLSX文件并解决所有语法错误。要获得语法帮助，请参阅<a href="#decision-tables-defining-proc">定义电子表格决策表</a> 。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>您可以上传决策表的新版本或下载当前版本：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/decision-table-uploaded.png" alt="决策表示例">
</div>
<div class="title">图335。上传的决策表选项</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="decision-tables-convert-proc"><a class="anchor" href="#decision-tables-convert-proc"></a> <a class="link" href="#decision-tables-convert-proc">16.7.8。将上载的电子表格决策表转换为Business Central中的指导决策表</a></h4>
<div class="paragraph">
<p>将XLS或XLSX电子表格决策表文件上载到Business Central中的项目后，可以将决策表转换为可以在Business Central中直接修改的指导决策表。</p>
</div>
<div class="paragraph">
<p>有关指导决策表的更多信息，请参阅<a href="#guided-decision-tables-con">指导决策表</a> 。</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">指导决策表和电子表格决策表是支持不同功能的不同决策表格式。当您将一种决策表格式转换为另一种决策表格式时，两种决策表格式之间所有受支持的功能都会被修改或丢失。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<div class="title">程序</div>
<p>在Business Central中，导航到要转换的上载决策表资产，然后在决策表设计器的右上工具栏中，单击<strong>Convert</strong> ：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/decision-table-uploaded-convert.png" alt="决策表示例">
</div>
<div class="title">图336。转换上传的决策表</div>
</div>
<div class="paragraph">
<p>转换后，转换后的决策表可作为项目中的指导决策表资产使用，您可以直接在Business Central中对其进行修改。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="drl-rules-con_drl-rules"><a class="anchor" href="#drl-rules-con_drl-rules"></a> <a class="link" href="#drl-rules-con_drl-rules">16.8。DRL（Drools规则语言）规则</a></h3>
<div class="paragraph">
<p>DRL（Drools规则语言）规则是您直接在其中定义的业务规则<code>.drl</code>文本文件。这些DRL文件是最终呈现Business Central中所有其他规则资产的源。您可以在Business Central界面中创建和管理DRL文件，或者使用Red Hat CodeReady Studio或其他集成开发环境（IDE）作为Maven或Java项目的一部分在外部创建它们。DRL文件可以包含一个或多个规则，这些规则至少定义了规则条件（ <code>when</code> ）和动作（ <code>then</code> ）。Business Central中的DRL设计器提供Java，DRL和XML的语法突出显示。</p>
</div>
<div class="paragraph">
<p>DRL文件包含以下组件：</p>
</div>
<div class="listingblock">
<div class="title">DRL文件中的组件</div>
<div class="content">
<pre class="highlightjs highlight"><code>package

import

function  // Optional

query  // Optional

declare   // Optional

global   // Optional

rule "rule name"
    // Attributes
    when
        // Conditions
    then
        // Actions
end

rule "rule2 name"

...</code></pre>
</div>
</div>
<div class="paragraph">
<p>以下示例DRL规则确定贷款申请决策服务中的年龄限制：</p>
</div>
<div class="listingblock">
<div class="title">贷款申请年龄限制的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Underage"
  salience 15
  agenda-group "applicationGroup"
  when
    $application : LoanApplication()
    Applicant( age &lt; 21 )
  then
    $application.setApproved( false );
    $application.setExplanation( "Underage" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>DRL文件可以包含单个或多个规则，查询和函数，并且可以定义资源声明，例如由规则和查询分配和使用的导入，全局和属性。DRL软件包必须在DRL文件的顶部列出，并且规则通常在最后列出。所有其他DRL组件都可以遵循任何顺序。</p>
</div>
<div class="paragraph">
<p>每个规则在规则包中必须具有唯一的名称。如果在包中的任何DRL文件中多次使用相同的规则名称，则规则将无法编译。规则名称始终用双引号引起来（ <code>rule "rule name"</code> ）以防止可能的编译错误，尤其是在规则名称中使用空格的情况下。</p>
</div>
<div class="paragraph">
<p>与DRL规则相关的所有数据对象必须与Business Central中的DRL文件位于同一项目包中。默认情况下，导入同一包中的资产。可以使用DRL规则导入其他软件包中的现有资产。</p>
</div>
<div class="sect3">
<h4 id="drl-rules-central-create-proc"><a class="anchor" href="#drl-rules-central-create-proc"></a> <a class="link" href="#drl-rules-central-create-proc">16.8.1。在Business Central中创建DRL规则</a></h4>
<div class="paragraph">
<p>您可以在Business Central中为项目创建和管理DRL规则。在每个DRL规则文件中，您都基于在包中创建或导入的数据对象定义规则条件，操作以及与规则相关的其他组件。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在Business Central中，转到<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> ，然后单击项目名称。</p>
</li>
<li>
<p>单击<strong>添加资产</strong> → <strong>DRL文件</strong> 。</p>
</li>
<li>
<p>输入信息丰富的<strong>DRL文件</strong>名，然后选择适当的<strong>Package</strong> 。您指定的包必须与已分配或将要分配所需数据对象的包相同。</p>
<div class="paragraph">
<p>如果您的项目中定义了任何特定领域的语言（DSL）资产，也可以选择“ <strong>显示声明的DSL句子”</strong> 。然后，这些DSL资产将成为您在DRL设计器中定义的条件和操作的可用对象。</p>
</div>
</li>
<li>
<p>单击<strong>确定</strong>以创建规则资产。</p>
<div class="paragraph">
<p>现在，新的DRL文件在“ <strong>项目资源管理器”</strong>的“ <strong>DRL”</strong>面板中，或者在<strong>DSLR</strong>面板中列出（如果您选择了“ <strong>显示声明的DSL句子”</strong>选项）。您分配了此DRL文件的包在文件顶部列出。</p>
</div>
</li>
<li>
<p>在DRL设计器左面板的“ <strong>事实类型”</strong>列表中，确认列出了规则所需的所有数据对象和数据对象字段（每个字段都展开）。如果不是，则可以使用以下命令从其他包中导入相关数据对象<code>import</code> DRL文件中的语句，或在包中<a href="#_wb.datamodeller">创建数据对象</a> 。</p>
</li>
<li>
<p>所有数据对象放置到位后，返回DRL设计器的“ <strong>模型”</strong>选项卡，并使用以下任何组件定义DRL文件：</p>
<div class="listingblock">
<div class="title">DRL文件中的组件</div>
<div class="content">
<pre class="highlightjs highlight"><code>package

import

function  // Optional

query  // Optional

declare   // Optional

global   // Optional

rule "rule name"
    // Attributes
    when
        // Conditions
    then
        // Actions
end

rule "rule2 name"

...</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>package</code> ：（自动）为您创建DRL文件并选择包时为您定义。</p>
</li>
<li>
<p><code>import</code> ：使用它来标识此包或要在DRL文件中使用的另一个包中的数据对象。以格式指定包和数据对象<code>packageName.objectName</code> ，并在不同的行上进行多次导入。</p>
<div class="listingblock">
<div class="title">导入数据对象</div>
<div class="content">
<pre class="highlightjs highlight"><code>import org.mortgages.LoanApplication;</code></pre>
</div>
</div>
</li>
<li>
<p><code>function</code> ：（可选）使用此功能可在DRL文件中包含规则要使用的功能。DRL文件中的函数将语义代码放入规则源文件中，而不是Java类中。如果操作（ <code>then</code> ）规则的一部分会重复使用，并且每个规则的参数都不同。在DRL文件中的规则上方，您可以声明函数或从帮助程序类中导入静态方法作为函数，然后在操作中按名称使用该函数（ <code>then</code> ）的部分规则。</p>
<div class="listingblock">
<div class="title">声明和使用带有规则的函数（选项1）</div>
<div class="content">
<pre class="highlightjs highlight"><code>function String hello(String applicantName) {
    return "Hello " + applicantName + "!";
}

rule "Using a function"
  when
    // Empty
  then
    System.out.println( hello( "James" ) );
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">导入并使用带有规则的功能（选项2）</div>
<div class="content">
<pre class="highlightjs highlight"><code>import function my.package.applicant.hello;

rule "Using a function"
  when
    // Empty
  then
    System.out.println( hello( "James" ) );
end</code></pre>
</div>
</div>
</li>
<li>
<p><code>query</code> ：（可选）使用此命令在Drools引擎中搜索与DRL文件中的规则相关的事实。您在DRL文件中添加查询定义，然后在应用程序代码中获得匹配的结果。查询搜索一组已定义的条件，不需要<code>when</code>要么<code>then</code>规格。查询名称是KIE基础的全局名称，因此在项目中的所有其他规则查询中必须唯一。要返回查询结果，请构造一个传统的<code>QueryResults</code>定义使用<code>ksession.getQueryResults("name")</code> ，在哪里<code>"name"</code>是查询名称。这将返回查询结果列表，使您能够检索与查询匹配的对象。在DRL文件中的规则上方定义查询和查询结果参数。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">DRL文件中的示例查询定义</div>
<div class="content">
<pre class="highlightjs highlight"><code>query "people under the age of 21"
    $person : Person( age &lt; 21 )
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">获取查询结果的示例应用程序代码</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">QueryResults results = ksession.getQueryResults( "people under the age of 21" );
System.out.println( "we have " + results.size() + " people under the age  of 21" );</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><code>declare</code> ：（可选）使用它来声明DRL文件中的规则要使用的新事实类型。默认事实类型<code>java.lang</code> Drools的包装是<code>Object</code> ，但是您可以根据需要在DRL文件中声明其他类型。在DRL文件中声明事实类型使您可以直接在Drools引擎中定义新的事实模型，而无需使用Java之类的低级语言创建模型。</p>
<div class="listingblock">
<div class="title">声明和使用新的事实类型</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare Person
  name : String
  dateOfBirth : java.util.Date
  address : Address
end

rule "Using a declared type"
  when
    $p : Person( name == "James" )
  then   // Insert Mark, who is a customer of James.
    Person mark = new Person();
    mark.setName( "Mark" );
    insert( mark );
end</code></pre>
</div>
</div>
</li>
<li>
<p><code>global</code> ：（可选）使用它包括DRL文件中的规则要使用的全局变量。全局变量通常为规则提供数据或服务，例如规则结果中使用的应用程序服务，并从规则返回数据，例如在规则结果中添加日志或值。通过KIE会话配置或REST操作在Drools引擎的工作内存中设置全局值，在DRL文件中的规则上方声明全局变量，然后在操作中使用它（ <code>then</code> ）的部分规则。对于多个全局变量，请在DRL文件中使用单独的行。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">设置Drools引擎的全局列表配置</div>
<div class="content">
<pre class="highlightjs highlight"><code>List&lt;String&gt; list = new ArrayList&lt;&gt;();
KieSession kieSession = kiebase.newKieSession();
kieSession.setGlobal( "myGlobalList", list );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">在规则中定义全局列表</div>
<div class="content">
<pre class="highlightjs highlight"><code>global java.util.List myGlobalList;

rule "Using a global"
  when
    // Empty
  then
    myGlobalList.add( "My global list" );
end</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p>除非全局变量具有恒定的不变值，否则请勿使用全局变量在规则中建立条件。全局变量未插入Drools引擎的工作存储器中，因此Drools引擎无法跟踪变量的值更改。</p>
</div>
<div class="paragraph">
<p>不要使用全局变量在规则之间共享数据。规则总是会推理并对工作内存状态做出反应，因此，如果您希望将数据从一个规则传递到另一个规则，请将数据作为事实断言到Drools引擎的工作内存中。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</li>
<li>
<p><code>rule</code> ：使用它来定义DRL文件中的每个规则。规则由格式的规则名称组成<code>rule "name"</code> ，后跟定义规则行为的可选属性（例如<code>salience</code>要么<code>no-loop</code> ）， 其次是<code>when</code>和<code>then</code>定义。每个规则在规则包中必须具有唯一的名称。的<code>when</code>规则的一部分包含执行动作必须满足的条件。例如，如果银行要求贷款申请人的年龄超过21岁，则<code>when</code>一个条件<code>"Underage"</code>规则是<code>Applicant( age < 21 )</code> 。的<code>then</code>规则的一部分包含满足规则的条件部分时要执行的操作。例如，当贷款申请人未满21岁时， <code>then</code>行动将是<code>setApproved( false )</code> ，因为申请人未满年龄而拒绝贷款。</p>
<div class="listingblock">
<div class="title">贷款申请年龄限制规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Underage"
  salience 15
  when
    $application : LoanApplication()
    Applicant( age &lt; 21 )
  then
    $application.setApproved( false );
    $application.setExplanation( "Underage" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>每个DRL文件至少必须指定<code>package</code> ， <code>import</code>和<code>rule</code>组件。所有其他组件都是可选的。</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>以下是贷款申请决策服务中的示例DRL文件：</p>
</div>
<div class="listingblock">
<div class="title">贷款申请的示例DRL文件</div>
<div class="content">
<pre class="highlightjs highlight"><code>package org.mortgages;

import org.mortgages.LoanApplication;
import org.mortgages.Bankruptcy;
import org.mortgages.Applicant;

rule "Bankruptcy history"
	salience 10
	when
		$a : LoanApplication()
		exists (Bankruptcy( yearOfOccurrence &gt; 1990 || amountOwed &gt; 10000 ))
	then
		$a.setApproved( false );
		$a.setExplanation( "has been bankrupt" );
		delete( $a );
end

rule "Underage"
	salience 15
	when
		$application : LoanApplication()
		Applicant( age &lt; 21 )
	then
		$application.setApproved( false );
		$application.setExplanation( "Underage" );
		delete( $application );
end</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AuthoringAssets/drl-rules-sample.png" alt="具有所需组件的示例DRL文件">
</div>
<div class="title">图337。Business Central中贷款申请的示例DRL文件</div>
</div>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>在定义规则的所有组件，单击<strong>验证</strong> DRL设计师的右上方工具栏中的验证DRL文件。如果文件验证失败，请解决错误消息中描述的所有问题，查看DRL文件中的所有语法和组件，然后再次尝试验证文件，直到文件通过。</p>
</li>
<li>
<p>在DRL设计器中单击“ <strong>保存</strong> ”以保存您的工作。</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="drl-rules-WHEN-proc"><a class="anchor" href="#drl-rules-WHEN-proc"></a> <a class="link" href="#drl-rules-WHEN-proc">16.8.1.1。在DRL规则中添加WHEN条件</a></h5>
<div class="paragraph">
<p>的<code>when</code>规则的一部分包含执行动作必须满足的条件。例如，如果银行要求贷款申请人的年龄超过21岁，则<code>when</code>条件<code>"Underage"</code>规则是<code>Applicant( age < 21 )</code> 。条件由一系列陈述的模式和约束，以及基于包中可用数据对象的可选绑定和其他受支持的DRL元素组成。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>的<code>package</code>在DRL文件的顶部定义。创建文件时，这应该已经为您完成了。</p>
</li>
<li>
<p>的<code>import</code>规则中使用的数据对象列表在<code>package</code> DRL文件的一行。数据对象可以来自此程序包，也可以来自Business Central中的另一个程序包。</p>
</li>
<li>
<p>的<code>rule</code>名称以格式定义<code>rule "name"</code>以下<code>package</code> ， <code>import</code>以及适用于整个DRL文件的其他行。同一规则名称不能在同一包中多次使用。可选规则属性（例如<code>salience</code>要么<code>no-loop</code> ），它定义了规则行为，位于规则名称下方， <code>when</code>部分。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在DRL设计器中，输入<code>when</code>在规则内开始添加条件语句。的<code>when</code>部分由零个或多个定义规则条件的事实模式组成。</p>
<div class="paragraph">
<p>如果<code>when</code>部分为空，则认为条件为真，并且<code>then</code>该部分在第一次执行时<code>fireAllRules()</code>在Drools引擎中进行调用。如果要使用规则来设置Drools引擎状态，这将很有用。</p>
</div>
<div class="listingblock">
<div class="title">没有条件的示例规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Always insert applicant"
  when
    // Empty
  then   // Actions to be executed once
    insert( new Applicant() );
end

// The rule is internally rewritten in the following way:

rule "Always insert applicant"
  when
    eval( true )
  then
    insert( new Applicant() );
end</code></pre>
</div>
</div>
</li>
<li>
<p>输入要满足的第一个条件的模式，并带有可选的约束，绑定和其他受支持的DRL元素。基本模式格式是<code><patternBinding> : <patternType> ( <constraints> )</code> 。模式基于包中的可用数据对象，并定义要满足的条件，以便触发<code>then</code>部分。</p>
<div class="ulist">
<ul>
<li>
<p><strong>简单模式：</strong>没有约束的简单模式与给定类型的事实匹配。例如，以下条件仅是申请人存在。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>when
  Applicant()</code></pre>
</div>
</div>
</li>
<li>
<p><strong>有约束</strong>的模式<strong>：有约束</strong>的模式与给定类型的事实以及括号中为true或false的其他限制相匹配。例如，以下条件是申请人未满21岁。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>when
  Applicant( age &lt; 21 )</code></pre>
</div>
</div>
</li>
<li>
<p><strong>带绑定的模式：</strong>对模式的绑定是速记引用，规则的其他组件可用于引用已定义的模式。例如下面的绑定<code>a</code>上<code>LoanApplication</code>未成年申请人在相关行动中使用。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>when
  $a : LoanApplication()
  Applicant( age &lt; 21 )
then
  $a.setApproved( false );
  $a.setExplanation( "Underage" )</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>继续定义适用于此规则的所有条件模式。以下是一些用于定义DRL条件的关键字选项：</p>
<div class="ulist">
<ul>
<li>
<p><code>and</code> ：使用此选项将条件组件分组为逻辑连接。前缀和前缀<code>and</code>支持。默认情况下，所有列出的模式都与<code>and</code>未指定任何连词时。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// All of the following examples are interpreted the same way:
$a : LoanApplication() and Applicant( age &lt; 21 )

$a : LoanApplication()
and Applicant( age &lt; 21 )

$a : LoanApplication()
Applicant( age &lt; 21 )

(and $a : LoanApplication() Applicant( age &lt; 21 ))</code></pre>
</div>
</div>
</li>
<li>
<p><code>or</code> ：使用它可以将条件组件分为逻辑分离。前缀和前缀<code>or</code>支持。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>// All of the following examples are interpreted the same way:
Bankruptcy( amountOwed == 100000 ) or IncomeSource( amount == 20000 )

Bankruptcy( amountOwed == 100000 )
or IncomeSource( amount == 20000 )

(or Bankruptcy( amountOwed == 100000 ) IncomeSource( amount == 20000 ))</code></pre>
</div>
</div>
</li>
<li>
<p><code>exists</code> ：使用它来指定必须存在的事实和约束。仅在第一个匹配项上触发此选项，而不在随后的匹配项上触发。如果您将此元素与多个模式一起使用，请用括号将模式括起来<code>()</code> 。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>exists ( Bankruptcy( yearOfOccurrence &gt; 1990 || amountOwed &gt; 10000 ) )</code></pre>
</div>
</div>
</li>
<li>
<p><code>not</code> ：使用它来指定事实和约束，这些事实和约束必须不存在。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>not ( Applicant( age &lt; 21 ) )</code></pre>
</div>
</div>
</li>
<li>
<p><code>forall</code> ：使用它来验证是否所有与第一个模式匹配的事实都与所有其余模式匹配。当一个<code>forall</code>构造满意，规则评估为<code>true</code> 。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>forall( $app : Applicant( age &lt; 21 )
              Applicant( this == $app, status = 'underage' ) )</code></pre>
</div>
</div>
</li>
<li>
<p><code>from</code> ：使用它可以为模式指定数据源。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Applicant( ApplicantAddress : address )
Address( zipcode == "23920W" ) from ApplicantAddress</code></pre>
</div>
</div>
</li>
<li>
<p><code>entry-point</code> ：使用它来定义<code>Entry Point</code>对应于模式的数据源。通常与<code>from</code> 。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Applicant() from entry-point "LoanApplication"</code></pre>
</div>
</div>
</li>
<li>
<p><code>collect</code> ：使用它来定义规则可以用作条件一部分的对象的集合。在该示例中，Drools引擎中针对每个给定抵押的所有待处理应用程序都分组在一个<code>List</code> 。如果找到三个或更多待处理的应用程序，则执行该规则。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$m : Mortgage()
$a : List( size &gt;= 3 )
    from collect( LoanApplication( Mortgage == $m, status == 'pending' ) )</code></pre>
</div>
</div>
</li>
<li>
<p><code>accumulate</code> ：使用它来遍历对象集合，对每个元素执行自定义操作，并返回一个或多个结果对象（如果约束评估为<code>true</code> ）。此选项是更灵活，更强大的<code>collect</code> 。使用格式<code>accumulate( <source pattern>; <functions> [;<constraints>] )</code> 。在这个例子中<code>min</code> ， <code>max</code>和<code>average</code>是用于计算每个传感器所有读数的最小，最大和平均温度值的累加功能。其他受支持的功能包括<code>count</code> ， <code>sum</code> ， <code>variance</code> ， <code>standardDeviation</code> ， <code>collectList</code>和<code>collectSet</code> 。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$s : Sensor()
accumulate( Reading( sensor == $s, $temp : temperature );
            $min : min( $temp ),
            $max : max( $temp ),
            $avg : average( $temp );
            $min &lt; 20, $avg &gt; 70 )</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">有关DRL规则条件的更多信息，请参阅<a href="#drl-rules-WHEN-con_drl-rules">DRL（WHEN）中的规则条件</a> 。
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>在定义规则的所有条件组件，单击<strong>验证</strong> DRL设计师的右上方工具栏中的验证DRL文件。如果文件验证失败，请解决错误消息中描述的所有问题，查看DRL文件中的所有语法和组件，然后再次尝试验证文件，直到文件通过。</p>
</li>
<li>
<p>在DRL设计器中单击“ <strong>保存</strong> ”以保存您的工作。</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="drl-rules-THEN-proc"><a class="anchor" href="#drl-rules-THEN-proc"></a> <a class="link" href="#drl-rules-THEN-proc">16.8.1.2。在DRL规则中添加THEN操作</a></h5>
<div class="paragraph">
<p>的<code>then</code>规则的一部分包含满足规则的条件部分时要执行的操作。例如，当贷款申请人未满21岁时， <code>then</code>一个动作<code>"Underage"</code>规则是<code>setApproved( false )</code> ，因为申请人未满年龄而拒绝贷款。操作由一种或多种方法组成，这些方法根据规则条件和程序包中的可用数据对象执行结果。规则操作的主要目的是在Drools引擎的工作内存中插入，删除或修改数据。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>的<code>package</code>在DRL文件的顶部定义。创建文件时，这应该已经为您完成了。</p>
</li>
<li>
<p>的<code>import</code>规则中使用的数据对象列表在<code>package</code> DRL文件的一行。数据对象可以来自此程序包，也可以来自Business Central中的另一个程序包。</p>
</li>
<li>
<p>的<code>rule</code>名称以格式定义<code>rule "name"</code>以下<code>package</code> ， <code>import</code>以及适用于整个DRL文件的其他行。同一规则名称不能在同一包中多次使用。可选规则属性（例如<code>salience</code>要么<code>no-loop</code> ），它定义了规则行为，位于规则名称下方， <code>when</code>部分。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在DRL设计器中，输入<code>then</code>之后<code>when</code>规则部分开始添加操作语句。</p>
</li>
<li>
<p>根据规则条件输入要在事实模式上执行的一个或多个操作。</p>
<div class="paragraph">
<p>以下是一些用于定义DRL操作的关键字选项：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>set</code> ：使用此设置字段的值。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$application.setApproved ( false );
$application.setExplanation( "has been bankrupt" );</code></pre>
</div>
</div>
</li>
<li>
<p><code>modify</code> ：使用它来指定要为事实修改的字段，并将更改通知给Drools引擎。此方法提供了一种用于事实更新的结构化方法。它结合了<code>update</code>使用setter调用进行操作以更改对象字段。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>modify( LoanApplication ) {
        setAmount( 100 ),
        setApproved ( true )
}</code></pre>
</div>
</div>
</li>
<li>
<p><code>update</code> ：使用它来指定字段和要更新的整个相关事实，并将更改通知给Drools引擎。事实改变后，您必须致电<code>update</code>在更改可能受更新值影响的另一个事实之前。为避免此附加步骤，请使用<code>modify</code>方法代替。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>LoanApplication.setAmount( 100 );
update( LoanApplication );</code></pre>
</div>
</div>
</li>
<li>
<p><code>insert</code> ：使用此插入<code>new</code>事实上进入了Drools引擎。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>insert( new Applicant() );</code></pre>
</div>
</div>
</li>
<li>
<p><code>insertLogical</code> ：使用此插入<code>new</code>逻辑上将事实纳入Drools引擎。Drools引擎负责事实的插入和撤回的逻辑决策。在常规或声明的插入之后，必须明确撤回事实。逻辑插入后，如果插入事实的规则中的条件不再成立，则插入的事实将自动撤回。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>insertLogical( new Applicant() );</code></pre>
</div>
</div>
</li>
<li>
<p><code>delete</code> ：使用此选项从Drools引擎中删除对象。关键字<code>retract</code>在DRL中也受支持，并执行相同的操作，但是<code>delete</code>在DRL代码中，通常首选与关键字保持一致<code>insert</code> 。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>delete( Applicant );</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">有关DRL规则操作的更多信息，请参见<a href="#drl-rules-THEN-con_drl-rules">DRL（THEN）中的规则操作</a> 。
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>在定义规则的所有操作组件，单击<strong>验证</strong> DRL设计师的右上方工具栏中的验证DRL文件。如果文件验证失败，请解决错误消息中描述的所有问题，查看DRL文件中的所有语法和组件，然后再次尝试验证文件，直到文件通过。</p>
</li>
<li>
<p>在DRL设计器中单击“ <strong>保存</strong> ”以保存您的工作。</p>
</li>
</ol>
</div>
<div class="sect5">
<h6 id="rules-attributes-ref_drl-rules"><a class="anchor" href="#rules-attributes-ref_drl-rules"></a> <a class="link" href="#rules-attributes-ref_drl-rules">DRL中的规则属性</a></h6>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./LanguageReference/rule_attributes.png" alt="规则属性">
</div>
<div class="title">图338。规则属性</div>
</div>
<div class="paragraph">
<p>规则属性是可以添加到业务规则以修改规则行为的其他规范。在DRL文件中，通常会在规则条件和操作上方定义规则属性，并在不同行上以以下格式定义多个属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "rule_name"
    // Attribute
    // Attribute
    when
        // Conditions
    then
        // Actions
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>下表列出了可以分配给规则的属性的名称和支持的值：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表57。规则属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:70%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>salience</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定义规则优先级的整数。在激活队列中排序时，具有较高显着性值的规则将具有较高的优先级。</p>
<p class="tableblock">例：<code>salience 10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">布尔值。选择该选项后，将启用规则。未选择该选项时，该规则被禁用。</p>
<p class="tableblock">例：<code>enabled true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>date-effective</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">包含日期和时间定义的字符串。仅当当前日期和时间在<code>date-effective</code>属性。</p>
<p class="tableblock">例：<code>date-effective "4-Sep-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>date-expires</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">包含日期和时间定义的字符串。如果当前日期和时间晚于<code>date-expires</code>属性。</p>
<p class="tableblock">例：<code>date-expires "4-Oct-2018"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no-loop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">布尔值。选择该选项后，如果规则的结果重新触发了先前满足的条件，则无法重新激活（循环）规则。如果未选择条件，则在这些情况下可以循环规则。</p>
<p class="tableblock">例：<code>no-loop true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>agenda-group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个字符串，标识要向其分配规则的议程组。通过议程组，您可以对议程进行分区，以提供对规则组的更多执行控制。只有已获得焦点的议程组中的规则才能被激活。</p>
<p class="tableblock">例：<code>agenda-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>activation-group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个字符串，用于标识您要向其分配规则的激活（或XOR）组。在激活组中，只能激活一个规则。触发的第一个规则将取消激活组中所有规则的所有未决激活。</p>
<p class="tableblock">例：<code>activation-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个长整数值，定义了如果仍满足规则条件，则可以激活规则的持续时间（以毫秒为单位）。</p>
<p class="tableblock">例：<code>duration 10000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">标识任一字符串<code>int</code> （间隔）或<code>cron</code>用于计划规则的计时器定义。</p>
<p class="tableblock">例： <code>timer ( cron:* 0/15 * * * ? )</code> （每15分钟一班）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>calendar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于计划规则的<a href="http://www.quartz-scheduler.org/">Quartz</a>日历定义。</p>
<p class="tableblock">例： <code>calendars "* * 0-7,18-23 ? * *"</code> （不包括非营业时间）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auto-focus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个布尔值，仅适用于议程组中的规则。选择该选项后，下次激活该规则时，焦点将自动分配给分配了该规则的议程组。</p>
<p class="tableblock">例：<code>auto-focus true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lock-on-active</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个布尔值，仅适用于规则流组或议程组中的规则。选择该选项后，下一次该规则的规则流组变为活动状态或该规则的议程组获得焦点时，该规则流组将不再处于活动状态或该议程组失去焦点之前，无法再次激活该规则。这是更强大的版本<code>no-loop</code>属性，因为匹配的规则的激活将被丢弃，而不考虑更新的来源（不仅是规则本身）。此属性是计算规则的理想选择，在计算规则中，您有许多修改事实的规则，并且您不希望任何规则重新匹配并再次触发。</p>
<p class="tableblock">例：<code>lock-on-active true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ruleflow-group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">标识规则流组的字符串。在规则流组中，只有在相关规则流激活了该组时，规则才能触发。</p>
<p class="tableblock">例：<code>ruleflow-group "GroupName"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dialect</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">标识任一字符串<code>JAVA</code>要么<code>MVEL</code>作为规则中代码表达式所使用的语言。默认情况下，该规则使用在程序包级别指定的方言。此处指定的任何方言都会覆盖规则的打包方言设置。</p>
<p class="tableblock">例：<code>dialect "JAVA"</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.dsleditor"><a class="anchor" href="#_drools.dsleditor"></a> <a class="link" href="#_drools.dsleditor">16.9。DSL（特定领域语言）规则</a></h3>
<div class="paragraph">
<p>DSL编辑器允许创作DSL句子。读者应该花时间探索Drools Expert文档中的DSL功能。因为Business Central的DSL编辑器中的语法是相同的。扩展了常规语法，以提供“提示”来控制如何在用户界面内呈现和验证DSL变量。</p>
</div>
<div class="paragraph">
<p>支持以下“提示”：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{ <varname>： <regular expression="">}</regular></varname></p>
<div class="paragraph">
<p>当在向导编辑器中使用DSL Sentence时，它将代替DSL变量呈现一个文本字段。文本字段的内容将针对正则表达式进行验证。</p>
</div>
</li>
<li>
<p>{ <varname>：ENUM： <facttype.fieldname>}</facttype.fieldname></varname></p>
<div class="paragraph">
<p>当在指导编辑器中使用DSL句子时，这将代替DSL变量呈现一个枚举。
<facttype.fieldname>将枚举绑定到模型“事实和字段”枚举定义。这可以是“ Business Central枚举”（即在Business Central中定义），也可以是Java枚举（即在模型POJO JAR文件中定义）。</facttype.fieldname></p>
</div>
</li>
<li>
<p>{{ <varname>：DATE： <dateformat>}</dateformat></varname></p>
<div class="paragraph">
<p>当在向导编辑器中使用DSL句子时，这将呈现一个日期选择器代替DSL变量。</p>
</div>
</li>
<li>
<p>{ <varname>：BOOLEAN：<[已检查|未选中]>}</varname></p>
<div class="paragraph">
<p>当在向导编辑器中使用DSL句子时，这将呈现一个下拉选择器来代替DSL变量，从而提供布尔选择。</p>
</div>
</li>
<li>
<p>{ <varname>：CF： <facttype.fieldname>}</facttype.fieldname></varname></p>
<div class="paragraph">
<p>这将呈现一个按钮，允许您使用“自定义表单”设置此变量的值。为了使用此功能，必须为包含factType.fieldName的自定义表单配置的工作集启用。如果没有这样的工作集，则使用一个简单的文本框（就像常规变量一样）。</p>
</div>
<div class="paragraph">
<p>有关更多信息，请阅读有关工作集和自定义表单配置的更多信息。</p>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/DSLEditor.png" alt="DSL编辑器">
</div>
<div class="title">图339。DSL规则</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.guidedscorecardeditor"><a class="anchor" href="#_drools.guidedscorecardeditor"></a> <a class="link" href="#_drools.guidedscorecardeditor">16.10。计分卡</a></h3>
<div class="paragraph">
<p>计分卡是用于计算总分的公式的图形表示。记分卡可用于预测某个结果的可能性或概率。现在，Drools支持添加记分卡。加性计分卡通过添加分配给各个规则条件的所有部分分数来计算总分数。</p>
</div>
<div class="paragraph">
<p>另外，Drools记分卡将允许设置原因代码，这有助于识别对总体得分有贡献的特定规则（存储桶）。Drools记分卡将基于PMML 4.1标准。</p>
</div>
<div class="paragraph">
<p>现在，“新建项目”菜单允许创建计分卡资产。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/scorecard_asset_webeditor.png" alt="计分卡资产网络管理员">
</div>
<div class="title">图340。记分卡资产指导编辑器</div>
</div>
<div class="paragraph">
<p>上图显示了具有一个特征的计分卡。每个计分卡均包括两个部分（a）设置参数（b）特征部分</p>
</div>
<div class="sect3">
<h4 id="_drools.guidedscorecardeditorsetupparameters"><a class="anchor" href="#_drools.guidedscorecardeditorsetupparameters"></a> <a class="link" href="#_drools.guidedscorecardeditorsetupparameters">16.10.1。 （a）设定参数</a></h4>
<div class="paragraph">
<p>设置部分由定义此计分卡总体行为的参数组成。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>事实：此下拉列表显示此资产可见的事实列表。</p>
</li>
<li>
<p>结果分数字段：显示所选事实的字段列表。仅显示“ double”类型的字段。如果此下拉列表为空，请仔细检查您的事实模型。最终计算出的分数将存储在此字段中。</p>
</li>
<li>
<p>初始分数：数字文本字段，用于捕获初始分数。生成的规则将使用该分数初始化“结果分数字段”，然后在对部分分数求和时将其添加到总分数中。</p>
</li>
<li>
<p>使用原因码：布尔指示器，用于计算原因码以及最终分数。在此字段中选择“是/否”将启用/禁用“结果原因代码字段”，“原因代码算法”和“基线分数”字段。</p>
</li>
<li>
<p>结果原因代码字段：显示所选事实的字段列表。仅类型为'java.util的字段。显示清单”。该集合将保存此计分卡选择的原因代码。</p>
</li>
<li>
<p>原因码算法：可以是“ none”，“ pointsAbove”或“ pointsBelow”，描述相对于每个特征的基线分数或在最高评分卡上设置的原因码的排名方式。</p>
</li>
<li>
<p>基线分数：确定原因码排名时，用作所有特征的基线比较分数的单个值。或者，可以为每个单独的特性设置唯一的基线得分，如下所示。仅当UseReasonCodes为“ true”且未为每个特性提供基线基线时，才需要此值。</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果UseReasonCodes为“ true”，则必须在记分卡级别或每个特征定义BaselineScore，并且必须为每个特征或其输入属性提供ReasonCode。如果UseReasonCodes为“ false”，则不需要baselineScore和原因码。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guidedscorecardeditorcharacteristics"><a class="anchor" href="#_drools.guidedscorecardeditorcharacteristics"></a> <a class="link" href="#_drools.guidedscorecardeditorcharacteristics">16.10.2。 （b）特征</a></h4>
<div class="paragraph">
<p>单击“新特征”按钮后，会将新的空白特征编辑器添加到记分卡。为每个记分卡特征（数字或分类）定义点分配策略。每个计分卡特性都分配有一个单独的部分分数，该分数用于计算总分数。总体分数就是所有部分分数的总和。假定部分分数是“ double”类型的连续值。</p>
</div>
<div class="sect4">
<h5 id="_drools.guidedscorecardeditorcreatingcharacteristics"><a class="anchor" href="#_drools.guidedscorecardeditorcreatingcharacteristics"></a> <a class="link" href="#_drools.guidedscorecardeditorcreatingcharacteristics">16.10.2.1。创造特征</a></h5>
<div class="paragraph">
<p>每个计分卡必须至少具有一个特征</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/scorecards_new_characteristic.png" alt="记分卡的新特性">
</div>
<div class="title">图341。新特性</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>名称：此特征的描述性名称。仅供参考。</p>
</li>
<li>
<p>删除特征：显示确认对话框后，将从记分卡中删除该特征。</p>
</li>
<li>
<p>添加属性：将为属性（箱）添加行条目。</p>
</li>
<li>
<p>事实：选择要评估的分数类别。</p>
</li>
<li>
<p>特征：显示所选事实的字段列表。仅显示类型为“字符串”，“整数”，“双精度”，“布尔值”的字段。</p>
</li>
<li>
<p>基线分数：设置特征的基线分数，在确定原因码的排名时，将其与实际部分分数进行比较。当useReasonCodes属性为“ true”且未在元素记分卡中定义baselineScore时，此值是必需的。只要为特性定义了baselineScore，它将优先于元素记分卡中定义的baselineScore值。</p>
</li>
<li>
<p>原因代码：包含特征的原因代码，通常与不利的决定相关联。</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_drools.guidedscorecardeditorcreatingattributes"><a class="anchor" href="#_drools.guidedscorecardeditorcreatingattributes"></a> <a class="link" href="#_drools.guidedscorecardeditorcreatingattributes">16.10.2.2。创建属性</a></h5>
<div class="paragraph">
<p>单击“新属性”按钮后，将出现一个新的空属性编辑器。在记分卡模型中，为特定特征定义属性的所有元素都必须都引用单个字段。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/scorecards_new_attribute.png" alt="记分卡新属性">
</div>
<div class="title">图342。新属性</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>运算符：输入属性和部分分数之间进行映射的条件。操作员下拉列表将显示不同的值，具体取决于所选字段的数据类型。</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>DataType字符串：“ =”，“ in”。</p>
</li>
<li>
<p>DataType整数：“ =”，“>”，“ <”，“> =”，“⇐”，“> .. <”，“> = .. <”，“> = ..⇐”，“>。 .⇐“。</p>
</li>
<li>
<p>DataType布尔值：“ true”，“ false”。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>有关更多详细信息，请参见下一部分（值）。</p>
</div>
</li>
<li>
<p>值：根据操作员选择的值，指定的值可以是单个值，也可以是用逗号（“，”）分隔的一组值。对于运算符类型boolean，禁用了value字段。</p>
<div class="paragraph">
<p></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表58。运算符/值</caption>
<colgroup>
<col style="width:25%">
<col style="width:25%">
<col style="width:25%">
<col style="width:25%">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据类型</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作员</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">备注</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">单值</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">会寻找完全匹配的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">逗号分隔值（a，b，c，...</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果字段值包含在逗号分隔的值列表中，则运算符“ in”表示评估为TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">布尔型</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是真的</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值字段不可修改（只读）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">布尔型</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是假的</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值字段不可修改（只读）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">数字</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">单值</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">等于运算符</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">数字</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">单值</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">大于运算符</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">数字</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">单值</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">少于运算符</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">数字</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">> =</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">单值</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">大于或等于</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">数字</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">单值</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">小于或等于</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">数字</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">> .. <</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">逗号分隔值（a，b）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（大于值“ a”）和（小于值“ b”）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">数字</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">> = .. <</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">逗号分隔值（a，b）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（大于或等于值'a'）和（小于值'b'）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">数字</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">> = .. <=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">逗号分隔值（a，b）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（大于或等于值'a'）和（小于或等于值'b'）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">数字</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">> .. <=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">逗号分隔值（a，b）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">（大于值'a'）和（小于或等于值'b'）</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>部分分数：定义授予该属性的分数。</p>
</li>
<li>
<p>原因码：定义属性的原因码。如果在此级别使用了reasonCode属性，则它优先于与Characteristic元素关联的ReasonCode。</p>
</li>
<li>
<p>行动：删除此属性。提示用户进行确认。</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果“使用原因代码”为“ true”，则必须在记分卡级别或为每个特征定义基线得分，并且必须为每个特征或其每个输入属性提供原因代码。如果“使用原因代码”为“ false”，则不需要BaselineScore和ReasonCode。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enumerations-define-proc_drl-rules"><a class="anchor" href="#enumerations-define-proc_drl-rules"></a> <a class="link" href="#enumerations-define-proc_drl-rules">16.11。定义规则资产中的下拉列表的枚举</a></h3>
<div class="paragraph">
<p>Business Central中的枚举定义确定指导规则，指导规则模板和指导决策表中条件或操作的字段的可能值。枚举定义包含<code>fact.field</code>映射到支持值的列表，这些值在规则资产的相关字段中显示为下拉列表。当用户选择基于与枚举定义相同的事实和字段的字段时，将显示已定义值的下拉列表。</p>
</div>
<div class="paragraph">
<p>您可以在Business Central或DRL源中为Drools项目定义枚举。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在Business Central中，转到<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> ，然后单击项目名称。</p>
</li>
<li>
<p>单击<strong>添加资产</strong> → <strong>枚举</strong> 。</p>
</li>
<li>
<p>输入信息丰富的<strong>枚举</strong>名称，然后选择适当的<strong>Package</strong> 。您指定的包必须与已分配或将要分配所需数据对象和相关规则资产的包相同。</p>
</li>
<li>
<p>单击<strong>确定</strong>以创建枚举。</p>
<div class="paragraph">
<p>现在，新的枚举列在<strong>Project Explorer</strong>的<strong>Enumeration Definitions</strong>面板中。</p>
</div>
</li>
<li>
<p>在枚举设计器的“ <strong>模型”</strong>选项卡中，单击“ <strong>添加枚举”</strong> ，然后为<strong>枚举</strong>定义以下值：</p>
<div class="ulist">
<ul>
<li>
<p><strong>事实</strong> ：在要与该枚举关联的项目的同一包中指定一个现有数据对象。在<strong>项目资源管理器中</strong>打开“ <strong>数据对象”</strong>面板以查看可用的数据对象，或者根据需要将相关数据对象创建为新资产。</p>
</li>
<li>
<p><strong>字段</strong> ：指定一个现有字段标识符，该标识符定义为您为<strong>事实</strong>选择的数据对象的一部分。在<strong>项目资源管理器中</strong>打开“ <strong>数据对象”</strong>面板以选择相关的数据对象，并查看可用的“ <strong>标识符”</strong>选项列表。如果需要，可以为数据对象创建相关的标识符。</p>
</li>
<li>
<p><strong>上下文</strong> ：以格式指定值列表<code>['string1','string2','string3']</code>要么<code>[integer1,integer2,integer3]</code>您想要映射到<strong>事实</strong>和<strong>字段</strong>定义。这些值将显示为规则资产相关字段的下拉列表。</p>
</li>
</ul>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例如，以下枚举定义了贷款申请决策服务中申请人信用等级的下拉值：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/EnumConfig.png" alt="枚举配置">
</div>
<div class="title">图343。Business Central中申请人信用等级的示例枚举</div>
</div>
<div class="listingblock">
<div class="title">DRL源中申请人信用等级的示例枚举</div>
<div class="content">
<pre class="highlightjs highlight"><code>'Applicant.creditRating' : ['AA', 'OK', 'Sub prime']</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，对于与项目在同一程序包中并使用以下规则的任何指导规则，指导规则模板或指导决策表<code>Applicant</code>数据对象和<code>creditRating</code>字段中，配置值可用作下拉选项：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/EnumDropDown.png" alt="EnumDropDown">
</div>
<div class="title">图344。指导规则或指导规则模板中的示例枚举下拉选项</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/EnumDropDownGDT.png" alt="EnumDropDownGDT">
</div>
<div class="title">图345。指导决策表中的示例枚举下拉选项</div>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="enumerations-advanced-ref_drl-rules"><a class="anchor" href="#enumerations-advanced-ref_drl-rules"></a> <a class="link" href="#enumerations-advanced-ref_drl-rules">16.11.1。规则资产的高级枚举选项</a></h4>
<div class="paragraph">
<p>对于您的Drools项目中具有枚举定义的高级用例，请考虑以下用于定义枚举的扩展选项：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">DRL值与Business Central中的值之间的映射</dt>
<dd>
<p>如果您希望枚举值在业务中心界面中与在DRL源中出现的枚举值不同或更完整，请使用以下格式的映射： <code>'fact.field' : ['sourceValue1=UIValue1','sourceValue2=UIValue2', …​ ]</code>用于您的枚举定义值。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例如，在下面的贷款状态枚举定义中，选项<code>A</code>要么<code>D</code>在DRL文件中使用，但选项<code>Approved</code>要么<code>Declined</code>在Business Central中显示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>'Loan.status' : ['A=Approved','D=Declined']</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">枚举值依赖性</dt>
<dd>
<p>如果希望一个下拉列表中的选定值确定后续下拉列表中的可用选项，请使用以下格式<code>'fact.fieldB[fieldA=value1]' : ['value2', 'value3', …​ ]</code>用于您的枚举定义。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例如，在以下保险单的枚举定义中， <code>policyType</code>字段接受值<code>Home</code>要么<code>Car</code> 。用户选择的策略类型决定了策略<code>coverage</code>可用的字段选项：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>'Insurance.policyType' : ['Home', 'Car']
'Insurance.coverage[policyType=Home]' : ['property', 'liability']
'Insurance.coverage[policyType=Car]' : ['collision', 'fullCoverage']</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">枚举相关性不适用于规则条件和操作。例如，在此保险单使用案例中，如果适用，在规则条件中选择的保单不会确定规则操作中的可用保险范围选项。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">枚举中的外部数据源</dt>
<dd>
<p>如果要从外部数据源检索枚举值列表，而不是直接在枚举定义中定义值，请在项目的类路径上，添加一个返回<code>java.util.List</code>字符串列表。在枚举定义中，而不是指定值列表，而是标识配置为从外部检索值的帮助程序类。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>例如，在以下针对贷款申请人区域的枚举定义中，而不是以格式明确定义申请人区域<code>'Applicant.region' : ['country1', 'country2', …​ ]</code> ，该枚举使用一个帮助程序类，该类返回外部定义的值的列表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>'Applicant.region' : (new com.mycompany.DataHelper()).getListOfRegions()</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中， <code>DataHelper</code>类包含一个<code>getListOfRegions()</code>返回字符串列表的方法。枚举被加载到规则资产中相关字段的下拉列表中。</p>
</div>
<div class="paragraph">
<p>您还可以像往常一样标识依赖字段并将对帮助程序类的调用用引号引起来，从而从帮助程序类中动态加载依赖枚举定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>'Applicant.region[countryCode]' : '(new com.mycompany.DataHelper()).getListOfRegions("@{countryCode}")'</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果要完全从外部数据源（如关系数据库）加载所有枚举数据，则可以实现一个Java类，该类返回一个<code>Map<String, List<String>></code>地图。地图的关键是<code>fact.field</code>映射，值是<code>java.util.List<String></code>值列表。</p>
</div>
<div class="paragraph">
<p>例如，以下Java类为相关枚举定义了贷款申请人区域：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SampleDataSource {

  public Map&lt;String, List&lt;String&gt;&gt; loadData() {
    Map data = new HashMap();

    List d = new ArrayList();
    d.add("AU");
    d.add("DE");
    d.add("ES");
    d.add("UK");
    d.add("US");
    ...
    data.put("Applicant.region", d);

    return data;
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>以下枚举定义与此示例Java类相关。枚举不包含对事实或字段名称的引用，因为它们是在Java类中定义的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>=(new SampleDataSource()).loadData()</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>=</code>运算符使Business Central可以加载帮助程序类中的所有枚举数据。当请求枚举定义在编辑器中使用时，将静态评估帮助器方法。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">Business Central当前不支持定义没有事实和字段定义的枚举。要以这种方式定义关联的Java类的枚举，请在您的Drools项目中使用DRL源。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="test-scenarios-intro-con"><a class="anchor" href="#test-scenarios-intro-con"></a> <a class="link" href="#test-scenarios-intro-con">16.12。测试场景</a></h3>
<div class="paragraph">
<p>Drools中的测试场景使您能够在将它们部署到生产环境之前，验证业务规则和业务规则数据（针对基于规则的测试场景）或DMN模型（针对基于DMN的测试场景）的功能。在测试场景中，您可以使用项目中的数据基于一个或多个已定义的业务规则来设置给定条件和预期结果。运行方案时，将比较规则实例的预期结果和实际结果。如果预期结果与实际结果相符，则测试成功。如果预期结果与实际结果不符，则测试失败。</p>
</div>
<div class="paragraph">
<p>Drools当前支持新的<strong>测试方案</strong>设计者和以前的<strong>测试方案（传统）</strong>设计者。默认设计器是新的测试方案设计器，它支持规则和DMN模型的测试，并通过测试方案提供增强的整体用户体验。如果需要，您可以继续使用旧版测试方案设计器，该设计器仅支持基于规则的测试方案。</p>
</div>
<div class="paragraph">
<p>您可以通过多种方式运行定义的测试方案，例如，可以在项目级别或特定测试方案资产内部运行可用的测试方案。测试方案是独立的，不能影响或修改其他测试方案。您可以在Business Central中的项目开发过程中随时运行测试方案。您不必编译或部署决策服务即可运行测试方案。</p>
</div>
<div class="paragraph">
<p>您可以将数据对象从不同的包导入到与测试方案相同的项目包中。默认情况下，导入同一包中的资产。创建必要的数据对象和测试方案之后，可以使用测试方案设计器的“ <strong>数据对象”</strong>选项卡来验证是否列出了所有必需的数据对象，或者通过添加“ <strong>新建”项</strong>来导入其他现有数据对象。</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">在整个测试方案文档中，所有对<em>测试方案</em>和<em>测试方案设计</em>器的引用均适用于新版本，除非明确指出是旧版。
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="test-designer-con"><a class="anchor" href="#test-designer-con"></a> <a class="link" href="#test-designer-con">16.12.1。Business Central中的测试方案设计器</a></h4>
<div class="paragraph">
<p>测试方案设计器提供了表格布局，可帮助您定义方案模板和所有相关的测试用例。设计器布局由一个表组成，该表具有标题和各个行。标头由三部分组成： <strong>GIVEN</strong>和<strong>EXPECT</strong>行，具有实例的行以及具有相应字段的行。标头也称为测试方案模板，各个行称为测试方案定义。</p>
</div>
<div class="paragraph">
<p>测试方案模板或标头包含以下两个部分：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>GIVEN</strong>数据对象及其字段-表示输入信息</p>
</li>
<li>
<p><strong>EXPECT</strong>数据对象及其字段-表示根据给定信息检查其确切值的对象及其字段，它们也构成预期的结果。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>测试方案定义代表模板的单独测试用例。</p>
</div>
<div class="paragraph">
<p>您可以从<strong>设计器</strong>的左侧面板访问<strong>Project Explorer</strong> ，而从右侧面板可以访问<strong>Settings</strong> ， <strong>Test Tools</strong> ， <strong>Scenario Cheatsheet</strong> ， <strong>Test Report</strong>和<strong>Coverage Report</strong>选项卡。您可以访问“ <strong>设置”</strong>选项卡以查看和编辑基于规则和基于DMN的测试方案的全局设置。您可以使用<strong>测试工具</strong>来配置数据对象映射。<strong>方案</strong> “备忘单”选项卡包含注释和备忘单，您可以将其用作参考。“ <strong>测试报告”</strong>选项卡显示<strong>测试</strong>概述和方案状态。要查看测试覆盖率统计信息，可以使用测试方案设计器右侧的“ <strong>覆盖率报告”</strong>选项卡。</p>
</div>
<div class="sect4">
<h5 id="test-designer-data-objects-import-proc"><a class="anchor" href="#test-designer-data-objects-import-proc"></a> <a class="link" href="#test-designer-data-objects-import-proc">16.12.1.1。导入数据对象</a></h5>
<div class="paragraph">
<p>测试方案设计者将加载与测试方案位于同一包中的所有数据对象。您可以从设计器的“ <strong>数据对象”</strong>选项卡中查看所有数据对象。加载的数据对象也显示在“ <strong>测试工具”</strong>面板中。</p>
</div>
<div class="paragraph">
<p>您需要关闭并重新打开设计器，以防数据对象发生更改（例如，当创建新的数据对象或删除现有的数据对象时）。从列表中选择一个数据对象以显示其字段和字段类型。</p>
</div>
<div class="paragraph">
<p>如果要使用与测试方案不同的包中的数据对象，则需要首先导入该数据对象。请按照以下过程为基于规则的测试方案导入数据对象。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>创建基于DMN的测试方案时，不能导入任何数据对象。基于DMN的测试方案不使用项目中的任何数据对象，而是使用DMN文件中定义的自定义数据类型。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在测试方案设计<strong>器中</strong>转到<strong>Project Explorer</strong>面板。</p>
</li>
<li>
<p>在“ <strong>测试方案”中</strong> ，选择一个测试方案。</p>
</li>
<li>
<p>选择<strong>数据对象</strong>选项卡，然后单击<strong>新建项</strong> 。</p>
</li>
<li>
<p>在“ <strong>添加导入”</strong>窗口中，从下拉列表中选择数据对象。</p>
</li>
<li>
<p>单击<strong>确定</strong> ，然后单击<strong>保存</strong> 。</p>
</li>
<li>
<p>关闭并重新打开测试方案设计器，以从数据对象列表中查看新的数据对象。</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-test-scenario-import-proc"><a class="anchor" href="#test-designer-test-scenario-import-proc"></a> <a class="link" href="#test-designer-test-scenario-import-proc">16.12.1.2。导入测试方案</a></h5>
<div class="paragraph">
<p>您可以使用项目视图中“ <strong>资产”</strong>选项卡中的“ <strong>导入资产”</strong>按钮来导入现有的测试方案。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在Business Central中，转到<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> ，然后单击项目名称。</p>
</li>
<li>
<p>在项目的<strong>资产</strong>标签中，点击<strong>导入资产</strong> 。</p>
</li>
<li>
<p>在“ <strong>创建新的导入资产”</strong>窗口中，</p>
<div class="ulist">
<ul>
<li>
<p>输入导入资产的名称。</p>
</li>
<li>
<p>从“ <strong>包”</strong>下拉列表中选择包。</p>
</li>
<li>
<p>从<strong>请选择要上传的文件</strong> ，单击<strong>选择文件...</strong>浏览到测试场景文件。</p>
</li>
</ul>
</div>
</li>
<li>
<p>选择文件，然后单击“ <strong>打开”</strong> 。</p>
</li>
<li>
<p>单击“ <strong>确定”</strong> ，测试方案将在测试方案设计器中打开。</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-save-test-proc"><a class="anchor" href="#test-designer-save-test-proc"></a> <a class="link" href="#test-designer-save-test-proc">16.12.1.3。保存测试方案</a></h5>
<div class="paragraph">
<p>您可以在创建测试方案模板或定义测试方案时随时保存测试方案。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在右上角的测试方案设计器工具栏中，单击<strong>保存</strong> 。</p>
</li>
<li>
<p>在“ <strong>确认保存”</strong>窗口中，</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>如果您想添加有关测试方案<strong>的评论</strong> ，请点击<strong>添加评论</strong> 。</p>
</li>
<li>
<p>再次单击<strong>保存</strong> 。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>屏幕上出现一条消息，指出测试方案已成功保存。</p>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-delete-test-proc"><a class="anchor" href="#test-designer-delete-test-proc"></a> <a class="link" href="#test-designer-delete-test-proc">16.12.1.4。删除测试方案</a></h5>
<div class="paragraph">
<p>您可以删除使用测试方案设计器创建的现有测试方案。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在右上方的测试方案设计器工具栏中，单击<strong>删除</strong> 。</p>
</li>
<li>
<p>在“ <strong>确认删除”</strong>窗口中，</p>
<div class="ulist">
<ul>
<li>
<p>要添加有关删除测试方案<strong>的评论</strong> ，请点击<strong>添加评论</strong> 。</p>
</li>
<li>
<p>点击<strong>删除</strong> 。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>屏幕上将显示一条消息，指出已成功删除测试方案。</p>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-rename-test-proc"><a class="anchor" href="#test-designer-rename-test-proc"></a> <a class="link" href="#test-designer-rename-test-proc">16.12.1.5。重命名测试方案</a></h5>
<div class="paragraph">
<p>您可以使用设计器右上方工具栏中的“ <strong>重命名”</strong>按钮来重命名现有的测试方案。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在右上角的测试方案设计器工具栏中，单击<strong>重命名</strong> 。</p>
</li>
<li>
<p>在“ <strong>重命名资产”</strong>窗口中，</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>在<strong>资产名称</strong>字段中输入<strong>名称</strong> 。</p>
</li>
<li>
<p>如果您想添加评论，请点击<strong>添加评论</strong> 。</p>
</li>
<li>
<p>单击<strong>重命名</strong> 。</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>单击“ <strong>重命名”</strong>仅重命名测试方案文件。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>在右上角的测试方案设计器工具栏中，单击<strong>保存</strong> 。</p>
</li>
<li>
<p>在“ <strong>确认保存”</strong>窗口中，</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>如果您想添加评论，请点击<strong>添加评论</strong> 。</p>
</li>
<li>
<p>再次单击<strong>保存</strong> 。</p>
</li>
</ol>
</div>
</li>
<li>
<p>或者，您可以单击<strong>保存</strong>并重<strong>命名</strong>以同时保存和重命名方案。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>屏幕上出现一条消息，指出测试方案已成功重命名。</p>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-copy-test-proc"><a class="anchor" href="#test-designer-copy-test-proc"></a> <a class="link" href="#test-designer-copy-test-proc">16.12.1.6。复制测试方案</a></h5>
<div class="paragraph">
<p>您可以使用右上角工具栏中的“ <strong>复制”</strong>按钮将现有的测试方案复制到同一软件包或其他软件包。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在右上角的测试方案设计器工具栏中，单击<strong>复制</strong> 。</p>
</li>
<li>
<p>在“ <strong>制作副本”</strong>窗口中，</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>在<strong>新名称</strong>字段中输入<strong>名称</strong> 。</p>
</li>
<li>
<p>选择您要将测试方案复制到的包。</p>
</li>
<li>
<p>可选：要添加评论，请点击<strong>添加评论</strong> 。</p>
</li>
<li>
<p>单击<strong>制作副本</strong> 。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>屏幕上出现一条消息，指出测试方案已成功复制。</p>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-download-test-proc"><a class="anchor" href="#test-designer-download-test-proc"></a> <a class="link" href="#test-designer-download-test-proc">16.12.1.7。下载测试方案</a></h5>
<div class="paragraph">
<p>您可以将测试方案的副本下载到本地计算机上，以备将来参考或用作备份。</p>
</div>
<div class="paragraph">
<div class="title">程序</div>
<p>在右上角的测试方案设计器工具栏中，单击“ <strong>下载”</strong>图标。</p>
</div>
<div class="paragraph">
<p>的<code>.scesim</code>文件下载到本地计算机。</p>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-latest-version-test-proc"><a class="anchor" href="#test-designer-latest-version-test-proc"></a> <a class="link" href="#test-designer-latest-version-test-proc">16.12.1.8。在测试方案的版本之间切换</a></h5>
<div class="paragraph">
<p>Business Central使您能够在测试方案的各个版本之间进行切换。每次保存方案时，都会在“最新版本”下列出该方案的新<strong>版本</strong> 。要使用此功能，您必须至少保存一次测试方案文件。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在右上方的测试方案设计器工具栏中，单击<strong>最新版本</strong> 。文件的所有版本（如果存在）都列在“ <strong>最新版本”</strong>下。</p>
</li>
<li>
<p>单击您要使用的版本。</p>
<div class="paragraph">
<p>所选版本的测试方案将在测试方案设计器中打开。</p>
</div>
</li>
<li>
<p>在设计器工具栏中，单击<strong>“还原”</strong> 。</p>
</li>
<li>
<p>在<strong>确认还原中</strong> ，</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>要添加评论，请点击<strong>添加评论</strong> 。</p>
</li>
<li>
<p>单击<strong>还原</strong>以确认。</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>屏幕上显示一条消息，指出所选版本已在设计器中成功重新加载。</p>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-view-hide-alerts-con"><a class="anchor" href="#test-designer-view-hide-alerts-con"></a> <a class="link" href="#test-designer-view-hide-alerts-con">16.12.1.9。查看或隐藏警报面板</a></h5>
<div class="paragraph">
<p>“ <strong>警报”</strong>面板显示在测试方案设计器或项目视图的底部。如果执行的测试失败，它包含构建信息和错误消息。</p>
</div>
<div class="paragraph">
<div class="title">程序</div>
<p>在右上方的设计器工具栏中，单击“ <strong>隐藏警报</strong> / <strong>查看警报”</strong>以启用或禁用报告面板。</p>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-contextual-menu-ref"><a class="anchor" href="#test-designer-contextual-menu-ref"></a> <a class="link" href="#test-designer-contextual-menu-ref">16.12.1.10。上下文菜单选项</a></h5>
<div class="paragraph">
<p>测试方案设计器提供了上下文菜单选项，使您能够在表上执行基本操作，例如添加，删除和复制行和列。要使用上下文菜单，您需要右键单击表元素。菜单选项因您选择的表元素而异。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表59。上下文菜单选项</caption>
<colgroup>
<col style="width:20%">
<col style="width:30%">
<col style="width:50%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">表格元素</th>
<th class="tableblock halign-left valign-top">电池标签</th>
<th class="tableblock halign-left valign-top">可用的上下文菜单选项</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">标头</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">＃和方案说明</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在下方插入行</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">给予与期望</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">插入最左列，插入最右列，在下方插入行</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">实例1，实例2和属性1，属性2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">向左插入列，向右插入列，删除列，重复实例，在下面插入行</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">行数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">所有具有行号，测试方案描述或测试方案定义的单元格</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在上方插入行，在下方插入行，重复行，删除行，运行方案</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表60。表交互的描述</caption>
<colgroup>
<col style="width:25%">
<col style="width:75%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">表互动</th>
<th class="tableblock halign-left valign-middle">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">插入最左列</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">插入一个新的最左列（根据用户选择，在表的GIVEN或EXPECT部分中）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">插入最右边的列</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">插入一个新的最右边的列（根据用户选择，在表的GIVEN或EXPECT部分中）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">向左插入列</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在所选列的左侧插入一个新列。新列与所选列的类型相同（根据用户选择，在表的GIVEN或EXPECT部分中）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">向右插入列</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在所选列的右侧插入一个新列。新列与所选列的类型相同（根据用户选择，在表的GIVEN或EXPECT部分中）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">删除栏</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">删除选定的列。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">在上方插入行</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在所选行上方插入新行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">在下方插入行</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在所选行下方插入新行。如果从标题单元格调用，则插入索引为1的新行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">行重复</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">复制所选行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">实例重复</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">复制所选实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">删除行</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">删除选定的行。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">运行方案</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">运行单个测试方案。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>的<code>Insert column right</code>要么<code>Insert column left</code>上下文菜单选项的行为有所不同，</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果所选列没有定义类型，则添加一个没有类型的新列。</p>
</li>
<li>
<p>如果所选列具有定义的类型，则将创建新的空列或具有父实例类型的列。</p>
<div class="ulist">
<ul>
<li>
<p>如果从实例头执行该操作，则会创建一个没有类型的新列。</p>
</li>
<li>
<p>如果从属性标题执行该操作，则会创建一个具有父实例类型的新列。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="test-designer-create-test-scenario-template-con"><a class="anchor" href="#test-designer-create-test-scenario-template-con"></a> <a class="link" href="#test-designer-create-test-scenario-template-con">16.12.2。测试方案模板</a></h4>
<div class="paragraph">
<p>在指定测试方案定义之前，您需要创建一个测试方案模板。测试方案表的标题定义每个方案的模板。您需要同时为GIVEN和EXPECT部分设置实例和属性标头的类型。实例头映射到特定的数据对象（事实），而属性头映射到相应的数据对象的特定字段。</p>
</div>
<div class="paragraph">
<p>使用测试方案设计器，您可以为基于规则和基于DMN的测试方案创建测试方案模板。</p>
</div>
<div class="sect4">
<h5 id="test-designer-create-test-template-rule-based-proc"><a class="anchor" href="#test-designer-create-test-template-rule-based-proc"></a> <a class="link" href="#test-designer-create-test-template-rule-based-proc">16.12.2.1。为基于规则的测试方案创建测试方案模板</a></h5>
<div class="paragraph">
<p>通过遵循以下过程来验证规则和数据，为基于规则的测试方案创建测试方案模板。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在Business Central中，转到<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> ，然后单击要为其创建测试方案的项目。</p>
</li>
<li>
<p>单击<strong>添加资产</strong> → <strong>测试方案</strong> 。</p>
</li>
<li>
<p>输入<strong>测试方案</strong>名称，然后选择适当的<strong>软件包</strong> 。您选择的包必须包含所有必需的数据对象，并且已分配或将要分配规则资产。</p>
</li>
<li>
<p>选择<strong>RULE</strong>作为<strong>来源类型</strong> 。</p>
</li>
<li>
<p>单击“ <strong>确定”</strong>以在测试方案设计器中创建并打开测试方案。</p>
</li>
<li>
<p>要将<strong>GIVEN</strong>列标题映射到数据对象，</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>单击“ <strong>GIVEN”</strong>部分中的实例标头。</p>
</li>
<li>
<p>从“ <strong>测试工具”</strong>选项卡中选择数据对象。</p>
</li>
<li>
<p>点击<strong>添加</strong> 。</p>
</li>
</ol>
</div>
</li>
<li>
<p>要插入数据对象的更多属性，请右键单击属性标题，然后根据需要选择“ <strong>向右</strong> <strong>插入列”</strong>或“ <strong>向左插入列”</strong> 。</p>
</li>
<li>
<p>要将数据对象字段映射到属性单元格，</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>单击属性单元格。</p>
</li>
<li>
<p>从“ <strong>测试工具”</strong>选项卡中选择数据对象字段。</p>
</li>
<li>
<p>点击<strong>添加</strong> 。</p>
</li>
</ol>
</div>
</li>
<li>
<p>要将<strong>EXPECT</strong>列标题映射到数据对象，</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>单击<strong>EXPECT</strong>部分中的实例标题。</p>
</li>
<li>
<p>从“ <strong>测试工具”</strong>选项卡中选择数据对象。</p>
</li>
<li>
<p>点击<strong>添加</strong> 。</p>
</li>
</ol>
</div>
</li>
<li>
<p>要插入数据对象的更多属性，请右键单击属性标题，然后根据需要选择“ <strong>向右</strong> <strong>插入列”</strong>或“ <strong>向左插入列”</strong> 。</p>
</li>
<li>
<p>要将数据对象字段映射到属性单元格，</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>单击属性单元格。</p>
</li>
<li>
<p>从“ <strong>测试工具”</strong>选项卡中选择数据对象字段。</p>
</li>
<li>
<p>点击<strong>添加</strong> 。</p>
<div class="paragraph">
<p>使用上下文菜单根据需要添加或删除列。</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-alias-proc"><a class="anchor" href="#test-designer-alias-proc"></a> <a class="link" href="#test-designer-alias-proc">16.12.2.2。在基于规则的测试方案中使用别名</a></h5>
<div class="paragraph">
<p>在测试方案设计器中，将标题单元格与数据对象映射后，该数据对象将从“ <strong>测试工具”</strong>选项卡中删除。您可以使用别名将数据对象重新映射到另一个标题单元格。别名使您可以在测试方案中指定同一数据对象的多个实例。您还可以创建属性别名以直接在表中重命名使用的属性。</p>
</div>
<div class="paragraph">
<div class="title">程序</div>
<p>在Business Central中的测试方案设计器中，双击标题单元格并手动更改名称。确保别名是唯一的。</p>
</div>
<div class="paragraph">
<p>现在，该实例出现在“ <strong>测试工具”</strong>选项卡中的数据对象列表中。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="test-designer-test-template-dmn-based-con"><a class="anchor" href="#test-designer-test-template-dmn-based-con"></a> <a class="link" href="#test-designer-test-template-dmn-based-con">16.12.3。基于DMN的测试方案的测试模板</a></h4>
<div class="paragraph">
<p>Business Central会自动为每个基于DMN的测试方案资产生成模板，并且该模板包含相关DMN模型的所有指定输入和决策。对于DMN模型中的每个输入节点，将添加<strong>GIVEN</strong>列，而每个决策节点均由<strong>EXPECT</strong>列表示。您可以根据需要随时修改默认模板。同样，为了仅测试整个DMN模型的特定部分，可以删除生成的列，并将决策节点从EXPECT移到GIVEN部分。</p>
</div>
<div class="sect4">
<h5 id="test-designer-create-test-template-dmn-based-proc"><a class="anchor" href="#test-designer-create-test-template-dmn-based-proc"></a> <a class="link" href="#test-designer-create-test-template-dmn-based-proc">16.12.3.1。为基于DMN的测试方案创建测试方案模板</a></h5>
<div class="paragraph">
<p>按照以下过程验证DMN模型，为基于DMN的方案创建测试方案模板。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在Business Central中，转到<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> ，然后单击要为其创建测试方案的项目。</p>
</li>
<li>
<p>单击<strong>添加资产</strong> → <strong>测试方案</strong> 。</p>
</li>
<li>
<p>输入<strong>测试方案</strong>名称，然后选择适当的<strong>软件包</strong> 。</p>
</li>
<li>
<p>选择<strong>DMN</strong>作为<strong>源类型</strong> 。</p>
</li>
<li>
<p>使用<strong>选择DMN资产</strong>选项选择一个现有DMN资产。</p>
</li>
<li>
<p>单击“ <strong>确定”</strong>以在测试方案设计器中创建并打开测试方案。</p>
<div class="paragraph">
<p>该模板是自动生成的，您可以根据需要对其进行修改。</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="test-designer-test-scenario-definition-proc"><a class="anchor" href="#test-designer-test-scenario-definition-proc"></a> <a class="link" href="#test-designer-test-scenario-definition-proc">16.12.4。定义测试方案</a></h4>
<div class="paragraph">
<p>创建测试方案模板之后，您必须接下来定义测试方案。测试方案表的行定义了各个测试方案。测试方案具有唯一的索引号，说明，输入值（在<strong>给定</strong>的值）的组，并且一组输出值（该<strong>期待</strong>值）。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>已为选定的测试方案创建了测试方案模板。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在测试方案设计器中打开测试方案。</p>
</li>
<li>
<p>输入测试方案的描述，并在该行的每个单元格中填写所需的值。</p>
</li>
<li>
<p>使用上下文菜单根据需要添加或删除行。</p>
<div class="paragraph">
<p>双击一个单元格开始内联编辑。要从测试评估中跳过特定单元格，请将其留空。</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>定义测试方案后，可以下一步运行测试。</p>
</div>
</div>
<div class="sect3">
<h4 id="test-designer-list-map-add-remove-item-proc"><a class="anchor" href="#test-designer-list-map-add-remove-item-proc"></a> <a class="link" href="#test-designer-list-map-add-remove-item-proc">16.12.5。在测试场景中使用列表和地图集合</a></h4>
<div class="paragraph">
<p>测试方案设计器支持基于DMN以及基于规则的测试方案的列表和映射集合。您可以在<strong>GIVEN</strong>和<strong>EXPECT</strong>列中将诸如列表或地图之类的集合定义为特定单元格的值。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>对于地图条目，输入键必须为<code>String</code>数据类型。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>首先设置列类型（使用类型为列表或地图的字段）。</p>
</li>
<li>
<p>双击列中的一个单元格以输入一个值。</p>
</li>
<li>
<p>在集合编辑器弹出窗口中，单击<strong>添加新项</strong> 。</p>
</li>
<li>
<p>输入所需的值，然后单击复选图标<span class="image"><img src="./dmn/dmn-datatype-constraints-tickmark.png" alt="dmn数据类型约束标记"></span>保存您添加的每个收集项目。</p>
</li>
<li>
<p>点击<strong>保存</strong> 。</p>
<div class="paragraph">
<p>要从集合中删除项目，请在集合弹出编辑器中单击bin图标。单击<strong>删除</strong>以删除集合本身。</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="test-designer-expressions-syntax-intro-ref"><a class="anchor" href="#test-designer-expressions-syntax-intro-ref"></a> <a class="link" href="#test-designer-expressions-syntax-intro-ref">16.12.6。测试方案中的表达式语法</a></h4>
<div class="paragraph">
<p>测试方案设计器为基于规则和基于DMN的测试方案支持不同的表达语言。虽然基于规则的测试方案支持基本的表达语言，但是基于DMN的测试方案支持FEEL表达语言。</p>
</div>
<div class="sect4">
<h5 id="test-designer-expressions-syntax-rule-based-ref"><a class="anchor" href="#test-designer-expressions-syntax-rule-based-ref"></a> <a class="link" href="#test-designer-expressions-syntax-rule-based-ref">16.12.6.1。基于规则的测试方案中的表达式语法</a></h5>
<div class="paragraph">
<p>测试方案设计器支持以下基于规则的测试方案定义表达式：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表61。表达式语法说明</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:66.6667%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">操作员</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定等于一个值。这是所有列的默认设置，并且是GIVEN列支持的唯一运算符。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">=，= !, <></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定值的不等式。该运算符可以与其他运算符组合。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><，>，<=，> =</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定比较：小于，大于，小于或等于以及大于或等于。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">[值1，值2，值3]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定值列表。如果一个或多个值有效，则方案定义被评估为true。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">expression1; expression2;表情3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定表达式列表。如果所有表达式均有效，则方案定义被评估为true。</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>空单元格将从评估中跳过。要定义一个空字符串，请使用<code>=</code> ， <code>[]</code> ， 要么<code>;</code> 。要定义空值，请使用<code>null</code> 。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表62。范例表达式</caption>
<colgroup>
<col style="width:18.1818%">
<col style="width:81.8182%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">表达</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实际值等于-1。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实际值小于0。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">！> 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实际值不大于0。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">[-1，0，1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实际值等于-1或0或1。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><> [1，-1]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实际值既不等于1也不等于-1。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">！100; 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实际值不等于100，但等于0。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">！= <0; <>> 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实际值不小于0也不大于1。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><> <= 0; > = 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实际值既不小于0也不等于0，但大于或等于1。</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>您可以在基于规则的测试方案设计器右侧的“ <strong>方案摘要”</strong>选项卡中引用受支持的命令和语法。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="test-designer-expressions-syntax-dmn-based-ref"><a class="anchor" href="#test-designer-expressions-syntax-dmn-based-ref"></a> <a class="link" href="#test-designer-expressions-syntax-dmn-based-ref">16.12.6.2。基于DMN的方案中的表达语法</a></h5>
<div class="paragraph">
<p>测试方案设计器中基于DMN的测试方案支持以下数据类型：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表63。基于DMN的方案支持的数据类型</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:66.6667%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">支持的数据类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">数字和字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串必须用引号引起来，例如， <code>"John Doe"</code> ， <code>"Brno"</code>要么<code>""</code> 。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">布尔值</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> ， <code>false</code>和<code>null</code> 。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">日期和时间</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">例如， <code>date("2019-05-13")</code>要么<code>time("14:10:00+02:00")</code> 。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">功能</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">语境</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">例如， <code>{x : 5, y : 3}</code> 。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">范围和清单</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">例如， <code>[1 .. 10]</code>要么<code>[2, 3, 4, 5]</code> 。</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>您可以在基于DMN的测试方案设计器右侧的“ <strong>方案摘要”</strong>选项卡中引用受支持的命令和语法。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="test-designer-run-test-proc"><a class="anchor" href="#test-designer-run-test-proc"></a> <a class="link" href="#test-designer-run-test-proc">16.12.7。运行测试方案</a></h4>
<div class="paragraph">
<p>创建测试方案模板并定义测试方案后，您可以运行测试以验证业务规则和数据。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>要运行定义的测试方案，请执行以下任一任务：</p>
<div class="ulist">
<ul>
<li>
<p>要在多个资产中的项目中执行项目中所有可用的测试方案，请在项目页面的右上角单击<strong>Test</strong> 。</p>
<div class="paragraph">
<div class="title">从项目视图运行所有测试方案</div>
<p><span class="image"><img src="./AuthoringAssets/test-scenarios-run-all-tests-button.png" alt="从项目视图运行所有测试方案"></span></p>
</div>
</li>
<li>
<p>执行单个定义的所有可用测试方案<code>.scesim</code>文件，在“测试方案”设计器的顶部，单击“ <strong>运行测试”</strong> <span class="image"><img src="./AuthoringAssets/test-scenarios-run-test-icon.png" alt="运行测试图标"></span>图标。</p>
</li>
<li>
<p>运行单个定义的单个测试方案<code>.scesim</code>文件中，右键单击要运行的测试方案的行，然后选择<strong>运行方案</strong> 。</p>
</li>
</ul>
</div>
</li>
<li>
<p>“ <strong>测试报告”</strong>面板显示<strong>测试</strong>概述和方案状态。</p>
<div class="paragraph">
<p>执行测试后，如果在测试方案表中输入的值与预期值不匹配，则突出显示相应的单元格。</p>
</div>
</li>
<li>
<p>如果测试失败，则可以执行以下任务来排除故障：</p>
<div class="ulist">
<ul>
<li>
<p>要在弹出窗口中查看错误消息，请将鼠标光标悬停在突出显示的单元格上。</p>
</li>
<li>
<p>要打开设计器底部的“ <strong>警报”</strong>面板或项目视图以<strong>查看</strong>错误消息，请单击“ <strong>查看警报”</strong> 。</p>
</li>
<li>
<p>进行必要的更改，然后再次运行测试，直到场景通过。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="test-scenarios-running-locally-proc"><a class="anchor" href="#test-scenarios-running-locally-proc"></a> <a class="link" href="#test-scenarios-running-locally-proc">16.12.8。在本地运行测试方案</a></h4>
<div class="paragraph">
<p>在Drools中，您可以直接在Business Central中运行测试场景，也可以使用命令行在本地运行测试场景。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在Business Central中，转到<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> ，然后单击项目名称。</p>
</li>
<li>
<p>在项目的主页上，选择“ <strong>设置”</strong>选项卡。</p>
</li>
<li>
<p>选择<strong>git</strong> <strong>URL</strong>并单击<strong>剪贴板</strong> <span class="image"><img src="./AuthoringAssets/test-scenarios-clipboard-icon.png" alt="复制到剪贴板图标"></span>复制git网址。</p>
</li>
<li>
<p>打开命令终端，然后导航到要克隆git项目的目录。</p>
</li>
<li>
<p>运行以下命令：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>git clone your_git_project_url</code></pre>
</div>
</div>
<div class="paragraph">
<p>更换<code>your_git_project_url</code>相关数据，例如<code>git://localhost:9418/MySpace/ProjectTestScenarios</code> 。</p>
</div>
</li>
<li>
<p>成功克隆项目后，导航至git project目录并执行以下命令：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn clean test</code></pre>
</div>
</div>
<div class="paragraph">
<p>项目的构建信息和测试结果（例如，运行的测试数量以及测试运行是否成功）将显示在命令终端中。如果发生故障，请在Business Central中进行必要的更改，拉出更改并再次运行命令。</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="test-designer-create-mortgages-example-proc"><a class="anchor" href="#test-designer-create-mortgages-example-proc"></a> <a class="link" href="#test-designer-create-mortgages-example-proc">16.12.9。使用示例抵押项目创建测试方案</a></h4>
<div class="paragraph">
<p>本章说明使用测试方案设计器从Business Central附带的示例<strong>抵押</strong>项目中创建和执行测试方案。本章中的测试方案示例基于<strong>Mortgages</strong>项目中<strong>定价贷款</strong>指导的决策表。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在Business Central中，转到<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> ，然后单击<strong>抵押</strong> 。</p>
</li>
<li>
<p>如果未在“ <strong>项目</strong> ”下列出该<strong>项目</strong> ，请从<strong>MySpace</strong>中单击三个点（ <span class="image"><img src="./cases/dotdotdotbutton.png" alt="点点按钮"></span> ）在页面的右上角。</p>
</li>
<li>
<p>单击<strong>尝试样本</strong> → <strong>抵押</strong> → <strong>确定</strong> 。</p>
<div class="paragraph">
<p>资产窗口出现。</p>
</div>
</li>
<li>
<p>单击<strong>添加资产</strong> → <strong>测试方案</strong> 。</p>
</li>
<li>
<p>输入<code>scenario_pricing_loans</code>作为<strong>测试方案</strong>名称，然后选择默认<code>mortgages.mortgages</code>从“ <strong>软件包”</strong>下拉列表中选择“ <strong>软件包”</strong> 。</p>
<div class="paragraph">
<p>您选择的包必须包含所有必需的规则资产。</p>
</div>
</li>
<li>
<p>选择<strong>RULE</strong>作为<strong>来源类型</strong> 。</p>
</li>
<li>
<p>单击“ <strong>确定”</strong>以在测试方案设计器中创建并打开测试方案。</p>
</li>
<li>
<p>展开<strong>项目资源管理器，</strong>并验证以下内容：</p>
<div class="ulist">
<ul>
<li>
<p><code>Applicant</code> ， <code>Bankruptcy</code> ， <code>IncomeSource</code>和<code>LoanApplication</code>数据对象存在。</p>
</li>
<li>
<p><code>Pricing loans</code>存在指导决策表。</p>
</li>
<li>
<p>验证新的测试方案是否在“ <strong>测试方案”下列出</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>确认一切就绪后，返回到测试方案设计器的“ <strong>模型”</strong>选项卡，并根据可用的数据对象定义方案的<strong>GIVEN</strong>和<strong>EXPECT</strong>数据。</p>
<div class="paragraph">
<div class="title">空白的测试方案设计师</div>
<p><span class="image"><img src="./project-data/test-scenarios-preview-editor.png" alt="测试方案预览编辑器"></span></p>
</div>
</li>
<li>
<p>定义<strong>GIVEN</strong>列的详细信息，</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>单击<strong>GIVEN</strong>列标题下名为<strong>INSTANCE 1</strong>的单元格。</p>
</li>
<li>
<p>在“ <strong>测试工具”</strong>面板中，选择<strong>LoanApplication</strong>数据对象。</p>
</li>
<li>
<p>点击<strong>添加</strong> 。</p>
</li>
</ol>
</div>
</li>
<li>
<p>要创建数据对象的属性，请右键单击属性单元格，然后根据需要选择“ <strong>向右</strong> <strong>插入列”</strong>或“ <strong>向左插入列”</strong> 。对于此示例，您需要在<strong>GIVEN</strong>列下再创建两个属性单元格。</p>
</li>
<li>
<p>单击第一个属性单元格，</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>在“ <strong>测试工具”</strong>面板中，选择并展开<strong>LoanApplication</strong>数据对象。</p>
</li>
<li>
<p>单击<strong>数量</strong> ，然后单击<strong>添加</strong>以将数据对象字段映射到属性单元格。</p>
</li>
</ol>
</div>
</li>
<li>
<p>单击第二个属性单元格，</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>在“ <strong>测试工具”</strong>面板中，选择并展开<strong>LoanApplication</strong>数据对象。</p>
</li>
<li>
<p>点击<strong>存款</strong> ，然后点击<strong>添加</strong> 。</p>
</li>
</ol>
</div>
</li>
<li>
<p>单击第三个属性单元格，</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>在“ <strong>测试工具”</strong>面板中，选择并展开<strong>LoanApplication</strong>数据对象。</p>
</li>
<li>
<p>单击<strong>lengthYears</strong> ，然后单击<strong>添加</strong> 。</p>
</li>
</ol>
</div>
</li>
<li>
<p>右键单击<strong>LoanApplication</strong>标头单元格，然后选择<strong>右插入列</strong> 。在右边创建了一个新的<strong>GIVEN</strong>列。</p>
</li>
<li>
<p>点击新的标题单元格，</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>在“ <strong>测试工具”</strong>面板中，选择<strong>IncomeSource</strong>数据对象。</p>
</li>
<li>
<p>单击<strong>添加</strong>将数据对象映射到标题单元格。</p>
</li>
</ol>
</div>
</li>
<li>
<p>单击<strong>IncomeSource</strong>下面的属性单元格，</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>在“ <strong>测试工具”</strong>面板中，选择并展开<strong>IncomeSource</strong>数据对象。</p>
</li>
<li>
<p>单击<strong>类型</strong> ，然后单击<strong>添加</strong>以将数据对象字段映射到属性单元格。</p>
<div class="paragraph">
<p>现在，您已经定义了所有<strong>GIVEN</strong>列单元格。</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>接下来，定义<strong>EXPECT</strong>列的详细信息，</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>单击<strong>EXPECT</strong>列标题下名为<strong>INSTANCE 2</strong>的单元格。</p>
</li>
<li>
<p>在“ <strong>测试工具”</strong>面板中，选择<strong>LoanApplication</strong>数据对象。</p>
</li>
<li>
<p>点击<strong>添加</strong> 。</p>
</li>
</ol>
</div>
</li>
<li>
<p>要创建数据对象的属性，请右键单击属性单元格，然后根据需要选择“ <strong>向右</strong> <strong>插入列”</strong>或“ <strong>向左插入列”</strong> 。在<strong>EXPECT</strong>列下再创建两个属性单元格。</p>
</li>
<li>
<p>单击第一个属性单元格，</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>在“ <strong>测试工具”</strong>面板中，选择并展开<strong>LoanApplication</strong>数据对象。</p>
</li>
<li>
<p>单击<strong>批准</strong> ，然后单击<strong>添加</strong>以将数据对象字段映射到属性单元格。</p>
</li>
</ol>
</div>
</li>
<li>
<p>单击第二个属性单元格，</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>在“ <strong>测试工具”</strong>面板中，选择并展开<strong>LoanApplication</strong>数据对象。</p>
</li>
<li>
<p>点击<strong>insuranceCost</strong> ，然后点击<strong>添加</strong> 。</p>
</li>
</ol>
</div>
</li>
<li>
<p>单击第三个属性单元格，</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>在“ <strong>测试工具”</strong>面板中，选择并展开<strong>LoanApplication</strong>数据对象。</p>
</li>
<li>
<p>点击<strong>核准利率</strong> ，然后点击<strong>添加</strong> 。</p>
</li>
</ol>
</div>
</li>
<li>
<p>现在，要定义测试方案，请在第一行中输入以下数据：</p>
<div class="ulist">
<ul>
<li>
<p>输入<code>Row 1 test scenario</code>作为<strong>方案说明</strong> ， <code>150000</code>作为<strong>数量</strong> ， <code>19000</code>作为<strong>押金</strong> ， <code>30</code>作为<strong>lengthYears</strong>和<code>Asset</code>作为<strong>GIVEN</strong>列值的<strong>类型</strong> 。</p>
</li>
<li>
<p>输入<code>true</code> <strong>经批准</strong> ， <code>0</code>作为<strong>保险费用</strong>和<code>2</code>作为<strong>approvedRate</strong>为<strong>EXPECT</strong>列值。</p>
</li>
</ul>
</div>
</li>
<li>
<p>接下来，在第二行中输入以下数据：</p>
<div class="ulist">
<ul>
<li>
<p>输入<code>Row 2 test scenario</code>作为<strong>方案说明</strong> ， <code>100002</code>作为<strong>数量</strong> ， <code>2999</code>作为<strong>押金</strong> ， <code>20</code>作为<strong>lengthYears</strong>和<code>Job</code>作为<strong>GIVEN</strong>列值的<strong>类型</strong> 。</p>
</li>
<li>
<p>输入<code>true</code> <strong>经批准</strong> ， <code>10</code>作为<strong>保险费用</strong>和<code>6</code>作为<strong>approvedRate</strong>为<strong>EXPECT</strong>列值。</p>
</li>
</ul>
</div>
</li>
<li>
<p>定义方案的所有<strong>GIVEN</strong> ， <strong>EXPECT</strong>和其他数据后，在测试方案设计器中单击“ <strong>保存</strong> ”以保存您的工作。</p>
</li>
<li>
<p>点击右上角的<strong>运行测试</strong>以运行<code>.scesim</code>文件。</p>
<div class="paragraph">
<p>测试结果显示在“ <strong>测试报告”</strong>面板中。单击<strong>查看警报</strong>以显示“ <strong>警报”</strong>部分中的消息。如果测试失败，请参考窗口底部“ <strong>警报”</strong>部分中的消息，查看并更正场景中的所有组件，然后再次尝试验证场景直到场景通过。</p>
</div>
</li>
<li>
<p>点击测试场景设计师<strong>保存</strong> ，保存你的工作，你已经做了一切必要的更改后。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="test-scenarios-legacy-designer-con"><a class="anchor" href="#test-scenarios-legacy-designer-con"></a> <a class="link" href="#test-scenarios-legacy-designer-con">16.12.10。Business Central中的测试方案（旧版）设计器</a></h4>
<div class="paragraph">
<p>Drools当前支持新的<strong>测试方案</strong>设计者和以前的<strong>测试方案（传统）</strong>设计者。默认设计器是新的测试方案设计器，它支持规则和DMN模型的测试，并通过测试方案提供增强的整体用户体验。如果需要，您可以继续使用旧版测试方案设计器，该设计器仅支持基于规则的测试方案。</p>
</div>
<div class="sect4">
<h5 id="test-scenarios-legacy-create-proc"><a class="anchor" href="#test-scenarios-legacy-create-proc"></a> <a class="link" href="#test-scenarios-legacy-create-proc">16.12.10.1。创建和运行测试方案（旧版）</a></h5>
<div class="paragraph">
<p>您可以在Business Central中创建测试方案，以在部署之前测试业务规则数据的功能。基本测试方案必须至少具有以下数据：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>相关数据对象</p>
</li>
<li>
<p><strong>给出的</strong>事实</p>
</li>
<li>
<p><strong>预期</strong>结果</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>有了这些数据，测试方案就可以基于定义的事实来验证该规则实例的预期和实际结果。您还可以将“ <strong>调用方法”</strong>和任何可用的<strong>全局变量添加</strong>到测试方案，但是这些方案设置是可选的。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在Business Central中，转到<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> ，然后单击项目名称。</p>
</li>
<li>
<p>单击<strong>添加资产</strong> → <strong>测试场景（旧版）</strong> 。</p>
</li>
<li>
<p>输入信息丰富的<strong>测试方案</strong>名称，然后选择适当的<strong>软件包</strong> 。您指定的包必须与已经分配或将要分配的规则资产的包相同。您可以将任何包装中的数据对象导入资产的设计器。</p>
</li>
<li>
<p>单击“ <strong>确定”</strong>创建测试方案。</p>
<div class="paragraph">
<p>现在，新的测试方案列在“ <strong>项目资源管理器”</strong>的“ <strong>测试方案”</strong>面板中，</p>
</div>
</li>
<li>
<p>单击“ <strong>数据对象”</strong>选项卡以验证是否列出了要测试的规则所需的所有数据对象。如果不是，请单击“ <strong>新建项目”</strong>以从其他程序包或您的程序包中导入所需的数据对象。</p>
</li>
<li>
<p>放置完所有数据对象后，返回到测试方案设计器的“ <strong>模型”</strong>选项卡，并根据可用的数据对象定义方案的<strong>GIVEN</strong>和<strong>EXPECT</strong>数据。</p>
<div class="imageblock">
<div class="content">
<img src="./project-data/test-scenario-edit.png" alt="测试场景编辑">
</div>
<div class="title">图346。测试方案设计师</div>
</div>
<div class="paragraph">
<p><strong>GIVEN</strong>部分定义了测试的输入事实。例如，如果<code>Underage</code>项目中的规则拒绝了21岁以下申请人的贷款申请，那么测试场景中的<strong>GIVEN</strong>事实可能是<code>Applicant</code>与<code>age</code>设置为小于21的整数。</p>
</div>
<div class="paragraph">
<p><strong>EXPECT</strong>部分基于<strong>GIVEN</strong>输入事实定义了预期结果。也就是说， <strong>给定</strong>输入的事实， <strong>希望</strong>这些其他事实是要激活有效或整个规则。例如，假设情景中申请人未满21岁，则<strong>EXPECT</strong>结果可能为<code>LoanApplication</code>与<code>approved</code>调成<code>false</code> （由于未成年人的申请），或者可能是由于<code>Underage</code>整个规则。</p>
</div>
</li>
<li>
<p>（可选）将<strong>CALL METHOD</strong>和任何<strong>全局变量</strong>添加到测试方案：</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>调用方法：</strong>启动规则执行时，可使用此方法从另一个事实调用方法。单击“ <strong>调用方法”</strong> ，选择一个事实，然后单击<span class="image"><img src="./project-data/6187.png" alt="6187"></span>选择要调用的方法。您可以从Java库或从为项目导入的JAR（如果适用）中调用任何Java类方法（例如ArrayList中的方法）。</p>
</li>
<li>
<p><strong>全局变量：</strong>使用它可以在项目中添加要在测试场景中验证的所有全局变量。单击<strong>全局变量</strong>以选择要验证的变量，然后在测试方案设计器中，单击全局名称并定义要应用于全局变量的字段值。如果没有全局变量可用，则必须在Business Central中将它们创建为新资产。全局变量是Drools引擎可见的命名对象，但与事实对象不同。全局对象的更改不会触发规则的重新评估。</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>单击测试方案设计器底部的“ <strong>更多”，</strong>以根据需要将其他数据块添加到同一方案文件中。</p>
</li>
<li>
<p>定义方案的所有<strong>GIVEN</strong> ， <strong>EXPECT</strong>和其他数据后，在测试方案设计器中单击“ <strong>保存</strong> ”以保存您的工作。</p>
</li>
<li>
<p>单击右上角的<strong>“运行方案</strong> ”以运行此方案<code>.scenario</code>文件，或单击<strong>“运行所有方案”</strong>以运行所有已保存的方案<code>.scenario</code>项目包中的文件（如果有多个）。尽管“ <strong>运行方案”</strong>选项不需要个人<code>.scenario</code>要保存的文件，“ <strong>运行所有方案”</strong>选项确实需要所有<code>.scenario</code>要保存的文件。</p>
<div class="paragraph">
<p>如果测试失败，请解决窗口底部“ <strong>警报”</strong>消息中描述的任何问题，查看方案中的所有组件，然后再次尝试验证方案，直到方案通过为止。</p>
</div>
</li>
<li>
<p>完成所有更改后，在测试方案设计器中单击“ <strong>保存</strong> ”以保存您的工作。</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="test-scenarios-legacy-GIVEN-proc"><a class="anchor" href="#test-scenarios-legacy-GIVEN-proc"></a> <a class="link" href="#test-scenarios-legacy-GIVEN-proc">16.12.10.2。在测试场景中添加GIVEN事实（旧版）</a></h5>
<div class="paragraph">
<p><strong>GIVEN</strong>部分定义了测试的输入事实。例如，如果<code>Underage</code>项目中的规则拒绝了21岁以下申请人的贷款申请，那么测试场景中的<strong>GIVEN</strong>事实可能是<code>Applicant</code>与<code>age</code>设置为小于21的整数。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>测试方案所需的所有数据对象均已创建或导入，并在“ <strong>测试方案（旧式）”</strong>设计器的“ <strong>数据对象”</strong>选项卡中列出。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在<strong>测试方案（Legacy）的</strong>设计师，点击<strong>考虑</strong>与现有的事实，打开<strong>新的输入</strong>窗口。</p>
<div class="imageblock">
<div class="content">
<img src="./project-data/test-scenario-facts.png" alt="将GIVEN输入添加到测试场景">
</div>
<div class="title">图347。将GIVEN输入添加到测试场景</div>
</div>
<div class="paragraph">
<p>该列表包括以下选项，具体取决于测试方案设计器的“ <strong>数据对象”</strong>选项卡中可用的<strong>数据对象</strong> ：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>插入新事实：</strong>使用此<strong>事实</strong>可以添加事实并修改其字段值。输入事实的变量作为<strong>事实名称</strong> 。</p>
</li>
<li>
<p><strong>修改现有事实：（</strong>仅在添加另一个事实之后出现。）使用它来指定在场景执行之间要在Drools引擎中修改的先前插入的事实。</p>
</li>
<li>
<p><strong>删除现有事实：（</strong>仅在添加另一个事实之后出现。）使用此选项可以指定在场景执行之间从Drools引擎中删除的先前插入的事实。</p>
</li>
<li>
<p><strong>激活规则流组：</strong>使用此选项可指定要激活的规则流组，以便可以测试该组中的所有规则。</p>
</li>
</ul>
</div>
</li>
<li>
<p>为所需的输入选项选择一个事实，然后单击<strong>添加</strong> 。例如，将“ <strong>插入新事实：”设置</strong>为“ <strong>申请人”</strong>并输入<code>a</code>要么<code>app</code>或<strong>事实名称的</strong>任何其他变量。</p>
</li>
<li>
<p>在测试方案设计器中单击事实，然后选择要修改的字段。</p>
<div class="imageblock">
<div class="content">
<img src="./project-data/test-scenario-field.png" alt="修改条件">
</div>
<div class="title">图348。修改事实字段</div>
</div>
</li>
<li>
<p>点击修改图标（ <span class="image"><img src="./project-data/6191.png" alt="6191"></span> ），然后从以下字段值中进行选择：</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>文字值：</strong>创建一个开放字段，您可以在其中输入特定的文字值。</p>
</li>
<li>
<p><strong>绑定变量：</strong>将字段的值设置为绑定到所选变量的事实。字段类型必须与绑定变量类型匹配。</p>
</li>
<li>
<p><strong>创建新事实：</strong>使您可以创建新事实并将其分配为父事实的字段值。然后，您可以在测试方案设计器中单击子事实，并类似地分配字段值或嵌套其他事实。</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>继续为方案添加任何其他<strong>GIVEN</strong>输入数据，然后在测试方案设计器中单击“ <strong>保存</strong> ”以保存您的工作。</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="test-scenarios-legacy-EXPECT-proc"><a class="anchor" href="#test-scenarios-legacy-EXPECT-proc"></a> <a class="link" href="#test-scenarios-legacy-EXPECT-proc">16.12.10.3。在测试场景中添加EXPECT结果（旧版）</a></h5>
<div class="paragraph">
<p><strong>EXPECT</strong>部分基于<strong>GIVEN</strong>输入事实定义了预期结果。也就是说， <strong>给</strong>定输入事实， <strong>期望</strong>其他指定事实有效或激活整个规则。例如，假设情景中申请人未满21岁，则<strong>EXPECT</strong>结果可能为<code>LoanApplication</code>与<code>approved</code>调成<code>false</code> （由于未成年人的申请），或者可能是由于<code>Underage</code>整个规则。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>测试方案所需的所有数据对象均已创建或导入，并在“ <strong>测试方案（旧式）”</strong>设计器的“ <strong>数据对象”</strong>选项卡中列出。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在<strong>测试方案（Legacy）的</strong>设计师，单击<strong>期待</strong>与现有的事实打开<strong>新的期望</strong>窗口。</p>
<div class="imageblock">
<div class="content">
<img src="./project-data/test-scenario-expected-rules.png" alt="将EXPECT结果添加到测试场景">
</div>
<div class="title">图349。将EXPECT结果添加到测试场景</div>
</div>
<div class="paragraph">
<p>该列表包括以下选项，具体取决于<strong>GIVEN</strong>部分中的<strong>数据</strong>和测试方案设计器的“ <strong>数据对象”</strong>选项卡中可用的<strong>数据对象</strong> ：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>规则：</strong>使用此命令可以指定项目中由于<strong>GIVEN</strong>输入而将被激活的特定规则。键入预期要激活的规则的名称，或从规则列表中选择它的名称，然后在测试方案设计器中，指定应激活该规则的次数。</p>
</li>
<li>
<p><strong>事实值：</strong>使用它来选择一个事实，并为其定义一些值，这些值由于<strong>GIVEN</strong>部分中定义的事实而有望有效。事实由先前为<strong>GIVEN</strong>输入定义的<strong>事实名称</strong>列出。</p>
</li>
<li>
<p><strong>匹配的任何事实：</strong>使用这个来验证至少有一个具有指定值的事实作为<strong>GIVEN</strong>输入的结果存在。</p>
</li>
</ul>
</div>
</li>
<li>
<p>选择所需期望的事实（例如<strong>事实值：</strong> <code>application</code> ），然后点击<strong>添加</strong>或<strong>确定</strong> 。</p>
</li>
<li>
<p>在测试方案设计器中单击事实，然后选择要添加和修改的字段。</p>
<div class="imageblock">
<div class="content">
<img src="./project-data/test-scenario-field-value.png" alt="修改事实字段">
</div>
<div class="title">图350。修改事实字段</div>
</div>
</li>
<li>
<p>将字段值设置为由于<strong>GIVEN</strong>输入而预期有效的值（例如<code>approved</code> | <code>equals</code> | <code>false</code> ）。</p>
</li>
<li>
<p>继续为该方案添加任何其他<strong>EXPECT</strong>输入数据，然后在测试方案设计器中单击“ <strong>保存</strong> ”以保存您的工作。</p>
</li>
<li>
<p>为方案定义并保存所有<strong>GIVEN</strong> ， <strong>EXPECT</strong>和其他数据后，单击右上角的<strong>“运行方案</strong> ”以运行此方案<code>.scenario</code>文件，或单击<strong>“运行所有方案”</strong>以运行所有已保存的方案<code>.scenario</code>项目包中的文件（如果有多个）。尽管“ <strong>运行方案”</strong>选项不需要个人<code>.scenario</code>要保存的文件，“ <strong>运行所有方案”</strong>选项确实需要所有<code>.scenario</code>要保存的文件。</p>
<div class="paragraph">
<p>如果测试失败，请解决窗口底部“ <strong>警报”</strong>消息中描述的任何问题，查看方案中的所有组件，然后再次尝试验证方案，直到方案通过为止。</p>
</div>
</li>
<li>
<p>完成所有更改后，在测试方案设计器中单击“ <strong>保存</strong> ”以保存您的工作。</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div></div>
<div class="sect1">
<h2 id="_wb.workbenchintegration"><a class="anchor" href="#_wb.workbenchintegration"></a> <a class="link" href="#_wb.workbenchintegration">17。商业中心整合</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="knowledge-store-rest-api-con_drl-rules"><a class="anchor" href="#knowledge-store-rest-api-con_drl-rules"></a> <a class="link" href="#knowledge-store-rest-api-con_drl-rules">17.1。适用于Business Central空间和项目的Knowledge Store REST API</a></h3>
<div class="paragraph">
<p>Drools提供了一个Knowledge Store REST API，您可以使用它与Drools中的项目和空间进行交互，而无需使用Business Central用户界面。知识存储是Drools中资产的工件存储库。此API支持使您能够促进和自动执行Business Central项目和空间的维护。</p>
</div>
<div class="paragraph">
<p>借助Knowledge Store REST API，您可以执行以下操作：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>检索有关所有项目和空间的信息</p>
</li>
<li>
<p>创建，更新或删除项目和空间</p>
</li>
<li>
<p>建立，部署和测试项目</p>
</li>
<li>
<p>检索有关以前的Knowledge Store REST API请求或<em>作业的信息</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>知识库REST API请求需要以下组件：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">认证方式</dt>
<dd>
<p>知识库REST API需要针对用户角色的HTTP基本身份验证或基于令牌的身份验证<code>rest-all</code> 。要查看您的Drools发行版的已配置用户角色，请导航至<code>~/$SERVER_HOME/standalone/configuration/application-roles.properties</code>和<code>~/application-users.properties</code> 。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>要为用户添加<code>rest-all</code>角色，导航至<code>~/$SERVER_HOME/bin</code>并运行以下命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./add-user.sh -a --user &lt;USERNAME&gt; --password &lt;PASSWORD&gt; --role rest-all</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关用户角色和Drools安装选项的更多信息，请参见<a href="#_installing_the_kie_server">安装KIE服务器</a> 。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">HTTP标头</dt>
<dd>
<p>知识库REST API需要以下HTTP标头来处理API请求：</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code> ：请求客户接受的数据格式：</p>
<div class="ulist">
<ul>
<li>
<p><code>application/json</code> （JSON）</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Content-Type</code> ：您的数据格式<code>POST</code>要么<code>PUT</code> API请求数据：</p>
<div class="ulist">
<ul>
<li>
<p><code>application/json</code> （JSON）</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">HTTP方法</dt>
<dd>
<p>Knowledge Store REST API支持以下针对API请求的HTTP方法：</p>
<div class="ulist">
<ul>
<li>
<p><code>GET</code> ：从指定的资源端点检索指定的信息</p>
</li>
<li>
<p><code>POST</code> ：创建或更新资源</p>
</li>
<li>
<p><code>DELETE</code> ：删除资源</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">基本网址</dt>
<dd>
<p>知识库REST API请求的基本URL是<code>http://SERVER:PORT/business-central/rest/</code> ， 如<code>http://localhost:8080/business-central/rest/</code> 。</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">知识存储库和内置在Business Central中的Drools控制器的REST API基本URL相同，因为它们都被视为Business Central REST服务的一部分。
</td>
</tr>
</tbody></table>
</div>
</dd>
<dt class="hdlist1">终点</dt>
<dd>
<p>知识库REST API端点，例如<code>/spaces/{spaceName}</code>对于指定的空间，是您附加到Knowledge Store REST API基本URL上以访问Drools中相应资源或资源类型的URI。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<div class="title">的请求网址示例<code>/spaces/{spaceName}</code>终点</div>
<p><code>http://localhost:8080/business-central/rest/spaces/MySpace</code></p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">索取资料</dt>
<dd>
<p>HTTP <code>POST</code>知识库REST API中的请求可能需要带有数据的JSON请求主体，以伴随该请求。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<div class="title">示例POST请求URL和JSON请求正文数据</div>
<p><code>http://localhost:8080/business-central/rest/spaces/MySpace/projects</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "Employee_Rostering",
  "groupId": "employeerostering",
  "version": "1.0.0-SNAPSHOT",
  "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill."
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="knowledge-store-rest-api-requests-proc_drl-rules"><a class="anchor" href="#knowledge-store-rest-api-requests-proc_drl-rules"></a> <a class="link" href="#knowledge-store-rest-api-requests-proc_drl-rules">17.1.1。使用REST客户端或curl实用程序通过Knowledge Store REST API发送请求</a></h4>
<div class="paragraph">
<p>Knowledge Store REST API使您无需使用Business Central用户界面即可与Drools中的项目和空间进行交互。您可以使用任何REST客户端或curl实用程序发送Knowledge Store REST API请求。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>Business Central已安装并正在运行。</p>
</li>
<li>
<p>你有<code>rest-all</code>用户角色访问Business Central。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>标识要向其发送请求的相关<a href="#knowledge-store-rest-api-endpoints-ref_kie-apis">API端点</a> ，例如<code>[GET] /spaces</code>检索Business Central中的空间。</p>
</li>
<li>
<p>在REST客户端或curl实用程序中，为<code>GET</code>请求<code>/spaces</code> 。根据您的用例调整任何请求详细信息。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>对于REST客户端：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>身份验证</strong> ：使用以下命令输入Business Central用户的用户名和密码： <code>rest-all</code>角色。</p>
</li>
<li>
<p><strong>HTTP标头</strong> ：设置以下标头：</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code> ：<code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>HTTP方法</strong> ：设置为<code>GET</code> 。</p>
</li>
<li>
<p><strong>URL</strong> ：输入知识库的REST API基础URL和端点，例如<code>http://localhost:8080/business-central/rest/spaces</code> 。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>对于curl实用程序：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-u</code> ：使用以下命令输入Business Central用户的用户名和密码： <code>rest-all</code>角色。</p>
</li>
<li>
<p><code>-H</code> ：设置以下标题：</p>
<div class="ulist">
<ul>
<li>
<p><code>accept</code> ：<code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>-X</code> ： 调成<code>GET</code> 。</p>
</li>
<li>
<p><strong>URL</strong> ：输入知识库的REST API基础URL和端点，例如<code>http://localhost:8080/business-central/rest/spaces</code> 。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -X GET "http://localhost:8080/business-central/rest/spaces"</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>执行请求并查看KIE服务器响应。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>服务器响应示例（JSON）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "name": "MySpace",
    "description": null,
    "projects": [
      {
        "name": "Employee_Rostering",
        "spaceName": "MySpace",
        "groupId": "employeerostering",
        "version": "1.0.0-SNAPSHOT",
        "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill.",
        "publicURIs": [
          {
            "protocol": "git",
            "uri": "git://localhost:9418/MySpace/example-Employee_Rostering"
          },
          {
            "protocol": "ssh",
            "uri": "ssh://localhost:8001/MySpace/example-Employee_Rostering"
          }
        ]
      },
      {
        "name": "Mortgage_Process",
        "spaceName": "MySpace",
        "groupId": "mortgage-process",
        "version": "1.0.0-SNAPSHOT",
        "description": "Getting started loan approval process in BPMN2, decision table, business rules, and forms.",
        "publicURIs": [
          {
            "protocol": "git",
            "uri": "git://localhost:9418/MySpace/example-Mortgage_Process"
          },
          {
            "protocol": "ssh",
            "uri": "ssh://localhost:8001/MySpace/example-Mortgage_Process"
          }
        ]
      }
    ],
    "owner": "admin",
    "defaultGroupId": "com.myspace"
  },
  {
    "name": "MySpace2",
    "description": null,
    "projects": [
      {
        "name": "IT_Orders",
        "spaceName": "MySpace",
        "groupId": "itorders",
        "version": "1.0.0-SNAPSHOT",
        "description": "Case Management IT Orders project",
        "publicURIs": [
          {
            "protocol": "git",
            "uri": "git://localhost:9418/MySpace/example-IT_Orders-1"
          },
          {
            "protocol": "ssh",
            "uri": "ssh://localhost:8001/MySpace/example-IT_Orders-1"
          }
        ]
      }
    ],
    "owner": "admin",
    "defaultGroupId": "com.myspace"
  }
]</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>在您的REST客户端或curl实用程序中，使用以下组件发送另一个API请求： <code>POST</code>请求<code>/spaces/{spaceName}/projects</code>在一个空间内创建一个项目。根据您的用例调整任何请求详细信息。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>对于REST客户端：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>身份验证</strong> ：使用以下命令输入Business Central用户的用户名和密码： <code>rest-all</code>角色。</p>
</li>
<li>
<p><strong>HTTP标头</strong> ：设置以下标头：</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code> ：<code>application/json</code></p>
</li>
<li>
<p><code>Content-Type</code> ：<code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>HTTP方法</strong> ：设置为<code>POST</code> 。</p>
</li>
<li>
<p><strong>URL</strong> ：输入知识库的REST API基础URL和端点，例如<code>http://localhost:8080/business-central/rest/spaces/MySpace/projects</code> 。</p>
</li>
<li>
<p><strong>请求正文</strong> ：添加一个JSON请求正文，其中包含新项目的标识数据：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "Employee_Rostering",
  "groupId": "employeerostering",
  "version": "1.0.0-SNAPSHOT",
  "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill."
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于curl实用程序：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-u</code> ：使用以下命令输入Business Central用户的用户名和密码： <code>rest-all</code>角色。</p>
</li>
<li>
<p><code>-H</code> ：设置以下标题：</p>
<div class="ulist">
<ul>
<li>
<p><code>accept</code> ：<code>application/json</code></p>
</li>
<li>
<p><code>content-type</code> ：<code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>-X</code> ： 调成<code>POST</code> 。</p>
</li>
<li>
<p><strong>URL</strong> ：输入知识库的REST API基础URL和端点，例如<code>http://localhost:8080/business-central/rest/spaces/MySpace/projects</code> 。</p>
</li>
<li>
<p><code>-d</code> ：添加JSON请求正文或文件（ <code>@file.json</code> ）以及新项目的标识数据：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -H "content-type: application/json" -X POST "http://localhost:8080/business-central/rest/spaces/MySpace/projects" -d "{ \"name\": \"Employee_Rostering\", \"groupId\": \"employeerostering\", \"version\": \"1.0.0-SNAPSHOT\", \"description\": \"Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill.\"}"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -H "content-type: application/json" -X POST "http://localhost:8080/business-central/rest/spaces/MySpace/projects" -d @my-project.json</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>执行请求并查看KIE服务器响应。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>服务器响应示例（JSON）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541017411591-6",
  "status": "APPROVED",
  "spaceName": "MySpace",
  "projectName": "Employee_Rostering",
  "projectGroupId": "employeerostering",
  "projectVersion": "1.0.0-SNAPSHOT",
  "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill."
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果遇到请求错误，请查看返回的错误代码消息并相应地调整您的请求。</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="knowledge-store-rest-api-endpoints-ref_drl-rules"><a class="anchor" href="#knowledge-store-rest-api-endpoints-ref_drl-rules"></a> <a class="link" href="#knowledge-store-rest-api-endpoints-ref_drl-rules">17.1.2。支持的Knowledge Store REST API端点</a></h4>
<div class="paragraph">
<p>知识库REST API提供了端点，用于管理Drools中的空间和项目以及检索有关先前知识库REST API请求或<em>作业的信息</em> 。</p>
</div>
<div class="sect4">
<h5 id="knowledge-store-rest-api-spaces-ref_drl-rules"><a class="anchor" href="#knowledge-store-rest-api-spaces-ref_drl-rules"></a> <a class="link" href="#knowledge-store-rest-api-spaces-ref_drl-rules">17.1.2.1。空间</a></h5>
<div class="paragraph">
<p>Knowledge Store REST API支持以下端点，用于管理Business Central中的空间。知识库REST API的基本URL为<code>http://SERVER:PORT/business-central/rest/</code> 。对于所有请求，所有请求都需要HTTP基本身份验证或基于令牌的身份验证<code>rest-all</code>用户角色。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[GET] /空格</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>返回Business Central中的所有空格。</p>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "name": "MySpace",
    "description": null,
    "projects": [
      {
        "name": "Employee_Rostering",
        "spaceName": "MySpace",
        "groupId": "employeerostering",
        "version": "1.0.0-SNAPSHOT",
        "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill.",
        "publicURIs": [
          {
            "protocol": "git",
            "uri": "git://localhost:9418/MySpace/example-Employee_Rostering"
          },
          {
            "protocol": "ssh",
            "uri": "ssh://localhost:8001/MySpace/example-Employee_Rostering"
          }
        ]
      },
      {
        "name": "Mortgage_Process",
        "spaceName": "MySpace",
        "groupId": "mortgage-process",
        "version": "1.0.0-SNAPSHOT",
        "description": "Getting started loan approval process in BPMN2, decision table, business rules, and forms.",
        "publicURIs": [
          {
            "protocol": "git",
            "uri": "git://localhost:9418/MySpace/example-Mortgage_Process"
          },
          {
            "protocol": "ssh",
            "uri": "ssh://localhost:8001/MySpace/example-Mortgage_Process"
          }
        ]
      }
    ],
    "owner": "admin",
    "defaultGroupId": "com.myspace"
  },
  {
    "name": "MySpace2",
    "description": null,
    "projects": [
      {
        "name": "IT_Orders",
        "spaceName": "MySpace",
        "groupId": "itorders",
        "version": "1.0.0-SNAPSHOT",
        "description": "Case Management IT Orders project",
        "publicURIs": [
          {
            "protocol": "git",
            "uri": "git://localhost:9418/MySpace/example-IT_Orders-1"
          },
          {
            "protocol": "ssh",
            "uri": "ssh://localhost:8001/MySpace/example-IT_Orders-1"
          }
        ]
      }
    ],
    "owner": "admin",
    "defaultGroupId": "com.myspace"
  }
]</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[GET] / spaces / {spaceName}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>返回有关指定空间的信息。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表64。请求参数</caption>
<colgroup>
<col style="width:25%">
<col style="width:45%">
<col style="width:15%">
<col style="width:15%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要检索的空间的名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "MySpace",
  "description": null,
  "projects": [
    {
      "name": "Mortgage_Process",
      "spaceName": "MySpace",
      "groupId": "mortgage-process",
      "version": "1.0.0-SNAPSHOT",
      "description": "Getting started loan approval process in BPMN2, decision table, business rules, and forms.",
      "publicURIs": [
        {
          "protocol": "git",
          "uri": "git://localhost:9418/MySpace/example-Mortgage_Process"
        },
        {
          "protocol": "ssh",
          "uri": "ssh://localhost:8001/MySpace/example-Mortgage_Process"
        }
      ]
    },
    {
      "name": "Employee_Rostering",
      "spaceName": "MySpace",
      "groupId": "employeerostering",
      "version": "1.0.0-SNAPSHOT",
      "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill.",
      "publicURIs": [
        {
          "protocol": "git",
          "uri": "git://localhost:9418/MySpace/example-Employee_Rostering"
        },
        {
          "protocol": "ssh",
          "uri": "ssh://localhost:8001/MySpace/example-Employee_Rostering"
        }
      ]
    },
    {
      "name": "Evaluation_Process",
      "spaceName": "MySpace",
      "groupId": "evaluation",
      "version": "1.0.0-SNAPSHOT",
      "description": "Getting started Business Process for evaluating employees",
      "publicURIs": [
        {
          "protocol": "git",
          "uri": "git://localhost:9418/MySpace/example-Evaluation_Process"
        },
        {
          "protocol": "ssh",
          "uri": "ssh://localhost:8001/MySpace/example-Evaluation_Process"
        }
      ]
    },
    {
      "name": "IT_Orders",
      "spaceName": "MySpace",
      "groupId": "itorders",
      "version": "1.0.0-SNAPSHOT",
      "description": "Case Management IT Orders project",
      "publicURIs": [
        {
          "protocol": "git",
          "uri": "git://localhost:9418/MySpace/example-IT_Orders"
        },
        {
          "protocol": "ssh",
          "uri": "ssh://localhost:8001/MySpace/example-IT_Orders"
        }
      ]
    }
  ],
  "owner": "admin",
  "defaultGroupId": "com.myspace"
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[POST] /空格</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>在Business Central中创建一个空间。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表65。请求参数</caption>
<colgroup>
<col style="width:25%">
<col style="width:45%">
<col style="width:15%">
<col style="width:15%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>身体</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">的<code>name</code> ， <code>description</code> ， <code>owner</code> ， <code>defaultGroupId</code>以及新空间的任何其他组件</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要求正文</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">示例请求正文（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "NewSpace",
  "description": "My new space.",
  "owner": "admin",
  "defaultGroupId": "com.newspace"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541016978154-3",
  "status": "APPROVED",
  "spaceName": "NewSpace",
  "owner": "admin",
  "defaultGroupId": "com.newspace",
  "description": "My new space."
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[删除] / spaces / {spaceName}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>从Business Central中删除指定的空间。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表66。请求参数</caption>
<colgroup>
<col style="width:25%">
<col style="width:45%">
<col style="width:15%">
<col style="width:15%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除的空间的名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541127032997-8",
  "status": "APPROVED",
  "spaceName": "MySpace",
  "owner": "admin",
  "description": "My deleted space.",
  "repositories": null
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="knowledge-store-rest-api-projects-ref_drl-rules"><a class="anchor" href="#knowledge-store-rest-api-projects-ref_drl-rules"></a> <a class="link" href="#knowledge-store-rest-api-projects-ref_drl-rules">17.1.2.2。专案</a></h5>
<div class="paragraph">
<p>Knowledge Store REST API支持以下端点，用于在Business Central中管理，构建和部署项目。知识库REST API的基本URL为<code>http://SERVER:PORT/business-central/rest/</code> 。对于所有请求，所有请求都需要HTTP基本身份验证或基于令牌的身份验证<code>rest-all</code>用户角色。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[GET] / spaces / {spaceName} / projects</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>返回指定空间中的项目。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表67。请求参数</caption>
<colgroup>
<col style="width:25%">
<col style="width:45%">
<col style="width:15%">
<col style="width:15%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">您要检索项目的空间的名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "name": "Mortgage_Process",
    "spaceName": "MySpace",
    "groupId": "mortgage-process",
    "version": "1.0.0-SNAPSHOT",
    "description": "Getting started loan approval process in BPMN2, decision table, business rules, and forms.",
    "publicURIs": [
      {
        "protocol": "git",
        "uri": "git://localhost:9418/MySpace/example-Mortgage_Process"
      },
      {
        "protocol": "ssh",
        "uri": "ssh://localhost:8001/MySpace/example-Mortgage_Process"
      }
    ]
  },
  {
    "name": "Employee_Rostering",
    "spaceName": "MySpace",
    "groupId": "employeerostering",
    "version": "1.0.0-SNAPSHOT",
    "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill.",
    "publicURIs": [
      {
        "protocol": "git",
        "uri": "git://localhost:9418/MySpace/example-Employee_Rostering"
      },
      {
        "protocol": "ssh",
        "uri": "ssh://localhost:8001/MySpace/example-Employee_Rostering"
      }
    ]
  },
  {
    "name": "Evaluation_Process",
    "spaceName": "MySpace",
    "groupId": "evaluation",
    "version": "1.0.0-SNAPSHOT",
    "description": "Getting started Business Process for evaluating employees",
    "publicURIs": [
      {
        "protocol": "git",
        "uri": "git://localhost:9418/MySpace/example-Evaluation_Process"
      },
      {
        "protocol": "ssh",
        "uri": "ssh://localhost:8001/MySpace/example-Evaluation_Process"
      }
    ]
  },
  {
    "name": "IT_Orders",
    "spaceName": "MySpace",
    "groupId": "itorders",
    "version": "1.0.0-SNAPSHOT",
    "description": "Case Management IT Orders project",
    "publicURIs": [
      {
        "protocol": "git",
        "uri": "git://localhost:9418/MySpace/example-IT_Orders"
      },
      {
        "protocol": "ssh",
        "uri": "ssh://localhost:8001/MySpace/example-IT_Orders"
      }
    ]
  }
]</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[GET] / spaces / {spaceName} / projects / {projectName}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>返回有关指定空间中指定项目的信息。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表68。请求参数</caption>
<colgroup>
<col style="width:25%">
<col style="width:45%">
<col style="width:15%">
<col style="width:15%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">项目所在空间的名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>projectName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要检索的项目名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "Employee_Rostering",
  "spaceName": "MySpace",
  "groupId": "employeerostering",
  "version": "1.0.0-SNAPSHOT",
  "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill.",
  "publicURIs": [
    {
      "protocol": "git",
      "uri": "git://localhost:9418/MySpace/example-Employee_Rostering"
    },
    {
      "protocol": "ssh",
      "uri": "ssh://localhost:8001/MySpace/example-Employee_Rostering"
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[POST] / spaces / {spaceName} / projects</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>在指定的空间中创建一个项目。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表69。请求参数</caption>
<colgroup>
<col style="width:25%">
<col style="width:45%">
<col style="width:15%">
<col style="width:15%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将在其中创建新项目的空间的名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>身体</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">的<code>name</code> ， <code>groupId</code> ， <code>version</code> ， <code>description</code>以及新项目的任何其他组件</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要求正文</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">示例请求正文（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "Employee_Rostering",
  "groupId": "employeerostering",
  "version": "1.0.0-SNAPSHOT",
  "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill."
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541017411591-6",
  "status": "APPROVED",
  "spaceName": "MySpace",
  "projectName": "Employee_Rostering",
  "projectGroupId": "employeerostering",
  "projectVersion": "1.0.0-SNAPSHOT",
  "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill."
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[删除] / spaces / {spaceName} / projects / {projectName}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>从指定的空间删除指定的项目。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表70。请求参数</caption>
<colgroup>
<col style="width:25%">
<col style="width:45%">
<col style="width:15%">
<col style="width:15%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">项目所在空间的名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>projectName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除的项目名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541128617727-10",
  "status": "APPROVED",
  "projectName": "Employee_Rostering",
  "spaceName": "MySpace"
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[POST] / spaces / {spaceName} / git / clone</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>将项目从指定的Git地址克隆到指定的空间。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表71。请求参数</caption>
<colgroup>
<col style="width:25%">
<col style="width:45%">
<col style="width:15%">
<col style="width:15%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">您要将项目克隆到的空间的名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>身体</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">的<code>name</code> ， <code>description</code>和Git存储库<code>userName</code> ， <code>password</code>和<code>gitURL</code>用于要克隆的项目</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要求正文</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">示例请求正文（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "Employee_Rostering",
  "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill.",
  "userName": "baAdmin",
  "password": "password@1",
  "gitURL": "git://localhost:9418/MySpace/example-Employee_Rostering"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541129488547-13",
  "status": "APPROVED",
  "cloneProjectRequest": {
    "name": "Employee_Rostering",
    "description": "Employee rostering problem optimisation using Planner. Assigns employees to shifts based on their skill.",
    "userName": "baAdmin",
    "password": "password@1",
    "gitURL": "git://localhost:9418/MySpace/example-Employee_Rostering"
  },
  "spaceName": "MySpace2"
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[POST] / spaces / {spaceName} / projects / {projectName} / maven / compile</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>在指定空间（相当于<code>mvn compile</code> ）。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表72。请求参数</caption>
<colgroup>
<col style="width:25%">
<col style="width:45%">
<col style="width:15%">
<col style="width:15%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">项目所在空间的名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>projectName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要编译的项目名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541128617727-10",
  "status": "APPROVED",
  "projectName": "Employee_Rostering",
  "spaceName": "MySpace"
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[POST] / spaces / {spaceName} / projects / {projectName} / maven / test</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>在指定的空间中测试指定的项目（相当于<code>mvn test</code> ）。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表73。请求参数</caption>
<colgroup>
<col style="width:25%">
<col style="width:45%">
<col style="width:15%">
<col style="width:15%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">项目所在空间的名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>projectName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">测试项目名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541132591595-19",
  "status": "APPROVED",
  "projectName": "Employee_Rostering",
  "spaceName": "MySpace"
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[POST] / spaces / {spaceName} / projects / {projectName} / maven / install</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>在指定的空间中安装指定的项目（相当于<code>mvn install</code> ）。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表74。请求参数</caption>
<colgroup>
<col style="width:25%">
<col style="width:45%">
<col style="width:15%">
<col style="width:15%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">项目所在空间的名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>projectName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要安装的项目的名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541132668987-20",
  "status": "APPROVED",
  "projectName": "Employee_Rostering",
  "spaceName": "MySpace"
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[POST] / spaces / {spaceName} / projects / {projectName} / maven / deploy</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>在指定空间中部署指定项目（相当于<code>mvn deploy</code> ）。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表75。请求参数</caption>
<colgroup>
<col style="width:25%">
<col style="width:45%">
<col style="width:15%">
<col style="width:15%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spaceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">项目所在空间的名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>projectName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要部署的项目名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "jobId": "1541132816435-21",
  "status": "APPROVED",
  "projectName": "Employee_Rostering",
  "spaceName": "MySpace"
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="knowledge-store-rest-api-jobs-ref_drl-rules"><a class="anchor" href="#knowledge-store-rest-api-jobs-ref_drl-rules"></a> <a class="link" href="#knowledge-store-rest-api-jobs-ref_drl-rules">17.1.2.3。职位（API请求）</a></h5>
<div class="paragraph">
<p>所有<code>POST</code>和<code>DELETE</code>除了返回的请求详细信息之外，知识存储区REST API中的请求还返回与每个请求关联的作业ID。您可以使用作业ID来查看请求状态或删除已发送的请求。</p>
</div>
<div class="paragraph">
<p>知识库REST API请求或<em>作业</em>可以具有以下状态：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表76。作业状态（API请求状态）</caption>
<colgroup>
<col style="width:25%">
<col style="width:75%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">状态</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ACCEPTED</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>该请求已被接受，正在处理中。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BAD_REQUEST</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>该请求包含不正确的内容，未被接受。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RESOURCE_NOT_EXIST</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>请求的资源（路径）不存在。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DUPLICATE_RESOURCE</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>资源已经存在。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SERVER_ERROR</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>KIE服务器中发生错误。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SUCCESS</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>请求成功完成。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FAIL</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>请求失败。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>APPROVED</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>该请求已被批准。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DENIED</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>该请求被拒绝。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GONE</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>由于以下原因之一，找不到请求的作业ID：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>该请求已明确删除。</p>
</li>
<li>
<p>该请求已完成，并且已从状态缓存中删除。缓存达到其最大容量后，将从状态缓存中删除请求。</p>
</li>
<li>
<p>该请求不存在。</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Knowledge Store REST API支持以下端点，这些端点用于检索或删除已发送的API请求。知识库REST API的基本URL为<code>http://SERVER:PORT/business-central/rest/</code> 。对于所有请求，所有请求都需要HTTP基本身份验证或基于令牌的身份验证<code>rest-all</code>用户角色。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[GET] / jobs / {jobId}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>返回指定作业的状态（先前发送的API请求）。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表77。请求参数</caption>
<colgroup>
<col style="width:25%">
<col style="width:45%">
<col style="width:15%">
<col style="width:15%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jobId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要检索的作业的ID（例如： <code>1541010216919-1</code> ）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "status": "SUCCESS",
  "jobId": "1541010216919-1",
  "result": null,
  "lastModified": 1541010218352,
  "detailedResult": [
    "level:INFO, path:null, text:Build of module 'Mortgage_Process' (requested by system) completed.\n Build: SUCCESSFUL"
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[删除] / jobs / {jobId}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>删除指定的作业（先前发送的API请求）。如果尚未处理该作业，则此请求将从作业队列中删除该作业。该请求不会取消或停止正在进行的作业。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表78。请求参数</caption>
<colgroup>
<col style="width:25%">
<col style="width:45%">
<col style="width:15%">
<col style="width:15%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jobId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除的作业的ID（例如： <code>1541010216919-1</code> ）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "status": "GONE",
  "jobId": "1541010216919-1",
  "result": null,
  "lastModified": 1541132054916,
  "detailedResult": [
    "level:INFO, path:null, text:Build of module 'Mortgage_Process' (requested by system) completed.\n Build: SUCCESSFUL"
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_embedded_drools_controller_calls"><a class="anchor" href="#_embedded_drools_controller_calls"></a> <a class="link" href="#_embedded_drools_controller_calls">17.2。嵌入式Drools控制器调用</a></h3>
<div class="paragraph">
<p>当以嵌入式Drools控制器模式运行Business Central时，还提供了一系列与管理KIE Server模板，实例和容器的所有方面有关的端点。有关更多详细信息，请参阅<a href="#controller-rest-api-con_kie-apis">Drools控制器REST API</a> 。 <a href="#controller-java-api-con_kie-apis">Java客户端API</a>也可用于与这些端点进行交互。</p>
</div>
</div>
<div class="sect2">
<h3 id="_kie.keycloakssointegration"><a class="anchor" href="#_kie.keycloakssointegration"></a> <a class="link" href="#_kie.keycloakssointegration">17.3。Keycloak SSO集成</a></h3>
<div class="paragraph">
<p>单一登录（SSO）和相关令牌交换机制正在成为Web上不同环境中进行身份验证和授权的最常见方案，尤其是在迁移到云中时。</p>
</div>
<div class="paragraph">
<p>本节讨论Keycloak与jBPM或Drools应用程序的集成，以便使用Keycloak上提供的所有功能。Keycloak是用于浏览器应用程序和RESTful Web服务的集成SSO和IDM。在<a href="http://keycloak.jboss.org/">Keycloak的主页上</a>进一步了解它。</p>
</div>
<div class="paragraph">
<p>与Keycloak集成的结果具有许多优势，例如：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>为包括Business Central在内的不同客户提供集成的SSO和IDM环境</p>
</li>
<li>
<p>社交登录-使用您的Facebook，Google，LinkedIn等帐户</p>
</li>
<li>
<p>用户会话管理</p>
</li>
<li>
<p>还有更多...</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>下一节将介绍Keycloak的以下集成点：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>通过Keycloak服务器进行Business Central身份验证</strong></p>
<div class="paragraph">
<p>它基本上包括通过Keycloak SSO保护Web客户端和远程服务客户端的安全。因此，Web界面或远程服务使用者（无论是用户还是服务）都将通过KC进行身份验证。</p>
</div>
</li>
<li>
<p><strong>通过Keycloak服务器进行执行服务器身份验证</strong></p>
<div class="paragraph">
<p>包括保护执行服务器提供的远程服务（因为它不提供Web界面）。任何远程服务使用者（无论是用户还是服务）都将通过KC进行身份验证。</p>
</div>
</li>
<li>
<p><strong>消费远程服务</strong></p>
<div class="paragraph">
<p>本节介绍第三方客户端如何使用由Business Central和Execution Server提供的远程服务终结点，例如REST API或远程文件系统服务。</p>
</div>
</li>
<li>
<p><strong>Keycloak和Business Central的安全管理区域</strong></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_scenario"><a class="anchor" href="#_scenario"></a> <a class="link" href="#_scenario">17.3.1。情境</a></h4>
<div class="paragraph">
<p>考虑以下图表作为本文档示例的环境：</p>
</div>
<div class="paragraph">
<p>Keycloak是一个独立的过程，提供远程身份验证，授权和管理服务，这些服务可能会被一个或多个jBPM应用程序通过网络使用。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/KeycloakSSOIntegration/KeyCloak_sso_scenario.png" alt="KeyCloak SSO方案">
</div>
</div>
<div class="paragraph">
<p>考虑以下用于构建此环境的主要步骤：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>安装和设置Keycloak服务器</p>
</li>
<li>
<p>为此示例创建和设置领域-配置领域的客户端，用户和角色</p>
</li>
<li>
<p>安装并设置SSO客户端适配器和jBPM应用程序</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>注意：结果环境和本文档的不同配置均基于Business Central。</p>
</div>
</div>
<div class="sect3">
<h4 id="_install_and_set_up_a_keycloak_server"><a class="anchor" href="#_install_and_set_up_a_keycloak_server"></a> <a class="link" href="#_install_and_set_up_a_keycloak_server">17.3.2。安装和设置Keycloak服务器</a></h4>
<div class="paragraph">
<p>Keycloak提供了广泛的文档以及有关在不同环境中进行安装的几篇文章。本节描述了用于构建示例的集成环境的最小设置。如果需要更多信息，请参考<a href="http://www.keycloak.org/documentation.html">Keycloak文档</a> 。</p>
</div>
<div class="paragraph">
<p>以下是最小化Keycloak安装和设置的步骤：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>从<a href="http://www.keycloak.org/downloads.html">下载</a>部分下载最新版本的Keycloak。本示例基于Keycloak 1.9.0。最后</p>
</li>
<li>
<p>将下载的Keycloak发行版解压缩到一个文件夹中，我们将其称为</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$KC_HOME</code></pre>
</div>
</div>
</li>
<li>
<p>运行KC服务器-此示例基于在同一主机上同时运行Keycloak和jBPM。为了避免端口冲突，可以将Keycloak服务器的端口偏移量用作：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$KC_HOME/bin/standalone.sh -Djboss.socket.binding.port-offset=100</code></pre>
</div>
</div>
</li>
<li>
<p>通过导航到<a href="http://localhost:8180/auth/" class="bare">http：// localhost：8180 / auth /</a>创建Keycloak的管理“ admin”用户</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Keycloak管理控制台可从<a href="http://localhost:8180/auth/admin/" class="bare">http：// localhost：8180 / auth / admin /获得</a> 。</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_and_set_up_the_demo_realm"><a class="anchor" href="#_create_and_set_up_the_demo_realm"></a> <a class="link" href="#_create_and_set_up_the_demo_realm">17.3.3。创建并设置演示领域</a></h4>
<div class="paragraph">
<p>安全领域用于限制对不同应用程序资源的访问。</p>
</div>
<div class="paragraph">
<p>Keycloak服务器运行之后，下一步就是创建领域。该领域将为jBPM应用程序提供不同的用户，角色，会话等。</p>
</div>
<div class="paragraph">
<p>Keycloak提供了几个领域创建和管理的<a href="https://github.com/keycloak/keycloak/tree/master/examples">示例</a> ，从<a href="https://github.com/keycloak/keycloak/tree/master/examples">官方示例</a>到带有更多示例的不同文章。</p>
</div>
<div class="paragraph">
<p>请按照以下步骤操作，以创建本文档稍后使用的<em>演示</em>领域：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>转到Keycloak <a href="http://localhost:8180/auth/admin">管理控制台</a> ，然后单击“ <em>添加领域”</em>按钮。给它命名为<em>demo</em> 。</p>
</li>
<li>
<p>转到“客户端”部分（从管理控制台主菜单），然后为<em>演示</em>领域创建一个新客户端：</p>
<div class="ulist">
<ul>
<li>
<p>客户编号： <em>kie</em></p>
</li>
<li>
<p>客户端协议： <em>openid-connect</em></p>
</li>
<li>
<p>帐户类型： <em>机密</em></p>
</li>
<li>
<p>根URL： <em><a href="http://localhost:8080" class="bare">http：// localhost：8080</a></em></p>
</li>
<li>
<p>基本网址： <em>/ business-central-xyz最后</em></p>
</li>
<li>
<p>重定向URI： <em>/ business-central-xyz最后/*</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>生成的<em>kie</em>客户端设置屏幕：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/KeycloakSSOIntegration/kie_client_settings.png" alt="kie客户端设置">
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如您在上述设置中看到的，它被认为是值<em>business-central-xyz应用程序上下文路径的最终</em>值。如果您的jBPM应用程序将部署在其他上下文路径，主机或端口上，请仅在此处使用您的具体设置。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>能够从Business Central使用<em>演示</em>领域的最后一步是创建应用程序的用户和角色：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>转到“角色”部分并创建角色<em>admin</em> ， <em>kiemgmt</em>和<em>rest-all</em></p>
</li>
<li>
<p>转到“用户”部分并创建<em>管理员</em>用户。在“凭据”选项卡中使用值<em>password</em>设置密码，然后取消设置临时开关。</p>
</li>
<li>
<p>在“用户”部分中，导航到“ <em>角色映射”</em>选项卡，然后将<em>admin</em> ， <em>kiemgmt</em>和<em>rest-all</em>角色分配给<em>admin</em>用户</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/KeycloakSSOIntegration/admin_user_roles.png" alt="管理员用户角色">
</div>
</div>
<div class="paragraph">
<p>此时，Keycloak服务器正在主机上运行，并使用最小配置集进行设置。让我们转到Business Central设置。</p>
</div>
</div>
<div class="sect3">
<h4 id="_install_and_set_up_business_central"><a class="anchor" href="#_install_and_set_up_business_central"></a> <a class="link" href="#_install_and_set_up_business_central">17.3.4。安装和设置Business Central</a></h4>
<div class="paragraph">
<p>对于本教程，让我们使用Wildfly作为Business Central的应用程序服务器，就像jBPM安装程序在默认情况下所做的那样。</p>
</div>
<div class="paragraph">
<p>让我们假设，在运行jBPM安装程序之后，将<em>$ JBPM_HOME</em>作为已部署应用程序的Wildfly服务器的根路径。</p>
</div>
<div class="sect4">
<h5 id="_install_the_kc_adapter"><a class="anchor" href="#_install_the_kc_adapter"></a> <a class="link" href="#_install_the_kc_adapter">17.3.4.1。安装KC适配器</a></h5>
<div class="paragraph">
<p>为了使用jBPM应用程序中的<a href="http://www.keycloak.org/docs/latest/securing_apps/#jboss-eap-wildfly-adapter">Keycloak</a>身份验证和授权模块，必须在<em>$ JBPM_HOME</em>的服务器上安装<a href="http://www.keycloak.org/docs/latest/securing_apps/#jboss-eap-wildfly-adapter">Keycloak JBoss EAP / Wildfly适配器</a> 。 Keycloak为不同的容器提供了多个开箱即用的适配器，如果您正在使用另一个容器或需要使用另一个适配器，请查看Keycloak文档中的“ <a href="http://www.keycloak.org/docs/latest/securing_apps/index.html">保护应用程序”部分</a> 。以下是安装和设置Wildfly 11/10/9适配器的步骤：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>从<a href="https://downloads.jboss.org/keycloak/3.4.3.Final/adapters/keycloak-oidc/keycloak-wildfly-adapter-dist-3.4.3.Final.zip">适用于Wildfly 11/10/9的Keycloak客户端适配器</a>下载适配器</p>
</li>
<li>
<p>在您的外壳上执行以下命令：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>cd $JBPM_HOME
unzip keycloak-wildfly-adapter-dist-3.4.3.Final.zip // Install the KC client adapter

cd $JBPM_HOME/bin
./standalone.sh -c standalone-full.xml // set up the KC client adapter.

// ** Once server is up, open a new command line terminal and run:
cd $JBPM_HOME/bin
./jboss-cli.sh -c --file=adapter-install.cli</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_configure_the_kc_adapter"><a class="anchor" href="#_configure_the_kc_adapter"></a> <a class="link" href="#_configure_the_kc_adapter">17.3.4.2。配置KC适配器</a></h5>
<div class="paragraph">
<p>将KC适配器安装到Wildfly中之后，下一步就是配置适配器，以指定不同的设置，例如身份验证服务器的位置，要使用的领域等。</p>
</div>
<div class="paragraph">
<p>Keycloak提供了两种配置适配器的方式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>每个WAR配置</p>
</li>
<li>
<p>通过Keycloak子系统</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在此示例中，让我们使用第二个选项，使用Keycloak子系统，因此我们的WAR不受这种设置的影响。如果您想使用per WAR方法，请查看<a href="http://www.keycloak.org/docs/latest/securing_apps/index.html#jboss-eap-wildfly-adapter">所需的Per WAR配置</a> 。</p>
</div>
<div class="paragraph">
<p>编辑配置文件<em>$ JBPM_HOME / standalone / configuration / standalone-full.xml</em>并找到子系统配置部分。添加以下内容：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:keycloak:1.1"&gt;
  &lt;secure-deployment name="business-central-x.y.z.Final.war"&gt;
    &lt;realm&gt;demo&lt;/realm&gt;
    &lt;realm-public-key&gt;MIIBIjANBgkqhkiG9w0BAQEFAAOCA...&lt;/realm-public-key&gt;
    &lt;auth-server-url&gt;http://localhost:8180/auth&lt;/auth-server-url&gt;
    &lt;ssl-required&gt;external&lt;/ssl-required&gt;
    &lt;resource&gt;kie&lt;/resource&gt;
    &lt;enable-basic-auth&gt;true&lt;/enable-basic-auth&gt;
    &lt;credential name="secret"&gt;925f9190-a7c1-4cfd-8a3c-004f9c73dae6&lt;/credential&gt;
    &lt;principal-attribute&gt;preferred_username&lt;/principal-attribute&gt;
  &lt;/secure-deployment&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您已在<em>步骤2中</em>从此文档中导入了示例json文件，则可以通过使用具体的部署名称来使用与上述相同的配置。否则，请使用您的值进行以下配置：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>安全部署的名称</em> -使用具体应用程序的WAR文件名</p>
</li>
<li>
<p><em>领域</em> -应用程序将使用的领域，在我们的示例中， <em>演示</em>领域是上一步创建的。</p>
</li>
<li>
<p><em>领域公钥</em> -在此处提供<em>演示</em>领域的公钥。它不是强制性的，如果未指定，将从服务器中检索它。否则，您可以在Keycloak管理控制台→领域设置（用于<em>演示</em>领域）→密钥中找到它</p>
</li>
<li>
<p><em>身份验证服务器URL</em> -Keycloak的身份验证服务器的URL</p>
</li>
<li>
<p><em>资源</em> -在步骤2中创建的客户端的名称。在我们的示例中，使用值<em>kie</em> 。</p>
</li>
<li>
<p><em>启用基本身份验证</em> -在此示例中，我们还启用基本身份验证机制，因此客户端可以同时使用令牌（承载）和基本方法来执行请求。</p>
</li>
<li>
<p><em>凭据</em> -使用<em>kie</em>客户端的密码值。您可以在Keycloak管理控制台→客户端→kie→凭据选项卡→复制<em>机密</em>的值中找到它。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>对于此示例，您必须注意将您的具体值用于<em>安全部署</em>名称， <em>realm-public-key</em>和<em>凭据</em>密码。</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">
<div class="paragraph">
<p>确保在Widfly / EAP配置文件的配置文件中不存在以下标记（例如：standalone.xml）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;single-sign-on/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在某些服务器版本中，默认情况下启用此功能。如果存在，则必须将其删除/禁用，以使Keycloak能够正确处理客户端。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_run_the_environment"><a class="anchor" href="#_run_the_environment"></a> <a class="link" href="#_run_the_environment">17.3.4.3。运行环境</a></h5>
<div class="paragraph">
<p>此时，Keycloak服务器已在主机上启动并运行，并且已为jBPM应用程序服务器安装并配置了KC适配器。您可以使用以下命令运行该应用程序：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$JBPM_HOME/bin/standalone.sh -c standalone-full.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>服务器启动后，您可以导航到该应用程序：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code> http://localhost:8080/business-central-x.y.z.Final</code></pre>
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/KeycloakSSOIntegration/jbpm_login_screen.png" alt="jbpm登录屏幕">
</div>
</div>
<div class="paragraph">
<p>使用Keycloak的管理员用户凭据登录： <em>admin / password</em> 。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_securing_business_central_remote_services_via_keycloak"><a class="anchor" href="#_securing_business_central_remote_services_via_keycloak"></a> <a class="link" href="#_securing_business_central_remote_services_via_keycloak">17.3.5。通过Keycloak保护Business Central远程服务</a></h4>
<div class="paragraph">
<p>Business Central提供了不同的远程服务终结点，第三方客户端可以使用<a href="#knowledge-store-rest-api-con_kie-apis">Knowledge Store REST API</a>来使用这些终结点。</p>
</div>
<div class="paragraph">
<p>为了通过Keycloak对那些服务进行身份验证，请对jBPM的WAR文件中的<em>WEB-INF / web.xml</em>文件（应用程序部署描述符）进行那些修改：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>将远程服务URL模式限制为：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;security-constraint&gt;
  &lt;web-resource-collection&gt;
    &lt;web-resource-name&gt;remote-services&lt;/web-resource-name&gt;
    &lt;url-pattern&gt;/rest/*&lt;/url-pattern&gt;
    &lt;url-pattern&gt;/maven2/*&lt;/url-pattern&gt;
    &lt;url-pattern&gt;/ws/*&lt;/url-pattern&gt;
  &lt;/web-resource-collection&gt;
  &lt;auth-constraint&gt;
    &lt;role-name&gt;rest-all&lt;/role-name&gt;
  &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">
<div class="paragraph">
<p>使用远程服务的用户必须是角色<em>rest-all的</em>成员。如前面的步骤所述，该示例中的<em>admin</em>用户已经是<em>rest-all</em>角色的成员。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_securing_business_centrals_file_system_services_via_keycloak"><a class="anchor" href="#_securing_business_centrals_file_system_services_via_keycloak"></a> <a class="link" href="#_securing_business_centrals_file_system_services_via_keycloak">17.3.6。通过Keycloak保护Business Central的文件系统服务</a></h4>
<div class="paragraph">
<p>为了使用其他远程服务，例如文件系统服务（例如，远程GIT）， <strong>必须</strong>在<em>$ JBPM_HOME / standalone / configuration / standalone-full.xml</em>文件<em>中将</em>特定的<strong>Keycloak登录模块用于</strong>应用程序的安全域。默认情况下，Business Central使用<em>其他</em>安全域，因此<em>$ JBPM_HOME / standalone / configuration / standalone-full.xml</em>上的最终配置应如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;security-domain name="other" cache-type="default"&gt;
    &lt;authentication&gt;
        &lt;login-module code="org.keycloak.adapters.jaas.DirectAccessGrantsLoginModule" flag="required"&gt;
            &lt;!-- Parameter value can be a file system absolute path or a classpath (e.g. "classpath:/some-path/kie-git.json")--&gt;
            &lt;module-option name="keycloak-config-file" value="$JBPM_HOME/kie-git.json"/&gt;
        &lt;/login-module&gt;
    &lt;/authentication&gt;
&lt;/security-domain&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>$ JBPM_HOME / standalone / configuration / standalone-full.xml</em>文件中<em>另一个</em>安全域上的登录模块必须由上述给定的替换。</p>
</li>
<li>
<p>将<em>$ JBPM_HOME / kie-git.json</em>替换<em>为</em>用于远程服务客户端的json配置文件的路径（在文件系统上）或classpath（例如， <em>classpath：/some-path/kie-git.json</em> ）。请继续阅读以创建此Keycloak客户端以及如何获取此json文件。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>此时，使用上述json配置文件中指定的客户端的Keycloak保护使用JAAS进行身份验证过程的远程服务（例如文件系统服务（例如GIT））。因此，让我们在Keycloak上创建此客户端并生成所需的JSON文件：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>导航到<a href="http://localhost:8180/auth/admin">KC管理控制台，</a>并使用<em>kie-git</em>作为名称为<em>演示</em>领域创建一个新客户端。</p>
</li>
<li>
<p>启用<em>直接访问授权已启用</em>选项</p>
</li>
<li>
<p>禁用<em>“启用标准流”</em>选项</p>
</li>
<li>
<p>为此客户端使用<em>机密</em>访问类型。参见下图示例：</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/KeycloakSSOIntegration/kie_git_client_settings.png" alt="kie git客户端设置">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>转到同一<em>kie-git</em>客户端配置屏幕中的“ <em>安装”</em>选项卡，然后使用<em>Keycloak OIDC JSON</em>类型导出。</p>
</li>
<li>
<p>最后，将此生成的JSON文件复制到服务器文件系统上的可访问目录中，或将其添加到应用程序的类路径中。使用此路径值作为<em>org.keycloak.adapters.jaas</em>的上述配置的<em>keycloak-config-file</em>参数<em>。DirectAccessGrantsLoginModule</em>登录模块。</p>
</li>
<li>
<p>有关Keycloak JAAS登录模块的更多信息，请参见<a href="http://www.keycloak.org/docs/latest/securing_apps/index.html#_jaas_adapter">Keycloak JAAS插件</a> 。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在这一点上，可以通过Keycloak服务器认证的所有用户克隆内部Git存储库：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># Command example:
git clone ssh://admin@localhost:8001/system</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_execution_server"><a class="anchor" href="#_execution_server"></a> <a class="link" href="#_execution_server">17.3.7。执行服务器</a></h4>
<div class="paragraph">
<p>KIE Execution Server提供了一个<a href="#kie-server-rest-api-con_kie-apis">REST API</a> ，任何第三方客户端都可以使用。本节介绍如何将KIE Execution Server与Keycloak SSO集成在一起，以便将第三方客户端身份管理委派给SSO服务器。</p>
</div>
<div class="paragraph">
<p>考虑到以上环境正在运行，因此请考虑具有以下条件：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在<a href="http://localhost:8180/auth" class="bare">http：// localhost：8180 / auth</a>上运行并侦听的Keycloak服务器</p>
</li>
<li>
<p>一个名为<em>demo</em>的领域，其中一个名为<em>kie</em> for Business Central的客户端</p>
</li>
<li>
<p>在<a href="http://localhost:8080/business-central-x.y.z.Final" class="bare">http：// localhost：8080 / business-central-xyzFinal</a>运行的Business Central</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请按照以下步骤将执行服务器添加到此环境中：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在Keycloak上为执行服务器创建客户端</p>
</li>
<li>
<p>安装设置和执行服务器（带有KC客户端适配器）</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_create_the_execution_servers_client_on_keycloak"><a class="anchor" href="#_create_the_execution_servers_client_on_keycloak"></a> <a class="link" href="#_create_the_execution_servers_client_on_keycloak">17.3.7.1。在Keycloak上创建执行服务器的客户端</a></h5>
<div class="paragraph">
<p>根据将要部署的每个执行服务器，您必须在Keycloak的<em>演示</em>领域中创建一个新客户端：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>转到<a href="http://localhost:8180/auth/admin">KC管理控制台</a> →客户端→新客户端</p>
</li>
<li>
<p>名称： <em>kie-execution-server</em></p>
</li>
<li>
<p>根URL： <em><a href="http://localhost:8280/" class="bare">http：// localhost：8280 /</a></em></p>
</li>
<li>
<p>客户端协议： <em>openid-connect</em></p>
</li>
<li>
<p>访问类型： <em>机密</em> （如果需要，可以是<em>公开的</em> ，但在生产环境中不建议使用）</p>
</li>
<li>
<p>有效的重定向URI： <em>/ kie-server-xyz最后/*</em></p>
</li>
<li>
<p>基本网址： <em>/ kie-server-xyz最后</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在此示例中，先前步骤中已经创建的<em>管理员</em>用户是用于客户端请求的<em>管理员</em>用户。因此，请确保<em>管理员</em>用户是角色<em>kie-server的</em>成员，以便使用执行服务器的远程服务。如果角色不存在，请创建它。</p>
</div>
<div class="paragraph">
<p>注意：此示例认为执行服务器将配置为使用200端口偏移量运行，因此HTTP端口可在localhost：8280处使用。</p>
</div>
</div>
<div class="sect4">
<h5 id="_install_and_set_up_the_kc_adapter_on_the_execution_server"><a class="anchor" href="#_install_and_set_up_the_kc_adapter_on_the_execution_server"></a> <a class="link" href="#_install_and_set_up_the_kc_adapter_on_the_execution_server">17.3.7.2。在执行服务器上安装和设置KC适配器</a></h5>
<div class="paragraph">
<p>此时，一个名为<em>kie-execution-server</em>的客户端已准备就绪，可以在KC服务器上从执行服务器上使用。</p>
</div>
<div class="paragraph">
<p>让我们安装，设置和部署执行服务器：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>安装另一个Wildfly服务器以用于执行服务器和KC客户端适配器。您可以按照上述有关Business Central的说明进行操作，也可以按照<a href="http://www.keycloak.org/docs/latest/securing_apps/index.html">安全应用程序指南进行操作</a></p>
</li>
<li>
<p>从Wildfly服务器的配置路径中编辑<em>standalone-full.xml</em>文件，并将KC子系统适配器配置为：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;secure-deployment name="kie-server-x.y.z.Final.war"&gt;
    &lt;realm&gt;demo&lt;/realm&gt;
    &lt;realm-public-key&gt;MIGfMA0GCSqGSIb...&lt;/realm-public-key&gt;
    &lt;auth-server-url&gt;http://localhost:8180/auth&lt;/auth-server-url&gt;
    &lt;ssl-required&gt;external&lt;/ssl-required&gt;
    &lt;resource&gt;kie-execution-server&lt;/resource&gt;
    &lt;enable-basic-auth&gt;true&lt;/enable-basic-auth&gt;
    &lt;credential name="secret"&gt;e92ec68d-6177-4239-be05-28ef2f3460ff&lt;/credential&gt;
    &lt;principal-attribute&gt;preferred_username&lt;/principal-attribute&gt;
&lt;/secure-deployment&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果与本示例不同，请考虑您的具体环境设置：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>安全部署名称→使用要部署的执行服务器war文件的名称</p>
</li>
<li>
<p>公钥→使用演示领域公钥或将其保留为空白，如果是这样，服务器将提供一个</p>
</li>
<li>
<p>资源→这次，而不是使用Business Central配置中使用的<em>kie</em>客户端，而是使用<em>kie-execution-server</em>客户端</p>
</li>
<li>
<p>启用基本身份验证→由您决定。您可以为第三方服务使用者启用基本身份验证</p>
</li>
<li>
<p>凭据→将密钥用于<em>kie-execution-server</em>客户端。您可以在KC管理控制台的“ <em>凭据”</em>标签中找到它</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_deploy_and_run_the_execution_server"><a class="anchor" href="#_deploy_and_run_the_execution_server"></a> <a class="link" href="#_deploy_and_run_the_execution_server">17.3.7.3。部署并运行执行服务器</a></h5>
<div class="paragraph">
<p>只需使用任何可用机制在Wildfly中部署执行服务器即可。使用以下命令运行执行服务器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$EXEC_SERVER_HOME/bin/standalone.sh -c standalone-full.xml -Djboss.socket.binding.port-offset=200 -Dorg.kie.server.id=&lt;ID&gt; -Dorg.kie.server.user=&lt;USER&gt; -Dorg.kie.server.pwd=&lt;PWD&gt; -Dorg.kie.server.location=&lt;LOCATION_URL&gt;  -Dorg.kie.server.controller=&lt;CONTROLLER_URL&gt; -Dorg.kie.server.controller.user=&lt;CONTROLLER_USER&gt; -Dorg.kie.server.controller.pwd=&lt;CONTOLLER_PASSWORD&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$EXEC_SERVER_HOME/bin/standalone.sh -c standalone-full.xml -Djboss.socket.binding.port-offset=200 -Dorg.kie.server.id=kieserver1 -Dorg.kie.server.user=admin -Dorg.kie.server.pwd=password -Dorg.kie.server.location=http://localhost:8280/kie-server-x.y.z.Final/services/rest/server -Dorg.kie.server.controller=http://localhost:8080/business-central-x.y.z.Final/rest/controller -Dorg.kie.server.controller.user=admin -Dorg.kie.server.controller.pwd=password</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">
<div class="paragraph">
<p>将使用执行服务器远程服务端点的用户必须分配角色<em>kie-server</em> 。因此，在KC管理控制台中为将使用执行服务器远程服务的用户创建并分配此角色。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>一旦启动，您可以将服务器状态检查为（针对该请求考虑使用基本身份验证，请参阅下一个使用<a href="#consumingRemoteServices">远程服务</a>以获取更多信息）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl http://admin:password@localhost:8280/kie-server-x.y.z.Final/services/rest/server/</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="consumingRemoteServices"><a class="anchor" href="#consumingRemoteServices"></a> <a class="link" href="#consumingRemoteServices">17.3.8。消费远程服务</a></h4>
<div class="paragraph">
<p>为了使用Business Central或Execution Server提供的不同远程服务，您的客户端必须在KC服务器上进行身份验证，并且必须具有有效的令牌才能执行请求。</p>
</div>
<div class="paragraph">
<p>请记住，为了使用远程服务，经过身份验证的用户必须已分配：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用Business Central远程服务<em>的所有</em>角色</p>
</li>
<li>
<p>角色<em>kie-server，</em>用于使用Execution Server远程服务</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请确保创建了必要的角色并将其分配给将在Keycloak管理控制台上使用远程服务的用户。</p>
</div>
<div class="paragraph">
<p>您有两个选择可以使用不同的删除服务端点：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果应用程序的客户端支持基本身份验证，则使用它</p>
</li>
<li>
<p>使用基于承载（令牌）的身份验证</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_using_basic_authentication"><a class="anchor" href="#_using_basic_authentication"></a> <a class="link" href="#_using_basic_authentication">17.3.8.1。使用基本身份验证</a></h5>
<div class="paragraph">
<p>如果KC客户端适配器配置启用了基本身份验证，如本指南中针对Business Central（ <em>步骤3.2</em> ）和Execution Server所建议的那样，则可以避免令牌授予/刷新调用，而只需调用服务即可，如以下示例所示。</p>
</div>
<div class="paragraph">
<p>Business Central远程存储库端点的示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl http://admin:password@localhost:8080/business-central-x.y.z.Final/rest/repositories</code></pre>
</div>
</div>
<div class="paragraph">
<p>检查执行服务器状态的示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl http://admin:password@localhost:8280/kie-server-x.y.z.Final/services/rest/server/</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="usingTokenBasedAuthentication"><a class="anchor" href="#usingTokenBasedAuthentication"></a> <a class="link" href="#usingTokenBasedAuthentication">17.3.8.2。使用基于令牌的身份验证</a></h5>
<div class="paragraph">
<p>第一步是在Keycloak上创建一个新客户端，该客户端允许第三方远程服务客户端获取令牌。可以通过以下方式完成：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>转到KC管理控制台，然后使用以下配置创建<em>新客户端</em> ：</p>
<div class="ulist">
<ul>
<li>
<p>客户编号： <em>kie-remote</em></p>
</li>
<li>
<p>客户端协议： <em>openid-connect</em></p>
</li>
<li>
<p>访问类型： <em>公共</em></p>
</li>
<li>
<p>有效的重定向URI： <em><a href="http://localhost/" class="bare">http：// localhost /</a></em></p>
</li>
</ul>
</div>
</li>
<li>
<p>当我们要手动获取令牌并调用服务时，让我们稍微延长令牌的寿命。在生产访问令牌中，令牌应具有相对较低的超时，最好少于5分钟：</p>
<div class="ulist">
<ul>
<li>
<p>转到KC管理控制台</p>
</li>
<li>
<p>单击您的领域设置</p>
</li>
<li>
<p>单击令牌选项卡</p>
</li>
<li>
<p>将“访问令牌寿命”的值更改为15分钟。那应该给我们足够的时间来获取令牌并在服务到期之前调用服务。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>一旦为我们的远程客户端创建了公共客户端，您现在就可以通过对KC服务器的令牌端点执行HTTP请求来获取令牌。这是命令行示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>RESULT=`curl --data "grant_type=password&amp;client_id=kie-remote&amp;username=admin&amp;passwordpassword=&lt;the_client_secret&gt;" http://localhost:8180/auth/realms/demo/protocol/openid-connect/token`</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>TOKEN=`echo $RESULT | sed 's/.*access_token":"//g' | sed 's/".*//g'`</code></pre>
</div>
</div>
<div class="paragraph">
<p>此时，如果您回显<em>$ TOKEN</em> ，它将输出从KC服务器获得的令牌字符串，该令牌字符串现在可用于授权对远程端点的进一步调用。例如，如果要检查内部jBPM存储库：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -H "Authorization: bearer $TOKEN" http://localhost:8080/business-central-x.y.z.Final/rest/repositories</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_keycloak_and_the_business_centrals_security_administration_area"><a class="anchor" href="#_keycloak_and_the_business_centrals_security_administration_area"></a> <a class="link" href="#_keycloak_and_the_business_centrals_security_administration_area">17.3.9。Keycloak和Business Central的安全管理区域</a></h4>
<div class="paragraph">
<p>Business Central提供了一个管理区域，该区域提供了用户，组和角色管理功能（请参阅<a href="#_wb.userandgroupmgmt">安全性管理</a> ）。</p>
</div>
<div class="paragraph">
<p>默认情况下，应用程序的安全管理系统指向应用程序的服务器领域。例如，在将打包的发行版用于Wildfly的情况下，它指向Wildfly的ApplicationRealm（基于属性）。这意味着管理区域中显示的领域中的实体不是应用程序正在使用的Keycloak领域中的实体。为了更改此默认行为，存在以下选项：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>禁用用户系统管理</p>
</li>
<li>
<p>使用内置的Keycloak安全管理提供程序代替默认的提供程序</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>为了定制现有的jBPM应用程序（WAR文件）以使用Keycloak安全管理提供程序，将<em>WEB-INF / classes / security-management.properties</em>的内容替换为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>org.uberfire.ext.security.management.api.userManagementServices=KCAdapterUserManagementService
org.uberfire.ext.security.management.keycloak.authServer=&lt;authz_server_url&gt;
# eg: org.uberfire.ext.security.management.keycloak.authServer=http://localhost:8180/auth</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>属性<code>org.uberfire.ext.security.management.api.userManagementServices</code>和<code>org.uberfire.ext.security.management.keycloak.authServer</code>也可以设置为系统属性。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>可以从<a href="https://repository.jboss.org/nexus/">JBoss Nexus</a>下载上述步骤中所需的<em>jar</em>工件，也可以从<a href="https://github.com/kiegroup/appformer">源代码</a>构建。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>一旦应用了以上更改，安全管理区域就会使用用户会话中存在的访问令牌，以授权和管理特定的Keycloak领域数据。</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">
<div class="paragraph">
<p>为了能够远程管理Keycloak领域，请确保用户已分配了<em>领域管理</em>客户端角色</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wb.workbenchhighavailability"><a class="anchor" href="#_wb.workbenchhighavailability"></a> <a class="link" href="#_wb.workbenchhighavailability">18岁商业中心高可用性</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_wb.vfsclustering"><a class="anchor" href="#_wb.vfsclustering"></a> <a class="link" href="#_wb.vfsclustering">18.1。VFS群集</a></h3>
<div class="paragraph">
<p><a href="#_wb.vfsrepository">VFS存储库</a> （通常是git存储库）存储所有资产（例如规则，决策表，流程定义，表单等）。如果该VFS位于每个本地服务器上，则必须在群集的所有服务器之间使其保持同步。</p>
</div>
<div class="paragraph">
<p>使用<a href="http://zookeeper.apache.org/">Apache Zookeeper</a>和<a href="http://helix.incubator.apache.org/">Apache Helix</a>完成此任务。Zookeeper将所有零件粘合在一起。Helix是群集管理组件，用于注册所有群集详细信息（节点，资源和群集本身）。Uberfire（在其基础上构建Business Central）使用这两个组件提供VFS群集。</p>
</div>
<div class="paragraph">
<p>要创建VFS集群：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>下载<a href="http://zookeeper.apache.org/">Apache Zookeeper</a>和<a href="http://helix.incubator.apache.org/">Apache Helix</a> 。</p>
</li>
<li>
<p>同时安装：</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>将Zookeeper解压缩到目录（ <code>$ZOOKEEPER_HOME</code> ）。</p>
</li>
<li>
<p>在<code>$ZOOKEEPER_HOME</code> ，复制<code>zoo_sample.conf</code>至<code>zoo.conf</code></p>
</li>
<li>
<p>编辑<code>zoo.conf</code> 。如果需要，请调整设置。通常只有以下两个属性是相关的：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># the directory where the snapshot is stored.
dataDir=/tmp/zookeeper
# the port at which the clients will connect
clientPort=2181</code></pre>
</div>
</div>
</li>
<li>
<p>将Helix解压缩到目录（ <code>$HELIX_HOME</code> ）。</p>
</li>
</ol>
</div>
</li>
<li>
<p>在Zookeeper中配置集群：</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>转到其<code>bin</code>目录：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ cd $ZOOKEEPER_HOME/bin</code></pre>
</div>
</div>
</li>
<li>
<p>启动Zookeeper服务器：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ sudo ./zkServer.sh start</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果服务器无法启动，请验证<code>dataDir</code> （如<code>zoo.conf</code> ）可访问。</p>
</div>
</li>
<li>
<p>要查看Zookeeper的活动，请打开<code>zookeeper.out</code> ：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ cat $ZOOKEEPER_HOME/bin/zookeeper.out</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>在Helix中配置集群：</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>转到其<code>bin</code>目录：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ cd $HELIX_HOME/bin</code></pre>
</div>
</div>
</li>
<li>
<p>创建集群：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ ./helix-admin.sh --zkSvr localhost:2181 --addCluster kie-cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>zkSvr</code>值必须与使用的Zookeeper服务器匹配。集群名称（ <code>kie-cluster</code> ）可以根据需要进行更改。</p>
</div>
</li>
<li>
<p>将节点添加到集群：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># Node 1
$ ./helix-admin.sh --zkSvr localhost:2181 --addNode kie-cluster nodeOne:12345
# Node 2
$ ./helix-admin.sh --zkSvr localhost:2181 --addNode kie-cluster nodeTwo:12346
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>通常，群集中的节点数a等于群集中的应用程序服务器数。节点名称（ <code>nodeOne:12345</code> ，…）可以根据需要进行更改。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>nodeOne:12345</code>是节点的唯一标识符，稍后将在配置应用程序服务器时引用该标识符。它不是主机和端口号，而是用于唯一标识逻辑节点。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>向集群添加资源：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ ./helix-admin.sh --zkSvr localhost:2181 --addResource kie-cluster vfs-repo 1 LeaderStandby AUTO_REBALANCE</code></pre>
</div>
</div>
<div class="paragraph">
<p>资源名称（ <code>vfs-repo</code> ）可以根据需要进行更改。</p>
</div>
</li>
<li>
<p>重新平衡集群以将其初始化：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ ./helix-admin.sh --zkSvr localhost:2181 --rebalance kie-cluster vfs-repo 2</code></pre>
</div>
</div>
</li>
<li>
<p>启动Helix控制器来管理集群：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$  ./run-helix-controller.sh --zkSvr localhost:2181 --cluster kie-cluster 2&gt;&amp;1 &gt; /tmp/controller.log &amp;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>在应用程序服务器上正确配置安全域。例如在WildFly和JBoss EAP上：</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>编辑档案<code>$JBOSS_HOME/domain/configuration/domain.xml</code> 。</p>
<div class="paragraph">
<p>为了简单起见，假设我们使用使用配置文件的默认域配置<code>full</code>定义两个服务器节点作为<code>main-server-group</code> 。</p>
</div>
</li>
<li>
<p>找到个人资料<code>full</code>并通过复制默认情况下已经在此处定义的其他安全域来添加新的安全域：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;security-domain name="kie-ide" cache-type="default"&gt;
    &lt;authentication&gt;
         &lt;login-module code="Remoting" flag="optional"&gt;
             &lt;module-option name="password-stacking" value="useFirstPass"/&gt;
         &lt;/login-module&gt;
         &lt;login-module code="RealmDirect" flag="required"&gt;
             &lt;module-option name="password-stacking" value="useFirstPass"/&gt;
         &lt;/login-module&gt;
    &lt;/authentication&gt;
&lt;/security-domain&gt;</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">
<div class="paragraph">
<p>安全域名是一个神奇的值。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>在应用程序服务器上为集群配置<a href="#_wb.systemproperties">系统属性</a> 。例如在WildFly和JBoss EAP上：</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>编辑档案<code>$JBOSS_HOME/domain/configuration/host.xml</code> 。</p>
</li>
<li>
<p>找到XML元素<code>server</code>属于<code>main-server-group</code>并添加必要的系统属性。</p>
<div class="paragraph">
<p>例如，nodeOne：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;system-properties&gt;
  &lt;property name="jboss.node.name" value="nodeOne" boot-time="false"/&gt;
  &lt;property name="org.uberfire.nio.git.dir" value="/tmp/kie/nodeone" boot-time="false"/&gt;
  &lt;property name="org.uberfire.metadata.index.dir" value="/tmp/kie/nodeone" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.id" value="kie-cluster" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.zk" value="localhost:2181" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.local.id" value="nodeOne_12345" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.vfs.lock" value="vfs-repo" boot-time="false"/&gt;
  &lt;!-- If you're running both nodes on the same machine: --&gt;
  &lt;property name="org.uberfire.nio.git.daemon.port" value="9418" boot-time="false"/&gt;
&lt;/system-properties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于nodeTwo：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;system-properties&gt;
  &lt;property name="jboss.node.name" value="nodeTwo" boot-time="false"/&gt;
  &lt;property name="org.uberfire.nio.git.dir" value="/tmp/kie/nodetwo" boot-time="false"/&gt;
  &lt;property name="org.uberfire.metadata.index.dir" value="/tmp/kie/nodetwo" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.id" value="kie-cluster" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.zk" value="localhost:2181" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.local.id" value="nodeTwo_12346" boot-time="false"/&gt;
  &lt;property name="org.uberfire.cluster.vfs.lock" value="vfs-repo" boot-time="false"/&gt;
  &lt;!-- If you're running both nodes on the same machine: --&gt;
  &lt;property name="org.uberfire.nio.git.daemon.port" value="9419" boot-time="false"/&gt;
&lt;/system-properties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>确保群集，节点和资源名称与在Helix中配置的名称匹配。</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_jbpm_clustering"><a class="anchor" href="#_jbpm_clustering"></a> <a class="link" href="#_jbpm_clustering">18.2。 jBPM集群</a></h3>
<div class="paragraph">
<p>除上述信息外，jBPM集群还需要其他配置。请参阅<a href="http://mswiderski.blogspot.com.br/2013/06/clustering-in-jbpm-v6.html">此博客文章</a>以正确配置数据库等。</p>
</div>
<h1 id="_kie_server" class="discrete">KIE服务器</h1>
<div class="paragraph">
<p>KIE服务器是用于规则的独立执行服务器。</p>
</div>
</div>
</div>
</div>
<div class="sect1">﻿<div class="sect1">
<h2 id="_ch.kie.server"><a class="anchor" href="#_ch.kie.server"></a> <a class="link" href="#_ch.kie.server">19KIE执行服务器</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview"><a class="anchor" href="#_overview"></a> <a class="link" href="#_overview">19.1。总览</a></h3>
<div class="paragraph">
<p><em>KIE Server</em>是一个模块化的独立服务器组件，可用于实例化和执行规则和流程。它通过REST，JMS和Java接口向客户端应用程序公开此功能。它还提供与<em>Business Central的</em>无缝集成。</p>
</div>
<div class="paragraph">
<p><em>KIE Server的</em>核心是打包为WAR文件的可配置Web应用程序。发行版可用于纯Web容器（例如Tomcat）以及JEE 6和JEE 7容器。</p>
</div>
<div class="paragraph">
<p>Kie Server上的大多数功能都是可扩展的，并且基于扩展的概念。每个扩展都可以独立启用/禁用，从而允许用户根据需要配置服务器。</p>
</div>
<div class="paragraph">
<p>当前版本的Kie Server附带两个默认扩展名：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BRM：为使用Drools引擎执行业务规则提供支持。</p>
</li>
<li>
<p>BPM：为使用jBPM引擎执行业务流程提供支持。它支持：</p>
<div class="ulist">
<ul>
<li>
<p>流程执行</p>
</li>
<li>
<p>任务执行</p>
</li>
<li>
<p>异步作业执行</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>这两个扩展默认都启用，但可以通过设置相应的属性来禁用（有关详细信息，请参见配置章节）。</p>
</div>
<div class="paragraph">
<p>该服务器设计为占用空间小，内存消耗最少，因此易于在云环境中部署。该服务器的每个实例都可以打开和实例化多个<em>Kie容器</em> ，这使您可以并行执行多个服务。</p>
</div>
<div class="sect3">
<h4 id="_glossary"><a class="anchor" href="#_glossary"></a> <a class="link" href="#_glossary">19.1.1。词汇表</a></h4>
<div class="ulist">
<ul>
<li>
<p><strong>Kie Server</strong> ：执行服务器纯粹专注于为规则和流程提供运行时环境。这些功能由<em>Kie Server Extensions提供</em> 。可以通过进一步的扩展来添加更多功能（例如，客户可以在缺少功能的情况下添加自己的扩展，这些功能随后将使用KIE Server的基础结构）。Kie Server实例是在给定的应用程序服务器/ Web容器上执行的独立Kie Server。一个Kie Server实例化并提供对多个Kie Containers的支持。</p>
</li>
<li>
<p><strong>Kie Server Extension</strong> ： <strong>Kie Server</strong>的“插件”，用于向服务器添加功能。Kie Server随附两个默认的kie服务器扩展：BRM和BPM。</p>
</li>
<li>
<p><strong>Kie容器</strong> ：kjar在内存中的实例化，允许实例化和使用其资产（域模型，流程，规则等）。Kie Server通过诸如REST和JMS之类的传输协议通过标准API公开Kie容器。</p>
</li>
<li>
<p><strong>控制器</strong> ：服务器支持的REST端点，将负责管理KIE Server实例。该端点必须提供以下功能：</p>
<div class="ulist">
<ul>
<li>
<p>响应连接请求</p>
</li>
<li>
<p>在相应的<em>Kie Server ID</em>上同步所有已注册的容器</p>
</li>
<li>
<p>响应断开请求</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Kie Server状态</strong> ：给定Kie Server实例的当前已知状态。这是本地存储（默认情况下在文件中），维护以下信息：</p>
<div class="ulist">
<ul>
<li>
<p>已注册Drools控制器列表</p>
</li>
<li>
<p>已知容器列表</p>
</li>
<li>
<p>kie服务器配置</p>
<div class="paragraph">
<p>在receival等事件的服务器状态被持久： <em>纪伊容器</em>中创建， <em>纪伊容器</em>被配置，呓控制器接受<em>纪伊Server</em>实例的登记等</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Kie Server ID</strong> ：一个任意分配的标识符，分配了配置。在启动时，为每个Kie服务器实例分配一个ID，并且该ID与Drools控制器上的配置匹配。Kie服务器实例将获取并使用该配置进行自我设置。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_the_kie_server"><a class="anchor" href="#_installing_the_kie_server"></a> <a class="link" href="#_installing_the_kie_server">19.2。安装KIE服务器</a></h3>
<div class="paragraph">
<p>KIE服务器作为Web应用程序存档（WAR）文件分发。WAR文件采用三种不同的包装：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>webc-</em>像Tomcat这样的普通Web（Servlet）容器的WAR</p>
</li>
<li>
<p><em>ee6</em> -JavaEE 6容器（例如JBoss EAP 6.x）的WAR</p>
</li>
<li>
<p><em>ee7</em> -JavaEE 7容器（例如WildFly 11.x）的WAR</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>要安装KIE Execution Server并验证其正在运行，请完成以下步骤：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>将WAR文件部署到您的Web容器中。</p>
</li>
<li>
<p>创建一个具有以下角色的用户<code>kie-server</code>在容器上。</p>
</li>
<li>
<p>通过浏览到浏览器窗口中的端点来测试您是否可以访问KIE服务器： <code><a href="http://SERVER:PORT/CONTEXT/services/rest/server/" class="bare">http://SERVER:PORT/CONTEXT/services/rest/server/</a></code> 。</p>
</li>
<li>
<p>当提示您输入用户名/密码时，键入您在步骤2中创建的用户名和密码。</p>
</li>
<li>
<p>一旦通过身份验证，您将看到KIE Server状态形式的XML响应，类似于以下内容：</p>
<div class="exampleblock">
<div class="title">例子107。示例握手服务器响应</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;response type="SUCCESS" msg="KIE Server info"&gt;
  &lt;kie-server-info&gt;
    &lt;version&gt;7.30.0.Final&lt;/version&gt;
  &lt;/kie-server-info&gt;
&lt;/response&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_installation_details_for_different_containers"><a class="anchor" href="#_installation_details_for_different_containers"></a> <a class="link" href="#_installation_details_for_different_containers">19.2.1。不同容器的安装详细信息</a></h4>
<div class="sect4">
<h5 id="_tomcat_7_x8_x"><a class="anchor" href="#_tomcat_7_x8_x"></a> <a class="link" href="#_tomcat_7_x8_x">19.2.1.1。Tomcat 7.x / 8.x</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>下载并解压缩Tomcat发行版。我们称其为分布的根<code>TOMCAT_HOME</code> 。该目录以Tomcat版本命名，例如<code>apache-tomcat-7.0.55</code> 。</p>
</li>
<li>
<p>下载<em>kie-server- -webc.war</em>并将其放入<code>TOMCAT_HOME/webapps</code> 。</p>
</li>
<li>
<p>配置用户和角色。确保该文件<code>TOMCAT_HOME/conf/tomcat-users.xml</code>包含以下用户名和角色定义。您当然可以选择其他用户名和密码，只需确保该用户具有角色即可<code>kie-server</code> ：</p>
<div class="exampleblock">
<div class="title">示例108。Tomcat的用户名和角色定义</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;role rolename="kie-server"/&gt;
&lt;user username="serveruser" password="my.s3cr3t.pass" roles="kie-server"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>通过运行启动服务器<code>TOMCAT_HOME/bin/startup.[sh|bat]</code> 。您可以签出Tomcat登录<code>TOMCAT_HOME/logs</code>查看应用程序是否成功部署。请阅读上表，了解可用于正确配置实例的引导程序开关。例如：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>./startup.sh -Dorg.kie.server.id=first-kie-server
             -Dorg.kie.server.location=http://localhost:8080/kie-server/services/rest/server</code></pre>
</div>
</div>
</li>
<li>
<p>验证服务器正在运行。去<code><a href="http://SERVER:PORT/CONTEXT/services/rest/server/" class="bare">http://SERVER:PORT/CONTEXT/services/rest/server/</a></code>并输入指定的用户名和密码。您应该看到带有有关服务器基本信息的简单XML消息。</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">
<div class="paragraph">
<p>与Tomcat或任何其他Web容器一起运行时，不能利用JMS接口。WAR的Web容器版本仅包含REST接口。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wildfly_11_x"><a class="anchor" href="#_wildfly_11_x"></a> <a class="link" href="#_wildfly_11_x">19.2.1.2。WildFly 11.x</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>下载并解压缩WildFly发行版。我们称其为分布的根<code>WILDFLY_HOME</code> 。该目录以WildFly版本命名，例如<code>wildfly-14.0.1.Final</code> 。</p>
</li>
<li>
<p>下载<em>kie-server- -ee7.war</em>并将其放入<code>WILDFLY_HOME/standalone/deployments</code> 。</p>
</li>
<li>
<p>配置用户和角色。执行以下命令<code>WILDFLY_HOME/bin/add-user.[sh|bat] -a -u 'kieserver' -p 'kieserver1!' -ro 'kie-server'</code> 。您当然可以选择其他用户名和密码，只需确保该用户具有角色即可<code>kie-server</code> 。</p>
</li>
<li>
<p>通过运行启动服务器<code>WILDFLY_HOME/bin/standalone.[sh|bat] -c standalone-full.xml <bootstrap_switches></code> 。您可以签出标准输出或WildFly登录<code>WILDFLY_HOME/standalone/logs</code>查看应用程序是否成功部署。请阅读上表，了解可用于正确配置实例的引导程序开关。例如：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>./standalone.sh  --server-config=standalone-full.xml
                 -Djboss.socket.binding.port-offset=150
                 -Dorg.kie.server.id=first-kie-server
                 -Dorg.kie.server.location=http://localhost:8230/kie-server/services/rest/server</code></pre>
</div>
</div>
</li>
<li>
<p>验证服务器正在运行。去<code><a href="http://SERVER:PORT/CONTEXT/services/rest/server/" class="bare">http://SERVER:PORT/CONTEXT/services/rest/server/</a></code>并输入指定的用户名和密码。您应该看到带有有关服务器基本信息的简单XML消息。</p>
<div class="imageblock">
<div class="content">
<img src="./KieServer/kie-server-info.png" alt="kie服务器信息">
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kie-server-system-properties-ref_kie-apis"><a class="anchor" href="#kie-server-system-properties-ref_kie-apis"></a> <a class="link" href="#kie-server-system-properties-ref_kie-apis">19.3。KIE Server系统属性</a></h3>
<div class="paragraph">
<p>KIE服务器接受以下系统属性（引导开关）来配置服务器的行为：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表79。禁用KIE服务器扩展的系统属性</caption>
<colgroup>
<col style="width:28.5714%">
<col style="width:14.2857%">
<col style="width:14.2857%">
<col style="width:42.8572%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">价值观</th>
<th class="tableblock halign-left valign-top">默认</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.drools.server.ext.disabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> ，<code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果设置为<code>true</code> ，禁用业务规则管理（BRM）支持（例如，规则支持）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.optaplanner.server.ext.disabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> ，<code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果设置为<code>true</code> ，禁用OptaPlanner支持。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.prometheus.server.ext.disabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> ，<code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果设置为<code>true</code> ，禁用Prometheus Server扩展。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.dmn.server.ext.disabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> ，<code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果设置为<code>true</code> ，则禁用KIE Server DMN支持。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.swagger.server.ext.disabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> ，<code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果设置为<code>true</code> ，禁用KIE Server swagger文档支持</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">下表中列出了某些Drools控制器属性，标记为必填项。在Business Central中创建或删除KIE Server容器时，请设置这些属性。如果单独使用KIE服务器而不与Business Central进行任何交互，则不需要设置必需的属性。
</td>
</tr>
</tbody></table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表80。Drools控制器所需的系统属性</caption>
<colgroup>
<col style="width:28.5714%">
<col style="width:14.2857%">
<col style="width:14.2857%">
<col style="width:42.8572%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">价值观</th>
<th class="tableblock halign-left valign-top">默认</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要分配给服务器的任意ID。如果在Business Central外部配置了无头Drools控制器，则这是服务器连接到无头Drools控制器以获取KIE容器配置的ID。如果未提供，则自动生成ID。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kieserver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在托管模式下运行时，用于从Drools控制器与KIE服务器连接的用户名。在Business Central系统属性中设置此属性。使用Drools控制器时设置此属性。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.pwd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kieserver1!</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在托管模式下运行时，用于从Drools控制器与KIE服务器连接的密码。在Business Central系统属性中设置此属性。使用Drools控制器时设置此属性。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.token</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">该属性使您可以在Drools控制器和KIE服务器之间使用基于令牌的身份验证，而不是基本的用户名和密码身份验证。Drools控制器将令牌作为参数发送到请求标头中。由于不需要刷新令牌，因此服务器需要使用期限很长的访问令牌。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">网址</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Drools控制器用于在此服务器上回叫的KIE Server实例的URL，例如， <code><a href="http://localhost:8230/kie-server/services/rest/server" class="bare">http://localhost:8230/kie-server/services/rest/server</a></code> 。使用Drools控制器时需要设置此属性。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.controller</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">逗号分隔列表</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">以逗号分隔的Drools控制器REST端点的URL列表，例如， <code><a href="http://localhost:8080/business-central/rest/controller" class="bare">http://localhost:8080/business-central/rest/controller</a></code> 。使用Drools控制器时需要设置此属性。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.controller.user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kieserver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接到Drools控制器REST API的用户名。使用Drools控制器时需要设置此属性。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.controller.pwd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kieserver1!</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接到Drools控制器REST API的密码。使用Drools控制器时需要设置此属性。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.controller.token</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">该属性使您可以在KIE服务器和Drools控制器之间使用基于令牌的身份验证，而不是基本用户名和密码身份验证。服务器将令牌作为参数发送到请求标头中。由于不需要刷新令牌，因此服务器需要使用期限很长的访问令牌。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.controller.connect</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">长</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">服务器启动时，多次尝试将KIE Server连接到Drools控制器之间的等待时间（以毫秒为单位）。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表81。加载密钥库的系统属性</caption>
<colgroup>
<col style="width:28.5714%">
<col style="width:14.2857%">
<col style="width:14.2857%">
<col style="width:42.8572%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">价值观</th>
<th class="tableblock halign-left valign-top">默认</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kie.keystore.keyStoreURL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">网址</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">该URL用于加载Java密码学扩展密钥库（JCEKS）。例如， <code><a href="file:///home/kie/keystores/keystore.jceks" class="bare">file:///home/kie/keystores/keystore.jceks</a></code> 。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kie.keystore.keyStorePwd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">该密码用于JCEKS。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kie.keystore.key.server.alias</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">存储密码的REST服务密钥的别名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kie.keystore.key.server.pwd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REST服务的别名的密码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kie.keystore.key.ctrl.alias</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认REST Drools控制器的密钥的别名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kie.keystore.key.ctrl.pwd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认REST Drools控制器的别名的密码。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表82。其他系统属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:20%">
<col style="width:20%">
<col style="width:30%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">价值观</th>
<th class="tableblock halign-left valign-top">默认</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kie.maven.settings.custom</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">路径</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自定义的位置<code>settings.xml</code> Maven配置文件。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kie.server.jms.queues.response</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>queue/KIE.SERVER.RESPONSE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JMS的响应队列JNDI名称。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.drools.server.filter.classes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> ，<code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设置为<code>true</code> ，Drools KIE Server扩展接受由注释的自定义类。 <code>XmlRootElement</code>要么<code>Remotable</code>仅注释。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.domain</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAAS <code>LoginContext</code>使用JMS时用于验证用户身份的域。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.repo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">路径</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KIE服务器状态文件的存储位置。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.sync.deploy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> ，<code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指示KIE服务器保持部署直到Drools控制器提供容器部署配置之前的属性。此属性仅影响在托管模式下运行的服务器。提供以下选项：</p>
<p class="tableblock">* <code>false</code> ：与Drools控制器的连接是异步的。应用程序启动，连接到Drools控制器，一旦成功，便部署容器。该应用程序甚至在容器可用之前就接受请求。* <code>true</code> ：服务器应用程序的部署将Drools控制器连接线程与主部署连接在一起，并等待其完成。如果同一服务器上有更多应用程序，此选项可能导致潜在的死锁。在一个服务器实例上仅使用一个应用程序。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.startup.strategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ControllerBasedStartupStrategy</code> ，<code>LocalContainersStartupStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ControllerBasedStartupStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KIE Server的启动策略用于控制已部署的KIE容器及其部署顺序。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.mgmt.api.disabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> ，<code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设置为<code>true</code> ，禁用KIE服务器管理API。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.server.xstream.enabled.packages</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java包，例如<code>org.kie.example</code> 。您还可以指定通配符表达式，例如<code>org.kie.example.*</code> 。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个属性，该属性指定要列入白名单以使用XStream进行编组的其他软件包。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.store.services.class</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.drools.persistence.jpa.KnowledgeStoreServiceImpl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实现的类的完全限定名称<code>KieStoreServices</code>负责引导KieSession实例。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="kie-server-extensions-con_kie-apis"><a class="anchor" href="#kie-server-extensions-con_kie-apis"></a> <a class="link" href="#kie-server-extensions-con_kie-apis">19.4。KIE Server功能和扩展</a></h3>
<div class="paragraph">
<p>KIE Server中的功能由您可以启用，禁用或进一步扩展以满足您的业务需求的插件扩展决定。KIE Server支持以下默认功能和扩展：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表83。KIE Server功能和扩展</caption>
<colgroup>
<col style="width:20%">
<col style="width:20%">
<col style="width:60%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">能力名称</th>
<th class="tableblock halign-left valign-top">扩展名</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KieServer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KieServer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供KIE Server的核心功能，例如在服务器实例上创建和处置KIE容器</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BRM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Drools</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供业务规则管理（BRM）功能，例如插入事实和执行业务规则</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BRP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OptaPlanner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供业务资源计划（BRP）功能，例如实施求解器</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供决策模型和表示法（DMN）功能，例如管理DMN数据类型和执行DMN模型</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Swagger</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Swagger</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供Swagger Web界面功能以与KIE Server REST API进行交互</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>要查看正在运行的KIE Server实例的支持扩展，请发送<code>GET</code>请求到以下REST API端点，并查看XML或JSON服务器响应：</p>
</div>
<div class="listingblock">
<div class="title">GET请求获取KIE服务器信息的基本URL</div>
<div class="content">
<pre class="highlightjs highlight"><code>http://SERVER:PORT/kie-server/services/rest/server</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">带有KIE服务器信息的示例JSON响应</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "SUCCESS",
  "msg": "Kie Server info",
  "result": {
    "kie-server-info": {
      "id": "test-kie-server",
      "version": "7.26.0.20190818-050814",
      "name": "test-kie-server",
      "location": "http://localhost:8080/kie-server/services/rest/server",
      "capabilities": [
        "KieServer",
        "BRM",
        "BRP",
        "DMN",
        "Swagger"
      ],
      "messages": [
        {
          "severity": "INFO",
          "timestamp": {
            "java.util.Date": 1566169865791
          },
          "content": [
            "Server KieServerInfo{serverId='test-kie-server', version='7.26.0.20190818-050814', name='test-kie-server', location='http:/localhost:8080/kie-server/services/rest/server', capabilities=[KieServer, BRM, BRP, DMN, Swagger]', messages=null', mode=DEVELOPMENT}started successfully at Sun Aug 18 23:11:05 UTC 2019"
          ]
        }
      ],
      "mode": "DEVELOPMENT"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>要启用或禁用KIE服务器扩展，请配置相关<code>*.server.ext.disabled</code> KIE Server系统属性。例如，要禁用<code>BRM</code>功能，设置系统属性<code>org.drools.server.ext.disabled=true</code> 。有关所有KIE Server系统属性，请参阅<a href="#kie-server-system-properties-ref_kie-apis">KIE Server系统属性</a> 。</p>
</div>
<div class="paragraph">
<p>默认情况下，KIE Server扩展通过REST或JMS数据传输公开，并使用预定义的客户端API。您可以使用其他REST端点扩展现有的KIE Server功能，将支持的传输方法扩展到REST或JMS之外，或者扩展KIE Server客户端中的功能。</p>
</div>
<div class="paragraph">
<p>KIE Server功能的这种灵活性使您可以使KIE Server实例适应业务需求，而无需使业务需求适应默认的KIE Server功能。</p>
</div>
<div class="sect3">
<h4 id="kie-server-extensions-endpoint-proc_kie-apis"><a class="anchor" href="#kie-server-extensions-endpoint-proc_kie-apis"></a> <a class="link" href="#kie-server-extensions-endpoint-proc_kie-apis">19.4.1。使用自定义REST API端点扩展现有的KIE Server功能</a></h4>
<div class="paragraph">
<p>通过KIE Server REST API，您可以在Drools中与KIE容器和业务资产（例如业务规则，流程和求解器）进行交互，而无需使用Business Central用户界面。可用的REST端点由KIE Server系统属性中启用的功能（例如， <code>org.drools.server.ext.disabled=false</code>为了<code>BRM</code>能力）。您可以使用自定义REST API端点扩展现有的KIE Server功能，以进一步使KIE Server REST API适应您的业务需求。</p>
</div>
<div class="paragraph">
<p>例如，此过程扩展了<code>Drools</code> KIE服务器扩展（用于<code>BRM</code>功能）与以下自定义REST API端点：</p>
</div>
<div class="listingblock">
<div class="title">定制REST API端点示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>/server/containers/instances/{containerId}/ksession/{ksessionId}</code></pre>
</div>
</div>
<div class="paragraph">
<p>此示例自定义端点接受要插入Drools引擎的工作存储器中的事实列表，自动执行所有规则，并从指定KIE容器中的KIE会话中检索所有对象。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>创建一个空的Maven项目，并在<code>pom.xml</code>该项目的文件：</p>
<div class="listingblock">
<div class="title">示例项目中的示例pom.xml文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;packaging&gt;jar&lt;/packaging&gt;

&lt;properties&gt;
  &lt;version.org.kie&gt;7.26.0.Final-redhat-00005&lt;/version.org.kie&gt;
&lt;/properties&gt;

&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie&lt;/groupId&gt;
    &lt;artifactId&gt;kie-api&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie&lt;/groupId&gt;
    &lt;artifactId&gt;kie-internal&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-api&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-services-common&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-services-drools&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-rest-common&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-core&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
    &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
    &lt;version&gt;1.7.25&lt;/version&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>实施<code>org.kie.server.services.api.KieServerApplicationComponentsService</code>项目中的Java类中的接口，如以下示例所示：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">示例实现<code>KieServerApplicationComponentsService</code>接口</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class CusomtDroolsKieServerApplicationComponentsService implements KieServerApplicationComponentsService {  <i class="conum" data-value="1"></i><b>(1)</b>

    private static final String OWNER_EXTENSION = "Drools";  <i class="conum" data-value="2"></i><b>(2)</b>

    public Collection&lt;Object&gt; getAppComponents(String extension, SupportedTransports type, Object... services) {  <i class="conum" data-value="3"></i><b>(3)</b>
        // Do not accept calls from extensions other than the owner extension:
        if ( !OWNER_EXTENSION.equals(extension) ) {
            return Collections.emptyList();
        }

        RulesExecutionService rulesExecutionService = null;  <i class="conum" data-value="4"></i><b>(4)</b>
        KieServerRegistry context = null;

        for( Object object : services ) {
            if( RulesExecutionService.class.isAssignableFrom(object.getClass()) ) {
                rulesExecutionService = (RulesExecutionService) object;
                continue;
            } else if( KieServerRegistry.class.isAssignableFrom(object.getClass()) ) {
                context = (KieServerRegistry) object;
                continue;
            }
        }

        List&lt;Object&gt; components = new ArrayList&lt;Object&gt;(1);
        if( SupportedTransports.REST.equals(type) ) {
            components.add(new CustomResource(rulesExecutionService, context));  <i class="conum" data-value="5"></i><b>(5)</b>
        }

        return components;
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>将REST端点交付给在应用程序启动时部署的KIE Server基础结构。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>指定您要扩展的扩展名，例如<code>Drools</code>本示例中的扩展名。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i> <b>3</b></td>
<td>返回REST容器必须部署的所有资源。您的KIE Server实例中启用的每个扩展名都称为<code>getAppComponents</code>方法，所以<code>if ( !OWNER_EXTENSION.equals(extension) )</code>调用返回除指定扩展名以外的所有扩展名的空集合<code>OWNER_EXTENSION</code>延期。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i> <b>4</b></td>
<td>列出您要使用的指定扩展名中的服务，例如<code>RulesExecutionService</code>和<code>KieServerRegistry</code>来自的服务<code>Drools</code>本示例中的扩展名。</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i> <b>5</b></td>
<td>指定扩展的传输类型，可以是<code>REST</code>要么<code>JMS</code> （ <code>REST</code>在此示例中）， <code>CustomResource</code>作为资源的一部分返回资源的类<code>components</code>清单。</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</li>
<li>
<p>实施<code>CustomResource</code> KIE Server可用于为新的REST资源提供附加功能的类，如以下示例所示：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">示例实现<code>CustomResource</code>类</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Custom base endpoint:
@Path("server/containers/instances/{containerId}/ksession")
public class CustomResource {

    private static final Logger logger = LoggerFactory.getLogger(CustomResource.class);

    private KieCommands commandsFactory = KieServices.Factory.get().getCommands();

    private RulesExecutionService rulesExecutionService;
    private KieServerRegistry registry;

    public CustomResource() {

    }

    public CustomResource(RulesExecutionService rulesExecutionService, KieServerRegistry registry) {
        this.rulesExecutionService = rulesExecutionService;
        this.registry = registry;
    }

    // Supported HTTP method, path parameters, and data formats:
    @POST
    @Path("/{ksessionId}")
    @Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response insertFireReturn(@Context HttpHeaders headers,
            @PathParam("containerId") String id,
            @PathParam("ksessionId") String ksessionId,
            String cmdPayload) {

        Variant v = getVariant(headers);
        String contentType = getContentType(headers);

        // Marshalling behavior and supported actions:
        MarshallingFormat format = MarshallingFormat.fromType(contentType);
        if (format == null) {
            format = MarshallingFormat.valueOf(contentType);
        }
        try {
            KieContainerInstance kci = registry.getContainer(id);

            Marshaller marshaller = kci.getMarshaller(format);

            List&lt;?&gt; listOfFacts = marshaller.unmarshall(cmdPayload, List.class);

            List&lt;Command&lt;?&gt;&gt; commands = new ArrayList&lt;Command&lt;?&gt;&gt;();
            BatchExecutionCommand executionCommand = commandsFactory.newBatchExecution(commands, ksessionId);

            for (Object fact : listOfFacts) {
                commands.add(commandsFactory.newInsert(fact, fact.toString()));
            }
            commands.add(commandsFactory.newFireAllRules());
            commands.add(commandsFactory.newGetObjects());

            ExecutionResults results = rulesExecutionService.call(kci, executionCommand);

            String result = marshaller.marshall(results);


            logger.debug("Returning OK response with content '{}'", result);
            return createResponse(result, v, Response.Status.OK);
        } catch (Exception e) {
            // If marshalling fails, return the `call-container` response to maintain backward compatibility:
            String response = "Execution failed with error : " + e.getMessage();
            logger.debug("Returning Failure response with content '{}'", response);
            return createResponse(response, v, Response.Status.INTERNAL_SERVER_ERROR);
        }

    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中， <code>CustomResource</code>自定义端点的类指定以下数据和行为：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用基本端点<code>server/containers/instances/{containerId}/ksession</code></p>
</li>
<li>
<p>用途<code>POST</code> HTTP方法</p>
</li>
<li>
<p>期望在REST请求中提供以下数据：</p>
<div class="ulist">
<ul>
<li>
<p>的<code>containerId</code>作为路径参数</p>
</li>
<li>
<p>的<code>ksessionId</code>作为路径参数</p>
</li>
<li>
<p>事实列表作为消息有效负载</p>
</li>
</ul>
</div>
</li>
<li>
<p>支持所有KIE Server数据格式：</p>
<div class="ulist">
<ul>
<li>
<p>XML（JAXB，XStream）</p>
</li>
<li>
<p>JSON格式</p>
</li>
</ul>
</div>
</li>
<li>
<p>将有效载荷解组为<code>List<?></code>集合，并为列表中的每个项目创建一个<code>InsertCommand</code>实例后跟<code>FireAllRules</code>和<code>GetObject</code>命令。</p>
</li>
<li>
<p>将所有命令添加到<code>BatchExecutionCommand</code>调用Drools引擎的实例。</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>要使新端点可被KIE Server发现，请创建一个<code>META-INF/services/org.kie.server.services.api.KieServerApplicationComponentsService</code>文件添加到您的Maven项目中，然后添加<code>KieServerApplicationComponentsService</code>文件中的实现类。对于此示例，文件包含单行<code>org.kie.server.ext.drools.rest.CusomtDroolsKieServerApplicationComponentsService</code> 。</p>
</li>
<li>
<p>构建您的项目，然后将生成的JAR文件复制到<code>~/kie-server.war/WEB-INF/lib</code>项目的目录。</p>
</li>
<li>
<p>启动KIE服务器，并将生成的项目部署到正在运行的KIE服务器。您可以使用Business Central界面或KIE Server REST API（a <code>PUT</code>请求<code>http://SERVER:PORT/kie-server/services/rest/server/containers/{containerId}</code> ）。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>将项目部署到正在运行的KIE服务器上之后，就可以开始与新的REST端点进行交互了。</p>
</div>
<div class="paragraph">
<p>对于此示例，您可以使用以下信息来调用新端点：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>请求网址示例：</strong> <code>http://localhost:8080/kie-server/services/rest/server/containers/instances/demo/ksession/defaultKieSession</code></p>
</li>
<li>
<p><strong>HTTP方法：</strong> <code>POST</code></p>
</li>
<li>
<p><strong>HTTP标头：</strong></p>
<div class="ulist">
<ul>
<li>
<p><code>Content-Type: application/json</code></p>
</li>
<li>
<p><code>Accept: application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>消息有效负载示例：</strong></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "org.jbpm.test.Person": {
      "name": "john",
      "age": 25
    }
  },
  {
    "org.jbpm.test.Person": {
      "name": "mary",
      "age": 22
    }
  }
]</code></pre>
</div>
</div>
</li>
<li>
<p><strong>服务器响应示例：</strong> <code>200</code> （成功）</p>
</li>
<li>
<p><strong>服务器日志输出示例：</strong></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>13:37:20,347 INFO  [stdout] (default task-24) Hello mary
13:37:20,348 INFO  [stdout] (default task-24) Hello john</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="kie-server-extensions-transport-proc_kie-apis"><a class="anchor" href="#kie-server-extensions-transport-proc_kie-apis"></a> <a class="link" href="#kie-server-extensions-transport-proc_kie-apis">19.4.2。扩展KIE Server以使用自定义数据传输</a></h4>
<div class="paragraph">
<p>默认情况下，KIE Server扩展通过REST或JMS数据传输公开。您可以扩展KIE Server以支持自定义数据传输，以使KIE Server传输协议适应您的业务需求。</p>
</div>
<div class="paragraph">
<p>例如，此过程将自定义数据传输添加到使用<code>Drools</code>扩展，并且基于Apache MINA（一种开源Java网络应用程序框架）。示例自定义MINA传输程序交换依赖于现有编组操作且仅支持JSON格式的基于字符串的数据。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>创建一个空的Maven项目，并在<code>pom.xml</code>该项目的文件：</p>
<div class="listingblock">
<div class="title">示例项目中的示例pom.xml文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;packaging&gt;jar&lt;/packaging&gt;

&lt;properties&gt;
  &lt;version.org.kie&gt;7.26.0.Final-redhat-00005&lt;/version.org.kie&gt;
&lt;/properties&gt;

&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie&lt;/groupId&gt;
    &lt;artifactId&gt;kie-api&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie&lt;/groupId&gt;
    &lt;artifactId&gt;kie-internal&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-api&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-services-common&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-services-drools&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-core&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.drools&lt;/groupId&gt;
    &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
    &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
    &lt;version&gt;1.7.25&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.mina&lt;/groupId&gt;
    &lt;artifactId&gt;mina-core&lt;/artifactId&gt;
    &lt;version&gt;2.1.3&lt;/version&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>实施<code>org.kie.server.services.api.KieServerExtension</code>项目中的Java类中的接口，如以下示例所示：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">示例实现<code>KieServerExtension</code>接口</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MinaDroolsKieServerExtension implements KieServerExtension {

    private static final Logger logger = LoggerFactory.getLogger(MinaDroolsKieServerExtension.class);

    public static final String EXTENSION_NAME = "Drools-Mina";

    private static final Boolean disabled = Boolean.parseBoolean(System.getProperty("org.kie.server.drools-mina.ext.disabled", "false"));
    private static final String MINA_HOST = System.getProperty("org.kie.server.drools-mina.ext.port", "localhost");
    private static final int MINA_PORT = Integer.parseInt(System.getProperty("org.kie.server.drools-mina.ext.port", "9123"));

    // Taken from dependency on the `Drools` extension:
    private KieContainerCommandService batchCommandService;

    // Specific to MINA:
    private IoAcceptor acceptor;

    public boolean isActive() {
        return disabled == false;
    }

    public void init(KieServerImpl kieServer, KieServerRegistry registry) {

        KieServerExtension droolsExtension = registry.getServerExtension("Drools");
        if (droolsExtension == null) {
            logger.warn("No Drools extension available, quiting...");
            return;
        }

        List&lt;Object&gt; droolsServices = droolsExtension.getServices();
        for( Object object : droolsServices ) {
            // If the given service is null (not configured), continue to the next service:
            if (object == null) {
                continue;
            }
            if( KieContainerCommandService.class.isAssignableFrom(object.getClass()) ) {
                batchCommandService = (KieContainerCommandService) object;
                continue;
            }
        }
        if (batchCommandService != null) {
            acceptor = new NioSocketAcceptor();
            acceptor.getFilterChain().addLast( "codec", new ProtocolCodecFilter( new TextLineCodecFactory( Charset.forName( "UTF-8" ))));

            acceptor.setHandler( new TextBasedIoHandlerAdapter(batchCommandService) );
            acceptor.getSessionConfig().setReadBufferSize( 2048 );
            acceptor.getSessionConfig().setIdleTime( IdleStatus.BOTH_IDLE, 10 );
            try {
                acceptor.bind( new InetSocketAddress(MINA_HOST, MINA_PORT) );

                logger.info("{} -- Mina server started at {} and port {}", toString(), MINA_HOST, MINA_PORT);
            } catch (IOException e) {
                logger.error("Unable to start Mina acceptor due to {}", e.getMessage(), e);
            }

        }
    }

    public void destroy(KieServerImpl kieServer, KieServerRegistry registry) {
        if (acceptor != null) {
            acceptor.dispose();
            acceptor = null;
        }
        logger.info("{} -- Mina server stopped", toString());
    }

    public void createContainer(String id, KieContainerInstance kieContainerInstance, Map&lt;String, Object&gt; parameters) {
        // Empty, already handled by the `Drools` extension

    }

    public void disposeContainer(String id, KieContainerInstance kieContainerInstance, Map&lt;String, Object&gt; parameters) {
      // Empty, already handled by the `Drools` extension

    }

    public List&lt;Object&gt; getAppComponents(SupportedTransports type) {
        // Nothing for supported transports (REST or JMS)
        return Collections.emptyList();
    }

    public &lt;T&gt; T getAppComponents(Class&lt;T&gt; serviceType) {

        return null;
    }

    public String getImplementedCapability() {
        return "BRM-Mina";
    }

    public List&lt;Object&gt; getServices() {
        return Collections.emptyList();
    }

    public String getExtensionName() {
        return EXTENSION_NAME;
    }

    public Integer getStartOrder() {
        return 20;
    }

    @Override
    public String toString() {
        return EXTENSION_NAME + " KIE Server extension";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>KieServerExtension</code>接口是KIE Server可以用来为新的MINA传输提供附加功能的主要扩展接口。该界面包含以下组件：</p>
</div>
<div class="listingblock">
<div class="title">概述<code>KieServerExtension</code>接口</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface KieServerExtension {

    boolean isActive();

    void init(KieServerImpl kieServer, KieServerRegistry registry);

    void destroy(KieServerImpl kieServer, KieServerRegistry registry);

    void createContainer(String id, KieContainerInstance kieContainerInstance, Map&lt;String, Object&gt; parameters);

    void disposeContainer(String id, KieContainerInstance kieContainerInstance, Map&lt;String, Object&gt; parameters);

    List&lt;Object&gt; getAppComponents(SupportedTransports type);

    &lt;T&gt; T getAppComponents(Class&lt;T&gt; serviceType);

    String getImplementedCapability();  <i class="conum" data-value="1"></i><b>(1)</b>

    List&lt;Object&gt; getServices();

    String getExtensionName();  <i class="conum" data-value="2"></i><b>(2)</b>

    Integer getStartOrder();  <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>指定此扩展涵盖的功能。该功能在KIE Server中必须是唯一的。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>为扩展名定义易于理解的名称。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i> <b>3</b></td>
<td>确定何时应启动指定的扩展名。对于依赖于其他扩展的扩展，此设置不得与父设置冲突。例如，在这种情况下，此自定义扩展名取决于<code>Drools</code>扩展名<code>StartOrder</code>调成<code>0</code> ，因此此自定义附加扩展名必须大于<code>0</code> （调成<code>20</code>在示例实现中）。</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>在上一个<code>MinaDroolsKieServerExtension</code>此接口的示例实现， <code>init</code>方法是从<code>Drools</code>扩展程序并用于引导MINA服务器。中的所有其他方法<code>KieServerExtension</code>接口可以保留在标准实现中，以满足接口要求。</p>
</div>
<div class="paragraph">
<p>的<code>TextBasedIoHandlerAdapter</code> class是MINA服务器上对传入请求做出反应的处理程序。</p>
</div>
</div>
</div>
</li>
<li>
<p>实施<code>TextBasedIoHandlerAdapter</code> MINA服务器的处理程序，如以下示例所示：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">示例实现<code>TextBasedIoHandlerAdapter</code>处理程序</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class TextBasedIoHandlerAdapter extends IoHandlerAdapter {

    private static final Logger logger = LoggerFactory.getLogger(TextBasedIoHandlerAdapter.class);

    private KieContainerCommandService batchCommandService;

    public TextBasedIoHandlerAdapter(KieContainerCommandService batchCommandService) {
        this.batchCommandService = batchCommandService;
    }

    @Override
    public void messageReceived( IoSession session, Object message ) throws Exception {
        String completeMessage = message.toString();
        logger.debug("Received message '{}'", completeMessage);
        if( completeMessage.trim().equalsIgnoreCase("quit") || completeMessage.trim().equalsIgnoreCase("exit") ) {
            session.close(false);
            return;
        }

        String[] elements = completeMessage.split("\\|");
        logger.debug("Container id {}", elements[0]);
        try {
            ServiceResponse&lt;String&gt; result = batchCommandService.callContainer(elements[0], elements[1], MarshallingFormat.JSON, null);

            if (result.getType().equals(ServiceResponse.ResponseType.SUCCESS)) {
                session.write(result.getResult());
                logger.debug("Successful message written with content '{}'", result.getResult());
            } else {
                session.write(result.getMsg());
                logger.debug("Failure message written with content '{}'", result.getMsg());
            }
        } catch (Exception e) {

        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，处理程序类接收文本消息，并在<code>Drools</code>服务。</p>
</div>
<div class="paragraph">
<p>使用以下代码时，请考虑以下处理程序要求和行为： <code>TextBasedIoHandlerAdapter</code>处理程序实现：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>您提交给处理程序的任何内容都必须是一行，因为每个传入的传输请求都是一行。</p>
</li>
<li>
<p>您必须在这一行中传递一个KIE容器ID，以便处理程序期望该格式<code>containerID|payload</code> 。</p>
</li>
<li>
<p>您可以按照编组产生的方式设置响应。响应可以是多行。</p>
</li>
<li>
<p>处理程序支持<em>流模式</em> ，使您可以在不断开KIE Server会话的情况下发送命令。要以流模式结束KIE Server会话，请发送<code>exit</code>要么<code>quit</code>命令到服务器。</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>要使新的数据传输可被KIE Server发现，请创建一个<code>META-INF/services/org.kie.server.services.api.KieServerExtension</code>文件添加到您的Maven项目中，然后添加<code>KieServerExtension</code>文件中的实现类。对于此示例，文件包含单行<code>org.kie.server.ext.mina.MinaDroolsKieServerExtension</code> 。</p>
</li>
<li>
<p>构建您的项目，然后复制生成的JAR文件和<code>mina-core-2.0.9.jar</code>文件（在此示例中，扩展名取决于该文件）到<code>~/kie-server.war/WEB-INF/lib</code>项目的目录。</p>
</li>
<li>
<p>启动KIE服务器，并将生成的项目部署到正在运行的KIE服务器。您可以使用Business Central界面或KIE Server REST API（a <code>PUT</code>请求<code>http://SERVER:PORT/kie-server/services/rest/server/containers/{containerId}</code> ）。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>将项目部署到正在运行的KIE Server上之后，您可以在KIE Server日志中查看新数据传输的状态，并开始使用新数据传输：</p>
</div>
<div class="listingblock">
<div class="title">服务器日志中的新数据传输</div>
<div class="content">
<pre class="highlightjs highlight"><code>Drools-Mina KIE Server extension -- Mina server started at localhost and port 9123
Drools-Mina KIE Server extension has been successfully registered as server extension</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于此示例，可以使用Telnet与KIE Server中新的基于MINA的数据传输进行交互：</p>
</div>
<div class="listingblock">
<div class="title">在命令终端中启动Telnet并在端口9123上连接到KIE Server</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">telnet 127.0.0.1 9123</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">在命令终端中与KIE Server的交互示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.

# Request body:
demo|{"lookup":"defaultKieSession","commands":[{"insert":{"object":{"org.jbpm.test.Person":{"name":"john","age":25}}}},{"fire-all-rules":""}]}

# Server response:
{
  "results" : [ {
    "key" : "",
    "value" : 1
  } ],
  "facts" : [ ]
}

demo|{"lookup":"defaultKieSession","commands":[{"insert":{"object":{"org.jbpm.test.Person":{"name":"mary","age":22}}}},{"fire-all-rules":""}]}
{
  "results" : [ {
    "key" : "",
    "value" : 1
  } ],
  "facts" : [ ]
}

demo|{"lookup":"defaultKieSession","commands":[{"insert":{"object":{"org.jbpm.test.Person":{"name":"james","age":25}}}},{"fire-all-rules":""}]}
{
  "results" : [ {
    "key" : "",
    "value" : 1
  } ],
  "facts" : [ ]
}
exit
Connection closed by foreign host.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器日志输出示例</div>
<div class="content">
<pre class="highlightjs highlight"><code>16:33:40,206 INFO  [stdout] (NioProcessor-2) Hello john
16:34:03,877 INFO  [stdout] (NioProcessor-2) Hello mary
16:34:19,800 INFO  [stdout] (NioProcessor-2) Hello james</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="kie-server-extensions-client-proc_kie-apis"><a class="anchor" href="#kie-server-extensions-client-proc_kie-apis"></a> <a class="link" href="#kie-server-extensions-client-proc_kie-apis">19.4.3。使用自定义客户端API扩展KIE Server客户端</a></h4>
<div class="paragraph">
<p>KIE Server使用预定义的客户端API，您可以与它们进行交互以使用KIE Server服务。您可以使用自定义客户端API扩展KIE Server客户端，以使KIE Server服务适应您的业务需求。</p>
</div>
<div class="paragraph">
<p>例如，此过程将自定义客户端API添加到KIE Server，以适应基于Apache MINA（一种开放源Java网络应用程序框架）的自定义数据传输（之前针对该场景配置）。</p>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>创建一个空的Maven项目，并在<code>pom.xml</code>该项目的文件：</p>
<div class="listingblock">
<div class="title">示例项目中的示例pom.xml文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;packaging&gt;jar&lt;/packaging&gt;

&lt;properties&gt;
   &lt;version.org.kie&gt;7.26.0.Final-redhat-00005&lt;/version.org.kie&gt;
 &lt;/properties&gt;

 &lt;dependencies&gt;
   &lt;dependency&gt;
     &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
     &lt;artifactId&gt;kie-server-api&lt;/artifactId&gt;
     &lt;version&gt;${version.org.kie}&lt;/version&gt;
   &lt;/dependency&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
      &lt;artifactId&gt;kie-server-client&lt;/artifactId&gt;
      &lt;version&gt;${version.org.kie}&lt;/version&gt;
    &lt;/dependency&gt;
   &lt;dependency&gt;
     &lt;groupId&gt;org.drools&lt;/groupId&gt;
     &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
     &lt;version&gt;${version.org.kie}&lt;/version&gt;
   &lt;/dependency&gt;
 &lt;/dependencies&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>实施相关<code>ServicesClient</code>项目中的Java类中的接口，如以下示例所示：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">样品<code>RulesMinaServicesClient</code>接口</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface RulesMinaServicesClient extends RuleServicesClient {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>需要一个特定的接口，因为您必须基于该接口注册客户端实现，并且给定接口只能有一个实现。</p>
</div>
<div class="paragraph">
<p>在此示例中，基于MINA的自定义数据传输使用<code>Drools</code>扩展，所以这个例子<code>RulesMinaServicesClient</code>接口扩展了现有的<code>RuleServicesClient</code>来自的客户端API <code>Drools</code>延期。</p>
</div>
</div>
</div>
</li>
<li>
<p>实施<code>RulesMinaServicesClient</code> KIE Server可用来为新的MINA传输提供其他客户端功能的接口，如以下示例所示：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">示例实现<code>RulesMinaServicesClient</code>接口</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class RulesMinaServicesClientImpl implements RulesMinaServicesClient {

    private String host;
    private Integer port;

    private Marshaller marshaller;

    public RulesMinaServicesClientImpl(KieServicesConfiguration configuration, ClassLoader classloader) {
        String[] serverDetails = configuration.getServerUrl().split(":");

        this.host = serverDetails[0];
        this.port = Integer.parseInt(serverDetails[1]);

        this.marshaller = MarshallerFactory.getMarshaller(configuration.getExtraJaxbClasses(), MarshallingFormat.JSON, classloader);
    }

    public ServiceResponse&lt;String&gt; executeCommands(String id, String payload) {

        try {
            String response = sendReceive(id, payload);
            if (response.startsWith("{")) {
                return new ServiceResponse&lt;String&gt;(ResponseType.SUCCESS, null, response);
            } else {
                return new ServiceResponse&lt;String&gt;(ResponseType.FAILURE, response);
            }
        } catch (Exception e) {
            throw new KieServicesException("Unable to send request to KIE Server", e);
        }
    }

    public ServiceResponse&lt;String&gt; executeCommands(String id, Command&lt;?&gt; cmd) {
        try {
            String response = sendReceive(id, marshaller.marshall(cmd));
            if (response.startsWith("{")) {
                return new ServiceResponse&lt;String&gt;(ResponseType.SUCCESS, null, response);
            } else {
                return new ServiceResponse&lt;String&gt;(ResponseType.FAILURE, response);
            }
        } catch (Exception e) {
            throw new KieServicesException("Unable to send request to KIE Server", e);
        }
    }

    protected String sendReceive(String containerId, String content) throws Exception {

        // Flatten the content to be single line:
        content = content.replaceAll("\\n", "");

        Socket minaSocket = null;
        PrintWriter out = null;
        BufferedReader in = null;

        StringBuffer data = new StringBuffer();
        try {
            minaSocket = new Socket(host, port);
            out = new PrintWriter(minaSocket.getOutputStream(), true);
            in = new BufferedReader(new InputStreamReader(minaSocket.getInputStream()));

            // Prepare and send data:
            out.println(containerId + "|" + content);
            // Wait for the first line:
            data.append(in.readLine());
            // Continue as long as data is available:
            while (in.ready()) {
                data.append(in.readLine());
            }

            return data.toString();
        } finally {
            out.close();
            in.close();
            minaSocket.close();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>此示例实现指定以下数据和行为：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用基于套接字的通信以简化操作</p>
</li>
<li>
<p>依赖于KIE Server客户端的默认配置并使用<code>ServerUrl</code>用于提供MINA服务器的主机和端口</p>
</li>
<li>
<p>将JSON指定为编组格式</p>
</li>
<li>
<p>要求收到的消息是以方括号开头的JSON对象<code>{</code></p>
</li>
<li>
<p>在等待响应的第一行时使用与阻塞API的直接套接字通信，然后读取所有可用的行</p>
</li>
<li>
<p>不使用<em>流模式</em> ，因此在调用命令后断开KIE Server会话</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>实施<code>org.kie.server.client.helper.KieServicesClientBuilder</code>项目中的Java类中的接口，如以下示例所示：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">示例实现<code>KieServicesClientBuilder</code>接口</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MinaClientBuilderImpl implements KieServicesClientBuilder {  <i class="conum" data-value="1"></i><b>(1)</b>

    public String getImplementedCapability() {  <i class="conum" data-value="2"></i><b>(2)</b>
        return "BRM-Mina";
    }

    public Map&lt;Class&lt;?&gt;, Object&gt; build(KieServicesConfiguration configuration, ClassLoader classLoader) {  <i class="conum" data-value="3"></i><b>(3)</b>
        Map&lt;Class&lt;?&gt;, Object&gt; services = new HashMap&lt;Class&lt;?&gt;, Object&gt;();

        services.put(RulesMinaServicesClient.class, new RulesMinaServicesClientImpl(configuration, classLoader));

        return services;
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>使您能够向通用KIE Server客户端基础结构提供其他客户端API</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>定义客户端使用的KIE服务器功能（扩展）</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i> <b>3</b></td>
<td>提供客户端实现的映射，其中键是接口，值是完全初始化的实现</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</li>
<li>
<p>要使新的客户端API可被KIE Server客户端发现，请创建一个<code>META-INF/services/org.kie.server.client.helper.KieServicesClientBuilder</code>文件添加到您的Maven项目中，然后添加<code>KieServicesClientBuilder</code>文件中的实现类。对于此示例，文件包含单行<code>org.kie.server.ext.mina.client.MinaClientBuilderImpl</code> 。</p>
</li>
<li>
<p>构建您的项目，然后将生成的JAR文件复制到<code>~/kie-server.war/WEB-INF/lib</code>项目的目录。</p>
</li>
<li>
<p>启动KIE服务器，并将生成的项目部署到正在运行的KIE服务器。您可以使用Business Central界面或KIE Server REST API（a <code>PUT</code>请求<code>http://SERVER:PORT/kie-server/services/rest/server/containers/{containerId}</code> ）。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>将项目部署到正在运行的KIE Server上之后，您可以开始与新的KIE Server客户端进行交互。通过创建客户端配置和客户端实例，按类型检索服务客户端并调用客户端方法，可以以与标准KIE Server客户端相同的方式使用新客户端。</p>
</div>
<div class="paragraph">
<p>对于此示例，您可以创建一个<code>RulesMinaServiceClient</code>客户端实例并通过MINA传输在KIE服务器上调用操作：</p>
</div>
<div class="listingblock">
<div class="title">创建示例示例<code>RulesMinaServiceClient</code>客户</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">protected RulesMinaServicesClient buildClient() {
    KieServicesConfiguration configuration = KieServicesFactory.newRestConfiguration("localhost:9123", null, null);
    List&lt;String&gt; capabilities = new ArrayList&lt;String&gt;();
    // Explicitly add capabilities (the MINA client does not respond to `get-server-info` requests):
    capabilities.add("BRM-Mina");

    configuration.setCapabilities(capabilities);
    configuration.setMarshallingFormat(MarshallingFormat.JSON);

    configuration.addJaxbClasses(extraClasses);

    KieServicesClient kieServicesClient =  KieServicesFactory.newKieServicesClient(configuration);

    RulesMinaServicesClient rulesClient = kieServicesClient.getServicesClient(RulesMinaServicesClient.class);

    return rulesClient;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">通过MINA传输在KIE服务器上调用操作的示例配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RulesMinaServicesClient rulesClient = buildClient();

List&lt;Command&lt;?&gt;&gt; commands = new ArrayList&lt;Command&lt;?&gt;&gt;();
BatchExecutionCommand executionCommand = commandsFactory.newBatchExecution(commands, "defaultKieSession");

Person person = new Person();
person.setName("mary");
commands.add(commandsFactory.newInsert(person, "person"));
commands.add(commandsFactory.newFireAllRules("fired"));

ServiceResponse&lt;String&gt; response = rulesClient.executeCommands(containerId, executionCommand);
Assert.assertNotNull(response);

Assert.assertEquals(ResponseType.SUCCESS, response.getType());

String data = response.getResult();

Marshaller marshaller = MarshallerFactory.getMarshaller(extraClasses, MarshallingFormat.JSON, this.getClass().getClassLoader());

ExecutionResultImpl results = marshaller.unmarshall(data, ExecutionResultImpl.class);
Assert.assertNotNull(results);

Object personResult = results.getValue("person");
Assert.assertTrue(personResult instanceof Person);

Assert.assertEquals("mary", ((Person) personResult).getName());
Assert.assertEquals("JBoss Community", ((Person) personResult).getAddress());
Assert.assertEquals(true, ((Person) personResult).isRegistered());</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kie_server_setup"><a class="anchor" href="#_kie_server_setup"></a> <a class="link" href="#_kie_server_setup">19.5。Kie服务器设置</a></h3>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">
<div class="paragraph">
<p>与6.2版及更低版本相比，服务器设置和注册已发生重大变化。以下内容仅适用于6.3版及更高版本。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="_managed_kie_server"><a class="anchor" href="#_managed_kie_server"></a> <a class="link" href="#_managed_kie_server">19.5.1。托管Kie服务器</a></h4>
<div class="paragraph">
<p>托管实例是要求Drools控制器可用以正确启动Kie Server实例的实例。</p>
</div>
<div class="paragraph">
<p>Drools控制器是负责以集中方式维护和管理Kie Server配置的组件。每个Drools控制器可以一次管理多个配置，并且环境中可以有多个Drools控制器。托管的KIE服务器可以配置为Drools控制器列表，但一次只能连接一个。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>值得一提的是，即使可以有多个Drools控制器，它们也应保持同步，以确保无论KIE Server实例与哪一个控制器联系，它都将提供相同的配置。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>在启动时，如果为Kie Server配置了Drools控制器列表，它将连续尝试连接到每个控制器，直到与其中一个成功建立连接为止。如果由于某种原因无法建立连接，则即使配置中存在本地存储，服务器也不会启动。这是设计使然，以确保一致性。例如，如果Kie Server已关闭且配置已更改，则此限制可保证它将以最新配置运行或根本不运行。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>为了在独立模式下运行Kie Server而不连接任何Drools控制器，请参阅“非托管Kie Server”。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>该配置集包括：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>部署和启动Kie容器</p>
</li>
<li>
<p>配置项-当前是用于进一步增强功能的占位符，将允许远程配置KIE Execution Server组件-计时器，持久性等</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Drools控制器除了提供配置管理外，还负责Kie Server的整体管理。它提供了一个REST API，分为两个部分：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>与KIE Execution Server实例进行交互的Drools控制器本身</p>
</li>
<li>
<p>允许远程管理Kie Server实例的管理API：</p>
<div class="ulist">
<ul>
<li>
<p>添加/删除服务器</p>
</li>
<li>
<p>向服务器添加容器或从服务器删除容器</p>
</li>
<li>
<p>在服务器上启动/停止容器</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Drools控制器仅处理Kie Server的配置或定义，以不同的方式进行处理。它不处理KIE Execution Server实例的任何运行时组件。它们始终被视为Drools控制器的远程控制器。Drools控制器负责持久化配置，以保留Drools控制器本身的重启。如果配置了多个Drools控制器，以使Drools控制器的所有实例上的所有定义保持最新，它也应管理同步。</p>
</div>
<div class="paragraph">
<p>默认情况下，Drools控制器随Business Central一起提供，并提供功能齐全的管理界面（REST api和UI）。它使用基础git仓库作为持久性存储，因此，在对GIT仓库进行集群（使用Apache Zookeeper和Apache Helix）时，它还将涵盖Drools控制器同步。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./KieServer/kie-server-simple-architecture.png" alt="kie服务器简单架构">
</div>
</div>
<div class="paragraph">
<p>上图说明了单个Drools控制器（业务中心）的设置以及由其管理的多个Kie Server实例。</p>
</div>
<div class="paragraph">
<p>下图说明了集群设置，其中有多个通过Zookeeper同步的Drools控制器实例。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./KieServer/kie-server-architecture.png" alt="kie服务器架构">
</div>
</div>
<div class="paragraph">
<p>在上图中，我们可以看到Kie Server实例能够连接到任何Drools控制器，但是它们只能连接到一个。每个实例将尝试连接到Drools控制器，只要它可以达到一个即可。与Drools控制器之一建立连接后，它将跳过其他控制器。</p>
</div>
<div class="sect4">
<h5 id="_working_with_managed_servers"><a class="anchor" href="#_working_with_managed_servers"></a> <a class="link" href="#_working_with_managed_servers">19.5.1.1。使用托管服务器</a></h5>
<div class="paragraph">
<p>用户使用托管KIE Server实例时可以采用两种方法：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>首先配置：</em>使用这种方法，用户将开始使用Drools控制器（UI或REST api）并创建和配置Kie Server定义。这基本上包括服务器定义的标识（标识和名称+可选的版本，以提高可读性）和要在服务器上运行的Kie Containers的配置。</p>
</li>
<li>
<p><em>首先注册：</em>使用这种方法，首先启动Kie Server实例，然后在Drools控制器上自动注册自己。然后，用户可以配置Kie容器。此选项仅跳过第一种方法中完成的注册步骤，并在自动注册后直接用服务器ID，名称和版本填充它。两种方法之间没有其他区别。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_unmanaged_kie_execution_server"><a class="anchor" href="#_unmanaged_kie_execution_server"></a> <a class="link" href="#_unmanaged_kie_execution_server">19.5.2。非托管KIE执行服务器</a></h4>
<div class="paragraph">
<p>反过来，非托管的Kie Server只是一个独立的实例，因此必须使用Kie Server本身的REST / JMS api进行单独配置。没有涉及Drools控制器。服务器自动将配置保存到一个文件中，以便在重新启动时用作内部服务器状态。</p>
</div>
<div class="paragraph">
<p>在以下操作期间将更新配置：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>部署Kie Container</p>
</li>
<li>
<p>取消部署Kie Container</p>
</li>
<li>
<p>启动Kie Container</p>
</li>
<li>
<p>停止Kie Container</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果Kie Server重新启动，它将尝试重新建立与关机前相同的状态。这意味着正在运行的Kie容器将被启动，而之前已停止/处置的Kie容器将不会被启动。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>在大多数使用情况下，应该在托管模式下执行Kie Server，因为这样做可以带来一些好处，例如Web用户界面（如果使用Business Central作为Drools控制器）和一些集群功能。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_kie_container"><a class="anchor" href="#_creating_a_kie_container"></a> <a class="link" href="#_creating_a_kie_container">19.6。创建一个Kie容器</a></h3>
<div class="paragraph">
<p>一旦注册了执行服务器，就可以开始向其添加<strong>Kie Containers</strong> 。</p>
</div>
<div class="paragraph">
<p><strong>Kie容器</strong>是自包含的环境，已调配以容纳打包和部署的规则实例的实例。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>首先，单击要在其中部署Container的Execution Server旁边的<strong>\ +</strong>图标。这将显示“新建容器”屏幕。</p>
</li>
<li>
<p>如果您知道已部署程序包的<strong>组名称</strong> ， <strong>工件标识</strong>和<strong>版本</strong> （GAV），则可以输入这些详细信息，然后单击“确定”按钮以选择该实例（并为容器提供名称）；</p>
</li>
<li>
<p>如果您不知道这些值，则可以在Business Central中搜索所有可以部署的软件包。单击<strong>搜索</strong>按钮，而不在搜索字段中输入任何值（您可以通过输入要部署的程序包中已知的任何术语来缩小搜索范围）。</p>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在此处插入屏幕快照</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>上图显示，有三个可部署的软件包可用作Execution Server上的容器。通过单击“选择”按钮选择所需的一个。这将自动填充<strong>GAV</strong> ，然后您可以单击“ <strong>确定”</strong>按钮以将此可部署对象用作新容器。</p>
</div>
</li>
<li>
<p>在顶部输入此容器的名称，然后按确定按钮。</p>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">
<div class="paragraph">
<p>容器名称在每个执行服务器内必须唯一，并且不能包含任何空格。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在<strong>GAV</strong>行的正下方，您将看到一个不可编辑的行，该行向您显示您可以针对其执行REST命令的Container的<strong>URL</strong> 。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_managing_containers"><a class="anchor" href="#_managing_containers"></a> <a class="link" href="#_managing_containers">19.7。管理容器</a></h3>
<div class="paragraph">
<p>可以从Business Central中启动，停止和更新Execution Server中的容器。</p>
</div>
<div class="sect3">
<h4 id="_starting_a_container"><a class="anchor" href="#_starting_a_container"></a> <a class="link" href="#_starting_a_container">19.7.1。启动容器</a></h4>
<div class="paragraph">
<p>注册后，容器将处于“停止”模式。可以先选择它，然后单击“开始”按钮来启动它。您也可以选择多个容器并同时启动它们。</p>
</div>
<div class="paragraph">
<p>容器处于“运行”模式后，其旁边会出现一个绿色箭头。如果启动容器时发生任何错误，则在容器及其部署到的服务器和执行服务器旁边会出现红色图标。</p>
</div>
<div class="paragraph">
<p>在重新部署容器（和可能的执行服务器）之前，应该检查Execution Server和当前Business Central的日志，以查看错误所在。</p>
</div>
</div>
<div class="sect3">
<h4 id="_stopping_and_deleting_a_container"><a class="anchor" href="#_stopping_and_deleting_a_container"></a> <a class="link" href="#_stopping_and_deleting_a_container">19.7.2。停止和删除容器</a></h4>
<div class="paragraph">
<p>与启动容器类似，选择要停止（或删除）的容器，然后单击“停止”按钮（一旦该容器进入“运行”模式，它将替换为“开始”按钮）或“删除”按钮。 ⁠</p>
</div>
</div>
<div class="sect3">
<h4 id="_updating_a_container"><a class="anchor" href="#_updating_a_container"></a> <a class="link" href="#_updating_a_container">19.7.3。更新容器</a></h4>
<div class="paragraph">
<p>您可以更新部署<code>KieContainers</code>无需重新启动执行服务器。这在业务规则更改，创建要配置的软件包的新版本的情况下很有用。</p>
</div>
<div class="paragraph">
<p>您可以配置和部署同一程序包的多个版本，每个版本都不同<code>KieContainer</code> 。</p>
</div>
<div class="paragraph">
<p>更新服务器中的部署<code>KieContainer</code>动态地，单击“容器”旁边的图标。这将打开“容器信息”屏幕。此屏幕的示例如下所示：</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在此处插入屏幕快照</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>“容器信息”屏幕是一个有用的工具，因为它不仅允许您查看该端点<code>KieContainer</code> ，但如果有更新，它还允许您手动或自动刷新配置。更新可以是手动的也可以是自动的：</p>
</div>
<div class="paragraph">
<p><strong>手动更新：</strong>要手动更新<code>KieContainer</code> ，在“版本”框中输入新的“版本号”，然后单击“ <strong>更新”</strong>按钮。当然，您也可以更新Group ID或Artifact Id（如果它们也已更改）。更新后，执行服务器将更新容器，并在屏幕底部“ <strong>已解决的发行ID”</strong>部分中显示<strong>已</strong>解决的GAV属性。</p>
</div>
<div class="paragraph">
<p><strong>自动更新：</strong>如果您希望已部署的Container始终具有最新版本的部署而无需手动编辑它，则需要将Version属性设置为的值。 <code>LATEST</code>然后开始<code>Scanner</code> 。这将确保部署的配置始终包含最新版本。单击“立即扫描”按钮可以按需启动扫描仪一次，也可以在后台以指定的间隔（以毫秒为单位）进行扫描的情况下启动扫描仪。您也可以将此值设置为<code>LATEST</code>首次创建此部署时。在这种情况下， <strong>已解决的发行ID</strong>将为您显示实际的最新版本号。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kie-server-rest-api-con_kie-apis"><a class="anchor" href="#kie-server-rest-api-con_kie-apis"></a> <a class="link" href="#kie-server-rest-api-con_kie-apis">19.8。适用于KIE容器和企业资产的KIE Server REST API</a></h3>
<div class="paragraph">
<p>Drools提供了一个KIE Server REST API，您可以使用它与Drools中的KIE容器和业务资产（例如业务规则，流程和求解器）进行交互，而无需使用Business Central用户界面。此API支持使您能够更有效地维护Drools资源，并优化与Drools的集成和开发。</p>
</div>
<div class="paragraph">
<p>使用KIE Server REST API，您可以执行以下操作：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>部署或处置KIE容器</p>
</li>
<li>
<p>检索和更新KIE容器信息</p>
</li>
<li>
<p>返回KIE服务器状态和基本信息</p>
</li>
<li>
<p>检索和更新业务资产信息</p>
</li>
<li>
<p>执行业务资产（例如规则和流程）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>KIE Server REST API请求需要以下组件：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">认证方式</dt>
<dd>
<p>KIE Server REST API需要针对用户角色的HTTP基本身份验证或基于令牌的身份验证<code>kie-server</code> 。要查看您的Drools发行版的已配置用户角色，请导航至<code>~/$SERVER_HOME/standalone/configuration/application-roles.properties</code>和<code>~/application-users.properties</code> 。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>要为用户添加<code>kie-server</code>角色，导航至<code>~/$SERVER_HOME/bin</code>并运行以下命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./add-user.sh -a --user &lt;USERNAME&gt; --password &lt;PASSWORD&gt; --role kie-server</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关用户角色和Drools安装选项的更多信息，请参见<a href="#_installing_the_kie_server">安装KIE服务器</a> 。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">HTTP标头</dt>
<dd>
<p>KIE Server REST API需要以下HTTP标头来处理API请求：</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code> ：请求客户接受的数据格式：</p>
<div class="ulist">
<ul>
<li>
<p><code>application/json</code> （JSON）</p>
</li>
<li>
<p><code>application/xml</code> （XML，用于JAXB或XSTREAM）</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Content-Type</code> ：您的数据格式<code>POST</code>要么<code>PUT</code> API请求数据：</p>
<div class="ulist">
<ul>
<li>
<p><code>application/json</code> （JSON）</p>
</li>
<li>
<p><code>application/xml</code> （XML，用于JAXB或XSTREAM）</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>X-KIE-ContentType</code> ：的必需标头<code>application/xml</code> XSTREAM API请求和响应：</p>
<div class="ulist">
<ul>
<li>
<p><code>XSTREAM</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">HTTP方法</dt>
<dd>
<p>KIE Server REST API支持以下针对API请求的HTTP方法：</p>
<div class="ulist">
<ul>
<li>
<p><code>GET</code> ：从指定的资源端点检索指定的信息</p>
</li>
<li>
<p><code>POST</code> ：更新资源或资源实例</p>
</li>
<li>
<p><code>PUT</code> ：更新或创建资源或资源实例</p>
</li>
<li>
<p><code>DELETE</code> ：删除资源或资源实例</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">基本网址</dt>
<dd>
<p>KIE Server REST API请求的基本URL是<code>http://SERVER:PORT/kie-server/services/rest/</code> ， 如<code>http://localhost:8080/kie-server/services/rest/</code> 。</p>
</dd>
<dt class="hdlist1">终点</dt>
<dd>
<p>KIE Server REST API端点，例如<code>/server/containers/{containerId}</code>对于指定的KIE容器，是您附加到KIE Server REST API基本URL的URI，以访问Drools中的相应资源或资源类型。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<div class="title">的请求网址示例<code>/server/containers/{containerId}</code>终点</div>
<p><code>http://localhost:8080/kie-server/services/rest/server/containers/MyContainer</code></p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">请求参数和请求数据</dt>
<dd>
<p>许多KIE Server REST API请求在请求URL路径中需要特定的参数，以标识或过滤特定的资源并执行特定的操作。您可以将URL参数以以下格式附加到端点<code>?<PARAM>=<VALUE>&<PARAM>=<VALUE></code> 。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<div class="title">带有参数的示例GET请求URL</div>
<p><code>http://localhost:8080/kie-server/services/rest/server/containers?groupId=com.redhat&artifactId=Project1&version=1.0&status=STARTED</code></p>
</div>
<div class="paragraph">
<p>HTTP <code>POST</code>和<code>PUT</code>请求可能另外需要带有数据的请求正文或文件，以伴随该请求。</p>
</div>
<div class="paragraph">
<div class="title">示例POST请求URL和JSON请求正文数据</div>
<p><code>http://localhost:8080/kie-server/services/rest/server/containers/MyContainer/release-id</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "release-id": {
    "artifact-id": "Project1",
    "group-id": "com.redhat",
    "version": "1.1"
  }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="kie-server-rest-api-requests-proc_kie-apis"><a class="anchor" href="#kie-server-rest-api-requests-proc_kie-apis"></a> <a class="link" href="#kie-server-rest-api-requests-proc_kie-apis">19.8.1。使用REST客户端或curl实用程序通过KIE Server REST API发送请求</a></h4>
<div class="paragraph">
<p>通过KIE Server REST API，您可以在Drools中与KIE容器和业务资产（例如业务规则，流程和求解器）进行交互，而无需使用Business Central用户界面。您可以使用任何REST客户端或curl实用程序发送KIE Server REST API请求。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>KIE服务器已安装并正在运行。</p>
</li>
<li>
<p>你有<code>kie-server</code>用户角色访问KIE服务器。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>标识要向其发送请求的相关<a href="#kie-server-rest-api-endpoints-ref_kie-apis">API端点</a> ，例如<code>[GET] /server/containers</code>从KIE服务器检索KIE容器。</p>
</li>
<li>
<p>在REST客户端或curl实用程序中，为<code>GET</code>请求<code>/server/containers</code> 。根据您的用例调整任何请求详细信息。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>对于REST客户端：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>身份验证</strong> ：使用以下命令输入KIE Server用户的用户名和密码： <code>kie-server</code>角色。</p>
</li>
<li>
<p><strong>HTTP标头</strong> ：设置以下标头：</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code> ：<code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>HTTP方法</strong> ：设置为<code>GET</code> 。</p>
</li>
<li>
<p><strong>URL</strong> ：输入KIE Server REST API的基本URL和端点，例如<code>http://localhost:8080/kie-server/services/rest/server/containers</code> 。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>对于curl实用程序：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-u</code> ：使用以下命令输入KIE Server用户的用户名和密码： <code>kie-server</code>角色。</p>
</li>
<li>
<p><code>-H</code> ：设置以下标题：</p>
<div class="ulist">
<ul>
<li>
<p><code>accept</code> ：<code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>-X</code> ： 调成<code>GET</code> 。</p>
</li>
<li>
<p><strong>URL</strong> ：输入KIE Server REST API的基本URL和端点，例如<code>http://localhost:8080/kie-server/services/rest/server/containers</code> 。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -X GET "http://localhost:8080/kie-server/services/rest/server/containers"</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>执行请求并查看KIE服务器响应。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>服务器响应示例（JSON）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "SUCCESS",
  "msg": "List of created containers",
  "result": {
    "kie-containers": {
      "kie-container": [
        {
          "container-id": "itorders_1.0.0-SNAPSHOT",
          "release-id": {
            "group-id": "itorders",
            "artifact-id": "itorders",
            "version": "1.0.0-SNAPSHOT"
          },
          "resolved-release-id": {
            "group-id": "itorders",
            "artifact-id": "itorders",
            "version": "1.0.0-SNAPSHOT"
          },
          "status": "STARTED",
          "scanner": {
            "status": "DISPOSED",
            "poll-interval": null
          },
          "config-items": [],
          "container-alias": "itorders"
        }
      ]
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>对于此示例，复制或记录项目<code>group-id</code> ， <code>artifact-id</code>和<code>version</code>响应中返回的已部署KIE容器之一的（GAV）数据。</p>
</li>
<li>
<p>在您的REST客户端或curl实用程序中，使用以下组件发送另一个API请求： <code>PUT</code>请求<code>/server/containers/{containerId}</code>使用复制的项目GAV数据部署新的KIE容器。根据您的用例调整任何请求详细信息。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>对于REST客户端：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>身份验证</strong> ：使用以下命令输入KIE Server用户的用户名和密码： <code>kie-server</code>角色。</p>
</li>
<li>
<p><strong>HTTP标头</strong> ：设置以下标头：</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code> ：<code>application/json</code></p>
</li>
<li>
<p><code>Content-Type</code> ：<code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>HTTP方法</strong> ：设置为<code>PUT</code> 。</p>
</li>
<li>
<p><strong>URL</strong> ：输入KIE Server REST API的基本URL和端点，例如<code>http://localhost:8080/kie-server/services/rest/server/containers/MyContainer</code> 。</p>
</li>
<li>
<p><strong>请求正文</strong> ：添加带有新KIE容器配置项的JSON请求正文：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "config-items": [
    {
      "itemName": "RuntimeStrategy",
      "itemValue": "SINGLETON",
      "itemType": "java.lang.String"
    },
    {
      "itemName": "MergeMode",
      "itemValue": "MERGE_COLLECTIONS",
      "itemType": "java.lang.String"
    },
    {
      "itemName": "KBase",
      "itemValue": "",
      "itemType": "java.lang.String"
    },
    {
      "itemName": "KSession",
      "itemValue": "",
      "itemType": "java.lang.String"
    }
  ],
  "release-id": {
    "group-id": "itorders",
    "artifact-id": "itorders",
    "version": "1.0.0-SNAPSHOT"
  },
  "scanner": {
    "poll-interval": "5000",
    "status": "STARTED"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于curl实用程序：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-u</code> ：使用以下命令输入KIE Server用户的用户名和密码： <code>kie-server</code>角色。</p>
</li>
<li>
<p><code>-H</code> ：设置以下标题：</p>
<div class="ulist">
<ul>
<li>
<p><code>accept</code> ：<code>application/json</code></p>
</li>
<li>
<p><code>content-type</code> ：<code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>-X</code> ： 调成<code>PUT</code> 。</p>
</li>
<li>
<p><strong>URL</strong> ：输入KIE Server REST API的基本URL和端点，例如<code>http://localhost:8080/kie-server/services/rest/server/containers/MyContainer</code> 。</p>
</li>
<li>
<p><code>-d</code> ：添加JSON请求正文或文件（ <code>@file.json</code> ）以及新KIE容器的配置项：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -H "content-type: application/json" -X PUT "http://localhost:8080/kie-server/services/rest/server/containers/MyContainer" -d "{ \"config-items\": [ { \"itemName\": \"RuntimeStrategy\", \"itemValue\": \"SINGLETON\", \"itemType\": \"java.lang.String\" }, { \"itemName\": \"MergeMode\", \"itemValue\": \"MERGE_COLLECTIONS\", \"itemType\": \"java.lang.String\" }, { \"itemName\": \"KBase\", \"itemValue\": \"\", \"itemType\": \"java.lang.String\" }, { \"itemName\": \"KSession\", \"itemValue\": \"\", \"itemType\": \"java.lang.String\" } ], \"release-id\": { \"group-id\": \"itorders\", \"artifact-id\": \"itorders\", \"version\": \"1.0.0-SNAPSHOT\" }, \"scanner\": { \"poll-interval\": \"5000\", \"status\": \"STARTED\" }}"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -H "content-type: application/json" -X PUT "http://localhost:8080/kie-server/services/rest/server/containers/MyContainer" -d @my-container-configs.json</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>执行请求并查看KIE服务器响应。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>服务器响应示例（JSON）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "SUCCESS",
  "msg": "Container MyContainer successfully deployed with module itorders:itorders:1.0.0-SNAPSHOT.",
  "result": {
    "kie-container": {
      "container-id": "MyContainer",
      "release-id": {
        "group-id": "itorders",
        "artifact-id": "itorders",
        "version": "1.0.0-SNAPSHOT"
      },
      "resolved-release-id": {
        "group-id": "itorders",
        "artifact-id": "itorders",
        "version": "1.0.0-SNAPSHOT"
      },
      "status": "STARTED",
      "scanner": {
        "status": "STARTED",
        "poll-interval": 5000
      },
      "config-items": [],
      "messages": [
        {
          "severity": "INFO",
          "timestamp": {
            "java.util.Date": 1540584717937
          },
          "content": [
            "Container MyContainer successfully created with module itorders:itorders:1.0.0-SNAPSHOT."
          ]
        }
      ],
      "container-alias": null
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果遇到请求错误，请查看返回的错误代码消息并相应地调整您的请求。</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="kie-server-rest-api-requests-swagger-proc_kie-apis"><a class="anchor" href="#kie-server-rest-api-requests-swagger-proc_kie-apis"></a> <a class="link" href="#kie-server-rest-api-requests-swagger-proc_kie-apis">19.8.2。使用Swagger接口通过KIE Server REST API发送请求</a></h4>
<div class="paragraph">
<p>KIE Server REST API支持Swagger Web界面，您可以使用它而不是独立的REST客户端或curl实用程序来与Drools中的KIE容器和业务资产（例如业务规则，流程和求解器）进行交互，而无需使用Business Central用户界面。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">默认情况下，KIE Server的Swagger Web界面由<code>org.kie.swagger.server.ext.disabled=false</code>系统属性。要在KIE Server中禁用Swagger Web界面，请将此系统属性设置为<code>true</code> 。
</td>
</tr>
</tbody></table>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>KIE服务器已安装并正在运行。</p>
</li>
<li>
<p>你有<code>kie-server</code>用户角色访问KIE服务器。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在网络浏览器中，导航到<code>http://SERVER:PORT/kie-server/docs</code> ， 如<code>http://localhost:8080/kie-server/docs</code> ，然后使用KIE Server用户的用户名和密码登录。 <code>kie-server</code>角色。</p>
</li>
<li>
<p>在Swagger页面中，选择要向其发送请求的相关API端点，例如<strong>KIE Server和KIE容器</strong> → <strong>[GET] / server / containers</strong>以从KIE Server检索KIE容器。</p>
</li>
<li>
<p>单击“ <strong>试用”，</strong>并根据需要提供要用来过滤结果的所有可选参数。</p>
</li>
<li>
<p>在“ <strong>响应内容类型”</strong>下拉菜单中，选择服务器响应的所需格式，例如JSON格式的<strong>application / json</strong> 。</p>
</li>
<li>
<p>单击<strong>执行</strong>并查看KIE服务器响应。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>服务器响应示例（JSON）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "SUCCESS",
  "msg": "List of created containers",
  "result": {
    "kie-containers": {
      "kie-container": [
        {
          "container-id": "itorders_1.0.0-SNAPSHOT",
          "release-id": {
            "group-id": "itorders",
            "artifact-id": "itorders",
            "version": "1.0.0-SNAPSHOT"
          },
          "resolved-release-id": {
            "group-id": "itorders",
            "artifact-id": "itorders",
            "version": "1.0.0-SNAPSHOT"
          },
          "status": "STARTED",
          "scanner": {
            "status": "DISPOSED",
            "poll-interval": null
          },
          "config-items": [],
          "container-alias": "itorders"
        }
      ]
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>对于此示例，复制或记录项目<code>group-id</code> ， <code>artifact-id</code>和<code>version</code>响应中返回的已部署KIE容器之一的（GAV）数据。</p>
</li>
<li>
<p>在Swagger页面中，导航到<strong>KIE Server和KIE容器</strong> → <strong>[PUT] / server / containers / {containerId}</strong>端点，以发送另一个请求，以使用复制的项目GAV数据部署新的KIE容器。根据您的用例调整任何请求详细信息。</p>
</li>
<li>
<p>单击“ <strong>试用”，</strong>然后为请求输入以下组件：</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>containerId</strong> ：输入新KIE容器的ID，例如<code>MyContainer</code> 。</p>
</li>
<li>
<p><strong>body</strong> ：将<strong>Parameter内容类型</strong>设置为所需的请求正文格式，例如JSON格式的<strong>application / json</strong> ，并添加带有新KIE容器配置项的请求正文：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "config-items": [
    {
      "itemName": "RuntimeStrategy",
      "itemValue": "SINGLETON",
      "itemType": "java.lang.String"
    },
    {
      "itemName": "MergeMode",
      "itemValue": "MERGE_COLLECTIONS",
      "itemType": "java.lang.String"
    },
    {
      "itemName": "KBase",
      "itemValue": "",
      "itemType": "java.lang.String"
    },
    {
      "itemName": "KSession",
      "itemValue": "",
      "itemType": "java.lang.String"
    }
  ],
  "release-id": {
    "group-id": "itorders",
    "artifact-id": "itorders",
    "version": "1.0.0-SNAPSHOT"
  },
  "scanner": {
    "poll-interval": "5000",
    "status": "STARTED"
  }
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>在“ <strong>响应内容类型”</strong>下拉菜单中，选择服务器响应的所需格式，例如JSON格式的<strong>application / json</strong> 。</p>
</li>
<li>
<p>单击<strong>执行</strong>并查看KIE服务器响应。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>服务器响应示例（JSON）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "SUCCESS",
  "msg": "Container MyContainer successfully deployed with module itorders:itorders:1.0.0-SNAPSHOT.",
  "result": {
    "kie-container": {
      "container-id": "MyContainer",
      "release-id": {
        "group-id": "itorders",
        "artifact-id": "itorders",
        "version": "1.0.0-SNAPSHOT"
      },
      "resolved-release-id": {
        "group-id": "itorders",
        "artifact-id": "itorders",
        "version": "1.0.0-SNAPSHOT"
      },
      "status": "STARTED",
      "scanner": {
        "status": "STARTED",
        "poll-interval": 5000
      },
      "config-items": [],
      "messages": [
        {
          "severity": "INFO",
          "timestamp": {
            "java.util.Date": 1540584717937
          },
          "content": [
            "Container MyContainer successfully created with module itorders:itorders:1.0.0-SNAPSHOT."
          ]
        }
      ],
      "container-alias": null
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果遇到请求错误，请查看返回的错误代码消息并相应地调整您的请求。</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="kie-server-rest-api-endpoints-ref_kie-apis"><a class="anchor" href="#kie-server-rest-api-endpoints-ref_kie-apis"></a> <a class="link" href="#kie-server-rest-api-endpoints-ref_kie-apis">19.8.3。支持的KIE Server REST API端点</a></h4>
<div class="paragraph">
<p>KIE Server REST API为Drools中的以下类型的资源提供了端点：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>KIE服务器和KIE容器</p>
</li>
<li>
<p>KIE会话资产（用于运行时命令）</p>
</li>
<li>
<p>DMN资产</p>
</li>
<li>
<p>规划求解器</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>KIE Server REST API的基本URL是<code>http://SERVER:PORT/kie-server/services/rest/</code> 。对于所有请求，所有请求都需要HTTP基本身份验证或基于令牌的身份验证<code>kie-server</code>用户角色。</p>
</div>
<div class="paragraph">
<p>有关KIE Server REST API端点和描述的完整列表，请使用以下资源之一：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>jBPM文档页面上的<a href="http://jbpm.org/learn/documentation.html">Execution Server REST API</a> （静态）</p>
</li>
<li>
<p>用于KIE Server REST API的Swagger UI，位于<code>http://SERVER:PORT/kie-server/docs</code> （动态，需要运行KIE Server）</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">默认情况下，KIE Server的Swagger Web界面由<code>org.kie.swagger.server.ext.disabled=false</code>系统属性。要在KIE Server中禁用Swagger Web界面，请将此系统属性设置为<code>true</code> 。
</td>
</tr>
</tbody></table>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kie-server-java-api-con_kie-apis"><a class="anchor" href="#kie-server-java-api-con_kie-apis"></a> <a class="link" href="#kie-server-java-api-con_kie-apis">19.9。用于KIE容器和业务资产的KIE Server Java客户端API</a></h3>
<div class="paragraph">
<p>Drools提供了一个KIE Server Java客户端API，使您能够使用Java客户端应用程序中的REST协议连接到KIE Server。您可以使用KIE Server Java客户端API替代KIE Server REST API，从而在不使用Business Central用户界面的情况下与Drools中的KIE容器和业务资产（例如业务规则，流程和求解器）进行交互。此API支持使您能够更有效地维护Drools资源，并优化与Drools的集成和开发。</p>
</div>
<div class="paragraph">
<p>使用KIE Server Java客户端API，您可以执行KIE Server REST API也支持的以下操作：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>部署或处置KIE容器</p>
</li>
<li>
<p>检索和更新KIE容器信息</p>
</li>
<li>
<p>返回KIE服务器状态和基本信息</p>
</li>
<li>
<p>检索和更新业务资产信息</p>
</li>
<li>
<p>执行业务资产（例如规则和流程）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>KIE Server Java客户端API请求需要以下组件：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">认证方式</dt>
<dd>
<p>KIE Server Java客户端API需要针对用户角色的HTTP基本身份验证<code>kie-server</code> 。要查看您的Drools发行版的已配置用户角色，请导航至<code>~/$SERVER_HOME/standalone/configuration/application-roles.properties</code>和<code>~/application-users.properties</code> 。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>要为用户添加<code>kie-server</code>角色，导航至<code>~/$SERVER_HOME/bin</code>并运行以下命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./add-user.sh -a --user &lt;USERNAME&gt; --password &lt;PASSWORD&gt; --role kie-server</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关用户角色和Drools安装选项的更多信息，请参见<a href="#_installing_the_kie_server">安装KIE服务器</a> 。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">项目依赖</dt>
<dd>
<p>KIE Server Java客户端API需要对Java项目的相关类路径具有以下依赖关系：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- For remote execution on KIE Server --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
  &lt;artifactId&gt;kie-server-client&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For runtime commands --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
  &lt;scope&gt;runtime&lt;/scope&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For debug logging (optional) --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
  &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
  &lt;version&gt;${logback.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code><version></code> for Drools依赖项是项目中当前使用的Drools的Maven工件版本（例如7.26.0）。Final-redhat-00005）。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">客户端请求配置</dt>
<dd>
<p>使用KIE Server Java客户端API的所有Java客户端请求必须至少定义以下服务器通信组件：</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>凭证<code>kie-server</code>用户</p>
</li>
<li>
<p>KIE服务器位置，例如<code>http://localhost:8080/kie-server/services/rest/server</code></p>
</li>
<li>
<p>API请求和响应的编组格式（JSON，JAXB或XSTREAM）</p>
</li>
<li>
<p>一种<code>KieServicesConfiguration</code>对象和一个<code>KieServicesClient</code>对象，用作使用Java客户端API启动服务器通信的入口点</p>
</li>
<li>
<p>一种<code>KieServicesFactory</code>定义REST协议和用户访问的对象</p>
</li>
<li>
<p>使用的任何其他客户端服务，例如<code>RuleServicesClient</code> ， <code>ProcessServicesClient</code> ， 要么<code>QueryServicesClient</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以下是带有这些组件的基本和高级客户端配置的示例：</p>
</div>
<div class="listingblock">
<div class="title">基本客户端配置示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.server.api.marshalling.MarshallingFormat;
import org.kie.server.client.KieServicesClient;
import org.kie.server.client.KieServicesConfiguration;
import org.kie.server.client.KieServicesFactory;

public class MyConfigurationObject {

  private static final String URL = "http://localhost:8080/kie-server/services/rest/server";
  private static final String USER = "baAdmin";
  private static final String PASSWORD = "password@1";

  private static final MarshallingFormat FORMAT = MarshallingFormat.JSON;

  private static KieServicesConfiguration conf;
  private static KieServicesClient kieServicesClient;

  public static void initialize() {
    conf = KieServicesFactory.newRestConfiguration(URL, USER, PASSWORD);

    //If you use custom classes, such as Obj.class, add them to the configuration.
    Set&lt;Class&lt;?&gt;&gt; extraClassList = new HashSet&lt;Class&lt;?&gt;&gt;();
    extraClassList.add(Obj.class);
    conf.addExtraClasses(extraClassList);

    conf.setMarshallingFormat(FORMAT);
    kieServicesClient = KieServicesFactory.newKieServicesClient(conf);
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">具有其他客户端服务的高级客户端配置示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.server.api.marshalling.MarshallingFormat;
import org.kie.server.client.CaseServicesClient;
import org.kie.server.client.DMNServicesClient;
import org.kie.server.client.DocumentServicesClient;
import org.kie.server.client.JobServicesClient;
import org.kie.server.client.KieServicesClient;
import org.kie.server.client.KieServicesConfiguration;
import org.kie.server.client.KieServicesFactory;
import org.kie.server.client.ProcessServicesClient;
import org.kie.server.client.QueryServicesClient;
import org.kie.server.client.RuleServicesClient;
import org.kie.server.client.SolverServicesClient;
import org.kie.server.client.UIServicesClient;
import org.kie.server.client.UserTaskServicesClient;
import org.kie.server.api.model.instance.ProcessInstance;
import org.kie.server.api.model.KieContainerResource;
import org.kie.server.api.model.ReleaseId;

public class MyAdvancedConfigurationObject {

    // REST API base URL, credentials, and marshalling format
    private static final String URL = "http://localhost:8080/kie-server/services/rest/server";
    private static final String USER = "baAdmin";
    private static final String PASSWORD = "password@1";;

    private static final MarshallingFormat FORMAT = MarshallingFormat.JSON;

    private static KieServicesConfiguration conf;

    // KIE client for common operations
    private static KieServicesClient kieServicesClient;

    // Rules client
    private static RuleServicesClient ruleClient;

    // Process automation clients
    private static CaseServicesClient caseClient;
    private static DocumentServicesClient documentClient;
    private static JobServicesClient jobClient;
    private static ProcessServicesClient processClient;
    private static QueryServicesClient queryClient;
    private static UIServicesClient uiClient;
    private static UserTaskServicesClient userTaskClient;

    // DMN client
    private static DMNServicesClient dmnClient;

    // Planning client
    private static SolverServicesClient solverClient;

    public static void main(String[] args) {
        initializeKieServerClient();
        initializeDroolsServiceClients();
        initializeJbpmServiceClients();
        initializeSolverServiceClients();
    }

    public static void initializeKieServerClient() {
        conf = KieServicesFactory.newRestConfiguration(URL, USER, PASSWORD);
        conf.setMarshallingFormat(FORMAT);
        kieServicesClient = KieServicesFactory.newKieServicesClient(conf);
    }

    public static void initializeDroolsServiceClients() {
        ruleClient = kieServicesClient.getServicesClient(RuleServicesClient.class);
        dmnClient = kieServicesClient.getServicesClient(DMNServicesClient.class);
    }

    public static void initializeJbpmServiceClients() {
        caseClient = kieServicesClient.getServicesClient(CaseServicesClient.class);
        documentClient = kieServicesClient.getServicesClient(DocumentServicesClient.class);
        jobClient = kieServicesClient.getServicesClient(JobServicesClient.class);
        processClient = kieServicesClient.getServicesClient(ProcessServicesClient.class);
        queryClient = kieServicesClient.getServicesClient(QueryServicesClient.class);
        uiClient = kieServicesClient.getServicesClient(UIServicesClient.class);
        userTaskClient = kieServicesClient.getServicesClient(UserTaskServicesClient.class);
    }

    public static void initializeSolverServiceClients() {
        solverClient = kieServicesClient.getServicesClient(SolverServicesClient.class);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="kie-server-java-api-requests-proc_kie-apis"><a class="anchor" href="#kie-server-java-api-requests-proc_kie-apis"></a> <a class="link" href="#kie-server-java-api-requests-proc_kie-apis">19.9.1。使用KIE Server Java客户端API发送请求</a></h4>
<div class="paragraph">
<p>通过KIE Server Java客户端API，您可以使用Java客户端应用程序中的REST协议连接到KIE Server。您可以使用KIE Server Java客户端API替代KIE Server REST API，从而在不使用Business Central用户界面的情况下与Drools中的KIE容器和业务资产（例如业务规则，流程和求解器）进行交互。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>KIE服务器已安装并正在运行。</p>
</li>
<li>
<p>你有<code>kie-server</code>用户角色访问KIE服务器。</p>
</li>
<li>
<p>您有一个带有Drools资源的Java项目。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在客户端应用程序中，确保已将以下依赖项添加到Java项目的相关类路径中：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- For remote execution on KIE Server --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
  &lt;artifactId&gt;kie-server-client&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For runtime commands --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;drools-compiler&lt;/artifactId&gt;
  &lt;scope&gt;runtime&lt;/scope&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For debug logging (optional) --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
  &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
  &lt;version&gt;${logback.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>在里面<code>~/kie/server/client</code> <a href="https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-remote/kie-server-client/src/main/java/org/kie/server/client">GitHub中</a> Java客户端API的文件夹，标识要发送的请求的相关Java客户端，例如<code>KieServicesClient</code>访问KIE容器和KIE Server中其他资产的客户端服务。</p>
</li>
<li>
<p>在您的客户端应用程序中，创建一个<code>.java</code> API请求的类。该类必须包含必要的导入，KIE Server位置和用户凭据， <code>KieServicesClient</code>对象以及要执行的客户端方法，例如<code>createContainer</code>和<code>disposeContainer</code>来自<code>KieServicesClient</code>客户。根据您的用例调整任何配置详细信息。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">创建和处置容器</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.server.api.marshalling.MarshallingFormat;
import org.kie.server.client.KieServicesClient;
import org.kie.server.client.KieServicesConfiguration;
import org.kie.server.client.KieServicesFactory;
import org.kie.server.api.model.KieContainerResource;
import org.kie.server.api.model.ServiceResponse;

public class MyConfigurationObject {

  private static final String URL = "http://localhost:8080/kie-server/services/rest/server";
  private static final String USER = "baAdmin";
  private static final String PASSWORD = "password@1";

  private static final MarshallingFormat FORMAT = MarshallingFormat.JSON;

  private static KieServicesConfiguration conf;
  private static KieServicesClient kieServicesClient;

  public static void initialize() {
    conf = KieServicesFactory.newRestConfiguration(URL, USER, PASSWORD);

  public void disposeAndCreateContainer() {
      System.out.println("== Disposing and creating containers ==");

      // Retrieve list of KIE containers
      List&lt;KieContainerResource&gt; kieContainers = kieServicesClient.listContainers().getResult().getContainers();
      if (kieContainers.size() == 0) {
          System.out.println("No containers available...");
          return;
      }

      // Dispose KIE container
      KieContainerResource container = kieContainers.get(0);
      String containerId = container.getContainerId();
      ServiceResponse&lt;Void&gt; responseDispose = kieServicesClient.disposeContainer(containerId);
      if (responseDispose.getType() == ResponseType.FAILURE) {
          System.out.println("Error disposing " + containerId + ". Message: ");
          System.out.println(responseDispose.getMsg());
          return;
      }
      System.out.println("Success Disposing container " + containerId);
      System.out.println("Trying to recreate the container...");

      // Re-create KIE container
      ServiceResponse&lt;KieContainerResource&gt; createResponse = kieServicesClient.createContainer(containerId, container);
      if(createResponse.getType() == ResponseType.FAILURE) {
          System.out.println("Error creating " + containerId + ". Message: ");
          System.out.println(responseDispose.getMsg());
          return;
      }
      System.out.println("Container recreated with success!");
      }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以使用<code>org.kie.server.api.model.ServiceResponse<T></code>对象，在哪里<code>T</code>表示返回的响应的类型。的<code>ServiceResponse</code>对象具有以下属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>String <em>message</em></code> ：返回响应消息</p>
</li>
<li>
<p><code>ResponseType <em>type</em></code> ：返回<code>SUCCESS</code>要么<code>FAILURE</code></p>
</li>
<li>
<p><code>T <em>result</em></code> ：返回请求的对象</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在此示例中，当您处置容器时， <code>ServiceResponse</code>返回一个<code>Void</code>响应。创建容器时， <code>ServiceResponse</code>返回一个<code>KieContainerResource</code>宾语。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">客户端和群集环境中的特定KIE Server容器之间的对话由唯一的安全性保护<code>conversationID</code> 。的<code>conversationID</code>使用<code>X-KIE-ConversationId</code> REST标头。如果您更新容器，请取消之前的设置<code>conversationID</code> 。使用<code>KieServiesClient.completeConversation()</code>取消<code>conversationID</code> Java API。</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</li>
<li>
<p>运行配置的<code>.java</code>类从您的项目目录执行请求，并查看KIE Server响应。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>如果启用了调试日志记录，则KIE Server会根据您配置的编组格式（例如JSON）做出详细响应。</p>
</div>
<div class="paragraph">
<p>新的KIE容器（日志）的服务器响应示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>10:23:35.194 [main] INFO  o.k.s.a.m.MarshallerFactory - Marshaller extensions init
10:23:35.396 [main] DEBUG o.k.s.client.balancer.LoadBalancer - Load balancer RoundRobinBalancerStrategy{availableEndpoints=[http://localhost:8080/kie-server/services/rest/server]} selected url 'http://localhost:8080/kie-server/services/rest/server'
10:23:35.398 [main] DEBUG o.k.s.c.i.AbstractKieServicesClientImpl - About to send GET request to 'http://localhost:8080/kie-server/services/rest/server'
10:23:35.440 [main] DEBUG o.k.s.c.i.AbstractKieServicesClientImpl - About to deserialize content:
 '{
  "type" : "SUCCESS",
  "msg" : "Kie Server info",
  "result" : {
    "kie-server-info" : {
      "id" : "default-kieserver",
      "version" : "7.11.0.Final-redhat-00003",
      "name" : "default-kieserver",
      "location" : "http://localhost:8080/kie-server/services/rest/server",
      "capabilities" : [ "KieServer", "BRM", "BPM", "CaseMgmt", "BPM-UI", "BRP", "DMN", "Swagger" ],
      "messages" : [ {
        "severity" : "INFO",
        "timestamp" : {
  "java.util.Date" : 1540814906533
},
        "content" : [ "Server KieServerInfo{serverId='default-kieserver', version='7.11.0.Final-redhat-00003', name='default-kieserver', location='http://localhost:8080/kie-server/services/rest/server', capabilities=[KieServer, BRM, BPM, CaseMgmt, BPM-UI, BRP, DMN, Swagger], messages=null}started successfully at Mon Oct 29 08:08:26 EDT 2018" ]
      } ]
    }
  }
}'
 into type: 'class org.kie.server.api.model.ServiceResponse'
10:23:35.653 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - KieServicesClient connected to: default-kieserver version 7.11.0.Final-redhat-00003
10:23:35.653 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Supported capabilities by the server: [KieServer, BRM, BPM, CaseMgmt, BPM-UI, BRP, DMN, Swagger]
10:23:35.653 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Building services client for server capability KieServer
10:23:35.653 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - No builder found for 'KieServer' capability
10:23:35.654 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Building services client for server capability BRM
10:23:35.654 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Builder 'org.kie.server.client.helper.DroolsServicesClientBuilder@6b927fb' for capability 'BRM'
10:23:35.655 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Capability implemented by {interface org.kie.server.client.RuleServicesClient=org.kie.server.client.impl.RuleServicesClientImpl@4a94ee4}
10:23:35.655 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Building services client for server capability BPM
10:23:35.656 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Builder 'org.kie.server.client.helper.JBPMServicesClientBuilder@4cc451f2' for capability 'BPM'
10:23:35.672 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Capability implemented by {interface org.kie.server.client.JobServicesClient=org.kie.server.client.impl.JobServicesClientImpl@1189dd52, interface org.kie.server.client.admin.ProcessAdminServicesClient=org.kie.server.client.admin.impl.ProcessAdminServicesClientImpl@36bc55de, interface org.kie.server.client.DocumentServicesClient=org.kie.server.client.impl.DocumentServicesClientImpl@564fabc8, interface org.kie.server.client.admin.UserTaskAdminServicesClient=org.kie.server.client.admin.impl.UserTaskAdminServicesClientImpl@16d04d3d, interface org.kie.server.client.QueryServicesClient=org.kie.server.client.impl.QueryServicesClientImpl@49ec71f8, interface org.kie.server.client.ProcessServicesClient=org.kie.server.client.impl.ProcessServicesClientImpl@1d2adfbe, interface org.kie.server.client.UserTaskServicesClient=org.kie.server.client.impl.UserTaskServicesClientImpl@36902638}
10:23:35.672 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Building services client for server capability CaseMgmt
10:23:35.672 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Builder 'org.kie.server.client.helper.CaseServicesClientBuilder@223d2c72' for capability 'CaseMgmt'
10:23:35.676 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Capability implemented by {interface org.kie.server.client.admin.CaseAdminServicesClient=org.kie.server.client.admin.impl.CaseAdminServicesClientImpl@2b662a77, interface org.kie.server.client.CaseServicesClient=org.kie.server.client.impl.CaseServicesClientImpl@7f0eb4b4}
10:23:35.676 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Building services client for server capability BPM-UI
10:23:35.676 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Builder 'org.kie.server.client.helper.JBPMUIServicesClientBuilder@5c33f1a9' for capability 'BPM-UI'
10:23:35.677 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Capability implemented by {interface org.kie.server.client.UIServicesClient=org.kie.server.client.impl.UIServicesClientImpl@223191a6}
10:23:35.678 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Building services client for server capability BRP
10:23:35.678 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Builder 'org.kie.server.client.helper.OptaplannerServicesClientBuilder@49139829' for capability 'BRP'
10:23:35.679 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Capability implemented by {interface org.kie.server.client.SolverServicesClient=org.kie.server.client.impl.SolverServicesClientImpl@77fbd92c}
10:23:35.679 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Building services client for server capability DMN
10:23:35.679 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Builder 'org.kie.server.client.helper.DMNServicesClientBuilder@67c27493' for capability 'DMN'
10:23:35.680 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Capability implemented by {interface org.kie.server.client.DMNServicesClient=org.kie.server.client.impl.DMNServicesClientImpl@35e2d654}
10:23:35.680 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - Building services client for server capability Swagger
10:23:35.680 [main] DEBUG o.k.s.c.impl.KieServicesClientImpl - No builder found for 'Swagger' capability
10:23:35.681 [main] DEBUG o.k.s.client.balancer.LoadBalancer - Load balancer RoundRobinBalancerStrategy{availableEndpoints=[http://localhost:8080/kie-server/services/rest/server]} selected url 'http://localhost:8080/kie-server/services/rest/server'
10:23:35.701 [main] DEBUG o.k.s.c.i.AbstractKieServicesClientImpl - About to send PUT request to 'http://localhost:8080/kie-server/services/rest/server/containers/employee-rostering3' with payload '{
  "container-id" : null,
  "release-id" : {
    "group-id" : "employeerostering",
    "artifact-id" : "employeerostering",
    "version" : "1.0.0-SNAPSHOT"
  },
  "resolved-release-id" : null,
  "status" : null,
  "scanner" : null,
  "config-items" : [ ],
  "messages" : [ ],
  "container-alias" : null
}'
10:23:38.071 [main] DEBUG o.k.s.c.i.AbstractKieServicesClientImpl - About to deserialize content:
 '{
  "type" : "SUCCESS",
  "msg" : "Container employee-rostering3 successfully deployed with module employeerostering:employeerostering:1.0.0-SNAPSHOT.",
  "result" : {
    "kie-container" : {
      "container-id" : "employee-rostering3",
      "release-id" : {
        "group-id" : "employeerostering",
        "artifact-id" : "employeerostering",
        "version" : "1.0.0-SNAPSHOT"
      },
      "resolved-release-id" : {
        "group-id" : "employeerostering",
        "artifact-id" : "employeerostering",
        "version" : "1.0.0-SNAPSHOT"
      },
      "status" : "STARTED",
      "scanner" : {
        "status" : "DISPOSED",
        "poll-interval" : null
      },
      "config-items" : [ ],
      "messages" : [ {
        "severity" : "INFO",
        "timestamp" : {
  "java.util.Date" : 1540909418069
},
        "content" : [ "Container employee-rostering3 successfully created with module employeerostering:employeerostering:1.0.0-SNAPSHOT." ]
      } ],
      "container-alias" : null
    }
  }
}'
 into type: 'class org.kie.server.api.model.ServiceResponse'</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果遇到请求错误，请查看返回的错误代码消息并相应地调整Java配置。</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="kie-server-java-clients-ref_kie-apis"><a class="anchor" href="#kie-server-java-clients-ref_kie-apis"></a> <a class="link" href="#kie-server-java-clients-ref_kie-apis">19.9.2。支持的KIE Server Java客户端</a></h4>
<div class="paragraph">
<p>以下是Java客户端中提供的一些Java客户端服务： <code>org.kie.server.client</code>您的Drools发行套件。您可以使用这些服务与KIE Server REST API类似地与KIE Server中的相关资源进行交互。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>KieServicesClient</code> ：用作其他KIE Server Java客户端的入口点，并用于与KIE容器进行交互</p>
</li>
<li>
<p><code>JobServicesClient</code> ：用于计划，取消，重新排队和获取工作请求</p>
</li>
<li>
<p><code>RuleServicesClient</code> ：用于向服务器发送命令以执行与规则相关的操作，例如执行规则或将对象插入KIE会话</p>
</li>
<li>
<p><code>SolverServicesClient</code> ：用于执行所有OptaPlanner操作，例如获取求解器状态和最佳解决方案，或处置求解器</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>的<code>getServicesClient</code>方法提供对以下任何客户端的访问：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RuleServicesClient rulesClient = kieServicesClient.getServicesClient(RuleServicesClient.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关可用的KIE Server Java客户端的完整列表，请参见<a href="https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-remote/kie-server-client/src/main/java/org/kie/server/client">GitHub中</a>的Java客户端API源。</p>
</div>
</div>
<div class="sect3">
<h4 id="kie-server-java-api-examples-ref_kie-apis"><a class="anchor" href="#kie-server-java-api-examples-ref_kie-apis"></a> <a class="link" href="#kie-server-java-api-examples-ref_kie-apis">19.9.3。使用KIE Server Java客户端API的示例请求</a></h4>
<div class="paragraph">
<p>以下是与KIE Server进行基本交互的KIE Server Java客户端API请求示例。有关可用的KIE Server Java客户端的完整列表，请参见<a href="https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-remote/kie-server-client/src/main/java/org/kie/server/client">GitHub中</a>的Java客户端API源。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">列出KIE Server功能</dt>
<dd>
<p>您可以使用<code>org.kie.server.api.model.KieServerInfo</code>对象以识别服务器功能。的<code>KieServicesClient</code>客户端需要服务器功能信息才能正确生成服务客户端。您可以在以下位置全局指定功能<code>KieServicesConfiguration</code> ;否则，它们将从KIE Server中自动检索。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">请求返回KIE Server功能的示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void listCapabilities() {

  KieServerInfo serverInfo = kieServicesClient.getServerInfo().getResult();
  System.out.print("Server capabilities:");

  for (String capability : serverInfo.getCapabilities()) {
    System.out.print(" " + capability);
  }

  System.out.println();
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">列出KIE服务器中的KIE容器</dt>
<dd>
<p>KIE容器由<code>org.kie.server.api.model.KieContainerResource</code>宾语。资源列表由<code>org.kie.server.api.model.KieContainerResourceList</code>宾语。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">从KIE服务器返回KIE容器的示例请求</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void listContainers() {
    KieContainerResourceList containersList = kieServicesClient.listContainers().getResult();
    List&lt;KieContainerResource&gt; kieContainers = containersList.getContainers();
    System.out.println("Available containers: ");
    for (KieContainerResource container : kieContainers) {
        System.out.println("\t" + container.getContainerId() + " (" + container.getReleaseId() + ")");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以选择使用以下实例过滤KIE容器结果<code>org.kie.server.api.model.KieContainerResourceFilter</code>类，该类传递给<code>org.kie.server.client.KieServicesClient.listContainers()</code>方法。</p>
</div>
<div class="listingblock">
<div class="title">通过发布ID和状态返回KIE容器的示例请求</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void listContainersWithFilter() {

    // Filter containers by releaseId "org.example:container:1.0.0.Final" and status FAILED
    KieContainerResourceFilter filter = new KieContainerResourceFilter.Builder()
            .releaseId("org.example", "container", "1.0.0.Final")
            .status(KieContainerStatus.FAILED)
            .build();

    // Using previously created KieServicesClient
    KieContainerResourceList containersList = kieServicesClient.listContainers(filter).getResult();
    List&lt;KieContainerResource&gt; kieContainers = containersList.getContainers();

    System.out.println("Available containers: ");

    for (KieContainerResource container : kieContainers) {
        System.out.println("\t" + container.getContainerId() + " (" + container.getReleaseId() + ")");
    }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">在KIE Server中创建和处置KIE容器</dt>
<dd>
<p>您可以使用<code>createContainer</code>和<code>disposeContainer</code>中的方法<code>KieServicesClient</code>客户端来处置和创建KIE容器。在此示例中，当您处置容器时， <code>ServiceResponse</code>返回一个<code>Void</code>响应。创建容器时， <code>ServiceResponse</code>返回一个<code>KieContainerResource</code>宾语。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">处理和重新创建KIE容器的示例请求</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void disposeAndCreateContainer() {
    System.out.println("== Disposing and creating containers ==");

    // Retrieve list of KIE containers
    List&lt;KieContainerResource&gt; kieContainers = kieServicesClient.listContainers().getResult().getContainers();
    if (kieContainers.size() == 0) {
        System.out.println("No containers available...");
        return;
    }

    // Dispose KIE container
    KieContainerResource container = kieContainers.get(0);
    String containerId = container.getContainerId();
    ServiceResponse&lt;Void&gt; responseDispose = kieServicesClient.disposeContainer(containerId);
    if (responseDispose.getType() == ResponseType.FAILURE) {
        System.out.println("Error disposing " + containerId + ". Message: ");
        System.out.println(responseDispose.getMsg());
        return;
    }
    System.out.println("Success Disposing container " + containerId);
    System.out.println("Trying to recreate the container...");

    // Re-create KIE container
    ServiceResponse&lt;KieContainerResource&gt; createResponse = kieServicesClient.createContainer(containerId, container);
    if(createResponse.getType() == ResponseType.FAILURE) {
        System.out.println("Error creating " + containerId + ". Message: ");
        System.out.println(responseDispose.getMsg());
        return;
    }
    System.out.println("Container recreated with success!");
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">在KIE Server中执行运行时命令</dt>
<dd>
<p>Drools支持可以将运行时命令发送到KIE Server进行资产相关的操作，例如在KIE会话中插入或收回对象或触发所有规则。支持的运行时命令的完整列表位于<code>org.drools.core.command.runtime</code>打包在您的Drools实例中。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>您可以使用<code>org.kie.api.command.KieCommands</code>类来插入命令，并使用<code>org.kie.api.KieServices.get().getCommands()</code>实例化<code>KieCommands</code>类。如果要添加多个命令，请使用<code>BatchExecutionCommand</code>包装纸。</p>
</div>
<div class="listingblock">
<div class="title">请求插入对象并触发所有规则的示例请求</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.command.Command;
import org.kie.api.command.KieCommands;
import org.kie.server.api.model.ServiceResponse;
import org.kie.server.client.RuleServicesClient;
import org.kie.server.client.KieServicesClient;
import org.kie.api.KieServices;

import java.util.Arrays;

...

public void executeCommands() {

  String containerId = "hello";
  System.out.println("== Sending commands to the server ==");
  RuleServicesClient rulesClient = kieServicesClient.getServicesClient(RuleServicesClient.class);
  KieCommands commandsFactory = KieServices.Factory.get().getCommands();

  Command&lt;?&gt; insert = commandsFactory.newInsert("Some String OBJ");
  Command&lt;?&gt; fireAllRules = commandsFactory.newFireAllRules();
  Command&lt;?&gt; batchCommand = commandsFactory.newBatchExecution(Arrays.asList(insert, fireAllRules));

  ServiceResponse&lt;String&gt; executeResponse = rulesClient.executeCommands(containerId, batchCommand);

  if(executeResponse.getType() == ResponseType.SUCCESS) {
    System.out.println("Commands executed with success! Response: ");
    System.out.println(executeResponse.getResult());
  } else {
    System.out.println("Error executing rules. Message: ");
    System.out.println(executeResponse.getMsg());
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">客户端和群集环境中的特定KIE Server容器之间的对话由唯一的安全性保护<code>conversationID</code> 。的<code>conversationID</code>使用<code>X-KIE-ConversationId</code> REST标头。如果您更新容器，请取消之前的设置<code>conversationID</code> 。使用<code>KieServiesClient.completeConversation()</code>取消<code>conversationID</code> Java API。</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kie-server-commands-con_kie-apis"><a class="anchor" href="#kie-server-commands-con_kie-apis"></a> <a class="link" href="#kie-server-commands-con_kie-apis">19.10。Drools中的KIE服务器和KIE容器命令</a></h3>
<div class="paragraph">
<p>Drools支持服务器命令，您可以将其发送到KIE Server进行与服务器相关或与容器相关的操作，例如检索服务器信息或创建或删除容器。支持的KIE Server配置命令的完整列表位于<code>org.kie.server.api.commands</code>打包在您的Drools实例中。</p>
</div>
<div class="paragraph">
<p>在KIE Server REST API中，您可以使用<code>org.kie.server.api.commands</code>命令作为请求主体<code>POST</code>要求<code>http://SERVER:PORT/kie-server/services/rest/server/config</code> 。有关使用KIE Server REST API的更多信息，请参阅<a href="#kie-server-rest-api-con_kie-apis">适用于KIE容器和业务资产的KIE Server REST API</a> 。</p>
</div>
<div class="paragraph">
<p>在KIE Server Java客户端API中，您可以在父级中使用相应的方法<code>KieServicesClient</code> Java客户端作为Java应用程序中的嵌入式API请求。所有KIE Server命令均由Java客户端API中提供的方法执行，因此您无需在Java应用程序中嵌入实际的KIE Server命令。有关使用KIE Server Java客户端API的更多信息，请参阅<a href="#kie-server-java-api-con_kie-apis">KIE容器和业务资产的KIE Server Java客户端API</a> 。</p>
</div>
<div class="sect3">
<h4 id="kie-server-commands-samples-ref_kie-apis"><a class="anchor" href="#kie-server-commands-samples-ref_kie-apis"></a> <a class="link" href="#kie-server-commands-samples-ref_kie-apis">19.10.1。示例KIE Server和KIE容器命令</a></h4>
<div class="paragraph">
<p>以下是示例KIE Server命令，您可以将它们与KIE Server REST API或Java客户端API一起使用，以在KIE Server中进行服务器相关或容器相关的操作：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GetServerInfoCommand</code></p>
</li>
<li>
<p><code>GetServerStateCommand</code></p>
</li>
<li>
<p><code>CreateContainerCommand</code></p>
</li>
<li>
<p><code>GetContainerInfoCommand</code></p>
</li>
<li>
<p><code>ListContainersCommand</code></p>
</li>
<li>
<p><code>CallContainerCommand</code></p>
</li>
<li>
<p><code>DisposeContainerCommand</code></p>
</li>
<li>
<p><code>GetScannerInfoCommand</code></p>
</li>
<li>
<p><code>UpdateScannerCommand</code></p>
</li>
<li>
<p><code>UpdateReleaseIdCommand</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>有关受支持的KIE Server配置和管理命令的完整列表，请参见<code>org.kie.server.api.commands</code>打包在您的Drools实例中。</p>
</div>
<div class="paragraph">
<p>您可以单独或作为批处理REST API请求或批处理Java API请求一起运行KIE Server命令：</p>
</div>
<div class="listingblock">
<div class="title">批处理REST API请求以创建，调用和处置KIE容器（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [
    {
      "create-container": {
        "container": {
          "status": "STARTED",
          "container-id": "command-script-container",
          "release-id": {
            "version": "1.0",
            "group-id": "com.redhat",
            "artifact-id": "Project1"
          }
        }
      }
    },
    {
      "call-container": {
        "payload": "{\n  \"commands\" : [ {\n    \"fire-all-rules\" : {\n      \"max\" : -1,\n      \"out-identifier\" : null\n    }\n  } ]\n}",
        "container-id": "command-script-container"
      }
    },
    {
      "dispose-container": {
        "container-id": "command-script-container"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">批处理Java API请求以检索，处置和重新创建KIE容器</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void disposeAndCreateContainer() {
    System.out.println("== Disposing and creating containers ==");

    // Retrieve list of KIE containers
    List&lt;KieContainerResource&gt; kieContainers = kieServicesClient.listContainers().getResult().getContainers();
    if (kieContainers.size() == 0) {
        System.out.println("No containers available...");
        return;
    }

    // Dispose KIE container
    KieContainerResource container = kieContainers.get(0);
    String containerId = container.getContainerId();
    ServiceResponse&lt;Void&gt; responseDispose = kieServicesClient.disposeContainer(containerId);
    if (responseDispose.getType() == ResponseType.FAILURE) {
        System.out.println("Error disposing " + containerId + ". Message: ");
        System.out.println(responseDispose.getMsg());
        return;
    }
    System.out.println("Success Disposing container " + containerId);
    System.out.println("Trying to recreate the container...");

    // Re-create KIE container
    ServiceResponse&lt;KieContainerResource&gt; createResponse = kieServicesClient.createContainer(containerId, container);
    if(createResponse.getType() == ResponseType.FAILURE) {
        System.out.println("Error creating " + containerId + ". Message: ");
        System.out.println(responseDispose.getMsg());
        return;
    }
    System.out.println("Container recreated with success!");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>本节中的每个命令都包括一个针对KIE Server REST API的REST请求主体示例（JSON），以及来自该示例的嵌入式方法示例。 <code>KieServicesClient</code> KIE Server Java客户端API的Java客户端。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">GetServerInfoCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>返回有关KIE服务器的信息。</p>
</div>
<div class="listingblock">
<div class="title">示例REST请求主体（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "get-server-info" : { }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java客户端方法示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServerInfo serverInfo = kieServicesClient.getServerInfo();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Kie Server info",
      "result": {
        "kie-server-info": {
          "id": "default-kieserver",
          "version": "7.11.0.Final-redhat-00001",
          "name": "default-kieserver",
          "location": "http://localhost:8080/kie-server/services/rest/server",
          "capabilities": [
            "KieServer",
            "BRM",
            "BPM",
            "CaseMgmt",
            "BPM-UI",
            "BRP",
            "DMN",
            "Swagger"
          ],
          "messages": [
            {
              "severity": "INFO",
              "timestamp": {
                "java.util.Date": 1538502533321
              },
              "content": [
                "Server KieServerInfo{serverId='default-kieserver', version='7.11.0.Final-redhat-00001', name='default-kieserver', location='http://localhost:8080/kie-server/services/rest/server', capabilities=[KieServer, BRM, BPM, CaseMgmt, BPM-UI, BRP, DMN, Swagger], messages=null}started successfully at Tue Oct 02 13:48:53 EDT 2018"
              ]
            }
          ]
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">GetServerStateCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>返回有关KIE服务器当前状态和配置的信息。</p>
</div>
<div class="listingblock">
<div class="title">示例REST请求主体（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "get-server-state" : { }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java客户端方法示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServerStateInfo serverStateInfo = kieServicesClient.getServerState();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Successfully loaded server state for server id default-kieserver",
      "result": {
        "kie-server-state-info": {
          "controller": [
            "http://localhost:8080/business-central/rest/controller"
          ],
          "config": {
            "config-items": [
              {
                "itemName": "org.kie.server.location",
                "itemValue": "http://localhost:8080/kie-server/services/rest/server",
                "itemType": "java.lang.String"
              },
              {
                "itemName": "org.kie.server.controller.user",
                "itemValue": "controllerUser",
                "itemType": "java.lang.String"
              },
              {
                "itemName": "org.kie.server.controller",
                "itemValue": "http://localhost:8080/business-central/rest/controller",
                "itemType": "java.lang.String"
              }
            ]
          },
          "containers": [
            {
              "container-id": "employee-rostering",
              "release-id": {
                "group-id": "employeerostering",
                "artifact-id": "employeerostering",
                "version": "1.0.0-SNAPSHOT"
              },
              "resolved-release-id": null,
              "status": "STARTED",
              "scanner": {
                "status": "STOPPED",
                "poll-interval": null
              },
              "config-items": [
                {
                  "itemName": "KBase",
                  "itemValue": "",
                  "itemType": "BPM"
                },
                {
                  "itemName": "KSession",
                  "itemValue": "",
                  "itemType": "BPM"
                },
                {
                  "itemName": "MergeMode",
                  "itemValue": "MERGE_COLLECTIONS",
                  "itemType": "BPM"
                },
                {
                  "itemName": "RuntimeStrategy",
                  "itemValue": "SINGLETON",
                  "itemType": "BPM"
                }
              ],
              "messages": [],
              "container-alias": "employeerostering"
            }
          ]
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">CreateContainerCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>在KIE服务器中创建一个KIE容器。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表84。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>container</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">包含<code>container-id</code> ， <code>release-id</code>数据（组ID，工件ID，版本）， <code>status</code>以及新的KIE容器的任何其他组件</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">示例REST请求主体（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "create-container" : {
      "container" : {
        "status" : null,
        "messages" : [ ],
        "container-id" : "command-script-container",
        "release-id" : {
          "version" : "1.0",
          "group-id" : "com.redhat",
          "artifact-id" : "Project1"
        },
        "config-items" : [ ]
      }
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java客户端方法示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ServiceResponse&lt;KieContainerResource&gt; response = kieServicesClient.createContainer("command-script-container", resource);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully deployed with module com.redhat:Project1:1.0.",
      "result": {
        "kie-container": {
          "container-id": "command-script-container",
          "release-id": {
            "version" : "1.0",
            "group-id" : "com.redhat",
            "artifact-id" : "Project1"
          },
          "resolved-release-id": {
            "version" : "1.0",
            "group-id" : "com.redhat",
            "artifact-id" : "Project1"
          },
          "status": "STARTED",
          "scanner": {
            "status": "DISPOSED",
            "poll-interval": null
          },
          "config-items": [],
          "messages": [
            {
              "severity": "INFO",
              "timestamp": {
                "java.util.Date": 1538762455510
              },
              "content": [
                "Container command-script-container successfully created with module com.redhat:Project1:1.0."
              ]
            }
          ],
          "container-alias": null
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">GetContainerInfoCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>返回有关KIE服务器中指定KIE容器的信息。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表85。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>container-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KIE容器的ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">示例REST请求主体（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "get-container-info" : {
      "container-id" : "command-script-container"
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java客户端方法示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ServiceResponse&lt;KieContainerResource&gt; response = kieServicesClient.getContainerInfo("command-script-container");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Info for container command-script-container",
      "result": {
        "kie-container": {
          "container-id": "command-script-container",
          "release-id": {
            "group-id": "com.redhat",
            "artifact-id": "Project1",
            "version": "1.0"
          },
          "resolved-release-id": {
            "group-id": "com.redhat",
            "artifact-id": "Project1",
            "version": "1.0"
          },
          "status": "STARTED",
          "scanner": {
            "status": "DISPOSED",
            "poll-interval": null
          },
          "config-items": [

          ],
          "container-alias": null
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">ListContainersCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>返回已在KIE服务器中创建的KIE容器的列表。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表86。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kie-container-filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选地图包含<code>release-id-filter</code> ， <code>container-status-filter</code> ，以及您要用来过滤结果的任何其他KIE容器属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">REST请求主体示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "list-containers" : {
      "kie-container-filter" : {
        "release-id-filter" : { },
        "container-status-filter" : {
          "accepted-status" : ["FAILED"]
        }
      }
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java客户端方法示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieContainerResourceFilter filter = new KieContainerResourceFilter.Builder()
        .status(KieContainerStatus.FAILED)
        .build();

KieContainerResourceList containersList = kieServicesClient.listContainers(filter);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "List of created containers",
      "result": {
        "kie-containers": {
          "kie-container": [
            {
              "container-id": "command-script-container",
              "release-id": {
                "group-id": "com.redhat",
                "artifact-id": "Project1",
                "version": "1.0"
              },
              "resolved-release-id": {
                "group-id": "com.redhat",
                "artifact-id": "Project1",
                "version": "1.0"
              },
              "status": "STARTED",
              "scanner": {
                "status": "STARTED",
                "poll-interval": 5000
              },
              "config-items": [
                {
                  "itemName": "RuntimeStrategy",
                  "itemValue": "SINGLETON",
                  "itemType": "java.lang.String"
                },
                {
                  "itemName": "MergeMode",
                  "itemValue": "MERGE_COLLECTIONS",
                  "itemType": "java.lang.String"
                },
                {
                  "itemName": "KBase",
                  "itemValue": "",
                  "itemType": "java.lang.String"
                },
                {
                  "itemName": "KSession",
                  "itemValue": "",
                  "itemType": "java.lang.String"
                }
              ],
              "messages": [
                {
                  "severity": "INFO",
                  "timestamp": {
                    "java.util.Date": 1538504619749
                  },
                  "content": [
                    "Container command-script-container successfully created with module com.redhat:Project1:1.0."
                  ]
                }
              ],
              "container-alias": null
            }
          ]
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">CallContainerCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>调用KIE容器并执行一个或多个运行时命令。有关Drools运行时命令的信息，请参阅Drools中的运行<a href="#runtime-commands-con_kie-apis">时命令</a> 。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表87。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>container-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要调用的KIE容器的ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个命令中的一个或多个命令<code>BatchExecutionCommand</code>在KIE容器上执行的包装器</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">REST请求主体示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "call-container" : {
      "payload" : "{\n  \"lookup\" : \"defaultKieSession\",\n  \"commands\" : [ {\n    \"fire-all-rules\" : {\n      \"max\" : -1,\n      \"out-identifier\" : null\n    }\n  } ]\n}",
      "container-id" : "command-script-container"
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java客户端方法示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;Command&lt;?&gt;&gt; commands = new ArrayList&lt;Command&lt;?&gt;&gt;();
      BatchExecutionCommand batchExecution1 = commandsFactory.newBatchExecution(commands, "defaultKieSession");
      commands.add(commandsFactory.newFireAllRules());

      ServiceResponse&lt;ExecutionResults&gt; response1 = ruleClient.executeCommandsWithResults("command-script-container", batchExecution1);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": "{\n  \"results\" : [ ],\n  \"facts\" : [ ]\n}"
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">DisposeContainerCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>在KIE服务器中放置一个指定的KIE容器。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表88。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>container-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将要处置的KIE容器的ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">REST请求主体示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "dispose-container" : {
      "container-id" : "command-script-container"
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java客户端方法示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ServiceResponse&lt;Void&gt; response = kieServicesClient.disposeContainer("command-script-container");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully disposed.",
      "result": null
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">GetScannerInfoCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>返回有关用于指定KIE容器中自动更新的KIE扫描程序的信息（如果适用）。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表89。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>container-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用KIE扫描器的KIE容器的ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">REST请求主体示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "get-scanner-info" : {
      "container-id" : "command-script-container"
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java客户端方法示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ServiceResponse&lt;KieScannerResource&gt; response = kieServicesClient.getScannerInfo("command-script-container");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Scanner info successfully retrieved",
      "result": {
        "kie-scanner": {
          "status": "DISPOSED",
          "poll-interval": null
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">UpdateScannerCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>启动或停止KIE扫描程序，该扫描程序控制对更新的KIE容器部署的轮询。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">避免在业务流程中使用KIE扫描仪。在流程中使用KIE扫描程序会导致无法预料的更新，当更改与正在运行的流程实例不兼容时，这些更新会导致长时间运行的流程出现错误。
</td>
</tr>
</tbody></table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表90。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>container-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用KIE扫描器的KIE容器的ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要在KIE扫描仪上设置的状态（ <code>STARTED</code> ， <code>STOPPED</code> ）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>poll-interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">允许的轮询持续时间（以毫秒为单位）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅在启动扫描仪时需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">REST请求主体示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "update-scanner" : {
      "scanner" : {
        "status" : "STARTED",
        "poll-interval" : 10000
      },
      "container-id" : "command-script-container"
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java客户端方法示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieScannerResource scannerResource = new KieScannerResource();
scannerResource.setPollInterval(10000);
scannerResource.setStatus(KieScannerStatus. STARTED);

ServiceResponse&lt;KieScannerResource&gt; response = kieServicesClient.updateScanner("command-script-container", scannerResource);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Kie scanner successfully created.",
      "result": {
        "kie-scanner": {
          "status": "STARTED",
          "poll-interval": 10000
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">UpdateReleaseIdCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>更新指定KIE容器的发行ID数据（组ID，工件ID，版本）。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表91。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>container-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要更新的KIE容器的ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>releaseId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">更新的GAV（组ID，工件ID，版本）数据将应用于KIE容器</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">REST请求主体示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "update-release-id" : {
      "releaseId" : {
        "version" : "1.1",
        "group-id" : "com.redhat",
        "artifact-id" : "Project1"
      },
      "container-id" : "command-script-container"
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java客户端方法示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ServiceResponse&lt;ReleaseId&gt; response = kieServicesClient.updateReleaseId("command-script-container", "com.redhat:Project1:1.1");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Release id successfully updated",
      "result": {
        "release-id": {
          "group-id": "com.redhat",
          "artifact-id": "Project1",
          "version": "1.1"
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="runtime-commands-con_kie-apis"><a class="anchor" href="#runtime-commands-con_kie-apis"></a> <a class="link" href="#runtime-commands-con_kie-apis">19.11。Drools中的运行时命令</a></h3>
<div class="paragraph">
<p>Drools支持可以将运行时命令发送到KIE Server进行资产相关的操作，例如执行所有规则或在KIE会话中插入或收回对象。支持的运行时命令的完整列表位于<code>org.drools.core.command.runtime</code>打包在您的Drools实例中。</p>
</div>
<div class="paragraph">
<p>在KIE Server REST API中，您可以使用全局<code>org.drools.core.command.runtime</code>命令或特定于规则<code>org.drools.core.command.runtime.rule</code>命令作为请求主体<code>POST</code>要求<code>http://SERVER:PORT/kie-server/services/rest/server/containers/instances/{containerId}</code> 。有关使用KIE Server REST API的更多信息，请参阅<a href="#kie-server-rest-api-con_kie-apis">适用于KIE容器和业务资产的KIE Server REST API</a> 。</p>
</div>
<div class="paragraph">
<p>在KIE Server Java客户端API中，您可以将这些命令与相关的Java客户端一起嵌入到Java应用程序中。例如，对于与规则相关的命令，您可以使用<code>RuleServicesClient</code>带有嵌入式命令的Java客户端。有关使用KIE Server Java客户端API的更多信息，请参阅<a href="#kie-server-java-api-con_kie-apis">KIE容器和业务资产的KIE Server Java客户端API</a> 。</p>
</div>
<div class="sect3">
<h4 id="runtime-commands-samples-ref_kie-apis"><a class="anchor" href="#runtime-commands-samples-ref_kie-apis"></a> <a class="link" href="#runtime-commands-samples-ref_kie-apis">19.11.1。Drools中的示例运行时命令</a></h4>
<div class="paragraph">
<p>以下是可与KIE Server REST API或Java客户端API一起使用的示例运行时命令示例，用于在KIE Server中进行资产相关的操作：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BatchExecutionCommand</code></p>
</li>
<li>
<p><code>InsertObjectCommand</code></p>
</li>
<li>
<p><code>RetractCommand</code></p>
</li>
<li>
<p><code>ModifyCommand</code></p>
</li>
<li>
<p><code>GetObjectCommand</code></p>
</li>
<li>
<p><code>GetObjectsCommand</code></p>
</li>
<li>
<p><code>InsertElementsCommand</code></p>
</li>
<li>
<p><code>FireAllRulesCommand</code></p>
</li>
<li>
<p><code>QueryCommand</code></p>
</li>
<li>
<p><code>SetGlobalCommand</code></p>
</li>
<li>
<p><code>GetGlobalCommand</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>有关受支持的运行时命令的完整列表，请参见<code>org.drools.core.command.runtime</code>打包在您的Drools实例中。</p>
</div>
<div class="paragraph">
<p>本节中的每个命令都包括针对KIE Server REST API的REST请求主体示例（JSON）和针对KIE Server Java客户端API的嵌入式Java命令示例。 Java示例使用一个对象<code>org.drools.compiler.test.Person</code>与田野<code>name</code> （字符串）和<code>age</code> （整数）。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">BatchExecutionCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>包含要一起执行的多个命令。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表92。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>commands</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要执行的命令列表。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lookup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设置将在其上执行命令的KIE会话ID。对于无状态的KIE会话，此属性是必需的。对于有状态的KIE会话，此属性是可选的，如果未指定，则使用默认的KIE会话。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">对于无状态KIE会话是必需的，对于有状态KIE会话是可选的</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">KIE会话ID位于<code>kmodule.xml</code> Drools项目的文件。要在Business Central中查看或添加KIE会话ID以与<code>lookup</code>命令属性，导航到Business Central中的相关项目，然后转到项目<strong>设置</strong> → <strong>KIE基础</strong> → <strong>KIE会话</strong> 。如果不存在KIE基础，请单击<strong>添加KIE基础</strong> → <strong>KIE会话</strong>以定义新的KIE基础和KIE会话。
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "lookup": "ksession1",
  "commands": [ {
      "insert": {
        "object": {
          "org.drools.compiler.test.Person": {
            "name": "john",
            "age": 25
          }
        }
      }
    },
    {
      "fire-all-rules": {
        "max": 10,
        "out-identifier": "firedActivations"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BatchExecutionCommand command = new BatchExecutionCommand();
command.setLookup("ksession1");

InsertObjectCommand insertObjectCommand = new InsertObjectCommand(new Person("john", 25));
FireAllRulesCommand fireAllRulesCommand = new FireAllRulesCommand();

command.getCommands().add(insertObjectCommand);
command.getCommands().add(fireAllRulesCommand);

ksession.execute(command);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": 0,
              "key": "firedActivations"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">InsertObjectCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>将对象插入KIE会话。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表93。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>object</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要插入的对象</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">的ID <code>FactHandle</code>从对象插入创建并添加到执行结果</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>return-object</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">布尔值，确定是否必须在执行结果中返回对象（默认值： <code>true</code> ）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entry-point</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">插入的入口点</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "insert": {
        "entry-point": "my stream",
        "object": {
          "org.drools.compiler.test.Person": {
            "age": 25,
            "name": "john"
          }
        },
        "out-identifier": "john",
        "return-object": false
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Command insertObjectCommand =
  CommandFactory.newInsert(new Person("john", 25), "john", false, null);

ksession.execute(insertObjectCommand);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [],
          "facts": [
            {
              "value": {
                "org.drools.core.common.DefaultFactHandle": {
                  "external-form": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap"
                }
              },
              "key": "john"
            }
          ]
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">缩回命令</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>从KIE会话撤回对象。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表94。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fact-handle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">的<code>FactHandle</code>与要收回的对象相关联</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "retract": {
        "fact-handle": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令：使用<code>FactHandleFromString</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RetractCommand retractCommand = new RetractCommand();
retractCommand.setFactHandleFromString("123:234:345:456:567");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令：使用<code>FactHandle</code>从插入的对象</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RetractCommand retractCommand = new RetractCommand(factHandle);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container employee-rostering successfully called.",
      "result": {
        "execution-results": {
          "results": [],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">修改命令</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>修改KIE会话中先前插入的对象。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表95。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fact-handle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">的<code>FactHandle</code>与要修改的对象关联</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于对象修改的设置器列表</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "modify": {
        "fact-handle": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap",
        "setters": {
          "accessor": "age",
          "value": 25
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ModifyCommand modifyCommand = new ModifyCommand(factHandle);

List&lt;Setter&gt; setters = new ArrayList&lt;Setter&gt;();
setters.add(new SetterImpl("age", "25"));

modifyCommand.setSetters(setters);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container employee-rostering successfully called.",
      "result": {
        "execution-results": {
          "results": [],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">GetObjectCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>从KIE会话中检索对象。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表96。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fact-handle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">的<code>FactHandle</code>与要检索的对象关联</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">的ID <code>FactHandle</code>从对象插入创建并添加到执行结果</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "get-object": {
        "fact-handle": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap",
        "out-identifier": "john"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">GetObjectCommand getObjectCommand = new GetObjectCommand();
getObjectCommand.setFactHandleFromString("123:234:345:456:567");
getObjectCommand.setOutIdentifier("john");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": null,
              "key": "john"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">GetObjectsCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>从KIE会话中检索所有对象作为集合。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表97。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>object-filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">筛选从KIE会话返回的对象</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">执行结果中使用的标识符</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "get-objects": {
        "out-identifier": "objects"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">GetObjectsCommand getObjectsCommand = new GetObjectsCommand();
getObjectsCommand.setOutIdentifier("objects");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": [
                {
                  "org.apache.xerces.dom.ElementNSImpl": "&lt;?xml version=\"1.0\" encoding=\"UTF-16\"?&gt;\n&lt;object xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"person\"&gt;&lt;age&gt;25&lt;/age&gt;&lt;name&gt;john&lt;/name&gt;\n &lt;\/object&gt;"
                },
                {
                  "org.drools.compiler.test.Person": {
                    "name": "john",
                    "age": 25
                  }
                }
              ],
              "key": "objects"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">InsertElementsCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>将对象列表插入KIE会话。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表98。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>objects</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要插入KIE会话的对象列表</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">的ID <code>FactHandle</code>从对象插入创建并添加到执行结果</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>return-object</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于确定是否必须在执行结果中返回对象的布尔值。默认值： <code>true</code> 。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entry-point</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">插入的入口点</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
    "insert-elements": {
        "objects": [
            {
                "containedObject": {
                    "@class": "org.drools.compiler.test.Person",
                    "age": 25,
                    "name": "john"
                }
            },
            {
                "containedObject": {
                    "@class": "Person",
                    "age": 35,
                    "name": "sarah"
                }
            }
        ]
    }
  }
]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;Object&gt; objects = new ArrayList&lt;Object&gt;();
objects.add(new Person("john", 25));
objects.add(new Person("sarah", 35));

Command insertElementsCommand = CommandFactory.newInsertElements(objects);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [],
          "facts": [
            {
              "value": {
                "org.drools.core.common.DefaultFactHandle": {
                  "external-form": "0:4:436792766:-2127720265:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap"
                }
              },
              "key": "john"
            },
            {
              "value": {
                "org.drools.core.common.DefaultFactHandle": {
                  "external-form": "0:4:436792766:-2127720266:4:DEFAULT:NON_TRAIT:java.util.LinkedHashMap"
                }
              },
              "key": "sarah"
            }
          ]
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">FireAllRulesCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>执行KIE会话中的所有规则。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表99。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要执行的最大规则数。默认是<code>-1</code>并且对执行没有任何限制。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用来检索执行结果中激发的规则数的ID。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>agenda-filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">议程过滤器，用于规则执行。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands" : [ {
    "fire-all-rules": {
        "max": 10,
        "out-identifier": "firedActivations"
    }
  } ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">FireAllRulesCommand fireAllRulesCommand = new FireAllRulesCommand();
fireAllRulesCommand.setMax(10);
fireAllRulesCommand.setOutIdentifier("firedActivations");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": 0,
              "key": "firedActivations"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">QueryCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>执行在KIE库中定义的查询。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表100。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询名称。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询结果的ID。使用此标识符将查询结果添加到执行结果中。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>arguments</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要作为查询参数传递的对象列表。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [
    {
      "query": {
        "name": "persons",
        "arguments": [],
        "out-identifier": "persons"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">QueryCommand queryCommand = new QueryCommand();
queryCommand.setName("persons");
queryCommand.setOutIdentifier("persons");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "SUCCESS",
  "msg": "Container stateful-session successfully called.",
  "result": {
    "execution-results": {
      "results": [
        {
          "value": {
            "org.drools.core.runtime.rule.impl.FlatQueryResults": {
              "idFactHandleMaps": {
                "type": "LIST",
                "componentType": null,
                "element": [
                  {
                    "type": "MAP",
                    "componentType": null,
                    "element": [
                      {
                        "value": {
                          "org.drools.core.common.DisconnectedFactHandle": {
                            "id": 1,
                            "identityHashCode": 1809949690,
                            "objectHashCode": 1809949690,
                            "recency": 1,
                            "object": {
                              "org.kie.server.testing.Person": {
                                "fullname": "John Doe",
                                "age": 47
                              }
                            },
                            "entryPointId": "DEFAULT",
                            "traitType": "NON_TRAIT",
                            "external-form": "0:1:1809949690:1809949690:1:DEFAULT:NON_TRAIT:org.kie.server.testing.Person"
                          }
                        },
                        "key": "$person"
                      }
                    ]
                  }
                ]
              },
              "idResultMaps": {
                "type": "LIST",
                "componentType": null,
                "element": [
                  {
                    "type": "MAP",
                    "componentType": null,
                    "element": [
                      {
                        "value": {
                          "org.kie.server.testing.Person": {
                            "fullname": "John Doe",
                            "age": 47
                          }
                        },
                        "key": "$person"
                      }
                    ]
                  }
                ]
              },
              "identifiers": {
                "type": "SET",
                "componentType": null,
                "element": [
                  "$person"
                ]
              }
            }
          },
          "key": "persons"
        }
      ],
      "facts": []
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">SetGlobalCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>将对象设置为全局状态。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表101。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在KIE库中定义的全局变量的ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>object</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要设置为全局变量的对象</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>out</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">布尔值，从执行结果中排除您设置的全局变量</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">全局执行结果的ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [
    {
      "set-global": {
        "identifier": "helper",
        "object": {
          "org.kie.server.testing.Person": {
            "fullname": "kyle",
            "age": 30
          }
        },
        "out-identifier": "output"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">SetGlobalCommand setGlobalCommand = new SetGlobalCommand();
setGlobalCommand.setIdentifier("helper");
setGlobalCommand.setObject(new Person("kyle", 30));
setGlobalCommand.setOut(true);
setGlobalCommand.setOutIdentifier("output");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "type": "SUCCESS",
  "msg": "Container stateful-session successfully called.",
  "result": {
    "execution-results": {
      "results": [
        {
          "value": {
            "org.kie.server.testing.Person": {
              "fullname": "kyle",
              "age": 30
            }
          },
          "key": "output"
        }
      ],
      "facts": []
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">GetGlobalCommand</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>检索先前定义的全局对象。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表102。命令属性</caption>
<colgroup>
<col style="width:30%">
<col style="width:50%">
<col style="width:20%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需求</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在KIE库中定义的全局变量的ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>out-identifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">执行结果中使用的ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选的</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">JSON请求正文示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "commands": [ {
      "get-global": {
        "identifier": "helper",
        "out-identifier": "helperOutput"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">示例Java命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">GetGlobalCommand getGlobalCommand = new GetGlobalCommand();
getGlobalCommand.setIdentifier("helper");
getGlobalCommand.setOutIdentifier("helperOutput");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例（JSON）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "response": [
    {
      "type": "SUCCESS",
      "msg": "Container command-script-container successfully called.",
      "result": {
        "execution-results": {
          "results": [
            {
              "value": null,
              "key": "helperOutput"
            }
          ],
          "facts": []
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="controller-rest-api-con_kie-apis"><a class="anchor" href="#controller-rest-api-con_kie-apis"></a> <a class="link" href="#controller-rest-api-con_kie-apis">19.12。适用于KIE Server模板和实例的Drools控制器REST API</a></h3>
<div class="paragraph">
<p>Drools提供了Drools控制器REST API，可用于与Drools中的KIE Server模板（配置），KIE Server实例（远程服务器）以及关联的KIE容器（部署单元）进行交互，而无需使用Business Central用户界面。此API支持使您可以更有效地维护Drools服务器和资源，并优化与Drools的集成和开发。</p>
</div>
<div class="paragraph">
<p>使用Drools控制器REST API，您可以执行以下操作：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>检索有关KIE Server模板，实例和关联的KIE容器的信息</p>
</li>
<li>
<p>更新，启动或停止与KIE Server模板和实例关联的KIE容器</p>
</li>
<li>
<p>创建，更新或删除KIE服务器模板</p>
</li>
<li>
<p>创建，更新或删除KIE Server实例</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>对Drools控制器REST API的请求需要以下组件：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">认证方式</dt>
<dd>
<p>对于以下用户角色，Drools控制器REST API需要HTTP基本身份验证或基于令牌的身份验证，具体取决于控制器类型：</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>rest-all</code>用户角色（如果您安装了Business Central并且想要使用内置的Drools控制器）</p>
</li>
<li>
<p><code>kie-server</code>用户角色（如果您与Business Central分开安装了无头Drools控制器）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>要查看您的Drools发行版的已配置用户角色，请导航至<code>~/$SERVER_HOME/standalone/configuration/application-roles.properties</code>和<code>~/application-users.properties</code> 。</p>
</div>
<div class="paragraph">
<p>要为用户添加<code>kie-server</code>角色或<code>rest-all</code>角色或两者兼而有之，导航到<code>~/$SERVER_HOME/bin</code>并使用指定的一个或多个角色运行以下命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./add-user.sh -a --user &lt;USERNAME&gt; --password &lt;PASSWORD&gt; --role kie-server,rest-all</code></pre>
</div>
</div>
<div class="paragraph">
<p>配置<code>kie-server</code>要么<code>rest-all</code>具有Drools控制器访问权限的用户，导航至<code>~/$SERVER_HOME/standalone/configuration/standalone-full.xml</code> ，取消注释<code>org.kie.server</code>属性（如果适用），然后添加控制器用户登录凭据和控制器位置（如果需要）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;property name="org.kie.server.location" value="http://localhost:8080/kie-server/services/rest/server"/&gt;
&lt;property name="org.kie.server.controller" value="http://localhost:8080/business-central/rest/controller"/&gt;
&lt;property name="org.kie.server.controller.user" value="baAdmin"/&gt;
&lt;property name="org.kie.server.controller.pwd" value="password@1"/&gt;
&lt;property name="org.kie.server.id" value="default-kieserver"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关用户角色和Drools安装选项的更多信息，请参见<a href="#_installing_the_kie_server">安装KIE服务器</a> 。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">HTTP标头</dt>
<dd>
<p>Drools控制器REST API需要以下HTTP标头来处理API请求：</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code> ：请求客户接受的数据格式：</p>
<div class="ulist">
<ul>
<li>
<p><code>application/json</code> （JSON）</p>
</li>
<li>
<p><code>application/xml</code> （XML，用于JAXB）</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Content-Type</code> ：您的数据格式<code>POST</code>要么<code>PUT</code> API请求数据：</p>
<div class="ulist">
<ul>
<li>
<p><code>application/json</code> （JSON）</p>
</li>
<li>
<p><code>application/xml</code> （XML，用于JAXB）</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">HTTP方法</dt>
<dd>
<p>Drools控制器REST API支持以下针对API请求的HTTP方法：</p>
<div class="ulist">
<ul>
<li>
<p><code>GET</code> ：从指定的资源端点检索指定的信息</p>
</li>
<li>
<p><code>POST</code> ：更新资源或资源实例</p>
</li>
<li>
<p><code>PUT</code> ：创建资源或资源实例</p>
</li>
<li>
<p><code>DELETE</code> ：删除资源或资源实例</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">基本网址</dt>
<dd>
<p>Drools控制器REST API请求的基本URL为<code>http://SERVER:PORT/CONTROLLER/rest/</code> ， 如<code>http://localhost:8080/business-central/rest/</code>如果您使用的是Business Central内置的Drools控制器。</p>
</dd>
<dt class="hdlist1">终点</dt>
<dd>
<p>Drools控制器REST API端点，例如<code>/controller/management/servers/{serverTemplateId}</code>对于指定的KIE Server模板，是您附加到Drools控制器REST API基本URL的URI，以访问Drools中的相应服务器资源或服务器资源类型。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<div class="title">的请求网址示例<code>/controller/management/servers/{serverTemplateId}</code>终点</div>
<p><code>http://localhost:8080/business-central/rest/controller/management/servers/default-kieserver</code></p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">请求参数和请求数据</dt>
<dd>
<p>某些Drools控制器REST API请求在请求URL路径中需要特定的参数，以标识或过滤特定的资源并执行特定的操作。您可以将URL参数以以下格式附加到端点<code>?<PARAM>=<VALUE>&<PARAM>=<VALUE></code> 。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<div class="title">带参数的示例DELETE请求URL</div>
<p><code>http://localhost:8080/business-central/rest/controller/server/new-kieserver-instance?location=http://localhost:8080/kie-server/services/rest/server</code></p>
</div>
<div class="paragraph">
<p>HTTP <code>POST</code>和<code>PUT</code>请求可能另外需要带有数据的请求正文或文件，以伴随该请求。</p>
</div>
<div class="paragraph">
<div class="title">示例PUT请求URL和JSON请求主体数据</div>
<p><code>http://localhost:8080/business-central/rest/controller/management/servers/new-kieserver</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "server-id": "new-kieserver",
  "server-name": "new-kieserver",
  "container-specs": [],
  "server-config": {},
  "capabilities": [
    "RULE",
    "PROCESS",
    "PLANNING"
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="controller-rest-api-requests-proc_kie-apis"><a class="anchor" href="#controller-rest-api-requests-proc_kie-apis"></a> <a class="link" href="#controller-rest-api-requests-proc_kie-apis">19.12.1。使用REST客户端或curl实用程序使用Drools控制器REST API发送请求</a></h4>
<div class="paragraph">
<p>Drools控制器REST API使您可以在不使用Business Central用户界面的情况下与Drools中的KIE Server模板（配置），KIE Server实例（远程服务器）以及关联的KIE容器（部署单元）进行交互。您可以使用任何REST客户端或curl实用程序发送Drools控制器REST API请求。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>KIE服务器已安装并正在运行。</p>
</li>
<li>
<p>Drools控制器或无头Drools控制器已安装并正在运行。</p>
</li>
<li>
<p>你有<code>rest-all</code>用户角色对Drools控制器的访问权限（如果已安装Business Central），或者<code>kie-server</code>用户角色可以访问与Business Central分开安装的无头Drools控制器。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>标识要向其发送请求的相关<a href="#controller-rest-api-endpoints-ref_kie-apis">API端点</a> ，例如<code>[GET] /controller/management/servers</code>从Drools控制器中检索KIE Server模板。</p>
</li>
<li>
<p>在REST客户端或curl实用程序中，为<code>GET</code>请求<code>controller/management/servers</code> 。根据您的用例调整任何请求详细信息。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>对于REST客户端：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>身份验证</strong> ：使用以下命令输入Drools控制器用户的用户名和密码： <code>rest-all</code>角色或无头Drools控制器用户<code>kie-server</code>角色。</p>
</li>
<li>
<p><strong>HTTP标头</strong> ：设置以下标头：</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code> ：<code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>HTTP方法</strong> ：设置为<code>GET</code> 。</p>
</li>
<li>
<p><strong>URL</strong> ：输入Drools控制器REST API的基本URL和端点，例如<code>http://localhost:8080/business-central/rest/controller/management/servers</code> 。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>对于curl实用程序：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-u</code> ：使用以下命令输入Drools控制器用户的用户名和密码： <code>rest-all</code>角色或无头Drools控制器用户<code>kie-server</code>角色。</p>
</li>
<li>
<p><code>-H</code> ：设置以下标题：</p>
<div class="ulist">
<ul>
<li>
<p><code>accept</code> ：<code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>-X</code> ： 调成<code>GET</code> 。</p>
</li>
<li>
<p><strong>URL</strong> ：输入Drools控制器REST API的基本URL和端点，例如<code>http://localhost:8080/business-central/rest/controller/management/servers</code> 。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -X GET "http://localhost:8080/business-central/rest/controller/management/servers"</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>执行请求并查看Drools控制器响应。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>服务器响应示例（JSON）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "server-template": [
    {
      "server-id": "default-kieserver",
      "server-name": "default-kieserver",
      "container-specs": [
        {
          "container-id": "employeerostering_1.0.0-SNAPSHOT",
          "container-name": "employeerostering",
          "server-template-key": {
            "server-id": "default-kieserver",
            "server-name": "default-kieserver"
          },
          "release-id": {
            "group-id": "employeerostering",
            "artifact-id": "employeerostering",
            "version": "1.0.0-SNAPSHOT"
          },
          "configuration": {
            "RULE": {
              "org.kie.server.controller.api.model.spec.RuleConfig": {
                "pollInterval": null,
                "scannerStatus": "STOPPED"
              }
            },
            "PROCESS": {
              "org.kie.server.controller.api.model.spec.ProcessConfig": {
                "runtimeStrategy": "SINGLETON",
                "kbase": "",
                "ksession": "",
                "mergeMode": "MERGE_COLLECTIONS"
              }
            }
          },
          "status": "STARTED"
        },
        {
          "container-id": "mortgage-process_1.0.0-SNAPSHOT",
          "container-name": "mortgage-process",
          "server-template-key": {
            "server-id": "default-kieserver",
            "server-name": "default-kieserver"
          },
          "release-id": {
            "group-id": "mortgage-process",
            "artifact-id": "mortgage-process",
            "version": "1.0.0-SNAPSHOT"
          },
          "configuration": {
            "RULE": {
              "org.kie.server.controller.api.model.spec.RuleConfig": {
                "pollInterval": null,
                "scannerStatus": "STOPPED"
              }
            },
            "PROCESS": {
              "org.kie.server.controller.api.model.spec.ProcessConfig": {
                "runtimeStrategy": "PER_PROCESS_INSTANCE",
                "kbase": "",
                "ksession": "",
                "mergeMode": "MERGE_COLLECTIONS"
              }
            }
          },
          "status": "STARTED"
        }
      ],
      "server-config": {},
      "server-instances": [
        {
          "server-instance-id": "default-kieserver-instance@localhost:8080",
          "server-name": "default-kieserver-instance@localhost:8080",
          "server-template-id": "default-kieserver",
          "server-url": "http://localhost:8080/kie-server/services/rest/server"
        }
      ],
      "capabilities": [
        "RULE",
        "PROCESS",
        "PLANNING"
      ]
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>在您的REST客户端或curl实用程序中，使用以下组件发送另一个API请求： <code>PUT</code>请求<code>/controller/management/servers/{serverTemplateId}</code>创建一个新的KIE Server模板。根据您的用例调整任何请求详细信息。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>对于REST客户端：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>身份验证</strong> ：使用以下命令输入Drools控制器用户的用户名和密码： <code>rest-all</code>角色或无头Drools控制器用户<code>kie-server</code>角色。</p>
</li>
<li>
<p><strong>HTTP标头</strong> ：设置以下标头：</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code> ：<code>application/json</code></p>
</li>
<li>
<p><code>Content-Type</code> ：<code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>HTTP方法</strong> ：设置为<code>PUT</code> 。</p>
</li>
<li>
<p><strong>URL</strong> ：输入Drools控制器REST API的基本URL和端点，例如<code>http://localhost:8080/business-central/rest/controller/management/servers/new-kieserver</code> 。</p>
</li>
<li>
<p><strong>请求正文</strong> ：添加带有新KIE Server模板配置的JSON请求正文：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "server-id": "new-kieserver",
  "server-name": "new-kieserver",
  "container-specs": [],
  "server-config": {},
  "capabilities": [
    "RULE",
    "PROCESS",
    "PLANNING"
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于curl实用程序：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-u</code> ：使用以下命令输入Drools控制器用户的用户名和密码： <code>rest-all</code>角色或无头Drools控制器用户<code>kie-server</code>角色。</p>
</li>
<li>
<p><code>-H</code> ：设置以下标题：</p>
<div class="ulist">
<ul>
<li>
<p><code>accept</code> ：<code>application/json</code></p>
</li>
<li>
<p><code>content-type</code> ：<code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>-X</code> ： 调成<code>PUT</code> 。</p>
</li>
<li>
<p><strong>URL</strong> ：输入Drools控制器REST API的基本URL和端点，例如<code>http://localhost:8080/business-central/rest/controller/management/servers/new-kieserver</code> 。</p>
</li>
<li>
<p><code>-d</code> ：添加JSON请求正文或文件（ <code>@file.json</code> ）以及新KIE服务器模板的配置：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -H "content-type: application/json" -X PUT "http://localhost:8080/business-central/rest/controller/management/servers/new-kieserver" -d "{ \"server-id\": \"new-kieserver\", \"server-name\": \"new-kieserver\", \"container-specs\": [], \"server-config\": {}, \"capabilities\": [ \"RULE\", \"PROCESS\", \"PLANNING\" ]}"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -H "content-type: application/json" -X PUT "http://localhost:8080/business-central/rest/controller/management/servers/new-kieserver" -d @my-server-template-configs.json</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>执行请求并确认成功的Drools控制器响应。</p>
<div class="paragraph">
<p>如果遇到请求错误，请查看返回的错误代码消息并相应地调整您的请求。</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="controller-rest-api-requests-swagger-proc_kie-apis"><a class="anchor" href="#controller-rest-api-requests-swagger-proc_kie-apis"></a> <a class="link" href="#controller-rest-api-requests-swagger-proc_kie-apis">19.12.2。使用Swagger接口通过Drools控制器REST API发送请求</a></h4>
<div class="paragraph">
<p>Drools控制器REST API支持Swagger Web界面，您可以使用它而不是独立的REST客户端或curl实用程序来与Drools中的KIE Server模板，实例和关联的KIE容器进行交互，而无需使用Business Central用户界面。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">默认情况下，Drools控制器的Swagger Web界面由<code>org.kie.workbench.swagger.disabled=false</code>系统属性。要为Drools控制器禁用Swagger Web界面，请将此系统属性设置为<code>true</code> 。
</td>
</tr>
</tbody></table>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>Drools控制器已安装并正在运行。</p>
</li>
<li>
<p>你有<code>rest-all</code>用户角色对Drools控制器的访问权限（如果已安装Business Central），或者<code>kie-server</code>用户角色可以访问与Business Central分开安装的无头Drools控制器。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在网络浏览器中，导航到<code>http://SERVER:PORT/CONTROLLER/docs</code> ， 如<code>http://localhost:8080/business-central/docs</code> ，然后使用Drools控制器用户的用户名和密码登录。 <code>rest-all</code>角色或无头Drools控制器用户<code>kie-server</code>角色。</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">如果您使用的是内置于Business Central的Drools控制器，则与Drools控制器关联的Swagger页面将被标识为Business Central REST服务的“ Business Central API”。如果您在不使用Business Central的情况下使用无头Drools控制器，则与无头Drools控制器关联的Swagger页面将被标识为“ Controller API”。在这两种情况下，Drools控制器的REST API端点都是相同的。
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>在Swagger页面中，选择要向其发送请求的相关API端点，例如<strong>Controller :: KIE Server模板和KIE容器</strong> → <strong>[GET] / controller / management / servers</strong>以从Drools控制器中检索KIE Server模板。</p>
</li>
<li>
<p>单击“ <strong>试用”，</strong>并提供要用于过滤结果的所有可选参数（如果适用）。</p>
</li>
<li>
<p>在“ <strong>响应内容类型”</strong>下拉菜单中，选择服务器响应的所需格式，例如JSON格式的<strong>application / json</strong> 。</p>
</li>
<li>
<p>单击<strong>执行</strong>并查看KIE服务器响应。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>服务器响应示例（JSON）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "server-template": [
    {
      "server-id": "default-kieserver",
      "server-name": "default-kieserver",
      "container-specs": [
        {
          "container-id": "employeerostering_1.0.0-SNAPSHOT",
          "container-name": "employeerostering",
          "server-template-key": {
            "server-id": "default-kieserver",
            "server-name": "default-kieserver"
          },
          "release-id": {
            "group-id": "employeerostering",
            "artifact-id": "employeerostering",
            "version": "1.0.0-SNAPSHOT"
          },
          "configuration": {
            "RULE": {
              "org.kie.server.controller.api.model.spec.RuleConfig": {
                "pollInterval": null,
                "scannerStatus": "STOPPED"
              }
            },
            "PROCESS": {
              "org.kie.server.controller.api.model.spec.ProcessConfig": {
                "runtimeStrategy": "SINGLETON",
                "kbase": "",
                "ksession": "",
                "mergeMode": "MERGE_COLLECTIONS"
              }
            }
          },
          "status": "STARTED"
        },
        {
          "container-id": "mortgage-process_1.0.0-SNAPSHOT",
          "container-name": "mortgage-process",
          "server-template-key": {
            "server-id": "default-kieserver",
            "server-name": "default-kieserver"
          },
          "release-id": {
            "group-id": "mortgage-process",
            "artifact-id": "mortgage-process",
            "version": "1.0.0-SNAPSHOT"
          },
          "configuration": {
            "RULE": {
              "org.kie.server.controller.api.model.spec.RuleConfig": {
                "pollInterval": null,
                "scannerStatus": "STOPPED"
              }
            },
            "PROCESS": {
              "org.kie.server.controller.api.model.spec.ProcessConfig": {
                "runtimeStrategy": "PER_PROCESS_INSTANCE",
                "kbase": "",
                "ksession": "",
                "mergeMode": "MERGE_COLLECTIONS"
              }
            }
          },
          "status": "STARTED"
        }
      ],
      "server-config": {},
      "server-instances": [
        {
          "server-instance-id": "default-kieserver-instance@localhost:8080",
          "server-name": "default-kieserver-instance@localhost:8080",
          "server-template-id": "default-kieserver",
          "server-url": "http://localhost:8080/kie-server/services/rest/server"
        }
      ],
      "capabilities": [
        "RULE",
        "PROCESS",
        "PLANNING"
      ]
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>在Swagger页面中，导航到<strong>Controller :: KIE Server模板和KIE容器</strong> → <strong>[GET] / controller / management / servers / {serverTemplateId}</strong>端点，以发送另一个请求以创建新的KIE Server模板。根据您的用例调整任何请求详细信息。</p>
</li>
<li>
<p>单击“ <strong>试用”，</strong>然后为请求输入以下组件：</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>serverTemplateId</strong> ：输入新KIE Server模板的ID，例如<code>new-kieserver</code> 。</p>
</li>
<li>
<p><strong>body</strong> ：将<strong>Parameter内容类型</strong>设置为所需的请求正文格式，例如JSON格式的<strong>application / json</strong> ，并添加具有新KIE Server模板配置的请求正文：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "server-id": "new-kieserver",
  "server-name": "new-kieserver",
  "container-specs": [],
  "server-config": {},
  "capabilities": [
    "RULE",
    "PROCESS",
    "PLANNING"
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>在“ <strong>响应内容类型”</strong>下拉菜单中，选择服务器响应的所需格式，例如JSON格式的<strong>application / json</strong> 。</p>
</li>
<li>
<p>单击<strong>执行</strong>并确认成功的Drools控制器响应。</p>
<div class="paragraph">
<p>如果遇到请求错误，请查看返回的错误代码消息并相应地调整您的请求。</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="controller-rest-api-endpoints-ref_kie-apis"><a class="anchor" href="#controller-rest-api-endpoints-ref_kie-apis"></a> <a class="link" href="#controller-rest-api-endpoints-ref_kie-apis">19.12.3。受支持的Drools控制器REST API端点</a></h4>
<div class="paragraph">
<p>Drools控制器REST API提供了用于与KIE Server模板（配置），KIE Server实例（远程服务器）以及关联的KIE容器（部署单元）进行交互的端点。Drools控制器REST API的基本URL为<code>http://SERVER:PORT/CONTROLLER/rest/</code> 。对于所有请求，所有请求都需要HTTP基本身份验证或基于令牌的身份验证<code>rest-all</code>用户角色（如果您安装了Business Central并且想要使用内置的Drools控制器，或者<code>kie-server</code>用户角色（如果您与Business Central分开安装了无头Drools控制器）。</p>
</div>
<div class="paragraph">
<p>有关Drools控制器REST API端点和描述的完整列表，请使用以下资源之一：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>jBPM文档页面上的<a href="http://jbpm.org/learn/documentation.html">Controller REST API</a> （静态）</p>
</li>
<li>
<p>Drools控制器REST API的Swagger UI，位于<code>http://SERVER:PORT/CONTROLLER/docs</code> （动态，需要运行Drools控制器）</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>默认情况下，Drools控制器的Swagger Web界面由<code>org.kie.workbench.swagger.disabled=false</code>系统属性。要为Drools控制器禁用Swagger Web界面，请将此系统属性设置为<code>true</code> 。</p>
</div>
<div class="paragraph">
<p>如果您使用的是内置于Business Central的Drools控制器，则与Drools控制器关联的Swagger页面将被标识为Business Central REST服务的“ Business Central API”。如果您在不使用Business Central的情况下使用无头Drools控制器，则与无头Drools控制器关联的Swagger页面将被标识为“ Controller API”。在这两种情况下，Drools控制器的REST API端点都是相同的。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="controller-java-api-con_kie-apis"><a class="anchor" href="#controller-java-api-con_kie-apis"></a> <a class="link" href="#controller-java-api-con_kie-apis">19.13。用于KIE Server模板和实例的Drools控制器Java客户端API</a></h3>
<div class="paragraph">
<p>Drools提供了Drools控制器Java客户端API，使您能够使用Java客户端应用程序中的REST或WebSocket协议连接到Drools控制器。您可以使用Drools控制器Java客户端API替代Drools控制器REST API来与Drools中的KIE Server模板（配置），KIE Server实例（远程服务器）和关联的KIE容器（部署单元）进行交互，而无需使用业务中心用户界面。此API支持使您可以更有效地维护Drools服务器和资源，并优化与Drools的集成和开发。</p>
</div>
<div class="paragraph">
<p>使用Drools控制器Java客户端API，您可以执行Drools控制器REST API也支持的以下操作：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>检索有关KIE Server模板，实例和关联的KIE容器的信息</p>
</li>
<li>
<p>更新，启动或停止与KIE Server模板和实例关联的KIE容器</p>
</li>
<li>
<p>创建，更新或删除KIE服务器模板</p>
</li>
<li>
<p>创建，更新或删除KIE Server实例</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Drools控制器Java客户端API请求需要以下组件：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">认证方式</dt>
<dd>
<p>Drools控制器Java客户端API需要以下用户角色的HTTP Basic身份验证，具体取决于控制器类型：</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>rest-all</code>用户角色（如果您安装了Business Central并且想要使用内置的Drools控制器）</p>
</li>
<li>
<p><code>kie-server</code>用户角色（如果您与Business Central分开安装了无头Drools控制器）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>要查看您的Drools发行版的已配置用户角色，请导航至<code>~/$SERVER_HOME/standalone/configuration/application-roles.properties</code>和<code>~/application-users.properties</code> 。</p>
</div>
<div class="paragraph">
<p>要为用户添加<code>kie-server</code>角色或<code>rest-all</code>角色或两者兼而有之，导航到<code>~/$SERVER_HOME/bin</code>并使用指定的一个或多个角色运行以下命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./add-user.sh -a --user &lt;USERNAME&gt; --password &lt;PASSWORD&gt; --role kie-server,rest-all</code></pre>
</div>
</div>
<div class="paragraph">
<p>配置<code>kie-server</code>要么<code>rest-all</code>具有Drools控制器访问权限的用户，导航至<code>~/$SERVER_HOME/standalone/configuration/standalone-full.xml</code> ，取消注释<code>org.kie.server</code>属性（如果适用），然后添加控制器用户登录凭据和控制器位置（如果需要）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;property name="org.kie.server.location" value="http://localhost:8080/kie-server/services/rest/server"/&gt;
&lt;property name="org.kie.server.controller" value="http://localhost:8080/business-central/rest/controller"/&gt;
&lt;property name="org.kie.server.controller.user" value="baAdmin"/&gt;
&lt;property name="org.kie.server.controller.pwd" value="password@1"/&gt;
&lt;property name="org.kie.server.id" value="default-kieserver"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关用户角色和Drools安装选项的更多信息，请参见<a href="#_installing_the_kie_server">安装KIE服务器</a> 。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">项目依赖</dt>
<dd>
<p>Drools控制器Java客户端API需要对Java项目的相关类路径具有以下依赖关系：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- For remote execution on controller --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
  &lt;artifactId&gt;kie-server-controller-client&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For REST client --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
  &lt;artifactId&gt;resteasy-client&lt;/artifactId&gt;
  &lt;version&gt;${resteasy.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For WebSocket client --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;io.undertow&lt;/groupId&gt;
  &lt;artifactId&gt;undertow-websockets-jsr&lt;/artifactId&gt;
  &lt;version&gt;${undertow.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For debug logging (optional) --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
  &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
  &lt;version&gt;${logback.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code><version></code> for Drools依赖项是项目中当前使用的Drools的Maven工件版本（例如7.26.0）。Final-redhat-00005）。</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">客户端请求配置</dt>
<dd>
<p>使用Drools控制器Java客户端API的所有Java客户端请求必须至少定义以下控制器通信组件：</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>凭证<code>rest-all</code>用户（如果您安装了Business Central），或者<code>kie-server</code>用户（如果您与Business Central分开安装了无头Drools控制器）</p>
</li>
<li>
<p>REST或WebSocket协议的Drools控制器位置：</p>
<div class="ulist">
<ul>
<li>
<p>REST URL示例：<code>http://localhost:8080/business-central/rest/controller</code></p>
</li>
<li>
<p>WebSocket URL示例：<code>ws://localhost:8080/headless-controller/websocket/controller</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>API请求和响应的编组格式（JSON或JAXB）</p>
</li>
<li>
<p>一种<code>KieServerControllerClient</code>对象，用作使用Java客户端API启动服务器通信的入口点</p>
</li>
<li>
<p>一种<code>KieServerControllerClientFactory</code>定义REST或WebSocket协议以及用户访问权限</p>
</li>
<li>
<p>Drools控制器客户端服务或所使用的服务，例如<code>listServerTemplates</code> ， <code>getServerTemplate</code> ， 要么<code>getServerInstances</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以下是带有这些组件的REST和WebSocket客户端配置的示例：</p>
</div>
<div class="listingblock">
<div class="title">REST的客户端配置示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.server.api.marshalling.MarshallingFormat;
import org.kie.server.controller.api.model.spec.ServerTemplateList;
import org.kie.server.controller.client.KieServerControllerClient;
import org.kie.server.controller.client.KieServerControllerClientFactory;

public class ListServerTemplatesExample {

    private static final String URL = "http://localhost:8080/business-central/rest/controller";
    private static final String USER = "baAdmin";
    private static final String PASSWORD = "password@1";

    private static final MarshallingFormat FORMAT = MarshallingFormat.JSON;

    public static void main(String[] args) {
        KieServerControllerClient client = KieServerControllerClientFactory.newRestClient(URL,
                                                                                          USER,
                                                                                          PASSWORD);

        final ServerTemplateList serverTemplateList = client.listServerTemplates();
        System.out.println(String.format("Found %s server template(s) at controller url: %s",
                                         serverTemplateList.getServerTemplates().length,
                                         URL));
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">WebSocket的客户端配置示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.server.api.marshalling.MarshallingFormat;
import org.kie.server.controller.api.model.spec.ServerTemplateList;
import org.kie.server.controller.client.KieServerControllerClient;
import org.kie.server.controller.client.KieServerControllerClientFactory;

public class ListServerTemplatesExample {

    private static final String URL = "ws://localhost:8080/my-controller/websocket/controller";
    private static final String USER = "baAdmin";
    private static final String PASSWORD = "password@1";

    private static final MarshallingFormat FORMAT = MarshallingFormat.JSON;

    public static void main(String[] args) {
        KieServerControllerClient client = KieServerControllerClientFactory.newWebSocketClient(URL,
                                                                                               USER,
                                                                                               PASSWORD);

        final ServerTemplateList serverTemplateList = client.listServerTemplates();
        System.out.println(String.format("Found %s server template(s) at controller url: %s",
                                         serverTemplateList.getServerTemplates().length,
                                         URL));
    }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="controller-java-api-requests-proc_kie-apis"><a class="anchor" href="#controller-java-api-requests-proc_kie-apis"></a> <a class="link" href="#controller-java-api-requests-proc_kie-apis">19.13.1。使用Drools控制器Java客户端API发送请求</a></h4>
<div class="paragraph">
<p>Drools控制器Java客户端API使您可以使用Java客户端应用程序中的REST或WebSocket协议连接到Drools控制器。您可以使用Drools控制器Java客户端API替代Drools控制器REST API来与Drools中的KIE Server模板（配置），KIE Server实例（远程服务器）和关联的KIE容器（部署单元）进行交互，而无需使用业务中心用户界面。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>KIE服务器已安装并正在运行。</p>
</li>
<li>
<p>Drools控制器或无头Drools控制器已安装并正在运行。</p>
</li>
<li>
<p>你有<code>rest-all</code>用户角色对Drools控制器的访问权限（如果已安装Business Central），或者<code>kie-server</code>用户角色可以访问与Business Central分开安装的无头Drools控制器。</p>
</li>
<li>
<p>您有一个带有Drools资源的Java项目。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在客户端应用程序中，确保已将以下依赖项添加到Java项目的相关类路径中：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- For remote execution on controller --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
  &lt;artifactId&gt;kie-server-controller-client&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For REST client --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
  &lt;artifactId&gt;resteasy-client&lt;/artifactId&gt;
  &lt;version&gt;${resteasy.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For WebSocket client --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;io.undertow&lt;/groupId&gt;
  &lt;artifactId&gt;undertow-websockets-jsr&lt;/artifactId&gt;
  &lt;version&gt;${undertow.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- For debug logging (optional) --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
  &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
  &lt;version&gt;${logback.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>在里面<code>~/kie/server/controller/client</code> <a href="https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-controller/kie-server-controller-client/src/main/java/org/kie/server/controller/client">GitHub中</a> Java客户端API的文件夹，标识您要发送的请求的相关Java客户端实现，例如<code>RestKieServerControllerClient</code>实现以REST协议访问KIE服务器模板和KIE容器的客户端服务。</p>
</li>
<li>
<p>在您的客户端应用程序中，创建一个<code>.java</code> API请求的类。该类必须包含必要的导入，Drools控制器位置和用户凭据， <code>KieServerControllerClient</code>对象以及要执行的客户端方法，例如<code>createServerTemplate</code>和<code>createContainer</code>来自<code>RestKieServerControllerClient</code>实施。根据您的用例调整任何配置详细信息。</p>
<div class="listingblock">
<div class="title">创建和与KIE Server模板和KIE容器进行交互</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;

import org.kie.server.api.marshalling.MarshallingFormat;
import org.kie.server.api.model.KieContainerStatus;
import org.kie.server.api.model.KieScannerStatus;
import org.kie.server.api.model.ReleaseId;
import org.kie.server.controller.api.model.spec.*;
import org.kie.server.controller.client.KieServerControllerClient;
import org.kie.server.controller.client.KieServerControllerClientFactory;

public class RestTemplateContainerExample {

  private static final String URL = "http://localhost:8080/business-central/rest/controller";
  private static final String USER = "baAdmin";
  private static final String PASSWORD = "password@1";

    private static KieServerControllerClient client;

    public static void main(String[] args) {
        KieServerControllerClient client = KieServerControllerClientFactory.newRestClient(URL,
                                                                                          USER,
                                                                                          PASSWORD,
                                                                                          MarshallingFormat.JSON);
        // Create server template and KIE container, start and stop KIE container, and delete server template
        ServerTemplate serverTemplate = createServerTemplate();
        ContainerSpec container = createContainer(serverTemplate);
        client.startContainer(container);
        client.stopContainer(container);
        client.deleteServerTemplate(serverTemplate.getId());
    }

    // Re-create and configure server template
    protected static ServerTemplate createServerTemplate() {
        ServerTemplate serverTemplate = new ServerTemplate();
        serverTemplate.setId("example-client-id");
        serverTemplate.setName("example-client-name");
        serverTemplate.setCapabilities(Arrays.asList(Capability.PROCESS.name(),
                                                     Capability.RULE.name(),
                                                     Capability.PLANNING.name()));

        client.saveServerTemplate(serverTemplate);

        return serverTemplate;
    }

    // Re-create and configure KIE containers
    protected static ContainerSpec createContainer(ServerTemplate serverTemplate){
        Map&lt;Capability, ContainerConfig&gt; containerConfigMap = new HashMap();

        ProcessConfig processConfig = new ProcessConfig("PER_PROCESS_INSTANCE", "kieBase", "kieSession", "MERGE_COLLECTION");
        containerConfigMap.put(Capability.PROCESS, processConfig);

        RuleConfig ruleConfig = new RuleConfig(500l, KieScannerStatus.SCANNING);
        containerConfigMap.put(Capability.RULE, ruleConfig);

        ReleaseId releaseId = new ReleaseId("org.kie.server.testing", "stateless-session-kjar", "1.0.0-SNAPSHOT");

        ContainerSpec containerSpec = new ContainerSpec("example-container-id", "example-client-name", serverTemplate, releaseId, KieContainerStatus.STOPPED, containerConfigMap);
        client.saveContainerSpec(serverTemplate.getId(), containerSpec);

        return containerSpec;
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p>运行配置的<code>.java</code>类从您的项目目录执行请求，并查看Drools控制器响应。</p>
<div class="paragraph">
<p>如果启用了调试日志记录，则KIE Server会根据您配置的编组格式（例如JSON）做出详细响应。如果遇到请求错误，请查看返回的错误代码消息并相应地调整Java配置。</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="controller-java-clients-ref_kie-apis"><a class="anchor" href="#controller-java-clients-ref_kie-apis"></a> <a class="link" href="#controller-java-clients-ref_kie-apis">19.13.2。受支持的Drools控制器Java客户端</a></h4>
<div class="paragraph">
<p>以下是Java客户端中提供的一些Java客户端服务： <code>org.kie.server.controller.client</code>您的Drools发行套件。您可以使用这些服务与Drools控制器REST API类似地与Drools控制器中的相关资源进行交互。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>KieServerControllerClient</code> ：用作与Drools控制器进行通信的入口点</p>
</li>
<li>
<p><code>RestKieServerControllerClient</code> ：用于与REST协议中的KIE Server模板和KIE容器进行交互的实现（位于<code>~/org/kie/server/controller/client/rest</code> ）</p>
</li>
<li>
<p><code>WebSocketKieServerControllerClient</code> ：用于与WebSocket协议中的KIE Server模板和KIE容器进行交互的实现（位于<code>~/org/kie/server/controller/client/websocket</code> ）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>有关可用的Drools控制器Java客户端的完整列表，请参见<a href="https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-controller/kie-server-controller-client/src/main/java/org/kie/server/controller/client">GitHub中</a>的Java客户端API源。</p>
</div>
</div>
<div class="sect3">
<h4 id="controller-java-api-examples-ref_kie-apis"><a class="anchor" href="#controller-java-api-examples-ref_kie-apis"></a> <a class="link" href="#controller-java-api-examples-ref_kie-apis">19.13.3。使用Drools控制器Java客户端API的示例请求</a></h4>
<div class="paragraph">
<p>以下是Drools控制器Java客户端API请求与Drools控制器进行基本交互的示例。有关可用的Drools控制器Java客户端的完整列表，请参见<a href="https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-controller/kie-server-controller-client/src/main/java/org/kie/server/controller/client">GitHub中</a>的Java客户端API源。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">创建和与KIE Server模板和KIE容器进行交互</dt>
<dd>
<p>您可以使用<code>ServerTemplate</code>和<code>ContainerSpec</code> REST或WebSocket Drools控制器客户端中的服务，以创建，处置和更新KIE Server模板和KIE容器，以及启动和停止KIE容器，如本示例所示。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">创建和与KIE服务器模板和KIE容器进行交互的示例请求</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;

import org.kie.server.api.marshalling.MarshallingFormat;
import org.kie.server.api.model.KieContainerStatus;
import org.kie.server.api.model.KieScannerStatus;
import org.kie.server.api.model.ReleaseId;
import org.kie.server.controller.api.model.spec.*;
import org.kie.server.controller.client.KieServerControllerClient;
import org.kie.server.controller.client.KieServerControllerClientFactory;

public class RestTemplateContainerExample {

  private static final String URL = "http://localhost:8080/business-central/rest/controller";
  private static final String USER = "baAdmin";
  private static final String PASSWORD = "password@1";

    private static KieServerControllerClient client;

    public static void main(String[] args) {
        KieServerControllerClient client = KieServerControllerClientFactory.newRestClient(URL,
                                                                                          USER,
                                                                                          PASSWORD,
                                                                                          MarshallingFormat.JSON);
        // Create server template and KIE container, start and stop KIE container, and delete server template
        ServerTemplate serverTemplate = createServerTemplate();
        ContainerSpec container = createContainer(serverTemplate);
        client.startContainer(container);
        client.stopContainer(container);
        client.deleteServerTemplate(serverTemplate.getId());
    }

    // Re-create and configure server template
    protected static ServerTemplate createServerTemplate() {
        ServerTemplate serverTemplate = new ServerTemplate();
        serverTemplate.setId("example-client-id");
        serverTemplate.setName("example-client-name");
        serverTemplate.setCapabilities(Arrays.asList(Capability.PROCESS.name(),
                                                     Capability.RULE.name(),
                                                     Capability.PLANNING.name()));

        client.saveServerTemplate(serverTemplate);

        return serverTemplate;
    }

    // Re-create and configure KIE containers
    protected static ContainerSpec createContainer(ServerTemplate serverTemplate){
        Map&lt;Capability, ContainerConfig&gt; containerConfigMap = new HashMap();

        ProcessConfig processConfig = new ProcessConfig("PER_PROCESS_INSTANCE", "kieBase", "kieSession", "MERGE_COLLECTION");
        containerConfigMap.put(Capability.PROCESS, processConfig);

        RuleConfig ruleConfig = new RuleConfig(500l, KieScannerStatus.SCANNING);
        containerConfigMap.put(Capability.RULE, ruleConfig);

        ReleaseId releaseId = new ReleaseId("org.kie.server.testing", "stateless-session-kjar", "1.0.0-SNAPSHOT");

        ContainerSpec containerSpec = new ContainerSpec("example-container-id", "example-client-name", serverTemplate, releaseId, KieContainerStatus.STOPPED, containerConfigMap);
        client.saveContainerSpec(serverTemplate.getId(), containerSpec);

        return containerSpec;
    }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">列出KIE Server模板并指定连接超时（REST）</dt>
<dd>
<p>当您对Drools控制器Java客户端API请求使用REST协议时，可以提供自己的<code>javax.ws.rs.core.Configuration</code>修改底层REST客户端API的规范，例如连接超时。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">REST请求示例以返回服务器模板并指定连接超时</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.concurrent.TimeUnit;
import javax.ws.rs.core.Configuration;
import org.jboss.resteasy.client.jaxrs.ResteasyClientBuilder;

import org.kie.server.api.marshalling.MarshallingFormat;
import org.kie.server.controller.api.model.spec.ServerTemplateList;
import org.kie.server.controller.client.KieServerControllerClient;
import org.kie.server.controller.client.KieServerControllerClientFactory;

public class RESTTimeoutExample {

  private static final String URL = "http://localhost:8080/business-central/rest/controller";
  private static final String USER = "baAdmin";
  private static final String PASSWORD = "password@1";

  public static void main(String[] args) {

      // Specify connection timeout
      final Configuration configuration =
              new ResteasyClientBuilder()
                      .establishConnectionTimeout(10,
                                                    TimeUnit.SECONDS)
                      .socketTimeout(60,
                                       TimeUnit.SECONDS)
                        .getConfiguration();
        KieServerControllerClient client = KieServerControllerClientFactory.newRestClient(URL,
                                                                                          USER,
                                                                                          PASSWORD,
                                                                                          MarshallingFormat.JSON,
                                                                                          configuration);

        // Retrieve list of server templates
        final ServerTemplateList serverTemplateList = client.listServerTemplates();
        System.out.println(String.format("Found %s server template(s) at controller url: %s",
                                         serverTemplateList.getServerTemplates().length,
                                         URL));
    }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">列出KIE Server模板并指定事件通知（WebSocket）</dt>
<dd>
<p>当对Drools控制器Java客户端API请求使用WebSocket协议时，可以基于客户端API连接到的特定Drools控制器中发生的更改来启用事件通知。例如，当在Drools控制器中连接或更新KIE Server模板或实例时，您会收到通知。</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">WebSocket请求示例以返回服务器模板并指定事件通知</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.server.api.marshalling.MarshallingFormat;
import org.kie.server.controller.api.model.events.*;
import org.kie.server.controller.api.model.spec.ServerTemplateList;
import org.kie.server.controller.client.KieServerControllerClient;
import org.kie.server.controller.client.KieServerControllerClientFactory;
import org.kie.server.controller.client.event.EventHandler;

public class WebSocketEventsExample {

    private static final String URL = "ws://localhost:8080/my-controller/websocket/controller";
    private static final String USER = "baAdmin";
    private static final String PASSWORD = "password@1";

    public static void main(String[] args) {
        KieServerControllerClient client = KieServerControllerClientFactory.newWebSocketClient(URL,
                                                                                               USER,
                                                                                               PASSWORD,
                                                                                               MarshallingFormat.JSON,
                                                                                               new TestEventHandler());

        // Retrieve list of server templates
        final ServerTemplateList serverTemplateList = client.listServerTemplates();
        System.out.println(String.format("Found %s server template(s) at controller url: %s",
                                         serverTemplateList.getServerTemplates().length,
                                         URL));
        try {
            Thread.sleep(60 * 1000);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // Set up event notifications
    static class TestEventHandler implements EventHandler {

        @Override
        public void onServerInstanceConnected(ServerInstanceConnected serverInstanceConnected) {
            System.out.println("serverInstanceConnected = " + serverInstanceConnected);
        }

        @Override
        public void onServerInstanceDeleted(ServerInstanceDeleted serverInstanceDeleted) {
            System.out.println("serverInstanceDeleted = " + serverInstanceDeleted);
        }

        @Override
        public void onServerInstanceDisconnected(ServerInstanceDisconnected serverInstanceDisconnected) {
            System.out.println("serverInstanceDisconnected = " + serverInstanceDisconnected);
        }

        @Override
        public void onServerTemplateDeleted(ServerTemplateDeleted serverTemplateDeleted) {
            System.out.println("serverTemplateDeleted = " + serverTemplateDeleted);
        }

        @Override
        public void onServerTemplateUpdated(ServerTemplateUpdated serverTemplateUpdated) {
            System.out.println("serverTemplateUpdated = " + serverTemplateUpdated);
        }

        @Override
        public void onServerInstanceUpdated(ServerInstanceUpdated serverInstanceUpdated) {
            System.out.println("serverInstanceUpdated = " + serverInstanceUpdated);
        }

        @Override
        public void onContainerSpecUpdated(ContainerSpecUpdated containerSpecUpdated) {
            System.out.println("onContainerSpecUpdated = " + containerSpecUpdated);
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_securing_password_using_key_store"><a class="anchor" href="#_securing_password_using_key_store"></a> <a class="link" href="#_securing_password_using_key_store">19.14。使用密钥库保护密码</a></h3>
<div class="paragraph">
<p>KIE服务器正在使用密码进行某种通信（例如REST api）基本身份验证。从安全角度来看，以明文形式在光盘上存储此类密码是不安全的。为此目的，开发了一种将密码存储在密钥存储区中，然后在应用程序中使用它的机制。</p>
</div>
<div class="sect3">
<h4 id="_simple_usecase"><a class="anchor" href="#_simple_usecase"></a> <a class="link" href="#_simple_usecase">19.14.1。简单用例</a></h4>
<div class="paragraph">
<p>用户想要保护自己的密码以通过REST客户端进行通信。他创建了新的密钥库，并在其中放置密码，他将系统变量和信息一起设置到密钥库中，KIE会自动加载密钥库并使用密码来保护通信。</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_and_business_logic"><a class="anchor" href="#_implementation_and_business_logic"></a> <a class="link" href="#_implementation_and_business_logic">19.14.2。实施和业务逻辑</a></h4>
<div class="paragraph">
<p>当前实现使用的是密钥存储（如果已定义）。如果不是，则使用config参数将功能恢复到旧的行为。</p>
</div>
</div>
<div class="sect3">
<h4 id="_system_requirements"><a class="anchor" href="#_system_requirements"></a> <a class="link" href="#_system_requirements">19.14.3。系统要求</a></h4>
<div class="paragraph">
<p>要使用密钥存储，我们需要首先创建它。由于JKS不支持对称密钥，因此我们必须创建JCEKS密钥库。此外，密码只能存储在Java 8及更高版本的密钥存储区中。为了生成密钥库，可以使用标准工具KeyTool，它是JDK安装的一部分。</p>
</div>
</div>
<div class="sect3">
<h4 id="_initialization_of_a_key_store"><a class="anchor" href="#_initialization_of_a_key_store"></a> <a class="link" href="#_initialization_of_a_key_store">19.14.4。密钥库的初始化</a></h4>
<div class="paragraph">
<p>对于密钥库初始化，我们建议使用keytool。语法如下：<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">${JAVA_HOME}/bin/keytool -importpassword -keystore _keystore_url_ -keypass _alias_key_password_ -alias _password_alias_ -storepass _keystore_password_ -storetype JCEKS</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>alias-</strong>要处理的条目的别名</p>
</li>
<li>
<p><strong>关键通过</strong> -密钥口令</p>
</li>
<li>
<p><strong>密钥库</strong> -密钥库名称</p>
</li>
<li>
<p><strong>storepass-</strong>密钥库密码</p>
</li>
<li>
<p><strong>storetype-</strong>密钥库类型</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>运行此命令后，将要求用户输入要存储的密码。</p>
</div>
</div>
<div class="sect3">
<h4 id="_system_parameters_for_loading_key_store"><a class="anchor" href="#_system_parameters_for_loading_key_store"></a> <a class="link" href="#_system_parameters_for_loading_key_store">19.14.5。加载密钥库的系统参数</a></h4>
<div class="ulist">
<ul>
<li>
<p><strong>kie.keystore.keyStoreURL-</strong>应当使用的密钥库的URL</p>
</li>
<li>
<p><strong>kie.keystore.keyStorePwd-</strong>密钥库的密码</p>
</li>
<li>
<p><strong>kie.keystore.key.server.alias-</strong>存储密码的REST服务密钥的别名</p>
</li>
<li>
<p><strong>kie.keystore.key.server.pwd-</strong>具有存储密码的REST服务的别名的密码</p>
</li>
<li>
<p><strong>kie.keystore.key.ctrl.alias-</strong>存储密码的默认REST Drools控制器的密钥的别名</p>
</li>
<li>
<p><strong>kie.keystore.key.ctrl.pwd-</strong>具有存储密码的默认REST Drools控制器的别名的密码</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_example_3"><a class="anchor" href="#_example_3"></a> <a class="link" href="#_example_3">19.14.6。例</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在应用程序服务器中创建用户和密码（必须具有kie-server角色）</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>${EAP_HOME}/add-user.sh -a -e -u kieserver -p "kiePassword1!" -g kie-server</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>使用密钥工具创建包含密码的密钥库<br></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">${JAVA_HOME}/bin/keytool -importpassword -keystore /home/kie/keystores/droolsServer.jceks -keypass keypwd -alias droolsKey -storepass serverpwd -storetype JCEKS

Enter the password to be stored:
Re-enter password:

${JAVA_HOME}/bin/keytool -importpassword -keystore /home/kie/keystores/droolsServer.jceks -keypass keypwd -alias restKey -storepass serverpwd -storetype JCEKS

Enter the password to be stored:
Re-enter password:</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>在应用程序服务器上设置以下系统属性，使KIE Server或Drools控制器从密钥库读取密码</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>    &lt;system-properties&gt;
        &lt;property name="kie.keystore.keyStoreURL" value="file:///home/kie/keystores/droolsServer.jceks"/&gt;
        &lt;property name="kie.keystore.keyStorePwd" value="serverpwd"/&gt;
        &lt;property name="kie.keystore.key.server.alias" value="restKey"/&gt;
        &lt;property name="kie.keystore.key.server.pwd" value="keypwd"/&gt;
        &lt;property name="kie.keystore.key.ctrl.alias" value="droolsKey"/&gt;
        &lt;property name="kie.keystore.key.ctrl.pwd" value="keypwd"/&gt;
    &lt;/system-properties&gt;</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>启动服务器以验证配置</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="prometheus-monitoring-con_kie-apis"><a class="anchor" href="#prometheus-monitoring-con_kie-apis"></a> <a class="link" href="#prometheus-monitoring-con_kie-apis">19.15。Drools中的Prometheus指标监控</a></h3>
<div class="paragraph">
<p>Prometheus是一个开源系统监视工具包，您可以将其与Drools一起使用，以收集和存储与业务规则，流程，决策模型和表示法（DMN）模型以及其他Drools资产的执行相关的指标。您可以通过对KIE服务器的REST API调用，通过Prometheus表达式浏览器或使用数据绘图工具（例如Grafana）来访问存储的度量。</p>
</div>
<div class="paragraph">
<p>您可以为本地KIE Server实例，Spring Boot上的KIE Server或Red Hat OpenShift Container Platform上的KIE Server部署配置Prometheus指标监视。</p>
</div>
<div class="paragraph">
<p>有关KIE Server通过Prometheus公开的可用指标的列表，请参阅GitHub上的“ <a href="https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-services/kie-server-services-prometheus">KIE Server Prometheus扩展”</a>页面。</p>
</div>
<div class="sect3">
<h4 id="prometheus-monitoring-proc_kie-apis"><a class="anchor" href="#prometheus-monitoring-proc_kie-apis"></a> <a class="link" href="#prometheus-monitoring-proc_kie-apis">19.15.1。为KIE Server配置Prometheus指标监视</a></h4>
<div class="paragraph">
<p>您可以将KIE Server实例配置为使用Prometheus来收集和存储与Drools中的业务资产活动相关的指标。有关KIE Server通过Prometheus公开的可用指标的列表，请参阅GitHub上的“ <a href="https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-services/kie-server-services-prometheus">KIE Server Prometheus扩展”</a>页面。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>已安装KIE服务器。</p>
</li>
<li>
<p>你有<code>kie-server</code>用户角色访问KIE服务器。</p>
</li>
<li>
<p>Prometheus已安装。有关下载和使用Prometheus的信息，请参阅<a href="https://prometheus.io/docs/introduction/overview/">Prometheus文档页面</a> 。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在您的KIE Server实例中，设置<code>org.kie.prometheus.server.ext.disabled</code>系统属性<code>false</code>启用Prometheus扩展。您可以在启动KIE服务器时或在<code>standalone.xml</code>要么<code>standalone-full.xml</code> Drools发行文件。</p>
</li>
<li>
<p>如果您在Spring Boot上运行Drools，请在<code>pom.xml</code> Maven项目的文件，并在<code>application.properties</code>系统属性：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Prometheus的Spring Boot pom.xml依赖项</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
  &lt;artifactId&gt;kie-server-services-prometheus&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
  &lt;artifactId&gt;kie-server-rest-prometheus&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Drools和Prometheus的Spring Boot application.properties密钥</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">kieserver.drools.enabled=true
kieserver.dmn.enabled=true
kieserver.prometheus.enabled=true</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>在里面<code>prometheus.yaml</code> Prometheus发行版的文件，在<code>scrape_configs</code>部分将Prometheus配置为从KIE Server抓取指标：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">在prometheus.yaml文件中刮取配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">scrape_configs:
  job_name: 'kie-server'
metrics_path: /SERVER_PATH/services/rest/metrics
Basic_auth:
username: USER_NAME
password: PASSWORD
static_configs:
  - targets: ["HOST:PORT"]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">刮除prometheus.yaml文件中的Spring Boot配置（如果适用）</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">scrape_configs:
  job_name: 'kie'
metrics_path: /rest/metrics
static_configs:
- targets: ["HOST:PORT"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>根据您的KIE服务器位置和设置替换这些值。</p>
</div>
</div>
</div>
</li>
<li>
<p>启动KIE Server实例。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>启动配置的KIE Server实例后，Prometheus开始收集指标，并且KIE Server将指标发布到REST API端点<code>http://HOST:PORT/SERVER/services/rest/metrics</code> （或在Spring Boot上， <code>http://HOST:PORT/rest/metrics</code> ）。</p>
</div>
</div>
</div>
</li>
<li>
<p>在REST客户端或curl实用程序中，发送带有以下组件的REST API请求，以验证KIE Server正在发布指标：</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>对于REST客户端：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>身份验证</strong> ：使用以下命令输入KIE Server用户的用户名和密码： <code>kie-server</code>角色。</p>
</li>
<li>
<p><strong>HTTP标头</strong> ：设置以下标头：</p>
<div class="ulist">
<ul>
<li>
<p><code>Accept</code> ：<code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>HTTP方法</strong> ：设置为<code>GET</code> 。</p>
</li>
<li>
<p><strong>URL</strong> ：输入KIE Server REST API的基本URL和指标端点，例如<code>http://localhost:8080/kie-server/services/rest/metrics</code> （或在Spring Boot上， <code>http://localhost:8080/rest/metrics</code> ）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>对于curl实用程序：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-u</code> ：使用以下命令输入KIE Server用户的用户名和密码： <code>kie-server</code>角色。</p>
</li>
<li>
<p><code>-H</code> ：设置以下标题：</p>
<div class="ulist">
<ul>
<li>
<p><code>accept</code> ：<code>application/json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>-X</code> ： 调成<code>GET</code> 。</p>
</li>
<li>
<p><strong>URL</strong> ：输入KIE Server REST API的基本URL和指标端点，例如<code>http://localhost:8080/kie-server/services/rest/metrics</code> （或在Spring Boot上， <code>http://localhost:8080/rest/metrics</code> ）。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>curl -u 'baAdmin:password@1' -H "accept: application/json" -X GET "http://localhost:8080/kie-server/services/rest/metrics"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">服务器响应示例</div>
<div class="content">
<pre class="highlightjs highlight"><code># HELP kie_server_container_started_total Kie Server Started Containers
# TYPE kie_server_container_started_total counter
kie_server_container_started_total{container_id="task-assignment-kjar-1.0",} 1.0
# HELP solvers_running Number of solvers currently running
# TYPE solvers_running gauge
solvers_running 0.0
# HELP dmn_evaluate_decision_nanosecond DMN Evaluation Time
# TYPE dmn_evaluate_decision_nanosecond histogram
# HELP solver_duration_seconds Time in seconds it took solver to solve the constraint problem
# TYPE solver_duration_seconds summary
solver_duration_seconds_count{solver_id="100tasks-5employees.xml",} 1.0
solver_duration_seconds_sum{solver_id="100tasks-5employees.xml",} 179.828255925
solver_duration_seconds_count{solver_id="24tasks-8employees.xml",} 1.0
solver_duration_seconds_sum{solver_id="24tasks-8employees.xml",} 179.995759653
# HELP drl_match_fired_nanosecond Drools Firing Time
# TYPE drl_match_fired_nanosecond histogram
# HELP dmn_evaluate_failed_count DMN Evaluation Failed
# TYPE dmn_evaluate_failed_count counter
# HELP kie_server_start_time Kie Server Start Time
# TYPE kie_server_start_time gauge
kie_server_start_time{name="myapp-kieserver",server_id="myapp-kieserver",location="http://myapp-kieserver-demo-monitoring.127.0.0.1.nip.io:80/services/rest/server",version="7.4.0.redhat-20190428",} 1.557221271502E12
# HELP kie_server_container_running_total Kie Server Running Containers
# TYPE kie_server_container_running_total gauge
kie_server_container_running_total{container_id="task-assignment-kjar-1.0",} 1.0
# HELP solver_score_calculation_speed Number of moves per second for a particular solver solving the constraint problem
# TYPE solver_score_calculation_speed summary
solver_score_calculation_speed_count{solver_id="100tasks-5employees.xml",} 1.0
solver_score_calculation_speed_sum{solver_id="100tasks-5employees.xml",} 6997.0
solver_score_calculation_speed_count{solver_id="24tasks-8employees.xml",} 1.0
solver_score_calculation_speed_sum{solver_id="24tasks-8employees.xml",} 19772.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果度量在KIE Server中不可用，请查看并验证本节中描述的KIE Server和Prometheus配置。</p>
</div>
<div class="paragraph">
<p>您还可以在以下位置的Prometheus表达式浏览器中与收集的指标进行交互： <code>http://HOST:PORT/graph</code> ，或将您的Prometheus数据源与数据绘图工具（例如Grafana）集成：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./KieServer/prometheus-expression-browser-data.png" alt="普罗米修斯表达式浏览器数据">
</div>
<div class="title">图351。具有KIE Server指标的Prometheus表达式浏览器</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./KieServer/prometheus-expression-browser-targets.png" alt="普罗米修斯表情浏览器目标">
</div>
<div class="title">图352。具有KIE Server目标的Prometheus表达式浏览器</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./KieServer/prometheus-grafana-data-dmn.png" alt="普罗米修斯·格拉法纳数据dmn">
</div>
<div class="title">图353。具有DIE模型的KIE Server指标的Grafana仪表板</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./KieServer/prometheus-grafana-data-optimizer.png" alt="普罗米修斯·格拉纳纳数据优化器">
</div>
<div class="title">图354。具有用于求解器的KIE Server指标的Grafana仪表板</div>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">额外资源</div>
<ul>
<li>
<p><a href="https://prometheus.io/docs/prometheus/latest/getting_started/">Prometheus入门</a></p>
</li>
<li>
<p><a href="https://prometheus.io/docs/visualization/grafana/">Grafana对Prometheus的支持</a></p>
</li>
<li>
<p><a href="https://grafana.com/docs/features/datasources/prometheus/">在Grafana中使用Prometheus</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="prometheus-monitoring-custom-proc_kie-apis"><a class="anchor" href="#prometheus-monitoring-custom-proc_kie-apis"></a> <a class="link" href="#prometheus-monitoring-custom-proc_kie-apis">19.15.2。使用自定义指标扩展KIE Server中的Prometheus指标监视</a></h4>
<div class="paragraph">
<p>在将KIE Server实例配置为使用Prometheus指标监视之后，可以扩展KIE Server中的Prometheus功能以根据业务需求使用自定义指标。然后Prometheus收集并存储您的自定义指标以及KIE Server通过Prometheus公开的默认指标。</p>
</div>
<div class="paragraph">
<p>例如，此过程定义了要由Prometheus收集和存储的自定义决策模型和表示法（DMN）度量。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>已为您的KIE Server实例配置了Prometheus指标监视。有关使用本地KIE Server进行Prometheus配置的信息，请参阅“ <a href="#prometheus-monitoring-proc_kie-apis">配置KIE Server的Prometheus指标监视”</a> 。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>创建一个空的Maven项目，并在<code>pom.xml</code>该项目的文件：</p>
<div class="listingblock">
<div class="title">示例项目中的示例pom.xml文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;packaging&gt;jar&lt;/packaging&gt;

&lt;properties&gt;
  &lt;version.org.kie&gt;7.26.0.Final-redhat-00005&lt;/version.org.kie&gt;
&lt;/properties&gt;

&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie&lt;/groupId&gt;
    &lt;artifactId&gt;kie-api&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-api&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-services-common&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-services-drools&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie.server&lt;/groupId&gt;
    &lt;artifactId&gt;kie-server-services-prometheus&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie&lt;/groupId&gt;
    &lt;artifactId&gt;kie-dmn-api&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.kie&lt;/groupId&gt;
    &lt;artifactId&gt;kie-dmn-core&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.jbpm&lt;/groupId&gt;
    &lt;artifactId&gt;jbpm-services-api&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.jbpm&lt;/groupId&gt;
    &lt;artifactId&gt;jbpm-executor&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.optaplanner&lt;/groupId&gt;
    &lt;artifactId&gt;optaplanner-core&lt;/artifactId&gt;
    &lt;version&gt;${version.org.kie}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;io.prometheus&lt;/groupId&gt;
    &lt;artifactId&gt;simpleclient&lt;/artifactId&gt;
    &lt;version&gt;0.5.0&lt;/version&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>实施相关的监听器<code>org.kie.server.services.prometheus.PrometheusMetricsProvider</code>接口作为定义您的自定义Prometheus指标的自定义侦听器类的一部分，如以下示例所示：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">示例实现<code>DMNRuntimeEventListener</code>自定义侦听器类中的侦听器</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.kie.server.ext.prometheus;

import io.prometheus.client.Gauge;
import org.kie.dmn.api.core.ast.DecisionNode;
import org.kie.dmn.api.core.event.AfterEvaluateBKMEvent;
import org.kie.dmn.api.core.event.AfterEvaluateContextEntryEvent;
import org.kie.dmn.api.core.event.AfterEvaluateDecisionEvent;
import org.kie.dmn.api.core.event.AfterEvaluateDecisionServiceEvent;
import org.kie.dmn.api.core.event.AfterEvaluateDecisionTableEvent;
import org.kie.dmn.api.core.event.BeforeEvaluateBKMEvent;
import org.kie.dmn.api.core.event.BeforeEvaluateContextEntryEvent;
import org.kie.dmn.api.core.event.BeforeEvaluateDecisionEvent;
import org.kie.dmn.api.core.event.BeforeEvaluateDecisionServiceEvent;
import org.kie.dmn.api.core.event.BeforeEvaluateDecisionTableEvent;
import org.kie.dmn.api.core.event.DMNRuntimeEventListener;
import org.kie.server.api.model.ReleaseId;
import org.kie.server.services.api.KieContainerInstance;

public class ExampleCustomPrometheusMetricListener implements DMNRuntimeEventListener {

    private final KieContainerInstance kieContainer;

    private final Gauge randomGauge = Gauge.build()
            .name("random_gauge_nanosecond")
            .help("Random gauge as an example of custom KIE Prometheus metric")
            .labelNames("container_id", "group_id", "artifact_id", "version", "decision_namespace", "decision_name")
            .register();

    public ExampleCustomPrometheusMetricListener(KieContainerInstance containerInstance) {
        kieContainer = containerInstance;
    }

    public void beforeEvaluateDecision(BeforeEvaluateDecisionEvent e) {
    }

    public void afterEvaluateDecision(AfterEvaluateDecisionEvent e) {
        DecisionNode decisionNode = e.getDecision();
        ReleaseId releaseId = kieContainer.getResource().getReleaseId();
        randomGauge.labels(kieContainer.getContainerId(), releaseId.getGroupId(),
                           releaseId.getArtifactId(), releaseId.getVersion(),
                           decisionNode.getModelName(), decisionNode.getModelNamespace())
                .set((int) (Math.random() * 100));
    }

    public void beforeEvaluateBKM(BeforeEvaluateBKMEvent event) {
    }

    public void afterEvaluateBKM(AfterEvaluateBKMEvent event) {
    }

    public void beforeEvaluateContextEntry(BeforeEvaluateContextEntryEvent event) {
    }

    public void afterEvaluateContextEntry(AfterEvaluateContextEntryEvent event) {
    }

    public void beforeEvaluateDecisionTable(BeforeEvaluateDecisionTableEvent event) {
    }

    public void afterEvaluateDecisionTable(AfterEvaluateDecisionTableEvent event) {
    }

    public void beforeEvaluateDecisionService(BeforeEvaluateDecisionServiceEvent event) {
    }

    public void afterEvaluateDecisionService(AfterEvaluateDecisionServiceEvent event) {
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>PrometheusMetricsProvider</code>界面包含收集Prometheus指标所需的侦听器。该接口由<code>kie-server-services-prometheus</code>您在项目中声明的依赖项<code>pom.xml</code>文件。</p>
</div>
<div class="paragraph">
<p>在此示例中， <code>ExampleCustomPrometheusMetricListener</code>类实现<code>DMNRuntimeEventListener</code>侦听器（来自<code>PrometheusMetricsProvider</code>接口），并定义要由Prometheus收集和存储的自定义DMN指标。</p>
</div>
</div>
</div>
</li>
<li>
<p>实施<code>PrometheusMetricsProvider</code>接口作为自定义指标提供程序类的一部分，该类将您的自定义侦听器与<code>PrometheusMetricsProvider</code>界面，如以下示例所示：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">示例实现<code>PrometheusMetricsProvider</code>自定义指标提供程序类中的界面</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.kie.server.ext.prometheus;

import org.jbpm.executor.AsynchronousJobListener;
import org.jbpm.services.api.DeploymentEventListener;
import org.kie.api.event.rule.AgendaEventListener;
import org.kie.api.event.rule.DefaultAgendaEventListener;
import org.kie.dmn.api.core.event.DMNRuntimeEventListener;
import org.kie.server.services.api.KieContainerInstance;
import org.kie.server.services.prometheus.PrometheusMetricsProvider;
import org.optaplanner.core.impl.phase.event.PhaseLifecycleListener;
import org.optaplanner.core.impl.phase.event.PhaseLifecycleListenerAdapter;

public class MyPrometheusMetricsProvider implements PrometheusMetricsProvider {

    public DMNRuntimeEventListener createDMNRuntimeEventListener(KieContainerInstance kContainer) {
        return new ExampleCustomPrometheusMetricListener(kContainer);
    }

    public AgendaEventListener createAgendaEventListener(String kieSessionId, KieContainerInstance kContainer) {
        return new DefaultAgendaEventListener();
    }

    public PhaseLifecycleListener createPhaseLifecycleListener(String solverId) {
        return new PhaseLifecycleListenerAdapter() {
        };
    }

    public AsynchronousJobListener createAsynchronousJobListener() {
        return null;
    }

    public DeploymentEventListener createDeploymentEventListener() {
        return null;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中， <code>MyPrometheusMetricsProvider</code>类实现<code>PrometheusMetricsProvider</code>界面，包括您的自定义<code>ExampleCustomPrometheusMetricListener</code>侦听器类。</p>
</div>
</div>
</div>
</li>
<li>
<p>要使新的指标提供程序可被KIE Server发现，请创建一个<code>META-INF/services/org.kie.server.services.prometheus.PrometheusMetricsProvider</code>文件添加到您的Maven项目中，然后添加<code>PrometheusMetricsProvider</code>文件中的实现类。对于此示例，文件包含单行<code>org.kie.server.ext.prometheus.MyPrometheusMetricsProvider</code> 。</p>
</li>
<li>
<p>构建您的项目，然后将生成的JAR文件复制到<code>~/kie-server.war/WEB-INF/lib</code>项目的目录。</p>
</li>
<li>
<p>启动KIE服务器，并将生成的项目部署到正在运行的KIE服务器。您可以使用Business Central界面或KIE Server REST API（ <code>PUT</code>请求<code>http://SERVER:PORT/kie-server/services/rest/server/containers/{containerId}</code> ）。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>将项目部署到正在运行的KIE Server上之后，Prometheus开始收集指标，并且KIE Server将指标发布到REST API端点<code>http://HOST:PORT/SERVER/services/rest/metrics</code> （或在Spring Boot上， <code>http://HOST:PORT/rest/metrics</code> ）。</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="performance-tuning-kie-server-ref_kie-apis"><a class="anchor" href="#performance-tuning-kie-server-ref_kie-apis"></a> <a class="link" href="#performance-tuning-kie-server-ref_kie-apis">19.16。KIE Server的性能调整注意事项</a></h3>
<div class="paragraph">
<p>以下关键概念或建议做法可帮助您优化KIE Server性能。为了方便起见，在本节中汇总了这些概念，并在适用的情况下在交叉引用的文档中进行了详细说明。新版本的Drools将根据需要扩展或更改此部分。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">确保在开发过程中启用开发模式</dt>
<dd>
<p>您可以在Business Central中设置要使用的KIE Server或特定项目<code>production</code>模式或<code>development</code>模式。默认情况下，KIE Server和Business Central中的所有新项目都处于开发模式。此模式提供的功能有助于您的开发体验（例如灵活的项目部署策略），以及在开发过程中优化KIE Server性能的功能（例如禁用重复GAV检测）。使用开发模式，直到建立了Drools环境并完全准备好进入生产模式为止。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>有关配置环境模式或重复GAV检测的更多信息，请参见以下资源：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_development_streamline_lifecycle">开发简化生命周期</a></p>
</li>
<li>
<p><a href="#_duplicate_gav_detection">重复GAV检测</a></p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">使KIE Server功能和扩展适应您的特定需求</dt>
<dd>
<p>KIE Server中的功能由您可以启用，禁用或进一步扩展以满足您的业务需求的插件扩展决定。默认情况下，KIE Server扩展通过REST或JMS数据传输公开，并使用预定义的客户端API。您可以使用其他REST端点扩展现有的KIE Server功能，将支持的传输方法扩展到REST或JMS之外，或者扩展KIE Server客户端中的功能。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>KIE Server功能的这种灵活性使您可以使KIE Server实例适应业务需求，而无需使业务需求适应默认的KIE Server功能。</p>
</div>
<div class="paragraph">
<p>有关启用，禁用或扩展KIE Server功能的信息，请参阅<a href="#kie-server-extensions-con_kie-apis">KIE Server功能和扩展</a> 。</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
<h1 id="_drools_examples" class="discrete">流口水的例子</h1>
<div class="paragraph">
<p>帮助您学习Drools的示例</p>
</div>
</div>
</div>
</div></div>
<div class="sect1">
<h2 id="_examples"><a class="anchor" href="#_examples"></a> <a class="link" href="#_examples">20例子</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="decision-examples-IDE-con_drools-examples"><a class="anchor" href="#decision-examples-IDE-con_drools-examples"></a> <a class="link" href="#decision-examples-IDE-con_drools-examples">20.1。Drools中针对IDE的示例决策</a></h3>
<div class="paragraph">
<p>Drools提供了作为Java类分发的示例决策，您可以将其导入到集成开发环境（IDE）中。您可以使用这些示例更好地了解Drools引擎功能，或将其用作您在自己的Drools项目中定义的决策的参考。</p>
</div>
<div class="paragraph">
<p>以下示例决策集是Drools中可用的一些示例：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Hello World示例</strong> ：演示基本规则执行和调试输出的使用</p>
</li>
<li>
<p><strong>实例</strong> ：通过规则显着性和议程小组展示向前链接和解决冲突</p>
</li>
<li>
<p><strong>斐波那契示例</strong> ：通过规则显着性演示递归和冲突解决</p>
</li>
<li>
<p><strong>银行示例</strong> ：演示模式匹配，基本排序和计算</p>
</li>
<li>
<p><strong>Pet Store示例</strong> ：展示规则议程组，全局变量，回调和GUI集成</p>
</li>
<li>
<p><strong>Sudoku示例</strong> ：演示复杂的模式匹配，问题解决，回调和GUI集成</p>
</li>
<li>
<p><strong>《毁灭之屋》示例</strong> ：演示向后链接和递归</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">有关OptaPlanner随附的优化示例，请参见《 <a href="https://docs.optaplanner.org/7.15.0.Final/optaplanner-docs/html_single/index.html#useCasesAndExamples">OptaPlanner用户指南》</a> 。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-IDE-proc_drools-examples"><a class="anchor" href="#decision-examples-IDE-proc_drools-examples"></a> <a class="link" href="#decision-examples-IDE-proc_drools-examples">20.2。在IDE中导入和执行Drools示例决策</a></h3>
<div class="paragraph">
<p>您可以将Drools示例决策导入到集成开发环境（IDE）中，并执行它们以探索规则和代码的功能。您可以使用这些示例更好地了解Drools引擎功能，或将其用作您在自己的Drools项目中定义的决策的参考。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>已安装Java 8或更高版本。</p>
</li>
<li>
<p>安装了Maven 3.5.x或更高版本。</p>
</li>
<li>
<p>已安装IDE，例如带有JBoss Tools插件的Eclipse。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>从<a href="https://github.com/kiegroup/drools/archive/master.zip">GitHub</a>的Drools <a href="https://github.com/kiegroup/drools/archive/master.zip">存储库</a>下载并解压缩源代码。</p>
<div class="paragraph">
<p>对于Conway的“人生游戏”示例决定，还请从<a href="https://github.com/kiegroup/droolsjbpm-integration/archive/master.zip">GitHub中</a>的Drools和jBPM集成<a href="https://github.com/kiegroup/droolsjbpm-integration/archive/master.zip">存储库</a>下载并解压缩源代码。</p>
</div>
</li>
<li>
<p>打开您的IDE并选择“ <strong>文件”</strong> →“ <strong>导入”</strong> →“ <strong>Maven”</strong> →“ <strong>现有Maven项目”</strong> ，或用于导入Maven项目的等效选项。</p>
</li>
<li>
<p>点击<strong>浏览</strong> ，导航至<code>~/drools-master/drools-examples</code> （或者，对于Conway的“人生游戏”示例， <code>~/droolsjbpm-integration-examples</code> ），然后导入项目。</p>
</li>
<li>
<p>导航到要运行的示例程序包，并找到带有<code>main</code>方法。</p>
</li>
<li>
<p>右键单击Java类，然后选择<strong>运行方式</strong> → <strong>Java应用程序</strong>以运行示例。</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>要通过基本用户界面运行所有示例，请运行<code>DroolsExamplesApp.java</code>类（或者，对于Conway的《人生游戏》， <code>DroolsJbpmIntegrationExamplesApp.java</code>类）中<code>org.drools.examples</code>主班。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/All/drools-examples-run-all.png" alt="流口水的例子跑了所有">
</div>
<div class="title">图355。Drools-examples中所有示例的接口（DroolsExamplesApp.java）</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/All/droolsjbpm-examples-run-all.png" alt="droolsjbpm示例全部运行">
</div>
<div class="title">图356。droolsjbpm-integration-examples中所有示例的接口（DroolsJbpmIntegrationExamplesApp.java）</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-helloworld-ref_drools-examples"><a class="anchor" href="#decision-examples-helloworld-ref_drools-examples"></a> <a class="link" href="#decision-examples-helloworld-ref_drools-examples">20.3。Hello World示例决策（基本规则和调试）</a></h3>
<div class="paragraph">
<p>Hello World示例决策集演示了如何将对象插入Drools引擎工作内存，如何使用规则匹配对象以及如何配置日志记录以跟踪Drools引擎的内部活动。</p>
</div>
<div class="paragraph">
<p>以下是Hello World示例的概述：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>名称</strong> ：<code>helloworld</code></p>
</li>
<li>
<p><strong>主班</strong> <code>org.drools.examples.helloworld.HelloWorldExample</code> （在<code>src/main/java</code> ）</p>
</li>
<li>
<p><strong>模块</strong> ：<code>drools-examples</code></p>
</li>
<li>
<p><strong>类型</strong> ：Java应用程序</p>
</li>
<li>
<p><strong>规则文件</strong> ： <code>org.drools.examples.helloworld.HelloWorld.drl</code> （在<code>src/main/resources</code> ）</p>
</li>
<li>
<p><strong>目标</strong> ：演示基本规则执行和调试输出的使用</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在Hello World示例中，将生成KIE会话以启用规则执行。所有规则都需要一个KIE会话才能执行。</p>
</div>
<div class="listingblock">
<div class="title">规则执行的KIE会话</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get(); <i class="conum" data-value="1"></i><b>(1)</b>
KieContainer kc = ks.getKieClasspathContainer(); <i class="conum" data-value="2"></i><b>(2)</b>
KieSession ksession = kc.newKieSession("HelloWorldKS"); <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>获得<code>KieServices</code>厂。这是应用程序用来与Drools引擎进行交互的主要界面。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>创建一个<code>KieContainer</code>从项目类路径。这会检测到<strong>/META-INF/kmodule.xml</strong>文件，并从中配置并实例化<code>KieContainer</code>与一个<code>KieModule</code> 。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i> <b>3</b></td>
<td>创建一个<code>KieSession</code>基于<code>"HelloWorldKS"</code>在<strong>/META-INF/kmodule.xml</strong>文件中定义的KIE会话配置。</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">有关Drools项目打包的更多信息，请参见<a href="#_builddeployutilizeandrunsection">Build，Deploy，Utilize和Run</a> 。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Drools有一个事件模型，它公开了引擎的内部活动。两个默认的调试侦听器， <code>DebugAgendaEventListener</code>和<code>DebugRuleRuntimeEventListener</code> ，将调试事件信息打印到<code>System.err</code>输出。的<code>KieRuntimeLogger</code>提供执行审核，您可以在图形查看器中查看其结果。</p>
</div>
<div class="listingblock">
<div class="title">调试侦听器和审核记录器</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Set up listeners.
ksession.addEventListener( new DebugAgendaEventListener() );
ksession.addEventListener( new DebugRuleRuntimeEventListener() );

// Set up a file-based audit logger.
KieRuntimeLogger logger = KieServices.get().getLoggers().newFileLogger( ksession, "./target/helloworld" );

// Set up a ThreadedFileLogger so that the audit view reflects events while debugging.
KieRuntimeLogger logger = ks.getLoggers().newThreadedFileLogger( ksession, "./target/helloworld", 1000 );</code></pre>
</div>
</div>
<div class="paragraph">
<p>记录器是基于<code>Agenda</code>和<code>RuleRuntime</code>听众。当Drools引擎完成执行后， <code>logger.close()</code>叫做。</p>
</div>
<div class="paragraph">
<p>该示例创建一个<code>Message</code>带有消息的对象<code>"Hello World"</code> ，插入状态<code>HELLO</code>进入<code>KieSession</code> ，执行规则<code>fireAllRules()</code> 。</p>
</div>
<div class="listingblock">
<div class="title">数据插入与执行</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Insert facts into the KIE session.
final Message message = new Message();
message.setMessage( "Hello World" );
message.setStatus( Message.HELLO );
ksession.insert( message );

// Fire the rules.
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="paragraph">
<p>规则执行使用数据模型将数据作为输入和输出传递给<code>KieSession</code> 。此示例中的数据模型具有两个字段： <code>message</code> ，这是一个<code>String</code>和<code>status</code> ，可以是<code>HELLO</code>要么<code>GOODBYE</code> 。</p>
</div>
<div class="listingblock">
<div class="title">数据模型类</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static class Message {
    public static final int HELLO   = 0;
    public static final int GOODBYE = 1;

    private String          message;
    private int             status;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这两个规则位于文件中<code>src/main/resources/org/drools/examples/helloworld/HelloWorld.drl</code> 。</p>
</div>
<div class="paragraph">
<p>的<code>when</code>条件<code>"Hello World"</code>规则指出已为每个规则激活该规则<code>Message</code>插入状态为KIE会话的对象<code>Message.HELLO</code> 。此外，还创建了两个变量绑定： <code>message</code>绑定到<code>message</code>属性和变量<code>m</code>绑定到匹配项<code>Message</code>对象本身。</p>
</div>
<div class="paragraph">
<p>的<code>then</code>规则的操作指定要打印绑定变量的内容<code>message</code>至<code>System.out</code> ，然后更改<code>message</code>和<code>status</code>的属性<code>Message</code>绑定对象<code>m</code> 。该规则使用<code>modify</code>语句在一个语句中应用一个分配块，并在该块的末尾将更改的结果通知Drools引擎。</p>
</div>
<div class="listingblock">
<div class="title">“ Hello World”规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Hello World"
  when
    m : Message( status == Message.HELLO, message : message )
  then
    System.out.println( message );
    modify ( m ) { message = "Goodbye cruel world",
                   status = Message.GOODBYE };
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>"Good Bye"</code>规则类似于<code>"Hello World"</code>规则，除了它匹配<code>Message</code>具有状态的对象<code>Message.GOODBYE</code> 。</p>
</div>
<div class="listingblock">
<div class="title">“再见”规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Good Bye"
  when
    Message( status == Message.GOODBYE, message : message )
  then
    System.out.println( message );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>要执行示例，请运行<code>org.drools.examples.helloworld.HelloWorldExample</code>类在您的IDE中作为Java应用程序。规则写入<code>System.out</code> ，侦听侦听器写入<code>System.err</code> ，然后审核记录器在中创建一个日志文件<code>target/helloworld.log</code> 。</p>
</div>
<div class="listingblock">
<div class="title">IDE控制台中的System.out输出</div>
<div class="content">
<pre class="highlightjs highlight"><code>Hello World
Goodbye cruel world</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">IDE控制台中的System.err输出</div>
<div class="content">
<pre class="highlightjs highlight"><code>==&gt;[ActivationCreated(0): rule=Hello World;
                   tuple=[fid:1:1:org.drools.examples.helloworld.HelloWorldExample$Message@17cec96]]
[ObjectInserted: handle=[fid:1:1:org.drools.examples.helloworld.HelloWorldExample$Message@17cec96];
                 object=org.drools.examples.helloworld.HelloWorldExample$Message@17cec96]
[BeforeActivationFired: rule=Hello World;
                   tuple=[fid:1:1:org.drools.examples.helloworld.HelloWorldExample$Message@17cec96]]
==&gt;[ActivationCreated(4): rule=Good Bye;
                   tuple=[fid:1:2:org.drools.examples.helloworld.HelloWorldExample$Message@17cec96]]
[ObjectUpdated: handle=[fid:1:2:org.drools.examples.helloworld.HelloWorldExample$Message@17cec96];
                old_object=org.drools.examples.helloworld.HelloWorldExample$Message@17cec96;
                new_object=org.drools.examples.helloworld.HelloWorldExample$Message@17cec96]
[AfterActivationFired(0): rule=Hello World]
[BeforeActivationFired: rule=Good Bye;
                   tuple=[fid:1:2:org.drools.examples.helloworld.HelloWorldExample$Message@17cec96]]
[AfterActivationFired(4): rule=Good Bye]</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了更好地理解此示例的执行流程，可以从以下位置加载审核日志文件： <code>target/helloworld.log</code>进入IDE调试视图或<strong>Audit View</strong> （如果可用）（例如，在某些IDE的“ <strong>窗口”</strong> →“ <strong>显示视图”</strong>中）。</p>
</div>
<div class="paragraph">
<p>在此示例中，“ <strong>审核”视图</strong>显示已插入对象，这将为对象创建激活。 <code>"Hello World"</code>规则。然后执行激活，更新<code>Message</code>对象并导致<code>"Good Bye"</code>规则激活。最后， <code>"Good Bye"</code>规则被执行。当您在“ <strong>审核视图”中</strong>选择一个事件时，原始事件即<code>"Activation created"</code>在此示例中，事件以绿色突出显示。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/HelloWorldExample/helloworld_auditview1.png" alt="helloworld auditview1">
</div>
<div class="title">图357。Hello World示例审核视图</div>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-state-ref_drools-examples"><a class="anchor" href="#decision-examples-state-ref_drools-examples"></a> <a class="link" href="#decision-examples-state-ref_drools-examples">20.4。说明示例决策（前向链接和冲突解决）</a></h3>
<div class="paragraph">
<p>State示例决策集演示了Drools引擎如何使用前向链接以及对工作内存中事实的任何更改来解决序列中规则的执行冲突。该示例着重于通过显着性值或您可以在规则中定义的议程组解决冲突。</p>
</div>
<div class="paragraph">
<p>以下是“状态”示例的概述：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>名称</strong> ：<code>state</code></p>
</li>
<li>
<p><strong>主要课程</strong> ： <code>org.drools.examples.state.StateExampleUsingSalience</code> ， <code>org.drools.examples.state.StateExampleUsingAgendaGroup</code> （在<code>src/main/java</code> ）</p>
</li>
<li>
<p><strong>模块</strong> ：<code>drools-examples</code></p>
</li>
<li>
<p><strong>类型</strong> ：Java应用程序</p>
</li>
<li>
<p><strong>规则文件</strong> ： <code>org.drools.examples.state.*.drl</code> （在<code>src/main/resources</code> ）</p>
</li>
<li>
<p><strong>目标</strong> ：通过规则显着性和议程小组展示向前链接和解决冲突</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>前向链接规则系统是一种数据驱动的系统，它从Drools引擎的工作内存中的一个事实开始，并对这个事实做出反应。将对象插入工作存储器后，所有因更改而变为真的规则条件都将安排在议程中执行。</p>
</div>
<div class="paragraph">
<p>相反，后向链接规则系统是一种目标驱动的系统，其结论是Drools引擎经常使用递归来尝试满足。如果系统无法达到结论或目标，它将搜索子目标，即完成当前目标一部分的结论。系统继续此过程，直到满足初始结论或满足所有子目标为止。</p>
</div>
<div class="paragraph">
<p>Drools中的Drools引擎同时使用向前和向后链接来评估规则。</p>
</div>
<div class="paragraph">
<p>下图说明了Drools引擎如何使用整体前向链接和逻辑流程中的后向链接段来评估规则：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/BackwardChaining/RuleEvaluation.png" alt="规则评估">
</div>
<div class="title">图358。使用向前和向后链接的规则评估逻辑</div>
</div>
<div class="paragraph">
<p>在“州”示例中，每个<code>State</code>该类具有用于其名称和当前状态的字段（请参阅该类<code>org.drools.examples.state.State</code> ）。以下状态是每个对象的两种可能状态：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NOTRUN</code></p>
</li>
<li>
<p><code>FINISHED</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">州级</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class State {
    public static final int NOTRUN   = 0;
    public static final int FINISHED = 1;

    private final PropertyChangeSupport changes =
        new PropertyChangeSupport( this );

    private String name;
    private int    state;

    ... setters and getters go here...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>State示例包含同一示例的两个版本，以解决规则执行冲突：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>一种<code>StateExampleUsingSalience</code>通过使用规则显着性解决冲突的版本</p>
</li>
<li>
<p>一种<code>StateExampleUsingAgendaGroups</code>通过使用规则议程组解决冲突的版本</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>状态示例的两个版本都涉及四个<code>State</code>对象： <code>A</code> ， <code>B</code> ， <code>C</code>和<code>D</code> 。最初，它们的状态设置为<code>NOTRUN</code> ，这是示例使用的构造函数的默认值。</p>
</div>
<h4 id="_state_example_using_salience" class="discrete">使用显着性的状态示例</h4>
<div class="paragraph">
<p>的<code>StateExampleUsingSalience</code> State版本的示例在规则中使用显着性值来解决规则执行冲突。在激活队列中排序时，具有较高显着性值的规则将具有较高的优先级。</p>
</div>
<div class="paragraph">
<p>该示例将每个<code>State</code>实例进入KIE会话，然后调用<code>fireAllRules()</code> 。</p>
</div>
<div class="listingblock">
<div class="title">显着状态示例执行</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">final State a = new State( "A" );
final State b = new State( "B" );
final State c = new State( "C" );
final State d = new State( "D" );

ksession.insert( a );
ksession.insert( b );
ksession.insert( c );
ksession.insert( d );

ksession.fireAllRules();

// Dispose KIE session if stateful (not required if stateless).
ksession.dispose();</code></pre>
</div>
</div>
<div class="paragraph">
<p>要执行示例，请运行<code>org.drools.examples.state.StateExampleUsingSalience</code>类在您的IDE中作为Java应用程序。</p>
</div>
<div class="paragraph">
<p>执行之后，IDE控制台窗口中将显示以下输出：</p>
</div>
<div class="listingblock">
<div class="title">IDE控制台中的Salience State示例输出</div>
<div class="content">
<pre class="highlightjs highlight"><code>A finished
B finished
C finished
D finished</code></pre>
</div>
</div>
<div class="paragraph">
<p>存在四个规则。</p>
</div>
<div class="paragraph">
<p>首先， <code>"Bootstrap"</code>规则射击，设置<code>A</code>陈述<code>FINISHED</code> ，然后导致<code>B</code>将其状态更改为<code>FINISHED</code> 。对象<code>C</code>和<code>D</code>都依赖<code>B</code> ，造成由显着性值解决的冲突。</p>
</div>
<div class="paragraph">
<p>为了更好地理解此示例的执行流程，可以从以下位置加载审核日志文件： <code>target/state.log</code>进入IDE调试视图或<strong>Audit View</strong> （如果可用）（例如，在某些IDE的“ <strong>窗口”</strong> →“ <strong>显示视图”</strong>中）。</p>
</div>
<div class="paragraph">
<p>在此示例中， <strong>审核视图</strong>显示该对象的断言<code>A</code>在该州<code>NOTRUN</code>激活<code>"Bootstrap"</code>规则，而其他对象的断言没有立即生效。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/StateExample/state_example_audit1.png" alt="状态示例audit1">
</div>
<div class="title">图359。显着性状态示例审核视图</div>
</div>
<div class="listingblock">
<div class="title">显着性状态示例中的规则“引导程序”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Bootstrap"
  when
    a : State(name == "A", state == State.NOTRUN )
  then
    System.out.println(a.getName() + " finished" );
    a.setState( State.FINISHED );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>执行<code>"Bootstrap"</code>规则改变状态<code>A</code>至<code>FINISHED</code> ，这会激活规则<code>"A to B"</code> 。</p>
</div>
<div class="listingblock">
<div class="title">显着性状态示例中的规则“ A至B”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "A to B"
  when
    State(name == "A", state == State.FINISHED )
    b : State(name == "B", state == State.NOTRUN )
  then
    System.out.println(b.getName() + " finished" );
    b.setState( State.FINISHED );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>规则的执行<code>"A to B"</code>改变状态<code>B</code>至<code>FINISHED</code> ，这将激活两个规则<code>"B to C"</code>和<code>"B to D"</code> ，将其激活信息添加到Drools引擎议程中。</p>
</div>
<div class="listingblock">
<div class="title">显着性状态示例中的规则“ B to C”和“ B to D”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "B to C"
    salience 10
  when
    State(name == "B", state == State.FINISHED )
    c : State(name == "C", state == State.NOTRUN )
  then
    System.out.println(c.getName() + " finished" );
    c.setState( State.FINISHED );
end

rule "B to D"
  when
    State(name == "B", state == State.FINISHED )
    d : State(name == "D", state == State.NOTRUN )
  then
    System.out.println(d.getName() + " finished" );
    d.setState( State.FINISHED );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>从这时起，两个规则都可能触发，因此，这些规则存在冲突。冲突解决策略使Drools引擎议程可以决定触发哪条规则。规则<code>"B to C"</code>具有较高的显着性值（ <code>10</code>与默认的显着性值<code>0</code> ），因此它会先触发，然后修改对象<code>C</code>陈述<code>FINISHED</code> 。</p>
</div>
<div class="paragraph">
<p>IDE中的“ <strong>审核视图”</strong>显示了对<code>State</code>规则中的对象<code>"A to B"</code> ，导致两次激活发生冲突。</p>
</div>
<div class="paragraph">
<p>您还可以在IDE中使用“ <strong>议程视图”</strong>来调查Drools引擎议程的状态。在此示例中，“ <strong>议程视图”</strong>显示规则中的断点<code>"A to B"</code>以及议程状态与两个相互冲突的规则。规则<code>"B to D"</code>最后触发，修改对象<code>D</code>陈述<code>FINISHED</code> 。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/StateExample/state_example_agenda1.png" alt="说明示例议程1">
</div>
<div class="title">图360。显着状态示例议程视图</div>
</div>
<h4 id="_state_example_using_agenda_groups" class="discrete">使用议程组的状态示例</h4>
<div class="paragraph">
<p>的<code>StateExampleUsingAgendaGroups</code> State版本的示例在规则中使用议程组来解决规则执行冲突。议程组使您可以对Drools引擎议程进行分区，以提供对规则组的更多执行控制。默认情况下，所有规则都在议程组中<code>MAIN</code> 。您可以使用<code>agenda-group</code>属性为规则指定其他议程组。</p>
</div>
<div class="paragraph">
<p>最初，工作记忆的重点是议程小组<code>MAIN</code> 。议程小组中的规则只有在小组获得焦点时才会触发。您可以使用以下方法设置焦点<code>setFocus()</code>或规则属性<code>auto-focus</code> 。的<code>auto-focus</code>属性可以使规则在匹配并激活后自动为其议程组赋予焦点。</p>
</div>
<div class="paragraph">
<p>在此示例中， <code>auto-focus</code>属性启用规则<code>"B to C"</code>在之前开火<code>"B to D"</code> 。</p>
</div>
<div class="listingblock">
<div class="title">议程组状态示例中的“ B至C”规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "B to C"
    agenda-group "B to C"
    auto-focus true
  when
    State(name == "B", state == State.FINISHED )
    c : State(name == "C", state == State.NOTRUN )
  then
    System.out.println(c.getName() + " finished" );
    c.setState( State.FINISHED );
    kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup( "B to D" ).setFocus();
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>规则<code>"B to C"</code>来电<code>setFocus()</code>在议程小组中<code>"B to D"</code> ，从而启用其活动规则，从而启用规则<code>"B to D"</code>开火。</p>
</div>
<div class="listingblock">
<div class="title">议程组状态示例中的“ B至D”规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "B to D"
    agenda-group "B to D"
  when
    State(name == "B", state == State.FINISHED )
    d : State(name == "D", state == State.NOTRUN )
  then
    System.out.println(d.getName() + " finished" );
    d.setState( State.FINISHED );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>要执行示例，请运行<code>org.drools.examples.state.StateExampleUsingAgendaGroups</code>类在您的IDE中作为Java应用程序。</p>
</div>
<div class="paragraph">
<p>执行之后，以下输出将显示在IDE控制台窗口中（与State示例的显着版本相同）：</p>
</div>
<div class="listingblock">
<div class="title">IDE控制台中的议程组状态示例输出</div>
<div class="content">
<pre class="highlightjs highlight"><code>A finished
B finished
C finished
D finished</code></pre>
</div>
</div>
<h4 id="_dynamic_facts_in_the_state_example" class="discrete">状态示例中的动态事实</h4>
<div class="paragraph">
<p>在此State示例中，另一个值得注意的概念是基于实现<em>事实</em>的对象使用<em>动态事实</em> 。 <code>PropertyChangeListener</code>宾语。为了让Drools引擎看到事实属性的更改并对更改做出反应，应用程序必须通知Drools引擎发生了更改。您可以使用<code>modify</code>声明，或通过指定事实实现<code>PropertyChangeSupport</code> JavaBeans规范定义的接口。</p>
</div>
<div class="paragraph">
<p>此示例演示了如何使用<code>PropertyChangeSupport</code>界面，无需显式<code>modify</code>规则中的声明。要使用此接口，请确保您的事实得以实现<code>PropertyChangeSupport</code>就像上课一样<code>org.drools.example.State</code>实现它，然后在DRL规则文件中使用以下代码来配置Drools引擎以侦听这些事实的属性更改：</p>
</div>
<div class="listingblock">
<div class="title">宣布一个动态事实</div>
<div class="content">
<pre class="highlightjs highlight"><code>declare type State
  @propertyChangeSupport
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用时<code>PropertyChangeListener</code>对象，每个设置器都必须为通知实现其他代码。例如，以下setter <code>state</code>在班上<code>org.drools.examples</code> ：</p>
</div>
<div class="listingblock">
<div class="title">使用PropertyChangeSupport的设置器示例</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void setState(final int newState) {
    int oldState = this.state;
    this.state = newState;
    this.changes.firePropertyChange( "state",
                                     oldState,
                                     newState );
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-fibonacci-ref_drools-examples"><a class="anchor" href="#decision-examples-fibonacci-ref_drools-examples"></a> <a class="link" href="#decision-examples-fibonacci-ref_drools-examples">20.5。斐波那契示例决策（递归和冲突解决）</a></h3>
<div class="paragraph">
<p>斐波那契示例决策集演示了Drools引擎如何使用递归来解决序列中规则的执行冲突。该示例着重于通过可在规则中定义的显着性值解决冲突。</p>
</div>
<div class="paragraph">
<p>以下是斐波那契示例的概述：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>名称</strong> ：<code>fibonacci</code></p>
</li>
<li>
<p><strong>主班</strong> <code>org.drools.examples.fibonacci.FibonacciExample</code> （在<code>src/main/java</code> ）</p>
</li>
<li>
<p><strong>模块</strong> ：<code>drools-examples</code></p>
</li>
<li>
<p><strong>类型</strong> ：Java应用程序</p>
</li>
<li>
<p><strong>规则文件</strong> ： <code>org.drools.examples.fibonacci.Fibonacci.drl</code> （在<code>src/main/resources</code> ）</p>
</li>
<li>
<p><strong>目标</strong> ：通过规则显着性演示递归和冲突解决</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>斐波那契数形成一个以0和1开头的序列。下一个斐波那契数是通过将前面的两个斐波那契数相加得出的：0、1、1、2、3、5、8、13、21、34、55、89、144、233、377、610、987、1597， 2584、4181、6765、10946等。</p>
</div>
<div class="paragraph">
<p>斐波那契示例使用单个事实类<code>Fibonacci</code>具有以下两个字段：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sequence</code></p>
</li>
<li>
<p><code>value</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>的<code>sequence</code>字段指示对象在斐波那契数列中的位置。的<code>value</code>字段显示该斐波那契对象在该序列位置的值，其中<code>-1</code>指示仍需要计算的值。</p>
</div>
<div class="listingblock">
<div class="title">斐波那契级</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static class Fibonacci {
    private int  sequence;
    private long value;

    public Fibonacci( final int sequence ) {
        this.sequence = sequence;
        this.value = -1;
    }

    ... setters and getters go here...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>要执行示例，请运行<code>org.drools.examples.fibonacci.FibonacciExample</code>类在您的IDE中作为Java应用程序。</p>
</div>
<div class="paragraph">
<p>执行之后，IDE控制台窗口中将显示以下输出：</p>
</div>
<div class="listingblock">
<div class="title">IDE控制台中的Fibonacci示例输出</div>
<div class="content">
<pre class="highlightjs highlight"><code>recurse for 50
recurse for 49
recurse for 48
recurse for 47
...
recurse for 5
recurse for 4
recurse for 3
recurse for 2
1 == 1
2 == 1
3 == 2
4 == 3
5 == 5
6 == 8
...
47 == 2971215073
48 == 4807526976
49 == 7778742049
50 == 12586269025</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了在Java中实现此行为，该示例插入了一个<code>Fibonacci</code>序列字段为的对象<code>50</code> 。然后，该示例使用递归规则插入其他49 <code>Fibonacci</code>对象。</p>
</div>
<div class="paragraph">
<p>而不是实施<code>PropertyChangeSupport</code>使用动态事实的界面，此示例使用MVEL方言<code>modify</code>关键字，以启用阻止设置程序操作并通知Drools引擎更改。</p>
</div>
<div class="listingblock">
<div class="title">斐波那契示例执行</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.insert( new Fibonacci( 50 ) );
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="paragraph">
<p>本示例使用以下三个规则：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"Recurse"</code></p>
</li>
<li>
<p><code>"Bootstrap"</code></p>
</li>
<li>
<p><code>"Calculate"</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>规则<code>"Recurse"</code>匹配每个断言<code>Fibonacci</code>值为的对象<code>-1</code> ，创建并声明一个新的<code>Fibonacci</code>序列比当前匹配的对象少一个的对象。每次添加斐波那契对象时，其序列字段等于<code>1</code>不存在，规则将重新匹配并再次触发。的<code>not</code>一旦内存中有全部50个Fibonacci对象，就可以使用conditional元素来停止规则匹配。该规则也有一个<code>salience</code>价值，因为您需要拥有全部50个<code>Fibonacci</code>在执行之前声明的对象<code>"Bootstrap"</code>规则。</p>
</div>
<div class="listingblock">
<div class="title">规则“递归”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Recurse"
    salience 10
  when
    f : Fibonacci ( value == -1 )
    not ( Fibonacci ( sequence == 1 ) )
  then
    insert( new Fibonacci( f.sequence - 1 ) );
    System.out.println( "recurse for " + f.sequence );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了更好地理解此示例的执行流程，可以从以下位置加载审核日志文件： <code>target/fibonacci.log</code>进入IDE调试视图或<strong>Audit View</strong> （如果可用）（例如，在某些IDE的“ <strong>窗口”</strong> →“ <strong>显示视图”</strong>中）。</p>
</div>
<div class="paragraph">
<p>在此示例中， <strong>审核视图</strong>显示了对<code>Fibonacci</code>带一个对象<code>sequence</code>现场<code>50</code> ，由Java代码完成。从那里开始， <strong>审核视图</strong>显示了规则的连续递归，其中每个已断言<code>Fibonacci</code>对象导致<code>"Recurse"</code>规则被激活并再次开火。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/FibonacciExample/fibonacci1.png" alt="斐波那契1">
</div>
<div class="title">图361。审核视图中的规则“递归”</div>
</div>
<div class="paragraph">
<p>当一个<code>Fibonacci</code>带一个对象<code>sequence</code>现场<code>2</code>断言， <code>"Bootstrap"</code>规则与<code>"Recurse"</code>规则。注意字段的多重限制<code>sequence</code>与<code>1</code>要么<code>2</code> ：</p>
</div>
<div class="listingblock">
<div class="title">规则“引导程序”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Bootstrap"
  when
    f : Fibonacci( sequence == 1 || == 2, value == -1 ) // multi-restriction
  then
    modify ( f ){ value = 1 };
    System.out.println( f.sequence + " == " + f.value );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以在IDE中使用“ <strong>议程视图”</strong>来调查Drools引擎议程的状态。的<code>"Bootstrap"</code>规则尚未触发，因为<code>"Recurse"</code>规则具有较高的显着性值。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/FibonacciExample/fibonacci_agenda1.png" alt="斐波那契议程1">
</div>
<div class="title">图362。议程视图1中的规则“递归”和“引导程序”</div>
</div>
<div class="paragraph">
<p>当一个<code>Fibonacci</code>带一个对象<code>sequence</code>的<code>1</code>断言， <code>"Bootstrap"</code>规则再次匹配，导致该规则两次激活。的<code>"Recurse"</code>规则不匹配并无法激活，因为<code>not</code>条件元素会在<code>Fibonacci</code>带一个对象<code>sequence</code>的<code>1</code>存在。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/FibonacciExample/fibonacci_agenda2.png" alt="斐波那契议程2">
</div>
<div class="title">图363。议程视图2中的规则“递归”和“引导程序”</div>
</div>
<div class="paragraph">
<p>的<code>"Bootstrap"</code>规则使用<code>sequence</code>的<code>1</code>和<code>2</code>值<code>1</code> 。现在你有两个<code>Fibonacci</code>值不等于的对象<code>-1</code> ， <code>"Calculate"</code>规则能够匹配。</p>
</div>
<div class="paragraph">
<p>在示例中，此时将近50 <code>Fibonacci</code>对象存在于工作存储器中。您需要选择一个合适的三元组依次计算每个值。如果在没有字段约束的规则中使用三个斐波那契模式来限制可能的叉积，结果将是50x49x48可能的组合，导致大约125,000个可能的规则触发，其中大多数不正确。</p>
</div>
<div class="paragraph">
<p>的<code>"Calculate"</code>规则使用字段约束以正确的顺序评估三个斐波那契模式。这种技术称为<em>跨产品匹配</em> 。</p>
</div>
<div class="paragraph">
<p>第一个模式找到任何<code>Fibonacci</code>有值的对象<code>!= -1</code>并同时绑定模式和字段。第二<code>Fibonacci</code>对象做同样的事情，但是增加了一个额外的字段约束，以确保其序列比<code>Fibonacci</code>绑定对象<code>f1</code> 。第一次触发此规则时，您知道只有序列<code>1</code>和<code>2</code>的值为<code>1</code> ，这两个约束条件确保<code>f1</code>参考序列<code>1</code>然后<code>f2</code>参考序列<code>2</code> 。</p>
</div>
<div class="paragraph">
<p>最终模式找到<code>Fibonacci</code>值等于的对象<code>-1</code>且序列大于<code>f2</code> 。</p>
</div>
<div class="paragraph">
<p>在示例中，此时，三个<code>Fibonacci</code>从可用的叉积中正确选择对象，然后您可以计算第三个对象的值<code>Fibonacci</code>绑定到的对象<code>f3</code> 。</p>
</div>
<div class="listingblock">
<div class="title">规则“计算”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Calculate"
  when
    // Bind f1 and s1.
    f1 : Fibonacci( s1 : sequence, value != -1 )
    // Bind f2 and v2, refer to bound variable s1.
    f2 : Fibonacci( sequence == (s1 + 1), v2 : value != -1 )
    // Bind f3 and s3, alternative reference of f2.sequence.
    f3 : Fibonacci( s3 : sequence == (f2.sequence + 1 ), value == -1 )
  then
    // Note the various referencing techniques.
    modify ( f3 ) { value = f1.value + v2 };
    System.out.println( s3 + " == " + f3.value );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>modify</code>语句更新<code>Fibonacci</code>绑定对象<code>f3</code> 。这意味着您现在有了另一个新<code>Fibonacci</code>值不等于的对象<code>-1</code> ，这允许<code>"Calculate"</code>重新匹配并计算下一个斐波那契数的规则。</p>
</div>
<div class="paragraph">
<p>IDE的调试视图或<strong>审核视图</strong>显示了如何触发最后一个<code>"Bootstrap"</code>规则修改<code>Fibonacci</code>对象，启用<code>"Calculate"</code>匹配的规则，然后修改另一个<code>Fibonacci</code>启用<code>"Calculate"</code>规则再次匹配。继续此过程，直到为所有<code>Fibonacci</code>对象。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/FibonacciExample/fibonacci4.png" alt="斐波那契4">
</div>
<div class="title">图364。审核视图中的规则</div>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-pricing-ref_drools-examples"><a class="anchor" href="#decision-examples-pricing-ref_drools-examples"></a> <a class="link" href="#decision-examples-pricing-ref_drools-examples">20.6。定价示例决策（决策表）</a></h3>
<div class="paragraph">
<p>定价示例决策集演示了如何使用电子表格决策表以表格格式而不是直接在DRL文件中计算保险单的零售成本。</p>
</div>
<div class="paragraph">
<p>以下是“定价”示例的概述：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>名称</strong> ：<code>decisiontable</code></p>
</li>
<li>
<p><strong>主班</strong> <code>org.drools.examples.decisiontable.PricingRuleDTExample</code> （在<code>src/main/java</code> ）</p>
</li>
<li>
<p><strong>模块</strong> ：<code>drools-examples</code></p>
</li>
<li>
<p><strong>类型</strong> ：Java应用程序</p>
</li>
<li>
<p><strong>规则文件</strong> ： <code>org.drools.examples.decisiontable.ExamplePolicyPricing.xls</code> （在<code>src/main/resources</code> ）</p>
</li>
<li>
<p><strong>目标</strong> ：演示使用电子表格决策表定义规则</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>电子表格决策表是XLS或XLSX电子表格，其中包含以表格格式定义的业务规则。您可以在独立的Drools项目中包含电子表格决策表，也可以将其上载到Business Central中的项目。决策表中的每一行都是一个规则，而每一列则是一个条件，一个动作或另一个规则属性。在将决策表创建并上传到Drools项目之后，与所有其他规则资产一样，您定义的规则也将编译为Drools规则语言（DRL）规则。</p>
</div>
<div class="paragraph">
<p>定价示例的目的是提供一组业务规则，以为申请特定类型保单的汽车驾驶员计算基本价格和折扣。驾驶员的年龄和历史以及保单类型都有助于计算基本保费，并且附加规则计算驾驶员可能有资格获得的潜在折扣。</p>
</div>
<div class="paragraph">
<p>要执行示例，请运行<code>org.drools.examples.decisiontable.PricingRuleDTExample</code>类在您的IDE中作为Java应用程序。</p>
</div>
<div class="paragraph">
<p>执行之后，IDE控制台窗口中将显示以下输出：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Cheapest possible
BASE PRICE IS: 120
DISCOUNT IS: 20</code></pre>
</div>
</div>
<div class="paragraph">
<p>执行该示例的代码遵循典型的执行模式：加载规则，插入事实并创建无状态KIE会话。此示例的区别在于规则是在<code>ExamplePolicyPricing.xls</code>文件而不是DRL文件或其他来源。电子表格文件使用模板和DRL规则加载到Drools引擎中。</p>
</div>
<h4 id="_spreadsheet_decision_table_setup" class="discrete">电子表格决策表设置</h4>
<div class="paragraph">
<p>的<code>ExamplePolicyPricing.xls</code>电子表格在第一个标签中包含两个决策表：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Base pricing rules</code></p>
</li>
<li>
<p><code>Promotional discount rules</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如电子表格示例所示，您只能使用电子表格的第一个标签来创建决策表，但是多个表可以位于一个标签中。决策表不一定遵循自上而下的逻辑，而是更多地用于捕获产生规则的数据的手段。规则的评估不一定按给定的顺序进行，因为Drools引擎的所有常规力学仍然适用。这就是为什么您可以在电子表格的同一标签中拥有多个决策表的原因。</p>
</div>
<div class="paragraph">
<p>决策表通过相应的规则模板文件执行<code>BasePricing.drt</code>和<code>PromotionalPricing.drt</code> 。这些模板文件通过其模板参数引用决策表，并直接引用决策表中条件和操作的各种标题。</p>
</div>
<div class="listingblock">
<div class="title">BasePricing.drt规则模板文件</div>
<div class="content">
<pre class="highlightjs highlight"><code>template header
age[]
profile
priorClaims
policyType
base
reason

package org.drools.examples.decisiontable;

template "Pricing bracket"
age
policyType
base

rule "Pricing bracket_@{row.rowNumber}"
  when
    Driver(age &gt;= @{age0}, age &lt;= @{age1}
        , priorClaims == "@{priorClaims}"
        , locationRiskProfile == "@{profile}"
    )
    policy: Policy(type == "@{policyType}")
  then
    policy.setBasePrice(@{base});
    System.out.println("@{reason}");
end
end template</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">PromotionalPricing.drt规则模板文件</div>
<div class="content">
<pre class="highlightjs highlight"><code>template header
age[]
priorClaims
policyType
discount

package org.drools.examples.decisiontable;

template "discounts"
age
priorClaims
policyType
discount

rule "Discounts_@{row.rowNumber}"
  when
    Driver(age &gt;= @{age0}, age &lt;= @{age1}, priorClaims == "@{priorClaims}")
    policy: Policy(type == "@{policyType}")
  then
    policy.applyDiscount(@{discount});
end
end template</code></pre>
</div>
</div>
<div class="paragraph">
<p>规则通过<code>kmodule.xml</code> KIE会议的参考<code>DTableWithTemplateKB</code> ，其中特别提到了<code>ExamplePolicyPricing.xls</code>电子表格，是成功执行规则所必需的。通过这种执行方法，您可以将规则作为独立单元执行（如本例中所示），也可以将规则包括在打包的知识JAR（KJAR）文件中，以便将电子表格与执行规则一起打包。</p>
</div>
<div class="paragraph">
<p>以下部分<code>kmodule.xml</code>文件是规则和电子表格成功执行所必需的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;kbase name="DecisionTableKB" packages="org.drools.examples.decisiontable"&gt;
        &lt;ksession name="DecisionTableKS" type="stateless"/&gt;
    &lt;/kbase&gt;

    &lt;kbase name="DTableWithTemplateKB" packages="org.drools.examples.decisiontable-template"&gt;
        &lt;ruleTemplate dtable="org/drools/examples/decisiontable-template/ExamplePolicyPricingTemplateData.xls"
                      template="org/drools/examples/decisiontable-template/BasePricing.drt"
                      row="3" col="3"/&gt;
        &lt;ruleTemplate dtable="org/drools/examples/decisiontable-template/ExamplePolicyPricingTemplateData.xls"
                      template="org/drools/examples/decisiontable-template/PromotionalPricing.drt"
                      row="18" col="3"/&gt;
        &lt;ksession name="DTableWithTemplateKS"/&gt;
    &lt;/kbase&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>作为使用规则模板文件执行决策表的替代方法，您可以使用<code>DecisionTableConfiguration</code>对象并指定输入电子表格作为输入类型，例如<code>DecisionTableInputType.xls</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DecisionTableConfiguration dtableconfiguration =
    KnowledgeBuilderFactory.newDecisionTableConfiguration();
        dtableconfiguration.setInputType( DecisionTableInputType.XLS );

        KnowledgeBuilder kbuilder = KnowledgeBuilderFactory.newKnowledgeBuilder();

        Resource xlsRes = ResourceFactory.newClassPathResource( "ExamplePolicyPricing.xls",
                                                                getClass() );
        kbuilder.add( xlsRes,
                      ResourceType.DTABLE,
                      dtableconfiguration );</code></pre>
</div>
</div>
<div class="paragraph">
<p>定价示例使用两种事实类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Driver</code></p>
</li>
<li>
<p><code>Policy</code> 。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>该示例在各自的Java类中为两个事实设置默认值。 <code>Driver.java</code>和<code>Policy.java</code> 。的<code>Driver</code>年龄30岁，之前没有索偿要求，目前的风险状况为<code>LOW</code> 。的<code>Policy</code>驾驶员正在申请的是<code>COMPREHENSIVE</code> 。</p>
</div>
<div class="paragraph">
<p>在任何决策表中，每一行都被视为不同的规则，每一列都是一个条件或一个动作。除非在执行时清除了议程，否则在决策表中评估每一行。</p>
</div>
<div class="paragraph">
<p>决策表电子表格（XLS或XLSX）需要两个定义规则数据的关键区域：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>一种<code>RuleSet</code>区域</p>
</li>
<li>
<p>一种<code>RuleTable</code>区域</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>的<code>RuleSet</code>电子表格的“区域”定义要全局应用于同一包（不仅是电子表格）中的所有规则的元素，例如规则集名称或通用规则属性。的<code>RuleTable</code>区域定义实际规则（行）以及在指定规则集中构成该规则表的条件，操作和其他规则属性（列）。决策表电子表格可以包含多个<code>RuleTable</code>区域，但只有一个<code>RuleSet</code>区域。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/PricingExample/DT_Config.png" alt="DT配置">
</div>
<div class="title">图365。决策表配置</div>
</div>
<div class="paragraph">
<p>的<code>RuleTable</code>区域还定义了规则属性适用的对象，在这种情况下<code>Driver</code>和<code>Policy</code> ，然后是对象的约束。例如， <code>Driver</code>定义<code>Age Bracket</code>列为<code>age >= $1, age <= $2</code> ，其中在表格列值中定义了逗号分隔的范围，例如<code>18,24</code> 。</p>
</div>
<h4 id="_base_pricing_rules" class="discrete">基本定价规则</h4>
<div class="paragraph">
<p>的<code>Base pricing rules</code> “定价”示例中的决策表评估驱动程序的寿命，风险概况，索赔数量和保单类型，并根据这些条件得出保单的底价。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/PricingExample/DT_Table1.png" alt="DT表1">
</div>
<div class="title">图366。底价计算</div>
</div>
<div class="paragraph">
<p>的<code>Driver</code>下表列中定义了属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Age Bracket</code> ：年龄括号中有条件的定义<code>age >=$1, age <=$2</code> ，它定义了驾驶员年龄的条件边界。此条件列突出显示了<code>$1 and $2</code> ，在电子表格中用逗号分隔。您可以将这些值写为<code>18,24</code>要么<code>18, 24</code>两种格式都可以执行业务规则。</p>
</li>
<li>
<p><code>Location risk profile</code> ：风险配置文件是示例程序始终通过的字符串<code>LOW</code>但可以更改以反映<code>MED</code>要么<code>HIGH</code> 。</p>
</li>
<li>
<p><code>Number of prior claims</code> ：声明的数量定义为条件列必须完全等于才能触发操作的整数。该值不是范围，仅是完全匹配。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>的<code>Policy</code>决策表的“条件”和“条件”均用于规则，并在下表的列中定义了属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Policy type applying for</code> ：策略类型是作为字符串传递的条件，该字符串定义了覆盖范围的类型： <code>COMPREHENSIVE</code> ， <code>FIRE_THEFT</code> ， 要么<code>THIRD_PARTY</code> 。</p>
</li>
<li>
<p><code>Base $ AUD</code> ： <code>basePrice</code>被定义为<code>ACTION</code>通过约束设定价格<code>policy.setBasePrice($param);</code>基于与此值相对应的电子表格单元格。当您为此决策表执行相应的DRL规则时， <code>then</code>规则的一部分将在与事实相匹配的真实条件下执行此操作语句，并将基本价格设置为相应的值。</p>
</li>
<li>
<p><code>Record Reason</code> ：规则成功执行后，此操作会生成一条输出消息到<code>System.out</code>控制台，反映触发了哪个规则。稍后将其捕获到应用程序中并进行打印。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>该示例还使用左侧的第一列对规则进行分类。该列仅用于注释，对规则执行没有影响。</p>
</div>
<h4 id="_promotional_discount_rules" class="discrete">促销折扣规则</h4>
<div class="paragraph">
<p>的<code>Promotional discount rules</code> “定价”示例中的决策表评估驾驶员的年龄，在先索赔的数量和驾驶员的保单类型，以产生保险单价格的潜在折扣。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/PricingExample/DT_Table2.png" alt="DT表2">
</div>
<div class="title">图367。折扣计算</div>
</div>
<div class="paragraph">
<p>该决策表包含驾驶员可能有资格享受的折扣条件。与基本价格计算类似，此表评估了<code>Age</code> ， <code>Number of prior claims</code>的驱动程序，以及<code>Policy type applying for</code>确定一个<code>Discount %</code>要应用的费率。例如，如果驾驶员今年30岁，没有事先声明，并且正在申请<code>COMPREHENSIVE</code>政策，给驾驶员折扣<code>20</code>百分。</p>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-petstore-ref_drools-examples"><a class="anchor" href="#decision-examples-petstore-ref_drools-examples"></a> <a class="link" href="#decision-examples-petstore-ref_drools-examples">20.7。Pet Store示例决策（议程组，全局变量，回调和GUI集成）</a></h3>
<div class="paragraph">
<p>Pet Store示例决策集演示了如何在规则中使用议程组和全局变量，以及如何将Drools规则与图形用户界面（GUI）（在本例中为基于Swing的桌面应用程序）集成。该示例还演示了如何使用回调与正在运行的Drools引擎进行交互，以基于运行时工作内存中的更改来更新GUI。</p>
</div>
<div class="paragraph">
<p>以下是“宠物店”示例的概述：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>名称</strong> ：<code>petstore</code></p>
</li>
<li>
<p><strong>主班</strong> <code>org.drools.examples.petstore.PetStoreExample</code> （在<code>src/main/java</code> ）</p>
</li>
<li>
<p><strong>模块</strong> ：<code>drools-examples</code></p>
</li>
<li>
<p><strong>类型</strong> ：Java应用程序</p>
</li>
<li>
<p><strong>规则文件</strong> ： <code>org.drools.examples.petstore.PetStore.drl</code> （在<code>src/main/resources</code> ）</p>
</li>
<li>
<p><strong>目标</strong> ：演示规则议程组，全局变量，回调和GUI集成</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在“宠物店”示例中，示例<code>PetStoreExample.java</code>类定义以下主体类（除了一些用于处理Swing事件的类）：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Petstore</code>包含<code>main()</code>方法。</p>
</li>
<li>
<p><code>PetStoreUI</code>负责创建和显示基于Swing的GUI。此类包含几个较小的类，主要用于响应各种GUI事件，例如用户鼠标单击。</p>
</li>
<li>
<p><code>TableModel</code>保存表数据。该类实质上是扩展Swing类的JavaBean。 <code>AbstractTableModel</code> 。</p>
</li>
<li>
<p><code>CheckoutCallback</code>使GUI与规则进行交互。</p>
</li>
<li>
<p><code>Ordershow</code>保留您要购买的物品。</p>
</li>
<li>
<p><code>Purchase</code>存储订单的详细信息以及您要购买的产品。</p>
</li>
<li>
<p><code>Product</code>是一个JavaBean，其中包含可购买的产品及其价格的详细信息。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>此示例中的许多Java代码都是基于纯JavaBean或基于Swing的。有关Swing组件的更多信息，请参见有关<a href="https://docs.oracle.com/javase/tutorial/uiswing/">使用JFC / Swing创建GUI</a>的Java教程。</p>
</div>
<h4 id="_rule_execution_behavior_in_the_pet_store_example" class="discrete">Pet Store示例中的规则执行行为</h4>
<div class="paragraph">
<p>与其他断言事实并立即触发事实的示例决策集不同，“宠物商店”示例在基于用户交互收集更多事实之前不会执行规则。该示例通过<code>PetStoreUI</code>由构造函数创建的对象，该对象接受<code>Vector</code>宾语<code>stock</code>用于收集产品。然后，该示例使用了<code>CheckoutCallback</code>包含先前加载的规则库的类。</p>
</div>
<div class="listingblock">
<div class="title">Pet Store KIE容器和事实执行设置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// KieServices is the factory for all KIE services.
KieServices ks = KieServices.Factory.get();

// Create a KIE container on the class path.
KieContainer kc = ks.getKieClasspathContainer();

// Create the stock.
Vector&lt;Product&gt; stock = new Vector&lt;Product&gt;();
stock.add( new Product( "Gold Fish", 5 ) );
stock.add( new Product( "Fish Tank", 25 ) );
stock.add( new Product( "Fish Food", 2 ) );

// A callback is responsible for populating the working memory and for firing all rules.
PetStoreUI ui = new PetStoreUI( stock,
                                new CheckoutCallback( kc ) );
ui.createAndShowGUI();</code></pre>
</div>
</div>
<div class="paragraph">
<p>触发规则的Java代码位于<code>CheckoutCallBack.checkout()</code>方法。当用户单击UI中的<strong>Checkout</strong>时，将触发此方法。</p>
</div>
<div class="listingblock">
<div class="title">从CheckoutCallBack.checkout（）执行规则</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public String checkout(JFrame frame, List&lt;Product&gt; items) {
    Order order = new Order();

    // Iterate through list and add to cart.
    for ( Product p: items ) {
        order.addItem( new Purchase( order, p ) );
    }

    // Add the JFrame to the ApplicationData to allow for user interaction.

    // From the KIE container, a KIE session is created based on
    // its definition and configuration in the META-INF/kmodule.xml file.
    KieSession ksession = kcontainer.newKieSession("PetStoreKS");

    ksession.setGlobal( "frame", frame );
    ksession.setGlobal( "textArea", this.output );

    ksession.insert( new Product( "Gold Fish", 5 ) );
    ksession.insert( new Product( "Fish Tank", 25 ) );
    ksession.insert( new Product( "Fish Food", 2 ) );

    ksession.insert( new Product( "Fish Food Sample", 0 ) );

    ksession.insert( order );

    // Execute rules.
    ksession.fireAllRules();

    // Return the state of the cart
    return order.toString();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>示例代码将两个元素传递给<code>CheckoutCallBack.checkout()</code>方法。一个元素是<code>JFrame</code>围绕输出文本框的Swing组件，位于GUI底部。第二个元素是订单商品列表，来自<code>TableModel</code>存储来自<code>Table</code> GUI右上角的区域。</p>
</div>
<div class="paragraph">
<p>的<code>for</code>循环将来自GUI的订单商品列表转换为<code>Order</code> JavaBean，也包含在文件中<code>PetStoreExample.java</code> 。</p>
</div>
<div class="paragraph">
<p>在这种情况下，该规则在无状态KIE会话中触发，因为所有数据都存储在Swing组件中，并且直到用户单击UI中的<strong>Checkout</strong>才执行。每次用户单击<strong>Checkout时</strong> ，列表的内容都会从Swing中移出<code>TableModel</code>进入KIE会话工作存储器，然后使用<code>ksession.fireAllRules()</code>方法。</p>
</div>
<div class="paragraph">
<p>在此代码中，有九个调用<code>KieSession</code> 。第一个创建一个新的<code>KieSession</code>来自<code>KieContainer</code> （示例通过了<code>KieContainer</code>来自<code>CheckoutCallBack</code>中的课程<code>main()</code>方法）。接下来的两个调用传入两个规则中包含全局变量的对象：Swing文本区域和用于编写消息的Swing框架。更多插页将有关产品的信息放入<code>KieSession</code> ，以及订单列表。最终通话是标准<code>fireAllRules()</code> 。</p>
</div>
<h4 id="_pet_store_rule_file_imports_global_variables_and_java_functions" class="discrete">Pet Store规则文件导入，全局变量和Java函数</h4>
<div class="paragraph">
<p>的<code>PetStore.drl</code>文件包含标准的package和import语句，以使各种Java类可用于规则。规则文件还包括要在规则内使用的<em>全局变量</em> ，定义为<code>frame</code>和<code>textArea</code> 。全局变量包含对Swing组件的引用<code>JFrame</code>和<code>JTextArea</code>先前由称为的Java代码传递的组件<code>setGlobal()</code>方法。与规则中的标准变量（在规则触发后立即失效）不同，全局变量在KIE会话的生存期内保留其值。这意味着这些全局变量的内容可用于所有后续规则的评估。</p>
</div>
<div class="listingblock">
<div class="title">PetStore.drl程序包，导入和全局变量</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.drools.examples;

import org.kie.api.runtime.KieRuntime;
import org.drools.examples.petstore.PetStoreExample.Order;
import org.drools.examples.petstore.PetStoreExample.Purchase;
import org.drools.examples.petstore.PetStoreExample.Product;
import java.util.ArrayList;
import javax.swing.JOptionPane;

import javax.swing.JFrame;

global JFrame frame
global javax.swing.JTextArea textArea</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>PetStore.drl</code>文件还包含文件中的规则使用的两个函数：</p>
</div>
<div class="listingblock">
<div class="title">PetStore.drl Java函数</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">function void doCheckout(JFrame frame, KieRuntime krt) {
        Object[] options = {"Yes",
                            "No"};

        int n = JOptionPane.showOptionDialog(frame,
                                             "Would you like to checkout?",
                                             "",
                                             JOptionPane.YES_NO_OPTION,
                                             JOptionPane.QUESTION_MESSAGE,
                                             null,
                                             options,
                                             options[0]);

       if (n == 0) {
            krt.getAgenda().getAgendaGroup( "checkout" ).setFocus();
       }
}

function boolean requireTank(JFrame frame, KieRuntime krt, Order order, Product fishTank, int total) {
        Object[] options = {"Yes",
                            "No"};

        int n = JOptionPane.showOptionDialog(frame,
                                             "Would you like to buy a tank for your " + total + " fish?",
                                             "Purchase Suggestion",
                                             JOptionPane.YES_NO_OPTION,
                                             JOptionPane.QUESTION_MESSAGE,
                                             null,
                                             options,
                                             options[0]);

       System.out.print( "SUGGESTION: Would you like to buy a tank for your "
                           + total + " fish? - " );

       if (n == 0) {
             Purchase purchase = new Purchase( order, fishTank );
             krt.insert( purchase );
             order.addItem( purchase );
             System.out.println( "Yes" );
       } else {
            System.out.println( "No" );
       }
       return true;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这两个功能执行以下操作：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>doCheckout()</code>显示一个对话框，询问用户是否要签出。如果用户这样做，则将焦点设置为<code>checkout</code>议程组，从而启用该组中的规则（可能）触发。</p>
</li>
<li>
<p><code>requireTank()</code>显示一个对话框，询问用户是否要购买鱼缸。如果用户这样做，则换一个新的鱼缸<code>Product</code>被添加到工作存储器中的订单列表中。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">对于此示例，所有规则和功能都在同一规则文件中，以提高效率。在生产环境中，通常将规则和函数分隔在不同的文件中，或构建静态Java方法并使用导入功能导入文件，例如<code>import function my.package.name.hello</code> 。
</td>
</tr>
</tbody></table>
</div>
<h4 id="_pet_store_rules_with_agenda_groups" class="discrete">宠物商店规则与议程小组</h4>
<div class="paragraph">
<p>Pet Store示例中的大多数规则都使用议程组来控制规则执行。通过议程组，您可以划分Drools引擎议程，以提供对规则组的更多执行控制。默认情况下，所有规则都在议程组中<code>MAIN</code> 。您可以使用<code>agenda-group</code>属性为规则指定其他议程组。</p>
</div>
<div class="paragraph">
<p>最初，工作记忆的重点是议程小组<code>MAIN</code> 。议程小组中的规则只有在小组获得焦点时才会触发。您可以使用以下方法设置焦点<code>setFocus()</code>或规则属性<code>auto-focus</code> 。的<code>auto-focus</code>属性可以使规则在匹配并激活后自动为其议程组赋予焦点。</p>
</div>
<div class="paragraph">
<p>宠物店示例使用以下议程组作为规则：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"init"</code></p>
</li>
<li>
<p><code>"evaluate"</code></p>
</li>
<li>
<p><code>"show items"</code></p>
</li>
<li>
<p><code>"checkout"</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如，样本规则<code>"Explode Cart"</code>使用<code>"init"</code>议程组，以确保它可以选择触发购物车项目并将其插入KIE会话工作记忆中：</p>
</div>
<div class="listingblock">
<div class="title">规则“分解购物车”</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Insert each item in the shopping cart into the working memory.
rule "Explode Cart"
    agenda-group "init"
    auto-focus true
    salience 10
  when
    $order : Order( grossTotal == -1 )
    $item : Purchase() from $order.items
  then
    insert( $item );
    kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup( "show items" ).setFocus();
    kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup( "evaluate" ).setFocus();
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>此规则与所有尚无订单的订单匹配<code>grossTotal</code>计算。该订单中每个购买商品的执行循环。</p>
</div>
<div class="paragraph">
<p>该规则使用与其议程组相关的以下功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>agenda-group "init"</code>定义议程组的名称。在这种情况下，组中只有一个规则。但是，Java代码和规则结果都不会将焦点放在该组上，因此它依赖于<code>auto-focus</code>属性是其开火的机会。</p>
</li>
<li>
<p><code>auto-focus true</code>确保此规则虽然是议程组中的唯一规则，但有机会在<code>fireAllRules()</code>从Java代码中调用。</p>
</li>
<li>
<p><code>kcontext…​.setFocus()</code>将重点放在<code>"show items"</code>和<code>"evaluate"</code>议程小组，使其规则得以执行。在实践中，您将按顺序遍历所有项目，将它们插入内存，然后在每次插入后触发其他规则。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>的<code>"show items"</code>议程组仅包含一条规则， <code>"Show Items"</code> 。对于当前在KIE会话工作内存中的订单中的每次购买，该规则基于以下信息将详细信息记录到GUI底部的文本区域中： <code>textArea</code>规则文件中定义的变量。</p>
</div>
<div class="listingblock">
<div class="title">规则“显示项目”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Show Items"
    agenda-group "show items"
  when
    $order : Order()
    $p : Purchase( order == $order )
  then
   textArea.append( $p.product + "\n");
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>"evaluate"</code>议程小组也从<code>"Explode Cart"</code>规则。该议程组包含两个规则， <code>"Free Fish Food Sample"</code>和<code>"Suggest Tank"</code> ，按该顺序执行。</p>
</div>
<div class="listingblock">
<div class="title">规则“免费鱼类食品样本”</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Free fish food sample when users buy a goldfish if they did not already buy
// fish food and do not already have a fish food sample.
rule "Free Fish Food Sample"
    agenda-group "evaluate" <i class="conum" data-value="1"></i><b>(1)</b>
  when
    $order : Order()
    not ( $p : Product( name == "Fish Food") &amp;&amp; Purchase( product == $p ) ) <i class="conum" data-value="2"></i><b>(2)</b>
    not ( $p : Product( name == "Fish Food Sample") &amp;&amp; Purchase( product == $p ) ) <i class="conum" data-value="3"></i><b>(3)</b>
    exists ( $p : Product( name == "Gold Fish") &amp;&amp; Purchase( product == $p ) ) <i class="conum" data-value="4"></i><b>(4)</b>
    $fishFoodSample : Product( name == "Fish Food Sample" );
  then
    System.out.println( "Adding free Fish Food Sample to cart" );
    purchase = new Purchase($order, $fishFoodSample);
    insert( purchase );
    $order.addItem( purchase );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>规则<code>"Free Fish Food Sample"</code>仅在满足以下所有条件时才触发：</p>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>议程小组<code>"evaluate"</code>正在规则执行中进行评估。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>用户还没有鱼食。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i> <b>3</b></td>
<td>用户还没有免费的鱼类食品样品。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i> <b>4</b></td>
<td>用户在订单中有一条金鱼。</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>如果订单事实满足所有这些要求，那么将创建一个新产品（鱼类食品样本）并将其添加到工作存储器中的订单中。</p>
</div>
<div class="listingblock">
<div class="title">规则“建议坦克”</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Suggest a fish tank if users buy more than five goldfish and
// do not already have a tank.
rule "Suggest Tank"
    agenda-group "evaluate"
  when
    $order : Order()
    not ( $p : Product( name == "Fish Tank") &amp;&amp; Purchase( product == $p ) ) <i class="conum" data-value="1"></i><b>(1)</b>
    ArrayList( $total : size &gt; 5 ) from collect( Purchase( product.name == "Gold Fish" ) ) <i class="conum" data-value="2"></i><b>(2)</b>
    $fishTank : Product( name == "Fish Tank" )
  then
    requireTank(frame, kcontext.getKieRuntime(), $order, $fishTank, $total);
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>规则<code>"Suggest Tank"</code>仅在满足以下条件时触发：</p>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>用户没有订单中的鱼缸。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>用户的订单中有5条以上的鱼。</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>规则触发时，它将调用<code>requireTank()</code>规则文件中定义的功能。此功能显示一个对话框，询问用户是否要购买鱼缸。如果用户这样做，则换一个新的鱼缸<code>Product</code>被添加到工作存储器中的订单列表中。当规则调用<code>requireTank()</code>功能，规则通过<code>frame</code>全局变量，以便该函数具有Swing GUI的句柄。</p>
</div>
<div class="paragraph">
<p>的<code>"do checkout"</code>宠物店示例中的规则没有议程组，也没有<code>when</code>条件，因此该规则将始终执行并被视为默认规则的一部分<code>MAIN</code>议程小组。</p>
</div>
<div class="listingblock">
<div class="title">规则“结帐”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "do checkout"
  when
  then
    doCheckout(frame, kcontext.getKieRuntime());
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>规则触发时，它将调用<code>doCheckout()</code>规则文件中定义的功能。此功能显示一个对话框，询问用户是否要签出。如果用户这样做，则将焦点设置为<code>checkout</code>议程组，从而启用该组中的规则（可能）触发。当规则调用<code>doCheckout()</code>功能，规则通过<code>frame</code>全局变量，以便该函数具有Swing GUI的句柄。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">如果无法按预期执行结果，此示例还演示了一种故障排除技术：您可以从<code>when</code>陈述规则并在<code>then</code>验证操作是否正确执行的语句。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>的<code>"checkout"</code>议程组包含用于处理订单结帐和应用任何折扣的三个规则： <code>"Gross Total"</code> ， <code>"Apply 5% Discount"</code>和<code>"Apply 10% Discount"</code> 。</p>
</div>
<div class="listingblock">
<div class="title">规则“总”，“应用5％折扣”和“应用10％折扣”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Gross Total"
    agenda-group "checkout"
  when
    $order : Order( grossTotal == -1)
    Number( total : doubleValue ) from accumulate( Purchase( $price : product.price ),
                                                              sum( $price ) )
  then
    modify( $order ) { grossTotal = total }
    textArea.append( "\ngross total=" + total + "\n" );
end

rule "Apply 5% Discount"
    agenda-group "checkout"
  when
    $order : Order( grossTotal &gt;= 10 &amp;&amp; &lt; 20 )
  then
    $order.discountedTotal = $order.grossTotal * 0.95;
    textArea.append( "discountedTotal total=" + $order.discountedTotal + "\n" );
end

rule "Apply 10% Discount"
    agenda-group "checkout"
  when
    $order : Order( grossTotal &gt;= 20 )
  then
    $order.discountedTotal = $order.grossTotal * 0.90;
    textArea.append( "discountedTotal total=" + $order.discountedTotal + "\n" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果用户尚未计算出总计，则<code>Gross Total</code>将产品价格累加起来，加到KIE会话中，并通过Swing显示出来<code>JTextArea</code>使用<code>textArea</code>全局变量。</p>
</div>
<div class="paragraph">
<p>如果总数在<code>10</code>和<code>20</code> （货币单位）， <code>"Apply 5% Discount"</code>规则计算折现后的总计，将其添加到KIE会话中，并在文本区域中显示。</p>
</div>
<div class="paragraph">
<p>如果总数不小于<code>20</code> ， <code>"Apply 10% Discount"</code>规则计算折现后的总计，将其添加到KIE会话中，并在文本区域中显示。</p>
</div>
<h4 id="_pet_store_example_execution" class="discrete">宠物店示例执行</h4>
<div class="paragraph">
<p>与其他Drools决策示例类似，您可以通过运行<code>org.drools.examples.petstore.PetStoreExample</code>类在您的IDE中作为Java应用程序。</p>
</div>
<div class="paragraph">
<p>当执行Pet Store示例时， <code>Pet Store Demo</code>出现GUI窗口。该窗口显示可用产品列表（左上方），空白产品列表（右上方），“ <strong>签出”</strong>和“ <strong>重置”</strong>按钮（中间）以及空白系统消息区域（底部）。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/PetStoreExample/1-PetStore-Start-Screen.png" alt="1 PetStore开始屏幕">
</div>
<div class="title">图368。启动后的Pet Store示例GUI</div>
</div>
<div class="paragraph">
<p>在此示例中，发生了以下事件以建立此执行行为：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>的<code>main()</code>方法已运行并加载了规则库，但尚未触发规则。到目前为止，这是与已运行的规则有关的唯一代码。</p>
</li>
<li>
<p>一个新的<code>PetStoreUI</code>对象已创建，并为规则库提供了句柄，以供以后使用。</p>
</li>
<li>
<p>各种Swing组件都已执行其功能，并且显示初始UI屏幕并等待用户输入。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>您可以从列表中单击各种产品以浏览UI设置：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/PetStoreExample/2-stock-added-to-order-list.png" alt="2库存添加到订单清单">
</div>
<div class="title">图369。探索Pet Store示例GUI</div>
</div>
<div class="paragraph">
<p>尚未触发任何规则代码。用户界面使用Swing代码检测用户的鼠标点击并将选定的产品添加到<code>TableModel</code>用于显示在用户界面右上角的对象。此示例说明了模型-视图-控制器设计模式。</p>
</div>
<div class="paragraph">
<p>当您单击<strong>Checkout时</strong> ，将以以下方式触发规则：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>方法<code>CheckOutCallBack.checkout()</code> （最终）由Swing类调用，以等待用户单击<strong>Checkout</strong> 。这将从<code>TableModel</code>对象（UI的右上角）放入KIE会话工作内存中。然后，该方法将触发规则。</p>
</li>
<li>
<p>的<code>"Explode Cart"</code>规则是第一个触发的<code>auto-focus</code>属性设置为<code>true</code> 。该规则循环遍历购物车中的所有产品，确保产品在工作内存中，然后提供<code>"show Items"</code>和<code>"evaluate"</code>议程将解雇选项分组。这些组中的规则将购物车中的内容添加到文本区域（UI的底部），评估您是否有资格获得免费的鱼类食品，并确定是否询问您是否要购买鱼缸。</p>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/PetStoreExample/3-purchase-suggestion.png" alt="3购买建议">
</div>
<div class="title">图370。鱼缸资质</div>
</div>
</li>
<li>
<p>的<code>"do checkout"</code>规则是下一个触发的规则，因为当前没有其他议程组有焦点，并且它是默认规则的一部分<code>MAIN</code>议程小组。此规则始终称为<code>doCheckout()</code>功能，询问您是否要退房。</p>
</li>
<li>
<p>的<code>doCheckout()</code>功能将焦点设置为<code>"checkout"</code>议程组，为该组中的规则提供触发选项。</p>
</li>
<li>
<p>中的规则<code>"checkout"</code>议程组显示购物车中的物品并应用适当的折扣。</p>
</li>
<li>
<p>然后，Swing等待用户输入以选择更多产品（并使规则再次触发）或关闭UI。</p>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/PetStoreExample/4-Petstore-final-screen.png" alt="4 Petstore最终屏幕">
</div>
<div class="title">图371。触发所有规则后，宠物商店示例GUI</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>您可以添加更多<code>System.out</code>在IDE控制台中演示事件流的调用：</p>
</div>
<div class="listingblock">
<div class="title">IDE控制台中的System.out输出</div>
<div class="content">
<pre class="highlightjs highlight"><code>Adding free Fish Food Sample to cart
SUGGESTION: Would you like to buy a tank for your 6 fish? - Yes</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-politician-ref_drools-examples"><a class="anchor" href="#decision-examples-politician-ref_drools-examples"></a> <a class="link" href="#decision-examples-politician-ref_drools-examples">20.8。诚实的政客示例决策（真相维护和显着性）</a></h3>
<div class="paragraph">
<p>诚实的政治家示例决策集演示了逻辑插入和规则中显着性的使用来维护真相的概念。</p>
</div>
<div class="paragraph">
<p>以下是“诚实政客”示例的概述：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>名称</strong> ：<code>honestpolitician</code></p>
</li>
<li>
<p><strong>主班</strong> <code>org.drools.examples.honestpolitician.HonestPoliticianExample</code> （在<code>src/main/java</code> ）</p>
</li>
<li>
<p><strong>模块</strong> ：<code>drools-examples</code></p>
</li>
<li>
<p><strong>类型</strong> ：Java应用程序</p>
</li>
<li>
<p><strong>规则文件</strong> ： <code>org.drools.examples.honestpolitician.HonestPolitician.drl</code> （在<code>src/main/resources</code> ）</p>
</li>
<li>
<p><strong>目标</strong> ：基于事实的逻辑插入和规则中显着性的使用，说明真相维护的概念</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>诚实政客示例的基本前提是，只有在陈述为真时，对象才能存在。规则结果可以在逻辑上插入带有<code>insertLogical()</code>方法。这意味着只要在逻辑上插入该对象的规则保持为真，该对象就会保留在KIE会话工作内存中。当规则不再成立时，对象将自动缩回。</p>
</div>
<div class="paragraph">
<p>在此示例中，规则执行导致一群政客由于腐败的公司而从诚实变为不诚实。在评估每个政治人物时，他们首先将其诚实属性设置为<code>true</code> ，但有一条规则开火，使政治人物不再诚实。当他们将自己的状态从诚实变为不诚实时，他们便从工作记忆中移出。规则显着性通知Drools引擎如何优先处理已为其定义显着性的任何规则，否则使用默认显着性值。 <code>0</code> 。在激活队列中排序时，具有较高显着性值的规则将具有较高的优先级。</p>
</div>
<h4 id="_politician_and_hope_classes" class="discrete">政客和希望班</h4>
<div class="paragraph">
<p>样品课<code>Politician</code>在示例中，是为诚实的政客配置的。的<code>Politician</code>类由String项组成<code>name</code>和一个布尔项<code>honest</code> ：</p>
</div>
<div class="listingblock">
<div class="title">政客阶层</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Politician {
    private String name;
    private boolean honest;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>Hope</code>类确定是否<code>Hope</code>对象存在。这个班级没有有意义的成员，但是只要社会有希望，它就会出现在工作记忆中。</p>
</div>
<div class="listingblock">
<div class="title">希望班</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Hope {

    public Hope() {

    }
  }</code></pre>
</div>
</div>
<h4 id="_rule_definitions_for_politician_honesty" class="discrete">政治家诚实的规则定义</h4>
<div class="paragraph">
<p>以诚实的政治家为例，当工作记忆中至少存在一名诚实的政治家时， <code>"We have an honest Politician"</code>规则在逻辑上插入新<code>Hope</code>宾语。一旦所有政客变得不诚实， <code>Hope</code>对象会自动缩回。这个规则有一个<code>salience</code>值为的属性<code>10</code>确保它在其他任何规则之前触发，因为在此阶段<code>"Hope is Dead"</code>规则是真的。</p>
</div>
<div class="listingblock">
<div class="title">规则“我们有一个诚实的政治家”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "We have an honest Politician"
    salience 10
  when
    exists( Politician( honest == true ) )
  then
    insertLogical( new Hope() );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>尽快<code>Hope</code>对象存在， <code>"Hope Lives"</code>规则匹配并触发。这个规则也有一个<code>salience</code>的价值<code>10</code>因此它优先于<code>"Corrupt the Honest"</code>规则。</p>
</div>
<div class="listingblock">
<div class="title">规则“希望生活”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Hope Lives"
    salience 10
  when
    exists( Hope() )
  then
    System.out.println("Hurrah!!! Democracy Lives");
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>最初，有四个诚实的政客，所以该规则有四个激活点，所有这些都处于冲突中。每条规则依次触发，破坏每位政治人物，使他们不再诚实。当所有四个政治人物都腐败时，没有任何政治人物拥有财产<code>honest == true</code> 。规则<code>"We have an honest Politician"</code>不再为true以及逻辑上插入的对象（由于最后执行<code>new Hope()</code> ）会自动缩回。</p>
</div>
<div class="listingblock">
<div class="title">规则“廉洁”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Corrupt the Honest"
  when
    politician : Politician( honest == true )
    exists( Hope() )
  then
    System.out.println( "I'm an evil corporation and I have corrupted " + politician.getName() );
    modify ( politician ) { honest = false };
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>随着<code>Hope</code>对象通过真相维护系统自动撤回，条件元素<code>not</code>应用于<code>Hope</code>不再是真实的，因此<code>"Hope is Dead"</code>规则匹配并触发。</p>
</div>
<div class="listingblock">
<div class="title">规则“希望已死”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Hope is Dead"
  when
    not( Hope() )
  then
    System.out.println( "We are all Doomed!!! Democracy is Dead" );
end</code></pre>
</div>
</div>
<h4 id="_example_execution_and_audit_trail" class="discrete">执行和审计跟踪示例</h4>
<div class="paragraph">
<p>在里面<code>HonestPoliticianExample.java</code>上课时，四位政客的诚实状态<code>true</code>插入以根据定义的业务规则进行评估：</p>
</div>
<div class="listingblock">
<div class="title">HonestPoliticianExample.java类执行</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static void execute( KieContainer kc ) {
        KieSession ksession = kc.newKieSession("HonestPoliticianKS");

        final Politician p1 = new Politician( "President of Umpa Lumpa", true );
        final Politician p2 = new Politician( "Prime Minster of Cheeseland", true );
        final Politician p3 = new Politician( "Tsar of Pringapopaloo", true );
        final Politician p4 = new Politician( "Omnipotence Om", true );

        ksession.insert( p1 );
        ksession.insert( p2 );
        ksession.insert( p3 );
        ksession.insert( p4 );

        ksession.fireAllRules();

        ksession.dispose();
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>要执行示例，请运行<code>org.drools.examples.honestpolitician.HonestPoliticianExample</code>类在您的IDE中作为Java应用程序。</p>
</div>
<div class="paragraph">
<p>执行之后，IDE控制台窗口中将显示以下输出：</p>
</div>
<div class="listingblock">
<div class="title">IDE控制台中的执行输出</div>
<div class="content">
<pre class="highlightjs highlight"><code>Hurrah!!! Democracy Lives
I'm an evil corporation and I have corrupted President of Umpa Lumpa
I'm an evil corporation and I have corrupted Prime Minster of Cheeseland
I'm an evil corporation and I have corrupted Tsar of Pringapopaloo
I'm an evil corporation and I have corrupted Omnipotence Om
We are all Doomed!!! Democracy is Dead</code></pre>
</div>
</div>
<div class="paragraph">
<p>输出显示，尽管至少有一位诚实的政治家，但民主仍然存在。但是，由于每个政客都被某个公司腐败，所有政客变得不诚实，民主也因此消亡。</p>
</div>
<div class="paragraph">
<p>为了更好地理解此示例的执行流程，您可以修改<code>HonestPoliticianExample.java</code>类包括<code>DebugRuleRuntimeEventListener</code>侦听器和审核记录器以查看执行详细信息：</p>
</div>
<div class="listingblock">
<div class="title">带有审计记录器的HonestPoliticianExample.java类</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.drools.examples.honestpolitician;

import org.kie.api.KieServices;
import org.kie.api.event.rule.DebugAgendaEventListener; <i class="conum" data-value="1"></i><b>(1)</b>
import org.kie.api.event.rule.DebugRuleRuntimeEventListener;
import org.kie.api.runtime.KieContainer;
import org.kie.api.runtime.KieSession;

public class HonestPoliticianExample {

    /**
     * @param args
     */
    public static void main(final String[] args) {
    	KieServices ks = KieServices.Factory.get(); <i class="conum" data-value="2"></i><b>(2)</b>
    	//ks = KieServices.Factory.get();
        KieContainer kc = KieServices.Factory.get().getKieClasspathContainer();
        System.out.println(kc.verify().getMessages().toString());
        //execute( kc );
        execute( ks, kc); <i class="conum" data-value="3"></i><b>(3)</b>
    }

    public static void execute( KieServices ks, KieContainer kc ) { <i class="conum" data-value="4"></i><b>(4)</b>
        KieSession ksession = kc.newKieSession("HonestPoliticianKS");

        final Politician p1 = new Politician( "President of Umpa Lumpa", true );
        final Politician p2 = new Politician( "Prime Minster of Cheeseland", true );
        final Politician p3 = new Politician( "Tsar of Pringapopaloo", true );
        final Politician p4 = new Politician( "Omnipotence Om", true );

        ksession.insert( p1 );
        ksession.insert( p2 );
        ksession.insert( p3 );
        ksession.insert( p4 );

        // The application can also setup listeners <i class="conum" data-value="5"></i><b>(5)</b>
        ksession.addEventListener( new DebugAgendaEventListener() );
        ksession.addEventListener( new DebugRuleRuntimeEventListener() );

        // Set up a file-based audit logger.
        ks.getLoggers().newFileLogger( ksession, "./target/honestpolitician" ); <i class="conum" data-value="6"></i><b>(6)</b>

        ksession.fireAllRules();

        ksession.dispose();
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>将处理以下内容的软件包添加到您的导入中： <code>DebugAgendaEventListener</code>和<code>DebugRuleRuntimeEventListener</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>创建一个<code>KieServices Factory</code>和一个<code>ks</code>元素来生成日志，因为该审核日志在<code>KieContainer</code>水平</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i> <b>3</b></td>
<td>修改<code>execute</code>同时使用的方法<code>KieServices</code>和<code>KieContainer</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i> <b>4</b></td>
<td>修改<code>execute</code>传递方法<code>KieServices</code>除了<code>KieContainer</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i> <b>5</b></td>
<td>创建听众</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i> <b>6</b></td>
<td>执行规则后，生成可传递到调试视图或<strong>审核视图</strong>或IDE中的日志</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>当您使用此修改后的日志记录功能运行“诚实政治家”时，可以从以下位置加载审核日志文件： <code>target/honestpolitician.log</code>进入IDE调试视图或<strong>Audit View</strong> （如果可用）（例如，在某些IDE的“ <strong>窗口”</strong> →“ <strong>显示视图”</strong>中）。</p>
</div>
<div class="paragraph">
<p>在此示例中， <strong>审核视图</strong>显示了示例类和规则中定义的执行，插入和撤回的流程：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/HonestPoliticianExample/honest_politician_audit.png" alt="诚实的政客审计">
</div>
<div class="title">图372。诚实的政客示例审计视图</div>
</div>
<div class="paragraph">
<p>插入第一个政治人物时，会发生两次激活。规则<code>"We have an honest Politician"</code>第一个插入的政治人物仅被激活一次，因为它使用<code>exists</code>条件元素，当插入至少一位政治人物时匹配。规则<code>"Hope is Dead"</code>在此阶段也被激活，因为<code>Hope</code>尚未插入对象。规则<code>"We have an honest Politician"</code>首先触发，因为它具有更高的<code>salience</code>比规则有价值<code>"Hope is Dead"</code> ，并插入<code>Hope</code>对象（以绿色突出显示）。的插入<code>Hope</code>对象激活规则<code>"Hope Lives"</code>并停用规则<code>"Hope is Dead"</code> 。插入也激活规则<code>"Corrupt the Honest"</code>对于每个插入的诚实政客。规则<code>"Hope Lives"</code>执行并打印<code>"Hurrah!!! Democracy Lives"</code> 。</p>
</div>
<div class="paragraph">
<p>接下来，对于每个政治人物，规则<code>"Corrupt the Honest"</code>火灾，印刷<code>"I’m an evil corporation and I have corrupted X"</code> ，在哪里<code>X</code>是政治家的名字，并将政治家的诚实价值修改为<code>false</code> 。当最后一个诚实的政治家遭到破坏时， <code>Hope</code>会由真理维护系统自动收回（以蓝色突出显示）。绿色突出显示区域显示了当前选中的蓝色突出显示区域的来源。之后<code>Hope</code>事实已经撤消，规则<code>"Hope is dead"</code>火灾，印刷<code>"We are all Doomed!!! Democracy is Dead"</code> 。</p>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-sudoku-ref_drools-examples"><a class="anchor" href="#decision-examples-sudoku-ref_drools-examples"></a> <a class="link" href="#decision-examples-sudoku-ref_drools-examples">20.9。Sudoku示例决策（复杂模式匹配，回调和GUI集成）</a></h3>
<div class="paragraph">
<p>基于流行数谜Sudoku的Sudoku示例决策集演示了如何使用Drools中的规则基于各种约束在较大的潜在解决方案空间中找到解决方案。此示例还显示了如何将Drools规则集成到图形用户界面（GUI）（在这种情况下为基于Swing的桌面应用程序）中，以及如何使用回调与正在运行的Drools引擎进行交互以根据工作中的更改来更新GUI运行时内存。</p>
</div>
<div class="paragraph">
<p>以下是Sudoku示例的概述：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>名称</strong> ：<code>sudoku</code></p>
</li>
<li>
<p><strong>主班</strong> <code>org.drools.examples.sudoku.SudokuExample</code> （在<code>src/main/java</code> ）</p>
</li>
<li>
<p><strong>模块</strong> ：<code>drools-examples</code></p>
</li>
<li>
<p><strong>类型</strong> ：Java应用程序</p>
</li>
<li>
<p><strong>规则文件</strong> ： <code>org.drools.examples.sudoku.*.drl</code> （在<code>src/main/resources</code> ）</p>
</li>
<li>
<p><strong>目标</strong> ：演示复杂的模式匹配，问题解决，回调和GUI集成</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>数独是一个基于逻辑的数字放置难题。目的是填充9x9的网格，以便每一列，每一行以及9个3x3区域中的每一个仅包含一次从1到9的数字。拼图设置器提供了部分完成的网格，拼图求解器的任务是在这些约束条件下完成网格。</p>
</div>
<div class="paragraph">
<p>解决此问题的一般策略是确保插入新数字时，该数字在其特定的3x3区域，行和列中必须是唯一的。此Sudoku示例决策集使用Drools规则从各种难度级别解决Sudoku难题，并尝试解决包含无效条目的有缺陷的难题。</p>
</div>
<h4 id="_sudoku_example_execution_and_interaction" class="discrete">Sudoku示例执行和交互</h4>
<div class="paragraph">
<p>与其他Drools决策示例类似，您可以通过运行<code>org.drools.examples.sudoku.SudokuExample</code>类在您的IDE中作为Java应用程序。</p>
</div>
<div class="paragraph">
<p>执行数独示例时， <code>Drools Sudoku Example</code>出现GUI窗口。该窗口包含一个空网格，但是程序附带了内部存储的各种网格，您可以加载和求解这些网格。</p>
</div>
<div class="paragraph">
<p>单击<strong>文件</strong> → <strong>示例</strong> → <strong>简单</strong>以加载示例之一。请注意，在加载网格之前，所有按钮都被禁用。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/SudokuExample/sudoku1.png" alt="数独1">
</div>
<div class="title">图373。启动后的数独示例GUI</div>
</div>
<div class="paragraph">
<p>加载“ <strong>简单”</strong>示例时，将根据拼图的初始状态填充网格。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/SudokuExample/sudoku2.png" alt="数独2">
</div>
<div class="title">图374。加载简单样本后的数独示例GUI</div>
</div>
<div class="paragraph">
<p>从以下选项中选择：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>单击“ <strong>求解”</strong>以触发Sudoku示例中定义的规则，这些规则将填充剩余值并使按钮再次变为非活动状态。</p>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/SudokuExample/sudoku3.png" alt="数独3">
</div>
<div class="title">图375。简单样品解决</div>
</div>
</li>
<li>
<p>单击“ <strong>步骤”</strong>以查看规则集找到的下一个数字。IDE中的控制台窗口显示有关正在解决该步骤的规则的详细信息。</p>
<div class="listingblock">
<div class="title">IDE控制台中的步骤执行输出</div>
<div class="content">
<pre>single 8 at [0,1]
column elimination due to [1,2]: remove 9 from [4,2]
hidden single 9 at [1,2]
row elimination due to [2,8]: remove 7 from [2,4]
remove 6 from [3,8] due to naked pair at [3,2] and [3,7]
hidden pair in row at [4,6] and [4,4]</pre>
</div>
</div>
</li>
<li>
<p>单击“ <strong>转储”</strong>以查看网格的状态，其中的单元格将显示既定值或剩余可能性。</p>
<div class="listingblock">
<div class="title">在IDE控制台中转储执行输出</div>
<div class="content">
<pre>        Col: 0     Col: 1     Col: 2     Col: 3     Col: 4     Col: 5     Col: 6     Col: 7     Col: 8
Row 0:  123456789  --- 5 ---  --- 6 ---  --- 8 ---  123456789  --- 1 ---  --- 9 ---  --- 4 ---  123456789
Row 1:  --- 9 ---  123456789  123456789  --- 6 ---  123456789  --- 5 ---  123456789  123456789  --- 3 ---
Row 2:  --- 7 ---  123456789  123456789  --- 4 ---  --- 9 ---  --- 3 ---  123456789  123456789  --- 8 ---
Row 3:  --- 8 ---  --- 9 ---  --- 7 ---  123456789  --- 4 ---  123456789  --- 6 ---  --- 3 ---  --- 5 ---
Row 4:  123456789  123456789  --- 3 ---  --- 9 ---  123456789  --- 6 ---  --- 8 ---  123456789  123456789
Row 5:  --- 4 ---  --- 6 ---  --- 5 ---  123456789  --- 8 ---  123456789  --- 2 ---  --- 9 ---  --- 1 ---
Row 6:  --- 5 ---  123456789  123456789  --- 2 ---  --- 6 ---  --- 9 ---  123456789  123456789  --- 7 ---
Row 7:  --- 6 ---  123456789  123456789  --- 5 ---  123456789  --- 4 ---  123456789  123456789  --- 9 ---
Row 8:  123456789  --- 4 ---  --- 9 ---  --- 7 ---  123456789  --- 8 ---  --- 3 ---  --- 5 ---  123456789</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sudoku示例包括一个故意损坏的示例文件，示例中定义的规则可以解析该文件。</p>
</div>
<div class="paragraph">
<p>单击<strong>文件</strong> → <strong>样本</strong> → <strong>！故意破碎！</strong> 加载破碎的样品。网格从一些问题开始，例如，值<code>5</code>在第一行中出现两次，这是不允许的。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/SudokuExample/sudoku4.png" alt="数独4">
</div>
<div class="title">图376。断数独示例初始状态</div>
</div>
<div class="paragraph">
<p>单击<strong>求解</strong>将求解规则应用于此无效网格。Sudoku示例中的相关求解规则将检测示例中的问题，并尝试尽可能解决难题。此过程无法完成，并且一些单元格留空。</p>
</div>
<div class="paragraph">
<p>解决规则活动显示在IDE控制台窗口中：</p>
</div>
<div class="listingblock">
<div class="title">在损坏的样本中检测到问题</div>
<div class="content">
<pre>cell [0,8]: 5 has a duplicate in row 0
cell [0,0]: 5 has a duplicate in row 0
cell [6,0]: 8 has a duplicate in col 0
cell [4,0]: 8 has a duplicate in col 0
Validation complete.</pre>
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/SudokuExample/sudoku5.png" alt="数独5">
</div>
<div class="title">图377。样品溶液尝试失败</div>
</div>
<div class="paragraph">
<p>标记为<strong>Hard的</strong> Sudoku示例文件更加复杂，求解规则可能无法解决它们。解决方案尝试失败将显示在IDE控制台窗口中：</p>
</div>
<div class="listingblock">
<div class="title">硬样品未解决</div>
<div class="content">
<pre>Validation complete.
...
Sorry - can't solve this grid.</pre>
</div>
</div>
<div class="paragraph">
<p>用于解决损坏的样本的规则将基于仍是单元格候选值的值集实施标准解决技术。例如，如果一组包含单个值，则这是单元格的值。对于在9个单元格的其中一组中的一个值出现一次的情况，规则将插入一个类型为事实的事实<code>Setting</code>与某些特定单元格的解决方案值。此事实导致该值从该单元格所属的任何组的所有其他单元格中消除，并且该值被收回。</p>
</div>
<div class="paragraph">
<p>示例中的其他规则会减少某些单元格的允许值。规则<code>"naked pair"</code> ， <code>"hidden pair in row"</code> ， <code>"hidden pair in column"</code>和<code>"hidden pair in square"</code>消除可能性，但不建立解决方案。规则<code>"X-wings in rows"</code> ，“列中的X翼”， <code>"intersection removal row"</code>和<code>"intersection removal column"</code>执行更复杂的消除。</p>
</div>
<h4 id="_sudoku_example_classes" class="discrete">数独示例类</h4>
<div class="paragraph">
<p>包装<code>org.drools.examples.sudoku.swing</code>包含以下核心类集，这些类实现了Sudoku拼图的框架：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>的<code>SudokuGridModel</code>类定义一个接口，该接口实现为将Sudoku拼图存储为9x9的网格<code>Cell</code>对象。</p>
</li>
<li>
<p>的<code>SudokuGridView</code>类是一个Swing组件，可以可视化该组件的任何实现<code>SudokuGridModel</code>类。</p>
</li>
<li>
<p>的<code>SudokuGridEvent</code>和<code>SudokuGridListener</code>类在模型和视图之间传递状态更改。解析或更改单元格值时会触发事件。</p>
</li>
<li>
<p>的<code>SudokuGridSamples</code>本课程提供了部分填充的数独谜题，用于演示目的。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">该软件包对Drools库没有任何依赖关系。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>包装<code>org.drools.examples.sudoku</code>包含以下实现基本元素的核心类集<code>Cell</code>对象及其各种聚合：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>的<code>CellFile</code>类，带有子类型<code>CellRow</code> ， <code>CellCol</code>和<code>CellSqr</code> ，所有这些都是<code>CellGroup</code>类。</p>
</li>
<li>
<p>的<code>Cell</code>和<code>CellGroup</code>的子类<code>SetOfNine</code> ，它提供了一个属性<code>free</code>与类型<code>Set<Integer></code> 。为一个<code>Cell</code>类，则该集合代表单个候选集合。为一个<code>CellGroup</code>类别，则该集合是其单元格的所有候选集合（仍需要分配的数字集合）的并集。</p>
<div class="paragraph">
<p>在数独示例中为81 <code>Cell</code>和27 <code>CellGroup</code>对象和由<code>Cell</code>属性<code>cellRow</code> ， <code>cellCol</code>和<code>cellSqr</code> ，并通过<code>CellGroup</code>属性<code>cells</code> （的列表<code>Cell</code>对象）。使用这些组件，您可以编写规则来检测允许将值分配给单元格或从某些候选集中消除值的特定情况。</p>
</div>
</li>
<li>
<p>的<code>Setting</code>类用于触发伴随值分配的操作。一个的存在<code>Setting</code>在检测新情况的所有规则中都使用了事实，以避免对不一致的中间状态做出反应。</p>
</li>
<li>
<p>的<code>Stepping</code>在低优先级规则中使用class来在以下情况下执行紧急停止<code>"Step"</code>不定期终止。此行为表明程序无法解决难题。</p>
</li>
<li>
<p>主班<code>org.drools.examples.sudoku.SudokuExample</code>实现将所有这些组件组合在一起的Java应用程序。</p>
</li>
</ul>
</div>
<h4 id="_sudoku_validation_rules_validate_drl" class="discrete">数独验证规则（validate.drl）</h4>
<div class="paragraph">
<p>的<code>validate.drl</code> Sudoku示例中的文件包含验证规则，该规则可检测单元格组中的重复数字。它们结合在一起<code>"validate"</code>议程组，可在用户加载拼图后显式激活规则。</p>
</div>
<div class="paragraph">
<p>的<code>when</code>这三个规则的条件<code>"duplicate in cell …​"</code>所有功能均通过以下方式发挥作用：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>规则中的第一个条件查找具有分配值的单元格。</p>
</li>
<li>
<p>规则中的第二个条件提取单元所属的三个单元组中的任何一个。</p>
</li>
<li>
<p>最终条件将根据规则在第一个单元格中找到一个值与第一个单元格相同且位于相同行，列或正方形的单元格（第一个单元格除外）。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">规则“在单元格中重复……”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "duplicate in cell row"
  when
    $c: Cell( $v: value != null )
    $cr: CellRow( cells contains $c )
    exists Cell( this != $c, value == $v, cellRow == $cr )
  then
    System.out.println( "cell " + $c.toString() + " has a duplicate in row " + $cr.getNumber() );
end

rule "duplicate in cell col"
  when
    $c: Cell( $v: value != null )
    $cc: CellCol( cells contains $c )
    exists Cell( this != $c, value == $v, cellCol == $cc )
  then
    System.out.println( "cell " + $c.toString() + " has a duplicate in col " + $cc.getNumber() );
end

rule "duplicate in cell sqr"
  when
    $c: Cell( $v: value != null )
    $cs: CellSqr( cells contains $c )
    exists Cell( this != $c, value == $v, cellSqr == $cs )
  then
    System.out.println( "cell " + $c.toString() + " has duplicate in its square of nine." );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>规则<code>"terminate group"</code>是最后一次开火。此规则将打印一条消息并停止序列。</p>
</div>
<div class="listingblock">
<div class="title">规则“终止组”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "terminate group"
    salience -100
  when
  then
    System.out.println( "Validation complete." );
    drools.halt();
end</code></pre>
</div>
</div>
<h4 id="_sudoku_solving_rules_sudoku_drl" class="discrete">数独求解规则（sudoku.drl）</h4>
<div class="paragraph">
<p>的<code>sudoku.drl</code> Sudoku示例中的文件包含三种类型的规则：一组处理分配给单元格的数字，另一组检测可行的分配，第三组从候选集中消除值。</p>
</div>
<div class="paragraph">
<p>规则<code>"set a value"</code> ， <code>"eliminate a value from Cell"</code>和<code>"retract setting"</code>取决于一个<code>Setting</code>宾语。第一条规则处理对单元格的分配以及从中删除值的操作<code>free</code>单元格的三个组的集合。该组还减少了一个计数器，该计数器为零时，将控制权返回给已调用的Java应用程序<code>fireUntilHalt()</code> 。</p>
</div>
<div class="paragraph">
<p>规则的目的<code>"eliminate a value from Cell"</code>是减少与新分配的小区相关的所有小区的候选列表。最后，当所有消除都完成后， <code>"retract setting"</code>收回触发<code>Setting</code>事实。</p>
</div>
<div class="listingblock">
<div class="title">规则“设置值”，“从单元格中消除值”和“撤回设置”</div>
<div class="content">
<pre class="highlightjs highlight"><code>// A Setting object is inserted to define the value of a Cell.
// Rule for updating the cell and all cell groups that contain it
rule "set a value"
  when
    // A Setting with row and column number, and a value
    $s: Setting( $rn: rowNo, $cn: colNo, $v: value )

    // A matching Cell, with no value set
    $c: Cell( rowNo == $rn, colNo == $cn, value == null,
              $cr: cellRow, $cc: cellCol, $cs: cellSqr )

    // Count down
    $ctr: Counter( $count: count )
  then
    // Modify the Cell by setting its value.
    modify( $c ){ setValue( $v ) }
    // System.out.println( "set cell " + $c.toString() );
    modify( $cr ){ blockValue( $v ) }
    modify( $cc ){ blockValue( $v ) }
    modify( $cs ){ blockValue( $v ) }
    modify( $ctr ){ setCount( $count - 1 ) }
end

// Rule for removing a value from all cells that are siblings
// in one of the three cell groups
rule "eliminate a value from Cell"
  when
    // A Setting with row and column number, and a value
    $s: Setting( $rn: rowNo, $cn: colNo, $v: value )

    // The matching Cell, with the value already set
    Cell( rowNo == $rn, colNo == $cn, value == $v, $exCells: exCells )

    // For all Cells that are associated with the updated cell
    $c: Cell( free contains $v ) from $exCells
  then
    // System.out.println( "clear " + $v + " from cell " + $c.posAsString()  );
    // Modify a related Cell by blocking the assigned value.
    modify( $c ){ blockValue( $v ) }
end

// Rule for eliminating the Setting fact
rule "retract setting"
  when
    // A Setting with row and column number, and a value
    $s: Setting( $rn: rowNo, $cn: colNo, $v: value )

    // The matching Cell, with the value already set
    $c: Cell( rowNo == $rn, colNo == $cn, value == $v )

    // This is the negation of the last pattern in the previous rule.
    // Now the Setting fact can be safely retracted.
    not( $x: Cell( free contains $v )
         and
         Cell( this == $c, exCells contains $x ) )
  then
    // System.out.println( "done setting cell " + $c.toString() );
    // Discard the Setter fact.
    delete( $s );
    // Sudoku.sudoku.consistencyCheck();
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>有两个求解规则可以检测可能向单元分配数字的情况。规则<code>"single"</code>开枪<code>Cell</code>包含单个数字的候选集。规则<code>"hidden single"</code>当不存在具有单个候选者的单元时触发，但是当存在包含候选者的单元时，该单元所属的三个组之一中的所有其他单元都不存在该候选。这两个规则都会创建并插入一个<code>Setting</code>事实。</p>
</div>
<div class="listingblock">
<div class="title">规则“单身”和“隐藏单身”</div>
<div class="content">
<pre class="highlightjs highlight"><code>// Detect a set of candidate values with cardinality 1 for some Cell.
// This is the value to be set.
rule "single"
  when
    // Currently no setting underway
    not Setting()

    // One element in the "free" set
    $c: Cell( $rn: rowNo, $cn: colNo, freeCount == 1 )
  then
    Integer i = $c.getFreeValue();
    if (explain) System.out.println( "single " + i + " at " + $c.posAsString() );
    // Insert another Setter fact.
    insert( new Setting( $rn, $cn, i ) );
end

// Detect a set of candidate values with a value that is the only one
// in one of its groups. This is the value to be set.
rule "hidden single"
  when
    // Currently no setting underway
    not Setting()
    not Cell( freeCount == 1 )

    // Some integer
    $i: Integer()

    // The "free" set contains this number
    $c: Cell( $rn: rowNo, $cn: colNo, freeCount &gt; 1, free contains $i )

    // A cell group contains this cell $c.
    $cg: CellGroup( cells contains $c )
    // No other cell from that group contains $i.
    not ( Cell( this != $c, free contains $i ) from $cg.getCells() )
  then
    if (explain) System.out.println( "hidden single " + $i + " at " + $c.posAsString() );
    // Insert another Setter fact.
    insert( new Setting( $rn, $cn, $i ) );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>来自最大组的规则（无论是单独的还是两个或三个的组）都实现了用于手动求解数独难题的各种求解技术。</p>
</div>
<div class="paragraph">
<p>规则<code>"naked pair"</code>检测大小相同的候选集<code>2</code>在一组的两个单元中。可以从该组的所有其他候选集中删除这两个值。</p>
</div>
<div class="listingblock">
<div class="title">规则“裸对”</div>
<div class="content">
<pre class="highlightjs highlight"><code>// A "naked pair" is two cells in some cell group with their sets of
// permissible values being equal with cardinality 2. These two values
// can be removed from all other candidate lists in the group.
rule "naked pair"
  when
    // Currently no setting underway
    not Setting()
    not Cell( freeCount == 1 )

    // One cell with two candidates
    $c1: Cell( freeCount == 2, $f1: free, $r1: cellRow, $rn1: rowNo, $cn1: colNo, $b1: cellSqr )

    // The containing cell group
    $cg: CellGroup( freeCount &gt; 2, cells contains $c1 )

    // Another cell with two candidates, not the one we already have
    $c2: Cell( this != $c1, free == $f1 /*** , rowNo &gt;= $rn1, colNo &gt;= $cn1 ***/ ) from $cg.cells

    // Get one of the "naked pair".
    Integer( $v: intValue ) from $c1.getFree()

    // Get some other cell with a candidate equal to one from the pair.
    $c3: Cell( this != $c1 &amp;&amp; != $c2, freeCount &gt; 1, free contains $v ) from $cg.cells
  then
    if (explain) System.out.println( "remove " + $v + " from " + $c3.posAsString() + " due to naked pair at " + $c1.posAsString() + " and " + $c2.posAsString() );
    // Remove the value.
    modify( $c3 ){ blockValue( $v ) }
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>三个规则<code>"hidden pair in …​"</code>功能类似于规则<code>"naked pair"</code> 。这些规则在一个组的两个单元中检测两个数字的子集，而在该组的任何其他单元中都没有值出现。这意味着所有其他候选对象都可以从包含隐藏对的两个单元中删除。</p>
</div>
<div class="listingblock">
<div class="title">规则“……中的隐藏对”</div>
<div class="content">
<pre class="highlightjs highlight"><code>// If two cells within the same cell group contain candidate sets with more than
// two values, with two values being in both of them but in none of the other
// cells, then we have a "hidden pair". We can remove all other candidates from
// these two cells.
rule "hidden pair in row"
  when
    // Currently no setting underway
    not Setting()
    not Cell( freeCount == 1 )

    // Establish a pair of Integer facts.
    $i1: Integer()
    $i2: Integer( this &gt; $i1 )

    // Look for a Cell with these two among its candidates. (The upper bound on
    // the number of candidates avoids a lot of useless work during startup.)
    $c1: Cell( $rn1: rowNo, $cn1: colNo, freeCount &gt; 2 &amp;&amp; &lt; 9, free contains $i1 &amp;&amp; contains $i2, $cellRow: cellRow )

    // Get another one from the same row, with the same pair among its candidates.
    $c2: Cell( this != $c1, cellRow == $cellRow, freeCount &gt; 2, free contains $i1 &amp;&amp; contains $i2 )

    // Ascertain that no other cell in the group has one of these two values.
    not( Cell( this != $c1 &amp;&amp; != $c2, free contains $i1 || contains $i2 ) from $cellRow.getCells() )
  then
    if( explain) System.out.println( "hidden pair in row at " + $c1.posAsString() + " and " + $c2.posAsString() );
    // Set the candidate lists of these two Cells to the "hidden pair".
    modify( $c1 ){ blockExcept( $i1, $i2 ) }
    modify( $c2 ){ blockExcept( $i1, $i2 ) }
end

rule "hidden pair in column"
  when
    not Setting()
    not Cell( freeCount == 1 )

    $i1: Integer()
    $i2: Integer( this &gt; $i1 )
    $c1: Cell( $rn1: rowNo, $cn1: colNo, freeCount &gt; 2 &amp;&amp; &lt; 9, free contains $i1 &amp;&amp; contains $i2, $cellCol: cellCol )
    $c2: Cell( this != $c1, cellCol == $cellCol, freeCount &gt; 2, free contains $i1 &amp;&amp; contains $i2 )
    not( Cell( this != $c1 &amp;&amp; != $c2, free contains $i1 || contains $i2 ) from $cellCol.getCells() )
  then
    if (explain) System.out.println( "hidden pair in column at " + $c1.posAsString() + " and " + $c2.posAsString() );
    modify( $c1 ){ blockExcept( $i1, $i2 ) }
    modify( $c2 ){ blockExcept( $i1, $i2 ) }
end

rule "hidden pair in square"
  when
    not Setting()
    not Cell( freeCount == 1 )

    $i1: Integer()
    $i2: Integer( this &gt; $i1 )
    $c1: Cell( $rn1: rowNo, $cn1: colNo, freeCount &gt; 2 &amp;&amp; &lt; 9, free contains $i1 &amp;&amp; contains $i2,
               $cellSqr: cellSqr )
    $c2: Cell( this != $c1, cellSqr == $cellSqr, freeCount &gt; 2, free contains $i1 &amp;&amp; contains $i2 )
    not( Cell( this != $c1 &amp;&amp; != $c2, free contains $i1 || contains $i2 ) from $cellSqr.getCells() )
  then
    if (explain) System.out.println( "hidden pair in square " + $c1.posAsString() + " and " + $c2.posAsString() );
    modify( $c1 ){ blockExcept( $i1, $i2 ) }
    modify( $c2 ){ blockExcept( $i1, $i2 ) }
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>有两个规则要处理<code>"X-wings"</code>在行和列中。当两个不同的行（或列）中的每一个中仅存在一个值的两个可能单元，并且这些候选值也位于同一列（或行）中时，则可以消除列（或行）中该值的所有其他候选值。当您遵循这些规则之一中的模式序列时，请注意如何用诸如<code>same</code>要么<code>only</code>导致模式具有适当的约束或带有前缀<code>not</code> 。</p>
</div>
<div class="listingblock">
<div class="title">统治“……的X翼”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "X-wings in rows"
  when
    not Setting()
    not Cell( freeCount == 1 )

    $i: Integer()
    $ca1: Cell( freeCount &gt; 1, free contains $i,
                $ra: cellRow, $rano: rowNo,         $c1: cellCol,        $c1no: colNo )
    $cb1: Cell( freeCount &gt; 1, free contains $i,
                $rb: cellRow, $rbno: rowNo &gt; $rano,      cellCol == $c1 )
    not( Cell( this != $ca1 &amp;&amp; != $cb1, free contains $i ) from $c1.getCells() )

    $ca2: Cell( freeCount &gt; 1, free contains $i,
                cellRow == $ra, $c2: cellCol,       $c2no: colNo &gt; $c1no )
    $cb2: Cell( freeCount &gt; 1, free contains $i,
                cellRow == $rb,      cellCol == $c2 )
    not( Cell( this != $ca2 &amp;&amp; != $cb2, free contains $i ) from $c2.getCells() )

    $cx: Cell( rowNo == $rano || == $rbno, colNo != $c1no &amp;&amp; != $c2no,
               freeCount &gt; 1, free contains $i )
  then
    if (explain) {
        System.out.println( "X-wing with " + $i + " in rows " +
            $ca1.posAsString() + " - " + $cb1.posAsString() +
            $ca2.posAsString() + " - " + $cb2.posAsString() + ", remove from " + $cx.posAsString() );
    }
    modify( $cx ){ blockValue( $i ) }
end

rule "X-wings in columns"
  when
    not Setting()
    not Cell( freeCount == 1 )

    $i: Integer()
    $ca1: Cell( freeCount &gt; 1, free contains $i,
                $c1: cellCol, $c1no: colNo,         $ra: cellRow,        $rano: rowNo )
    $ca2: Cell( freeCount &gt; 1, free contains $i,
                $c2: cellCol, $c2no: colNo &gt; $c1no,      cellRow == $ra )
    not( Cell( this != $ca1 &amp;&amp; != $ca2, free contains $i ) from $ra.getCells() )

    $cb1: Cell( freeCount &gt; 1, free contains $i,
                cellCol == $c1, $rb: cellRow,  $rbno: rowNo &gt; $rano )
    $cb2: Cell( freeCount &gt; 1, free contains $i,
                cellCol == $c2,      cellRow == $rb )
    not( Cell( this != $cb1 &amp;&amp; != $cb2, free contains $i ) from $rb.getCells() )

    $cx: Cell( colNo == $c1no || == $c2no, rowNo != $rano &amp;&amp; != $rbno,
               freeCount &gt; 1, free contains $i )
  then
    if (explain) {
        System.out.println( "X-wing with " + $i + " in columns " +
            $ca1.posAsString() + " - " + $ca2.posAsString() +
            $cb1.posAsString() + " - " + $cb2.posAsString() + ", remove from " + $cx.posAsString()  );
    }
    modify( $cx ){ blockValue( $i ) }
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>这两个规则<code>"intersection removal …​"</code>是基于在一个正方形内单行或单列中某个数字的有限出现。这意味着该数字必须在行或列的两个或三个单元格之一中，并且可以从该组所有其他单元格的候选集中删除。该模式会建立受限事件，然后针对正方形外部和同一单元文件中的每个单元触发。</p>
</div>
<div class="listingblock">
<div class="title">规则“去除交叉口……”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "intersection removal column"
  when
    not Setting()
    not Cell( freeCount == 1 )

    $i: Integer()
    // Occurs in a Cell
    $c: Cell( free contains $i, $cs: cellSqr, $cc: cellCol )
    // Does not occur in another cell of the same square and a different column
    not Cell( this != $c, free contains $i, cellSqr == $cs, cellCol != $cc )

    // A cell exists in the same column and another square containing this value.
    $cx: Cell( freeCount &gt; 1, free contains $i, cellCol == $cc, cellSqr != $cs )
  then
    // Remove the value from that other cell.
    if (explain) {
        System.out.println( "column elimination due to " + $c.posAsString() +
                            ": remove " + $i + " from " + $cx.posAsString() );
    }
    modify( $cx ){ blockValue( $i ) }
end

rule "intersection removal row"
  when
    not Setting()
    not Cell( freeCount == 1 )

    $i: Integer()
    // Occurs in a Cell
    $c: Cell( free contains $i, $cs: cellSqr, $cr: cellRow )
    // Does not occur in another cell of the same square and a different row.
    not Cell( this != $c, free contains $i, cellSqr == $cs, cellRow != $cr )

    // A cell exists in the same row and another square containing this value.
    $cx: Cell( freeCount &gt; 1, free contains $i, cellRow == $cr, cellSqr != $cs )
  then
    // Remove the value from that other cell.
    if (explain) {
        System.out.println( "row elimination due to " + $c.posAsString() +
                            ": remove " + $i + " from " + $cx.posAsString() );
    }
    modify( $cx ){ blockValue( $i ) }
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>这些规则足以满足许多（但不是全部）数独难题。为了解决非常困难的网格，规则集需要更复杂的规则。（最终，有些难题只能通过反复试验才能解决。）</p>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-conway-ref_drools-examples"><a class="anchor" href="#decision-examples-conway-ref_drools-examples"></a> <a class="link" href="#decision-examples-conway-ref_drools-examples">20.10。Conway的“人生游戏”示例决策（规则流组和GUI集成）</a></h3>
<div class="paragraph">
<p>Conway的“生命游戏”示例决策集基于John Conway着名的蜂窝自动机，演示了如何在规则中使用规则流组来控制规则执行。该示例还演示了如何将Drools规则与图形用户界面（GUI）集成在一起，在这种情况下，这是基于Conway的《人生游戏》的基于Swing的实现。</p>
</div>
<div class="paragraph">
<p>以下是Conway的生命游戏（Conway）示例的概述：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>名称</strong> ：<code>conway</code></p>
</li>
<li>
<p><strong>主要课程</strong> ： <code>org.drools.examples.conway.ConwayRuleFlowGroupRun</code> ， <code>org.drools.examples.conway.ConwayAgendaGroupRun</code> （在<code>src/main/java</code> ）</p>
</li>
<li>
<p><strong>模块</strong> ：<code>droolsjbpm-integration-examples</code></p>
</li>
<li>
<p><strong>类型</strong> ：Java应用程序</p>
</li>
<li>
<p><strong>规则文件</strong> ： <code>org.drools.examples.conway.*.drl</code> （在<code>src/main/resources</code> ）</p>
</li>
<li>
<p><strong>目标</strong> ：演示规则流组和GUI集成</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">Conway的“生命游戏”示例与Drools中的大多数其他示例决策集分开，并且位于<a href="https://github.com/kiegroup/droolsjbpm-integration/archive/master.zip">GitHub</a>的Drools和jBPM集成存储库中。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>在Conway的《生活游戏》中，用户通过创建具有定义属性的初始配置或高级模式，然后观察初始状态的演变，来与游戏进行交互。游戏的目的是展示一代又一代人口的发展。基于对所有单元格的同时评估，每一代都是从前一个生成的。</p>
</div>
<div class="paragraph">
<p>以下基本规则支配着下一代：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果一个活动单元中的活动邻居少于两个，它就会死于寂寞。</p>
</li>
<li>
<p>如果一个活细胞有三个以上的活细胞，则死于拥挤。</p>
</li>
<li>
<p>如果一个死细胞正好有三个活着的邻居，那么它就会复活。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>不满足任何这些条件的任何单元将保留给下一代。</p>
</div>
<div class="paragraph">
<p>Conway的“生命游戏”示例将Drools规则与<code>ruleflow-group</code>属性定义游戏中实现的模式。该示例还包含决策集的一个版本，该决策集使用议程组可以实现相同的行为。议程组使您可以对Drools引擎议程进行分区，以提供对规则组的执行控制。默认情况下，所有规则都在议程组中<code>MAIN</code> 。您可以使用<code>agenda-group</code>属性为规则指定其他议程组。</p>
</div>
<div class="paragraph">
<p>本概述未使用议程组探讨Conway示例的版本。有关议程组的更多信息，请参阅专门针对议程组的Drools示例决策集。</p>
</div>
<h4 id="_conway_example_execution_and_interaction" class="discrete">Conway示例执行和交互</h4>
<div class="paragraph">
<p>与其他Drools决策示例类似，您可以通过运行<code>org.drools.examples.conway.ConwayRuleFlowGroupRun</code>类在您的IDE中作为Java应用程序。</p>
</div>
<div class="paragraph">
<p>当您执行Conway示例时， <code>Conway’s Game of Life</code>出现GUI窗口。该窗口包含一个进行生命模拟的空网格或“竞技场”。最初，网格是空的，因为系统中还没有活细胞。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/ConwaysGameOfLifeExample/conway1.png" alt="康威1">
</div>
<div class="title">图378。启动后的Conway示例GUI</div>
</div>
<div class="paragraph">
<p>从“ <strong>模式”</strong>下拉菜单中选择预定义的模式，然后单击<strong>“下一代”</strong>以单击遍历每个种群。每个细胞要么活着要么死了，其中活细胞包含一个绿色的球。当种群从初始模式演变时，根据游戏规则，细胞相对于相邻细胞生存或死亡。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/ConwaysGameOfLifeExample/conway2.png" alt="康威2">
</div>
<div class="title">图379。康威代的进化示例</div>
</div>
<div class="paragraph">
<p>邻居不仅包括左侧，右侧，顶部和底部的单元，还包括对角连接的单元，因此每个单元共有八个邻居。例外是只有三个邻居的角单元，以及沿着四个边界各有五个邻居的单元。</p>
</div>
<div class="paragraph">
<p>您可以通过单击单元格来手动干预以创建或杀死单元格。</p>
</div>
<div class="paragraph">
<p>要从初始模式自动运行演变，请单击<strong>开始</strong> 。</p>
</div>
<h4 id="_conway_example_rules_with_ruleflow_groups" class="discrete">具有Ruleflow组的Conway示例规则</h4>
<div class="paragraph">
<p>中的规则<code>ConwayRuleFlowGroupRun</code>示例使用规则流组来控制规则执行。规则流组是由<code>ruleflow-group</code>规则属性。这些规则仅在激活组后才能触发。仅当规则流图的详细说明到达代表该组的节点时，该组本身才能变为活动状态。</p>
</div>
<div class="paragraph">
<p>Conway示例对规则使用以下规则流组：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"register neighbor"</code></p>
</li>
<li>
<p><code>"evaluate"</code></p>
</li>
<li>
<p><code>"calculate"</code></p>
</li>
<li>
<p><code>"reset calculate"</code></p>
</li>
<li>
<p><code>"birth"</code></p>
</li>
<li>
<p><code>"kill"</code></p>
</li>
<li>
<p><code>"kill all"</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>全部<code>Cell</code>对象被插入到KIE会话中，并且<code>"register …​"</code>规则流组中的规则<code>"register neighbor"</code>可以由Ruleflow流程执行。这四个规则组创建<code>Neighbor</code>某个单元与其东北，北部，西北和西部邻居之间的关系。</p>
</div>
<div class="paragraph">
<p>该关系是双向的，并处理其他四个方向。边界细胞不需要任何特殊处理。这些小区不与没有小区的相邻小区配对。</p>
</div>
<div class="paragraph">
<p>到所有激活均已激活这些规则时，所有单元格都与其所有相邻单元格相关。</p>
</div>
<div class="listingblock">
<div class="title">规则“注册……”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "register north east"
    ruleflow-group "register neighbor"
  when
    $cell: Cell( $row : row, $col : col )
    $northEast : Cell( row  == ($row - 1), col == ( $col + 1 ) )
  then
    insert( new Neighbor( $cell, $northEast ) );
    insert( new Neighbor( $northEast, $cell ) );
end

rule "register north"
    ruleflow-group "register neighbor"
  when
    $cell: Cell( $row : row, $col : col )
    $north : Cell( row  == ($row - 1), col == $col )
  then
    insert( new Neighbor( $cell, $north ) );
    insert( new Neighbor( $north, $cell ) );
end

rule "register north west"
    ruleflow-group "register neighbor"
  when
    $cell: Cell( $row : row, $col : col )
    $northWest : Cell( row  == ($row - 1), col == ( $col - 1 ) )
  then
    insert( new Neighbor( $cell, $northWest ) );
    insert( new Neighbor( $northWest, $cell ) );
end

rule "register west"
    ruleflow-group "register neighbor"
  when
    $cell: Cell( $row : row, $col : col )
    $west : Cell( row  == $row, col == ( $col - 1 ) )
  then
    insert( new Neighbor( $cell, $west ) );
    insert( new Neighbor( $west, $cell ) );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>插入所有单元格后，一些Java代码将模式应用于网格，将某些单元格设置为<code>Live</code> 。然后，当用户单击<strong>Start</strong>或<strong>Next Generation时</strong> ，示例将执行<code>Generation</code>规则流。此规则流管理每个生成周期中单元的所有更改。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/ConwaysGameOfLifeExample/conway_ruleflow_generation.png" alt="康威规则流生成">
</div>
<div class="title">图380。生成规则流</div>
</div>
<div class="paragraph">
<p>规则流过程进入<code>"evaluate"</code> Ruleflow组以及该组中的所有活动规则都可以触发。规则<code>"Kill the …​"</code>和<code>"Give Birth"</code>在这个小组中，将游戏规则应用于出生或杀死细胞。该示例使用<code>phase</code>属性来驱动推理<code>Cell</code>按特定规则组反对。通常，阶段与规则流流程定义中的规则流组相关。</p>
</div>
<div class="paragraph">
<p>请注意，该示例不会更改任何状态<code>Cell</code>因为此时必须先完成完整的评估，然后才能应用这些更改。该示例将单元格设置为<code>phase</code>那就是<code>Phase.KILL</code>要么<code>Phase.BIRTH</code> ，稍后将用于控制应用于<code>Cell</code>宾语。</p>
</div>
<div class="listingblock">
<div class="title">规则“杀死……”和“生育”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Kill The Lonely"
    ruleflow-group "evaluate"
    no-loop
  when
    // A live cell has fewer than 2 live neighbors.
    theCell: Cell( liveNeighbors &lt; 2, cellState == CellState.LIVE,
                   phase == Phase.EVALUATE )
  then
    modify( theCell ){
        setPhase( Phase.KILL );
    }
end

rule "Kill The Overcrowded"
    ruleflow-group "evaluate"
    no-loop
  when
    // A live cell has more than 3 live neighbors.
    theCell: Cell( liveNeighbors &gt; 3, cellState == CellState.LIVE,
                   phase == Phase.EVALUATE )
  then
    modify( theCell ){
        setPhase( Phase.KILL );
    }
end

rule "Give Birth"
    ruleflow-group "evaluate"
    no-loop
  when
    // A dead cell has 3 live neighbors.
    theCell: Cell( liveNeighbors == 3, cellState == CellState.DEAD,
                   phase == Phase.EVALUATE )
  then
    modify( theCell ){
        theCell.setPhase( Phase.BIRTH );
    }
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>毕竟<code>Cell</code>网格中的对象已被评估，该示例使用<code>"reset calculate"</code>规则以清除<code>"calculate"</code>规则流组。然后，该示例在规则流中输入一个拆分，以启用规则<code>"kill"</code>和<code>"birth"</code>如果激活了规则流组则触发。这些规则适用于状态更改。</p>
</div>
<div class="listingblock">
<div class="title">规则“重置计算”，“杀死”和“出生”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "reset calculate"
    ruleflow-group "reset calculate"
  when
  then
    WorkingMemory wm = drools.getWorkingMemory();
    wm.clearRuleFlowGroup( "calculate" );
end

rule "kill"
    ruleflow-group "kill"
    no-loop
  when
    theCell: Cell( phase == Phase.KILL )
  then
    modify( theCell ){
        setCellState( CellState.DEAD ),
        setPhase( Phase.DONE );
    }
end

rule "birth"
    ruleflow-group "birth"
    no-loop
  when
    theCell: Cell( phase == Phase.BIRTH )
  then
    modify( theCell ){
        setCellState( CellState.LIVE ),
        setPhase( Phase.DONE );
    }
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个阶段， <code>Cell</code>对象已被修改，状态更改为<code>LIVE</code>要么<code>DEAD</code> 。当一个单元变为活动状态或死亡状态时，该示例使用<code>Neighbor</code>规则中的关系<code>"Calculate …​"</code>遍历所有周围的细胞，增加或减少<code>liveNeighbor</code>计数。计数已更改的任何单元也将设置为<code>EVALUATE</code>阶段，以确保在规则流流程的评估阶段将其包括在推理中。</p>
</div>
<div class="paragraph">
<p>确定并设置所有单元的实时计数后，规则流过程结束。如果用户最初单击“ <strong>开始”</strong> ，则Drools引擎将在此时重新启动规则流。如果用户最初单击<strong>“下一代”</strong> ，则用户可以请求另一代。</p>
</div>
<div class="listingblock">
<div class="title">规则“计算……”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "Calculate Live"
    ruleflow-group "calculate"
    lock-on-active
  when
    theCell: Cell( cellState == CellState.LIVE )
    Neighbor( cell == theCell, $neighbor : neighbor )
  then
    modify( $neighbor ){
        setLiveNeighbors( $neighbor.getLiveNeighbors() + 1 ),
        setPhase( Phase.EVALUATE );
    }
end

rule "Calculate Dead"
    ruleflow-group "calculate"
    lock-on-active
  when
    theCell: Cell( cellState == CellState.DEAD )
    Neighbor( cell == theCell, $neighbor : neighbor )
  then
    modify( $neighbor ){
        setLiveNeighbors( $neighbor.getLiveNeighbors() - 1 ),
        setPhase( Phase.EVALUATE );
    }
end</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="decision-examples-doom-ref_drools-examples"><a class="anchor" href="#decision-examples-doom-ref_drools-examples"></a> <a class="link" href="#decision-examples-doom-ref_drools-examples">20.11。厄运之家示例决策（向后链接和递归）</a></h3>
<div class="paragraph">
<p>“厄运之屋”示例决策集演示了Drools引擎如何使用向后链接和递归来达到分层系统中定义的目标或子目标。</p>
</div>
<div class="paragraph">
<p>以下是《毁灭之屋》示例的概述：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>名称</strong> ：<code>backwardchaining</code></p>
</li>
<li>
<p><strong>主班</strong> <code>org.drools.examples.backwardchaining.HouseOfDoomMain</code> （在<code>src/main/java</code> ）</p>
</li>
<li>
<p><strong>模块</strong> ：<code>drools-examples</code></p>
</li>
<li>
<p><strong>类型</strong> ：Java应用程序</p>
</li>
<li>
<p><strong>规则文件</strong> ： <code>org.drools.examples.backwardchaining.BC-Example.drl</code> （在<code>src/main/resources</code> ）</p>
</li>
<li>
<p><strong>目标</strong> ：演示反向链接和递归</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>反向链接规则系统是一种目标驱动的系统，其开头是Drools引擎尝试使用递归来满足的结论。如果系统无法达到结论或目标，它将搜索子目标，即完成当前目标一部分的结论。系统继续此过程，直到满足初始结论或满足所有子目标为止。</p>
</div>
<div class="paragraph">
<p>相反，前向链接规则系统是一种数据驱动的系统，其始于Drools引擎的工作内存中的一个事实，并对该事实的更改做出反应。将对象插入工作存储器后，所有因更改而变为真的规则条件都将安排在议程中执行。</p>
</div>
<div class="paragraph">
<p>Drools中的Drools引擎同时使用向前和向后链接来评估规则。</p>
</div>
<div class="paragraph">
<p>下图说明了Drools引擎如何使用整体前向链接和逻辑流程中的后向链接段来评估规则：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/BackwardChaining/RuleEvaluation.png" alt="规则评估">
</div>
<div class="title">图381。使用向前和向后链接的规则评估逻辑</div>
</div>
<div class="paragraph">
<p>“厄运之屋”示例使用具有各种查询类型的规则来查找房屋和房间在房屋中的位置。样品课<code>Location.java</code>包含<code>item</code>和<code>location</code>示例中使用的元素。样品课<code>HouseOfDoomMain.java</code>将物品或房间插入房屋中它们各自的位置并执行规则。</p>
</div>
<div class="listingblock">
<div class="title">HouseOfDoomMain.java类中的项目和位置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.insert( new Location("Office", "House") );
ksession.insert( new Location("Kitchen", "House") );
ksession.insert( new Location("Knife", "Kitchen") );
ksession.insert( new Location("Cheese", "Kitchen") );
ksession.insert( new Location("Desk", "Office") );
ksession.insert( new Location("Chair", "Office") );
ksession.insert( new Location("Computer", "Desk") );
ksession.insert( new Location("Drawer", "Desk") );</code></pre>
</div>
</div>
<div class="paragraph">
<p>示例规则依赖于反向链接和递归来确定房屋结构中所有项目和房间的位置。</p>
</div>
<div class="paragraph">
<p>下图说明了厄运之屋的结构以及其中的物品和房间：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Examples/BackwardChaining/TransitiveReasoning.png" alt="传递推理">
</div>
<div class="title">图382。厄运之屋结构</div>
</div>
<div class="paragraph">
<p>要执行示例，请运行<code>org.drools.examples.backwardchaining.HouseOfDoomMain</code>类在您的IDE中作为Java应用程序。</p>
</div>
<div class="paragraph">
<p>执行之后，IDE控制台窗口中将显示以下输出：</p>
</div>
<div class="listingblock">
<div class="title">IDE控制台中的执行输出</div>
<div class="content">
<pre class="highlightjs highlight"><code>go1
Office is in the House
---
go2
Drawer is in the House
---
go3
---
Key is in the Office
---
go4
Chair is in the Office
Desk is in the Office
Key is in the Office
Computer is in the Office
Drawer is in the Office
---
go5
Chair is in Office
Desk is in Office
Drawer is in Desk
Key is in Drawer
Kitchen is in House
Cheese is in Kitchen
Knife is in Kitchen
Computer is in Desk
Office is in House
Key is in Office
Drawer is in House
Computer is in House
Key is in House
Desk is in House
Chair is in House
Knife is in House
Cheese is in House
Computer is in Office
Drawer is in Office
Key is in Desk</code></pre>
</div>
</div>
<div class="paragraph">
<p>示例中的所有规则均已触发，以检测房屋中所有物品的位置并在输出中打印每个物品的位置。</p>
</div>
<h4 id="_recursive_query_and_related_rules" class="discrete">递归查询和相关规则</h4>
<div class="paragraph">
<p>递归查询反复在数据结构的层次结构中搜索元素之间的关系。</p>
</div>
<div class="paragraph">
<p>以《毁灭之屋》为例， <code>BC-Example.drl</code>文件包含一个<code>isContainedIn</code>查询示例中的大多数规则用于递归评估插入Drools引擎的数据的房屋数据结构：</p>
</div>
<div class="listingblock">
<div class="title">BC-Example.drl中的递归查询</div>
<div class="content">
<pre class="highlightjs highlight"><code>query isContainedIn( String x, String y )
  Location( x, y; )
  or
  ( Location( z, y; ) and isContainedIn( x, z; ) )
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>规则<code>"go"</code>打印插入到系统中的每个字符串，以确定如何实施项目以及规则<code>"go1"</code>调用查询<code>isContainedIn</code> ：</p>
</div>
<div class="listingblock">
<div class="title">规则“ go”和“ go1”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "go" salience 10
  when
    $s : String()
  then
    System.out.println( $s );
end

rule "go1"
  when
    String( this == "go1" )
    isContainedIn("Office", "House"; )
  then
    System.out.println( "Office is in the House" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>该示例插入<code>"go1"</code>串入Drools引擎并激活<code>"go1"</code>检测该项目的规则<code>Office</code>在该位置<code>House</code> ：</p>
</div>
<div class="listingblock">
<div class="title">插入字符串和射击规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>ksession.insert( "go1" );
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">IDE控制台中的规则“ go1”输出</div>
<div class="content">
<pre class="highlightjs highlight"><code>go1
Office is in the House</code></pre>
</div>
</div>
<h4 id="_transitive_closure_rule" class="discrete">传递闭包规则</h4>
<div class="paragraph">
<p>传递闭包是父元素中包含的元素之间的关系，该父元素在层次结构中高出多个级别。</p>
</div>
<div class="paragraph">
<p>规则<code>"go2"</code>识别<code>Drawer</code>和<code>House</code> ： <code>Drawer</code>在里面<code>Desk</code>在里面<code>Office</code>在里面<code>House</code> 。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "go2"
  when
    String( this == "go2" )
    isContainedIn("Drawer", "House"; )
  then
    System.out.println( "Drawer is in the House" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>该示例插入<code>"go2"</code>串入Drools引擎并激活<code>"go2"</code>检测该项目的规则<code>Drawer</code>最终在该位置<code>House</code> ：</p>
</div>
<div class="listingblock">
<div class="title">插入字符串和射击规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>ksession.insert( "go2" );
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">IDE控制台中的规则“ go2”输出</div>
<div class="content">
<pre class="highlightjs highlight"><code>go2
Drawer is in the House</code></pre>
</div>
</div>
<div class="paragraph">
<p>Drools引擎根据以下逻辑确定此结果：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>该查询以递归方式搜索房屋中的多个楼层，以检测之间的传递闭包<code>Drawer</code>和<code>House</code> 。</p>
</li>
<li>
<p>而不是使用<code>Location( x, y; )</code> ，查询使用的值<code>(z, y; )</code>因为<code>Drawer</code>不直接在<code>House</code> 。</p>
</li>
<li>
<p>的<code>z</code>参数当前未绑定，这意味着它没有任何值，并返回该参数中的所有内容。</p>
</li>
<li>
<p>的<code>y</code>参数当前绑定到<code>House</code> ，所以<code>z</code>退货<code>Office</code>和<code>Kitchen</code> 。</p>
</li>
<li>
<p>该查询从<code>Office</code>并递归检查<code>Drawer</code>在里面<code>Office</code> 。查询行<code>isContainedIn( x, z; )</code>被称为这些参数。</p>
</li>
<li>
<p>没有实例<code>Drawer</code>直接存在于<code>Office</code> ，因此找不到匹配项。</p>
</li>
<li>
<p>用<code>z</code>未绑定，查询将返回内部的数据<code>Office</code>并确定<strong>z == Desk</strong> 。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>isContainedIn(x==drawer, z==desk)</code></pre>
</div>
</div>
</li>
<li>
<p>的<code>isContainedIn</code>查询递归搜索三次，第三次查询检测到<code>Drawer</code>在<code>Desk</code> 。</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Location(x==drawer, y==desk)</code></pre>
</div>
</div>
</li>
<li>
<p>在第一个位置上进行此匹配后，查询将递归搜索结构，以确定<code>Drawer</code>在里面<code>Desk</code> ， <code>Desk</code>在里面<code>Office</code>和<code>Office</code>在里面<code>House</code> 。因此， <code>Drawer</code>在里面<code>House</code>并且规则得到满足。</p>
</li>
</ol>
</div>
<h4 id="_reactive_query_rule" class="discrete">反应式查询规则</h4>
<div class="paragraph">
<p>反应式查询在数据结构的层次结构中搜索元素之间的关系，并在修改结构中的元素时动态更新。</p>
</div>
<div class="paragraph">
<p>规则<code>"go3"</code>用作反应性查询，以检测是否有新项目<code>Key</code>曾经存在于<code>Office</code>通过传递闭包：A <code>Key</code>在里面<code>Drawer</code>在里面<code>Office</code> 。</p>
</div>
<div class="listingblock">
<div class="title">规则“ go3”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "go3"
  when
    String( this == "go3" )
    isContainedIn("Key", "Office"; )
  then
    System.out.println( "Key is in the Office" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>该示例插入<code>"go3"</code>串入Drools引擎并激活<code>"go3"</code>规则。最初，此规则不满足，因为没有项目<code>Key</code>在房屋结构中存在，因此规则不产生任何输出。</p>
</div>
<div class="listingblock">
<div class="title">插入字符串和射击规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>ksession.insert( "go3" );
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">IDE控制台中的规则“ go3”输出（不满意）</div>
<div class="content">
<pre class="highlightjs highlight"><code>go3</code></pre>
</div>
</div>
<div class="paragraph">
<p>该示例然后插入一个新项目<code>Key</code>在该位置<code>Drawer</code> ，位于<code>Office</code> 。此更改满足了<code>"go3"</code>规则，并相应地填充输出。</p>
</div>
<div class="listingblock">
<div class="title">插入新物品的位置和射击规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>ksession.insert( new Location("Key", "Drawer") );
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">IDE控制台中的规则“ go3”输出（已满足）</div>
<div class="content">
<pre class="highlightjs highlight"><code>Key is in the Office</code></pre>
</div>
</div>
<div class="paragraph">
<p>此更改还在查询中包含的后续递归搜索中增加了结构的另一个级别。</p>
</div>
<h4 id="_queries_with_unbound_arguments_in_rules" class="discrete">规则中具有未绑定参数的查询</h4>
<div class="paragraph">
<p>具有一个或多个未绑定参数的查询将返回查询的已定义（绑定）参数中的所有未定义（未绑定）项目。如果查询中的所有参数均未绑定，则查询将返回查询范围内的所有项目。</p>
</div>
<div class="paragraph">
<p>规则<code>"go4"</code>使用未绑定的参数<code>thing</code>搜索绑定参数中的所有项目<code>Office</code> ，而不是使用绑定参数来搜索<code>Office</code> ：</p>
</div>
<div class="listingblock">
<div class="title">规则“ go4”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "go4"
  when
    String( this == "go4" )
    isContainedIn(thing, "Office"; )
  then
    System.out.println( thing + "is in the Office" );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>该示例插入<code>"go4"</code>串入Drools引擎并激活<code>"go4"</code>规则返回所有<code>Office</code> ：</p>
</div>
<div class="listingblock">
<div class="title">插入字符串和射击规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>ksession.insert( "go4" );
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">IDE控制台中的规则“ go4”输出</div>
<div class="content">
<pre class="highlightjs highlight"><code>go4
Chair is in the Office
Desk is in the Office
Key is in the Office
Computer is in the Office
Drawer is in the Office</code></pre>
</div>
</div>
<div class="paragraph">
<p>规则<code>"go5"</code>使用两个未绑定的参数<code>thing</code>和<code>location</code>搜索整个项目中的所有项目及其位置<code>House</code>数据结构：</p>
</div>
<div class="listingblock">
<div class="title">规则“ go5”</div>
<div class="content">
<pre class="highlightjs highlight"><code>rule "go5"
  when
    String( this == "go5" )
    isContainedIn(thing, location; )
  then
    System.out.println(thing + " is in " + location );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>该示例插入<code>"go5"</code>串入Drools引擎并激活<code>"go5"</code>规则返回所有项目及其在<code>House</code>数据结构：</p>
</div>
<div class="listingblock">
<div class="title">插入字符串和射击规则</div>
<div class="content">
<pre class="highlightjs highlight"><code>ksession.insert( "go5" );
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">IDE控制台中的规则“ go5”输出</div>
<div class="content">
<pre class="highlightjs highlight"><code>go5
Chair is in Office
Desk is in Office
Drawer is in Desk
Key is in Drawer
Kitchen is in House
Cheese is in Kitchen
Knife is in Kitchen
Computer is in Desk
Office is in House
Key is in Office
Drawer is in House
Computer is in House
Key is in House
Desk is in House
Chair is in House
Knife is in House
Cheese is in House
Computer is in Office
Drawer is in Office
Key is in Desk</code></pre>
</div>
</div>
<h1 id="_drools_release_notes" class="discrete">Drools发行说明</h1>
</div>
</div>
</div>
<div class="sect1">﻿<div class="sect1">
<h2 id="droolsreleasenoteschapter"><a class="anchor" href="#droolsreleasenoteschapter"></a> <a class="link" href="#droolsreleasenoteschapter">21发行说明</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="drools.releasenotesdrools.7.24.0"><a class="anchor" href="#drools.releasenotesdrools.7.24.0"></a> <a class="link" href="#drools.releasenotesdrools.7.24.0">21.1。Drools 7.24.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="dmn-pmml-support"><a class="anchor" href="#dmn-pmml-support"></a> <a class="link" href="#dmn-pmml-support">21.1.1。DMN包含模型中的PMML支持</a></h4>
<div class="paragraph">
<p>现在，您可以使用Business Central中“决策模型和表示法（DMN）”设计器中的“ <strong>包括的模型”</strong>选项卡，将项目中的PMML模型包括在指定的DMN文件中。在DMN文件中包含PMML模型时，可以将该PMML模型作为DMN决策节点或业务知识模型节点的框式函数表达式来调用。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesworkbench.7.23.0.final"><a class="anchor" href="#_drools.releasenotesworkbench.7.23.0.final"></a> <a class="link" href="#_drools.releasenotesworkbench.7.23.0.final">21.2。Business Central 7.23.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_enhanced_bc_collaboration_features"><a class="anchor" href="#_enhanced_bc_collaboration_features"></a> <a class="link" href="#_enhanced_bc_collaboration_features">21.2.1。增强的BC协作功能</a></h4>
<div class="paragraph">
<p>以下增强功能已添加到Business Central中，以提供其他选项来管理对空间和项目的访问。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Collaboration/collaboration-security-management.png" alt="协作安全管理">
</div>
<div class="title">图383。安全管理用户界面</div>
</div>
<div class="paragraph">
<p>通过引入此新功能，现在可以使用“贡献者”选项卡直接在各自的屏幕中管理空间和项目权限。将贡献者添加到空间后，他们便可以打开它并查看其项目和其他可用信息。根据其贡献者角色，还授予了以下权限：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>所有者</em> ：更新贡献者，删除空间，创建和删除项目</p>
</li>
<li>
<p><em>管理员</em> ：更新贡献者（所有者除外）并创建项目</p>
</li>
<li>
<p><em>贡献者</em> ：创建项目</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Collaboration/collaboration-space-contributors.png" alt="协作空间贡献者">
</div>
<div class="title">图384。空间贡献者选项卡</div>
</div>
<div class="paragraph">
<p>在空间内创建项目时，会从该空间复制其参与者，并且项目创建者将成为新项目的所有者。如果他们也是项目空间的贡献者，也可以将新的贡献者添加到项目中。参与者可以查看项目，并且根据其角色，他们还可能具有以下权限：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>所有者</em> ：查看，更新，构建，部署和删除项目</p>
</li>
<li>
<p><em>管理员</em> ：查看，更新，构建和部署项目</p>
</li>
<li>
<p><em>贡献者</em> ：查看，更新和构建项目</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Collaboration/collaboration-project-contributors.png" alt="协作项目贡献者">
</div>
<div class="title">图385。项目贡献者选项卡</div>
</div>
<div class="paragraph">
<p>安全检查使用“安全管理”用户界面和“贡献者”选项卡将权限分配给空间和项目。例如，如果用户被分配给具有所需权限的角色，或者是该空间的所有者，则可以删除该空间。</p>
</div>
</div>
<div class="sect3">
<h4 id="_role_based_access_control_for_branches"><a class="anchor" href="#_role_based_access_control_for_branches"></a> <a class="link" href="#_role_based_access_control_for_branches">21.2.2。分支机构基于角色的访问控制</a></h4>
<div class="paragraph">
<p>除了新的协作功能外，您还可以为项目的每个分支自定义贡献者角色权限。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Collaboration/collaboration-branch-management.png" alt="协作分公司管理">
</div>
<div class="title">图386。分支机构管理设置部分</div>
</div>
<div class="paragraph">
<p>选择每个贡献者角色对所选分支具有哪些权限。</p>
</div>
</div>
<div class="sect3">
<h4 id="_importing_a_subset_of_branches"><a class="anchor" href="#_importing_a_subset_of_branches"></a> <a class="link" href="#_importing_a_subset_of_branches">21.2.3。导入分支的子集</a></h4>
<div class="paragraph">
<p>从存储库导入项目时，只能选择要保留在Business Central中的分支。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在Business Central中，单击<strong>菜单</strong> → <strong>设计</strong> → <strong>项目</strong> 。</p>
</li>
<li>
<p>选择或创建要将项目导入到的空间。默认空间是MySpace。</p>
</li>
<li>
<p>单击屏幕右侧的三个点，然后选择“ <strong>导入项目”</strong> 。</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/Importing/import-project-menu.png" alt="导入项目菜单">
</div>
<div class="title">图387。导入项目弹出访问</div>
</div>
<div class="paragraph">
<p>在“ <strong>导入项目”</strong>窗口中，输入包含要导入的项目的Git存储库的URL和凭证，然后单击<strong>导入</strong> 。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/Importing/import-project-repository-url.png" alt="导入项目存储库URL">
</div>
<div class="title">图388。导入项目弹出窗口</div>
</div>
<div class="paragraph">
<p>单击“ <strong>导入”后</strong> ，将列出在该存储库中找到的所有项目：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/Importing/import-project-list-of-projects.png" alt="导入项目项目列表">
</div>
<div class="title">图389。进口项目清单</div>
</div>
<div class="paragraph">
<p>在每个项目名称的右侧，单击分支图标。选择要导入的分支。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/Importing/import-project-branch-selector-popup.png" alt="导入项目分支选择器弹出窗口">
</div>
<div class="title">图390。进口项目清单</div>
</div>
<div class="paragraph">
<p>仅保留选定的分支：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/Importing/import-project-imported-branches.png" alt="进口项目进口分公司">
</div>
<div class="title">图391。进口分行清单</div>
</div>
</div>
<div class="sect3">
<h4 id="_dmn_included_models"><a class="anchor" href="#_dmn_included_models"></a> <a class="link" href="#_dmn_included_models">21.2.4。DMN随附的型号</a></h4>
<div class="paragraph">
<p>DMN设计器包含一个新的“ <strong>包含的模型”</strong>选项卡，可用于在指定的DMN文件中包括外部定义的DMN模型。在DMN文件中添加包含的模型时，可以在该DMN文件中重复使用包含的模型的组件。此增强功能可帮助您更有效地在项目中的不同DMN模型之间集成DMN逻辑。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesworkbench.7.19.0.final"><a class="anchor" href="#_drools.releasenotesworkbench.7.19.0.final"></a> <a class="link" href="#_drools.releasenotesworkbench.7.19.0.final">21.3。Business Central 7.19.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_dmn_automatic_layout"><a class="anchor" href="#_dmn_automatic_layout"></a> <a class="link" href="#_dmn_automatic_layout">21.3.1。DMN自动版式</a></h4>
<div class="paragraph">
<p>可以使用新的“ <strong>执行自动布局”</strong>工具栏按钮来自动定位DMN决策需求图（DRD）中的节点。此自动布局功能从DRD的底部到顶部垂直定向DRD节点。但是，自动布局当前不支持<strong>决策服务</strong>节点。</p>
</div>
</div>
<div class="sect3">
<h4 id="_dmn_and_test_scenario_context_menu_keyboard_control"><a class="anchor" href="#_dmn_and_test_scenario_context_menu_keyboard_control"></a> <a class="link" href="#_dmn_and_test_scenario_context_menu_keyboard_control">21.3.2。DMN和“测试方案”上下文菜单键盘控件</a></h4>
<div class="paragraph">
<p>在DMN和Test Scenario表中，都添加了对上下文菜单调用的键盘支持。现在，您可以通过键入<strong>Ctrl + Space</strong>来调用上下文菜单。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.18.0"><a class="anchor" href="#_drools.releasenotesdrools.7.18.0"></a> <a class="link" href="#_drools.releasenotesdrools.7.18.0">21.4。Drools 7.18中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_new_builder_options"><a class="anchor" href="#_new_builder_options"></a> <a class="link" href="#_new_builder_options">21.4.1。新的生成器选项</a></h4>
<div class="sect4">
<h5 id="_trimcellsindtableoption"><a class="anchor" href="#_trimcellsindtableoption"></a> <a class="link" href="#_trimcellsindtableoption">21.4.1.1。TrimCellsInDTableOption</a></h5>
<div class="paragraph">
<p>默认情况下，决策表中单元格的所有值在进行处理之前都会被修剪。在某些情况下，不需要这种自动修整甚至是有害的。在这种情况下，现在可以使用新的TrimCellsInDTableOption或相应的“ drools.trimCellsInDTable”系统属性来禁用修整。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_groupdrlsinkiebasesbyfolderoption"><a class="anchor" href="#_groupdrlsinkiebasesbyfolderoption"></a> <a class="link" href="#_groupdrlsinkiebasesbyfolderoption">21.4.2。GroupDRLsInKieBasesByFolderOption</a></h4>
<div class="paragraph">
<p>默认情况下，任何级别的资源文件夹下的所有Drools工件都包含在KieBase中。从现在开始，kmodule.xml的packages属性允许将要在此KieBase中编译的工件限制为仅属于软件包列表的工件。但是，较早版本的Drools实际上检查了文件夹名称而不是软件包名称。新的GroupDRLsInKieBasesByFolderOption或相应的“ drools.groupDRLsInKieBasesByFolder”系统属性允许重新启用基于文件夹的旧行为。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesworkbench.7.18.0.final"><a class="anchor" href="#_drools.releasenotesworkbench.7.18.0.final"></a> <a class="link" href="#_drools.releasenotesworkbench.7.18.0.final">21.5。Business Central 7.18.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_guided_rules_designer_filtering"><a class="anchor" href="#_guided_rules_designer_filtering"></a> <a class="link" href="#_guided_rules_designer_filtering">21.5.1。指导规则设计器过滤</a></h4>
<div class="paragraph">
<p>当您添加新的Condition或Action元素时，受指导的规则设计器现在支持DSL（域特定语言）文件和事实类型的过滤。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/AuthoringAssets/guided-rule-editor-filter.png" alt="指导规则编辑器过滤器">
</div>
<div class="title">图392。筛选</div>
</div>
</div>
<div class="sect3">
<h4 id="_test_scenario_preview_renamed_to_test_scenario_and_listmap_support"><a class="anchor" href="#_test_scenario_preview_renamed_to_test_scenario_and_listmap_support"></a> <a class="link" href="#_test_scenario_preview_renamed_to_test_scenario_and_listmap_support">21.5.2。测试方案（预览）已重命名为测试方案和列表/地图支持</a></h4>
<div class="paragraph">
<p>旧的测试方案已重命名为“测试方案（旧版）”，而“测试方案”（预览）现在更名为“测试方案”。编辑器现在还支持将列表和映射作为受支持的数据类型进行测试。</p>
</div>
</div>
<div class="sect3">
<h4 id="_development_streamline_lifecycle"><a class="anchor" href="#_development_streamline_lifecycle"></a> <a class="link" href="#_development_streamline_lifecycle">21.5.3。开发简化生命周期</a></h4>
<div class="paragraph">
<p>除KIE Server上的新开发模式外，Business Central还为<em>SNAPSHOT</em>模块添加了简化的部署机制，以改善模块的开发和测试阶段的用户体验。引入了一些更改：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>更灵活的部署策略，使您可以运行模块更新，而无需取消部署先前的部署。</p>
</li>
<li>
<p>部署<em>SNAPSHOT</em>模块后，Business Central将存储用户部署首选项，以使后续部署更新以前部署的容器。此机制还保留活动的流程实例。</p>
</li>
<li>
<p>增加了重新部署模块，使用最新更改更新容器但中止活动流程实例的功能。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>引入的其他更改：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/StreamlineDevelopment/streamline_dev_mode_toggle.png" alt="简化开发人员模式切换">
</div>
<div class="title">图393。在模块的“ <strong>常规设置”</strong>屏幕上切换为“新<strong>开发模式</strong> <strong>”，</strong>以将模块转换为<em>快照</em></div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/StreamlineDevelopment/streamline_build_and_install.png" alt="简化构建和安装">
</div>
<div class="title">图394。将“ <strong>生成”</strong>按钮更改为带有“ <strong>生成和安装”</strong>选项的下拉菜单</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/StreamlineDevelopment/streamline_redeploy.png" alt="简化重新部署">
</div>
<div class="title">图395。已将“ <strong>部署”</strong>按钮更改为仅具有“ <strong>重新部署”的</strong>下拉菜单（仅在<em>SNAPSHOT</em>模块上可用）</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.17.0"><a class="anchor" href="#_drools.releasenotesdrools.7.17.0"></a> <a class="link" href="#_drools.releasenotesdrools.7.17.0">21.6。Drools 7.17中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_minor_changes_in_dmn_feel_built_in_functions_parameter_names"><a class="anchor" href="#_minor_changes_in_dmn_feel_built_in_functions_parameter_names"></a> <a class="link" href="#_minor_changes_in_dmn_feel_built_in_functions_parameter_names">21.6.1。DMN FEEL内置函数的参数名称中的较小更改</a></h4>
<div class="paragraph">
<p>Drools的先前版本提供（可选）FEEL内置功能<code>split()</code>作为DMN v1.1规范之外的扩展功能。为了与DMN规范的v1.2版本保持一致，该版本现在包括<code>split()</code>作为标准化的FEEL内置功能集的一部分，功能参数名称已与DMN规范本身所规定的功能参数名称对齐，并带有签名<code>split( string, delimiter )</code>如DMN v1.2规范文档的表68中所指定。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesworkbench.7.17.0.final"><a class="anchor" href="#_drools.releasenotesworkbench.7.17.0.final"></a> <a class="link" href="#_drools.releasenotesworkbench.7.17.0.final">21.7。Business Central 7.17.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_test_scenario_preview_enabled_by_default"><a class="anchor" href="#_test_scenario_preview_enabled_by_default"></a> <a class="link" href="#_test_scenario_preview_enabled_by_default">21.7.1。默认情况下启用测试方案（预览）</a></h4>
<div class="paragraph">
<p>现在默认情况下已启用“测试方案（预览）”，因此不需要其他配置。</p>
</div>
</div>
<div class="sect3">
<h4 id="_test_scenario_dmn_support"><a class="anchor" href="#_test_scenario_dmn_support"></a> <a class="link" href="#_test_scenario_dmn_support">21.7.2。测试方案DMN支持</a></h4>
<div class="paragraph">
<p>测试方案（预览）现在支持DMN模型测试</p>
</div>
</div>
<div class="sect3">
<h4 id="_dmn_decision_service_support"><a class="anchor" href="#_dmn_decision_service_support"></a> <a class="link" href="#_dmn_decision_service_support">21.7.3。DMN决策服务支持</a></h4>
<div class="paragraph">
<p>现在，可以在Business Central的DMN设计器面板中使用DMN决策服务节点。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesworkbench.7.16.0.final"><a class="anchor" href="#_drools.releasenotesworkbench.7.16.0.final"></a> <a class="link" href="#_drools.releasenotesworkbench.7.16.0.final">21.8。Business Central 7.16.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_dmn_and_test_scenario_keyboard_control"><a class="anchor" href="#_dmn_and_test_scenario_keyboard_control"></a> <a class="link" href="#_dmn_and_test_scenario_keyboard_control">21.8.1。DMN和测试方案键盘控制</a></h4>
<div class="paragraph">
<p>对于DMN表和“测试方案”表，都添加了以下键盘控件支持：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>表导航：</strong>在DMN或“测试方案”表中选择一个单元格后，可以使用箭头键在其他单元格之间导航。选择第一个单元格的方式在DMN和测试方案表中有所不同：</p>
<div class="ulist">
<ul>
<li>
<p>在DMN表中，默认情况下会选择左上角的单元格。在标准导航旁边，按<strong>Enter键</strong>选择一个嵌套表达式，然后按<strong>Esc键</strong>返回到父表达式。</p>
</li>
<li>
<p>在“测试方案”表中，默认情况下未选择任何单元格。按<strong>Shift + Home键</strong>以选择第一个可用单元格。</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>表格编辑：</strong>在DMN或“测试方案”表格中选择一个单元格后，可以将新值输入该单元格或更改已添加的值。要编辑单元格，请按<strong>Enter</strong> 。要停止编辑，请按<strong>Shift + Tab</strong> 。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.15.0"><a class="anchor" href="#_drools.releasenotesdrools.7.15.0"></a> <a class="link" href="#_drools.releasenotesdrools.7.15.0">21.9。Drools 7.15中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_broken_dmn_resources_detected_in_drools_project_builds"><a class="anchor" href="#_broken_dmn_resources_detected_in_drools_project_builds"></a> <a class="link" href="#_broken_dmn_resources_detected_in_drools_project_builds">21.9.1。在Drools项目构建中检测到损坏的DMN资源</a></h4>
<div class="paragraph">
<p>当Drools项目（KJAR文件）包含无效或损坏的资源时，该项目将无法构建，并在一个或多个错误消息中报告失败。以前，具有无效DMN资源的Drools项目可以成功构建，而不会出现错误消息。在此版本中，此问题已得到解决，因此，无效的DMN资源现在会导致项目构建失败，并带有错误消息，如预期的那样（ref：DROOLS-3335）。</p>
</div>
<div class="paragraph">
<p>有关项目打包和部署的更多信息，请参见<a href="#_builddeployutilizeandrunsection">Build，Deploy，Utilize and Run</a> 。</p>
</div>
<div class="paragraph">
<p>对于定制的程序化构建，可以使用以下代码片段检索构建错误列表：</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieFileSystem kfs = ks.newKieFileSystem()
                      .generateAndWritePomXML(releaseId)
                      .write(dmnResource);
KieBuilder kieBuilder = ks.newKieBuilder(kfs)
                          .buildAll();
Results results = kieBuilder.getResults();
if (results.hasMessages(Message.Level.ERROR)) {
    throw new IllegalStateException(results.getMessages(Message.Level.ERROR).toString());
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_new_method_for_creating_a_knowledge_run_time"><a class="anchor" href="#_new_method_for_creating_a_knowledge_run_time"></a> <a class="link" href="#_new_method_for_creating_a_knowledge_run_time">21.9.2。创建知识运行时间的新方法</a></h4>
<div class="paragraph">
<p>创建知识运行时的首选方法（例如， <code>DMNRuntime</code> ）不再通过<code>KieSession</code>实例，而是通过新<code>KieRuntimeFactory</code> API：</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DMNRuntime rt = KieRuntimeFactory.of(kieContainer.getKieBase()).get(DMNRuntime.class);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.15.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.15.0.final"></a> <a class="link" href="#_wb.releasenotesworkbench.7.15.0.final">21.10。KIE Workbench 7.15.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_git_hooks_notifications"><a class="anchor" href="#_git_hooks_notifications"></a> <a class="link" href="#_git_hooks_notifications">21.10.1。Git挂钩通知</a></h4>
<div class="paragraph">
<p>改进的git hooks集成可通过定制消息向用户提供反馈通知。</p>
</div>
</div>
<div class="sect3">
<h4 id="_kie_workbench_consolidation"><a class="anchor" href="#_kie_workbench_consolidation"></a> <a class="link" href="#_kie_workbench_consolidation">21.10.2。KIE Workbench整合</a></h4>
<div class="paragraph">
<p>KIE Workbench现在称为Business Central，可以在以下位置使用<code>business-central</code>网络环境。配置文件提供了一组Business Central功能，您可以根据需要选择一个配置文件。的<code>FULL</code>配置文件是包含所有功能的默认配置文件。的<code>PLANNER_AND_RULES</code>个人资料仅包含drools-kie-wb功能。您可以使用<code>org.kie.workbench.profile</code>系统属性（可能的值为FULL或PLANNER_AND_RULES），也可以从“管理”屏幕的“配置文件”选项中获取。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.14.0"><a class="anchor" href="#_drools.releasenotesdrools.7.14.0"></a> <a class="link" href="#_drools.releasenotesdrools.7.14.0">21.11。Drools 7.14中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_file_system_based_kiescanner"><a class="anchor" href="#_file_system_based_kiescanner"></a> <a class="link" href="#_file_system_based_kiescanner">21.11.1。基于文件系统的KieScanner</a></h4>
<div class="paragraph">
<p>的<code>KieScanner</code>允许持续监视您的Maven存储库，以检查是否已安装新版本的Kie项目，如果已安装，则实时更新运行中的项目<code>KieContainer</code>使用该项目的较新版本。但是，在许多情况下，尤其是在生产环境中，安装Maven存储库是不切实际的。因此，现在可以<code>KieScanner</code>只需从纯文件系统的文件夹中获取更新即可。您可以创建并启动这样的<code>KieScanner</code>就像</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieScanner kScanner = kieServices.newKieScanner( kContainer, "/myrepo/kjars" );

// Start the KieScanner polling the Maven repository every 10 seconds
kScanner.start( 10000L );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>其中“ / myrepo / kjars”将是<code>KieScanner</code>将寻找kjar更新。放置在此文件夹中的jar文件必须遵循maven约定，然后必须是{artifactId}-{versionId} .jar形式的名称</p>
</div>
</div>
<div class="sect3">
<h4 id="_support_for_executable_models_in_dmn_projects"><a class="anchor" href="#_support_for_executable_models_in_dmn_projects"></a> <a class="link" href="#_support_for_executable_models_in_dmn_projects">21.11.2。支持DMN项目中的可执行模型</a></h4>
<div class="paragraph">
<p>您现在可以使用<code>kie-maven-plugin</code>构建组件以生成DMN可执行模型类并在Drools项目中进行编译（ <code>kjar</code> ）。这种支持使DMN项目中的DMN决策表逻辑能够得到更有效的评估。</p>
</div>
<div class="paragraph">
<p>要在DMN项目中启用可执行模型，请添加所需的<code>kie-dmn-core</code>依赖<code>pom.xml</code>文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.kie&lt;/groupId&gt;
  &lt;artifactId&gt;kie-dmn-core&lt;/artifactId&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>要构建允许可执行模型编译的DMN项目，请在命令终端中导航到Maven项目目录，然后运行以下命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn clean install -DgenerateDMNModel=yes</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者，您可以直接在<code>pom.xml</code>文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project&gt;
  ...
  &lt;properties&gt;
    &lt;generateDMNModel&gt;yes&lt;/generateDMNModel&gt;
  &lt;/properties&gt;
  ...
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关为您的Maven或Java项目配置可执行模型的更多信息，请参见<a href="#executable-model-con_N&N-7.7">可执行规则模型</a> 。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.14.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.14.0.final"></a> <a class="link" href="#_wb.releasenotesworkbench.7.14.0.final">21.12。KIE Workbench 7.14.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_ssh_and_git_daemon_port_assignment_changes"><a class="anchor" href="#_ssh_and_git_daemon_port_assignment_changes"></a> <a class="link" href="#_ssh_and_git_daemon_port_assignment_changes">21.12.1。SSH和Git守护程序端口分配更改</a></h4>
<div class="paragraph">
<p>如果SSH或Git守护程序的默认端口或分配的端口已在使用中，则会自动选择一个新端口。确保端口可用，并检查日志以获取更多信息。</p>
</div>
<div class="paragraph">
<p>在进行此更改之前，该应用程序曾经无法启动。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.13.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.13.0.final"></a> <a class="link" href="#_wb.releasenotesworkbench.7.13.0.final">21.13。KIE Workbench 7.13.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_test_scenarios_preview_editor"><a class="anchor" href="#_test_scenarios_preview_editor"></a> <a class="link" href="#_test_scenarios_preview_editor">21.13.1。测试方案（预览）编辑器</a></h4>
<div class="paragraph">
<p>此版本包含新的“测试方案”编辑器的预览，该编辑器使用全新的用户体验来测试规则。</p>
</div>
<div class="paragraph">
<p>有关启用和使用编辑器的详细信息，请参见<a href="#test-scenarios-intro-con">测试方案</a>部分。</p>
</div>
</div>
<div class="sect3">
<h4 id="_experimental_features_support"><a class="anchor" href="#_experimental_features_support"></a> <a class="link" href="#_experimental_features_support">21.13.2。实验功能支持</a></h4>
<div class="paragraph">
<p>新的<em>实验性功能框架已</em>添加到工作台中。它为用户提供了一种简单的机制来预览功能，这些功能不是产品的一部分，但可能对他们来说很有趣（例如正在进行的开发，技术预览，POC ...）。</p>
</div>
<div class="paragraph">
<p>有关更多详细信息，请参见<a href="#_wb.experimentalFeatures">实验功能框架</a>一节。</p>
</div>
</div>
<div class="sect3">
<h4 id="_ssh_keystore"><a class="anchor" href="#_ssh_keystore"></a> <a class="link" href="#_ssh_keystore">21.13.3。SSH密钥库</a></h4>
<div class="paragraph">
<p>为了向Workbench VFS提供正确的SSH身份验证，必须添加新的密钥库。该密钥库使用户可以注册其SSH公共密钥。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-editor.png" alt="ssh密钥库编辑器">
</div>
<div class="title">图396。SSH密钥库用户界面</div>
</div>
<div class="paragraph">
<p>您可以使用新的<strong>SSH密钥</strong>菜单选项从“ <strong>管理”</strong>页面访问它。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-menu.png" alt="ssh密钥库菜单">
</div>
<div class="title">图397。管理员页面上的SSH密钥菜单选项</div>
</div>
<div class="paragraph">
<p>有关详细信息，请参见<a href="#_wb.sshkeystore">SSH密钥库</a>部分。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.13.0"><a class="anchor" href="#_drools.releasenotesdrools.7.13.0"></a> <a class="link" href="#_drools.releasenotesdrools.7.13.0">21.14。Drools 7.13中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_allow_to_declare_serialversionuid_on_classes_generated_from_declared_types"><a class="anchor" href="#_allow_to_declare_serialversionuid_on_classes_generated_from_declared_types"></a> <a class="link" href="#_allow_to_declare_serialversionuid_on_classes_generated_from_declared_types">21.14.1。允许在从声明的类型生成的类上声明serialVersionUID</a></h4>
<div class="paragraph">
<p>为了提高序列化KieSession的兼容性，引入了通过如下注释在从声明的类型生成的类上指定serialVersionUID的可能性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>declare MyClass
  @serialVersionUID( 42 )
  name : String
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_declaratively_set_calendars_on_kiesession_via_kmodule_xml"><a class="anchor" href="#_declaratively_set_calendars_on_kiesession_via_kmodule_xml"></a> <a class="link" href="#_declaratively_set_calendars_on_kiesession_via_kmodule_xml">21.14.2。通过kmodule.xml在KieSession上声明式设置日历</a></h4>
<div class="paragraph">
<p>可以通过kmodule.xml配置文件在KieSession上声明性地设置一个或多个日历，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;ksession name="KSession1"&gt;
  &lt;calendars&gt;
    &lt;calendar name="monday" type="org.domain.Monday"/&gt;
  &lt;/calendars&gt;
&lt;/ksession&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>类型是实现该类的类的名称<code>org.kie.api.time.Calendar</code>接口。</p>
</div>
</div>
<div class="sect3">
<h4 id="_kiesessions_pool"><a class="anchor" href="#_kiesessions_pool"></a> <a class="link" href="#_kiesessions_pool">21.14.3。KieSessions池</a></h4>
<div class="paragraph">
<p>在大量使用案例中，`KieSession`s的创建和处理频率很高。通常，此操作不是很耗时，但是当重复数百万次会成为瓶颈，并且还需要大量的GC工作。一些用户尝试使用自制池来缓解此问题，因此，已决定立即提供此解决方案。</p>
</div>
<div class="paragraph">
<p>获得一个池<code>KieSession</code>从一个<code>KieContainer</code>足以在其上调用该方法</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>KieContainerSessionsPool KieContainer.newKieSessionsPool(int initialSize)</code></pre>
</div>
</div>
<div class="paragraph">
<p>哪里<code>initialSize</code>是号码<code>KieSession`s that will be initially created in the pool. However, if required by the running application, the number of `KieSession`s in the pool will dynamically grow beyond that value. At this point you can create `KieSession`s from that pool as you would normally do from a `KieContainer</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>KieContainerSessionsPool pool = kContainer.newKieSessionsPool(10);
KieSession kSession = pool.newKieSession();</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在，您可以正常使用KieSession并在通话时<code>dispose()</code>在它上面，而不是被销毁，只是被重置并推回池中。请注意，当您拥有一个或多个池时，使用此池也会影响情况<code>StatelessKieSession`s and you keep reusing them with multiple call to the `execute()</code>方法。实际上是<code>StatelessKieSession</code>直接从<code>KieContainer</code>将继续在内部创建一个新的<code>KieSession</code>每个<code>execute()</code>调用。相反，如果您创建<code>StatelessKieSession</code>从池中，它将在内部使用<code>KieSession`s provided by the pool itself. In other words even if you asked a `StatelessKieSession</code>到池中，实际合并的是由它包装的`KieSession`。</p>
</div>
<div class="paragraph">
<p>完成池的操作后，需要调用<code>shutdown()</code>避免内存泄漏的方法。替代呼叫<code>dispose()</code>总体上<code>KieContainer</code>还将自动关闭最终从中创建的所有池。</p>
</div>
</div>
<div class="sect3">
<h4 id="_wb.releasenotesworkbench.7.13.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.13.0.final"></a> <a class="link" href="#_wb.releasenotesworkbench.7.13.0.final">21.14.4。KIE Workbench 7.13.0中的新功能和值得注意的功能</a></h4>
<div class="sect4">
<h5 id="_test_scenarios_preview_editor_2"><a class="anchor" href="#_test_scenarios_preview_editor_2"></a> <a class="link" href="#_test_scenarios_preview_editor_2">21.14.4.1。测试方案（预览）编辑器</a></h5>
<div class="paragraph">
<p>此版本包含新的“测试方案”编辑器的预览，该编辑器使用全新的用户体验来测试规则。</p>
</div>
<div class="paragraph">
<p>有关启用和使用编辑器的详细信息，请参见<a href="#test-scenarios-intro-con">测试方案</a>部分。</p>
</div>
</div>
<div class="sect4">
<h5 id="_experimental_features_support_2"><a class="anchor" href="#_experimental_features_support_2"></a> <a class="link" href="#_experimental_features_support_2">21.14.4.2。实验功能支持</a></h5>
<div class="paragraph">
<p>新的<em>实验性功能框架已</em>添加到工作台中。它为用户提供了一种简单的机制来预览功能，这些功能不是产品的一部分，但可能对他们来说很有趣（例如正在进行的开发，技术预览，POC ...）。</p>
</div>
<div class="paragraph">
<p>有关更多详细信息，请参见<a href="#_wb.experimentalFeatures">实验功能框架</a>一节。</p>
</div>
</div>
<div class="sect4">
<h5 id="_ssh_keystore_2"><a class="anchor" href="#_ssh_keystore_2"></a> <a class="link" href="#_ssh_keystore_2">21.14.4.3。SSH密钥库</a></h5>
<div class="paragraph">
<p>为了向Workbench VFS提供正确的SSH身份验证，必须添加新的密钥库。该密钥库使用户可以注册其SSH公共密钥。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-editor.png" alt="ssh密钥库编辑器">
</div>
<div class="title">图398。SSH密钥库用户界面</div>
</div>
<div class="paragraph">
<p>您可以使用新的<strong>SSH密钥</strong>菜单选项从“ <strong>管理”</strong>页面访问它。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/SSHKeyStore/ssh-keystore-menu.png" alt="ssh密钥库菜单">
</div>
<div class="title">图399。管理员页面上的SSH密钥菜单选项</div>
</div>
<div class="paragraph">
<p>有关详细信息，请参见<a href="#_wb.sshkeystore">SSH密钥库</a>部分。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.12.0"><a class="anchor" href="#_drools.releasenotesdrools.7.12.0"></a> <a class="link" href="#_drools.releasenotesdrools.7.12.0">21.15。Drools 7.12中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_end_of_support_for_drools_rhq_plugin_component"><a class="anchor" href="#_end_of_support_for_drools_rhq_plugin_component"></a> <a class="link" href="#_end_of_support_for_drools_rhq_plugin_component">21.15.1。终止支持<code>drools-rhq-plugin</code>零件</a></h4>
<div class="paragraph">
<p>的<code>drools-rhq-plugin</code>不再支持使用JBoss Operations Network监视Drools的组件，因为该组件未得到充分利用并且已过时。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.11.0"><a class="anchor" href="#_drools.releasenotesdrools.7.11.0"></a> <a class="link" href="#_drools.releasenotesdrools.7.11.0">21.16。Drools 7.11中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_minor_api_changes_of_kie_dmn_open_source_engine"><a class="anchor" href="#_minor_api_changes_of_kie_dmn_open_source_engine"></a> <a class="link" href="#_minor_api_changes_of_kie_dmn_open_source_engine">21.16.1。Kie DMN开源引擎的微小API更改</a></h4>
<div class="paragraph">
<p>Kie DMN开源引擎的API进行了一些小的更改，以支持新的DMN v1.2格式。</p>
</div>
<div class="paragraph">
<p>新包装<code>org.kie.dmn.model.api</code>在Maven模块内部<code>kie-dmn-model</code>提供了通用模型来支持DMN版本v1.1和v1.2。这要求先前版本的用户更新先前程序包中的引用<code>org.kie.dmn.model.v1_1</code>到这个新包装<code>org.kie.dmn.model.api</code> 。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">Kie DMN API的用户必须从以下位置更新导入包的引用： <code>import org.kie.dmn.model.v1_1.<strong>;</strong></code> <strong>至<code>import org.kie.dmn.model.api.</code></strong> <code>;</code> 。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>包<code>org.kie.dmn.api.marshalling.v1_1</code>不赞成使用<code>org.kie.dmn.api.marshalling</code> ;通常，这不应影响Kie DMN API的最终用户，因为<code>DMNRuntime</code>将自动为DMN v1.1和v1.2提供支持。此更改会影响手动管理DMN资源封送的用户，这些用户必须升级到新软件包才能支持新的DMN v1.2版本。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.11.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.11.0.final"></a> <a class="link" href="#_wb.releasenotesworkbench.7.11.0.final">21.17。KIE Workbench 7.11.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_multiple_git_branches_support"><a class="anchor" href="#_multiple_git_branches_support"></a> <a class="link" href="#_multiple_git_branches_support">21.17.1。多个Git分支支持</a></h4>
<div class="paragraph">
<p>现在，您可以在Business Central中交替使用多个Git源分支，以改善项目的Git工作流程。</p>
</div>
<div class="paragraph">
<p>创建并打开项目后，您可以查看项目的所有资产：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/project_master.png" alt="项目负责人">
</div>
</div>
<div class="paragraph">
<p>在面包屑导航中，您现在可以看到一个下拉菜单，单击该菜单时将显示所有可用的Git分支：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/branches_breadcrumb_only_master.png" alt="分支面包屑唯一大师">
</div>
</div>
<div class="paragraph">
<p>您可以单击<strong>添加分支</strong>将更多分支添加到您的项目：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/add_branch_popup.png" alt="添加分支弹出窗口">
</div>
</div>
<div class="paragraph">
<p>添加新分支后，您将使用基本分支中拥有的所有资产重定向到新分支：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/feature_branch.png" alt="功能分支">
</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/branches_breadcrumb.png" alt="分支面包屑">
</div>
</div>
<div class="paragraph">
<p>您还可以单击屏幕右上角的<strong>Delete Branch</strong>来删除除master分支以外的任何分支：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/delete_branch_option.png" alt="删除分支选项">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.9.0"><a class="anchor" href="#_drools.releasenotesdrools.7.9.0"></a> <a class="link" href="#_drools.releasenotesdrools.7.9.0">21.18。Drools 7.9的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_moved_executablecommand_to_kie_public_api"><a class="anchor" href="#_moved_executablecommand_to_kie_public_api"></a> <a class="link" href="#_moved_executablecommand_to_kie_public_api">21.18.1。将ExecutableCommand移至KIE公共API</a></h4>
<div class="paragraph">
<p>内部流口水<code>ExecutableCommand</code>介面已移至KIE公开API。现在可以在不依赖内部接口的情况下创建自定义的可执行命令。</p>
</div>
<div class="paragraph">
<p>已淘汰的内部<code>ExecutableCommand</code>该接口仍然存在以实现向后兼容，并且在以后的版本中将删除该接口。</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">基于旧内部接口的现有自定义命令会覆盖<code>canRunInTransaction()</code>由于此更改，该方法将不再编译。
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_alpha_network_compiler"><a class="anchor" href="#_alpha_network_compiler"></a> <a class="link" href="#_alpha_network_compiler">21.18.2。Alpha网络编译器</a></h4>
<div class="paragraph">
<p>Drools现在支持评估alpha节点的优化，该优化涉及生成中间类，该中间类被编译以更快地评估约束。</p>
</div>
<div class="paragraph">
<p>这是高度实验性的，应该只能与新的可执行模型系统一起使用。要启用它，请使用<code>drools.alphaNetworkCompiler</code>中的配置密钥<code>KieModuleModel</code>组态。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;kmodule xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns="http://www.drools.org/xsd/kmodule"&gt;
  &lt;configuration&gt;
    &lt;property key="drools.alphaNetworkCompiler" value="true"/&gt;
  &lt;/configuration&gt;
&lt;/kmodule&gt;</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">当前的实现在增量编译方面存在问题，因此请勿一起使用。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.8.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.8.0.final"></a> <a class="link" href="#_wb.releasenotesworkbench.7.8.0.final">21.19。KIE Workbench 7.8.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_new_system_property_for_setting_the_default_maven_repository_in_project_pom_xml_files"><a class="anchor" href="#_new_system_property_for_setting_the_default_maven_repository_in_project_pom_xml_files"></a> <a class="link" href="#_new_system_property_for_setting_the_default_maven_repository_in_project_pom_xml_files">21.19.1。用于在项目pom.xml文件中设置默认Maven存储库的新系统属性</a></h4>
<div class="paragraph">
<p>为了使在Workbench外部构建Workbench项目更加容易，现在可以为添加到每个新Project pom.xml中的默认Maven存储库设置URL。建议您在首次启动Workbench之前进行设置。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.7.0"><a class="anchor" href="#_drools.releasenotesdrools.7.7.0"></a> <a class="link" href="#_drools.releasenotesdrools.7.7.0">21.20。Drools 7.7中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="executable-model-con_N&N-7.7"><a class="anchor" href="#executable-model-con_N&N-7.7"></a> <a class="link" href="#executable-model-con_N&N-7.7">21.20.1。可执行规则模型</a></h4>
<div class="paragraph">
<p>可执行规则模型是可嵌入模型，它们提供规则集的基于Java的表示形式以便在构建时执行。可执行模型是Drools中标准资产打包的一种更有效的替代方法，它可以更快地创建KIE容器和KIE基础，尤其是当您拥有大量DRL（Drools规则语言）文件和其他Drools资产时。该模型是低级模型，使您能够提供所有必要的执行信息，例如用于索引评估的lambda表达式。</p>
</div>
<div class="paragraph">
<p>可执行规则模型为您的项目提供以下特定优势：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>编译时间：</strong>传统上，打包的Drools项目（KJAR）包含DRL文件和其他Drools工件的列表，这些工件定义了规则库以及一些实现约束和后果的预生成类。从Maven存储库下载KJAR并将其安装在KIE容器中时，必须解析和编译那些DRL文件。此过程可能很慢，尤其是对于大型规则集。使用可执行模型，您可以在项目KJAR中打包实现项目规则库的可执行模型的Java类，并以更快的方式从中重新创建KIE容器及其KIE基础。在Maven项目中，您可以使用<code>kie-maven-plugin</code>在编译过程中自动从DRL文件生成可执行模型源。</p>
</li>
<li>
<p><strong>运行时：</strong>在可执行模型中，所有约束都定义为Java lambda表达式。相同的lambda表达式也用于约束评估，因此您不再需要使用<code>mvel</code>用于解释性评估的表达式或即时（JIT）流程来转换<code>mvel</code>基于约束的字节码。这样可以更快更有效地运行时间。</p>
</li>
<li>
<p><strong>开发时间：</strong>可执行模型使您能够开发和试验Drools引擎的新功能，而无需直接以DRL格式编码元素或修改DRL解析器以支持它们。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>对于可执行规则模型中的查询定义，最多只能使用10个参数。</p>
</div>
<div class="paragraph">
<p>对于可执行规则模型中规则后果内的变量，您最多只能使用24个绑定变量（包括内置变量）。 <code>drools</code>变量）。例如，以下规则结果使用了超过24个绑定变量并创建了编译错误：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>...
then
  $input.setNo25Count(functions.sumOf(new Object[]{$no1Count_1, $no2Count_1, $no3Count_1, ..., $no25Count_1}).intValue());
  $input.getFirings().add("fired");
  update($input);</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="_executable_model_domain_specific_languages_dsls"><a class="anchor" href="#_executable_model_domain_specific_languages_dsls"></a> <a class="link" href="#_executable_model_domain_specific_languages_dsls">21.20.1.1。可执行模型域特定语言（DSL）</a></h5>
<div class="paragraph">
<p>在为可执行模型设计领域特定语言（DSL）的第一次迭代时，一个目标是摆脱模式的概念，并将规则视为表达式（约束）和动作（结果）的流。因此，我们将其称为Flow DSL。此处提供此DSL的一些示例。</p>
</div>
<div class="paragraph">
<p>但是，在实施Flow DSL之后，很明显，避免明确使用模式的决定使我们不得不实施一些既具有复杂性又具有性能成本的额外逻辑，因为为了正确地重新创建预期的数据结构， Drools编译器有必要将那些看似无关的表达式组合在一起。</p>
</div>
<div class="paragraph">
<p>因此，已经决定在我们称为模式DSL的第二个DSL中重新引入模式。这允许绕过必须填充人为语义空白并且在运行时也很耗时的算法分组表达式。我们认为两种DSL都适用于不同的用例，因此我们决定保留并支持这两种。尤其是Pattern DSL更安全，更快（即使更冗长），因此这将是在通过kie-maven-plugin创建KJAR时自动生成的DSL。相反，Flow DSL更为简洁，更接近用户可能希望以Java编程方式定义规则的方式，我们计划通过后处理器自动生成定义索引的模型部分，从而使其不再那么冗长和财产反应性。换句话说，我们期望Pattern DSL将由机器编写，而Flow DSL将最终由人类编写。</p>
</div>
</div>
<div class="sect4">
<h5 id="executable-model-maven-proc_N&N-7.7"><a class="anchor" href="#executable-model-maven-proc_N&N-7.7"></a> <a class="link" href="#executable-model-maven-proc_N&N-7.7">21.20.1.2。在Maven项目中嵌入可执行规则模型</a></h5>
<div class="paragraph">
<p>您可以在Maven项目中嵌入可执行规则模型，以在构建时更有效地编译规则资产。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>您有一个包含Drools业务资产的Mavenized项目。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>在里面<code>pom.xml</code> Maven项目的文件，请确保打包类型设置为<code>kjar</code>并添加<code>kie-maven-plugin</code>构建组件：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;packaging&gt;kjar&lt;/packaging&gt;
...
&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.kie&lt;/groupId&gt;
      &lt;artifactId&gt;kie-maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;${drools.version}&lt;/version&gt;
      &lt;extensions&gt;true&lt;/extensions&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>kjar</code>包装类型激活<code>kie-maven-plugin</code>组件来验证和预编译工件资源。的<code><version></code>是项目中当前使用的Drools的Maven工件版本（例如7.26.0。Final-redhat-00005）。这些设置是正确打包Maven项目所必需的。</p>
</div>
</div>
</div>
</li>
<li>
<p>将以下依赖项添加到<code>pom.xml</code>文件，以允许从可执行模型构建规则资产：</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>drools-canonical-model</code> ：启用独立于Drools的规则集模型的可执行规范表示</p>
</li>
<li>
<p><code>drools-model-compiler</code> ：将可执行模型编译为Drools内部数据结构，以便可由Drools引擎执行</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;drools-canonical-model&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;drools-model-compiler&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>在命令终端中，导航到您的Maven项目目录，然后运行以下命令以从可执行模型构建项目：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn clean install -DgenerateModel=&lt;VALUE&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code>-DgenerateModel=<VALUE></code>属性使项目可以构建为基于模型的KJAR而不是基于DRL的KJAR。</p>
</div>
<div class="paragraph">
<p>更换<code><VALUE></code>具有以下三个值之一：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>YES</code> ：生成与原始项目中DRL文件相对应的可执行模型，并从生成的KJAR中排除DRL文件。</p>
</li>
<li>
<p><code>WITHDRL</code> ：生成与原始项目中的DRL文件相对应的可执行模型，并且还将DRL文件添加到生成的KJAR中以用于文档编制（无论如何，KIE库都是从可执行模型构建的）。</p>
</li>
<li>
<p><code>NO</code> ：不生成可执行模型。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>示例构建命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mvn clean install -DgenerateModel=YES</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="executable-model-java-proc_N&N-7.7"><a class="anchor" href="#executable-model-java-proc_N&N-7.7"></a> <a class="link" href="#executable-model-java-proc_N&N-7.7">21.20.1.3。在Java应用程序中嵌入可执行规则模型</a></h5>
<div class="paragraph">
<p>您可以以编程方式在Java应用程序中嵌入可执行规则模型，以在构建时更有效地编译规则资产。</p>
</div>
<div class="ulist">
<div class="title">先决条件</div>
<ul>
<li>
<p>您有一个包含Drools业务资产的Java应用程序。</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">程序</div>
<ol class="arabic">
<li>
<p>将以下依赖项添加到Java项目的相关类路径中：</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>drools-canonical-model</code> ：启用独立于Drools的规则集模型的可执行规范表示</p>
</li>
<li>
<p><code>drools-model-compiler</code> ：将可执行模型编译为Drools内部数据结构，以便可由Drools引擎执行</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;drools-canonical-model&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;org.drools&lt;/groupId&gt;
  &lt;artifactId&gt;drools-model-compiler&lt;/artifactId&gt;
  &lt;version&gt;${drools.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>的<code><version></code>是项目中当前使用的Drools的Maven工件版本（例如7.26.0。Final-redhat-00005）。</p>
</div>
</div>
</div>
</li>
<li>
<p>将规则资产添加到KIE虚拟文件系统<code>KieFileSystem</code>和使用<code>KieBuilder</code>与<code>buildAll( ExecutableModelProject.class )</code>指定从可执行模型构建资产：</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.kie.api.KieServices;
import org.kie.api.builder.KieFileSystem;
import org.kie.api.builder.KieBuilder;

  KieServices ks = KieServices.Factory.get();
  KieFileSystem kfs = ks.newKieFileSystem()
  kfs.write("src/main/resources/KBase1/ruleSet1.drl", stringContainingAValidDRL)
  .write("src/main/resources/dtable.xls",
    kieServices.getResources().newInputStreamResource(dtableFileStream));

  KieBuilder kieBuilder = ks.newKieBuilder( kfs );
  // Build from an executable model
  kieBuilder.buildAll( ExecutableModelProject.class )
  assertEquals(0, kieBuilder.getResults().getMessages(Message.Level.ERROR).size());</code></pre>
</div>
</div>
<div class="paragraph">
<p>后<code>KieFileSystem</code>从可执行模型构建而成，结果<code>KieSession</code>使用基于lambda表达式的约束，而不是效率较低的约束<code>mvel</code>表达式。如果<code>buildAll()</code>不包含任何参数，该项目以标准方法构建，没有可执行模型。</p>
</div>
<div class="paragraph">
<p>作为使用的更手动的替代方法<code>KieFileSystem</code>为了创建可执行模型，您可以定义一个<code>Model</code>使用流畅的API并创建一个<code>KieBase</code>从中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Model model = new ModelImpl().addRule( rule );
KieBase kieBase = KieBaseBuilder.createKieBaseFromModel( model );</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.7.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.7.0.final"></a> <a class="link" href="#_wb.releasenotesworkbench.7.7.0.final">21.21。KIE Workbench 7.7.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_project_oriented_workbench"><a class="anchor" href="#_project_oriented_workbench"></a> <a class="link" href="#_project_oriented_workbench">21.21.1。面向项目的工作台</a></h4>
<div class="paragraph">
<p>工作台变为面向项目。这意味着每个项目现在都位于专用的存储库中。以前，每个项目都在一个文件夹中，一个存储库可以容纳多个项目。这些更改合并了项目和存储库的概念。</p>
</div>
<div class="paragraph">
<p>一个项目的一种存储库方法使UI更加简单，并改善了单个项目的发布或冻结。以前，如果某个项目被冻结，分支或标记，则该存储库仍将与其他项目共享，从而使发行控制变得更加困难和复杂。</p>
</div>
<div class="paragraph">
<p>旧版Workbench的项目需要迁移到新设置。为此，我们提供了一个命令行迁移工具。</p>
</div>
<div class="paragraph">
<p>目前，“面向项目”不支持多模块设置。此功能是计划中的，但此版本中未计划。现在不推荐使用的资产管理功能取决于多模块支持，不能迁移到此Workbench版本。</p>
</div>
</div>
<div class="sect3">
<h4 id="_connecting_to_a_headless_drools_controller"><a class="anchor" href="#_connecting_to_a_headless_drools_controller"></a> <a class="link" href="#_connecting_to_a_headless_drools_controller">21.21.2。连接到无头Drools控制器</a></h4>
<div class="paragraph">
<p>现在，在运行Workbench实例时，可以更加灵活地决定如何管理Kie Server实例。以前，无论何时启动工作台，它总是会启动嵌入式Drools控制器。此设置仍然可用，但是现在还有一个选项，可以不启动此服务，而是连接到无头Drools控制器。这允许使用更细粒度的部署模型，在该模型中可以为特定方案决定最佳方法。</p>
</div>
<div class="paragraph">
<p>要在这些模式之间切换，请使用关键的系统属性： <strong>org.kie.workbench.controller</strong> 。默认情况下，如果缺少此系统属性，Workbench将继续启动嵌入式服务。否则，它将尝试连接到远程服务，并确保没有启动任何嵌入式服务。</p>
</div>
<div class="paragraph">
<p>重要的是要注意，连接到无头Drools控制器时，仅Web套接字连接协议可用。</p>
</div>
<div class="paragraph">
<p>有关通过密钥库进行的有关用户名，密码，令牌和安全密码的所有可能的系统配置的更多详细信息，请参阅<a href="#_wb.systemproperties">Workbench系统属性</a> 。</p>
</div>
</div>
<div class="sect3">
<h4 id="_content_management_enhancements"><a class="anchor" href="#_content_management_enhancements"></a> <a class="link" href="#_content_management_enhancements">21.21.3。内容管理增强</a></h4>
<div class="sect4">
<h5 id="_properties_panel"><a class="anchor" href="#_properties_panel"></a> <a class="link" href="#_properties_panel">21.21.3.1。属性面板</a></h5>
<div class="paragraph">
<p>可以编辑不同页面元素的属性，包括页面本身或其任何行和组件。选定元素后，通过将鼠标悬停在元素上并单击编辑器区域，或在“ <em>属性”</em>面板下拉列表中选择该元素，其属性将显示在左侧的停靠面板中。看截图：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/ContentManagement/ContentManagementPropertiesPanel.png" alt="ContentManagementPropertiesPanel">
</div>
<div class="title">图400。内容管理属性面板</div>
</div>
<div class="paragraph">
<p>此版本中可用的属性基本上是与元素样式相关的属性，例如宽度，高度或边距等。每种类型的可用属性可能有所不同。注意，例如，HTML组件提供了一组额外的属性，所有这些属性都与文本样式相关。</p>
</div>
<div class="paragraph">
<p>更改属性后，无论在<em>设计</em>还是<em>预览</em>模式下，其值都会反映在编辑器的区域中。</p>
</div>
</div>
<div class="sect4">
<h5 id="_screen_component_removed"><a class="anchor" href="#_screen_component_removed"></a> <a class="link" href="#_screen_component_removed">21.21.3.2。屏幕组件已删除</a></h5>
<div class="paragraph">
<p><em>屏幕</em>组件（位于右侧工具栏的“ <em>组件”</em>面板中的“ <em>核心”</em>组下）已被删除。原因是，该组件不适合生产环境。</p>
</div>
<div class="paragraph">
<p>但是，在将来的版本中，与域相关的组件（例如BPM的任务列表）将可供最终用户轻松使用。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_new_migration_tool"><a class="anchor" href="#_new_migration_tool"></a> <a class="link" href="#_new_migration_tool">21.21.4。新的迁移工具</a></h4>
<div class="paragraph">
<p>提供了一个新的命令行迁移工具，该工具支持Linux和Windows，可将不同的资源移至最新版本。它可以执行不同的迁移：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>项目迁移</strong> ：将KIE项目从旧项目布局（7.4.x和以前的版本）迁移到新的面向项目的结构。</p>
</li>
<li>
<p><strong>表单迁移</strong> ：将旧的jBPM Form Modeler表单迁移为新的Forms格式。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/7.7.0/MigrationTool.png" alt="迁移工具">
</div>
<div class="title">图401。命令行迁移工具</div>
</div>
<div class="paragraph">
<p>您可以<a href="https://github.com/kiegroup/kie-wb-common/blob/master/kie-wb-common-cli/kie-wb-common-cli-migration-tool/README.md">在此处</a>找到更多信息。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.6.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.6.0.final"></a> <a class="link" href="#_wb.releasenotesworkbench.7.6.0.final">21.22。KIE Workbench 7.6.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_content_management_enhancements_2"><a class="anchor" href="#_content_management_enhancements_2"></a> <a class="link" href="#_content_management_enhancements_2">21.22.1。内容管理增强</a></h4>
<div class="paragraph">
<p>为了改善用户体验， <em>内容管理</em>工具（又称<em>页面创作</em> ）中引入了一些额外的更改。以下屏幕截图显示了自最新版本以来引入的更改。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/ContentManagement/ContentManagementEnhancements.png" alt="内容管理增强">
</div>
<div class="title">图402。内容管理的新外观</div>
</div>
<div class="sect4">
<h5 id="_fluidpage_editor_mode_selection"><a class="anchor" href="#_fluidpage_editor_mode_selection"></a> <a class="link" href="#_fluidpage_editor_mode_selection">21.22.1.1。流体/页面编辑器模式选择</a></h5>
<div class="paragraph">
<p>弹出的新页面允许选择两种编辑模式：</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/ContentManagement/NewPagePopup.png" alt="NewPagePopup">
</div>
<div class="title">图403。弹出内容管理的新页面</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>流畅性</strong> ：它更像是经典网页，当页面超过可用高度时会显示垂直滚动条。</p>
</li>
<li>
<p><strong>Page</strong> ：它是先前版本中的默认设置。选中后，它将强制页面始终适合窗口的100％高度。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_preview_feature"><a class="anchor" href="#_preview_feature"></a> <a class="link" href="#_preview_feature">21.22.1.2。预览功能</a></h5>
<div class="paragraph">
<p>页面作者可以根据需要从<em>编辑器</em>来回切换到“ <em>预览”</em>模式。在“ <em>预览”</em>模式下，所有编辑器的控件都将被删除，从而可以显示页面，就像最终用户在页面发布后所看到的那样。</p>
</div>
</div>
<div class="sect4">
<h5 id="_use_dock_panels_to_increase_the_editor_content_area"><a class="anchor" href="#_use_dock_panels_to_increase_the_editor_content_area"></a> <a class="link" href="#_use_dock_panels_to_increase_the_editor_content_area">21.22.1.3。使用停靠面板增加编辑器内容区域</a></h5>
<div class="paragraph">
<p>为了增加编辑器中心区域的可用空间，页面列表，导航配置和组件面板均已作为停靠面板移至左侧边栏。</p>
</div>
</div>
<div class="sect4">
<h5 id="_component_palette_reorganization"><a class="anchor" href="#_component_palette_reorganization"></a> <a class="link" href="#_component_palette_reorganization">21.22.1.4。组件面板重组</a></h5>
<div class="paragraph">
<p>在以前的版本中，调色板中仅存在一个单一类别的组件。从7.6版开始，这些组件现在分为三个主要类别：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>核心</em> ：HTML和Page组件</p>
</li>
<li>
<p><em>导航</em> ：菜单栏，树，图块，选项卡列表，轮播和目标分区</p>
</li>
<li>
<p><em>报告</em> ：条形图，饼图，线，面积，地图，气泡，公制，仪表，表格和过滤器</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这些更改的目的是使调色板更具吸引力，并简化要拖动的目标组件的选择。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kieserver.releasenoteskie.7.5.1"><a class="anchor" href="#_kieserver.releasenoteskie.7.5.1"></a> <a class="link" href="#_kieserver.releasenoteskie.7.5.1">21.23。新的Drools控制器客户端API</a></h3>
<div class="paragraph">
<p>为了简化与Drools控制器相关的任务的管理，例如创建服务器模板，启动和停止容器等，我们开发了一个新的Java客户端API，可在kie-server-controller-client Maven模块下使用。使用此API，您可以使用REST或Web套接字协议连接到Drools控制器。有关更多详细信息，请参阅<a href="#ControllerJavaAPI-section.adoc">Drools控制器客户端API</a>章节。</p>
</div>
</div>
<div class="sect2">
<h3 id="_breaking_changes_in_kie_server_7_5_1_from_7_0"><a class="anchor" href="#_breaking_changes_in_kie_server_7_5_1_from_7_0"></a> <a class="link" href="#_breaking_changes_in_kie_server_7_5_1_from_7_0">21.24。从7.0更改Kie Server 7.5.1中的重大更改</a></h3>
<div class="sect3">
<h4 id="_drools_controller_api_changes"><a class="anchor" href="#_drools_controller_api_changes"></a> <a class="link" href="#_drools_controller_api_changes">21.24.1。Drools控制器API更改</a></h4>
<div class="paragraph">
<p>更改为<code>SpecManagementService</code>接口：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>包含的新方法<code>getContainerInfo</code>允许检索单个<code>ContainerSpec</code>定义在<code>ServerTemplate</code> 。</p>
</li>
<li>
<p>改变方法<code>listContainerSpec</code> ， <code>listServerTemplateKeys</code>和<code>listServerTemplates</code>将类型从通用集合返回到特定的域列表类型（ <code>ContainerSpecList</code> ， <code>ServerTemplateKeyList</code>和<code>ServerTemplateList</code> ），以便使用JAXB和JSON正确地序列化和反序列化返回的值。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>更改为<code>RuleCapabilitiesService</code>接口：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>startScanner</code>方法现在使用<code>java.lang.Long</code>时间而不是原始时间<code>long</code>为了<code>interval</code>参数以避免JSON和JAXB序列化问题。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>更改为<code>RuntimeManagementService</code>接口：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>改变方法<code>getContainers</code>和<code>getServerInstances</code>将类型从通用集合返回到特定的域列表类型（ <code>ContainerList</code>和<code>ServerInstanceKeyList</code> ），以便使用JAXB和JSON正确地序列化和反序列化返回的值。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>有关更多详细信息，请参见<a href="https://issues.jboss.org/browse/JBPM-6243">JBPM-6243</a> 。</p>
</div>
</div>
<div class="sect3">
<h4 id="_kie_server_api_changes"><a class="anchor" href="#_kie_server_api_changes"></a> <a class="link" href="#_kie_server_api_changes">21.24.2。Kie Server API更改</a></h4>
<div class="paragraph">
<p>更改为<code>ServiceResponse</code>包装器：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>感动<code>ResponseType</code>枚举和通用方法的新接口称为<code>KieServiceResponse</code> ，从而可以将其扩展到多种实现。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.5.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.5.0.final"></a> <a class="link" href="#_wb.releasenotesworkbench.7.5.0.final">21.25。KIE Workbench 7.5.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_content_management_enhancements_3"><a class="anchor" href="#_content_management_enhancements_3"></a> <a class="link" href="#_content_management_enhancements_3">21.25.1。内容管理增强</a></h4>
<div class="paragraph">
<p>为了改善用户体验，“ <em>内容管理”</em> （又名“ <em>仪表板”</em> ）工具中引入了显着更改。</p>
</div>
<div class="sect4">
<h5 id="_perspective_to_page_renaming"><a class="anchor" href="#_perspective_to_page_renaming"></a> <a class="link" href="#_perspective_to_page_renaming">21.25.1.1。透视页面重命名</a></h5>
<div class="paragraph">
<p>用户对“页面”一词更为熟悉。注意，“透视图”是从Eclipse开发工具中借用的概念，因此，它是开发人员圈子中最常用的概念。页面与Web内容更相关，普通人更容易理解。因此，透视图已重命名为整个工具页面。</p>
</div>
</div>
<div class="sect4">
<h5 id="_left_sidebar_new_look_and_feel"><a class="anchor" href="#_left_sidebar_new_look_and_feel"></a> <a class="link" href="#_left_sidebar_new_look_and_feel">21.25.1.2。左侧边栏新外观</a></h5>
<div class="paragraph">
<p>这是最引人注目的变化。左侧边栏已被完全重写，以提供增强的外观。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/ContentManagement/ContentManagementLeftSideBar.png" alt="ContentManagementLeftSideBar">
</div>
<div class="title">图404。内容管理工具的左侧栏</div>
</div>
<div class="paragraph">
<p><em>页面</em>和<em>导航</em>这两个部分已合并到一个视图中。在此视图中，用户可以创建新页面或更改导航配置。</p>
</div>
<div class="paragraph">
<p><em>导航</em>部分列出了导航树。具体来说，默认情况下名为“ <em>工作台”</em>的树是可用的，不能删除，并且它包含在工作台的顶部大型菜单中显示的条目。对其进行的任何更改都将导致大型菜单修改其条目。实际上，这是用户使用新页面扩展工作台所必须使用的机制。</p>
</div>
</div>
<div class="sect4">
<h5 id="_tags_button_disabled"><a class="anchor" href="#_tags_button_disabled"></a> <a class="link" href="#_tags_button_disabled">21.25.1.3。标签按钮已禁用</a></h5>
<div class="paragraph">
<p>标签功能或在编辑期间将一组标签附加到页面上的功能已被删除。此功能与以前的“ Apps”透视图结合使用，允许用户以分类的方式发布其动态页面。不再需要此功能。在页面的编辑过程中，曾经出现在编辑器右上角按钮栏中的“ <em>标签”</em>按钮已被删除。</p>
</div>
<div class="paragraph">
<p>作为替代，用户可以利用现有的导航功能来创建新页面并将其附加到工作台的大型菜单。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_extra_navigation_components"><a class="anchor" href="#_extra_navigation_components"></a> <a class="link" href="#_extra_navigation_components">21.25.2。额外的导航组件</a></h4>
<div class="paragraph">
<p><em>内容管理</em>工具中可用的现有导航组件已经扩展了一些其他类型。迄今为止，存在以下组件：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>瓷砖导航器</p>
</li>
<li>
<p>标签列表</p>
</li>
<li>
<p>轮播</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>最近在发行版中添加了以下内容：</p>
</div>
<div class="sect4">
<h5 id="_menu_bar"><a class="anchor" href="#_menu_bar"></a> <a class="link" href="#_menu_bar">21.25.2.1。菜单栏</a></h5>
<div class="paragraph">
<p>顾名思义，此组件以菜单栏形状显示导航树的条目。对支持的级别数量没有限制。单击页面项目后，页面内容将显示在菜单栏配置中指定的“ <em>目标div”</em> （请参见下面的详细信息）组件中。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/ContentManagement/MenubarComponent.png" alt="MenubarComponent">
</div>
<div class="title">图405。菜单栏导航组件</div>
</div>
</div>
<div class="sect4">
<h5 id="_tree_navigator"><a class="anchor" href="#_tree_navigator"></a> <a class="link" href="#_tree_navigator">21.25.2.2。树导航器</a></h5>
<div class="paragraph">
<p>与<em>菜单栏</em>相同，但条目显示为垂直树结构。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/ContentManagement/TreeNavigatorComponent.png" alt="TreeNavigatorComponent">
</div>
<div class="title">图406。菜单栏导航组件</div>
</div>
</div>
<div class="sect4">
<h5 id="_target_div"><a class="anchor" href="#_target_div"></a> <a class="link" href="#_target_div">21.25.2.3。目标div</a></h5>
<div class="paragraph">
<p><em>Carousel</em>和<em>Tile导航器</em>组件都可以自己处理用户单击的项目的显示。其他<em>选项卡（</em>如<em>Tab列表</em> ， <em>菜单栏</em>和<em>Tree导航器）</em>需要<em>Target div</em>组件作为其显示输出，因为它们的条目显示和最后单击的内容之间有明显的分隔。</p>
</div>
<div class="paragraph">
<p>因此，每次将基于<em>Target div</em>的导航组件拖放到页面中时，也必须同时拖放<em>Target div</em>组件，以便第一个组件可以链接到该组件。以下屏幕显示了配置面板，每次将基于目标div的组件放入页面时都会显示该面板。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/ContentManagement/NavComponentTargetDivModal.png" alt="NavComponentTargetDivModal">
</div>
<div class="title">图407。基于目标div的导航组件配置</div>
</div>
<div class="paragraph">
<p>导航组对于所有导航组件都是必需的，因为它指示要显示的导航结构，而<em>目标div</em>设置<strong>不适</strong>用于非目标div组件，例如<em>Carousel</em>或<em>Tile导航器</em> 。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.4.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.4.0.final"></a> <a class="link" href="#_wb.releasenotesworkbench.7.4.0.final">21.26。KIE Workbench 7.4.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_guided_decision_table_improvements"><a class="anchor" href="#_guided_decision_table_improvements"></a> <a class="link" href="#_guided_decision_table_improvements">21.26.1。指导决策表改进</a></h4>
<div class="paragraph">
<p>除了修复许多错误外，还改进了用于创建和编辑列的向导，以显示对不同列类型所需的不同步骤的描述。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/dtable-wizard-help-text1.png" alt="dtable向导帮助text1">
</div>
<div class="title">图408。指导决策表向导示例1</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/dtable-wizard-help-text2.png" alt="dtable向导帮助text2">
</div>
<div class="title">图409。指导决策表向导示例2</div>
</div>
</div>
<div class="sect3">
<h4 id="_disable_experimental_editors"><a class="anchor" href="#_disable_experimental_editors"></a> <a class="link" href="#_disable_experimental_editors">21.26.2。停用实验性编辑器</a></h4>
<div class="paragraph">
<p>以下功能被认为是实验性的，可以使用“安全性/用户管理”管理屏幕来禁用：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>指导决策树编辑器</p>
</li>
<li>
<p>导游记分卡编辑器</p>
</li>
<li>
<p>XLS计分卡编辑器</p>
</li>
<li>
<p>（新）BPMN2流程编辑器</p>
</li>
<li>
<p>部署/服务器配置透视图</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这些功能默认情况下处于启用状态。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/disable-experimental-features1.png" alt="停用实验功能1">
</div>
<div class="title">图410。禁用编辑器</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.3.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.3.0.final"></a> <a class="link" href="#_wb.releasenotesworkbench.7.3.0.final">21.27。KIE Workbench 7.3.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_new_home_and_menu_bar"><a class="anchor" href="#_new_home_and_menu_bar"></a> <a class="link" href="#_new_home_and_menu_bar">21.27.1。新家和菜单栏</a></h4>
<div class="paragraph">
<p>主页，菜单栏和关于弹出窗口现在具有新设计。菜单项分为代表主要功能区域的组。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Home/home-with-menu-expanded.png" alt="菜单扩展的家">
</div>
<div class="title">图411。展开菜单的主视图</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Home/about-popup.png" alt="关于弹出">
</div>
<div class="title">图412。关于弹出</div>
</div>
</div>
<div class="sect3">
<h4 id="_admin_page_changes"><a class="anchor" href="#_admin_page_changes"></a> <a class="link" href="#_admin_page_changes">21.27.2。管理员页面更改</a></h4>
<div class="paragraph">
<p>现在，可以通过菜单栏上的齿轮图标访问“管理”页面，其中包含更多项目。对透视图工件，数据集，数据源和语言选项的访问已移至此处。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Home/admin-page-7-3-x.png" alt="管理页面7 3 x">
</div>
<div class="title">图413。管理员页面</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.1.0"><a class="anchor" href="#_drools.releasenotesdrools.7.1.0"></a> <a class="link" href="#_drools.releasenotesdrools.7.1.0">21.28。Drools 7.1中的新功能和值得注意的功能</a></h3>

</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.1.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.1.0.final"></a> <a class="link" href="#_wb.releasenotesworkbench.7.1.0.final">21.29。KIE Workbench 7.1.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_project_metrics_dashboard"><a class="anchor" href="#_project_metrics_dashboard"></a> <a class="link" href="#_project_metrics_dashboard">21.29.1。项目指标仪表板</a></h4>
<div class="paragraph">
<p>现在，创作库中列出的每个项目都可以使用全新的仪表板。打开项目详细信息页面后，指标卡会显示在屏幕右侧。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/project-metrics-card.png" alt="项目指标卡">
</div>
<div class="title">图414。项目指标卡</div>
</div>
<div class="paragraph">
<p>该卡显示一段时间内对该特定项目所做的贡献（承诺）的历史记录。单击<em>查看全部</em>链接以访问完整的仪表板，该仪表板显示有关项目贡献的所有指标。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/project-metrics-dashboard.png" alt="项目指标仪表板">
</div>
<div class="title">图415。项目指标仪表板</div>
</div>
<div class="paragraph">
<p>请注意，可使用不同的过滤器控件来选择由具体用户或在特定时间范围内做出的贡献。</p>
</div>
</div>
<div class="sect3">
<h4 id="_teams_metrics_dashboard"><a class="anchor" href="#_teams_metrics_dashboard"></a> <a class="link" href="#_teams_metrics_dashboard">21.29.2。团队指标仪表板</a></h4>
<div class="paragraph">
<p>全新的仪表板也已添加到“团队”页面。右侧的指标卡显示所有贡献（提交）的历史记录。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/teams-metrics-card.png" alt="团队指标卡">
</div>
<div class="title">图416。球队指标卡</div>
</div>
<div class="paragraph">
<p>单击<em>查看全部</em>链接以访问完整的仪表板，其中显示了总体贡献指标。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/teams-metrics-dashboard.png" alt="团队指标仪表板">
</div>
<div class="title">图417。团队指标仪表板</div>
</div>
<div class="paragraph">
<p>请注意，有不同的过滤器控件可用于通过不同的标准选择贡献：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>由一个具体的用户，</p>
</li>
<li>
<p>在特定时间范围内，</p>
</li>
<li>
<p>按团队或</p>
</li>
<li>
<p>按项目。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>该仪表板替代了以前的<em>Authoring> Contributors</em>仪表板，该仪表板在工作台的顶部菜单栏中不再可用。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.0.0"><a class="anchor" href="#_drools.releasenotesdrools.7.0.0"></a> <a class="link" href="#_drools.releasenotesdrools.7.0.0">21.30。Drools 7.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_core_engine"><a class="anchor" href="#_core_engine"></a> <a class="link" href="#_core_engine">21.30.1。核心引擎</a></h4>
<div class="sect4">
<h5 id="_dmn_runtime_support"><a class="anchor" href="#_dmn_runtime_support"></a> <a class="link" href="#_dmn_runtime_support">21.30.1.1。DMN运行时支持</a></h5>
<div class="paragraph">
<p>Drools现在对DMN（决策模型和表示法）具有完整的运行时支持。DMN文件现在是资产，可以添加到任何kjar中以执行。有关如何构建和执行DMN模型的详细信息，请参考<a href="#drools.DMN">DMN部分</a> 。</p>
</div>
<div class="paragraph">
<p>目前，不支持DMN创作，但将来的版本将支持该创作。</p>
</div>
</div>
<div class="sect4">
<h5 id="_multithreaded_evaluation_in_the_drools_engine"><a class="anchor" href="#_multithreaded_evaluation_in_the_drools_engine"></a> <a class="link" href="#_multithreaded_evaluation_in_the_drools_engine">21.30.1.2。Drools引擎中的多线程评估</a></h5>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p>此功能在Drools 7.0中是实验性的。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>在Drools 7.0中，Drools引擎现在可以通过将RETE和PHREAK模式匹配算法划分为独立分区并进行并行评估来并行评估更多业务规则。</p>
</div>
<div class="paragraph">
<p>默认情况下，在Drools中禁用多线程评估。要为并行KIE基础启用多线程评估，请使用以下选项之一：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>通过以下方式启用多线程评估<code>KieBaseConfiguration</code> ：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>KieServices ks = KieServices.Factory.get();
KieBaseConfiguration kieBaseConf = ks.newKieBaseConfiguration();
kieBaseConf.setOption(MultithreadEvaluationOption.YES);
KieBase kieBase = kieContainer.newKieBase(kieBaseConf);</code></pre>
</div>
</div>
</li>
<li>
<p>启用多线程评估系统属性：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>drools.multithreadEvaluation = true</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p>并行Drools引擎当前不支持使用查询，显着性或议程组的规则。如果KIE库中存在这些规则元素，则编译器将发出警告并自动切换回单线程评估。但是，在某些情况下，Drools引擎可能无法检测到不受支持的规则元素，并且可能会错误地评估规则。例如，Drools引擎可能无法检测规则何时依赖DRL文件中规则排序所提供的隐式显着性，从而由于不支持的显着性属性而导致评估不正确。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_oopath_improvements"><a class="anchor" href="#_oopath_improvements"></a> <a class="link" href="#_oopath_improvements">21.30.1.3。OOPath改进</a></h5>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p>此功能是实验性的</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>OOPath是在Drools 6.3.0中引入的，但是在Drools 7.0.0中，语法已稍作更改以使其更接近于标准xpath one。这意味着必须在方括号之间放置约束，而不是大括号，并且必须在约束之外表达内联强制转换。例如，以下以6.x语法表示的oopath：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/list{#SubClass, prop == 0}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在Drools 7.x中变为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/list#SubClass[prop == 0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>此外，Drools 7.0.0改进了对标准Java Collection的支持，并为<code>List</code>和<code>Set</code> ，作为专业<code>ReactiveList</code>和<code>ReactiveSet</code> ;一种<code>ReactiveCollection</code>也可以。当通过它们的操作执行可变操作时，这还包括开箱即用的反应性支持<code>Iterator</code>和<code>ListIterator</code> 。</p>
</div>
<div class="listingblock">
<div class="title">例：</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class School extends AbstractReactiveObject {
    private String name;
    private final List&lt;Child&gt; children = new ReactiveList&lt;Child&gt;(); <i class="conum" data-value="1"></i><b>(1)</b>

    public void setName(String name) {
        this.name = name;
        notifyModification(); <i class="conum" data-value="2"></i><b>(2)</b>
    }

    public void addChild(Child child) {
        children.add(child); <i class="conum" data-value="3"></i><b>(3)</b>
        // no need to call notifyModification() here.
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>使用专业<code>ReactiveList</code>通过标准Java提供反应性支持<code>List</code> 。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>通常<code>notifyModification()</code>更改字段以进行反应性支持时需要调用</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i> <b>3</b></td>
<td>但是在<code>ReactiveList</code>这是自动处理的，就像在该字段上执行的所有其他变异操作一样<code>children</code> 。</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">作为最佳实践，建议声明反应式收集字段<code>final</code>按照所示示例。
</td>
</tr>
</tbody></table>
</div>
<div class="sect5">
<h6 id="_oopath_maven_plug_in"><a class="anchor" href="#_oopath_maven_plug_in"></a> <a class="link" href="#_oopath_maven_plug_in">OOPath Maven插件</a></h6>
<div class="paragraph">
<p>Kie Maven插件提供了新的目标<code>injectreactive</code>检测字节码并自动注入对标准情况的反应性支持。</p>
</div>
<div class="paragraph">
<p>的<code>injectreactive</code>默认情况下，目标是禁用的，并且可以通过Maven插件配置启用<code>instrument-enabled</code>设置。</p>
</div>
<div class="listingblock">
<div class="title">例：</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;groupId&gt;org.kie&lt;/groupId&gt;
&lt;artifactId&gt;kie-maven-plugin&lt;/artifactId&gt;
&lt;extensions&gt;true&lt;/extensions&gt;
&lt;configuration&gt;
    &lt;instrument-enabled&gt;true&lt;/instrument-enabled&gt; <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>启用<code>injectreactive</code>目标。</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>的<code>injectreactive</code>目标将检测与Maven项目构建的输出目录有关的字节码<code>${project.build.outputDirectory}</code> 。</p>
</div>
<div class="paragraph">
<p>可以通过Maven插件配置将目标范围限制为特定软件包或软件包层次结构<code>instrument-packages</code>设置列表。。例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;groupId&gt;org.kie&lt;/groupId&gt;
&lt;artifactId&gt;kie-maven-plugin&lt;/artifactId&gt;
&lt;extensions&gt;true&lt;/extensions&gt;
&lt;configuration&gt;
    &lt;instrument-enabled&gt;true&lt;/instrument-enabled&gt;
    &lt;instrument-packages&gt;
        &lt;instrumentPackage&gt;to.instrument&lt;/instrumentPackage&gt; <i class="conum" data-value="1"></i><b>(1)</b>
        &lt;instrumentPackage&gt;org.drools.compiler.xpath.tobeinstrumented.*&lt;/instrumentPackage&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    &lt;/instrument-packages&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i> <b>1个</b></td>
<td>将检测范围专门限制为<code>to.instrument</code>仅包装。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i> <b>2</b></td>
<td>将检测范围限制为<code>org.drools.compiler.xpath.tobeinstrumented</code>和它的子包。</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>在以下标准情况下，该插件将为每个字段分配检测字节码：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>现场分配也会触发<code>notifyModification()</code></p>
</li>
<li>
<p>将任何定义为List的字段包装为<code>ReactiveList</code></p>
</li>
<li>
<p>将定义为Set的任何字段包装为<code>ReactiveSet</code></p>
</li>
<li>
<p>将定义为Collection的任何字段包装为<code>ReactiveCollection</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">为了正确包装List / Set类型的字段，必须使用以下两种方法之一专门声明java类的字段成员： <code>java.util.Collection</code> ， <code>java.util.List</code>要么<code>java.util.Set</code> （例如，将一个字段声明为<code>java.util.ArrayList</code>不会配备专门的反应性集合）。
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">不建议将对响应性的手动支持（手动实现）和字节码检测Maven插件混合使用；最好设想将这两个范围区分开来，例如，通过使用插件配置仅对上述特定软件包进行检测。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>以下部分提供了插件工具的详细示例。</p>
</div>
<div class="sect6">
<h7 id="_instrumentation_of_field_assignments"><a class="anchor" href="#_instrumentation_of_field_assignments"></a> <a class="link" href="#_instrumentation_of_field_assignments">现场作业检测</a></h7>
<div class="paragraph">
<p>如下例所示的字段分配：</p>
</div>
<div class="listingblock">
<div class="title">原版的：</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Toy {
    private String owner;
    ...

    public void setOwner(String owner) {
        this.owner = owner;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>将通过拦截字段分配并触发<code>notifyModification()</code> ：</p>
</div>
<div class="listingblock">
<div class="title">结果：</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Toy implements ReactiveObject {
    private String owner;
    ...

    public void setOwner(final String owner) {
        this.$$_drools_write_owner(owner);
    }

    public void $$_drools_write_owner(final String owner) {
        this.owner = owner;
        ReactiveObjectUtil.notifyModification((ReactiveObject) this);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，仅当字段不是<code>Collection</code> 。</p>
</div>
<div class="paragraph">
<p>如果现场分配是指一个<code>List</code>或一个<code>Set</code> ，检测将使用<code>ReactiveList</code>要么<code>`ReactiveSet</code>相应地例如：</p>
</div>
<div class="listingblock">
<div class="title">原版的：</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class School {
    private final String name;
    private final List&lt;Child&gt; children = new ArrayList&lt;Child&gt;();
    ...

    public School(String name) {
        this.name = name;
    }

    public List&lt;Child&gt; getChildren() {
        return children;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>将通过拦截和包装来检测<code>ReactiveList</code> ：</p>
</div>
<div class="listingblock">
<div class="title">结果：</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class School implements ReactiveObject {
    private final String name;
    private final List&lt;Child&gt; children;

    public School(final String name) {
        this.$$_drools_write_children(new ArrayList());
        this.name = name;
    }

    public List&lt;Child&gt; getChildren() {
        return this.children;
    }

    public void $$_drools_write_children(final List list) {
        this.children = (List&lt;Child&gt;) new ReactiveList(list);
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_pmml_support"><a class="anchor" href="#_pmml_support"></a> <a class="link" href="#_pmml_support">21.30.1.4。PMML支持</a></h5>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p>此功能是实验性的</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">此功能使用<a href="#drl-rule-units-con">规则单位</a>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>现在，Drools支持符合预测建模标记语言（PMML）子集的资产。现在支持以下预测模型类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>回归</p>
</li>
<li>
<p>计分卡</p>
</li>
<li>
<p>树</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>此外，“挖掘”模型类型具有部分支持。当前具有以下模式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>模型链</p>
</li>
<li>
<p>全选</p>
</li>
<li>
<p>首先选择</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>当它们可用时，将支持其他操作模式。</p>
</div>
</div>
<div class="sect4">
<h5 id="_soft_expiration_for_events"><a class="anchor" href="#_soft_expiration_for_events"></a> <a class="link" href="#_soft_expiration_for_events">21.30.1.5。事件的软到期</a></h5>
<div class="paragraph">
<p>在Drools 6.x中明确定义事件到期时，始终将其视为硬到期，这意味着它始终优先于在涉及该事件的时间窗口和约束上隐式计算的任何其他到期。Drools 7还允许为推断的过期偏移量为无限大时可以使用的事件指定软过期。通过这种方式，可以保证有一个到期日，该到期日可以是推断的一个，也可以是指定的一个，如果另一个缺失。此外，这意味着规则创建者不需要在所有规则中都包括时间约束，然后即使没有知道规则也可以设计事件类。</p>
</div>
<div class="paragraph">
<p>默认情况下，事件过期被认为是很难的，但是可以更改过期策略并定义软过期，或者通过以下方式注释事件的类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Role(Role.Type.EVENT)
@Expires( value = "30s", policy = TIME_SOFT )
public class MyEvent { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>或使用类型声明：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>declare MyEvent
  @role( event )
  @expires(value = 30s, policy = TIME_SOFT)
end</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rule_units"><a class="anchor" href="#_rule_units"></a> <a class="link" href="#_rule_units">21.30.1.6。规则单位</a></h5>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p>此功能是实验性的</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>规则单元代表一种纯粹的声明性方法，用于将规则集划分为较小的单元，将不同的数据源绑定到这些单元，并协调各个单元的执行。规则单元是数据源，全局变量和规则的集合。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_business_central_2"><a class="anchor" href="#_business_central_2"></a> <a class="link" href="#_business_central_2">21.30.2。商业中心</a></h4>
<div class="paragraph">
<p>除了对Business Central的一般改进（在下面的单独部分中列出）之外，Business Central中还提供了一些Drools特定的增强功能。</p>
</div>
<div class="sect4">
<h5 id="_dmn_style_hit_policies_for_decision_tables"><a class="anchor" href="#_dmn_style_hit_policies_for_decision_tables"></a> <a class="link" href="#_dmn_style_hit_policies_for_decision_tables">21.30.2.1。决策表的DMN样式匹配策略</a></h5>
<div class="paragraph">
<p>对于每个点击策略，默认情况下，一行优先于其下方的每一行。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>唯一匹配使用唯一匹配策略，每一行都必须唯一，这意味着不能重叠。如果“验证”功能在开发时就发出警告，则永远不会出现两行可以触发的情况。</p>
</li>
<li>
<p>先发命中先发命中只触发一排，从上到下首先满足的那一行。</p>
</li>
<li>
<p>解决的命中与“第一次命中”相似，但是例如，您可以赋予第10行高于第5行的优先级。这意味着您可以保留想要的行的顺序以提高视觉可读性，但是可以指定优先级例外。</p>
</li>
<li>
<p>规则顺序可能触发多行，并且验证行不会发生，因此验证不会报告有关行之间的冲突的信息。</p>
</li>
<li>
<p>无这是正常的击中模式。默认情况下，旧的决策表将使用此选项，但是由于7.0使用PHREAK，因此行顺序现在很重要。旧表不需要迁移工具。多行可能会触发。验证警告有关发生冲突的行。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_guided_rule_editor_support_formulae_in_composite_field_constraints"><a class="anchor" href="#_guided_rule_editor_support_formulae_in_composite_field_constraints"></a> <a class="link" href="#_guided_rule_editor_support_formulae_in_composite_field_constraints">21.30.2.2。指导规则编辑器：复合字段约束中的支持公式</a></h5>
<div class="paragraph">
<p>现在，复合字段约束支持公式的使用。</p>
</div>
<div class="paragraph">
<p>将约束添加到模式时，“多字段约束”选择（“所有（和）”和“任何一个（或）”）支持使用除表达式之外的公式。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/composite-field-constraint-formulae1.png" alt="复合场约束公式1">
</div>
<div class="title">图418。复合字段约束-选择公式</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/composite-field-constraint-formulae2.png" alt="复合场约束公式2">
</div>
<div class="title">图419。复合字段约束-公式编辑器</div>
</div>
</div>
<div class="sect4">
<h5 id="_guided_decision_table_editor_new_editor"><a class="anchor" href="#_guided_decision_table_editor_new_editor"></a> <a class="link" href="#_guided_decision_table_editor_new_editor">21.30.2.3。指导决策表编辑器：新编辑器</a></h5>
<div class="paragraph">
<p>指导决策表编辑器已被广泛重写，以支持在同一编辑器中编辑多个表。共享关联的表之间可见链接，从而使关联关系的可视化变得更加容易。从创建或更新另一个表的条件所消耗的事实的操作中推断出关联。</p>
</div>
<div class="paragraph">
<p>重点包括：-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>新外观</p>
</li>
<li>
<p>可调整大小的列</p>
</li>
<li>
<p>通过拖放“在表格中”对列进行重新排序</p>
</li>
<li>
<p>通过拖放“在表格中”对行进行重新排序</p>
</li>
<li>
<p>通过拖放来重新放置表格</p>
</li>
<li>
<p>平移视图以滚动内容</p>
</li>
<li>
<p>可缩放的视图，因此您可以“缩小”以一次查看更多内容</p>
</li>
<li>
<p>每个决策表的文件锁定和版本历史记录</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/dtables-new-editor.png" alt="dtables新编辑器">
</div>
<div class="title">图420。新编辑</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/dtables-new-editor-multiple.png" alt="dtables新编辑器多个">
</div>
<div class="title">图421。新编辑器-多个打开的表</div>
</div>
</div>
<div class="sect4">
<h5 id="_guided_decision_table_editor_caching_of_enumeration_lookups"><a class="anchor" href="#_guided_decision_table_editor_caching_of_enumeration_lookups"></a> <a class="link" href="#_guided_decision_table_editor_caching_of_enumeration_lookups">21.30.2.4。指导决策表编辑器：缓存枚举查找</a></h5>
<div class="paragraph">
<p>指导决策表编辑器长期以来一直能够使用枚举定义。但是，由于表可能包含许多单元，因此如果定义需要服务器往返以从帮助程序类中检索查找，则枚举的性能有时可能不理想。</p>
</div>
<div class="paragraph">
<p>服务器往返的结果现在缓存在客户端中，因此在修改单元时无需进行连续的网络调用。打开编辑器并按需填充时，将初始化缓存。</p>
</div>
</div>
<div class="sect4">
<h5 id="_guided_decision_table_editor_verification_and_validation"><a class="anchor" href="#_guided_decision_table_editor_verification_and_validation"></a> <a class="link" href="#_guided_decision_table_editor_verification_and_validation">21.30.2.5。指导决策表编辑器：验证和确认</a></h5>
<div class="sect5">
<h6 id="_system_property"><a class="anchor" href="#_system_property"></a> <a class="link" href="#_system_property">系统属性</a></h6>
<div class="paragraph">
<p>可以使用系统属性禁用验证和确认<strong><code></code></strong> <code>org.kie.verification.disable-dtable-realtime-verification<strong></strong></code> 。这对于大型决策表或用户想忽略V＆V很有用。</p>
</div>
</div>
<div class="sect5">
<h6 id="_range_checks"><a class="anchor" href="#_range_checks"></a> <a class="link" href="#_range_checks">范围检查</a></h6>
<div class="paragraph">
<p>验证将采取第一步，以帮助您制定完整的决策表。在下一个版本中，我们添加了对检查布尔值，数字和日期值是否覆盖所有范围的支持。这意味着，如果您的表上有检查是否批准了申请的检查，则验证报告将提醒您确保您还处理未批准申请的情况。</p>
</div>
</div>
<div class="sect5">
<h6 id="_unique_single_hit"><a class="anchor" href="#_unique_single_hit"></a> <a class="link" href="#_unique_single_hit">独特的单曲</a></h6>
<div class="paragraph">
<p>过去，如果各行相互包含，则验证和确认会引发问题。如果一行包含另一行，则可以用同一组事实满足条件。表示同一张表中的两行可以同时触发。在某些情况下，包含并不重要，但是在其他情况下，您希望有一个表，其中一次仅触发一个规则。该表然后是单个命中决策表。为了帮助制作仅可触发一行的单个命中表，验证会密切注意条件。报告单次点击中断时的情况。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_breaking_changes_in_drools_7_0_from_6_x"><a class="anchor" href="#_breaking_changes_in_drools_7_0_from_6_x"></a> <a class="link" href="#_breaking_changes_in_drools_7_0_from_6_x">21.31。从6.x到Drools 7.0的重大更改</a></h3>
<div class="sect3">
<h4 id="_property_reactivity_enabled_by_default"><a class="anchor" href="#_property_reactivity_enabled_by_default"></a> <a class="link" href="#_property_reactivity_enabled_by_default">21.31.1。默认情况下启用属性反应</a></h4>
<div class="paragraph">
<p>属性反应性已在Drools 5.4中引入，但用户必须通过以下方式逐个类显式地启用它<code>@PropertyReactive</code>注释或使用<code>PropertySpecificOption.ALWAYS</code>生成器选项。但是，由于在正确性和性能方面都认为使用此功能是一种很好的做法，因此在Drools 7.0中已默认启用它。如果需要，可以通过向kmodule.xml文件中添加以下配置来禁用属性反应性并将Drools 7.0重新配置为与6.x版完全相同。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;configuration&gt;
  &lt;property key="drools.propertySpecific" value="ALLOWED"/&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_type_preserving_accumulate_functions"><a class="anchor" href="#_type_preserving_accumulate_functions"></a> <a class="link" href="#_type_preserving_accumulate_functions">21.31.2。类型保留累加函数</a></h4>
<div class="paragraph">
<p>在Drools 6中使用<code>sum</code>函数在累加模式中的结果始终为Double，与执行求和的字段类型无关。这导致以下3个问题：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>精度损失：很长的总和<code>1881617265586265321L</code>将错误地返回<code>1.88161726558626534E18</code> 。BigDecimal的总和<code>0.09</code>和<code>0.01</code>也将是不正确的。</p>
</li>
<li>
<p>性能损失：用Double总计求和要比用Long或Integer求和慢得多。</p>
</li>
<li>
<p>复杂的泄漏：它迫使用户在Double上进行模式匹配，或者在Number上进行更通用的（建议选择）模式，而在Integer类型的字段上求和的结果也将是Integer。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>相反，Drools 7会保留在其上执行求和的表达式的类型，因此可以直接在该类型上进行匹配，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Long(...) from accumulate(..., sum($p.getLongWeight()))</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_renaming_timedruleexecutionoption"><a class="anchor" href="#_renaming_timedruleexecutionoption"></a> <a class="link" href="#_renaming_timedruleexecutionoption">21.31.3。重命名TimedRuleExecutionOption</a></h4>
<div class="paragraph">
<p>用于控制何时必须自动执行定时规则的KieSession选项已重命名为<code>TimedRuleExecutionOption</code>修复其名称中的键入错误，该错误会影响以前的版本；该物业已与<code>drools.timedRuleExecution</code> 。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表103。名称变更</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">以前的版本</th>
<th class="tableblock halign-left valign-top">版<code>7.0.0.Final</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KieSession选项</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TimedRuleExectionOption</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TimedRuleExecutionOption</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>drools.timedRuleExection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>drools.timedRuleExecution</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_renaming_and_unification_of_configuration_files"><a class="anchor" href="#_renaming_and_unification_of_configuration_files"></a> <a class="link" href="#_renaming_and_unification_of_configuration_files">21.31.4。重命名和统一配置文件</a></h4>
<div class="paragraph">
<p>在Drools 6.x中，默认的Drools配置属性是在两个不同的文件中配置的：* <code>drools.default.rulebase.conf</code>位于drools-core的META-INF文件夹中* <code>drools.default.packagebuilder.conf</code>位于drools-compiler的META-INF文件夹中</p>
</div>
<div class="paragraph">
<p>在Drools 7.0.0中，这些文件被统一为一个名为<code>kie.default.properties.conf</code> ，位于drools-core的META-INF文件夹中。如果要覆盖这些属性的默认值或添加自己的属性，可以将它们放在一个名为<code>kie.properties.conf</code>位于项目的META-INF文件夹中。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.0.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.0.0.final"></a> <a class="link" href="#_wb.releasenotesworkbench.7.0.0.final">21.32。KIE Workbench 7.0.0中的新功能和值得注意的功能</a></h3>
<div class="paragraph">
<p>工作台已更新，以支持Wildfly 10和EAP7。Java的最低要求是JDK8。</p>
</div>
<div class="sect3">
<h4 id="_new_authoring_library"><a class="anchor" href="#_new_authoring_library"></a> <a class="link" href="#_new_authoring_library">21.32.1。新创作（图书馆）</a></h4>
<div class="paragraph">
<p>创作现在有了新的设计，拥有更好的信息组织。现在可以管理（创建，删除和编辑）团队（组织单位），在存储库中列出项目并在项目中列出资产。选择资产后，您可以看到资产编辑器和项目资源管理器。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>库使用工作台的索引。因此， <strong>必须</strong>删除现有索引信息，以便工作台可以使用必要的信息来重建它们。索引信息存储在<code>.index</code>应用程序服务器中的文件夹<code>\bin</code>文件夹（或者您可能已经使用<code>org.uberfire.metadata.index.dir</code>系统属性）。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/library-teams-view.png" alt="图书馆团队观点">
</div>
<div class="title">图422。团队观点</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/library-team-creation.png" alt="图书馆团队创建">
</div>
<div class="title">图423。团队创造</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/library-empty-library.png" alt="图书馆空图书馆">
</div>
<div class="title">图424。空储存库</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/library-projects-list.png" alt="图书馆项目清单">
</div>
<div class="title">图425。带有项目的存储库</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/library-empty-project.png" alt="图书馆空项目">
</div>
<div class="title">图426。空项目</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/library-assets-list.png" alt="图书馆资产清单">
</div>
<div class="title">图427。资产项目</div>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/library-asset-view.png" alt="图书馆资产视图">
</div>
<div class="title">图428。资产视图</div>
</div>
<div class="paragraph">
<p>另外，您可以通过访问主页>管理>库来设置有关默认工作空间的一些首选项。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/ReleaseNotes/Library/library-preferences.png" alt="图书馆偏好">
</div>
<div class="title">图429。库首选项</div>
</div>
</div>
<div class="sect3">
<h4 id="_authoring_imports_of_examples"><a class="anchor" href="#_authoring_imports_of_examples"></a> <a class="link" href="#_authoring_imports_of_examples">21.32.2。创作-实例导入</a></h4>
<div class="paragraph">
<p>在7.x之前，Workbench用于在启动时安装预定义的示例。</p>
</div>
<div class="paragraph">
<p>7.x版带来了从git存储库导入示例的功能。Authoring Perspective包含一个用于“示例”的菜单项，单击此菜单将启动向导以指导您完成导入。</p>
</div>
<div class="exampleblock">
<div class="title">示例109菜单项</div>
<div class="content">
<div class="paragraph">
<p>Authoring Perspective包含“示例”的菜单项。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/examples-wizard1.png" alt="示例wizard1">
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">例子110。向导-输入源存储库</div>
<div class="content">
<div class="paragraph">
<p>向导的页面1允许用户选择预定义的示例存储库，或输入自己的URL。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/examples-wizard2.png" alt="实例向导2">
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">例子111。向导-选择项目</div>
<div class="content">
<div class="paragraph">
<p>向导的第2页列出了源存储库中可用的项目。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/examples-wizard3.png" alt="实例向导3">
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">例子112。向导-输入目标存储库</div>
<div class="content">
<div class="paragraph">
<p>向导的第3页允许用户输入目标存储库名称，并将其与组织单位相关联。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/examples-wizard4.png" alt="实例向导4">
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_authoring_pop_ups_improvements"><a class="anchor" href="#_authoring_pop_ups_improvements"></a> <a class="link" href="#_authoring_pop_ups_improvements">21.32.3。创作-弹出窗口改进</a></h4>
<div class="paragraph">
<p>所有系统弹出窗口的UX都得到了改进。</p>
</div>
<div class="paragraph">
<p>默认情况下，“注释”字段是隐藏的。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/popups-comment-field.png" alt="弹出窗口评论字段">
</div>
</div>
<div class="paragraph">
<p>现在，从任何包中复制项目文件时都可以选择目标包。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/popups-package-field.png" alt="弹出包字段">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_authoring_project_editor_reimport_button"><a class="anchor" href="#_authoring_project_editor_reimport_button"></a> <a class="link" href="#_authoring_project_editor_reimport_button">21.32.4。创作-项目编辑器-重新导入按钮</a></h4>
<div class="paragraph">
<p>“重新导入”按钮会使所有缓存的依赖项无效，以便处理其中特定的依赖关系已更新而无需修改其版本的情况。</p>
</div>
</div>
<div class="sect3">
<h4 id="_security_management"><a class="anchor" href="#_security_management"></a> <a class="link" href="#_security_management">21.32.5。安全管理</a></h4>
<div class="paragraph">
<p>6.4版中发布的“用户和组管理”透视图已统一为一个透视图，该透视图提供了一个共享视图，用于管理用户和组以及授予任何应用程序角色的权限。</p>
</div>
<div class="paragraph">
<p>这个非常新的透视图位于顶部菜单栏中的“ <em>主页”</em>部分下。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementMenuEntry.png" alt="安全管理菜单条目">
</div>
<div class="title">图430。链接到安全管理角度</div>
</div>
<div class="paragraph">
<p>下一个屏幕截图显示了此新透视图的外观：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementHome.png" alt="安全管理主页">
</div>
<div class="title">图431。安全管理主页</div>
</div>
<div class="paragraph">
<p>左侧显示一个选项卡式窗格，允许用户选择“ <em>角色”</em> ，“ <em>组”</em>或“ <em>用户”</em>选项卡。单击角色（或组）后，将显示一个详细屏幕，允许用户配置一些安全设置。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/SecurityManagement/SecurityManagementRoleView.png" alt="安全管理角色视图">
</div>
<div class="title">图432。角色安全设置</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>主页透视图</strong> ：登录后将用户定向到的目标透视图，这使得每个角色/组具有不同的主页成为可能。</p>
</li>
<li>
<p><strong>优先级</strong> ：用于为那些分配了多个角色或组的用户确定哪些设置（家庭视角，权限等）具有优先级。</p>
</li>
<li>
<p><strong>权限</strong> ：完整的ACL（ <em>访问控制列表</em> ）编辑器，用于授予/拒绝对平台中可用的各种资源（如<em>“透视图”</em> ，“ <em>组织单位”</em> ，“ <em>存储库”</em>或“ <em>项目”）的</em>权限。可以通过添加单独的异常来覆盖任何这些资源类型之上的全局权限，这可以实现<em>全部拒绝</em> <em>授予一些</em>策略或<em>全部拒绝</em> <em>授予一些</em>策略。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_kie_config_cli_has_been_removed"><a class="anchor" href="#_kie_config_cli_has_been_removed"></a> <a class="link" href="#_kie_config_cli_has_been_removed">21.32.6。 kie-config-cli已被删除</a></h4>
<div class="paragraph">
<p>命令行工具<code>kie-config-cli.[sh/bat]</code>出于以下原因，已删除了6.x中用于管理远程存储库的管理器：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>它提供的与安全性相关的操作（ <code>add-role-repo</code> ， <code>remove-role-repo</code> ， <code>add-role-org-unit</code> ， <code>remove-role-org-unit</code> ， <code>add-role-project</code> ， <code>remove-role-project</code> ）已被更全面的<a href="#_wb.userandgroupmgmt">安全管理</a>功能所取代。</p>
</li>
<li>
<p>与管理部署相关的操作（ <code>list-deployment</code> ， <code>add-deployment</code> ， <code>remove-deployment</code> ）不再有意义，因为jBPM运行时已从工作台中删除。仍然可以使用<a href="#kie-server-rest-api-con_kie-apis">Kie Server REST API</a>以编程方式管理部署。</p>
</li>
<li>
<p>其余操作（ <code>create-org-unit</code> ， <code>remove-org-unit</code> ， <code>list-org-units</code> ， <code>create-repo</code> ， <code>remove-repo</code> ， <code>list-repo</code> ， <code>add-repo-org-unit</code> ， <code>remove-repo-org-unit</code> ， <code>list-project-details</code> ）作为<a href="#knowledge-store-rest-api-con_kie-apis">Knowledge Store REST API</a>的一部分提供。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_user_and_project_admin_pages_and_preferences"><a class="anchor" href="#_user_and_project_admin_pages_and_preferences"></a> <a class="link" href="#_user_and_project_admin_pages_and_preferences">21.32.7。用户和项目管理页面和首选项</a></h4>
<div class="paragraph">
<p>现在，工作台具有一个新菜单项：“管理员”。在这里，您可以找到一些管理工具，例如“用户”，“组”和“角色”管理，以及常规首选项。在此处更改首选项后，它将影响依赖于该首选项的所有位置，但仅适用于登录用户。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AdminPagePreferences/admin-page-user-access.png" alt="管理员页面用户访问权限">
</div>
<div class="title">图433。用户管理员页面访问</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AdminPagePreferences/admin-page-user.png" alt="管理员页面用户">
</div>
<div class="title">图434。用户管理页面，其中包含用户级别的工具和首选项</div>
</div>
<div class="paragraph">
<p>每个项目还具有自己的管理页面，其中包含管理工具和首选项。在此处更改首选项后，它将仅影响该项目，并且仅影响登录的用户。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AdminPagePreferences/admin-page-project-access.png" alt="管理页面项目访问">
</div>
<div class="title">图435。项目管理员页面访问</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AdminPagePreferences/admin-page-project.png" alt="管理页面项目">
</div>
<div class="title">图436。项目管理页面，其中包含项目级别的工具和首选项</div>
</div>
</div>
<div class="sect3">
<h4 id="_gav_conflict_check_and_child_gav_edition"><a class="anchor" href="#_gav_conflict_check_and_child_gav_edition"></a> <a class="link" href="#_gav_conflict_check_and_child_gav_edition">21.32.8。GAV冲突检查和儿童GAV版本</a></h4>
<div class="paragraph">
<p>现在，可以为每个用户设置GAV冲突检查标志，并允许或阻止其所有项目（或专门针对每个项目）的子GAV版本。</p>
</div>
<div class="paragraph">
<p>如果通过“ Admin”菜单项进行访问，则可以在管理工具“项目”中找到该配置。也可以通过在项目管理页面上输入管理工具“常规”来找到它。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/AdminPagePreferences/gav-preferences.png" alt="偏好设置">
</div>
<div class="title">图437。组工件版本（GAV）首选项</div>
</div>
</div>
<div class="sect3">
<h4 id="_data_source_management"><a class="anchor" href="#_data_source_management"></a> <a class="link" href="#_data_source_management">21.32.9。资料来源管理</a></h4>
<div class="paragraph">
<p>新的数据源管理系统使工作台能够定义用于访问外部数据库的数据源和驱动程序。</p>
</div>
<div class="paragraph">
<p>其中包括的一些功能是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>管理数据源的新视角：</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceManagementPerspective.png" alt="数据源管理角度">
</div>
<div class="title">图438。数据源创作视角</div>
</div>
<div class="ulist">
<ul>
<li>
<p>用于指导数据源创建的新向导。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/NewDataSourceWizard.png" alt="NewDataSourceWizard">
</div>
<div class="title">图439。新数据源向导</div>
</div>
<div class="ulist">
<ul>
<li>
<p>用于指导驱动程序创建的新向导。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/NewDriverWizard.png" alt="NewDriver向导">
</div>
<div class="title">图440。新驱动程序向导</div>
</div>
<div class="paragraph">
<p>以及浏览数据源所指向的数据库的数据库信息的能力。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>可用模式浏览</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceContentBrowser1.png" alt="DataSourceContentBrowser1">
</div>
<div class="title">图441。数据库模式</div>
</div>
<div class="ulist">
<ul>
<li>
<p>可用表浏览</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceContentBrowser2.png" alt="DataSourceContentBrowser2">
</div>
<div class="title">图442。模式表</div>
</div>
<div class="ulist">
<ul>
<li>
<p>表格内容浏览</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./Workbench/Authoring/DataSourceManagement/DataSourceContentBrowser3.png" alt="DataSourceContentBrowser3">
</div>
<div class="title">图443。表信息</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kieserver.releasenoteskie.7.0.0"><a class="anchor" href="#_kieserver.releasenoteskie.7.0.0"></a> <a class="link" href="#_kieserver.releasenoteskie.7.0.0">21.33。从6.x重大更改Kie Server 7.0</a></h3>
<div class="sect3">
<h4 id="_serviceresponse_xstream_marshalling_changes"><a class="anchor" href="#_serviceresponse_xstream_marshalling_changes"></a> <a class="link" href="#_serviceresponse_xstream_marshalling_changes">21.33.1。ServiceResponse XStream封送更改</a></h4>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">本发行说明仅在直接与Kie Server（kie服务器）API接口时适用，而在使用Kie Server Java客户端（kie-server-client）API时不适用。</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>为了与JAXB封送更加一致，XStream封送进行了以下更改：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>XML ServiceResponse元素的<code>response</code>对象不再使用规范名称呈现。</p>
</li>
<li>
<p>XStream现在使用<code>type</code>和<code>msg</code>作为属性，而不是子元素。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>有关更多详细信息，请参见<a href="https://issues.jboss.org/browse/DROOLS-1509">DROOLS-1509</a> 。</p>
</div>
</div>
<div class="sect3">
<h4 id="_simplified_planner_rest_api"><a class="anchor" href="#_simplified_planner_rest_api"></a> <a class="link" href="#_simplified_planner_rest_api">21.33.2。简化的Planner REST API</a></h4>
<div class="sect4">
<h5 id="_serviceresponse_wrapper_removal"><a class="anchor" href="#_serviceresponse_wrapper_removal"></a> <a class="link" href="#_serviceresponse_wrapper_removal">21.33.2.1。ServiceResponse包装器的移除</a></h5>
<div class="paragraph">
<p><code>ServiceResponse</code>包装器已从KIE Server返回的Planner服务响应中删除。这样可以更轻松地在客户端上处理响应。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;solver-instance&gt;
    ...
    &lt;status&gt;SOLVING&lt;/status&gt;
    &lt;score scoreClass="org.optaplanner.core.api.score.buildin.hardsoft.HardSoftScore"&gt;0hard/-10soft&lt;/score&gt;
    &lt;best-solution class="curriculumcourse.curriculumcourse.CourseSchedule"&gt;
        ...
    &lt;/best-solution&gt;
&lt;/solver-instance&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_new_planner_api_overview"><a class="anchor" href="#_new_planner_api_overview"></a> <a class="link" href="#_new_planner_api_overview">21.33.2.2。新的Planner API概述</a></h5>
<div class="paragraph">
<p>注册一个求解器：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>放置<a class="bare" href="http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}">http：// $ {kie-server} / services / rest / server / containers / $ {container_id} / solvers / $ {solver_id}</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>提交解决方案：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>POST <a class="bare" href="http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}/state/solving">http：// $ {kie-server} / services / rest / server / containers / $ {container_id} / solvers / $ {solver_id} / state / solving</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>获得最佳解决方案：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GET <a class="bare" href="http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}/bestsolution">http：// $ {kie-server} / services / rest / server / containers / $ {container_id} / solvers / $ {solver_id} / bestsolution</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>终止求解器：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>POST <a class="bare" href="http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}/state/terminating-early">http：// $ {kie-server} / services / rest / server / containers / $ {container_id} / solvers / $ {solver_id} / state / terminate-early</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>设置求解器：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>删除<a class="bare" href="http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}">http：// $ {kie-server} / services / rest / server / containers / $ {container_id} / solvers / $ {solver_id}</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.6.5.0"><a class="anchor" href="#_drools.releasenotesdrools.6.5.0"></a> <a class="link" href="#_drools.releasenotesdrools.6.5.0">21.34。Drools 6.5.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_configurable_threadfactory"><a class="anchor" href="#_configurable_threadfactory"></a> <a class="link" href="#_configurable_threadfactory">21.34.1。可配置的ThreadFactory</a></h4>
<div class="paragraph">
<p>某些运行时环境（例如Google App Engine）不允许直接创建新的线程。因此，现在可以通过使用类名设置系统属性<strong>drools.threadFactory</strong>来插入自己的ThreadFactory实现。例如，如果您使用此类实现了与Google App Engine兼容的ThreadFactory <code>com.user.project.GoogleAppEngineThreadFactory</code>您可以通过设置使Drools使用它：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>drools.threadFactory = com.user.project.GoogleAppEngineThreadFactory</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_use_of_any_expressions_as_input_for_a_query"><a class="anchor" href="#_use_of_any_expressions_as_input_for_a_query"></a> <a class="link" href="#_use_of_any_expressions_as_input_for_a_query">21.34.2。使用任何表达式作为查询的输入</a></h4>
<div class="paragraph">
<p>现在可以将事实的字段都用作查询的输入参数，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>query contains(String $s, String $c)
    $s := String( this.contains( $c ) )
end

rule PersonNamesWithA when
    $p : Person()
    contains( $p.name, "a"; )
then
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>通常，还有任何一种有效的表达式，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>query checkLength(String $s, int $l)
    $s := String( length == $l )
end

rule CheckPersonNameLength when
    $i : Integer()
    $p : Person()
    checkLength( $p.name, 1 + $i + $p.age; )
then
end</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update_with_modified_properties"><a class="anchor" href="#_update_with_modified_properties"></a> <a class="link" href="#_update_with_modified_properties">21.34.3。使用修改后的属性更新</a></h4>
<div class="paragraph">
<p>引入属性反应性是为了避免进行不必要的和无用的（重新）评估，并使Drools引擎仅对实际上限制或绑定在给定模式内部的属性做出反应。但是，此功能仅可用于在规则结果内进行的修改。相反，以编程方式进行的更新不会意识到对象的属性已更改，因此无法使用此功能。</p>
</div>
<div class="paragraph">
<p>为了克服此限制，现在可以有选择地在更新语句中指定已修改的对象中已更改的属性的名称，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Person me = new Person("me", 40);
FactHandle meHandle = ksession.insert( me );

me.setAge(41);
me.setAddress("California Avenue");
ksession.update( meHandle, me, "age", "address" );</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_monitoring_framework_improvements"><a class="anchor" href="#_monitoring_framework_improvements"></a> <a class="link" href="#_monitoring_framework_improvements">21.34.4。监控框架改进</a></h4>
<div class="paragraph">
<p>为了监视KieContainers，引入了一种新型的MBean，并且重新审视了JMX MBean的层次结构，以反映与KieBases的相关MBean的关系。JMX对象命名已标准化，以反映Kie API中使用的术语。为了提供对Stateless KieSession的监视，引入了一种新型的MBean，这在以前的版本中不可用。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表104。JMX对象名更改</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">MBean</th>
<th class="tableblock halign-left valign-top">之前<code>6.5.x</code></th>
<th class="tableblock halign-left valign-top">从<code>6.5.0.Final</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KieContainer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie:kcontainerId=<em>{kcontainerId}</em></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">凯基</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.drools.kbases:type=<em>{kbaseId}</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie:kcontainerId=<em>{kcontainerId}</em>,kbaseId=<em>{kbaseId}</em></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KieSession（有状态）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.drools.kbases:type=<em>{kbaseId}</em>,group=Sessions,sessionId=<em>{ksessionId}</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie:kcontainerId=<em>{kcontainerId}</em>,kbaseId=<em>{kbaseId}</em>,ksessionType=Stateful,ksessionName=<em>{ksessionName}</em></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">无状态KieSession</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不适用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie:kcontainerId=<em>{kcontainerId}</em>,kbaseId=<em>{kbaseId}</em>,ksessionType=Stateless,ksessionName=<em>{ksessionName}</em></code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>KieSession MBean合并以相同名称实例化的所有会话的统计数据。</p>
</div>
<div class="paragraph">
<p>通过创建KieSession <code>JPAKnowledgeService</code> ，将在具有常量的KieSession MBean下进行监控<code>{ksessionName}</code>重视<code>persistent</code> ;此MBean不直接由KieContainer管理，因此，当不再需要监视时，需要从JMX手动注销它。</p>
</div>
<div class="paragraph">
<p>新的JMX对象命名方案现在对ID强制使用正确的JMX引用，例如：<code>org.kie:kcontainerId="2cb55f40-f220-432a-aba8-7940c18bf108",kbaseId="KBase1"</code></p>
</div>
<div class="paragraph">
<p>旧的DroolsManagementAgent（已在JMX上以<code>org.drools:type=DroolsManagementAgent</code> ）不再需要，因此不再在JMX上注册。</p>
</div>
<div class="paragraph">
<p>现在，KieSession MBean具有适当的JMX <code>CompositeData</code>和<code>TabularData</code>支持（如适用）。KieSession MBean继续支持所有与流程相关的聚合统计信息监视，但不再显示每个流程实例的开始/结束日期：jBPM中对此范围提供了审计和日志记录支持。</p>
</div>
<div class="paragraph">
<p>Drools RHQ / JON插件进行了更改，以反映上述所有更改，此外还进行了旨在正确显示层次嵌套的特定错误修复。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.6.4.0"><a class="anchor" href="#_drools.releasenotesdrools.6.4.0"></a> <a class="link" href="#_drools.releasenotesdrools.6.4.0">21.35。Drools 6.4.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_better_java_8_compatibility"><a class="anchor" href="#_better_java_8_compatibility"></a> <a class="link" href="#_better_java_8_compatibility">21.35.1。更好的Java 8兼容性</a></h4>
<div class="paragraph">
<p>现在可以在规则的右侧（然后）部分使用Java 8语法（lambda和方法引用）。</p>
</div>
</div>
<div class="sect3">
<h4 id="_more_robust_incremental_compilation"><a class="anchor" href="#_more_robust_incremental_compilation"></a> <a class="link" href="#_more_robust_incremental_compilation">21.35.2。更强大的增量编译</a></h4>
<div class="paragraph">
<p>当涉及带有子网的一个或多个规则（具有复杂存在模式的规则）时，尤其是当在不同规则之间共享同一子网时，增量编译（基于规则的动态更新）存在一些相关的缺陷。此问题需要部分重写现有的增量编译算法，然后进行一次完整的审计，该审计也已通过仅在该领域由20,000多个测试用例构成的全新测试套件进行了验证。</p>
</div>
</div>
<div class="sect3">
<h4 id="_improved_multi_threading_behaviour"><a class="anchor" href="#_improved_multi_threading_behaviour"></a> <a class="link" href="#_improved_multi_threading_behaviour">21.35.3。改进的多线程行为</a></h4>
<div class="paragraph">
<p>为了消除大量同步点并提高稳定性和可预测性，部分处理了多线程引擎代码。特别是这种新的实现方式可以使用户线程（在会话中执行插入/更新/删除操作），Drools引擎线程（进行适当的规则评估）和计时器（执行基于时间的）之间更清晰地分离并更好地交互。诸如事件到期之类的操作）。</p>
</div>
<div class="paragraph">
<p>Drools 6引入了新的phreak算法，从而使这一改进成为可能。实际上，在ReteOO算法中，网络评估是在用户插入/更新/删除操作期间执行的，这意味着每个用户操作都会锁定整个引擎。与phreak相反，插入/更新/删除是分开的，并且在调用fireAllRules或fireUntilHalt时会进行网络评估。</p>
</div>
<div class="paragraph">
<p>更详细地说，此改进分为两部分。首先，添加了新的线程安全队列，以将所有用户操作存储为命令。在规则评估阶段，由Drools引擎线程刷新并处理其条目时，该队列由User线程填充。第二部分介绍了一个状态机，用于协调用户线程，计时器线程和引擎线程，然后提供了一种更清晰的自记录方式来对它们的交互进行建模。</p>
</div>
</div>
<div class="sect3">
<h4 id="_oopath_improvements_2"><a class="anchor" href="#_oopath_improvements_2"></a> <a class="link" href="#_oopath_improvements_2">21.35.4。OOPath改进</a></h4>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p>此功能是实验性的</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>OOPath已在Drools 6.3.0中引入。在Drools 6.4.0中已对其进行了增强，以支持以下功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>约束还可以引用当前迭代对象之前遍历的图形对象。例如以下OOPath：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams/grades{ result &gt; ../averageResult } )</code></pre>
</div>
</div>
<div class="paragraph">
<p>将仅匹配成绩高于通过考试平均水平的成绩。</p>
</div>
</li>
<li>
<p>约束也可以递归地成为另一个OOPath，如下所示：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Student( $exam: /plan/exams{ /grades{ result &gt; 20 } } )</code></pre>
</div>
</div>
</li>
<li>
<p>也可以使用<code>?/</code>分隔符而不是<code>/</code>一。如以下示例所示：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams{ course == "Big Data" }?/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>这样，Drools引擎将对对考试所做的更改做出反应，或者是否将考试添加到了计划中，但是如果对现有考试添加了新的成绩，则不会做出反应。当然，如果OOPath块不是反应性的，则从那里到表达式结尾的所有OOPath其余部分也将是非反应性的。例如以下OOPath</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: ?/plan/exams{ course == "Big Data" }/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>将完全无反应。因此，不允许使用<code>?/</code>分隔符在同一OOPath中不止一次，所以表达式如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan?/exams{ course == "Big Data" }?/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>会导致编译时错误。</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.6.4.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.6.4.0.final"></a> <a class="link" href="#_wb.releasenotesworkbench.6.4.0.final">21.36。KIE Workbench 6.4.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_new_look_and_feel"><a class="anchor" href="#_new_look_and_feel"></a> <a class="link" href="#_new_look_and_feel">21.36.1。新外观</a></h4>
<div class="paragraph">
<p>整个工作台的总体外观已更新为采用<a href="https://www.patternfly.org/">PatternFly</a> 。此更新在每个屏幕上带来了更清洁，轻便和更一致的用户体验。通过删除所有不必要的视觉元素，使用户可以专注于数据和任务。交互和行为基本上保持不变，从而将这种更改的范围限制为视觉更新。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/NewLookAndFeel.png" alt="新外观和感觉">
</div>
<div class="title">图444。工作台-新外观</div>
</div>
</div>
<div class="sect3">
<h4 id="_various_ui_improvements"><a class="anchor" href="#_various_ui_improvements"></a> <a class="link" href="#_various_ui_improvements">21.36.2。各种UI改进</a></h4>
<div class="paragraph">
<p>除了上述针对一般外观的PatternFly更新之外，还改进了工作台中的许多单个组件以创建更好的用户体验。这涉及确保模式弹出窗口的默认大小适合于适合相应的内容，调整文本字段的大小以及对齐标签，以及在较小的屏幕上使用时改善各种组件的调整大小行为。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/ModalPostPatternFly.png" alt="ModalPostPatternFly">
</div>
<div class="title">图445。工作台-适当大小的弹出窗口</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/LabelFieldAlignmentPostPatternFly.png" alt="LabelFieldAlignmentPostPatternFly">
</div>
<div class="title">图446。工作台-适当大小的文本字段和对齐的标签</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/HorizonalAlignmentPostPatternFly.png" alt="HorizontalAlignmentPostPatternFly">
</div>
<div class="title">图447。工作台-调整大小的编辑器窗口，水平空间有限</div>
</div>
</div>
<div class="sect3">
<h4 id="_new_locales"><a class="anchor" href="#_new_locales"></a> <a class="link" href="#_new_locales">21.36.3。新地区</a></h4>
<div class="paragraph">
<p>语言环境<code>ru</code> （俄语）和<code>zh_TW</code> （繁体中文）现在已添加。</p>
</div>
<div class="paragraph">
<p>现在支持的语言环境是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>默认英语。</p>
</li>
<li>
<p><code>es</code> （西班牙语）</p>
</li>
<li>
<p><code>fr</code> （法文）</p>
</li>
<li>
<p><code>de</code> （德语）</p>
</li>
<li>
<p><code>ja</code> （日本）</p>
</li>
<li>
<p><code>pt_BR</code> （葡萄牙语-巴西）</p>
</li>
<li>
<p><code>zh_CN</code> （简体中文）</p>
</li>
<li>
<p><code>zh_TW</code> （中国传统的）</p>
</li>
<li>
<p><code>ru</code> （俄语）</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_authoring_imports_consistent_terminology"><a class="anchor" href="#_authoring_imports_consistent_terminology"></a> <a class="link" href="#_authoring_imports_consistent_terminology">21.36.4。创作-导入-一致的术语</a></h4>
<div class="paragraph">
<p>工作台以前在项目编辑器中有一个用于“导入建议”的部分，这实际上是用户注册Java运行时环境提供的类以供规则创作使用的一种方法。此外，编辑器具有“配置”选项卡，在该选项卡中，用户应将类从其他程序包导入到规则所在的程序包中。</p>
</div>
<div class="paragraph">
<p>这两个术语都不明确，而且彼此之间以及工作台的其他方面均不一致。</p>
</div>
<div class="paragraph">
<p>我们更改了这些术语，以（希望）使其含义更清楚，并与在工作台中创作Java类有关的“数据对象”术语保持一致。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/ExternalDataObjects1.png" alt="外部数据对象1">
</div>
<div class="title">图448。项目编辑器-外部数据对象</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/ExternalDataObjects2.png" alt="ExternalDataObjects2">
</div>
<div class="title">图449。项目编辑器-定义外部数据对象</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DataObjects1.png" alt="数据对象1">
</div>
<div class="title">图450。资产编辑器-数据对象</div>
</div>
<div class="paragraph">
<p>“数据对象”屏幕列出了与资产在同一包中的所有数据对象，并允许导入其他包中的其他数据对象。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DataObjects2.png" alt="数据对象2">
</div>
<div class="title">图451。资产编辑器-定义可用于创作的数据对象</div>
</div>
</div>
<div class="sect3">
<h4 id="_disable_automatic_build"><a class="anchor" href="#_disable_automatic_build"></a> <a class="link" href="#_disable_automatic_build">21.36.5。禁用自动构建</a></h4>
<div class="paragraph">
<p>使用项目资源管理器浏览项目时，工作台会自动构建所选项目，并在消息控制台中显示构建消息。尽管这是有益的，但在编写大型项目时可能会对工作台的性能产生不利影响。现在可以使用<code>org.kie.build.disable-project-explorer</code>系统属性。将值设置为<code>true</code>禁用。默认值为<code>false</code> 。</p>
</div>
</div>
<div class="sect3">
<h4 id="_support_for_scp_style_git_repository_urls"><a class="anchor" href="#_support_for_scp_style_git_repository_urls"></a> <a class="link" href="#_support_for_scp_style_git_repository_urls">21.36.6。支持<code>SCP</code>样式<code>git</code>储存库网址</a></h4>
<div class="paragraph">
<p>克隆时<code>git</code>现在可以使用存储库<code>SCP</code>样式网址，例如<code>git@github.com:user/repository.git</code> 。如果您操作系统的公共密钥库受密码保护，则密码可以随<code>org.uberfire.nio.git.ssh.passphrase</code>系统属性。</p>
</div>
</div>
<div class="sect3">
<h4 id="_authoring_duplicate_gav_detection"><a class="anchor" href="#_authoring_duplicate_gav_detection"></a> <a class="link" href="#_authoring_duplicate_gav_detection">21.36.7。创作-重复的GAV检测</a></h4>
<div class="paragraph">
<p>执行以下任何操作时，现在将检查为项目解析的所有Maven存储库，以查看是否存在项目的GroupId，ArtifactId和Version。如果发现冲突，则阻止该操作；尽管用户可以使用<code>admin</code>角色。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>可以通过设置系统属性来禁用该功能<code>org.guvnor.project.gav.check.disabled</code>至<code>true</code> 。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>解析的存储库是在以下位置发现的存储库：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>项目的<code>POM</code><code><repositories></code>部分（或任何父母<code>POM</code> ）。</p>
</li>
<li>
<p>项目的<code>POM</code><code><distributionManagement></code>部分。</p>
</li>
<li>
<p>Maven的全球<code>settings.xml</code>配置文件。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>受影响的操作：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>创建新的托管存储库。</p>
</li>
<li>
<p>使用项目编辑器保存项目定义。</p>
</li>
<li>
<p>将新模块添加到托管多模块存储库。</p>
</li>
<li>
<p>保存<code>pom.xml</code>文件。</p>
</li>
<li>
<p>使用项目编辑器构建和安装项目。</p>
</li>
<li>
<p>使用项目编辑器构建和部署项目。</p>
</li>
<li>
<p>资产管理部门负责建设，安装或部署项目。</p>
</li>
<li>
<p><code>REST</code>创建，安装或部署项目的操作。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>的用户<code>Admin</code>角色可以覆盖使用项目编辑器中“存储库”设置检查的存储库列表。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/MavenRepositories1.png" alt="Maven存储库1">
</div>
<div class="title">图452。项目编辑器-查看已解决的存储库</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/MavenRepositories2.png" alt="Maven资源库2">
</div>
<div class="title">图453。项目编辑器-解析的存储库列表</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/MavenRepositories3.png" alt="Maven资源库3">
</div>
<div class="title">图454。检测到重复的GAV</div>
</div>
</div>
<div class="sect3">
<h4 id="_new_execution_server_management_user_interface"><a class="anchor" href="#_new_execution_server_management_user_interface"></a> <a class="link" href="#_new_execution_server_management_user_interface">21.36.8。新的执行服务器管理用户界面</a></h4>
<div class="paragraph">
<p>KIE Execution Server管理UI进行了完全重新设计，以适应最近引入的重大改进。除了新的UI是从头开始构建并遵循PatternFly提供的最佳实践这一事实外，新界面还扩展了以前的功能，使用户可以更好地控制服务器。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/NewExecServerUI.png" alt="NewExecServerUI">
</div>
<div class="title">图455。KIE Execution Server-新的用户界面</div>
</div>
</div>
<div class="sect3">
<h4 id="_user_and_group_management"><a class="anchor" href="#_user_and_group_management"></a> <a class="link" href="#_user_and_group_management">21.36.9。用户和组管理</a></h4>
<div class="paragraph">
<p>提供后端服务和直观友好的用户界面，使工作台管理员可以管理应用程序的用户和组。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/UserAndGroupManagement.png" alt="UserAndGroupManagement">
</div>
</div>
<div class="paragraph">
<p>该界面为工作台管理员提供了执行领域相关操作的能力，例如创建用户，创建组，将组或角色分配给给定用户等。</p>
</div>
<div class="paragraph">
<p>默认情况下，它带有用于管理Wildfly，EAP和Tomcat默认领域的内置实现，并且设计为可扩展的-任何第三方领域管理系统都可以轻松集成到工作台中。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.6.3.0"><a class="anchor" href="#_drools.releasenotesdrools.6.3.0"></a> <a class="link" href="#_drools.releasenotesdrools.6.3.0">21.37。Drools 6.3.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_browsing_graphs_of_objects_with_oopath"><a class="anchor" href="#_browsing_graphs_of_objects_with_oopath"></a> <a class="link" href="#_browsing_graphs_of_objects_with_oopath">21.37.1。使用OOPath浏览对象图</a></h4>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p>此功能是实验性的</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>当事实的字段是一个集合时，可以使用<code>from</code>关键词。但是，当需要浏览对象图时，会广泛使用<code>from</code>条件元素可能导致冗长而繁琐的语法，如以下示例所示：</p>
</div>
<div class="exampleblock">
<div class="title">示例113。浏览来自的对象图</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "Find all grades for Big Data exam" when
    $student: Student( $plan: plan )
    $exam: Exam( course == "Big Data" ) from $plan.exams
    $grade: Grade() from $exam.grades
then /* RHS */ end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>在此示例中，假设使用的领域模型包括<code>Student</code>谁有一个<code>Plan</code>研究： <code>Plan</code>可以有零个或多个<code>Exam</code> s和<code>Exam</code>零或更多<code>Grade</code> s。请注意，只有图的根对象（ <code>Student</code>在这种情况下）必须位于工作存储器中才能正常工作。</p>
</div>
<div class="paragraph">
<p>通过从XPath借用思想，可以使此语法更加简洁，因为XPath具有紧凑的符号，可以在处理集合和过滤约束时浏览相关元素。这种受XPath启发的符号被称为<code>OOPath</code>因为它专门用于浏览对象图。使用此表示法，可以按如下方式重写前一个示例：</p>
</div>
<div class="exampleblock">
<div class="title">示例114。使用OOPath浏览对象图</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>rule "Find all grades for Big Data exam" when
    Student( $grade: /plan/exams[course == "Big Data"]/grades )
then /* RHS */ end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>形式上，核心语法<code>OOPath</code>可以通过这种方式在EBNF表示法中定义表达式。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>OOPExpr = "/" OOPSegment { ( "/" | "." ) OOPSegment } ;
OOPSegment = [ID ( ":" | ":=" )] ID ["[" Number "]"] ["{" Constraints "}"];</code></pre>
</div>
</div>
<div class="paragraph">
<p>在实践中<code>OOPath</code>表达式具有以下功能。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>它必须以<code>/</code> 。</p>
</li>
<li>
<p>它可以通过以下方式取消引用对象的单个属性： <code>.</code>算子</p>
</li>
<li>
<p>它可以使用<code>/</code>操作员。如果返回一个集合，它将遍历该集合中的值</p>
</li>
<li>
<p>在遍历引用的对象时，它可以过滤掉不满足一个或多个约束的对象，它们写成大括号之间的谓词表达式，例如：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams[course == "Big Data"]/grades )</code></pre>
</div>
</div>
</li>
<li>
<p>也可以通过将项目放在方括号之间来按其索引访问项目，例如：</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Student( $grade: /plan/exams[0]/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了遵守Java约定，与基于XPath 1的索引相比，OOPath索引的基于0的索引</p>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_reactive_oopath"><a class="anchor" href="#_reactive_oopath"></a> <a class="link" href="#_reactive_oopath">21.37.1.1。反应性OOPath</a></h5>
<div class="paragraph">
<p>目前，Drools无法对包含在评估过程中遍历的深层嵌套的更新做出反应<code>OOPath</code>表达。为了使这些对象对当前的变化有反应，有必要使它们扩展类<code>org.drools.core.phreak.ReactiveObject</code> 。计划通过实现一种自动检测属于特定域模型的类的机制来克服此限制。</p>
</div>
<div class="paragraph">
<p>扩展了该类之后，域对象可以通过调用继承的方法来通知Drools引擎其字段之一已更新。 <code>notifyModification</code>如以下示例所示：</p>
</div>
<div class="exampleblock">
<div class="title">示例115。通知Drools引擎考试已移至其他课程</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>public void setCourse(String course) {
    this.course = course;
    notifyModification(this);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>这样，如果将考试转移到其他课程，则重新触发该规则，并重新计算与该规则匹配的成绩列表。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_shared.releasenotes.kienavigator"><a class="anchor" href="#_shared.releasenotes.kienavigator"></a> <a class="link" href="#_shared.releasenotes.kienavigator">21.37.2。Eclipse的Kie Navigator View</a></h4>
<div class="paragraph">
<p>新的查看器已添加到Eclipse工具中。该Kie Navigator视图用于管理Kie Server的安装和项目。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.6.3.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.6.3.0.final"></a> <a class="link" href="#_wb.releasenotesworkbench.6.3.0.final">21.38。KIE Workbench 6.3.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_real_time_validation_and_verification_for_the_decision_tables"><a class="anchor" href="#_real_time_validation_and_verification_for_the_decision_tables"></a> <a class="link" href="#_real_time_validation_and_verification_for_the_decision_tables">21.38.1。决策表的实时验证和验证</a></h4>
<div class="paragraph">
<p>决策表过去具有用于验证表的“验证”按钮。现在将其删除，并在每个单元格值更改后验证该表。验证和验证检查包括：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>冗余</p>
</li>
<li>
<p>包容性</p>
</li>
<li>
<p>矛盾冲突</p>
</li>
<li>
<p>缺少列</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这些检查将在工作台文档中详细说明。</p>
</div>
</div>
<div class="sect3">
<h4 id="_improved_drl_editor"><a class="anchor" href="#_improved_drl_editor"></a> <a class="link" href="#_improved_drl_editor">21.38.2。改进的DRL编辑器</a></h4>
<div class="paragraph">
<p>DRL编辑器已经进行了整容。从普通的TextArea转换为使用ACE Editor和自定义DRL语法突出显示工具。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/drl-ace-editor.png" alt="drl ace编辑器">
</div>
<div class="title">图456。ACE编辑器</div>
</div>
</div>
<div class="sect3">
<h4 id="_asset_locking"><a class="anchor" href="#_asset_locking"></a> <a class="link" href="#_asset_locking">21.38.3。资产锁定</a></h4>
<div class="paragraph">
<p>为了避免在编辑资产时发生冲突，引入了一种新的锁定机制，以确保一次只能有一个用户可以编辑资产。当用户开始编辑资产时，将自动获取锁。这由资产标题栏以及项目资源管理器视图中显示的锁定符号指示。如果用户开始编辑已经锁定的资产，则会显示一个弹出通知，通知用户该资产当前无法编辑，因为该资产正在由另一个用户使用。只要编辑用户持有该锁，就可以防止其他用户进行更改。当编辑用户保存或关闭资产或退出工作台时，锁将自动释放。如果需要，每个用户还可以选择在元数据选项卡中强制释放锁定。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DataModelEditingWithLock.png" alt="DataModelEditingWithLock">
</div>
<div class="title">图457。自动编辑资产会获得锁定</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DataModelLocked.png" alt="数据模型锁定">
</div>
<div class="title">图458。锁定资产不能由其他用户编辑</div>
</div>
</div>
<div class="sect3">
<h4 id="_data_modeller_tool_windows"><a class="anchor" href="#_data_modeller_tool_windows"></a> <a class="link" href="#_data_modeller_tool_windows">21.38.4。数据建模工具Windows</a></h4>
<div class="paragraph">
<p>Drools和jBPM配置，持久性（请参阅生成启用JPA的数据模型）和高级配置已移至“工具窗口”。 “工具窗口”是最新的Uberfire版本中引入的新概念，可用于开发上下文感知的屏幕。每个“工具窗口”将包含一个域编辑器，该域编辑器将管理一组相关的数据对象参数。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DM-DroolsDomainToolWindow6.3.png" alt="DM DroolsDomainToolWindow6.3">
</div>
<div class="title">图459。Drools和jBPM域工具窗口</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DM-JPADomainToolWindow6.3.png" alt="DM JPADomainToolWindow6.3">
</div>
<div class="title">图460。持久性工具窗口</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DM-AdvancedDomainToolWindow6.3.png" alt="DM AdvancedDomainToolWindow6.3">
</div>
<div class="title">图461。高级配置工具窗口</div>
</div>
</div>
<div class="sect3">
<h4 id="_generation_of_jpa_enabled_data_models"><a class="anchor" href="#_generation_of_jpa_enabled_data_models"></a> <a class="link" href="#_generation_of_jpa_enabled_data_models">21.38.5。启用JPA的数据模型的生成</a></h4>
<div class="paragraph">
<p>扩展了数据建模器以支持可持久数据对象的生成。可持久数据对象基于JPA规范，并且所有基础元数据都是自动生成的。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>可以在创建时将“新建→数据对象”数据对象标记为可持久。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DM-NewDataObject6.3.png" alt="DM NewDataObject6.3">
</div>
<div class="title">图462。新数据对象</div>
</div>
</li>
<li>
<p>持久性工具窗口包含用于数据对象和字段的JPA域编辑器。每个编辑器将默认管理生成的JPA元数据</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DM-DataObjectJPADomainTab6.3.png" alt="DM DataObjectJPADomainTab6.3">
</div>
<div class="title">图463。数据对象级JPA域编辑器</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DM-FieldJPADomainTab6.3.png" alt="DM FieldJPADomainTab6.3">
</div>
<div class="title">图464。现场级JPA域编辑器</div>
</div>
</li>
<li>
<p>持久性配置屏幕已添加到项目编辑器。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DM-Persistence-Configuration6.3.png" alt="DM持久性配置6.3">
</div>
<div class="title">图465。持久性配置</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_data_set_authoring"><a class="anchor" href="#_data_set_authoring"></a> <a class="link" href="#_data_set_authoring">21.38.6。数据集创作</a></h4>
<div class="paragraph">
<p>添加了创作数据集定义的新视角。数据集定义可以从数据库，CSV / Excel文件等外部系统中检索数据，甚至可以使用Java类来生成数据。数据一旦可用，就可以用于例如从“透视编辑器”创建图表和仪表板，而仅从任何可用数据集中提供图表。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/DataSetAuthoringPerspective.png" alt="DataSetAuthoringPerspective">
</div>
<div class="title">图466。数据集创作视角</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.6.2.0"><a class="anchor" href="#_drools.releasenotesdrools.6.2.0"></a> <a class="link" href="#_drools.releasenotesdrools.6.2.0">21.39。Drools 6.2.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_propagation_modes"><a class="anchor" href="#_propagation_modes"></a> <a class="link" href="#_propagation_modes">21.39.1。传播方式</a></h4>
<div class="paragraph">
<p>PHREAK作为Drools引擎的默认算法的引入使规则的评估变得懒惰。这种新的Drools懒惰行为可以提高性能，但在某些特定情况下，则打破了Drools某些功能的语义。</p>
</div>
<div class="paragraph">
<p>更确切地说，在某些情况下，必须立即将新事实的插入传播到会话中。例如，Drools允许在查询之前以'？的形式在只拉（或被动）模式下执行查询。'符号，如下例所示：</p>
</div>
<div class="exampleblock">
<div class="title">示例116。被动查询</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">query Q (Integer i)
    String( this == i.toString() )
end
rule R when
    $i : Integer()
    ?Q( $i; )
then
    System.out.println( $i );
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，由于查询是被动的，因此它不应对在查询本身中插入符合联接条件的String做出反应。换句话说，这一系列命令</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession ksession = ...
ksession.insert(1);
ksession.insert("1");
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="paragraph">
<p>不应导致规则R触发，因为在整数之后插入了满足查询条件的字符串，并且被动查询不应对此插入作出反应。相反，如果插入顺序被反转，则规则应触发，因为当存在现有String可以满足被动查询时，Integer的插入将触发它。</p>
</div>
<div class="paragraph">
<p>不幸的是，PHREAK的懒惰特性不允许Drools引擎对这两个事实的插入顺序进行任何区分，因此该规则在两种情况下都适用。在这种情况下，有必要像旧的基于RETEOO的引擎一样急切地评估规则。</p>
</div>
<div class="paragraph">
<p>在其他情况下，要求传播急切，这意味着传播不是立即的，但是无论如何必须在Drools引擎/议程开始预定的评估之前进行。例如，当规则具有no-loop或lock-on-active属性时，这是必需的，实际上，当这种情况发生时，此传播模式由Drools引擎自动实施。</p>
</div>
<div class="paragraph">
<p>为了涵盖这些用例，以及在所有其他需要立即或急切评估规则的情况下，可以通过使用<strong>@Propagation（Propagation。）注释规则本身来声明性地指定<strong>。类型）</strong> ，其中传播。Type是具有3个可能值的枚举：</strong></p><strong>
</strong></div><strong>
<div class="ulist">
<ul>
<li>
<p><strong>IMMEDIATE</strong>表示立即进行传播。</p>
</li>
<li>
<p><strong>EAGER</strong>意味着传播是<strong>缓慢</strong>进行的，但是在计划的评估之前急切地进行了评估。</p>
</li>
<li>
<p><strong>LAZY</strong>表示传播完全是惰性的，这是默认的PHREAK行为</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这意味着下面的drl：</p>
</div>
<div class="exampleblock">
<div class="title">示例117使用被动查询的数据驱动规则</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">query Q (Integer i)
    String( this == i.toString() )
end
rule R @Propagation(IMMEDIATE) when
    $i : Integer()
    ?Q( $i; )
then
    System.out.println( $i );
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>当且仅当将Integer插入到String之后时，规则R才会触发，从而符合被动查询的语义。</p>
</div>
</strong></div><strong>
</strong></div><strong>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.6.2.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.6.2.0.final"></a> <a class="link" href="#_wb.releasenotesworkbench.6.2.0.final">21.40。KIE Workbench 6.2.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_download_repository_or_part_of_the_repository_as_a_zip"><a class="anchor" href="#_download_repository_or_part_of_the_repository_as_a_zip"></a> <a class="link" href="#_download_repository_or_part_of_the_repository_as_a_zip">21.40.1。以ZIP格式下载存储库或部分存储库</a></h4>
<div class="paragraph">
<p>使用此功能可以从存储库中下载ZIP格式的存储库或文件夹。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/zip_repo.png" alt="邮编">
</div>
<div class="title">图467。下载当前存储库或项目</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/zip_folder.png" alt="ZIP文件夹">
</div>
<div class="title">图468。下载资料夹</div>
</div>
</div>
<div class="sect3">
<h4 id="_project_editor_permissions"><a class="anchor" href="#_project_editor_permissions"></a> <a class="link" href="#_project_editor_permissions">21.40.2。项目编辑者权限</a></h4>
<div class="paragraph">
<p>添加了为项目编辑器配置基于角色的权限的功能。</p>
</div>
<div class="paragraph">
<p>可以使用以下命令配置权限<code>WEB-INF/classes/workbench-policy.properties</code>文件。</p>
</div>
<div class="paragraph">
<p>支持以下权限：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>保存按钮</p>
<div class="paragraph">
<p><code>feature.wb_project_authoring_save</code></p>
</div>
</li>
<li>
<p>删除按钮</p>
<div class="paragraph">
<p><code>feature.wb_project_authoring_delete</code></p>
</div>
</li>
<li>
<p>复制按钮</p>
<div class="paragraph">
<p><code>feature.wb_project_authoring_copy</code></p>
</div>
</li>
<li>
<p>重命名按钮</p>
<div class="paragraph">
<p><code>feature.wb_project_authoring_rename</code></p>
</div>
</li>
<li>
<p>生成和部署按钮</p>
<div class="paragraph">
<p><code>feature.wb_project_authoring_buildAndDeploy</code></p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_unify_validation_style_in_guided_decision_table_wizard"><a class="anchor" href="#_unify_validation_style_in_guided_decision_table_wizard"></a> <a class="link" href="#_unify_validation_style_in_guided_decision_table_wizard">21.40.3。在“指导决策表向导”中统一验证样式。</a></h4>
<div class="paragraph">
<p>我们所有的新屏幕都使用GWT-Bootstrap小部件，并警告用户以一致的方式输入错误。</p>
</div>
<div class="paragraph">
<p>最明显的区别之一是“引导决策表向导”，该向导以与我们使用GWT-Bootstrap不一致的方式警告错误。</p>
</div>
<div class="paragraph">
<p>此向导已更新，可以使用新的外观。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/NewGuidedDecisionTableWizardValidation.png" alt="NewGuidedDecisionTableWizardValidation">
</div>
<div class="title">图469。新的指导决策表向导验证</div>
</div>
</div>
<div class="sect3">
<h4 id="_improved_wizards"><a class="anchor" href="#_improved_wizards"></a> <a class="link" href="#_improved_wizards">21.40.4。改进的巫师</a></h4>
<div class="paragraph">
<p>在对指导决策表向导进行重新设计以使其验证与应用程序其他区域一致的过程中，我们也借此机会将向导框架也移至了GWT-Bootstrap。</p>
</div>
<div class="paragraph">
<p>产生的外观更加令人愉悦。我们希望在时间和优先级允许的情况下，将更多的旧版编辑器迁移到GWT-Bootstrap。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/NewGuidedDecisionTableWizard.png" alt="新的指导决策表向导">
</div>
<div class="title">图470。新向导框架</div>
</div>
</div>
<div class="sect3">
<h4 id="_consistent_behaviour_of_xls_guided_decision_tables_and_guided_templates"><a class="anchor" href="#_consistent_behaviour_of_xls_guided_decision_tables_and_guided_templates"></a> <a class="link" href="#_consistent_behaviour_of_xls_guided_decision_tables_and_guided_templates">21.40.5。XLS，指导决策表和指导模板的一致行为</a></h4>
<div class="paragraph">
<p>一致性对每个人都是一件好事。用户可以期望不同的编写隐喻会产生相同的规则行为（开发人员会知道什么是错误！）。</p>
</div>
<div class="paragraph">
<p>XLS决策表，指导决策表和指导规则模板生成空单元格的基础规则的方式存在一些不一致之处。消除了这些，使它们的操作一致。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果所有约束都具有空值（空单元格），则不会创建模式。</p>
<div class="paragraph">
<p>您是否需要模式但没有约束；您将需要包括约束<code>this != null</code> 。</p>
</div>
<div class="paragraph">
<p>此操作与XLS和指导决策表始终工作的方式一致。</p>
</div>
</li>
<li>
<p>您可以在字符串字段中为空字符串或空格定义约束，方法是使用双引号将其定界。生成规则时，将从值中删除括起来的引号。</p>
<div class="paragraph">
<p>不需要对其他字符串值使用引号，并且可以将其省略。但是，它们的使用对于区分空字符串和空单元格的约束至关重要-在这种情况下，可以省略该约束。</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_improved_metadata_tab"><a class="anchor" href="#_improved_metadata_tab"></a> <a class="link" href="#_improved_metadata_tab">21.40.6。改进的元数据选项卡</a></h4>
<div class="paragraph">
<p>重新设计了先前版本中提供的“元数据”选项卡，以提供更好的资产版本控制信息浏览和恢复。现在，每个工作台编辑器都将提供一个“概述”选项卡，使用户能够管理以下信息。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/ImprovedMetadataWidget.jpg" alt="改进的MetadataWidget">
</div>
<div class="title">图471。改进的元数据选项卡</div>
</div>
<div class="ulist">
<ul>
<li>
<p>版本历史</p>
<div class="paragraph">
<p>版本历史记录显示资产版本的表格视图，并提供“选择”按钮，使用户能够加载先前创建的版本。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/ImprovedVersionsHistory.jpg" alt="改进版本历史">
</div>
<div class="title">图472。版本历史</div>
</div>
</li>
<li>
<p>元数据</p>
<div class="paragraph">
<p>元数据部分可以访问其他文件属性。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/ImprovedMetadatSection.jpg" alt="改进的元数据部分">
</div>
<div class="title">图473。元数据部分</div>
</div>
</li>
<li>
<p>评论区</p>
<div class="paragraph">
<p>重新设计的注释区域使文件讨论更加清晰。</p>
</div>
</li>
<li>
<p>版本选择下拉列表</p>
<div class="paragraph">
<p>菜单栏上的“版本选择器下拉菜单”提供了从“编辑器”选项卡加载和还原以前版本的功能，而无需打开“概述选项卡”以加载“版本历史记录”。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/ImprovedVersionsSelector.jpg" alt="改进的版本选择器">
</div>
<div class="title">图474。版本选择下拉列表</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_improved_data_objects_editor"><a class="anchor" href="#_improved_data_objects_editor"></a> <a class="link" href="#_improved_data_objects_editor">21.40.7。改进的数据对象编辑器</a></h4>
<div class="paragraph">
<p>Java编辑器已统一为标准工作台编辑器起作用。这意味着现在每个数据对象都在自己的编辑器窗口中进行编辑。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/NewJavaEditor.png" alt="NewJavaEditor">
</div>
<div class="title">图475。改进的数据对象编辑器</div>
</div>
<div class="ulist">
<ul>
<li>
<p>添加了“新建→数据对象”选项以创建数据对象。</p>
</li>
<li>
<p>为每个文件添加了“概述”选项卡，以管理文件元数据并有权访问文件版本历史记录。</p>
</li>
<li>
<p>添加了可编辑的“源选项卡”选项卡。现在，管理员可以使用工作台修改Java代码。</p>
</li>
<li>
<p>提供了“编辑器”-“源选项卡”往返。这将使管理员可以对生成的Java代码进行手动更改，然后返回到编辑器标签以继续工作。</p>
</li>
<li>
<p>类用法检测。每当将要删除或重命名数据对象时，都会在项目中扫描类的用法。如果找到用法（例如在drl文件，决策表等中），则用户将收到警报。这将防止用户中断项目构建。</p>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/UsagesDetection.png" alt="用途检测">
</div>
<div class="title">图476。用法检测</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_execution_server_management_ui"><a class="anchor" href="#_execution_server_management_ui"></a> <a class="link" href="#_execution_server_management_ui">21.40.8。执行服务器管理UI</a></h4>
<div class="paragraph">
<p>在<strong>服务器</strong>顶级菜单下添加了一个称为<strong>管理</strong>的新视角。这种观点使用户能够管理具有多个容器的多个执行服务器。可用功能包括连接到已经部署的执行服务器；创建新的，启动，停止，删除或升级容器。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/NewExecutionServerManagementPerspective.png" alt="NewExecutionServerManagementPerspective">
</div>
<div class="title">图477。管理视角</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p>当前版本的Execution Server仅支持基于规则的执行。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_social_activities"><a class="anchor" href="#_social_activities"></a> <a class="link" href="#_social_activities">21.40.9。社交活动</a></h4>
<div class="paragraph">
<p>在名为<strong>Activity</strong>的新的顶级菜单项组下添加了一个名为<strong>Social Activities的</strong>全新功能。</p>
</div>
<div class="paragraph">
<p>这项新功能分为两个不同的视角： <strong>时间轴视角</strong>和<strong>人员视角</strong> 。</p>
</div>
<div class="paragraph">
<p><strong>时间轴透视图</strong>在左侧显示了登录用户创建或编辑的最近资产。在主窗口中，有一个“最新更改”屏幕，显示所有最近更新的资产以及一个按存储库过滤最近更新的选项。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/TimelinePerspective.png" alt="时间轴透视">
</div>
<div class="title">图478。时间轴透视</div>
</div>
<div class="paragraph">
<p><strong>People Perspective</strong>是用户的主页。显示他的信息（包括用户电子邮件中的照片），用户连接（用户关注的人）以及用户最近的活动。还有一种编辑用户信息的方法。搜索建议可用于导航到用户个人资料，关注他并在您的时间轴上查看他的更新。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/PeoplePerspective.png" alt="以人为本">
</div>
<div class="title">图479。以人为本</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/PeoplePerspective1.png" alt="PeoplePerspective1">
</div>
<div class="title">图480。编辑用户信息</div>
</div>
</div>
<div class="sect3">
<h4 id="_contributors_dashboard"><a class="anchor" href="#_contributors_dashboard"></a> <a class="link" href="#_contributors_dashboard">10.40.10。贡献者仪表板</a></h4>
<div class="paragraph">
<p>在名为<strong>Activity</strong>的新顶级菜单项组下添加了一个名为<strong>Contributors的</strong>全新视角。透视图本身是一个仪表板，其中显示了有关工作台中对托管组织/存储库所做贡献的几个指标。每次从工作台中添加/删除组织/存储库时，仪表板本身都会相应更新。</p>
</div>
<div class="paragraph">
<p>这种新的视角允许监视托管存储库上的基础活动。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/ContributorsPerspective.png" alt="贡献者观点">
</div>
<div class="title">图481。贡献者观点</div>
</div>
</div>
<div class="sect3">
<h4 id="_package_selector"><a class="anchor" href="#_package_selector"></a> <a class="link" href="#_package_selector">11.40.11。包选择器</a></h4>
<div class="paragraph">
<p>创作时新资产的位置由Project Explorer的上下文决定。</p>
</div>
<div class="paragraph">
<p>在“新资源”弹出窗口中，它已被“包选择器”所取代。</p>
</div>
<div class="paragraph">
<p>该位置默认为Project Explorer上下文，但现在可以更轻松地选择其他程序包。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/PackageSelector.png" alt="包选择器">
</div>
<div class="title">图482。包选择器</div>
</div>
</div>
<div class="sect3">
<h4 id="_improved_visual_consistency"><a class="anchor" href="#_improved_visual_consistency"></a> <a class="link" href="#_improved_visual_consistency">12.40.12。改善视觉一致性</a></h4>
<div class="paragraph">
<p>所有弹出窗口都已重构为使用GWT-Bootstrap小部件。</p>
</div>
<div class="paragraph">
<p>尽管进行了简单的更改，但它为整个应用程序带来了更大的视觉一致性。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/GuidedDecisionTableNewPopup.png" alt="GuidedDecisionTableNewPopup">
</div>
<div class="title">图483。指导决策表编辑器示例弹出窗口</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/GuidedRuleNewPopup.png" alt="GuidedRuleNewPopup">
</div>
<div class="title">图484。指导规则编辑器示例弹出窗口</div>
</div>
</div>
<div class="sect3">
<h4 id="_guided_decision_tree_editor"><a class="anchor" href="#_guided_decision_tree_editor"></a> <a class="link" href="#_guided_decision_tree_editor">13.40.13。指导决策树编辑器</a></h4>
<div class="paragraph">
<p>添加了新的编辑器以支持简单决策树的建模。</p>
</div>
<div class="paragraph">
<p>有关使用的更多信息，请参见《用户指南》中的适用部分。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/GuidedDecisionTree1.png" alt="GuidedDecisionTree1">
</div>
<div class="title">图485。指导决策树示例</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_repository_wizard"><a class="anchor" href="#_create_repository_wizard"></a> <a class="link" href="#_create_repository_wizard">14.40.14。创建存储库向导</a></h4>
<div class="paragraph">
<p>已经创建了一个向导来指导存储库的创建过程。现在，用户可以在存储库创建时决定它是托管库还是非托管库，并配置所有相关参数。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/CreateRepositoryWizard1.png" alt="CreateRepositoryWizard1">
</div>
<div class="title">图486。创建存储库向导1/2</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/CreateRepositoryWizard2.png" alt="CreateRepositoryWizard2">
</div>
<div class="title">图487。创建存储库向导2/2</div>
</div>
</div>
<div class="sect3">
<h4 id="_repository_structure_screen"><a class="anchor" href="#_repository_structure_screen"></a> <a class="link" href="#_repository_structure_screen">21.40.15。仓库结构屏幕</a></h4>
<div class="paragraph">
<p>新的存储库结构屏幕将使用户可以管理给定存储库的项目，以及与托管存储库相关的其他操作，例如：分支创建，资产提升和项目发布。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/ManagedRepositoryStructureScreen.png" alt="ManagedRepositoryStructureScreen">
</div>
<div class="title">图488。托管存储库的存储库结构屏幕</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/UnManagedRepositoryStructureScreen.png" alt="UnManagedRepositoryStructureScreen">
</div>
<div class="title">图489。非托管存储库的存储库结构屏幕</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kie.releasenotesintegration.6.2.0"><a class="anchor" href="#_kie.releasenotesintegration.6.2.0"></a> <a class="link" href="#_kie.releasenotesintegration.6.2.0">21.41。集成6.2.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_kie_execution_server"><a class="anchor" href="#_kie_execution_server"></a> <a class="link" href="#_kie_execution_server">21.41.1。KIE执行服务器</a></h4>
<div class="paragraph">
<p>创建了一个新的KIE Execution Server，其目的是支持kjars的部署以及自动创建REST端点以执行远程规则。此初始实现无需任何胶合代码即可支持通过REST设置和执行kjars。</p>
</div>
<div class="paragraph">
<p>用户界面也集成到工作台中以进行远程配置。有关详细信息，请参见工作台的“ New＆Noteworthy”。</p>
</div>
<div class="listingblock">
<div class="title">Kie Server界面</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/server")
public interface KieServer {

    @GET
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response getInfo();

    @POST
    @Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response execute( CommandScript command );

    @GET
    @Path("containers")
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response listContainers();

    @GET
    @Path("containers/{id}")
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response getContainerInfo( @PathParam("id") String id );

    @PUT
    @Path("containers/{id}")
    @Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response createContainer( @PathParam("id") String id, KieContainerResource container );

    @DELETE
    @Path("containers/{id}")
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response disposeContainer( @PathParam("id") String id );

    @POST
    @Path("containers/{id}")
    @Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response execute( @PathParam("id") String id, String cmdPayload );

    @GET
    @Path("containers/{id}/release-id")
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response getReleaseId( @PathParam("id") String id);

    @POST
    @Path("containers/{id}/release-id")
    @Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response updateReleaseId( @PathParam("id") String id, ReleaseId releaseId );

    @GET
    @Path("containers/{id}/scanner")
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response getScannerInfo( @PathParam("id") String id );

    @POST
    @Path("containers/{id}/scanner")
    @Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    public Response updateScanner( @PathParam("id") String id, KieScannerResource resource );

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.6.1.0"><a class="anchor" href="#_drools.releasenotesdrools.6.1.0"></a> <a class="link" href="#_drools.releasenotesdrools.6.1.0">21.42。Drools 6.1.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_jmx_support_for_kiescanner"><a class="anchor" href="#_jmx_support_for_kiescanner"></a> <a class="link" href="#_jmx_support_for_kiescanner">21.42.1。JMX对KieScanner的支持</a></h4>
<div class="paragraph">
<p>在KieScanner和KieContainer上增加了对JMX监视和管理的支持。要启用，请设置属性<code>kie.scanner.mbeans</code>至<code>enabled</code> ，例如通过Java命令行： <code>-Dkie.scanner.mbeans=enabled</code> 。</p>
</div>
<div class="paragraph">
<p>KieScannerMBean将以以下名称注册：</p>
</div>
<div class="paragraph">
<p>它公开了以下属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>扫描仪发行版ID：</strong>配置扫描仪的发行版ID。可能包括Maven范围版本和特殊关键字，例如LATEST，SNAPSHOT等。</p>
</li>
<li>
<p><strong>当前发行版ID：</strong>工件解析到的实际发行版ID。</p>
</li>
<li>
<p><strong>状态：正在</strong>启动，正在扫描，正在更新，正在运行，已停止，正在关闭</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>它还公开了以下操作：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>scanNow（）：</strong>强制对maven存储库进行立即扫描以查找工件更新</p>
</li>
<li>
<p><strong>start（）：</strong>根据轮询间隔参数开始轮询Maven存储库以获取工件更新</p>
</li>
<li>
<p><strong>stop（）：</strong>停止自动轮询Maven存储库</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.6.1.0"><a class="anchor" href="#_wb.releasenotesworkbench.6.1.0"></a> <a class="link" href="#_wb.releasenotesworkbench.6.1.0">21.43。KIE Workbench 6.1.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_data_modeler_round_trip_and_source_code_preservation"><a class="anchor" href="#_data_modeler_round_trip_and_source_code_preservation"></a> <a class="link" href="#_data_modeler_round_trip_and_source_code_preservation">21.43.1。Data Modeler-往返和源代码保存</a></h4>
<div class="paragraph">
<p>现在支持数据建模器和Java源代码之间的完整往返。无论Java代码在何处生成（例如Eclipse，Data Modeller），数据建模器都只会更新必要的代码块以保持模型更新。</p>
</div>
</div>
<div class="sect3">
<h4 id="_data_modeler_improved_annotations"><a class="anchor" href="#_data_modeler_improved_annotations"></a> <a class="link" href="#_data_modeler_improved_annotations">21.43.2。Data Modeler-改进的注释</a></h4>
<div class="paragraph">
<p>添加了新的注释@ TypeSafe，@ ClassReactive，@ PropertyReactive，@ Timestamp，@ Duration和@Expires，以丰富数据建模人员管理的当前Drools注释。</p>
</div>
</div>
<div class="sect3">
<h4 id="_standardization_of_the_display_of_tabular_data"><a class="anchor" href="#_standardization_of_the_display_of_tabular_data"></a> <a class="link" href="#_standardization_of_the_display_of_tabular_data">21.43.3。表格数据显示的标准化</a></h4>
<div class="paragraph">
<p>我们使用新的表格小部件对表格数据的显示进行了标准化。</p>
</div>
<div class="paragraph">
<p>新表支持以下功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>选择可见列</p>
</li>
<li>
<p>可调整大小的列</p>
</li>
<li>
<p>可移动列</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/new-grid.png" alt="新网格">
</div>
<div class="title">图490。新表</div>
</div>
<div class="paragraph">
<p>该表在以下情况下使用：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>收件箱（传入更改）</p>
</li>
<li>
<p>收件箱（最近编辑）</p>
</li>
<li>
<p>收件箱（最近打开）</p>
</li>
<li>
<p>项目问题摘要</p>
</li>
<li>
<p>神器库浏览器</p>
</li>
<li>
<p>项目编辑器依存关系网格</p>
</li>
<li>
<p>项目编辑器KSession网格</p>
</li>
<li>
<p>项目编辑器工作项处理程序配置网格</p>
</li>
<li>
<p>项目编辑器侦听器配置网格</p>
</li>
<li>
<p>搜索结果网格</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_generation_of_modifyx_blocks"><a class="anchor" href="#_generation_of_modifyx_blocks"></a> <a class="link" href="#_generation_of_modifyx_blocks">21.43.4。的产生<code>modify(x) {…​}</code>块</a></h4>
<div class="paragraph">
<p>指导规则编辑器，指导模板编辑器和指导决策表编辑器已更改为生成<code>modify(x){…​}</code></p>
</div>
<div class="paragraph">
<p>从历史上看，这些编辑器支持较旧的<code>update(x)</code>语法，因此在工作台中创建的规则将无法正确响应<code>@PropertyReactive</code>以及模型中的相关注释。现在已经通过使用<code>modify(x){…​}</code>块。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kie.releasenoteskie.6.0.0"><a class="anchor" href="#_kie.releasenoteskie.6.0.0"></a> <a class="link" href="#_kie.releasenoteskie.6.0.0">21.44。KIE API 6.0.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_new_kie_name"><a class="anchor" href="#_new_kie_name"></a> <a class="link" href="#_new_kie_name">21.44.1。新的KIE名称</a></h4>
<div class="paragraph">
<p>KIE是用于将我们的相关项目组合在一起的新的总称；随着家庭的不断壮大。KIE还用于统一API的通用部分；例如构建，部署和加载。这将替代以前使用的kiegroup和Knowledge关键字。</p>
</div>
<div class="imageblock" style="text-align:center">
<div class="content">
<img src="./KIE/Overview/kie.png" alt="ie">
</div>
<div class="title">图491。KIE解剖</div>
</div>
</div>
<div class="sect3">
<h4 id="_maven_aligned_projects_and_modules_and_maven_deployment"><a class="anchor" href="#_maven_aligned_projects_and_modules_and_maven_deployment"></a> <a class="link" href="#_maven_aligned_projects_and_modules_and_maven_deployment">2144.2。Maven对齐项目和模块以及Maven部署</a></h4>
<div class="paragraph">
<p>5.x系列中最大的抱怨之一是缺乏定义的部署方法。Drools和jBPM使用的机制非常灵活，但是太灵活了。6.0的主要重点是简化系统的构建，部署和加载（利用）方面。现在，构建和部署活动与Maven和Maven存储库保持一致。现在，用于加载规则和过程的利用率是面向约定和配置的，而不是面向程序的，并且具有合理的默认设置以最小化配置。</p>
</div>
<div class="paragraph">
<p>可以使用Maven构建项目并将其安装到本地M2_REPO或远程Maven存储库中。然后使用Maven声明和构建依赖项的类路径，以供KIE访问。</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_and_convention_based_projects"><a class="anchor" href="#_configuration_and_convention_based_projects"></a> <a class="link" href="#_configuration_and_convention_based_projects">2144.3。基于配置和约定的项目</a></h4>
<div class="paragraph">
<p>“ kmodule.xml”为KIE项目提供了声明式配置。约定和默认值用于减少所需的配置量。</p>
</div>
<div class="exampleblock">
<div class="title">例子118。声明KieBases和KieSessions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"&gt;
  &lt;kbase name="kbase1" packages="org.mypackages"&gt;
    &lt;ksession name="ksession1"/&gt;
  &lt;/kbase&gt;
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">示例119。利用KieSession</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.getKieClasspathContainer();

KieSession kSession = kContainer.newKieSession("ksession1");
kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiebase_inclusion"><a class="anchor" href="#_kiebase_inclusion"></a> <a class="link" href="#_kiebase_inclusion">21.44.4。KieBase包含</a></h4>
<div class="paragraph">
<p>可以将属于一个KieBase的所有KIE工件包括到第二个KieBase中。这意味着第二个KieBase除了直接定义到其中的所有规则，功能和过程外，还将包含在包含的KieBase中创建的那些规则，功能和过程。可以在kmodule.xml文件中以声明方式完成此包含</p>
</div>
<div class="exampleblock">
<div class="title">例子120。声明式地将KieBase包含到另一个</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;kmodule xmlns="http://www.drools.org/xsd/kmodule"&gt;
  &lt;kbase name="kbase2" includes="kbase1"&gt;
    &lt;ksession name="ksession2"/&gt;
  &lt;/kbase&gt;
&lt;/kmodule&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>或以编程方式使用<code>KieModuleModel</code> 。</p>
</div>
<div class="exampleblock">
<div class="title">示例121。以编程方式将KieBase包含到另一个</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieModuleModel kmodule = KieServices.Factory.get().newKieModuleModel();
KieBaseModel kieBaseModel1 = kmodule.newKieBaseModel("KBase2").addInclude("KBase1");</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiemodules_kiecontainer_and_kie_ci"><a class="anchor" href="#_kiemodules_kiecontainer_and_kie_ci"></a> <a class="link" href="#_kiemodules_kiecontainer_and_kie_ci">21.44.5。KieModules，KieContainer和KIE-CI</a></h4>
<div class="paragraph">
<p>Maven生产的任何带有'kmodule.xml'的JAR都被视为KieModule。这可以从类路径加载，也可以在运行时从资源位置动态加载。如果kie-ci依赖项位于类路径上，则它将嵌入Maven，并且所有解析都将使用Maven自动完成，并且可以访问本地或远程存储库。Maven配置遵循Settings.xml。</p>
</div>
<div class="paragraph">
<p>KieContainer提供了一个运行时来利用KieModule，通过Maven内置了版本控制功能。Kie-ci将根据要加载的工件的所有Maven声明的依赖关系动态创建一个类路径。支持Maven最新，快照，发布和版本范围。</p>
</div>
<div class="exampleblock">
<div class="title">例子122。使用并运行-Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.newKieContainer(
        ks.newReleaseId("org.mygroup", "myartefact", "1.0") );

KieSession kSession = kContainer.newKieSession("ksession1");
kSession.insert(new Message("Dave", "Hello, HAL. Do you read me, HAL?"));
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>如果KIE-CI在类路径中，则可以将KieContainers动态更新为特定版本，并通过Maven进行解析。对于有状态的KieSession，现有会话将增量更新。</p>
</div>
<div class="exampleblock">
<div class="title">示例123动态更新-Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieContainer kContainer.updateToVersion(
                ks.newReleaseId("org.mygroup", "myartefact", "1.1") );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiescanner_2"><a class="anchor" href="#_kiescanner_2"></a> <a class="link" href="#_kiescanner_2">21.44.6。KieScanner</a></h4>
<div class="paragraph">
<p>的<code>KieScanner</code>是Drools 5中存在的KnowledgeAgent的面向Maven的替代。它会持续监视您的Maven存储库，以检查是否已安装新版本的Kie项目，如果已安装，则将其部署在<code>KieContainer</code>包装那个项目。使用<code>KieScanner</code>要求kie-ci.jar位于类路径上。</p>
</div>
<div class="paragraph">
<p>一种<code>KieScanner</code>可以在<code>KieContainer</code>如以下示例所示。</p>
</div>
<div class="exampleblock">
<div class="title">例子124。在KieContainer上注册并启动KieScanner</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
ReleaseId releaseId = kieServices.newReleaseId( "org.acme", "myartifact", "1.0-SNAPSHOT" );
KieContainer kContainer = kieServices.newKieContainer( releaseId );
KieScanner kScanner = kieServices.newKieScanner( kContainer );

// Start the KieScanner polling the Maven repository every 10 seconds
kScanner.start( 10000L );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>在这个例子中<code>KieScanner</code>配置为以固定的时间间隔运行，但也可以通过调用以下命令按需运行<code>scanNow()</code>方法就可以了。如果<code>KieScanner</code>在Maven存储库中找到该用户使用的Kie项目的更新版本<code>KieContainer</code>它会自动下载新版本并触发新项目的增量构建。从这一刻起，所有新<code>KieBase</code>和<code>KieSession</code>以此创建<code>KieContainer</code>将使用新的项目版本。</p>
</div>
</div>
<div class="sect3">
<h4 id="_hierarchical_classloader"><a class="anchor" href="#_hierarchical_classloader"></a> <a class="link" href="#_hierarchical_classloader">21.44.7。分层ClassLoader</a></h4>
<div class="paragraph">
<p>CompositeClassLoader不再使用。因为它一直是性能问题和错误的源头。现在使用传统的分层类加载器。根类加载器处于KieContext级别，每个名称空间有一个子类加载器。这样可以更轻松地添加和删除规则，但DRL文件中的命名空间之间现在不再存在引用。即，函数只能由声明它们的名称空间使用。建议在项目中使用静态Java方法，这对所有名称空间都是可见的。但是不能动态更新那些（与根KieContainer ClassLoader上的其他类一样）。</p>
</div>
</div>
<div class="sect3">
<h4 id="_legacy_api_adapter"><a class="anchor" href="#_legacy_api_adapter"></a> <a class="link" href="#_legacy_api_adapter">21.44.8。旧版API适配器</a></h4>
<div class="paragraph">
<p>通过Maven依赖项“ knowledge-api-legacy5-adapter”仍可使用Drools和jBPM构建和运行5.x API。由于在6.0中部署的性质发生了显着变化，因此无法为KnowledgeAgent提供适配器桥。如果缺少任何其他方法或有问题，请打开JIRA，我们将修复6.1</p>
</div>
</div>
<div class="sect3">
<h4 id="_kie_documentation"><a class="anchor" href="#_kie_documentation"></a> <a class="link" href="#_kie_documentation">21.44.9。KIE文档</a></h4>
<div class="paragraph">
<p>尽管添加了许多新文档来使用新的KIE API，但整个文档尚未更新。因此，将继续引用旧术语。提前致歉，感谢您的耐心配合。我们希望社区中的人们能够与我们一起为6.1更新整个文档</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.6.0.0"><a class="anchor" href="#_drools.releasenotesdrools.6.0.0"></a> <a class="link" href="#_drools.releasenotesdrools.6.0.0">21.45。Drools 6.0.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_phreak_lazy_rule_matching_algorithm"><a class="anchor" href="#_phreak_lazy_rule_matching_algorithm"></a> <a class="link" href="#_phreak_lazy_rule_matching_algorithm">2145.1。PHREAK-惰性规则匹配算法</a></h4>
<div class="paragraph">
<p>在Drools 6.0中完成的主要工作涉及新的PREAK算法。这是一种惰性算法，应可使Drools处理大量规则和事实。AngendaGroups现在可以帮助改善性能，因为只有在尝试触发规则时才对其进行评估。</p>
</div>
<div class="paragraph">
<p>PHREAK继续支持顺序模式，但现在允许“修改”。尽管顺序配置不存在“推论”，但由于规则被懒惰地评估，因此任何尚未评估的规则将由于“修改”而看到更新的数据。这更符合人们直观地认为顺序工作的方式。</p>
</div>
<div class="paragraph">
<p>已针对PHREAK调整了冲突解决顺序，现在按显着性然后按规则顺序进行了排序；根据文件中的规则位置。在Drools 6.0.0之前，在突出显示之后，它被认为是任意的。当KieModules和updateToVersion用于动态部署时，文件中的规则顺序将通过diff处理保留。</p>
</div>
</div>
<div class="sect3">
<h4 id="_automatically_firing_timed_rule_in_passive_mode"><a class="anchor" href="#_automatically_firing_timed_rule_in_passive_mode"></a> <a class="link" href="#_automatically_firing_timed_rule_in_passive_mode">21.45.2。在被动模式下自动触发定时规则</a></h4>
<div class="paragraph">
<p>默认情况下，当Drools引擎在被动模式下运行时（即：使用fireAllRules），它不会触发定时规则，除非不会再次调用fireAllRules。现在可以通过使用以下命令配置KieSession来更改此默认行为： <code>TimedRuleExectionOption</code>如以下示例所示。</p>
</div>
<div class="exampleblock">
<div class="title">示例125配置KieSession以自动执行定时规则</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
ksconf.setOption( TimedRuleExectionOption.YES );
KSession ksession = kbase.newKieSession(ksconf, null);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>也可以对必须自动执行的定时规则进行更精细的控制。为此，必须设置一个“已过滤” <code>`TimedRuleExectionOption</code>可以定义一个回调来过滤这些规则，如下面的示例所示。</p>
</div>
<div class="exampleblock">
<div class="title">示例126配置过滤器以选择应自动执行哪些定时规则</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
conf.setOption( new TimedRuleExectionOption.FILTERED(new TimedRuleExecutionFilter() {
    public boolean accept(Rule[] rules) {
        return rules[0].getName().equals("MyRule");
    }
}) );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_expression_timers"><a class="anchor" href="#_expression_timers"></a> <a class="link" href="#_expression_timers">2145.3。表达计时器</a></h4>
<div class="paragraph">
<p>现在可以将间隔计时器的延迟和间隔定义为表达式而不是固定值。为此，必须将计时器声明为表达式一（用“ expr：”表示），如以下示例所示：</p>
</div>
<div class="exampleblock">
<div class="title">例子127。表达式计时器示例</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">declare Bean
    delay   : String = "30s"
    period  : long = 60000
end

rule "Expression timer"
    timer( expr: $d, $p )
when
    Bean( $d : delay, $p : period )
then
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，表达式$ d和$ p可以使用规则的模式匹配部分中定义的任何变量，并且可以是可以在一段时间内解析的任何String或可以在内部进行长时间转换的任何数值。代表以毫秒为单位的持续时间。</p>
</div>
<div class="paragraph">
<p>时间间隔和表达式计时器都可以具有3个可选参数，分别名为“开始”，“结束”和“重复限制”。当使用这些参数中的一个或多个时，计时器定义的第一部分必须后跟分号“;”。并且参数必须用逗号“，”分隔，如以下示例所示：</p>
</div>
<div class="exampleblock">
<div class="title">示例128。具有开始和结束的间隔计时器</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">timer (int: 30s 10s; start=3-JAN-2010, end=5-JAN-2010)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>start和end参数的值可以是Date，代表Date的String或长整数，或者通常是任何Number，可以用以下转换在Java Date中进行转换：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">new Date( ((Number) n).longValue() )</code></pre>
</div>
</div>
<div class="paragraph">
<p>相反，repeat-limit只能是整数，它定义计时器允许的最大重复次数。如果同时设置了end和repeat-limit参数，则当两者中的第一个匹配时，计时器将停止。</p>
</div>
<div class="paragraph">
<p>使用start参数意味着为计时器定义了一个阶段，其中阶段的开始由开始本身加上最终的延迟给出。换句话说，在这种情况下，有时会安排定时规则：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">start + delay + n*period</code></pre>
</div>
</div>
<div class="paragraph">
<p>最多可重复限制时间，且不得迟于结束时间戳记（以先到者为准）。例如具有以下间隔计时器的规则</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">timer ( int: 30s 1m; start="3-JAN-2010" )</code></pre>
</div>
</div>
<div class="paragraph">
<p>排定在2010年1月3日午夜之后的每分钟30秒。这也意味着，例如，如果您在3-FEB-2010的午夜打开系统，则不会立即进行安排，但会保留计时器定义的阶段，因此将在30秒后第一次进行安排午夜。如果由于某种原因系统被暂停（例如，会话被序列化，然后在一段时间后反序列化），则该规则将仅计划一次以从丢失的激活中恢复（无论我们错过了多少激活），随后将再次计划该规则。与计时器的相位。</p>
</div>
</div>
<div class="sect3">
<h4 id="_ruleflowgroups_and_agendagroups_are_merged"><a class="anchor" href="#_ruleflowgroups_and_agendagroups_are_merged"></a> <a class="link" href="#_ruleflowgroups_and_agendagroups_are_merged">21.45.4。RuleFlowGroups和AgendaGroups合并</a></h4>
<div class="paragraph">
<p>这两个组已合并，现在RuleFlowGroups的行为与AgendaGroups相同。出于弃用的原因，保留了get方法，但是它们都返回相同的基础数据。当jBPM激活组时，它现在仅调用setFocus。一起使用RuleFlowGroups和AgendaGroups会继续导致错误。它还使代码库与PHREAK和将来计划的多核开发保持一致。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.6.0.0"><a class="anchor" href="#_wb.releasenotesworkbench.6.0.0"></a> <a class="link" href="#_wb.releasenotesworkbench.6.0.0">21.46。KIE Workbench 6.0.0中的新功能和值得注意的功能</a></h3>
<div class="paragraph">
<p>使用名为UberFire的新基础项目对工作台进行了大修。UberFire受Eclipse的启发，为工作台提供了一个干净，可扩展和灵活的框架。最终结果不仅为我们的最终用户带来了更丰富的体验，而且我们现在可以使用干净的基于组件的体系结构更快地发展。如果您喜欢他的Workbench经验，则可以立即使用UberFire来构建自己的基于Web的仪表板和控制台。</p>
</div>
<div class="paragraph">
<p>除了迁移到UberFire之外，另一个最大的变化是从JCR迁移到Git。有一个实用程序项目可帮助迁移。Git是最具可伸缩性和功能最强大的源存储库，没有。JGit为Git提供了可靠的OSS实现。这解决了各种JCR实现的持续性能问题，一旦文件数量和版本数量变得过高，这些问题就会放慢速度。为了消除复杂性，已经有了很大的“低技术含量”驱动力。现在，所有内容都存储为文件，包括元数据。该数据库仅用于提供快速索引和搜索。因此，导入和导出都是所有标准Git，外部站点（例如GitHub）可用于交换存储库。</p>
</div>
<div class="paragraph">
<p>在5.x中，开发人员将使用自己的源存储库，然后通过团队提供程序推送JCR。该团队提供者功能不全，在Eclipse之外不可用。Git使我们的资源库可以处理任何现有的Git工具或团队提供者。虽然UI尚不支持，但会随着时间的推移添加它，但可以连接到存储库并标记和分支并还原内容。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/kie-drools-wb.png" alt="凯·基洛尔斯wb">
</div>
<div class="title">图492。工作台</div>
</div>
<div class="paragraph">
<p>Guvnor品牌从其预期角色中泄漏了太多；例如决策表之类的创作隐喻，被视为Guvnor组件而不是Drools组件。Guvnor在5.x中使用的整体项目结构对此无济于事。在6.0版中，Guvnor的重点已缩小到封装UberFire插件集，这些插件提供了构建基于Web的IDE的基础。例如用于构建和部署的Maven集成，通过收件箱管理Maven存储库和活动通知。Drools和jBPM以Uberfire为基础构建工作台发行版，包括一组插件（例如Guvnor）以及自己的插件，用于决策表，指导编辑器，BPMN2设计器和人工任务。</p>
</div>
<div class="paragraph">
<p>“模型结构”图概述了新项目的结构。Drools工作台称为KIE-Drools-WB。 KIE-WB是结合了所有Guvnor，Drools和jBPM插件的uber工作台。由于jBPM-WB实际上并不存在，因此被KIE-WB冗余了，因此已被删除。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Workbench/ReleaseNotes/kie-structure.png" alt="凯结构">
</div>
<div class="title">图493。模块结构</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="重要"></i>
</td>
<td class="content">
<div class="paragraph">
<p>KIE Drools Workbench和KIE Workbench共享通用工作台功能的一组公共组件，例如项目导航，项目定义，基于Maven的项目，Maven Artifact存储库。在本文档中，将更详细地描述这些通用功能。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>两个主要分布包括：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>KIE Drools工作台</p>
<div class="ulist">
<ul>
<li>
<p>Drools编辑器，用于规则和辅助资产。</p>
</li>
<li>
<p>jBPM Designer，用于规则流和支持资产。</p>
</li>
</ul>
</div>
</li>
<li>
<p>KIE工作台</p>
<div class="ulist">
<ul>
<li>
<p>Drools编辑器，用于规则和辅助资产。</p>
</li>
<li>
<p>jBPM Designer，用于BPMN2和支持资产。</p>
</li>
<li>
<p>业务中心，运行时和人工任务支持。</p>
</li>
<li>
<p>jBPM表单生成器。</p>
</li>
<li>
<p>BAM。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>工作台亮点：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>新的灵活的工作台环境，带有透视图和面板。</p>
</li>
<li>
<p>遵循KIE API的新打包和构建系统。</p>
<div class="ulist">
<ul>
<li>
<p>基于Maven的项目。</p>
</li>
<li>
<p>Maven Artifact信息库取代了Global Area，并提供了完全依赖项支持。</p>
</li>
</ul>
</div>
</li>
<li>
<p>New Data Modeller取代了声明式事实模型编辑器；将Java类的创作带入创作环境。Java类被打包到项目中，并且可以在规则，流程等中使用，也可以在您自己的应用程序中外部使用。</p>
</li>
<li>
<p>虚拟文件系统用默认的基于Git的实现代替了JCR。</p>
<div class="ulist">
<ul>
<li>
<p>基于默认Git的实现支持远程操作。</p>
</li>
<li>
<p>外部修改出现在工作台中。</p>
</li>
</ul>
</div>
</li>
<li>
<p>增量构建系统，几乎实时显示您的项目和资产的验证结果。</p>
<div class="literalblock">
<div class="content">
<pre>The editors themselves are largely unchanged; however of note imports have moved from the package definition to individual editors so you need only import types used for an asset and not the package as a whole.</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_kie.releasenotesintegration.6.0.0"><a class="anchor" href="#_kie.releasenotesintegration.6.0.0"></a> <a class="link" href="#_kie.releasenotesintegration.6.0.0">21.47。集成6.0.0中的新功能和值得注意的功能</a></h3>
<div class="sect3">
<h4 id="_cdi"><a class="anchor" href="#_cdi"></a> <a class="link" href="#_cdi">21.47.1。CDI</a></h4>
<div class="listingblock">
<div class="title">“ jar1”的并行版本加载。KBase1'KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession("kbase1")
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.0")
private KieBase kbase1v10;

@Inject
@KBase("kbase1")
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.1")
private KieBase kbase1v10;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">“ jar1”的并行版本加载。KBase1'KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@KSession("ksession1")
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.0")
private KieSession ksessionv10;

@Inject
@KSession("ksession1")
@KReleaseId( groupId = "jar1", rtifactId = "art1", version = "1.1")
private KieSession ksessionv11;</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在，CDI已紧密集成到KIE API中。它可以用来注入版本化的KieSession和KieBases。</p>
</div>
</div>
<div class="sect3">
<h4 id="_spring"><a class="anchor" href="#_spring"></a> <a class="link" href="#_spring">21.47.2。弹簧</a></h4>
<div class="paragraph">
<p>Spring已进行了改进，现在已与KIE集成。 Spring可以用功能更强大的spring版本替换'kmodule.xml'。目的是与kmodule.xml保持一致</p>
</div>
</div>
<div class="sect3">
<h4 id="_aries_blueprints"><a class="anchor" href="#_aries_blueprints"></a> <a class="link" href="#_aries_blueprints">21.47.3。白羊座的蓝图</a></h4>
<div class="paragraph">
<p>现在也支持白羊座的蓝图，并遵循春季所做的工作。目的是与spring和kmodule.xml保持一致</p>
</div>
</div>
<div class="sect3">
<h4 id="_osgi_ready"><a class="anchor" href="#_osgi_ready"></a> <a class="link" href="#_osgi_ready">21.47.4。准备好OSGi</a></h4>
<div class="paragraph">
<p>所有模块都经过重构，以避免软件包拆分，这在5.x中是一个问题。测试已移至PAX。</p>
</div>
</div>
</div>
</strong></div><strong>
</strong></div></div>
</div>
<div id="footer">
<div id="footer-text">版本7.30.0。最后<br>上次更新时间2019-11-26 20:59:04 CET</div>
</div>
<!-- Collapsed Table of Content -->
<script src="website/jquery/jquery.min.js"></script>
<script src="website/jstree/jstree.min.js"></script>
<script src="website/toc.js"></script>

<!-- Adobe Analytics for Red Hat - DPAL (DTM Property Auto-Loader) - part 2/2 -->
<script type="text/javascript">
    if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
        _satellite.pageBottom();
    }
</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>

</body></html>