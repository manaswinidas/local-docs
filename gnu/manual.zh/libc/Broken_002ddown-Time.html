<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>故障时间（GNU C库）</title>

<meta name="description" content="Broken-down Time (The GNU C Library)">
<meta name="keywords" content="Broken-down Time (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Calendar-Time.html#Calendar-Time" rel="up" title="Calendar Time">
<link href="High-Accuracy-Clock.html#High-Accuracy-Clock" rel="next" title="High Accuracy Clock">
<link href="High_002dResolution-Calendar.html#High_002dResolution-Calendar" rel="prev" title="High-Resolution Calendar">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Broken_002ddown-Time"></span><div class="header">
<p>下一篇： <a href="High-Accuracy-Clock.html#High-Accuracy-Clock" rel="next" accesskey="n">高精度时钟</a> ，上一篇： <a href="High_002dResolution-Calendar.html#High_002dResolution-Calendar" rel="prev" accesskey="p">高分辨率日历</a> ，上一篇： <a href="Calendar-Time.html#Calendar-Time" rel="up" accesskey="u">日历时间</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Broken_002ddown-Time-1"></span><h4 class="subsection">21.4.3故障时间</h4>
<span id="index-broken_002ddown-time-1"></span>
<span id="index-calendar-time-and-broken_002ddown-time"></span>

<p>日历时间由GNU C库的常规功能表示为自固定基础日历时间起的经过时间。这对于计算很方便，但与人们通常认为日历时间的方式无关。相比之下， <em>细分时间</em>是日历时间的二进制表示形式，分为年，月，日等。细分的时间值对于计算没有用，但是对于打印人类可读的时间信息很有用。
</p>
<p>细分的时间值始终与选择的时区相关，并且还指示该时区。
</p>
<p>本节中的符号在头文件中声明<samp>time.h</samp> 。
</p>
<dl>
<dt id="index-struct-tm">数据类型： <strong>struct tm</strong></dt>
<dd>
<p>这是用于表示故障时间的数据类型。该结构至少包含以下成员，这些成员可以按任何顺序出现。
</p>
<dl compact>
<dt><code>int tm_sec</code></dt>
<dd><p>这是自分钟最高点起的整秒数（通常在该范围内） <code>0</code>通过<code>59</code> ，但实际上限是<code>60</code> ，以便在有leap秒支持的情况下提供leap秒）。
<span id="index-leap-second"></span>
</p>
</dd>
<dt><code>int tm_min</code></dt>
<dd><p>这是自小时最高点以来的完整分钟数（在该范围内<code>0</code>通过<code>59</code> ）。
</p>
</dd>
<dt><code>int tm_hour</code></dt>
<dd><p>这是午夜之后的完整小时数（在该范围内<code>0</code>通过<code>23</code> ）。
</p>
</dd>
<dt><code>int tm_mday</code></dt>
<dd><p>这是每月的第几天（范围<code>1</code>通过<code>31</code> ）。注意这一点！作为结构中唯一的序数，它与结构的其余部分不一致。
</p>
</dd>
<dt><code>int tm_mon</code></dt>
<dd><p>这是自年初以来的完整日历月数（范围<code>0</code>通过<code>11</code> ）。注意这一点！人们通常使用年份中的序数（其中一月= 1）。
</p>
</dd>
<dt><code>int tm_year</code></dt>
<dd><p>这是自1900年以来的完整日历年数。
</p>
</dd>
<dt><code>int tm_wday</code></dt>
<dd><p>这是自周日以来的整天数（范围为<code>0</code>通过<code>6</code> ）。
</p>
</dd>
<dt><code>int tm_yday</code></dt>
<dd><p>这是自年初以来的整天数（范围为<code>0</code>通过<code>365</code> ）。
</p>
</dd>
<dt><code>int tm_isdst</code></dt>
<dd><span id="index-Daylight-Saving-Time"></span>
<span id="index-summer-time"></span>
<p>这是一个标志，指示夏令时在上述时间是否有效。如果“夏令时”有效，则该值为正；如果不启用，则为零；如果该信息不可用，则该值为负。
</p>
</dd>
<dt><code>long int tm_gmtoff</code></dt>
<dd><p>该字段描述了用于计算此细分时间值的时区，包括夏时制的任何调整；这是您必须添加到UTC以获取本地时间的秒数。您也可以将其视为UTC以东的秒数。例如，对于美国东部标准时间，该值为<code>-5*60*60</code> 。的<code>tm_gmtoff</code>字段源自BSD，是GNU库扩展；在严格的ISO C <!-- /@w -->环境中不可见。
</p>
</dd>
<dt><code>const char *tm_zone</code></dt>
<dd><p>此字段是用于计算此细分时间值的时区的名称。喜欢<code>tm_gmtoff</code> ，此字段是BSD和GNU扩展，在严格的ISO C <!-- /@w -->环境中不可见。
</p></dd>
</dl>
</dd></dl>


<dl>
<dt id="index-localtime">函数： <em>struct tm *</em> <strong>localtime</strong> <em>（const time_t * <var>time</var> ）</em></dt>
<dd>
<p>初步： MT不安全种族：tmbuf env语言环境| AS不安全堆锁| AC不安全锁内存fd |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>localtime</code>函数转换由指向的简单时间<var>time</var>细分的时间表示形式，相对于用户指定的时区表示。
</p>
<p>返回值是指向静态分解时间结构的指针，该结构可能会被后续的对<code>ctime</code> ， <code>gmtime</code> ， 要么<code>localtime</code> 。（但是没有其他库函数会覆盖此对象的内容。）
</p>
<p>返回值是空指针，如果<var>time</var>不能表示为故障时间；通常是因为年份无法适应<code>int</code> 。
</p>
<p>呼唤<code>localtime</code>也将当前时区设置为<code>tzset</code>被称为。请参阅<a href="Time-Zone-Functions.html#Time-Zone-Functions">时区功能</a> 。
</p></dd></dl>

<p>使用<code>localtime</code>函数是多线程程序中的大问题。结果将返回到静态缓冲区中，并在所有线程中使用。POSIX.1c引入了此功能的变体。
</p>
<dl>
<dt id="index-localtime_005fr">功能： <em>struct tm *</em> <strong>localtime_r</strong> <em>（const time_t * <var>time</var> ，struct tm * <var>resultp</var> ）</em></dt>
<dd>
<p>初步： MT安全环境语言环境| AS不安全堆锁| AC不安全锁内存fd |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>


<p>的<code>localtime_r</code>功能就像<code>localtime</code>功能。它需要一个指向包含简单时间的变量的指针，并将其转换为细分时间格式。
</p>
<p>但是结果不会放在静态缓冲区中。而是将其放置在类型的对象中<code>struct tm</code>该参数<var>resultp</var>点。
</p>
<p>如果转换成功，函数将返回指向结果写入对象的指针，即返回<var>resultp</var> 。
</p></dd></dl>


<dl>
<dt id="index-gmtime">功能： <em>struct tm *</em> <strong>gmtime</strong> <em>（const time_t * <var>time</var> ）</em></dt>
<dd>
<p>初步： MT不安全种族：tmbuf env语言环境| AS不安全堆锁| AC不安全锁内存fd |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>该功能类似于<code>localtime</code> ，但细分时间以协调世界时（UTC）（以前称为格林威治标准时间（GMT））表示，而不是相对于本地时区。
</p>
</dd></dl>

<p>至于<code>localtime</code>函数我们有一个问题，就是结果被放在一个静态变量中。POSIX.1c还提供了替代<code>gmtime</code> 。
</p>
<dl>
<dt id="index-gmtime_005fr">功能： <em>struct tm *</em> <strong>gmtime_r</strong> <em>（const time_t * <var>time</var> ，struct tm * <var>resultp</var> ）</em></dt>
<dd>
<p>初步： MT安全环境语言环境| AS不安全堆锁| AC不安全锁内存fd |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>该功能类似于<code>localtime_r</code> ，除了它的转换方式类似于<code>gmtime</code>给定时间为协调世界时。
</p>
<p>如果转换成功，函数将返回指向结果写入对象的指针，即返回<var>resultp</var> 。
</p></dd></dl>


<dl>
<dt id="index-mktime">函数： <em>time_t</em> <strong>mktime</strong> <em>（结构tm * <var>brokentime</var> ）</em></dt>
<dd>
<p>初步： MT安全环境语言环境| AS不安全堆锁| AC不安全锁内存fd |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>mktime</code>函数将分解的时间结构转换为简单的时间表示。它还规范化了细分时间结构的内容，并根据其他组件的值填充了其中的一些组件。
</p>
<p>的<code>mktime</code>函数将忽略指定的内容<code>tm_wday</code> ， <code>tm_yday</code> ， <code>tm_gmtoff</code>和<code>tm_zone</code>细分时间结构的成员。它使用其他组件的值确定日历时间。这些组件允许具有超出其正常范围的非标准化值。最后一件事<code>mktime</code>所做的是调整<var>brokentime</var>结构，包括最初被忽略的成员。
</p>
<p>如果指定的细分时间不能表示为简单时间， <code>mktime</code>返回值<code>(time_t)(-1)</code>并且不修改以下内容<var>brokentime</var> 。
</p>
<p>呼唤<code>mktime</code>也将当前时区设置为<code>tzset</code>被称为; <code>mktime</code>使用此信息代替<var>brokentime</var>的首字母<code>tm_gmtoff</code>和<code>tm_zone</code>成员。请参阅<a href="Time-Zone-Functions.html#Time-Zone-Functions">时区功能</a> 。
</p></dd></dl>

<dl>
<dt id="index-timelocal">函数： <em>time_t</em> <strong>timelocal</strong> <em>（struct tm * <var>brokentime</var> ）</em></dt>
<dd>
<p>初步： MT安全环境语言环境| AS不安全堆锁| AC不安全锁内存fd |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>


<p><code>timelocal</code>在功能上与<code>mktime</code> ，但更易记。请注意，它是<code>localtime</code>功能。
</p>
<p><strong>便携性说明：</strong> <code>mktime</code>本质上是普遍可用的。 <code>timelocal</code>相当罕见。
</p>
</dd></dl>

<dl>
<dt id="index-timegm">函数： <em>time_t</em> <strong>timegm</strong> <em>（结构tm * <var>brokentime</var> ）</em></dt>
<dd>
<p>初步： MT安全环境语言环境| AS不安全堆锁| AC不安全锁内存fd |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>


<p><code>timegm</code>在功能上与<code>mktime</code>除了它总是将输入值作为世界标准时间（UTC）之外，无论任何本地时区设置如何。
</p>
<p>注意<code>timegm</code>是...的逆<code>gmtime</code> 。
</p>
<p><strong>便携性说明：</strong> <code>mktime</code>本质上是普遍可用的。 <code>timegm</code>相当罕见。对于从UTC分解时间到简单时间的最便捷的转换，请设置<code>TZ</code> UTC环境变量，调用<code>mktime</code> ，然后设定<code>TZ</code>背部。
</p>
</dd></dl>



<hr>
<div class="header">
<p>下一篇： <a href="High-Accuracy-Clock.html#High-Accuracy-Clock" rel="next" accesskey="n">高精度时钟</a> ，上一篇： <a href="High_002dResolution-Calendar.html#High_002dResolution-Calendar" rel="prev" accesskey="p">高分辨率日历</a> ，上一篇： <a href="Calendar-Time.html#Calendar-Time" rel="up" accesskey="u">日历时间</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>