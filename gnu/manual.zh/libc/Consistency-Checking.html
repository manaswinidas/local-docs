<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>一致性检查（GNU C库）</title>

<meta name="description" content="Consistency Checking (The GNU C Library)">
<meta name="keywords" content="Consistency Checking (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Language-Features.html#Language-Features" rel="up" title="Language Features">
<link href="Variadic-Functions.html#Variadic-Functions" rel="next" title="Variadic Functions">
<link href="Language-Features.html#Language-Features" rel="prev" title="Language Features">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Consistency-Checking"></span><div class="header">
<p>下一页： <a href="Variadic-Functions.html#Variadic-Functions" rel="next" accesskey="n">可变参数函数</a> ，上一页： <a href="Language-Features.html#Language-Features" rel="up" accesskey="u">语言功能</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Explicitly-Checking-Internal-Consistency"></span><h3 class="section">A.1明确检查内部一致性</h3>
<span id="index-consistency-checking"></span>
<span id="index-impossible-events"></span>
<span id="index-assertions"></span>

<p>在编写程序时，通常最好在战略位置检查“不可能的”错误或违反基本假设。例如，这些检查有助于调试程序不同部分之间的接口问题。
</p>
<span id="index-assert_002eh"></span>
<p>的<code>assert</code>宏，在头文件中定义<samp>assert.h</samp> ，提供了一种方便的方法来中止程序，同时打印一条有关在程序中检测到错误的消息。
</p>
<span id="index-NDEBUG"></span>
<p>一旦您认为程序已调试，就可以禁用由程序执行的错误检查。 <code>assert</code>通过与宏重新编译宏<code>NDEBUG</code>定义。这意味着您实际上不必更改程序源代码即可禁用这些检查。
</p>
<p>但是禁用这些一致性检查是不可取的，除非它们使程序变慢得多。在所有其他条件相同的情况下，无论谁运行该程序，进行更多错误检查都是一件好事。明智的用户显然会导致程序崩溃，而不是在没有任何提示可能出错的情况下无意义地返回程序。
</p>
<dl>
<dt id="index-assert">宏： <em>void</em> <strong>assert</strong> <em>（int <var>expression</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS不安全堆损坏| AC不安全的内存锁损坏|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>验证程序员的信念<var>expression</var>在程序中此时不为零。
</p>
<p>如果<code>NDEBUG</code>没有定义， <code>assert</code>测试的价值<var>expression</var> 。如果为假（零）， <code>assert</code>在打印以下形式的消息后中止程序（请参阅<a href="Aborting-a-Program.html#Aborting-a-Program">中止程序</a> ）：</p>
<div class="example">
<pre class="example"><samp><var>file</var></samp>:<var>linenum</var>: <var>function</var>: Assertion `<var>expression</var>' failed.
</pre></div>

<p>在标准错误流上<code>stderr</code> （请参阅<a href="Standard-Streams.html#Standard-Streams">标准流</a> ）。文件名和行号取自C预处理程序宏<code>__FILE__</code>和<code>__LINE__</code>并指定调用的位置<code>assert</code>被制造。使用GNU C编译器时，调用的函数名称<code>assert</code>取自内置变量<code>__PRETTY_FUNCTION__</code> ;对于较早的编译器，将省略函数名称和以下冒号。
</p>
<p>如果预处理器宏<code>NDEBUG</code>在之前定义<samp>assert.h</samp>包括在内<code>assert</code>宏定义为绝对不执行任何操作。
</p>
<p><strong>警告：</strong>即使参数表达式<var>expression</var>不评估是否<code>NDEBUG</code>有效。所以永远不要使用<code>assert</code>带有副作用的论点。例如， <code>assert (++i > 0);</code>这是一个坏主意，因为<code>i</code>如果不会增加<code>NDEBUG</code>被定义为。
</p></dd></dl>

<p>有时，您要检查的“不可能”条件是操作系统功能返回的错误。然后，不仅显示程序崩溃的位置，还显示返回的错误很有用。的<code>assert_perror</code>宏使这变得容易。
</p>
<dl>
<dt id="index-assert_005fperror">宏： <em>void</em> <strong>assert_perror</strong> <em>（int <var>errnum</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS不安全堆损坏| AC不安全的内存锁损坏|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>相似<code>assert</code> ，但验证<var>errnum</var>是零。
</p>
<p>如果<code>NDEBUG</code>没有定义， <code>assert_perror</code>测试的价值<var>errnum</var> 。如果不是零<code>assert_perror</code>在打印以下形式的消息后中止程序：</p>
<div class="example">
<pre class="example"><samp><var>file</var></samp>:<var>linenum</var>: <var>function</var>: <var>error text</var>
</pre></div>

<p>在标准错误流上。文件名，行号和函数名相同<code>assert</code> 。错误文字是<code>strerror (<var>errnum</var>)</code> <!-- /@w --> 。请参阅<a href="Error-Messages.html#Error-Messages">错误消息</a> 。
</p>
<p>喜欢<code>assert</code>如果<code>NDEBUG</code>在之前定义<samp>assert.h</samp>包括在内<code>assert_perror</code>宏绝对不执行任何操作。它不评估参数，因此<var>errnum</var>应该没有任何副作用。最好是<var>errnum</var>只是一个简单的变量引用；通常会<code>errno</code> 。
</p>
<p>此宏是GNU扩展。
</p></dd></dl>

<p><strong>使用说明：</strong> <code>assert</code>设计用于检测<em>内部不一致的设施</em> ;它不适用于报告程序<em>用户</em>的无效输入或不正确的使用情况。
</p>
<p>诊断消息中的信息由<code>assert</code>和<code>assert_perror</code>宏旨在帮助您（程序员）找出错误的原因，但是对于告诉程序用户为什么他或她的输入无效或为什么无法执行命令并没有真正的用处。而且，当输入无效时，您的程序不应中止，因为<code>assert</code>会这样做-在打印错误消息后，它应该以非零状态<a href="Exit-Status.html#Exit-Status">退出</a> （请参阅<a href="Exit-Status.html#Exit-Status">Exit Status</a> ），或者阅读其他命令或移至下一个输入文件。
</p>
<p>见<a href="Error-Messages.html#Error-Messages">错误信息</a> ，对信息上打印错误消息<em>不</em>表示程序中的错误问题。
</p>

<hr>
<div class="header">
<p>下一页： <a href="Variadic-Functions.html#Variadic-Functions" rel="next" accesskey="n">可变参数函数</a> ，上一页： <a href="Language-Features.html#Language-Features" rel="up" accesskey="u">语言功能</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>