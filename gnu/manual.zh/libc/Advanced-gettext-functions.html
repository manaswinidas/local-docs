<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>先进的gettext函数（GNU C库）</title>

<meta name="description" content="Advanced gettext functions (The GNU C Library)">
<meta name="keywords" content="Advanced gettext functions (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Message-catalogs-with-gettext.html#Message-catalogs-with-gettext" rel="up" title="Message catalogs with gettext">
<link href="Charset-conversion-in-gettext.html#Charset-conversion-in-gettext" rel="next" title="Charset conversion in gettext">
<link href="Locating-gettext-catalog.html#Locating-gettext-catalog" rel="prev" title="Locating gettext catalog">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Advanced-gettext-functions"></span><div class="header">
<p>下一篇： <a href="Charset-conversion-in-gettext.html#Charset-conversion-in-gettext" rel="next" accesskey="n">gettext中的字符集转换</a> ，上一篇： <a href="Locating-gettext-catalog.html#Locating-gettext-catalog" rel="prev" accesskey="p">查找gettext目录</a> ，上一篇： <a href="Message-catalogs-with-gettext.html#Message-catalogs-with-gettext" rel="up" accesskey="u">带有gettext的消息目录</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Additional-functions-for-more-complicated-situations"></span><h4 class="subsubsection">8.2.1.3用于更复杂情况的附加功能</h4>

<p>的功能<code>gettext</code>到目前为止描述的家庭（以及所有<code>catgets</code>功能方面的问题）在现实世界中存在一个已被所有现有方法完全忽略的问题。这里的意思是复数形式的处理。
</p>
<p>在任何人想到国际化之前（甚至可悲的是，在此之后）浏览Unix源代码，人们通常都可以找到类似于以下内容的代码：</p>
<div class="example">
<pre class="example">   printf (&quot;%d file%s deleted&quot;, n, n == 1 ? &quot;&quot; : &quot;s&quot;);
</pre></div>

<p>在人们首次对代码进行国际化的抱怨之后，人们要么完全避免使用这种形式，要么使用诸如<code>"file(s)"</code> 。两者看起来都不自然，应避免使用。首先尝试正确解决问题，如下所示：</p>
<div class="example">
<pre class="example">   if (n == 1)
     printf (&quot;%d file deleted&quot;, n);
   else
     printf (&quot;%d files deleted&quot;, n);
</pre></div>

<p>但这不能解决问题。它可以帮助不简单地通过添加“ s”而仅构成名词的复数形式的语言，仅此而已。人们再次陷入了相信他们的语言使用规则普遍的陷阱。但是在语言族之间，对复数形式的处理差异很大。我们之间（甚至在语言家族内部）有两点不同。</p>
<ul>
<li>复数形式构建的形式不同。这是具有许多不规则之处的语言的问题。例如，德语就是一个严峻的案例。尽管英语和德语是同一语言家族（德语）的一部分，但德语中几乎找不到几乎所有形式的复数名词形式（后接“ s”）。

</li><li>复数形式的数量不同。对于那些只有罗马语和日耳曼语经验的人来说，这有些令人惊讶，因为这里的数字是相同的（有两个）。

<p>但是其他语言族只有一种形式或多种形式。有关更多信息，请参阅附加部分。
</p></li></ul>

<p>这样的结果是应用程序编写者不应尝试解决其代码中的问题。这将是本地化，因为它仅适用于某些硬编码语言环境。而是扩展<code>gettext</code>应该使用接口。
</p>
<p>这些额外的功能取代了一个键字符串，两个字符串和一个数字参数。其背后的思想是，使用数字参数和第一个字符串作为键，实现可以使用由转换器指定的规则使用正确的复数形式。然后，这两个字符串参数将用于提供一个返回值，以防找不到消息目录（类似于普通的<code>gettext</code>行为）。在这种情况下，将使用日耳曼语言的规则，并假定第一个字符串参数为单数形式，第二个为复数形式。
</p>
<p>这样的结果是，没有语言目录的程序只有在程序本身是用日耳曼语编写的情况下才能显示正确的字符串。这是一个限制，但是由于GNU C库（以及GNU <code>gettext</code>软件包）是作为GNU软件包的一部分编写的，并且GNU项目的编码标准要求程序以英语编写，但是该解决方案仍然可以实现其目的。
</p>
<dl>
<dt id="index-ngettext">函数： <em>char *</em> <strong>ngettext</strong> <em>（const char * <var>msgid1</var> ，const char * <var>msgid2</var> ，unsigned long int <var>n</var> ）</em></dt>
<dd>
<p>初步： MT安全环境| AS不安全损坏的堆锁dlopen | AC不安全损坏的锁fd mem |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>ngettext</code>功能类似于<code>gettext</code>函数以相同的方式查找消息目录。但是，这需要两个额外的参数。的<var>msgid1</var>参数必须包含要转换的字符串的单数形式。它也用作在目录中搜索的关键字。的<var>msgid2</var>参数是复数形式。参数<var>n</var>用于确定复数形式。如果找不到消息目录<var>msgid1</var>如果返回<code>n == 1</code> ， 除此以外<code>msgid2</code> 。
</p>
<p>使用此功能的一个示例是：</p>
<div class="example">
<pre class="example">  printf (ngettext (&quot;%d file removed&quot;, &quot;%d files removed&quot;, n), n);
</pre></div>

<p>请注意，数值<var>n</var>必须传递给<code>printf</code>以及功能。仅将其传递给<code>ngettext</code> 。
</p></dd></dl>

<dl>
<dt id="index-dngettext">函数： <em>char *</em> <strong>dngettext</strong> <em>（const char * <var>domain</var> ，const char * <var>msgid1</var> ，const char * <var>msgid2</var> ，unsigned long int <var>n</var> ）</em></dt>
<dd>
<p>初步： MT安全环境| AS不安全损坏的堆锁dlopen | AC不安全损坏的锁fd mem |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>dngettext</code>类似于<code>dgettext</code>功能选择消息目录。区别在于需要两个额外的参数来提供正确的复数形式。这两个参数的处理方式相同<code>ngettext</code>处理他们。
</p></dd></dl>

<dl>
<dt id="index-dcngettext">函数： <em>char *</em> <strong>dcngettext</strong> <em>（const char * <var>domain</var> ，const char * <var>msgid1</var> ，const char * <var>msgid2</var> ，unsigned long int <var>n</var> ，int <var>category</var> ）</em></dt>
<dd>
<p>初步： MT安全环境| AS不安全损坏的堆锁dlopen | AC不安全损坏的锁fd mem |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>dcngettext</code>类似于<code>dcgettext</code>功能选择消息目录。区别在于需要两个额外的参数来提供正确的复数形式。这两个参数的处理方式相同<code>ngettext</code>处理他们。
</p></dd></dl>

<span id="The-problem-of-plural-forms"></span><h4 class="subsubheading">复数形式的问题</h4>

<p>问题的描述可以在最后一部分的开头找到。现在有一个问题如何解决。如果没有语言学家的输入（这是不可用的），就无法确定是否只有几种不同的形式形成了复数形式，或者是否每种新支持的语言都可以增加数量。
</p>
<p>因此，实现的解决方案是允许翻译者指定如何选择复数形式的规则。由于公式随每种语言的不同而不同，因此这是唯一可行的解决方案，除了对代码中的信息进行硬编码（这仍需要扩展的可能性，以防止使用新语言）。有关详细信息，请参见GNU <code>gettext</code>手册。这里仅提供一些信息。
</p>
<p>有关复数形式选择的信息必须存储在标题条目中（带有空白的信息） <code>msgid</code>串）。看起来像这样：</p>
<div class="example">
<pre class="example">Plural-Forms: nplurals=2; plural=n == 1 ? 0 : 1;
</pre></div>

<p>的<code>nplurals</code> value必须是一个十进制数字，用于指定该语言存在多少种不同的复数形式。后面的字符串<code>plural</code>是使用C语言语法的表达式。例外是不允许有负数，数字必须是十进制，唯一允许的变量是<code>n</code> 。只要其中一个功能，该表达式就会被求值<code>ngettext</code> ， <code>dngettext</code> ， 要么<code>dcngettext</code>叫做。然后，将传递给这些函数的数值替换为变量的所有用法<code>n</code>在表达式中。然后，结果值必须大于或等于零且小于作为的值给出的值<code>nplurals</code> 。
</p>
<p>此时，以下规则是已知的。列出了家庭语言。但这并不一定意味着可以对整个家庭进行概括（如下表所示）。 <a id="DOCF2" href="#FOOT2"><sup>2</sup></a>
</p>
<dl compact>
<dt>仅一种形式：</dt>
<dd><p>有些语言只需要一种形式。单数和复数形式之间没有区别。适当的标头条目如下所示：</p>
<div class="example">
<pre class="example">Plural-Forms: nplurals=1; plural=0;
</pre></div>

<p>具有此属性的语言包括：</p>
<dl compact>
<dt>Finno-Ugric家庭</dt>
<dd><p>匈牙利</p></dd>
<dt>亚洲家庭</dt>
<dd><p>日文，韩文</p></dd>
<dt>突厥语/阿尔泰语系</dt>
<dd><p>土耳其</p></dd>
</dl>

</dd>
<dt>两种形式，单数仅用于一种</dt>
<dd><p>这是大多数现有程序中使用的格式，因为它是英语使用的格式。标头条目如下所示：</p>
<div class="example">
<pre class="example">Plural-Forms: nplurals=2; plural=n != 1;
</pre></div>

<p>（注意：这使用了C表达式的功能，布尔表达式的值必须为零或一。）
</p>
<p>具有此属性的语言包括：</p>
<dl compact>
<dt>日耳曼家庭</dt>
<dd><p>丹麦文，荷兰文，英文，德文，挪威文，瑞典文</p></dd>
<dt>Finno-Ugric家庭</dt>
<dd><p>爱沙尼亚语，芬兰语</p></dd>
<dt>拉丁/希腊家庭</dt>
<dd><p>希腊语</p></dd>
<dt>闪族家庭</dt>
<dd><p>希伯来语</p></dd>
<dt>浪漫家庭</dt>
<dd><p>义大利文，葡萄牙文，西班牙文</p></dd>
<dt>人工的</dt>
<dd><p>世界语</p></dd>
</dl>

</dd>
<dt>两种形式，单数表示零和一</dt>
<dd><p>语言家族中的特殊情况。标头条目为：</p>
<div class="example">
<pre class="example">Plural-Forms: nplurals=2; plural=n&gt;1;
</pre></div>

<p>具有此属性的语言包括：</p>
<dl compact>
<dt>罗马家庭</dt>
<dd><p>法语，巴西葡萄牙语</p></dd>
</dl>

</dd>
<dt>三种形式，零的特殊情况</dt>
<dd><p>标头条目为：</p>
<div class="example">
<pre class="example">Plural-Forms: nplurals=3; plural=n%10==1 &amp;&amp; n%100!=11 ? 0 : n != 0 ? 1 : 2;
</pre></div>

<p>具有此属性的语言包括：</p>
<dl compact>
<dt>波罗的海家庭</dt>
<dd><p>拉脱维亚语</p></dd>
</dl>

</dd>
<dt>三种形式，一种和两种的特殊情况</dt>
<dd><p>标头条目为：</p>
<div class="example">
<pre class="example">Plural-Forms: nplurals=3; plural=n==1 ? 0 : n==2 ? 1 : 2;
</pre></div>

<p>具有此属性的语言包括：</p>
<dl compact>
<dt>凯尔特人</dt>
<dd><p>盖尔格（爱尔兰）</p></dd>
</dl>

</dd>
<dt>三种形式，数字以1 [2-9]结尾的特殊情况</dt>
<dd><p>标头条目如下所示：</p>
<div class="example">
<pre class="example">Plural-Forms: nplurals=3; \
    plural=n%10==1 &amp;&amp; n%100!=11 ? 0 : \
           n%10&gt;=2 &amp;&amp; (n%100&lt;10 || n%100&gt;=20) ? 1 : 2;
</pre></div>

<p>具有此属性的语言包括：</p>
<dl compact>
<dt>波罗的海家庭</dt>
<dd><p>立陶宛语</p></dd>
</dl>

</dd>
<dt>三种形式，以1和2、3、4结尾的数字的特殊情况除外，以1 [1-4]结尾的数字除外</dt>
<dd><p>标头条目如下所示：</p>
<div class="example">
<pre class="example">Plural-Forms: nplurals=3; \
    plural=n%100/10==1 ? 2 : n%10==1 ? 0 : (n+9)%10&gt;3 ? 2 : 1;
</pre></div>

<p>具有此属性的语言包括：</p>
<dl compact>
<dt>斯拉夫家庭</dt>
<dd><p>克罗地亚文，捷克文，俄文，乌克兰文</p></dd>
</dl>

</dd>
<dt>三种形式，特殊情况为1和2、3、4</dt>
<dd><p>标头条目如下所示：</p>
<div class="example">
<pre class="example">Plural-Forms: nplurals=3; \
    plural=(n==1) ? 1 : (n&gt;=2 &amp;&amp; n&lt;=4) ? 2 : 0;
</pre></div>

<p>具有此属性的语言包括：</p>
<dl compact>
<dt>斯拉夫家庭</dt>
<dd><p>斯洛伐克文</p></dd>
</dl>

</dd>
<dt>三种形式，一种特殊情况，一种和某些数字以2、3或4结尾</dt>
<dd><p>标头条目如下所示：</p>
<div class="example">
<pre class="example">Plural-Forms: nplurals=3; \
    plural=n==1 ? 0 : \
           n%10&gt;=2 &amp;&amp; n%10&lt;=4 &amp;&amp; (n%100&lt;10 || n%100&gt;=20) ? 1 : 2;
</pre></div>

<p>具有此属性的语言包括：</p>
<dl compact>
<dt>斯拉夫家庭</dt>
<dd><p>抛光</p></dd>
</dl>

</dd>
<dt>四种形式，一种特殊情况适用于以02、03或04结尾的一个和所有数字</dt>
<dd><p>标头条目如下所示：</p>
<div class="example">
<pre class="example">Plural-Forms: nplurals=4; \
    plural=n%100==1 ? 0 : n%100==2 ? 1 : n%100==3 || n%100==4 ? 2 : 3;
</pre></div>

<p>具有此属性的语言包括：</p>
<dl compact>
<dt>斯拉夫家庭</dt>
<dd><p>斯洛文尼亚文</p></dd>
</dl>
</dd>
</dl>


<div class="footnote">
<hr>
<h4 class="footnotes-heading">脚注</h4>

<h3><a id="FOOT2" href="#DOCF2">（2）</a></h3>
<p>欢迎添加。将适当的信息发送到<a href="mailto:bug-glibc-manual@gnu.org">bug-glibc-manual@gnu.org</a> 。</p>
</div>
<hr>
<div class="header">
<p>下一篇： <a href="Charset-conversion-in-gettext.html#Charset-conversion-in-gettext" rel="next" accesskey="n">gettext中的字符集转换</a> ，上一篇： <a href="Locating-gettext-catalog.html#Locating-gettext-catalog" rel="prev" accesskey="p">查找gettext目录</a> ，上一篇： <a href="Message-catalogs-with-gettext.html#Message-catalogs-with-gettext" rel="up" accesskey="u">带有gettext的消息目录</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>