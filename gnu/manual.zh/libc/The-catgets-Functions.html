<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>catgets函数（GNU C库）</title>

<meta name="description" content="The catgets Functions (The GNU C Library)">
<meta name="keywords" content="The catgets Functions (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Message-catalogs-a-la-X_002fOpen.html#Message-catalogs-a-la-X_002fOpen" rel="up" title="Message catalogs a la X/Open">
<link href="The-message-catalog-files.html#The-message-catalog-files" rel="next" title="The message catalog files">
<link href="Message-catalogs-a-la-X_002fOpen.html#Message-catalogs-a-la-X_002fOpen" rel="prev" title="Message catalogs a la X/Open">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="The-catgets-Functions"></span><div class="header">
<p>下一页： <a href="The-message-catalog-files.html#The-message-catalog-files" rel="next" accesskey="n">消息目录文件</a> ，上： <a href="Message-catalogs-a-la-X_002fOpen.html#Message-catalogs-a-la-X_002fOpen" rel="up" accesskey="u">消息目录la X / Open</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="The-catgets-function-family"></span><h4 class="subsection">8.1.1 <code>catgets</code>功能家族</h4>

<dl>
<dt id="index-catopen">函数： <em>nl_catd</em> <strong>catopen</strong> <em>（const char * <var>cat_name</var> ，int <var>flag</var> ）</em></dt>
<dd>
<p>初步： MT安全环境| AS不安全堆| AC不安全的内存|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>catopen</code>函数试图找到名为的消息数据文件<var>cat_name</var>并在找到时加载。返回值是不透明的类型，可以在调用其他函数以引用此已加载目录时使用。
</p>
<p>返回值为<code>(nl_catd) -1</code>如果函数失败并且没有目录被加载。全局变量<code>errno</code>包含用于导致失败的错误的代码。但是，即使函数调用成功，也并不意味着可以翻译所有消息。
</p>
<p>查找目录文件的方式必须使程序的用户能够影响决策。由用户决定使用的语言，有时使用备用目录文件很有用。所有这些都可以由用户通过设置一些环境变量来指定。
</p>
<p>第一个问题是找出所有消息目录的存储位置。每个程序都有自己的位置来保存所有不同的文件，但是目录文件通常按语言分组，所有程序的目录都保存在同一位置。
</p>
<span id="index-NLSPATH-environment-variable"></span>
<p>告诉<code>catopen</code>可以在其中找到程序目录的功能，用户可以设置环境变量<code>NLSPATH</code>用来描述她/他的选择的值。由于此值必须可用于不同的语言和语言环境，因此不能为简单的字符串。相反，它是一个格式字符串（类似于<code>printf</code>的）。一个例子是</p>
<div class="example">
<pre class="example">/usr/share/locale/%L/%N:/usr/share/locale/%L/LC_MESSAGES/%N
</pre></div>

<p>第一个可以看到可以指定多个目录（使用用冒号分隔它们的通常语法）。接下来要观察的是格式字符串， <code>%L</code>和<code>%N</code>在这种情况下。的<code>catopen</code>函数知道其中的几个，当然替换所有这些都是不同的。
</p>
<dl compact>
<dt><code>%N</code></dt>
<dd><p>该格式元素将替换为目录文件的名称。这就是<var>cat_name</var>争论<code>catgets</code> 。
</p>
</dd>
<dt><code>%L</code></dt>
<dd><p>该格式元素替换为当前选定的语言环境的名称，以翻译消息。下面说明如何确定。
</p>
</dd>
<dt><code>%l</code></dt>
<dd><p>（这是小写的ell。）该格式元素替换为语言环境名称的language元素。描述所选语言环境的字符串应采用以下格式： <code><var>lang</var>[_<var>terr</var>[.<var>codeset</var>]]</code>而这种格式使用第一部分<var>lang</var> 。
</p>
</dd>
<dt><code>%t</code></dt>
<dd><p>此格式元素由地区部分替代<var>terr</var>当前所选语言环境的名称。请参阅上面格式的说明。
</p>
</dd>
<dt><code>%c</code></dt>
<dd><p>此格式元素由代码集部分替代<var>codeset</var>当前所选语言环境的名称。请参阅上面格式的说明。
</p>
</dd>
<dt><code>%%</code></dt>
<dd><p>以来<code>%</code>用作元字符，必须有一种表达方式<code>%</code>结果本身中的字符。使用<code>%%</code>就像它适用于那样吗<code>printf</code> 。
</p></dd>
</dl>


<p>使用<code>NLSPATH</code>允许在任意目录中搜索消息目录，同时仍允许使用其他语言。如果<code>NLSPATH</code>未设置环境变量，默认值为</p>
<div class="example">
<pre class="example"><var>prefix</var>/share/locale/%L/%N:<var>prefix</var>/share/locale/%L/LC_MESSAGES/%N
</pre></div>

<p>哪里<var>prefix</var>被给予<code>configure</code>在安装GNU C库时（此值在许多情况下是<code>/usr</code>或空字符串）。
</p>
<p>剩下的问题是决定必须使用哪个。该值决定上述格式元素的替换。首先，用户可以在消息目录名称中指定路径（即，该名称包含斜杠字符）。在这种情况下<code>NLSPATH</code>不使用环境变量。目录必须按照程序中指定的方式存在，可能相对于当前工作目录而言。这种情况是不可取的，并且目录名称绝对不能这样写。除此之外，此行为不适用于所有其他提供以下内容的平台： <code>catgets</code>接口。
</p>
<span id="index-LC_005fALL-environment-variable"></span>
<span id="index-LC_005fMESSAGES-environment-variable"></span>
<span id="index-LANG-environment-variable"></span>
<p>否则，将检查来自标准环境的环境变量的值（请参见<a href="Standard-Environment.html#Standard-Environment">标准环境</a> ）。检查哪些变量由<var>flag</var>的参数<code>catopen</code> 。如果值为<code>NL_CAT_LOCALE</code> （在<samp>nl_types.h</samp> ）然后<code>catopen</code>函数使用当前选择的语言环境名称<code>LC_MESSAGES</code>类别。
</p>
<p>如果<var>flag</var>为零<code>LANG</code>检查环境变量。这是早期语言环境的概念，当时语言环境的概念甚至还没有达到POSIX语言环境的水平。
</p>
<p>环境变量和语言环境名称应具有以下形式的值： <code><var>lang</var>[_<var>terr</var>[.<var>codeset</var>]]</code>如上所述。如果没有设置环境变量<code>"C"</code>使用语言环境可防止任何翻译。
</p>
<p>该函数的返回值无论如何都是有效的字符串。它是消息目录的翻译，还是与消息目录的翻译相同<var>string</var>参数。因此，用于确定翻译是否确实发生的一段代码必须如下所示：</p>
<div class="example">
<pre class="example">{
  char *trans = catgets (desc, set, msg, input_string);
  if (trans == input_string)
    {
      /* Something went wrong.  */
    }
}
</pre></div>

<p>发生错误时，全局变量<code>errno</code>被设定为</p>
<dl compact>
<dt><var>EBADF</var></dt>
<dd><p>该目录不存在。
</p></dd>
<dt><var>ENOMSG</var></dt>
<dd><p>set / message元组未命名消息目录中的现有元素。
</p></dd>
</dl>

<p>尽管有时候测试错误可能很有用，但是程序通常会避免进行任何测试。如果翻译不可用，则打印原始未翻译的消息也没什么大问题。用户也可以理解这一点，或者他/她将寻找未翻译消息的原因。
</p></dd></dl>

<p>请注意，当前选择的语言环境不依赖于对<code>setlocale</code>功能。不必存在此语言环境的语言环境数据文件并调用<code>setlocale</code>成功。的<code>catopen</code>函数直接读取环境变量的值。
</p>

<dl>
<dt id="index-catgets">函数： <em>char *</em> <strong>catgets</strong> <em>（nl_catd <var>catalog_desc</var> ，int <var>set</var> ，int <var>message</var> ，const char * <var>string</var> ）</em></dt>
<dd><p>初步： MT安全| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>功能<code>catgets</code>必须用于访问以前使用<code>catopen</code>功能。的<var>catalog_desc</var>参数必须是先前由返回的值<code>catopen</code> 。
</p>
<p>接下来的两个参数<var>set</var>和<var>message</var> ，反映消息目录文件的内部组织。这将在下面详细说明。现在，很有趣的是，一个目录可以包含几组，并且每个线程中的消息都使用数字分别编号。设置号和消息号都不得连续。它们可以任意选择。但是每条消息（除非等于另一条消息）必须具有自己唯一的一组设置和消息编号。
</p>
<p>由于不能保证用户选择的语言的消息目录存在最后一个参数<var>string</var>有助于妥善处理此案。如果找不到匹配的字符串<var>string</var>返回。对于程序员来说，这意味着</p>
<ul>
<li>的<var>string</var>参数应包含合理的文本（这也有助于理解程序，否则，在预期返回的字符串上将没有任何提示。
</li><li>所有<var>string</var>参数应使用相同的语言编写。
</li></ul>
</dd></dl>

<p>使用以下代码编写程序有点不舒服<code>catgets</code>如果没有可用的支持功能，则运行。由于每个集合/消息号元组必须唯一，因此程序员必须在编写代码的同时保留消息列表。并且必须协调在同一项目上工作的多个人之间的工作。我们将看到如何稍微缓解其中的一些问题（请参阅<a href="Common-Usage.html#Common-Usage">常用用法</a> ）。
</p>
<dl>
<dt id="index-catclose">函数： <em>int</em> <strong>catclose</strong> <em>（nl_catd <var>catalog_desc</var> ）</em></dt>
<dd><p>初步： MT安全| AS不安全堆| AC不安全的损坏的内存|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>catclose</code>函数可用于释放与消息目录相关的资源，该消息目录以前是通过调用打开的<code>catopen</code> 。如果可以成功释放资源，则函数返回<code>0</code> 。否则返回<code>-1</code>和全局变量<code>errno</code>被设置。如果目录描述符可能会发生错误<var>catalog_desc</var>在这种情况下无效<code>errno</code>被设定为<code>EBADF</code> 。
</p></dd></dl>


<hr>
<div class="header">
<p>下一页： <a href="The-message-catalog-files.html#The-message-catalog-files" rel="next" accesskey="n">消息目录文件</a> ，向上： <a href="Message-catalogs-a-la-X_002fOpen.html#Message-catalogs-a-la-X_002fOpen" rel="up" accesskey="u">消息目录la X / Open</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>