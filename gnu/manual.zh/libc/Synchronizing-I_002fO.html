<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>同步I / O（GNU C库）</title>

<meta name="description" content="Synchronizing I/O (The GNU C Library)">
<meta name="keywords" content="Synchronizing I/O (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Low_002dLevel-I_002fO.html#Low_002dLevel-I_002fO" rel="up" title="Low-Level I/O">
<link href="Asynchronous-I_002fO.html#Asynchronous-I_002fO" rel="next" title="Asynchronous I/O">
<link href="Waiting-for-I_002fO.html#Waiting-for-I_002fO" rel="prev" title="Waiting for I/O">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Synchronizing-I_002fO"></span><div class="header">
<p>下一篇： <a href="Asynchronous-I_002fO.html#Asynchronous-I_002fO" rel="next" accesskey="n">异步I / O</a> ，上一篇： <a href="Waiting-for-I_002fO.html#Waiting-for-I_002fO" rel="prev" accesskey="p">等待</a> <a href="Asynchronous-I_002fO.html#Asynchronous-I_002fO" rel="next" accesskey="n">I / O</a> ，上一篇： <a href="Low_002dLevel-I_002fO.html#Low_002dLevel-I_002fO" rel="up" accesskey="u">低级I / O</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Synchronizing-I_002fO-operations"></span><h3 class="section">13.10同步I / O操作</h3>

<span id="index-synchronizing"></span>
<p>在大多数现代操作系统中，正常的I / O操作不会同步执行。即，即使<code>write</code>系统调用返回，这并不意味着数据实际上已写入介质，例如磁盘。
</p>
<p>在需要同步点的情况下，可以使用特殊功能来确保所有操作在返回之前完成。
</p>
<dl>
<dt id="index-sync">功能： <em>无效</em> <strong>同步</strong> <em>（无效）</em></dt>
<dd>
<p>初步： MT安全| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>只要有未写入设备的数据，对该函数的调用将不会返回。内核中的所有脏缓冲区都将被写入，因此可以实现一个整体一致的系统（如果没有其他并行进程写入数据）。
</p>
<p>的原型<code>sync</code>可以在<samp>unistd.h</samp> 。
</p></dd></dl>

<p>程序更经常要确保写入到给定文件的数据而不是系统中的所有数据都已提交。为了这， <code>sync</code>太过分了。
</p>

<dl>
<dt id="index-fsync">函数： <em>int</em> <strong>fsync</strong> <em>（int <var>fildes</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>fsync</code>函数可用于确保所有与打开文件关联的数据<var>fildes</var>被写入与描述符关联的设备。除非所有操作都已完成，否则函数调用不会返回。
</p>
<p>的原型<code>fsync</code>可以在<samp>unistd.h</samp> 。
</p>
<p>此功能是多线程程序中的取消点。如果线程当时分配了一些资源（例如内存，文件描述符，信号量或其他内容），这将是一个问题<code>fsync</code>叫做。如果线程被取消，这些资源将保持分配状态，直到程序结束。为避免这种情况，请致电<code>fsync</code>应该使用取消处理程序进行保护。
</p>
<p>如果未发生错误，则函数的返回值为零。否则为<em>-1</em>和全局变量<code>errno</code>设置为以下值：</p><dl compact>
<dt><code>EBADF</code></dt>
<dd><p>描述符<var>fildes</var>无效。
</p>
</dd>
<dt><code>EINVAL</code></dt>
<dd><p>由于系统未实现同步，因此无法进行同步。
</p></dd>
</dl>
</dd></dl>

<p>有时甚至没有必要写入与文件描述符关联的所有数据。例如，在大小不变的数据库文件中，将所有文件内容数据写入设备就足够了。元信息（如修改时间等）不是那么重要，并且在出现问题的情况下不提交此类信息不会阻止文件的成功恢复。
</p>
<dl>
<dt id="index-fdatasync">函数： <em>int</em> <strong>fdatasync</strong> <em>（int <var>fildes</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>当一个电话<code>fdatasync</code>函数返回时，确保将所有文件数据都写入设备。对于所有待处理的I / O操作，保证数据完整性的部件已完成。
</p>
<p>并非所有系统都实现<code>fdatasync</code>操作。在缺少此功能的系统上<code>fdatasync</code>通过调用来模拟<code>fsync</code>因为所执行的动作是由要求的动作的超集<code>fdatasync</code> 。
</p>
<p>的原型<code>fdatasync</code>在<samp>unistd.h</samp> 。
</p>
<p>如果未发生错误，则函数的返回值为零。否则为<em>-1</em>和全局变量<code>errno</code>设置为以下值：</p><dl compact>
<dt><code>EBADF</code></dt>
<dd><p>描述符<var>fildes</var>无效。
</p>
</dd>
<dt><code>EINVAL</code></dt>
<dd><p>由于系统未实现同步，因此无法进行同步。
</p></dd>
</dl>
</dd></dl>


<hr>
<div class="header">
<p>下一篇： <a href="Asynchronous-I_002fO.html#Asynchronous-I_002fO" rel="next" accesskey="n">异步I / O</a> ，上一篇： <a href="Waiting-for-I_002fO.html#Waiting-for-I_002fO" rel="prev" accesskey="p">等待</a> <a href="Asynchronous-I_002fO.html#Asynchronous-I_002fO" rel="next" accesskey="n">I / O</a> ，上一篇： <a href="Low_002dLevel-I_002fO.html#Low_002dLevel-I_002fO" rel="up" accesskey="u">低级I / O</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>