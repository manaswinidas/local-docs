<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>经过的时间（GNU C库）</title>

<meta name="description" content="Elapsed Time (The GNU C Library)">
<meta name="keywords" content="Elapsed Time (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Date-and-Time.html#Date-and-Time" rel="up" title="Date and Time">
<link href="Processor-And-CPU-Time.html#Processor-And-CPU-Time" rel="next" title="Processor And CPU Time">
<link href="Time-Basics.html#Time-Basics" rel="prev" title="Time Basics">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Elapsed-Time"></span><div class="header">
<p>下一篇： <a href="Processor-And-CPU-Time.html#Processor-And-CPU-Time" rel="next" accesskey="n">处理器和CPU时间</a> ，上一篇： <a href="Time-Basics.html#Time-Basics" rel="prev" accesskey="p">时间基础</a> ，上一篇： <a href="Date-and-Time.html#Date-and-Time" rel="up" accesskey="u">日期和时间</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Elapsed-Time-1"></span><h3 class="section">21.2经过的时间</h3>
<span id="index-elapsed-time-1"></span>

<p>表示经过时间的一种方法是使用简单的算术数据类型，如以下函数所示，用于计算两个日历时间之间的经过时间。该函数在<samp>time.h</samp> 。
</p>
<dl>
<dt id="index-difftime">函数： <em>double</em> <strong>difftime</strong> <em>（time_t <var>time1</var> ，time_t <var>time0</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>difftime</code>函数返回日历时间之间经过的时间的秒数<var>time1</var>和日历时间<var>time0</var> ，作为类型的值<code>double</code> 。除非启用了leap秒支持，否则差异将忽略leap秒。
</p>
<p>在GNU C库中，您可以简单地减去<code>time_t</code>价值观。但是在其他系统上<code>time_t</code>数据类型可能会使用其他一些编码，而减法不能直接起作用。
</p></dd></dl>

<p>GNU C库提供了两种专门用于表示经过时间的数据类型。它们被各种GNU C库函数使用，您也可以将它们用于自己的目的。它们完全相同，只是一个分辨率以微秒为单位，而另一个较新的分辨率以纳秒为单位。
</p>
<dl>
<dt id="index-struct-timeval">数据类型： <strong>struct timeval</strong></dt>
<dd>
<span id="index-timeval"></span>
<p>的<code>struct timeval</code>结构表示经过的时间。声明在<samp>sys/time.h</samp>并具有以下成员：</p>
<dl compact>
<dt><code>time_t tv_sec</code></dt>
<dd><p>这代表经过时间的整秒数。
</p>
</dd>
<dt><code>long int tv_usec</code></dt>
<dd><p>这是剩余的经过时间（以秒为单位），以微秒数表示。它总是小于一百万。
</p>
</dd>
</dl>
</dd></dl>

<dl>
<dt id="index-struct-timespec">数据类型： <strong>struct timespec</strong></dt>
<dd>
<span id="index-timespec"></span>
<p>的<code>struct timespec</code>结构表示经过的时间。声明在<samp>time.h</samp>并具有以下成员：</p>
<dl compact>
<dt><code>time_t tv_sec</code></dt>
<dd><p>这代表经过时间的整秒数。
</p>
</dd>
<dt><code>long int tv_nsec</code></dt>
<dd><p>这是剩余的经过时间（几分之一秒），表示为纳秒数。它总是少于十亿。
</p>
</dd>
</dl>
</dd></dl>

<p>通常需要减去两个类型的值<code>struct timeval</code> <!-- /@w -->或<code>struct timespec</code> <!-- /@w --> 。这是执行此操作的最佳方法。它甚至可以在某些特殊的操作系统上运行， <code>tv_sec</code>成员具有未签名的类型。
</p>
<div class="example">
<pre class="example">

/* <span class="roman">Subtract the &lsquo;struct timeval&rsquo; values X and Y,
   storing the result in RESULT.
   Return 1 if the difference is negative, otherwise 0.</span> */

int
timeval_subtract (struct timeval *result, struct timeval *x, struct timeval *y)
{
  /* <span class="roman">Perform the carry for the later subtraction by updating <var>y</var>.</span> */
  if (x-&gt;tv_usec &lt; y-&gt;tv_usec) {
    int nsec = (y-&gt;tv_usec - x-&gt;tv_usec) / 1000000 + 1;
    y-&gt;tv_usec -= 1000000 * nsec;
    y-&gt;tv_sec += nsec;
  }
  if (x-&gt;tv_usec - y-&gt;tv_usec &gt; 1000000) {
    int nsec = (x-&gt;tv_usec - y-&gt;tv_usec) / 1000000;
    y-&gt;tv_usec += 1000000 * nsec;
    y-&gt;tv_sec -= nsec;
  }

  /* <span class="roman">Compute the time remaining to wait.
     <code>tv_usec</code> is certainly positive.</span> */
  result-&gt;tv_sec = x-&gt;tv_sec - y-&gt;tv_sec;
  result-&gt;tv_usec = x-&gt;tv_usec - y-&gt;tv_usec;

  /* <span class="roman">Return 1 if result is negative.</span> */
  return x-&gt;tv_sec &lt; y-&gt;tv_sec;
}
</pre></div>

<p>常用功能<code>struct timeval</code>是<code>gettimeofday</code>和<code>settimeofday</code> 。
</p>

<p>没有专门针对处理经过时间的GNU C库功能，但是日历时间，处理器时间以及警报和睡眠功能与它们有很大关系。
</p>

<hr>
<div class="header">
<p>下一篇： <a href="Processor-And-CPU-Time.html#Processor-And-CPU-Time" rel="next" accesskey="n">处理器和CPU时间</a> ，上一篇： <a href="Time-Basics.html#Time-Basics" rel="prev" accesskey="p">时间基础</a> ，上一篇： <a href="Date-and-Time.html#Date-and-Time" rel="up" accesskey="u">日期和时间</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>