<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>格式化数字（GNU C库）</title>

<meta name="description" content="Formatting Numbers (The GNU C Library)">
<meta name="keywords" content="Formatting Numbers (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Locales.html#Locales" rel="up" title="Locales">
<link href="Yes_002dor_002dNo-Questions.html#Yes_002dor_002dNo-Questions" rel="next" title="Yes-or-No Questions">
<link href="The-Elegant-and-Fast-Way.html#The-Elegant-and-Fast-Way" rel="prev" title="The Elegant and Fast Way">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Formatting-Numbers"></span><div class="header">
<p>下一篇： <a href="Yes_002dor_002dNo-Questions.html#Yes_002dor_002dNo-Questions" rel="next" accesskey="n">是或否问题</a> ，上一篇： <a href="Locale-Information.html#Locale-Information" rel="prev" accesskey="p">语言环境信息</a> ，上一篇： <a href="Locales.html#Locales" rel="up" accesskey="u">语言环境</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="A-dedicated-function-to-format-numbers"></span><h3 class="section">7.8格式化数字的专用功能</h3>

<p>我们已经看到结构由<code>localeconv</code>以及给定的值<code>nl_langinfo</code>允许您检索各种特定于语言环境的信息，以格式化数字和金额。我们还看到，基本规则非常复杂。
</p>
<p>因此，X / Open标准引入了使用此类语言环境信息的功能，从而使用户更容易根据这些规则设置数字格式。
</p>
<dl>
<dt id="index-strfmon">函数： <em>ssize_t</em> <strong>strfmon</strong> <em>（字符* <var>s</var> ，size_t <var>maxsize</var> ，const char * <var>format</var> ，…）</em></dt>
<dd><p>初步： MT安全区域| AS不安全堆| AC不安全的内存|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>strfmon</code>功能类似于<code>strftime</code>该函数的功能是：它需要一个缓冲区，缓冲区的大小，格式字符串以及以格式字符串指定的格式以文本形式写入缓冲区的值。喜欢<code>strftime</code> ，该函数还会返回写入缓冲区的字节数。
</p>
<p>有两个区别： <code>strfmon</code>可以使用多个参数，当然，格式说明也不同。喜欢<code>strftime</code> ，格式字符串由普通文本（按原样输出）和格式说明符（由“ <samp>%</samp> '。在“ <samp>%</samp> '，您可以选择在主要格式字符之前指定各种标志和格式信息，方法类似于<code>printf</code> ：</p>
<ul>
<li>紧跟在“ <samp>%</samp> '可以存在以下一个或多个标志：<dl compact>
<dt>' <samp>=<var>f</var></samp> '</dt>
<dd><p>单字节字符<var>f</var>用于此字段作为数字填充字符。默认情况下，此字符为空格字符。仅当指定了左精度时，才执行此字符的填充。它不只是填充到给定的字段宽度。
</p></dd>
<dt>' <samp>^</samp> '</dt>
<dd><p>在不根据当前语言环境的规则对数字进行分组的情况下打印数字。默认情况下启用分组。
</p></dd>
<dt>' <samp>+</samp> '，' <samp>(</samp> '</dt>
<dd><p>最多可以使用这些标志之一。他们选择代表货币金额符号的格式。默认情况下，如果“ <samp>+</samp>给定了'，使用的语言环境等价于<em>+</em> / <em>-</em> 。如果“ <samp>(</samp>给出'，括号内为负数。确切的格式由<code>LC_MONETARY</code>在程序运行时选择的语言环境的类别。
</p></dd>
<dt>' <samp>!</samp> '</dt>
<dd><p>输出将不包含货币符号。
</p></dd>
<dt>' <samp>-</samp> '</dt>
<dd><p>如果输出未填满整个字段宽度，则将其格式为左对齐而不是右对齐。
</p></dd>
</dl>
</li></ul>

<p>规范的下一部分是可选的字段宽度。如果未指定宽度，则为<em>0</em> 。在输出期间，该功能首先确定需要多少空间。如果它至少需要与字段宽度给定的字符一样多，则使用所需的尽可能多的空间来输出。否则，通过填充空格字符将其扩展为使用整个宽度。是否存在“ <samp>-</samp> '标志确定发生这种填充的一侧。如果存在，则在右边添加空格，使输出左对齐，反之亦然。
</p>
<p>到目前为止，该格式看起来很熟悉，类似于<code>printf</code>和<code>strftime</code>格式。但是，接下来的两个可选字段引入了一些新内容。第一个是“ <samp>#</samp> '字符，后跟十进制数字字符串。数字字符串的值指定小数点左侧（或等效数字）的<em>数字</em>位置数。这<em>不</em>包括分组人物当“ <samp>^</samp> '标志未给出。如果打印数字所需的空间不能填满整个宽度，则在字段的左侧填充填充字符，可以使用' <samp>=</samp> '标志，默认情况下为空格。例如，如果将字段宽度选择为6且数字为<em>123</em> ，则填充字符为' <samp>*</samp>结果将是<samp>***123</samp> '。
</p>
<p>第二个可选字段以“ <samp>.</samp> '（句点），由另一个十进制数字字符串组成。其值描述小数点后打印的字符数。默认值是从当前语言环境（ <code>frac_digits</code> ， <code>int_frac_digits</code> ，请参阅<a href="General-Numeric.html#General-Numeric">通用数字</a> ）。如果精确表示需要的数字比字段宽度所给定的数字更多，则将显示的值四舍五入。如果小数位数选择为零，则不打印小数点。
</p>
<p>作为GNU扩展， <code>strfmon</code> GNU C库中的实现允许一个可选的' <samp>L</samp> '接下来作为格式修饰符。如果指定此修饰符，则参数应为<code>long double</code>代替<code>double</code>值。
</p>
<p>最后，最后一个组件是格式说明符。定义了三个说明符：</p>
<dl compact>
<dt>' <samp>i</samp> '</dt>
<dd><p>使用语言环境的规则来格式化国际货币值。
</p></dd>
<dt>' <samp>n</samp> '</dt>
<dd><p>使用语言环境的规则来格式化本国货币值。
</p></dd>
<dt>' <samp>%</samp> '</dt>
<dd><p>放置一个<samp>%</samp>在输出中。不得提供任何标志，宽度说明符或修饰符，只有' <samp>%%</samp> ' 被允许。
</p></dd>
</dl>

<p>至于<code>printf</code> ，该函数从左到右读取格式字符串，并使用格式字符串后传递给该函数的值。这些值应为以下任一类型<code>double</code>要么<code>long double</code> ，具体取决于修饰符' <samp>L</samp> '。结果存储在由指向的缓冲区中<var>s</var> 。最多<var>maxsize</var>字符被存储。
</p>
<p>该函数的返回值是存储在其中的字符数<var>s</var> ，包括终止<code>NULL</code>字节。如果存储的字符数超过<var>maxsize</var> ，该函数返回<em>-1</em>和缓冲区的内容<var>s</var>未指定。在这种情况下<code>errno</code>被设定为<code>E2BIG</code> 。
</p></dd></dl>

<p>几个例子应该说明该函数如何工作。假定以下所有代码段均在使用USA语言环境的程序中执行（ <code>en_US</code> ）。格式的最简单形式是：</p>
<div class="example">
<pre class="example">strfmon (buf, 100, &quot;@%n@%n@%n@&quot;, 123.45, -567.89, 12345.678);
</pre></div>

<p>产生的输出是</p><div class="example">
<pre class="example">&quot;@$123.45@-$567.89@$12,345.68@&quot;
</pre></div>

<p>我们可以在这里注意到几件事。首先，输出编号的宽度不同。我们尚未在格式字符串中指定宽度，因此这也就不足为奇了。第二，第三个数字使用数千个分隔符打印。千位分隔符<code>en_US</code>语言环境是逗号。该数字也四舍五入。
<em>.678</em>舍入为<em>.68，</em>因为该格式未指定精度，并且语言环境的默认值为<em>2</em> 。最后，请注意，由于“ <samp>%n</samp> '被使用，不是' <samp>i</samp> '。下一个示例显示了如何对齐输出。
</p>
<div class="example">
<pre class="example">strfmon (buf, 100, &quot;@%=*11n@%=*11n@%=*11n@&quot;, 123.45, -567.89, 12345.678);
</pre></div>

<p>这次的输出是：</p>
<div class="example">
<pre class="example">&quot;@    $123.45@   -$567.89@ $12,345.68@&quot;
</pre></div>

<p>两件事脱颖而出。首先，所有字段都具有相同的宽度（11个字符），因为这是格式中给出的宽度，并且因为没有数字要求打印更多的字符。第二个要点是不使用填充字符。这是正确的，因为没有使用空格来达到' <samp>#</samp> '修饰符，而是填充到给定的宽度。如果我们现在添加宽度规格，则区别变得明显。
</p>
<div class="example">
<pre class="example">strfmon (buf, 100, &quot;@%=*11#5n@%=*11#5n@%=*11#5n@&quot;,
         123.45, -567.89, 12345.678);
</pre></div>

<p>输出是</p>
<div class="example">
<pre class="example">&quot;@ $***123.45@-$***567.89@ $12,456.68@&quot;
</pre></div>

<p>在这里，我们可以看到所有货币符号都已对齐，并且货币符号和数字之间的空格已被选定的填充字符填充。请注意，尽管宽度被选择为<em>5，</em>并且<em>123.45</em>的小数点后还有三位数字，但该空间仍填充了三个星号。这是正确的，因为如上所述，宽度不包括用于存储数千个分隔符的位置。最后一个示例应说明其余功能。
</p>
<div class="example">
<pre class="example">strfmon (buf, 100, &quot;@%=0(16#5.3i@%=0(16#5.3i@%=0(16#5.3i@&quot;,
         123.45, -567.89, 12345.678);
</pre></div>

<p>这个相当复杂的格式字符串会产生以下输出：</p>
<div class="example">
<pre class="example">&quot;@ USD 000123,450 @(USD 000567.890)@ USD 12,345.678 @&quot;
</pre></div>

<p>最明显的变化是表示负数的替代方法。在金融界，通常使用括号来完成，这就是“ <samp>(</samp> '标志已选择。填充字符现在为' <samp>0</samp> '。请注意，此“ <samp>0</samp> '字符不被视为数字零，因此不会使用千位分隔符来打印第一个和第二个数字。由于我们使用了格式说明符' <samp>i</samp> ' 代替 ' <samp>n</samp> '，则使用货币符号的国际形式。这是一个四个字母的字符串<code>"USD "</code> 。最后一点是，由于小数点的精度右边被选择为三，因此第一个和第二个数字的末尾打印有一个额外的零，而第三个数字的打印不进行舍入。
</p>
<hr>
<div class="header">
<p>下一篇： <a href="Yes_002dor_002dNo-Questions.html#Yes_002dor_002dNo-Questions" rel="next" accesskey="n">是或否问题</a> ，上一篇： <a href="Locale-Information.html#Locale-Information" rel="prev" accesskey="p">语言环境信息</a> ，上一篇： <a href="Locales.html#Locales" rel="up" accesskey="u">语言环境</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>