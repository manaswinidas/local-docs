<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>设置语言环境（GNU C库）</title>

<meta name="description" content="Setting the Locale (The GNU C Library)">
<meta name="keywords" content="Setting the Locale (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Locales.html#Locales" rel="up" title="Locales">
<link href="Standard-Locales.html#Standard-Locales" rel="next" title="Standard Locales">
<link href="Locale-Categories.html#Locale-Categories" rel="prev" title="Locale Categories">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Setting-the-Locale"></span><div class="header">
<p>下一个： <a href="Standard-Locales.html#Standard-Locales" rel="next" accesskey="n">标准语言环境</a> ，上一个： <a href="Locale-Categories.html#Locale-Categories" rel="prev" accesskey="p">语言环境类别</a> ，上： <a href="Locales.html#Locales" rel="up" accesskey="u">语言环境</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="How-Programs-Set-the-Locale"></span><h3 class="section">7.4程序如何设置语言环境</h3>

<p>AC程序启动时会继承其区域设置环境变量。这会自动发生。但是，这些变量不会自动控制库函数使用的语言环境，因为ISO C <!-- /@w -->表示默认情况下，所有程序都以标准“ <samp>C</samp>的语言环境。要使用环境指定的语言环境，必须调用<code>setlocale</code> 。调用如下：</p>
<div class="example">
<pre class="example">setlocale (LC_ALL, &quot;&quot;);
</pre></div>

<p>根据用户对适当环境变量的选择来选择语言环境。
</p>
<span id="index-changing-the-locale"></span>
<span id="index-locale_002c-changing"></span>
<p>您也可以使用<code>setlocale</code>指定用于一般用途或特定类别的特定语言环境。
</p>
<span id="index-locale_002eh"></span>
<p>本节中的符号在头文件中定义<samp>locale.h</samp> 。
</p>
<dl>
<dt id="index-setlocale">函数： <em>char *</em> <strong>setlocale</strong> <em>（int <var>category</var> ，const char * <var>locale</var> ）</em></dt>
<dd>
<p>初步： MT不安全const：locale env | AS不安全的初始化锁堆损坏| AC不安全的初始化损坏的锁内存fd |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>功能<code>setlocale</code>设置类别的当前语言环境<var>category</var>至<var>locale</var> 。
</p>
<p>如果<var>category</var>是<code>LC_ALL</code> ，这指定了用于所有目的的语言环境。的其他可能值<var>category</var>指定一个用途（请参阅“ <a href="Locale-Categories.html#Locale-Categories">语言环境类别”</a> ）。
</p>
<p>您还可以使用此函数通过将空指针作为参数来查找当前语言环境。 <var>locale</var>论点。在这种情况下， <code>setlocale</code>返回一个字符串，该字符串是当前为类别选择的语言环境的名称<var>category</var> 。
</p>
<p>传回的字串<code>setlocale</code>可以被后续调用覆盖，因此，如果要保存该<a href="Copying-Strings-and-Arrays.html#Copying-Strings-and-Arrays">字符串，而不要再</a>调用它，则应复制该字符串（请参见<a href="Copying-Strings-and-Arrays.html#Copying-Strings-and-Arrays">复制字符串和数组</a> ）。 <code>setlocale</code> 。（保证标准库永远不会调用<code>setlocale</code>本身。）
</p>
<p>您不应该修改返回的字符串<code>setlocale</code> 。它可能与先前调用时作为参数传递的字符串相同<code>setlocale</code> 。一个要求是<var>category</var>在调用中必须与返回的字符串相同，并且在将字符串传递为<var>locale</var>参数。
</p>
<p>当您阅读类别的当前语言环境时<code>LC_ALL</code> ，该值对所有类别的所选语言环境的整个组合进行编码。如果您使用相同的“语言环境名称” <code>LC_ALL</code>在随后的电话中<code>setlocale</code> ，它将恢复区域选择的相同组合。
</p>
<p>为了确保以后可以使用返回的字符串对当前选定的语言环境进行编码，您必须复制该字符串。不能保证返回的指针随时间推移保持有效。
</p>
<p>当。。。的时候<var>locale</var>参数不是空指针，返回的字符串<code>setlocale</code>反映新修改的语言环境。
</p>
<p>如果您指定一个空字符串<var>locale</var> ，这意味着要读取适当的环境变量并使用其值来选择要使用的语言环境<var>category</var> 。
</p>
<p>如果给定一个非空字符串<var>locale</var> ，则尽可能使用该名称的语言环境。
</p>
<p>有效的语言环境名称（或者是第二个参数<code>setlocale</code> ，或者，如果参数是一个空字符串，则从流程环境获得的名称）必须是有效的语言环境名称。请参阅<a href="Locale-Names.html#Locale-Names">语言环境名称</a> 。
</p>
<p>如果您指定了无效的语言环境名称， <code>setlocale</code>返回一个空指针，并保持当前语言环境不变。
</p></dd></dl>

<p>这是显示如何使用的示例<code>setlocale</code>暂时切换到新的语言环境。
</p>
<div class="example">
<pre class="example">#include &lt;stddef.h&gt;
#include &lt;locale.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

void
with_other_locale (char *new_locale,
                   void (*subroutine) (int),
                   int argument)
{
  char *old_locale, *saved_locale;

  /* <span class="roman">Get the name of the current locale.</span>  */
  old_locale = setlocale (LC_ALL, NULL);

  /* <span class="roman">Copy the name so it won&rsquo;t be clobbered by <code>setlocale</code>.</span> */
  saved_locale = strdup (old_locale);
  if (saved_locale == NULL)
    fatal (&quot;Out of memory&quot;);

  /* <span class="roman">Now change the locale and do some stuff with it.</span> */
  setlocale (LC_ALL, new_locale);
  (*subroutine) (argument);

  /* <span class="roman">Restore the original locale.</span> */
  setlocale (LC_ALL, saved_locale);
  free (saved_locale);
}
</pre></div>

<p><strong>可移植性注意：</strong>某些ISO C <!-- /@w -->系统可能会定义其他语言环境类别，并且库的将来版本也会这样做。为了便于携带，假设任何以'开头的符号<samp>LC_</samp> '可能在<samp>locale.h</samp> 。
</p>
<hr>
<div class="header">
<p>下一个： <a href="Standard-Locales.html#Standard-Locales" rel="next" accesskey="n">标准语言环境</a> ，上一个： <a href="Locale-Categories.html#Locale-Categories" rel="prev" accesskey="p">语言环境类别</a> ，上： <a href="Locales.html#Locales" rel="up" accesskey="u">语言环境</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>