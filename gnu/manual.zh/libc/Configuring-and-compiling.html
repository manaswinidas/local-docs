<html><head></head><body lang="zh-Hans" ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>配置和编译（GNU C库）</title>

<meta name="description" content="Configuring and compiling (The GNU C Library)">
<meta name="keywords" content="Configuring and compiling (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Installation.html#Installation" rel="up" title="Installation">
<link href="Running-make-install.html#Running-make-install" rel="next" title="Running make install">
<link href="Installation.html#Installation" rel="prev" title="Installation">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>





<span id="Configuring-and-compiling"></span><div class="header">
<p>下一页： <a href="Running-make-install.html#Running-make-install" rel="next" accesskey="n">运行make install</a> ，上一步： <a href="Installation.html#Installation" rel="up" accesskey="u">安装</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Configuring-and-compiling-the-GNU-C-Library"></span><h3 class="appendixsec">C.1配置和编译GNU C库</h3>
<span id="index-configuring"></span>
<span id="index-compiling"></span>

<p>无法在源目录中编译GNU C库。您必须在单独的构建目录中构建它。例如，如果您在以下位置解压缩了GNU C库源代码， <samp>/src/gnu/glibc-<var>version</var></samp> ，创建目录<samp>/src/gnu/glibc-build</samp>放置目标文件。这样可以在发生错误时删除整个构建目录，这是重新开始的最安全方法，应该始终这样做。
</p>
<p>在您的对象目录中，运行shell脚本<samp>configure</samp>位于源代码树的顶层。在上述情况下，您可以输入</p>
<div class="example">
<pre class="example">$ ../glibc-<var>version</var>/configure <var>args&hellip;</var>
</pre></div>

<p>请注意，即使您在单独的构建目录中进行构建，编译也可能需要在源目录中创建或修改文件和目录。
</p>
<p><code>configure</code>有很多选择，但通常唯一的强制性选择是“ <samp>--prefix</samp> '。这个选项告诉<code>configure</code>您要在其中安装GNU C库的位置。默认为<samp>/usr/local</samp> ，但要安装为标准系统库的常规设置是' <samp>--prefix=/usr</samp> '适用于GNU / Linux系统，' <samp>--prefix=</samp> '（空前缀）用于GNU / Hurd系统。
</p>
<p>传递' <samp>CC=<var>compiler</var></samp> '和<code>CFLAGS=<var>flags</var></code>争论<code>configure</code> 。<code>CC</code>选择将要使用的C编译器，并<code>CFLAGS</code>为编译器设置优化选项。所有编译所需的任何编译器选项，例如选择ABI或为其生成代码的处理器的选项，都应包含在其中。 <code>CC</code> 。对于特定文件，例如用于优化和调试的GNU C库构建系统可能会覆盖这些选项， <code>CFLAGS</code> 。的默认值<code>CFLAGS</code>是' <samp>-g -O2</samp> ”，并且GNU C库无法在没有优化的情况下进行编译，因此如果<code>CFLAGS</code>指定必须启用优化。例如：</p>
<div class="example">
<pre class="example">$ ../glibc-<var>version</var>/configure CC=&quot;gcc -m32&quot; CFLAGS=&quot;-O3&quot;
</pre></div>

<p>以下列表描述了以下所有可用选项<code>configure</code> ：</p>
<dl compact>
<dt>' <samp>--prefix=<var>directory</var></samp> '</dt>
<dd><p>在以下目录的子目录中安装与机器无关的数据文件： <samp><var>directory</var></samp> 。默认是安装在<samp>/usr/local</samp> 。
</p>
</dd>
<dt>' <samp>--exec-prefix=<var>directory</var></samp> '</dt>
<dd><p>在以下目录的子目录中安装库和其他与机器有关的文件<samp><var>directory</var></samp> 。默认为<samp>--prefix</samp> '目录（如果指定了该选项），或者<samp>/usr/local</samp>除此以外。
</p>
</dd>
<dt>' <samp>--with-headers=<var>directory</var></samp> '</dt>
<dd><p>在以下位置查找内核头文件<var>directory</var> ，不是<samp>/usr/include</samp> 。GNU C库需要来自内核头文件的信息，这些信息描述了到内核的接口。GNU C库通常会在<samp>/usr/include</samp>为他们，但如果您指定此选项，它将在<var>DIRECTORY</var>代替。
</p>
<p>此选项主要用于其中标头位于<samp>/usr/include</samp>来自旧版的GNU C库。在这种情况下，冲突有时会发生。如果您要使用一组新的内核标头来编译GNU C库，则也可以使用此选项。 <samp>/usr/include</samp> 。
</p>
</dd>
<dt>' <samp>--enable-kernel=<var>version</var></samp> '</dt>
<dd><p>该选项当前仅在GNU / Linux系统上有用。的<var>version</var>参数应采用XYZ格式，并描述预期生成的库支持的Linux内核的最小版本。越高<var>version</var>数字是，添加的兼容性代码越少，代码获得的速度就越快。
</p>
</dd>
<dt>' <samp>--with-binutils=<var>directory</var></samp> '</dt>
<dd><p>在以下位置使用binutils（汇编器和链接器） <samp><var>directory</var></samp> ，而不是C编译器默认使用的版本。如果系统上的默认binutils无法处理GNU C库中的所有构造，则可以使用此选项。在这种情况下， <code>configure</code>将检测到问题并抑制这些构造，以便该库仍然可用，但功能可能会丢失-例如，您无法使用旧的binutils构建共享的libc。
</p>
</dd>
<dt>' <samp>--with-nonshared-cflags=<var>cflags</var></samp> '</dt>
<dd><p>使用其他编译器标志<var>cflags</var>来构建库的那些始终静态链接到应用程序和库的部分，即使使用共享链接也是如此（即，包含在其中的目标文件） <samp>lib*_nonshared.a</samp>库）。构建过程将自动使用适当的标志，但是此选项可用于设置构建应用程序和库所需的其他标志，以匹配本地策略。例如，如果这样的政策要求链接到应用程序的所有代码都必须使用源设防来构建， <samp>--with-nonshared-cflags=-Wp,-D_FORTIFY_SOURCE=2</samp> '将确保<samp>libc_nonshared.a</samp>使用此标志编译（尽管在这种情况下这不会影响生成的代码，并且可能仅更改调试信息和元数据）。
</p>

</dd>
<dt>' <samp>--disable-shared</samp> '</dt>
<dd><p>即使可能，也不要构建共享库。并非所有系统都支持共享库。您需要ELF支持和（当前）GNU链接器。
</p>
</dd>
<dt>' <samp>--enable-static-pie</samp> '</dt>
<dd><p>启用静态位置独立可执行文件（static PIE）支持。静态PIE与静态可执行文件类似，但是无需动态链接程序的帮助即可将其加载到任何地址。除标有无饼的程序外，所有静态程序和静态测试都将构建为静态PIE。生成的glibc可以与GCC选项-static-pie一起使用，该选项可在GCC 8或更高版本中使用，以创建静态PIE。此选项还意味着默认情况下，会将glibc程序和测试创建为与动态位置无关的可执行文件（PIE）。
</p>
</dd>
<dt>' <samp>--enable-cet</samp> '</dt>
<dd><p>启用英特尔控制流实施技术（CET）支持。使用以下命令构建GNU C库时<samp>--enable-cet</samp> ，生成的库将受到间接分支跟踪（IBT）和影子堆栈（SHSTK）的保护。启用CET后，GNU C库与所有现有的可执行文件和共享库兼容。当前在带有GCC 8和binutils 2.29或更高版本的i386，x86_64和x32上支持此功能。请注意，启用CET后，GNU C库要求具有多字节NOP功能的CPU，例如x86-64处理器以及Intel Pentium Pro或更高版本。
</p>
<p>注意： <samp>--enable-cet</samp>已在非CET处理器上针对i686，x86_64和x32进行了测试。 <samp>--enable-cet</samp>已在CET SDV上针对x86_64和x32进行了测试，但是尚未针对i686验证Intel CET支持。
</p>
</dd>
<dt>' <samp>--disable-profile</samp> '</dt>
<dd><p>不要使用分析信息来构建库。如果您不打算进行概要分析，则可能要使用此选项。
</p>
</dd>
<dt>' <samp>--enable-static-nss</samp> '</dt>
<dd><p>编译NSS（名称服务开关）库的静态版本。不建议这样做，因为它违反了NSS的目的；与NSS库静态链接的程序不能动态地重新配置为使用其他名称数据库。
</p>
</dd>
<dt>' <samp>--enable-hardcoded-path-in-tests</samp> '</dt>
<dd><p>默认情况下，动态测试链接为与已安装的C库一起运行。此选项在动态测试中对新建的C库路径进行硬编码，以便可以直接调用它们。
</p>
</dd>
<dt>' <samp>--disable-timezone-tools</samp> '</dt>
<dd><p>默认情况下，与时区相关的实用程序（ <code>zic</code> ， <code>zdump</code>和<code>tzselect</code> ）与GNU C库一起安装。如果您要独立构建这些文件（例如，使用“ <samp>tzcode</samp> '软件包），则此选项将允许禁用这些软件包的安装。
</p>
<p>请注意，您需要确保外部工具与GNU C库期望的版本保持同步，因为数据格式可能会随时间变化。咨询<samp>timezone</samp>子目录以获取更多详细信息。
</p>
</dd>
<dt>' <samp>--enable-stack-protector</samp> '</dt>
<dt>' <samp>--enable-stack-protector=strong</samp> '</dt>
<dt>' <samp>--enable-stack-protector=all</samp> '</dt>
<dd><p>使用GCC编译C库和glibc包的所有其他部分（包括线程和数学库，NSS模块和音译模块） <samp>-fstack-protector</samp> ， <samp>-fstack-protector-strong</samp>要么<samp>-fstack-protector-all</samp>用于检测堆栈溢出的选项。仅动态链接器和少量直接从汇编器调用的例程不包括在此保护范围内。
</p>
</dd>
<dt>' <samp>--enable-bind-now</samp> '</dt>
<dd><p>对已安装的共享库和程序禁用延迟绑定。这提供了额外的安全性增强，因为它启用了完整的RELRO和只读的全局偏移表（GOT），但代价是略微增加了程序加载时间。
</p>
<span id="index-pt_005fchown"></span>
<span id="index-grantpt-1"></span>
</dd>
<dt>' <samp>--enable-pt_chown</samp> '</dt>
<dd><p>文件<samp>pt_chown</samp>是用于的辅助二进制文件<code>grantpt</code> （请参阅<a href="Allocation.html#Allocation">Pseudo-Terminals</a> ），已安装setuid root以修复伪终端所有权。默认情况下未构建它，因为使用Linux内核的系统通常使用<code>devpts</code>文件系统已启用并已安装在<samp>/dev/pts</samp> ，它会自动管理伪终端的所有权。通过使用 ' <samp>--enable-pt_chown</samp> '，您可以建造<samp>pt_chown</samp>并安装它setuid并归归<code>root</code> 。指某东西的用途<samp>pt_chown</samp>给系统带来了额外的安全风险，只有在您理解并接受这些风险后，才应启用它。
</p>
</dd>
<dt>' <samp>--disable-werror</samp> '</dt>
<dd><p>默认情况下，GNU C库内置<samp>-Werror</samp> 。如果您希望不使用此选项进行构建（例如，如果使用的GCC版本比使用此版本的GNU C库的版本更高，则使用新的警告会导致使用<samp>-Werror</samp>失败），您可以使用<samp>--disable-werror</samp> 。
</p>
</dd>
<dt>' <samp>--disable-mathvec</samp> '</dt>
<dd><p>对于x86_64，默认情况下，GNU C库是使用矢量数学库构建的。使用此选项可以禁用向量数学库。
</p>
</dd>
<dt>' <samp>--enable-tunables</samp> '</dt>
<dd><p>可调参数支持允许在运行时自定义其他库参数。默认情况下启用此功能。此选项可以采用以下值：</p>
<dl compact>
<dt><code>yes</code></dt>
<dd><p>如果未传递任何选项进行配置，则这是默认设置。这将启用可调参数并选择默认的前端（当前为“ <samp>valstring</samp> '）。
</p>
</dd>
<dt><code>no</code></dt>
<dd><p>此选项禁用可调参数。
</p>
</dd>
<dt><code>valstring</code></dt>
<dd><p>这将启用可调参数并选择“ <samp>valstring</samp>可调参数的前端。该前端允许用户在单个环境变量中将可调参数指定为以冒号分隔的列表<code>GLIBC_TUNABLES</code> 。
</p></dd>
</dl>

</dd>
<dt>' <samp>--enable-obsolete-nsl</samp> '</dt>
<dd><p>缺省情况下，libnsl仅作为共享库构建以实现向后兼容性，而根本不构建NSS模块libnss_compat，libnss_nis和libnss_nisplus。使用此选项可对所有相关的NSS模块和头文件启用libnsl。对于GNU C库2.28版之后添加的体系结构和ABI，此选项不可用，并且没有构建libnsl兼容性库。
</p>
</dd>
<dt>' <samp>--disable-crypt</samp> '</dt>
<dd><p>不要安装密码短语哈希库<samp>libcrypt</samp>或头文件<samp>crypt.h</samp> 。 <samp>unistd.h</samp>仍然会声明函数<code>crypt</code> 。使用此选项不会更改可能需要与之链接的程序集<samp>-lcrypt</samp> ;这仅意味着GNU C库将不提供该库。
</p>
<p>该选项适用于尝试使用独立维护的libcrypt实现的黑客和发行版。它可能会在将来的版本中成为默认设置。
</p>
</dd>
<dt>' <samp>--disable-experimental-malloc</samp> '</dt>
<dd><p>默认情况下，在<code>malloc</code> 。虽然可以使用可调参数在每个应用程序的基础上禁用此缓存（将glibc.malloc.tcache_count设置为零），但是可以使用此选项将其从构建中完全删除。
</p>
</dd>
<dt>' <samp>--build=<var>build-system</var></samp> '</dt>
<dt>' <samp>--host=<var>host-system</var></samp> '</dt>
<dd><p>这些选项用于交叉编译。如果您同时指定选项和<var>build-system</var>与...不同<var>host-system</var> ， <code>configure</code>将准备从以下版本交叉编译GNU C库： <var>build-system</var>用于<var>host-system</var> 。您可能需要使用“ <samp>--with-headers</samp> '选项也可能需要覆盖<var>configure</var>选择编译器和/或binutils。
</p>
<p>如果您仅指定“ <samp>--host</samp> '， <code>configure</code>将为本机编译做准备，但使用您指定的内容而不是猜测您的系统是什么。这对于更改CPU子模型最有用。例如，如果<code>configure</code>猜你的机器是<code>i686-pc-linux-gnu</code>但您想为586es编译一个库，请给“ <samp>--host=i586-pc-linux-gnu</samp> ' 要不就 ' <samp>--host=i586-linux</samp> '并添加适当的编译器标志（' <samp>-mcpu=i586</samp> '会把戏） <code>CC</code> 。
</p>
<p>如果您仅指定“ <samp>--build</samp> '， <code>configure</code>会感到困惑。
</p>
</dd>
<dt>' <samp>--with-pkgversion=<var>version</var></samp> '</dt>
<dd><p>指定要包含在其中的二进制文件的描述，可能包括构建号或构建日期<samp>--version</samp> GNU C库所安装程序的输出。例如， <samp>--with-pkgversion='FooBar GNU/Linux glibc build 123'</samp> 。默认值为“ <samp>GNU libc</samp> '。
</p>
</dd>
<dt>' <samp>--with-bugurl=<var>url</var></samp> '</dt>
<dd><p>指定用户希望报告错误时应访问的URL，以包含在其中<samp>--help</samp> GNU C库所安装程序的输出。默认值是指GNU C库的主要错误报告信息。
</p></dd>
</dl>

<p>要构建库和相关程序，请键入<code>make</code> 。这将产生很多输出，其中一些可能看起来像来自<code>make</code>但是不是。查找来自的错误消息<code>make</code>包含“ <samp>***</samp> '。这些表明存在严重错误。
</p>
<p>编译过程可能需要很长时间，具体取决于计算机的配置和速度。某些复杂的模块可能需要很长时间才能编译，而在较慢的计算机上则可能需要几分钟。如果编译器挂起，不要惊慌。
</p>
<p>如果您想进行并行制作，只需传递' <samp>-j</samp> '选项，带有适当的数字参数<code>make</code> 。您需要一个最新的GNU <code>make</code>版本。
</p>
<p>要构建并运行使用某些库功能的测试程序，请键入<code>make check</code> 。如果未成功完成，请不要使用内置库，并在确认问题未知后报告错误。有关<a href="Reporting-Bugs.html#Reporting-Bugs">报告错误</a>的说明，请参见报告错误。请注意，某些测试假设它们没有被运行<code>root</code> 。我们建议您以非特权用户身份编译和测试GNU C库。
</p>
<p>在报告错误之前，请确保您的系统没有问题。测试（以及以后的安装）使用系统的某些先前存在的文件，例如<samp>/etc/passwd</samp> ， <samp>/etc/nsswitch.conf</samp>和别的。这些文件都必须包含正确且明智的内容。
</p>
<p>一般， <code>make check</code>将在报告发现的所有问题之前运行所有测试，如果发生任何问题，将退出并显示错误状态。您可以指定“ <samp>stop-on-test-failure=y</samp> '跑步时<code>make check</code>使测试运行停止并在发生故障时立即以错误状态退出。
</p>
<p>要格式化《 <cite>GNU C库参考手册》</cite>以进行打印，请键入<code>make dvi</code> <!-- /@w --> 。您需要有效的TeX安装才能执行此操作。该发行版在构建过程中以Info文件的形式构建手册的在线格式化版本。您可以使用<code>make info</code> <!-- /@w --> 。
</p>
<p>该库具有许多专用配置参数，您可以在其中找到<samp>Makeconfig</samp> 。这些可以被文件覆盖<samp>configparms</samp> 。要更改它们，请创建一个<samp>configparms</samp>在构建目录中，并添加适合您系统的值。该文件包含在其中并由解析<code>make</code>并且必须遵循makefile的约定。
</p>
<p>通过在其中设置一些变量，可以很容易地配置GNU C库以进行交叉编译。 <samp>configparms</samp> 。组<code>CC</code>到您为其配置库的目标的交叉编译器；重要的是要使用相同的<code>CC</code>跑步时的价值<code>configure</code> ， 像这样： ' <samp>configure <var>target</var> CC=<var>target</var>-gcc</samp> '。组<code>BUILD_CC</code>编译器，以供在编译库时在构建系统上运行的程序使用。您可能需要设置<code>AR</code>交叉编译的版本<code>ar</code>如果未将本机工具配置为与目标配置的目标文件一起使用。当交叉编译GNU C库时，可以使用' <samp>make check test-wrapper="<var>srcdir</var>/scripts/cross-test-ssh.sh <var>hostname</var>"</samp> '，在哪里<var>srcdir</var>是主源目录的绝对目录名称，并且<var>hostname</var>是可以运行GNU C库的新建二进制文件的系统的主机名。源目录和构建目录必须在构建系统和<var>hostname</var> 。
</p>
<p>通常，在测试GNU C库时， <samp>test-wrapper</samp>可以将其设置为任何程序的名称和参数，以运行新建的二进制文件。该程序必须保留要运行的二进制文件的参数，其工作目录以及标准输入，输出和错误文件描述符。如果“ <samp><var>test-wrapper</var> env</samp> '将无法运行设置了环境变量的程序，然后' <samp>test-wrapper-env</samp> “必须设置为运行具有有效环境变量分配的新建程序的程序，这些分配被指定为” <samp><var>var</var>=<var>value</var></samp> '在要运行的程序名称之前。如果为同一变量指定了多个分配，则最后指定的分配必须优先。同样，如果“ <samp><var>test-wrapper</var> env -i</samp> '在直接变量除外的环境中完全没有变量的环境下运行程序将无效，然后' <samp>test-wrapper-env-only</samp>必须设置；它的用法与“ <samp>test-wrapper-env</samp> ”，其语义上的唯一区别是从一组空的环境变量而不是环境变量开始。
</p>

<hr>
<div class="header">
<p>下一页： <a href="Running-make-install.html#Running-make-install" rel="next" accesskey="n">运行make install</a> ，上一步： <a href="Installation.html#Installation" rel="up" accesskey="u">安装</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>