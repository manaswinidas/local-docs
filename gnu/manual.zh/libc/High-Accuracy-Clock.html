<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>高精度时钟（GNU C库）</title>

<meta name="description" content="High Accuracy Clock (The GNU C Library)">
<meta name="keywords" content="High Accuracy Clock (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Calendar-Time.html#Calendar-Time" rel="up" title="Calendar Time">
<link href="Formatting-Calendar-Time.html#Formatting-Calendar-Time" rel="next" title="Formatting Calendar Time">
<link href="Broken_002ddown-Time.html#Broken_002ddown-Time" rel="prev" title="Broken-down Time">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="High-Accuracy-Clock"></span><div class="header">
<p>下一篇： <a href="Formatting-Calendar-Time.html#Formatting-Calendar-Time" rel="next" accesskey="n">格式化日历时间</a> ，上一篇： <a href="Broken_002ddown-Time.html#Broken_002ddown-Time" rel="prev" accesskey="p">故障时间</a> ，上一篇： <a href="Calendar-Time.html#Calendar-Time" rel="up" accesskey="u">日历时间</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="High-Accuracy-Clock-1"></span><h4 class="subsection">21.4.4高精度时钟</h4>

<span id="index-time_002c-high-precision"></span>
<span id="index-clock_002c-high-accuracy"></span>
<span id="index-sys_002ftimex_002eh"></span>
<p>的<code>ntp_gettime</code>和<code>ntp_adjtime</code>功能提供了一个接口来监视和操纵系统时钟以保持高精度时间。例如，您可以微调时钟速度或使其与另一个时间源同步。
</p>
<p>这些功能的典型用法是由实现网络时间协议的服务器来同步多个系统的时钟和高精度时钟。
</p>
<p>这些函数在中声明<samp>sys/timex.h</samp> 。
</p>
<span id="index-struct-ntptimeval"></span>
<dl>
<dt id="index-struct-ntptimeval-1">数据类型： <strong>struct ntptimeval</strong></dt>
<dd><p>此结构用于获取有关系统时钟的信息。它包含以下成员：</p><dl compact>
<dt><code>struct timeval time</code></dt>
<dd><p>这是当前的日历时间，表示为从纪元开始经过的时间。的<code>struct timeval</code>数据类型在“ <a href="Elapsed-Time.html#Elapsed-Time">经过时间”中</a>描述。
</p>
</dd>
<dt><code>long int maxerror</code></dt>
<dd><p>这是最大误差，以微秒为单位。除非通过更新<code>ntp_adjtime</code>定期，此值将达到特定于平台的最大值。
</p>
</dd>
<dt><code>long int esterror</code></dt>
<dd><p>这是估计的误差，以微秒为单位。该值可以通过以下方式设置<code>ntp_adjtime</code>指示系统时钟与实际日历时间的估计偏移量。
</p></dd>
</dl>
</dd></dl>

<dl>
<dt id="index-ntp_005fgettime">功能： <em>int</em> <strong>ntp_gettime</strong> <em>（struct ntptimeval * <var>tptr</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>ntp_gettime</code>函数设置由指向的结构<var>tptr</var>到当前值。之后，结构的元素包含内核中的计时器实现采用的值。他们可能正确也可能不正确。如果不是，则<code>ntp_adjtime</code>打电话是必要的。
</p>
<p>返回值为<code>0</code>关于成功，关于失败的其他价值观。下列<code>errno</code>为此功能定义了错误条件：</p>
<dl compact>
<dt><code>TIME_ERROR</code>
<span id="index-TIME_005fERROR"></span>
</dt>
<dd><p>目前尚未正确设置精密时钟模型，因此必须将时钟视为不同步的，并且应谨慎对待这些值。
</p></dd>
</dl>
</dd></dl>

<span id="index-struct-timex"></span>
<dl>
<dt id="index-struct-timex-1">数据类型： <strong>struct timex</strong></dt>
<dd><p>该结构用于控制和监视系统时钟。它包含以下成员：</p><dl compact>
<dt><code>unsigned int modes</code></dt>
<dd><p>此变量控制是否设置以及设置哪些值。几个符号常量必须与<em>二进制</em>组合<em>或</em>指定有效模式。这些常数以<code>MOD_</code> 。
</p>
</dd>
<dt><code>long int offset</code></dt>
<dd><p>此值指示系统时钟与实际日历时间的当前偏移量。该值以微秒为单位。如果位<code>MOD_OFFSET</code>安顿好了<code>modes</code> ，可以设置偏移量（可能还有其他从属值）。偏移的绝对值不能超过<code>MAXPHASE</code> 。
</p>

</dd>
<dt><code>long int frequency</code></dt>
<dd><p>此值指示实际日历时间与系统时钟之间的频率差异。该值表示为缩放的PPM（百万分率，0.0001％）。缩放比例是<code>1 << SHIFT_USEC</code> 。该值可以用位设置<code>MOD_FREQUENCY</code> ，但绝对值不能超过<code>MAXFREQ</code> 。
</p>
</dd>
<dt><code>long int maxerror</code></dt>
<dd><p>这是最大误差，以微秒为单位。可以使用位设置新值<code>MOD_MAXERROR</code> 。除非通过更新<code>ntp_adjtime</code>定期，此值将稳定增加并达到特定于平台的最大值。
</p>
</dd>
<dt><code>long int esterror</code></dt>
<dd><p>这是估计的误差，以微秒为单位。可以使用位设置该值<code>MOD_ESTERROR</code> 。
</p>
</dd>
<dt><code>int status</code></dt>
<dd><p>此变量反映时钟机械的各种状态。有效位有符号常量，从<code>STA_</code> 。其中一些标志可以使用<code>MOD_STATUS</code>一点。
</p>
</dd>
<dt><code>long int constant</code></dt>
<dd><p>该值表示内核中实现的PLL（锁相环）的带宽或刚度。可以使用位更改该值<code>MOD_TIMECONST</code> 。
</p>
</dd>
<dt><code>long int precision</code></dt>
<dd><p>该值表示读取系统时钟时的精度或最大误差。该值以微秒表示。
</p>
</dd>
<dt><code>long int tolerance</code></dt>
<dd><p>该值表示按比例的PPM表示的系统时钟的最大频率误差。此值用于增加<code>maxerror</code>每一秒。
</p>
</dd>
<dt><code>struct timeval time</code></dt>
<dd><p>当前日历时间。
</p>
</dd>
<dt><code>long int tick</code></dt>
<dd><p>时钟滴答之间经过的时间（以微秒为单位）。时钟滴答是系统时钟所基于的周期性定时器中断。
</p>
</dd>
<dt><code>long int ppsfreq</code></dt>
<dd><p>这是仅当系统时钟可以使用PPS（每秒脉冲）信号来调节系统时钟时才出现的几个可选变量中的第一个。该值以比例的PPM表示，表示系统时钟和PPS信号之间的频率差。
</p>
</dd>
<dt><code>long int jitter</code></dt>
<dd><p>该值表示PPS信号色散的中值滤波平均值，以微秒为单位。
</p>
</dd>
<dt><code>int shift</code></dt>
<dd><p>该值是PPS校准间隔期间的二进制指数，范围为<code>PPS_SHIFT</code>至<code>PPS_SHIFTMAX</code> 。
</p>
</dd>
<dt><code>long int stabil</code></dt>
<dd><p>该值表示按比例缩放的PPM中PPS频率的中值滤波色散。</p>
</dd>
<dt><code>long int jitcnt</code></dt>
<dd><p>此计数器代表抖动超过允许的最大值的脉冲数<code>MAXTIME</code> 。
</p>
</dd>
<dt><code>long int calcnt</code></dt>
<dd><p>此计数器反映成功校准间隔的数量。
</p>
</dd>
<dt><code>long int errcnt</code></dt>
<dd><p>该计数器代表校准误差的数量（由大的偏移量或抖动引起）。
</p>
</dd>
<dt><code>long int stbcnt</code></dt>
<dd><p>该计数器表示稳定性超过阈值的校准次数。
</p></dd>
</dl>
</dd></dl>

<dl>
<dt id="index-ntp_005fadjtime">函数： <em>int</em> <strong>ntp_adjtime</strong> <em>（结构timex * <var>tptr</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>ntp_adjtime</code>函数设置由指定的结构<var>tptr</var>到当前值。
</p>
<p>此外， <code>ntp_adjtime</code>更新一些设置以匹配您在*中传递给它的内容<var>tptr</var> 。使用<code>modes</code> *的元素<var>tptr</var>选择要更新的设置。你可以设定<code>offset</code> ， <code>freq</code> ， <code>maxerror</code> ， <code>esterror</code> ， <code>status</code> ， <code>constant</code>和<code>tick</code> 。
</p>
<p><code>modes</code> = 0表示不设置任何内容。
</p>
<p>只有超级用户可以更新设置。
</p>

<p>返回值为<code>0</code>关于成功，关于失败的其他价值观。下列<code>errno</code>为此功能定义了错误条件：</p>
<dl compact>
<dt><code>TIME_ERROR</code></dt>
<dd><p>目前尚未正确设置高精度时钟模型，因此必须将时钟视为不同步的，并且应谨慎对待这些值。另一个原因可能是不允许使用指定的新值。
</p>
</dd>
<dt><code>EPERM</code></dt>
<dd><p>该进程指定了设置更新，但不是超级用户。
</p>
</dd>
</dl>

<p>有关更多详细信息，请参阅RFC1305（网络时间协议，版本3）和相关文档。
</p>
<p><strong>可移植性说明：</strong> GNU C库的早期版本不具有此功能，但确实具有同义功能<code>adjtimex</code> 。
</p>
</dd></dl>


<hr>
<div class="header">
<p>下一篇： <a href="Formatting-Calendar-Time.html#Formatting-Calendar-Time" rel="next" accesskey="n">格式化日历时间</a> ，上一篇： <a href="Broken_002ddown-Time.html#Broken_002ddown-Time" rel="prev" accesskey="p">故障时间</a> ，上一篇： <a href="Calendar-Time.html#Calendar-Time" rel="up" accesskey="u">日历时间</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>