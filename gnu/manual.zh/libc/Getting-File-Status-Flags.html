<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>获取文件状态标志（GNU C库）</title>

<meta name="description" content="Getting File Status Flags (The GNU C Library)">
<meta name="keywords" content="Getting File Status Flags (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="File-Status-Flags.html#File-Status-Flags" rel="up" title="File Status Flags">
<link href="File-Locks.html#File-Locks" rel="next" title="File Locks">
<link href="Operating-Modes.html#Operating-Modes" rel="prev" title="Operating Modes">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Getting-File-Status-Flags"></span><div class="header">
<p>上一页： <a href="Operating-Modes.html#Operating-Modes" rel="prev" accesskey="p">操作模式</a> ，向上： <a href="File-Status-Flags.html#File-Status-Flags" rel="up" accesskey="u">文件状态标志</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Getting-and-Setting-File-Status-Flags"></span><h4 class="subsection">13.15.4获取和设置文件状态标志</h4>

<p>的<code>fcntl</code>函数可以获取或更改文件状态标志。
</p>
<dl>
<dt id="index-F_005fGETFL-1">巨集： <em>int</em> <strong>F_GETFL</strong></dt>
<dd>
<p>此宏用作<var>command</var>争论<code>fcntl</code> ，以读取带有描述符的打开文件的文件状态标志<var>filedes</var> 。
</p>
<p>的正常返回值<code>fcntl</code>使用此命令是一个非负数，可以解释为各个标志的按位或。由于文件访问模式不是单比特值，因此可以使用以下命令屏蔽掉返回标志中的其他比特<code>O_ACCMODE</code>比较它们。
</p>
<p>如有错误， <code>fcntl</code>返回<em>-1</em> 。下列<code>errno</code>为该命令定义了错误条件：</p>
<dl compact>
<dt><code>EBADF</code></dt>
<dd><p>的<var>filedes</var>参数无效。
</p></dd>
</dl>
</dd></dl>

<dl>
<dt id="index-F_005fSETFL-1">巨集： <em>int</em> <strong>F_SETFL</strong></dt>
<dd>
<p>此宏用作<var>command</var>争论<code>fcntl</code> ，以设置与打开的文件相对应的打开文件的文件状态标志<var>filedes</var>论点。此命令需要三分之一<code>int</code>参数以指定新标志，因此调用如下所示：</p>
<div class="example">
<pre class="example">fcntl (<var>filedes</var>, F_SETFL, <var>new-flags</var>)
</pre></div>

<p>您不能以这种方式更改文件的访问模式；也就是说，是否打开文件描述符以进行读取或写入。
</p>
<p>的正常返回值<code>fcntl</code>该命令的值是<em>-1</em>以外的未指定值，表示错误。错误条件与<code>F_GETFL</code>命令。
</p></dd></dl>

<p>如果要修改文件状态标志，应使用以下命令获取当前标志<code>F_GETFL</code>并修改值。不要以为这里列出的标志是唯一实现的标志。您的程序可能会从现在开始运行数年，然后可能会存在更多标志。例如，这是设置或清除标志的功能<code>O_NONBLOCK</code>而不更改任何其他标志：</p>
<div class="example">
<pre class="example">/* <span class="roman">Set the <code>O_NONBLOCK</code> flag of <var>desc</var> if <var>value</var> is nonzero,</span>
   <span class="roman">or clear the flag if <var>value</var> is 0.</span>
   <span class="roman">Return 0 on success, or -1 on error with <code>errno</code> set.</span> */

int
set_nonblock_flag (int desc, int value)
{
  int oldflags = fcntl (desc, F_GETFL, 0);
  /* <span class="roman">If reading the flags failed, return error indication now.</span> */
  if (oldflags == -1)
    return -1;
  /* <span class="roman">Set just the flag we want to set.</span> */
  if (value != 0)
    oldflags |= O_NONBLOCK;
  else
    oldflags &amp;= ~O_NONBLOCK;
  /* <span class="roman">Store modified flag word in the descriptor.</span> */
  return fcntl (desc, F_SETFL, oldflags);
}
</pre></div>

<hr>
<div class="header">
<p>上一页： <a href="Operating-Modes.html#Operating-Modes" rel="prev" accesskey="p">操作模式</a> ，向上： <a href="File-Status-Flags.html#File-Status-Flags" rel="up" accesskey="u">文件状态标志</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>