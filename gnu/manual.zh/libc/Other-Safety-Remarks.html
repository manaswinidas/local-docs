<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>其他安全说明（GNU C库）</title>

<meta name="description" content="Other Safety Remarks (The GNU C Library)">
<meta name="keywords" content="Other Safety Remarks (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="POSIX.html#POSIX" rel="up" title="POSIX">
<link href="Berkeley-Unix.html#Berkeley-Unix" rel="next" title="Berkeley Unix">
<link href="Conditionally-Safe-Features.html#Conditionally-Safe-Features" rel="prev" title="Conditionally Safe Features">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Other-Safety-Remarks"></span><div class="header">
<p>上一页： <a href="Conditionally-Safe-Features.html#Conditionally-Safe-Features" rel="prev" accesskey="p">有条件的安全功能</a> ，向上： <a href="POSIX.html#POSIX" rel="up" accesskey="u">POSIX</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Other-Safety-Remarks-1"></span><h4 class="subsubsection">1.2.2.4其他安全说明</h4>
<span id="index-Other-Safety-Remarks"></span>

<p>附加关键字可以附加到函数中，指示不会使函数调用不安全的功能，但是在某些程序类别中可能需要考虑这些功能：</p>
<ul>
<li> <code>locale</code>
<span id="index-locale"></span>

<p>带注释的功能<code>locale</code>从区域设置对象读取的MT安全问题，而无需任何形式的同步。带注释的功能<code>locale</code>与语言环境更改并发调用时，其行为可能与执行期间未激活的任何语言环境相对应，但其混合方式不可预测。
</p>
<p>但是，我们不会将这些功能标记为MT-或AS-不安全，因为修改语言环境对象的功能标记为<code>const:locale</code>并被认为是不安全的。由于不安全，当运行多个线程或启用了异步信号时，将不调用后者，因此在这些情况下可以认为语言环境有效地保持不变，这使得前者很安全。
</p>


</li><li> <code>env</code>
<span id="index-env"></span>

<p>标有功能<code>env</code>作为MT安全问题进入环境<code>getenv</code>或类似内容，如果同时进行修改，则没有任何保护措施以确保安全。
</p>
<p>我们不会将这些功能标记为MT-或AS-不安全，因为修改环境的功能都标记为<code>const:env</code>并被认为是不安全的。由于不安全，当运行多个线程或启用了异步信号时，将不调用后者，因此在这些情况下可以认为环境实际上是恒定的，这使得前者很安全。
</p>

</li><li> <code>hostid</code>
<span id="index-hostid"></span>

<p>标有功能<code>hostid</code>因为MT安全问题会从保存机器“主机ID”的系统范围数据结构中读取。这些数据结构通常不能自动进行修改。由于预期“主机ID”通常不会更改，因此从中读取的功能（ <code>gethostid</code> ）被认为是安全的，而对其进行修改的函数（ <code>sethostid</code> ）标有<code>const:hostid</code> ，表示如果要调用它，可能需要特别注意。在这种特定情况下，特别注意相当于系统范围（而不仅仅是进程内）的协调。
</p>

</li><li> <code>sigintr</code>
<span id="index-sigintr"></span>

<p>标有功能<code>sigintr</code>作为MT安全问题，请访问<code>_sigintr</code>内部数据结构没有任何保护措施，以确保在进行并发修改时的安全性。
</p>
<p>但是，我们不会将这些功能标记为MT-或AS-不安全，因为修改此数据结构的功能都标记为<code>const:sigintr</code>并被认为是不安全的。由于不安全，当多个线程正在运行或启用了异步信号时，不应调用后者，因此在这些情况下可以认为数据结构有效地保持不变，这使得前者很安全。
</p>

</li><li> <code>fd</code>
<span id="index-fd"></span>

<p>带注释的功能<code>fd</code>由于异步线程取消会中断文件描述符的执行，因此AC安全问题可能会泄漏文件描述符。
</p>
<p>分配或取消分配文件描述符的函数通常会这样标记。即使他们试图保护文件描述符的分配和使用清理区域的重新分配，分配一个新的描述符并在清理区域可以释放它的位置存储它的编号也不能作为单个原子操作执行。类似地，不能原子地执行释放描述符并将其从通常负责释放描述符的数据结构中删除。总会有一个窗口，在其中不能释放描述符，因为描述符尚未存储在清理处理程序参数中，或者在释放之前已被取出。它不能在释放后取出：打开的描述符可能意味着该描述符仍然必须关闭，或者已经关闭，但该描述符已由另一个线程或信号处理程序重新分配。
</p>
<p>通过暂时禁用异步线程取消，可以在内部避免这种泄漏，并且会降低性能。但是，由于分配或释放函数的调用者必须自己执行此操作，以避免在其自己的层中发生相同类型的泄漏，因此让库假定他们正在照顾它比对性能造成的影响更有意义。当问题在上层解决时，它是多余的，而当问题没有解决时，它是不足的。
</p>
<p>此注释本身不会导致该功能被视为交流不安全。但是，这种泄漏的累积影响可能会对某些程序造成问题。在这种情况下，建议在调用此类函数的过程中暂停异步取消。
</p>

</li><li> <code>mem</code>
<span id="index-mem"></span>

<p>带注释的功能<code>mem</code>因为如果异步线程取消中断了它们的执行，则AC安全问题可能会泄漏内存。
</p>
<p>问题类似于文件描述符的问题：没有原子接口来分配内存并将其地址存储在参数中的清理处理程序，或者释放它并从该参数中删除其地址，而没有至少暂时禁用异步取消，这些功能不起作用。
</p>
<p>此说明本身不会导致功能被普遍认为是AC不安全的。但是，对于某些程序来说，此类泄漏的累积影响可能非常严重，以至于可能需要在调用此类函数期间禁用异步取消。
</p>

</li><li> <code>cwd</code>
<span id="index-cwd"></span>

<p>标有功能<code>cwd</code>因为MT安全问题可能会在执行过程中临时更改当前工作目录，这可能导致相对路径名在其他线程中或在异步信号或取消处理程序中以意外方式解析。
</p>
<p>这还不足以将如此标记的功能标记为MT-或AS-不安全，但是当此行为是可选的时（例如， <code>nftw</code>与<code>FTW_CHDIR</code> ），避免使用该选项可能是使用完整路径名或相对于文件描述符的一个很好的选择（例如<code>openat</code> ）系统调用。
</p>

</li><li> <code>!posix</code>
<span id="index-_0021posix"></span>

<p>此备注作为功能的MT，AS或AC安全注释，表明该功能的安全状态已知与POSIX标准中的指定状态不同。例如，POSIX不需要某个功能是安全的，但是我们的实现是安全的，反之亦然。
</p>
<p>就目前而言，没有此备注并不意味着我们记录的安全特性与POSIX要求的相应功能相同。
</p>

</li><li> <code>:identifier</code>
<span id="index-_003aidentifier"></span>

<p>注释有时可能会跟在标识符后面，这些标识符旨在对几个功能进行分组，例如，以不安全的方式访问数据结构，例如<code>race</code>和<code>const</code> ，或提供更具体的信息，例如在标有的功能中命名信号<code>sig</code> 。可以设想，它可以应用于<code>lock</code>和<code>corrupt</code>以及将来。
</p>
<p>在大多数情况下，标识符将命名一组函数，但可能会使用诸如这样的符号命名全局对象或函数自变量，或与它们关联的可识别属性或逻辑组件。 <code>:buf(arg)</code>表示与参数关联的缓冲区<var>arg</var> ， 要么<code>:tcattr(fd)</code>表示文件描述符的终端属性<var>fd</var> 。
</p>
<p>标识符最常见的用途是提供功能和自变量的逻辑组，这些组必须由相同的同步原语保护，以确保在给定上下文中的安全操作。
</p>

</li><li> <code>/condition</code>
<span id="index-_002fcondition"></span>

<p>一些安全注释可能是有条件的，因为它们仅在涉及参数，全局变量甚至底层内核的布尔表达式的计算结果为true时才适用。这样的条件<code>/hurd</code>要么<code>/!linux!bsd</code>表示前面的标记分别仅在基础内核是HURD或既不是Linux也不是BSD内核时才适用。 <code>/!ps</code>和<code>/one_per_line</code>指示前面的标记仅在参数时适用<var>ps</var>是NULL还是全局变量<var>one_per_line</var>不为零。
</p>
<p>当所有使功能不安全的标记都带有此类条件装饰，而没有任何指定的条件成立时，则该功能可以视为安全的。
</p>

</li></ul>


<hr>
<div class="header">
<p>上一页： <a href="Conditionally-Safe-Features.html#Conditionally-Safe-Features" rel="prev" accesskey="p">有条件的安全功能</a> ，向上： <a href="POSIX.html#POSIX" rel="up" accesskey="u">POSIX</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>