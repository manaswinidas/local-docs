<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>设置警报（GNU C库）</title>

<meta name="description" content="Setting an Alarm (The GNU C Library)">
<meta name="keywords" content="Setting an Alarm (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Date-and-Time.html#Date-and-Time" rel="up" title="Date and Time">
<link href="Sleeping.html#Sleeping" rel="next" title="Sleeping">
<link href="Time-Functions-Example.html#Time-Functions-Example" rel="prev" title="Time Functions Example">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Setting-an-Alarm"></span><div class="header">
<p>下一个： <a href="Sleeping.html#Sleeping" rel="next" accesskey="n">睡眠</a> ，上一个： <a href="Calendar-Time.html#Calendar-Time" rel="prev" accesskey="p">日历时间</a> ，上： <a href="Date-and-Time.html#Date-and-Time" rel="up" accesskey="u">日期和时间</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Setting-an-Alarm-1"></span><h3 class="section">21.5设置闹钟</h3>

<p>的<code>alarm</code>和<code>setitimer</code>函数提供了一种机制，使进程将来可以中断自身。他们通过设置计时器来做到这一点。当计时器到期时，该过程会收到信号。
</p>
<span id="index-setting-an-alarm"></span>
<span id="index-interval-timer_002c-setting"></span>
<span id="index-alarms_002c-setting"></span>
<span id="index-timers_002c-setting"></span>
<p>每个进程都有三个可用的独立间隔计时器：</p>
<ul>
<li>一个实时计时器，用于计算经过的时间。此计时器发送一个<code>SIGALRM</code>到期时向进程发出信号。
<span id="index-real_002dtime-timer"></span>
<span id="index-timer_002c-real_002dtime"></span>

</li><li>一个虚拟计时器，用于计算进程使用的处理器时间。此计时器发送一个<code>SIGVTALRM</code>到期时向进程发出信号。
<span id="index-virtual-timer"></span>
<span id="index-timer_002c-virtual"></span>

</li><li>一个配置计时器，它对进程使用的处理器时间以及代表该进程的系统调用所花费的处理器时间进行计数。此计时器发送一个<code>SIGPROF</code>到期时向进程发出信号。
<span id="index-profiling-timer"></span>
<span id="index-timer_002c-profiling"></span>

<p>此计时器对于在解释器中进行概要分析很有用。时间间隔计时器机制不具备分析本机代码所需的精细粒度。
</p></li></ul>

<p>在任何给定时间，您只能设置每种类型的一个计时器。如果您设置的计时器尚未过期，则只需将该计时器重置为新值即可。
</p>
<p>您应该使用以下命令为适当的警报信号建立处理程序<code>signal</code>要么<code>sigaction</code>在发出呼叫之前<code>setitimer</code>要么<code>alarm</code> 。否则，异常事件链可能导致计时器在程序建立处理程序之前到期。在这种情况下，它将终止，因为终止是警报信号的默认操作。请参阅<a href="Signal-Handling.html#Signal-Handling">信号处理</a> 。
</p>
<p>为了能够使用警报功能来中断可能无限期阻塞的系统调用，重要的是<em>不要</em>设置<code>SA_RESTART</code>使用来注册信号处理程序时标记<code>sigaction</code> 。不使用时<code>sigaction</code>事情变得更糟： <code>signal</code>函数对于重启具有固定的语义。此功能的BSD语义是设置标志。因此，如果<code>sigaction</code>由于任何原因无法使用，有必要使用<code>sysv_signal</code>并不是<code>signal</code> 。
</p>
<p>的<code>setitimer</code>功能是设置警报的主要方法。该功能在头文件中声明<samp>sys/time.h</samp> 。的<code>alarm</code>函数，在<samp>unistd.h</samp> ，为设置实时计时器提供了更为简单的界面。
<span id="index-unistd_002eh-14"></span>
<span id="index-sys_002ftime_002eh-2"></span>
</p>
<dl>
<dt id="index-struct-itimerval">数据类型： <strong>struct itimerval</strong></dt>
<dd>
<p>此结构用于指定计时器何时到期。它包含以下成员：</p><dl compact>
<dt><code>struct timeval it_interval</code></dt>
<dd><p>这是连续的定时器中断之间的时间间隔。如果为零，警报将仅发送一次。
</p>
</dd>
<dt><code>struct timeval it_value</code></dt>
<dd><p>这是从现在到第一次定时器中断的时间。如果为零，则禁用警报。
</p></dd>
</dl>

<p>的<code>struct timeval</code>数据类型在“ <a href="Elapsed-Time.html#Elapsed-Time">经过时间”中</a>描述。
</p></dd></dl>

<dl>
<dt id="index-setitimer">函数： <em>int</em> <strong>setitimer</strong> <em>（int <var>which</var> ，const struct itimerval * <var>new</var> ，struct itimerval * <var>old</var> ）</em></dt>
<dd>
<p>初步： MT安全计时器| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>setitimer</code>功能设置计时器指定<var>which</var>根据<var>new</var> 。的<var>which</var>参数的值可以为<code>ITIMER_REAL</code> ， <code>ITIMER_VIRTUAL</code> ， 要么<code>ITIMER_PROF</code> 。
</p>
<p>如果<var>old</var>不是空指针， <code>setitimer</code>在指向的结构中返回有关任何以前相同类型的未到期计时器的信息。
</p>
<p>返回值为<code>0</code>成功与<code>-1</code>失败。下列<code>errno</code>为此功能定义了错误条件：</p>
<dl compact>
<dt><code>EINVAL</code></dt>
<dd><p>计时器周期太大。
</p></dd>
</dl>
</dd></dl>

<dl>
<dt id="index-getitimer">函数： <em>int</em> <strong>getitimer</strong> <em>（int <var>which</var> ，struct itimerval * <var>old</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>getitimer</code>函数存储有关由以下对象指定的计时器的信息<var>which</var>在所指向的结构中<var>old</var> 。
</p>
<p>返回值和错误条件与相同<code>setitimer</code> 。
</p></dd></dl>

<dl compact>
<dt><code>ITIMER_REAL</code>
<span id="index-ITIMER_005fREAL"></span>
</dt>
<dd>
<p>该常数可用作<var>which</var>争论<code>setitimer</code>和<code>getitimer</code>用于指定实时计时器的功能。
</p>
</dd>
<dt><code>ITIMER_VIRTUAL</code>
<span id="index-ITIMER_005fVIRTUAL"></span>
</dt>
<dd>
<p>该常数可用作<var>which</var>争论<code>setitimer</code>和<code>getitimer</code>用于指定虚拟计时器的功能。
</p>
</dd>
<dt><code>ITIMER_PROF</code>
<span id="index-ITIMER_005fPROF"></span>
</dt>
<dd>
<p>该常数可用作<var>which</var>争论<code>setitimer</code>和<code>getitimer</code>用于指定分析计时器的函数。
</p></dd>
</dl>

<dl>
<dt id="index-alarm">功能： <em>unsigned int</em> <strong>警报</strong> <em>（unsigned int <var>seconds</var> ）</em></dt>
<dd>
<p>初步： MT安全计时器| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>alarm</code>功能将实时计时器设置为在<var>seconds</var>秒。如果要取消任何现有警报，可以通过致电<code>alarm</code>与一个<var>seconds</var>零参数。
</p>
<p>返回值指示在发送前一个警报之前还剩下多少秒。如果以前没有警报， <code>alarm</code>返回零。
</p></dd></dl>

<p>的<code>alarm</code>功能可以根据<code>setitimer</code>像这样：</p>
<div class="example">
<pre class="example">unsigned int
alarm (unsigned int seconds)
{
  struct itimerval old, new;
  new.it_interval.tv_usec = 0;
  new.it_interval.tv_sec = 0;
  new.it_value.tv_usec = 0;
  new.it_value.tv_sec = (long int) seconds;
  if (setitimer (ITIMER_REAL, &amp;new, &amp;old) &lt; 0)
    return 0;
  else
    return old.it_value.tv_sec;
}
</pre></div>

<p>有一个示例显示了<code>alarm</code> <a href="Handler-Returns.html#Handler-Returns">处理程序返回中的</a>函数。
</p>
<p>如果您只是想让进程等待给定的秒数，则应使用<code>sleep</code>功能。请参阅<a href="Sleeping.html#Sleeping">睡眠</a> 。
</p>
<p>您不应该指望计时器到期时准确到达的信号。在多处理环境中，通常会涉及一些延迟。
</p>
<p><strong>便携性注：</strong> <code>setitimer</code>和<code>getitimer</code>函数来自BSD Unix，而<code>alarm</code>功能由POSIX.1标准指定。 <code>setitimer</code>比<code>alarm</code> ，但是<code>alarm</code>被更广泛地使用。
</p>
<hr>
<div class="header">
<p>下一个： <a href="Sleeping.html#Sleeping" rel="next" accesskey="n">睡眠</a> ，上一个： <a href="Calendar-Time.html#Calendar-Time" rel="prev" accesskey="p">日历时间</a> ，上： <a href="Date-and-Time.html#Date-and-Time" rel="up" accesskey="u">日期和时间</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>