<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>控制缓冲（GNU C库）</title>

<meta name="description" content="Controlling Buffering (The GNU C Library)">
<meta name="keywords" content="Controlling Buffering (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Stream-Buffering.html#Stream-Buffering" rel="up" title="Stream Buffering">
<link href="Other-Kinds-of-Streams.html#Other-Kinds-of-Streams" rel="next" title="Other Kinds of Streams">
<link href="Flushing-Buffers.html#Flushing-Buffers" rel="prev" title="Flushing Buffers">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Controlling-Buffering"></span><div class="header">
<p>上一页： <a href="Flushing-Buffers.html#Flushing-Buffers" rel="prev" accesskey="p">刷新缓冲区</a> ，向上： <a href="Stream-Buffering.html#Stream-Buffering" rel="up" accesskey="u">流缓冲</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Controlling-Which-Kind-of-Buffering"></span><h4 class="subsection">12.20.3控制哪种缓冲</h4>

<p>打开流之后（但在对其执行任何其他操作之前），您可以使用来显式指定希望其具有的缓冲类型。 <code>setvbuf</code>功能。
<span id="index-buffering_002c-controlling"></span>
</p>
<p>本节中列出的功能在头文件中声明<samp>stdio.h</samp> 。
<span id="index-stdio_002eh-12"></span>
</p>
<dl>
<dt id="index-setvbuf">功能： <em>int</em> <strong>setvbuf</strong> <em>（FILE * <var>stream</var> ，字符* <var>buf</var> ，int <var>mode</var> ，size_t <var>size</var> ）</em></dt>
<dd>
<p>初步： MT安全|不安全AS损坏| AC不安全锁损坏|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>此函数用于指定流<var>stream</var>应该有缓冲模式<var>mode</var> ，可以是<code>_IOFBF</code> （用于完全缓冲）， <code>_IOLBF</code> （用于行缓冲），或<code>_IONBF</code> （用于无缓冲的输入/输出）。
</p>
<p>如果您将空指针指定为<var>buf</var>论据<code>setvbuf</code>本身使用分配一个缓冲区<code>malloc</code> 。关闭流时，将释放此缓冲区。
</p>
<p>除此以外， <var>buf</var>应该是至少可以容纳一个字符数组<var>size</var>字符。只要流保持打开状态并且该数组仍是其缓冲区，就不应释放该数组的空间。通常，您应该静态分配它，或者<code>malloc</code> （请参阅无<a href="Unconstrained-Allocation.html#Unconstrained-Allocation">约束分配</a> ）缓冲区。除非在退出声明该数组的块之前关闭文件，否则使用自动数组不是一个好主意。
</p>
<p>当数组保留为流缓冲区时，流I / O函数会将缓冲区用于内部目的。当流将其用于缓冲时，您不应尝试直接访问数组中的值。
</p>
<p>的<code>setvbuf</code>如果成功，函数将返回零；如果的值，则返回非零值<var>mode</var>无效或无法兑现请求。
</p></dd></dl>

<dl>
<dt id="index-_005fIOFBF">巨集： <em>int</em> <strong>_IOFBF</strong></dt>
<dd>
<p>此宏的值是一个整数常量表达式，可以用作<var>mode</var>争论<code>setvbuf</code>函数指定应完全缓冲流。
</p></dd></dl>

<dl>
<dt id="index-_005fIOLBF">巨集： <em>int</em> <strong>_IOLBF</strong></dt>
<dd>
<p>此宏的值是一个整数常量表达式，可以用作<var>mode</var>争论<code>setvbuf</code>函数指定流应该行缓冲。
</p></dd></dl>

<dl>
<dt id="index-_005fIONBF">巨集： <em>int</em> <strong>_IONBF</strong></dt>
<dd>
<p>此宏的值是一个整数常量表达式，可以用作<var>mode</var>争论<code>setvbuf</code>函数，用于指定应不缓冲流。
</p></dd></dl>

<dl>
<dt id="index-BUFSIZ">巨集： <em>int</em> <strong>BUFSIZ</strong></dt>
<dd>
<p>此宏的值是一个整数常量表达式，可以很好地用于<var>size</var>争论<code>setvbuf</code> 。保证该值至少为<code>256</code> 。
</p>
<p>的价值<code>BUFSIZ</code>在每个系统上选择，以便使流I / O高效。所以使用是一个好主意<code>BUFSIZ</code>作为调用时缓冲区的大小<code>setvbuf</code> 。
</p>
<p>实际上，您可以通过以下方式获得更好的缓冲区大小值： <code>fstat</code>系统调用：可以在<code>st_blksize</code>文件属性的字段。请参阅<a href="Attribute-Meanings.html#Attribute-Meanings">属性含义</a> 。
</p>
<p>有时人们也使用<code>BUFSIZ</code>作为用于相关目的的缓冲区的分配大小，例如用于接收带有以下内容的输入行的字符串<code>fgets</code> （请参阅“ <a href="Character-Input.html#Character-Input">字符输入”</a> ）。没有特别的理由使用<code>BUFSIZ</code>为此，而不是其他任何整数，除了它可能导致以有效大小的块进行I / O。
</p></dd></dl>

<dl>
<dt id="index-setbuf">功能： <em>void</em> <strong>setbuf</strong> <em>（文件* <var>stream</var> ，字符* <var>buf</var> ）</em></dt>
<dd>
<p>初步： MT安全|不安全AS损坏| AC不安全锁损坏|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>如果<var>buf</var>是一个空指针，此函数的效果等同于调用<code>setvbuf</code>与一个<var>mode</var>的论点<code>_IONBF</code> 。否则，等同于调用<code>setvbuf</code>与<var>buf</var>和<var>mode</var>的<code>_IOFBF</code>和一个<var>size</var>的论点<code>BUFSIZ</code> 。
</p>
<p>的<code>setbuf</code>提供功能以与旧代码兼容；使用<code>setvbuf</code>在所有新程序中。
</p></dd></dl>

<dl>
<dt id="index-setbuffer">功能： <em>void</em> <strong>setbuffer</strong> <em>（FILE * <var>stream</var> ，字符* <var>buf</var> ，size_t <var>size</var> ）</em></dt>
<dd>
<p>初步： MT安全|不安全AS损坏| AC不安全锁损坏|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>如果<var>buf</var>是一个空指针，此函数使<var>stream</var>无缓冲的。否则，它会使<var>stream</var>完全缓冲使用<var>buf</var>作为缓冲区。的<var>size</var>参数指定长度<var>buf</var> 。
</p>
<p>提供此功能是为了与旧的BSD代码兼容。使用<code>setvbuf</code>代替。
</p></dd></dl>

<dl>
<dt id="index-setlinebuf">函数： <em>void</em> <strong>setlinebuf</strong> <em>（FILE * <var>stream</var> ）</em></dt>
<dd>
<p>初步： MT安全|不安全AS损坏| AC不安全锁损坏|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>该功能使<var>stream</var>行缓冲，并为您分配缓冲区。
</p>
<p>提供此功能是为了与旧的BSD代码兼容。使用<code>setvbuf</code>代替。
</p></dd></dl>

<p>可以使用Solaris中引入的GNU C库中可用的非标准函数来查询给定的流是否行缓冲。
</p>
<dl>
<dt id="index-_005f_005fflbf">函数： <em>int</em> <strong>__flbf</strong> <em>（FILE * <var>stream</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>__flbf</code>如果流，函数将返回非零值<var>stream</var>是行缓冲的。否则，返回值为零。
</p>
<p>该函数在<samp>stdio_ext.h</samp>标头。
</p></dd></dl>

<p>另外两个扩展允许确定缓冲区的大小以及使用了多少缓冲区。这些功能也在Solaris中引入。
</p>
<dl>
<dt id="index-_005f_005ffbufsize">功能： <em>size_t</em> <strong>__fbufsize</strong> <em>（FILE * <var>stream</var> ）</em></dt>
<dd>
<p>初步： MT-Safe竞赛：流|不安全AS损坏|交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>__fbufsize</code>函数返回流中缓冲区的大小<var>stream</var> 。该值可用于优化流的使用。
</p>
<p>该函数在<samp>stdio_ext.h</samp>标头。
</p></dd></dl>

<dl>
<dt id="index-_005f_005ffpending">功能： <em>size_t</em> <strong>__fpending</strong> <em>（FILE * <var>stream</var> ）</em></dt>
<dd>
<p>初步： MT-Safe竞赛：流|不安全AS损坏|交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>__fpending</code>函数返回当前在输出缓冲区中的字节数。对于宽流，测量单位为宽字符。不应在读取模式或打开的只读缓冲区中使用此功能。
</p>
<p>该函数在<samp>stdio_ext.h</samp>标头。
</p></dd></dl>

<hr>
<div class="header">
<p>上一页： <a href="Flushing-Buffers.html#Flushing-Buffers" rel="prev" accesskey="p">刷新缓冲区</a> ，向上： <a href="Stream-Buffering.html#Stream-Buffering" rel="up" accesskey="u">流缓冲</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>