<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Malloc示例（GNU C库）</title>

<meta name="description" content="Malloc Examples (The GNU C Library)">
<meta name="keywords" content="Malloc Examples (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Unconstrained-Allocation.html#Unconstrained-Allocation" rel="up" title="Unconstrained Allocation">
<link href="Freeing-after-Malloc.html#Freeing-after-Malloc" rel="next" title="Freeing after Malloc">
<link href="Basic-Allocation.html#Basic-Allocation" rel="prev" title="Basic Allocation">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Malloc-Examples"></span><div class="header">
<p>下一篇： <a href="Freeing-after-Malloc.html#Freeing-after-Malloc" rel="next" accesskey="n">Malloc之后释放</a> ，上一篇： <a href="Basic-Allocation.html#Basic-Allocation" rel="prev" accesskey="p">基本分配</a> ，上一篇： <a href="Unconstrained-Allocation.html#Unconstrained-Allocation" rel="up" accesskey="u">不受限制的分配</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Examples-of-malloc"></span><h4 class="subsubsection">3.2.3.2示例<code>malloc</code></h4>

<p>如果没有更多可用空间， <code>malloc</code>返回一个空指针。您应该检查<em>每次</em>致电的价值<code>malloc</code> 。编写一个子程序来调用非常有用<code>malloc</code>并报告错误（如果该值为空指针），并且仅在该值为非零时返回。该功能通常称为<code>xmalloc</code> 。这里是：</p>
<div class="example">
<pre class="example">void *
xmalloc (size_t size)
{
  void *value = malloc (size);
  if (value == 0)
    fatal (&quot;virtual memory exhausted&quot;);
  return value;
}
</pre></div>

<p>这是使用的真实示例<code>malloc</code> （通过<code>xmalloc</code> ）。功能<code>savestring</code>将一个字符序列复制到一个新分配的以null终止的字符串中：</p>
<div class="example">
<pre class="example">char *
savestring (const char *ptr, size_t len)
{
  char *value = (char *) xmalloc (len + 1);
  value[len] = '\0';
  return (char *) memcpy (value, ptr, len);
}
</pre></div>

<p>那块<code>malloc</code>确保为您提供对齐方式，以便它可以容纳任何类型的数据。在GNU系统上，该地址在32位系统上始终为8的倍数，在64位系统上始终为16的倍数。仅很少需要更高的边界（例如页面边界）；对于那些情况，使用<code>aligned_alloc</code>要么<code>posix_memalign</code> （请参阅<a href="Aligned-Memory-Blocks.html#Aligned-Memory-Blocks">对齐的内存块</a> ）。
</p>
<p>请注意，位于块末尾的内存可能正在用于其他用途。也许另一个调用已经分配了一个块<code>malloc</code> 。如果您尝试将数据块处理的时间超过要求的时间，则可能会破坏<code>malloc</code>用于跟踪其块，或者您可以销毁另一个块的内容。如果您已经分配了一个块并发现您希望它更大，请使用<code>realloc</code> （请参阅<a href="Changing-Block-Size.html#Changing-Block-Size">更改块大小</a> ）。
</p>
<hr>
<div class="header">
<p>下一篇： <a href="Freeing-after-Malloc.html#Freeing-after-Malloc" rel="next" accesskey="n">Malloc之后释放</a> ，上一篇： <a href="Basic-Allocation.html#Basic-Allocation" rel="prev" accesskey="p">基本分配</a> ，上一篇： <a href="Unconstrained-Allocation.html#Unconstrained-Allocation" rel="up" accesskey="u">不受限制的分配</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>