<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>设置组（GNU C库）</title>

<meta name="description" content="Setting Groups (The GNU C Library)">
<meta name="keywords" content="Setting Groups (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Users-and-Groups.html#Users-and-Groups" rel="up" title="Users and Groups">
<link href="Enable_002fDisable-Setuid.html#Enable_002fDisable-Setuid" rel="next" title="Enable/Disable Setuid">
<link href="Setting-User-ID.html#Setting-User-ID" rel="prev" title="Setting User ID">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Setting-Groups"></span><div class="header">
<p>下一篇： <a href="Enable_002fDisable-Setuid.html#Enable_002fDisable-Setuid" rel="next" accesskey="n">启用/禁用Setuid</a> ，上一篇： <a href="Setting-User-ID.html#Setting-User-ID" rel="prev" accesskey="p">设置用户ID</a> ，上一篇： <a href="Users-and-Groups.html#Users-and-Groups" rel="up" accesskey="u">用户和组</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Setting-the-Group-IDs"></span><h3 class="section">30.7设置组ID</h3>

<p>本节介绍了用于更改进程的组ID（真实和有效）的功能。要使用这些功能，必须包含头文件<samp>sys/types.h</samp>和<samp>unistd.h</samp> 。
<span id="index-unistd_002eh-24"></span>
<span id="index-sys_002ftypes_002eh-6"></span>
</p>
<dl>
<dt id="index-setegid">函数： <em>int</em> <strong>setegid</strong> <em>（gid_t <var>newgid</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS不安全锁| AC不安全锁|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>此功能将进程的有效组ID设置为<var>newgid</var> ，前提是允许该进程更改其组ID。就像<code>seteuid</code> ，如果该进程具有特权，则可以将其有效的组ID更改为任何值；如果不是，但是具有文件组ID，则可能会更改为其实际组ID或文件组ID；否则，它可能不会更改其有效的组ID。</p>
<p>请注意，仅当进程的有效<em>用户</em> ID为零时，该进程才享有特权。有效的组ID仅影响访问权限。
</p>
<p>的返回值和错误条件<code>setegid</code>与那些相同<code>seteuid</code> 。
</p>
<p>仅在以下情况下存在此功能<code>_POSIX_SAVED_IDS</code>被定义为。
</p></dd></dl>

<dl>
<dt id="index-setgid">函数： <em>int</em> <strong>setgid</strong> <em>（gid_t <var>newgid</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS不安全锁| AC不安全锁|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>此功能将流程的实际和有效组ID设置为<var>newgid</var> ，前提是该进程具有特权。它还会删除文件组ID（如果有）。
</p>
<p>如果该过程没有特权，则<code>setgid</code>表现像<code>setegid</code> 。
</p>
<p>的返回值和错误条件<code>setgid</code>与那些相同<code>seteuid</code> 。
</p></dd></dl>

<dl>
<dt id="index-setregid">函数： <em>int</em> <strong>setregid</strong> <em>（gid_t <var>rgid</var> ，gid_t <var>egid</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS不安全锁| AC不安全锁|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>此功能将进程的真实组ID设置为<var>rgid</var>和有效的组ID <var>egid</var> 。如果<var>rgid</var>是<code>-1</code> ，表示不更改真实组ID；如果<var>egid</var>是<code>-1</code> ，表示不更改有效的组ID。</p>
<p>的<code>setregid</code>提供功能是为了与不支持文件ID的4.3 BSD Unix兼容。您可以使用此功能交换流程的有效组ID和实际组ID。（特权进程不限于此用法。）如果支持文件ID，则应使用该功能，而不要使用此功能。请参阅<a href="Enable_002fDisable-Setuid.html#Enable_002fDisable-Setuid">启用/禁用Setuid</a> 。
</p>
<p>的返回值和错误条件<code>setregid</code>与那些相同<code>setreuid</code> 。
</p></dd></dl>

<p><code>setuid</code>和<code>setgid</code>行为取决于当时的有效用户ID是否为零。如果不为零，它们的行为就像<code>seteuid</code>和<code>setegid</code> 。如果是这样，他们将同时更改有效ID和实际ID，并删除文件ID。为避免混淆，我们建议您始终使用<code>seteuid</code>和<code>setegid</code>除非您知道有效用户ID为零，而您的目的是永久更改角色。这种情况很少见-大多数需要它的程序，例如<code>login</code>和<code>su</code> ，已被编写。
</p>
<p>请注意，如果您的程序将setuid设置为除<code>root</code> ，则无法永久删除特权。
</p>
<p>该系统还允许特权进程更改其补充组ID。使用<code>setgroups</code>要么<code>initgroups</code> ，您的程序应包含头文件<samp>grp.h</samp> 。
<span id="index-grp_002eh-1"></span>
</p>
<dl>
<dt id="index-setgroups">函数： <em>int</em> <strong>setgroups</strong> <em>（size_t <var>count</var> ，const gid_t * <var>groups</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS不安全锁| AC不安全锁|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>此功能设置进程的补充组ID。只能从特权进程中调用它。的<var>count</var>参数指定数组中组ID的数量<var>groups</var> 。
</p>
<p>该函数返回<code>0</code>如果成功，并且<code>-1</code>错误。下列<code>errno</code>为此功能定义了错误条件：</p>
<dl compact>
<dt><code>EPERM</code></dt>
<dd><p>调用过程没有特权。
</p></dd>
</dl>
</dd></dl>

<dl>
<dt id="index-initgroups">函数： <em>int</em> <strong>initgroups</strong> <em>（const char * <var>user</var> ，gid_t <var>group</var> ）</em></dt>
<dd>
<p>初步： MT安全区域| AS-Unsafe dlopen插件堆锁| AC不安全损坏的内存fd锁|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>initgroups</code>函数将进程的补充组ID设置为用户名的默认默认值<var>user</var> 。群组<var>group</var>自动包含在内。
</p>
<p>此功能通过扫描所有组的组数据库来工作<var>user</var>属于。然后调用<code>setgroups</code>与它已经构建的列表。
</p>
<p>返回值和错误条件与相同<code>setgroups</code> 。
</p></dd></dl>

<p>如果您对特定用户所属的组感兴趣，但是不想更改流程的补充组ID，则可以使用<code>getgrouplist</code> 。使用<code>getgrouplist</code> ，您的程序应包含头文件<samp>grp.h</samp> 。
<span id="index-grp_002eh-2"></span>
</p>
<dl>
<dt id="index-getgrouplist">函数： <em>int</em> <strong>getgrouplist</strong> <em>（const char * <var>user</var> ，gid_t <var>group</var> ，gid_t * <var>groups</var> ，int * <var>ngroups</var> ）</em></dt>
<dd>
<p>初步： MT安全区域| AS-Unsafe dlopen插件堆锁| AC不安全损坏的内存fd锁|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>getgrouplist</code>函数扫描组数据库中的所有组<var>user</var>属于。取决于 * <var>ngroups</var>与这些组相对应的组ID存储在数组中<var>groups</var> ;该函数的返回值是实际存储的组ID的数量。如果* <var>ngroups</var>小于找到的组总数，则<code>getgrouplist</code>返回值<code>-1</code>并将实际的组数存储在* <var>ngroups</var> 。群组<var>group</var>自动包含在由返回的组的列表中<code>getgrouplist</code> 。
</p>
<p>这是使用方法<code>getgrouplist</code>阅读所有补充组<var>user</var> ：</p>
<div class="example">
<pre class="example">gid_t *
supplementary_groups (char *user)
{
  int ngroups = 16;
  gid_t *groups
    = (gid_t *) xmalloc (ngroups * sizeof (gid_t));
  struct passwd *pw = getpwnam (user);

  if (pw == NULL)
    return NULL;

  if (getgrouplist (pw-&gt;pw_name, pw-&gt;pw_gid, groups, &amp;ngroups) &lt; 0)
    {
      groups = xrealloc (ngroups * sizeof (gid_t));
      getgrouplist (pw-&gt;pw_name, pw-&gt;pw_gid, groups, &amp;ngroups);
    }
  return groups;
}
</pre></div>
</dd></dl>

<hr>
<div class="header">
<p>下一篇： <a href="Enable_002fDisable-Setuid.html#Enable_002fDisable-Setuid" rel="next" accesskey="n">启用/禁用Setuid</a> ，上一篇： <a href="Setting-User-ID.html#Setting-User-ID" rel="prev" accesskey="p">设置用户ID</a> ，上一篇： <a href="Users-and-Groups.html#Users-and-Groups" rel="up" accesskey="u">用户和组</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>