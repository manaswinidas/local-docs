<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>哈希搜索功能（GNU C库）</title>

<meta name="description" content="Hash Search Function (The GNU C Library)">
<meta name="keywords" content="Hash Search Function (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Searching-and-Sorting.html#Searching-and-Sorting" rel="up" title="Searching and Sorting">
<link href="Tree-Search-Function.html#Tree-Search-Function" rel="next" title="Tree Search Function">
<link href="Search_002fSort-Example.html#Search_002fSort-Example" rel="prev" title="Search/Sort Example">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Hash-Search-Function"></span><div class="header">
<p>下一页： <a href="Tree-Search-Function.html#Tree-Search-Function" rel="next" accesskey="n">树木搜索功能</a> ，上一篇： <a href="Search_002fSort-Example.html#Search_002fSort-Example" rel="prev" accesskey="p">搜索/排序示例</a> ，上一篇： <a href="Searching-and-Sorting.html#Searching-and-Sorting" rel="up" accesskey="u">搜索和排序</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="The-hsearch-function_002e"></span><h3 class="section">9.5的<code>hsearch</code>功能。</h3>

<p>到目前为止，本章中提到的函数都是用于在有序或无序数组中搜索。还有其他组织信息的方法，以后应进行搜索。插入，删除和搜索的成本有所不同。一种可能的实现方式是使用哈希表。头文件中声明了以下函数<samp>search.h</samp> 。
</p>
<dl>
<dt id="index-hcreate">函数： <em>int</em> <strong>hcreate</strong> <em>（size_t <var>nel</var> ）</em></dt>
<dd>
<p>初步： MT不安全种族：hsearch | AS不安全堆| AC不安全的损坏的内存|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>hcreate</code>函数创建一个哈希表，该哈希表至少可以包含<var>nel</var>元素。无法增长该表，因此有必要为该表选择值<var>nel</var>明智地。用于实现此功能的方法可能需要使散列表中的元素数大于预期的最大元素数。如果填充了80％或更多的哈希表，它们通常效率不高。只有在几乎没有冲突的情况下，才能实现通过哈希保证的恒定访问时间。有关更多信息，请参见Knuth的“计算机编程的艺术，第3部分：搜索和排序”。
</p>
<p>该功能最弱的方面是整个程序最多使用一个哈希表。该表在编程器无法控制的情况下分配在本地存储器中。作为扩展，GNU C库提供了带有可重入接口的附加功能集，该可重入接口提供了相似的接口，但允许任意保留许多哈希表。
</p>
<p>如果前一个表首先通过调用销毁，则可能在程序运行中使用多个哈希表<code>hdestroy</code> 。
</p>
<p>如果成功，该函数将返回非零值。如果返回零，则出现问题。这可能意味着已经在使用哈希表，或者程序内存不足。
</p></dd></dl>

<dl>
<dt id="index-hdestroy">功能： <em>void</em> <strong>hdestroy</strong> <em>（无效）</em></dt>
<dd>
<p>初步： MT不安全种族：hsearch | AS不安全堆| AC不安全的损坏的内存|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>hdestroy</code>函数可用于释放先前调用中分配的所有资源<code>hcreate</code> 。调用此函数后，可以再次调用<code>hcreate</code>并分配一个可能大小不同的新表。
</p>
<p>重要的是要记住，当时哈希表中包含的元素<code>hdestroy</code>调用<em>不会</em>被此函数释放。程序代码负责释放这些字符串（如有必要）。没有额外的，单独保存的信息，就不可能释放所有元素的内存，因为没有函数可以遍历哈希表中的所有可用元素。如果确实有必要释放表和所有元素，则程序员必须在调用之前保留所有表元素的列表。 <code>hdestroy</code>他/她必须使用此列表释放所有元素的数据。这是一种非常令人不愉快的机制，它还表明，这种哈希表主要用于仅创建一次并在程序运行结束之前使用的表。
</p></dd></dl>

<p>使用以下类型定义哈希表的条目和用于搜索的键：</p>
<dl>
<dt id="index-struct-ENTRY">数据类型： <strong>struct ENTRY</strong></dt>
<dd><p>此结构的两个元素都是指向零终止字符串的指针。这是对功能的限制<code>hsearch</code>功能。它们仅可用于始终使用NUL字符且仅用于终止记录的数据集。无法处理常规二进制数据。
</p>
<dl compact>
<dt><code>char *key</code></dt>
<dd><p>指向以零结尾的字符串的指针，该字符串描述搜索关键字或哈希表中的元素。
</p></dd>
<dt><code>char *data</code></dt>
<dd><p>指向描述数据的以零结尾的字符串的指针。如果仅为了搜索现有条目而调用函数，则该元素可能会保持未定义状态，因为未使用该元素。
</p></dd>
</dl>
</dd></dl>

<dl>
<dt id="index-hsearch">功能： <em>ENTRY *</em> <strong>hsearch</strong> <em>（ENTRY <var>item</var> ，动作<var>action</var> ）</em></dt>
<dd>
<p>初步： MT不安全种族：hsearch | AS不安全| AC不安全损坏/操作== ENTER |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>在使用创建的哈希表中搜索<code>hcreate</code>的<code>hsearch</code>必须使用功能。此函数可以对元素进行简单搜索（如果<var>action</var>有价值<code>FIND</code> ），也可以将key元素插入哈希表。条目永远不会被替换。
</p>
<p>键由指向类型对象的指针表示<code>ENTRY</code> 。为了在哈希表中定位相应的位置<code>key</code>使用结构的元素。
</p>
<p>如果找到具有匹配密钥的条目，则<var>action</var>参数无关。找到的条目将返回。如果找不到匹配的条目，并且<var>action</var>参数具有值<code>FIND</code>该函数返回一个<code>NULL</code>指针。如果找不到条目，并且<var>action</var>参数具有值<code>ENTER</code>新条目将添加到使用参数初始化的哈希表中<var>item</var> 。返回指向新添加的条目的指针。
</p></dd></dl>

<p>如前所述，到目前为止所描述的功能使用的哈希表是全局的，并且程序中最多可以随时有一个哈希表。一种解决方案是使用以下功能，这些功能是GNU扩展。它们的共同点在于它们对哈希表进行操作，该哈希表由该类型的对象的内容描述<code>struct hsearch_data</code> 。此类型应视为不透明，不应直接更改其成员。
</p>
<dl>
<dt id="index-hcreate_005fr">函数： <em>int</em> <strong>hcreate_r</strong> <em>（size_t <var>nel</var> ，结构hsearch_data * <var>htab</var> ）</em></dt>
<dd>
<p>初步： MT安全竞赛：htab | AS不安全堆| AC不安全的损坏的内存|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>



<p>的<code>hcreate_r</code>函数初始化由指向的对象<var>htab</var>至少包含一个哈希表<var>nel</var>元素。因此，此功能等效于<code>hcreate</code>除了初始化数据结构由用户控制外，其他功能都可以。
</p>
<p>这允许一次具有多个哈希表。所需的内存<code>struct hsearch_data</code>对象可以动态分配。在调用此函数之前，必须将其初始化为零。
</p>
<p>如果操作成功，则返回值为非零。如果返回值为零，则出问题了，这可能意味着程序内存不足。
</p></dd></dl>

<dl>
<dt id="index-hdestroy_005fr">函数： <em>void</em> <strong>hdestroy_r</strong> <em>（结构hsearch_data * <var>htab</var> ）</em></dt>
<dd>
<p>初步： MT安全竞赛：htab | AS不安全堆| AC不安全的损坏的内存|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>


<p>的<code>hdestroy_r</code>函数释放由<code>hcreate_r</code>这个对象的功能<var>htab</var> 。至于<code>hdestroy</code>释放表元素的字符串是程序的责任。
</p></dd></dl>

<dl>
<dt id="index-hsearch_005fr">函数： <em>int</em> <strong>hsearch_r</strong> <em>（ENTRY <var>item</var> ，动作<var>action</var> ，输入** <var>retval</var> ，结构hsearch_data * <var>htab</var> ）</em></dt>
<dd>
<p>初步： MT安全竞赛：htab | AS安全AC不安全损坏/操作== ENTER |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>


<p>的<code>hsearch_r</code>功能相当于<code>hsearch</code> 。前两个参数的含义相同。但是，该函数不是在单个全局哈希表上进行操作，而是在由指向的对象所描述的表上工作<var>htab</var> （通过调用进行初始化<code>hcreate_r</code> ）。
</p>
<p>与<code>hcreate</code>是指向表中找到的条目的指针不是函数的返回值。通过将其存储在指针指向的指针变量中来返回它<var>retval</var>参数。该函数的返回值是一个整数值，如果非零则表示成功，如果非零则表示失败。在后一种情况下，全局变量<code>errno</code>发出故障原因的信号。
</p>
<dl compact>
<dt><code>ENOMEM</code></dt>
<dd><p>桌子已经装满了<code>hsearch_r</code>被一个迄今未知的钥匙叫来， <var>action</var>调成<code>ENTER</code> 。
</p></dd>
<dt><code>ESRCH</code></dt>
<dd><p>的<var>action</var>参数是<code>FIND</code>并且在表格中找不到对应的元素。
</p></dd>
</dl>
</dd></dl>


<hr>
<div class="header">
<p>下一页： <a href="Tree-Search-Function.html#Tree-Search-Function" rel="next" accesskey="n">树木搜索功能</a> ，上一篇： <a href="Search_002fSort-Example.html#Search_002fSort-Example" rel="prev" accesskey="p">搜索/排序示例</a> ，上一篇： <a href="Searching-and-Sorting.html#Searching-and-Sorting" rel="up" accesskey="u">搜索和排序</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>