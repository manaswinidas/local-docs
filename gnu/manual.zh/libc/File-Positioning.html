<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>文件定位（GNU C库）</title>

<meta name="description" content="File Positioning (The GNU C Library)">
<meta name="keywords" content="File Positioning (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="I_002fO-on-Streams.html#I_002fO-on-Streams" rel="up" title="I/O on Streams">
<link href="Portable-Positioning.html#Portable-Positioning" rel="next" title="Portable Positioning">
<link href="Binary-Streams.html#Binary-Streams" rel="prev" title="Binary Streams">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="File-Positioning"></span><div class="header">
<p>下一篇： <a href="Portable-Positioning.html#Portable-Positioning" rel="next" accesskey="n">便携式定位</a> ，上一篇： <a href="Binary-Streams.html#Binary-Streams" rel="prev" accesskey="p">二进制流</a> ，上一篇： <a href="Binary-Streams.html#Binary-Streams" rel="prev" accesskey="p">流</a>上的<a href="I_002fO-on-Streams.html#I_002fO-on-Streams" rel="up" accesskey="u">I / O</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="File-Positioning-1"></span><h3 class="section">12.18文件定位</h3>
<span id="index-file-positioning-on-a-stream"></span>
<span id="index-positioning-a-stream"></span>
<span id="index-seeking-on-a-stream"></span>

<p>流的<em>文件位置</em>描述了流当前正在文件中读取或写入的位置。流上的I / O使文件位置在文件中前进。在GNU系统上，文件位置用整数表示，该整数从文件的开头算起字节数。请参阅<a href="File-Position.html#File-Position">文件位置</a> 。
</p>
<p>在对普通磁盘文件进行I / O期间，您可以随时更改文件位置，以读取或写入文件的任何部分。其他一些文件也可能允许这样做。支持更改文件位置的文件有时称为<em>随机访问</em>文件。
</p>
<p>您可以使用本节中的功能来检查或修改与流关联的文件位置指示符。下面列出的符号在头文件中声明<samp>stdio.h</samp> 。
<span id="index-stdio_002eh-9"></span>
</p>
<dl>
<dt id="index-ftell">功能： <em>long int</em> <strong>ftell</strong> <em>（文件* <var>stream</var> ）</em></dt>
<dd>
<p>初步： MT安全|不安全AS损坏| AC不安全锁损坏|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>此函数返回流的当前文件位置<var>stream</var> 。
</p>
<p>如果流不支持文件定位，或者文件位置不能在文件中表示，则此功能可能会失败<code>long int</code> ，也可能出于其他原因。如果发生故障，则值为<code>-1</code>返回。
</p></dd></dl>

<dl>
<dt id="index-ftello">功能： <em>off_t</em> <strong>ftello</strong> <em>（文件* <var>stream</var> ）</em></dt>
<dd>
<p>初步： MT安全|不安全AS损坏| AC不安全锁损坏|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>ftello</code>功能类似于<code>ftell</code> ，除了它返回类型的值<code>off_t</code> 。支持此类型的系统使用它来描述所有文件位置，这与使用长int的POSIX规范不同。两者的大小不一定相同。因此，如果将实现写在符合POSIX的底层I / O实现的顶部，则使用ftell可能会导致问题，并且使用<code>ftello</code>只要有可用就更好。
</p>
<p>如果此函数失败，则返回<code>(off_t) -1</code> 。可能由于缺少对文件定位的支持或内部错误而发生。否则，返回值是当前文件位置。
</p>
<p>该函数是Unix Single Specification版本2中定义的扩展。
</p>
<p>当源编译时<code>_FILE_OFFSET_BITS == 64</code>在32位系统上，该功能实际上是<code>ftello64</code> 。即，LFS接口透明地替换了旧接口。
</p></dd></dl>

<dl>
<dt id="index-ftello64">功能： <em>off64_t</em> <strong>ftello64</strong> <em>（文件* <var>stream</var> ）</em></dt>
<dd>
<p>初步： MT安全|不安全AS损坏| AC不安全锁损坏|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>该功能类似于<code>ftello</code>唯一的区别是返回值是类型<code>off64_t</code> 。这也需要流<var>stream</var>是使用以下任一方式打开的<code>fopen64</code> ， <code>freopen64</code> ， 要么<code>tmpfile64</code>因为否则，用于将文件指针定位到2 ^ 31字节限制之外的基础文件操作可能会失败。
</p>
<p>如果源使用<code>_FILE_OFFSET_BITS == 64</code>在32位计算机上，此功能在名称下可用<code>ftello</code>因此透明地替换了旧界面。
</p></dd></dl>

<dl>
<dt id="index-fseek">函数： <em>int</em> <strong>fseek</strong> <em>（FILE * <var>stream</var> ，长整数<var>offset</var> ，int <var>whence</var> ）</em></dt>
<dd>
<p>初步： MT安全|不安全AS损坏| AC不安全锁损坏|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>fseek</code>函数用于更改流的文件位置<var>stream</var> 。的价值<var>whence</var>必须是常量之一<code>SEEK_SET</code> ， <code>SEEK_CUR</code> ， 要么<code>SEEK_END</code> ，以指示是否<var>offset</var>分别相对于文件的开头，当前文件的位置或文件的结尾。
</p>
<p>如果操作成功，此函数将返回零值，并返回一个非零值以指示失败。成功的呼叫也会清除文件结束指示<var>stream</var>并丢弃通过使用“推回”的所有字符<code>ungetc</code> 。
</p>
<p><code>fseek</code>要么在设置文件位置之前刷新任何缓冲的输出，要么记住它，以便稍后将其写入文件中的适当位置。
</p></dd></dl>

<dl>
<dt id="index-fseeko">函数： <em>int</em> <strong>fseeko</strong> <em>（FILE * <var>stream</var> ，off_t <var>offset</var> ，int <var>whence</var> ）</em></dt>
<dd>
<p>初步： MT安全|不安全AS损坏| AC不安全锁损坏|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>该功能类似于<code>fseek</code>但它纠正了一个问题<code>fseek</code>在具有POSIX类型的系统中。使用类型的值<code>long int</code>因为偏移量与POSIX不兼容。 <code>fseeko</code>使用正确的类型<code>off_t</code>为了<var>offset</var>参数。
</p>
<p>因此，最好选择<code>ftello</code>只要它可用，因为它的功能（如果根本不同）更接近基础定义。
</p>
<p>功能和返回值与相同<code>fseek</code> 。
</p>
<p>该函数是Unix Single Specification版本2中定义的扩展。
</p>
<p>当源编译时<code>_FILE_OFFSET_BITS == 64</code>在32位系统上，该功能实际上是<code>fseeko64</code> 。即，LFS接口透明地替换了旧接口。
</p></dd></dl>

<dl>
<dt id="index-fseeko64">函数： <em>int</em> <strong>fseeko64</strong> <em>（FILE * <var>stream</var> ，off64_t <var>offset</var> ，int <var>whence</var> ）</em></dt>
<dd>
<p>初步： MT安全|不安全AS损坏| AC不安全锁损坏|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>该功能类似于<code>fseeko</code>唯一的区别是<var>offset</var>参数的类型<code>off64_t</code> 。这也需要流<var>stream</var>是使用以下任一方式打开的<code>fopen64</code> ， <code>freopen64</code> ， 要么<code>tmpfile64</code>因为否则，用于将文件指针定位到2 ^ 31字节限制之外的基础文件操作可能会失败。
</p>
<p>如果源使用<code>_FILE_OFFSET_BITS == 64</code>在32位计算机上，此功能在名称下可用<code>fseeko</code>因此透明地替换了旧界面。
</p></dd></dl>

<p><strong>可移植性注意：</strong>在非POSIX系统中， <code>ftell</code> ， <code>ftello</code> ， <code>fseek</code>和<code>fseeko</code>可能只能在二进制流上可靠地工作。请参阅<a href="Binary-Streams.html#Binary-Streams">二进制流</a> 。
</p>
<p>以下符号常量定义为用作<var>whence</var>争论<code>fseek</code> 。它们也与<code>lseek</code>函数（请参见<a href="I_002fO-Primitives.html#I_002fO-Primitives">I / O基元</a> ）并指定文件锁定的偏移量（请参见<a href="Control-Operations.html#Control-Operations">Control Operations</a> ）。
</p>
<dl>
<dt id="index-SEEK_005fSET">巨集： <em>int</em> <strong>SEEK_SET</strong></dt>
<dd>
<p>这是一个整数常量，当用作<var>whence</var>争论<code>fseek</code>要么<code>fseeko</code>函数，指定提供的偏移量是相对于文件开头的。
</p></dd></dl>

<dl>
<dt id="index-SEEK_005fCUR">巨集： <em>int</em> <strong>SEEK_CUR</strong></dt>
<dd>
<p>这是一个整数常量，当用作<var>whence</var>争论<code>fseek</code>要么<code>fseeko</code>函数，指定提供的偏移量是相对于当前文件位置的。
</p></dd></dl>

<dl>
<dt id="index-SEEK_005fEND">巨集： <em>int</em> <strong>SEEK_END</strong></dt>
<dd>
<p>这是一个整数常量，当用作<var>whence</var>争论<code>fseek</code>要么<code>fseeko</code>函数，指定提供的偏移量是相对于文件末尾的。
</p></dd></dl>

<dl>
<dt id="index-rewind">功能： <em>无效</em> <strong>倒带</strong> <em>（FILE * <var>stream</var> ）</em></dt>
<dd>
<p>初步： MT安全|不安全AS损坏| AC不安全锁损坏|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>rewind</code>函数定位流<var>stream</var>在文件的开头。相当于打电话<code>fseek</code>要么<code>fseeko</code>在<var>stream</var>带着<var>offset</var>的论点<code>0L</code>和一个<var>whence</var>的论点<code>SEEK_SET</code> ，除了返回值被丢弃并且流的错误指示符被重置之外。
</p></dd></dl>

<p>这三个别名是“ <samp>SEEK_…</samp>存在常量是为了与较早的BSD系统兼容。它们在两个不同的头文件中定义： <samp>fcntl.h</samp>和<samp>sys/file.h</samp> 。
</p>
<dl compact>
<dt><code>L_SET</code>
<span id="index-L_005fSET"></span>
</dt>
<dd>
<p>的别名<code>SEEK_SET</code> 。
</p>
</dd>
<dt><code>L_INCR</code>
<span id="index-L_005fINCR"></span>
</dt>
<dd>
<p>的别名<code>SEEK_CUR</code> 。
</p>
</dd>
<dt><code>L_XTND</code>
<span id="index-L_005fXTND"></span>
</dt>
<dd>
<p>的别名<code>SEEK_END</code> 。
</p></dd>
</dl>

<hr>
<div class="header">
<p>下一篇： <a href="Portable-Positioning.html#Portable-Positioning" rel="next" accesskey="n">便携式定位</a> ，上一篇： <a href="Binary-Streams.html#Binary-Streams" rel="prev" accesskey="p">二进制流</a> ，上一篇： <a href="Binary-Streams.html#Binary-Streams" rel="prev" accesskey="p">流</a>上的<a href="I_002fO-on-Streams.html#I_002fO-on-Streams" rel="up" accesskey="u">I / O</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>