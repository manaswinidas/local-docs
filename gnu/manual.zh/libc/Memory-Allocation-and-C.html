<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>内存分配和C（GNU C库）</title>

<meta name="description" content="Memory Allocation and C (The GNU C Library)">
<meta name="keywords" content="Memory Allocation and C (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Memory-Allocation.html#Memory-Allocation" rel="up" title="Memory Allocation">
<link href="The-GNU-Allocator.html#The-GNU-Allocator" rel="next" title="The GNU Allocator">
<link href="Memory-Allocation.html#Memory-Allocation" rel="prev" title="Memory Allocation">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Memory-Allocation-and-C"></span><div class="header">
<p>下一页： <a href="The-GNU-Allocator.html#The-GNU-Allocator" rel="next" accesskey="n">GNU分配器</a> ，向上： <a href="Memory-Allocation.html#Memory-Allocation" rel="up" accesskey="u">内存分配</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Memory-Allocation-in-C-Programs"></span><h4 class="subsection">3.2.1 C程序中的内存分配</h4>

<p>C语言通过C程序中的变量支持两种内存分配：</p>
<ul>
<li> 声明静态或全局变量时会发生<em>静态分配</em> 。每个静态或全局变量都定义一个固定大小的空间块。当程序启动时（执行操作的一部分），该空间分配一次，并且永远不会释放。
<span id="index-static-memory-allocation"></span>
<span id="index-static-storage-class"></span>

</li><li> 当您声明一个自动变量，例如函数参数或局部变量时，就会发生<em>自动分配</em> 。当输入包含声明的复合语句时，将分配自动变量的空间，并在退出该复合语句时释放该空间。
<span id="index-automatic-memory-allocation"></span>
<span id="index-automatic-storage-class"></span>

<p>在GNU C中，自动存储的大小可以是变化的表达式。在其他C实现中，它必须是一个常量。
</p></li></ul>

<p>C变量不支持第三种重要的内存分配类型，即<em>动态分配</em> ，但可以通过GNU C库函数使用。
<span id="index-dynamic-memory-allocation"></span>
</p>
<span id="Dynamic-Memory-Allocation"></span><h4 class="subsubsection">3.2.1.1动态内存分配</h4>
<span id="index-dynamic-memory-allocation-1"></span>

<p><em>动态内存分配</em>是一种技术，其中程序在运行时确定将信息存储在何处。当需要的内存量或需要继续使用多长时间取决于程序运行之前未知的因素时，就需要动态分配。
</p>
<p>例如，您可能需要一个块来存储从输入文件读取的行。由于对行的长度没有限制，因此必须动态分配内存，并在读取更多行时使其动态变大。
</p>
<p>或者，您可能需要为输入数据中的每个记录或每个定义使用一个块；由于您无法事先知道会有多少个，因此您在读取记录或定义时必须为其分配一个新块。
</p>
<p>使用动态分配时，内存块的分配是程序显式请求的操作。要分配空间时，可以调用函数或宏，并使用参数指定大小。如果要释放空间，可以通过调用另一个函数或宏来释放空间。您可以随时随地执行这些操作。
</p>
<p>C变量不支持动态分配。没有“动态”存储类，也永远不会有C变量，其值存储在动态分配的空间中。获取动态分配的内存的唯一方法是通过系统调用（通常是通过GNU C库函数调用），而引用动态分配的空间的唯一方法是通过指针。因为它不那么方便，并且因为动态分配的实际过程需要更多的计算时间，所以程序员通常仅在静态分配和自动分配都不起作用时才使用动态分配。
</p>
<p>例如，如果您要动态分配一些空间来容纳<code>struct foobar</code> ，您不能声明类型的变量<code>struct foobar</code>其内容是动态分配的空间。但是你可以声明一个指针类型的变量<code>struct foobar *</code>并为其分配空间地址。然后您可以使用运算符<samp>*</samp> '和' <samp>-></samp> '在此指针变量上引用该空间的内容：</p>
<div class="example">
<pre class="example">{
  struct foobar *ptr
     = (struct foobar *) malloc (sizeof (struct foobar));
  ptr-&gt;name = x;
  ptr-&gt;next = current_foobar;
  current_foobar = ptr;
}
</pre></div>

<hr>
<div class="header">
<p>下一页： <a href="The-GNU-Allocator.html#The-GNU-Allocator" rel="next" accesskey="n">GNU分配器</a> ，向上： <a href="Memory-Allocation.html#Memory-Allocation" rel="up" accesskey="u">内存分配</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>