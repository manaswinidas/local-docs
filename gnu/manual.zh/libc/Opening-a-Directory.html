<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>打开目录（GNU C库）</title>

<meta name="description" content="Opening a Directory (The GNU C Library)">
<meta name="keywords" content="Opening a Directory (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Accessing-Directories.html#Accessing-Directories" rel="up" title="Accessing Directories">
<link href="Reading_002fClosing-Directory.html#Reading_002fClosing-Directory" rel="next" title="Reading/Closing Directory">
<link href="Directory-Entries.html#Directory-Entries" rel="prev" title="Directory Entries">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Opening-a-Directory"></span><div class="header">
<p>下一页： <a href="Reading_002fClosing-Directory.html#Reading_002fClosing-Directory" rel="next" accesskey="n">读取/关闭目录</a> ，上一页： <a href="Directory-Entries.html#Directory-Entries" rel="prev" accesskey="p">目录条目</a> ，向上： <a href="Accessing-Directories.html#Accessing-Directories" rel="up" accesskey="u">访问目录</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Opening-a-Directory-Stream"></span><h4 class="subsection">14.2.2打开目录流</h4>

<span id="index-dirent_002eh-2"></span>
<p>本节介绍如何打开目录流。所有符号都在头文件中声明<samp>dirent.h</samp> 。
</p>
<dl>
<dt id="index-DIR">数据类型： <strong>DIR</strong></dt>
<dd>
<p>的<code>DIR</code>数据类型表示目录流。
</p></dd></dl>

<p>您不应该分配<code>struct dirent</code>要么<code>DIR</code>数据类型，因为目录访问功能可以为您完成此操作。而是使用以下函数返回的指针来引用这些对象。
</p>
<p>目录流是一个高级接口。在Linux上，可以使用用于使用文件描述符访问目录的备用接口。请参阅<a href="Low_002dlevel-Directory-Access.html#Low_002dlevel-Directory-Access">低级目录访问</a> 。
</p>
<dl>
<dt id="index-opendir">功能： <em>DIR *</em> <strong>opendir</strong> <em>（const char * <var>dirname</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS不安全堆| AC不安全的内存fd |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>opendir</code>函数打开并返回目录流，以读取文件名为<var>dirname</var> 。流具有类型<code>DIR *</code> 。
</p>
<p>如果不成功， <code>opendir</code>返回一个空指针。除了常见的文件名错误（请参阅<a href="File-Name-Errors.html#File-Name-Errors">文件名错误</a> ）之外，以下内容<code>errno</code>为此功能定义了错误条件：</p>
<dl compact>
<dt><code>EACCES</code></dt>
<dd><p>拒绝由命名的目录的读取权限<code>dirname</code> 。
</p>
</dd>
<dt><code>EMFILE</code></dt>
<dd><p>该进程打开了太多文件。
</p>
</dd>
<dt><code>ENFILE</code></dt>
<dd><p>整个系统或包含目录的文件系统目前无法支持任何其他打开的文件。（在GNU / Hurd系统上不会发生此问题。）
</p>
</dd>
<dt><code>ENOMEM</code></dt>
<dd><p>没有足够的可用内存。
</p></dd>
</dl>

<p>的<code>DIR</code>类型通常使用文件描述符来实现，并且<code>opendir</code>在功能方面<code>open</code>功能。请参阅<a href="Low_002dLevel-I_002fO.html#Low_002dLevel-I_002fO">低级I / O。</a>目录流和基础文件描述符在以下位置关闭<code>exec</code> （请参阅<a href="Executing-a-File.html#Executing-a-File">执行文件</a> ）。
</p></dd></dl>

<p>打开的目录供读取<code>opendir</code>由名称标识。在某些情况下，这还不够。还是方式<code>opendir</code>隐式地为目录创建文件描述符不是程序想要的方式。在这些情况下，可以使用替代接口。
</p>
<dl>
<dt id="index-fdopendir">功能： <em>DIR *</em> <strong>fdopendir</strong> <em>（int <var>fd</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS不安全堆| AC不安全的内存fd |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>fdopendir</code>功能就像<code>opendir</code>但是要求调用者提供文件描述符，而不是使用文件名并打开目录的文件描述符。然后，此文件描述符将在返回目录流对象的后续使用中使用。
</p>
<p>调用者必须确保文件描述符与目录相关联，并且它允许读取。
</p>
<p>如果<code>fdopendir</code>调用成功返回文件描述符，现在该文件由系统控制。可以按以下方式隐式创建描述符： <code>opendir</code>可以使用，但程序不能关闭描述符。
</p>
<p>如果函数执行失败，它将返回一个空指针，并且文件描述符仍然可供程序使用。下列<code>errno</code>为此功能定义了错误条件：</p>
<dl compact>
<dt><code>EBADF</code></dt>
<dd><p>文件描述符无效。
</p>
</dd>
<dt><code>ENOTDIR</code></dt>
<dd><p>文件描述符未与目录关联。
</p>
</dd>
<dt><code>EINVAL</code></dt>
<dd><p>描述符不允许读取目录内容。
</p>
</dd>
<dt><code>ENOMEM</code></dt>
<dd><p>没有足够的可用内存。
</p></dd>
</dl>
</dd></dl>

<p>在某些情况下，可能需要掌握由文件创建器创建的文件描述符。 <code>opendir</code>呼叫。例如，要将当前工作目录切换到该目录，只需阅读<code>fchdir</code>功能可以使用。历史上<code>DIR</code>类型被公开，程序可以访问这些字段。这在GNU C库中不会发生。而是提供了单独的功能以允许访问。
</p>
<dl>
<dt id="index-dirfd">函数： <em>int</em> <strong>dirfd</strong> <em>（DIR * <var>dirstream</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>功能<code>dirfd</code>返回与目录流关联的文件描述符<var>dirstream</var> 。可以使用该描述符，直到使用<code>closedir</code> 。如果目录流实现未使用文件描述符，则返回值为<code>-1</code> 。
</p></dd></dl>

<hr>
<div class="header">
<p>下一页： <a href="Reading_002fClosing-Directory.html#Reading_002fClosing-Directory" rel="next" accesskey="n">读取/关闭目录</a> ，上一页： <a href="Directory-Entries.html#Directory-Entries" rel="prev" accesskey="p">目录条目</a> ，向上： <a href="Accessing-Directories.html#Accessing-Directories" rel="up" accesskey="u">访问目录</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>