<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>GUI程序问题（GNU C库）</title>

<meta name="description" content="GUI program problems (The GNU C Library)">
<meta name="keywords" content="GUI program problems (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Message-catalogs-with-gettext.html#Message-catalogs-with-gettext" rel="up" title="Message catalogs with gettext">
<link href="Using-gettextized-software.html#Using-gettextized-software" rel="next" title="Using gettextized software">
<link href="Charset-conversion-in-gettext.html#Charset-conversion-in-gettext" rel="prev" title="Charset conversion in gettext">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="GUI-program-problems"></span><div class="header">
<p>下一篇： <a href="Using-gettextized-software.html#Using-gettextized-software" rel="next" accesskey="n">使用gettextized软件</a> ，上一篇： <a href="Charset-conversion-in-gettext.html#Charset-conversion-in-gettext" rel="prev" accesskey="p">在gettext中进行字符集转换</a> ，上一篇： <a href="Message-catalogs-with-gettext.html#Message-catalogs-with-gettext" rel="up" accesskey="u">带有gettext的消息目录</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="How-to-use-gettext-in-GUI-programs"></span><h4 class="subsubsection">8.2.1.5使用方法<code>gettext</code>在GUI程序中</h4>

<p>一个地方<code>gettext</code>如果正常使用这些功能，则具有图形用户界面（GUI）的程序中存在很大问题。问题是许多必须翻译的字符串都很短。它们必须出现在限制长度的下拉菜单中。但是不包含整个句子或至少句子的较大片段的字符串可能会在程序中出现不止一种情况，但可能具有不同的翻译。对于GUI程序中经常使用的单字字符串，尤其如此。
</p>
<p>结果，许多人说<code>gettext</code>方法是错误的，而是<code>catgets</code>应该使用确实没有这个问题的工具。但是有一种非常简单而强大的方法可以解决此类问题<code>gettext</code>功能。
</p>
<p>例如，考虑以下虚构情况。GUI程序的菜单栏包含以下条目：</p>
<div class="example">
<pre class="example">+------------+------------+--------------------------------------+
| File       | Printer    |                                      |
+------------+------------+--------------------------------------+
| Open     | | Select   |
| New      | | Open     |
+----------+ | Connect  |
             +----------+
</pre></div>

<p>拥有琴弦<code>File</code> ， <code>Printer</code> ， <code>Open</code> ， <code>New</code> ， <code>Select</code>和<code>Connect</code>翻译后的代码中必须在某个时候调用该函数的<code>gettext</code>家庭。但是在两个地方传递给函数的字符串是<code>Open</code> 。翻译可能不一样，因此我们处于上述困境中。
</p>
<p>解决此问题的一种方法是人为地扩展字符串以使其清晰。但是，如果没有翻译，程序将如何处理？扩展字符串不是应该打印的内容。因此，我们应该使用功能的略微修改版本。
</p>
<p>要扩展字符串，应使用统一的方法。例如，在上面的示例中，可以选择字符串作为</p>
<div class="example">
<pre class="example">Menu|File
Menu|Printer
Menu|File|Open
Menu|File|New
Menu|Printer|Select
Menu|Printer|Open
Menu|Printer|Connect
</pre></div>

<p>现在所有的字符串都是不同的，如果不是<code>gettext</code>使用以下小包装函数，一切正常：</p>
<span id="index-sgettext"></span>
<div class="example">
<pre class="example">  char *
  sgettext (const char *msgid)
  {
    char *msgval = gettext (msgid);
    if (msgval == msgid)
      msgval = strrchr (msgid, '|') + 1;
    return msgval;
  }
</pre></div>

<p>这个小功能的作用是识别没有翻译可用的情况。由于返回值是输入值，因此可以通过指针比较非常有效地完成此操作。如果没有翻译，我们知道输入字符串的格式与我们用于菜单条目的格式相同，因此包含一个<code>|</code>字符。我们仅搜索该字符的最后一次出现并返回指向其后字符的指针。而已！
</p>
<p>如果现在一致地使用扩展字符串形式并替换了<code>gettext</code>通话至<code>sgettext</code> （在GUI实现中通常只限于很少的地方），然后可以生成可以国际化的程序。
</p>
<p>使用高级编译器（例如GNU C），可以编写<code>sgettext</code>用作内联函数或像这样的宏：</p>
<span id="index-sgettext-1"></span>
<div class="example">
<pre class="example">#define sgettext(msgid) \
  ({ const char *__msgid = (msgid);            \
     char *__msgstr = gettext (__msgid);       \
     if (__msgval == __msgid)                  \
       __msgval = strrchr (__msgid, '|') + 1;  \
     __msgval; })
</pre></div>

<p>另一个<code>gettext</code>功能 （ <code>dgettext</code> ， <code>dcgettext</code>和<code>ngettext</code>等价物）也可以而且应该具有相应的函数，除了参数和对底层函数的调用外，它们看起来几乎相同。
</p>
<p>现在当然存在一个问题，为什么GNU C库中不存在这样的功能？这个问题的答案有两个部分。
</p>
<ul>
<li>它们易于编写，因此可以由使用它们的项目提供。这本身并不是一个答案，必须与第二部分一起看待：</li><li>C库无法包含可以在任何地方使用的版本。问题在于如何选择字符以将前缀与扩展字符串中的实际字符串分开。上面的例子<code>|</code>这是一个很好的选择，因为它类似于在此上下文中经常使用的符号，并且它也是消息字符串中不经常使用的字符。

<p>但是，如果在消息字符串中使用字符，该怎么办。或者，如果选择的字符在计算机上的字符集中不可用，则进行编译（例如， <code>|</code> ISO C <!-- /@w -->不需要存在；这就是为什么<samp>iso646.h</samp>文件位于ISO C <!-- /@w -->编程环境中）。
</p></li></ul>

<p>只剩下一条评论。上面的包装函数要求翻译字符串本身不进行扩展。这只是合乎逻辑的。不需要消除字符串的歧义（因为它们永远不会用作搜索的键），并且这样做还可以节省相当多的内存和磁盘空间。
</p>

<hr>
<div class="header">
<p>下一篇： <a href="Using-gettextized-software.html#Using-gettextized-software" rel="next" accesskey="n">使用gettextized软件</a> ，上一篇： <a href="Charset-conversion-in-gettext.html#Charset-conversion-in-gettext" rel="prev" accesskey="p">在gettext中进行字符集转换</a> ，上一篇： <a href="Message-catalogs-with-gettext.html#Message-catalogs-with-gettext" rel="up" accesskey="u">带有gettext的消息目录</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>