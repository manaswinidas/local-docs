<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>移植（GNU C库）</title>

<meta name="description" content="Porting (The GNU C Library)">
<meta name="keywords" content="Porting (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Maintenance.html#Maintenance" rel="up" title="Maintenance">
<link href="Hierarchy-Conventions.html#Hierarchy-Conventions" rel="next" title="Hierarchy Conventions">
<link href="64_002dbit-time-symbol-handling.html#g_t64_002dbit-time-symbol-handling" rel="prev" title="64-bit time symbol handling">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Porting"></span><div class="header">
<p>上一页： <a href="Symbol-handling.html#Symbol-handling" rel="prev" accesskey="p">符号处理</a> ，上一级： <a href="Maintenance.html#Maintenance" rel="up" accesskey="u">维护</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Porting-the-GNU-C-Library"></span><h3 class="appendixsec">D.3移植GNU C库</h3>

<p>GNU C库被编写为可轻松移植到各种机器和操作系统。与机器和操作系统有关的功能被很好地分离，以使添加新机器或操作系统的实现变得容易。本节描述了库源代码树的布局，并说明了用于选择要使用的机器相关代码的机制。
</p>
<p>库中所有与机器和操作系统有关的文件都在子目录中<samp>sysdeps</samp>在顶级库源目录下。该目录包含子目录的层次结构（请参见<a href="Hierarchy-Conventions.html#Hierarchy-Conventions">层次结构约定</a> ）。
</p>
<p>的每个子目录<samp>sysdeps</samp>包含特定机器或操作系统或一类机器或操作系统（例如，特定供应商的系统或使用IEEE 754浮点格式的所有机器）的源文件。配置指定这些子目录的有序列表。每个子目录都隐式地将其父目录追加到列表中。例如，指定列表<samp>unix/bsd/vax</samp>等同于指定列表<samp>unix/bsd/vax unix/bsd unix</samp> 。子目录还可以指定它隐含了在目录层次结构中不直接位于其上的其他子目录。如果文件<samp>Implies</samp>存在于子目录中，它列出了其他子目录<samp>sysdeps</samp>追加到列表中，出现在包含<samp>Implies</samp>文件。一条线<samp>Implies</samp>以'开头的文件<samp>#</samp>字符将作为注释被忽略。例如， <samp>unix/bsd/Implies</samp>包含：</p><div class="example">
<pre class="example"># BSD has Internet-related things.
unix/inet
</pre></div>
<p>和<samp>unix/Implies</samp>包含：</p><div class="example">
<pre class="example">posix
</pre></div>

<p>所以最后的清单是<samp>unix/bsd/vax unix/bsd unix/inet unix posix</samp> 。
</p>
<p><samp>sysdeps</samp>有一个名为“特殊”子目录<samp>generic</samp> 。它总是隐式地附加到子目录列表中，因此您不必将其放在<samp>Implies</samp>文件，并且您不应在其下创建旨在成为新的特定类别的子目录。
<samp>generic</samp>有两个目的。首先，makefile不必费心查找不在以下位置的文件的系统相关版本<samp>generic</samp> 。这意味着任何与系统相关的源文件都必须在<samp>generic</samp> ，即使该文件定义的例程未在其他平台上实现。第二， <samp>generic</samp>如果makefile找不到特定于您要编译的系统的版本，则使用系统依赖文件的版本。
</p>
<p>如果有可能在<samp>generic</samp>与计算机无关的C中的文件，仅使用C库中的其他与计算机无关的功能，则应这样做。否则，使其成为存根。<em>存根</em>功能是无法在特定机器或操作系统上实现的功能。存根函数总是返回错误，并进行设置<code>errno</code>至<code>ENOSYS</code> （未实现功能）。请参阅<a href="Error-Reporting.html#Error-Reporting">错误报告</a> 。如果定义存根函数，则必须放置以下语句<code>stub_warning(<var>function</var>)</code> ，在哪里<var>function</var>是函数的名称，在其定义之后。这将导致该功能列在已安装的<code><gnu/stubs.h></code> ，并使GNU ld在使用该功能时发出警告。
</p>
<p>一些稀有功能仅在特定系统上有用，而在其他系统上则完全没有定义；它们不会出现在与系统无关的源代码或makefile中（包括<samp>generic</samp>目录），仅在取决于系统的情况下<samp>Makefile</samp>在特定系统的子目录中。
</p>
<p>如果您遇到的文件位于主源目录之一（ <samp>string</samp> ， <samp>stdio</samp> ，等等），并且您要编写与计算机或操作系统相关的版本，请将文件移至<samp>sysdeps/generic</samp>并将新的实现写入相应的特定于系统的子目录中。请注意，如果文件依赖于系统，则该文件<strong>不得</strong>出现在主要源目录之一中。
</p>
<p>在以下目录的每个子目录中可能都有一些特殊文件<samp>sysdeps</samp> ：</p>
<dl compact>
<dt><samp>Makefile</samp></dt>
<dd>
<p>此计算机或操作系统的文件，或计算机或操作系统的类。该文件包含在库makefile中<samp>Makerules</samp> ，由顶级makefile和子目录makefile使用。它可以更改在包含的makefile中设置的变量或添加新规则。它可以使用GNU <code>make</code>基于变量'的条件指令<samp>subdir</samp> （请参见上文），以为库的不同部分选择不同的变量和规则集。它也可以设置<code>make</code>变数' <samp>sysdep-routines</samp> '，以指定要包含在库中的其他模块。您应该使用“ <samp>sysdep-routines</samp> '而不是将模块添加到' <samp>routines</samp> '，因为后者用于确定要分配给主源树的每个子目录的内容。
</p>
<p>按顺序包括要搜索的子目录的有序列表中的子目录中的每个makefile。由于可能包含多个与系统相关的Makefile，因此每个文件都应附加到“ <samp>sysdep-routines</samp>而不是简单地设置它：</p>
<div class="example">
<pre class="example">sysdep-routines := $(sysdep-routines) foo bar
</pre></div>

</dd>
<dt><samp>Subdirs</samp></dt>
<dd>
<p>该文件包含此系统应包含的顶级库源树下的新的整个子目录的名称。这些子目录的处理方式就像库源树中与系统无关的子目录一样，例如<samp>stdio</samp>和<samp>math</samp> 。
</p>
<p>当有全新的函数和头文件集应进入此子目录所在系统的库时，请使用此选项<samp>sysdeps</samp>实施。例如， <samp>sysdeps/unix/inet/Subdirs</samp>包含<samp>inet</samp> ;的<samp>inet</samp>目录包含各种面向网络的操作，这些操作仅在放入支持Internet的系统上的库中才有意义。
</p>
</dd>
<dt><samp>configure</samp></dt>
<dd>
<p>该文件是要在配置时运行的Shell脚本片段。顶层<samp>configure</samp>脚本使用外壳<code>.</code>命令读取<samp>configure</samp>依次选择每个与系统相关的目录中的文件。的<samp>configure</samp>文件通常是从<samp>configure.ac</samp>使用Autoconf文件。
</p>
<p>取决于系统<samp>configure</samp>脚本通常会将内容添加到shell变量' <samp>DEFS</samp> '和' <samp>config_vars</samp> ';看到顶级<samp>configure</samp>有关详细信息的脚本。该脚本可以检查“ <samp><span class="nolinebreak">--with-</span><var>package</var></samp> ' <!-- /@w -->已传递给顶层的选项<samp>configure</samp> 。对于一个选项<samp><span class="nolinebreak">--with-</span><var>package</var>=<var>value</var></samp> ' <!-- /@w --> <samp>configure</samp>设置shell变量' <samp><span class="nolinebreak">with_</span><var>package</var></samp> ' <!-- /@w --> （带破折号的<var>package</var>转换为下划线） <var>value</var> ;如果选项只是“ <samp><span class="nolinebreak">--with-</span><var>package</var></samp> ' <!-- /@w --> （无参数），则设置为' <samp><span class="nolinebreak">with_</span><var>package</var></samp> ' <!-- /@w -->到' <samp>yes</samp> '。
</p>
</dd>
<dt><samp>configure.ac</samp></dt>
<dd>
<p>该文件是要处理到文件中的Autoconf输入片段<samp>configure</samp>在此子目录中。有关<cite>Autoconf</cite>的说明，请参见<cite>Autoconf中的</cite> <a href="https://www.gnu.org/software/autoconf/manual/html_node/Introduction.html#Introduction">简介</a> <cite>：生成自动配置脚本</cite> 。你应该写<samp>configure</samp>要么<samp>configure.ac</samp> ，但不能两者兼而有之。第一行<samp>configure.ac</samp>应该调用<code>m4</code>宏' <samp>GLIBC_PROVIDES</samp> '。这个宏做了几个<code>AC_PROVIDE</code>调用由顶层使用的Autoconf宏<samp>configure</samp>脚本;否则，Autoconf可能会不必要地再次调用这些宏。
</p></dd>
</dl>

<p>这是用于隔离系统依赖性的通用系统。
</p>
<table class="menu" border="0" cellspacing="0">
<tbody><tr><td align="left" valign="top">• <a href="Hierarchy-Conventions.html#Hierarchy-Conventions" accesskey="1">层次结构约定</a></td><td>  </td><td align="left" valign="top">的布局<samp>sysdeps</samp>层次结构。
</td></tr>
<tr><td align="left" valign="top">• <a href="Porting-to-Unix.html#Porting-to-Unix" accesskey="2">移植到Unix</a></td><td>  </td><td align="left" valign="top">将库移植到普通的类Unix系统。
</td></tr>
</tbody></table>

<hr>
<div class="header">
<p>上一页： <a href="Symbol-handling.html#Symbol-handling" rel="prev" accesskey="p">符号处理</a> ，上一级： <a href="Maintenance.html#Maintenance" rel="up" accesskey="u">维护</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>