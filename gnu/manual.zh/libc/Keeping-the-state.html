<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>保持状态（GNU C库）</title>

<meta name="description" content="Keeping the state (The GNU C Library)">
<meta name="keywords" content="Keeping the state (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Restartable-multibyte-conversion.html#Restartable-multibyte-conversion" rel="up" title="Restartable multibyte conversion">
<link href="Converting-a-Character.html#Converting-a-Character" rel="next" title="Converting a Character">
<link href="Selecting-the-Conversion.html#Selecting-the-Conversion" rel="prev" title="Selecting the Conversion">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Keeping-the-state"></span><div class="header">
<p>下一篇： <a href="Converting-a-Character.html#Converting-a-Character" rel="next" accesskey="n">转换字符</a> ，上一篇： <a href="Selecting-the-Conversion.html#Selecting-the-Conversion" rel="prev" accesskey="p">选择转换</a> ，上一篇： <a href="Converting-a-Character.html#Converting-a-Character" rel="next" accesskey="n">可</a> <a href="Restartable-multibyte-conversion.html#Restartable-multibyte-conversion" rel="up" accesskey="u">重启的多字节转换</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Representing-the-state-of-the-conversion"></span><h4 class="subsection">6.3.2表示转换状态</h4>

<span id="index-stateful"></span>
<p>在本章的引言中，有人说某些字符集使用<em>状态</em>编码。也就是说，编码值在某种程度上取决于文本中的先前字节。
</p>
<p>由于转换功能允许在一个以上的步骤中转换文本，因此我们必须有一种方法可以将该信息从一个函数调用传递到另一个函数。
</p>
<dl>
<dt id="index-mbstate_005ft">数据类型： <strong>mbstate_t</strong></dt>
<dd>
<span id="index-shift-state"></span>
<p>类型变量<code>mbstate_t</code>可以包含有关从一个调用到转换函数到另一个调用所需的<em>移位状态的</em>所有信息。
</p>
<span id="index-wchar_002eh-5"></span>
<p><code>mbstate_t</code>在中定义<samp>wchar.h</samp> 。它是在ISO C90 <!-- /@w -->修订1 <!-- /@w -->引入的。
</p></dd></dl>

<p>使用类型的对象<code>mbstate_t</code>程序员必须定义此类对象（通常作为堆栈上的局部变量），并将指向该对象的指针传递给转换函数。这样，如果当前的多字节字符集是有状态的，则转换功能可以更新对象。
</p>
<p>没有将状态对象置于任何特定状态的特定函数或初始化程序。规则是对象在首次使用之前应始终代表初始状态，这是通过使用如下代码清除整个变量来实现的：</p>
<div class="example">
<pre class="example">{
  mbstate_t state;
  memset (&amp;state, '\0', sizeof (state));
  /* <span class="roman">from now on <var>state</var> can be used.</span>  */
  &hellip;
}
</pre></div>

<p>使用转换函数生成输出时，通常需要测试当前状态是否对应于初始状态。例如，这对于决定是否发出转义序列以在某些序列点处将状态设置为初始状态很有必要。通信协议经常需要这样做。
</p>
<dl>
<dt id="index-mbsinit">功能： <em>int</em> <strong>mbsinit</strong> <em>（const mbstate_t * <var>ps</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>mbsinit</code>函数确定状态对象是否指向<var>ps</var>处于初始状态。如果<var>ps</var>为空指针或对象处于初始状态，返回值为非零。否则为零。
</p>
<span id="index-wchar_002eh-6"></span>
<p><code>mbsinit</code>在ISO C90 <!-- /@w -->修订1 <!-- /@w -->引入，并在<samp>wchar.h</samp> 。
</p></dd></dl>

<p>代码使用<code>mbsinit</code>通常看起来像这样：</p>
<div class="example">
<pre class="example">{
  mbstate_t state;
  memset (&amp;state, '\0', sizeof (state));
  /* <span class="roman">Use <var>state</var>.</span>  */
  &hellip;
  if (! mbsinit (&amp;state))
    {
      /* <span class="roman">Emit code to return to initial state.</span>  */
      const wchar_t empty[] = L&quot;&quot;;
      const wchar_t *srcp = empty;
      wcsrtombs (outbuf, &amp;srcp, outbuflen, &amp;state);
    }
  &hellip;
}
</pre></div>

<p>发出转义序列以返回到初始状态的代码很有趣。的<code>wcsrtombs</code>函数可用于确定必要的输出代码（请参阅<a href="Converting-Strings.html#Converting-Strings">转换字符串</a> ）。请注意，对于GNU C库，从宽字节文本到宽字符文本的转换无需执行此额外操作，因为宽字符编码不是有状态的。但是，没有任何标准提到禁止<code>wchar_t</code>使用有状态编码。
</p>
<hr>
<div class="header">
<p>下一篇： <a href="Converting-a-Character.html#Converting-a-Character" rel="next" accesskey="n">转换字符</a> ，上一篇： <a href="Selecting-the-Conversion.html#Selecting-the-Conversion" rel="prev" accesskey="p">选择转换</a> ，上一篇： <a href="Converting-a-Character.html#Converting-a-Character" rel="next" accesskey="n">可</a> <a href="Restartable-multibyte-conversion.html#Restartable-multibyte-conversion" rel="up" accesskey="u">重启的多字节转换</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>