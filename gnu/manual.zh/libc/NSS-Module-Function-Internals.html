<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>NSS模块函数内部（GNU C库）</title>

<meta name="description" content="NSS Module Function Internals (The GNU C Library)">
<meta name="keywords" content="NSS Module Function Internals (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Extending-NSS.html#Extending-NSS" rel="up" title="Extending NSS">
<link href="Users-and-Groups.html#Users-and-Groups" rel="next" title="Users and Groups">
<link href="Adding-another-Service-to-NSS.html#Adding-another-Service-to-NSS" rel="prev" title="Adding another Service to NSS">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="NSS-Module-Function-Internals"></span><div class="header">
<p>上一页： <a href="Adding-another-Service-to-NSS.html#Adding-another-Service-to-NSS" rel="prev" accesskey="p">向NSS添加另一个服务</a> ，向上： <a href="Extending-NSS.html#Extending-NSS" rel="up" accesskey="u">扩展NSS</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Internals-of-the-NSS-Module-Functions"></span><h4 class="subsection">29.4.2 NSS模块功能的内部</h4>

<p>到目前为止，我们仅为NSS模块中的功能提供了语法接口。实际上，由于每个函数的实现明显不同，因此我们无话可说。但是所有功能都必须遵循一些通用规则。
</p>
<p>实际上，界面中可能会出现四种不同的功能。所有这些都源自传统的系统数据库数据库。
<var>db</var>下表中的通常是数据库的缩写（例如，它是<code>pw</code>用于用户数据库）。
</p>
<dl compact>
<dt><code>enum nss_status _nss_<var>database</var>_set<var>db</var>ent (void)</code></dt>
<dd><p>此功能为后续操作准备服务。对于简单的基于文件的查找，这意味着可以打开文件，对于其他服务，此功能只是一个noop。
</p>
<p>此函数的一种特殊情况是它为某些函数增加了一个参数<var>database</var> s（即接口是<code>int set<var>db</var>ent (int)</code> ）。<a href="Host-Names.html#Host-Names">主机名</a> ，它描述了<code>sethostent</code>功能。
</p>
<p>返回值应为<var>NSS_STATUS_SUCCESS</var>或在发生错误时根据上表（请参阅<a href="NSS-Modules-Interface.html#NSS-Modules-Interface">NSS模块接口</a> ）。
</p>
</dd>
<dt><code>enum nss_status _nss_<var>database</var>_end<var>db</var>ent (void)</code></dt>
<dd><p>此功能仅关闭所有仍打开的文件或删除缓冲区高速缓存。如果没有要删除的文件或缓冲区，这又是一个简单的操作。
</p>
<p>通常没有返回值，除了<var>NSS_STATUS_SUCCESS</var> 。
</p>
</dd>
<dt><code>enum nss_status _nss_<var>database</var>_get<var>db</var>ent_r (<var>STRUCTURE</var> *result, char *buffer, size_t buflen, int *errnop)</code></dt>
<dd><p>由于要连续多次调用此函数以检索一个条目之后另一个条目，因此它必须保持某种状态。但这也意味着功能并不是真正可重入的。它们是可重入的，仅是因为同时调用此函数不会尝试将检索到的数据写在同一位置（非可重入函数就是这种情况）。相反，它会写入由<var>result</var>参数。但是，这些调用具有相同的状态，在文件访问的情况下，这意味着它们将返回文件中的相邻条目。
</p>
<p>长度缓冲<var>buflen</var>指向<var>buffer</var>可用于存储结果的一些其他数据。<em>不能</em>保证在下一次调用此函数时传递相同的缓冲区。因此，一定不能滥用此缓冲区来保存从一个调用到另一个调用的某些状态信息。
</p>
<p>在函数返回失败代码之前，实现应存储本地值<code>errno</code>变量指向<var>errnop</var> 。这对于确保模块在静态链接程序中工作非常重要。存储的值不能为零。
</p>
<p>如上所述，此函数还可以有一个附加的最后一个参数。这取决于使用的数据库。它只发生在<code>host</code>和<code>networks</code> 。
</p>
<p>该函数应返回<code>NSS_STATUS_SUCCESS</code>只要有更多的条目。读取最后一个条目时，它应该返回<code>NSS_STATUS_NOTFOUND</code> 。当作为参数提供的缓冲区太小而无法返回数据时<code>NSS_STATUS_TRYAGAIN</code>应该退货。如果以前未通过调用来初始化服务<code>_nss_<var>DATABASE</var>_set<var>db</var>ent</code>此函数允许的所有返回值也可以在此处返回。
</p>
</dd>
<dt><code>enum nss_status _nss_<var>DATABASE</var>_get<var>db</var>by<var>XX</var>_r (<var>PARAMS</var>, <var>STRUCTURE</var> *result, char *buffer, size_t buflen, int *errnop)</code></dt>
<dd><p>该函数应从数据库返回条目，该条目由<var>PARAMS</var> 。这些参数的类型和数量有所不同。必须通过查看用户级界面功能来单独确定它。此处提供给非可重入版本的所有参数由<var>PARAMS</var> 。
</p>
<p>结果必须存储在指向的结构中<var>result</var> 。如果还有其他数据要返回（例如字符串， <var>result</var>结构仅包含指针），该函数必须使用<var>buffer</var>长度<var>buflen</var> 。绝对不能引用非恒定的全局数据。
</p>
<p>该功能的实现应遵守<var>stayopen</var>由设置的标志<code>set<var>DB</var>ent</code>只要有意义就起作用。
</p>
<p>在函数返回之前，实现应存储本地值<code>errno</code>变量中所指向的变量<var>errnop</var> 。这对于确保模块在静态链接程序中工作很重要。
</p>
<p>同样，此函数还为<code>host</code>和<code>networks</code>数据库。
</p>
<p>返回值应始终遵循上述给定规则（请参见<a href="NSS-Modules-Interface.html#NSS-Modules-Interface">NSS Modules Interface</a> ）。
</p>
</dd>
</dl>
<hr>
<div class="header">
<p>上一页： <a href="Adding-another-Service-to-NSS.html#Adding-another-Service-to-NSS" rel="prev" accesskey="p">向NSS添加另一个服务</a> ，向上： <a href="Extending-NSS.html#Extending-NSS" rel="up" accesskey="u">扩展NSS</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>