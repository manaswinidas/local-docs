<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>选择转换（GNU C库）</title>

<meta name="description" content="Selecting the Conversion (The GNU C Library)">
<meta name="keywords" content="Selecting the Conversion (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Restartable-multibyte-conversion.html#Restartable-multibyte-conversion" rel="up" title="Restartable multibyte conversion">
<link href="Keeping-the-state.html#Keeping-the-state" rel="next" title="Keeping the state">
<link href="Restartable-multibyte-conversion.html#Restartable-multibyte-conversion" rel="prev" title="Restartable multibyte conversion">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Selecting-the-Conversion"></span><div class="header">
<p>下一步： <a href="Keeping-the-state.html#Keeping-the-state" rel="next" accesskey="n">保持状态</a> ，向上：可<a href="Restartable-multibyte-conversion.html#Restartable-multibyte-conversion" rel="up" accesskey="u">重启的多字节转换</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Selecting-the-conversion-and-its-properties"></span><h4 class="subsection">6.3.1选择转换及其属性</h4>

<p>上面我们已经说过，当前选择的语言环境<code>LC_CTYPE</code>类别决定了我们将要描述的功能所执行的转换。每个语言环境都使用自己的字符集（作为<code>localedef</code> ），这是假设为外部多字节编码的一种。宽字符集在GNU C库中始终为UCS-4。
</p>
<p>每个多字节字符集的一个特征是表示一个字符可能需要的最大字节数。在编写使用转换函数的代码时，此信息非常重要（如下例所示）。ISO C <!-- /@w -->标准定义了两个提供此信息的宏。
</p>

<dl>
<dt id="index-MB_005fLEN_005fMAX">巨集： <em>int</em> <strong>MB_LEN_MAX</strong></dt>
<dd>
<p><code>MB_LEN_MAX</code>指定在任何受支持的语言环境中单个字符的多字节序列中的最大字节数。它是一个编译时常量，并且在<samp>limits.h</samp> 。
<span id="index-limits_002eh-1"></span>
</p></dd></dl>

<dl>
<dt id="index-MB_005fCUR_005fMAX">巨集： <em>int</em> <strong>MB_CUR_MAX</strong></dt>
<dd>
<p><code>MB_CUR_MAX</code>扩展为一个正整数表达式，该表达式是当前语言环境中多字节字符中的最大字节数。该值永远不会大于<code>MB_LEN_MAX</code> 。不像<code>MB_LEN_MAX</code>该宏不必是编译时常量，而在GNU C库中则不是。
</p>
<span id="index-stdlib_002eh-6"></span>
<p><code>MB_CUR_MAX</code>在中定义<samp>stdlib.h</samp> 。
</p></dd></dl>

<p>因为严格的ISO C90 <!-- /@w -->编译器不允许使用可变长度数组定义，所以必须使用两个不同的宏，但是仍然希望避免动态分配。这段不完整的代码显示了问题：</p>
<div class="example">
<pre class="example">{
  char buf[MB_LEN_MAX];
  ssize_t len = 0;

  while (! feof (fp))
    {
      fread (&amp;buf[len], 1, MB_CUR_MAX - len, fp);
      /* <span class="roman">&hellip; process</span> buf */
      len -= used;
    }
}
</pre></div>

<p>内循环中的代码应在数组中始终有足够的字节<var>buf</var>转换一个多字节字符。数组<var>buf</var>必须静态调整大小，因为许多编译器不允许使用可变大小。的<code>fread</code>电话确保<code>MB_CUR_MAX</code>字节始终在<var>buf</var> 。请注意，如果<code>MB_CUR_MAX</code>不是编译时常量。
</p>

<hr>
<div class="header">
<p>下一步： <a href="Keeping-the-state.html#Keeping-the-state" rel="next" accesskey="n">保持状态</a> ，向上：可<a href="Restartable-multibyte-conversion.html#Restartable-multibyte-conversion" rel="up" accesskey="u">重启的多字节转换</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>