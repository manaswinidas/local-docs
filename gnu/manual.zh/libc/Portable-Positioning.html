<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>便携式定位（GNU C库）</title>

<meta name="description" content="Portable Positioning (The GNU C Library)">
<meta name="keywords" content="Portable Positioning (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="I_002fO-on-Streams.html#I_002fO-on-Streams" rel="up" title="I/O on Streams">
<link href="Stream-Buffering.html#Stream-Buffering" rel="next" title="Stream Buffering">
<link href="File-Positioning.html#File-Positioning" rel="prev" title="File Positioning">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Portable-Positioning"></span><div class="header">
<p>下一篇： <a href="Stream-Buffering.html#Stream-Buffering" rel="next" accesskey="n">流缓冲</a> ，上一篇： <a href="File-Positioning.html#File-Positioning" rel="prev" accesskey="p">文件定位</a> ，上一篇： <a href="Stream-Buffering.html#Stream-Buffering" rel="next" accesskey="n">流</a>上的<a href="I_002fO-on-Streams.html#I_002fO-on-Streams" rel="up" accesskey="u">I / O</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Portable-File_002dPosition-Functions"></span><h3 class="section">12.19可移植文件位置功能</h3>

<p>在GNU系统上，文件位置实际上是一个字符计数。您可以将任何字符计数值指定为<code>fseek</code>要么<code>fseeko</code>并获得任何随机访问文件的可靠结果。但是，某些ISO C <!-- /@w -->系统不以此方式表示文件位置。
</p>
<p>在某些文本流与二进制流确实不同的系统上，无法将文本流的文件位置表示为从文件开头算起的字符数。例如，某些系统上的文件位置必须同时编码文件内的记录偏移量和记录内的字符偏移量。
</p>
<p>因此，如果您希望程序可移植到这些系统中，则必须遵守某些规则：</p>
<ul>
<li>从返回的值<code>ftell</code>文本流上的字符与到目前为止已阅读的字符数没有可预测的关系。您唯一可以依靠的是您可以随后将其用作<var>offset</var>争论<code>fseek</code>要么<code>fseeko</code>移回相同的文件位置。

</li><li>在致电给<code>fseek</code>要么<code>fseeko</code>在文字串流中， <var>offset</var>必须为零，或<var>whence</var>一定是<code>SEEK_SET</code>和<var>offset</var>必须是早前致电的结果<code>ftell</code>在同一流上。

</li><li>文本流的文件位置指示符的值是不确定的，而有些字符已被推回<code>ungetc</code>尚未读取或丢弃的内容。请参阅未<a href="Unreading.html#Unreading">读</a> 。
</li></ul>

<p>但是，即使您遵守这些规则，对于长文件也可能会遇到麻烦，因为<code>ftell</code>和<code>fseek</code>用一个<code>long int</code>代表文件位置的值。此类型可能没有空间来编码大文件中的所有文件位置。使用<code>ftello</code>和<code>fseeko</code>功能可能会有所帮助，因为<code>off_t</code>类型应该能够容纳所有文件位置值，但这仍然无助于处理必须与文件位置相关联的其他信息。
</p>
<p>因此，如果您确实想为文件位置提供支持特殊编码的系统，则最好使用这些功能<code>fgetpos</code>和<code>fsetpos</code>代替。这些函数使用数据类型表示文件位置<code>fpos_t</code> ，其内部表示因系统而异。
</p>
<p>这些符号在头文件中声明<samp>stdio.h</samp> 。
<span id="index-stdio_002eh-10"></span>
</p>
<dl>
<dt id="index-fpos_005ft">数据类型： <strong>fpos_t</strong></dt>
<dd>
<p>这是一种对象的类型，可以对有关流文件位置的信息进行编码，以供功能使用<code>fgetpos</code>和<code>fsetpos</code> 。
</p>
<p>在GNU C库中， <code>fpos_t</code>是一个不透明的数据结构，其中包含表示文件偏移量和转换状态信息的内部数据。在其他系统中，它可能具有不同的内部表示形式。
</p>
<p>使用时<code>_FILE_OFFSET_BITS == 64</code>在32位计算机上，此类型实际上等效于<code>fpos64_t</code>因为LFS接口透明地替换了旧接口。
</p></dd></dl>

<dl>
<dt id="index-fpos64_005ft">数据类型： <strong>fpos64_t</strong></dt>
<dd>
<p>这是一种对象的类型，可以对有关流文件位置的信息进行编码，以供功能使用<code>fgetpos64</code>和<code>fsetpos64</code> 。
</p>
<p>在GNU C库中， <code>fpos64_t</code>是一个不透明的数据结构，其中包含表示文件偏移量和转换状态信息的内部数据。在其他系统中，它可能具有不同的内部表示形式。
</p></dd></dl>

<dl>
<dt id="index-fgetpos">函数： <em>int</em> <strong>fgetpos</strong> <em>（FILE * <var>stream</var> ，fpos_t * <var>position</var> ）</em></dt>
<dd>
<p>初步： MT安全|不安全AS损坏| AC不安全锁损坏|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>此函数存储流的文件位置指示符的值<var>stream</var>在里面<code>fpos_t</code>指向的对象<var>position</var> 。如果成功<code>fgetpos</code>返回零；否则，它返回一个非零值，并将实现定义的正值存储在<code>errno</code> 。
</p>
<p>当源编译时<code>_FILE_OFFSET_BITS == 64</code>在32位系统上，该功能实际上是<code>fgetpos64</code> 。即，LFS接口透明地替换了旧接口。
</p></dd></dl>

<dl>
<dt id="index-fgetpos64">函数： <em>int</em> <strong>fgetpos64</strong> <em>（FILE * <var>stream</var> ，fpos64_t * <var>position</var> ）</em></dt>
<dd>
<p>初步： MT安全|不安全AS损坏| AC不安全锁损坏|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>该功能类似于<code>fgetpos</code>但是文件位置以类型为变量的形式返回<code>fpos64_t</code>到哪<var>position</var>点。
</p>
<p>如果源使用<code>_FILE_OFFSET_BITS == 64</code>在32位计算机上，此功能在名称下可用<code>fgetpos</code>因此透明地替换了旧界面。
</p></dd></dl>

<dl>
<dt id="index-fsetpos">函数： <em>int</em> <strong>fsetpos</strong> <em>（FILE * <var>stream</var> ，const fpos_t * <var>position</var> ）</em></dt>
<dd>
<p>初步： MT安全|不安全AS损坏| AC不安全锁损坏|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>此功能设置流的文件位置指示符<var>stream</var>到这个位置<var>position</var> ，这必须是先前调用所设置的<code>fgetpos</code>在同一流上。如果成功<code>fsetpos</code>清除流上的文件结束指示符，丢弃通过使用“推回”的任何字符<code>ungetc</code> ，并返回零值。除此以外， <code>fsetpos</code>返回一个非零值，并将实现定义的正值存储在<code>errno</code> 。
</p>
<p>当源编译时<code>_FILE_OFFSET_BITS == 64</code>在32位系统上，该功能实际上是<code>fsetpos64</code> 。即，LFS接口透明地替换了旧接口。
</p></dd></dl>

<dl>
<dt id="index-fsetpos64">功能： <em>int</em> <strong>fsetpos64</strong> <em>（FILE * <var>stream</var> ，const fpos64_t * <var>position</var> ）</em></dt>
<dd>
<p>初步： MT安全|不安全AS损坏| AC不安全锁损坏|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>该功能类似于<code>fsetpos</code>但是用于定位的文件位置在type变量中提供<code>fpos64_t</code>到哪<var>position</var>点。
</p>
<p>如果源使用<code>_FILE_OFFSET_BITS == 64</code>在32位计算机上，此功能在名称下可用<code>fsetpos</code>因此透明地替换了旧界面。
</p></dd></dl>

<hr>
<div class="header">
<p>下一篇： <a href="Stream-Buffering.html#Stream-Buffering" rel="next" accesskey="n">流缓冲</a> ，上一篇： <a href="File-Positioning.html#File-Positioning" rel="prev" accesskey="p">文件定位</a> ，上一篇： <a href="Stream-Buffering.html#Stream-Buffering" rel="next" accesskey="n">流</a>上的<a href="I_002fO-on-Streams.html#I_002fO-on-Streams" rel="up" accesskey="u">I / O</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>