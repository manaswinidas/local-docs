<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>扫描目录内容（GNU C库）</title>

<meta name="description" content="Scanning Directory Content (The GNU C Library)">
<meta name="keywords" content="Scanning Directory Content (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Accessing-Directories.html#Accessing-Directories" rel="up" title="Accessing Directories">
<link href="Simple-Directory-Lister-Mark-II.html#Simple-Directory-Lister-Mark-II" rel="next" title="Simple Directory Lister Mark II">
<link href="Random-Access-Directory.html#Random-Access-Directory" rel="prev" title="Random Access Directory">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Scanning-Directory-Content"></span><div class="header">
<p>下一篇： <a href="Simple-Directory-Lister-Mark-II.html#Simple-Directory-Lister-Mark-II" rel="next" accesskey="n">简单目录列表器Mark II</a> ，上一篇： <a href="Random-Access-Directory.html#Random-Access-Directory" rel="prev" accesskey="p">随机访问目录</a> ，上一篇： <a href="Accessing-Directories.html#Accessing-Directories" rel="up" accesskey="u">访问目录</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Scanning-the-Content-of-a-Directory"></span><h4 class="subsection">14.2.6扫描目录的内容</h4>

<p>目录处理功能的高级接口是<code>scandir</code>功能。借助它的帮助，您可以选择目录中条目的子集，可以对它们进行排序并获得名称列表。
</p>
<dl>
<dt id="index-scandir">函数： <em>int</em> <strong>scandir</strong> <em>（const char * <var>dir</var> ，结构差异*** <var>namelist</var> ，int（* <var>selector</var> ）（const struct dirent *），int（* <var>cmp</var> ）（const struct dirent **，const struct dirent **））</em></dt>
<dd>

<p>初步： MT安全| AS不安全堆| AC不安全的内存fd |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>


<p>的<code>scandir</code>函数扫描目录选择的内容<var>dir</var> 。*中的结果<var>namelist</var>是指向类型结构的指针的数组<code>struct dirent</code>描述所有选定的目录条目，并使用<code>malloc</code> 。用户提供的功能不是总返回所有目录条目，而是提供<var>selector</var>可用于确定结果中包含哪些条目。仅其条目<var>selector</var>返回一个非零值被选中。
</p>
<p>最后，*中的条目<var>namelist</var>使用用户提供的功能排序<var>cmp</var> 。参数传递给<var>cmp</var>功能是类型<code>struct dirent **</code> ，因此不能直接使用<code>strcmp</code>要么<code>strcoll</code>功能;而是看功能<code>alphasort</code>和<code>versionsort</code>下面。
</p>
<p>函数的返回值是放置在*中的条目数<var>namelist</var> 。如果是<code>-1</code>发生错误（无法打开目录进行读取或malloc调用失败）和全局变量<code>errno</code>包含有关错误的更多信息。
</p></dd></dl>

<p>如上所述，第四个参数<code>scandir</code>函数必须是排序函数的指针。为了方便程序员，GNU C库包含函数的实现，这些实现对于此目的非常有帮助。
</p>
<dl>
<dt id="index-alphasort">函数： <em>int</em> <strong>alphasort</strong> <em>（const struct dirent ** <var>a</var> ，const struct dirent ** <var>b</var> ）</em></dt>
<dd>

<p>初步： MT安全区域| AS不安全堆| AC不安全的内存|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>alphasort</code>函数的行为类似于<code>strcoll</code>函数（请参见<a href="String_002fArray-Comparison.html#String_002fArray-Comparison">字符串/数组比较</a> ）。区别在于参数不是字符串指针，而是类型<code>struct dirent **</code> 。
</p>
<p>的返回值<code>alphasort</code>小于，等于或大于零，具体取决于两个条目的顺序<var>a</var>和<var>b</var> 。
</p></dd></dl>

<dl>
<dt id="index-versionsort">函数： <em>int</em> <strong>版本</strong> <em>排序（const struct dirent ** <var>a</var> ，const struct dirent ** <var>b</var> ）</em></dt>
<dd>
<p>初步： MT安全区域| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>versionsort</code>功能就像<code>alphasort</code>除了它使用<code>strverscmp</code>内部功能。
</p></dd></dl>

<p>如果文件系统支持大文件，则无法使用<code>scandir</code>自从<code>dirent</code>结构可能无法包含所有信息。LFS提供了新的类型<code>struct dirent64</code> <!-- /@w --> 。要使用此功能，我们需要一个新功能。
</p>
<dl>
<dt id="index-scandir64">功能： <em>int</em> <strong>scandir64</strong> <em>（const char * <var>dir</var> ，struct dirent64 *** <var>namelist</var> ，int（* <var>selector</var> ）（const struct dirent64 *），int（* <var>cmp</var> ）（const struct dirent64 **，const struct dirent64 **））</em></dt>
<dd>
<p>初步： MT安全| AS不安全堆| AC不安全的内存fd |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>scandir64</code>功能像<code>scandir</code>函数，除了它返回的目录条目由类型的元素描述<code>struct dirent64</code> <!-- /@w --> 。所指向的功能<var>selector</var>再次用于选择所需的条目，除了<var>selector</var>现在必须指向一个需要<code>struct dirent64 *</code> <!-- /@w -->参数。
</p>
<p>同样<var>cmp</var>函数应该期望其两个参数为类型<code>struct dirent64 **</code> 。
</p></dd></dl>

<p>如<var>cmp</var>现在是不同类型的函数<code>alphasort</code>和<code>versionsort</code>无法提供该参数。相反，我们在下面提供了两个替换功能。
</p>
<dl>
<dt id="index-alphasort64">功能： <em>int</em> <strong>alphasort64</strong> <em>（const struct dirent64 ** <var>a</var> ，const struct dirent ** <var>b</var> ）</em></dt>
<dd>
<p>初步： MT安全区域| AS不安全堆| AC不安全的内存|请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>alphasort64</code>函数的行为类似于<code>strcoll</code>函数（请参见<a href="String_002fArray-Comparison.html#String_002fArray-Comparison">字符串/数组比较</a> ）。区别在于参数不是字符串指针，而是类型<code>struct dirent64 **</code> 。
</p>
<p>返回值<code>alphasort64</code>小于，等于或大于零，具体取决于两个条目的顺序<var>a</var>和<var>b</var> 。
</p></dd></dl>

<dl>
<dt id="index-versionsort64">函数： <em>int</em> <strong>versionsort64</strong> <em>（const struct dirent64 ** <var>a</var> ，const struct dirent64 ** <var>b</var> ）</em></dt>
<dd>
<p>初步： MT安全区域| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>versionsort64</code>功能就像<code>alphasort64</code> ，除了它使用<code>strverscmp</code>内部功能。
</p></dd></dl>

<p>重要的是不要混合使用<code>scandir</code>以及64位比较功能，反之亦然。在某些系统上可以执行此操作，但是在其他系统上则会失败。
</p>
<hr>
<div class="header">
<p>下一篇： <a href="Simple-Directory-Lister-Mark-II.html#Simple-Directory-Lister-Mark-II" rel="next" accesskey="n">简单目录列表器Mark II</a> ，上一篇： <a href="Random-Access-Directory.html#Random-Access-Directory" rel="prev" accesskey="p">随机访问目录</a> ，上一篇： <a href="Accessing-Directories.html#Accessing-Directories" rel="up" accesskey="u">访问目录</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>