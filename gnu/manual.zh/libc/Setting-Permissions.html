<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>设置权限（GNU C库）</title>

<meta name="description" content="Setting Permissions (The GNU C Library)">
<meta name="keywords" content="Setting Permissions (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="File-Attributes.html#File-Attributes" rel="up" title="File Attributes">
<link href="Testing-File-Access.html#Testing-File-Access" rel="next" title="Testing File Access">
<link href="Access-Permission.html#Access-Permission" rel="prev" title="Access Permission">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Setting-Permissions"></span><div class="header">
<p>下一篇： <a href="Testing-File-Access.html#Testing-File-Access" rel="next" accesskey="n">测试文件访问</a> ，上一篇： <a href="Access-Permission.html#Access-Permission" rel="prev" accesskey="p">访问权限</a> ，上一篇： <a href="File-Attributes.html#File-Attributes" rel="up" accesskey="u">文件属性</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Assigning-File-Permissions"></span><h4 class="subsection">14.9.7分配文件权限</h4>

<span id="index-file-creation-mask"></span>
<span id="index-umask"></span>
<p>用于创建文件的原始函数（例如， <code>open</code>要么<code>mkdir</code> ） <var>mode</var>参数，该参数指定授予新创建文件的文件权限。在使用此模式之前，将通过该进程的<em>文件创建mask</em>或<em>umask</em>对其进行修改。
</p>
<p>在文件创建掩码中设置的位标识始终为新创建的文件禁用的权限。例如，如果您在掩码中设置了所有“其他”访问位，则即使“其他”类别中的进程也根本无法访问新创建的文件。 <var>mode</var>传递给create函数的参数将允许这种访问。换句话说，文件创建掩码是您要授予的普通访问权限的补充。
</p>
<p>创建文件的程序通常会指定一个<var>mode</var>包含对特定文件有意义的所有权限的参数。对于普通文件，通常是所有类用户的读写权限。然后，按照个人用户自己的文件创建掩码的指定，限制这些权限。
</p>
<span id="index-chmod"></span>
<p>要更改给定名称的现有文件的权限，请调用<code>chmod</code> 。此函数使用指定的权限位，并忽略文件创建掩码。
</p>
<span id="index-umask-2"></span>
<p>在正常使用中，文件创建掩码由用户的登录shell初始化（使用<code>umask</code> shell命令），并由所有子进程继承。应用程序通常不需要担心文件创建掩码。它会自动执行应做的事情。
</p>
<p>当您的程序需要创建文件并绕过umask的访问权限时，最简单的方法是使用<code>fchmod</code>打开文件后，而不是更改umask。实际上，更改umask通常仅由shell完成。他们使用<code>umask</code>功能。
</p>
<p>本节中的函数在中声明<samp>sys/stat.h</samp> 。
<span id="index-sys_002fstat_002eh-5"></span>
</p>
<dl>
<dt id="index-umask-1">功能： <em>mode_t</em> <strong>umask</strong> <em>（mode_t <var>mask</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>umask</code>函数将当前进程的文件创建掩码设置为<var>mask</var> ，并返回文件创建掩码的前一个值。
</p>
<p>这是一个示例，显示如何使用<code>umask</code>无需永久更改：</p>
<div class="example">
<pre class="example">mode_t
read_umask (void)
{
  mode_t mask = umask (0);
  umask (mask);
  return mask;
}
</pre></div>

<p>但是，在GNU / Hurd系统上最好使用<code>getumask</code>如果您只想读取掩码值，因为它是可重入的。
</p></dd></dl>

<dl>
<dt id="index-getumask">函数： <em>mode_t</em> <strong>getumask</strong> <em>（无效）</em></dt>
<dd>
<p>初步： MT安全| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>返回当前进程的文件创建掩码的当前值。此功能是GNU扩展，仅在GNU / Hurd系统上可用。
</p></dd></dl>

<dl>
<dt id="index-chmod-1">功能： <em>int</em> <strong>chmod</strong> <em>（const char * <var>filename</var> ，mode_t <var>mode</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>chmod</code>函数设置名称为的文件的访问权限位<var>filename</var>至<var>mode</var> 。
</p>
<p>如果<var>filename</var>是一个符号链接， <code>chmod</code>更改链接指向的文件的权限，而不更改链接本身的权限。
</p>
<p>该函数返回<code>0</code>如果成功，并且<code>-1</code>如果不。除了常见的文件名错误（请参阅<a href="File-Name-Errors.html#File-Name-Errors">文件名错误</a> ）之外，以下内容<code>errno</code>为此功能定义了错误条件：</p>
<dl compact>
<dt><code>ENOENT</code></dt>
<dd><p>命名文件不存在。
</p>
</dd>
<dt><code>EPERM</code></dt>
<dd><p>此过程无权更改此文件的访问权限。只有文件的所有者（由进程的有效用户ID判断）或特权用户才能更改它们。
</p>
</dd>
<dt><code>EROFS</code></dt>
<dd><p>该文件位于只读文件系统上。
</p>
</dd>
<dt><code>EFTYPE</code></dt>
<dd><p><var>mode</var>有<code>S_ISVTX</code>位（“粘性位”）设置，并且命名文件不是目录。有些系统不允许在非目录文件上设置粘性位，有些则允许（只有其中一些为非目录文件的粘性位设置了有用的含义）。
</p>
<p>你只会得到<code>EFTYPE</code>在粘滞位对非目录文件没有任何意义的系统上，因此清除输入中的位始终是安全的<var>mode</var>并打电话<code>chmod</code>再次。有关粘性位的完整详细信息，请参见<a href="Permission-Bits.html#Permission-Bits">权限</a>位。
</p></dd>
</dl>
</dd></dl>

<dl>
<dt id="index-fchmod">函数： <em>int</em> <strong>fchmod</strong> <em>（int <var>filedes</var> ，mode_t <var>mode</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>就像<code>chmod</code> ，不同之处在于它会更改由赋予的当前打开文件的权限<var>filedes</var> 。
</p>
<p>的返回值<code>fchmod</code>是<code>0</code>成功与<code>-1</code>失败。下列<code>errno</code>为此功能定义了错误代码：</p>
<dl compact>
<dt><code>EBADF</code></dt>
<dd><p>的<var>filedes</var>参数不是有效的文件描述符。
</p>
</dd>
<dt><code>EINVAL</code></dt>
<dd><p>的<var>filedes</var>参数对应于管道或套接字，或其他实际上没有访问权限的东西。
</p>
</dd>
<dt><code>EPERM</code></dt>
<dd><p>此过程无权更改此文件的访问权限。只有文件的所有者（由进程的有效用户ID判断）或特权用户才能更改它们。
</p>
</dd>
<dt><code>EROFS</code></dt>
<dd><p>该文件位于只读文件系统上。
</p></dd>
</dl>
</dd></dl>

<hr>
<div class="header">
<p>下一篇： <a href="Testing-File-Access.html#Testing-File-Access" rel="next" accesskey="n">测试文件访问</a> ，上一篇： <a href="Access-Permission.html#Access-Permission" rel="prev" accesskey="p">访问权限</a> ，上一篇： <a href="File-Attributes.html#File-Attributes" rel="up" accesskey="u">文件属性</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>