<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Mount-Unmount-Remount（GNU C库）</title>

<meta name="description" content="Mount-Unmount-Remount (The GNU C Library)">
<meta name="keywords" content="Mount-Unmount-Remount (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Filesystem-Handling.html#Filesystem-Handling" rel="up" title="Filesystem Handling">
<link href="System-Parameters.html#System-Parameters" rel="next" title="System Parameters">
<link href="Other-Mount-Information.html#Other-Mount-Information" rel="prev" title="Other Mount Information">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Mount_002dUnmount_002dRemount"></span><div class="header">
<p>上一页： <a href="Mount-Information.html#Mount-Information" rel="prev" accesskey="p">挂载信息</a> ，上一页： <a href="Filesystem-Handling.html#Filesystem-Handling" rel="up" accesskey="u">文件系统处理</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Mount_002c-Unmount_002c-Remount"></span><h4 class="subsection">31.3.2安装，卸载，重新安装</h4>

<p>本节描述了挂载，卸载和重新挂载文件系统的功能。
</p>
<p>只有超级用户可以装载，卸载或重新装载文件系统。
</p>
<p>这些功能无法访问<samp>fstab</samp>和<samp>mtab</samp>文件。您应该分别维护和使用它们。请参阅<a href="Mount-Information.html#Mount-Information">安装信息</a> 。
</p>
<p>本节中的符号在<samp>sys/mount.h</samp> 。
</p>
<dl>
<dt id="index-mount">功能： <em>int</em> <strong>mount</strong> <em>（const char * <var>special_file</var> ，const char * <var>dir</var> ，const char * <var>fstype</var> ，unsigned long int <var>options</var> ，const void * <var>data</var> ）</em></dt>
<dd>

<p>初步： MT安全| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>


<p><code>mount</code>挂载或重新挂载文件系统。这两个操作是完全不同的，并且很自然地合并到该功能中。的<code>MS_REMOUNT</code>选项，如下所述，确定是否<code>mount</code>安装或重新安装。
</p>
<p>对于挂载，块设备上的文件系统由名为的设备专用文件表示<var>special_file</var>被安装在安装点上<var>dir</var> 。这意味着目录<var>dir</var> （以及其中的所有文件）不再可见；取代它的位置（并仍然带有名称<var>dir</var> ）是设备上文件系统的根目录。
</p>
<p>作为例外，如果文件系统类型（参见下文）不是基于设备的类型（例如“ proc”）， <code>mount</code>实例化文件系统并将其挂载<var>dir</var>并忽略<var>special_file</var> 。
</p>
<p>要重新安装， <var>dir</var>指定要挂载（并保持）要重新挂载的文件系统的挂载点， <var>special_file</var>被忽略。重新挂载文件系统意味着更改在挂载文件系统时控制文件系统操作的选项。这并不意味着要重新安装。
</p>
<p>对于挂载，您必须使用以下命令标识文件系统的类型<var>fstype</var> 。此类型告诉内核如何访问文件系统，可以将其视为文件系统驱动程序的名称。可接受的值取决于系统。在具有Linux内核和<code>proc</code>文件系统，可能值的列表在文件中<samp>filesystems</samp>在里面<code>proc</code>文件系统（例如类型<kbd>cat /proc/filesystems</kbd>以查看列表）。在Linux内核中，文件系统的类型<code>mount</code>可以挂载的文件及其类型名称取决于将哪些文件系统驱动程序配置到内核中或作为可加载内核模块加载。一个常见值的示例<var>fstype</var>是<code>ext2</code> 。
</p>
<p>要重新安装， <code>mount</code>忽略<var>fstype</var> 。
</p>
<p><var>options</var>指定在卸载或重新挂载文件系统之前适用的各种选项。选项的确切含义取决于文件系统，并且对于某些文件系统，选项可能根本无效。此外，对于某些文件系统，其中一些选项（但从不<code>MS_RDONLY</code> ）可以通过来覆盖单个文件的访问权限<code>ioctl</code> 。
</p>
<p><var>options</var>是具有使用以下掩码和掩码值宏定义的位字段的位字符串：</p>
<dl compact>
<dt><code>MS_MGC_MASK</code>
<span id="index-MS_005fMGC_005fMASK"></span>
</dt>
<dd><p>此多位字段包含一个幻数。如果没有值<code>MS_MGC_VAL</code> ， <code>mount</code>假设以下所有位均为零，并且<var>data</var>参数是一个空字符串，无论其实际值如何。
</p>
</dd>
<dt><code>MS_REMOUNT</code>
<span id="index-MS_005fREMOUNT"></span>
</dt>
<dd><p>该位亮表示要重新安装文件系统。关表示安装它。
</p>
</dd>
<dt><code>MS_RDONLY</code>
<span id="index-MS_005fRDONLY"></span>
</dt>
<dd><p>该位指定在安装文件系统时不允许对其进行任何写操作。这不能被覆盖<code>ioctl</code> 。几乎所有文件系统都提供此选项。
</p>
</dd>
<dt><code>MS_NOSUID</code>
<span id="index-MS_005fNOSUID"></span>
</dt>
<dd><p>该位指定在挂载文件系统时，应忽略文件系统中文件的Setuid和Setgid权限。
</p>
</dd>
<dt><code>MS_NOEXEC</code>
<span id="index-MS_005fNOEXEC"></span>
</dt>
<dd><p>该位打开表示在挂载文件系统时，不应执行文件系统中的任何文件。
</p>
</dd>
<dt><code>MS_NODEV</code>
<span id="index-MS_005fNODEV"></span>
</dt>
<dd><p>该位打开指定在挂载文件系统时，文件系统中的任何设备专用文件均不可访问。
</p>
</dd>
<dt><code>MS_SYNCHRONOUS</code>
<span id="index-MS_005fSYNCHRONOUS"></span>
</dt>
<dd><p>该位置on指示在挂载文件系统时对文件系统的所有写入均应是同步的；即，数据应在每次写入完成之前同步，而不是保存在缓冲区高速缓存中。
</p>
</dd>
<dt><code>MS_MANDLOCK</code>
<span id="index-MS_005fMANDLOCK"></span>
</dt>
<dd><p>该位置on指定在挂载文件系统时应允许对文件进行强制性锁定。
</p>
</dd>
<dt><code>MS_NOATIME</code>
<span id="index-MS_005fNOATIME"></span>
</dt>
<dd><p>此位打开指定在挂载文件系统时访问文件时，文件的访问时间不应更新。
</p>
</dd>
<dt><code>MS_NODIRATIME</code>
<span id="index-MS_005fNODIRATIME"></span>
</dt>
<dd><p>该位指定在挂载文件系统时访问目录时，目录的访问时间不应更新。
</p>

</dd>
</dl>

<p>上述掩码未涵盖的任何位均应置位；否则，结果不确定。
</p>
<p>的含义<var>data</var>取决于文件系统类型，并且完全由内核中的文件系统驱动程序控制。
</p>
<p>例：</p>
<div class="example">
<pre class="example">#include &lt;sys/mount.h&gt;

mount(&quot;/dev/hdb&quot;, &quot;/cdrom&quot;, MS_MGC_VAL | MS_RDONLY | MS_NOSUID, &quot;&quot;);

mount(&quot;/dev/hda2&quot;, &quot;/mnt&quot;, MS_MGC_VAL | MS_REMOUNT, &quot;&quot;);

</pre></div>

<p>适当的论据<code>mount</code>通常记录在<samp>fstab</samp>表。请参阅<a href="Mount-Information.html#Mount-Information">安装信息</a> 。
</p>
<p>如果安装或重新安装成功，则返回值为零。不然是<code>-1</code>和<code>errno</code>设置适当。的值<code>errno</code>依赖于文件系统，但以下是常规列表：</p>
<dl compact>
<dt><code>EPERM</code></dt>
<dd><p>该进程不是超级用户。
</p></dd>
<dt><code>ENODEV</code></dt>
<dd><p>文件系统类型<var>fstype</var>内核不知道。
</p></dd>
<dt><code>ENOTBLK</code></dt>
<dd><p>文件<var>dev</var>不是块设备专用文件。
</p></dd>
<dt><code>EBUSY</code></dt>
<dd>
<ul>
<li>设备已安装。

</li><li>挂载点很忙。（例如，它是某个进程的工作目录，或者已经安装了文件系统）。

</li><li>请求是重新挂载为只读，但是有一些文件可以写入。
</li></ul>

</dd>
<dt><code>EINVAL</code></dt>
<dd><ul>
<li>尝试重新安装，但是没有在指定的安装点上安装任何文件系统。

</li><li>假定的文件系统具有无效的超级块。

</li></ul>

</dd>
<dt><code>EACCES</code></dt>
<dd><ul>
<li>文件系统本质上是只读的（可能是由于设备上的开关所致），并且尝试以读写方式挂载该文件系统的过程（通过设置<code>MS_RDONLY</code>位关闭）。

</li><li> <var>special_file</var>要么<var>dir</var>由于文件权限而无法访问。

</li><li> <var>special_file</var>无法访问，因为它位于随<code>MS_NODEV</code>选项。

</li></ul>

</dd>
<dt><code>EM_FILE</code></dt>
<dd><p>虚拟设备表已满。 <code>mount</code>如果要挂载的文件系统不是使用某个设备的文件系统，则需要创建一个虚拟设备（也称为“未命名”设备）。
</p>
</dd>
</dl>

</dd></dl>


<dl>
<dt id="index-umount2">函数： <em>int</em> <strong>umount2</strong> <em>（const char * <var>file</var> ，int <var>flags</var> ）</em></dt>
<dd>
<p>初步： MT安全| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>


<p><code>umount2</code>卸载文件系统。
</p>
<p>您可以通过包含文件系统的设备专用文件或安装点来标识要卸载的文件系统。效果是一样的。指定其中一个作为字符串<var>file</var> 。
</p>
<p><var>flags</var>包含由以下掩码宏标识的一位字段：</p>
<dl compact>
<dt><code>MNT_FORCE</code>
<span id="index-MNT_005fFORCE"></span>
</dt>
<dd><p>该位打开的意思是即使文件系统很忙也要强制卸载，方法是先使文件系统不忙。如果该位关闭并且文件系统正忙， <code>umount2</code>失败于<code>errno</code> = <code>EBUSY</code> 。根据文件系统的不同，这可能会覆盖全部，部分繁忙条件或没有繁忙状态。
</p>
</dd>
</dl>

<p>中的所有其他位<var>flags</var>应该设置为零；否则，结果不确定。
</p>
<p>例：</p>
<div class="example">
<pre class="example">#include &lt;sys/mount.h&gt;

umount2(&quot;/mnt&quot;, MNT_FORCE);

umount2(&quot;/dev/hdd1&quot;, 0);

</pre></div>

<p>卸载文件系统后，将看到挂载点所在的目录以及其中的所有文件。
</p>
<p>作为卸载的一部分， <code>umount2</code>同步文件系统。
</p>
<p>如果卸载成功，则返回值为零。不然是<code>-1</code>和<code>errno</code>设置如下：</p>
<dl compact>
<dt><code>EPERM</code></dt>
<dd><p>该进程不是超级用户。
</p></dd>
<dt><code>EBUSY</code></dt>
<dd><p>由于繁忙，无法卸载文件系统。例如，它包含一个目录，该目录是某个进程的工作目录或某个进程已打开的文件。在某些情况下，使用某些文件系统，可以避免这种故障。 <code>MNT_FORCE</code>选项。
</p>
</dd>
<dt><code>EINVAL</code></dt>
<dd><p><var>file</var>有效地引用文件，但该文件既不是当前安装的文件系统的安装点，也不是设备专用文件。
</p>
</dd>
</dl>

<p>此功能并非在所有系统上都可用。
</p></dd></dl>

<dl>
<dt id="index-umount">功能： <em>int</em> <strong>umount</strong> <em>（const char * <var>file</var> ）</em></dt>
<dd>

<p>初步： MT安全| AS安全交流安全请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>


<p><code>umount</code>做与<code>umount2</code>与<var>flags</var>设置为零。它比<code>umount2</code>但由于它无法强制卸载文件系统，因此在以下情况下不建议使用<code>umount2</code>也可以。
</p></dd></dl>



<hr>
<div class="header">
<p>上一页： <a href="Mount-Information.html#Mount-Information" rel="prev" accesskey="p">挂载信息</a> ，上一页： <a href="Filesystem-Handling.html#Filesystem-Handling" rel="up" accesskey="u">文件系统处理</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>