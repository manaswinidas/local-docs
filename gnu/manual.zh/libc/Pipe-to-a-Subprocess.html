<html ><!-- This file documents the GNU C Library.

This is
The GNU C Library Reference Manual, for version
2.30.

Copyright (C) 1993-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version
1.3 or any later version published by the Free
Software Foundation; with the Invariant Sections being "Free Software
Needs Free Documentation" and "GNU Lesser General Public License",
the Front-Cover texts being "A GNU Manual", and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the
section entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." --><!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>管道到子流程（GNU C库）</title>

<meta name="description" content="Pipe to a Subprocess (The GNU C Library)">
<meta name="keywords" content="Pipe to a Subprocess (The GNU C Library)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Concept-Index.html#Concept-Index" rel="index" title="Concept Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Pipes-and-FIFOs.html#Pipes-and-FIFOs" rel="up" title="Pipes and FIFOs">
<link href="FIFO-Special-Files.html#FIFO-Special-Files" rel="next" title="FIFO Special Files">
<link href="Creating-a-Pipe.html#Creating-a-Pipe" rel="prev" title="Creating a Pipe">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="zh-Hans" >
<span id="Pipe-to-a-Subprocess"></span><div class="header">
<p>下一篇： <a href="FIFO-Special-Files.html#FIFO-Special-Files" rel="next" accesskey="n">FIFO特殊文件</a> ，上一篇： <a href="Creating-a-Pipe.html#Creating-a-Pipe" rel="prev" accesskey="p">创建管道</a> ，上<a href="Creating-a-Pipe.html#Creating-a-Pipe" rel="prev" accesskey="p">一篇</a> ： <a href="Pipes-and-FIFOs.html#Pipes-and-FIFOs" rel="up" accesskey="u">管道和FIFO</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<span id="Pipe-to-a-Subprocess-1"></span><h3 class="section">15.2管道到子流程</h3>
<span id="index-creating-a-pipe-to-a-subprocess"></span>
<span id="index-pipe-to-a-subprocess"></span>
<span id="index-filtering-i_002fo-through-subprocess"></span>

<p>管道的常见用法是向作为子进程运行的程序发送数据或从中接收数据。一种方法是结合使用<code>pipe</code> （创建管道）， <code>fork</code> （以创建子流程）， <code>dup2</code> （强制子流程将管道用作其标准输入或输出通道），以及<code>exec</code> （执行新程序）。或者，您可以使用<code>popen</code>和<code>pclose</code> 。
</p>
<p>使用的优势<code>popen</code>和<code>pclose</code>界面更简单易用。但是它没有提供直接使用低级功能那样的灵活性。
</p>
<dl>
<dt id="index-popen">功能： <em>FILE *</em> <strong>popen</strong> <em>（const char * <var>command</var> ，const char * <var>mode</var> ）</em></dt>
<dd>


<p>初步： MT安全| AS不安全堆损坏| AC不安全损坏的锁fd mem |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>popen</code>功能与<code>system</code>功能;请参阅<a href="Running-a-Command.html#Running-a-Command">运行命令</a> 。它执行shell命令<var>command</var>作为子过程。但是，与其等待命令完成，不如创建到子进程的管道并返回与该管道相对应的流。
</p>
<p>如果您指定一个<var>mode</var>的论点<code>"r"</code> ，您可以从流中读取以从子流程的标准输出通道检索数据。子流程从父流程继承其标准输入通道。
</p>
<p>同样，如果您指定一个<var>mode</var>的论点<code>"w"</code> ，您可以写入流以将数据发送到子流程的标准输入通道。子流程从父流程继承其标准输出通道。
</p>
<p>发生错误时<code>popen</code>返回一个空指针。如果无法创建管道或流，无法分叉子流程或无法执行程序，则可能会发生这种情况。
</p></dd></dl>

<dl>
<dt id="index-pclose">功能： <em>int</em> <strong>pclose</strong> <em>（FILE * <var>stream</var> ）</em></dt>
<dd>


<p>初步： MT安全| AS不安全堆插件损坏锁| AC不安全损坏的锁fd mem |请参阅<a href="POSIX-Safety-Concepts.html#POSIX-Safety-Concepts">POSIX安全概念</a> 。
</p>

<p>的<code>pclose</code>函数用于关闭由创建的流<code>popen</code> 。它等待子进程终止并返回其状态值，就像<code>system</code>功能。
</p></dd></dl>

<p>这是显示如何使用的示例<code>popen</code>和<code>pclose</code>通过另一个程序过滤输出，在本例中为分页程序<code>more</code> 。
</p>
<div class="example">
<pre class="example">

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

void
write_data (FILE * stream)
{
  int i;
  for (i = 0; i &lt; 100; i++)
    fprintf (stream, &quot;%d\n&quot;, i);
  if (ferror (stream))
    {
      fprintf (stderr, &quot;Output to stream failed.\n&quot;);
      exit (EXIT_FAILURE);
    }
}

</pre><pre class="example">int
main (void)
{
  FILE *output;

  output = popen (&quot;more&quot;, &quot;w&quot;);
  if (!output)
    {
      fprintf (stderr,
               &quot;incorrect parameters or too many files.\n&quot;);
      return EXIT_FAILURE;
    }
  write_data (output);
  if (pclose (output) != 0)
    {
      fprintf (stderr,
               &quot;Could not run more or other error.\n&quot;);
    }
  return EXIT_SUCCESS;
}
</pre></div>

<hr>
<div class="header">
<p>下一篇： <a href="FIFO-Special-Files.html#FIFO-Special-Files" rel="next" accesskey="n">FIFO特殊文件</a> ，上一篇： <a href="Creating-a-Pipe.html#Creating-a-Pipe" rel="prev" accesskey="p">创建管道</a> ，上<a href="Creating-a-Pipe.html#Creating-a-Pipe" rel="prev" accesskey="p">一篇</a> ： <a href="Pipes-and-FIFOs.html#Pipes-and-FIFOs" rel="up" accesskey="u">管道和FIFO</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Concept-Index.html#Concept-Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>