<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>常规数据类型（《 GNU Awk用户指南》）</title>

<meta name="description" content="General Data Types (The GNU Awk User’s Guide)">
<meta name="keywords" content="General Data Types (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Extension-API-Description.html#Extension-API-Description" rel="up" title="Extension API Description">
<link href="Memory-Allocation-Functions.html#Memory-Allocation-Functions" rel="next" title="Memory Allocation Functions">
<link href="Extension-API-Functions-Introduction.html#Extension-API-Functions-Introduction" rel="prev" title="Extension API Functions Introduction">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="manual.css">


</head>

<body lang="zh-Hans" >
<a name="General-Data-Types"></a>
<div class="header">
<p>下一页： <a href="Memory-Allocation-Functions.html#Memory-Allocation-Functions" rel="next" accesskey="n">内存分配功能</a> ，上一页： <a href="Extension-API-Functions-Introduction.html#Extension-API-Functions-Introduction" rel="prev" accesskey="p">扩展API函数简介</a> ，向上： <a href="Extension-API-Description.html#Extension-API-Description" rel="up" accesskey="u">扩展API描述</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="General_002dPurpose-Data-Types"></a>
<h4 class="subsection">17.4.2通用数据类型</h4>

<a name="index-Robbins_002c-Arnold-4"></a>
<a name="index-Ramey_002c-Chet-1"></a>
<blockquote>
<p><i>我与工会有着真正的爱恨交织。</i>
</p></blockquote>
<div align="center">— <em>阿诺德·罗宾斯</em>
</div>
<blockquote>
<p><i>工会就是这样：编译器会安排事情，以便他们可以容纳爱与恨。</i>
</p></blockquote>
<div align="center"><em>切特·拉米</em>
</div>
<p>扩展API定义了许多用于通用的简单类型和结构。在后续各节中将介绍其他更专业的数据结构，以及使用它们的功能。
</p>
<p>通用类型和结构如下：</p>
<dl compact>
<dt><code>typedef void *awk_ext_id_t;</code></dt>
<dd><p>接收到此类型的值<code>gawk</code>加载扩展时。然后必须将该值传递回<code>gawk</code>作为每个API函数的第一个参数。
</p>
</dd>
<dt><code>#define awk_const …</code></dt>
<dd><p>此宏扩展为“ <samp>const</samp> '在编译扩展名时，编译为空<code>gawk</code>本身。这使得API数据结构中的某些字段无法通过扩展代码写入，同时允许<code>gawk</code>根据需要使用它们。
</p>
</dd>
<dt><code>typedef enum awk_bool {</code></dt>
<dt><code>    awk_false = 0,</code></dt>
<dt><code>    awk_true</code></dt>
<dt><code>} awk_bool_t;</code></dt>
<dd><p>一个简单的布尔类型。
</p>
</dd>
<dt><code>typedef struct awk_string {</code></dt>
<dt><code>    char *str;      /* data */</code></dt>
<dt><code>    size_t len;     /* length thereof, in chars */</code></dt>
<dt><code>} awk_string_t;</code></dt>
<dd><p>这表示可变字符串。<code>gawk</code>拥有所提供的值所指向的内存。否则，它将获取指向的内存的所有权。
<em>这样的记忆必须来自调用其中之一<code>gawk_malloc()</code> ， <code>gawk_calloc()</code> ， 要么<code>gawk_realloc()</code>功能！</em>
</p>
<p>如前所述，使用当前的多字节编码来维护字符串。
</p>
</dd>
<dt><code>typedef enum {</code></dt>
<dt><code>    AWK_UNDEFINED,</code></dt>
<dt><code>    AWK_NUMBER,</code></dt>
<dt><code>    AWK_STRING,</code></dt>
<dt><code>    AWK_REGEX,</code></dt>
<dt><code>    AWK_STRNUM,</code></dt>
<dt><code>    AWK_ARRAY,</code></dt>
<dt><code>    AWK_SCALAR,         /* opaque access to a variable */</code></dt>
<dt><code>    AWK_VALUE_COOKIE    /* for updating a previously created value */</code></dt>
<dt><code>} awk_valtype_t;</code></dt>
<dd><p>这个<code>enum</code>指示值的类型。在以下使用<code>struct</code> 。
</p>
</dd>
<dt><code>typedef struct awk_value {</code></dt>
<dt><code>    awk_valtype_t val_type;</code></dt>
<dt><code>    union {</code></dt>
<dt><code>        awk_string_t       s;</code></dt>
<dt><code>        awknum_t           n;</code></dt>
<dt><code>        awk_array_t        a;</code></dt>
<dt><code>        awk_scalar_t       scl;</code></dt>
<dt><code>        awk_value_cookie_t vc;</code></dt>
<dt><code>    } u;</code></dt>
<dt><code>} awk_value_t;</code></dt>
<dd><p>一个“ <code>awk</code>值。”的<code>val_type</code>成员指出了什么样的价值<code>union</code>持有，并且每个成员都是适当的类型。
</p>
</dd>
<dt><code>#define str_value      u.s</code></dt>
<dt><code>#define strnum_value   str_value</code></dt>
<dt><code>#define regex_value    str_value</code></dt>
<dt><code>#define num_value      u.n.d</code></dt>
<dt><code>#define num_type       u.n.type</code></dt>
<dt><code>#define num_ptr        u.n.ptr</code></dt>
<dt><code>#define array_cookie   u.a</code></dt>
<dt><code>#define scalar_cookie  u.scl</code></dt>
<dt><code>#define value_cookie   u.vc</code></dt>
<dd><p>使用这些宏可以访问<code>awk_value_t</code>更具可读性。
</p>
</dd>
<dt><code>enum AWK_NUMBER_TYPE {</code></dt>
<dt><code>    AWK_NUMBER_TYPE_DOUBLE,</code></dt>
<dt><code>    AWK_NUMBER_TYPE_MPFR,</code></dt>
<dt><code>    AWK_NUMBER_TYPE_MPZ</code></dt>
<dt><code>};</code></dt>
<dd><p>这个<code>enum</code>在以下结构中用于定义要使用的数值类型。在文件的顶层声明它，以便它对于C ++和C都能正常工作。</p>
</dd>
<dt><code>typedef struct awk_number {</code></dt>
<dt><code>    double d;</code></dt>
<dt><code>    enum AWK_NUMBER_TYPE type;</code></dt>
<dt><code>    void *ptr;</code></dt>
<dt><code>} awk_number_t;</code></dt>
<dd><p>这代表一个数值。在内部， <code>gawk</code>将每个数字存储为C <code>double</code> ，GMP整数或MPFR任意精度浮点值。为了使扩展也支持GMP和MPFR值，在此结构中传递了数字值。
</p>
<p>双精度<code>d</code>元素总是填充在从<code>gawk</code> 。此外，通过检查<code>type</code>成员，扩展程序可以确定<code>ptr</code>成员是GMP整数（类型<code>mpz_ptr</code> ）或MPFR浮点值（类型<code>mpfr_ptr_t</code> ），并进行适当的投射。
</p>
</dd>
<dt><code>typedef void *awk_scalar_t;</code></dt>
<dd><p>标量可以表示为不透明类型。这些值是从<code>gawk</code>然后传回去在此列表后的文本中以一般方式对此进行了讨论，并在<a href="Symbol-table-by-cookie.html#Symbol-table-by-cookie">Cookie</a>中的“ <a href="Symbol-table-by-cookie.html#Symbol-table-by-cookie">变量访问和更新”</a>中进行了详细介绍。
</p>
</dd>
<dt><code>typedef void *awk_value_cookie_t;</code></dt>
<dd><p>“值cookie”是代表缓存值的不透明类型。此列表后面的文本中也对此进行了一般性的讨论，在<a href="Cached-values.html#Cached-values">创建和使用缓存的值中</a>对此进行了更详细的讨论。
</p>
</dd>
</dl>

<p>标量值<code>awk</code>是数字，字符串，strnum或键入的正则表达式。的<code>awk_value_t</code> struct代表值。的<code>val_type</code>成员指示其中的内容<code>union</code> 。
</p>
<p>表示数字很容易-API使用C <code>double</code> 。字符串需要更多的工作。因为<code>gawk</code>如果允许在字符串值中嵌入<small>NUL</small>字节，则必须将字符串表示为一对，其中包含数据指针和长度。这是<code>awk_string_t</code>类型。
</p>
<p>一个strnum（数字字符串）值表示为一个字符串，由看起来像数字的用户输入数据组成。当扩展创建一个strnum值时，结果是一个标记为用户输入的字符串。随后的解析<code>gawk</code>然后确定它看起来像一个数字，应被视为strnum或常规字符串。
</p>
<p>这在扩展功能想要执行与<code>split()</code>该函数在其创建的数组元素上设置strnum属性。例如，实现CSV拆分的扩展程序可能要使用此功能。这对于从数据库检索数据项的功能也很有用。PostgreSQL的<code>PQgetvalue()</code>例如，函数返回一个字符串，该字符串可以是数字或文本，具体取决于内容。
</p>
<p>类型化的regexp值（请参阅“ <a href="Strong-Regexp-Constants.html#Strong-Regexp-Constants">强类型化的Regexp常数”</a>一节）对扩展功能没有多大用处。扩展函数可以告知已收到它们，并为标量值创建它们。否则，他们可以通过以下方式检查regexp的文本<code>regex_value.str</code>和<code>regex_value.len</code> 。
</p>
<p>标识符（即全局变量的名称）可以与标量值或数组相关联。此外， <code>gawk</code>提供真正的数组数组，其中任何给定的数组元素本身都可以是数组。数组的讨论要等到<a href="Array-Manipulation.html#Array-Manipulation">数组操作之后才进行</a> 。
</p>
<p>前面列出的各种宏可以更轻松地使用<code>union</code>好像它们是一个<code>struct</code> ;这是C语言中的常见编码做法。此类代码更易于编写和阅读，但<em>您有</em>责任确保<code>val_type</code>成员正确反映了值的类型<code>awk_value_t</code>结构。
</p>
<p>从概念上讲， <code>union</code> （数字，字符串和数组）是使用<code>awk</code>价值观。但是，由于API提供了仅通过使用变量名来访问和更改全局标量变量的值的例程，因此会降低性能： <code>gawk</code>每次访问和更改变量时都必须找到该变量。事实证明这是一个实际问题，而不仅仅是理论上的问题。
</p>
<p>因此，如果您知道扩展程序将花费大量时间读取和/或更改一个或多个标量变量的值，则可以获取该变量的<em>标量cookie</em> <a name="DOCF103" href="#FOOT103"><sup>103</sup></a>对象，然后使用该cookie获取该变量的值或更改变量的值。的<code>awk_scalar_t</code>类型包含一个标量cookie，并且<code>scalar_cookie</code>巨集可让您存取<code>awk_value_t</code>结构。给定标量cookie， <code>gawk</code>可以根据需要直接检索或修改值，而无需先查找它。
</p>
<p>的<code>awk_value_cookie_t</code>类型和<code>value_cookie</code>宏是相似的。如果您知道要对一个或多个变量使用相同的数字或字符串<em>值</em> ，则可以创建一次该<em>值</em> ，并为其保留一个<em>值cookie</em> ，然后在希望设置a的值时传入该值cookie。变量。这样可以节省运行中的存储空间<code>gawk</code>处理并减少创造价值所需的时间。
</p>
<div class="footnote">
<hr>
<h4 class="footnotes-heading">脚注</h4>

<h3><a name="FOOT103" href="#DOCF103">（103）</a></h3>
<p>见<a href="http://catb.org/jargon/html/C/cookie.html">在行话文件中的“曲奇”进入</a>了<em>饼干</em>的定义，并<a href="http://catb.org/jargon/html/M/magic-cookie.html">在行话文件中的“魔饼”进入</a>一个不错的例子。另请参见<a href="Glossary.html#Glossary">词汇表中</a> “ Cookie”的条目。
</p>
</div>
<hr>
<div class="header">
<p>下一页： <a href="Memory-Allocation-Functions.html#Memory-Allocation-Functions" rel="next" accesskey="n">内存分配功能</a> ，上一页： <a href="Extension-API-Functions-Introduction.html#Extension-API-Functions-Introduction" rel="prev" accesskey="p">扩展API函数简介</a> ，向上： <a href="Extension-API-Description.html#Extension-API-Description" rel="up" accesskey="u">扩展API描述</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>