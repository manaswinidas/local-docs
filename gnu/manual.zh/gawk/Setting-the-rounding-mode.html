<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>设置舍入模式（《 GNU Awk用户指南》）</title>

<meta name="description" content="Setting the rounding mode (The GNU Awk User’s Guide)">
<meta name="keywords" content="Setting the rounding mode (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="FP-Math-Caution.html#FP-Math-Caution" rel="up" title="FP Math Caution">
<link href="Arbitrary-Precision-Integers.html#Arbitrary-Precision-Integers" rel="next" title="Arbitrary Precision Integers">
<link href="Setting-precision.html#Setting-precision" rel="prev" title="Setting precision">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="/software/gnulib/manual.css">


</head>

<body lang="zh-Hans" >
<a name="Setting-the-rounding-mode"></a>
<div class="header">
<p>上一页： <a href="Setting-precision.html#Setting-precision" rel="prev" accesskey="p">设置精度</a> ，向上： <a href="FP-Math-Caution.html#FP-Math-Caution" rel="up" accesskey="u">FP数学警告</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="Setting-the-Rounding-Mode"></a>
<h4 class="subsection">16.4.5设置舍入模式</h4>

<a name="index-ROUNDMODE-variable-1"></a>
<p>的<code>ROUNDMODE</code>变量提供对舍入模式的程序级控制。之间的对应<code>ROUNDMODE</code> <a href="#table_002dgawk_002drounding_002dmodes">表16.5中</a>显示了IEEE舍入模式。
</p>
<div class="float"><a name="table_002dgawk_002drounding_002dmodes"></a>

<table>
<thead><tr><th width="45%">舍入模式</th><th width="30%">IEEE名称</th><th width="25%"><code>ROUNDMODE</code></th></tr></thead>
<tbody><tr><td width="45%">四舍五入到最接近的关系</td><td width="30%"><code>roundTiesToEven</code></td><td width="25%"><code>"N"</code>要么<code>"n"</code></td></tr>
<tr><td width="45%">向正无穷大舍入</td><td width="30%"><code>roundTowardPositive</code></td><td width="25%"><code>"U"</code>要么<code>"u"</code></td></tr>
<tr><td width="45%">向负无穷大舍入</td><td width="30%"><code>roundTowardNegative</code></td><td width="25%"><code>"D"</code>要么<code>"d"</code></td></tr>
<tr><td width="45%">向零舍入</td><td width="30%"><code>roundTowardZero</code></td><td width="25%"><code>"Z"</code>要么<code>"z"</code></td></tr>
<tr><td width="45%">四舍五入</td><td width="30%"></td><td width="25%"><code>"A"</code>要么<code>"a"</code></td></tr>
</tbody></table>
<div class="float-caption"><p><strong>表16.5：</strong> <code>gawk</code>舍入模式</p></div></div>
<p><code>ROUNDMODE</code>具有默认值<code>"N"</code> ，它选择IEEE 754舍入模式<code>roundTiesToEven</code> 。在<a href="#table_002dgawk_002drounding_002dmodes">表16.5中</a> ，该值<code>"A"</code>选择从零舍入。仅当您的MPFR库版本支持时，此选项才可用。否则，设置<code>ROUNDMODE</code>至<code>"A"</code>没有效果。
</p>
<p>默认模式<code>roundTiesToEven</code>是最理想的选择，但最不直观。该方法通过将值向上或向下舍入为最接近的数字，对于大多数值而言显然是有用的。例如，将1.132舍入到两位数将产生1.13，而将1.157舍入将产生1.16。
</p>
<p>但是，在四舍五入之间取整一个值时，事情并没有像您在学校学到的那样起作用。在这种情况下，数字将四舍五入到最接近的偶数位。因此，将0.125舍入到两位数会四舍五入到0.12，但将0.6875舍入到三位数会舍入到0.688。使用时您可能已经遇到过这种舍入模式<code>printf</code>格式化浮点数。例如：</p>
<div class="example">
<pre class="example">BEGIN {
    x = -4.5
    for (i = 1; i &lt; 10; i++) {
        x += 1.0
        printf(&quot;%4.1f =&gt; %2.0f\n&quot;, x, x)
    }
}
</pre></div>

<p>在作者的系统上运行时，产生以下输出： <a name="DOCF100" href="#FOOT100"><sup>100</sup></a>
</p>
<div class="example">
<pre class="example">-3.5 =&gt; -4
-2.5 =&gt; -2
-1.5 =&gt; -2
-0.5 =&gt; 0
 0.5 =&gt; 0
 1.5 =&gt; 2
 2.5 =&gt; 2
 3.5 =&gt; 4
 4.5 =&gt; 4
</pre></div>

<p>背后的理论<code>roundTiesToEven</code>是它或多或少均匀地分布了精确的一半向上和向下的回合，这可能会导致任何累积的舍入误差抵消自己。这是IEEE 754计算功能和运算符的默认舍入模式。
</p>
<a name="index-sidebar_002c-Rounding-Modes-and-Conversion"></a>

<table class="cartouche" border="1"><tbody><tr><td>
<div align="center"><b>舍入模式和转换</b>
</div>

<p>了解这一点以及<code>CONVFMT</code>和<code>OFMT</code> ，舍入模式会影响数字如何转换为字符串。例如，考虑以下程序：</p>
<div class="example">
<pre class="example">BEGIN {
    pi = 3.1416
    OFMT = &quot;%.f&quot;        # Print value as integer
    print pi            # ROUNDMODE = &quot;N&quot; by default.
    ROUNDMODE = &quot;U&quot;     # Now change ROUNDMODE
    print pi
}
</pre></div>

<p>运行此程序将产生以下输出：</p>
<div class="example">
<pre class="example">$ <kbd>gawk -M -f roundmode.awk</kbd>
-| 3
-| 4
</pre></div>
</td></tr></tbody></table>

<p>其他舍入模式很少使用。四舍五入为正无穷大（ <code>roundTowardPositive</code> ）并向负无穷大（ <code>roundTowardNegative</code> ）通常用于实现间隔算法，在此您可以调整舍入模式以计算输出范围的上限和下限。的<code>roundTowardZero</code> mode可用于将浮点数转换为整数。当从零舍入时，将选择幅度大于或等于该值的最接近的数字。
</p>
<p>一些数字分析人员会告诉您，舍入样式的选择对最终结果有巨大影响，并建议您等待任何舍入的最终输出。取而代之的是，您通常可以通过将精度初始设置为足够大于最终所需精度的某个值来避免舍入误差问题，以使舍入误差的累积不会影响结果。如果您怀疑计算结果对舍入误差的累积敏感，请确保在更改舍入模式时在输出上寻找显着差异。
</p>
<div class="footnote">
<hr>
<h4 class="footnotes-heading">脚注</h4>

<h3><a name="FOOT100" href="#DOCF100">（100）</a></h3>
<p>如果系统中的C库未使用IEEE 754偶数舍入规则来舍入一半情况，则输出可能会完全不同。 <code>printf</code> 。</p>
</div>
<hr>
<div class="header">
<p>上一页： <a href="Setting-precision.html#Setting-precision" rel="prev" accesskey="p">设置精度</a> ，向上： <a href="FP-Math-Caution.html#FP-Math-Caution" rel="up" accesskey="u">FP数学警告</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>