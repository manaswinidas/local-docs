<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>多行（《 GNU Awk用户指南》）</title>

<meta name="description" content="Multiple Line (The GNU Awk User’s Guide)">
<meta name="keywords" content="Multiple Line (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Reading-Files.html#Reading-Files" rel="up" title="Reading Files">
<link href="Getline.html#Getline" rel="next" title="Getline">
<link href="Testing-field-creation.html#Testing-field-creation" rel="prev" title="Testing field creation">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="/software/gnulib/manual.css">


</head>

<body lang="zh-Hans" >
<a name="Multiple-Line"></a>
<div class="header">
<p>下一篇： <a href="Getline.html#Getline" rel="next" accesskey="n">Getline</a> ，上一篇： <a href="Testing-field-creation.html#Testing-field-creation" rel="prev" accesskey="p">测试字段创建</a> ，上一篇： <a href="Reading-Files.html#Reading-Files" rel="up" accesskey="u">阅读文件</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="Multiple_002dLine-Records"></a>
<h3 class="section">4.9多行记录</h3>

<a name="index-multiple_002dline-records"></a>
<a name="index-records_002c-multiline"></a>
<a name="index-input_002c-multiline-records"></a>
<a name="index-files_002c-reading_002c-multiline-records"></a>
<a name="index-input_002c-files_002c-See-input-files"></a>
<p>在某些数据库中，一行不能方便地将所有信息保存在一个条目中。在这种情况下，您可以使用多行记录。这样做的第一步是选择数据格式。
</p>
<a name="index-record-separators_002c-with-multiline-records"></a>
<p>一种技术是使用不寻常的字符或字符串来分隔记录。例如，您可以使用换页符（写为“ <samp>\f</samp>在<code>awk</code> ，如C）中所述，将它们分开，使每个记录都记录文件的一页。为此，只需设置变量<code>RS</code>至<code>"\f"</code> （包含换页符的字符串）。只要不将其作为记录中数据的一部分，其他任何字符都可以使用。
</p>
<a name="index-RS-variable_002c-multiline-records-and"></a>
<p>另一种技术是让空行分开记录。通过特殊的分配，将一个空字符串作为<code>RS</code>表示记录由一个或多个空行分隔。什么时候<code>RS</code>设置为空字符串，每个记录总是在遇到的第一个空白行处结束。下一条记录要等到第一行非空白行之后才开始。不管连续出现多少行，它们都充当一个记录分隔符。（空白行必须完全为空；仅包含空格的行不计算在内。）
</p>
<a name="index-leftmost-longest-match"></a>
<a name="index-matching_002c-leftmost-longest"></a>
<p>您可以达到与“ <samp>RS = ""</samp> '通过分配字符串<code>"\n\n+"</code>至<code>RS</code> 。此正则表达式与记录末尾的换行符和记录后的一个或多个空行匹配。另外，如果有选择，则正则表达式始终匹配最长的序列（请参阅<a href="Leftmost-Longest.html#Leftmost-Longest">“多少文本匹配？”部分</a> ）。因此，下一条记录要等到紧随其后的第一条非空白行之后才开始-不管一行中出现多少空白行，它们都被视为一个记录分隔符。
</p>
<a name="index-dark-corner_002c-multiline-records"></a>
<p>但是，“ <samp>RS = ""</samp> '和' <samp>RS = "\n\n+"</samp> '。在第一种情况下，将忽略输入数据文件中的前导换行符，并且如果文件结束于最后一条记录之后而没有多余的空行，则将从记录中删除最后一条换行符。在第二种情况下，不执行此特殊处理。（直流）
</p>
<a name="index-field-separator_002c-in-multiline-records"></a>
<a name="index-FS_002c-in-multiline-records"></a>
<p>现在将输入分为记录，第二步是分离记录中的字段。一种方法是按常规方式将每行划分为多个字段。由于特殊功能，默认情况下会发生这种情况。什么时候<code>RS</code>设置为空字符串， <em>然后</em> <code>FS</code>设置为单个字符，换行符<em>始终</em>充当字段分隔符。这是除由于<code>FS</code> 。
</p>
<blockquote>
<p><b>注意：</b>何时<code>FS</code>是空字符串（ <code>""</code> ）或regexp，这是该功能的<code>RS</code>不适用。它确实适用于单个空格的默认字段分隔符：' <samp>FS = " "
<!-- /@w --></samp> '。
</p>
<p>请注意，POSIX规范中的语言意味着该特殊功能应在以下情况下适用： <code>FS</code>是一个正则表达式。但是，Unix <code>awk</code>从来没有那样，也没有<code>gawk</code> 。这本质上是POSIX中的错误。</p></blockquote>

<p>这种特殊例外的原始动机可能是在默认情况下提供有用的行为（即， <code>FS</code>等于<code>" "</code> <!-- /@w --> ）。如果您确实不希望换行符分隔字段，则此功能可能会成为问题，因为无法阻止它。不过，您可以使用<code>split()</code>函数手动分解记录（请参见“ <a href="String-Functions.html#String-Functions">字符串操作函数”</a>一节）。如果您使用单字符字段分隔符，则可以通过以下方式以另一种方式解决特殊功能： <code>FS</code>换成该单个字符的正则表达式。例如，如果字段分隔符是百分比字符，而不是' <samp>FS = "%"</samp> '， 使用 ' <samp>FS = "[%]"</samp> '。
</p>
<p>分隔字段的另一种方法是将每个字段放在单独的行上：为此，只需设置变量<code>FS</code>到字符串<code>"\n"</code> 。（此单字符分隔符与单个换行符匹配。）以这种方式组织的数据文件的一个实际示例可能是邮件列表，其中的行之间用空行分隔。考虑一个名为的文件中的邮件列表<samp>addresses</samp> ，如下所示：</p>
<div class="example">
<pre class="example">Jane Doe
123 Main Street
Anywhere, SE 12345-6789

John Smith
456 Tree-lined Avenue
Smallville, MW 98765-4321
&hellip;
</pre></div>

<p>一个简单的程序来处理此文件，如下所示：</p>
<div class="example">
<pre class="example"># addrs.awk --- simple mailing list program

# Records are separated by blank lines.
# Each line is one field.
BEGIN { RS = &quot;&quot; ; FS = &quot;\n&quot; }

{
      print &quot;Name is:&quot;, $1
      print &quot;Address is:&quot;, $2
      print &quot;City and State are:&quot;, $3
      print &quot;&quot;
}
</pre></div>

<p>运行程序将产生以下输出：</p>
<div class="example">
<pre class="example">$ <kbd>awk -f addrs.awk addresses</kbd>
-| Name is: Jane Doe
-| Address is: 123 Main Street
-| City and State are: Anywhere, SE 12345-6789
-|
-| Name is: John Smith
-| Address is: 456 Tree-lined Avenue
-| City and State are: Smallville, MW 98765-4321
-|
&hellip;
</pre></div>

<p>有关处理地址列表的更实际的程序，请参见“ <a href="Labels-Program.html#Labels-Program">打印邮件标签</a> ”一节。以下列表根据记录的值总结了如何拆分记录<code>RS</code> ：</p>
<dl compact>
<dt><code>RS == "\n"</code></dt>
<dd><p>记录由换行符（' <samp>\n</samp> '）。实际上，数据文件中的每一行都是单独的记录，包括空行。这是默认值。
</p>
</dd>
<dt><code>RS == <var>any single character</var></code></dt>
<dd><p>记录按每次出现的字符分开。多个连续出现界定了空记录。
</p>
</dd>
<dt><code>RS == ""</code></dt>
<dd><p>记录由空白行分隔。什么时候<code>FS</code>是单个字符，那么换行符除了用作其他值外，还始终用作字段分隔符<code>FS</code>可能有。文件中的前导和尾随换行符将被忽略。
</p>
</dd>
<dt><code>RS == <var>regexp</var></code></dt>
<dd><p>记录按出现的匹配字符分开<var>regexp</var> 。的领先和落后比赛<var>regexp</var>分隔空记录。（这是一个<code>gawk</code>延期; POSIX标准未指定。）
</p></dd>
</dl>

<a name="index-gawk_002c-RT-variable-in-2"></a>
<a name="index-RT-variable-2"></a>
<a name="index-differences-in-awk-and-gawk_002c-RS_002fRT-variables-2"></a>
<p>如果不在兼容模式下（请参阅“ <a href="Options.html#Options">命令行选项”</a>一节）， <code>gawk</code>套<code>RT</code>到与指定的值匹配的输入文本<code>RS</code> 。但是如果输入文件结尾没有匹配的文本<code>RS</code> ， 然后<code>gawk</code>套<code>RT</code>为空字符串。
</p>
<hr>
<div class="header">
<p>下一篇： <a href="Getline.html#Getline" rel="next" accesskey="n">Getline</a> ，上一篇： <a href="Testing-field-creation.html#Testing-field-creation" rel="prev" accesskey="p">测试字段创建</a> ，上一篇： <a href="Reading-Files.html#Reading-Files" rel="up" accesskey="u">阅读文件</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>