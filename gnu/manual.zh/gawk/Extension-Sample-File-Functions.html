<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>扩展样本文件功能（《 GNU Awk用户指南》）</title>

<meta name="description" content="Extension Sample File Functions (The GNU Awk User’s Guide)">
<meta name="keywords" content="Extension Sample File Functions (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Extension-Samples.html#Extension-Samples" rel="up" title="Extension Samples">
<link href="Extension-Sample-Fnmatch.html#Extension-Sample-Fnmatch" rel="next" title="Extension Sample Fnmatch">
<link href="Extension-Samples.html#Extension-Samples" rel="prev" title="Extension Samples">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="/software/gnulib/manual.css">


</head>

<body lang="zh-Hans" >
<a name="Extension-Sample-File-Functions"></a>
<div class="header">
<p>下一页： <a href="Extension-Sample-Fnmatch.html#Extension-Sample-Fnmatch" rel="next" accesskey="n">扩展样本Fnmatch</a> ，上： <a href="Extension-Samples.html#Extension-Samples" rel="up" accesskey="u">扩展样本</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="File_002dRelated-Functions"></a>
<h4 class="subsection">17.7.1文件相关的功能</h4>

<p>的<code>filefuncs</code>扩展提供了三种不同的功能，如下所示。用法是：</p>
<dl compact>
<dt><code>@load "filefuncs"</code></dt>
<dd><p>这是您加载扩展程序的方式。
</p>
<a name="index-chdir_0028_0029-extension-function"></a>
</dd>
<dt><code>result = chdir("/some/directory")</code></dt>
<dd><p>的<code>chdir()</code>功能是直接挂钩<code>chdir()</code>系统调用以更改当前目录。成功时返回零，错误时返回小于零的值。在后一种情况下，它会更新<code>ERRNO</code> 。
</p>
<a name="index-stat_0028_0029-extension-function"></a>
</dd>
<dt><code>result = stat("/some/path", statdata</code> [ <code>, follow</code> ]<code>)</code></dt>
<dd><p>的<code>stat()</code>功能提供了一个挂钩<code>stat()</code>系统调用。成功时返回零，错误时返回小于零的值。在后一种情况下，它会更新<code>ERRNO</code> 。
</p>
<p>默认情况下，它使用<code>lstat()</code>系统调用。但是，如果传递了第三个参数，它将使用<code>stat()</code>代替。
</p>
<p>在所有情况下，它都会清除<code>statdata</code>数组。通话成功后， <code>stat()</code>填充<code>statdata</code>具有从文件系统中检索到的信息的数组，如下所示：</p>
<table>
<thead><tr><th width="15%">下标</th><th width="50%">田野里<code>struct stat</code></th><th width="20%">文件类型</th></tr></thead>
<tbody><tr><td width="15%"><code>"name"</code></td><td width="50%">档案名称</td><td width="20%">所有</td></tr>
<tr><td width="15%"><code>"dev"</code></td><td width="50%"><code>st_dev</code></td><td width="20%">所有</td></tr>
<tr><td width="15%"><code>"ino"</code></td><td width="50%"><code>st_ino</code></td><td width="20%">所有</td></tr>
<tr><td width="15%"><code>"mode"</code></td><td width="50%"><code>st_mode</code></td><td width="20%">所有</td></tr>
<tr><td width="15%"><code>"nlink"</code></td><td width="50%"><code>st_nlink</code></td><td width="20%">所有</td></tr>
<tr><td width="15%"><code>"uid"</code></td><td width="50%"><code>st_uid</code></td><td width="20%">所有</td></tr>
<tr><td width="15%"><code>"gid"</code></td><td width="50%"><code>st_gid</code></td><td width="20%">所有</td></tr>
<tr><td width="15%"><code>"size"</code></td><td width="50%"><code>st_size</code></td><td width="20%">所有</td></tr>
<tr><td width="15%"><code>"atime"</code></td><td width="50%"><code>st_atime</code></td><td width="20%">所有</td></tr>
<tr><td width="15%"><code>"mtime"</code></td><td width="50%"><code>st_mtime</code></td><td width="20%">所有</td></tr>
<tr><td width="15%"><code>"ctime"</code></td><td width="50%"><code>st_ctime</code></td><td width="20%">所有</td></tr>
<tr><td width="15%"><code>"rdev"</code></td><td width="50%"><code>st_rdev</code></td><td width="20%">设备文件</td></tr>
<tr><td width="15%"><code>"major"</code></td><td width="50%"><code>st_major</code></td><td width="20%">设备文件</td></tr>
<tr><td width="15%"><code>"minor"</code></td><td width="50%"><code>st_minor</code></td><td width="20%">设备文件</td></tr>
<tr><td width="15%"><code>"blksize"</code></td><td width="50%"><code>st_blksize</code></td><td width="20%">所有</td></tr>
<tr><td width="15%"><code>"pmode"</code></td><td width="50%">模式值的人类可读版本，例如<code>ls</code> （例如， <code>"-rwxr-xr-x"</code> ）</td><td width="20%">所有</td></tr>
<tr><td width="15%"><code>"linkval"</code></td><td width="50%">符号链接的值</td><td width="20%">符号链接</td></tr>
<tr><td width="15%"><code>"type"</code></td><td width="50%">文件的类型，以字符串形式，为以下之一<code>"file"</code> ， <code>"blockdev"</code> ， <code>"chardev"</code> ， <code>"directory"</code> ， <code>"socket"</code> ， <code>"fifo"</code> ， <code>"symlink"</code> ， <code>"door"</code> ， 要么<code>"unknown"</code> （并非所有系统都支持所有文件类型）</td><td width="20%">所有</td></tr>
</tbody></table>

<a name="index-fts_0028_0029-extension-function"></a>
</dd>
<dt><code>flags = or(FTS_PHYSICAL, ...)</code></dt>
<dt><code>result = fts(pathlist, flags, filedata)</code></dt>
<dd><p>遍历提供的文件树<code>pathlist</code>并填写<code>filedata</code>数组，如下所述。 <code>flags</code>是几个预定义值的按位或，也将在稍后描述。如果没有错误，则返回零，否则返回-1。
</p></dd>
</dl>

<p>的<code>fts()</code>函数提供了对C库的钩子<code>fts()</code>遍历文件层次结构的例程。它不是在流中一次返回有关一个文件的数据，而是用有关在请求的层次结构中遇到的每个文件和目录的数据填充多维数组。
</p>
<p>参数如下：</p>
<dl compact>
<dt><code>pathlist</code></dt>
<dd><p>文件名数组。使用元素值；索引值将被忽略。
</p>
</dd>
<dt><code>flags</code></dt>
<dd><p>这应该是以下一个或多个预定义常量标志值的按位或。至少之一<code>FTS_LOGICAL</code>要么<code>FTS_PHYSICAL</code>必须提供;除此以外<code>fts()</code>返回错误值并设置<code>ERRNO</code> 。标志是：</p>
<dl compact>
<dt><code>FTS_LOGICAL</code></dt>
<dd><p>进行“逻辑”文件遍历，其中对于符号链接返回的信息是指链接到的文件，而不是符号链接本身。该标志与<code>FTS_PHYSICAL</code> 。
</p>
</dd>
<dt><code>FTS_PHYSICAL</code></dt>
<dd><p>进行“物理”文件遍历，其中符号链接返回的信息是指符号链接本身。该标志与<code>FTS_LOGICAL</code> 。
</p>
</dd>
<dt><code>FTS_NOCHDIR</code></dt>
<dd><p>作为性能优化，C库<code>fts()</code>例程在遍历文件层次结构时会更改目录。该标志禁用该优化。
</p>
</dd>
<dt><code>FTS_COMFOLLOW</code></dt>
<dd><p>立即跟随一个名为的符号链接<code>pathlist</code> ，无论是否<code>FTS_LOGICAL</code>被设置。
</p>
</dd>
<dt><code>FTS_SEEDOT</code></dt>
<dd><p>默认情况下，C库<code>fts()</code>例程不返回以下条目<samp>.</samp> （点）和<samp>..</samp> （点对点）。此选项将导致也包括点对点的条目。（扩展名始终包含一个点条目；稍后将对此进行更多说明。）
</p>
</dd>
<dt><code>FTS_XDEV</code></dt>
<dd><p>在遍历期间，请勿跨入其他已挂载的文件系统。
</p></dd>
</dl>

</dd>
<dt><code>filedata</code></dt>
<dd><p>的<code>filedata</code>数组保存结果。
<code>fts()</code>首先清除它。然后在其中创建一个元素<code>filedata</code>对于其中的每个元素<code>pathlist</code> 。索引是目录或文件的名称<code>pathlist</code> 。该索引的元素本身就是一个数组。有两种情况：</p>
<dl compact>
<dt><em>路径是一个文件</em></dt>
<dd><p>在这种情况下，数组包含两个或三个元素：</p>
<dl compact>
<dt><code>"path"</code></dt>
<dd><p>该文件的完整路径，从文件中指定的“根”开始<code>pathlist</code>数组。
</p>
</dd>
<dt><code>"stat"</code></dt>
<dd><p>这个元素本身就是一个数组，包含与<code>stat()</code>前面描述的功能<code>statdata</code>论点。如果该元素可能不存在<code>stat()</code>文件的系统调用失败。
</p>
</dd>
<dt><code>"error"</code></dt>
<dd><p>如果遇到某种错误，则数组还将包含一个名为<code>"error"</code> ，它是描述错误的字符串。
</p></dd>
</dl>

</dd>
<dt><em>路径是目录</em></dt>
<dd><p>在这种情况下，该数组包含目录中每个条目的一个元素。如果条目是文件，则该元素与刚才描述的文件相同。如果条目是目录，则该元素（递归）是描述子目录的数组。如果<code>FTS_SEEDOT</code>是在标志中提供的，那么还将有一个名为<code>".."</code> 。此元素将是一个数组，其中包含由<code>stat()</code> 。
</p>
<p>另外，会有一个元素的索引为<code>"."</code> 。此元素是一个数组，其中包含与文件相同的两个或三个元素： <code>"path"</code> ， <code>"stat"</code>和<code>"error"</code> 。
</p></dd>
</dl>
</dd>
</dl>

<p>的<code>fts()</code>如果没有错误，函数将返回零。否则，它返回-1。
</p>
<blockquote>
<p><b>注意：</b> <code>fts()</code>扩展不能完全模仿C库的接口<code>fts()</code>例程，而是选择提供一个基于关联数组的接口，该接口从<code>awk</code>程序。这包括缺少比较功能，因为<code>gawk</code>已经提供了强大的数组排序工具。虽然一个<code>fts_read()</code>可以提供类似的接口，这比简单地创建一个多维数组来表示文件层次结构及其信息的感觉不自然。
</p></blockquote>

<p>看到<samp>test/fts.awk</samp>在里面<code>gawk</code>分发示例使用<code>fts()</code>扩展功能。
</p>
<hr>
<div class="header">
<p>下一页： <a href="Extension-Sample-Fnmatch.html#Extension-Sample-Fnmatch" rel="next" accesskey="n">扩展样本Fnmatch</a> ，上： <a href="Extension-Samples.html#Extension-Samples" rel="up" accesskey="u">扩展样本</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>