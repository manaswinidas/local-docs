<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>警报程序（《 GNU Awk用户指南》）</title>

<meta name="description" content="Alarm Program (The GNU Awk User’s Guide)">
<meta name="keywords" content="Alarm Program (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Miscellaneous-Programs.html#Miscellaneous-Programs" rel="up" title="Miscellaneous Programs">
<link href="Translate-Program.html#Translate-Program" rel="next" title="Translate Program">
<link href="Dupword-Program.html#Dupword-Program" rel="prev" title="Dupword Program">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="manual.css">


</head>

<body lang="zh-Hans" >
<a name="Alarm-Program"></a>
<div class="header">
<p>下一个： <a href="Translate-Program.html#Translate-Program" rel="next" accesskey="n">翻译程序</a> ，上一个： <a href="Dupword-Program.html#Dupword-Program" rel="prev" accesskey="p">Dupword程序</a> ，上： <a href="Miscellaneous-Programs.html#Miscellaneous-Programs" rel="up" accesskey="u">其他程序</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="An-Alarm-Clock-Program"></a>
<h4 class="subsection">11.3.2闹钟程序</h4>
<a name="index-insomnia_002c-cure-for"></a>
<a name="index-Robbins_002c-Arnold-3"></a>
<blockquote>
<p><i>没有什么能像响闹钟那样治好失眠的了。</i>
</p></blockquote>
<div align="center">— <em>阿诺德·罗宾斯</em>
</div><a name="index-Quanstrom_002c-Erik"></a>
<blockquote>
<p><i>睡眠适用于Web开发人员。</i>
</p></blockquote>
<div align="center">— <em>埃里克·昆斯特伦</em>
</div>
<a name="index-time_002c-alarm-clock-example-program"></a>
<a name="index-alarm-clock-example-program"></a>
<p>以下程序是一个简单的“闹钟”程序。您给它一个时间和可选的消息。在指定的时间，它将消息打印在标准输出上。此外，您可以为其指定重复消息的次数以及重复之间的延迟。
</p>
<p>该程序使用<code>getlocaltime()</code>从<a href="Getlocaltime-Function.html#Getlocaltime-Function">管理一天中的时间</a>起作用。
</p>
<p>所有工作都在<code>BEGIN</code>规则。第一部分是参数检查和默认设置：延迟，计数和要打印的消息。如果用户提供的消息中没有ASCII BEL字符（称为“警报”字符）， <code>"\a"</code> ），然后将其添加到邮件中。（在许多系统上，打印ASCII BEL会生成声音警报。因此，当警报响起时，如果用户不看计算机，系统会引起注意。）只是为了更改，该程序使用<code>switch</code>声明（见部分<a href="Switch-Statement.html#Switch-Statement">的<code>switch</code>语句</a> ），但可以使用一系列<code>if</code> -- <code>else</code>语句代替。这是程序：</p>
<a name="index-alarm_002eawk-program"></a>
<div class="example">
<pre class="example"># alarm.awk --- set an alarm
#
# Requires getlocaltime() library function
# usage: alarm time [ &quot;message&quot; [ count [ delay ] ] ]

BEGIN {
    # Initial argument sanity checking
    usage1 = &quot;usage: alarm time ['message' [count [delay]]]&quot;
    usage2 = sprintf(&quot;\t(%s) time ::= hh:mm&quot;, ARGV[1])

    if (ARGC &lt; 2) {
        print usage1 &gt; &quot;/dev/stderr&quot;
        print usage2 &gt; &quot;/dev/stderr&quot;
        exit 1
    }
    switch (ARGC) {
    case 5:
        delay = ARGV[4] + 0
        # fall through
    case 4:
        count = ARGV[3] + 0
        # fall through
    case 3:
        message = ARGV[2]
        break
    default:
        if (ARGV[1] !~ /[[:digit:]]?[[:digit:]]:[[:digit:]]{2}/) {
            print usage1 &gt; &quot;/dev/stderr&quot;
            print usage2 &gt; &quot;/dev/stderr&quot;
            exit 1
        }
        break
    }

    # set defaults for once we reach the desired time
    if (delay == 0)
        delay = 180    # 3 minutes
</pre><pre class="example">    if (count == 0)
        count = 5
</pre><pre class="example">    if (message == &quot;&quot;)
        message = sprintf(&quot;\aIt is now %s!\a&quot;, ARGV[1])
    else if (index(message, &quot;\a&quot;) == 0)
        message = &quot;\a&quot; message &quot;\a&quot;
</pre></div>

<p>下一部分代码将警报时间转换为小时和分钟，将其转换为24小时制（如有必要），然后将该时间转换为自午夜以来的秒数。接下来，它将当前时间转换为自午夜以来的秒数。两者之间的区别在于发出警报之前需要等待多长时间：</p>
<div class="example">
<pre class="example">    # split up alarm time
    split(ARGV[1], atime, &quot;:&quot;)
    hour = atime[1] + 0    # force numeric
    minute = atime[2] + 0  # force numeric

    # get current broken down time
    getlocaltime(now)

    # if time given is 12-hour hours and it's after that
    # hour, e.g., `alarm 5:30' at 9 a.m. means 5:30 p.m.,
    # then add 12 to real hour
    if (hour &lt; 12 &amp;&amp; now[&quot;hour&quot;] &gt; hour)
        hour += 12

    # set target time in seconds since midnight
    target = (hour * 60 * 60) + (minute * 60)

    # get current time in seconds since midnight
    current = (now[&quot;hour&quot;] * 60 * 60) + \
               (now[&quot;minute&quot;] * 60) + now[&quot;second&quot;]

    # how long to sleep for
    naptime = target - current
    if (naptime &lt;= 0) {
        print &quot;alarm: time is in the past!&quot; &gt; &quot;/dev/stderr&quot;
        exit 1
    }
</pre></div>

<a name="index-sleep-utility"></a>
<p>最后，程序使用<code>system()</code>函数（请参阅“ <a href="I_002fO-Functions.html#I_002fO-Functions">输入/输出函数”部分</a> ）以调用<code>sleep</code>效用。的<code>sleep</code>实用程序只会暂停给定的秒数。如果退出状态不为零，则程序假定<code>sleep</code>被打断并退出。如果<code>sleep</code>以OK状态（零）退出，然后程序循环循环打印消息，再次使用<code>sleep</code>延迟多少秒是必要的：</p>
<div class="example">
<pre class="example">    # zzzzzz..... go away if interrupted
    if (system(sprintf(&quot;sleep %d&quot;, naptime)) != 0)
        exit 1

    # time to notify!
    command = sprintf(&quot;sleep %d&quot;, delay)
    for (i = 1; i &lt;= count; i++) {
        print message
        # if sleep command interrupted, go away
        if (system(command) != 0)
            break
    }

    exit 0
}
</pre></div>

<hr>
<div class="header">
<p>下一个： <a href="Translate-Program.html#Translate-Program" rel="next" accesskey="n">翻译程序</a> ，上一个： <a href="Dupword-Program.html#Dupword-Program" rel="prev" accesskey="p">Dupword程序</a> ，上： <a href="Miscellaneous-Programs.html#Miscellaneous-Programs" rel="up" accesskey="u">其他程序</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>