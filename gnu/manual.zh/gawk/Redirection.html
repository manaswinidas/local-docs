<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>重定向（《 GNU Awk用户指南》）</title>

<meta name="description" content="Redirection (The GNU Awk User’s Guide)">
<meta name="keywords" content="Redirection (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Printing.html#Printing" rel="up" title="Printing">
<link href="Special-FD.html#Special-FD" rel="next" title="Special FD">
<link href="Printf-Examples.html#Printf-Examples" rel="prev" title="Printf Examples">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="manual.css">


</head>

<body lang="zh-Hans" >
<a name="Redirection"></a>
<div class="header">
<p>下一篇： <a href="Special-FD.html#Special-FD" rel="next" accesskey="n">特殊FD</a> ，上一篇： <a href="Printf.html#Printf" rel="prev" accesskey="p">Printf</a> ，上一篇： <a href="Printing.html#Printing" rel="up" accesskey="u">打印</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="Redirecting-Output-of-print-and-printf"></a>
<h3 class="section">5.6重定向输出<code>print</code>和<code>printf</code></h3>

<a name="index-output-redirection"></a>
<a name="index-redirection-of-output"></a>
<a name="index-_002d_002dsandbox-option_002c-output-redirection-with-print_002c-printf"></a>
<p>到目前为止， <code>print</code>和<code>printf</code>已经转到标准输出，通常是屏幕。都<code>print</code>和<code>printf</code>也可以将其输出发送到其他地方。这称为<em>重定向</em> 。
</p>
<blockquote>
<p><b>注意：</b>何时<samp>--sandbox</samp>被指定（请参阅“ <a href="Options.html#Options">命令行选项”</a>一节），禁用将输出重定向到文件，管道和协同进程。
</p></blockquote>

<p>重定向出现在<code>print</code>要么<code>printf</code>声明。重定向<code>awk</code>的编写方式与shell命令中的重定向类似，不同之处在于它们是在<code>awk</code>程序。
</p>
<a name="index-print-statement_002c-See-Also-redirection_002c-of-output"></a>
<a name="index-printf-statement_002c-See-Also-redirection_002c-of-output"></a>
<p>输出重定向有四种形式：输出到文件，输出附加到文件，通过管道输出到另一个命令以及输出到协同处理。我们为他们展示所有<code>print</code>声明，但是它们在<code>printf</code> ：</p>
<dl compact>
<dd><a name="index-_003e-_0028right-angle-bracket_0029_002c-_003e-operator-_0028I_002fO_0029"></a>
<a name="index-right-angle-bracket-_0028_003e_0029_002c-_003e-operator-_0028I_002fO_0029"></a>
<a name="index-operators_002c-input_002foutput-3"></a>
</dd>
<dt><code>print <var>items</var> > <var>output-file</var></code></dt>
<dd><p>此重定向将项目打印到名为的输出文件中<var>output-file</var> 。档案名称<var>output-file</var>可以是任何表达式。它的值被更改为字符串，然后用作文件名（请参阅“ <a href="Expressions.html#Expressions">表达式”</a>部分）。
</p>
<p>使用这种类型的重定向时， <var>output-file</var>在第一个输出写入之前将其擦除。随后写入相同<var>output-file</var>不要擦除<var>output-file</var> ，但要附加到它后面。（这与您在Shell脚本中使用重定向的方式不同。）如果<var>output-file</var>不存在，它被创建。例如，这是<code>awk</code>程序可以将人们的名字列表写入一个名为<samp>name-list</samp> ，以及到另一个名为的文件的电话号码列表<samp>phone-list</samp> ：</p>
<div class="example">
<pre class="example">$ <kbd>awk '{ print $2 &gt; &quot;phone-list&quot;</kbd>
&gt;        <kbd>print $1 &gt; &quot;name-list&quot; }' mail-list</kbd>
$ <kbd>cat phone-list</kbd>
-| 555-5553
-| 555-3412
&hellip;
$ <kbd>cat name-list</kbd>
-| Amelia
-| Anthony
&hellip;
</pre></div>

<p>每个输出文件每行包含一个名称或编号。
</p>
<a name="index-_003e-_0028right-angle-bracket_0029_002c-_003e_003e-operator-_0028I_002fO_0029"></a>
<a name="index-right-angle-bracket-_0028_003e_0029_002c-_003e_003e-operator-_0028I_002fO_0029"></a>
</dd>
<dt><code>print <var>items</var> >> <var>output-file</var></code></dt>
<dd><p>此重定向将项目打印到名为的现有输出文件中<var>output-file</var> 。这个和单身之间的区别<samp>></samp>重定向是指旧内容（如果有） <var>output-file</var>不会被删除。相反， <code>awk</code>输出将附加到文件。如果<var>output-file</var>不存在，则创建它。
</p>
<a name="index-_007c-_0028vertical-bar_0029_002c-_007c-operator-_0028I_002fO_0029-1"></a>
<a name="index-pipe_002c-output"></a>
<a name="index-output_002c-pipes"></a>
</dd>
<dt><code>print <var>items</var> | <var>command</var></code></dt>
<dd><p>可以通过管道将输出发送到另一个程序，而不是发送到文件。此重定向将打开一个管道以<var>command</var> ，并写入的值<var>items</var>通过此管道到达另一个要执行的进程<var>command</var> 。
</p>
<p>重定向参数<var>command</var>实际上是<code>awk</code>表达。其值将转换为字符串，其内容将给出要运行的shell命令。例如，以下代码产生两个文件，一个未排序的人的名字列表，以及一个以相反的字母顺序排序的列表：</p>

<div class="example">
<pre class="example">awk '{ print $1 &gt; &quot;names.unsorted&quot;
       command = &quot;sort -r &gt; names.sorted&quot;
       print $1 | command }' mail-list
</pre></div>

<p>未排序的列表是通过普通重定向编写的，而排序的列表是通过管道将<code>sort</code>效用。
</p>
<p>下一个示例使用重定向将邮件邮寄到邮件列表<code>bug-system</code> 。如果在<code>awk</code>脚本定期运行以进行系统维护：</p>
<div class="example">
<pre class="example">report = &quot;mail bug-system&quot;
print(&quot;Awk script failed:&quot;, $0) | report
print(&quot;at record number&quot;, FNR, &quot;of&quot;, FILENAME) | report
close(report)
</pre></div>

<p>的<code>close()</code>之所以调用此函数，是因为在将所有预期的输出发送给管道后立即关闭管道是个好主意。有关更多信息，请参见“ <a href="Close-Files-And-Pipes.html#Close-Files-And-Pipes">关闭输入和输出重定向”</a>部分。
</p>
<p>此示例还说明了如何使用变量来表示<var>file</var>要么<var>command</var> —不必总是使用字符串常量。通常，使用变量是一个好主意，因为（如果要引用相同的文件或命令） <code>awk</code>要求每次都以相同的方式写入字符串值。
</p>
<a name="index-coprocesses"></a>
<a name="index-_007c-_0028vertical-bar_0029_002c-_007c_0026-operator-_0028I_002fO_0029-1"></a>
<a name="index-operators_002c-input_002foutput-4"></a>
<a name="index-differences-in-awk-and-gawk_002c-input_002foutput-operators-1"></a>
</dd>
<dt><code>print <var>items</var> |& <var>command</var></code></dt>
<dd><p>此重定向将项目打印到的输入<var>command</var> 。这个和单身之间的区别<samp>|</samp>重定向是指<var>command</var>可以阅读<code>getline</code> 。从而， <var>command</var>是一个<em>协同处理程序</em> ，它与<em>协同</em>工作但是它的附属。 <code>awk</code>程序。
</p>
<p>此功能是<code>gawk</code>扩展名，在POSIX中不可用<code>awk</code> 。请参阅<a href="Getline_002fCoprocess.html#Getline_002fCoprocess">使用</a>部分<a href="Getline_002fCoprocess.html#Getline_002fCoprocess"><code>getline</code>来自Coprocess</a>的简短讨论。有关更完整的讨论，请参见“ <a href="Two_002dway-I_002fO.html#Two_002dway-I_002fO">与另一个过程</a>进行<a href="Two_002dway-I_002fO.html#Two_002dway-I_002fO">双向通信”</a>部分。
</p></dd>
</dl>

<p>使用'重定向输出<samp>></samp> '，' <samp>>></samp> '，' <samp>|</samp> '， 要么 ' <samp>|&</samp> '仅在特定情况下要求系统打开文件，管道或协同处理<var>file</var>要么<var>command</var>您指定的程序尚未将其写入，或者自上次写入以来已将其关闭。
</p>
<a name="index-troubleshooting_002c-printing"></a>
<p>使用' <samp>></samp> '第一次重定向<code>print</code>到文件，然后使用“ <samp>>></samp> '用于后续输出：</p>
<div class="example">
<pre class="example"># clear the file
print &quot;Don't panic&quot; &gt; &quot;guide.txt&quot;
&hellip;
# append
print &quot;Avoid improbability generators&quot; &gt;&gt; &quot;guide.txt&quot;
</pre></div>

<p>实际上，这就是必须从shell使用重定向的方式。但在<code>awk</code> ，没有必要。在这种情况下，程序应使用“ <samp>></samp> '为所有<code>print</code>语句，因为输出文件仅打开一次。（如果您混合使用' <samp>></samp> '和' <samp>>></samp> '输出按预期顺序生成。但是，混合使用同一文件的运算符肯定是不好的样式，这会使程序的读者感到困惑。）
</p>
<a name="index-differences-in-awk-and-gawk_002c-implementation-limitations-1"></a>
<a name="index-implementation-issues_002c-gawk_002c-limits-1"></a>
<a name="index-awk_002c-implementation-issues_002c-pipes"></a>
<a name="index-gawk_002c-implementation-issues_002c-pipes"></a>
<p>如前所述（请参阅<a href="Getline-Notes.html#Getline-Notes">要记住的</a>部分<a href="Getline-Notes.html#Getline-Notes"><code>getline</code></a> ），很多很多<code>awk</code>实施限制了<code>awk</code>程序可能只开放给一个！在<code>gawk</code> ，没有这样的限制。
<code>gawk</code>允许程序在基础操作系统允许的情况下打开尽可能多的管道。
</p>
<a name="index-sidebar_002c-Piping-into-sh"></a>

<table class="cartouche" border="1"><tbody><tr><td>
<div align="center"><b>管道成<code>sh</code></b>
</div>

<a name="index-shells_002c-piping-commands-into"></a>

<p>使用重定向的一种特别有效的方法是构建命令行并将它们通过管道传递到外壳中， <code>sh</code> 。例如，假设您有一个从系统中移过来的文件列表，其中所有文件名都以大写形式存储，并且您希望将它们重命名为所有小写形式的名称。以下程序既简单又有效：</p>
<div class="example">
<pre class="example">{ printf(&quot;mv %s %s\n&quot;, $0, tolower($0)) | &quot;sh&quot; }

END { close(&quot;sh&quot;) }
</pre></div>

<p>的<code>tolower()</code>函数返回其参数字符串，并将所有大写字符转换为小写（请参阅“ <a href="String-Functions.html#String-Functions">字符串操作函数”</a>一节）。该程序使用以下命令建立命令行列表： <code>mv</code>实用程序来重命名文件。然后，它将列表发送到外壳程序以执行。
</p>
<p>有关可以帮助生成要馈送给Shell的命令行的函数，请参见<a href="Shell-Quoting.html#Shell-Quoting">引用字符串以传递给Shell</a>一节。
</p></td></tr></tbody></table>

<hr>
<div class="header">
<p>下一篇： <a href="Special-FD.html#Special-FD" rel="next" accesskey="n">特殊FD</a> ，上一篇： <a href="Printf.html#Printf" rel="prev" accesskey="p">Printf</a> ，上一篇： <a href="Printing.html#Printing" rel="up" accesskey="u">打印</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>