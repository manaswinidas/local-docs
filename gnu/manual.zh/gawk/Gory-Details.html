<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>血腥细节（《 GNU Awk用户指南》）</title>

<meta name="description" content="Gory Details (The GNU Awk User’s Guide)">
<meta name="keywords" content="Gory Details (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="String-Functions.html#String-Functions" rel="up" title="String Functions">
<link href="I_002fO-Functions.html#I_002fO-Functions" rel="next" title="I/O Functions">
<link href="String-Functions.html#String-Functions" rel="prev" title="String Functions">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="manual.css">


</head>

<body lang="zh-Hans" >
<a name="Gory-Details"></a>
<div class="header">
<p>上： <a href="String-Functions.html#String-Functions" rel="up" accesskey="u">字符串函数</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="More-about-_005c-and-_0026-with-sub_0028_0029_002c-gsub_0028_0029_002c-and-gensub_0028_0029"></a>
<h4 class="subsubsection">9.1.3.1有关' <samp>\</samp> '和' <samp>&</samp>与<code>sub()</code> ， <code>gsub()</code>和<code>gensub()</code></h4>

<a name="index-escape-processing_002c-gsub_0028_0029_002fgensub_0028_0029_002fsub_0028_0029-functions"></a>
<a name="index-sub_0028_0029-function_002c-escape-processing"></a>
<a name="index-gsub_0028_0029-function_002c-escape-processing"></a>
<a name="index-gensub_0028_0029-function-_0028gawk_0029_002c-escape-processing"></a>
<a name="index-_005c-_0028backslash_0029_002c-gsub_0028_0029_002fgensub_0028_0029_002fsub_0028_0029-functions-and"></a>
<a name="index-backslash-_0028_005c_0029_002c-gsub_0028_0029_002fgensub_0028_0029_002fsub_0028_0029-functions-and"></a>
<a name="index-_0026-_0028ampersand_0029_002c-gsub_0028_0029_002fgensub_0028_0029_002fsub_0028_0029-functions-and"></a>
<a name="index-ampersand-_0028_0026_0029_002c-gsub_0028_0029_002fgensub_0028_0029_002fsub_0028_0029-functions-and"></a>

<blockquote>
<p><b>注意：</b>据报道该小节会引起头痛。您可能想在初读时略过它。
</p></blockquote>

<p>使用时<code>sub()</code> ， <code>gsub()</code> ， 要么<code>gensub()</code> ，并尝试将文字反斜杠和＆符添加到替换文本中，您需要记住， <em>转义处理</em>正在进行多个级别。
</p>
<p>首先，有一个<em>词法</em>层次，即<code>awk</code>读取您的程序并构建其内部副本以执行。然后是运行时级别，即<code>awk</code>实际扫描替换字符串以确定生成什么。
</p>
<a name="index-Brian-Kernighan_0027s-awk-12"></a>
<p>在两个层面上<code>awk</code>查找反斜杠后可能出现的一组定义的字符。在词汇级别，它将查找<a href="Escape-Sequences.html#Escape-Sequences">Escape Sequences中</a>列出的<a href="Escape-Sequences.html#Escape-Sequences">转义序列</a> 。因此，对于每个“ <samp>\</samp>那个<code>awk</code>在运行时级别的进程中，必须在词汇级别键入两个反斜杠。当对转义序列无效的字符后跟' <samp>\</samp> '，BWK <code>awk</code>和<code>gawk</code>两者都只是删除开头的“ <samp>\</samp> '，然后将下一个字符放入字符串中。因此，例如<code>"a\qb"</code>被视为<code>"aqb"</code> 。
</p>
<p>在运行时级别，各种功能处理“ <samp>\</samp> '和' <samp>&</samp> '不同。情况（非常）有些复杂。历史上， <code>sub()</code>和<code>gsub()</code>函数处理了两个字符的序列' <samp>\&</samp>特别地该序列在生成的文本中被替换为一个' <samp>&</samp> '。任何其他 ' <samp>\</samp> '内<var>replacement</var>不在'之前的字符串<samp>&</samp> '保持不变。如<a href="#table_002dsub_002descapes">表9.1所示</a> 。
</p>
<div class="float"><a name="table_002dsub_002descapes"></a>

<div class="display">
<pre class="display"> You type         <code>sub()</code> sees          <code>sub()</code> generates
 &mdash;&mdash;&ndash;         &mdash;&mdash;&mdash;-          &mdash;&mdash;&mdash;&mdash;&mdash;
     <code>\&amp;</code>              <code>&amp;</code>            The matched text
    <code>\\&amp;</code>             <code>\&amp;</code>            A literal &lsquo;<samp>&amp;</samp>&rsquo;
   <code>\\\&amp;</code>             <code>\&amp;</code>            A literal &lsquo;<samp>&amp;</samp>&rsquo;
  <code>\\\\&amp;</code>            <code>\\&amp;</code>            A literal &lsquo;<samp>\&amp;</samp>&rsquo;
 <code>\\\\\&amp;</code>            <code>\\&amp;</code>            A literal &lsquo;<samp>\&amp;</samp>&rsquo;
<code>\\\\\\&amp;</code>           <code>\\\&amp;</code>            A literal &lsquo;<samp>\\&amp;</samp>&rsquo;
    <code>\\q</code>             <code>\q</code>            A literal &lsquo;<samp>\q</samp>&rsquo;
</pre></div>
<div class="float-caption"><p><strong>表9.1：的</strong>历史转义序列处理<code>sub()</code>和<code>gsub()</code></p></div></div>
<p>该表显示了词法级处理，其中在运行时级别，奇数个反斜杠变为偶数，以及由<code>sub()</code> 。（为简单起见，下表的其余部分仅显示在词汇级别输入偶数个反斜杠的情况。）
</p>
<p>历史方法的问题在于，无法获得文字“ <samp>\</samp> '，然后是匹配的文本。
</p>
<p>几个版本的POSIX标准试图解决此问题，但没有成功。此时的细节无关紧要。
</p>
<p>一方面， <code>gawk</code>维护者提交了修订后的标准的提议文本，该文本恢复为与原始现有实践更为接近的规则。拟议的规则具有特殊情况，可以产生“ <samp>\</samp> '在匹配文本之前。如<a href="#table_002dsub_002dproposed">表9.2</a>所示。
</p>
<div class="float"><a name="table_002dsub_002dproposed"></a>

<div class="display">
<pre class="display"> You type         <code>sub()</code> sees         <code>sub()</code> generates
 &mdash;&mdash;&ndash;         &mdash;&mdash;&mdash;-         &mdash;&mdash;&mdash;&mdash;&mdash;
<code>\\\\\\&amp;</code>           <code>\\\&amp;</code>            A literal &lsquo;<samp>\&amp;</samp>&rsquo;
  <code>\\\\&amp;</code>            <code>\\&amp;</code>            A literal &lsquo;<samp>\</samp>&rsquo;, followed by the matched text
    <code>\\&amp;</code>             <code>\&amp;</code>            A literal &lsquo;<samp>&amp;</samp>&rsquo;
    <code>\\q</code>             <code>\q</code>            A literal &lsquo;<samp>\q</samp>&rsquo;
   <code>\\\\</code>             <code>\\</code>            <code>\\</code>
</pre></div>
<div class="float-caption"><p><strong>表9.2：</strong> <code>gawk</code>规则<code>sub()</code>和反斜杠</p></div></div>
<p>简而言之，在运行时级别，现在有三个特殊的字符序列（' <samp>\\\&</samp> '，' <samp>\\&</samp> '和' <samp>\&</samp> '），而历史上只有一个。但是，与历史案例一样，任何“ <samp>\</samp>不属于这三个序列之一的'不是特殊的，并按字面意义出现在输出中。
</p>
<p><code>gawk</code> 3.0和3.1遵循以下规则<code>sub()</code>和<code>gsub()</code> 。POSIX标准的修订时间比预期的要长得多。除此之外<code>gawk</code>维护者的建议在标准化过程中丢失了。最终规则有些简单。除了一种情况，结果相似。
</p>
<a name="index-POSIX-awk_002c-functions-and_002c-gsub_0028_0029_002fsub_0028_0029"></a>
<p>POSIX规则规定： <samp>\&</samp> '在替换字符串中产生一个文字' <samp>&</samp> '，' <samp>\\</samp> '产生文字' <samp>\</samp> '和' <samp>\</samp> '紧接着其他没有什么特别的； ' <samp>\</samp> '直接放置在输出中。这些规则在<a href="#table_002dposix_002dsub">表9.3</a>中给出。
</p>
<div class="float"><a name="table_002dposix_002dsub"></a>

<div class="display">
<pre class="display"> You type         <code>sub()</code> sees         <code>sub()</code> generates
 &mdash;&mdash;&ndash;         &mdash;&mdash;&mdash;-         &mdash;&mdash;&mdash;&mdash;&mdash;
<code>\\\\\\&amp;</code>           <code>\\\&amp;</code>            A literal &lsquo;<samp>\&amp;</samp>&rsquo;
  <code>\\\\&amp;</code>            <code>\\&amp;</code>            A literal &lsquo;<samp>\</samp>&rsquo;, followed by the matched text
    <code>\\&amp;</code>             <code>\&amp;</code>            A literal &lsquo;<samp>&amp;</samp>&rsquo;
    <code>\\q</code>             <code>\q</code>            A literal &lsquo;<samp>\q</samp>&rsquo;
   <code>\\\\</code>             <code>\\</code>            <code>\</code>
</pre></div>
<div class="float-caption"><p><strong>表9.3：的</strong> POSIX规则<code>sub()</code>和<code>gsub()</code></p></div></div>
<p>唯一明显的区别是最后一个： <samp>\\\\</samp>被视为“ <samp>\\</samp> '并产生' <samp>\</samp> ' 代替 ' <samp>\\</samp> '。
</p>
<p>从3.1.4版开始， <code>gawk</code>遵循POSIX规则时<samp>--posix</samp>已指定（请参阅“ <a href="Options.html#Options">命令行选项”</a>一节）。否则，它继续遵循拟议的规则，因为这是其多年以来的行为。
</p>
<p>当4.0.0版发布时， <code>gawk</code>维护者使POSIX规则成为默认规则，打破了十多年的向后兼容性。 <a name="DOCF49" href="#FOOT49"><sup>49</sup></a>不用说，这是一个坏主意，从4.0.1版开始， <code>gawk</code>恢复其历史行为，并且仅在以下情况下遵循POSIX规则<samp>--posix</samp>给出。
</p>
<p>规则<code>gensub()</code>相当简单。在运行时级别，无论何时<code>gawk</code>看到一个“ <samp>\</samp> '，如果后面的字符是数字，则将与相应的带括号的子表达式匹配的文本放置在生成的输出中。否则，无论' <samp>\</samp> '，它出现在生成的文本和' <samp>\</samp>如<a href="#table_002dgensub_002descapes">表9.4</a>所示。
</p>
<div class="float"><a name="table_002dgensub_002descapes"></a>

<div class="display">
<pre class="display">  You type          <code>gensub()</code> sees         <code>gensub()</code> generates
  &mdash;&mdash;&ndash;          &mdash;&mdash;&mdash;&mdash;-         &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
      <code>&amp;</code>                    <code>&amp;</code>            The matched text
    <code>\\&amp;</code>                   <code>\&amp;</code>            A literal &lsquo;<samp>&amp;</samp>&rsquo;
   <code>\\\\</code>                   <code>\\</code>            A literal &lsquo;<samp>\</samp>&rsquo;
  <code>\\\\&amp;</code>                  <code>\\&amp;</code>            A literal &lsquo;<samp>\</samp>&rsquo;, then the matched text
<code>\\\\\\&amp;</code>                 <code>\\\&amp;</code>            A literal &lsquo;<samp>\&amp;</samp>&rsquo;
    <code>\\q</code>                   <code>\q</code>            A literal &lsquo;<samp>q</samp>&rsquo;
</pre></div>
<div class="float-caption"><p><strong>表9.4：的</strong>转义序列处理<code>gensub()</code></p></div></div>
<p>由于词法级和运行时级处理的复杂性以及<code>sub()</code>和<code>gsub()</code> ，我们建议使用<code>gawk</code>和<code>gensub()</code>当您必须进行替换时。
</p>
<div class="footnote">
<hr>
<h4 class="footnotes-heading">脚注</h4>

<h3><a name="FOOT49" href="#DOCF49">（49）</a></h3>
<p>尽管本节中有一条注释指出下一个主要版本将移至POSIX规则，但他对他还是很天真。</p>
</div>
<hr>
<div class="header">
<p>上： <a href="String-Functions.html#String-Functions" rel="up" accesskey="u">字符串函数</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>