<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>数组排序函数（《 GNU Awk用户指南》）</title>

<meta name="description" content="Array Sorting Functions (The GNU Awk User’s Guide)">
<meta name="keywords" content="Array Sorting Functions (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Array-Sorting.html#Array-Sorting" rel="up" title="Array Sorting">
<link href="Two_002dway-I_002fO.html#Two_002dway-I_002fO" rel="next" title="Two-way I/O">
<link href="Controlling-Array-Traversal.html#Controlling-Array-Traversal" rel="prev" title="Controlling Array Traversal">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="/software/gnulib/manual.css">


</head>

<body lang="zh-Hans" >
<a name="Array-Sorting-Functions"></a>
<div class="header">
<p>上一页： <a href="Controlling-Array-Traversal.html#Controlling-Array-Traversal" rel="prev" accesskey="p">控制数组遍历</a> ，向上： <a href="Array-Sorting.html#Array-Sorting" rel="up" accesskey="u">数组排序</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="Sorting-Array-Values-and-Indices-with-gawk"></a>
<h4 class="subsection">12.2.2使用以下命令对数组值和索引进行排序<code>gawk</code></h4>

<a name="index-arrays_002c-sorting"></a>
<a name="index-asort_0028_0029-function-_0028gawk_0029-1"></a>
<a name="index-asort_0028_0029-function-_0028gawk_0029_002c-arrays_002c-sorting"></a>
<a name="index-asorti_0028_0029-function-_0028gawk_0029-1"></a>
<a name="index-asorti_0028_0029-function-_0028gawk_0029_002c-arrays_002c-sorting"></a>
<a name="index-sort-function_002c-arrays_002c-sorting"></a>
<p>多数情况<code>awk</code>实现，对数组进行排序需要编写一个<code>sort()</code>功能。探索不同的排序算法可能很有教育意义，但通常这不是程序的重点。
<code>gawk</code>提供内置<code>asort()</code>和<code>asorti()</code>函数（请参阅“ <a href="String-Functions.html#String-Functions">字符串操作函数”</a>一节）以对数组进行排序。例如：</p>
<div class="example">
<pre class="example"><var>populate the array</var> data
n = asort(data)
for (i = 1; i &lt;= n; i++)
    <var>do something with</var> data[i]
</pre></div>

<p>致电后<code>asort()</code> ，数组<code>data</code>从1索引到某个数字<var>n</var> ，其中的元素总数<code>data</code> 。（此计数是<code>asort()</code>的返回值。）
<code>data[1]</code> <= <code>data[2]</code> <= <code>data[3]</code> ， 等等。默认比较基于元素的类型（请参见<a href="Typing-and-Comparison.html#Typing-and-Comparison">变量</a>类型<a href="Typing-and-Comparison.html#Typing-and-Comparison">和比较表达式部分</a> ）。所有数字值都在所有字符串值之前，而字符串值又在所有子数组之前。
</p>
<a name="index-side-effects_002c-asort_0028_0029-function"></a>
<p>通话的重要副作用<code>asort()</code>是<em>该数组的原始索引不可避免地丢失了</em> 。由于这并不总是可取的， <code>asort()</code>接受第二个参数：</p>
<div class="example">
<pre class="example"><var>populate the array</var> source
n = asort(source, dest)
for (i = 1; i &lt;= n; i++)
    <var>do something with</var> dest[i]
</pre></div>

<p>在这种情况下， <code>gawk</code>复制<code>source</code>排列成<code>dest</code>数组然后排序<code>dest</code> ，破坏其索引。然而<code>source</code>数组不受影响。
</p>
<p>通常，需要对<em>索引</em>的值进行排序，而不是对元素的值进行排序。为此，请使用<code>asorti()</code>功能。界面和行为与<code>asort()</code> ，除了索引值用于排序并成为结果数组的值：</p>
<div class="example">
<pre class="example">{ source[$0] = some_func($0) }

END {
    n = asorti(source, dest)
    for (i = 1; i &lt;= n; i++) {
        <i>Work with sorted indices directly:</i>
        <var>do something with</var> dest[i]
        &hellip;
        <i>Access original array via sorted indices:</i>
        <var>do something with</var> source[dest[i]]
    }
}
</pre></div>

<p>到目前为止，一切都很好。现在开始变得有趣。都<code>asort()</code>和<code>asorti()</code>接受第三个字符串参数来控制数组元素的比较。当我们介绍<code>asort()</code>和<code>asorti()</code>在<a href="String-Functions.html#String-Functions">String-Manipulation Functions中</a> ，我们忽略了第三个参数。但是，现在该描述该论点如何影响这两个功能了。
</p>
<p>基本上，第三个参数指定如何对数组进行排序。有两种可能性。与<code>PROCINFO["sorted_in"]</code> ，此参数可能是预定义名称之一， <code>gawk</code>提供的信息（请参阅<a href="Controlling-Scanning.html#Controlling-Scanning">将预定义阵列扫描顺序与<code>gawk</code></a> ），也可以是用户定义函数的名称（请参见<a href="Controlling-Array-Traversal.html#Controlling-Array-Traversal">控制数组遍历</a>部分）。
</p>
<p>在后一种情况下， <em>该函数可以按其选择的任何方式比较元素</em> ，仅考虑索引，仅值或同时考虑两者。这是非常强大的。
</p>
<p>数组排序后， <code>asort()</code>以其最终顺序获取<em>值</em> ，并使用它们来填充结果数组，而<code>asorti()</code>以它们的最终顺序获取<em>索引</em> ，并使用它们来填充结果数组。
</p>
<a name="index-reference-counting_002c-sorting-arrays"></a>
<blockquote>
<p><b>注意：</b>复制数组索引和元素在内存方面并不昂贵。在内部， <code>gawk</code>维护对数据的<em>引用计数</em> 。例如，当<code>asort()</code>将第一个数组复制到第二个数组，即使两个数组都使用值，原始数组元素的数据也只有一个副本。
</p></blockquote>

<a name="index-gawk_002c-IGNORECASE-variable-in-4"></a>
<a name="index-arrays_002c-sorting_002c-IGNORECASE-variable-and"></a>
<a name="index-IGNORECASE-variable_002c-array-sorting-functions-and"></a>
<p>因为<code>IGNORECASE</code>影响字符串比较，值<code>IGNORECASE</code>也会影响两者的排序<code>asort()</code>和<code>asorti()</code> 。还要注意的是语言环境的排序顺序<em>不</em>发挥作用;比较仅基于字符值。 <a name="DOCF85" href="#FOOT85"><sup>85</sup></a>
</p>
<p>以下示例演示了将比较功能与<code>asort()</code> 。比较功能， <code>case_fold_compare()</code> ，将两个值都映射为小写，以便在忽略大小写的情况下进行比较。
</p>
<div class="example">
<pre class="example"># case_fold_compare --- compare as strings, ignoring case

function case_fold_compare(i1, v1, i2, v2,    l, r)
{
    l = tolower(v1)
</pre><pre class="example">    r = tolower(v2)

    if (l &lt; r)
        return -1
    else if (l == r)
        return 0
    else
        return 1
}
</pre></div>

<p>这是它的测试程序：</p>
<div class="example">
<pre class="example"># Test program

BEGIN {
    Letters = &quot;abcdefghijklmnopqrstuvwxyz&quot; \
              &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;
    split(Letters, data, &quot;&quot;)

    asort(data, result, &quot;case_fold_compare&quot;)

    j = length(result)
    for (i = 1; i &lt;= j; i++) {
        printf(&quot;%s&quot;, result[i])
        if (i % (j/2) == 0)
            printf(&quot;\n&quot;)
        else
            printf(&quot; &quot;)
    }
}
</pre></div>

<p>运行时，我们得到以下信息：</p>
<div class="example">
<pre class="example">$ <kbd>gawk -f case_fold_compare.awk</kbd>
-| A a B b c C D d e E F f g G H h i I J j k K l L M m
-| n N O o p P Q q r R S s t T u U V v w W X x y Y z Z
</pre></div>

<div class="footnote">
<hr>
<h4 class="footnotes-heading">脚注</h4>

<h3><a name="FOOT85" href="#DOCF85">（85）</a></h3>
<p>之所以如此，是因为基于语言环境的比较仅在POSIX兼容模式下发生，并且<code>asort()</code>和<code>asorti()</code>是<code>gawk</code>扩展程序，在这种情况下不可用。</p>
</div>
<hr>
<div class="header">
<p>上一页： <a href="Controlling-Array-Traversal.html#Controlling-Array-Traversal" rel="prev" accesskey="p">控制数组遍历</a> ，向上： <a href="Array-Sorting.html#Array-Sorting" rel="up" accesskey="u">数组排序</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>