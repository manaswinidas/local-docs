<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>添加代码（《 GNU Awk用户指南》）</title>

<meta name="description" content="Adding Code (The GNU Awk User’s Guide)">
<meta name="keywords" content="Adding Code (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Additions.html#Additions" rel="up" title="Additions">
<link href="New-Ports.html#New-Ports" rel="next" title="New Ports">
<link href="Accessing-The-Source.html#Accessing-The-Source" rel="prev" title="Accessing The Source">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="manual.css">


</head>

<body lang="zh-Hans" >
<a name="Adding-Code"></a>
<div class="header">
<p>下一篇： <a href="New-Ports.html#New-Ports" rel="next" accesskey="n">新端口</a> ，上一篇： <a href="Accessing-The-Source.html#Accessing-The-Source" rel="prev" accesskey="p">访问源</a> ，上一篇： <a href="Additions.html#Additions" rel="up" accesskey="u">附加</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="Adding-New-Features"></a>
<h4 class="appendixsubsec">C.2.2添加新功能</h4>

<a name="index-adding_002c-features-to-gawk"></a>
<a name="index-features_002c-adding-to-gawk"></a>
<a name="index-gawk_002c-features_002c-adding"></a>
<p>您可以随意添加任何新功能<code>gawk</code> 。但是，如果您希望将更改合并到<code>gawk</code>分发，您需要采取几个步骤才能使其包含在内：</p>
<ol>
<li>在将新功能构建到<code>gawk</code>本身，请考虑将其编写为扩展（请参阅<a href="Dynamic-Extensions.html#Dynamic-Extensions">为<code>gawk</code></a> ）。如果不可能，请继续执行此列表中的其余步骤。

</li><li>准备签署适当的文件。为了让FSF分发您的更改，您必须将这些更改放置在公共领域并为此提交已签名的声明，或者将更改中的版权分配给FSF。这两个动作都很容易实现，而且<em>很多</em>人已经这样做了。如有疑问，请与我联系（请参阅“ <a href="Bugs.html#Bugs">报告问题和错误</a> ”部分），或“在gnu dot org分配”。

</li><li>获取最新版本。如果更改是相对于最新的分布式版本的，则对我来说集成起来要容易得多。 <code>gawk</code> ，或者相对于Git存储库中的最新代码更好。如果您的版本<code>gawk</code>已经很老了，我可能根本无法整合您的更改。（请参见<a href="Getting.html#Getting">获取<code>gawk</code>发行版</a> ，获取有关获取最新版本的信息<code>gawk</code> ）

</li><li>遵循<cite>GNU编码标准</cite> 。本文档描述了如何编写GNU软件。如果您尚未阅读，请阅读，最好<em>在</em>开始修改<em>之前</em>阅读<code>gawk</code> 。（可以从GNU Project的<a href="https://www.gnu.org/prep/standards/">网站</a>获得<cite>GNU编码标准</cite> 。也提供Texinfo，Info和DVI版本。）

</li><li> <a name="index-gawk_002c-coding-style-in"></a>使用<code>gawk</code>编码风格。的C代码<code>gawk</code>遵循<cite>GNU编码标准中</cite>的指示，除少数例外。该代码使用传统的“ K＆R”样式进行格式化，尤其是在括号的放置和TAB的使用方面。简而言之， <code>gawk</code>如下面所述：<ul>
<li>定义函数时，请使用ANSI / ISO样式（原型）函数标头。

</li><li>将函数名称放在其自己的行的开头。

</li><li>使用 ' <samp>#elif</samp> '而不是嵌套' <samp>#if</samp>里面<samp>#else</samp> '。

</li><li>放置函数的返回类型，即使它是<code>int</code> ，位于函数名称和参数所在行的上方。

</li><li>在控制结构中用括号括起空格（ <code>if</code> ， <code>while</code> ， <code>for</code> ， <code>do</code> ， <code>switch</code>和<code>return</code> ）。

</li><li>请勿在函数调用中使用的括号前放置空格。

</li><li>在所有C运算符周围以及函数调用中的逗号后放置空格。

</li><li>请勿使用逗号运算符来产生多种副作用，除非<code>for</code>循环初始化和递增部分，以及在宏体内。

</li><li>使用真实的制表符缩进，而不是空格。

</li><li>使用“ K＆R”花括号布局样式。

</li><li>使用比较<code>NULL</code>和<code>'\0'</code>在以下情况下<code>if</code> ， <code>while</code>和<code>for</code>陈述，以及<code>case</code>的<code>switch</code>语句，而不仅仅是普通的指针或字符值。

</li><li>使用<code>true</code>和<code>false</code>对于<code>bool</code>价值观<code>NULL</code>指针值的符号常量和字符常量<code>'\0'</code>在适当的地方，而不是<code>1</code>和<code>0</code> 。

</li><li>为每个功能提供一行描述性注释。

</li><li>请勿使用<code>alloca()</code>用于从堆栈中分配内存的函数。与不必释放存储空间的次要好处相比，使用它会带来更多的可移植性麻烦。相反，使用<code>malloc()</code>和<code>free()</code> 。

</li><li>请勿使用以下形式的比较： <samp>! strcmp(a, b)</samp>或类似。正如亨利·斯宾塞曾经说过的： <code>strcmp()</code>不是布尔值！”而是使用' <samp>strcmp(a, b) == 0</samp> '。

</li><li>如果添加新的位标志值，请使用显式十六进制常量（ <code>0x001</code> ， <code>0x002</code> ， <code>0x004</code> ，依此类推），而不是向左移动连续的数量（' <samp>(1<<0)</samp> '，' <samp>(1<<1)</samp> '， 等等）。
</li></ul>

<blockquote>
<p><b>注意：</b>如果我必须重新格式化您的代码以遵循在中使用的编码样式<code>gawk</code> ，我可能根本不愿意整合您的更改。
</p></blockquote>

</li><li> <a name="index-Texinfo-5"></a>更新文档。连同您的新代码，请为此网页提供新的部分和/或章节。如果可能的话，请使用真实的Texinfo，而不是仅提供未格式化的ASCII文本（尽管这样做总比没有文档要好）。<cite>GAWK中</cite>应遵循的约定<cite>：有效的AWK编程</cite>在“ <samp>@bye</samp>在Texinfo源文件的末尾。如果可能，请更新<code>man</code>页面。

<p>您还必须签署文件以进行文档更改。
</p>
</li><li> <a name="index-git-utility-3"></a>将更改提交为统一差异。使用 ' <samp>diff -u -r -N</samp> '比较原版<code>gawk</code>您的版本的源代码树。我建议使用GNU版本的<code>diff</code>或最重要的是，“ <samp>git diff</samp> ' 要么 ' <samp>git format-patch</samp> '。发送产生的输出<code>diff</code>提交更改时向我发送。（有关电子邮件信息，请参阅“ <a href="Bugs.html#Bugs">报告问题和错误”</a>部分。）

<p>使用此格式，我可以轻松地将所做的更改应用于主版本<code>gawk</code>源代码（使用<code>patch</code> ）。如果必须使用文本编辑器手动应用更改，则可能不需要这样做，尤其是在有很多更改的情况下。
</p>
</li><li>包括一个条目<samp>ChangeLog</samp>文件与您的提交。这有助于进一步减少我要做的工作量，使我更容易接受补丁。如果仅将此差异作为差异的一部分，这是最简单的。
</li></ol>

<p>尽管这听起来需要做很多工作，但请记住，尽管您可能会编写新代码，但我必须对其进行维护和支持。如果我不可能用最少的额外工作来做到这一点，那么我可能不会。
</p>
<hr>
<div class="header">
<p>下一篇： <a href="New-Ports.html#New-Ports" rel="next" accesskey="n">新端口</a> ，上一篇： <a href="Accessing-The-Source.html#Accessing-The-Source" rel="prev" accesskey="p">访问源</a> ，上一篇： <a href="Additions.html#Additions" rel="up" accesskey="u">附加</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>