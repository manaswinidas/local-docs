<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Wc程序（《 GNU Awk用户指南》）</title>

<meta name="description" content="Wc Program (The GNU Awk User’s Guide)">
<meta name="keywords" content="Wc Program (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Clones.html#Clones" rel="up" title="Clones">
<link href="Miscellaneous-Programs.html#Miscellaneous-Programs" rel="next" title="Miscellaneous Programs">
<link href="Uniq-Program.html#Uniq-Program" rel="prev" title="Uniq Program">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="/software/gnulib/manual.css">


</head>

<body lang="zh-Hans" >
<a name="Wc-Program"></a>
<div class="header">
<p>上一页： <a href="Uniq-Program.html#Uniq-Program" rel="prev" accesskey="p">Uniq程序</a> ，上： <a href="Clones.html#Clones" rel="up" accesskey="u">克隆</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="Counting-Things"></a>
<h4 class="subsection">11.2.7点算</h4>


<a name="index-counting"></a>
<a name="index-input-files_002c-counting-elements-in"></a>
<a name="index-words_002c-counting"></a>
<a name="index-characters_002c-counting"></a>
<a name="index-lines_002c-counting"></a>
<a name="index-wc-utility"></a>
<p>的<code>wc</code> （单词计数）实用程序对一个或多个输入文件中的行，单词和字符进行计数。其用法如下：</p>
<div class="display">
<pre class="display"><code>wc</code> [<samp>-lwc</samp>] [<var>files</var> &hellip;]
</pre></div>

<p>如果在命令行上未指定文件， <code>wc</code>读取其标准输入。如果有多个文件，它还会打印所有文件的总数。选项及其含义如下：</p>
<dl compact>
<dt><code>-l</code></dt>
<dd><p>仅计算行数。
</p>
</dd>
<dt><code>-w</code></dt>
<dd><p>只算单词。“单词”是非空格字符的连续序列，由空格和/或TAB分隔。幸运的是，这是正常的方式<code>awk</code>在其输入数据中分隔字段。
</p>
</dd>
<dt><code>-c</code></dt>
<dd><p>仅计算字符。
</p></dd>
</dl>

<p>实施中<code>wc</code>在<code>awk</code>特别优雅，因为<code>awk</code>为我们做了很多工作；它可以将行分割成单词（即字段）并对其进行计数，还可以对行（即记录）进行计数，并且可以轻松地告诉我们行的长度。
</p>
<p>该程序使用<code>getopt()</code>库函数（请参阅“ <a href="Getopt-Function.html#Getopt-Function">处理命令行选项”一节</a> ）和文件转换函数（请参见“ <a href="Filetrans-Function.html#Filetrans-Function">注意数据文件边界”</a>一节）。
</p>
<p>这个版本与传统版本的<code>wc</code> ：它总是按顺序行，单词和字符打印计数。传统版本记下了<samp>-l</samp> ， <samp>-w</samp>和<samp>-c</samp>选项，然后按该顺序打印计数。
</p>
<p>的<code>BEGIN</code>规则执行参数处理。变量<code>print_total</code>如果在命令行上命名多个文件，则为true：</p>
<a name="index-wc_002eawk-program"></a>
<div class="example">
<pre class="example"># wc.awk --- count lines, words, characters

# Options:
#    -l    only count lines
#    -w    only count words
#    -c    only count characters
#
# Default is to count lines, words, characters
#
# Requires getopt() and file transition library functions

BEGIN {
    # let getopt() print a message about
    # invalid options. we ignore them
    while ((c = getopt(ARGC, ARGV, &quot;lwc&quot;)) != -1) {
        if (c == &quot;l&quot;)
            do_lines = 1
        else if (c == &quot;w&quot;)
            do_words = 1
        else if (c == &quot;c&quot;)
            do_chars = 1
    }
    for (i = 1; i &lt; Optind; i++)
        ARGV[i] = &quot;&quot;

    # if no options, do all
    if (! do_lines &amp;&amp; ! do_words &amp;&amp; ! do_chars)
        do_lines = do_words = do_chars = 1

    print_total = (ARGC - i &gt; 1)
}
</pre></div>

<p>的<code>beginfile()</code>功能简单；它将行，单词和字符的计数重置为零，并将当前文件名保存在<code>fname</code> ：</p>
<div class="example">
<pre class="example">function beginfile(file)
{
    lines = words = chars = 0
    fname = FILENAME
}
</pre></div>

<p>的<code>endfile()</code>函数将当前文件的编号添加到行，单词和字符的运行总计中。然后，它将打印出刚刚读取的文件的编号。它依靠<code>beginfile()</code>重置以下数据文件的编号：</p>
<div class="example">
<pre class="example">function endfile(file)
{
    tlines += lines
    twords += words
    tchars += chars
    if (do_lines)
        printf &quot;\t%d&quot;, lines
</pre><pre class="example">    if (do_words)
        printf &quot;\t%d&quot;, words
</pre><pre class="example">    if (do_chars)
        printf &quot;\t%d&quot;, chars
    printf &quot;\t%s\n&quot;, fname
}
</pre></div>

<p>每行执行一条规则。它将记录的长度加一加到<code>chars</code> 。 <a name="DOCF77" href="#FOOT77"><sup>77</sup></a>由于记录之间的换行符（ <code>RS</code> ）不是记录本身的一部分，因此不包含在记录的长度中。下一个， <code>lines</code>读取的每一行都增加，并且<code>words</code>由的值增加<code>NF</code> ，这是此行中“单词”的数量：</p>
<div class="example">
<pre class="example"># do per line
{
    chars += length($0) + 1    # get newline
    lines++
    words += NF
}
</pre></div>

<p>最后， <code>END</code>规则只打印所有文件的总数：</p>
<div class="example">
<pre class="example">END {
    if (print_total) {
        if (do_lines)
            printf &quot;\t%d&quot;, tlines
        if (do_words)
            printf &quot;\t%d&quot;, twords
        if (do_chars)
            printf &quot;\t%d&quot;, tchars
        print &quot;\ttotal&quot;
    }
}
</pre></div>

<div class="footnote">
<hr>
<h4 class="footnotes-heading">脚注</h4>

<h3><a name="FOOT77" href="#DOCF77">（77）</a></h3>
<p>因为<code>gawk</code>了解多字节语言环境，此代码计算字符，而不是字节。</p>
</div>
<hr>
<div class="header">
<p>上一页： <a href="Uniq-Program.html#Uniq-Program" rel="prev" accesskey="p">Uniq程序</a> ，上： <a href="Clones.html#Clones" rel="up" accesskey="u">克隆</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>