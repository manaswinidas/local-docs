<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>读取超时（《 GNU Awk用户指南》）</title>

<meta name="description" content="Read Timeout (The GNU Awk User’s Guide)">
<meta name="keywords" content="Read Timeout (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Reading-Files.html#Reading-Files" rel="up" title="Reading Files">
<link href="Retrying-Input.html#Retrying-Input" rel="next" title="Retrying Input">
<link href="Getline-Summary.html#Getline-Summary" rel="prev" title="Getline Summary">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="/software/gnulib/manual.css">


</head>

<body lang="zh-Hans" >
<a name="Read-Timeout"></a>
<div class="header">
<p>下一页： <a href="Retrying-Input.html#Retrying-Input" rel="next" accesskey="n">重试输入</a> ，上一篇： <a href="Getline.html#Getline" rel="prev" accesskey="p">函数getline</a> ，向上： <a href="Reading-Files.html#Reading-Files" rel="up" accesskey="u">读取文件</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">内容</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="Reading-Input-with-a-Timeout"></a>
<h3 class="section">4.11超时读取输入</h3>
<a name="index-timeout_002c-reading-input"></a>

<a name="index-differences-in-awk-and-gawk_002c-read-timeouts"></a>
<p>本节介绍了特定于<code>gawk</code> 。
</p>
<p>您可以指定超时时间（以毫秒为单位），以从键盘，管道或双向通信（包括TCP / IP套接字）读取输入。可以在每个输入，每个命令或每个连接的基础上，通过在<code>PROCINFO</code>数组（请参阅<a href="Auto_002dset.html#Auto_002dset">传达信息的内置变量</a>部分）：</p>
<div class="example">
<pre class="example">PROCINFO[&quot;input_name&quot;, &quot;READ_TIMEOUT&quot;] = <var>timeout in milliseconds</var>
</pre></div>

<p>设置时，这会导致<code>gawk</code>如果在指定的超时时间内没有数据可读取，则超时并返回失败。例如，TCP客户端可以决定在一定时间后放弃接收来自服务器的任何响应：</p>
<div class="example">
<pre class="example">Service = &quot;/inet/tcp/0/localhost/daytime&quot;
PROCINFO[Service, &quot;READ_TIMEOUT&quot;] = 100
if ((Service |&amp; getline) &gt; 0)
    print $0
else if (ERRNO != &quot;&quot;)
    print ERRNO
</pre></div>

<p>以下是在不等待五秒钟以上的情况下从用户<a name="DOCF25" href="#FOOT25"><sup>25</sup></a>进行交互读取的方法：</p>
<div class="example">
<pre class="example">PROCINFO[&quot;/dev/stdin&quot;, &quot;READ_TIMEOUT&quot;] = 5000
while ((getline &lt; &quot;/dev/stdin&quot;) &gt; 0)
    print $0
</pre></div>

<p><code>gawk</code>如果在等待超时时间后输入仍未到达，则终止读取操作，返回失败并设置<code>ERRNO</code>设置为适当的字符串值。超时值为负或零与完全不指定超时相同。
</p>
<p>还可以设置一个超时，以便在隐式循环中从键盘读取内容，该循环读取输入记录并将它们与模式进行匹配，如下所示：</p>
<div class="example">
<pre class="example">$ <kbd>gawk 'BEGIN { PROCINFO[&quot;-&quot;, &quot;READ_TIMEOUT&quot;] = 5000 }</kbd>
&gt; <kbd>{ print &quot;You entered: &quot; $0 }'</kbd>
<kbd>gawk</kbd>
-| You entered: gawk
</pre></div>

<p>在这种情况下，五秒钟内未能响应将导致以下错误消息：</p>
<div class="example">
<pre class="example">error&rarr; gawk: cmd. line:2: (FILENAME=- FNR=1) fatal: error reading input file `-': Connection timed out
</pre></div>

<p>超时可以随时设置或更改，并且在下一次尝试从输入设备读取时生效。在下面的示例中，我们以一秒的超时值开始，并逐渐将其减少十分之一秒，直到我们无限期地等待输入到达：</p>
<div class="example">
<pre class="example">PROCINFO[Service, &quot;READ_TIMEOUT&quot;] = 1000
while ((Service |&amp; getline) &gt; 0) {
    print $0
    PROCINFO[Service, &quot;READ_TIMEOUT&quot;] -= 100
}
</pre></div>

<blockquote>
<p><b>注意：</b>您不应该假定读取操作将在打印完第十条记录后完全阻塞。它可能是<code>gawk</code>会在第一次读取和缓冲一条记录中的数据。因此，像前面的示例中那样更改超时值不是很有用。
</p></blockquote>

<p>如果<code>PROCINFO</code>元素不存在，并且<code>GAWK_READ_TIMEOUT</code>存在环境变量， <code>gawk</code>使用其值初始化超时值。排他性地使用环境变量来指定超时具有无法基于每个命令或每个连接来控制它的缺点。
</p>
<p><code>gawk</code>即使超时尝试从基础设备读取可能会成功，也将超时事件视为错误。这是一个限制，也意味着您不能使用它来多路复用来自两个或多个源的输入。有关启用以后的I / O尝试成功的方法，请参阅“ <a href="Retrying-Input.html#Retrying-Input">某些输入错误后重试读取”部分</a> 。
</p>
<p>分配超时值可以防止读取操作无限期地阻塞。但请记住，还有其他方法<code>gawk</code>可以等待输入设备准备就绪。网络客户端有时可能需要很长的时间才能建立连接，然后才能开始读取任何数据，否则打开FIFO特殊文件进行读取的尝试可能会无限期地阻塞，直到其他进程打开它进行写入为止。
</p>
<div class="footnote">
<hr>
<h4 class="footnotes-heading">脚注</h4>

<h3><a name="FOOT25" href="#DOCF25">（25）</a></h3>
<p>假定标准输入是键盘。</p>
</div>
<hr>
<div class="header">
<p>下一页： <a href="Retrying-Input.html#Retrying-Input" rel="next" accesskey="n">重试输入</a> ，上一篇： <a href="Getline.html#Getline" rel="prev" accesskey="p">函数getline</a> ，向上： <a href="Reading-Files.html#Reading-Files" rel="up" accesskey="u">读取文件</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">内容</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>