<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>POSIX浮点问题（《 GNU Awk用户指南》）</title>

<meta name="description" content="POSIX Floating Point Problems (The GNU Awk User’s Guide)">
<meta name="keywords" content="POSIX Floating Point Problems (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Arbitrary-Precision-Arithmetic.html#Arbitrary-Precision-Arithmetic" rel="up" title="Arbitrary Precision Arithmetic">
<link href="Floating-point-summary.html#Floating-point-summary" rel="next" title="Floating point summary">
<link href="Checking-for-MPFR.html#Checking-for-MPFR" rel="prev" title="Checking for MPFR">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="manual.css">


</head>

<body lang="zh-Hans" >
<a name="POSIX-Floating-Point-Problems"></a>
<div class="header">
<p>下一篇： <a href="Floating-point-summary.html#Floating-point-summary" rel="next" accesskey="n">浮点摘要</a> ，上一篇： <a href="Checking-for-MPFR.html#Checking-for-MPFR" rel="prev" accesskey="p">MPFR检查</a> ，上一篇： <a href="Arbitrary-Precision-Arithmetic.html#Arbitrary-Precision-Arithmetic" rel="up" accesskey="u">任意精度算术</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="Standards-Versus-Existing-Practice"></a>
<h3 class="section">16.7标准与现有实践</h3>

<p>历史上， <code>awk</code>根据需要已将任何非数字字符串转换为数值零。此外，该语言的原始定义和原始POSIX标准还规定： <code>awk</code>仅理解十进制数字（以10为基数），而不理解八进制数字（以8为基数）或十六进制数字（以16为基数）。
</p>
<p>2001年和2004年POSIX标准的语言更改可以解释为暗示<code>awk</code>应该支持其他功能。这些功能是：</p>
<ul>
<li>解释以十六进制表示的浮点数据值（例如， <code>0xDEADBEEF</code> ）。（注意：数据值， <em>而不是</em>源代码常量。）

</li><li>支持特殊的IEEE 754浮点值“非数字”（NaN），正无穷大（“ inf”）和负无穷大（“ -inf”）。特别是，这些值的格式由ISO 1999 C标准指定，该格式忽略大小写，并且可以在'之后添加与实现相关的附加字符。 <samp>nan</samp> '并允许' <samp>inf</samp> ' 要么 ' <samp>infinity</samp> '。
</li></ul>

<p>第一个问题是，这两者都是对历史惯例的明显改变：</p>
<ul>
<li>的<code>gawk</code>维护人员认为支持十六进制浮点值尤其困难，并且最初的设计者从未打算将其作为语言的一部分。

</li><li>允许完全字母的字符串具有有效的数值也是与历史惯例的非常严重的偏离。
</li></ul>

<p>第二个问题是<code>gawk</code>维护者认为，这种对标准的解释（首先需要一定数量的“语言律师”才能做到）甚至不是标准开发人员想要的。换句话说，“我们知道您的位置，但是我们认为那不是您想要的。”
</p>
<p>认识到这些问题，但是尝试提供与该标准的早期版本的兼容性，2008 POSIX标准添加了明确的措辞，以允许但不要求<code>awk</code>支持十六进制浮点值和“非数字”和无穷大的特殊值。
</p>
<p>虽然<code>gawk</code>维护人员继续认为，尽管不建议提供这些功能，但在支持IEEE浮点的系统上，提供<em>某种</em>支持NaN和无穷大值的方法似乎是合理的。解决方案在<code>gawk</code>如下：</p>
<ul>
<li>随着<samp>--posix</samp>命令行选项<code>gawk</code>变成“放手”。字符串值直接传递到系统库的<code>strtod()</code>函数，如果成功返回一个数值，那就使用它。 <a name="DOCF102" href="#FOOT102"><sup>102</sup></a>根据定义，结果不能跨不同系统移植。它们也有些令人惊讶：<div class="example">
<pre class="example">$ <kbd>echo nanny | gawk --posix '{ print $1 + 0 }'</kbd>
-| nan
$ <kbd>echo 0xDeadBeef | gawk --posix '{ print $1 + 0 }'</kbd>
-| 3735928559
</pre></div>

</li><li>不带<samp>--posix</samp> ， <code>gawk</code>解释四个字符串值' <samp>+inf</samp> '，' <samp>-inf</samp> '，' <samp>+nan</samp> '和' <samp>-nan</samp>特别是产生相应的特殊数值。前导信号向<code>gawk</code> （和用户）该值确实是数字。不支持十六进制浮点数（除非您也使用<samp>--non-decimal-data</samp> ， <em>不</em>建议使用）。例如：<div class="example">
<pre class="example">$ <kbd>echo nanny | gawk '{ print $1 + 0 }'</kbd>
-| 0
$ <kbd>echo +nan | gawk '{ print $1 + 0 }'</kbd>
-| +nan
$ <kbd>echo 0xDeadBeef | gawk '{ print $1 + 0 }'</kbd>
-| 0
</pre></div>

<p><code>gawk</code>忽略四个特殊值中的大小写。因此， <samp>+nan</samp> '和' <samp>+NaN</samp> ' 是相同的。
</p></li></ul>

<p>除了处理输入<code>gawk</code>当值是NaN或无穷大时，还需要在输出上打印“正确”的值。对于此类值，从版本4.2.2开始<code>gawk</code>打印刚才描述的四个字符串之一： <samp>+inf</samp> '，' <samp>-inf</samp> '，' <samp>+nan</samp> '， 要么 ' <samp>-nan</samp> '。同样，在POSIX模式下， <code>gawk</code>打印系统C的结果<code>printf()</code>使用功能<code>%g</code>值的格式字符串，无论可能是什么。
</p>
<div class="footnote">
<hr>
<h4 class="footnotes-heading">脚注</h4>

<h3><a name="FOOT102" href="#DOCF102">（102）</a></h3>
<p>您要的，就知道了。</p>
</div>
<hr>
<div class="header">
<p>下一篇： <a href="Floating-point-summary.html#Floating-point-summary" rel="next" accesskey="n">浮点摘要</a> ，上一篇： <a href="Checking-for-MPFR.html#Checking-for-MPFR" rel="prev" accesskey="p">MPFR检查</a> ，上一篇： <a href="Arbitrary-Precision-Arithmetic.html#Arbitrary-Precision-Arithmetic" rel="up" accesskey="u">任意精度算术</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>