<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>固定宽度的数据（《 GNU Awk用户指南》）</title>

<meta name="description" content="Fixed width data (The GNU Awk User’s Guide)">
<meta name="keywords" content="Fixed width data (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Constant-Size.html#Constant-Size" rel="up" title="Constant Size">
<link href="Skipping-intervening.html#Skipping-intervening" rel="next" title="Skipping intervening">
<link href="Constant-Size.html#Constant-Size" rel="prev" title="Constant Size">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="/software/gnulib/manual.css">


</head>

<body lang="zh-Hans" >
<a name="Fixed-width-data"></a>
<div class="header">
<p>下一篇： <a href="Skipping-intervening.html#Skipping-intervening" rel="next" accesskey="n">跳过干预</a> ，上一篇： <a href="Constant-Size.html#Constant-Size" rel="up" accesskey="u">恒定大小</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="Processing-Fixed_002dWidth-Data"></a>
<h4 class="subsection">4.6.1处理定宽数据</h4>

<p>固定宽度数据的一个示例是数字一起运行的旧Fortran程序的输入，或未预期将其输出用作其他程序的输入的程序的输出。
</p>
<p>后者的一个示例是一张表，其中所有列都使用可变数量的空格对齐，而<em>空字段只是空格</em> 。显然， <code>awk</code>的基于<code>FS</code>在这种情况下效果不佳。虽然是便携式的<code>awk</code>程序可以使用一系列<code>substr()</code>呼吁<code>$0</code> （请参阅“ <a href="String-Functions.html#String-Functions">字符串操作函数”</a>一节），这对于大量字段而言很尴尬且效率低下。
</p>
<a name="index-troubleshooting_002c-fatal-errors_002c-field-widths_002c-specifying"></a>
<a name="index-w-utility"></a>
<a name="index-FIELDWIDTHS-variable"></a>
<a name="index-gawk_002c-FIELDWIDTHS-variable-in"></a>
<p>通过将包含空格分隔数字的字符串分配给内置变量来指定将输入记录拆分为固定宽度的字段<code>FIELDWIDTHS</code> 。每个数字指定字段的宽度， <em>包括</em>字段之间的列。如果要忽略字段之间的列，可以将宽度指定为一个单独的字段，随后将其忽略。提供具有负值的字段宽度是致命错误。
</p>
<p>以下数据是Unix的输出<code>w</code>效用。说明使用<code>FIELDWIDTHS</code> ：</p>
<div class="example">
<pre class="example"> 10:06pm  up 21 days, 14:04,  23 users
User     tty       login&nbsp; idle   JCPU   PCPU  what
hzuo     ttyV0     8:58pm            9      5  vi p24.tex
hzang    ttyV3     6:37pm    50                -csh
eklye    ttyV5     9:53pm            7      1  em thes.tex
dportein ttyV6     8:17pm  1:47                -csh
gierd    ttyD3    10:00pm     1                elm
dave     ttyD4     9:47pm            4      4  w
brent    ttyp0    26Jun91  4:46  26:46   4:41  bash
dave     ttyq4    26Jun9115days     46     46  wnewmail
</pre></div>

<p>以下程序接受此输入，将空闲时间转换为秒数，并打印出前两个字段和计算出的空闲时间：</p>
<div class="example">
<pre class="example">BEGIN  { FIELDWIDTHS = &quot;9 6 10 6 7 7 35&quot; }
NR &gt; 2 {
    idle = $4
    sub(/^ +/, &quot;&quot;, idle)   # strip leading spaces
    if (idle == &quot;&quot;)
        idle = 0
    if (idle ~ /:/) {      # hh:mm
        split(idle, t, &quot;:&quot;)
        idle = t[1] * 60 + t[2]
    }
    if (idle ~ /days/)
        idle *= 24 * 60 * 60

    print $1, $2, idle
}
</pre></div>

<blockquote>
<p><b>注意：</b>前面的程序使用了许多<code>awk</code>尚未介绍的功能。
</p></blockquote>

<p>在数据上运行程序会产生以下结果：</p>
<div class="example">
<pre class="example">hzuo      ttyV0  0
hzang     ttyV3  50
eklye     ttyV5  0
dportein  ttyV6  107
gierd     ttyD3  1
dave      ttyD4  0
brent     ttyp0  286
dave      ttyq4  1296000
</pre></div>

<p>固定宽度输入数据的另一个（可能是更实际的）示例是来自一副抽签卡的输入。在美国的某些地区，选民通过在计算机卡上打孔来标记他们的选择。然后处理这些卡片以计算任何特定候选人或任何特定问题的票数。由于投票人可能选择不对某些问题进行投票，因此卡片上的任何列都可能为空。一个<code>awk</code>处理此类数据的程序可以使用<code>FIELDWIDTHS</code>简化读取数据的功能。（当然， <code>gawk</code>在带有读卡器的系统上运行是另一回事了！）
</p>
<hr>
<div class="header">
<p>下一篇： <a href="Skipping-intervening.html#Skipping-intervening" rel="next" accesskey="n">跳过干预</a> ，上一篇： <a href="Constant-Size.html#Constant-Size" rel="up" accesskey="u">恒定大小</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>