<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>分析（《 GNU Awk用户指南》）</title>

<meta name="description" content="Profiling (The GNU Awk User’s Guide)">
<meta name="keywords" content="Profiling (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Advanced-Features.html#Advanced-Features" rel="up" title="Advanced Features">
<link href="Advanced-Features-Summary.html#Advanced-Features-Summary" rel="next" title="Advanced Features Summary">
<link href="TCP_002fIP-Networking.html#TCP_002fIP-Networking" rel="prev" title="TCP/IP Networking">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="manual.css">


</head>

<body lang="zh-Hans" >
<a name="Profiling"></a>
<div class="header">
<p>下一页： <a href="Advanced-Features-Summary.html#Advanced-Features-Summary" rel="next" accesskey="n">高级功能概述</a> ，上一个： <a href="TCP_002fIP-Networking.html#TCP_002fIP-Networking" rel="prev" accesskey="p">TCP / IP网络</a> ，最多： <a href="Advanced-Features.html#Advanced-Features" rel="up" accesskey="u">高级功能</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">内容</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="Profiling-Your-awk-Programs"></a>
<h3 class="section">12.5分析您的<code>awk</code>程式</h3>
<a name="index-awk-programs_002c-profiling"></a>
<a name="index-profiling-awk-programs"></a>
<a name="index-awkprof_002eout-file"></a>
<a name="index-files_002c-awkprof_002eout"></a>

<p>您可能会产生您的执行跟踪<code>awk</code>程式。通过传递选项来完成<samp>--profile</samp>至<code>gawk</code> 。什么时候<code>gawk</code>完成运行后，它将在名为的文件中创建程序的配置文件<samp>awkprof.out</samp> 。因为它是性能分析，所以它的执行速度也比执行速度慢45％ <code>gawk</code>通常会。
</p>
<a name="index-_002d_002dprofile-option-1"></a>
<p>如下例所示， <samp>--profile</samp>选项可用于更改文件名，其中<code>gawk</code>将写个人资料：</p>
<div class="example">
<pre class="example">gawk --profile=myprog.prof -f myprog.awk data1 data2
</pre></div>

<p>在前面的示例中， <code>gawk</code>将个人资料放在<samp>myprog.prof</samp>而不是<samp>awkprof.out</samp> 。
</p>
<p>这是一个示例会话，显示了一个简单的<code>awk</code>程序，其输入数据以及运行结果<code>gawk</code>与<samp>--profile</samp>选项。首先， <code>awk</code>程序：</p>
<div class="example">
<pre class="example">BEGIN { print &quot;First BEGIN rule&quot; }

END { print &quot;First END rule&quot; }

/foo/ {
    print &quot;matched /foo/, gosh&quot;
    for (i = 1; i &lt;= 3; i++)
        sing()
}

{
    if (/foo/)
        print &quot;if is true&quot;
    else
        print &quot;else is true&quot;
}

BEGIN { print &quot;Second BEGIN rule&quot; }

END { print &quot;Second END rule&quot; }

function sing(    dummy)
{
    print &quot;I gotta be me!&quot;
}
</pre></div>

<p>以下是输入数据：</p>
<div class="example">
<pre class="example">foo
bar
baz
foo
junk
</pre></div>

<p>这里是<samp>awkprof.out</samp>这是由于运行<code>gawk</code>关于此程序和数据的事件探查器（此示例还说明了<code>awk</code>程序员有时很早就起床工作）：</p>
<a name="index-BEGIN-pattern_002c-profiling-and"></a>
<a name="index-END-pattern_002c-profiling-and"></a>
<div class="example">
<pre class="example">    # gawk profile, created Mon Sep 29 05:16:21 2014

    # BEGIN rule(s)

    BEGIN {
 1          print &quot;First BEGIN rule&quot;
    }

    BEGIN {
 1          print &quot;Second BEGIN rule&quot;
    }

    # Rule(s)

 5  /foo/ { # 2
 2          print &quot;matched /foo/, gosh&quot;
 6          for (i = 1; i &lt;= 3; i++) {
 6                  sing()
            }
    }

 5  {
 5          if (/foo/) { # 2
 2                  print &quot;if is true&quot;
 3          } else {
 3                  print &quot;else is true&quot;
            }
    }

    # END rule(s)

    END {
 1          print &quot;First END rule&quot;
    }

    END {
 1          print &quot;Second END rule&quot;
    }


    # Functions, listed alphabetically

 6  function sing(dummy)
    {
 6          print &quot;I gotta be me!&quot;
    }
</pre></div>

<p>此示例说明了概要分析输出的许多基本功能。它们如下：</p>
<ul>
<li>程序按顺序打印<code>BEGIN</code>规则， <code>BEGINFILE</code>规则，模式行动规则， <code>ENDFILE</code>规则， <code>END</code>规则和功能，按字母顺序列出。多<code>BEGIN</code>和<code>END</code>规则保留自己的身份，多个<code>BEGINFILE</code>和<code>ENDFILE</code>规则。

</li><li> <a name="index-patterns_002c-counts_002c-in-a-profile"></a>模式行动规则有两个方面。规则左侧的第一个计数显示了<em>测试</em>该规则的模式的次数。第二个计数（在注释中规则的左括号右方）显示<em>执行</em>规则动作的次数。两者之间的差异表明规则模式评估为false的次数。

</li><li>同样地， <code>if</code> -- <code>else</code>语句显示了对该条件进行了多少次测试。在开口右侧，左括号<code>if</code>的身体是一个计数，显示条件为真的次数。计数<code>else</code>指示测试失败了多少次。

</li><li> <a name="index-loops_002c-count-for-header_002c-in-a-profile"></a>循环标头的计数（例如<code>for</code>要么<code>while</code> ）显示了执行循环测试的次数。（因此，您不能仅查看规则中第一条语句的计数来确定执行该规则的次数。如果第一个语句是循环，则计数会产生误导。）

</li><li> <a name="index-functions_002c-user_002ddefined_002c-counts_002c-in-a-profile"></a><a name="index-user_002ddefined_002c-functions_002c-counts_002c-in-a-profile"></a>对于用户定义的函数，计数旁边的计数<code>function</code>关键字指示该函数被调用了多少次。主体中语句旁边的计数显示这些语句被执行了多少次。

</li><li> <a name="index-_007b_007d-_0028braces_0029"></a><a name="index-braces-_0028_007b_007d_0029"></a>布局使用带有TAB的“ K＆R”样式。牙套无处不在，即使<code>if</code> ， <code>else</code> ，或loop只是一个语句。

</li><li> <a name="index-_0028_0029-_0028parentheses_0029_002c-in-a-profile"></a><a name="index-parentheses-_0028_0029_002c-in-a-profile"></a>括号仅在需要的地方使用，如程序的结构和优先级规则所示。例如， ' <samp>(3 + 5) * 4</samp>表示将三和五相加，然后将总数乘以四。但是， <samp>3 + 5 * 4</samp> “没有括号，表示” <samp>3 + (5 * 4)</samp> '。但是，在源程序中保留显式括号。


</li><li>括号用于以下参数<code>print</code>和<code>printf</code>只有当<code>print</code>要么<code>printf</code>语句之后是重定向。同样，如果重定向的目标不是标量，则会将其括起来。

</li><li> <code>gawk</code>在前面提供主要评论<code>BEGIN</code>和<code>END</code>规则， <code>BEGINFILE</code>和<code>ENDFILE</code>规则，模式行动规则和功能。

</li></ul>

<p>程序的概要文件版本可能看起来与编写程序时键入的完全不同。这是因为<code>gawk</code>通过“漂亮地打印”程序的内部表示来创建概要文件版本。这样做的好处是<code>gawk</code>可以产生标准表示。另外，诸如：</p>
<div class="example">
<pre class="example">/foo/
</pre></div>

<p>表现为：</p>
<div class="example">
<pre class="example">/foo/   {
    print
}
</pre></div>

<p>这是正确的，但可能出乎意料。（如果程序同时使用“ <samp>print $0</samp> '和普通' <samp>print</samp> '，则保留该区别。）
</p>
<a name="index-profiling-awk-programs_002c-dynamically"></a>
<a name="index-gawk-program_002c-dynamic-profiling"></a>
<a name="index-dynamic-profiling"></a>
<p>除了在程序完成后创建配置文件之外， <code>gawk</code>可以在运行时生成配置文件。如果您的<code>awk</code>程序进入无限循环，您想查看已执行的内容。要使用此功能，请运行<code>gawk</code>与<samp>--profile</samp>后台选项：</p>
<div class="example">
<pre class="example">$ <kbd>gawk --profile -f myprog &amp;</kbd>
[1] 13992
</pre></div>

<a name="index-kill-command_002c-dynamic-profiling"></a>
<a name="index-USR1-signal_002c-for-dynamic-profiling"></a>
<a name="index-SIGUSR1-signal_002c-for-dynamic-profiling"></a>
<a name="index-signals_002c-USR1_002fSIGUSR1_002c-for-profiling"></a>
<p>外壳打印作业号和进程ID号；在这种情况下为13992。使用<code>kill</code>命令发送<code>USR1</code>发信号给<code>gawk</code> ：</p>
<div class="example">
<pre class="example">$ <kbd>kill -USR1 13992</kbd>
</pre></div>

<p>像往常一样，将程序的概要文件版本写入<samp>awkprof.out</samp> ，或者如果使用<samp>--profile</samp>选项。
</p>
<p>如前所示，配置文件与常规配置文件一起，包含任何活动功能的跟踪：</p>
<div class="example">
<pre class="example"># Function Call Stack:

#   3. baz
#   2. bar
#   1. foo
# -- main --
</pre></div>

<p>您可以发送<code>gawk</code>的<code>USR1</code>发出任意多次的信号。每次，概要文件和函数调用跟踪都会附加到输出概要文件中。
</p>
<a name="index-HUP-signal_002c-for-dynamic-profiling"></a>
<a name="index-SIGHUP-signal_002c-for-dynamic-profiling"></a>
<a name="index-signals_002c-HUP_002fSIGHUP_002c-for-profiling"></a>
<p>如果您使用<code>HUP</code>信号而不是<code>USR1</code>信号， <code>gawk</code>生成配置文件和函数调用跟踪，然后退出。
</p>
<a name="index-INT-signal-_0028MS_002dWindows_0029"></a>
<a name="index-SIGINT-signal-_0028MS_002dWindows_0029"></a>
<a name="index-signals_002c-INT_002fSIGINT-_0028MS_002dWindows_0029"></a>
<a name="index-QUIT-signal-_0028MS_002dWindows_0029"></a>
<a name="index-SIGQUIT-signal-_0028MS_002dWindows_0029"></a>
<a name="index-signals_002c-QUIT_002fSIGQUIT-_0028MS_002dWindows_0029"></a>
<p>什么时候<code>gawk</code>在MS-Windows系统上运行，它使用<code>INT</code>和<code>QUIT</code>用于生成配置文件的信号，对于<code>INT</code>信号， <code>gawk</code>退出。这是因为这些系统不支持<code>kill</code>命令，因此可以传递给程序的唯一信号是键盘产生的信号。的<code>INT</code>信号是由<kbd>Ctrl-c</kbd>要么<kbd>Ctrl-BREAK</kbd>键，而<code>QUIT</code>信号是由<kbd>Ctrl-\</kbd>键。
</p>
<a name="index-pretty-printing-1"></a>
<p>最后， <code>gawk</code>也接受另一种选择， <samp>--pretty-print</samp> 。这样叫的话<code>gawk</code>将程序“漂亮地打印”到<samp>awkprof.out</samp> ，没有任何执行次数。
</p>
<blockquote>
<p><b>注意：</b>很久以前， <samp>--pretty-print</samp>选项也会运行您的程序。这已不再是这种情况。
</p></blockquote>

<a name="index-profiling_002c-pretty_002dprinting_002c-difference-with"></a>
<a name="index-pretty_002dprinting_002c-profiling_002c-difference-with"></a>
<p>在进行概要分析时创建的输出与在进行漂亮打印时创建的输出之间存在显着差异。打印精美的输出保留了程序中的原始注释，尽管它们的位置可能与源代码中的原始位置不完全对应。但是，任何评论都不应丢失。也， <code>gawk</code>尽最大努力保持语句末尾的注释与单独的行注释之间的区别。但是，这并不总是完美的。
</p>
<p>但是，作为有意的设计决策，概要分析输出会<em>忽略</em>原始程序的注释。这使您可以专注于执行计数数据，并有助于避免使用分析器进行漂亮打印的诱惑。
</p>
<p>此外，打印精美的输出不具有概要分析输出的前导缩进。这样，开发完成后就可以轻松地漂亮地打印代码，然后将结果用作程序的最终版本。
</p>
<p>由于您的程序的内部表示形式经过格式化，可以重新创建<code>awk</code>程序，配置文件和漂亮的打印会自动禁用<code>gawk</code>的默认优化。
</p>
<p>分析和漂亮打印还保留了数字常量的原始格式；如果您在源代码中使用了八进制或十六进制值，则它将在输出中以这种方式出现。
</p>
<hr>
<div class="header">
<p>下一页： <a href="Advanced-Features-Summary.html#Advanced-Features-Summary" rel="next" accesskey="n">高级功能概述</a> ，上一个： <a href="TCP_002fIP-Networking.html#TCP_002fIP-Networking" rel="prev" accesskey="p">TCP / IP网络</a> ，最多： <a href="Advanced-Features.html#Advanced-Features" rel="up" accesskey="u">高级功能</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">内容</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>