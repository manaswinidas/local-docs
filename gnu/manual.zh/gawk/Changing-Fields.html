<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>更改字段（《 GNU Awk用户指南》）</title>

<meta name="description" content="Changing Fields (The GNU Awk User’s Guide)">
<meta name="keywords" content="Changing Fields (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Reading-Files.html#Reading-Files" rel="up" title="Reading Files">
<link href="Field-Separators.html#Field-Separators" rel="next" title="Field Separators">
<link href="Nonconstant-Fields.html#Nonconstant-Fields" rel="prev" title="Nonconstant Fields">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="manual.css">


</head>

<body lang="zh-Hans" >
<a name="Changing-Fields"></a>
<div class="header">
<p>下一篇： <a href="Field-Separators.html#Field-Separators" rel="next" accesskey="n">字段分隔符</a> ，上一篇：非<a href="Nonconstant-Fields.html#Nonconstant-Fields" rel="prev" accesskey="p">恒定字段</a> ，上<a href="Nonconstant-Fields.html#Nonconstant-Fields" rel="prev" accesskey="p">一篇</a> ： <a href="Reading-Files.html#Reading-Files" rel="up" accesskey="u">读取文件</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="Changing-the-Contents-of-a-Field"></a>
<h3 class="section">4.4更改字段的内容</h3>

<a name="index-fields_002c-changing-contents-of"></a>
<p>字段的内容，如<code>awk</code> ，可以在<code>awk</code>程序;这改变了什么<code>awk</code>视为当前输入记录。（实际输入未触及； <code>awk</code> <em>从不</em>修改输入文件。）考虑以下示例及其输出：</p>
<div class="example">
<pre class="example">$ <kbd>awk '{ nboxes = $3 ; $3 = $3 - 10</kbd>
&gt;        <kbd>print nboxes, $3 }' inventory-shipped</kbd>
-| 25 15
-| 32 22
-| 24 14
&hellip;
</pre></div>

<p>程序首先将字段3的原始值保存在变量中<code>nboxes</code> 。' <samp>-</samp> '符号表示减法，因此该程序将重新分配字段3， <code>$3</code> ，作为字段3减去10的原始值： <samp>$3 - 10</samp> '。（请参阅<a href="Arithmetic-Ops.html#Arithmetic-Ops">算术运算符</a>部分。）然后，它打印字段3的原始值和新值。（仓库中的某个人在盘点红色框时犯了一个一致的错误。）
</p>
<p>为此，文本<code>$3</code>必须作为数字有意义；字符串必须转换为数字，以便计算机对其进行算术运算。减法得到的数字将转换回字符串，然后成为字段3。请参阅<a href="Conversion.html#Conversion">“字符串和数字的转换”</a>部分。
</p>
<p>当字段的值更改时（如<code>awk</code> ），则重新计算输入记录的文本以包含旧字段所在的新字段。换一种说法， <code>$0</code>进行更改以反映更改后的字段。因此，该程序将打印输入文件的副本，并从每行的第二个字段中减去10：</p>
<div class="example">
<pre class="example">$ <kbd>awk '{ $2 = $2 - 10; print $0 }' inventory-shipped</kbd>
-| Jan 3 25 15 115
-| Feb 5 32 24 226
-| Mar 5 24 34 228
&hellip;
</pre></div>

<p>也可以将内容分配给超出范围的字段。例如：</p>
<div class="example">
<pre class="example">$ <kbd>awk '{ $6 = ($5 + $4 + $3 + $2)</kbd>
&gt; <kbd>       print $6 }' inventory-shipped</kbd>
-| 168
-| 297
-| 301
&hellip;
</pre></div>

<a name="index-adding_002c-fields"></a>
<a name="index-fields_002c-adding"></a>
<p>我们刚刚创建<code>$6</code> ，其值为字段总和<code>$2</code> ， <code>$3</code> ， <code>$4</code>和<code>$5</code> 。' <samp>+</samp> '符号表示加法。对于文件<samp>inventory-shipped</samp> ， <code>$6</code>代表特定月份运送的包裹总数。
</p>
<p>创建新字段更改<code>awk</code>是当前输入记录的内部副本，即<code>$0</code> 。因此，如果您<samp>print $0</samp> '在添加字段之后，打印的记录包括新字段，并在该字段和以前存在的字段之间具有适当数量的字段分隔符。
</p>
<a name="index-OFS-variable"></a>
<a name="index-output-field-separator_002c-See-OFS-variable"></a>
<a name="index-field-separators_002c-See-Also-OFS"></a>
<p>此重新计算影响并受以下因素影响<code>NF</code> （字段数；请参阅“ <a href="Fields.html#Fields">检查字段”</a>一节）。例如， <code>NF</code>设置为您创建的最高字段的编号。的确切格式<code>$0</code>还受到尚未讨论的功能的影响： <em>输出字段分隔符</em> ， <code>OFS</code> ，用于分隔字段（请参阅<a href="Output-Separators.html#Output-Separators">输出分隔符</a>部分）。
</p>
<p>但是请注意，仅仅是<em>引用</em>超出范围的字段<em>没有</em>发生变化的值或者<code>$0</code>要么<code>NF</code> 。引用超出范围的字段只会产生一个空字符串。例如：</p>
<div class="example">
<pre class="example">if ($(NF+1) != &quot;&quot;)
    print &quot;can't happen&quot;
else
    print &quot;everything is normal&quot;
</pre></div>

<p>应该打印' <samp>everything is normal</samp> '，因为<code>NF+1</code>肯定超出范围。（见部分<a href="If-Statement.html#If-Statement">的<code>if</code> -- <code>else</code></a>有关更多信息的<a href="If-Statement.html#If-Statement">声明</a> <code>awk</code>的<code>if-else</code>陈述。请参阅“ <a href="Typing-and-Comparison.html#Typing-and-Comparison">变量类型和比较表达式”部分</a> ，以获取有关“ <samp>!=</samp> '运算符。）
</p>
<p>请务必注意，对现有字段进行分配会更改<code>$0</code>但不会改变<code>NF</code> ，即使您将空字符串分配给字段也是如此。例如：</p>
<div class="example">
<pre class="example">$ <kbd>echo a b c d | awk '{ OFS = &quot;:&quot;; $2 = &quot;&quot;</kbd>
&gt;                       <kbd>print $0; print NF }'</kbd>
-| a::c:d
-| 4
</pre></div>

<p>田野还在那儿。它只是一个空值，由'之间的两个冒号分隔<samp>a</samp> '和' <samp>c</samp> '。此示例显示了创建新字段时发生的情况：</p>
<div class="example">
<pre class="example">$ <kbd>echo a b c d | awk '{ OFS = &quot;:&quot;; $2 = &quot;&quot;; $6 = &quot;new&quot;</kbd>
&gt;                       <kbd>print $0; print NF }'</kbd>
-| a::c:d::new
-| 6
</pre></div>

<p>介入领域<code>$5</code>用一个空值（由第二对相邻的冒号表示）创建，并且<code>NF</code>用值六更新。
</p>
<a name="index-dark-corner_002c-NF-variable_002c-decrementing"></a>
<a name="index-NF-variable_002c-decrementing"></a>
<p>递减<code>NF</code>在的新值之后，丢弃字段的值<code>NF</code>并重新计算<code>$0</code> 。（直流）这是一个例子：</p>
<div class="example">
<pre class="example">$ <kbd>echo a b c d e f | awk '{ print &quot;NF =&quot;, NF;</kbd>
&gt; <kbd>                          NF = 3; print $0 }'</kbd>
-| NF = 6
-| a b c
</pre></div>

<a name="index-portability_002c-NF-variable_002c-decrementing"></a>
<blockquote>
<p><b>注意：</b>某些版本的<code>awk</code>不要重建<code>$0</code>什么时候<code>NF</code>递减。直到2018年8月，这包括BWK <code>awk</code> ;幸运的是，他的版本现在可以正确处理此问题。
</p></blockquote>

<p>最后，有时候强迫使用很方便<code>awk</code>使用字段的当前值重建整个记录，并<code>OFS</code> 。为此，请使用看似无害的分配：</p>
<div class="example">
<pre class="example">$1 = $1   # force record to be reconstituted
print $0  # or whatever else with $0
</pre></div>

<p>这种力量<code>awk</code>重建记录。如此处所示，它确实有助于添加评论。
</p>
<p>两者之间的关系存在另一面<code>$0</code>和领域。任何分配给<code>$0</code>导致使用<em>当前</em>值将记录重新解析为字段<code>FS</code> 。这也适用于任何更新的内置函数<code>$0</code> ， 如<code>sub()</code>和<code>gsub()</code> （请参阅“ <a href="String-Functions.html#String-Functions">字符串操作函数”</a>一节）。
</p>
<a name="index-sidebar_002c-Understanding-_00240"></a>

<table class="cartouche" border="1"><tbody><tr><td>
<div align="center"><b>理解<code>$0</code></b>
</div>


<p>重要的是要记住<code>$0</code>是<em>完整</em>记录，与从输入中读取的完全相同。这包括任何前导或尾随空格，以及分隔字段的确切空格（或其他字符）。
</p>
<p>尝试仅通过设置更改记录中的字段分隔符是一个常见错误<code>FS</code>和<code>OFS</code> ，然后期待一个简单的“ <samp>print</samp> ' 要么 ' <samp>print $0</samp> '打印修改后的记录。
</p>
<p>但这是行不通的，因为没有做任何更改记录本身的事情。相反，您必须强制重建记录，通常使用诸如“ <samp>$1 = $1</samp>如前所述。
</p></td></tr></tbody></table>


<hr>
<div class="header">
<p>下一篇： <a href="Field-Separators.html#Field-Separators" rel="next" accesskey="n">字段分隔符</a> ，上一篇：非<a href="Nonconstant-Fields.html#Nonconstant-Fields" rel="prev" accesskey="p">恒定字段</a> ，上<a href="Nonconstant-Fields.html#Nonconstant-Fields" rel="prev" accesskey="p">一篇</a> ： <a href="Reading-Files.html#Reading-Files" rel="up" accesskey="u">读取文件</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>