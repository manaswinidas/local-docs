<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>查找错误（《 GNU Awk用户指南》）</title>

<meta name="description" content="Finding The Bug (The GNU Awk User’s Guide)">
<meta name="keywords" content="Finding The Bug (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Sample-Debugging-Session.html#Sample-Debugging-Session" rel="up" title="Sample Debugging Session">
<link href="List-of-Debugger-Commands.html#List-of-Debugger-Commands" rel="next" title="List of Debugger Commands">
<link href="Debugger-Invocation.html#Debugger-Invocation" rel="prev" title="Debugger Invocation">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="manual.css">


</head>

<body lang="zh-Hans" >
<a name="Finding-The-Bug"></a>
<div class="header">
<p>上<a href="Debugger-Invocation.html#Debugger-Invocation" rel="prev" accesskey="p">一篇</a> ： <a href="Debugger-Invocation.html#Debugger-Invocation" rel="prev" accesskey="p">调试器调用</a> ，上<a href="Debugger-Invocation.html#Debugger-Invocation" rel="prev" accesskey="p">一篇</a> ： <a href="Sample-Debugging-Session.html#Sample-Debugging-Session" rel="up" accesskey="u">示例调试会话</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="Finding-the-Bug"></a>
<h4 class="subsection">14.2.2查找错误</h4>

<p>假设我们在使用时有问题（的错误版本） <samp>uniq.awk</samp>在“跳过字段”模式下，跳过第一个字段时似乎并没有捕捉到应该相同的行，例如：</p>
<div class="example">
<pre class="example">awk is a wonderful program!
gawk is a wonderful program!
</pre></div>

<p>如果我们认为记录中的字段（类似于C）是以从零开始的方式编号的，那么可能会发生这种情况，因此请使用以下行：</p>
<div class="example">
<pre class="example">clast = join(alast, fcount+1, n)
cline = join(aline, fcount+1, m)
</pre></div>

<p>我们写：</p>
<div class="example">
<pre class="example">clast = join(alast, fcount, n)
cline = join(aline, fcount, m)
</pre></div>

<p>在尝试调查此类问题时，我们通常要做的第一件事是在程序中放置一个断点，以便我们可以在工作时观察它并发现它在做什么错。断点的合理位置<samp>uniq.awk</samp>在功能的开头<code>are_equal()</code> ，它将当前行与上一行进行比较。要设置断点，请使用<code>b</code> （断点）命令：</p>
<a name="index-debugger_002c-setting-a-breakpoint"></a>
<a name="index-debugger_002c-breakpoint-command"></a>
<a name="index-debugger_002c-break-command"></a>
<a name="index-debugger_002c-b-command"></a>
<div class="example">
<pre class="example">gawk&gt; <kbd>b are_equal</kbd>
-| Breakpoint 1 set at file `awklib/eg/prog/uniq.awk', line 63
</pre></div>

<p>调试器告诉我们断点所在的文件和行号。现在输入“ <samp>r</samp> ' 要么 ' <samp>run</samp> '，程序将运行，直到它首次达到断点：</p>
<a name="index-debugger_002c-running-the-program"></a>
<a name="index-debugger_002c-run-command"></a>
<div class="example">
<pre class="example">gawk&gt; <kbd>r</kbd>
-| Starting program:
-| Stopping in Rule ...
-| Breakpoint 1, are_equal(n, m, clast, cline, alast, aline)
         at `awklib/eg/prog/uniq.awk':63
-| 63          if (fcount == 0 &amp;&amp; charcount == 0)
gawk&gt;
</pre></div>

<p>现在我们可以看看程序内部发生了什么。首先，让我们看看如何到达自己的位置。在提示符下，我们输入“ <samp>bt</samp> '（“ backtrace”的缩写），调试器以当前堆栈帧的列表作为响应：</p>
<a name="index-debugger_002c-stack-frames_002c-showing"></a>
<a name="index-debugger_002c-bt-command"></a>
<a name="index-debugger_002c-backtrace-command"></a>
<div class="example">
<pre class="example">gawk&gt; <kbd>bt</kbd>
-| #0  are_equal(n, m, clast, cline, alast, aline)
         at `awklib/eg/prog/uniq.awk':68
-| #1  in main() at `awklib/eg/prog/uniq.awk':88
</pre></div>

<p>这告诉我们<code>are_equal()</code>由主程序在第88行调用<samp>uniq.awk</samp> 。（这并不奇怪，因为这是对<code>are_equal()</code>在程序中，但是在更复杂的程序中，知道谁调用了函数以及使用什么参数可能是找到问题根源的关键。）
</p>
<p>现在我们在<code>are_equal()</code> ，我们可以开始查看一些变量的值。假设我们输入“ <samp>p n</samp> '（ <code>p</code>是“打印”的缩写）。我们希望看到的价值<code>n</code> ，是一个参数<code>are_equal()</code> 。实际上，调试器为我们提供了：</p>
<a name="index-debugger_002c-print-command"></a>
<a name="index-debugger_002c-p-command"></a>
<div class="example">
<pre class="example">gawk&gt; <kbd>p n</kbd>
-| n = untyped variable
</pre></div>

<p>在这种情况下， <code>n</code>是一个未初始化的局部变量，因为该函数是在没有参数的情况下调用的（请参见“ <a href="Function-Calls.html#Function-Calls">函数调用”</a>一节）。
</p>
<p>要显示的更有用的变量可能是当前记录：</p>
<div class="example">
<pre class="example">gawk&gt; <kbd>p $0</kbd>
-| $0 = &quot;gawk is a wonderful program!&quot;
</pre></div>

<p>起初这可能有点令人费解，因为这是我们测试输入的第二行。让我们来看看<code>NR</code> ：</p>
<div class="example">
<pre class="example">gawk&gt; <kbd>p NR</kbd>
-| NR = 2
</pre></div>

<p>所以我们可以看到<code>are_equal()</code>仅被要求用于文件的第二条记录。当然，这是因为我们的程序包含“ <samp>NR == 1</samp> '：</p>
<div class="example">
<pre class="example">NR == 1 {
    last = $0
    next
}
</pre></div>

<p>好的，让我们检查一下该规则是否正确运行：</p>
<div class="example">
<pre class="example">gawk&gt; <kbd>p last</kbd>
-| last = &quot;awk is a wonderful program!&quot;
</pre></div>

<p>到目前为止，我们所做的所有工作均已验证该程序是否按计划进行，直到并包括<code>are_equal()</code> ，因此问题必须在此函数内。为了进一步调查，我们必须开始“逐步”完成以下工作<code>are_equal()</code> 。我们首先输入“ <samp>n</samp> '（代表“下一个”）：</p>
<a name="index-debugger_002c-n-command"></a>
<a name="index-debugger_002c-next-command"></a>
<div class="example">
<pre class="example">gawk&gt; <kbd>n</kbd>
-| 66          if (fcount &gt; 0) {
</pre></div>

<p>这告诉我们<code>gawk</code>现在准备执行第66行，该行决定是否对行进行特殊的“跳场”处理，如<samp>-1</samp>命令行选项。（请注意，由于第63行中的条件，“ <samp>if (fcount == 0 && charcount == 0)</samp> '，是错误的。）
</p>
<p>继续执行步骤，现在我们将拆分当前记录和最后一条记录：</p>
<div class="example">
<pre class="example">gawk&gt; <kbd>n</kbd>
-| 67              n = split(last, alast)
gawk&gt; <kbd>n</kbd>
-| 68              m = split($0, aline)
</pre></div>

<p>在这一点上，我们应该好奇地看到记录被分割成什么，因此我们尝试查看：</p>
<div class="example">
<pre class="example">gawk&gt; <kbd>p n m alast aline</kbd>
-| n = 5
-| m = untyped variable
-| alast = array, 5 elements
-| aline = untyped variable
</pre></div>

<p>（ <code>p</code>命令可以包含多个参数，类似于<code>awk</code>的<code>print</code>声明。）
</p>
<p>但是，这有点令人失望。我们发现的只有五个元素<code>alast</code> ; <code>m</code>和<code>aline</code>没有值，因为我们在第68行，但尚未执行。该信息足够有用（我们现在知道没有一个单词被意外遗漏），但是如果我们想在数组内部看到该怎么办？
</p>
<a name="index-debugger_002c-printing-single-array-elements"></a>
<p>首选是使用下标：</p>
<div class="example">
<pre class="example">gawk&gt; <kbd>p alast[0]</kbd>
-| &quot;0&quot; not in array `alast'
</pre></div>

<p>糟糕！
</p>
<div class="example">
<pre class="example">gawk&gt; <kbd>p alast[1]</kbd>
-| alast[&quot;1&quot;] = &quot;awk&quot;
</pre></div>

<p>但是，对于100个成员的数组，这有点慢<code>gawk</code>提供快捷方式（让人想起另一种语言）：</p>
<a name="index-debugger_002c-printing-all-array-elements"></a>
<div class="example">
<pre class="example">gawk&gt; <kbd>p @alast</kbd>
-| alast[&quot;1&quot;] = &quot;awk&quot;
-| alast[&quot;2&quot;] = &quot;is&quot;
-| alast[&quot;3&quot;] = &quot;a&quot;
-| alast[&quot;4&quot;] = &quot;wonderful&quot;
-| alast[&quot;5&quot;] = &quot;program!&quot;
</pre></div>

<p>看来我们到此为止还可以。让我们再走一两个步骤：</p>
<div class="example">
<pre class="example">gawk&gt; <kbd>n</kbd>
-| 69              clast = join(alast, fcount, n)
gawk&gt; <kbd>n</kbd>
-| 70              cline = join(aline, fcount, m)
</pre></div>

<p>好吧，这是我们的错（很抱歉破坏了悬念）。我们想到的是从第二个字段开始加入字段以进行虚拟记录比较，如果第一个字段编号为零，则可以正常工作。让我们看看我们有什么：</p>
<div class="example">
<pre class="example">gawk&gt; <kbd>p cline clast</kbd>
-| cline = &quot;gawk is a wonderful program!&quot;
-| clast = &quot;awk is a wonderful program!&quot;
</pre></div>

<p>嘿，那些看起来很熟悉！它们只是我们原始的，未更改的输入记录。稍加思考（人脑仍然是最好的调试工具），我们意识到我们相距甚远！
</p>
<p>我们离开了调试器：</p>
<div class="example">
<pre class="example">gawk&gt; <kbd>q</kbd>
-| The program is running. Exit anyway (y/n)? <kbd>y</kbd>
</pre></div>

<p>然后我们进入编辑器：</p>
<div class="example">
<pre class="example">clast = join(alast, fcount+1, n)
cline = join(aline, fcount+1, m)
</pre></div>

<p>问题解决了！
</p>
<hr>
<div class="header">
<p>上<a href="Debugger-Invocation.html#Debugger-Invocation" rel="prev" accesskey="p">一篇</a> ： <a href="Debugger-Invocation.html#Debugger-Invocation" rel="prev" accesskey="p">调试器调用</a> ，上<a href="Debugger-Invocation.html#Debugger-Invocation" rel="prev" accesskey="p">一篇</a> ： <a href="Sample-Debugging-Session.html#Sample-Debugging-Session" rel="up" accesskey="u">示例调试会话</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>