<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>就地扩展示例（《 GNU Awk用户指南》）</title>

<meta name="description" content="Extension Sample Inplace (The GNU Awk User’s Guide)">
<meta name="keywords" content="Extension Sample Inplace (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Extension-Samples.html#Extension-Samples" rel="up" title="Extension Samples">
<link href="Extension-Sample-Ord.html#Extension-Sample-Ord" rel="next" title="Extension Sample Ord">
<link href="Extension-Sample-Fork.html#Extension-Sample-Fork" rel="prev" title="Extension Sample Fork">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="/software/gnulib/manual.css">


</head>

<body lang="zh-Hans" >
<a name="Extension-Sample-Inplace"></a>
<div class="header">
<p>下一个： <a href="Extension-Sample-Ord.html#Extension-Sample-Ord" rel="next" accesskey="n">扩展样本Ord</a> ，上一个： <a href="Extension-Sample-Fork.html#Extension-Sample-Fork" rel="prev" accesskey="p">扩展样本叉</a> ，上： <a href="Extension-Samples.html#Extension-Samples" rel="up" accesskey="u">扩展样本</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="Enabling-In_002dPlace-File-Editing"></a>
<h4 class="subsection">17.7.4启用就地文件编辑</h4>

<a name="index-inplace-extension"></a>
<p>的<code>inplace</code>扩展模拟GNU <code>sed</code>的<samp>-i</samp>选项，对每个输入文件执行“就地”编辑。它使用捆绑<samp>inplace.awk</samp>包含文件以正确调用扩展名。此扩展程序使用命名空间工具将所有变量和函数放置在<code>inplace</code>命名空间（参见<a href="Namespaces.html#Namespaces">命名空间中<code>gawk</code></a> ）：</p>
<div class="example">
<pre class="example"># inplace --- load and invoke the inplace extension.

@load &quot;inplace&quot;

# Please set inplace::suffix to make a backup copy.  For example, you may
# want to set inplace::suffix to .bak on the command line or in a BEGIN rule.

# By default, each filename on the command line will be edited inplace.
# But you can selectively disable this by adding an inplace=0 argument
# prior to files that you do not want to process this way.  You can then
# reenable it later on the commandline by putting inplace=1 before files
# that you wish to be subject to inplace editing.

# N.B. We call inplace::end() in the BEGINFILE and END rules so that any
# actions in an ENDFILE rule will be redirected as expected.

@namespace &quot;inplace&quot;
</pre><pre class="example">

</pre><pre class="example">BEGIN {
    enable = 1         # enabled by default
}
</pre><pre class="example">

</pre><pre class="example">BEGINFILE {
    if (filename != &quot;&quot;)
        end(filename, suffix)
    if (enable)
        begin(filename = FILENAME, suffix)
    else
        filename = &quot;&quot;
}
</pre><pre class="example">

</pre><pre class="example">END {
    if (filename != &quot;&quot;)
        end(filename, suffix)
}
</pre></div>

<p>对于每个已处理的常规文件，扩展名将标准输出重定向到配置为具有与原始所有者相同的所有者和权限的临时文件。处理完文件后，扩展名将标准输出恢复到其原始目的地。如果<code>inplace::suffix</code>不是空字符串，原始文件链接到通过附加该后缀创建的备份文件名。最后，临时文件被重命名为原始文件名。
</p>
<p>请注意，可以通过放置“ <samp>inplace::enable=0</samp>在列出不应该以这种方式处理的文件之前，请先在命令行上输入'。您可以通过添加“ <samp>inplace::enable=1</samp> '参数位于应进行就地编辑的文件之前。
</p>
<p>的<code>inplace::filename</code>变量用于跟踪当前文件名，以便不调用<code>inplace::end()</code>在处理第一个文件之前。
</p>
<p>如果发生任何错误，扩展名将发出致命错误，以立即终止处理而不会损坏原始文件。
</p>
<p>以下是一些简单的示例：</p>
<div class="example">
<pre class="example">$ <kbd>gawk -i inplace '{ gsub(/foo/, &quot;bar&quot;) }; { print }' file1 file2 file3</kbd>
</pre></div>

<p>要保留原始文件的备份副本，请尝试以下操作：</p>
<div class="example">
<pre class="example">$ <kbd>gawk -i inplace -v inplace::suffix=.bak '{ gsub(/foo/, &quot;bar&quot;) }</kbd>
&gt; <kbd>{ print }' file1 file2 file3</kbd>
</pre></div>

<p>请注意，尽管扩展名确实尝试保留所有权和权限，但并未尝试从原始文件复制ACL。
</p>
<p>如果程序过早终止（如收到未处理的信号可能会发生），则可能会留下一个临时文件。
</p>
<hr>
<div class="header">
<p>下一个： <a href="Extension-Sample-Ord.html#Extension-Sample-Ord" rel="next" accesskey="n">扩展样本Ord</a> ，上一个： <a href="Extension-Sample-Fork.html#Extension-Sample-Fork" rel="prev" accesskey="p">扩展样本叉</a> ，上： <a href="Extension-Samples.html#Extension-Samples" rel="up" accesskey="u">扩展样本</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>