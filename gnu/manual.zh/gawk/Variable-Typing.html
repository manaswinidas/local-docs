<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>变量键入（《 GNU Awk用户指南》）</title>

<meta name="description" content="Variable Typing (The GNU Awk User’s Guide)">
<meta name="keywords" content="Variable Typing (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Typing-and-Comparison.html#Typing-and-Comparison" rel="up" title="Typing and Comparison">
<link href="Comparison-Operators.html#Comparison-Operators" rel="next" title="Comparison Operators">
<link href="Typing-and-Comparison.html#Typing-and-Comparison" rel="prev" title="Typing and Comparison">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="/software/gnulib/manual.css">


</head>

<body lang="zh-Hans" >
<a name="Variable-Typing"></a>
<div class="header">
<p>下一页： <a href="Comparison-Operators.html#Comparison-Operators" rel="next" accesskey="n">比较运算符</a> ，上一篇： <a href="Typing-and-Comparison.html#Typing-and-Comparison" rel="up" accesskey="u">键入和比较</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="String-Type-versus-Numeric-Type"></a>
<h4 class="subsubsection">6.3.2.1字符串类型与数字类型</h4>

<p>标量对象<code>awk</code> （变量，数组元素和字段）是<em>动态</em>类型的。这意味着它们的类型可以随着程序的运行而改变，从任何使用前的<em>无类型</em>变为<a name="DOCF32" href="#FOOT32"><sup>32</sup></a>到字符串或数字，然后随着程序的进行从字符串到数字或数字到字符串。 （ <code>gawk</code>还提供了正则表达式类型的标量，但现在让我们忽略它；请参阅<a href="Strong-Regexp-Constants.html#Strong-Regexp-Constants">强类型的正则表达式常量</a> 。）
</p>
<p>您不能对无类型变量做很多事情，只能告诉他们无类型。以下程序测试<code>a</code>反对<code>""</code>和<code>0</code> ;测试何时成功<code>a</code>从未被赋值。它还使用内置的<code>typeof()</code>函数（尚未显示；请参阅“ <a href="Type-Functions.html#Type-Functions">获取类型信息”</a>一节）以显示<code>a</code>的类型：</p>
<div class="example">
<pre class="example">$ <kbd>gawk 'BEGIN { print (a == &quot;&quot; &amp;&amp; a == 0 ?</kbd>
&gt; <kbd>&quot;a is untyped&quot; : &quot;a has a type!&quot;) ; print typeof(a) }'</kbd>
-| a is untyped
-| unassigned
</pre></div>

<p>标量在分配数值时具有数值类型，例如来自数字常量或具有数值类型的另一个标量：</p>
<div class="example">
<pre class="example">$ <kbd>gawk 'BEGIN { a = 42 ; print typeof(a)</kbd>
&gt; <kbd>b = a ; print typeof(b) }'</kbd>
number
number
</pre></div>

<p>类似地，一个标量在分配一个字符串值时具有字符串类型，例如来自一个字符串常量或来自另一个具有字符串类型的标量：</p>
<div class="example">
<pre class="example">$ <kbd>gawk 'BEGIN { a = &quot;forty two&quot; ; print typeof(a)</kbd>
&gt; <kbd>b = a ; print typeof(b) }'</kbd>
string
string
</pre></div>

<p>到目前为止，这一切都很简单明了。但是，什么时候发生<code>awk</code>必须处理用户的数据？让我们从现场数据开始。以下命令应产生什么输出？
</p>
<div class="example">
<pre class="example">echo hello | awk '{ printf(&quot;%s %s &lt; 42\n&quot;, $1,
                           ($1 &lt; 42 ? &quot;is&quot; : &quot;is not&quot;)) }'
</pre></div>

<p>由于“ <samp>hello</samp> '是字母数据， <code>awk</code>只能做一个字符串比较。在内部，它会转换<code>42</code>进入<code>"42"</code>并比较两个字符串值<code>"hello"</code>和<code>"42"</code> 。结果如下：</p>
<div class="example">
<pre class="example">$ <kbd>echo hello | awk '{ printf(&quot;%s %s &lt; 42\n&quot;, $1,</kbd>
&gt; <kbd>                           ($1 &lt; 42 ? &quot;is&quot; : &quot;is not&quot;)) }'</kbd>
-| hello is not &lt; 42
</pre></div>

<p>但是，当来自用户的数据<em>看起来像</em>数字时会发生什么？一方面，实际上，输入数据由字符组成，而不是二进制数值。但是，另一方面，数据看起来是数字的，并且<code>awk</code>真的应该这样对待它。实际上，它确实：</p>
<div class="example">
<pre class="example">$ <kbd>echo 37 | awk '{ printf(&quot;%s %s &lt; 42\n&quot;, $1,</kbd>
&gt; <kbd>                        ($1 &lt; 42 ? &quot;is&quot; : &quot;is not&quot;)) }'</kbd>
-| 37 is &lt; 42
</pre></div>

<p>这是什么时候的规则<code>awk</code>将数据视为数字，以及何时将数据视为字符串。
</p>
<a name="index-numeric_002c-strings"></a>
<a name="index-strings_002c-numeric"></a>
<a name="index-POSIX-awk_002c-numeric-strings-and"></a>
<p>POSIX标准将术语<em>数字字符串</em>用于看起来是数字的输入数据。' <samp>37</samp>上例中的'是数字字符串。那么数字字符串的类型是什么？答：数字。
</p>
<p>变量的类型很重要，因为两个变量的类型决定了如何比较它们。变量类型遵循以下定义和规则：</p>
<ul>
<li>数字常数或数字运算的结果具有<em>numeric</em>属性。

</li><li>字符串常量或字符串操作的结果具有<em>string</em>属性。

</li><li>领域<code>getline</code>输入， <code>FILENAME</code> ， <code>ARGV</code>元素， <code>ENVIRON</code>元素，以及由创建的数组的元素<code>match()</code> ， <code>split()</code>和<code>patsplit()</code>数字字符串具有<em>strnum</em>属性。 <a name="DOCF33" href="#FOOT33"><sup>33</sup></a>否则，它们具有<em>字符串</em>属性。未初始化的变量也具有<em>strnum</em>属性。

</li><li>属性在分配之间传播，但不会因使用而改变。
</li></ul>

<p>最后一条规则特别重要。在以下程序中<code>a</code>具有数字类型，即使稍后在字符串操作中使用它也是如此：</p>
<div class="example">
<pre class="example">BEGIN {
     a = 12.345
     b = a &quot; is a cute number&quot;
     print b
}
</pre></div>

<p>比较两个操作数时，可以使用字符串比较或数字比较。根据以下对称矩阵，这取决于操作数的属性：</p>
<pre class="verbatim">        +----------------------------------------------
        |       STRING          NUMERIC         STRNUM
--------+----------------------------------------------
        |
STRING  |       string          string          string
        |
NUMERIC |       string          numeric         numeric
        |
STRNUM  |       string          numeric         numeric
--------+----------------------------------------------
</pre>
<p>基本思想是，看起来像数字的用户输入（ <em>仅</em>用户输入）应该被视为数字，即使它实际上是由字符组成的，因此也是字符串。因此，例如，字符串常量<code>" +3.14"</code> <!-- /@w -->出现在程序源代码中时，它是一个字符串（即使看起来是数字），也<em>绝不会</em>被视为用于比较的数字。
</p>
<p>简而言之，当一个操作数是“纯”字符串（例如字符串常量）时，将执行字符串比较。否则，将执行数字比较。（数字和strnum之间的主要区别在于strnum <code>gawk</code>保留标量输入时的原始字符串值。）
</p>
<p>这一点需要进一步强调：看起来像数字的输入<em>是</em>数字。所有其他输入均视为字符串。
</p>
<p>因此，六个字符的输入字符串' <samp> +3.14</samp> ' <!-- /@w -->接收strnum属性。相比之下，八个字符<code>" +3.14"</code>出现在程序文本中的<!-- /@w -->包含一个字符串常量。以下示例打印“ <samp>1</samp> '当两个不同的常数之间的比较为真时，' <samp>0</samp> ' 除此以外：</p>
<div class="example">
<pre class="example">$ <kbd>echo ' +3.14' | awk '{ print($0 == &quot; +3.14&quot;) }'</kbd>    <i>True</i>
-| 1
$ <kbd>echo ' +3.14' | awk '{ print($0 == &quot;+3.14&quot;) }'</kbd>     <i>False</i>
-| 0
$ <kbd>echo ' +3.14' | awk '{ print($0 == &quot;3.14&quot;) }'</kbd>      <i>False</i>
-| 0
$ <kbd>echo ' +3.14' | awk '{ print($0 == 3.14) }'</kbd>        <i>True</i>
-| 1
$ <kbd>echo ' +3.14' | awk '{ print($1 == &quot; +3.14&quot;) }'</kbd>    <i>False</i>
-| 0
$ <kbd>echo ' +3.14' | awk '{ print($1 == &quot;+3.14&quot;) }'</kbd>     <i>True</i>
-| 1
$ <kbd>echo ' +3.14' | awk '{ print($1 == &quot;3.14&quot;) }'</kbd>      <i>False</i>
-| 0
$ <kbd>echo ' +3.14' | awk '{ print($1 == 3.14) }'</kbd>        <i>True</i>
-| 1
</pre></div>

<p>您可以使用以下命令查看输入字段（或其他用户输入）的类型<code>typeof()</code> ：</p>
<div class="example">
<pre class="example">$ <kbd>echo hello 37 | gawk '{ print typeof($1), typeof($2) }'</kbd>
-| string strnum
</pre></div>

<div class="footnote">
<hr>
<h4 class="footnotes-heading">脚注</h4>

<h3><a name="FOOT32" href="#DOCF32">（32）</a></h3>
<p><code>gawk</code>称为<em>unassigned</em> ，如以下示例所示。</p>
<h3><a name="FOOT33" href="#DOCF33">（33）</a></h3>
<p>因此，POSIX数字字符串和<code>gawk</code>的strnum是同一回事。</p>
</div>
<hr>
<div class="header">
<p>下一页： <a href="Comparison-Operators.html#Comparison-Operators" rel="next" accesskey="n">比较运算符</a> ，上一篇： <a href="Typing-and-Comparison.html#Typing-and-Comparison" rel="up" accesskey="u">键入和比较</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>