<html ><!-- 
Copyright (C) 1989, 1991, 1992, 1993, 1996-2005, 2007, 2009-2019 

Free Software Foundation, Inc.



This is Edition 5.0 of GAWK: Effective AWK Programming: A User's Guide for GNU Awk,
for the 5.0.0 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.
A copy of the license is included in the section entitled
"GNU Free Documentation License".

a. The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." --><!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ --><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>按内容拆分（《 GNU Awk用户指南》）</title>

<meta name="description" content="Splitting By Content (The GNU Awk User’s Guide)">
<meta name="keywords" content="Splitting By Content (The GNU Awk User’s Guide)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Reading-Files.html#Reading-Files" rel="up" title="Reading Files">
<link href="Testing-field-creation.html#Testing-field-creation" rel="next" title="Testing field creation">
<link href="Fields-with-fixed-data.html#Fields-with-fixed-data" rel="prev" title="Fields with fixed data">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>
<link rel="stylesheet" type="text/css" href="manual.css">


</head>

<body lang="zh-Hans" >
<a name="Splitting-By-Content"></a>
<div class="header">
<p>下一页： <a href="Testing-field-creation.html#Testing-field-creation" rel="next" accesskey="n">测试字段创建</a> ，上一页：固定<a href="Constant-Size.html#Constant-Size" rel="prev" accesskey="p">大小</a> ，向上： <a href="Reading-Files.html#Reading-Files" rel="up" accesskey="u">读取文件</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>
<hr>
<a name="Defining-Fields-by-Content"></a>
<h3 class="section">4.7按内容定义字段</h3>

<p>本节讨论了高级功能<code>gawk</code> 。如果您是新手<code>awk</code>用户，您可能想在第一次阅读时跳过它。
</p>
<a name="index-advanced-features_002c-specifying-field-content"></a>
<p>通常，当使用<code>FS</code> ， <code>gawk</code>将字段定义为出现在每个字段分隔符之间的记录部分。换一种说法， <code>FS</code>定义一个字段<em>是没有</em>什么，而不是一个领域<em>是</em>什么。但是，有时候您确实想根据字段的含义而不是不是字段的含义来定义字段。
</p>
<p>最臭名昭著的情况是所谓的<em>逗号分隔值</em> （CSV）数据。例如，许多电子表格程序都可以将其数据导出到文本文件中，其中每个记录都以换行符终止，并且字段之间用逗号分隔。如果仅用逗号分隔数据，则不会有问题。当其中一个字段包含<em>嵌入式</em>逗号时，就会出现问题。在这种情况下，大多数程序会将字段嵌入在双引号中。 <a name="DOCF23" href="#FOOT23"><sup>23</sup></a>因此，我们可能会有如下数据：</p>
<div class="example">
<pre class="example">Robbins,Arnold,&quot;1234 A Pretty Street, NE&quot;,MyTown,MyState,12345-6789,USA
</pre></div>

<a name="index-gawk_002c-FPAT-variable-in"></a>
<a name="index-FPAT-variable"></a>
<p>的<code>FPAT</code>变量为这种情况提供了解决方案。的价值<code>FPAT</code>应该是提供正则表达式的字符串。此正则表达式描述每个字段的内容。
</p>
<p>对于此处显示的CSV数据，每个字段要么是“不是逗号的任何内容”，要么是“双引号，不是双引号的任何内容，再加上双引号。”如果写成正则表达式不变（见<a href="Regexp.html#Regexp">正则表达式</a> ），我们将有<code>/([^,]+)|("[^"]+")/</code> 。将其写为字符串需要我们转义双引号，从而导致：</p>
<div class="example">
<pre class="example">FPAT = &quot;([^,]+)|(\&quot;[^\&quot;]+\&quot;)&quot;
</pre></div>

<p>使用此功能，这是一个解析数据的简单程序：</p>
<div class="example">
<pre class="example">BEGIN {
    FPAT = &quot;([^,]+)|(\&quot;[^\&quot;]+\&quot;)&quot;
}
</pre><pre class="example">

</pre><pre class="example">{
    print &quot;NF = &quot;, NF
    for (i = 1; i &lt;= NF; i++) {
        printf(&quot;$%d = &lt;%s&gt;\n&quot;, i, $i)
    }
}
</pre></div>

<p>运行时，我们得到以下信息：</p>
<div class="example">
<pre class="example">$ <kbd>gawk -f simple-csv.awk addresses.csv</kbd>
NF =  7
$1 = &lt;Robbins&gt;
$2 = &lt;Arnold&gt;
$3 = &lt;&quot;1234 A Pretty Street, NE&quot;&gt;
$4 = &lt;MyTown&gt;
$5 = &lt;MyState&gt;
$6 = &lt;12345-6789&gt;
$7 = &lt;USA&gt;
</pre></div>

<p>注意值中的嵌入式逗号<code>$3</code> 。
</p>
<p>处理此类CSV数据时，一个直接的改进就是使用引号将引号删除，例如：</p>
<div class="example">
<pre class="example">if (substr($i, 1, 1) == &quot;\&quot;&quot;) {
    len = length($i)
    $i = substr($i, 2, len - 2)    # Get text within the two quotes
}
</pre></div>

<p>与<code>FS</code> ， <code>IGNORECASE</code>变量（请参阅<a href="User_002dmodified.html#User_002dmodified">控制的内置</a>变量部分<a href="User_002dmodified.html#User_002dmodified"><code>awk</code></a> ）影响<code>FPAT</code> 。
</p>
<p>将值分配给<code>FPAT</code>覆盖字段拆分<code>FS</code>与<code>FIELDWIDTHS</code> 。
</p>
<blockquote>
<p><b>注意：</b>某些程序会导出CSV数据，该数据包含双引号之间的嵌入换行符。 <code>gawk</code>无法提供解决方法。即使存在CSV数据的正式规范，也没有更多要做的事情。的<code>FPAT</code>该机制为大多数情况提供了一种优雅的解决方案，并且<code>gawk</code>开发人员对此感到满意。
</p></blockquote>

<p>如所写，正则表达式用于<code>FPAT</code>要求每个字段至少包含一个字符。直观的修改（更改第一个“ <samp>+</samp> ' 至 ' <samp>*</samp> '）允许字段为空：</p>
<div class="example">
<pre class="example">FPAT = &quot;([^,]*)|(\&quot;[^\&quot;]+\&quot;)&quot;
</pre></div>


<p>最后， <code>patsplit()</code> function使相同的功能可用于拆分常规字符串（请参阅“ <a href="String-Functions.html#String-Functions">字符串操作函数”</a>一节）。
</p>
<div class="footnote">
<hr>
<h4 class="footnotes-heading">脚注</h4>

<h3><a name="FOOT23" href="#DOCF23">（23）</a></h3>
<p>多年来，CSV格式缺乏正式的标准定义。
<a href="http://www.ietf.org/rfc/rfc4180.txt">RFC 4180</a>标准化了最常见的做法。</p>
</div>
<hr>
<div class="header">
<p>下一页： <a href="Testing-field-creation.html#Testing-field-creation" rel="next" accesskey="n">测试字段创建</a> ，上一页：固定<a href="Constant-Size.html#Constant-Size" rel="prev" accesskey="p">大小</a> ，向上： <a href="Reading-Files.html#Reading-Files" rel="up" accesskey="u">读取文件</a> [ <a href="index.html#SEC_Contents" title="目录" rel="contents">目录</a> ] [ <a href="Index.html#Index" title="指数" rel="index">索引</a> ]</p>
</div>





</body></html>