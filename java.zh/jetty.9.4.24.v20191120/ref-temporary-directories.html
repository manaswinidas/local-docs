<html ><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>临时目录</title><link rel="stylesheet" type="text/css" href="css/docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="jetty, servlet, servlet-api, cometd, http, websocket, eclipse, maven, java, server, software"><link rel="home" href="index.html" title="Jetty"><link rel="up" href="configuring-contexts.html" title="Chapter 5. Configuring Contexts"><link rel="prev" href="configuring-virtual-hosts.html" title="Configuring Virtual Hosts"><link rel="next" href="serving-webapp-from-particular-port.html" title="Serving a WebApp from a Particular Port/Connector"><link rel="shortcut icon" href="images/favicon.ico" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><link rel="stylesheet" href="css/highlighter/foundation.css"><script src="js/highlight.pack.js"></script><script>
      hljs.initHighlightingOnLoad();
    </script><link type="text/css" rel="stylesheet" href="css/font-awesome/font-awesome.min.css"></head><body bgcolor="white"  text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><tbody><tr><td style="width:25%"><a href="http://www.eclipse.org/jetty"><img src="images/jetty-header-logo.png" alt="Jetty标志"></a><br><span style="font-size:small">版本：9.4.24.v20191120</span></td><td style="width:50%"></td></tr></tbody></table><div class="navheader" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><table width="100%" summary="Navigation header"><tbody><tr><th colspan="3" align="center">临时目录</th></tr><tr><td width="20%" align="left"><a href="configuring-virtual-hosts.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><th width="60%" align="center">第五章配置上下文<br><a href="index.html" accesskey="p"><i class="fa fa-home" aria-hidden="true"></i>家</a></th><td width="20%" align="right"> <a href="serving-webapp-from-particular-port.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr></tbody></table><hr></div><div class="jetty-callout" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><h5 class="callout"><a href="http://www.webtide.com/">通过<span class="website">www.webtide.com</span>与Jetty核心开发人员联系。</a></h5><p>内部/客户项目的私人支持...自定义扩展和发行版...无限期支持的版本快照...您的应用程序和Ajax / Comet项目的可伸缩性指南...赞助功能开发的开发服务</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear:both"><a name="ref-temporary-directories"></a>临时目录</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="ref-temporary-directories.html#_the_default_temp_directory">默认临时目录</a></span></dt><dt><span class="section"><a href="ref-temporary-directories.html#_setting_a_specific_temp_directory">设置特定的临时目录</a></span></dt><dt><span class="section"><a href="ref-temporary-directories.html#_the_work_directory">“工作”目录</a></span></dt><dt><span class="section"><a href="ref-temporary-directories.html#_persisting_the_temp_directory">保留临时目录</a></span></dt></dl></div><p>Jetty本身没有临时目录，但是您可以为每个Web应用程序分配一个目录，WAR被解压缩到该目录中，即时编译JSP，等等。如果您不分配特定的临时目录，Jetty将创建一个Web应用程序启动时需要。无论是设置临时目录的位置-还是让Jetty为您创建一个-您都可以选择在Web应用程序停止时保留或删除临时目录。</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_the_default_temp_directory"></a>默认临时目录</h3></div></div></div><p>默认情况下，Jetty将为每个Web应用程序创建一个临时目录。目录名称将采用以下格式：</p><pre class="literallayout">"jetty-"+host+"-"+port+"-"+resourceBase+"-_"+context+"-"+virtualhost+"-"+randomdigits+".dir"</pre><p>例如：</p><pre class="literallayout">jetty-0.0.0.0-8080-test.war-_test-any-8900275691885214790.dir</pre><p>哪里<code class="literal">0.0.0.0</code>是主机地址， <code class="literal">8080</code>是港口， <code class="literal">test.war</code>是resourceBase， <code class="literal">test</code>是上下文路径（将/转换为_）， <code class="literal">any</code>是虚拟主机，并且<code class="literal">randomdigits</code>是一串保证唯一的数字。</p><p>创建临时目录后，可以将其作为上下文属性的值（作为文件）进行检索<code class="literal">javax.servlet.context.tempdir.</code></p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_the_location_of_the_temp_directory"></a>临时目录的位置</h4></div></div></div><p>默认情况下，Jetty会在由<code class="literal">java.io.tmpdir</code>系统属性。您可以通过设置context属性指示Jetty使用其他父目录<code class="literal">org.eclipse.jetty.webapp.basetempdir</code>到所需父目录的名称。该属性命名的目录<span class="emphasis"><em>必须</em></span>存在并且是<span class="emphasis"><em>可写的</em></span> 。</p><p>与Jetty一样，您可以在上下文xml文件中设置此属性，也可以在代码中进行设置。</p><p>这是在xml文件中进行设置的示例：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;Configure class="org.eclipse.jetty.webapp.WebAppContext"&gt;

  &lt;Set name="contextPath"&gt;/test&lt;/Set&gt;
  &lt;Set name="war"&gt;foo.war&lt;/Set&gt;

  &lt;Call name="setAttribute"&gt;
    &lt;Arg&gt;org.eclipse.jetty.webapp.basetempdir&lt;/Arg&gt;
    &lt;Arg&gt;/home/my/foo&lt;/Arg&gt;
  &lt;/Call&gt;
&lt;/Configure&gt;</code></pre><p>代码中的等效项是：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>WebAppContext context = new WebAppContext();
context.setContextPath("/test");
context.setWar("foo.war");
context.setAttribute("org.eclipse.jetty.webapp.basetempdir", "/tmp/foo");</code></pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_setting_a_specific_temp_directory"></a>设置特定的临时目录</h3></div></div></div><p>有几种方法可以将特定目录用作临时目录：</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_call_webappcontext_settempdirectory_string_dir"></a>调用WebAppContext.setTempDirectory（String dir）</h4></div></div></div><p>与以前一样，可以使用XML文件或直接在代码中完成此操作。这是在XML中设置临时目录的示例：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;Configure class="org.eclipse.jetty.webapp.WebAppContext"&gt;

  &lt;Set name="contextPath"&gt;/test&lt;/Set&gt;
  &lt;Set name="war"&gt;foo.war&lt;/Set&gt;

  &lt;Set name="tempDirectory"&gt;/some/dir/foo&lt;/Set&gt;
&lt;/Configure&gt;</code></pre><p>这是使用Java代码执行此操作的示例：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>WebAppContext context = new WebAppContext();
context.setContextPath("/test");
context.setWar("foo.war");
context.setTempDirectory(new File("/some/dir/foo"));</code></pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_setting_the_javax_servlet_context_tempdir_context_attribute"></a>设置javax.servlet.context.tempdir上下文属性</h4></div></div></div><p>您应该使用要用作临时目录的目录名称来设置此上下文属性。同样，您可以使用XML进行此操作：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;Configure class="org.eclipse.jetty.webapp.WebAppContext"&gt;

  &lt;Set name="contextPath"&gt;/test&lt;/Set&gt;
  &lt;Set name="war"&gt;foo.war&lt;/Set&gt;

  &lt;Call name="setAttribute"&gt;
    &lt;Arg&gt;javax.servlet.context.tempdir&lt;/Arg&gt;
    &lt;Arg&gt;/some/dir/foo&lt;/Arg&gt;
  &lt;/Call&gt;

&lt;/Configure&gt;</code></pre><p>或在Java中：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>WebAppContext context = new WebAppContext();
context.setContextPath("/test");
context.setWar("foo.war");
context.setAttribute("javax.servlet.context.tempdir", "/some/dir/foo");</code></pre><p>通过上述两种方法之一创建临时目录后，该文件的实例都将设置为<code class="literal">javax.servlet.context.tempdir</code> Web应用程序的属性。</p><div class="blockquote"><blockquote class="blockquote"><div class="note" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-asterisk" aria-hidden="true"></i>注意</h3><p>如果您可能在重新部署之间更改WEB-INF / lib中的jar，请谨慎设置一个明确的临时目录。有一个关于<a class="link" href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4774421" target="_top">缓存jar内容</a>的JVM错误<a class="link" href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4774421" target="_top">。</a></p></div></blockquote></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_setting_the_temp_directory_on_the_command_line"></a>在命令行上设置临时目录</h4></div></div></div><p>您可以通过两种方式在Jetty启动时在命令行上设置临时目录的位置。首先是最简单的方法，只需在启动Jetty时将其添加到命令行中即可。</p><div class="screenexample"><pre class="screen">java -jar ../start.jar -Djava.io.tmpdir=/path/to/desired/directory</pre></div><p>或者，这可以在<a class="link" href="startup-modules.html" title="Managing Startup Modules">模块中</a>定义<a class="link" href="startup-modules.html" title="管理启动模块">。</a>的<code class="literal">jvm</code>设置与Jetty打包在一起的模块以添加其他JVM选项。启用模块后（使用<code class="literal">--add-to-start=jvm</code>命令）， <code class="literal">jvm.ini</code>文件并将位置添加到临时目录。您还需要验证包括<code class="literal">--exec</code>该命令未注释掉，因为这是Jetty启动新的分叉JVM所必需的。以下是标准示例<code class="literal">jvm.ini</code>文件已更改为包括对临时目录的引用。</p><div class="screenexample"><pre class="screen"># ---------------------------------------
# Module: jvm
# A noop module that creates an ini template useful for
# setting JVM arguments (eg -Xmx )
# ---------------------------------------
--module=jvm

## JVM Configuration
## If JVM args are include in an ini file then --exec is needed
## to start a new JVM from start.jar with the extra args.
##
## If you wish to avoid an extra JVM running, place JVM args
## on the normal command line and do not use --exec
--exec
# -Xmx2000m
# -Xmn512m
# -XX:+UseConcMarkSweepGC
# -XX:ParallelCMSThreads=2
# -XX:+CMSClassUnloadingEnabled
# -XX:+UseCMSCompactAtFullCollection
# -XX:CMSInitiatingOccupancyFraction=80
# -internal:gc
# -XX:+PrintGCDateStamps
# -XX:+PrintGCTimeStamps
# -XX:+PrintGCDetails
# -XX:+PrintTenuringDistribution
# -XX:+PrintCommandLineFlags
# -XX:+DisableExplicitGC
-Djava.io.tmpdir=/path/to/desired/directory</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_the_work_directory"></a> “工作”目录</h3></div></div></div><p>可以创建一个名为<code class="literal">work</code>在里面<code class="literal">$\{jetty.base}</code>目录。如果找到了这样的目录，则假定您要将其用作以下目录中所有webapps临时目录的父目录。 <code class="literal">$\{jetty.base}</code> 。而且，从历史上看，当Jetty退出时，工作目录中的这些临时目录不会被清除（或更准确地说， <code class="literal">temp</code>当上下文停止时，不会清除与该上下文相对应的目录）。</p><p>当一个<code class="literal">work</code>使用目录时，用于生成特定于上下文的临时目录的名称的算法省略了随机数字字符串。这样可以确保目录名称在上下文重新启动后保持一致。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_persisting_the_temp_directory"></a>保留临时目录</h3></div></div></div><p>有时在重新启动Web应用程序之间保留临时目录的内容很有用。默认情况下，Jetty <span class="strong"><strong>不会</strong></span>保留临时目录。要配置Jetty使其保持不变，请使用<a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/webapp/WebAppContext.html" target="_top">WebAppContext.setPersistTempDirectory（true）</a> 。</p><div class="blockquote"><blockquote class="blockquote"><div class="note" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-asterisk" aria-hidden="true"></i>注意</h3><p>请注意，如果您致电<code class="literal">setPersistTempDirectory(true)</code> ，但是让Jetty每次都创建一个新的临时目录（即，您不设置显式的临时目录），那么您将在所选的临时目录位置中累积临时目录。</p></div></blockquote></div></div></div><script type="text/javascript">
      SyntaxHighlighter.all()
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tbody><tr><td width="40%" align="left"><a href="configuring-virtual-hosts.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><td width="20%" align="center"><a href="configuring-contexts.html" accesskey="u"><i class="fa fa-chevron-up" aria-hidden="true"></i>最佳</a></td><td width="40%" align="right"> <a href="serving-webapp-from-particular-port.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr><tr><td width="40%" align="left" valign="top">配置虚拟主机</td><td width="20%" align="center"><a href="index.html" accesskey="h"><i class="fa fa-home" aria-hidden="true"></i>家</a></td><td width="40%" align="right" valign="top">从特定端口/连接器服务WebApp</td></tr></tbody></table></div><p xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"></p><div class="jetty-callout">看到错误或缺少的东西？
            <span class="callout"><a href="http://github.com/eclipse/jetty.project">在以下位置对此文档做出贡献<span class="website"><i class="fa fa-github" aria-hidden="true"></i> Github！</span></a></span> <span style="float:right"><i>（产生：2019-11-20）</i></span></div><p></p></body></html>