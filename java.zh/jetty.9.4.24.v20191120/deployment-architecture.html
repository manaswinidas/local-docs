<html ><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>部署架构</title><link rel="stylesheet" type="text/css" href="css/docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="jetty, servlet, servlet-api, cometd, http, websocket, eclipse, maven, java, server, software"><link rel="home" href="index.html" title="Jetty"><link rel="up" href="configuring-deployment.html" title="Chapter 4. Deploying to Jetty"><link rel="prev" href="hot-deployment.html" title="Hot Deployment"><link rel="next" href="quickstart-webapp.html" title="Quickstart Webapps"><link rel="shortcut icon" href="images/favicon.ico" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><link rel="stylesheet" href="css/highlighter/foundation.css"><script src="js/highlight.pack.js"></script><script>
      hljs.initHighlightingOnLoad();
    </script><link type="text/css" rel="stylesheet" href="css/font-awesome/font-awesome.min.css"></head><body bgcolor="white"  text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><tbody><tr><td style="width:25%"><a href="http://www.eclipse.org/jetty"><img src="images/jetty-header-logo.png" alt="Jetty标志"></a><br><span style="font-size:small">版本：9.4.24.v20191120</span></td><td style="width:50%"></td></tr></tbody></table><div class="navheader" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><table width="100%" summary="Navigation header"><tbody><tr><th colspan="3" align="center">部署架构</th></tr><tr><td width="20%" align="left"><a href="hot-deployment.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><th width="60%" align="center">第四章部署到Jetty<br><a href="index.html" accesskey="p"><i class="fa fa-home" aria-hidden="true"></i>家</a></th><td width="20%" align="right"> <a href="quickstart-webapp.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr></tbody></table><hr></div><div class="jetty-callout" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><h5 class="callout"><a href="http://www.webtide.com/">通过<span class="website">www.webtide.com</span>与Jetty核心开发人员联系。</a></h5><p>内部/客户项目的私人支持...自定义扩展和发行版...无限期支持的版本快照...您的应用程序和Ajax / Comet项目的可伸缩性指南...赞助功能开发的开发服务</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear:both"><a name="deployment-architecture"></a>部署架构</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="deployment-architecture.html#udm-application-providers">应用程序提供者</a></span></dt><dt><span class="section"><a href="deployment-architecture.html#udm-application-lifecycle-graph">应用程序生命周期图</a></span></dt><dt><span class="section"><a href="deployment-architecture.html#udm-lifecycle-bindings">生命周期绑定</a></span></dt><dt><span class="section"><a href="deployment-architecture.html#default-web-app-provider">了解默认的WebAppProvider</a></span></dt></dl></div><p>Jetty是围绕可扩展的Deployment Manager架构构建的，并带有通过它的Web应用程序的正式LifeCycle。</p><p>为了让Jetty提供内容（静态或动态），需要配置<a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/server/handler/ContextHandler.html" target="_top">ContextHandler</a>并将其添加到适当位置的Jetty中。可插拔<code class="literal">DeploymentManager</code>可以简化此过程。Jetty发行版包含示例<code class="literal">DeploymentManager</code>配置以将目录中找到的WAR文件部署到Jetty，也将Jetty上下文xml文件部署到Jetty。</p><p>的<code class="literal">DeploymentManager</code>是典型的Webapp部署机制的核心；它作为应用程序生命周期图，在应用程序生命周期图中查找并提供应用程序的应用程序提供程序以及该图中控制部署过程的一组绑定的组合而运行。</p><p><span class="inlinemediaobject"><img src="images/Jetty_DeployManager_DeploymentManager_Roles.png" width="195" alt="图片"></span></p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="udm-application-providers"></a>应用程序提供者</h3></div></div></div><p>在Jetty部署应用程序之前， <a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/deploy/AppProvider.html" target="_top"><code class="literal">AppProvider</code></a>识别应用程序，然后将其提供给<code class="literal">DeploymentManager</code> 。主要的<code class="literal">AppProvider</code>与Jetty分布是<a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/deploy/providers/WebAppProvider.html" target="_top"><code class="literal">WebAppProvider</code> 。</a></p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="udm-application-lifecycle-graph"></a>应用程序生命周期图</h3></div></div></div><p>的核心特征<code class="literal">DeploymentManager</code>是<a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/deploy/AppLifeCycle.html" target="_top">应用程序生命周期图</a> 。</p><p><span class="inlinemediaobject"><img src="images/Jetty_DeployManager_AppLifeCycle-1.png" width="340" alt="图片"></span></p><p>该图的节点和边缘是在Jetty中沿最常见的动作和状态预先定义的。这些节点和边缘未进行硬编码；可以根据需要对其进行调整和添加（例如，对添加工作流，批准，登台，分发，集群或云的协调部署等任何复杂的要求）。</p><p>新应用程序在“未部署”节点上输入此图，然后<a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/deploy/DeploymentManager.html#requestAppGoal(org.eclipse.jetty.deploy.App" target="_top"><code class="literal">java.lang.String DeploymentManager.requestAppGoal(App,String)</code></a>方法将它们推入图表。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="udm-lifecycle-bindings"></a>生命周期绑定</h3></div></div></div><p>一组默认<a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/deploy/AppLifeCycle.Binding.html" target="_top"><code class="literal">AppLifeCycle.Bindings</code></a>定义标准行为，并处理部署，启动，停止和取消部署应用程序。如果需要，自定义<code class="literal">AppLifeCycle.Bindings</code>可以在Application LifeCycle图上的任何位置编写和分配。</p><p>新的例子<code class="literal">AppLifeCycle.Binding</code>可以开发的实现包括：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem">验证传入的应用程序。</li><li class="listitem">防止部署已知的禁止应用程序。</li><li class="listitem">将安装提交到公司环境中的应用程序审核服务。</li><li class="listitem">将应用程序分发到群集或云中的其他节点。</li><li class="listitem">通过电子邮件发送给所有者/管理员以更改应用程序的状态。</li></ul></div><p>有四个默认绑定：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem"><a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/deploy/bindings/StandardDeployer.html" target="_top"><code class="literal">StandardDeployer</code></a> —在适当的位置将ContextHandler部署到Jetty中。</li><li class="listitem"><a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/deploy/bindings/StandardStarter.html" target="_top"><code class="literal">StandardStarter</code></a> —将ContextHandler设置为启动并开始接受传入的请求。</li><li class="listitem"><a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/deploy/bindings/StandardStopper.html" target="_top"><code class="literal">StandardStopper</code></a> —停止ContextHandler并停止接受传入的请求。</li><li class="listitem"><a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/deploy/bindings/StandardUndeployer.html" target="_top"><code class="literal">StandardUndeployer</code></a> —从Jetty中删除ContextHandler。</li></ul></div><p><span class="inlinemediaobject"><img src="images/Jetty_DeployManager_DefaultAppLifeCycleBindings.png" width="851" alt="图片"></span></p><p>出于调试原因，还提供了第五种非标准绑定，称为<a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/deploy/bindings/DebugBinding.html" target="_top">DebugBinding</a> 。它记录了应用程序生命周期中的各种转换。</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_using_globalwebappconfigbinding"></a>使用GlobalWebappConfigBinding</h4></div></div></div><p>除了上面讨论的LifeCycle绑定外，还有<a class="link" href="https://www.eclipse.org/jetty/javadoc/current/org/eclipse/jetty/deploy/bindings/GlobalWebappConfigBinding.html" target="_top"><code class="literal">GlobalWebappConfigBinding</code></a>当添加到<code class="literal">DeploymentManager</code>将一个附加的配置XML文件应用于它部署的每个Web应用程序。这在设置服务器或系统类或定义<a class="link" href="override-web-xml.html" title="Jetty override-web.xml">覆盖描述符</a>时很有用<a class="link" href="override-web-xml.html" title="Jetty覆盖-web.xml">。</a>该配置XML文件将是针对webapp存在的任何上下文XML文件的<span class="emphasis"><em>补充</em></span> 。它会<span class="emphasis"><em>在</em></span>所有上下文XML文件之后但<span class="emphasis"><em>在</em></span> webapp启动<span class="emphasis"><em>之前</em></span>应用。XML文件的格式与任何上下文XML文件相同，并且可以用于webapp的相同参数。</p><p>要使用此绑定，您可以修改现有的<code class="literal">jetty-deploy.xml</code>随附于Jetty发行版（请确保首先<a class="link" href="startup-base-and-home.html" title="管理Jetty基地和Jetty主页">将其复制到$ JETTY_BASE / etc目录中</a> ），或者通过<a class="link" href="custom-modules.html" title="定制模块">创建一个新的模块</a>文件来调用附加的XML文件。</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>        &lt;Call name="addLifeCycleBinding"&gt;
          &lt;Arg&gt;
            &lt;New class="org.eclipse.jetty.deploy.bindings.GlobalWebappConfigBinding" &gt;
              &lt;Set name="jettyXml"&gt;&lt;Property name="jetty.home" default="." /&gt;/etc/global-webapp-config.xml&lt;/Set&gt;
            &lt;/New&gt;
          &lt;/Arg&gt;
        &lt;/Call&gt;</code></pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="default-web-app-provider"></a>了解默认的WebAppProvider</h3></div></div></div><p><a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/deploy/providers/WebAppProvider.html" target="_top">WebAppProvider</a>用于部署打包为WAR文件，扩展为目录或在<a class="xref" href="configuring-specific-webapp-deployment.html#deployable-descriptor-file" title="Jetty可部署描述符XML文件">Jetty Deployable Descriptor XML File中</a>声明的Web应用程序。它支持热（重新）部署。</p><p>基本操作<code class="literal">WebAppProvider</code>定期扫描目录中的可部署内容。在标准Jetty发行版中，这是在<code class="literal">${jetty.home}/etc/jetty-deploy.xml</code>文件。</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure_9_3.dtd"&gt;
&lt;Configure id="Server" class="org.eclipse.jetty.server.Server"&gt;

  &lt;Call name="addBean"&gt;
    &lt;Arg&gt;
      &lt;New id="DeploymentManager" class="org.eclipse.jetty.deploy.DeploymentManager"&gt;
        &lt;Set name="contexts"&gt;
          &lt;Ref refid="Contexts" /&gt;
        &lt;/Set&gt;
        &lt;Call id="webappprovider" name="addAppProvider"&gt;
          &lt;Arg&gt;
            &lt;New class="org.eclipse.jetty.deploy.providers.WebAppProvider"&gt;
              &lt;Set name="monitoredDirName"&gt;&lt;Property name="jetty.home" default="." /&gt;/webapps&lt;/Set&gt;
              &lt;Set name="defaultsDescriptor"&gt;&lt;Property name="jetty.home" default="." /&gt;/etc/webdefault.xml&lt;/Set&gt;
              &lt;Set name="scanInterval"&gt;1&lt;/Set&gt;
              &lt;Set name="extractWars"&gt;true&lt;/Set&gt;
            &lt;/New&gt;
          &lt;/Arg&gt;
        &lt;/Call&gt;
      &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/Call&gt;
&lt;/Configure&gt;</code></pre><p>以上配置将创建一个<code class="literal">DeploymentManager</code>跟踪为Server LifeCycle Bean，具有以下配置。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">语境</span></dt><dd>传递给HandlerContainer的引用，将发现的Web应用程序部署到其中。这通常是指向<code class="literal">id="Contexts"</code>发现于<code class="literal">${jetty.home}/etc/jetty.xml</code>文件，它本身是<code class="literal">ContextHandlerCollection</code> 。</dd><dt><span class="term">monitorDirName</span></dt><dd><p class="simpara">用于扫描Web应用程序的目录的文件路径或URL。</p><pre class="literallayout">Scanning follows these rules:</pre><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">基本目录必须存在。</li><li class="listitem">隐藏文件（以<code class="literal">"."</code> ）被忽略。</li><li class="listitem">名称以结尾的目录<code class="literal">".d"</code>被忽略。</li><li class="listitem">通用CVS目录<code class="literal">"CVS"</code>和<code class="literal">"CVSROOT"</code>被忽略。</li><li class="listitem">任何<code class="literal">*.war</code>文件被视为<a class="link" href="automatic-webapp-deployment.html" title="自动Web应用程序部署">自动部署</a>文件。</li><li class="listitem">任何<code class="literal">*.xml</code>文件被视为<a class="link" href="configuring-specific-webapp-deployment.html#deployable-descriptor-file" title="Jetty可部署描述符XML文件">上下文描述符可部署</a> 。</li><li class="listitem">在WAR文件和XML文件都存在相同基本名称的特殊情况下，假定XML文件用于配置和引用WAR文件（请参阅<a class="xref" href="configuring-specific-webapp-deployment.html" title="配置特定的Web应用程序部署">配置特定的Web应用程序部署</a> ）。从jetty-9.2.7开始，如果WAR文件或其相应的XML文件发生更改，则将重新部署webapp。</li><li class="listitem">目录被认为是可部署的。</li><li class="listitem">在目录和WAR文件都存在相同名称的特殊情况下，假定WAR文件是可自动部署的。</li><li class="listitem">在目录和同名XML文件同时存在的特殊情况下，假定XML文件用于配置和引用目录。</li><li class="listitem">所有其他目录都将自动部署。</li><li class="listitem">如果使用自动部署以及特殊文件名<code class="literal">root.war/ROOT.war</code>或目录名称<code class="literal">root/ROOT</code>将导致部署到<code class="literal">"/"</code>上下文路径。</li></ol></div></dd><dt><span class="term">defaultsDescriptor</span></dt><dd>指定用于所有Web应用程序的默认Servlet Web描述符。该描述符的目的是在Web应用程序自身之前包含Web应用程序的通用配置<code class="literal">/WEB-INF/web.xml</code>被申请;被应用。的<code class="literal">${jetty.home}/etc/webdefault.xml</code> Jetty发行版随附的工具控制JSP和Default servlet的配置，以及MIME类型和其他基本元数据。</dd><dt><span class="term">scanInterval</span></dt><dd>两次扫描之间的时间间隔（以秒为单位） <code class="literal">monitoredDirName</code>对于更改：要部署新的上下文，将上下文更改为重新部署，或将删除的上下文取消部署。</dd><dt><span class="term">extractWars</span></dt><dd>如果parameter为true，则在打包之前将所有打包的WAR或zip文件首先提取到一个临时目录中。如果Web应用程序中有未编译的JSP，则建议这样做。</dd><dt><span class="term">parentLoaderPriority</span></dt><dd>参数是一个布尔值，用于选择是使用标准Java <a class="link" href="jetty-classloading.html" title="Jetty Classloading">父</a> <a class="link" href="jetty-classloading.html" title="Jetty Classloading">级优先</a> <a class="link" href="jetty-classloading.html" title="Jetty类装载">委派</a>还是<a class="link" href="jetty-classloading.html" title="Jetty类装载">servlet规范webapp类加载优先级</a> 。后者是默认设置。</dd></dl></div></div></div><script type="text/javascript">
      SyntaxHighlighter.all()
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tbody><tr><td width="40%" align="left"><a href="hot-deployment.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><td width="20%" align="center"><a href="configuring-deployment.html" accesskey="u"><i class="fa fa-chevron-up" aria-hidden="true"></i>最佳</a></td><td width="40%" align="right"> <a href="quickstart-webapp.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr><tr><td width="40%" align="left" valign="top">热部署</td><td width="20%" align="center"><a href="index.html" accesskey="h"><i class="fa fa-home" aria-hidden="true"></i>家</a></td><td width="40%" align="right" valign="top">快速入门Web应用程序</td></tr></tbody></table></div><p xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"></p><div class="jetty-callout">看到错误或缺少的东西？
            <span class="callout"><a href="http://github.com/eclipse/jetty.project">在以下位置对此文档做出贡献<span class="website"><i class="fa fa-github" aria-hidden="true"></i> Github！</span></a></span> <span style="float:right"><i>（产生：2019-11-20）</i></span></div><p></p></body></html>