<html ><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>别名文件和符号链接</title><link rel="stylesheet" type="text/css" href="css/docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="jetty, servlet, servlet-api, cometd, http, websocket, eclipse, maven, java, server, software"><link rel="home" href="index.html" title="Jetty"><link rel="up" href="configuring-security.html" title="Chapter 7. Configuring Security"><link rel="prev" href="configuring-form-size.html" title="Limiting Form Content"><link rel="next" href="configuring-security-secure-passwords.html" title="Secure Password Obfuscation"><link rel="shortcut icon" href="images/favicon.ico" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><link rel="stylesheet" href="css/highlighter/foundation.css"><script src="js/highlight.pack.js"></script><script>
      hljs.initHighlightingOnLoad();
    </script><link type="text/css" rel="stylesheet" href="css/font-awesome/font-awesome.min.css"></head><body bgcolor="white"  text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><tbody><tr><td style="width:25%"><a href="http://www.eclipse.org/jetty"><img src="images/jetty-header-logo.png" alt="Jetty标志"></a><br><span style="font-size:small">版本：9.4.24.v20191120</span></td><td style="width:50%"></td></tr></tbody></table><div class="navheader" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><table width="100%" summary="Navigation header"><tbody><tr><th colspan="3" align="center">别名文件和符号链接</th></tr><tr><td width="20%" align="left"><a href="configuring-form-size.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><th width="60%" align="center">第7章。配置安全性<br><a href="index.html" accesskey="p"><i class="fa fa-home" aria-hidden="true"></i>家</a></th><td width="20%" align="right"> <a href="configuring-security-secure-passwords.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr></tbody></table><hr></div><div class="jetty-callout" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><h5 class="callout"><a href="http://www.webtide.com/">通过<span class="website">www.webtide.com</span>与Jetty核心开发人员联系。</a></h5><p>内部/客户项目的私人支持...自定义扩展和发行版...无限期支持的版本快照...您的应用程序和Ajax / Comet项目的可伸缩性指南...赞助功能开发的开发服务</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear:both"><a name="serving-aliased-files"></a>别名文件和符号链接</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="serving-aliased-files.html#_good_security_practise">良好安全规范</a></span></dt><dt><span class="section"><a href="serving-aliased-files.html#file-alias-detection">别名检测</a></span></dt><dt><span class="section"><a href="serving-aliased-files.html#file-alias-serving">服务别名和符号链接</a></span></dt></dl></div><p>Web应用程序通常会从JVM下运行的操作系统提供的文件系统中提供静态内容。但是，由于文件系统通常为同一文件实现多个别名，因此安全性约束和其他servlet URI空间映射可能会无意间被别名绕过。</p><p>一个重要的例子是Windows文件系统实现的不区分大小写和8.3文件名。如果网络应用程序中的文件名为<code class="literal">/mysecretfile.txt</code>受URI上的安全性约束保护<code class="literal">/mysecretfile.txt</code> ，然后向<code class="literal">/MySecretFile.TXT</code>不会与URI约束匹配，因为URI区分大小写，但是Windows文件系统将报告该名称确实存在一个文件，尽管存在安全性约束，该文件仍将得到提供。与不区分大小写的情况相比，鲜为人知的是Windows文件系统还支持<a class="link" href="http://en.wikipedia.org/wiki/8.3_filename" target="_top">8.3文件名</a>以与旧程序兼容。因此，对URI之类的请求<code class="literal">/MYSECR~1.TXT</code>将再次与安全性约束不匹配，但是将由文件系统报告为现有文件并提供服务。</p><p>别名的例子很多，而不仅仅是Windows：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem">NTFS备用流名称，例如<code class="literal">c:\test\file.txt::$DATA:name</code></li><li class="listitem">OpenVMS支持文件versionig <code class="literal">/mysecret.txt;N</code>指的是版本N <code class="literal">/mysecret.txt</code>实质上是别名。</li><li class="listitem">Clearcase软件配置管理系统提供了一个文件系统，其中<code class="literal">@@</code>文件名中的“是”是特定版本的别名。</li><li class="listitem">Unix文件系统支持<code class="literal">/./foo.txt</code>作为和别名<code class="literal">/foo.txt</code></li><li class="listitem">许多JVM实现错误地认为null字符是字符串终止符，因此文件名来自<code class="literal">/foobar.txt%00</code>是的别名<code class="literal">/foobar.txt</code></li><li class="listitem">Unix符号链接和硬链接是别名的一种形式，它允许同一文件或目录具有多个名称。</li></ul></div><p>此外，可以绕过的不仅仅是URI安全约束。例如URI模式的映射<code class="literal">*.jsp</code>到JSP Servlet的请求可能会绕过对别名的请求，例如<code class="literal">/foobar.jsp%00</code> ，而不是执行JSP，而是文件系统返回JSP的源代码。</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_good_security_practise"></a>良好安全规范</h3></div></div></div><p>别名的部分问题是标准的Web应用程序安全性模型是允许除安全约束明确拒绝的请求之外的所有请求。安全性的最佳做法是拒绝所有请求，并仅允许那些明确标识为允许的请求。尽管可以用这种样式设计Web应用程序安全性约束，但在所有情况下都可能很困难，并且它不是默认设置。因此，对于Jetty来说，能够检测并拒绝对别名静态内容的请求非常重要。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="file-alias-detection"></a>别名检测</h3></div></div></div><p>Jetty不可能知道在其下运行的文件系统可能实现的所有别名，因此它不会尝试对任何已知的别名进行任何特定的检查。相反，Jetty通过使用文件的规范路径来检测别名。如果Jetty处理的文件资源的规范名称与用于请求资源的名称不同，则Jetty会确定该资源是别名请求，并且不会由该资源返回。 <code class="literal">ServletContext.getResource(String)</code>方法（或类似方法），因此不会用作静态内容，也不会用作JSP的基础。</p><p>如果Jetty在Windows操作系统上运行，则此文件名为<code class="literal">/MySecret.TXT</code>将具有与该情况完全匹配的规范名称。因此，当请求<code class="literal">/mysecret.txt</code>要么<code class="literal">/MYSECR~1.TXT</code>将产生与该文件匹配的文件资源，不同的规范名称将指示那些请求是别名，它们将不用作静态内容，而是返回404响应。</p><p>不幸的是，这种方法拒绝所有别名，包括符号链接，这些别名在组装复杂的Web应用程序时可能很有用。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="file-alias-serving"></a>服务别名和符号链接</h3></div></div></div><p>并非所有的别名都是错误的，也不应该被视为破坏安全性约束的尝试。具体来说，在组装复杂的Web应用程序时，符号链接可能非常有用。因此，Jetty上下文支持可扩展<code class="literal">AliasCheck</code>允许别名资源被检查和有条件地服务的机制。这样，可以检测并提供“良好”别名。Jetty提供了几种实用的实现<code class="literal">AliasCheck</code>接口与嵌套类<code class="literal">ContextHandler</code> ：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">批准别名</span></dt><dd>批准所有别名（ <span class="strong"><strong>请谨慎使用！</strong></span> ）。</dd><dt><span class="term">AllowSymLinkAliasChecker</span></dt><dd>使用Java-7批准别名<code class="literal">Files.readSymbolicLink(path)</code>和<code class="literal">Path.toRealPath(...)</code>用于检查别名是否有效的符号链接的API。</dd></dl></div><div class="blockquote"><blockquote class="blockquote"><div class="note" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-asterisk" aria-hidden="true"></i>注意</h3><p>默认情况下，Jetty为在UNIX上运行的实现提供别名文件，因为使用<a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/server/handler/AllowSymLinkAliasChecker.html" target="_top"><code class="literal">AllowSymLinkAliasChecker</code></a>和<a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/server/handler/ContextHandler.ApproveNonExistentDirectoryAliases.html" target="_top"><code class="literal">ApproveNonExistentDirectoryAliases</code></a>别名检查器。</p></div></blockquote></div><p>应用程序可以自由实现自己的别名检查。可以通过上下文部署程序文件中使用的以下XML将Alias Checkers安装在上下文中，或者<code class="literal">WEB-INF/jetty-web.xml</code> ：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>  &lt;!-- Allow symbolic links  --&gt;
  &lt;Call name="addAliasCheck"&gt;
    &lt;Arg&gt;&lt;New class="org.eclipse.jetty.server.handler.AllowSymLinkAliasChecker"/&gt;&lt;/Arg&gt;
  &lt;/Call&gt;</code></pre></div></div><script type="text/javascript">
      SyntaxHighlighter.all()
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tbody><tr><td width="40%" align="left"><a href="configuring-form-size.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><td width="20%" align="center"><a href="configuring-security.html" accesskey="u"><i class="fa fa-chevron-up" aria-hidden="true"></i>最佳</a></td><td width="40%" align="right"> <a href="configuring-security-secure-passwords.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr><tr><td width="40%" align="left" valign="top">限制表格内容</td><td width="20%" align="center"><a href="index.html" accesskey="h"><i class="fa fa-home" aria-hidden="true"></i>家</a></td><td width="40%" align="right" valign="top">安全密码混淆</td></tr></tbody></table></div><p xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"></p><div class="jetty-callout">看到错误或缺少的东西？
            <span class="callout"><a href="http://github.com/eclipse/jetty.project">在以下位置对此文档做出贡献<span class="website"><i class="fa fa-github" aria-hidden="true"></i> Github！</span></a></span> <span style="float:right"><i>（产生：2019-11-20）</i></span></div><p></p></body></html>