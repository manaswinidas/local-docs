<html ><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>配置Jetty请求日志</title><link rel="stylesheet" type="text/css" href="css/docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="jetty, servlet, servlet-api, cometd, http, websocket, eclipse, maven, java, server, software"><link rel="home" href="index.html" title="Jetty"><link rel="up" href="configuring-logging.html" title="Chapter 11. Jetty Logging"><link rel="prev" href="default-logging-with-stderrlog.html" title="Default Logging with Jetty’s StdErrLog"><link rel="next" href="configuring-logging-modules.html" title="Jetty Logging Integrations (SLF4J, Log4j, Logback, JCL, JUL)"><link rel="shortcut icon" href="images/favicon.ico" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><link rel="stylesheet" href="css/highlighter/foundation.css"><script src="js/highlight.pack.js"></script><script>
      hljs.initHighlightingOnLoad();
    </script><link type="text/css" rel="stylesheet" href="css/font-awesome/font-awesome.min.css"></head><body bgcolor="white"  text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><tbody><tr><td style="width:25%"><a href="http://www.eclipse.org/jetty"><img src="images/jetty-header-logo.png" alt="Jetty标志"></a><br><span style="font-size:small">版本：9.4.24.v20191120</span></td><td style="width:50%"></td></tr></tbody></table><div class="navheader" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><table width="100%" summary="Navigation header"><tbody><tr><th colspan="3" align="center">配置Jetty请求日志</th></tr><tr><td width="20%" align="left"><a href="default-logging-with-stderrlog.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><th width="60%" align="center">第十一章Jetty记录<br><a href="index.html" accesskey="p"><i class="fa fa-home" aria-hidden="true"></i>家</a></th><td width="20%" align="right"> <a href="configuring-logging-modules.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr></tbody></table><hr></div><div class="jetty-callout" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><h5 class="callout"><a href="http://www.webtide.com/">通过<span class="website">www.webtide.com</span>与Jetty核心开发人员联系。</a></h5><p>内部/客户项目的私人支持...自定义扩展和发行版...无限期支持的版本快照...您的应用程序和Ajax / Comet项目的可伸缩性指南...赞助功能开发的开发服务</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear:both"><a name="configuring-jetty-request-logs"></a>配置Jetty请求日志</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="configuring-jetty-request-logs.html#constructing-request-log-entry">构造请求日志条目</a></span></dt><dt><span class="section"><a href="configuring-jetty-request-logs.html#implementing-request-log">实施请求日志</a></span></dt><dt><span class="section"><a href="configuring-jetty-request-logs.html#configuring-request-log">配置请求日志模块</a></span></dt><dt><span class="section"><a href="configuring-jetty-request-logs.html#request-log-custom-writer">介绍RequestLog。作家</a></span></dt><dt><span class="section"><a href="configuring-jetty-request-logs.html#configuring-separate-request-log-for-web-application">为Web应用程序配置单独的请求日志</a></span></dt></dl></div><p>请求日志是服务器已处理请求的记录。每个收到的请求只有一个条目，通常采用标准NCSA格式，因此您可以使用<a class="link" href="http://en.wikipedia.org/wiki/Webalizer" target="_top">Webalizer之类的</a>工具方便地对其进行分析。</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="constructing-request-log-entry"></a>构造请求日志条目</h3></div></div></div><p>标准的请求日志条目包括客户端IP地址，日期，方法，URL，结果，大小，引荐来源网址，用户代理和延迟。例如：</p><pre class="literallayout">123.4.5.6 - - [20/Jul/2016:10:16:17 +0000]
  "GET /jetty/tut/XmlConfiguration.html HTTP/1.1"
  200 76793 "http://localhost:8080/jetty/tut/logging.html"
  "Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.6) Gecko/20040614 Firefox/0.8" 342</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="implementing-request-log"></a>实施请求日志</h3></div></div></div><p>Jetty提供了一个称为<code class="literal">NCSARequestLog</code>在每天都会滚动的文件中支持NCSA格式。</p><p><a class="link" href="http://logback.qos.ch/" target="_top">Logback项目</a>提供了<a class="link" href="http://logback.qos.ch/access.html" target="_top">另一种实现</a> <code class="literal">RequestLog</code>界面，提供丰富而强大的HTTP访问日志功能。</p><p>如果这些选项都不满足您的需求，则可以通过实施Jetty的方法来实现自定义请求记录器<a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/server/RequestLog.html" target="_top"><code class="literal">RequestLog.java</code></a>界面并将其插入类似于<code class="literal">NCSARequestLog</code> ， 如下所示。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuring-request-log"></a>配置请求日志模块</h3></div></div></div><p>要通过Jetty分发为整个服务器启用请求日志模块，首先需要在命令行上启用它：</p><div class="screenexample"><pre class="screen">$ java -jar ../start.jar --add-to-start=requestlog

INFO: requestlog      initialised in ${jetty.base}/start.d/requestlog.ini
MKDIR: ${jetty.base}/logs
INFO: Base directory was modified</pre></div><p>上面的命令将添加一个新的<code class="literal">requestlog.ini</code>归档到您的<a class="link" href="startup-modules.html#start-vs-startd" title="Start.ini与Start.d"><code class="literal">{$jetty.base}/start.d</code>目录</a> 。</p><div class="blockquote"><blockquote class="blockquote"><div class="note" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-asterisk" aria-hidden="true"></i>注意</h3><p>默认情况下，请求日志未设置为附加，这意味着在服务器重新启动后会清除干净日志文件。您可以通过编辑<code class="literal">requestlog.ini</code>并取消注释读取的行<code class="literal">jetty.requestlog.append=true</code> 。</p></div></blockquote></div><p>Jetty的嵌入式用法的等效代码为：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>NCSARequestLog requestLog = new NCSARequestLog("/var/logs/jetty/jetty-yyyy_mm_dd.request.log");
requestLog.setAppend(true);
requestLog.setExtended(false);
requestLog.setLogTimeZone("GMT");
requestLog.setLogLatency(true);
requestLog.setRetainDays("90");

server.setRequestLog(requestLog);</code></pre><p>这将配置请求登录<code class="literal">{$jetty.home}/logs</code>文件名包括日期。现有的日志文件将附加到GMT时区中，并使用扩展的NCSA格式。</p><p>上面的配置启用了Log Latency，这是服务器处理请求所花费的时间。该值以毫秒为单位，并附加到每个请求的日志文件中。</p><p>您还可以自定义希望保留请求日志的天数。默认情况下，日志文件会保留90天，然后再删除。的价值<code class="literal">retainDays</code> （xml）或<code class="literal">setRetainDays</code> （Java）应该配置为<span class="emphasis"><em>1 + n</em></span>天。例如，如果您想保留当天和前一天的日志，则可以设置<code class="literal">retainDays</code> （要么<code class="literal">setRetainDays</code> ）值设为2。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="request-log-custom-writer"></a>介绍RequestLog。作家</h3></div></div></div><p>一个的概念<code class="literal">RequestLog.Writer</code>在Jetty 9.4.15中引入的，可将由<code class="literal">RequestLog</code> 。这允许<code class="literal">CustomRequestLog</code>匹配其他功能<code class="literal">RequestLogger</code>通过插入任何实现<code class="literal">RequestLog.Writer</code>和自定义格式字符串。Jetty当前具有以下实现<code class="literal">RequestLog.Writer</code> ， <code class="literal">RequestLogWriter</code> ， <code class="literal">AsyncRequestLogWriter</code>和<code class="literal">Slf4jRequestLogWriter</code> 。</p><p>因此，创建异步的方法<code class="literal">RequestLog</code>使用扩展的NCSA格式已更改为：</p><p><code class="literal">new AsyncNcsaRequestLog(filename)</code></p><p>至：</p><p><code class="literal">new CustomRequestLog(new AsyncRequestLogWriter(filename), CustomRequestLog.EXTENDED_NCSA_FORMAT)</code></p><p>此外，现在有两个要配置的日志时区设置。存在用于记录请求时间的配置，该配置在<code class="literal">timeZone</code>中的参数<code class="literal">%t</code>字符串的格式代码，以格式给出<code class="literal">%{format|timeZone|locale}t</code> 。</p><p>另一个<code class="literal">timeZone</code>参数与日志文件名的生成（创建和翻转）有关。这是在<code class="literal">requestlog</code>模块文件，或可用作设置器<code class="literal">RequestLogWriter</code>通过XML。</p><p>默认情况下，两个时区都设置为GMT。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuring-separate-request-log-for-web-application"></a>为Web应用程序配置单独的请求日志</h3></div></div></div><p>要为特定的Web应用程序配置单独的请求日志，请将以下内容添加到上下文XML文件中。</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;Configure class="org.eclipse.jetty.webapp.WebAppContext"&gt;
  ...
  &lt;Call name="insertHandler"&gt;
    &lt;Arg&gt;
      &lt;New id="RequestLog" class="org.eclipse.jetty.server.handler.RequestLogHandler"&gt;
        &lt;Set name="requestLog"&gt;
          &lt;New id="RequestLogImpl" class="org.eclipse.jetty.server.NCSARequestLog"&gt;
            &lt;Set name="filename"&gt;&lt;Property name="jetty.logs" default="./logs"/&gt;/test-yyyy_mm_dd.request.log&lt;/Set&gt;
            &lt;Set name="filenameDateFormat"&gt;yyyy_MM_dd&lt;/Set&gt;
            &lt;Set name="LogTimeZone"&gt;GMT&lt;/Set&gt;
            &lt;Set name="retainDays"&gt;90&lt;/Set&gt;
            &lt;Set name="append"&gt;true&lt;/Set&gt;
            &lt;Set name="LogLatency"&gt;true&lt;/Set&gt;
          &lt;/New&gt;
        &lt;/Set&gt;
      &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/Call&gt;
  ...
&lt;/Configure&gt;</code></pre></div></div><script type="text/javascript">
      SyntaxHighlighter.all()
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tbody><tr><td width="40%" align="left"><a href="default-logging-with-stderrlog.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><td width="20%" align="center"><a href="configuring-logging.html" accesskey="u"><i class="fa fa-chevron-up" aria-hidden="true"></i>最佳</a></td><td width="40%" align="right"> <a href="configuring-logging-modules.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr><tr><td width="40%" align="left" valign="top">使用Jetty的StdErrLog进行默认日志记录</td><td width="20%" align="center"><a href="index.html" accesskey="h"><i class="fa fa-home" aria-hidden="true"></i>家</a></td><td width="40%" align="right" valign="top">Jetty记录集成（SLF4J，Log4j，Logback，JCL，JUL）</td></tr></tbody></table></div><p xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"></p><div class="jetty-callout">看到错误或缺少的东西？
            <span class="callout"><a href="http://github.com/eclipse/jetty.project">在以下位置对此文档做出贡献<span class="website"><i class="fa fa-github" aria-hidden="true"></i> Github！</span></a></span> <span style="float:right"><i>（产生：2019-11-20）</i></span></div><p></p></body></html>