<html ><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>设置非root用户的端口80访问</title><link rel="stylesheet" type="text/css" href="css/docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="jetty, servlet, servlet-api, cometd, http, websocket, eclipse, maven, java, server, software"><link rel="home" href="index.html" title="Jetty"><link rel="up" href="configuring-security.html" title="Chapter 7. Configuring Security"><link rel="prev" href="configuring-security-secure-passwords.html" title="Secure Password Obfuscation"><link rel="next" href="jaas-support.html" title="JAAS Support"><link rel="shortcut icon" href="images/favicon.ico" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><link rel="stylesheet" href="css/highlighter/foundation.css"><script src="js/highlight.pack.js"></script><script>
      hljs.initHighlightingOnLoad();
    </script><link type="text/css" rel="stylesheet" href="css/font-awesome/font-awesome.min.css"></head><body bgcolor="white"  text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><tbody><tr><td style="width:25%"><a href="http://www.eclipse.org/jetty"><img src="images/jetty-header-logo.png" alt="码头标志"></a><br><span style="font-size:small">版本：9.4.24.v20191120</span></td><td style="width:50%"></td></tr></tbody></table><div class="navheader" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><table width="100%" summary="Navigation header"><tbody><tr><th colspan="3" align="center">设置非root用户的端口80访问</th></tr><tr><td width="20%" align="left"><a href="configuring-security-secure-passwords.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><th width="60%" align="center">第7章。配置安全性<br><a href="index.html" accesskey="p"><i class="fa fa-home" aria-hidden="true"></i>家</a></th><td width="20%" align="right"> <a href="jaas-support.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr></tbody></table><hr></div><div class="jetty-callout" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><h5 class="callout"><a href="http://www.webtide.com/">通过<span class="website">www.webtide.com</span>与Jetty核心开发人员联系。</a></h5><p>内部/客户项目的私人支持...自定义扩展和发行版...无限期支持的版本快照...您的应用程序和Ajax / Comet项目的可伸缩性指南...赞助功能开发的开发服务</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear:both"><a name="setting-port80-access"></a>设置非root用户的端口80访问</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="setting-port80-access.html#using-ipchains">使用ipchains</a></span></dt><dt><span class="section"><a href="setting-port80-access.html#using-iptables">使用iptables</a></span></dt><dt><span class="section"><a href="setting-port80-access.html#configuring-jetty-setuid-feature">配置Jetty的SetUID功能</a></span></dt><dt><span class="section"><a href="setting-port80-access.html#using-solaris10-user-rights-management-framework">使用Solaris 10用户权限管理框架</a></span></dt></dl></div><p>在基于Unix的系统上，端口80是受保护的。通常只有超级用户<code class="literal">root</code>可以打开它。出于安全原因，不希望将服务器运行为<code class="literal">root</code> 。该页面显示了几个以非root用户身份访问端口80的选项，包括使用<code class="literal">ipchains</code> ， <code class="literal">iptables</code> ，Jetty的SetUID功能， <code class="literal">xinetd</code>和Solaris 10用户权限管理框架。</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="using-ipchains"></a>使用ipchains</h3></div></div></div><p>在某些Linux系统上，您可以使用<span class="emphasis"><em>ipchains REDIRECT</em></span>机制从内核中的一个端口重定向到另一个端口（如果<code class="literal">ipchains</code>不可用，那么<code class="literal">iptables</code>通常是）：</p><div class="screenexample"><pre class="screen"># /sbin/ipchains -I input --proto TCP --dport 80 -j REDIRECT 8080</pre></div><p>该命令对系统的指示如下：“插入内核的数据包，过滤以下内容作为检查传入数据包的第一条规则：如果协议是TCP，目标端口是80，则将数据包重定向到端口8080”。请注意，您的内核必须在编译时支持<code class="literal">ipchains</code> （实际上所有股票内核都是）。您还必须拥有<code class="literal">ipchains</code>命令行实用程序已安装。您可以随时运行此命令，最好一次运行一次，因为它每次运行时都会插入规则的另一个副本。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="using-iptables"></a>使用iptables</h3></div></div></div><p>在许多Linux系统上，您可以使用<code class="literal">iptables</code> REDIRECT机制从内核中的一个端口重定向到另一个端口（如果<code class="literal">iptables</code>不可用，那么通常<code class="literal">ipchains</code>是）。</p><p>您需要在启动脚本或防火墙规则中添加以下内容：</p><div class="screenexample"><pre class="screen"># /sbin/iptables -t nat -I PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8080</pre></div><p>的基本模型<code class="literal">iptables</code>与...不同<code class="literal">ipchains</code> ，因此转发通常只发生在源自服务器本身之外的数据包。如果使用，还需要允许传入数据包到端口8080 <code class="literal">iptables</code>作为本地防火墙。</p><p>小心在<span class="emphasis"><em>输入</em></span>链中放置这样的规则。此类规则必须在任何接受数据包的规则之前，否则将不会发生重定向。如果服务器需要侦听多个端口（如HTTPS），则可以根据需要插入任意多个规则。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuring-jetty-setuid-feature"></a>配置Jetty的SetUID功能</h3></div></div></div><p><a class="link" href="http://en.wikipedia.org/wiki/Setuid" target="_top">SetUID</a>是一种使用类Unix文件系统访问权限的技术，允许用户运行可执行文件，否则该可执行文件需要更高的特权。</p><p>码头的<code class="literal">SetUID</code>该模块允许您以普通用户身份运行Jetty，即使您需要在端口80或443上运行Jetty。</p><p>要将其与Jetty发行版一起使用：</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">确保您拥有<code class="literal">http.mod</code> （如果使用SSL， <a class="link" href="quickstart-common-config.html#quickstart-starting-https" title="为HTTPS和HTTP2添加SSL">则为https.mod</a> ）为所使用的<a class="link" href="quickstart-common-config.html#creating-jetty-base" title="创建一个新的码头基地">基础</a> <a class="link" href="startup-modules.html" title="Managing Startup Modules">启用</a>的<a class="link" href="startup-modules.html" title="管理启动模块">模块</a> 。的<code class="literal">http.mod</code>在发行版中默认启用，而<a class="link" href="quickstart-common-config.html#quickstart-starting-https" title="为HTTPS和HTTP2添加SSL">https.mod</a>仅在<a class="link" href="quickstart-running-jetty.html#demo-webapps-base" title="示范基地">demo-base</a>目录中启用。</li><li class="listitem">确保已将<a class="link" href="quickstart-common-config.html#quickstart-changing-jetty-port" title="更改码头">http端口更改</a>为80（如果使用SSL，则将<a class="link" href="quickstart-common-config.html#quickstart-changing-https-port" title="更改码头HTTPS端口">https端口更改</a>为443）。</li><li class="listitem"><p class="simpara">启用<code class="literal">setuid.mod</code>模块：</p><div class="screenexample"><pre class="screen"># java -jar start.jar --add-to-start=setuid</pre></div><div class="blockquote"><blockquote class="blockquote"><div class="note" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-asterisk" aria-hidden="true"></i>注意</h3><p>--add-to-start命令将启用setuid模块以进行此操作以及所有随后的jetty执行。还有其他启用模块的方法，例如单次执行。有关替代方案的更多信息，请参见“ <a class="link" href="startup-modules.html" title="管理启动模块">管理启动模块</a> ”部分。</p></div></blockquote></div></li><li class="listitem"><p class="simpara">编辑配置<code class="literal">setuid</code>模块来替代<code class="literal">userid</code>和<code class="literal">groupid</code>用户在启动后切换到。如果您的服务器实例具有<code class="literal">${jetty.base/start.d}</code>目录中，此配置位于<code class="literal">start.d/setuid.ini</code>文件代替。除此以外。此配置位于<code class="literal">${jetty.base}start.ini</code>文件。</p><pre class="literallayout">Below are the lines to configure:</pre><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>jetty.startServerAsPrivileged=false
jetty.username=foo
jetty.groupname=bar
jetty.umask=002</code></pre><div class="blockquote"><blockquote class="blockquote"><div class="note" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-asterisk" aria-hidden="true"></i>注意</h3><p>以及打开连接器<code class="literal">root</code> ，您也可以让Jetty以以下方式启动服务器<code class="literal">root</code>改为非<code class="literal">root</code>用户。</p></div></blockquote></div></li><li class="listitem"><p class="simpara">需要本地代码库才能执行用户切换。此代码作为Jetty ToolChain项目的一部分托管，并且独立于Jetty本身发行。你可以找到源代码<a class="link" href="https://github.com/eclipsejetty.toolchain" target="_top">这里</a>的<a class="link" href="https://github.com/eclipse/jetty.toolchain/jetty-setuid" target="_top">码头- setuid的</a>项目。在本地构建它，这将生成适合于操作系统的本机库：</p><div class="screenexample"><pre class="screen"># mvn clean install</pre></div><p class="simpara">如果您是在linux机器上构建的，则可以在以下位置找到本机库<code class="literal">jetty-setuid/libsetuid-linux/target/libsetuid-linux.so</code> 。如果您在其他操作系统上构建，则会在其他子目录中找到该库，其名称包含操作系统的名称。您可能需要将此文件复制到Jetty发行版的lib目录中。</p></li><li class="listitem"><p class="simpara">启动Jetty作为<code class="literal">root</code>用户在您的基本目录中，向Java提供本机库的位置。以下是假设您位于<a class="link" href="quickstart-running-jetty.html#demo-webapps-base" title="Demo Base">demo-base</a>目录中的如何从命令行执行此操作的<a class="link" href="quickstart-running-jetty.html#demo-webapps-base" title="示范基地">示例</a> ：</p><div class="screenexample"><pre class="screen"># sudo java -Djava.library.path=libsetuid-linux -jar $JETTY_HOME/start.jar</pre></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="using-solaris10-user-rights-management-framework"></a>使用Solaris 10用户权限管理框架</h3></div></div></div><p>Solaris 10提供了一个用户权限管理框架，该框架可以允许用户并处理类似于超级用户的功能：</p><div class="screenexample"><pre class="screen">usermod -K defaultpriv=basic,net_privaddr myself</pre></div><p>现在<code class="literal">myself</code>用户可以绑定到端口80。</p><p>有关更多信息，请参考<a class="link" href="http://docs.oracle.com/cd/E23823_01/html/816-4557/prbactm-1.html#scrolltoc" target="_top">Solaris 10</a>和<a class="link" href="http://docs.oracle.com/cd/E23824_01/html/821-1456/prbactm-1.html#scrolltoc" target="_top">Solaris 11 Security Services文档</a> 。</p></div></div><script type="text/javascript">
      SyntaxHighlighter.all()
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tbody><tr><td width="40%" align="left"><a href="configuring-security-secure-passwords.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><td width="20%" align="center"><a href="configuring-security.html" accesskey="u"><i class="fa fa-chevron-up" aria-hidden="true"></i>最佳</a></td><td width="40%" align="right"> <a href="jaas-support.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr><tr><td width="40%" align="left" valign="top">安全密码混淆</td><td width="20%" align="center"><a href="index.html" accesskey="h"><i class="fa fa-home" aria-hidden="true"></i>家</a></td><td width="40%" align="right" valign="top">JAAS支持</td></tr></tbody></table></div><p xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"></p><div class="jetty-callout">看到错误或缺少的东西？
            <span class="callout"><a href="http://github.com/eclipse/jetty.project">在以下位置对此文档做出贡献<span class="website"><i class="fa fa-github" aria-hidden="true"></i> Github！</span></a></span> <span style="float:right"><i>（产生：2019-11-20）</i></span></div><p></p></body></html>