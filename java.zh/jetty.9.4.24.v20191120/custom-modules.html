<html ><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>定制模块</title><link rel="stylesheet" type="text/css" href="css/docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="jetty, servlet, servlet-api, cometd, http, websocket, eclipse, maven, java, server, software"><link rel="home" href="index.html" title="Jetty"><link rel="up" href="startup.html" title="Chapter 9. Starting Jetty"><link rel="prev" href="startup-modules.html" title="Managing Startup Modules"><link rel="next" href="startup-xml-config.html" title="Managing XML Based Startup Configuration"><link rel="shortcut icon" href="images/favicon.ico" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><link rel="stylesheet" href="css/highlighter/foundation.css"><script src="js/highlight.pack.js"></script><script>
      hljs.initHighlightingOnLoad();
    </script><link type="text/css" rel="stylesheet" href="css/font-awesome/font-awesome.min.css"></head><body bgcolor="white"  text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><tbody><tr><td style="width:25%"><a href="http://www.eclipse.org/jetty"><img src="images/jetty-header-logo.png" alt="Jetty标志"></a><br><span style="font-size:small">版本：9.4.24.v20191120</span></td><td style="width:50%"></td></tr></tbody></table><div class="navheader" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><table width="100%" summary="Navigation header"><tbody><tr><th colspan="3" align="center">定制模块</th></tr><tr><td width="20%" align="left"><a href="startup-modules.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><th width="60%" align="center">第九章启动Jetty<br><a href="index.html" accesskey="p"><i class="fa fa-home" aria-hidden="true"></i>家</a></th><td width="20%" align="right"> <a href="startup-xml-config.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr></tbody></table><hr></div><div class="jetty-callout" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><h5 class="callout"><a href="http://www.webtide.com/">通过<span class="website">www.webtide.com</span>与Jetty核心开发人员联系。</a></h5><p>内部/客户项目的私人支持...自定义扩展和发行版...无限期支持的版本快照...您的应用程序和Ajax / Comet项目的可伸缩性指南...赞助功能开发的开发服务</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear:both"><a name="custom-modules"></a>定制模块</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="custom-modules.html#custom-module-properties">模块属性</a></span></dt><dt><span class="section"><a href="custom-modules.html#custom-module-location">模块位置</a></span></dt><dt><span class="section"><a href="custom-modules.html#custom-module-examples">创建自定义模块</a></span></dt><dt><span class="section"><a href="custom-modules.html#_dependencies">依存关系</a></span></dt></dl></div><p>除了Jetty发行版随附的模块之外，用户还可以创建和定义自己的自定义模块以用于其Jetty实现。自定义模块的使用有多种原因-它们可以扩展Jetty中的功能，添加新功能，管理服务器可用的其他库...等等。</p><p>Jetty模块的核心是<code class="literal">{name}.mod</code>文件本身。Jetty<code class="literal">.mod</code>文件定义以下内容：</p><div class="note" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-asterisk" aria-hidden="true"></i>注意</h3><p>重要的是要注意，在创建自己的模块时，不需要这些部分-只需使用适用于您的实现的部分即可。</p></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">模块说明-<code class="literal">[description]</code></span></dt><dd>模块说明。当查看<code class="literal">.mod</code>文件本身或使用<code class="literal">--list-modules</code>命令。</dd><dt><span class="term">依赖模块列表-<code class="literal">[depend]</code></span></dt><dd><p class="simpara">所有模块都可以声明它们依赖于其他模块， <code class="literal">[depend]</code>部分。依赖关系列表用于根据您激活的模块可传递地解析被认为是必需的其他模块。活动模块图中定义的模块顺序用于确定各种配置执行顺序，例如Jetty IoC XML配置，以及解决冲突的属性声明。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">可选模块-<code class="literal">[optional]</code></span></dt><dd>注意：有一个特殊的部分<code class="literal">[optional]</code>用于描述结构上相关的模块，这些模块在技术上不是必需的，但可能对您的特定配置有用。</dd></dl></div></dd><dt><span class="term">图书馆清单-<code class="literal">[lib]</code></span></dt><dd>模块可以选择声明它们具有正常运行所需的库。的<code class="literal">[lib]</code>本节声明了一组遵循<a class="link" href="startup-base-and-home.html#base-vs-home-resolution">Jetty Base和Jetty Home路径解析规则</a>的路径名。</dd><dt><span class="term">Jetty IoC XML配置列表-<code class="literal">[xml]</code></span></dt><dd>模块可以选择声明Jetty IoC XML配置列表，以用于连接该模块定义的功能。的<code class="literal">[xml]</code>本节声明了一组遵循<a class="link" href="startup-base-and-home.html#base-vs-home-resolution">Jetty Base和Jetty Home路径解析规则</a>的路径名。理想情况下，所有XML文件都经过参数化以接受属性来配置标准配置的各种元素。允许对大多数部署进行简化的Jetty配置。Jetty IoC XML配置的执行顺序由通过<code class="literal">[depend]</code>部分。如果默认XML不足以满足您的需求，则可以通过在<code class="literal">${jetty.base}/etc/</code>具有相同名称的目录。Jetty Base和Jetty Home的解决步骤将确保您的副本来自<code class="literal">${jetty.base}</code>将在默认的一个中拾取<code class="literal">${jetty.home}</code> 。</dd><dt><span class="term">模块标签列表-<code class="literal">[tags]</code></span></dt><dd>为了便于分类，可以为模块分配标签。使用时<code class="literal">--list-modules</code>命令，模块将按此部分中存在的第一个标记进行分组。这些标签还可以使用以下方式专门列出模块<code class="literal">--list-modules=<tag name></code>在命令行上。</dd><dt><span class="term">Ini变量-<code class="literal">[ini]</code></span></dt><dd>的<code class="literal">[ini]</code>部分用于在启动时添加或更改服务器参数。的<code class="literal">[ini]</code>部分还可以包含一个文件或多个文件的路径，这些文件应仅对服务器可用。当您想要控制可用于已部署的Web应用程序的jar时，这将很有帮助。</dd><dt><span class="term">JettyINI模板-<code class="literal">[ini-template]</code></span></dt><dd>每个模块都可以选择声明一个启动ini模板，该模板用于将示例配置元素插入/添加/添加到<code class="literal">start.ini</code>要么<code class="literal">start.d/*.ini</code>使用时的文件<code class="literal">--add-to-start=<name></code>命令行参数<code class="literal">start.jar</code> 。通常用于显示Jetty IoC XML配置文件中的一些参数化属性选项，这些参数也在同一模块中引用。</dd><dt><span class="term">所需文件和目录-<code class="literal">[files]</code></span></dt><dd><p class="simpara">如果模块的激活需要存在某些路径，则<code class="literal">[files]</code>部分定义了它们。本节中的条目有2种操作模式。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">确保目录存在</span></dt><dd>如果添加以结尾的路径名<code class="literal">"/"</code> （斜线），例如<code class="literal">"webapps/"</code> ，那么如果该目录尚不存在，则将创建该目录<code class="literal">${jetty.base}/<pathname></code> （例如： <code class="literal">"webapps/"</code>将导致<code class="literal">${jetty.base}/webapps/</code>正在创建）。</dd><dt><span class="term">下载文件</span></dt><dd>有一种特殊的语法可以让您将文件下载到特定位置（如果尚不存在）： <code class="literal"><url>:<pathname></code> 。目前， <code class="literal"><url></code>必须是<code class="literal">http://</code>方案网址（请<a class="link" href="bugs.html" title="问题，功能和错误">告知我们</a>是否需要更多方案支持）。的<code class="literal"><pathname></code>部分遵循<a class="link" href="startup-base-and-home.html#base-vs-home-resolution">Jetty Base和Jetty Home路径解析规则</a> 。例： <code class="literal">http://repo.corp.com/maven/corp-security-policy-1.0.jar:lib/corp-security-policy.jar</code>这将检查是否存在<code class="literal">lib/corp-security-policy.jar</code> ，如果不存在，它将从以下位置下载jar文件<code class="literal">http://repo.corp.com/maven/corp-security-policy-1.0.jar</code></dd></dl></div></dd><dt><span class="term">执照-<code class="literal">[license]</code></span></dt><dd>如果您要实施具有许可证的软件/技术，则可以在此处放置其文本。用户尝试激活模块时，将询问他们是否接受许可协议。如果用户不接受许可协议，则不会激活该模块。</dd><dt><span class="term">其他启动命令-<code class="literal">[exec]</code></span></dt><dd>的<code class="literal">[exec]</code>小节用于定义模块特有的其他参数。这些命令将添加到服务器启动中。</dd><dt><span class="term">JPMS模块路径定义-<code class="literal">[jpms]</code></span></dt><dd>的<code class="literal">[jpms]</code>部分用于将<a class="link" href="startup-jpms.html" title="使用Java平台模块系统（JPMS）启动">JPMS模块</a>添加到模块路径，以便在使用<code class="literal">--jpms</code>命令。</dd></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="custom-module-properties"></a>模块属性</h3></div></div></div><p>属性用于参数化：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem">XML文件使用<code class="literal"><Property name="pname"/></code>元件</li><li class="listitem">使用的模块文件<code class="literal">${pname}</code>句法</li></ul></div><p>属性和系统属性可以在命令行，ini文件或<code class="literal">[ini]</code>使用以下语法的模块部分。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">name=value</code></span></dt><dd>设置可以使用<property>元素</property>在XML文件中扩展的属性<property>。</property></dd><dt><span class="term"><code class="literal">name+=value</code></span></dt><dd>将值附加到现有属性值。</dd><dt><span class="term"><code class="literal">name+=,value</code></span></dt><dd>如果需要，使用逗号分隔符将值附加到现有属性值。</dd><dt><span class="term"><code class="literal">name?=value</code></span></dt><dd>仅在尚未设置属性时设置它。</dd></dl></div><p>如果前面的任何格式前面有<code class="literal">-D</code> ，然后设置系统属性和开始属性。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="custom-module-location"></a>模块位置</h3></div></div></div><p>Jetty随附了数十个模块，作为分发软件包的一部分。默认情况下，它们位于<code class="literal">${JETTY_HOME}/modules</code>目录。这些模块不应修改。在极少数情况下，您需要更改库存模块，然后将其复制到<code class="literal">${JETTY_BASE}</code>在一个<code class="literal">modules</code>目录。</p><p>自定义模块也应作为<code class="literal">${JETTY_BASE}/modules</code>目录，尽管您可以选择将它们放在<code class="literal">${JETTY_HOME}/modules</code>为了方便起见，如果您有几个<code class="literal">{$JETTY_BASE}</code>实施中的位置。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="custom-module-examples"></a>创建自定义模块</h3></div></div></div><p>如上所示，创建自定义模块文件时可以使用多个选项。这看似令人生畏，但是好消息是创建自定义模块实际上非常容易。</p><p>例如，下面是<code class="literal">http.mod</code>定义用于启用服务器的HTTP功能的参数的文件：</p><div class="screenexample"><pre class="screen">DO NOT EDIT - See: https://www.eclipse.org/jetty/documentation/current/startup-modules.html

[description]
Enables an HTTP connector on the server.
By default HTTP/1 is support, but HTTP2C can
be added to the connector with the http2c module.

[tags]
connector
http

[depend]
server

[xml]
etc/jetty-http.xml

[ini-template]
### HTTP Connector Configuration

## Connector host/address to bind to
# jetty.http.host=0.0.0.0

## Connector port to listen on
# jetty.http.port=8080

## Connector idle timeout in milliseconds
# jetty.http.idleTimeout=30000

## Number of acceptors (-1 picks default based on number of cores)
# jetty.http.acceptors=-1

## Number of selectors (-1 picks default based on number of cores)
# jetty.http.selectors=-1

## ServerSocketChannel backlog (0 picks platform default)
# jetty.http.acceptorQueueSize=0

## Thread priority delta to give to acceptor threads
# jetty.http.acceptorPriorityDelta=0

## Connect Timeout in milliseconds
# jetty.http.connectTimeout=15000

## HTTP Compliance: RFC7230, RFC7230_LEGACY, RFC2616, RFC2616_LEGACY, LEGACY or CUSTOMn
# jetty.http.compliance=RFC7230_LEGACY</pre></div><p>您会注意到<code class="literal">http.mod</code>文件仅包含一些可用的部分- <code class="literal">[description]</code> ， <code class="literal">[tags]</code> ， <code class="literal">[depend]</code> ， <code class="literal">[xml]</code>和<code class="literal">[ini-template]</code> 。在配置自己的模块时，您可以自由选择包含的模块。</p><p>例如，下面是一个模块文件，该文件定义了自定义XML和lib，并激活了许多其他模块。这样的模块可用于为新的JETTY_BASE启用一组标准模块和资源，而无需手动定义它们。</p><div class="screenexample"><pre class="screen">[description]
Enables the standard set of modules and resources for ACME Corp servers.

[tags]
core

[depend]
server
client
http
http2
jsp
console-capture
requestlog
stats
gzip
deploy
jmx

[files]
basehome:modules/acme/acme.xml|etc/acme.xml

[lib]
lib/acme/ACMECustom.jar</pre></div><p>激活此模块将激活所有从属模块，创建任何必需的目录并复制任何必需的文件：</p><div class="screenexample"><pre class="screen">java -jar ../start.jar --add-to-start=acme

ALERT: There are enabled module(s) with licenses.
The following 1 module(s):
 + contains software not provided by the Eclipse Foundation!
 + contains software not covered by the Eclipse Public License!
 + has not been audited for compliance with its license

 Module: alpn-impl/alpn-8
  + ALPN is a hosted at github under the GPL v2 with ClassPath Exception.
  + ALPN replaces/modifies OpenJDK classes in the sun.security.ssl package.
  + http://github.com/jetty-project/jetty-alpn
  + http://openjdk.java.net/legal/gplv2+ce.html

Proceed (y/N)? y
INFO  : webapp          transitively enabled, ini template available with --add-to-start=webapp
INFO  : server          transitively enabled, ini template available with --add-to-start=server
INFO  : requestlog      transitively enabled, ini template available with --add-to-start=requestlog
INFO  : alpn            transitively enabled, ini template available with --add-to-start=alpn
INFO  : jsp             transitively enabled
INFO  : servlet         transitively enabled
INFO  : alpn-impl/alpn-8 dynamic dependency of alpn
INFO  : annotations     transitively enabled
INFO  : gzip            transitively enabled, ini template available with --add-to-start=gzip
INFO  : ssl             transitively enabled, ini template available with --add-to-start=ssl
INFO  : plus            transitively enabled
INFO  : deploy          transitively enabled, ini template available with --add-to-start=deploy
INFO  : alpn-impl/alpn-1.8.0_92 dynamic dependency of alpn-impl/alpn-8
INFO  : security        transitively enabled
INFO  : jmx             transitively enabled
INFO  : apache-jsp      transitively enabled
INFO  : stats           transitively enabled, ini template available with --add-to-start=stats
INFO  : acme            initialized in ${jetty.base}/start.d/acme.ini
INFO  : jndi            transitively enabled
INFO  : console-capture transitively enabled, ini template available with --add-to-start=console-capture
INFO  : client          transitively enabled
INFO  : http            transitively enabled, ini template available with --add-to-start=http
INFO  : http2           transitively enabled, ini template available with --add-to-start=http2
MKDIR : ${jetty.base}/logs
MKDIR : ${jetty.base}/lib
MKDIR : ${jetty.base}/lib/alpn
MKDIR : ${jetty.base}/etc
COPY  : ${jetty.home}/modules/ssl/keystore to ${jetty.base}/etc/keystore
MKDIR : ${jetty.base}/webapps
DOWNLD: https://repo1.maven.org/maven2/org/mortbay/jetty/alpn/alpn-boot/8.1.8.v20160420/alpn-boot-8.1.8.v20160420.jar to ${jetty.base}/lib/alpn/alpn-boot-8.1.8.v20160420.jar
COPY  : ${jetty.home}/modules/acme/acme.xml to ${jetty.base}/etc/acme.xml
INFO  : Base directory was modified</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_dependencies"></a>依存关系</h3></div></div></div><p>启用相关模块后，默认情况下将以可传递方式进行操作。这意味着任何<code class="literal">ini</code>相关模块的文件未在<code class="literal">${JETTY_BASE}/start.d</code>目录（或添加到<code class="literal">${JETTY_BASE}/start.ini</code> ），因此无法配置。</p><p>供Jetty创建/添加<code class="literal">ini-template</code>参数<code class="literal">start.d</code>要么<code class="literal">start.ini</code>必须显式启用关联的模块。</p><p>例如，如果我激活<code class="literal">http</code>模块，它将被启用，并且<code class="literal">server</code>模块将暂时启用：</p><div class="screenexample"><pre class="screen">$ java -jar ../start.jar --add-to-start=http
INFO  : server          transitively enabled, ini template available with --add-to-start=server
INFO  : http            initialized in ${jetty.base}/start.d/http.ini
INFO  : Base directory was modified</pre></div><p>您会注意到，Jetty会通知您启用了哪些模块，以及相关的ini文件所在的位置（适用时）。它还告诉用户他们将需要运行什么命令来启用所选模块的所有丢失或所需的ini文件，在这种情况下<code class="literal">--add-to-start=server</code> 。</p><div class="screenexample"><pre class="screen">$ java -jar ../start.jar --add-to-start=server
INFO  : server          initialized in ${jetty.base}/start.d/server.ini
INFO  : Base directory was modified</pre></div><div class="blockquote"><blockquote class="blockquote"><div class="note" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-asterisk" aria-hidden="true"></i>注意</h3><p>重要的是要记住，激活依赖项时，Jetty不仅会下降一层。如果从属模块也具有依赖关系，则它们也将被启用。</p></div></blockquote></div></div></div><script type="text/javascript">
      SyntaxHighlighter.all()
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tbody><tr><td width="40%" align="left"><a href="startup-modules.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><td width="20%" align="center"><a href="startup.html" accesskey="u"><i class="fa fa-chevron-up" aria-hidden="true"></i>最佳</a></td><td width="40%" align="right"> <a href="startup-xml-config.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr><tr><td width="40%" align="left" valign="top">管理启动模块</td><td width="20%" align="center"><a href="index.html" accesskey="h"><i class="fa fa-home" aria-hidden="true"></i>家</a></td><td width="40%" align="right" valign="top">管理基于XML的启动配置</td></tr></tbody></table></div><p xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"></p><div class="jetty-callout">看到错误或缺少的东西？
            <span class="callout"><a href="http://github.com/eclipse/jetty.project">在以下位置对此文档做出贡献<span class="website"><i class="fa fa-github" aria-hidden="true"></i> Github！</span></a></span> <span style="float:right"><i>（产生：2019-11-20）</i></span></div><p></p></body></html>