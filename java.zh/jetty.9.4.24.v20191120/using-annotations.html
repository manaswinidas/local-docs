<html ><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>使用注释</title><link rel="stylesheet" type="text/css" href="css/docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="jetty, servlet, servlet-api, cometd, http, websocket, eclipse, maven, java, server, software"><link rel="home" href="index.html" title="Jetty"><link rel="up" href="annotations.html" title="Chapter 13. Annotations"><link rel="prev" href="annotations.html" title="Chapter 13. Annotations"><link rel="next" href="using-annotations-embedded.html" title="Using Annotations with Jetty Embedded"><link rel="shortcut icon" href="images/favicon.ico" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><link rel="stylesheet" href="css/highlighter/foundation.css"><script src="js/highlight.pack.js"></script><script>
      hljs.initHighlightingOnLoad();
    </script><link type="text/css" rel="stylesheet" href="css/font-awesome/font-awesome.min.css"></head><body bgcolor="white"  text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><tbody><tr><td style="width:25%"><a href="http://www.eclipse.org/jetty"><img src="images/jetty-header-logo.png" alt="Jetty标志"></a><br><span style="font-size:small">版本：9.4.24.v20191120</span></td><td style="width:50%"></td></tr></tbody></table><div class="navheader" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><table width="100%" summary="Navigation header"><tbody><tr><th colspan="3" align="center">使用注释</th></tr><tr><td width="20%" align="left"><a href="annotations.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><th width="60%" align="center">第十三章注解<br><a href="index.html" accesskey="p"><i class="fa fa-home" aria-hidden="true"></i>家</a></th><td width="20%" align="right"> <a href="using-annotations-embedded.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr></tbody></table><hr></div><div class="jetty-callout" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><h5 class="callout"><a href="http://www.webtide.com/">通过<span class="website">www.webtide.com</span>与Jetty核心开发人员联系。</a></h5><p>内部/客户项目的私人支持...自定义扩展和发行版...无限期支持的版本快照...您的应用程序和Ajax / Comet项目的可伸缩性指南...赞助功能开发的开发服务</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear:both"><a name="using-annotations"></a>使用注释</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="using-annotations.html#_which_annotations_are_supported">支持哪些注释</a></span></dt><dt><span class="section"><a href="using-annotations.html#discoverable_introspectable_annotations">发现与内省注释</a></span></dt><dt><span class="section"><a href="using-annotations.html#jars-scanned-for-annotations">扫描哪些Jar文件以查找发现的注释</a></span></dt><dt><span class="section"><a href="using-annotations.html#_multi_threaded_annotation_scanning">多线程注释扫描</a></span></dt><dt><span class="section"><a href="using-annotations.html#servlet-container-initializers">ServletContainerInitializers</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_which_annotations_are_supported"></a>支持哪些注释</h3></div></div></div><p>Jetty支持以下注释的解释和应用：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem">@资源</li><li class="listitem">@资源</li><li class="listitem">@PostConstruct</li><li class="listitem">@PreDestroy</li><li class="listitem">@DeclaredRoles</li><li class="listitem">@RunAs</li><li class="listitem">@MultipartConfig</li><li class="listitem">@WebServlet</li><li class="listitem">@WebFilter</li><li class="listitem">@WebListener</li><li class="listitem">@WebInitParam</li><li class="listitem">@ ServletSecurity，@ HttpConstraint，@ HttpMethodConstraint</li><li class="listitem">@HandlesTypes（在ServletContainerInitializers上）</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="discoverable_introspectable_annotations"></a>发现与内省注释</h3></div></div></div><p>某些类型的注释可以放置在任何类上，而不必只是那些与容器直接交互的注释。这些类型的注释称为“已发现”，表示容器必须采取主动措施才能出去并找到它们。注释的另一种类型称为“自省”，这意味着它们出现在容器在其生命周期内与之交互的类上（例如， <code class="literal">javax.servlet.Servlet</code> ， <code class="literal">javax.servlet.Filter</code> ，…等），因此可以通过在此时对类进行简单检查来找到。</p><p>发现的注释的一些示例是：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem">@WebServlet</li><li class="listitem">@WebFilter</li><li class="listitem">@WebListener</li></ul></div><p>自省注释的一些示例包括：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem">@PostConstruct</li><li class="listitem">@PreDestroy</li><li class="listitem">@资源</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jars-scanned-for-annotations"></a>扫描哪些Jar文件以查找发现的注释</h3></div></div></div><p>web.xml文件可以包含属性<code class="literal">metadata-complete</code> 。如果设置为<code class="literal">true</code> ，则<span class="emphasis"><em>不会</em></span>扫描可发现的注释。但是，由于<a class="link" href="http://docs.oracle.com/javaee/6/api/javax/servlet/ServletContainerInitializer.html" target="_top">javax.servlet ，类的扫描<span class="emphasis"><em>仍然</em></span>可能发生</a><a class="link" href="http://docs.oracle.com/javaee/6/api/javax/servlet/ServletContainerInitializer.html" target="_top">。ServletContainerInitializer</a> 。Jetty使用<a class="link" href="http://docs.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html" target="_top">javax.util找到实现此接口的类</a><a class="link" href="http://docs.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html" target="_top">。ServiceLoader</a>机制，如果存在， <span class="emphasis"><em>并且</em></span>其中包括@HandlesTypes批注，则Jetty必须扫描Web应用程序的类层次结构。如果容器路径中或Web应用程序的WEB-INF / lib中有许多jar，这可能会非常耗时。</p><p>如果要进行扫描-因为<code class="literal">metadata-complete</code>是<code class="literal">false</code>或丢失，或者因为存在一个或多个<a class="link" href="http://docs.oracle.com/javaee/6/api/javax/servlet/ServletContainerInitializer.html" target="_top">javax.servlet。带有@HandlesTypes的ServletContainerIntializer-</a>那么Jetty必须同时考虑容器的类路径和webapp的类路径。</p><p>默认情况下，Jetty将<span class="emphasis"><em>不会</em></span>扫描容器的类路径上的任何类。如果您需要扫描容器类路径上的jar和类，则可以使用<a class="link" href="configuring-webapps.html#container-include-jar-pattern" title="org.eclipse.jetty.server.webapp。ContainerIncludeJarPattern"><code class="literal">org.eclipse.jetty.server.webapp.ContainerIncludeJarPattern</code></a> context属性，用于指定容器的类路径中要扫描的jar和目录的模式。</p><p>默认情况下，Jetty会扫描<span class="emphasis"><em>所有</em></span>类别的<code class="literal">WEB-INF/classes</code>和所有的罐子<code class="literal">WEB-INF/lib</code>根据由web.xml中的绝对或相对排序子句建立的顺序（如果有）。如果您的Web应用程序包含许多jar文件，则可以通过从扫描中省略它们来显着加快部署速度。为此，请使用<a class="link" href="configuring-webapps.html#web-inf-include-jar-pattern" title="org.eclipse.jetty.server.webapp。WebInfIncludeJarPattern">org.eclipse.jetty.server.webapp。WebInfIncludeJarPattern</a>上下文属性定义您要专门扫描的jar的模式。</p><p>请注意，如果您已为<a class="link" href="jetty-classloading.html#using-extra-classpath-method" title="Using the extraClasspath() method">Web</a>应用程序配置了<a class="link" href="jetty-classloading.html#using-extra-classpath-method" title="使用extraClasspath（）方法">extraClasspath</a> ，则它也将参与扫描过程。出于扫描目的，所有类dirs都被视为与WEB-INF / class中的类相同，而jars如同在WEB-INF / lib中一样。</p><p>如果需要<a class="link" href="using-annotations.html#servlet-container-initializers" title="ServletContainerInitializers">控制它们的应用顺序，</a>请参见下一节<a class="link" href="using-annotations.html#servlet-container-initializers" title="ServletContainerInitializers">ServletContainerInitializers</a> 。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_multi_threaded_annotation_scanning"></a>多线程注释扫描</h3></div></div></div><p><a class="link" href="using-annotations.html#jars-scanned-for-annotations" title="Which Jar Files Are Scanned For Discovered Annotations">如果要执行注释扫描</a> ，默认情况下，Jetty将以多线程方式<a class="link" href="using-annotations.html#jars-scanned-for-annotations" title="扫描哪些Jar文件以查找发现的注释">进行注释扫描</a> ，以便在最短的时间内完成它。</p><p>如果由于某些原因您不希望进行多线程扫描，则可以将Jetty配置为恢复为单线程扫描。有几种配置方法：</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">设置上下文属性<code class="literal">org.eclipse.jetty.annotations.multiThreaded</code>至<code class="literal">false</code></li><li class="listitem">设置服务器属性<code class="literal">org.eclipse.jetty.annotations.multiThreaded</code>至<code class="literal">false</code></li><li class="listitem">设置系统属性<code class="literal">org.eclipse.jetty.annotations.multiThreaded</code>至<code class="literal">false</code></li></ol></div><p>方法1将仅影响当前的Webapp。方法2将影响部署到同一服务器实例的所有Web应用程序。方法3将影响部署在同一JVM中的所有Web应用程序。</p><p>默认情况下，Jetty将最多等待60秒才能完成所有扫描线程。您可以通过执行以下任一操作将其设置为更高或更低的秒数：</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">设置上下文属性<code class="literal">org.eclipse.jetty.annotations.maxWait</code></li><li class="listitem">设置服务器属性<code class="literal">org.eclipse.jetty.annotations.maxWait</code></li><li class="listitem">设置系统属性<code class="literal">org.eclipse.jetty.annotations.maxWait</code></li></ol></div><p>方法1将仅影响当前的Webapp。方法2将影响部署到同一服务器实例的所有Web应用程序。方法3将影响部署在同一JVM中的所有Web应用程序。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="servlet-container-initializers"></a> ServletContainerInitializers</h3></div></div></div><p><a class="link" href="http://docs.oracle.com/javaee/6/api/javax/servlet/ServletContainerInitializer.html" target="_top">javax.servlet。ServletContainerInitializer</a>类可以存在于：容器的类路径，Web应用程序的<code class="literal">WEB-INF/classes</code>目录，Web应用程序的<code class="literal">WEB-INF/lib</code>罐子，或您在<a class="link" href="jetty-classloading.html#using-extra-classpath-method" title="Using the extraClasspath() method">Web</a>应用程序上配置的任何外部<a class="link" href="jetty-classloading.html#using-extra-classpath-method" title="使用extraClasspath（）方法">extraClasspath</a> 。</p><p><a class="link" href="http://jcp.org/aboutJava/communityprocess/final/jsr340/" target="_top">Servlet规范</a>没有定义任何顺序，其中<code class="literal">ServletContainerInitializer</code> webapp启动时必须调用。默认情况下，Jetty将按以下顺序调用它们：</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">容器的类路径中的ServletContainerInitializers</li><li class="listitem">来自WEB-INF / classs的ServletContainerInitializers</li><li class="listitem">WEB-INF / lib <span class="emphasis"><em>中的</em></span> ServletContainerInitializers <span class="emphasis"><em>按照在web.xml中建立的顺序</em></span> ，或按<a class="link" href="http://docs.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html" target="_top">javax.util返回SCI的顺序进行</a><a class="link" href="http://docs.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html" target="_top">震击。ServiceLoader，</a>如果<span class="emphasis"><em>没有</em></span>订购</li></ol></div><p>由于是与注释扫描的情况下， <a class="link" href="jetty-classloading.html#using-extra-classpath-method" title="使用extraClasspath（）方法">extraClasspath</a>充分考虑<code class="literal">ServletContainerInitializer</code>回调。 <code class="literal">ServletContainerInitializer</code>派生自<code class="literal">extraClasspath</code>和罐子从<code class="literal">extraClasspath</code>分别在第2步和第3步中调用webapp。</p><div class="blockquote"><blockquote class="blockquote"><div class="note" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-asterisk" aria-hidden="true"></i>注意</h3><p>从Jetty 9.4.4开始，除非<code class="literal">web.xml</code>是3.0或更高版本<code class="literal">ServletContainerInitializers</code>将发现容器类路径上的内容。希望使用的用户<code class="literal">ServletContainerInitializers</code>从具有较旧版本的网络应用程序中<code class="literal">web.xml</code>必须要么升级他们的<code class="literal">web.xml</code>版本或通话<code class="literal">WebAppContext.setConfigurationDiscovered(true)</code>以编程方式或在xml中。升级<code class="literal">web.xml</code>版本是可取的。</p></div></blockquote></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_controlling_the_order_of_servletcontainerinitializer_invocation"></a>控制ServletContainerInitializer调用的顺序</h4></div></div></div><p>如果你需要<code class="literal">ServletContainerInitializer</code>以不同于上面概述的特定顺序调用的类，可以使用context属性<code class="literal">org.eclipse.jetty.containerInitializerOrder</code> 。将它们设置为以逗号分隔的类名列表<code class="literal">ServletContainerInitializers</code>按照您希望它们应用的顺序。您可以选择在列表中<span class="strong"><strong>一次</strong></span>使用通配符“ <span class="strong"><strong>” *</strong></span> 。它将匹配所有<code class="literal">ServletContainerInitializer</code>分类未在列表中明确命名。</p><p>这是一个在代码中设置context属性的示例（尽管您也可以<a class="link" href="quickstart-config-what.html#intro-jetty-configuration-webapps" title="Configuring Web Applications">在xml中</a>进行<a class="link" href="quickstart-config-what.html#intro-jetty-configuration-webapps" title="配置Web应用程序">相同操作</a> ）：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>WebAppContext context = new WebAppContext();
context.setAttribute("org.eclipse.jetty.containerInitializerOrder",
                     "org.eclipse.jetty.websocket.jsr356.server.deploy.WebSocketServerContainerInitializer, com.acme.Foo.MySCI, *");</code></pre><p>在此示例中，我们确保<code class="literal">WebSocketServerContainerInitializer</code>是第一个<code class="literal">ServletContainerInitializer</code>依次为MySCI和其他任何<code class="literal">ServletContainerInitializer</code>发现但尚未调用的实例。</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="excluding-scis"></a>不包括ServletContainerInitializers</h4></div></div></div><p>默认情况下，根据Servlet规范，所有<code class="literal">ServletContainerInitializer</code>被发现的对象将被调用（有关如何控制调用顺序的信息，请参见上文）。有时，根据您的要求，可能需要完全阻止某些调用。</p><p>在这种情况下，您可以定义<code class="literal">org.eclipse.jetty.containerInitializerExclusionPattern</code>上下文属性。这是一个正则表达式，用于定义要排除的类名的<a class="link" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html" target="_top">模式</a> 。这是一个示例，在代码中设置context属性，尽管您可以<a class="link" href="quickstart-config-what.html#intro-jetty-configuration-webapps" title="配置Web应用程序">在xml中</a>进行完全相同的操作：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>WebAppContext context = new WebAppContext();
context.setAttribute("org.eclipse.jetty.containerInitializerExclusionPattern",
                     "com.acme.*|com.corp.SlowContainerInitializer");</code></pre><p>在此示例中，我们排除了<span class="strong"><strong>所有</strong></span> <code class="literal">ServletContainerInitializer</code> com.acme包中的实例，以及<code class="literal">SlowContainerInitializer</code> 。</p><p>可以同时使用排除和排序来控制<code class="literal">ServletContainerInitializer</code>调用-排除项将在订购前应用。</p></div></div></div><script type="text/javascript">
      SyntaxHighlighter.all()
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tbody><tr><td width="40%" align="left"><a href="annotations.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><td width="20%" align="center"><a href="annotations.html" accesskey="u"><i class="fa fa-chevron-up" aria-hidden="true"></i>最佳</a></td><td width="40%" align="right"> <a href="using-annotations-embedded.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr><tr><td width="40%" align="left" valign="top">第十三章注解</td><td width="20%" align="center"><a href="index.html" accesskey="h"><i class="fa fa-home" aria-hidden="true"></i>家</a></td><td width="40%" align="right" valign="top">在Jetty Embedded中使用注释</td></tr></tbody></table></div><p xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"></p><div class="jetty-callout">看到错误或缺少的东西？
            <span class="callout"><a href="http://github.com/eclipse/jetty.project">在以下位置对此文档做出贡献<span class="website"><i class="fa fa-github" aria-hidden="true"></i> Github！</span></a></span> <span style="float:right"><i>（产生：2019-11-20）</i></span></div><p></p></body></html>