<html ><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>SPNEGO支持</title><link rel="stylesheet" type="text/css" href="css/docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="jetty, servlet, servlet-api, cometd, http, websocket, eclipse, maven, java, server, software"><link rel="home" href="index.html" title="Jetty"><link rel="up" href="configuring-security.html" title="Chapter 7. Configuring Security"><link rel="prev" href="jaas-support.html" title="JAAS Support"><link rel="next" href="configuring-jsp.html" title="Chapter 8. Configuring JSP Support"><link rel="shortcut icon" href="images/favicon.ico" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><link rel="stylesheet" href="css/highlighter/foundation.css"><script src="js/highlight.pack.js"></script><script>
      hljs.initHighlightingOnLoad();
    </script><link type="text/css" rel="stylesheet" href="css/font-awesome/font-awesome.min.css"></head><body bgcolor="white"  text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><tbody><tr><td style="width:25%"><a href="http://www.eclipse.org/jetty"><img src="images/jetty-header-logo.png" alt="码头标志"></a><br><span style="font-size:small">版本：9.4.24.v20191120</span></td><td style="width:50%"></td></tr></tbody></table><div class="navheader" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><table width="100%" summary="Navigation header"><tbody><tr><th colspan="3" align="center">SPNEGO支持</th></tr><tr><td width="20%" align="left"><a href="jaas-support.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><th width="60%" align="center">第7章。配置安全性<br><a href="index.html" accesskey="p"><i class="fa fa-home" aria-hidden="true"></i>家</a></th><td width="20%" align="right"> <a href="configuring-jsp.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr></tbody></table><hr></div><div class="jetty-callout" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><h5 class="callout"><a href="http://www.webtide.com/">通过<span class="website">www.webtide.com</span>与Jetty核心开发人员联系。</a></h5><p>内部/客户项目的私人支持...自定义扩展和发行版...无限期支持的版本快照...您的应用程序和Ajax / Comet项目的可伸缩性指南...赞助功能开发的开发服务</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear:both"><a name="spnego-support"></a> SPNEGO支持</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="spnego-support.html#_configuring_jetty_and_spnego">配置Jetty和SPNEGO</a></span></dt><dt><span class="section"><a href="spnego-support.html#_configuring_firefox">配置Firefox</a></span></dt><dt><span class="section"><a href="spnego-support.html#_configuring_internet_explorer">配置Internet Explorer</a></span></dt></dl></div><p>简单和受保护的GSSAPI协商机制（SPNEGO）是一种在基于Windows或Active Directory的网络上运行时对用户进行无缝身份验证的方法。Jetty通过JDK（从Java 6和7的更高版本开始启用）支持这种类型的身份验证和授权。还需要注意的重要一点是，这是一个<span class="emphasis"><em>非常</em></span>脆弱的设置，其中的所有内容都需要正确配置才能正常工作，否则它可能会变得有趣而令人兴奋，更不用说晦涩难懂的方式了。</p><p>要启用此功能以及对Windows网络（例如Active Domain Controller）上的中央系统的知识和访问以及创建和维护服务用户的能力，需要大量的配置和测试。</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_configuring_jetty_and_spnego"></a>配置Jetty和SPNEGO</h3></div></div></div><p>要在启用SPNEGO的情况下运行，需要以下命令行选项：</p><div class="screenexample"><pre class="screen">-Djava.security.krb5.conf=/path/to/jetty/etc/krb5.ini \
-Djava.security.auth.login.config=/path/to/jetty/etc/spnego.conf \
-Djavax.security.auth.useSubjectCredsOnly=false</pre></div><p>对于调试SPNEGO身份验证，以下选项非常有用：</p><div class="screenexample"><pre class="screen">-Dorg.eclipse.jetty.LEVEL=debug \
-Dsun.security.spnego.debug=all</pre></div><p>必须通过以下方式在Web应用程序中启用SPNEGO身份验证。角色名称对于您的网络将有所不同。</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code> &lt;security-constraint&gt;
   &lt;web-resource-collection&gt;
     &lt;web-resource-name&gt;Secure Area&lt;/web-resource-name&gt;
     &lt;url-pattern&gt;/secure/me/*&lt;/url-pattern&gt;
   &lt;/web-resource-collection&gt;
   &lt;auth-constraint&gt;
     &lt;!-- this is the domain that the user is a member of --&gt;
     &lt;role-name&gt;MORTBAY.ORG&lt;/role-name&gt;
   &lt;/auth-constraint&gt;
 &lt;/security-constraint&gt;
 &lt;login-config&gt;
   &lt;auth-method&gt;SPNEGO&lt;/auth-method&gt;
   &lt;realm-name&gt;Test Realm&lt;/realm-name&gt;
   &lt;!-- optionally to add custom error page --&gt;
   &lt;spnego-login-config&gt;
     &lt;spnego-error-page&gt;/loginError.html?param=foo&lt;/spnego-error-page&gt;
   &lt;/spnego-login-config&gt;
 &lt;/login-config&gt;</code></pre><p>对应的<code class="literal">UserRealm</code>如果需要嵌入，则需要通过编程方式通过<code class="literal">jetty.xml</code>或Webapp的上下文文件中。</p><p>这就是Jetty xml文件中的配置。</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>  &lt;Call name="addBean"&gt;
     &lt;Arg&gt;
       &lt;New class="org.eclipse.jetty.security.SpnegoLoginService"&gt;
         &lt;Set name="name"&gt;Test Realm&lt;/Set&gt;
         &lt;Set name="config"&gt;&lt;Property name="jetty.home" default="."/&gt;/etc/spnego.properties&lt;/Set&gt;
       &lt;/New&gt;
     &lt;/Arg&gt;
   &lt;/Call&gt;</code></pre><p>这就是上下文xml文件中的配置。</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code> &lt;Get name="securityHandler"&gt;
   &lt;Set name="loginService"&gt;
     &lt;New class="org.eclipse.jetty.security.SpnegoLoginService"&gt;
       &lt;Set name="name"&gt;Test Realm&lt;/Set&gt;
       &lt;Set name="config"&gt;
        &lt;SystemProperty name="jetty.home" default="."/&gt;/etc/spnego.properties
      &lt;/Set&gt;
     &lt;/New&gt;
   &lt;/Set&gt;
   &lt;Set name="checkWelcomeFiles"&gt;true&lt;/Set&gt;
 &lt;/Get&gt;</code></pre><p>S3pnego需要许多重要的配置文件。在本测试示例中，这些配置文件的默认值位于<code class="literal">/etc</code> Jetty发行版的文件夹。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">spnego.properties</span></dt><dd>使用运行时属性配置用户领域</dd><dt><span class="term">krb5.ini</span></dt><dd>配置基础的kerberos设置</dd><dt><span class="term">spnego.conf</span></dt><dd>在gssapi和kerberos之间配置胶水</dd></dl></div><p>请务必注意，在<code class="literal">krb5.ini</code>和<code class="literal">spnego.conf</code>文件需要包含用于<code class="literal">targetName</code>用于http服务器。为此，请使用与此类似的过程：</p><p>在Windows Active Domain Controller上运行：</p><div class="screenexample"><pre class="screen">$ setspn -A HTTP/linux.mortbay.org ADUser</pre></div><p>要创建密钥表文件，请使用以下过程：</p><div class="screenexample"><pre class="screen">$ ktpass -out c:\dir\krb5.keytab -princ HTTP/linux.mortbay.org@MORTBAY.ORG -mapUser ADUser -mapOp set -pass ADUserPWD -crypto RC4-HMAC-NT -pType KRB5_NT_PRINCIPAL</pre></div><p>此步骤将为您提供密钥表文件，然后将其复制到运行http服务器的计算机上并从配置文件中引用。为了进行测试，我们将密钥表放入了<code class="literal">/etc</code>目录并从那里引用它。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_configuring_firefox"></a>配置Firefox</h3></div></div></div><p>需要采取以下步骤来通知Firefox应该使用协商对话框进行身份验证。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">浏览到about：config并同意警告</li><li class="listitem">搜索以查找<span class="emphasis"><em>网络</em></span>设置</li><li class="listitem">组<code class="literal">network.negotiate-auth.delegation-uris</code>到<a class="link" href="http://,https://" target="_top">http：//，https：//</a></li><li class="listitem">组<code class="literal">network.negotiate-auth.trusted-uris</code>到<a class="link" href="http://,https://" target="_top">http：//，https：//</a></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_configuring_internet_explorer"></a>配置Internet Explorer</h3></div></div></div><p>要通知Internet Explorer应该使用协商对话框进行身份验证，需要执行以下步骤。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">工具→选项→安全性→本地Intranet→站点（此处应检查所有内容）</li><li class="listitem">工具→选项→安全性→本地Intranet→站点→高级（将URL添加到服务器（ <code class="literal">http://</code>和/或<code class="literal">https://</code> —使用主机名，而不是IP）</li><li class="listitem">工具→选项→安全性→本地Intranet→站点→高级→关闭</li><li class="listitem">工具→选项→安全性→本地Intranet→站点→确定</li><li class="listitem">工具→选项→高级→安全性（在复选框列表中）</li><li class="listitem">找到并选择<code class="literal">Enable Integrated Windows Authentication</code></li><li class="listitem">工具→选项→高级→安全性→确定</li><li class="listitem">关闭IE，然后重新打开并浏览到受SPNEGO保护的资源</li></ol></div><p>您<span class="strong"><strong>必须</strong></span>使用主机名而不是IP。如果使用IP，则默认为NTLM身份验证。要使SPNEGO身份验证有效，必须满足以下条件：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem">您必须在网络的Intranet区域内</li><li class="listitem">使用主机名而不是IP访问服务器</li><li class="listitem">在IE中启用了集成Windows身份验证和/或在Firefox中信任了主机</li><li class="listitem">服务器不在浏览器本地；它不能在本地主机上运行</li><li class="listitem">客户端的Kerberos系统已通过域控制器的身份验证</li></ul></div></div></div><script type="text/javascript">
      SyntaxHighlighter.all()
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tbody><tr><td width="40%" align="left"><a href="jaas-support.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><td width="20%" align="center"><a href="configuring-security.html" accesskey="u"><i class="fa fa-chevron-up" aria-hidden="true"></i>最佳</a></td><td width="40%" align="right"> <a href="configuring-jsp.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr><tr><td width="40%" align="left" valign="top">JAAS支持</td><td width="20%" align="center"><a href="index.html" accesskey="h"><i class="fa fa-home" aria-hidden="true"></i>家</a></td><td width="40%" align="right" valign="top">第八章配置JSP支持</td></tr></tbody></table></div><p xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"></p><div class="jetty-callout">看到错误或缺少的东西？
            <span class="callout"><a href="http://github.com/eclipse/jetty.project">在以下位置对此文档做出贡献<span class="website"><i class="fa fa-github" aria-hidden="true"></i> Github！</span></a></span> <span style="float:right"><i>（产生：2019-11-20）</i></span></div><p></p></body></html>