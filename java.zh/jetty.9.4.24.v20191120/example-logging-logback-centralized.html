<html ><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>使用Logback进行集中式日志记录</title><link rel="stylesheet" type="text/css" href="css/docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="jetty, servlet, servlet-api, cometd, http, websocket, eclipse, maven, java, server, software"><link rel="home" href="index.html" title="Jetty"><link rel="up" href="configuring-logging.html" title="Chapter 11. Jetty Logging"><link rel="prev" href="configuring-logging-modules.html" title="Jetty Logging Integrations (SLF4J, Log4j, Logback, JCL, JUL)"><link rel="next" href="jetty-dump-tool.html" title="Jetty Dump Tool"><link rel="shortcut icon" href="images/favicon.ico" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><link rel="stylesheet" href="css/highlighter/foundation.css"><script src="js/highlight.pack.js"></script><script>
      hljs.initHighlightingOnLoad();
    </script><link type="text/css" rel="stylesheet" href="css/font-awesome/font-awesome.min.css"></head><body bgcolor="white"  text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><tbody><tr><td style="width:25%"><a href="http://www.eclipse.org/jetty"><img src="images/jetty-header-logo.png" alt="Jetty标志"></a><br><span style="font-size:small">版本：9.4.24.v20191120</span></td><td style="width:50%"></td></tr></tbody></table><div class="navheader" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><table width="100%" summary="Navigation header"><tbody><tr><th colspan="3" align="center">使用Logback进行集中式日志记录</th></tr><tr><td width="20%" align="left"><a href="configuring-logging-modules.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><th width="60%" align="center">第十一章Jetty记录<br><a href="index.html" accesskey="p"><i class="fa fa-home" aria-hidden="true"></i>家</a></th><td width="20%" align="right"> <a href="jetty-dump-tool.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr></tbody></table><hr></div><div class="jetty-callout" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><h5 class="callout"><a href="http://www.webtide.com/">通过<span class="website">www.webtide.com</span>与Jetty核心开发人员联系。</a></h5><p>内部/客户项目的私人支持...自定义扩展和发行版...无限期支持的版本快照...您的应用程序和Ajax / Comet项目的可伸缩性指南...赞助功能开发的开发服务</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear:both"><a name="example-logging-logback-centralized"></a>使用Logback进行集中式日志记录</h2></div></div></div><p><span class="emphasis"><em>集中日志</em></span>一词是指Jetty服务器和服务器上部署的所有Web应用程序的强制日志配置。它将所有记录事件从Web应用程序路由到服务器端的单个配置。</p><p>下面的示例显示了如何使用Jetty和Slf4j来完成此任务<code class="literal">Logback</code>管理将日志最终写入磁盘。</p><div class="blockquote"><blockquote class="blockquote"><div class="important" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-plus" aria-hidden="true"></i>重要</h3><p>这种机制会强制所有Web应用程序使用服务器的配置进行日志记录，这并不完全适用于所有Web应用程序。一个示例是将Jenkins-CI部署为Web应用程序，如果将其日志记录配置强制到服务器端，则会失去在<a class="link" href="http://jenkins-ci.org/" target="_top">Jenkins-CI</a>上查看来自各种内部版本的日志的能力（因为现在这些日志实际上将转到主服务器日志）。</p></div></blockquote></div><p>此配置本质上是多记录器配置，向部署者添加了配置以强制执行<code class="literal">WebAppClassLoader</code>更改为在特定于记录器的类的Webapps类路径上使用服务器类路径。</p><p>此配置使用的技术是提供<a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120org/eclipse/jetty/deploy/AppLifeCycle.Binding.html" target="_top">AppLifeCycle。绑定</a>到为公共日志记录类修改<a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/webapp/WebAppContext.html#getSystemClasspathPattern()" target="_top">WebAppContext.getSystemClasspathPattern（）。add（String）的</a> <a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/deploy/AppLifeCycle.html" target="_top">“部署”节点</a> 。请参阅<a class="link" href="https://github.com/jetty-project/jetty-webapp-logging/blob/master/src/main/java/org/eclipse/jetty/webapp/logging/CentralizedWebAppLoggingBinding.java" target="_top">org.eclipse.jetty.logging。CentralizedWebAppLoggingBinding</a>用于实际实现。</p><p>方便更换<code class="literal">logging</code>已创建模块以引导您的<code class="literal">${jetty.base}</code>该目录用于将所有Jetty服务器日志从多个日志框架捕获到由Logback管理的单个日志输出文件中。</p><div class="screenexample"><pre class="screen">[mybase]$ mkdir modules
[mybase]$ cd modules

[modules]$ curl -O https://raw.githubusercontent.com/jetty-project/logging-modules/master/capture-all/logging.mod
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1416  100  1416    0     0   4241      0 --:--:-- --:--:-- --:--:--  4252

[master]$ curl -O https://raw.githubusercontent.com/jetty-project/logging-modules/master/centralized/webapp-logging.mod
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   660  100   660    0     0   2032      0 --:--:-- --:--:-- --:--:--  2037
[modules]$ cd ..

[mybase]$ java -jar /opt/jetty-dist/start.jar --add-to-start=logging,webapp-logging
INFO: logging         initialised in ${jetty.base}/start.ini (appended)
MKDIR: ${jetty.base}/logs
DOWNLOAD: https://repo1.maven.org/maven2/org/slf4j/slf4j-api/1.6.6/slf4j-api-1.6.6.jar to lib/logging/slf4j-api-1.6.6.jar
DOWNLOAD: https://repo1.maven.org/maven2/org/slf4j/log4j-over-slf4j/1.6.6/log4j-over-slf4j-1.6.6.jar to lib/logging/log4j-over-slf4j-1.6.6.jar
DOWNLOAD: https://repo1.maven.org/maven2/org/slf4j/jul-to-slf4j/1.6.6/jul-to-slf4j-1.6.6.jar to lib/logging/jul-to-slf4j-1.6.6.jar
DOWNLOAD: https://repo1.maven.org/maven2/org/slf4j/jcl-over-slf4j/1.6.6/jcl-over-slf4j-1.6.6.jar to lib/logging/jcl-over-slf4j-1.6.6.jar
DOWNLOAD: https://repo1.maven.org/maven2/ch/qos/logback/logback-core/1.0.7/logback-core-1.0.7.jar to lib/logging/logback-core-1.0.7.jar
DOWNLOAD: https://repo1.maven.org/maven2/ch/qos/logback/logback-classic/1.0.7/logback-classic-1.0.7.jar to lib/logging/logback-classic-1.0.7.jar
DOWNLOAD: https://raw.githubusercontent.com/jetty-project/logging-modules/master/capture-all/logback.xml to resources/logback.xml
DOWNLOAD: https://raw.githubusercontent.com/jetty-project/logging-modules/master/capture-all/jetty-logging.properties to resources/jetty-logging.properties
DOWNLOAD: https://raw.githubusercontent.com/jetty-project/logging-modules/master/capture-all/jetty-logging.xml to etc/jetty-logging.xml
INFO: resources       initialised transitively
INFO: resources       enabled in     ${jetty.base}/start.ini
INFO: webapp-logging  initialised in ${jetty.base}/start.ini (appended)
DOWNLOAD: https://repo1.maven.org/maven2/org/eclipse/jetty/jetty-webapp-logging/9.0.0/jetty-webapp-logging-9.0.0.jar to lib/webapp-logging/jetty-webapp-logging-9.0.0.jar
DOWNLOAD: https://raw.githubusercontent.com/jetty-project/jetty-webapp-logging/master/src/main/config/etc/jetty-webapp-logging.xml to etc/jetty-webapp-logging.xml
DOWNLOAD: https://raw.githubusercontent.com/jetty-project/jetty-webapp-logging/master/src/main/config/etc/jetty-mdc-handler.xml to etc/jetty-mdc-handler.xml
INFO: deploy          initialised transitively
INFO: deploy          enabled in     ${jetty.base}/start.ini
INFO: logging         initialised transitively
INFO: resources       initialised transitively
INFO: resources       enabled in     ${jetty.base}/start.ini

[mybase]$ java -jar /opt/jetty-dist/start.jar</pre></div><p>更换<code class="literal">logging.mod</code>执行许多任务。</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><code class="literal">mybase</code>是一个<code class="literal">${jetty.base}</code>目录。</li><li class="listitem">Jetty分布被拆开（和未触及）到<code class="literal">/opt/jetty-dist/</code>并成为<code class="literal">${jetty.home}</code>此演示的目录。</li><li class="listitem">的<code class="literal">curl</code>命令下载替换<code class="literal">logging.mod</code>并将其放入<code class="literal">${jetty.base}/modules/</code>该目录仅供mybase使用。</li><li class="listitem"><p class="simpara">的<code class="literal">start.jar --add-to-start=logging,webapp-logging</code>命令执行许多步骤以使日志记录模块可用于<code class="literal">${jetty.base}</code>组态。</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">几个条目被添加到<code class="literal">${jetty.base}/start.ini</code>组态。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem"><code class="literal">--module=logging</code>添加以启用日志记录模块。</li><li class="listitem"><code class="literal">--module=webapp-logging</code>添加以启用webapp日志记录模块。</li></ul></div></li><li class="listitem">需要<code class="literal">${jetty.base}</code>目录已创建： <code class="literal">${jetty.base}/logs</code>和<code class="literal">${jetty.base}/resources</code> 。</li><li class="listitem"><p class="simpara">所需的日志记录库已下载（如果尚不存在）到<code class="literal">${jetty.base}/lib/logging/</code>目录：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem"><code class="literal">slf4j-api.jar</code> -用于Slf4j的API罐（其余的大多数罐都使用）</li><li class="listitem"><code class="literal">log4j-over-slf4j.jar</code> -捕获所有log4j发出的日志事件的Slf4j jar</li><li class="listitem"><code class="literal">jul-to-slf4j.jar</code> -捕获所有java.util.logging事件的Slf4j jar</li><li class="listitem"><code class="literal">jcl-over-slf4j.jar</code> -捕获所有公用记录事件的Slf4j jar</li><li class="listitem"><code class="literal">logback-classic.jar</code> -Slf4j适配器jar，它将所有捕获的日志记录事件路由到logback本身。</li><li class="listitem"><code class="literal">logback-core.jar</code> -logback实现jar，用于处理所有日志事件的过滤和输出。</li></ul></div></li><li class="listitem"><p class="simpara">所需的webapp记录库已下载（如果尚不存在）到<code class="literal">${jetty.base}/lib/webapp-logging/</code>目录：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem"><code class="literal">jetty-webapp-logging.jar</code> -Jetty端部署管理器应用程序生命周期绑定，用于修改<code class="literal">WebAppClassloaders</code>已部署的Web应用程序。</li></ul></div></li><li class="listitem">所需的配置文件已下载（如果尚不存在）到<code class="literal">${jetty.base}/resources/</code>目录： <code class="literal">jetty-logging.properties</code>和<code class="literal">logback.xml</code> 。</li><li class="listitem">所需的初始化命令已下载（如果尚不存在）到<code class="literal">${jetty.base}/etc/</code>目录： <code class="literal">jetty-logging.xml</code> ， <code class="literal">jetty-webapp-logging.xml</code>和<code class="literal">jetty-mdc-handler.xml</code> 。</li></ol></div></li></ol></div><p>此时，Jetty<code class="literal">mybase</code>配置为使Jetty服务器本身将使用slf4j进行日志记录，并将来自其他Jetty Server组件（例如数据库驱动程序，安全层，jsp，邮件和其他第三方服务器组件）的所有其他日志记录事件路由到logback以进行过滤和输出。</p><p>通过部署的所有Web应用<code class="literal">DeploymentManager</code>有他们的<code class="literal">WebAppClassLoader</code>修改为在所有日志记录实现中使用服务器端类和配置。</p><p>可以使用以下命令验证服务器类路径<code class="literal">start.jar --list-config</code>命令。</p><p>本质上，Jetty现在已配置为向slf4j发出其自己的日志记录事件，并且各种slf4j桥jar都代表log4j进行操作， <code class="literal">java.util.logging</code>和<code class="literal">commons-logging</code> ，将所有日志记录事件路由到logback（slf4j适配器）以进行路由（到控制台，文件等）。</p></div><script type="text/javascript">
      SyntaxHighlighter.all()
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tbody><tr><td width="40%" align="left"><a href="configuring-logging-modules.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><td width="20%" align="center"><a href="configuring-logging.html" accesskey="u"><i class="fa fa-chevron-up" aria-hidden="true"></i>最佳</a></td><td width="40%" align="right"> <a href="jetty-dump-tool.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr><tr><td width="40%" align="left" valign="top">Jetty记录集成（SLF4J，Log4j，Logback，JCL，JUL）</td><td width="20%" align="center"><a href="index.html" accesskey="h"><i class="fa fa-home" aria-hidden="true"></i>家</a></td><td width="40%" align="right" valign="top">Jetty卸货工具</td></tr></tbody></table></div><p xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"></p><div class="jetty-callout">看到错误或缺少的东西？
            <span class="callout"><a href="http://github.com/eclipse/jetty.project">在以下位置对此文档做出贡献<span class="website"><i class="fa fa-github" aria-hidden="true"></i> Github！</span></a></span> <span style="float:right"><i>（产生：2019-11-20）</i></span></div><p></p></body></html>