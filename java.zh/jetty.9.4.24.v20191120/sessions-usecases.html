<html ><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>会话用例</title><link rel="stylesheet" type="text/css" href="css/docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="jetty, servlet, servlet-api, cometd, http, websocket, eclipse, maven, java, server, software"><link rel="home" href="index.html" title="Jetty"><link rel="up" href="session-management.html" title="Chapter 10. Session Management"><link rel="prev" href="session-configuration-memcachedsessiondatastore.html" title="Persistent Sessions: The L2 Session Data Cache"><link rel="next" href="configuring-logging.html" title="Chapter 11. Jetty Logging"><link rel="shortcut icon" href="images/favicon.ico" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><link rel="stylesheet" href="css/highlighter/foundation.css"><script src="js/highlight.pack.js"></script><script>
      hljs.initHighlightingOnLoad();
    </script><link type="text/css" rel="stylesheet" href="css/font-awesome/font-awesome.min.css"></head><body bgcolor="white"  text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><tbody><tr><td style="width:25%"><a href="http://www.eclipse.org/jetty"><img src="images/jetty-header-logo.png" alt="码头标志"></a><br><span style="font-size:small">版本：9.4.24.v20191120</span></td><td style="width:50%"></td></tr></tbody></table><div class="navheader" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><table width="100%" summary="Navigation header"><tbody><tr><th colspan="3" align="center">会话用例</th></tr><tr><td width="20%" align="left"><a href="session-configuration-memcachedsessiondatastore.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><th width="60%" align="center">第十章会话管理<br><a href="index.html" accesskey="p"><i class="fa fa-home" aria-hidden="true"></i>家</a></th><td width="20%" align="right"> <a href="configuring-logging.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr></tbody></table><hr></div><div class="jetty-callout" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><h5 class="callout"><a href="http://www.webtide.com/">通过<span class="website">www.webtide.com</span>与Jetty核心开发人员联系。</a></h5><p>内部/客户项目的私人支持...自定义扩展和发行版...无限期支持的版本快照...您的应用程序和Ajax / Comet项目的可伸缩性指南...赞助功能开发的开发服务</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear:both"><a name="sessions-usecases"></a>会话用例</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="sessions-usecases.html#_clustering_with_a_sticky_load_balancer">使用粘性负载均衡器进行集群</a></span></dt><dt><span class="section"><a href="sessions-usecases.html#_clustering_without_a_sticky_load_balancer">没有粘性负载均衡器的集群</a></span></dt><dt><span class="section"><a href="sessions-usecases.html#_handling_corrupted_or_unloadable_session_data">处理损坏或无法加载的会话数据</a></span></dt><dt><span class="section"><a href="sessions-usecases.html#_configuring_sessions_via_jetty_xml">通过Jetty XML配置会话</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_clustering_with_a_sticky_load_balancer"></a>使用粘性负载均衡器进行集群</h3></div></div></div><p>最好，您的群集将利用粘性负载均衡器。这会将对相同会话的请求路由到相同的Jetty实例。在这种情况下， <code class="literal">DefaultSessionCache</code>可用于将使用中的Session对象保留在内存中。您可以通过逐出策略设置控制会话对象在内存中保留多长时间，从而微调缓存。</p><p>如果您有大量的Session或非常大的Session对象，那么您可能希望通过控制Session对象在缓存中花费的时间来管理内存分配。的<code class="literal">EVICT_ON_SESSION_EXIT</code>一旦引用它的最后一个同时请求退出，驱逐策略就会从缓存中删除一个Session对象。或者， <code class="literal">EVICT_ON_INACTIVITY</code>在经过可配置的时间（没有请求引用该对象）之后，该策略将从缓存中删除会话对象。</p><p>如果您的会话寿命很长并且很少被引用，则可以使用<code class="literal">EVICT_ON_INACTIVITY_POLICY</code>控制缓存的大小。</p><p>如果您的会话较小，数量相对较少或数量稳定，或者是阅读最多的会话，则可以选择<code class="literal">NEVER_EVICT</code>政策。使用此策略，会话对象将保留在高速缓存中，直到它们到期或显式失效为止。</p><p>如果您同时请求同一会话对象的可能性很高，则<code class="literal">EVICT_ON_SESSION_EXIT</code>策略将确保Session对象在需要时一直保留在缓存中。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_clustering_without_a_sticky_load_balancer"></a>没有粘性负载均衡器的集群</h3></div></div></div><p>如果没有粘性负载均衡器，则对同一会话的请求可能会到达群集中的任何节点上。这意味着很可能在任何<code class="literal">SessionCache</code>由于会话可能最后一次在其他节点上访问，因此该会话可能已过时。在这种情况下， <code class="literal">choices</code>将使用<code class="literal">NullSessionCache</code>或取消调谐<code class="literal">DefaultSessionCache</code> 。如果使用NullSessionCache，则将避免所有Session对象缓存。这意味着每次请求引用会话时，都必须将其从持久性存储中引入。这也意味着同一会话的多个请求不能共享Session对象：每个对象都有自己的Session对象。此外，会话写的结果是不确定的，因为Servlet规范没有要求会话进行ACID事务。</p><p>如果您使用<code class="literal">DefaultSessionCache</code> ，由于对同一会话的同时请求分散在群集中，因此存在某些节点上的缓存可能包含过期的会话信息的风险。为了减轻这种情况，您可以使用<code class="literal">EVICT_ON_SESSION_EXIT</code>逐出策略：这将确保会话的最后一个同时请求退出时，将其从缓存中删除。同样，由于缺少会话事务性，无法保证写操作的排序结果。由于会话是在至少一个请求正在访问时被缓存的，因此多个同时的请求有可能共享同一会话对象。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_handling_corrupted_or_unloadable_session_data"></a>处理损坏或无法加载的会话数据</h3></div></div></div><p>由于各种原因，可能无法<code class="literal">SessionDataStore</code>重新读取存储的会话。一种情况是，会话将序列化的对象存储在其属性中，并在重新部署之后在其中进行了不兼容的类更改。使用二传手<code class="literal">SessionCache.setRemoveUnloadableSessions(true)</code>将允许<code class="literal">SessionDataStore</code>从持久性存储中删除不可读的会话。这有助于防止清除程序在相同的已过期但不可恢复的会话上连续生成错误。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_configuring_sessions_via_jetty_xml"></a>通过Jetty XML配置会话</h3></div></div></div><p>使用提供的会话模块，无需配置上下文xml或<code class="literal">jetty-web.xml</code>会话文件。也就是说，如果用户希望以此方式配置会话，则可以使用<a class="link" href="reference-section.html#jetty-xml-syntax" title="Jetty XML语法">Jetty IoC XML格式。</a></p><p>以下是如何配置<a class="link" href="configuring-sessions-file-system.html" title="持久会话：文件系统"><code class="literal">FileSessionDataStore</code></a> ，但相同的概念适用于本章中讨论的任何* SessionDataStores：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;Configure class="org.eclipse.jetty.webapp.WebAppContext"&gt;
  &lt;Call id="sh" name="getSessionHandler"&gt;
    &lt;Set name="sessionCache"&gt;
      &lt;New class="org.eclipse.jetty.server.session.DefaultSessionCache"&gt;
        &lt;Arg&gt;&lt;Ref id="sh"/&gt;&lt;/Arg&gt;
        &lt;Set name="sessionDataStore"&gt;
           &lt;New class="org.eclipse.jetty.server.session.FileSessionDataStore"&gt;
             &lt;Set name="storeDir"&gt;/tmp/sessions&lt;/Set&gt;
           &lt;/New&gt;
        &lt;/Set&gt;
      &lt;/New&gt;
    &lt;/Set&gt;
  &lt;/Call&gt;
&lt;/Configure&gt;</code></pre><p>上面的示例在<code class="literal">jetty-web.xml</code>文件或<a class="link" href="configuring-specific-webapp-deployment.html#using-basic-descriptor-files" title="使用基本描述符文件">上下文xml描述符文件。</a></p><div class="blockquote"><blockquote class="blockquote"><div class="note" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-asterisk" aria-hidden="true"></i>注意</h3><p>如果您明确配置<code class="literal">SessionCache</code>和<code class="literal">SessionDataStore</code>为一个<code class="literal">SessionHandler</code>在上下文xml文件中或<code class="literal">jetty-web.xml</code>文件中，您已启用的所有会话模块都将被忽略。因此，例如，如果您启用了<code class="literal">session-store-gcloud module</code>对于您的服务器，您可以强制特定的Web应用使用<code class="literal">FileSessionDataStore</code>通过在上下文xml文件或<code class="literal">jetty-web.xml</code>文件如上所示。</p></div></blockquote></div></div></div><script type="text/javascript">
      SyntaxHighlighter.all()
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tbody><tr><td width="40%" align="left"><a href="session-configuration-memcachedsessiondatastore.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><td width="20%" align="center"><a href="session-management.html" accesskey="u"><i class="fa fa-chevron-up" aria-hidden="true"></i>最佳</a></td><td width="40%" align="right"> <a href="configuring-logging.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr><tr><td width="40%" align="left" valign="top">持久会话：L2会话数据缓存</td><td width="20%" align="center"><a href="index.html" accesskey="h"><i class="fa fa-home" aria-hidden="true"></i>家</a></td><td width="40%" align="right" valign="top">第十一章码头记录</td></tr></tbody></table></div><p xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"></p><div class="jetty-callout">看到错误或缺少的东西？
            <span class="callout"><a href="http://github.com/eclipse/jetty.project">在以下位置对此文档做出贡献<span class="website"><i class="fa fa-github" aria-hidden="true"></i> Github！</span></a></span> <span style="float:right"><i>（产生：2019-11-20）</i></span></div><p></p></body></html>