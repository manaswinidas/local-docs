<html ><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>配置JNDI</title><link rel="stylesheet" type="text/css" href="css/docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="jetty, servlet, servlet-api, cometd, http, websocket, eclipse, maven, java, server, software"><link rel="home" href="index.html" title="Jetty"><link rel="up" href="jndi.html" title="Chapter 12. Configuring JNDI"><link rel="prev" href="using-jetty-jndi.html" title="Working with Jetty JNDI"><link rel="next" href="jndi-embedded.html" title="Using JNDI with Jetty Embedded"><link rel="shortcut icon" href="images/favicon.ico" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><link rel="stylesheet" href="css/highlighter/foundation.css"><script src="js/highlight.pack.js"></script><script>
      hljs.initHighlightingOnLoad();
    </script><link type="text/css" rel="stylesheet" href="css/font-awesome/font-awesome.min.css"></head><body bgcolor="white"  text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><tbody><tr><td style="width:25%"><a href="http://www.eclipse.org/jetty"><img src="images/jetty-header-logo.png" alt="码头标志"></a><br><span style="font-size:small">版本：9.4.24.v20191120</span></td><td style="width:50%"></td></tr></tbody></table><div class="navheader" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><table width="100%" summary="Navigation header"><tbody><tr><th colspan="3" align="center">配置JNDI</th></tr><tr><td width="20%" align="left"><a href="using-jetty-jndi.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><th width="60%" align="center">第十二章配置JNDI<br><a href="index.html" accesskey="p"><i class="fa fa-home" aria-hidden="true"></i>家</a></th><td width="20%" align="right"> <a href="jndi-embedded.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr></tbody></table><hr></div><div class="jetty-callout" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><h5 class="callout"><a href="http://www.webtide.com/">通过<span class="website">www.webtide.com</span>与Jetty核心开发人员联系。</a></h5><p>内部/客户项目的私人支持...自定义扩展和发行版...无限期支持的版本快照...您的应用程序和Ajax / Comet项目的可伸缩性指南...赞助功能开发的开发服务</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear:both"><a name="jndi-configuration"></a>配置JNDI</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="jndi-configuration.html#configuring-jndi-env-entries">配置JNDI <span class="emphasis"><em>ENV条目</em></span></a></span></dt><dt><span class="section"><a href="jndi-configuration.html#configuring-resource-refs-and-resource-env-refs">配置<span class="emphasis"><em>资源引用</em></span>和<span class="emphasis"><em>资源环境引用</em></span></a></span></dt><dt><span class="section"><a href="jndi-configuration.html#configuring-datasources">配置数据源</a></span></dt><dt><span class="section"><a href="jndi-configuration.html#configuring-jms-queues-topics-connectionfactories">配置JMS队列，主题和连接工厂</a></span></dt><dt><span class="section"><a href="jndi-configuration.html#configuring-mail-with-jndi">配置邮件</a></span></dt><dt><span class="section"><a href="jndi-configuration.html#configuring-xa-transactions">配置XA事务</a></span></dt><dt><span class="section"><a href="jndi-configuration.html#configuring-links">配置链接</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuring-jndi-env-entries"></a>配置JNDI <span class="emphasis"><em>ENV条目</em></span></h3></div></div></div><p>有时，在运行时将配置信息传递到Webapp很有用，您可能无法或无法方便地将其编码为<code class="literal">web.xml</code>环境。在这种情况下，您可以使用<code class="literal">org.eclipse.jetty.plus.jndi.EnvEntry</code>类，甚至覆盖相同名称的条目<code class="literal">web.xml</code> 。</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;New class="org.eclipse.jetty.plus.jndi.EnvEntry"&gt;
  &lt;Arg&gt;&lt;/Arg&gt;
  &lt;Arg&gt;mySpecialValue&lt;/Arg&gt;
  &lt;Arg type="java.lang.Integer"&gt;4000&lt;/Arg&gt;
  &lt;Arg type="boolean"&gt;true&lt;/Arg&gt;
&lt;/New&gt;</code></pre><p>这个例子定义了一个虚拟的<code class="literal">env-entry</code>叫<code class="literal">mySpecialValue</code>有价值<code class="literal">4000</code> <a class="link" href="using-jetty-jndi.html#jndi-name-scope" title="资源名称范围">范围仅限</a>于JVM。它被放入JNDI中<code class="literal">java:comp/env/mySpecialValue</code>对于部署的<span class="emphasis"><em>每个</em></span> Web应用程序。此外，布尔值参数表示此值会覆盖<code class="literal">env-entry</code>在同名<code class="literal">web.xml</code> 。如果您不想覆盖，请忽略此参数，或将其设置为<code class="literal">false</code> 。</p><p>Servlet规范仅允许将以下对象类型绑定到<code class="literal">env-entry</code> ：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem">java.lang。串</li><li class="listitem">java.lang。整数</li><li class="listitem">java.lang。浮动</li><li class="listitem">java.lang。双</li><li class="listitem">java.lang。长</li><li class="listitem">java.lang。短</li><li class="listitem">java.lang。字符</li><li class="listitem">java.lang。字节</li><li class="listitem">java.lang。布尔型</li></ul></div><p>话虽这么说，Jetty更加灵活，并且允许您绑定自定义POJO， <a class="link" href="http://docs.oracle.com/javase/1.5.0/docs/api/javax/naming/Reference.html" target="_top"><code class="literal">javax.naming.References</code></a>和<a class="link" href="http://docs.oracle.com/javase/1.5.0/docs/api/javax/naming/Referenceable.html" target="_top"><code class="literal">javax.naming.Referenceables</code></a> 。请注意，如果您利用此功能，则您的Web应用程序<span class="emphasis"><em>不可移植</em></span> 。</p><p>要使用<code class="literal">env-entry</code>以上配置，在您的代码中使用代码<code class="literal">servlet/filter/etc.</code> ， 如：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>import javax.naming.InitialContext;

public class MyClass {

  public void myMethod() {

    InitialContext ic = new InitialContext();
    Integer mySpecialValue = (Integer)ic.lookup("java:comp/env/mySpecialValue");
    ...
  }
}</code></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuring-resource-refs-and-resource-env-refs"></a>配置<span class="emphasis"><em>资源引用</em></span>和<span class="emphasis"><em>资源环境引用</em></span></h3></div></div></div><p>您可以配置要在资源管理器中引用的任何类型的资源。 <code class="literal">web.xml</code>作为一个文件<code class="literal">resource-ref</code>要么<code class="literal">resource-env-ref</code> ， 使用<code class="literal">org.eclipse.jetty.plus.jndi.Resource</code>命名条目的类型。您提供范围，对象名称（相对于<code class="literal">java:comp/env</code> ）和POJO实例或<code class="literal">javax.naming.Reference</code>实例或<code class="literal">javax.naming.Referenceable</code>实例。</p><p><a class="link" href="http://jcp.org/aboutJava/communityprocess/pr/jsr244/index.html" target="_top">J2EE规范</a>建议将数据源存储在<code class="literal">java:comp/env/jdbc</code> ，JMS连接工厂下<code class="literal">java:comp/env/jms</code> ，下的JavaMail连接工厂<code class="literal">java:comp/env/mail</code>和URL连接工厂<code class="literal">java:comp/env/url</code> 。</p><p>例如：</p><div class="table"><a name="d0e15440"></a><p class="title"><b>表12.1数据源声明约定</b></p><div class="table-contents"><table class="table" border="1" summary="DataSource Declaration Conventions"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th align="left" valign="top">资源类型</th><th align="left" valign="top">在中命名<code class="literal">jetty.xml</code></th><th align="left" valign="top">环境查询</th></tr></thead><tbody><tr><td align="left" valign="top"><p>javax.sql。数据源</p></td><td align="left" valign="top"><p>jdbc / myDB</p></td><td align="left" valign="top"><p>java：comp / env / jdbc / myDB</p></td></tr><tr><td align="left" valign="top"><p>javax.jms。QueueConnectionFactory</p></td><td align="left" valign="top"><p>jms / myQueue</p></td><td align="left" valign="top"><p>java：comp / env / jms / myQueue</p></td></tr><tr><td align="left" valign="top"><p>javax.mail。届会</p></td><td align="left" valign="top"><p>邮件/ myMailService</p></td><td align="left" valign="top"><p>java：comp / env / mail / myMailService</p></td></tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuring-datasources"></a>配置数据源</h3></div></div></div><p>这是配置<code class="literal">javax.sql.DataSource</code> 。Jetty可以使用其类路径上可用的任何DataSource实现。在此示例中，数据源来自<a class="link" href="http://db.apache.org/derby" target="_top">Derby</a>关系数据库，但是您可以使用<code class="literal">javax.sql.DataSource</code> 。本示例将其配置为范围为<span class="emphasis"><em>wac</em></span>的Web应用程序：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;Configure id='wac' class="org.eclipse.jetty.webapp.WebAppContext"&gt;
  &lt;New id="myds" class="org.eclipse.jetty.plus.jndi.Resource"&gt;
    &lt;Arg&gt;&lt;Ref refid="wac"/&gt;&lt;/Arg&gt;
    &lt;Arg&gt;jdbc/myds&lt;/Arg&gt;
    &lt;Arg&gt;
      &lt;New class="org.apache.derby.jdbc.EmbeddedDataSource"&gt;
        &lt;Set name="DatabaseName"&gt;test&lt;/Set&gt;
        &lt;Set name="createDatabase"&gt;create&lt;/Set&gt;
      &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/New&gt;
&lt;/Configure&gt;</code></pre><p>上面的代码创建了一个实例<code class="literal">org.apache.derby.jdbc.EmbeddedDataSource</code> ，调用两个setter方法<code class="literal">setDatabaseName("test"),</code>和<code class="literal">setCreateDatabase("create"),</code>并将其绑定到Web应用程序的JNDI范围。如果您没有适当的<code class="literal">resource-ref</code>在你的<code class="literal">web.xml</code> ，可以从应用程序查找中使用<code class="literal">java:comp/env/jdbc/myds</code> 。</p><p>这是一个例子<code class="literal">web.xml</code>上面数据源的声明：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;resource-ref&gt;
  &lt;res-ref-name&gt;jdbc/myds&lt;/res-ref-name&gt;
  &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
  &lt;res-auth&gt;Container&lt;/res-auth&gt;
&lt;/resource-ref&gt;</code></pre><p>在您的数据库中查找您的数据源<code class="literal">servlet/filter/etc.</code> ：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>import javax.naming.InitialContext;
import javax.sql.DataSource;

public class MyClass {

  public void myMethod() {

    InitialContext ic = new InitialContext();
    DataSource myDS = (DataSource)ic.lookup("java:comp/env/jdbc/myds");

    ...
  }
}</code></pre><div class="blockquote"><blockquote class="blockquote"><div class="note" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-asterisk" aria-hidden="true"></i>注意</h3><p>小心！配置资源时，请确保您配置的对象类型与您希望在其中查找的对象类型匹配<code class="literal">java:comp/env</code> 。对于数据库连接工厂，这意味着您注册为资源的对象<span class="emphasis"><em>必须</em></span>实现<code class="literal">javax.sql.DataSource</code>接口。</p></div></blockquote></div><p>有关数据源配置的更多示例，请参见<a class="xref" href="jndi-datasource-examples.html" title="数据源示例">数据源示例</a> 。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuring-jms-queues-topics-connectionfactories"></a>配置JMS队列，主题和连接工厂</h3></div></div></div><p>Jetty可以绑定JMS目标和连接工厂的任何实现。您只需要确保Jetty的classpath上可以使用实现Jars。这是绑定<a class="link" href="http://activemq.apache.org" target="_top">ActiveMQ</a> in-JVM连接工厂的示例：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;Configure id='wac' class="org.eclipse.jetty.webapp.WebAppContext"&gt;
  &lt;New id="cf" class="org.eclipse.jetty.plus.jndi.Resource"&gt;
    &lt;Arg&gt;&lt;Ref refid='wac'/&gt;&lt;/Arg&gt;
    &lt;Arg&gt;jms/connectionFactory&lt;/Arg&gt;
    &lt;Arg&gt;
      &lt;New class="org.apache.activemq.ActiveMQConnectionFactory"&gt;
        &lt;Arg&gt;vm://localhost?broker.persistent=false&lt;/Arg&gt;
      &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/New&gt;
&lt;/Configure&gt;</code></pre><p>中的条目<code class="literal">web.xml</code>将会：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;resource-ref&gt;
  &lt;res-ref-name&gt;jms/connectionFactory&lt;/res-ref-name&gt;
  &lt;res-type&gt;javax.jms.ConnectionFactory&lt;/res-type&gt;
  &lt;res-auth&gt;Container&lt;/res-auth&gt;
&lt;/resource-ref&gt;</code></pre><p>TODO：在进度演示中放入一个QUEUE示例</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuring-mail-with-jndi"></a>配置邮件</h3></div></div></div><p>码头还提供了访问<code class="literal">javax.mail.Sessions</code>从应用程序内部：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;Configure id='wac' class="org.eclipse.jetty.webapp.WebAppContext"&gt;
  &lt;New id="mail" class="org.eclipse.jetty.plus.jndi.Resource"&gt;
    &lt;Arg&gt;&lt;Ref refid="wac"/&gt;&lt;/Arg&gt;
    &lt;Arg&gt;mail/Session&lt;/Arg&gt;
    &lt;Arg&gt;
      &lt;New class="org.eclipse.jetty.jndi.factories.MailSessionReference"&gt;
        &lt;Set name="user"&gt;fred&lt;/Set&gt;
        &lt;Set name="password"&gt;OBF:1xmk1w261z0f1w1c1xmq&lt;/Set&gt;
        &lt;Set name="properties"&gt;
          &lt;New class="java.util.Properties"&gt;
            &lt;Put name="mail.smtp.host"&gt;XXX&lt;/Put&gt;
            &lt;Put name="mail.from"&gt;me@me&lt;/Put&gt;
            &lt;Put name="mail.debug"&gt;true&lt;/Put&gt;
          &lt;/New&gt;
        &lt;/Set&gt;
      &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/New&gt;
&lt;/Configure&gt;</code></pre><p>此设置将创建一个实例<code class="literal">org.eclipse.jetty.jndi.factories.MailSessionReference</code>类，调用它的setter方法来设置邮件系统的身份验证，并填充一组属性，然后在<code class="literal">MailSessionReference</code>实例。结果是应用程序可以查找<code class="literal">java:comp/env/mail/Session</code>在运行时并获得对<code class="literal">javax.mail.Session</code>具有必要的配置以允许其通过SMTP发送电子邮件。</p><div class="blockquote"><blockquote class="blockquote"><div class="tip" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-lightbulb-o" aria-hidden="true"></i>小费</h3><p>您可以将密码设置为纯文本，或使用Jetty的<a class="link" href="configuring-security-secure-passwords.html" title="安全密码混淆">安全密码混淆</a> （OBF :)机制使配置文件更安全一些，以免被撬开。请记住，您不能使用MD5和Crypt的其他Jetty加密机制，因为它们不允许您恢复邮件系统所需的原始密码。</p></div></blockquote></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuring-xa-transactions"></a>配置XA事务</h3></div></div></div><p>如果要使用资源执行分布式事务，则需要一个支持JTA接口的<span class="emphasis"><em>事务管理器</em></span> ，并且可以将其查找为<code class="literal">java:comp/UserTransaction</code>在您的webapp中。Jetty并未标配一种，但您可以插入自己喜欢的一种。您可以使用Jetty配置文件中的<a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/plus/jndi/Transaction.html" target="_top">JNDI事务</a>对象配置事务管理器。以下示例配置<a class="link" href="http://www.atomikos.com/" target="_top">Atomikos</a>事务管理器：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;New id="tx" class="org.eclipse.jetty.plus.jndi.Transaction"&gt;
  &lt;Arg&gt;
    &lt;New class="com.atomikos.icatch.jta.J2eeUserTransaction"/&gt;
  &lt;/Arg&gt;
&lt;/New&gt;</code></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuring-links"></a>配置链接</h3></div></div></div><p>通常，您为自己设置的名称<code class="literal">Resource</code>应该与您在其中使用的名称相同<code class="literal">web.xml</code> 。例如：</p><p>在上下文xml文件中：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;Configure id='wac' class="org.eclipse.jetty.webapp.WebAppContext"&gt;
  &lt;New id="myds" class="org.eclipse.jetty.plus.jndi.Resource"&gt;
    &lt;Arg&gt;&lt;Ref refid="wac"/&gt;&lt;/Arg&gt;
    &lt;Arg&gt;jdbc/mydatasource&lt;/Arg&gt;
    &lt;Arg&gt;
      &lt;New class="org.apache.derby.jdbc.EmbeddedDataSource"&gt;
        &lt;Set name="DatabaseName"&gt;test&lt;/Set&gt;
        &lt;Set name="createDatabase"&gt;create&lt;/Set&gt;
      &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/New&gt;
&lt;/Configure&gt;</code></pre><p>在一个<code class="literal">web.xml</code>文件：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;resource-ref&gt;
  &lt;res-ref-name&gt;jdbc/mydatasource&lt;/res-ref-name&gt;
  &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
  &lt;res-auth&gt;Container&lt;/res-auth&gt;
  &lt;injection-target&gt;
    &lt;injection-target-class&gt;com.acme.JNDITest&lt;/injection-target-class&gt;
    &lt;injection-target-name&gt;myDatasource&lt;/injection-target-name&gt;
  &lt;/injection-target&gt;
&lt;/resource-ref&gt;</code></pre><p>但是，您可以在<code class="literal">web.xml</code>用不同的名称，并将其链接到您的<code class="literal">org.eclipse.jetty.plus.jndi.Resource</code>通过使用<code class="literal">org.eclipse.jetty.plus.jndi.Link</code> 。对于上面的示例，您可以参考<code class="literal">jdbc/mydatasource</code>作为资源<code class="literal">jdbc/mydatasource1</code>如下：</p><p>在上下文xml文件中声明<code class="literal">jdbc/mydatasource</code> ：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;Configure id='wac' class="org.eclipse.jetty.webapp.WebAppContext"&gt;
  &lt;New id="myds" class="org.eclipse.jetty.plus.jndi.Resource"&gt;
    &lt;Arg&gt;&lt;Ref refid="wac"/&gt;&lt;/Arg&gt;
    &lt;Arg&gt;jdbc/mydatasource&lt;/Arg&gt;
    &lt;Arg&gt;
      &lt;New class="org.apache.derby.jdbc.EmbeddedDataSource"&gt;
        &lt;Set name="DatabaseName"&gt;test&lt;/Set&gt;
        &lt;Set name="createDatabase"&gt;create&lt;/Set&gt;
      &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/New&gt;
&lt;/Configure&gt;</code></pre><p>然后在<code class="literal">WEB-INF/jetty-env.xml</code>文件，链接名称<code class="literal">jdbc/mydatasource</code>到您要引用的名称<code class="literal">web.xml</code> ，在这种情况下是<code class="literal">jdbc/mydatasource1</code> ：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;New id="map1" class="org.eclipse.jetty.plus.jndi.Link"&gt;
  &lt;Arg&gt;&lt;Ref refid='wac'/&gt;&lt;/Arg&gt;
  &lt;Arg&gt;jdbc/mydatasource1&lt;/Arg&gt; &lt;!-- name in web.xml --&gt;
  &lt;Arg&gt;jdbc/mydatasource&lt;/Arg&gt;  &lt;!-- name in container environment --&gt;
&lt;/New&gt;</code></pre><p>现在您可以参考<code class="literal">jdbc/mydatasource1</code>在里面<code class="literal">web.xml</code>像这样：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;resource-ref&gt;
  &lt;res-ref-name&gt;jdbc/mydatasource1&lt;/res-ref-name&gt;
  &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
  &lt;res-auth&gt;Container&lt;/res-auth&gt;
  &lt;injection-target&gt;
    &lt;injection-target-class&gt;com.acme.JNDITest&lt;/injection-target-class&gt;
    &lt;injection-target-name&gt;myDatasource&lt;/injection-target-name&gt;
  &lt;/injection-target&gt;
&lt;/resource-ref&gt;</code></pre><p>当您无法直接在JNDI资源中更改JNDI资源时，此功能很有用。 <code class="literal">web.xml</code>但需要将其链接到部署环境中的特定资源。</p></div></div><script type="text/javascript">
      SyntaxHighlighter.all()
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tbody><tr><td width="40%" align="left"><a href="using-jetty-jndi.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><td width="20%" align="center"><a href="jndi.html" accesskey="u"><i class="fa fa-chevron-up" aria-hidden="true"></i>最佳</a></td><td width="40%" align="right"> <a href="jndi-embedded.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr><tr><td width="40%" align="left" valign="top">与Jetty JNDI合作</td><td width="20%" align="center"><a href="index.html" accesskey="h"><i class="fa fa-home" aria-hidden="true"></i>家</a></td><td width="40%" align="right" valign="top">将JNDI与Jetty Embedded一起使用</td></tr></tbody></table></div><p xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"></p><div class="jetty-callout">看到错误或缺少的东西？
            <span class="callout"><a href="http://github.com/eclipse/jetty.project">在以下位置对此文档做出贡献<span class="website"><i class="fa fa-github" aria-hidden="true"></i> Github！</span></a></span> <span style="float:right"><i>（产生：2019-11-20）</i></span></div><p></p></body></html>