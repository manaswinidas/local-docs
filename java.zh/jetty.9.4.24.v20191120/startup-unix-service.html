<html ><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>使用jetty.sh启动Unix服务</title><link rel="stylesheet" type="text/css" href="css/docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="jetty, servlet, servlet-api, cometd, http, websocket, eclipse, maven, java, server, software"><link rel="home" href="index.html" title="Jetty"><link rel="up" href="startup.html" title="Chapter 9. Starting Jetty"><link rel="prev" href="startup-xml-config.html" title="Managing XML Based Startup Configuration"><link rel="next" href="startup-windows-service.html" title="Startup via Windows Service"><link rel="shortcut icon" href="images/favicon.ico" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><link rel="stylesheet" href="css/highlighter/foundation.css"><script src="js/highlight.pack.js"></script><script>
      hljs.initHighlightingOnLoad();
    </script><link type="text/css" rel="stylesheet" href="css/font-awesome/font-awesome.min.css"></head><body bgcolor="white"  text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><tbody><tr><td style="width:25%"><a href="http://www.eclipse.org/jetty"><img src="images/jetty-header-logo.png" alt="Jetty标志"></a><br><span style="font-size:small">版本：9.4.24.v20191120</span></td><td style="width:50%"></td></tr></tbody></table><div class="navheader" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><table width="100%" summary="Navigation header"><tbody><tr><th colspan="3" align="center">使用jetty.sh启动Unix服务</th></tr><tr><td width="20%" align="left"><a href="startup-xml-config.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><th width="60%" align="center">第九章启动Jetty<br><a href="index.html" accesskey="p"><i class="fa fa-home" aria-hidden="true"></i>家</a></th><td width="20%" align="right"> <a href="startup-windows-service.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr></tbody></table><hr></div><div class="jetty-callout" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><h5 class="callout"><a href="http://www.webtide.com/">通过<span class="website">www.webtide.com</span>与Jetty核心开发人员联系。</a></h5><p>内部/客户项目的私人支持...自定义扩展和发行版...无限期支持的版本快照...您的应用程序和Ajax / Comet项目的可伸缩性指南...赞助功能开发的开发服务</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear:both"><a name="startup-unix-service"></a>使用jetty.sh启动Unix服务</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="startup-unix-service.html#_quick_start_a_jetty_service">快速启动Jetty服务</a></span></dt><dt><span class="section"><a href="startup-unix-service.html#_practical_setup_of_a_jetty_service">Jetty服务的实际设置</a></span></dt></dl></div><p>独立的Jetty发行版随附<code class="literal">bin/jetty.sh</code>各种Unix发行版（包括OSX）都可以使用该脚本来管理Jetty作为启动服务。</p><p>该脚本适合在Unix中将Jetty设置为服务。</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_quick_start_a_jetty_service"></a>快速启动Jetty服务</h3></div></div></div><p>使Jetty作为服务运行的最少步骤包括：</p><div class="screenexample"><pre class="screen">[/opt/jetty]# tar -zxf /home/user/downloads/jetty-distribution-9.4.24.v20191120.tar.gz
[/opt/jetty]# cd jetty-distribution-9.4.24.v20191120/
[/opt/jetty/jetty-distribution-9.4.24.v20191120]# ls
bin        lib                         modules      resources  start.jar
demo-base  license-eplv10-aslv20.html  notice.html  start.d    VERSION.txt
etc        logs                        README.TXT   start.ini  webapps

[/opt/jetty/jetty-distribution-9.4.24.v20191120]# cp bin/jetty.sh /etc/init.d/jetty
[/opt/jetty/jetty-distribution-9.4.24.v20191120]# echo JETTY_HOME=`pwd` &gt; /etc/default/jetty
[/opt/jetty/jetty-distribution-9.4.24.v20191120]# cat /etc/default/jetty
JETTY_HOME=/opt/jetty/jetty-distribution-9.4.24.v20191120

[/opt/jetty/jetty-distribution-9.4.24.v20191120]# service jetty start
Starting Jetty: OK Wed Nov 20 10:26:53 MST 2013</pre></div><p>从该演示中，我们可以看到Jetty作为Unix服务从Windows成功启动。 <code class="literal">/opt/jetty/jetty-distribution-{VERSION}</code>目录。</p><p>此配置运行良好，但是它以root用户身份运行Jetty。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_practical_setup_of_a_jetty_service"></a>Jetty服务的实际设置</h3></div></div></div><p>有多种方法可以完成此操作，主要取决于您的Unix环境（可能还取决于公司策略）。</p><p>此处概述的技术假定在Linux上安装（在Ubuntu 12.04.3 LTS上演示）。</p><p>准备一些空目录以供使用。</p><div class="screenexample"><pre class="screen"># mkdir -p /opt/jetty
# mkdir -p /opt/web/mybase
# mkdir -p /opt/jetty/temp</pre></div><p>目录用途如下：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">/选择/Jetty</span></dt><dd>Jetty分布将被放到哪里</dd><dt><span class="term">/ opt / web / mybase</span></dt><dd>您的特定Web应用程序集将位于何处，包括使它们正常运行所需的服务器所有配置。</dd><dt><span class="term">/选择/Jetty/临时</span></dt><dd><p class="simpara">这是服务层分配给Java的临时目录（这是Java所认为的<code class="literal">java.io.tmpdir</code>系统属性）。</p><p class="simpara">故意将其与标准temp目录分开<code class="literal">/tmp</code> ，因为该位置是Servlet Spec工作目录的两倍。我们的经验是，标准的temp目录通常由各种清除脚本管理，这些脚本在运行时间较长的Jetty服务器上造成了严重破坏。</p></dd></dl></div><p>Jetty 9.3需要Java 8（或更高版本）才能运行。确保已安装。</p><div class="screenexample"><pre class="screen"># apt-get install openjdk-8-jdk</pre></div><p>或从以下<a class="link" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_top">网址</a>下载Java 8： <a class="link" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_top">http</a> ： <a class="link" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_top">//www.oracle.com/technetwork/java/javase/downloads/index.html</a></p><div class="screenexample"><pre class="screen"># java -version
java version "1.6.0_27"
OpenJDK Runtime Environment (IcedTea6 1.12.6) (6b27-1.12.6-1ubuntu0.12.04.2)
OpenJDK 64-Bit Server VM (build 20.0-b12, mixed mode)

# update-alternatives --list java
/usr/lib/jvm/java-6-openjdk-amd64/jre/bin/java
/usr/lib/jvm/java-7-openjdk-amd64/jre/bin/java

# update-alternatives --config java
There are 2 choices for the alternative java (providing /usr/bin/java).

  Selection    Path                                            Priority   Status
------------------------------------------------------------
* 0            /usr/lib/jvm/java-6-openjdk-amd64/jre/bin/java   1061      auto mode
  1            /usr/lib/jvm/java-6-openjdk-amd64/jre/bin/java   1061      manual mode
  2            /usr/lib/jvm/java-7-openjdk-amd64/jre/bin/java   1051      manual mode

Press enter to keep the current choice[*], or type selection number: 2
update-alternatives: using /usr/lib/jvm/java-7-openjdk-amd64/jre/bin/java to provide /usr/bin/java (java) in manual mode.

# java -version
java version "1.7.0_25"
OpenJDK Runtime Environment (IcedTea 2.3.10) (7u25-2.3.10-1ubuntu0.12.04.2)
OpenJDK 64-Bit Server VM (build 23.7-b01, mixed mode)</pre></div><p>建议您创建一个用户来专门运行Jetty。该用户应具有运行Jetty所需的最少特权集。</p><div class="screenexample"><pre class="screen"># useradd --user-group --shell /bin/false --home-dir /opt/jetty/temp jetty</pre></div><p>这将创建一个名为<code class="literal">jetty</code> ，属于名为<code class="literal">jetty</code> ，无外壳访问权限（又名<code class="literal">/bin/false</code> ），以及位于的主目录<code class="literal">/opt/jetty/temp</code> 。</p><p>从<a class="link" href="quick-start-getting-started.html#jetty-downloading" title="下载Jetty">官方Eclipse下载站点下载</a> Jetty发行版的副本</p><p>打开包装。</p><div class="screenexample"><pre class="screen">[/opt/jetty]# tar -zxf /home/user/Downloads/jetty-distribution-9.4.24.v20191120.tar.gz
[/opt/jetty]# ls -F
jetty-distribution-9.4.24.v20191120/
[/opt/jetty]# mkdir /opt/jetty/temp</pre></div><p>拆开Jetty分布目录名称的第一部分似乎也很奇怪或令人讨厌。但是从Jetty 9开始， <code class="literal">${jetty.home}</code>和<code class="literal">${jetty.base}</code>在隔离您的Web应用程序特定配置的同时，还可以简化Jetty本身的升级。有关Jetty家庭和基础概念的更多信息，请参见<a class="link" href="startup-base-and-home.html" title="Managing Jetty Base and Jetty Home">本章前面的“</a>管理Jetty安装”部分<a class="link" href="startup-base-and-home.html" title="管理Jetty基地和Jetty主页">。</a></p><p>的<code class="literal">/opt/jetty/temp</code>目录被创建为Jetty用于临时和工作目录的持久位置。许多Unix系统会定期清除/ tmp目录，这种行为在Servlet容器中是不希望的，并且已知会引起问题。该持久目录位于<code class="literal">/opt/jetty/temp</code>解决该行为。</p><p>目录位于<code class="literal">/opt/web/mybase</code>将会是<code class="literal">${jetty.base}</code> ，因此，请对其进行配置，以保存您的webapp及其配置。</p><div class="tip" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-lightbulb-o" aria-hidden="true"></i>小费</h3><p>在过去的Jetty版本中，您将配置/修改/添加到<code class="literal">jetty-distribution</code>目录直接。虽然仍然支持，但我们建议您设置适当的<code class="literal">${jetty.base}</code>目录，因为它将使您更轻松地受益<code class="literal">jetty-distribution</code>将来升级。</p></div><div class="screenexample"><pre class="screen"># cd /opt/web/mybase/
[/opt/web/mybase]# ls
[/opt/web/mybase]# java -jar /opt/jetty/jetty-distribution-9.4.24.v20191120/start.jar \
   --add-to-start=deploy,http,console-capture
   INFO  : webapp          transitively enabled, ini template available with --add-to-start=webapp
   INFO  : server          transitively enabled, ini template available with --add-to-start=server
   INFO  : security        transitively enabled
   INFO  : servlet         transitively enabled
   INFO  : console-capture initialized in ${jetty.base}/start.ini
   INFO  : http            initialized in ${jetty.base}/start.ini
   INFO  : deploy          initialized in ${jetty.base}/start.ini
   MKDIR : ${jetty.base}/logs
   MKDIR : ${jetty.base}/webapps
   INFO  : Base directory was modified
[/opt/web/mybase]# ls -F
start.ini  webapps/</pre></div><p>至此，您已经配置了<code class="literal">/opt/web/mybase</code>启用以下模块：</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">部署</span></dt><dd>该模块将执行以下操作中的Web应用程序（WAR文件或展开的目录）或Jetty IoC XML上下文可部署项的部署： <code class="literal">/opt/web/mybase/webapps</code>目录。</dd><dt><span class="term">http</span></dt><dd><p class="simpara">这将设置一个侦听基本HTTP请求的连接器。</p><p class="simpara">查看创建的<code class="literal">start.ini</code>用于配置此连接器。</p></dd><dt><span class="term">控制台捕获</span></dt><dd>将Jetty作为服务运行时，启用日志记录非常重要。此模块将启用基本STDOUT和STDERR捕获日志记录到<code class="literal">/opt/web/mybase/logs/</code>目录。</dd></dl></div><p>此外， <code class="literal">webapp</code> ， <code class="literal">server</code> ， <code class="literal">security</code>和<code class="literal">servlet</code>已启用模块，因为它们是其他模块的依赖项。</p><p>有关设置和配置文件的更多详细信息和选项，请参见<a class="xref" href="start-jar.html" title="使用start.jar">使用start.jar</a> 。 <code class="literal">${jetty.base}</code>目录。</p><p>将您的战争文件复制到位。</p><div class="screenexample"><pre class="screen"># cp /home/user/projects/mywebsite.war /opt/web/mybase/webapps/</pre></div><p>大多数服务安装都希望Jetty在端口80上运行，现在有机会将其更改为默认值<code class="literal">8080</code>至<code class="literal">80</code> 。</p><p>编辑<code class="literal">/opt/web/mybase/start.ini</code>并更改<code class="literal">jetty.http.port</code>值。</p><div class="screenexample"><pre class="screen"># grep jetty.http.port /opt/web/mybase/start.ini
jetty.port=80</pre></div><p>更改Jetty发行版和webapp目录上的权限，以便您创建的用户可以访问它。</p><div class="screenexample"><pre class="screen"># chown --recursive jetty /opt/jetty
# chown --recursive jetty /opt/web/mybase</pre></div><p>接下来，我们需要使Unix系统意识到我们有一个可以由标准管理的新Jetty服务。 <code class="literal">service</code>电话。</p><div class="screenexample"><pre class="screen"># cp /opt/jetty/jetty-distribution-9.4.24.v20191120/bin/jetty.sh /etc/init.d/jetty
# echo "JETTY_HOME=/opt/jetty/jetty-distribution-9.4.24.v20191120" &gt; /etc/default/jetty
# echo "JETTY_BASE=/opt/web/mybase" &gt;&gt; /etc/default/jetty
# echo "TMPDIR=/opt/jetty/temp" &gt;&gt; /etc/default/jetty</pre></div><p>测试配置：</p><div class="screenexample"><pre class="screen"># service jetty status
Checking arguments to Jetty:
START_INI      =  /opt/web/mybase/start.ini
JETTY_HOME     =  /opt/jetty/jetty-distribution-9.4.24.v20191120
JETTY_BASE     =  /opt/web/mybase
JETTY_CONF     =  /opt/jetty/jetty-distribution-9.4.24.v20191120/etc/jetty.conf
JETTY_PID      =  /var/run/jetty.pid
JETTY_START    =  /opt/jetty/jetty-distribution-9.4.24.v20191120/start.jar
CLASSPATH      =
JAVA           =  /usr/bin/java
JAVA_OPTIONS   =  -Djetty.state=/opt/web/mybase/jetty.state
       -Djetty.logs=/opt/web/mybase/logs
       -Djetty.home=/opt/jetty/jetty-distribution-9.4.24.v20191120
       -Djetty.base=/opt/web/mybase
       -Djava.io.tmpdir=/opt/jetty/temp
JETTY_ARGS     =  console-capture.xml jetty-started.xml
RUN_CMD        =  /usr/bin/java
       -Djetty.state=/opt/web/mybase/jetty.state
       -Djetty.logs=/opt/web/mybase/logs
       -Djetty.home=/opt/jetty/jetty-distribution-9.4.24.v20191120
       -Djetty.base=/opt/web/mybase
       -Djava.io.tmpdir=/opt/jetty/temp
       -jar /opt/jetty/jetty-distribution-9.4.24.v20191120/start.jar
       console-capture.xml
       jetty-started.xml</pre></div><p>您现在已经配置了<code class="literal">${jetty.base}</code>在<code class="literal">/opt/web/mybase</code>和一个<code class="literal">${jetty.home}</code>在<code class="literal">/opt/jetty/jetty-distribution-{VERSION}</code> ，以及启动服务所需的服务级别文件。</p><p>测试服务以确保其启动并成功运行。</p><div class="screenexample"><pre class="screen"># service jetty start
Starting Jetty: OK Wed Nov 20 12:35:28 MST 2013

# service jetty check
..(snip)..
Jetty running pid=2958

[/opt/web/mybase]# ps u 2958
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
jetty     2958  5.3  0.1 11179176 53984 ?      Sl   12:46   0:00 /usr/bin/java -Djetty...</pre></div><p>现在，您应该正在运行服务器。</p></div></div><script type="text/javascript">
      SyntaxHighlighter.all()
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tbody><tr><td width="40%" align="left"><a href="startup-xml-config.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><td width="20%" align="center"><a href="startup.html" accesskey="u"><i class="fa fa-chevron-up" aria-hidden="true"></i>最佳</a></td><td width="40%" align="right"> <a href="startup-windows-service.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr><tr><td width="40%" align="left" valign="top">管理基于XML的启动配置</td><td width="20%" align="center"><a href="index.html" accesskey="h"><i class="fa fa-home" aria-hidden="true"></i>家</a></td><td width="40%" align="right" valign="top">通过Windows服务启动</td></tr></tbody></table></div><p xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"></p><div class="jetty-callout">看到错误或缺少的东西？
            <span class="callout"><a href="http://github.com/eclipse/jetty.project">在以下位置对此文档做出贡献<span class="website"><i class="fa fa-github" aria-hidden="true"></i> Github！</span></a></span> <span style="float:right"><i>（产生：2019-11-20）</i></span></div><p></p></body></html>