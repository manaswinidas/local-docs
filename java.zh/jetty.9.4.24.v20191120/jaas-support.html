<html ><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>JAAS支持</title><link rel="stylesheet" type="text/css" href="css/docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="jetty, servlet, servlet-api, cometd, http, websocket, eclipse, maven, java, server, software"><link rel="home" href="index.html" title="Jetty"><link rel="up" href="configuring-security.html" title="Chapter 7. Configuring Security"><link rel="prev" href="setting-port80-access.html" title="Setting Port 80 Access for a Non-Root User"><link rel="next" href="spnego-support.html" title="SPNEGO Support"><link rel="shortcut icon" href="images/favicon.ico" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><link rel="stylesheet" href="css/highlighter/foundation.css"><script src="js/highlight.pack.js"></script><script>
      hljs.initHighlightingOnLoad();
    </script><link type="text/css" rel="stylesheet" href="css/font-awesome/font-awesome.min.css"></head><body bgcolor="white"  text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><tbody><tr><td style="width:25%"><a href="http://www.eclipse.org/jetty"><img src="images/jetty-header-logo.png" alt="Jetty标志"></a><br><span style="font-size:small">版本：9.4.24.v20191120</span></td><td style="width:50%"></td></tr></tbody></table><div class="navheader" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><table width="100%" summary="Navigation header"><tbody><tr><th colspan="3" align="center">JAAS支持</th></tr><tr><td width="20%" align="left"><a href="setting-port80-access.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><th width="60%" align="center">第7章。配置安全性<br><a href="index.html" accesskey="p"><i class="fa fa-home" aria-hidden="true"></i>家</a></th><td width="20%" align="right"> <a href="spnego-support.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr></tbody></table><hr></div><div class="jetty-callout" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><h5 class="callout"><a href="http://www.webtide.com/">通过<span class="website">www.webtide.com</span>与Jetty核心开发人员联系。</a></h5><p>内部/客户项目的私人支持...自定义扩展和发行版...无限期支持的版本快照...您的应用程序和Ajax / Comet项目的可伸缩性指南...赞助功能开发的开发服务</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear:both"><a name="jaas-support"></a> JAAS支持</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="jaas-support.html#jetty-jaas">Jetty和JAAS</a></span></dt><dt><span class="section"><a href="jaas-support.html#jaas-configuration">组态</a></span></dt><dt><span class="section"><a href="jaas-support.html#_a_closer_look_at_jaasloginservice">仔细查看JAASLoginService</a></span></dt><dt><span class="section"><a href="jaas-support.html#_writing_your_own_loginmodule">编写自己的LoginModule</a></span></dt><dt><span class="section"><a href="jaas-support.html#_other_goodies">其他商品</a></span></dt></dl></div><p>JAAS实现了标准可插拔身份验证模块（PAM）框架的Java版本。</p><p>JAAS可以用于两个目的：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem">用于验证用户身份，以可靠，安全地确定谁当前正在执行Java代码，而不管该代码是作为应用程序，小程序，Bean还是Servlet运行的</li><li class="listitem">授权用户以确保他们具有执行所执行操作所需的访问控制权（权限）</li></ul></div><p>JAAS认证以可插入方式执行。这允许应用程序保持独立于基础身份验证技术。可以在应用程序下插入新的或更新的身份验证技术，而无需修改应用程序本身。应用程序通过实例化身份验证来启用身份验证过程<code class="literal">LoginContext</code>对象，而对象又引用配置来确定身份验证技术，或者<code class="literal">LoginModule</code> （s），用于执行身份验证。典型<code class="literal">LoginModules</code>可能会提示您输入并验证用户名和密码。其他人可能会读取并验证语音或指纹样本。</p><p>有关JAAS的更多信息，请参见Java身份验证和授权服务（JAAS） <a class="link" href="http://java.sun.com/javase/6/docs/technotes/guides/security/jaas/JAASRefGuide.html" target="_top">参考指南</a> 。</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jetty-jaas"></a>Jetty和JAAS</h3></div></div></div><p>许多应用程序服务器都支持JAAS，以此为J2EE（现在称为JavaEE） <a class="link" href="http://java.sun.com/javaee/index.jsp" target="_top">规范</a>的声明性安全模型带来更大的灵活性。对JAAS的Jetty支持为Servlet安全性提供了更多的选择，并提高了Web应用程序的可移植性。</p><p>JAAS支持旨在规定尽可能少的内容，同时提供足够灵活的基础结构，以允许用户放入自己的自定义<a class="link" href="http://java.sun.com/j2se/1.4.2/docs/guide/security/jaas/JAASLMDevGuide.html" target="_top">LoginModule</a> 。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jaas-configuration"></a>组态</h3></div></div></div><p>将JAAS与Jetty结合使用非常简单，只需声明一个<code class="literal">org.eclipse.jetty.jaas.JAASLoginService</code> ，创建一个JAAS登录模块配置文件并在Jetty运行行中指定它。让我们看一个例子。</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_step_1"></a>步骤1</h4></div></div></div><p>配置Jetty<code class="literal">org.eclipse.jetty.jaas.JAASLoginService</code>匹配<code class="literal"><realm-name></code>在你的<code class="literal">web.xml</code>文件。例如，如果<code class="literal">web.xml</code>包含一个称为“ Test JAAS领域”的领域，如下所示：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;login-config&gt;
  &lt;auth-method&gt;FORM&lt;/auth-method&gt;
  &lt;realm-name&gt;Test JAAS Realm&lt;/realm-name&gt;
  &lt;form-login-config&gt;
    &lt;form-login-page&gt;/login/login&lt;/form-login-page&gt;
    &lt;form-error-page&gt;/login/error&lt;/form-error-page&gt;
  &lt;/form-login-config&gt;
&lt;/login-config&gt;</code></pre><p>那么您需要创建一个<code class="literal">JAASLoginService</code>匹配的领域名称为“ Test JAAS领域”：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;New class="org.eclipse.jetty.jaas.JAASLoginService"&gt;
  &lt;Set name="Name"&gt;Test JAAS Realm&lt;/Set&gt;
  &lt;Set name="LoginModuleName"&gt;xyz&lt;/Set&gt;
&lt;/New&gt;</code></pre><p>的<code class="literal">LoginModuleName</code>必须与登录模块配置文件中声明的LoginModule的名称匹配（请参阅<a class="link" href="jaas-support.html#jaas-step-2" title="第2步">步骤2</a> ）。</p><div class="blockquote"><blockquote class="blockquote"><div class="caution" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-exclamation" aria-hidden="true"></i>警告</h3><p>您在其中声明的领域名称的名称<code class="literal">web.xml</code>必须<span class="strong"><strong>完全</strong></span>符合<code class="literal">Name</code>您的领域<code class="literal">JAASLoginService</code> 。</p></div></blockquote></div><p>您可以声明您的<code class="literal">JAASLoginService</code>以几种不同的方式：</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">如果您有多个要使用同一安全性基础结构的Web应用程序，则可以声明您的<code class="literal">JAASLoginService</code>在顶层Jetty xml文件中作为添加到<code class="literal">org.eclipse.jetty.server.Server</code> 。一个例子：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;Configure id="Server" class="org.eclipse.jetty.server.Server"&gt;

  &lt;Call name="addBean"&gt;
    &lt;Arg&gt;
      &lt;New class="org.eclipse.jetty.jaas.JAASLoginService"&gt;
        &lt;Set name="name"&gt;Test JAAS Realm&lt;/Set&gt;
        &lt;Set name="LoginModuleName"&gt;xyz&lt;/Set&gt;
      &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/Call&gt;

&lt;/Configure&gt;</code></pre></li><li class="listitem"><p class="simpara">或者，您可以使用<code class="literal">JAASLoginService</code>通过为Webapp创建<a class="link" href="configuring-specific-webapp-deployment.html#deployable-descriptor-file" title="Jetty可部署描述符XML文件">上下文xml</a>文件并指定<code class="literal">JAASLoginService</code>在里面：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;Configure class="org.eclipse.jetty.webapp.WebAppContext"&gt;

  &lt;Set name="securityHandler"&gt;
    &lt;New class="org.eclipse.jetty.security.ConstraintSecurityHandler"&gt;
     &lt;Set name="loginService"&gt;
       &lt;New class="org.eclipse.jetty.jaas.JAASLoginService"&gt;
         &lt;Set name="name"&gt;Test JAAS Realm&lt;/Set&gt;
         &lt;Set name="loginModuleName"&gt;xyz&lt;/Set&gt;
       &lt;/New&gt;
     &lt;/Set&gt;
    &lt;/New&gt;
  &lt;/Set&gt;

&lt;/Configure&gt;</code></pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="jaas-step-2"></a>第2步</h4></div></div></div><p>设置你的<code class="literal">LoginModule</code>在配置文件中，遵循以下<a class="link" href="https://docs.oracle.com/javase/7/docs/api/javax/security/auth/login/Configuration.html" target="_top">语法规则</a> ：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>xyz {
       com.acme.SomeLoginModule required debug=true;
    };</code></pre><div class="blockquote"><blockquote class="blockquote"><div class="caution" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-exclamation" aria-hidden="true"></i>警告</h3><p>当务之急是在第一线的应用名称是<span class="strong"><strong>完全</strong></span>一样的<code class="literal">LoginModuleName</code>你的<code class="literal">JAASLoginService</code> 。</p></div></blockquote></div><p>您可能会发现将此配置文件命名为<code class="literal">etc/login.conf</code>因为，正如我们将在下面看到的，JAAS的一些接线工作已经为您完成。</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_step_3"></a>第三步</h4></div></div></div><p>您现在需要在支持JAAS的情况下调用Jetty。这有两个方面：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem">将与JAAS相关的jar添加到Jetty容器类路径</li><li class="listitem">设置系统属性<code class="literal">java.security.auth.login.config</code></li></ul></div><p>为此，请使用Jetty <a class="link" href="startup.html#startup-overview" title="启动概述">启动</a> <a class="link" href="startup-modules.html" title="管理启动模块">模块机制</a>来添加JAAS <a class="link" href="startup-modules.html" title="管理启动模块">模块</a> ：</p><div class="screenexample"><pre class="screen">java -jar start.jar --add-to-start=jaas</pre></div><div class="blockquote"><blockquote class="blockquote"><div class="note" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-asterisk" aria-hidden="true"></i>注意</h3><p>默认情况下，发行版的顶层未启用JAAS模块。但是，有几个<a class="link" href="quickstart-running-jetty.html#demo-webapps-base" title="示范基地">演示Web应用程序</a> -包括JAAS Web应用程序-可在<code class="literal">demo-base</code>已预启用JAAS模块的发行版目录。</p></div></blockquote></div><p>现在您将有一个名为<code class="literal">start.d/jaas.ini</code> ， 其中包含：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>--module=jaas
jaas.login.conf=etc/login.conf</code></pre><p>的<code class="literal">jaas.login.conf</code>属性是指您的位置<code class="literal">LoginModule</code>您在<a class="link" href="jaas-support.html#jaas-step-2" title="第2步">步骤2中</a>建立的配置文件。如果你叫它<code class="literal">etc/login.conf</code> ，那么您的工作就完成了。否则，请更改<code class="literal">jaas.login.conf</code>属性为LoginModule配置文件的位置。Jetty将自动使用此属性来设置System属性的值<code class="literal">java.security.auth.login.config.</code></p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_a_closer_look_at_jaasloginservice"></a>仔细查看JAASLoginService</h3></div></div></div><p>为了在与Web应用程序一起使用JAAS时提供最大程度的灵活性， <code class="literal">JAASLoginService</code>支持几个配置选项。请注意，通常不需要显式设置这些设置，因为Jetty具有默认设置，可以在99％的情况下使用。但是，如果需要，可以配置：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem">CallbackHandler（默认值： <code class="literal">org.eclipse.jetty.jaas.callback.DefaultCallbackHandler</code> ）</li><li class="listitem">等效于用户角色的Principal实现的类名列表（默认： <code class="literal">org.eclipse.jetty.jaas.JAASRole</code> ）</li></ul></div><p>这是将每个设置（为其默认值）的示例：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;New class="org.eclipse.jetty.jaas.JAASLoginService"&gt;
  &lt;Set name="Name"&gt;Test JAAS Realm&lt;/Set&gt;
  &lt;Set name="LoginModuleName"&gt;xyz&lt;/Set&gt;
  &lt;Set name="CallbackHandlerClass"&gt;
       org.eclipse.jetty.jaas.callback.DefaultCallbackHandler
  &lt;/Set&gt;
  &lt;Set name="roleClassNames"&gt;
    &lt;Array type="java.lang.String"&gt;
      &lt;Item&gt;org.eclipse.jetty.jaas.JAASRole&lt;/Item&gt;
    &lt;/Array&gt;
  &lt;/Set&gt;
&lt;/New&gt;</code></pre><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_callbackhandler"></a>回调处理程序</h4></div></div></div><p>CallbackHandler负责与用户进行交互，以获得要验证的用户名和凭据。</p><p>Jetty附带<code class="literal">org.eclipse.jetty.jaas.DefaultCallbackHandler</code>该接口将请求中包含的信息与由请求的回调相关联<code class="literal">LoginModules</code> 。如果您有默认要求未涵盖的特定要求，则可以使用自己的实现方式替换此默认值。</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_role_principal_implementation_class"></a>角色负责人实施类</h4></div></div></div><p>什么时候<code class="literal">LoginModules</code>在对用户进行身份验证时，他们通常还会收集用户拥有的所有角色并将其放置在JAAS主题中。如<code class="literal">LoginModules</code>可以自由使用自己的JAAS委托人实现将其放入主题中，Jetty需要在执行授权检查时知道哪些委托人代表用户，哪些代表他/她的角色。 <code class="literal"><security-constraint></code> 。这个例子<code class="literal">LoginModules</code>与Jetty一起运送的所有<code class="literal">org.eclipse.jetty.jaas.JAASRole</code>类。但是，如果您已插入其他<code class="literal">LoginModules</code> ，您必须配置其角色Principal实现的类名。</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_sample_loginmodules"></a>样本登录模块</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem"><a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/jaas/spi/JDBCLoginModule.html" target="_top"><code class="literal">org.eclipse.jetty.jaas.spi.JDBCLoginModule</code></a></li><li class="listitem"><a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/jaas/spi/PropertyFileLoginModule.html" target="_top"><code class="literal">org.eclipse.jetty.jaas.spi.PropertyFileLoginModule</code></a></li><li class="listitem"><a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/jaas/spi/DataSourceLoginModule.html" target="_top"><code class="literal">org.eclipse.jetty.jaas.spi.DataSourceLoginModule</code></a></li><li class="listitem"><a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/jaas/spi/LdapLoginModule.html" target="_top"><code class="literal">org.eclipse.jetty.jaas.ldap.LdapLoginModule</code></a></li></ul></div><div class="blockquote"><blockquote class="blockquote"><div class="note" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-asterisk" aria-hidden="true"></i>注意</h3><p>密码可以明文形式存储，混淆或校验和。班级<a class="link" href="http://www.eclipse.org/jetty/javadoc/9.4.24.v20191120/org/eclipse/jetty/util/security/Password.html" target="_top"><code class="literal">org.eclipse.jetty.util.security.Password</code></a>应该用于生成各种密码，密码的输出可以放入属性文件或输入数据库表中。在“ <a class="link" href="configuring-security-secure-passwords.html" title="安全密码混淆">保护密码”</a>的“配置”部分下，详细了解此内容。</p></div></blockquote></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_jdbcloginmodule"></a> JDBC登录模块</h4></div></div></div><p>的<code class="literal">JDBCLoginModule</code>通过JDBC调用将用户密码和角色存储在数据库中。您可以配置JDBC连接信息，以及存储用户名和凭据的表和列的名称，以及存储角色的表和列的名称。</p><p>这是使用HSQLDB驱动程序的示例登录模块配置文件条目：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>jdbc {
      org.eclipse.jetty.jaas.spi.JDBCLoginModule required
      debug="true"
      dbUrl="jdbc:hsqldb:."
      dbUserName="sa"
      dbDriver="org.hsqldb.jdbcDriver"
      userTable="myusers"
      userField="myuser"
      credentialField="mypassword"
      userRoleTable="myuserroles"
      userRoleUserField="myuser"
      userRoleRoleField="myrole";
      };</code></pre><p>存储身份验证和角色信息的数据库表不需要特定的架构。属性<code class="literal">userTable</code> ， <code class="literal">userField</code> ， <code class="literal">credentialField</code> ， <code class="literal">userRoleTable</code> ， <code class="literal">userRoleUserField</code> ， <code class="literal">userRoleRoleField</code>配置用于格式化以下查询的表名和表中的列：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>  select &lt;credentialField&gt; from &lt;userTable&gt;
          where &lt;userField&gt; =?
  select &lt;userRoleRoleField&gt; from &lt;userRoleTable&gt;
          where &lt;userRoleUserField&gt; =?</code></pre><p>当先前未经身份验证的用户请求身份验证时，将从数据库中懒惰地读取凭据和角色信息。请注意，此信息<span class="emphasis"><em>仅</em></span>缓存经过身份验证的会话的时间长度。当用户注销或会话到期时，将从内存中清除信息。</p><p>请注意，密码可以纯文本或编码格式存储在数据库中-请参阅上面“密码/凭据”中的注释。</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_datasourceloginmodule"></a>数据源登录模块</h4></div></div></div><p>类似于<code class="literal">JDBCLoginModule</code> ， 但是这个<code class="literal">LoginModule</code>使用一个<code class="literal">DataSource</code>连接到数据库而不是JDBC驱动程序。的<code class="literal">DataSource</code>通过在以下位置执行JNDI查找获得<code class="literal">java:comp/env/${dnJNDIName}</code> 。</p><p>使用此方法的示例登录模块配置：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>ds {
     org.eclipse.jetty.jaas.spi.DataSourceLoginModule required
     debug="true"
     dbJNDIName="ds"
     userTable="myusers"
     userField="myuser"
     credentialField="mypassword"
     userRoleTable="myuserroles"
     userRoleUserField="myuser"
     userRoleRoleField="myrole";
    };</code></pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_propertyfileloginmodule"></a> PropertyFileLoginModule</h4></div></div></div><p>使用此登录模块实现，可以从属性文件中读取身份验证和角色信息。</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>props {
        org.eclipse.jetty.jaas.spi.PropertyFileLoginModule required
        debug="true"
        file="/somewhere/somefile.props";
      };</code></pre><p>file参数是与文件格式相同的属性文件的位置。 <code class="literal">etc/realm.properties</code>示例文件。格式为：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;username&gt;: &lt;password&gt;[,&lt;rolename&gt; ...]</code></pre><p>这是一个例子：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>fred: OBF:1xmk1w261u9r1w1c1xmq,user,admin
harry: changeme,user,developer
tom: MD5:164c88b302622e17050af52c89945d44,user
dick: CRYPT:adpexzg3FUZAk,admin</code></pre><p>用户第一次请求身份验证时，将完全读入文件的内容并将其缓存在内存中。</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_ldaploginmodule"></a> LdapLoginModule</h4></div></div></div><p>这是一个例子：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>ldaploginmodule {
   org.eclipse.jetty.jaas.spi.LdapLoginModule required
   debug="true"
   contextFactory="com.sun.jndi.ldap.LdapCtxFactory"
   hostname="ldap.example.com"
   port="389"
   bindDn="cn=Directory Manager"
   bindPassword="directory"
   authenticationMethod="simple"
   forceBindingLogin="false"
   userBaseDn="ou=people,dc=alcatel"
   userRdnAttribute="uid"
   userIdAttribute="uid"
   userPasswordAttribute="userPassword"
   userObjectClass="inetOrgPerson"
   roleBaseDn="ou=groups,dc=example,dc=com"
   roleNameAttribute="cn"
   roleMemberAttribute="uniqueMember"
   roleObjectClass="groupOfUniqueNames";
   };</code></pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_writing_your_own_loginmodule"></a>编写自己的LoginModule</h3></div></div></div><p>如果要实现自己的自定义<code class="literal">LoginModule</code> ，有两个类需要熟悉： <code class="literal">org.eclipse.jetty.jaas.spi.AbstractLoginModule</code>和<code class="literal">org.eclipse.jetty.jaas.spi.UserInfo</code> 。</p><p>的<code class="literal">org.eclipse.jetty.jaas.spi.AbstractLoginModule</code>实现所有<code class="literal">javax.security.auth.spi.LoginModule</code>方法。您需要做的就是实施<code class="literal">getUserInfo</code>返回一个方法<code class="literal">org.eclipse.jetty.jaas.UserInfo</code>封装用户名，密码和角色名称的实例（注意：as <code class="literal">java.lang.Strings</code> ）。</p><p>的<code class="literal">AbstractLoginModule</code>不支持任何缓存，因此，如果要缓存UserInfo（例如， <code class="literal">org.eclipse.jetty.jaas.spi.PropertyFileLoginModule</code> ），那么您必须自己提供。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_other_goodies"></a>其他商品</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_servletrequestcallback"></a> ServletRequestCallback</h4></div></div></div><p>通过此回调，您可以访问身份验证中涉及的ServletRequest，从而可以访问其他功能（例如当前会话）。可以在您的自定义LoginModule实现中配置此回调。请注意，Jetty随附的LoginModule实现目前均未使用此回调。</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_requestparametercallback"></a> RequestParameterCallback</h4></div></div></div><p>由于所有servlet容器都通过动作来拦截和处理表单提交<code class="literal">j_security_check</code> ，通常不可能在用于执行身份验证的登录表单上插入任何其他输入字段：您只能通过<code class="literal">j_username</code>和<code class="literal">j_password</code> 。在少数情况下，这还不够好，并且您需要用户提供更多信息以进行身份验证，则可以使用JAAS回调处理程序<code class="literal">org.eclipse.jetty.jaas.callback.RequestParameterCallback</code> 。通过此回调，您可以访问在表单提交中传递的所有参数。要使用它，在<code class="literal">login()</code>您的自定义登录模块的方法，添加<code class="literal">RequestParameterCallback</code>登录模块使用的回调处理程序列表，告诉它您感兴趣的参数，然后获取参数的值。这是一个例子：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>public class FooLoginModule extends AbstractLoginModule
{
     public boolean login()
        throws LoginException
     {

        Callback[] callbacks = new Callback[3];
        callbacks[0] = new NameCallback();
        callbacks[1] = new ObjectCallback();

        //as an example, look for a param named "extrainfo" in the request
        //use one RequestParameterCallback() instance for each param you want to access
        callbacks[2] = new RequestParameterCallback ();
        ((RequestParameterCallback)callbacks[2]).setParameterName ("extrainfo");


        callbackHandler.handle(callbacks);
        String userName = ((NameCallback)callbacks[0]).getName();
        Object pwd = ((ObjectCallback)callbacks[1]).getObject();
        List paramValues = ((RequestParameterCallback)callbacks[2]).getParameterValues();

        //use the userName, pwd and the value(s) of the parameter named "extrainfo" to
        //authenticate the user

     }
}</code></pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_example_jaas_webapp"></a> JAAS WebApp示例</h4></div></div></div><p>可以在Jetty GitHub存储库中找到使用JAAS的示例Web应用程序：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem"><a class="link" href="https://github.com/eclipse/jetty.project/tree/jetty-9.4.x/tests/test-webapps/test-jaas-webapp" target="_top">https://github.com/eclipse/jetty.project/tree/master/tests/test-webapps/test-jaas-webapp</a></li></ul></div></div></div></div><script type="text/javascript">
      SyntaxHighlighter.all()
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tbody><tr><td width="40%" align="left"><a href="setting-port80-access.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><td width="20%" align="center"><a href="configuring-security.html" accesskey="u"><i class="fa fa-chevron-up" aria-hidden="true"></i>最佳</a></td><td width="40%" align="right"> <a href="spnego-support.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr><tr><td width="40%" align="left" valign="top">设置非root用户的端口80访问</td><td width="20%" align="center"><a href="index.html" accesskey="h"><i class="fa fa-home" aria-hidden="true"></i>家</a></td><td width="40%" align="right" valign="top">SPNEGO支持</td></tr></tbody></table></div><p xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"></p><div class="jetty-callout">看到错误或缺少的东西？
            <span class="callout"><a href="http://github.com/eclipse/jetty.project">在以下位置对此文档做出贡献<span class="website"><i class="fa fa-github" aria-hidden="true"></i> Github！</span></a></span> <span style="float:right"><i>（产生：2019-11-20）</i></span></div><p></p></body></html>