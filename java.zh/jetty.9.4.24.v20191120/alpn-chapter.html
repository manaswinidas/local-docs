<html ><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>第十五章应用层协议协商（ALPN）</title><link rel="stylesheet" type="text/css" href="css/docbook.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><meta name="keywords" content="jetty, servlet, servlet-api, cometd, http, websocket, eclipse, maven, java, server, software"><link rel="home" href="index.html" title="Jetty"><link rel="up" href="jetty-admin-guide.html" title="Part III. Jetty Administration Guide"><link rel="prev" href="jetty-jconsole.html" title="Managing Jetty with JConsole and JMC"><link rel="next" href="http2.html" title="Chapter 16. HTTP/2"><link rel="shortcut icon" href="images/favicon.ico" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><link rel="stylesheet" href="css/highlighter/foundation.css"><script src="js/highlight.pack.js"></script><script>
      hljs.initHighlightingOnLoad();
    </script><link type="text/css" rel="stylesheet" href="css/font-awesome/font-awesome.min.css"></head><body bgcolor="white"  text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><tbody><tr><td style="width:25%"><a href="http://www.eclipse.org/jetty"><img src="images/jetty-header-logo.png" alt="Jetty标志"></a><br><span style="font-size:small">版本：9.4.24.v20191120</span></td><td style="width:50%"></td></tr></tbody></table><div class="navheader" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><table width="100%" summary="Navigation header"><tbody><tr><th colspan="3" align="center">第十五章应用层协议协商（ALPN）</th></tr><tr><td width="20%" align="left"><a href="jetty-jconsole.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><th width="60%" align="center">第三部分Jetty管理指南<br><a href="index.html" accesskey="p"><i class="fa fa-home" aria-hidden="true"></i>家</a></th><td width="20%" align="right"> <a href="http2.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr></tbody></table><hr></div><div class="jetty-callout" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><h5 class="callout"><a href="http://www.webtide.com/">通过<span class="website">www.webtide.com</span>与Jetty核心开发人员联系。</a></h5><p>内部/客户项目的私人支持...自定义扩展和发行版...无限期支持的版本快照...您的应用程序和Ajax / Comet项目的可伸缩性指南...赞助功能开发的开发服务</p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="alpn-chapter"></a>第十五章应用层协议协商（ALPN）</h2></div></div></div><div class="toc"><p><b>目录</b></p><dl class="toc"><dt><span class="section"><a href="alpn-chapter.html#alpn">介绍ALPN</a></span></dt></dl></div><p>诸如HTTP / 2之类的新Web协议的开发提出了在传输层安全性（TLS）握手中进行协议协商的需求。<a class="link" href="https://tools.ietf.org/html/rfc7301" target="_top">为此</a> ，已经定义了一种称为ALPN（应用层协议协商<a class="link" href="https://tools.ietf.org/html/rfc7301" target="_top">-RFC7301</a> ）的协议协商。</p><p>截至2016年，ALPN现在已替换了通用网络中较旧（现已完全弃用）的NPN。</p><p>对于那些支持HTTP / 2的浏览器，它们现在都支持ALPN。从Jetty 9.3.0开始，Jetty仅支持ALPN。</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear:both"><a name="alpn"></a>介绍ALPN</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="alpn-chapter.html#alpn-openjdk8">ALPN和OpenJDK 8</a></span></dt><dt><span class="section"><a href="alpn-chapter.html#alpn-conscrypt">ALPN和加密</a></span></dt><dt><span class="section"><a href="alpn-chapter.html#alpn-jdk9">ALPN和JDK 9</a></span></dt><dt><span class="section"><a href="alpn-chapter.html#alpn-troubleshooting">ALPN故障排除</a></span></dt><dt><span class="section"><a href="alpn-chapter.html#alpn-openjdk8-details">有关ALPN和OpenJDK 8的详细信息</a></span></dt><dt><span class="section"><a href="alpn-chapter.html#alpn-openjdk8-client-example">客户实例</a></span></dt><dt><span class="section"><a href="alpn-chapter.html#alpn-openjdk8-server-example">服务器实例</a></span></dt><dt><span class="section"><a href="alpn-chapter.html#alpn-openjdk8-implementation">实施细节</a></span></dt><dt><span class="section"><a href="alpn-chapter.html#alpn-openjdk8-tests">单元测试</a></span></dt><dt><span class="section"><a href="alpn-chapter.html#alpn-openjdk8-debugging">调试</a></span></dt><dt><span class="section"><a href="alpn-chapter.html#alpn-openjdk8-license-details">许可证详细信息</a></span></dt><dt><span class="section"><a href="alpn-chapter.html#alpn-versions">版本号</a></span></dt><dt><span class="section"><a href="alpn-chapter.html#alpn-build">如何建立ALPN</a></span></dt></dl></div><p>应用层协议协商（ALPN）是TLS扩展，它允许客户端和服务器协商在TLS提供的加密范围内它们将用于通信的应用协议。</p><p>ALPN可以在TLS连接中协商任何协议。最常协商的协议是HTTP / 2和HTTP / 1.1。</p><p>浏览器仅通过ALPN协商HTTP / 2协议，才支持TLS上的HTTP / 2。如果要浏览器使用HTTP / 2协议，则需要将服务器配置为支持TLS和ALPN，否则它们将默认为HTTP / 1.1。</p><p>在Jetty项目中，在两个工件中<span class="emphasis"><em>使用</em></span>了ALPN： <code class="literal">jetty-alpn-client</code>和<code class="literal">jetty-alpn-server</code> ，分别用于客户端和服务器。</p><p>通过Jetty发行版将Jetty用作独立服务器时， <code class="literal">jetty-alpn-server</code>工件由Jetty模块系统自动包含在服务器类路径中。</p><p>使用Jetty Embedded时， <code class="literal">jetty-alpn-client</code>和<code class="literal">jetty-alpn-server</code>对于客户端和服务器用例，必须分别在类路径中包含工件。</p><p>通过以下三个选项为这两个工件<span class="emphasis"><em>提供</em></span>了ALPN实现：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem"><p class="simpara">仅对于JDK 8，基于修改的OpenJDK类的提供程序</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:circle"><li class="listitem">仅适用于JDK 8，纯Java实现</li><li class="listitem">需要<code class="literal">-Xbootclasspath/p</code>命令行选项</li></ul></div></li><li class="listitem"><p class="simpara">对于JDK 8或更高版本，基于<a class="link" href="configuring-ssl.html#conscrypt" title="加密SSL">Conscrypt安全提供程序的提供程序</a></p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:circle"><li class="listitem">与JDK 8或更高版本一起使用，并提供改进的性能</li><li class="listitem">绑定到Conscrypt随附的OpenSSL本机库，因此仅在Conscrypt支持的平台上可用</li></ul></div></li><li class="listitem"><p class="simpara">对于JDK 9或更高版本，基于JDK中存在的ALPN API的提供程序</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:circle"><li class="listitem">与JDK 9或更高版本（纯Java实现）一起使用</li><li class="listitem">性能低于Conscrypt</li></ul></div></li></ul></div><p>尽管第一个托管在Jetty项目的保护下，但它独立于Jetty（Servlet容器）；您可以在任何其他Java网络服务器中使用它。</p><p>上面的每个提供者都提供一个ALPN <span class="emphasis"><em>服务</em></span>实现；Jetty使用<code class="literal">ServiceLoader</code>加载这些服务实现的机制。服务器类路径中必须至少存在一个有效的提供程序。例如，将JDK 8与JDK 9 ALPN提供程序一起使用是<span class="emphasis"><em>无效的</em></span>组合。缺少有效的实现是启动时的错误（另请参阅<a class="link" href="alpn-chapter.html#alpn-troubleshooting" title="ALPN故障排除">故障排除部分</a> ）。</p><p>服务器类路径中可能有多个ALPN服务提供者。创建新连接后， <code class="literal">SSLEngine</code>实例与之相关；每<code class="literal">SSLEngine</code>传递给所有服务实现，直到一个接受它为止。</p><p>因此，可以同时激活多个提供程序，例如JDK 9提供程序和Conscrypt提供程序，并且在运行时，Jetty运行时将选择正确的提供程序。</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="alpn-openjdk8"></a> ALPN和OpenJDK 8</h3></div></div></div><p>当使用基于OpenJDK 8的JDK（关于JDK 9，请参见<a class="link" href="alpn-chapter.html#alpn-jdk9" title="ALPN和JDK 9">上文</a> ），并且您不使用或不能使用<a class="link" href="configuring-ssl.html#conscrypt" title="加密SSL">Conscrypt时</a> ，可以使用Jetty的ALPN引导库通过以下方式提供ALPN服务实现： <code class="literal">alpn-boot</code>神器。</p><p>Jetty ALPN引导库修改了相关的OpenJDK类以添加ALPN支持，并提供了应用程序可用来启用ALPN的ALPN API。</p><p>当通过Jetty发行版将Jetty用作独立服务器时，在以下情况下会自动启用ALPN支持： <code class="literal">http2</code>模块已启用。这可以传递<code class="literal">alpn-8</code>该模块将<code class="literal">jetty-alpn-openjdk8-server</code>服务器类路径中的工件，提供ALPN OpenJDK 8服务实现。</p><p>使用Jetty Embedded时，ALPN支持由以下组件提供： <code class="literal">jetty-alpn-openjdk8-client</code>和<code class="literal">jetty-alpn-openjdk8-server</code>工件，分别用于客户端使用和服务器使用。</p><p>要使ALPN与Jetty ALPN引导库一起使用，您需要：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem">使用引导类路径中的Jetty ALPN引导库启动JVM</li><li class="listitem">拥有<code class="literal">jetty-alpn-openjdk8-client</code>神器或<code class="literal">jetty-alpn-openjdk8-server</code>类路径中的工件</li></ul></div><p>启动JVM，如下所示：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>java -Xbootclasspath/p:&lt;path_to_alpn_boot_jar&gt; ...</code></pre><p>哪里<code class="literal">path_to_alpn_boot_jar</code>是文件系统上的路径<code class="literal">alpn-boot</code>工件，例如Maven坐标处的工件<code class="literal">org.mortbay.jetty.alpn:alpn-boot</code> 。</p><p>确保获得<a class="link" href="alpn-chapter.html#alpn-versions" title="Versions">与JRE版本匹配</a>的<a class="link" href="alpn-chapter.html#alpn-versions" title="版本号">ALPN引导工件版本</a> 。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="alpn-conscrypt"></a> ALPN和加密</h3></div></div></div><p>使用JDK 8或更高版本时，可以使用<a class="link" href="https://conscrypt.org/" target="_top">Conscrypt</a>安全提供程序来提供ALPN服务实现。</p><p>Conscrypt本机绑定到BoringSSL（Google的OpenSSL的一个分支），因此通过BoringSSL提供的支持（与Conscrypt捆绑在一起）将支持ALPN。</p><p>通过Jetty发行版将Jetty用作独立服务器时，通过启用以下功能来启用ALPN： <code class="literal">conscrypt</code>模块。</p><p>使用Jetty Embedded时，ALPN由<code class="literal">jetty-alpn-conscrypt-client</code>和<code class="literal">jetty-alpn-conscrypt-server</code>工件，分别用于客户端使用和服务器使用。此外，您还需要Conscrypt工件，通常是<code class="literal">org.conscrypt:conscrypt-openjdk-uber</code>神器。所有这些工件必须添加到类路径中。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="alpn-jdk9"></a> ALPN和JDK 9</h3></div></div></div><p>当通过Jetty发行版将JDK 9或更高版本以及Jetty用作独立服务器时，在以下情况下会自动启用ALPN支持： <code class="literal">http2</code>模块已启用。这可以传递<code class="literal">alpn-9</code>该模块将<code class="literal">jetty-alpn-java-server</code>服务器类路径中的工件，提供ALPN JDK 9服务实现。</p><p>使用JDK 9或更高版本并嵌入Jetty时，ALPN服务实现由<code class="literal">jetty-alpn-java-client</code>和<code class="literal">jetty-alpn-java-server</code>分别用于客户端使用和服务器使用的工件，并且必须添加到类路径中。</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="alpn-osgi"></a>从OSGi开始</h4></div></div></div><p>要在OSGi环境中使用ALPN，除了上述内容外，您还需要部署<code class="literal">jetty-osgi-alpn</code>罐。这个罐子里有一个<code class="literal">Fragment-Host</code>确保ALPN类从系统捆绑包中可用的指令。</p><p>您可以从Maven Central下载<a class="link" href="https://repo1.maven.org/maven2/org/eclipse/jetty/osgi/jetty-osgi-alpn/" target="_top">jetty-osgi-alpn jar</a> 。</p><div class="blockquote"><blockquote class="blockquote"><div class="note" xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title"><i class="fa fa-asterisk" aria-hidden="true"></i>注意</h3><p>OSGi <span class="strong"><strong>需要</strong></span>一个<code class="literal">ServiceLoader</code>实施以使Jetty正常运行。OSGi利用<a class="link" href="http://aries.apache.org/modules/spi-fly.html" target="_top">Apache Aries SPI Fly</a>来实现此功能。您可以阅读有关OSGi和<code class="literal">ServiceLoader</code> <a class="link" href="http://blog.osgi.org/2013/02/javautilserviceloader-in-osgi.html" target="_top">这里。</a></p></div></blockquote></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="alpn-troubleshooting"></a> ALPN故障排除</h3></div></div></div><p>启动Jetty服务器时，尤其是在使用Jetty嵌入式系统时，可能会看到类似以下的错误：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>IllegalStateException: no ALPN processor</code></pre><p>该错误意味着您在类路径中没有正确设置ALPN依赖项。</p><p>例如，您可能拥有<code class="literal">jetty-alpn-java-server</code>类路径中的工件（使用JDK 9时正确），但使用JDK 8运行应用程序。</p><p>另一个例子是当您正确放置<code class="literal">alpn-boot</code>引导类路径中的工件，但是您没有<code class="literal">jetty-alpn-openjdk8-server</code>类路径中的工件。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="alpn-openjdk8-details"></a>有关ALPN和OpenJDK 8的详细信息</h3></div></div></div><p>以下各节仅使用Jetty引导库引用ALPN的API和实现。</p><p>Jetty ALPN引导库在概念上由两部分组成：ALPN API和ALPN实现。</p><p>ALPN API由<code class="literal">org.eclipse.jetty.alpn:alpn-api</code>神器。只有使用ALPN API的应用程序代码才需要此工件。</p><p>ALPN的实现由<code class="literal">org.mortbay.jetty.alpn:alpn-boot</code>工件，并包含对OpenJDK类的修改。的<code class="literal">org.mortbay.jetty.alpn:alpn-boot</code>工件还包含存在于<code class="literal">org.eclipse.jetty.alpn:alpn-api</code>神器。</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="alpn-openjdk8-understanding"></a>了解ALPN API</h4></div></div></div><p>应用程序需要与ALPN TLS扩展协议协商进行交互。例如，服务器应用程序需要知道客户端是否支持ALPN，客户端应用程序需要知道服务器是否支持ALPN。</p><p>为了实现这种交互，Jetty的ALPN实现为托管在Maven坐标处的应用程序提供了API。 <code class="literal">org.eclipse.jetty.alpn:alpn-api</code> 。您需要按规定声明此依赖项，因为<code class="literal">alpn-boot</code> jar已包含它（请参阅上一节），因此可以从引导类路径中获得它。</p><p>该API由一个类组成， <code class="literal">org.eclipse.jetty.alpn.ALPN</code> ，并且应用程序需要注册的实例<code class="literal">SSLSocket</code>要么<code class="literal">SSLEngine</code>与一个<code class="literal">ClientProvider</code>要么<code class="literal">ServerProvider</code> （取决于应用程序是客户端应用程序还是服务器应用程序）。参考<code class="literal">ALPN</code> Javadocs以及下面的示例，以获取有关客户端和服务器提供程序方法的更多详细信息。</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="alpn-openjdk8-client-example"></a>客户实例</h3></div></div></div><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>SSLContext sslContext = ...;
SSLSocket sslSocket = (SSLSocket)context.getSocketFactory().createSocket("localhost", server.getLocalPort());

ALPN.put(sslSocket, new ALPN.ClientProvider()
{
    @Override
    public List&lt;String&gt; protocols()
    {
        return Arrays.asList("h2", "http/1.1");
    }

    @Override
    public void unsupported()
    {
        ALPN.remove(sslSocket);
    }

    @Override
    public void selected(String protocol)
    {
        ALPN.remove(sslSocket);
        System.out.println("Protocol Selected is: " + protocol);
    }
});</code></pre><p>ALPN实施调用<code class="literal">ALPN.ClientProvider</code>方法<code class="literal">protocols()</code> ， <code class="literal">unsupported()</code>和<code class="literal">selected(String)</code> ，以便客户端应用程序可以：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem">决定是否支持ALPN</li><li class="listitem">提供支持的协议</li><li class="listitem">知道服务器是否支持ALPN</li><li class="listitem">了解服务器选择的协议</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="alpn-openjdk8-server-example"></a>服务器实例</h3></div></div></div><p>该示例<code class="literal">SSLEngine</code>是相同的，只需要替换<code class="literal">SSLSocket</code>具有的实例<code class="literal">SSLEngine</code>实例。</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>SSLEngine sslEngine = ...;
ALPN.put(sslEngine, new ALPN.ServerProvider()
{
    @Override
    public void unsupported()
    {
        ALPN.remove(sslEngine);
    }

    @Override
    public String select(List&lt;String&gt; protocols);
    {
        ALPN.remove(sslEngine);
        return protocols.get(0);
    }
});</code></pre><p>ALPN实施调用<code class="literal">ALPN.ServerProvider</code>方法<code class="literal">unsupported()</code>和<code class="literal">select(List<String>),</code>这样服务器应用程序可以：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type:disc"><li class="listitem">知道客户端是否支持ALPN。</li><li class="listitem">选择客户端支持的协议之一。</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="alpn-openjdk8-implementation"></a>实施细节</h3></div></div></div><p>重要的是<code class="literal">ALPN.ServerProvider</code>和<code class="literal">ALPN.ClientProvider</code>去除<code class="literal">sslSocket</code>要么<code class="literal">sslEngine</code>谈判完成后，如上面的示例所示。否则会导致内存泄漏。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="alpn-openjdk8-tests"></a>单元测试</h3></div></div></div><p>您可以编写和运行使用ALPN实现的单元测试。我们与Maven一起使用的解决方案是为Surefire插件指定一个附加的命令行参数：</p><pre xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"><code>&lt;project&gt;

&lt;properties&gt;
    &lt;alpn-boot-version&gt;8.1.4.v20150727&lt;/alpn-boot-version&gt;
&lt;/properties&gt;

&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
            &lt;configuration&gt;
                &lt;argLine&gt;
                    -Xbootclasspath/p:${settings.localRepository}/org/mortbay/jetty/alpn/alpn-boot/${alpn-boot-version}/alpn-boot-${alpn-boot-version}.jar
                &lt;/argLine&gt;
            &lt;/configuration&gt;
        &lt;/plugin&gt;

        ...

    &lt;/plugins&gt;
&lt;/build&gt;

...

&lt;/project&gt;</code></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="alpn-openjdk8-debugging"></a>调试</h3></div></div></div><p>您可以通过以下方式为ALPN实现启用调试日志记录：</p><pre class="literallayout">ALPN.debug = true;</pre><p>由于ALPN类位于引导类路径中，因此我们选择不使用日志记录库，因为我们不想覆盖应用程序日志记录库的选择。因此记录直接在<code class="literal">System.err</code> 。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="alpn-openjdk8-license-details"></a>许可证详细信息</h3></div></div></div><p>ALPN的实现依赖于对一些OpenJDK类的修改，以及对新类的修改。 <code class="literal">sun.security.ssl</code>包。这些类在相同的版本下发布<code class="literal">GPLv2+exception</code> OpenJDK的许可证。</p><p>ALPN类及其嵌套类的发布与Jetty项目的类具有相同的许可。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="alpn-versions"></a>版本号</h3></div></div></div><p>依赖于OpenJDK类的修改，ALPN实现每次在对修改后的OpenJDK类进行更新时都进行更新。</p><div class="table"><a name="d0e17710"></a><p class="title"><b>表15.1ALPN与OpenJDK版本</b></p><div class="table-contents"><table class="table" border="1" summary="ALPN vs. OpenJDK versions"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th align="left" valign="top">OpenJDK版本</th><th align="left" valign="top">ALPN版本</th></tr></thead><tbody><tr><td align="left" valign="top"><p>1.7.0u40</p></td><td align="left" valign="top"><p>7.1.0.v20141016</p></td></tr><tr><td align="left" valign="top"><p>1.7.0u45</p></td><td align="left" valign="top"><p>7.1.0.v20141016</p></td></tr><tr><td align="left" valign="top"><p>1.7.0u51</p></td><td align="left" valign="top"><p>7.1.0.v20141016</p></td></tr><tr><td align="left" valign="top"><p>1.7.0u55</p></td><td align="left" valign="top"><p>7.1.0.v20141016</p></td></tr><tr><td align="left" valign="top"><p>1.7.0u60</p></td><td align="left" valign="top"><p>7.1.0.v20141016</p></td></tr><tr><td align="left" valign="top"><p>1.7.0u65</p></td><td align="left" valign="top"><p>7.1.0.v20141016</p></td></tr><tr><td align="left" valign="top"><p>1.7.0u67</p></td><td align="left" valign="top"><p>7.1.0.v20141016</p></td></tr><tr><td align="left" valign="top"><p>1.7.0u71</p></td><td align="left" valign="top"><p>7.1.2.v20141202</p></td></tr><tr><td align="left" valign="top"><p>1.7.0u72</p></td><td align="left" valign="top"><p>7.1.2.v20141202</p></td></tr><tr><td align="left" valign="top"><p>1.7.0u75</p></td><td align="left" valign="top"><p>7.1.3.v20150130</p></td></tr><tr><td align="left" valign="top"><p>1.7.0u76</p></td><td align="left" valign="top"><p>7.1.3.v20150130</p></td></tr><tr><td align="left" valign="top"><p>1.7.0u79</p></td><td align="left" valign="top"><p>7.1.3.v20150130</p></td></tr><tr><td align="left" valign="top"><p>1.7.0u80</p></td><td align="left" valign="top"><p>7.1.3.v20150130</p></td></tr><tr><td align="left" valign="top"><p>1.8.0</p></td><td align="left" valign="top"><p>8.1.0.v20141016</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u05</p></td><td align="left" valign="top"><p>8.1.0.v20141016</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u11</p></td><td align="left" valign="top"><p>8.1.0.v20141016</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u20</p></td><td align="left" valign="top"><p>8.1.0.v20141016</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u25</p></td><td align="left" valign="top"><p>8.1.2.v20141202</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u31</p></td><td align="left" valign="top"><p>8.1.3.v20150130</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u40</p></td><td align="left" valign="top"><p>8.1.3.v20150130</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u45</p></td><td align="left" valign="top"><p>8.1.3.v20150130</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u51</p></td><td align="left" valign="top"><p>8.1.4.v20150727</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u60</p></td><td align="left" valign="top"><p>8.1.5.v20150921</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u65</p></td><td align="left" valign="top"><p>8.1.6.v20151105</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u66</p></td><td align="left" valign="top"><p>8.1.6.v20151105</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u71</p></td><td align="left" valign="top"><p>8.1.7.v20160121</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u72</p></td><td align="left" valign="top"><p>8.1.7.v20160121</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u73</p></td><td align="left" valign="top"><p>8.1.7.v20160121</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u74</p></td><td align="left" valign="top"><p>8.1.7.v20160121</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u77</p></td><td align="left" valign="top"><p>8.1.7.v20160121</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u91</p></td><td align="left" valign="top"><p>8.1.7.v20160121</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u92</p></td><td align="left" valign="top"><p>8.1.8.v20160420</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u101</p></td><td align="left" valign="top"><p>8.1.9.v20160720</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u102</p></td><td align="left" valign="top"><p>8.1.9.v20160720</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u111</p></td><td align="left" valign="top"><p>8.1.9.v20160720</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u112</p></td><td align="left" valign="top"><p>8.1.10.v20161026</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u121</p></td><td align="left" valign="top"><p>8.1.11.v20170118</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u131</p></td><td align="left" valign="top"><p>8.1.11.v20170118</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u141</p></td><td align="left" valign="top"><p>8.1.11.v20170118</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u144</p></td><td align="left" valign="top"><p>8.1.11.v20170118</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u151</p></td><td align="left" valign="top"><p>8.1.11.v20170118</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u152</p></td><td align="left" valign="top"><p>8.1.11.v20170118</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u161</p></td><td align="left" valign="top"><p>8.1.12.v20180117</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u162</p></td><td align="left" valign="top"><p>8.1.12.v20180117</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u171</p></td><td align="left" valign="top"><p>8.1.12.v20180117</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u172</p></td><td align="left" valign="top"><p>8.1.12.v20180117</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u181</p></td><td align="left" valign="top"><p>8.1.12.v20180117</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u191</p></td><td align="left" valign="top"><p>8.1.13.v20181017</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u192</p></td><td align="left" valign="top"><p>8.1.13.v20181017</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u201</p></td><td align="left" valign="top"><p>8.1.13.v20181017</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u202</p></td><td align="left" valign="top"><p>8.1.13.v20181017</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u211 <sup>[1]</sup></p></td><td align="left" valign="top"><p>8.1.13.v20181017</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u212</p></td><td align="left" valign="top"><p>8.1.13.v20181017</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u221 <sup>[1]</sup></p></td><td align="left" valign="top"><p>8.1.13.v20181017</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u222</p></td><td align="left" valign="top"><p>8.1.13.v20181017</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u231 <sup>[1]</sup></p></td><td align="left" valign="top"><p>8.1.13.v20181017</p></td></tr><tr><td align="left" valign="top"><p>1.8.0u232</p></td><td align="left" valign="top"><p>8.1.13.v20181017</p></td></tr></tbody></table></div></div><br class="table-break"><p><sup>[1]</sup>这些是Oracle版本，其源代码不可用，或者不清楚确切的含义是因为OpenJDK存储库中没有对应的标记。我们假定这些发行版的源代码（至少对于为了使ALPN工作而修改的文件而言）与随后的发行版等效（例如，对于1.8.0u211，我们假定源代码等效于1.8.0u212，对于1.8.0u221，假设1.8.0u222，等等。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="alpn-build"></a>如何建立ALPN</h3></div></div></div><p>本部分适用于需要使用OpenJDK版本更新ALPN实现的Jetty开发人员。</p><p>使用以下命令克隆OpenJDK存储库：</p><div class="screenexample"><pre class="screen">$ hg clone http://hg.openjdk.java.net/jdk8u/jdk8u jdk8u
$ cd !$
$ ./get_source.sh</pre></div><p>要将源更新为特定标记，请使用以下命令：</p><div class="screenexample"><pre class="screen">$ ./make/scripts/hgforest.sh update &lt;tag-name&gt;</pre></div><p>可从以下页面获得OpenJDK标签的列表： <a class="link" href="http://hg.openjdk.java.net/jdk8u/jdk8u/tags" target="_top">OpenJDK 8标签</a> 。</p><p>然后，您需要在<a class="link" href="https://github.com/jetty-project/jetty-alpn" target="_top">ALPN GitHub Repository的</a>分支处比较OpenJDK的源更改并将其合并到已修改的OpenJDK类中。 <code class="literal">master</code> 。</p></div></div></div><script type="text/javascript">
      SyntaxHighlighter.all()
    </script><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tbody><tr><td width="40%" align="left"><a href="jetty-jconsole.html" accesskey="p"><i class="fa fa-chevron-left" aria-hidden="true"></i>以前</a> </td><td width="20%" align="center"><a href="jetty-admin-guide.html" accesskey="u"><i class="fa fa-chevron-up" aria-hidden="true"></i>最佳</a></td><td width="40%" align="right"> <a href="http2.html" accesskey="n">下一个<i class="fa fa-chevron-right" aria-hidden="true"></i></a></td></tr><tr><td width="40%" align="left" valign="top">使用JConsole和JMC管理Jetty</td><td width="20%" align="center"><a href="index.html" accesskey="h"><i class="fa fa-home" aria-hidden="true"></i>家</a></td><td width="40%" align="right" valign="top">第十六章HTTP / 2</td></tr></tbody></table></div><p xmlns:jfetch="java:org.eclipse.jetty.xslt.tools.JavaSourceFetchExtension" xmlns:fetch="java:org.eclipse.jetty.xslt.tools.SourceFetchExtension" xmlns:d="http://docbook.org/ns/docbook" xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" xmlns:xslthl="http://xslthl.sf.net" xmlns:gcse="http://www.google.com" xmlns:date="http://exslt.org/dates-and-times"></p><div class="jetty-callout">看到错误或缺少的东西？
            <span class="callout"><a href="http://github.com/eclipse/jetty.project">在以下位置对此文档做出贡献<span class="website"><i class="fa fa-github" aria-hidden="true"></i> Github！</span></a></span> <span style="float:right"><i>（产生：2019-11-20）</i></span></div><p></p></body></html>