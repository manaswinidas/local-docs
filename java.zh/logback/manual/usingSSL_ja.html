<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml"><head></head><body dir="ltr" onload="prettyPrint(); decorate();"></ s> </ s> </ s> <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>第15章SSLを使用する</title>
    <link rel="stylesheet" type="text/css" href="../css/common.css">
    <link rel="stylesheet" type="text/css" href="../css/screen.css" media="screen">
    <link rel="stylesheet" type="text/css" href="../css/_print.css" media="print">
    <link rel="stylesheet" type="text/css" href="../css/prettify.css" media="screen">
  
  
    <script type="text/javascript">prefix='../';</script>
    <script type="text/javascript" src="../js/prettify.js"></script>
    <script src="../templates/header.js" type="text/javascript"></script>
    <script type="text/javascript" src="../js/dsl.js"></script>
    <script type="text/javascript" src="../js/jquery-min.js"></script>
    <script type="text/javascript" src="../js/decorator.js"></script>
    <div id="left">
      <noscript>请打开Javascript查看此菜单</noscript>
      <script src="../templates/left.js" type="text/javascript"></script>
    </div>
    <div id="right">
      <script src="menu_ja.js" type="text/javascript"></script>
    </div>
    <div id="content">    
      <h1>第15章SSLを使用する</h1>
      
      <div class="quote">

        <p><em>建筑物と创造物の间には越えられない壁があります。は，建筑物は作られた后でしか爱されることができないのに，创造物は存在する前から爱されていることです。</em></p>
        <p>-查尔斯·狄更斯</p>
      </div>

    <script type="text/javascript" src="../templates/creative.js"></script>

      <p>logbackはソケットベースのアペンダーから远隔のレシーバーにログを配信するために，Secure Socket Layer（SSL）を使用することが出来ます。SSLに対応したアペンダーとレシーバーを使うと，シリアライズされたロギングイベントはセキュアなチャネルで配信されます。
      </p>
      
      <h2 class="doAnchor">SSLとそれを使うコンポーネントの役割</h2>
      
      <p>アペンダーやレシーバーはサーバーとしても振る舞うし，クライアントとしても振る舞うことができます。これはネットワーク接続を始める方向によるものです。logーバーとして振る舞うとき，logbackのコンポーネントは外部のクライアントコンポーネントからの接続を待ち受けます。逆に，クライアントとして振る舞うコンポーネントは，外部のサーバーコンコーネンネントに接続し始めます。はとえば， <em>クライアント</em>として振る舞うアペンダーは， <em>サーバー</em>として振る舞うレシーバーに接続するのです。がいは， <em>クライアント</em>として振る舞うレシーバーが， <em>サーバー</em>として振る舞うアペンダーに接続します。</p>
      
      <p>基本ンポーネントの役割は，基本的にコンポーネントタイプによって决まります。たとえば， <code>SSLServerSocketAppender</code>はサーバーとして振る舞うアペンダーコンポーネントですし， <code>SSLSocketAppender</code>はクライアントとして振る舞うアペンダーコンポーネントです。このように，开発者もアプリケーションション管理者も，思った通りの方向でネットワーク接続を始められるようにlogbackのコンポーネントを设定することができます。</p>
      
      <p>SSLのコンテキストにおいて接続を开始する方向は非常に重要です。。，证明ーバーコンポーネントは接続してくるクライアントに対してX.509证明书を使って自分のことを证明しなければならないからです。クライアントコンポーネントはサーバー続する接続するとき，信頼できるかどうかをサーバーの证明书で検证します。开発者やアプリケーション管理者はlogbackのコンポーネントの役割をきちんと理解しておかなければなりません。X，サーバーならキーストア（サーバーのX.509证明书を配置します）を适切に构成し，クライアントならトラストストア（信頼できるサーバーかどうかを検证バときに使用する自己署名ルート证明书を配置します）を适切に构成しなければなりません。</p>
      
      <p>SSLが<em>相互认证</em>するように设置されている场合，サーバーコンコーネントとクライアントコンポーネントの両方が，それぞれのピアから信頼性を検证された正当なX.509证明书を持っていなければなりません。相互认证はサーバーコンコーネントで设定でのなので，开発者もアプリケーションション管理者も，コンポーネントがちゃんとサーバーとして振る舞っていることをきちんと把握しておかなければなりません。</p>
      
      <p>本章では，サーバーとして振る舞うアペンペーやレシーバーのことを，単に<em>サーバーコンポーネント</em>あるいは<em>サーバー</em>と呼ぶことにします。して，クライアントとして振る舞うコンポーネントは<em>クライアントコンポーネント</em>あるいは<em>クライアント</em>と呼ぶことにします。
            
      </p><h2 class="doAnchor">SSLとX.509证明书</h2>
      
      <p>SSLに対応したlogbackコンポーネントを使うには，SSLサーバーとして动作するコンポーネントが自分のことを证明するのに，X.509证明书（秘密键とそれに対応する证明书，および，CAの证明书チェーン）が必要になります。相互认证を使いたいときは，SSLクライアントとして动作するコンポーネントの证明书も必要です。
      </p>      
      <p>民间の证明机关（CA）だけでなく，独自のCAで発行した证明书を使うことができるのですが，自己署名した证明书を使うこともできます。必要事项は次のとおりです。</p> 
      <ol>
        <li>（自己署名证明书を使わない场合）サーバーコンポーネントに，サーバーの秘密键を含むキーストア，対応する证明书，およびCAの证明书チェーンを指定しなければなりません。
        </li>
        <li>クライアントコンポーネントに，信頼されたルートCA证明书（复数可）または，サーバの自己署名ルート证明书を含むトラストストアを指定しなければなりません。
        </li>
      </ol>
          
      <h2 class="doAnchor">SSL用のlogbackコンポーネントの设定</h2>
      <p>logbackがSSL対応するのに使っているJava安全套接字扩展（JSSE）とJava暗号化アーキテクチャ（JCA）には设定可能的な项目がたくさんあります。また，プラグイン可能なフレームワークーのな，组み込みのSSLとプラットフォーム固有の暗号化机能は差し替え可能えいます。SSLに対応したlogbackのコンポーネントでは，SSLエンジンと暗号化プロバイダーに设定できることは全て设定できるようになっています。ので，利用者によって固有のセキュリティ要件を満たすことができます。
      </p>
      
      <h3>JSSEのシステムプロパティを使った基本的なSSLの设定</h3>
      <p>SSLに対応したlogbackのコンポーネントでは，SSLの设定可能なプロパティのほとんどについて妥当な初期な用意されています。场合，ほとんどの场合いくつかJSEEのシステムプロパティを指定するだけで済むでしょう。
      </p>
      
      <p>りのセクションの残りの部分では，ほとんどの环境で必要になる特定のJSSEプロパティについて说明します。パティをステムプロパティを使ってJSSEをカスタマイズする方法の详细については， <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html#InstallationAndCustomization">JSSEのカスタマイズ</a>の<a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html">JSSEリファレンスガイド</a>を参照してください。
      </p>

      <p>ーバーとして振る舞うSSL対応のlogbackアペンダーやレシーバー（ <code>SSLServerSocketReceiver</code>や<code>SSLServerSocketAppender</code>や<code>SimpleSSLSocketServer</code> ）を使うときは，JSSEのシステムプロパティで秘密键と证明书を含むキーストアの场所と种类とパスワードを指定しなければなりません。
      </p>
      
      <h4><a name="basicConfig.keyStore"></a>でキーバー侧でキーストアを指定するためのシステムプロパティ</h4>
      <table class="bodyTable striped">
        <tbody><tr>
          <th>プロパティ名</th>
          <th>说明</th>
        </tr>
        <tr>
          <td><code>javax.net.ssl.keyStore</code></td>
          <td>秘密ーバーコンポーネントの秘密键と证明书を包含むファイルの，ファイルシステム上のパスを指定します。</td>
        </tr>
        <tr>
          <td><code>javax.net.ssl.keyStoreType</code></td>
          <td>キーストアの种类を指定します。场合のプロパティが指定されていない场合，プラットフォームのデフォルト（JKS）になります。
          </td>
        </tr>
        <tr>
          <td><code>javax.net.ssl.keyStorePassword</code></td>
          <td>ーストアにアクセスするためのパスワードを指定します。
          </td>
        </tr>
      </tbody></table>

      <p>で<a href="./15-usingSSL.html#Examples">の例</a>で，SSL対応のサーバーコンコーネントを実行する际にシステムプロパティを指定パティを方法する确认してください。
      </p>
         
      <p>がーバーコンポーネントが民间の证明机关（CA）で署名された证明书を使うときは， <strong>おそらくクライアントコンポーネントでSSLの设定をする必要はありません。</strong>JVMーバー侧では，JVMのシステムプロパティとしてキーストアを指定するだけでよいです。
      </p>
               
      <p>自己的机构名したサーバー证明书か，Javaのデフォルトのトラストストアに含まれないルート证明书（社内用の证明局など）で署名したサーバー证明书を使うときは，JSパスワードを指定するか，サーバー证明书を署名した信頼できるルトト证明书を指定しなければなりません。<strong>SSL対応のクライアントコンポーネントを利用するアプリケーションごとに，これらのシステムプロパティを设定しなければなりません</strong> 。
      </p>
        
      <h4><a name="basicConfig.trustStore"></a>クライアント侧でトラストストアト指定をのシステムプロパティ</h4>
      <table class="bodyTable striped">
        <tbody><tr>
          <th>プロパティ名</th>
          <th>说明</th>
        </tr>
        <tr>
          <td><code>javax.net.ssl.trustStore</code></td>
          <td>证明ーバーコンポーネントの证明书か，サーバー证明书に署名した认证局（CA）の信頼できるルート证明书のファイルシステム上のパスを指定します。</td>
        </tr>
        <tr>
          <td><code>javax.net.ssl.trustStoreType</code></td>
          <td>トラストストアの种类を指定します。场合のプロパティが指定されていない场合，プラットフォームのデフォルト（JKS）になります。
          </td>
        </tr>
        <tr>
          <td><code>javax.net.ssl.trustStorePassword</code></td>
          <td>トラストストアにアクセスするためのパスワードを指定します。
          </td>
        </tr>
      </tbody></table>

      <p>で<a href="./15-usingSSL.html#Examples">の例</a>で，SSL対応のクライアントコンポーネントを実行する际にシステムプロパティを指定する方法を确认してください。
      </p>         
            
      <h3 class="doAnchor"><a name="SSLConfiguration"></a>高度なSSLの设定</h3>
      <p>JSSEシステムプロパティによる基本的なSSLの设定だけでは足りないことがあります。Webアプリケーションで<code>SSLServerSocketReceiver</code>を用法しているとき，WebクライアントがWebサーバーを识别するため证明书と，ロギングクライアントがロギングサーバーを识别するための证明书では别のものを使いたいはずです。ロギングサーバーには，认证，および，认可されたリモートロガーだけが接続できるよう，SSLのクライアントを认证したいこともあるでしょう。あるいは，内部ネットワークではSSLプロトコルと暗号スイートを使わなければならない，というポリシーを强制する组织があるかもしれません。これらのいずれかのニーズを満たすためには，logbackの高度なSSL设定オプションを确かめておいたほういいでしょう。</p>
      <p>logbackのコンポーネントでSSLを设定するときは， <code>ssl</code>プロパティに指定します。
      </p>      
      <p><code>SSLServerSocketReceiver</code>を使うときは，keystoreプロパティでサーバーの证明书を含んだキーストアを指定します。
      </p>

      <span class="asGroovy" onclick="return asGroovy('logback-ssl-serverKeyStore');">Groovyとして表示</span>
      <pre id="logback-ssl-serverKeyStore" class="prettyprint source">&lt;configuration&gt;

  &lt;appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender"&gt;
    &lt;encoder&gt;
      &lt;pattern&gt;%d{HH:mm:ss.SSS} [%thread] %-5level %logger - %msg%n&lt;/pattern&gt;
    &lt;/encoder&gt;
  &lt;/appender&gt;
  
  &lt;root level="debug"&gt;
    &lt;appender-ref ref="CONSOLE" /&gt;
  &lt;/root&gt;

  &lt;receiver class="ch.qos.logback.classic.net.server.SSLServerSocketReceiver"&gt;
    &lt;ssl&gt;
      &lt;keyStore&gt;
        &lt;location&gt;classpath:/logging-server-keystore.jks&lt;/location&gt;
        &lt;password&gt;changeit&lt;/password&gt;
      &lt;/keyStore&gt;
    &lt;/ssl&gt;
  &lt;/receiver&gt; 

&lt;/configuration&gt;</pre>

      <p>ここでは，キーストアの场所にloging <em>-server-keystore.jks</em>が指定されています。から，文件から始まるURLを指定することもできます。
      </p>
      <p>アプリケーションで<code>SSLSocketAppender</code>を使いたいけど，アプリケーション自体の（JSEEの）デフォルトのトラストストアを変更したくないときは， <code>javax.net.ssl.trustStore</code>プロパティを使うことができます。
      </p>          

      <span class="asGroovy" onclick="return asGroovy('logback-ssl-clientTrustStore');">Groovyとして表示</span>
      <pre id="logback-ssl-clientTrustStore" class="prettyprint source">&lt;configuration&gt;
  &lt;appender name="SOCKET" class="ch.qos.logback.classic.net.SSLSocketAppender"&gt;
    &lt;ssl&gt;
      &lt;trustStore&gt;
        &lt;location&gt;classpath:/logging-server-truststore.jks&lt;/location&gt;
        &lt;password&gt;changeit&lt;/password&gt;
      &lt;/trustStore&gt;
    &lt;/ssl&gt;
  &lt;/appender&gt;
  
  &lt;root level="debug"&gt;
    &lt;appender-ref ref="SOCKET" /&gt;
  &lt;/root&gt;

&lt;/configuration&gt;</pre>

      <p><em>日志记录服务器信任库。jks</em>が指定されていに。から，文件から始まるURLを指定することもできます。

      </p>

      <h4>SSLプロパティ</h4>
      
      <p>JSSEは设置可能なオプションを大量に公开しています。logbackのSSL対応では公开された设定のほとんどを设定ファイル中で指定できるようになっています。XML形式の设定ファイルでは，SSLの各种设定をssl要素で设定します。ssl要素に対応しているのは<code><a href="http://logback.qos.ch/xref/ch/qos/logback/core/net/ssl/SSLConfiguration.html">SSLConfiguration</a></code>クラスです。
      </p>
      
      <p>SSLに対応したコンポーネントを设定するには，デフォルト値では困る时にこれらのプロパティを设定するだけでよいです。设定してしまうと，こんがらがってしまって问题を解析するのがとてもむずかしくなってしまいます。
      </p>
 
      <p>SSLの设定におけるトップレベルのプロパティは次のとおりです。これらのプロパティの多くについて，さらに下位のプロパティが存在します。トップレベルなプロパティの一覧表の后に说明します。
      </p>
            
      <table class="bodyTable striped">
        <tbody><tr>
          <th>プロパティ名</th>
          <th>类型</th>
          <th>说明</th>
        </tr>
        <tr>
          <td><span class="prop" container="ssl">keyManagerFactory</span></td>
          <td><a href="http://logback.qos.ch/xref/ch/qos/logback/core/net/ssl/KeyManagerFactoryFactoryBean.html">
              <code>KeyManagerFactoryFactoryBean</code></a>
          </td>
          <td><code><a href="http://docs.oracle.com/javase/1.5.0/docs/api/javax/net/ssl/KeyManagerFactory.html">KeyManagerFactory</a></code>の设定を指定します。JVMのプロパティが设定されていない场合は，JVMのデフォルトのファクトリが使が。<a href="./15-usingSSL.html#KeyManagerFactoryFactoryBean">をーマネージャファクトリの设定</a>を参照してください。
          </td>
        </tr>
        <tr>
          <td><a name="ssl.keyStore"></a> <span class="prop" container="ssl">密钥库</span></td>
          <td><a href="http://logback.qos.ch/xref/ch/qos/logback/core/net/ssl/KeyStoreFactoryBean.html">
              <code>KeyStoreFactoryBean</code></a>
          </td>
          <td>
            <p><code><a href="http://docs.oracle.com/javase/1.5.0/docs/api/java/security/KeyStore.html">KeyStore</a></code>の设定を指定します。ーストアには，少なくとも1つのX.509证明书（秘密键と対応する证明书，あるいはCA证明书チェーン）が含まれていなければなりません。证明の证明书がSSLのリモートピアに提示されます。
            </p>
            <p>SSLクライアント（ <code>SSLSocketAppender</code>など）の设定に<span class="prop" container="ssl">keyStore</span>プロパティが必要になるのは，リモートピアへの接続にクライアント认证が必要な场合だけです。
            </p>
            <p>SSLサーバー（ <code>SimpleSSLSocketServer</code>など）の<span class="prop" container="ssl">keyStore</span>プロパティには，サーバー证明书を格纳したキーストアを指定します。JSのプロパティが设定されていない场合は，JSSEのシステムプロパティ<code>javax.net.ssl.keyStore</code>に，サーバーのキーストアの场所を指定しておかなければなりません。详细は<a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html">JSSEのフガンスガイド</a>の<a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html#InstallationAndCustomization">JSSEのカスタマイズ</a>を参照してください。
            </p>
            <p>します<a href="./15-usingSSL.html#KeyStoreFactoryBean">ーストアの设定</a>については后述します。
            </p>
          </td>
        </tr>
        <tr>
          <td><span class="prop" container="ssl">参数</span></td>
          <td><a href="http://logback.qos.ch/xref/ch/qos/logback/core/net/ssl/SSLParametersConfiguration.html">
              <code>SSLParametersConfiguration</code></a></td>
          <td>SSLセッションのネゴシエーションショ使用するいろいろなパラメータを指定します。<a href="./15-usingSSL.html#SSLParametersConfiguration">SSLパラメータの设定</a>については后述します。
          </td>
        </tr>
        <tr>
          <td><span class="prop" container="ssl">协议</span></td>
          <td><code>String</code></td>
          <td><code><a href="http://docs.oracle.com/javase/1.5.0/docs/api/javax/net/ssl/SSLContext.html">SSLContext</a></code>を作成するために使用するSSLプロトコルを指定します。<a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html">JSSEリファレンスガイド</a>に记された<a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html#AppA">标准名</a>を指定してください。JVMのプロパティが设定されていない场合は，JVMのデフォルトのプロトコル名が使用されます。
          </td>
        </tr>
        <tr>
          <td><span class="prop" container="ssl">提供者</span></td>
          <td><code>String</code></td>
          <td><code><a href="http://docs.oracle.com/javase/1.5.0/docs/api/javax/net/ssl/SSLContext.html">SSLContext</a></code>を作成するために使用するJSSEプロバイダーダ名を指定します。はのプロパティが设定されていない场合は，JVMのデフォルトのJSSEプロバイダ名ダ使用されます。
          </td>
        </tr>
        <tr>
          <td><span class="prop" container="ssl">安全随机</span></td>
          <td><a href="http://logback.qos.ch/xref/ch/qos/logback/core/net/ssl/SecureRandomFactoryBean.html">
              <code>SecureRandomFactoryBean</code></a>
          </td>
          <td><code><a href="http://docs.oracle.com/javase/1.5.0/docs/api/java/security/SecureRandom.html">SecureRandom</a></code> （安全な乱数生成器）の设定を指定します。はのプロパティが设定されていない场合は，JVMのデフォルトの乱数生成器が使用されます。<a href="./15-usingSSL.html#SecureRandomFactoryBean">安全な乱数生成器の设定</a>については后述します。
          </td>
        </tr>
        <tr>
          <td><span class="prop" container="ssl">trustManagerFactory</span></td>
          <td><a href="http://logback.qos.ch/xref/ch/qos/logback/core/net/ssl/TrustManagerFactoryFactoryBean.html">
              <code>TrustManagerFactoryFactoryBean</code></a>
          </td>
          <td><code><a href="http://docs.oracle.com/javase/1.5.0/docs/api/javax/net/ssl/TrustManagerFactory.html">TrustManagerFactory</a></code>の设定を指定します。JVMのプロパティが设定されていない场合は，JVMのデフォルトのファクトリーを使用します。<a href="./15-usingSSL.html#TrustManagerFactoryFactoryBean">トラストマネージャファクトリー</a>については后述します。
          </td>
        </tr>
        <tr>
          <td><a name="ssl.trustStore"></a> <span class="prop" container="ssl">trustStore</span></td>
          <td><a href="http://logback.qos.ch/xref/ch/qos/logback/core/net/ssl/KeyStoreFactoryBean.html">
              <code>KeyStoreFactoryBean</code></a>
          </td>
          <td>
            <p>SSLのリモートピアの同一性を検证するために使う<code><a href="http://docs.oracle.com/javase/1.5.0/docs/api/java/security/KeyStore.html">KeyStore</a></code>の设定を指定します。つーストアには少なくとも1つ以上の<em>トラストアンカー</em>が含まれていなければなりません。“信頼できる”と印の付けられた自己署名证明书のことです。一般的に，トラストストアには自己署名CA证明书が含まれています。
            </p>
            <p>JSのプロパティで指定したトラストストアは，JSSEの<code>java.net.ssl.trustStore</code>システムプロパティで指定された全てのトラストストアを上书きします。详细は<a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html">JSSEのフガンスガイド</a>の<a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html#InstallationAndCustomization">JSSEのカスタマイズ</a>を参照してください。

            </p>
          </td>
        </tr>
      </tbody></table>
      
      <h4 class="doAnchor"><a name="KeyStoreFactoryBean"></a>设定ーストアの设定</h4>
          
      <p><code><a href="http://logback.qos.ch/xref/ch/qos/logback/core/net/ssl/KeyStoreFactoryBean.html">KeyStoreFactoryBean</a></code> 509，X.509证明书を格纳した<a href="http://docs.oracle.com/javase/1.5.0/docs/api/java/security/KeyStore.html"><code>KeyStore</code></a>を作成するために必要な设定を提供します。BeanのファクトリーBeanのプロパティは， <a href="./15-usingSSL.html#SSLConfiguration">SSLの设定</a>で绍介した<a href="./15-usingSSL.html#ssl.keyStore"><span class="prop" container="ssl">keyStore</span></a>および<a href="./15-usingSSL.html#ssl.trustStore"><span class="prop" container="ssl">trustStore</span></a>として使うことができます。
      </p>
 
      <table class="bodyTable striped">
        <tbody><tr>
          <th>プロパティ名</th>
          <th>型</th>
          <th>说明</th>
        </tr>
        <tr>
          <td><span class="prop" container="keyStore">地点</span></td>
          <td><code>String</code></td>
          <td>キーストアの场所をURLで指定します。ファイルシステム上のキーストアを指定するときは， <code>file:</code>形式のURLを指定します。<code>classpath:</code>形式のURLを指定すれば，クラスパス上のリソースを指定することもできます。URLスキームがないときは， <code>classpath:</code>が指定されたものとして扱います。</td>
        </tr>
        <tr>
          <td><span class="prop" container="keyStore">密码</span></td>
          <td><code>String</code></td>
          <td>ーストアにアクセスするためのパスワードを指定します。</td>
        </tr>
        <tr>
          <td><span class="prop" container="keyStore">提供者</span></td>
          <td><code>String</code></td>
          <td><code>KeyStore</code>プ作成するために使用するJCAプロバイダーダ名を指定します。JVMのプロパティが设定されていない场合は，JVMのデフォルトのキーストアプロバイダーが使用されます。
          </td>
        </tr>
        <tr>
          <td><span class="prop" container="keyStore">类型</span></td>
          <td><code>String</code></td>
          <td><code>KeyStore</code>の种类を指定します。指定できるのは， <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/CryptoSpec.html">Java暗号化アーキテクチャ</a>に记载された仕様である<a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/CryptoSpec.html#AppA">标准名</a>です。JVMのプロパティが设定されていない场合は，JVMのデフォルトが使用されます。
          </td>
        </tr>
      </tbody></table>
      
      <h4><a name="KeyManagerFactoryFactoryBean"></a>设定ーマネージャファクトリーの设定</h4>
          
      <p><a href="http://docs.oracle.com/javase/1.5.0/docs/api/javax/net/ssl/KeyManagerFactory.html"><code>KeyManagerFactory</code></a>を作成するために必要な设定は， <code><a href="http://logback.qos.ch/xref/ch/qos/logback/core/net/ssl/KeyManagerFactoryFactoryBean.html">KeyManagerFactoryFactoryBean</a></code>によって提供されます。普通はキーマネージャーファクトリーの明示的な设定は不要です。に全ての场合にJVMのデフォルトのファクトリーで十分だからです。
      </p>

      <table class="bodyTable striped">
        <tbody><tr>
          <th>プロパティ名</th>
          <th>型</th>
          <th>说明</th>
        </tr>
        <tr>
          <td><span class="prop" container="keyManagerFactory">算法</span></td>
          <td><code>String</code></td>
          <td><code>KeyManagerFactory</code>が使うアルゴリズム名を指定します。指定できるのは， <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html">JSSEリファレンスガイド</a>に记载された<a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html#AppA">标准名</a>だけです。JVMのプロパティが设定されていない场合は，JVMのデフォルトのアルゴリズムが使用されます。
          </td>
        </tr>
        <tr>
          <td><span class="prop" container="keyManagerFactory">提供者</span></td>
          <td><code>String</code></td>
          <td><code>SecureRandom</code>生成器を生成するのに使われるJCAプロバイダーダ名を指定します。はのプロパティが设定されていない场合は，JVMのデフォルトのJSSEプロバイダーダ使用されます。
          </td>
        </tr>
      </tbody></table>

      <h4 class="doAnchor"><a name="SecureRandomFactoryBean"></a>安全な乱数生成器の设定</h4>
          
      <p><a href="http://docs.oracle.com/javase/1.5.0/docs/api/java/security/SecureRandom.html"><code>SecureRandom</code></a>生成器を作成するために必要な设定は， <code><a href="http://logback.qos.ch/xref/ch/qos/logback/core/net/ssl/SecureRandomFactoryBean.html">SecureRandomFactoryBean</a></code>によって提供されます。JVMのデフォルトの乱数生成器で十分なことがほとんどなので，普通は明示的に设定する必要がありません。
      </p>
 
      <table class="bodyTable striped">
        <tbody><tr>
          <th>プロパティ名</th>
          <th>型</th>
          <th>说明</th>
        </tr>
        <tr>
          <td><span class="prop" container="secureRandom">算法</span></td>
          <td><code>String</code></td>
          <td><code>安全な乱数生成器</code>のアルゴリズム名を指定します。指定できるのは<a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/CryptoSpec.html">Java暗号化アーキテクチャの</a>に记载された<a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/CryptoSpec.html#AppA">标准名</a>だけです。はのプロパティが设定されていない场合は，JVMのデフォルトの乱数生成アルゴリズムが使用ズムが。
          </td>
        </tr>
        <tr>
          <td><span class="prop" container="secureRandom">提供者</span></td>
          <td><code>String</code></td>
          <td><code>安全な乱数生成器</code>プ生成するために使われるJCAプロバイダーダ名を指定します。はのプロパティが设定されていない场合は，JVMのデフォルトのJSSEプロバイダ名ダ使用されます。
          </td>
        </tr>
      </tbody></table>
      
      <h4><a name="SSLParametersConfiguration"></a> SSLパラメータの设定</h4>
          
      <p><code><a href="http://logback.qos.ch/xref/ch/qos/logback/core/net/ssl/SSLParametersConfiguration.html">SSLParametersConfiguration</a></code>を使って，SSLプロトコル，暗号スイート，およびクライアント认证オプションをカスタマイズすることができます。
      </p>

      <table class="bodyTable striped">
        <tbody><tr>
          <th>プロパティ名</th>
          <th>型</th>
          <th>说明</th>
        </tr>
        <tr>
          <td><a name="parameters.excludedCipherSpecs"></a> <span class="prop" container="parameters">excludeCipherSpecs</span></td>
          <td><code>String</code></td>
          <td>
            <p>にッションネゴシエーションをする际に排除するSSL暗号方式名をカンマ区切りリストで指定します。エのプロパティに指定する値は，SSLエンジンがサポートしている暗号方式を限定するために使用されます。マッチした暗号方式はすべて无效になります。
            </p>
            <p>カンマ区切りリストのそれぞれの项目には単纯な文字列あるいは距离表现表现指定をとができます。
            </p>
            <p>指定できるのは， <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html">JSSEリファレンスガイド</a>の<a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html#AppA">标准名</a>にあるものだけです。
            </p>
          </td>
        </tr>
        <tr>
          <td><a name="parameters.includedCipherSpecs"></a> <span class="prop" container="parameters">includedCipherSpecs</span></td>
          <td><code>String</code></td>
          <td>
            <p>セッションネゴシエーションをする际をする使用するSSL暗号方式名をカンマ区切りリストで指定します。エのプロパティに指定する値は，SSLエンジンがサポートしている暗号方式を特定するために使用されます。マッチした暗号方式はすべて有效になります。
            </p>
            <p>カンマ区切りリストのそれぞれの项目には単纯な文字列あるいは距离表现表现指定をとができます。
            </p>
            <p>指定できるのは， <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html">JSSEリファレンスガイド</a>の<a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html#AppA">标准名</a>にあるものだけです。

            </p>
          </td>
        </tr>
        <tr>
          <td><a name="parameters.excludedProtocols"></a> <span class="prop" container="parameters">排除协议</span></td>
          <td><code>String</code></td>
          <td>
            <p>セッションネゴシエーションをする际に排除するSSLプロトコル名をカンマ区切りリストで指定します。このプロパティに指定する値は，SSLエンジンがサポートしているSSLプロトコルを限定するために使用されます。チしたッチしたSSLプロトコルはすべて无效になります。
            </p>
            <p>カンマ区切りリストのそれぞれの项目には単纯な文字列あるいは距离表现表现指定をとができます。
            </p>
            <p>指定できるのは， <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html">JSSEリファレンスガイド</a>の<a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html#AppA">标准名</a>にあるものだけです。
            </p>
          </td>
        </tr>
        <tr>
          <td><a name="parameters.includedProtocols"></a> <span class="prop" container="parameters">包含的协议</span></td>
          <td><code>String</code></td>
          <td>
            <p>セッションネゴシエーションをする际をする使用するSSLプロトコル名をカンマ区切りリストで指定します。このプロパティに指定する値は，SSLエンジンがサポートしているSSLプロトコルを特定するために使用されます。チしたッチしたSSLプロトコルはすべて有效になります。

            </p>
            <p>カンマ区切りリストのそれぞれの项目には単纯な文字列あるいは距离表现表现指定をとができます。

            </p>
            <p>指定できるのは， <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html">JSSEリファレンスガイド</a>の<a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html#AppA">标准名</a>にあるものだけです。
            </p>
          </td>
        </tr>
        <tr>
          <td><a name="parameters.needClientAuth"></a> <span class="prop" container="parameters">needClientAuth</span></td>
          <td><code>boolean</code></td>
          <td>でーバー侧でクライアント认证が<em>必要</em>なときは，このプロパティに<code>true</code>を指定します。クライアントコンポーネント（ <code>SSLSocketAppender</code>はこ）の场合はこのプロパティは无视されます。
          </td>
        </tr>
        <tr>
          <td><a name="parameters.wantClientAuth"></a> <span class="prop" container="parameters">wantClientAuth</span></td>
          <td><code>boolean</code></td>
          <td>でーバー侧でクライアント认证が<em>必要</em>なときは，このプロパティに<code>true</code>を指定します。クライアントコンポーネント（ <code>SSLSocketAppender</code>はこ）の场合はこのプロパティは无视されます。

          </td>
        </tr>
      </tbody></table>
      
      <h4><a name="TrustManagerFactoryFactoryBean"></a>トラストマネージャファクトリーの设定</h4>
          
      <p><a href="http://docs.oracle.com/javase/1.5.0/docs/api/javax/net/ssl/TrustManagerFactory.html"><code>TrustManagerFactory</code></a>を作成するために必要な设定は， <code><a href="http://logback.qos.ch/xref/ch/qos/logback/core/net/ssl/TrustManagerFactoryFactoryBean.html">TrustManagerFactoryFactoryBean</a></code>が提供します。JVMのデフォルトのファクトリーで十分なことがほとんどなので，普通は明示的に设定する必要がありません。

      </p>

      <table class="bodyTable striped">
        <tbody><tr>
          <th>プロパティ名</th>
          <th>型</th>
          <th>说明</th>
        </tr>
        <tr>
          <td><span class="prop" container="trustManagerFactory">算法</span></td>
          <td><code>String</code></td>
          <td><code>TrustManagerFactory</code>のアルゴリズム名を指定します。指定できるのは， <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html">JSSEリファレンスガイド</a>の<a href="http://docs.oracle.com/javase/1.5.0/docs/guide/security/jsse/JSSERefGuide.html#AppA">标准名</a>にあるものだけです。JVMのプロパティが设定されていない场合は，JVMのデフォルトのキーマネージャのアルゴリズムが使用されます。
          </td>
        </tr>
        <tr>
          <td><span class="prop" container="trustManagerFactory">提供者</span></td>
          <td><code>String</code></td>
          <td><code>安全な乱数生成器</code>プ生成するために使われるJCAプロバイダーダ名を指定します。はのプロパティが设定されていない场合は，JVMのデフォルトのJSSEプロバイダが使用されます。
          </td>
        </tr>
      </tbody></table>
      
      <h2 class="doAnchor"><a name="Examples"></a>例</h2>

      <h3>JSSEシステムプロパティを使用する</h3>
      <p>JSSEシステムプロパティは，パティはーバーのX.509证明书を含むキーストアの场所とパスワードを指定するために使われます。また，クライアントコンポーネンがントネ信がきるサーバーかどうかを検证するために使用する，自己署名ルートCA证明书を含むトラストストストアの场所とパスワードを指定します。</p>

      <h4>サーバーのキーストアを指定する</h4>
      <p>するーバーコンポーネントを実行する场合，サーバーの证明书を含むキーストアの场所とパスワードを指定しなければなりません。のために，JSSEシステムプロパティを使用することができます。logbackの配布物に含まれる<code>SimpleSSLSocketServer</code>を実行してみましょう。</p>
    
      <p class="source">java -DkeyStore = / etc / logback-server-keystore.jks \ -DkeyStorePassword = changeit -DkeyStoreType = JKS \ ch.qos.logback.net。SimpleSSLSocketServer 6000 /etc/logback-server-config.xml</p>
              
      <p>JSSEシステムプロパティの<em>keyStore</em>に，サーバーのキーストアへのパスを指定するのを忘れないようにしてください。そのパスを<em>logback.xml</em>で指定するときはURLで指定します。</p>
      
      <p>ではの例ではlogbackの配布物に含まれているスタンドアローンのサーバーアプリケーションショ行を実。でもアプリケーションでも，logbackのサーバーコンポーネントを使う偶尔は同じようにシステムプロパティを指定できます。
      
      </p><h4>クライアントのトラストストアを指定する</h4>
      
      <p>クライアントコンポーネントを使用する场合，信頼できるサーバーかどうかを検证するために使用する，ルートCA证明书を含むトラストストアト场所のパスワードを指定しなければなりません。ためにのためにJSSEシステムプロパティを使用することができます。logbackのSSL対応のクライアントコンポーネントを复数使用する<code>com.example.MyLoggingApplication</code>を実行してみましょう。</p>

      <p class="source">java -DtrustStore = / etc / logback-client-truststore.jks \ -DtrustStorePassword = changeit -DtrustStoreType = JKS \ com.example。MyLoggingApplication</p>
      
      <p>JSSEシステムプロパティのに<em>的trustStore，</em>トラストストアへのパスを指定するのを忘れないようにしてください。そのパスを<em>logback.xml</em>で指定するときはURLで指定します。</p>
      
      <h3>自己ーバーコンポーネントの自己署名证明书を生成して利用する</h3>
      <p>自己署名证明书を生成するには，Javaランタイム环境（JRE）に同梱されている<em>keytoolユーティリティ</em>を使用します。在此之前の手顺では，
      </p>
      
      <h4>证明ーバコンポーネントの证明书の生成</h4>
      <p>次のコマンドを実行すると， <em>server.keystore</em>というファイル名の自己署名クライアント证明书を生成します。</p>
      <pre class="source">keytool -genkey -alias server -dname "CN=my-logging-server" \
    -keyalg RSA -validity 365 -keystore server.keystore
Enter keystore password: &lt;Enter password of your choosing&gt;
Re-enter new password: &lt;Re-enter same password&gt;
Enter key password for &lt;my-logging-server&gt;
	(RETURN if same as keystore password):  &lt;Press RETURN&gt;
</pre>

      <p><em>dname</em>に指定した<em>my-logging-server</em>は，正当なものであればどんなものでも构いません。完全ーバーを実行するホストの完全修饰ドメイン名にするとよいでしょう。<em>有效性</em>には证明书の有效期限が切れるまでの日数を指定します。</p>
      
      <p>本番环境の设定で重要になるのが，サーバー证明书を配置するキーストアにとても强力なパスワードを指定することです。秘密のパスワードによって，サーバーの秘密键にアクセスできるのが限られた关系者だけであることを保证します。后の手顺でこのパスワードが必要になるので，サーバーの设定をするときに心の中にメモしておいてください。
      </p>

      <h4>クライアントコンポーネント用のトラストストアの作成</h4>
      <p>クライアントコンポーネントの设定に使用するため，前の手顺で作成したサーバーの证明书をキーストアからエクスポートして，トラストストアにインポートしましょう。次のコマンドを実行すると，证明书をエクスポートして<em>server.truststore</em>といフフイイル名のトラストストアにインポトトします。</p>
      
      <pre class="source">keytool -export -rfc -alias server -keystore server.keystore \
    -file server.crt
Enter keystore password: &lt;Enter password you chose for in previous step&gt;

keytool -import -alias server -file server.crt -keystore server.truststore
Enter keystore password: &lt;Enter password of your choosing&gt;
Re-enter new password: &lt;Re-enter same password&gt;
Owner: CN=my-logging-server
Issuer: CN=my-logging-server
Serial number: 6e7eea40
Valid from: Sun Mar 31 07:57:29 EDT 2013 until: Mon Mar 31 07:57:29 EDT 2014

   ...

Trust this certificate? [no]:  &lt;Enter "yes"&gt;
</pre>

      <p>最初是コマンドは，キーストアからエクスポートしたサー证明ー证明书を<em>server.crt</em>というファイル名で保存します。二つ目のコマンドは，サーバー证明书を含んだ<em>server.truststore</em>という新しいトラストストアト作成します。
      </p>
      
      <p>本番环境の设定で重要になるのが，トラストストアにとても强力な，そして，サーバーのキーストアに使用したパスワードとは异なるパスワードを设定することです。に指定したパスワードは，クライアントのアペンダーの设定に必要になるので心の中にメモしておいてください。
      </p>
          
      <h4>设定ーバコンポーネントの设定</h4>
      <p><em>server.keystore</em>をアプリケーションアーカイブの内部に取り込まなければならないかもしれません。ますしーストアはアプリプーションのクラスパスリソースとして扱うこともできますし，単にサーバーを実行するホストのファイルシステム上に配置することもできます。设定ファイルからキーストアの场所を指定するときは， <code>classpath:</code>から始まるURLか， <code>file:</code>から始まるURLのいずれかを指定します。设定ファイルを见てみましょう。</p>

      <p class="example">例：サーバーコンポーネントの设定</p>
      <pre class="prettyprint source">&lt;configuration debug="true"&gt;
  &lt;appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender"&gt;
    &lt;encoder&gt;
      &lt;pattern&gt;%d{HH:mm:ss.SSS} [%thread] %-5level %logger - %msg%n&lt;/pattern&gt;
    &lt;/encoder&gt;
  &lt;/appender&gt;
  
  &lt;root level="DEBUG"&gt;
    &lt;appender-ref ref="CONSOLE" /&gt;
  &lt;/root&gt;

  &lt;server class="ch.qos.logback.classic.net.server.SSLServerSocketReceiver"&gt;
    &lt;ssl&gt;
      &lt;keyStore&gt;
        &lt;location&gt;classpath:server.keystore&lt;/location&gt;
        &lt;password&gt;${server.keystore.password}&lt;/password&gt;
      &lt;/keyStore&gt;
    &lt;/ssl&gt;
  &lt;/server&gt;
&lt;/configuration&gt;</pre>
      
      <p>ではの例では，キーストアがアプリプーションのクラスパスのルートに配置されていることを可以としています。</p>
      
      <p>ドには，キーストアのパスワードには<em>server.keystore.password</em>という変数を指定しています。，どの设定ファイルにもパスワードを书いておかなくてもよくなります。たとえば，アプリケーションショ启动した后，ロギングシステムを设定する前にコンソールでパスワード入力を促すプロンプトプ出すようにして，システムプロパティ<em>server.keystore.password</em>をプログラムム的に设定すればよいのです。
      </p>
      
      <h4>クライアントコンポーネントの设定</h4>
      <p>クライアントとして振る舞うSSL対応のコンポーネントを使用するアプリケーションショいて， <em>server.truststore</em>をアプリケーションアカカイブの内部に取り込まなければならないかもしれません。，设定ファイルからトラストストアの场所を指定するときは， <code>classpath:</code>から始まるURLか， <code>file:</code>から始まるURLのいずれかを指定します。アペンダーの设定を见てみましょう。</p>

      <p class="example">例：アペンダーの设定</p>

      <pre class="prettyprint source">&lt;configuration debug="true"&gt;
  &lt;appender name="SOCKET" class="ch.qos.logback.classic.net.SSLSocketAppender"&gt;
    &lt;remoteHost&gt;${host}&lt;/remoteHost&gt;
    &lt;ssl&gt;
      &lt;trustStore&gt;
        &lt;location&gt;classpath:server.truststore&lt;/location&gt;
        &lt;password&gt;${server.truststore.password}&lt;/password&gt;
      &lt;/trustStore&gt;
    &lt;/ssl&gt;
  &lt;/appender&gt;

  &lt;root level="DEBUG"&gt;
    &lt;appender-ref ref="SOCKET" /&gt;
  &lt;/root&gt;
&lt;/configuration&gt;</pre>

      <p>ではの例では，トラストストアがアプリケーションのクラスパスのルートに配置されていることを替换としています。</p>
      
      <p>ドには，トラストストアのパスワードには<em>server.truststore.password</em>という変数を指定しています。，どの设定ファイルにもパスワードを书いておかなくてもよくなります。たとえば，アプリケーションショ启动した后，ロギングシステムを设定する前にコンソールでパスワード入力を促すプロンプトプ出すようにして，システムプロパティ<em>server.truststore.password</em>をプログラムム的に设定すればよいのです。

      </p>

      <h2>SSLの设定を监查する</h2>
      <p>安全な通信が必要とされる环境では，SSLを使うコンポーネントがローカルルリセキュリシーシいることを検证するため，设定内容を监查しなければならない。logbackでは，自身を初期化している间に行われるSSLの设定について详细なロギング情报を提供することでこれに対応しています。设定中で<code>debug</code>プロパティを使うことで，监查ログを有效化することができます。</p>
      
      <pre class="prettyprint source">&lt;configuration debug="true"&gt;
  
  ...
  
&lt;/configuration&gt;</pre>

      <p>debugプロパティを有效にすると，ロギングシステムの初期化中に行われるSSLの设定に关するあらゆる情报が得られるようになります。SSL设定の监查罗罗として出力されるのは次のようなものです。</p>
      
      <p class="example">例：SSL设定の监查ログ</p>
      
      <pre>06:46:31,941 |-INFO in SSLServerSocketReceiver@4ef18d37 - SSL protocol 'SSL' provider 'SunJSSE version 1.6'
06:46:31,967 |-INFO in SSLServerSocketReceiver@4ef18d37 - key store of type 'JKS' provider 'SUN version 1.6': file:src/main/java/chapters/appenders/socket/ssl/keystore.jks
06:46:31,967 |-INFO in SSLServerSocketReceiver@4ef18d37 - key manager algorithm 'SunX509' provider 'SunJSSE version 1.6'
06:46:31,973 |-INFO in SSLServerSocketReceiver@4ef18d37 - secure random algorithm 'SHA1PRNG' provider 'SUN version 1.6'
06:46:32,755 |-INFO in SSLParametersConfiguration@4a6f19d5 - enabled protocol: SSLv2Hello
06:46:32,755 |-INFO in SSLParametersConfiguration@4a6f19d5 - enabled protocol: SSLv3
06:46:32,755 |-INFO in SSLParametersConfiguration@4a6f19d5 - enabled protocol: TLSv1
06:46:32,756 |-INFO in SSLParametersConfiguration@4a6f19d5 - enabled cipher suite: SSL_RSA_WITH_RC4_128_MD5
06:46:32,756 |-INFO in SSLParametersConfiguration@4a6f19d5 - enabled cipher suite: SSL_RSA_WITH_RC4_128_SHA
06:46:32,756 |-INFO in SSLParametersConfiguration@4a6f19d5 - enabled cipher suite: TLS_RSA_WITH_AES_256_CBC_SHA
</pre>

      <p>ここで示した出力は显着にカットしてありますが，一般的には次のようなものが含まれています。
          </p><ul>
            <li>完全なプロトコルのリスト</li>
            <li>プロバイダー</li>
            <li>アルゴリズム</li>
            <li>暗号スイート</li>
            <li>キーストアやトラストストアの场所</li>
          </ul>
      <p></p>
      
      <p>监の监查罗罗が取まれるこいに注意の必要な情报が含まれることはありませんが，セキュリティの本ストプラクティスとしては，本番环境の设定の妥当性が确认されたなら，监查罗グは无效化するべきです。<code>debug</code>プロパティを消すか， <code>false</code>を指定すれば监查ログは无效化されます。
      </p>
      
      <h2>SSLの设定误りを解决する</h2>
      <p>SSLの设定が间违法っていると，普通ならクライアントとサーバーのコンポーネントの间でセッションを可以できなくなります。に，クライアントがサーバーに接続しようとしてそれができなかったときにそれぞれで例外をスローすることによって明らかになります。
      </p>
      <p>例外メッセージの内容は，见ているログによって异なります。それは，セッションネゴシエーション中に报告されるエラーの原因は，主にプロトコルの制限によるものだからです。したがって，セッションネゴシエーションの问题を解决するには，クライアントとサーバーの両方のログを调查しなければなりません。
      </p>
      
      <h3>サーバの证明书が使用できません</h3>
      <p>证明ーバーの证明书が使用できない时，サーバコンポーネントを起动すると次のような例外メッセージがログに出力されます。</p>
         
      <p><em>javax.net.ssl。SSLException：没有可用的证书或密钥与启用的SSL密码套件相对应</em>
      </p>
      
      <p>ほとんどの场合，サーバーの秘密键に対応する证明书を含むキーストアの场所を设定し忘れていることが原因です。
      </p>
      
      <h4>ソリューション</h4>
      <p>システムプロパティの<a href="./15-usingSSL.html#basicConfig.keyStore">キーストア</a>か，サーバーコンポーネントの<span class="prop">ssl</span>の设定で<span class="prop"><a href="./15-usingSSL.html#ssl.keyStore">keyStore</a></span>プロパティに，サーバ证明书を含むキーストアの场所を指定してください。あと，キーストアのパスワードも指定してください。
      </p>
      
      <h3>クライアントはサーバーを信頼できません</h3>
      <p>クライアントがサーバに接続しようとするとき，次のような例外メッセージがログに现れます。</p>
      
      <p><em>javax.net.ssl。SSLHandshakeException：sun.security.validator。ValidatorException：PKIX路径构建失败</em>
      </p>
      <p>した，クライアントがサーバーの提示した证明书を信頼できないと判断した场合に発生します。よくある原因としては，サーバーが本署名サーバー证明书（をいは内部の认证局で署名したサーバー证明书）を使っている上で，クライアントの使用するトラストストアにサーのーの本署名证明书が含まれていない（あるいはサーバー证明书に署名したCAの信頼できるルート证明书が含まれていない）ことです。
      </p> 
      <p>证明ーバー证明书が无效している场合も同じような现象が発生します。侧ーバー侧のログを见ることが出来るなら，クライアントが接続しようとするたびに次のような例外メッセージが现れているのがわかると思います。</p>
      
      <p><em>javax.net.ssl。SSLHandshakeException：收到致命警报：...</em>
      </p>
      
      <p>例外メッセージの后半部分には，クライアントがサーバー证明书を拒否した理由を表すコードが现れます。
      </p>
      <table class="bodyTable striped">
        <tbody><tr>
          <th>コー</th>
          <th>说明</th>
        </tr>
        <tr>
          <td><code>certificate_unknown</code></td>
          <td>クライアントのトラストストアが正しく设定されていないことを示しています。
          </td>
        </tr>
        <tr>
          <td><code>certificate_expired</code></td>
          <td>サーバー证明书が无效しているので更新が必要なことを示しています。
          </td>
        </tr>
        <tr>
          <td><code>certificate_revoked</code></td>
          <td>サーバー证明书に署名した认证局（CA）が，そのサーバー证明书を无效にしたことを示しています。サーバー证明书を更新しなければなりません。
          </td>
        </tr>
      </tbody></table>
        
      <h4>ソリューション</h4>
      <p>侧ーバー侧のログに<code>certificate_unknown</code>が现れているときは，システムプロパティ<a href="./15-usingSSL.html#basicConfig.trustStore">トラストストア</a>か，アペンダーの<span class="prop">ssl</span>设定に<a href="./15-usingSSL.html#ssl.trustStore">trustStore</a>プロパティを指定パティをい。自己ーバーの自己署名证明书か，证明书に署名したCAのルート证明书を格纳した<span class="prop">トラストストア</span>の场所と，アクセスするためのパスワードを指定しなければなりません。
      </p>

      <p>侧ーバー侧のログに<code>certificate_expired</code>か<code>certificate_revoked</code>が现れているときは，新しいサーバー证明书が必要です。でーバーの设定で指定したキーストアの场所に，新しいサーバー证明书と対応する秘密键を配置してください。自己的机构名サーバー证明书を使っているときは，クライアントのアペンダーの设定に指定されているトラストストアにも新しい证明书を配置しなければなりません。
      </p>
      
      <h3>をーバーはクライアントを信頼できません</h3>
      <p>注： <strong>この问题が生じるのは，サーバーがクライアント证明书を要求するように明示的に设定している场合だけです（ <a href="./15-usingSSL.html#parameters.needClientAuth"><span class="prop">needClientAuth</span></a>か<a href="./15-usingSSL.html#parameters.wantClientAuth"><span class="prop">wantClientAuth</span></a>プロパティを指定したときです）。</strong>
      </p>
 
      <p>クライアントがサーバに接続しようとするとき，次のような例外メッセージがログに现れます。
</p>
      
      <p><em>javax.net.ssl。SSLHandshakeException：收到致命警报：...</em>
      </p>

      <p>例外メッセージの后半部分には，サーバーがクライアントの证明书を拒否した理由を表すコードが现れます。

      </p>
      <table class="bodyTable striped">
        <tbody><tr>
          <th>コー</th>
          <th>说明</th>
        </tr>
        <tr>
          <td><code>certificate_unknown</code></td>
          <td>ーバのトラストストアが正しく设定されていないことを示しています。
          </td>
        </tr>
        <tr>
          <td><code>certificate_expired</code></td>
          <td>クライアントの证明书が不能しているので更新が必要なことを示しています。

          </td>
        </tr>
        <tr>
          <td><code>certificate_revoked</code></td>
          <td>クライアントの证明书に署名した认证局（CA）が，その证明书を无效にしたことを示しています。证明书を更新しなければなりません。

          </td>
        </tr>
      </tbody></table>
        
      <h4>ソリューション</h4>
      <p>クライアント侧のログに<code>bad_certificate</code>が现れているときは，システムプロパティ<a href="./15-usingSSL.html#basicConfig.trustStore">トラストストアト</a>ーバーコンコーネントントの<span class="prop">ssl</span>设定の<span class="prop"><a href="./15-usingSSL.html#ssl.trustStore">trustStore</a></span>プロパティに，トラストストアの场所とパスワードを指定しなければなりません。トラストストアにはクライアントの自己署名证明书か，证明书に署名したCAのルート证明书が含まれていなければなりません。
      </p>

      <p>侧ーバー侧のログに<code>certifacte_expired</code>あるいは<code>certificate_revoked</code>が现れているときは，新しい证明书が必要です。クライアントの设定で指定したキーストアの场所に，新しい证明书と対応する秘密键を配置してください。自己署名证明书を使っているときは，サーバーの设定に指定されているトラストストアにも新しい证明书を配置しなければなりません。

      </p>
      
      <h3>クライアントとサーバー间でSSLプロトコルを合意できません</h3>
      <p>注： <strong>この问题が生じるのは，明示的にSSLプロトコルを<a href="./15-usingSSL.html#parameters.excludedProtocols">除外</a>したり<a href="./15-usingSSL.html#parameters.includedProtocols">指定</a>している场合だけです</strong> 。
      </p>

      <p>クライアントがサーバに接続しようとするとき，次のような例外メッセージがログに现れます。</p>
      
      <p><em>javax.net.ssl。SSLHandshakeException：收到致命警报：handshake_failure</em>
      </p>
      
      <p>グにーバーのログに现れるメッセージのほうがわかりやすいです。</p>
      
      <p><em>javax.net.ssl。SSLHandshakeException：SSLv2Hello已禁用</em>
      </p>
      
      <p>一方のピアで除外したプロトコルが，もう一方のピアでは除外されていない场合に発生します。</p>
         
      <h4>ソリューション</h4>
      <p><a href="./15-usingSSL.html#parameters.excludedProtocols"><span class="prop">excluded</span></a>ーバーとクライアントの両方で，已<a href="./15-usingSSL.html#parameters.excludedProtocols"><span class="prop">排除的协议</span></a>と已<a href="./15-usingSSL.html#parameters.includedProtocols"><span class="prop">包含的协议</span></a>に指定した値を确认してください。
      </p>

      <h3>クライアントとサーバー间で暗号スイートを合意できません</h3>
      <p>注： <strong>この问题が生じるのは，明示的に暗号スイートを<a href="./15-usingSSL.html#parameters.excludedCipherSuites">除外</a>したり<a href="./15-usingSSL.html#parameters.includedCipherSuites">指定</a>している场合だけです</strong> 。
      </p>
      
      <p>クライアントがサーバに接続しようとするとき，次のような例外メッセージがログに现れます。
</p>
      
      <p><em>javax.net.ssl。SSLHandshakeException：收到致命警报：handshake_failure</em>
      </p>
      
      <p>グにーバーのログに现れるメッセージのほうがわかりやすいです。
</p>
      
      <p><em>javax.net.ssl。SSLHandshakeException：没有通用的密码套件</em>
      </p>
      
      <p>クライアントとサーバーそれぞれの暗号スイート一覧について，1つも一致するものが无い场合に発生します。</p>
      
      <h4>ソリューション</h4>
      <p>でーバーとクライアントの両方で，已<a href="./15-usingSSL.html#parameters.excludedCipherSuites"><span class="prop">排除的</span></a> CipherSuites和已<a href="./15-usingSSL.html#parameters.includedCipherSuites"><span class="prop">包含的</span></a> CipherSuitesに指定した値を确认してください。

      </p>
         
    <script src="../templates/footer.js" type="text/javascript"></script>

    <p></p><p></p></div>
  
</body></html>