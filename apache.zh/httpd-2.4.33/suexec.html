<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>suEXEC支持-Apache HTTP Server版本2.4</title>
<link href="./style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="./style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="./style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="./style/css/prettify.css">
<script src="./style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body id="manual-page" ><div id="page-header">
<p class="menu"><a href="./mod/index.html">模块</a> | <a href="./mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="./glossary.html">词汇表</a> | <a href="./sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="./images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="<-" alt="<-" src="./images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> > <a href="http://httpd.apache.org/">HTTP Server</a> > <a href="http://httpd.apache.org/docs/">文档</a> > <a href="./index.html">版本2.4</a></div><div id="page-content"><div id="preamble"><h1>suEXEC支持</h1>


    <p><strong>suEXEC</strong>功能使Apache HTTP Server的用户能够以与调用Web服务器的用户ID不同的用户ID运行<strong>CGI</strong>和<strong>SSI</strong>程序。通常，当执行CGI或SSI程序时，它以与运行Web服务器相同的用户身份运行。</p>

    <p>正确使用此功能可以大大降低允许用户开发和运行私有CGI或SSI程序所涉及的安全风险。但是，如果suEXEC配置不正确，则可能导致许多问题，并可能在计算机的安全性中造成新的漏洞。如果您不熟悉管理<em>setuid根</em>程序及其所带来的安全性问题，我们强烈建议您不要考虑使用suEXEC。</p>
  </div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><ul id="toc"><li><img alt="" src="./images/down.gif"> <a href="#before">开始之前</a></li>
<li><img alt="" src="./images/down.gif"> <a href="#model">suEXEC安全模型</a></li>
<li><img alt="" src="./images/down.gif"> <a href="#install">配置和安装suEXEC</a></li>
<li><img alt="" src="./images/down.gif"> <a href="#enable">启用和禁用suEXEC</a></li>
<li><img alt="" src="./images/down.gif"> <a href="#usage">使用suEXEC</a></li>
<li><img alt="" src="./images/down.gif"> <a href="#debug">调试suEXEC</a></li>
<li><img alt="" src="./images/down.gif"> <a href="#jabberwock">当心Jabberwock：警告和示例</a></li>
</ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="before" id="before">开始之前</a></h2>

    <p>在直接进入本文档之前，您应该了解有关您和使用suexec的环境的某些假设。</p>

    <p>首先，假设您使用的是UNIX派生操作系统，该操作系统能够执行<strong>setuid</strong>和<strong>setgid</strong>操作。在这方面给出了所有命令示例。如果其他平台能够支持suEXEC，则它们的配置可能会有所不同。</p>

    <p>其次，假定您熟悉计算机安全性及其管理的一些基本概念。这涉及到对<strong>setuid / setgid</strong>操作及其对系统及其安全级别的各种影响的理解。</p>

    <p>第三，假定您使用的是suEXEC代码的<strong>未修改</strong>版本。suEXEC的所有代码都经过开发人员和众多Beta测试人员的仔细审查和测试。已采取一切预防措施来确保简单而稳固的代码基础。更改此代码可能会导致意外问题和新的安全风险。<strong>强烈</strong>建议您不要更改suEXEC代码，除非您精通安全性编程的细节，并愿意与Apache HTTP Server开发团队共享您的工作以供考虑。</p>

    <p>第四点也是最后一点，Apache HTTP Server开发团队决定<strong>不</strong>将suEXEC包含在Apache httpd的默认安装中。为此，suEXEC配置需要管理员仔细注意细节。在适当考虑了suEXEC的各种设置之后，管理员可以通过常规安装方法安装suEXEC。这些设置的值需要由管理员仔细确定和指定，以便在使用suEXEC功能期间正确维护系统安全性。通过此详细过程，我们希望将suEXEC安装仅限制于那些认真且有足够决心使用它的用户。</p>

    <p>还和我们在一起吗？是？好。让我们继续前进！</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="model" id="model">suEXEC安全模型</a></h2>

    <p>在开始配置和安装suEXEC之前，我们将首先讨论您将要实现的安全模型。这样，您可能会更好地了解suEXEC内部到底发生了什么，以及采取了哪些预防措施来确保系统的安全性。</p>

    <p><strong>suEXEC</strong>基于主Apache HTTP Server调用的setuid“包装程序”。当对CGI或SSI程序发出HTTP请求时，将调用此包装器，管理员已指定该CGI或SSI程序以除主服务器以外的用户ID身份运行。发出此类请求时，Apache httpd为suEXEC包装器提供程序的名称以及要在其下执行程序的用户和组ID。</p>

    <p>然后，包装程序采用以下过程确定成功或失败-如果这些条件中的任何一个失败，程序将记录失败并退出并显示错误，否则它将继续：</p>

    <ol>
      <li>
        <strong>执行此包装程序的用户是否是该系统的有效用户？</strong>

        <p class="indent">这是为了确保执行包装程序的用户确实是系统的用户。
        </p>
     </li>

     <li>
        <strong>是否使用适当数量的参数调用包装器？</strong>

        <p class="indent">只有给定适当数量的参数，包装器才会执行。正确的参数格式是Apache HTTP Server已知的。如果包装未收到适当数量的参数，则说明它已被黑客入侵，或者Apache httpd二进制文件的suEXEC部分出了问题。
        </p>
      </li>

      <li>
        <strong>是否允许此有效用户运行包装器？</strong>

        <p class="indent">该用户是否可以运行该包装程序？仅允许一个用户（Apache用户）执行此程序。
        </p>
      </li>

      <li>
        <strong>目标CGI或SSI程序是否具有不安全的层次结构引用？</strong>

        <p class="indent">目标CGI或SSI程序的路径是否包含前导“ /”或具有“ ..”反向引用？这些是不允许的；目标CGI / SSI程序必须位于suEXEC的文档根目录下（请参阅<code>--with-suexec-docroot=<em>DIR</em></code>下面）。
        </p>
      </li>

      <li>
        <strong>目标用户名有效吗？</strong>

        <p class="indent">目标用户是否存在？
        </p>
      </li>

      <li>
        <strong>目标组名称有效吗？</strong>

        <p class="indent">目标人群是否存在？
        </p>
      </li>

      <li>
        <strong>目标用户<em>不是</em>超级用户吗？</strong>


        <p class="indent">suEXEC不允许<code><em>root</em></code>执行CGI / SSI程序。
        </p>
      </li>

      <li>
        <strong>目标用户ID是否在最小ID编号<em>之上</em> ？</strong>

        <p class="indent">最小用户ID号是在配置期间指定的。这使您可以设置允许执行CGI / SSI程序的最低用户ID。这对于阻止“系统”帐户很有用。
        </p>
      </li>

      <li>
        <strong>目标组<em>不是</em>超级用户组吗？</strong>

        <p class="indent">目前，suEXEC不允许<code><em>root</em></code>组来执行CGI / SSI程序。
        </p>
      </li>

      <li>
        <strong>是目标组的groupid <em>高于</em>最小ID值吗？</strong>

        <p class="indent">最小组ID号是在配置期间指定的。这使您可以设置允许执行CGI / SSI程序的最低组ID。这对于阻止“系统”组很有用。
        </p>
      </li>

      <li>
        <strong>包装程序能否成功成为目标用户和组？</strong>

        <p class="indent">该程序通过setuid和setgid调用成为目标用户和组。组访问列表也使用用户所属的所有组进行初始化。
        </p>
      </li>

      <li>
        <strong>我们可以将目录更改为目标CGI / SSI程序所在的目录吗？</strong>

        <p class="indent">如果不存在，则不能很好地包含文件。如果我们无法将目录更改为该目录，则该目录也可能不存在。
        </p>
      </li>

      <li>
        <strong>该目录位于httpd网站空间内吗？</strong>

        <p class="indent">如果请求是针对服务器的常规部分，则请求的目录是否位于suEXEC的文档根目录下？如果要求是<code class="directive"><a href="./mod/mod_userdir.html#userdir">UserDir</a></code> ，目录中的请求目录是否配置为suEXEC的userdir（请参见<a href="#install">suEXEC的配置选项</a> ）？
        </p>
      </li>

      <li>
        <strong>该目录<em>不能</em>被其他任何人写入吗？</strong>

        <p class="indent">我们不想向其他人打开目录；只有所有者用户才可以更改此目录的内容。
        </p>
      </li>

      <li>
        <strong>目标CGI / SSI程序是否存在？</strong>

        <p class="indent">如果不存在，则无法很好地执行它。
        </p>
      </li>

      <li>
        <strong>目标CGI / SSI程序是否<em>不能</em>被其他任何人编写？</strong>

        <p class="indent">我们不希望所有者以外的任何人拥有更改CGI / SSI程序的能力。
        </p>
      </li>

      <li>
        <strong>目标CGI / SSI程序<em>不是</em> setuid还是setgid？</strong>

        <p class="indent">我们不想执行会再次更改UID / GID的程序。
        </p>
      </li>

      <li>
        <strong>目标用户/组与程序的用户/组相同吗？</strong>

        <p class="indent">用户是文件的所有者吗？
        </p>
      </li>

      <li>
        <strong>我们能否成功清洁工艺环境以确保安全运行？</strong>

        <p class="indent">suEXEC通过建立安全的执行PATH（在配置过程中定义）以及仅传递名称在安全环境列表中列出的变量（也在配置过程中创建）来清理进程的环境。
        </p>
      </li>

      <li>
        <strong>我们能否成功成为目标CGI / SSI程序并执行？</strong>

        <p class="indent">这是suEXEC结束且目标CGI / SSI程序开始的地方。
        </p>
      </li>
    </ol>

    <p>这是suEXEC包装程序的安全模型的标准操作。它有些严格，并且可能对CGI / SSI设计施加新的限制和准则，但是在考虑安全性的基础上逐步进行了精心开发。</p>

    <p>有关此安全模型如何限制您在服务器配置方面的可能性的更多信息，以及通过正确的suEXEC设置可以避免哪些安全风险，请参阅本文档的<a href="#jabberwock">“当心Jabberwock”</a>部分。</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="install" id="install">配置和安装suEXEC</a></h2>

    <p>这是我们开始乐趣的地方。</p>

    <p><strong>suEXEC配置选项</strong><br>
    </p>

    <dl>
      <dt><code>--enable-suexec</code></dt>

      <dd>此选项启用suEXEC功能，该功能默认情况下从不安装或激活。最后一个<code>--with-suexec-xxxxx</code>选项必须与<code>--enable-suexec</code>选项以使APACI接受您使用suEXEC功能的请求。</dd>

      <dt><code>--with-suexec-bin=<em>PATH</em></code></dt>

      <dd>通往的道路<code>suexec</code>出于安全原因，二进制文件必须在服务器中进行硬编码。使用此选项可以覆盖默认路径。 <em>例如</em>
      <code>--with-suexec-bin=/usr/sbin/suexec</code></dd>

      <dt><code>--with-suexec-caller=<em>UID</em></code></dt>

      <dd>httpd正常运行时使用的<a href="mod/mpm_common.html#user">用户名</a> 。这是唯一被允许执行suEXEC包装程序的用户。</dd>

      <dt><code>--with-suexec-userdir=<em>DIR</em></code></dt>

      <dd>定义为应允许suEXEC访问的用户主目录下的子目录。suEXEC将以用户身份执行此目录下的所有可执行文件，因此它们应为“安全”程序。如果您使用的是“简单” <code class="directive"><a href="./mod/mod_userdir.html#userdir">UserDir</a></code>指令（即其中没有“ *”的指令）应设置为相同的值。在以下情况下，suEXEC将无法正常工作： <code class="directive"><a href="./mod/mod_userdir.html#userdir">UserDir</a></code>指令指向的位置与用户主目录中所引用的位置不同<code>passwd</code>文件。默认值为“ <code>public_html</code> ”。<br>如果您的虚拟主机具有不同的<code class="directive"><a href="./mod/mod_userdir.html#userdir">UserDir</a></code>对于每一个，您将需要将它们定义为全部驻留在一个父目录中；然后在此处命名该父目录。<strong>如果未正确定义，则“〜userdir” cgi请求将不起作用！</strong></dd>

      <dt><code>--with-suexec-docroot=<em>DIR</em></code></dt>

      <dd>定义为httpd的DocumentRoot集。这将是唯一的层次结构（除了<code class="directive"><a href="./mod/mod_userdir.html#userdir">UserDir</a></code> s）可用于suEXEC行为。默认目录是<code>--datadir</code>后缀为“ <code>/htdocs</code> “， <em>例如，</em>如果您配置为“ <code>--datadir=/home/apache</code> “目录” <code>/home/apache/htdocs</code> ”用作suEXEC包装程序的文档根目录。</dd>

      <dt><code>--with-suexec-uidmin=<em>UID</em></code></dt>

      <dd>将此定义为suEXEC的目标用户所允许的最低UID。对于大多数系统，500或100很常见。预设值为100。</dd>

      <dt><code>--with-suexec-gidmin=<em>GID</em></code></dt>

      <dd>将其定义为允许作为suEXEC目标组的最低GID。对于大多数系统，100是通用值，因此用作默认值。</dd>

      <dt><code>--with-suexec-logfile=<em>FILE</em></code></dt>

      <dd>这定义了所有suEXEC事务和错误记录到的文件名（用于审计和调试目的）。默认情况下，日志文件名为“ <code>suexec_log</code> ”，并位于您的标准日志文件目录中（ <code>--logfiledir</code> ）。</dd>

      <dt><code>--with-suexec-safepath=<em>PATH</em></code></dt>

      <dd>定义一个安全的PATH环境以传递给CGI可执行文件。默认值为“ <code>/usr/local/bin:/usr/bin:/bin</code> ”。</dd>
    </dl>

    <h3>编译和安装suEXEC包装器</h3>
      

      <p>如果您启用了suEXEC功能， <code>--enable-suexec</code>选择<code>suexec</code>如果执行以下命令，则会自动构建二进制文件（连同httpd本身） <code>make</code>命令。</p>

      <p>构建完所有组件后，您可以执行命令<code>make install</code>安装它们。二进制图像<code>suexec</code>安装在由<code>--sbindir</code>选项。默认位置是“ / usr / local / apache2 / bin / suexec”。</p>

      <p>请注意，安装步骤需要<strong><em>root特权</em></strong> 。为了让包装器设置用户ID，必须将其安装为所有者<code><em>root</em></code>并且必须为文件模式设置setuserid执行位。</p>
    

    <h3>设置偏执权限</h3>
      

      <p>尽管suEXEC包装程序将检查以确保其调用方是正确的用户，如使用<code>--with-suexec-caller</code><code class="program"><a href="./programs/configure.html">configure</a></code>选项，在此检查之前，suEXEC使用的系统或库调用总是有可能被系统利用。为了解决这个问题，并且由于通常是最佳实践，因此您应该使用文件系统权限来确保只有组httpd运行时才可以执行suEXEC。</p>

      <p>例如，如果您的Web服务器配置为以以下方式运行：</p>

      <pre class="prettyprint lang-config">User www
Group webgroup</pre>


      <p>和<code class="program"><a href="./programs/suexec.html">suexec</a></code>安装在“ / usr / local / apache2 / bin / suexec”中，则应运行：</p>

      <div class="example"><p><code>chgrp webgroup /usr/local/apache2/bin/suexec<br> chmod 4750 /usr/local/apache2/bin/suexec<br></code></p></div>

      <p>这将确保只有组httpd可以运行，甚至可以执行suEXEC包装程序。</p>
    
</div><div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="enable" id="enable">启用和禁用suEXEC</a></h2>

    <p>启动httpd时，它将查找文件<code class="program"><a href="./programs/suexec.html">suexec</a></code>在由<code>--sbindir</code>选项（默认值为“ / usr / local / apache / sbin / suexec”）。如果httpd找到正确配置的suEXEC包装程序，它将在错误日志中显示以下消息：</p>

<div class="example"><p><code>[notice] suEXEC mechanism enabled (wrapper: <var>/path/to/suexec</var>)</code></p></div>

    <p>如果在服务器启动时未看到此消息，则服务器很可能找不到它期望的包装程序，或者未安装可执行文件<em>setuid root</em> 。</p>

     <p>如果要首次启用suEXEC机制，并且Apache HTTP Server已经在运行，则必须终止并重新启动httpd。仅用简单的HUP或USR1信号重新启动它是不够的。</p>
     <p>如果要禁用suEXEC，则应删除并删除httpEXE，然后重新启动。 <code class="program"><a href="./programs/suexec.html">suexec</a></code>文件。</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="usage" id="usage">使用suEXEC</a></h2>

    <p>对CGI程序的请求仅在包含以下内容的虚拟主机时才调用suEXEC包装器： <code class="directive"><a href="./mod/mod_suexec.html#suexecusergroup">SuexecUserGroup</a></code>指令或是否由它们处理<code class="module"><a href="./mod/mod_userdir.html">mod_userdir</a></code> 。</p>

    <p><strong>虚拟主机：</strong><br>使用suEXEC包装的一种方法是通过<code class="directive"><a href="./mod/mod_suexec.html#suexecusergroup">SuexecUserGroup</a></code>指令中<code class="directive"><a href="./mod/core.html#virtualhost">VirtualHost</a></code>定义。通过将此指令设置为不同于主服务器用户ID的值，对CGI资源的所有请求将作为为该<em>用户</em>定义的<em>用户</em>和<em>组</em>执行。 <code class="directive"><a href="./mod/core.html#virtualhost"><VirtualHost></a></code> 。如果未为<code class="directive"><a href="./mod/core.html#virtualhost"><VirtualHost></a></code>然后假定主服务器用户标识。</p>

    <p><strong>用户目录：</strong><br>由处理的请求<code class="module"><a href="./mod/mod_userdir.html">mod_userdir</a></code>将调用suEXEC包装程序以在请求的用户目录的用户标识下执行CGI程序。要使该功能起作用，唯一的要求是为用户启用CGI执行，并且脚本必须满足上述<a href="#model">安全检查</a>的审查要求。另请参阅<code>--with-suexec-userdir</code> <a href="#install">编译时间选项</a> 。</p> </div><div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="debug" id="debug">调试suEXEC</a></h2>

    <p>suEXEC包装器会将日志信息写入到使用<code>--with-suexec-logfile</code>如上所述的选项。如果您感觉已正确配置并安装了包装器，请查看此日志和服务器的error_log，以了解您可能误入了何处。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="jabberwock" id="jabberwock">当心Jabberwock：警告和示例</a></h2>

    <p><strong>注意！</strong> 本部分可能不完整。有关文档本部分的最新版本，请参见<a href="http://httpd.apache.org/docs/2.4/suexec.html">联机文档</a>版本。</p>

    <p>关于包装器，有一些有趣的问题，这些问题可能会导致服务器设置受到限制。在提交有关suEXEC的任何“错误”之前，请仔细阅读这些内容。</p>

    <ul>
      <li><strong>suEXEC兴趣点</strong></li>

      <li>层次结构限制<p class="indent">出于安全和效率方面的考虑，所有suEXEC请求必须保留在用于虚拟主机请求的顶级文档根目录中，或者对于userdir请求保留在一个顶级个人文档根目录中。例如，如果配置了四个VirtualHost，则需要从一个主要的httpd文档层次结构中构造所有VHost的文档根目录，以利用suEXEC for VirtualHosts的优势。（示例即将发布。）
        </p>
      </li>

      <li>suEXEC的PATH环境变量<p class="indent">这可能是一件危险的事情。确保您在此定义中包括的每个路径都是<strong>受信任的</strong>目录。您不想让人们放开世界各地的人在上面运行特洛伊木马。
        </p>
      </li>

      <li>更改suEXEC代码<p class="indent">同样，如果您在不知道自己在做什么的情况下尝试这样做，可能会导致<strong>大麻烦</strong> 。尽可能远离它。
        </p>
      </li>
    </ul>

</div></div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="./mod/index.html">模块</a> | <a href="./mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="./glossary.html">词汇表</a> | <a href="./sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>

</body></html>