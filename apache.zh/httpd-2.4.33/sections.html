<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>配置部分-Apache HTTP Server版本2.4</title>
<link href="./style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="./style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="./style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="./style/css/prettify.css">
<script src="./style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body id="manual-page" ><div id="page-header">
<p class="menu"><a href="./mod/index.html">模块</a> | <a href="./mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="./glossary.html">词汇表</a> | <a href="./sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="./images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="<-" alt="<-" src="./images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> > <a href="http://httpd.apache.org/">HTTP Server</a> > <a href="http://httpd.apache.org/docs/">文档</a> > <a href="./index.html">版本2.4</a></div><div id="page-content"><div id="preamble"><h1>配置部分</h1>

 <p><a href="configuring.html">配置文件</a>中的指令可以应用于整个服务器，也可以被限制为仅应用于特定的目录，文件，主机或URL。本文档介绍了如何使用配置节容器或<code>.htaccess</code>文件以更改其他配置指令的范围。</p>
</div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><ul id="toc"><li><img alt="" src="./images/down.gif"> <a href="#types">配置节容器的类型</a></li>
<li><img alt="" src="./images/down.gif"> <a href="#file-and-web">文件系统，Webspace和布尔表达式</a></li>
<li><img alt="" src="./images/down.gif"> <a href="#virtualhost">虚拟主机</a></li>
<li><img alt="" src="./images/down.gif"> <a href="#proxy">代理</a></li>
<li><img alt="" src="./images/down.gif"> <a href="#whatwhere">允许哪些指令？</a></li>
<li><img alt="" src="./images/down.gif"> <a href="#merging">这些部分如何合并</a></li>
</ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="types" id="types">配置节容器的类型</a></h2>

<table class="related"><tbody><tr><th>相关模块</th><th>相关指令</th></tr><tr><td><ul><li><code class="module"><a href="./mod/core.html">core</a></code></li><li><code class="module"><a href="./mod/mod_version.html">mod_version</a></code></li><li><code class="module"><a href="./mod/mod_proxy.html">mod_proxy</a></code></li></ul></td><td><ul><li><code class="directive"><a href="./mod/core.html#directory"><Directory></a></code></li><li><code class="directive"><a href="./mod/core.html#directorymatch"><DirectoryMatch></a></code></li><li><code class="directive"><a href="./mod/core.html#files"><Files></a></code></li><li><code class="directive"><a href="./mod/core.html#filesmatch"><FilesMatch></a></code></li><li><code class="directive"><a href="./mod/core.html#if"><If></a></code></li><li><code class="directive"><a href="./mod/core.html#ifdefine"><IfDefine></a></code></li><li><code class="directive"><a href="./mod/core.html#ifmodule"><IfModule></a></code></li><li><code class="directive"><a href="./mod/mod_version.html#ifversion"><IfVersion></a></code></li><li><code class="directive"><a href="./mod/core.html#location"><Location></a></code></li><li><code class="directive"><a href="./mod/core.html#locationmatch"><LocationMatch></a></code></li><li><code class="directive"><a href="./mod/mod_md.html#mdomainsetsection"><MDomainSet></a></code></li><li><code class="directive"><a href="./mod/mod_proxy.html#proxy"><Proxy></a></code></li><li><code class="directive"><a href="./mod/mod_proxy.html#proxymatch"><ProxyMatch></a></code></li><li><code class="directive"><a href="./mod/core.html#virtualhost"><VirtualHost></a></code></li></ul></td></tr></tbody></table>

<p>容器有两种基本类型。每个请求都会评估大多数容器。随附的指令仅适用于与容器匹配的那些请求。的<code class="directive"><a href="./mod/core.html#ifdefine"><IfDefine></a></code> ， <code class="directive"><a href="./mod/core.html#ifmodule"><IfModule></a></code>和<code class="directive"><a href="./mod/mod_version.html#ifversion"><IfVersion></a></code>另一方面，仅在服务器启动和重新启动时评估容器。如果启动时它们的条件为真，则随附的指令将适用于所有请求。如果条件不成立，将忽略附带的指令。</p>

<p>的<code class="directive"><a href="./mod/core.html#ifdefine"><IfDefine></a></code>指令包含仅在以下情况下适用的指令： <code class="program"><a href="./programs/httpd.html">httpd</a></code>命令行。例如，使用以下配置，仅当使用以下命令启动服务器时，所有请求才会重定向到另一个站点<code>httpd -DClosedForNow</code> ：</p>

<pre class="prettyprint lang-config">&lt;IfDefine ClosedForNow&gt;
    Redirect "/" "http://otherserver.example.com/"
&lt;/IfDefine&gt;</pre>


<p>的<code class="directive"><a href="./mod/core.html#ifmodule"><IfModule></a></code>指令非常相似，不同之处在于它包含仅在服务器中有特定模块可用时才应用的指令。该模块必须在服务器中静态编译，或者必须动态编译及其<code class="directive"><a href="./mod/mod_so.html#loadmodule">LoadModule</a></code>行必须早于配置文件中。仅在您需要配置文件才能工作（无论是否安装了某些模块）时，才应使用此伪指令。不应将其用于始终包含要使用的指令，因为它可以抑制有关缺少模块的有用错误消息。</p>

<p>在以下示例中， <code class="directive"><a href="./mod/mod_mime_magic.html#mimemagicfile">MimeMagicFile</a></code>指令仅在以下情况下适用<code class="module"><a href="./mod/mod_mime_magic.html">mod_mime_magic</a></code>可用。</p>

<pre class="prettyprint lang-config">&lt;IfModule mod_mime_magic.c&gt;
    MimeMagicFile "conf/magic"
&lt;/IfModule&gt;</pre>


<p>的<code class="directive"><a href="./mod/mod_version.html#ifversion"><IfVersion></a></code>指令与<code class="directive"><a href="./mod/core.html#ifdefine"><IfDefine></a></code>和<code class="directive"><a href="./mod/core.html#ifmodule"><IfModule></a></code> ，除了它包含仅在执行特定版本的服务器时才适用的指令。该模块旨在用于必须处理不同httpd版本和不同配置的测试套件和大型网络中。</p>

<pre class="prettyprint lang-config">&lt;IfVersion &gt;= 2.4&gt;
    # this happens only in versions greater or
    # equal 2.4.0.
&lt;/IfVersion&gt;</pre>


<p><code class="directive"><a href="./mod/core.html#ifdefine"><IfDefine></a></code> ， <code class="directive"><a href="./mod/core.html#ifmodule"><IfModule></a></code>和<code class="directive"><a href="./mod/mod_version.html#ifversion"><IfVersion></a></code>可以在测试前加上“！”来应用否定条件”。同样，可以嵌套这些部分以实现更复杂的限制。</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="file-and-web" id="file-and-web">文件系统，Webspace和布尔表达式</a></h2>

<p>最常用的配置节容器是那些更改文件系统或Web空间中特定位置的配置的容器。首先，重要的是要了解两者之间的区别。文件系统是操作系统所看到的磁盘视图。例如，在默认安装中，Apache httpd驻留在<code>/usr/local/apache2</code>在Unix文件系统中或<code>"c:/Program Files/Apache Group/Apache2"</code>在Windows文件系统中。（请注意，即使在Windows中，正斜杠也应始终用作Apache httpd配置文件中的路径分隔符。）相反，网站空间是由网站服务器交付并由客户端看到的网站视图。所以这条路<code>/dir/</code>在webspace中对应于路径<code>/usr/local/apache2/htdocs/dir/</code>在Unix上默认安装的Apache httpd的文件系统中。Web空间不必直接映射到文件系统，因为可以从数据库或其他位置动态生成网页。</p>

<h3><a name="filesystem" id="filesystem">文件系统容器</a></h3>

<p>的<code class="directive"><a href="./mod/core.html#directory"><Directory></a></code>和<code class="directive"><a href="./mod/core.html#files"><Files></a></code>指令及其对应的<a class="glossarylink" href="./glossary.html#regex" title="见词汇">regex</a>将指令应用于文件系统的各个部分。包含在指令中<code class="directive"><a href="./mod/core.html#directory"><Directory></a></code>部分适用于命名的文件系统目录以及该目录的所有子目录（以及这些目录中的文件）。使用<a href="howto/htaccess.html">.htaccess文件</a>可以获得相同的效果。例如，在以下配置中，将为目录启用目录索引。 <code>/var/web/dir1</code>目录和所有子目录。</p>

<pre class="prettyprint lang-config">&lt;Directory "/var/web/dir1"&gt;
    Options +Indexes
&lt;/Directory&gt;</pre>


<p>包含在指令中<code class="directive"><a href="./mod/core.html#files"><Files></a></code>部分适用于具有指定名称的任何文件，无论其位于哪个目录中。因此，例如，以下配置指令在放入配置文件的主要部分时，将拒绝访问任何名为<code>private.html</code>无论在哪里找到它。</p>

<pre class="prettyprint lang-config">&lt;Files "private.html"&gt;
    Require all denied
&lt;/Files&gt;</pre>


<p>要处理在文件系统特定部分中找到的文件， <code class="directive"><a href="./mod/core.html#files"><Files></a></code>和<code class="directive"><a href="./mod/core.html#directory"><Directory></a></code>部分可以组合。例如，以下配置将拒绝访问<code>/var/web/dir1/private.html</code> ， <code>/var/web/dir1/subdir2/private.html</code> ， <code>/var/web/dir1/subdir3/private.html</code> ，以及<code>private.html</code>在下找到<code>/var/web/dir1/</code>目录。</p>

<pre class="prettyprint lang-config">&lt;Directory "/var/web/dir1"&gt;
    &lt;Files "private.html"&gt;
        Require all denied
    &lt;/Files&gt;
&lt;/Directory&gt;</pre>



<h3><a name="webspace" id="webspace">网站空间容器</a></h3>

<p>的<code class="directive"><a href="./mod/core.html#location"><Location></a></code>另一方面，伪指令和它的<a class="glossarylink" href="./glossary.html#regex" title="见词汇">regex</a>对应项更改了Web空间中内容的配置。例如，以下配置阻止访问任何以/ private开头的URL路径。特别是，它将适用于<code>http://yoursite.example.com/private</code> ， <code>http://yoursite.example.com/private123</code>和<code>http://yoursite.example.com/private/dir/file.html</code>以及以<code>/private</code>串。</p>

<pre class="prettyprint lang-config">&lt;LocationMatch "^/private"&gt;
    Require all denied
&lt;/LocationMatch&gt;</pre>


<p>的<code class="directive"><a href="./mod/core.html#location"><Location></a></code>指令与文件系统没有任何关系。例如，以下示例显示如何将特定的URL映射到由提供的内部Apache HTTP Server处理程序。 <code class="module"><a href="./mod/mod_status.html">mod_status</a></code> 。没有文件<code>server-status</code>需要存在于文件系统中。</p>

<pre class="prettyprint lang-config">&lt;Location "/server-status"&gt;
    SetHandler server-status
&lt;/Location&gt;</pre>



<h3><a name="overlapping-webspace" id="overlapping-webspace">重叠的网站空间</a></h3>
<p>为了具有两个重叠的URL，必须考虑某些节或指令的评估顺序。对于<code class="directive"><a href="./mod/core.html#location"><Location></a></code>这将是：</p>
<pre class="prettyprint lang-config">&lt;Location "/foo"&gt;
&lt;/Location&gt;
&lt;Location "/foo/bar"&gt;
&lt;/Location&gt;</pre>

<p><code class="directive"><a href="./mod/mod_alias.html#alias"><Alias></a></code> es相反，反之亦然：</p>
<pre class="prettyprint lang-config">Alias "/foo/bar" "/srv/www/uncommon/bar"
Alias "/foo" "/srv/www/common/foo"</pre>

<p>对于<code class="directive"><a href="./mod/mod_proxy.html#proxypass">ProxyPass</a></code>指令：</p>
<pre class="prettyprint lang-config">ProxyPass "/special-area" "http://special.example.com" smax=5 max=10
ProxyPass "/" "balancer://mycluster/" stickysession=JSESSIONID|jsessionid nofailover=On</pre>



<h3><a name="wildcards" id="wildcards">通配符和正则表达式</a></h3>

<p>的<code class="directive"><a href="./mod/core.html#directory"><Directory></a></code> ， <code class="directive"><a href="./mod/core.html#files"><Files></a></code>和<code class="directive"><a href="./mod/core.html#location"><Location></a></code>指令每个都可以使用shell样式的通配符，如<code>fnmatch</code>来自C标准库。字符“ *”与任何字符序列“？”匹配。“匹配任何单个字符，而<em>‘[SEQ]’</em>在<em>SEQ</em>任何字符匹配。“ /”字符不会与任何通配符匹配；必须明确指定。</p>

<p>如果需要更灵活的匹配，则每个容器都有对应的正则表达式（regex） <code class="directive"><a href="./mod/core.html#directorymatch"><DirectoryMatch></a></code> ， <code class="directive"><a href="./mod/core.html#filesmatch"><FilesMatch></a></code>和<code class="directive"><a href="./mod/core.html#locationmatch"><LocationMatch></a></code>允许在选择匹配项时使用与perl兼容的<a class="glossarylink" href="./glossary.html#regex" title="见词汇">正则表达式</a> 。但是请参阅下面有关配置合并的部分，以了解使用正则表达式部分将如何更改指令的应用方式。</p>

<p>更改所有用户目录配置的非正则表达式通配符部分如下所示：</p>

<pre class="prettyprint lang-config">&lt;Directory "/home/*/public_html"&gt;
    Options Indexes
&lt;/Directory&gt;</pre>


<p>使用正则表达式部分，我们可以一次拒绝访问多种类型的图像文件：</p>
<pre class="prettyprint lang-config">&lt;FilesMatch "\.(?i:gif|jpe?g|png)$"&gt;
    Require all denied
&lt;/FilesMatch&gt;</pre>


<p>包含<strong>命名组和反向引用的</strong>正则表达式<strong>以</strong>大写形式添加到具有相应名称的环境中。这样就可以在<a href="expr.html">表达式</a>和模块（例如）中引用文件名路径和URL的元素<code class="module"><a href="./mod/mod_rewrite.html">mod_rewrite</a></code> 。</p>

<pre class="prettyprint lang-config">&lt;DirectoryMatch "^/var/www/combined/(?&lt;SITENAME&gt;[^/]+)"&gt;
    require ldap-group "cn=%{env:MATCH_SITENAME},ou=combined,o=Example"
&lt;/DirectoryMatch&gt;</pre>




<h3><a name="expressions" id="expressions">布尔表达式</a></h3>
<p>的<code class="directive"><a href="./mod/core.html#if"><If></a></code>指令根据可以由布尔表达式表示的条件来更改配置。例如，如果HTTP Referer标头不是以“ http://www.example.com/”开头，则以下配置拒绝访问。</p>
<pre class="prettyprint lang-config">&lt;If "!(%{HTTP_REFERER} -strmatch 'http://www.example.com/*')"&gt;
    Require all denied
&lt;/If&gt;</pre>




<h3><a name="whichwhen" id="whichwhen">什么时候使用</a></h3>

<p>实际上，在文件系统容器和Webspace容器之间进行选择非常容易。将指令应用于驻留在文件系统中的对象时，请始终使用<code class="directive"><a href="./mod/core.html#directory"><Directory></a></code>要么<code class="directive"><a href="./mod/core.html#files"><Files></a></code> 。将指令应用于不在文件系统中的对象（例如从数据库生成的网页）时，请使用<code class="directive"><a href="./mod/core.html#location"><Location></a></code> 。</p>

<p>永远不要使用很重要<code class="directive"><a href="./mod/core.html#location"><Location></a></code>尝试限制对文件系统中对象的访问时。这是因为许多不同的网站空间位置（URL）可以映射到同一文件系统位置，从而可以规避您的限制。例如，考虑以下配置：</p>

<pre class="prettyprint lang-config">&lt;Location "/dir/"&gt;
    Require all denied
&lt;/Location&gt;</pre>


<p>如果要求是<code>http://yoursite.example.com/dir/</code> 。但是，如果您使用的是不区分大小写的文件系统，该怎么办？然后，您可以通过请求轻松避免您的限制<code>http://yoursite.example.com/DIR/</code> 。的<code class="directive"><a href="./mod/core.html#directory"><Directory></a></code>相反，伪指令将适用于从该位置提供的任何内容，而不管其调用方式如何。（文件系统链接是一个例外。可以使用符号链接将同一目录放置在文件系统的多个部分中。的<code class="directive"><a href="./mod/core.html#directory"><Directory></a></code>指令将遵循符号链接，而无需重置路径名。因此，为了获得最高级别的安全性，应通过适当的方式禁用符号链接<code class="directive"><a href="./mod/core.html#options">Options</a></code>指示。）</p>

<p>如果您认为由于使用区分大小写的文件系统而导致这些都不适合您，请记住，还有许多其他方法可以将多个网站空间位置映射到同一文件系统位置。因此，您应该始终尽可能使用文件系统容器。但是，此规则有一个例外。将配置限制放在<code><Location "/"></code>部分是绝对安全的，因为此部分将适用于所有请求，而不管特定的URL。</p>


<h3><a name="nesting" id="nesting">节的嵌套</a></h3>

<p>某些节类型可以嵌套在其他节类型中。一方面， <code class="directive"><a href="./mod/core.html#files"><Files></a></code>可以在里面使用<code class="directive"><a href="./mod/core.html#directory"><Directory></a></code> 。另一方面， <code class="directive"><a href="./mod/core.html#if"><If></a></code>可以在里面使用<code class="directive"><a href="./mod/core.html#directory"><Directory></a></code> ， <code class="directive"><a href="./mod/core.html#location"><Location></a></code>和<code class="directive"><a href="./mod/core.html#files"><Files></a></code>部分（但不在另一部分内<code class="directive"><a href="./mod/core.html#if"><If></a></code> ）。命名部分的正则表达式对应的行为相同。</p>

<p>嵌套部分在相同类型的非嵌套部分之后合并。</p>



</div><div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="virtualhost" id="virtualhost">虚拟主机</a></h2>

<p>的<code class="directive"><a href="./mod/core.html#virtualhost"><VirtualHost></a></code>容器包含适用于特定主机的指令。当从同一台计算机为多台主机提供不同配置时，这很有用。有关更多信息，请参见《 <a href="vhosts/index.html">虚拟主机文档》</a> 。</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="proxy" id="proxy">代理</a></h2>

<p>的<code class="directive"><a href="./mod/mod_proxy.html#proxy"><Proxy></a></code>和<code class="directive"><a href="./mod/mod_proxy.html#proxymatch"><ProxyMatch></a></code>容器仅将封闭的配置指令应用于通过以下方式访问的网站<code class="module"><a href="./mod/mod_proxy.html">mod_proxy</a></code>与指定网址匹配的代理服务器。例如，以下配置将仅允许一部分客户端访问<code>www.example.com</code>使用代理服务器的网站：</p>

<pre class="prettyprint lang-config">&lt;Proxy "http://www.example.com/*"&gt;
    Require host yournetwork.example.com
&lt;/Proxy&gt;</pre>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="whatwhere" id="whatwhere">允许哪些指令？</a></h2>

<p>要找出在哪些类型的配置节中允许使用哪些指令，请检查指令的<a href="mod/directive-dict.html#Context">上下文</a> 。允许的一切<code class="directive"><a href="./mod/core.html#directory"><Directory></a></code>在句法上也允许<code class="directive"><a href="./mod/core.html#directorymatch"><DirectoryMatch></a></code> ， <code class="directive"><a href="./mod/core.html#files"><Files></a></code> ， <code class="directive"><a href="./mod/core.html#filesmatch"><FilesMatch></a></code> ， <code class="directive"><a href="./mod/core.html#location"><Location></a></code> ， <code class="directive"><a href="./mod/core.html#locationmatch"><LocationMatch></a></code> ， <code class="directive"><a href="./mod/mod_proxy.html#proxy"><Proxy></a></code>和<code class="directive"><a href="./mod/mod_proxy.html#proxymatch"><ProxyMatch></a></code>部分。但是，有一些例外情况：</p>

<ul>
<li>的<code class="directive"><a href="./mod/core.html#allowoverride">AllowOverride</a></code>指令仅在<code class="directive"><a href="./mod/core.html#directory"><Directory></a></code>部分。</li>

<li>的<code>FollowSymLinks</code>和<code>SymLinksIfOwnerMatch</code><code class="directive"><a href="./mod/core.html#options">Options</a></code>仅在<code class="directive"><a href="./mod/core.html#directory"><Directory></a></code>部分或<code>.htaccess</code>文件。</li>

<li>的<code class="directive"><a href="./mod/core.html#options">Options</a></code>指令不能用于<code class="directive"><a href="./mod/core.html#files"><Files></a></code>和<code class="directive"><a href="./mod/core.html#filesmatch"><FilesMatch></a></code>部分。</li>
</ul>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="merging" id="merging">这些部分如何合并</a></h2>

<p>配置部分以非常特殊的顺序应用。由于这会对解释配置指令的方式产生重要影响，因此了解其工作原理非常重要。</p>

    <p>合并顺序为：</p>

    <ol>
      <li> <code class="directive"><a href="./mod/core.html#directory"><Directory></a></code> （正则表达式除外）和<code>.htaccess</code>同时完成<code>.htaccess</code> ，如果允许，则覆盖<code class="directive"><a href="./mod/core.html#directory"><Directory></a></code> ）</li>

      <li><code class="directive"><a href="./mod/core.html#directorymatch"><DirectoryMatch></a></code> （和<code><Directory "~"></code> ）</li>

      <li><code class="directive"><a href="./mod/core.html#files"><Files></a></code>和<code class="directive"><a href="./mod/core.html#filesmatch"><FilesMatch></a></code>同时完成</li>

      <li><code class="directive"><a href="./mod/core.html#location"><Location></a></code>和<code class="directive"><a href="./mod/core.html#locationmatch"><LocationMatch></a></code>同时完成</li>

      <li><code class="directive"><a href="./mod/core.html#if"><If></a></code>
      </li>

    </ol>

    <p>一些重要的评论：</p>
    <ul>
        <li>除了<code class="directive"><a href="./mod/core.html#directory"><Directory></a></code> ，每个组中的节均按照它们在配置文件中出现的顺序进行处理。例如，对<em>/ foo</em>的请求将匹配<code><Location "/foo/bar"></code>和<code><Location "/foo"></code> （在这种情况下为第4组）：将评估两个部分，但将按照它们在配置文件中出现的顺序进行评估。</li>
        <li><code class="directive"><a href="./mod/core.html#directory"><Directory></a></code> （上面的组1）按顺序最短目录组件中的最长来处理。例如， <code><Directory "/var/web/dir"></code>将在之前处理<code><Directory "/var/web/dir/subdir"></code> 。</li>
        <li>如果多个<code class="directive"><a href="./mod/core.html#directory"><Directory></a></code>这些部分适用于按配置文件顺序处理的同一目录。</li>
        <li>通过配置包含<code class="directive"><a href="./mod/core.html#include">Include</a></code>伪指令将被视为它们位于文件所在位置的包含文件中<code class="directive"><a href="./mod/core.html#include">Include</a></code>指示。</li>
        <li>内部节<code class="directive"><a href="./mod/core.html#virtualhost"><VirtualHost></a></code>这些部分将<em>在</em>虚拟主机定义之外的相应部分<em>之后</em>应用。这允许虚拟主机覆盖主服务器配置。</li>
        <li>当请求由<code class="module"><a href="./mod/mod_proxy.html">mod_proxy</a></code> ， <code class="directive"><a href="./mod/mod_proxy.html#proxy"><Proxy></a></code>容器代替了<code class="directive"><a href="./mod/core.html#directory"><Directory></a></code>容器中的加工顺序。</li>
    </ul>

    <div class="note"><h3>技术说明</h3>实际上有一个<code><Location></code> / <code><LocationMatch></code>在名称翻译阶段（其中<code>Aliases</code>和<code>DocumentRoots</code>用于将URL映射到文件名）。翻译完成后，此序列的结果将被完全丢弃。
    </div>

<h3><a name="relationship-module-configuration" id="relationship-module-configuration">模块和配置部分之间的关系</a></h3>
    <p>在阅读了如何合并配置节之后，经常会出现一个问题，该问题与特定模块（例如， <code class="module"><a href="./mod/mod_rewrite.html">mod_rewrite</a></code>被处理。答案并不简单，需要一些背景知识。每个httpd模块管理自己的配置，并且httpd.conf中的每个指令都在特定上下文中指定一个配置。 httpd在读取时不执行命令。</p>
    <p>在运行时，httpd的核心按照上述顺序遍历已定义的配置节，以确定哪些节适用于当前请求。当第一部分匹配时，它将被视为此请求的当前配置。如果后续部分也匹配，则每个部分中带有指令的每个模块都有机会在两个部分之间合并其配置。结果是第三个配置，该过程一直进行到评估所有配置部分为止。</p>
    <p>完成上述步骤后，HTTP请求的“实际”处理开始：每个模块都有机会运行并执行所需的任何任务。他们可以从httpd的核心中检索自己的最终合并配置，以确定应如何操作。</p>
    <p>一个示例可以帮助可视化整个过程。以下配置使用<code class="directive"><a href="./mod/mod_headers.html#header">Header</a></code>指令<code class="module"><a href="./mod/mod_headers.html">mod_headers</a></code>设置特定的HTTP标头。httpd将在<code>CustomHeaderName</code>请求的标头<code>/example/index.html</code> ？
    </p>
    <pre class="prettyprint lang-config">&lt;Directory "/"&gt;
    Header set CustomHeaderName one
    &lt;FilesMatch ".*"&gt;
        Header set CustomHeaderName three
    &lt;/FilesMatch&gt;
&lt;/Directory&gt;

&lt;Directory "/example"&gt;
    Header set CustomHeaderName two
&lt;/Directory&gt;</pre>
    
    <ul>
        <li><code class="directive">Directory</code> “ /”匹配项和初始配置来设置<code>CustomHeaderName</code>具有值的标题<code>one</code>被建造。</li>
        <li><code class="directive">Directory</code> “ / example”匹配，并且自<code class="module"><a href="./mod/mod_headers.html">mod_headers</a></code>在其代码中指定要在合并的情况下覆盖的代码，将创建一个新配置来设置<code>CustomHeaderName</code>具有值的标题<code>two</code> 。</li>
        <li><code class="directive">FilesMatch</code> “。*”匹配，并且出现另一个合并机会，从而导致<code>CustomHeaderName</code>标头值<code>three</code> 。</li>
        <li>最终在HTTP请求处理的后续步骤中<code class="module"><a href="./mod/mod_headers.html">mod_headers</a></code>将被调用，它将接收配置以设置<code>CustomHeaderName</code>具有值的标题<code>three</code> 。 <code class="module"><a href="./mod/mod_headers.html">mod_headers</a></code>通常使用此配置执行其工作，即设置foo标头。这并不意味着模块不能执行更复杂的操作，例如因为不需要或不推荐使用而放弃指令等。</li>
    </ul>

    <p>.htaccess也是如此，因为它们的优先级与<code class="directive">Directory</code>按合并顺序。要了解的重要概念是<code class="directive">Directory</code>和<code class="directive">FilesMatch</code>与模块专用指令（例如， <code class="directive"><a href="./mod/mod_headers.html#header">Header</a></code>要么<code class="directive"><a href="./mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>因为它们在不同的级别上运行。
    </p>


<h3><a name="merge-examples" id="merge-examples">一些有用的例子</a></h3>

<p>以下是显示合并顺序的人工示例。假设它们都适用于请求，则本示例中的指令将按A> B> C> D> E的顺序应用。</p>

<pre class="prettyprint lang-config">&lt;Location "/"&gt;
    E
&lt;/Location&gt;

&lt;Files "f.html"&gt;
    D
&lt;/Files&gt;

&lt;VirtualHost *&gt;
    &lt;Directory "/a/b"&gt;
        B
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;

&lt;DirectoryMatch "^.*b$"&gt;
    C
&lt;/DirectoryMatch&gt;

&lt;Directory "/a/b"&gt;
    A
&lt;/Directory&gt;</pre>



<p>对于更具体的示例，请考虑以下内容。不管设置了什么访问限制<code class="directive"><a href="./mod/core.html#directory"><Directory></a></code>部分， <code class="directive"><a href="./mod/core.html#location"><Location></a></code>部分将最后评估，并允许不受限制地访问服务器。换句话说，合并的顺序很重要，所以要小心！</p>

<pre class="prettyprint lang-config">&lt;Location "/"&gt;
    Require all granted
&lt;/Location&gt;

# Whoops!  This &lt;Directory&gt; section will have no effect
&lt;Directory "/"&gt;
    &lt;RequireAll&gt;
        Require all granted
        Require not host badguy.example.com
    &lt;/RequireAll&gt;
&lt;/Directory&gt;</pre>




</div></div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="./mod/index.html">模块</a> | <a href="./mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="./glossary.html">词汇表</a> | <a href="./sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>

</body></html>