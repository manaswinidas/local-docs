<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>自定义错误响应-Apache HTTP Server版本2.4</title>
<link href="./style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="./style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="./style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="./style/css/prettify.css">
<script src="./style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body id="manual-page" ><div id="page-header">
<p class="menu"><a href="./mod/index.html">模块</a> | <a href="./mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="./glossary.html">词汇表</a> | <a href="./sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="./images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="<-" alt="<-" src="./images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> > <a href="http://httpd.apache.org/">HTTP Server</a> > <a href="http://httpd.apache.org/docs/">文档</a> > <a href="./index.html">版本2.4</a></div><div id="page-content"><div id="preamble"><h1>自定义错误响应</h1>



    <p>尽管在出现4xx或5xx HTTP状态代码的情况下，Apache HTTP Server提供了通用的错误响应，但这些响应相当明显，毫无意义，并且可能使站点用户感到恐惧。您可能希望提供更友好的自定义错误响应，或者以英语以外的其他语言提供自定义错误响应，或者提供的样式更符合您的网站布局。</p>

    <p>可以为指定为错误条件的任何HTTP状态代码（即任何4xx或5xx状态）定义定制的错误响应。</p>

    <p>此外，还提供了一组值，以便可以使用<a href="howto/ssi.html">Server Side Includes</a>基于这些变量的值进一步自定义错误文档。或者，您可以通过cgi程序或使用这些变量的其他动态处理程序（PHP，mod_perl等）来处理错误情况。</p>

  </div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><ul id="toc"><li><img alt="" src="./images/down.gif"> <a href="#configuration">组态</a></li>
<li><img alt="" src="./images/down.gif"> <a href="#variables">可用变量</a></li>
<li><img alt="" src="./images/down.gif"> <a href="#custom">自定义错误响应</a></li>
<li><img alt="" src="./images/down.gif"> <a href="#multi-lang">多语言自定义错误文档</a></li>
</ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="configuration" id="configuration">组态</a></h2>

    <p>使用以下命令配置自定义错误文档<code class="directive"><a href="./mod/core.html#errordocument">ErrorDocument</a></code>指令，可以在全局，虚拟主机或目录上下文中使用。如果.htaccess文件中可以使用它<code class="directive"><a href="./mod/core.html#allowoverride">AllowOverride</a></code>设置为FileInfo。</p>

    <pre class="prettyprint lang-config">ErrorDocument 500 "Sorry, our script crashed. Oh dear"
ErrorDocument 500 /cgi-bin/crash-recover
ErrorDocument 500 http://error.example.com/server_error.html
ErrorDocument 404 /errors/not_found.html
ErrorDocument 401 /subscription/how_to_subscribe.html</pre>


    <p>的语法<code>ErrorDocument</code>指令是：</p>

    <pre class="prettyprint lang-config">ErrorDocument &lt;3-digit-code&gt; &lt;action&gt;</pre>


    <p>该动作将被视为：</p>

    <ol>
      <li>重定向到的本地URL（如果操作以“ /”开头）。</li>
      <li>重定向到的外部URL（如果操作是有效的URL）。</li>
      <li>要显示的文本（如果以上都不显示）。如果文本包含多个单词，则必须用引号（“）引起来。</li>
    </ol>

    <p>重定向到本地URL时，将设置其他环境变量，以便可以进一步自定义响应。它们不会发送到外部URL。</p>

  </div><div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="variables" id="variables">可用变量</a></h2>

      <p>重定向到另一个URL可能很有用，但前提是可以传递一些信息，然后可以使用这些信息更清楚地解释或记录错误情况。</p>

      <p>为此，在发送错误重定向时，将设置其他环境变量，该环境变量将通过在原始报头名称前加上“ REDIRECT_”，从提供给原始请求的报头中生成。这为错误文档提供了原始请求的上下文。</p>

      <p>例如，除了更常见的环境变量外，您可能还会收到以下内容。</p>

      <div class="example"><p><code>REDIRECT_HTTP_ACCEPT=*/*, image/gif, image/jpeg, image/png<br> REDIRECT_HTTP_USER_AGENT=Mozilla/5.0 Fedora/3.5.8-1.fc12 Firefox/3.5.8<br> REDIRECT_PATH=.:/bin:/usr/local/bin:/sbin<br> REDIRECT_QUERY_STRING=<br> REDIRECT_REMOTE_ADDR=121.345.78.123<br> REDIRECT_REMOTE_HOST=client.example.com<br> REDIRECT_SERVER_NAME=www.example.edu<br> REDIRECT_SERVER_PORT=80<br> REDIRECT_SERVER_SOFTWARE=Apache/2.2.15<br> REDIRECT_URL=/cgi-bin/buggy.pl</code></p></div>

      <p><code>REDIRECT_</code>环境变量是根据重定向之前存在的环境变量创建的。它们被重命名为<code>REDIRECT_</code>前缀， <em>即</em> <code>HTTP_USER_AGENT</code>变成<code>REDIRECT_HTTP_USER_AGENT</code> 。</p>

      <p><code>REDIRECT_URL</code> ， <code>REDIRECT_STATUS</code>和<code>REDIRECT_QUERY_STRING</code>确保可以设置，并且只有在错误条件之前存在其他标头时，才会设置其他标头。</p>

      <p>这<strong>一切都</strong>不会被设置为在<code class="directive"><a href="./mod/core.html#errordocument">ErrorDocument</a></code>目标是<em>外部</em>重定向（以方案名称开头的任何内容，例如<code>http:</code> ，即使它与服务器指向的是同一主机）。</p>
  </div><div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="custom" id="custom">自定义错误响应</a></h2>

      <p>如果你指出你的<code>ErrorDocument</code>对于某些动态处理程序，例如服务器端包含文档，CGI脚本或其他各种处理程序，您可能希望使用可用的自定义环境变量来自定义此响应。</p>

      <p>如果ErrorDocument指定了对CGI脚本的本地重定向，则该脚本应包含“ <code>Status:</code>标头字段”，以确保一直传播到导致被调用的错误条件到客户端。例如，Perl ErrorDocument脚本可能包括以下内容：</p>

       <pre class="prettyprint lang-perl">...
print  "Content-type: text/html\n";
printf "Status: %s Condition Intercepted\n", $ENV{"REDIRECT_STATUS"};
...</pre>


      <p>如果脚本专用于处理特定的错误情况，例如<code>404 Not Found</code> ，它可以改用特定的代码和错误文本。</p>

      <p>请注意，如果响应包含<code>Location:</code>标头（为了发出客户端重定向），脚本<em>必须</em>发出适当的<code>Status:</code>标头（例如<code>302 Found</code> ）。否则<code>Location:</code>标头可能无效。</p>

  </div><div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="multi-lang" id="multi-lang">多语言自定义错误文档</a></h2>

    <p>Apache HTTP Server的安装随附提供了一个自定义错误文档的目录，该目录已翻译成16种不同的语言。还有一个配置文件<code>conf/extra</code>可以包含以启用此功能的配置目录。</p>

    <p>在服务器配置文件中，您将看到如下一行：</p>

    <pre class="prettyprint lang-config"># Multi-language error messages
#Include conf/extra/httpd-multilang-errordoc.conf</pre>


    <p>取消注释<code>Include</code> line将启用此功能，并根据客户端浏览器中设置的语言首选项提供与语言协商的错误消息。</p>

    <p>此外，这些文件还包含各种<code>REDIRECT_</code>变量，以便可以向最终用户提供发生了什么以及他们现在可以做什么的附加信息。</p>

    <p>您可以随意定制这些文档，以向用户提供有关您的站点以及他们在站点中可以找到的内容的更多有用信息。</p>

    <p><code class="module"><a href="./mod/mod_include.html">mod_include</a></code>和<code class="module"><a href="./mod/mod_negotiation.html">mod_negotiation</a></code>必须启用才能使用此功能。</p>

 </div></div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="./mod/index.html">模块</a> | <a href="./mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="./glossary.html">词汇表</a> | <a href="./sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>

</body></html>