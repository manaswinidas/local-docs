<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>有关DNS和Apache HTTP Server的问题-Apache HTTP Server版本2.4</title>
<link href="./style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="./style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="./style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="./style/css/prettify.css">
<script src="./style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body id="manual-page" ><div id="page-header">
<p class="menu"><a href="./mod/index.html">模块</a> | <a href="./mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="./glossary.html">词汇表</a> | <a href="./sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="./images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="<-" alt="<-" src="./images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> > <a href="http://httpd.apache.org/">HTTP Server</a> > <a href="http://httpd.apache.org/docs/">文档</a> > <a href="./index.html">版本2.4</a></div><div id="page-content"><div id="preamble"><h1>有关DNS和Apache HTTP Server的问题</h1>


    <p>该页面可以用以下语句来概括：不要以依赖DNS解析来解析配置文件的方式配置Apache HTTP Server。如果httpd需要DNS解析来解析配置文件，则您的服务器可能会遇到可靠性问题（例如，它可能无法启动），或者遭到拒绝和盗窃服务攻击（包括能够从其他虚拟主机中窃取数据的虚拟主机）。</p>
  </div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><ul id="toc"><li><img alt="" src="./images/down.gif"> <a href="#example">一个简单的例子</a></li>
<li><img alt="" src="./images/down.gif"> <a href="#denial">拒绝服务</a></li>
<li><img alt="" src="./images/down.gif"> <a href="#main">“主服务器”地址</a></li>
<li><img alt="" src="./images/down.gif"> <a href="#tips">避免这些问题的提示</a></li>
</ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="example" id="example">一个简单的例子</a></h2>
    

    <pre class="prettyprint lang-config"># This is a misconfiguration example, do not use on your server
&lt;VirtualHost www.example.dom&gt;
  ServerAdmin webgirl@example.dom
  DocumentRoot "/www/example"
&lt;/VirtualHost&gt;</pre>


    <p>为了使服务器正常运行，它绝对需要有关每个虚拟主机的两条信息： <code class="directive"><a href="./mod/core.html#servername">ServerName</a></code>以及服务器将绑定并响应的至少一个IP地址。上面的示例不包含IP地址，因此httpd必须使用DNS查找以下地址<code>www.example.dom</code> 。如果由于某种原因在服务器解析其配置文件时DNS不可用， <strong>则将不会配置</strong>此虚拟主机。它将无法响应对此虚拟主机的任何点击。</p>

    <p>假设<code>www.example.dom</code>地址为192.0.2.1。然后考虑以下配置片段：</p>

    <pre class="prettyprint lang-config"># This is a misconfiguration example, do not use on your server
&lt;VirtualHost 192.0.2.1&gt;
  ServerAdmin webgirl@example.dom
  DocumentRoot "/www/example"
&lt;/VirtualHost&gt;</pre>


    <p>这次httpd需要使用反向DNS来查找<code>ServerName</code>为此虚拟主机。如果反向查找失败，则它将部分禁用虚拟主机。如果虚拟主机是基于名称的，那么它将被完全禁用，但是如果虚拟主机是基于IP的，则它几乎可以正常工作。但是，如果httpd必须曾经为服务器生成包括服务器名称的完整URL（例如发出重定向时），则它将无法生成有效的URL。</p>

    <p>以下是可避免这两个问题的代码段：</p>

    <pre class="prettyprint lang-config">&lt;VirtualHost 192.0.2.1&gt;
  ServerName www.example.dom
  ServerAdmin webgirl@example.dom
  DocumentRoot "/www/example"
&lt;/VirtualHost&gt;</pre>

  </div><div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="denial" id="denial">拒绝服务</a></h2>
    

    <p>考虑以下配置片段：</p>

    <pre class="prettyprint lang-config">&lt;VirtualHost www.example1.dom&gt;
  ServerAdmin webgirl@example1.dom
  DocumentRoot "/www/example1"
&lt;/VirtualHost&gt;
&lt;VirtualHost www.example2.dom&gt;
  ServerAdmin webguy@example2.dom
  DocumentRoot "/www/example2"
&lt;/VirtualHost&gt;</pre>


    <p>假设您已将192.0.2.1分配给<code>www.example1.dom</code>和192.0.2.2至<code>www.example2.dom</code> 。此外，假设<code>example1.dom</code>拥有自己的DNS的控制权。使用此配置， <code>example1.dom</code>他们可以偷走所有发往<code>example2.dom</code> 。为此，他们要做的就是设置<code>www.example1.dom</code>至192.0.2.2。由于它们控制自己的DNS，因此您不能阻止它们指向<code>www.example1.dom</code>记录他们想要的任何地方。</p>

    <p>进入192.0.2.2的请求（包括所有用户键入以下形式的URL的请求） <code>http://www.example2.dom/whatever</code> ）将全部由<code>example1.dom</code>虚拟主机。为了更好地理解为什么会发生这种情况，需要更深入地讨论httpd如何将传入请求与将为其服务的虚拟主机进行匹配。提供了描述此<a href="vhosts/details.html">内容的</a>粗略文档。</p>
  </div><div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="main" id="main">“主服务器”地址</a></h2>
    

    <p><a href="vhosts/name-based.html">基于名称的虚拟主机支持</a>要求httpd知道该<a href="vhosts/name-based.html">主机</a>的IP地址。 <code class="program"><a href="./programs/httpd.html">httpd</a></code>正在运行。要获得此地址，它使用全局<code class="directive"><a href="./mod/core.html#servername">ServerName</a></code> （如果存在）或调用C函数<code>gethostname</code> （返回的内容应与在命令提示符下键入“主机名”相同）。然后，它在该地址上执行DNS查找。目前没有办法避免这种查找。</p>

    <p>如果您担心此查询可能会由于DNS服务器已关闭而失败，则可以在其中插入主机名<code>/etc/hosts</code> （您可能已经拥有了它，以便计算机可以正常启动）。然后确保您的计算机配置为使用<code>/etc/hosts</code>如果DNS失败。根据您使用的操作系统，可以通过编辑来完成<code>/etc/resolv.conf</code> ， 或许<code>/etc/nsswitch.conf</code> 。</p>

    <p>如果您的服务器由于任何其他原因不必执行DNS，则可以通过运行带有<code>HOSTRESORDER</code>环境变量设置为“本地”。这完全取决于您使用的操作系统和解析器库。除非您使用它，否则还会影响CGI。 <code class="module"><a href="./mod/mod_env.html">mod_env</a></code>控制环境。最好查阅操作系统的手册页或常见问题解答。</p>
  </div><div class="top"><a href="#page-header"><img alt="最佳" src="./images/up.gif"></a></div>
<div class="section">
<h2><a name="tips" id="tips">避免这些问题的提示</a></h2>
    

    <ul>
      <li>使用IP地址<code class="directive"><a href="./mod/core.html#virtualhost">VirtualHost</a></code>
      </li>

      <li>使用IP地址<code class="directive"><a href="./mod/mpm_common.html#listen">Listen</a></code>
      </li>

      <li>确保所有虚拟主机都有明确的<code class="directive"><a href="./mod/core.html#servername">ServerName</a></code>
      </li>

      <li>创建一个<code><VirtualHost _default_:*></code>没有页面可服务的服务器</li>
    </ul>
  </div></div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="./mod/index.html">模块</a> | <a href="./mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="./glossary.html">词汇表</a> | <a href="./sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>

</body></html>