<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>何时不使用mod_rewrite-Apache HTTP Server版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body id="manual-page" ><div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="<-" alt="<-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> > <a href="http://httpd.apache.org/">HTTP服务器</a> > <a href="http://httpd.apache.org/docs/">文档</a> > <a href="../index.html">版本2.4</a> > <a href="./index.html">重写</a></div><div id="page-content"><div id="preamble"><h1>何时不使用mod_rewrite</h1>



<p>本文件是对<code class="module"><a href="../mod/mod_rewrite.html">mod_rewrite</a></code> <a href="../mod/mod_rewrite.html">参考文档</a> 。它描述了有关以下方面的最重要概念之一<code class="module"><a href="../mod/mod_rewrite.html">mod_rewrite</a></code> -即何时避免使用它。</p>

<p><code class="module"><a href="../mod/mod_rewrite.html">mod_rewrite</a></code>当发现其他替代方案不足时，应将其视为万不得已的方法。在存在更简单的替代方案时使用它会导致配置混乱，脆弱且难以维护。了解还有哪些其他选择是朝着非常重要的一步<code class="module"><a href="../mod/mod_rewrite.html">mod_rewrite</a></code>精通。</p>

<p>请注意，这些示例中的许多示例在您的特定服务器配置中都不会起作用，因此，理解它们，而不只是将示例剪切并粘贴到您的配置中，这一点很重要。</p>

<p>最常见的情况是<code class="module"><a href="../mod/mod_rewrite.html">mod_rewrite</a></code>当最好的解决方案需要访问服务器配置文件而您没有访问权限时，正确的工具才是正确的工具。某些配置指令仅在服务器配置文件中可用。因此，如果您处于只能使用.htaccess文件的托管环境，则可能需要诉诸于<code class="module"><a href="../mod/mod_rewrite.html">mod_rewrite</a></code> 。</p>

</div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><ul id="toc"><li><img alt="" src="../images/down.gif"> <a href="#redirect">简单重定向</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#alias">URL别名</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#vhosts">虚拟主机</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#proxy">简单代理</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#setenv">环境变量测试</a></li>
</ul><h3>也可以看看</h3><ul class="seealso"><li><a href="../mod/mod_rewrite.html">模块文件</a></li><li><a href="intro.html">mod_rewrite简介</a></li><li><a href="remapping.html">重定向和重新映射</a></li><li><a href="access.html">控制访问</a></li><li><a href="vhosts.html">虚拟主机</a></li><li><a href="proxy.html">代理</a></li><li><a href="rewritemap.html">使用RewriteMap</a></li><li><a href="advanced.html">先进技术</a></li></ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="redirect" id="redirect">简单重定向</a></h2>


<p><code class="module"><a href="../mod/mod_alias.html">mod_alias</a></code>提供<code class="directive"><a href="../mod/mod_alias.html#redirect">Redirect</a></code>和<code class="directive"><a href="../mod/mod_alias.html#redirectmatch">RedirectMatch</a></code>指令，提供一种将一个URL重定向到另一个URL的方法。将一个URL或一类URL进行这种简单的重定向到其他地方，应该使用这些指令而不是<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code> 。<code>RedirectMatch</code>允许您在重定向条件中包含正则表达式，从而提供使用的许多好处<code>RewriteRule</code> 。</p>

<p>常见用途<code>RewriteRule</code>是重定向整个URL类。例如， <code>/one</code>目录必须重定向到<code>http://one.example.com/</code> ，或者全部<code>http</code>请求必须重定向到<code>https</code> 。</p>

<p>这些情况最好由<code>Redirect</code>指示。请记住<code>Redirect</code>保留路径信息。也就是说，URL的重定向<code>/one</code>还将重定向该网址下的所有网址，例如<code>/one/two.html</code>和<code>/one/three/four.html</code> 。</p>

<p>将网址重定向到<code>/one</code>至<code>http://one.example.com</code> ， 请执行下列操作：</p>

<pre class="prettyprint lang-config">Redirect "/one/" "http://one.example.com/"</pre>


<p>例如，将一个主机名重定向到另一个<code>example.com</code>至<code>www.example.com</code> ，请参阅<a href="remapping.html#canonicalhost">规范主机名</a>配方。</p>

<p>重定向<code>http</code>网址<code>https</code> ， 请执行下列操作：</p>

<pre class="prettyprint lang-config">&lt;VirtualHost *:80&gt;
    ServerName www.example.com
    Redirect "/" "https://www.example.com/"
&lt;/VirtualHost&gt;

&lt;VirtualHost *:443&gt;
    ServerName www.example.com
    # ... SSL configuration goes here
&lt;/VirtualHost&gt;</pre>


<p>指某东西的用途<code>RewriteRule</code>如果还有其他原因，执行此任务可能是合适的<code>RewriteRule</code>同一范围内的指令。这是因为，当有<code>Redirect</code>和<code>RewriteRule</code>同一范围内的指令<code>RewriteRule</code>指令将首先运行，无论配置文件中出现的顺序如何。</p>

<p>在<em>http到https</em>重定向的情况下，使用<code>RewriteRule</code>如果您无权访问主服务器配置文件，并且必须在<code>.htaccess</code>文件代替。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="alias" id="alias">URL别名</a></h2>
<p>的<code class="directive"><a href="../mod/mod_alias.html#alias">Alias</a></code>指令可提供从URI到目录的映射-通常是您外部的目录<code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code> 。尽管可以通过以下方式执行此映射<code class="module"><a href="../mod/mod_rewrite.html">mod_rewrite</a></code> ， <code class="directive"><a href="../mod/mod_alias.html#alias">Alias</a></code>出于简化和性能的原因，“首选”方法是首选方法。</p>

<div class="example"><h3>使用别名</h3><pre class="prettyprint lang-config">Alias "/cats" "/var/www/virtualhosts/felines/htdocs"</pre>
</div>

<p>指某东西的用途<code class="module"><a href="../mod/mod_rewrite.html">mod_rewrite</a></code>当您无权访问服务器配置文件时，执行此映射可能是合适的。别名只能在服务器或虚拟主机上下文中使用，而不能在<code>.htaccess</code>文件。
</p>

<p>如果有的话，符号链接将是完成同一件事的另一种方式<code>Options FollowSymLinks</code>在您的服务器上启用。</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="vhosts" id="vhosts">虚拟主机</a></h2>
<p>尽管可以<a href="vhosts.html">使用mod_rewrite</a>处理<a href="vhosts.html">虚拟主机</a> ，但这很少是正确的方法。创建个人<code class="directive"><a href="../mod/core.html#virtualhost"><VirtualHost></a></code>障碍几乎总是正确的方法。如果您有大量的虚拟主机，请考虑使用<code class="module"><a href="../mod/mod_vhost_alias.html">mod_vhost_alias</a></code>自动创建这些主机。</p>

<p>诸如<code class="module"><a href="../mod/mod_macro.html">mod_macro</a></code>对于动态创建大量虚拟主机也很有用。</p>

<p>使用<code class="module"><a href="../mod/mod_rewrite.html">mod_rewrite</a></code>如果您使用的托管服务不提供对服务器配置文件的访问权限，则创建vitualhost可能是合适的，因此，您只能使用<code>.htaccess</code>文件。</p>

<p>请参阅<a href="vhosts.html">带有mod_rewrite</a>的<a href="vhosts.html">虚拟主机</a>文档，以获取有关在看起来仍然正确的方法下如何完成此操作的更多详细信息。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="proxy" id="proxy">简单代理</a></h2>

<p><code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>提供<a href="flags.html#flag_p">[P]</a>标志以通过传递重写的URI <code class="module"><a href="../mod/mod_proxy.html">mod_proxy</a></code> 。</p>

<pre class="prettyprint lang-config">RewriteRule "^/?images(.*)" "http://imageserver.local/images$1" [P]</pre>


<p>但是，在许多情况下，如上例所示，当不需要实际的模式匹配时， <code class="directive"><a href="../mod/mod_proxy.html#proxypass">ProxyPass</a></code>指令是更好的选择。这里的示例可以表示为：</p>

<pre class="prettyprint lang-config">ProxyPass "/images/" "http://imageserver.local/images/"</pre>


<p>请注意，无论您使用<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>要么<code class="directive"><a href="../mod/mod_proxy.html#proxypass">ProxyPass</a></code> ，您仍然需要使用<code class="directive"><a href="../mod/mod_proxy.html#proxypassreverse">ProxyPassReverse</a></code>指令以捕获从后端服务器发出的重定向：</p>

<pre class="prettyprint lang-config">ProxyPassReverse "/images/" "http://imageserver.local/images/"</pre>


<p>您可能需要使用<code>RewriteRule</code>相反，当有其他<code>RewriteRule</code>有效范围与<code>RewriteRule</code>通常会在<code>ProxyPass</code> ，因此可能会抢占您要完成的工作。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="setenv" id="setenv">环境变量测试</a></h2>

<p><code class="module"><a href="../mod/mod_rewrite.html">mod_rewrite</a></code>通常用于根据特定环境变量或请求标头的存在或不存在采取特定操作。使用以下命令可以更有效地完成此操作<code class="directive"><a href="../mod/core.html#if"><If></a></code> 。</p>

<p>考虑例如以下常见情况： <code class="directive">RewriteRule</code>用于强制规范的主机名，例如<code>www.example.com</code>代替<code>example.com</code> 。可以使用<code class="directive"><a href="../mod/core.html#if"><If></a></code>指令，如下所示：</p>

<pre class="prettyprint lang-config">&lt;If "req('Host') != 'www.example.com'"&gt;
    Redirect "/" "http://www.example.com/"
&lt;/If&gt;</pre>


<p>该技术可用于根据任何请求标头，响应标头或环境变量执行操作，以取代<code class="module"><a href="../mod/mod_rewrite.html">mod_rewrite</a></code>在许多常见情况下。</p>

<p>请参阅<a href="../expr.html">表达式评估文档</a> ，以获取有关可以在哪些类型的表达式中使用的概述。 <code class="directive"><a href="../mod/core.html#if"><If></a></code>部分以及某些其他指令中。</p>

</div></div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>

</body></html>