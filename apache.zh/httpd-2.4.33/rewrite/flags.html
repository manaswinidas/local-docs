<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>RewriteRule标志-Apache HTTP Server版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body id="manual-page" ><div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="<-" alt="<-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> > <a href="http://httpd.apache.org/">HTTP服务器</a> > <a href="http://httpd.apache.org/docs/">文档</a> > <a href="../index.html">版本2.4</a> > <a href="./index.html">重写</a></div><div id="page-content"><div id="preamble"><h1>RewriteRule标志</h1>


<p>本文档讨论了可用于<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>指令，提供详细的说明和示例。</p>
</div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><ul id="toc"><li><img alt="" src="../images/down.gif"> <a href="#introduction">介绍</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_b">B（转义反向引用）</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_bnp">BNP | backrefnoplus（不要将空格转义为+）</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_c">C |链</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_co">CO | cookie</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_dpi">DPI |丢弃路径</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_e">E | env</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_end">结束</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_f">F |禁止</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_g">G |消失</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_h">H |处理程序</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_l">L | last</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_n">N |下一个</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_nc">NC |无案</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_ne">NE | noescape</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_ns">NS | nosubreq</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_p">对|代理</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_pt">PT |直通</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_qsa">QSA | qsappend</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_qsd">QSD | qsdiscard</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_qsl">QSL | qslast</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_r">R |重定向</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_s">S |跳过</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#flag_t">T |类型</a></li>
</ul><h3>也可以看看</h3><ul class="seealso"><li><a href="../mod/mod_rewrite.html">模块文件</a></li><li><a href="intro.html">mod_rewrite简介</a></li><li><a href="remapping.html">重定向和重新映射</a></li><li><a href="access.html">控制访问</a></li><li><a href="vhosts.html">虚拟主机</a></li><li><a href="proxy.html">代理</a></li><li><a href="rewritemap.html">使用RewriteMap</a></li><li><a href="advanced.html">先进技术</a></li><li><a href="avoid.html">何时不使用mod_rewrite</a></li></ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="introduction" id="introduction">介绍</a></h2>
<p>一种<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>可以通过一个或多个标志来修改其行为。规则末尾的方括号中包含标志，多个标志之间用逗号分隔。</p>
<pre class="prettyprint lang-config">RewriteRule pattern target [Flag1,Flag2,Flag3]</pre>


<p>每个标志（除少数例外）都有一个简短的形式，例如<code>CO</code> ，以及更长的形式，例如<code>cookie</code> 。虽然最常用的是短格式，但建议您熟悉长格式，以便记住每个标志的作用。一些标志带有一个或多个参数。标志不区分大小写。</p>

<p>当在同一轮重写处理期间执行替换（“-”除外）时，更改与请求关联的元数据的标志（T =，H =，E =）在按目录和htaccess上下文中不起作用。
</p>

<p>这里提供了每个可用的标志，以及如何使用它们的示例。</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_b" id="flag_b">B（转义反向引用）</a></h2>
<p>[B]标志指示<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>在应用转换之前转义非字母数字字符。</p>
<p>在2.4.26及更高版本中，可以通过列出反向转义中的特定字符来限制转义： <code>[B=#?;]</code> 。注意：可以在字符列表中使用空格字符进行转义，但不能是列表中的最后一个字符。</p>

<p><code>mod_rewrite</code>必须先对URL进行转义，然后再对它们进行映射，因此在应用反向引用时不会对转义进行转义。使用B标志，反向引用中的非字母数字字符将被转义。例如，考虑以下规则：</p>

<pre class="prettyprint lang-config">RewriteRule "^search/(.*)$" "/search.php?term=$1"</pre>


<p>给定搜索词“ x＆y / z”，浏览器会将其编码为“ x％20％26％20y％2Fz”，从而发出请求“ search / x％20％26％20y％2Fz”。没有B标志，此重写规则将映射到'search.php?。term = x＆y / z'，这不是有效的网址，因此将被编码为<code>search.php?term=x%20&y%2Fz=</code> ，这不是预期的。</p>

<p>在此规则上设置B标志后，参数将被重新编码，然后再传递给输出URL，从而可以正确映射到<code>/search.php?term=x%20%26%20y%2Fz</code> 。</p>

<pre class="prettyprint lang-config">RewriteRule "^search/(.*)$" "/search.php?term=$1" [B,PT]</pre>


<p>请注意，您可能还需要设置<code class="directive"><a href="../mod/core.html#allowencodedslashes">AllowEncodedSlashes</a></code>至<code>On</code>为了使此特定示例正常工作，因为httpd不允许在URL中使用编码的斜杠，如果看到则返回404。</p>

<p>这种转义在代理情况下尤其必要，如果后端使用未转义的URL可能会损坏后端。</p>

<p>此标志的替代方法是使用<code class="directive"><a href="../mod/mod_rewrite.html#rewritecond">RewriteCond</a></code>针对％{THE_REQUEST}进行捕获，该捕获将以编码形式捕获字符串。</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_bnp" id="flag_bnp">BNP | backrefnoplus（不要将空格转义为+）</a></h2>
<p>[BNP]标志指示<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>在％20的后向引用中转义空格字符，而不是'+'。在路径组件而不是查询字符串中使用反向引用时很有用。</p>

<p>该标志在2.4.26及更高版本中可用。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_c" id="flag_c">C |链</a></h2>
<p>[C]或[chain]标志指示<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>链接到下一条规则。也就是说，如果规则匹配，则照常进行处理，然后控制移至下一条规则。但是，如果不匹配，则将跳过下一个规则以及链接在一起的任何其他规则。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_co" id="flag_co">CO | cookie</a></h2>
<p>[CO]或[cookie]标志可让您在特定的<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>火柴。该参数包含三个必填字段和四个可选字段。</p>

<p>该标志的完整语法，包括所有属性，如下所示：</p>

<div class="example"><p><code>[CO=NAME:VALUE:DOMAIN:lifetime:path:secure:httponly]</code></p></div>

<p>如果在任何cookie字段中都需要文字'：'字符，则可以使用其他语法。要选择使用其他语法，cookie的“名称”前应带有“;”字符，并且字段分隔符应指定为“;”。</p>

<div class="example"><p><code>[CO=;NAME;VALUE:MOREVALUE;DOMAIN;lifetime;path;secure;httponly]</code></p></div>

<p>您必须声明名称，值和域才能设置Cookie。</p>

<dl>
<dt>域</dt>
<dd>您希望Cookie有效的域。这可能是一个主机名，例如<code>www.example.com</code> ，也可能是一个域，例如<code>.example.com</code> 。它必须至少由两个点隔开。也就是说，它可能不仅是<code>.com</code>要么<code>.net</code> 。cookie安全模型禁止使用这种cookie。</dd>
</dl>

<p>您还可以选择设置以下值：</p>

<dl>
<dt>一生</dt>
<dd>Cookie将持续的时间（以分钟为单位）。</dd>
<dd>值为0表示cookie仅在当前浏览器会话中持久存在。如果未指定，则为默认值。</dd>

<dt>路径</dt>
<dd>Cookie在当前网站上有效的路径，例如<code>/customers/</code>要么<code>/files/download/</code> 。</dd>
<dd>默认情况下，此设置为<code>/</code> -即整个网站。</dd>

<dt>安全</dt>
<dd>如果设置为<code>secure</code> ， <code>true</code> ， 要么<code>1</code> ，则仅允许通过安全（https）连接来翻译Cookie。</dd>

<dt>httponly</dt>
<dd>如果设置为<code>HttpOnly</code> ， <code>true</code> ， 要么<code>1</code> ，该Cookie将具有<code>HttpOnly</code>标志集，这意味着在支持此功能的浏览器中，JavaScript代码无法访问Cookie。</dd>
</dl>

<p>考虑以下示例：</p>

<pre class="prettyprint lang-config">RewriteEngine On
RewriteRule "^/index\.html" "-" [CO=frontdoor:yes:.example.com:1440:/]</pre>


<p>在给出的示例中，规则不重写请求。 “-”重写目标告诉mod_rewrite通过不变的方式传递请求。而是将名为“前门”的cookie设置为“是”。Cookie对以下主机中的任何主机均有效<code>.example.com</code>域。它设置为在1440分钟（24小时）内到期，并为所有URI返回。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_dpi" id="flag_dpi">DPI |丢弃路径</a></h2>
<p>DPI标志导致重写的URI的PATH_INFO部分被丢弃。</p>
<p>此标志在2.2.12版和更高版本中可用。</p>
<p>在每个目录上下文中，每个URI <code class="directive">RewriteRule</code>与之比较的是URI和PATH_INFO的当前值的串联。</p>

<p>当前URI可以是客户端请求的初始URI，也可以是上一轮mod_rewrite处理的结果，也可以是当前一轮mod_rewrite处理中的先前规则的结果。</p>

<p>相反，在每条规则之前附加到URI的PATH_INFO仅反映此轮mod_rewrite处理之前的PATH_INFO的值。因此，如果URI的大部分都被匹配并复制为多个<code class="directive">RewriteRule</code>指令，而不考虑URI的哪些部分来自当前PATH_INFO，最终的URI可能会附加PATH_INFO的多个副本。</p>

<p>在不需要此请求到文件系统的先前映射而导致的PATH_INFO的任何替换中，请使用此标志。该标志永久忘记在此轮mod_rewrite处理开始之前建立的PATH_INFO。在当前一轮的mod_rewrite处理完成之前，不会重新计算PATH_INFO。在这一轮处理中的后续规则将仅看到替换的直接结果，而未附加任何PATH_INFO。</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_e" id="flag_e">E | env</a></h2>
<p>使用[E]或[env]标志，可以设置环境变量的值。请注意，运行规则后可能会设置一些环境变量，从而取消设置的内容。有关<a href="../env.html">环境变量</a>如何工作的更多详细信息，请参见<a href="../env.html">环境变量文档</a> 。</p>

<p>此标志的完整语法为：</p>

<pre class="prettyprint lang-config">[E=VAR:VAL]
[E=!VAR]</pre>


<p><code>VAL</code>可能包含反向引用（ <code>$N</code>要么<code>%N</code> ）展开。</p>

<p>使用简写形式</p>

<div class="example"><p><code>[E=VAR]</code></p></div>

<p>您可以设置名为<code>VAR</code>到一个空值。</p>

<p>表格</p>

<div class="example"><p><code>[E=!VAR]</code></p></div>

<p>允许取消设置先前设置的名为<code>VAR</code> 。</p>

<p>然后可以在各种上下文中使用环境变量，包括CGI程序，其他RewriteRule指令或CustomLog指令。</p>

<p>如果请求的URI是图像文件，则以下示例将名为“ image”的环境变量设置为“ 1”。然后，该环境变量用于从访问日志中排除那些请求。</p>

<pre class="prettyprint lang-config">RewriteRule "\.(png|gif|jpg)$" "-" [E=image:1]
CustomLog "logs/access_log" combined env=!image</pre>


<p>请注意，使用<code class="directive"><a href="../mod/mod_setenvif.html#setenvif">SetEnvIf</a></code> 。提供此技术仅作为示例，而不作为推荐。</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_end" id="flag_end">结束</a></h2>
<p>使用[END]标志不仅终止当前的重写处理（如[L]），而且还可以防止在每个目录（htaccess）上下文中发生任何后续的重写处理。</p>

<p>这不适用于外部重定向产生的新请求。</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_f" id="flag_f">F |禁止</a></h2>
<p>使用[F]标志会使服务器向客户端返回403 Forbidden状态代码。虽然可以使用<code class="directive"><a href="../mod/mod_access_compat.html#deny">Deny</a></code>指令，这在分配禁止状态方面提供了更大的灵活性。</p>

<p>以下规则将禁止<code>.exe</code>从您的服务器下载文件。</p>

<pre class="prettyprint lang-config">RewriteRule "\.exe" "-" [F]</pre>


<p>本示例对重写目标使用“-”语法，这意味着未修改请求的URI。如果您要禁止该请求，则没有理由重写为另一个URI。</p>

<p>当使用[F]时，意味着[L]-即立即返回响应，并且不评估其他规则。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_g" id="flag_g">G |消失</a></h2>
<p>[G]标志强制服务器返回410 Gone状态和响应。这表明资源曾经可用，但不再可用。</p>

<p>与[F]标志一样，在使用[G]标志时，通常会将“-”语法用于重写目标：</p>

<pre class="prettyprint lang-config">RewriteRule "oldproduct" "-" [G,NC]</pre>


<p>使用[G]时，隐含一个[L]-即立即返回响应，并且不评估其他规则。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_h" id="flag_h">H |处理程序</a></h2>
<p>强制使用指定的处理程序处理结果请求。例如，一个人可能会用它来强制所有没有文件扩展名的文件被php处理程序解析：</p>

<pre class="prettyprint lang-config">RewriteRule "!\." "-" [H=application/x-httpd-php]</pre>


<p>上面的正则表达式- <code>!\.</code> -将匹配任何不包含文字的请求<code>.</code>字符。
</p>

<p>这也可以用于根据某些条件强制处理程序。例如，在每个服务器上下文中使用的以下代码段允许<code>.php</code>要<em>显示</em>的文件<code>mod_php</code>如果要求他们与<code>.phps</code>延期：</p>

<pre class="prettyprint lang-config">RewriteRule "^(/source/.+\.php)s$" "$1" [H=application/x-httpd-php-source]</pre>


<p>上面的正则表达式- <code>^(/source/.+\.php)s$</code> -将匹配以开头的任何请求<code>/source/</code>后跟1个或n个字符，后跟<code>.phps</code>从字面上看。向后引用$ 1引用正则表达式括号内的已捕获匹配。</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_l" id="flag_l">L | last</a></h2>
<p>[L]标志导致<code class="module"><a href="../mod/mod_rewrite.html">mod_rewrite</a></code>停止处理规则集。在大多数情况下，这意味着如果规则匹配，将不再处理其他规则。这对应于<code>last</code> Perl中的命令，或者<code>break</code>使用此标志指示应立即应用当前规则，而不考虑其他规则。</p>

<p>如果您正在使用<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>在任一<code>.htaccess</code>文件或<code class="directive"><a href="../mod/core.html#directory"><Directory></a></code>部分，一定要对规则的处理方式有所了解。简化形式是，一旦处理完规则，重写的请求就会交回URL解析引擎以执行可能的操作。随着改写请求的处理， <code>.htaccess</code>文件或<code class="directive"><a href="../mod/core.html#directory"><Directory></a></code>可能会再次遇到该节，因此规则集可能会从头开始再次运行。最常见的情况是，如果其中一个规则导致重定向（内部或外部）导致请求过程重新开始，则将发生这种情况。</p>

<p>因此，重要的是，如果您使用<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>在这些上下文之一中的指令中，您需要采取显式步骤来避免规则循环，而不是仅仅依靠[L]标志来终止一系列规则的执行，如下所示。</p>

<p>替代标志[END]不仅可以用于终止当前的重写处理，而且还可以防止在每个目录（htaccess）上下文中发生任何后续的重写处理。这不适用于外部重定向产生的新请求。</p>

<p>此处给出的示例将重写对<code>index.php</code> ，将原始请求作为查询字符串参数提供给<code>index.php</code> ， 然而<code class="directive"><a href="../mod/mod_rewrite.html#rewritecond">RewriteCond</a></code>确保请求是否已经针对<code>index.php</code> ， <code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>将被跳过。</p>

<pre class="prettyprint lang-config">RewriteBase "/"
RewriteCond "%{REQUEST_URI}" "!=/index.php"
RewriteRule "^(.*)" "/index.php?req=$1" [L,PT]</pre>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_n" id="flag_n">N |下一个</a></h2>
<p>[N]标志使用规则集的结果作为起点，使规则集从顶部重新开始。使用时要格外小心，因为这可能会导致循环。
</p>
<p>例如，如果您希望在请求中重复替换某个字符串或字母，则可以使用[Next]标志。此处显示的示例将在请求中的所有位置将A替换为B，并将继续这样做，直到不再有替换的A。
</p>
<pre class="prettyprint lang-config">RewriteRule "(.*)A(.*)" "$1B$2" [N]</pre>

<p>您可以将其视为<code>while</code>循环：虽然此模式仍然匹配（即URI仍包含<code>A</code> ），执行此替换（即替换<code>A</code>与一个<code>B</code> ）。</p>

<p>在2.4.8及更高版本中，此模块在32,000次迭代后返回错误，以防止意外循环。可以通过添加到N标志来指定替代的最大迭代次数。</p>
<pre class="prettyprint lang-config"># Be willing to replace 1 character in each pass of the loop
RewriteRule "(.+)[&gt;&lt;;]$" "$1" [N=64000]
# ... or, give up if after 10 loops
RewriteRule "(.+)[&gt;&lt;;]$" "$1" [N=10]</pre>


</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_nc" id="flag_nc">NC |无案</a></h2>
<p>使用[NC]标志会导致<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>以不区分大小写的方式进行匹配。也就是说，不在乎字母在匹配的URI中是大写还是小写。</p>

<p>在下面的示例中，对图像文件的任何请求都将被代理到您的专用图像服务器。匹配不区分大小写，因此<code>.jpg</code>和<code>.JPG</code>例如，两个文件都是可以接受的。</p>

<pre class="prettyprint lang-config">RewriteRule "(.*\.(jpg|gif|png))$" "http://images.example.com$1" [P,NC]</pre>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_ne" id="flag_ne">NE | noescape</a></h2>
<p>默认情况下，特殊字符，例如<code>&</code>和<code>?</code> ，例如，将被转换为其等效的十六进制代码。使用[NE]标志可以防止这种情况的发生。
</p>

<pre class="prettyprint lang-config">RewriteRule "^/anchor/(.+)" "/bigpage.html#$1" [NE,R]</pre>


<p>上面的示例将重定向<code>/anchor/xyz</code>至<code>/bigpage.html#xyz</code> 。省略[NE]将导致＃转换为等效的十六进制代码， <code>%23</code> ，这将导致404 Not Found错误情况。
</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_ns" id="flag_ns">NS | nosubreq</a></h2>
<p>使用[NS]标志可防止在子请求中使用该规则。例如，使用SSI（服务器端包含）包含的页面是一个子请求，您可能希望避免在这些子请求上发生重写。而且，当<code class="module"><a href="../mod/mod_dir.html">mod_dir</a></code>尝试找出有关可能的目录默认文件（例如<code>index.html</code>文件），这是一个内部子请求，因此您通常希望避免对此类子请求进行重写。如果应用了完整的规则集，则在子请求上，它并不总是有用的，甚至可能导致错误。使用此标志排除有问题的规则。</p>

<p>决定是否使用此规则：如果给URL加上CGI脚本前缀，以迫使它们由CGI脚本处理，则可能会在子请求上遇到问题（或大量开销）。在这些情况下，请使用此标志。</p>

<p>作为HTML页面的一部分加载的图像，JavaScript文件或CSS文件不是子请求-浏览器将它们作为单独的HTTP请求进行请求。
</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_p" id="flag_p">对|代理</a></h2>
<p>使用[P]标志会使请求由<code class="module"><a href="../mod/mod_proxy.html">mod_proxy</a></code> ，并通过代理请求进行处理。例如，如果您希望所有图像请求都由后端图像服务器处理，则可以执行以下操作：</p>

<pre class="prettyprint lang-config">RewriteRule "/(.*)\.(jpg|gif|png)$" "http://images.example.com/$1.$2" [P]</pre>


<p>[P]标志的使用表示[L]-即，该请求将立即通过代理推送，并且不会考虑任何以下规则。</p>

<p>您必须确保替换字符串是有效的URI（通常以<code>http://</code> <em>主机名</em> ）可以由<code class="module"><a href="../mod/mod_proxy.html">mod_proxy</a></code> 。如果没有，您将从代理模块收到错误。使用此标志可实现更强大的<code class="directive"><a href="../mod/mod_proxy.html#proxypass">ProxyPass</a></code>指令，将远程内容映射到本地服务器的名称空间。</p>

<div class="warning">
<h3>安全警告</h3>
<p>在构造规则的目标URL时，请注意考虑到允许客户端影响服务器将用作代理的URL集对安全性的影响。确保URL的方案和主机名部分是固定的，或者不允许客户端产生不适当的影响。</p>
</div>

<div class="warning">
<h3>性能警告</h3>
<p>使用此标志触发使用<code class="module"><a href="../mod/mod_proxy.html">mod_proxy</a></code> ，无需处理持久连接。这意味着如果您将其设置为，则代理的性能会更好<code class="directive"><a href="../mod/mod_proxy.html#proxypass">ProxyPass</a></code>要么<code class="directive"><a href="../mod/mod_proxy.html#proxypassmatch">ProxyPassMatch</a></code></p>
<p>这是因为此标志触发使用默认工作程序，该默认工作程序不处理连接池/重用。</p>
<p>避免使用此标志，并尽可能使用这些指令。</p>
</div>

<p>注意： <code class="module"><a href="../mod/mod_proxy.html">mod_proxy</a></code>必须启用才能使用此标志。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_pt" id="flag_pt">PT |直通</a></h2>

<p>默认情况下，假定RewriteRule中的目标（或替换字符串）为文件路径。使用[PT]标志会导致将其视为URI。也就是说，使用[PT]标志会导致<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>通过网址映射传回，这样基于位置的映射（例如<code class="directive"><a href="../mod/mod_alias.html#alias">Alias</a></code> ， <code class="directive"><a href="../mod/mod_alias.html#redirect">Redirect</a></code> ， 要么<code class="directive"><a href="../mod/mod_alias.html#scriptalias">ScriptAlias</a></code> ，例如，可能有机会生效。
</p>

<p>例如，如果您有一个<code class="directive"><a href="../mod/mod_alias.html#alias">Alias</a></code> / icons，并有一个<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>指向那里，您应该使用[PT]标志来确保<code class="directive"><a href="../mod/mod_alias.html#alias">Alias</a></code>被评估。
</p>

<pre class="prettyprint lang-config">Alias "/icons" "/usr/local/apache/icons"
RewriteRule "/pics/(.+)\.jpg$" "/icons/$1.gif" [PT]</pre>


<p>在这种情况下省略[PT]标志将导致别名被忽略，从而导致返回“找不到文件”错误。
</p>

<p>的<code>PT</code>标志意味着<code>L</code>标志：重写将被停止，以便将请求传递到下一个处理阶段。</p>

<p>请注意<code>PT</code>每个目录上下文中都隐含该标志，例如<code class="directive"><a href="../mod/core.html#directory"><Directory></a></code>部分或中<code>.htaccess</code>文件。避免的唯一方法是重写为<code>-</code> 。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_qsa" id="flag_qsa">QSA | qsappend</a></h2>
<p>当替换URI包含查询字符串时，默认行为<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>是丢弃现有的查询字符串，并将其替换为新生成的查询字符串。使用[QSA]标志会使查询字符串组合在一起。
</p>

<p>请考虑以下规则：</p>

<pre class="prettyprint lang-config">RewriteRule "/pages/(.+)" "/page.php?page=$1" [QSA]</pre>


<p>带有[QSA]标志的请求<code>/pages/123?one=two</code>将被映射到<code>/page.php?page=123&one=two</code> 。没有[QSA]标志，该请求将被映射到<code>/page.php?page=123</code> -也就是说，现有查询字符串将被丢弃。
</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_qsd" id="flag_qsd">QSD | qsdiscard</a></h2>
<p>当请求的URI包含查询字符串，而目标URI不包含查询字符串时，默认行为是<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>是将该查询字符串复制到目标URI。使用[QSD]标志会导致查询字符串被丢弃。
</p>

<p>此标志在2.4.0及更高版本中可用。</p>

<p>一起使用[QSD]和[QSA]将导致[QSD]优先。
</p>

<p>如果目标URI具有查询字符串，则将遵循默认行为-也就是说，原始查询字符串将被丢弃，并替换为查询字符串中的查询字符串。 <code>RewriteRule</code>目标URI。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_qsl" id="flag_qsl">QSL | qslast</a></h2>
<p>默认情况下，替换中的第一个（最左边）问号会分隔查询字符串的路径。使用[QSL]标志指示<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>而是使用最后一个（最右边的）问号拆分两个组件。</p>

<p>当映射到文件名中带有文字问号的文件时，这很有用。如果替换中未使用任何查询字符串，则可以与此标志一起附加问号。</p>

<p>该标志在2.4.19版和更高版本中可用。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_r" id="flag_r">R |重定向</a></h2>
<p>使用[R]标志会导致向浏览器发出HTTP重定向。如果指定了完全限定的网址（即，包括<code>http://servername/</code> ），然后将重定向到该位置。否则，将使用当前协议，服务器名称和端口号来生成随重定向发送的URL。
</p>

<p>
可以使用语法[R = 305]指定<em>任何</em>有效的HTTP响应状态代码，如果未指定，则默认使用302状态代码。指定的状态代码不必一定是重定向（3xx）状态代码。但是，如果状态代码不在重定向范围（300-399）中，则替换字符串将被完全删除，并且重写将停止，就像<code>L</code>被使用。</p>

<p>除了响应状态代码外，您还可以使用其符号名称指定重定向状态： <code>temp</code> （默认）， <code>permanent</code> ， 要么<code>seeother</code> 。</p>

<p>您几乎总是希望将[R]与[L]结合使用（即，使用[R，L]），因为[R]标志本身就位于前面<code>http://thishost[:thisport]</code>到URI，然后将其传递给规则集中的下一条规则，这通常会导致“请求中出现无效的URI”警告。
</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_s" id="flag_s">S |跳过</a></h2>
<p>[S]标志用于跳过您不想运行的规则。跳过标志的语法为[S = <em>N</em> ]，其中<em>N</em>表示要跳过的规则数（前提是<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule"> RewriteRule</a></code>火柴）。这可以被认为是<code>goto</code>重写规则集中的语句。在以下示例中，我们只想运行<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>如果请求的URI与实际文件不符。</p>

<pre class="prettyprint lang-config"># Is the request for a non-existent file?
RewriteCond "%{REQUEST_FILENAME}" "!-f"
RewriteCond "%{REQUEST_FILENAME}" "!-d"
# If so, skip these two RewriteRules
RewriteRule ".?" "-" [S=2]

RewriteRule "(.*\.gif)" "images.php?$1"
RewriteRule "(.*\.html)" "docs.php?$1"</pre>


<p>这项技术很有用，因为<code class="directive"><a href="../mod/mod_rewrite.html#rewritecond">RewriteCond</a></code>仅适用于<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>立即跟随它。因此，如果您想<code>RewriteCond</code>适用于几个<code>RewriteRule</code>例如，一种可能的技术是消除这些条件并添加一个<code>RewriteRule</code>带有[Skip]标志。您可以使用它来构造伪if-then-else构造：then子句的最后一条规则变为<code>skip=N</code> ，其中N是else子句中的规则数：</p>
<pre class="prettyprint lang-config"># Does the file exist?
RewriteCond "%{REQUEST_FILENAME}" "!-f"
RewriteCond "%{REQUEST_FILENAME}" "!-d"
# Create an if-then-else construct by skipping 3 lines if we meant to go to the "else" stanza.
RewriteRule ".?" "-" [S=3]

# IF the file exists, then:
    RewriteRule "(.*\.gif)" "images.php?$1"
    RewriteRule "(.*\.html)" "docs.php?$1"
    # Skip past the "else" stanza.
    RewriteRule ".?" "-" [S=1]
# ELSE...
    RewriteRule "(.*)" "404.php?file=$1"
# END</pre>


<p>使用以下命令完成这种配置可能会更容易<code class="directive"><If></code> ， <code class="directive"><ElseIf></code>和<code class="directive"><Else></code>指令代替。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="flag_t" id="flag_t">T |型</a></h2>
<p>设置将发送结果响应的MIME类型。这与<code class="directive"><a href="../mod/mod_mime.html#addtype">AddType</a></code>指示。</p>

<p>例如，如果以特殊方式请求，则可以使用以下技术将Perl源代码作为纯文本提供：</p>

<pre class="prettyprint lang-config"># Serve .pl files as plain text
RewriteRule "\.pl$" "-" [T=text/plain]</pre>


<p>或者，也许，如果您有一台摄像机生成不带文件扩展名的jpeg图像，则可以凭借其文件名强制为这些图像提供正确的MIME类型：</p>

<pre class="prettyprint lang-config"># Files with 'IMG' in the name are jpg images.
RewriteRule "IMG" "-" [T=image/jpg]</pre>


<p>请注意，这是一个简单的例子，最好使用<code class="directive"><a href="../mod/core.html#filesmatch"><FilesMatch></a></code>代替。在诉诸重写之前，请务必考虑问题的替代解决方案，这总是比替代方案效率低下。</p>

<p>如果在每个目录的上下文中使用，则仅使用<code>-</code> （破折号）替代<em>整个回合的mod_rewrite处理</em> ，否则，由于内部重新处理（包括后续回合的mod_rewrite处理），设置有此标志的MIME类型将丢失。的<code>L</code>标志在这种情况下对于结束<em>当前</em>一轮的mod_rewrite处理很有用。</p>

</div></div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>

</body></html>