<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>Apache HTTP Server教程：.htaccess文件-Apache HTTP Server版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body id="manual-page" ><div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="<-" alt="<-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> > <a href="http://httpd.apache.org/">HTTP服务器</a> > <a href="http://httpd.apache.org/docs/">文档</a> > <a href="../index.html">版本2.4</a> >操作方法<a href="./index.html">/教程</a></div><div id="page-content"><div id="preamble"><h1>Apache HTTP Server教程：.htaccess文件</h1>


<p><code>.htaccess</code>文件提供了一种基于目录进行配置更改的方法。</p>
</div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><ul id="toc"><li><img alt="" src="../images/down.gif"> <a href="#related">.htaccess文件</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#what">它们是什么/如何使用</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#when">何时（不使用）.htaccess文件</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#how">指令如何应用</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#auth">认证示例</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#ssi">服务器端包含示例</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#rewrite">重写.htaccess文件中的规则</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#cgi">CGI范例</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#troubleshoot">故障排除</a></li>
</ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="related" id="related">.htaccess文件</a></h2>
    <table class="related"><tbody><tr><th>相关模块</th><th>相关指令</th></tr><tr><td><ul><li><code class="module"><a href="../mod/core.html">core</a></code></li><li><code class="module"><a href="../mod/mod_authn_file.html">mod_authn_file</a></code></li><li><code class="module"><a href="../mod/mod_authz_groupfile.html">mod_authz_groupfile</a></code></li><li><code class="module"><a href="../mod/mod_cgi.html">mod_cgi</a></code></li><li><code class="module"><a href="../mod/mod_include.html">mod_include</a></code></li><li><code class="module"><a href="../mod/mod_mime.html">mod_mime</a></code></li></ul></td><td><ul><li><code class="directive"><a href="../mod/core.html#accessfilename">AccessFileName</a></code></li><li><code class="directive"><a href="../mod/core.html#allowoverride">AllowOverride</a></code></li><li><code class="directive"><a href="../mod/core.html#options">Options</a></code></li><li><code class="directive"><a href="../mod/mod_mime.html#addhandler">AddHandler</a></code></li><li><code class="directive"><a href="../mod/core.html#sethandler">SetHandler</a></code></li><li><code class="directive"><a href="../mod/mod_authn_core.html#authtype">AuthType</a></code></li><li><code class="directive"><a href="../mod/mod_authn_core.html#authname">AuthName</a></code></li><li><code class="directive"><a href="../mod/mod_authn_file.html#authuserfile">AuthUserFile</a></code></li><li><code class="directive"><a href="../mod/mod_authz_groupfile.html#authgroupfile">AuthGroupFile</a></code></li><li><code class="directive"><a href="../mod/mod_authz_core.html#require">Require</a></code></li></ul></td></tr></tbody></table>

    <div class="note">你应该避免使用<code>.htaccess</code>如果您有权访问httpd主服务器配置文件，则文件完全可用。使用<code>.htaccess</code>文件会降低您的Apache http服务器的速度。您可以在<code>.htaccess</code>文件最好设置在<code class="directive"><a href="../mod/core.html#directory">Directory</a></code>块，因为它将具有相同的效果和更好的性能。</div>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="what" id="what">它们是什么/如何使用</a></h2>


    <p><code>.htaccess</code>文件（或“分布式配置文件”）提供了一种基于每个目录进行配置更改的方法。包含一个或多个配置指令的文件放置在特定的文档目录中，这些指令适用于该目录及其所有子目录。</p>

    <div class="note"><h3>注意：</h3>
      <p>如果你想打电话给你<code>.htaccess</code>文件，您可以使用<code class="directive"><a href="../mod/core.html#accessfilename">AccessFileName</a></code>指示。例如，如果您希望调用该文件<code>.config</code>然后可以将以下内容放入服务器配置文件中：</p>

      <pre class="prettyprint lang-config">AccessFileName ".config"</pre>

    </div>

    <p>一般来说， <code>.htaccess</code>文件使用与<a href="../configuring.html#syntax">主要配置文件</a>相同的语法。您可以在这些文件中放置的内容取决于<code class="directive"><a href="../mod/core.html#allowoverride">AllowOverride</a></code>指示。该指令按类别指定了如果在目录中找到了哪些指令，则可以使用这些指令。 <code>.htaccess</code>文件。如果指令允许<code>.htaccess</code>文件，该指令的文档将包含一个Override节，指定必须在其中包含什么值<code class="directive"><a href="../mod/core.html#allowoverride">AllowOverride</a></code>为了允许该指令。</p>

    <p>例如，如果您查看有关<code class="directive"><a href="../mod/core.html#adddefaultcharset">AddDefaultCharset</a></code>指令，您会发现它在<code>.htaccess</code>文件。（请参阅指令摘要中的“上下文”行。）<a href="../mod/directive-dict.html#Context">替代</a>行显示为<code>FileInfo</code> 。因此，您必须至少<code>AllowOverride FileInfo</code>为了遵守该指令<code>.htaccess</code>文件。</p>

    <div class="example"><h3>例：</h3><table>
        <tbody><tr>
          <td><a href="../mod/directive-dict.html#Context">内容：</a></td>
          <td>服务器配置，虚拟主机，目录，.htaccess</td>
        </tr>

        <tr>
          <td><a href="../mod/directive-dict.html#Override">覆写：</a></td>
          <td>文件信息</td>
        </tr>
      </tbody></table></div>

    <p>如果您不确定是否允许特定指令<code>.htaccess</code>文件，查看该指令的文档，然后检查“ .htaccess”的上下文行。</p>
    </div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="when" id="when">何时（不使用）.htaccess文件</a></h2>

    <p>通常，您只能使用<code>.htaccess</code>当您无权访问主服务器配置文件时。例如，存在一个普遍的误解，即用户身份验证应始终在<code>.htaccess</code>文件，并且在最近几年，另一个误解是<code class="module"><a href="../mod/mod_rewrite.html">mod_rewrite</a></code>指令必须加入<code>.htaccess</code>文件。这根本不是那么回事。您可以将用户身份验证配置放在主服务器配置中，实际上，这是首选的处理方式。同样<code>mod_rewrite</code>伪指令在主服务器配置中的许多方面效果更好。</p>

    <p><code>.htaccess</code>如果内容提供者需要按目录对服务器进行配置更改，但在服务器系统上没有root用户访问权限，则应使用这些文件。如果服务器管理员不愿意频繁更改配置，则可能希望允许各个用户在服务器中进行这些更改。 <code>.htaccess</code>自己存档。例如，在ISP在单个计算机上托管多个用户站点并希望其用户能够更改其配置的情况下，尤其如此。</p>

    <p>但是，一般而言， <code>.htaccess</code>应尽可能避免使用文件。您会考虑放入的任何配置<code>.htaccess</code>文件，可以同样有效地制作<code class="directive"><a href="../mod/core.html#directory"><Directory></a></code>主服务器配置文件中的“部分”。</p>

    <p>避免使用的主要原因有两个<code>.htaccess</code>文件。</p>

    <p>首先是性能。什么时候<code class="directive"><a href="../mod/core.html#allowoverride">AllowOverride</a></code>设置为允许使用<code>.htaccess</code>文件，httpd将在每个目录中查找<code>.htaccess</code>文件。因此，允许<code>.htaccess</code>文件是否会影响性能，无论您是否实际使用它们！另外， <code>.htaccess</code>每次请求文档时都会加载文件。</p>

    <p>进一步注意，httpd必须寻找<code>.htaccess</code>所有高级目录中的文件，以便具有必须应用的指令的完整补充。（请参阅有关<a href="#how">如何应用指令的部分</a> 。）因此，如果从目录中请求文件<code>/www/htdocs/example</code> ，httpd必须查找以下文件：</p>

    <div class="example"><p><code>/.htaccess<br> /www/.htaccess<br> /www/htdocs/.htaccess<br> /www/htdocs/example/.htaccess</code></p></div>

    <p>因此，对于该目录之外的每个文件访问，将有4个其他文件系统访问，即使这些文件都不存在。（请注意，只有在<code>.htaccess</code>文件已启用<code>/</code> ，通常情况并非如此。）</p>

    <p>如果是<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>指令，在<code>.htaccess</code>在上下文中，必须对目录的每个请求都重新编译这些正则表达式，而在主服务器配置上下文中，它们将被编译一次并进行缓存。此外，规则本身也更加复杂，因为必须围绕每个目录上下文和<code>mod_rewrite</code> 。有关此主题的更多详细信息，请参考《 <a href="../rewrite/intro.html#htaccess">重写指南》</a> 。</p>

    <p>第二个考虑因素是安全性。您允许用户修改服务器配置，这可能会导致您无法控制的更改。请仔细考虑您是否要授予用户此特权。还请注意，为用户提供少于其所需权限的特权将导致其他技术支持请求。确保您清楚地告诉用户您所授予的特权级别。确切指定您已设置的内容<code class="directive"><a href="../mod/core.html#allowoverride">AllowOverride</a></code>并将它们指向相关文档，以后会为您省去很多麻烦。</p>

    <p>请注意，放一个<code>.htaccess</code>目录中的文件<code>/www/htdocs/example</code>包含指令，并将同一指令放入“目录”部分<code><Directory "/www/htdocs/example"></code>在您的主服务器配置中：</p>

    <p><code>.htaccess</code>归档在<code>/www/htdocs/example</code> ：</p>

    <div class="example"><h3>.htaccess文件的内容<code>/www/htdocs/example</code></h3><pre class="prettyprint lang-config">AddType text/example ".exm"</pre>
</div>

    <div class="example"><h3>您的部分<code>httpd.conf</code>文件</h3><pre class="prettyprint lang-config">&lt;Directory "/www/htdocs/example"&gt;
    AddType text/example ".exm"
&lt;/Directory&gt;</pre>
</div>

    <p>但是，将此配置放入服务器配置文件将减少性能影响，因为该配置在httpd启动时加载一次，而不是在每次请求文件时加载。</p>

    <p>指某东西的用途<code>.htaccess</code>可以通过设置<code class="directive"><a href="../mod/core.html#allowoverride">AllowOverride</a></code>指令<code>none</code> ：</p>

    <pre class="prettyprint lang-config">AllowOverride None</pre>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="how" id="how">指令如何应用</a></h2>

    <p>可以在<code>.htaccess</code>文件将应用于其中的目录<code>.htaccess</code>找到文件及其所有子目录。但是，重要的是要记住， <code>.htaccess</code>目录中更高的文件。指令按照找到的顺序应用。因此， <code>.htaccess</code>特定目录中的文件可能会覆盖在<code>.htaccess</code>在目录树中找到更高的文件。而这些反过来可能在更高的位置或在主服务器配置文件本身中找到了覆盖的指令。</p>

    <p>例：</p>

    <p>在目录中<code>/www/htdocs/example1</code>我们有一个<code>.htaccess</code>包含以下内容的文件：</p>

    <pre class="prettyprint lang-config">Options +ExecCGI</pre>


    <p>（注意：您必须具有“ <code>AllowOverride Options</code> “实际上是允许使用“ <code class="directive"><a href="../mod/core.html#options">Options</a></code> “中的指令<code>.htaccess</code>文件。）</p>

    <p>在目录中<code>/www/htdocs/example1/example2</code>我们有一个<code>.htaccess</code>文件包含：</p>

    <pre class="prettyprint lang-config">Options Includes</pre>


    <p>因为这个第二<code>.htaccess</code>文件，在目录中<code>/www/htdocs/example1/example2</code> ，仅允许CGI执行<code>Options Includes</code>是有效的，它会完全覆盖以前可能已在使用的任何设置。</p>

    <h3><a name="merge" id="merge">合并.htaccess与主要配置文件</a></h3>

    <p>如<a href="../sections.html">配置部分</a>文档中所述， <code>.htaccess</code>文件可以覆盖<code class="directive"><a href="../mod/core.html#directory"><Directory></a></code>相应目录的部分，但将被主要配置文件中的其他类型的配置部分覆盖。即使存在自由主义者，这一事实也可以用于强制执行某些配置。 <code class="directive"><a href="../mod/core.html#allowoverride">AllowOverride</a></code>设置。例如，为了防止执行脚本同时允许在其中设置其他任何内容<code>.htaccess</code>您可以使用：</p>

    <pre class="prettyprint lang-config">&lt;Directory "/www/htdocs"&gt;
    AllowOverride All
&lt;/Directory&gt;

&lt;Location "/"&gt;
    Options +IncludesNoExec -ExecCGI
&lt;/Location&gt;</pre>


    <div class="note">本示例假设您的<code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code>是<code>/www/htdocs</code> 。</div>


</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="auth" id="auth">认证示例</a></h2>

    <p>如果您直接跳到文档的这一部分以了解如何进行身份验证，那么注意一件事很重要。有一个常见的误解，要求您使用<code>.htaccess</code>文件以实现密码验证。不是这种情况。将身份验证指令放在<code class="directive"><a href="../mod/core.html#directory"><Directory></a></code>主服务器配置文件中的“部分”是实现此目的的首选方法，并且<code>.htaccess</code>仅当您无权访问主服务器配置文件时，才应使用这些文件。请参阅<a href="#when">上文</a> ，了解何时应该使用和不应该使用<code>.htaccess</code>文件。</p>

    <p>话虽如此，如果您仍然认为您需要使用<code>.htaccess</code>文件，您可能会发现以下配置可能对您有用。</p>

    <p><code>.htaccess</code>文件内容：</p>

    <pre class="prettyprint lang-config">AuthType Basic
AuthName "Password Required"
AuthUserFile "/www/passwords/password.file"
AuthGroupFile "/www/passwords/group.file"
Require group admins</pre>


    <p>注意<code>AllowOverride AuthConfig</code>必须有效，这些指令才能生效。</p>

    <p>请参阅<a href="auth.html">身份验证教程</a> ，以更全面地讨论身份验证和授权。</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="ssi" id="ssi">服务器端包含示例</a></h2>

    <p>的另一种常见用法<code>.htaccess</code>文件用于为特定目录启用服务器端包含。这可以通过以下配置指令来完成： <code>.htaccess</code>文件放在所需目录中：</p>

    <pre class="prettyprint lang-config">Options +Includes
AddType text/html shtml
AddHandler server-parsed shtml</pre>


    <p>注意<code>AllowOverride Options</code>和<code>AllowOverride FileInfo</code>必须都同时生效，这些指令才能生效。</p>

    <p>请参阅<a href="ssi.html">SSI教程</a> ，以更全面地讨论服务器端包含。</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="rewrite" id="rewrite">重写.htaccess文件中的规则</a></h2>
<p>使用时<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code>在<code>.htaccess</code>文件，请注意每个目录的上下文会稍有改变。特别是，规则被视为相对于当前目录，而不是原始请求的URI。考虑以下示例：</p>

<pre class="prettyprint lang-config"># In httpd.conf
RewriteRule "^/images/(.+)\.jpg" "/images/$1.png"

# In .htaccess in root dir
RewriteRule "^images/(.+)\.jpg" "images/$1.png"

# In .htaccess in images/
RewriteRule "^(.+)\.jpg" "$1.png"</pre>


<p>在一个<code>.htaccess</code>在您的文档目录中，前导斜杠将从提供给<code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code> ，并在<code>images</code>子目录， <code>/images/</code>从中删除。因此，您的正则表达式也需要省略该部分。</p>

<p>有关使用的更多详细信息，请查阅<a href="../rewrite/index.html">mod_rewrite文档</a> 。 <code>mod_rewrite</code> 。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="cgi" id="cgi">CGI范例</a></h2>

    <p>最后，您可能希望使用<code>.htaccess</code>文件以允许在特定目录中执行CGI程序。这可以通过以下配置实现：</p>

    <pre class="prettyprint lang-config">Options +ExecCGI
AddHandler cgi-script cgi pl</pre>


    <p>或者，如果希望将给定目录中的所有文件都视为CGI程序，则可以使用以下配置来完成：</p>

    <pre class="prettyprint lang-config">Options +ExecCGI
SetHandler cgi-script</pre>


    <p>注意<code>AllowOverride Options</code>和<code>AllowOverride FileInfo</code>必须都同时生效，这些指令才能生效。</p>

    <p>请参阅<a href="cgi.html">CGI教程</a> ，以更全面地讨论CGI编程和配置。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="troubleshoot" id="troubleshoot">故障排除</a></h2>

    <p>当您将配置指令放在<code>.htaccess</code>文件，而您没有得到理想的效果，可能有很多事情出了问题。</p>

    <p>最常见的问题是<code class="directive"><a href="../mod/core.html#allowoverride">AllowOverride</a></code>未设置为不遵守您的配置指令。确保您没有<code>AllowOverride None</code>对所涉及的文件范围有效。一个很好的测试是将垃圾放入您的<code>.htaccess</code>文件并重新加载页面。如果未生成服务器错误，则几乎可以肯定<code>AllowOverride None</code>有效。</p>

    <p>另一方面，如果在尝试访问文档时遇到服务器错误，请检查httpd错误日志。它可能会告诉您，您的<code>.htaccess</code>文件是不允许的。</p>

    <div class="example"><p><code>[Fri Sep 17 18:43:16 2010] [alert] [client 192.168.200.51] /var/www/html/.htaccess: DirectoryIndex not allowed here</code></p></div>

    <p>这将表明您使用的指令在<code>.htaccess</code>文件，或者您根本没有<code class="directive"><a href="../mod/core.html#allowoverride">AllowOverride</a></code>设置为足以用于您使用的指令的级别。请查阅该特定指令的文档以确定哪种情况。</p>

    <p>或者，它可能告诉您在使用指令本身时出现语法错误。</p>

    <div class="example"><p><code>[Sat Aug 09 16:22:34 2008] [alert] [client 192.168.200.51] /var/www/html/.htaccess: RewriteCond: bad flag delimiters</code></p></div>

    <p>在这种情况下，错误消息应特定于您所提交的特定语法错误。</p>

</div></div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>

</body></html>