<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>Apache httpd教程：服务器端包含的简介-Apache HTTP Server版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body id="manual-page" ><div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="<-" alt="<-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> > <a href="http://httpd.apache.org/">HTTP服务器</a> > <a href="http://httpd.apache.org/docs/">文档</a> > <a href="../index.html">版本2.4</a> >操作方法<a href="./index.html">/教程</a></div><div id="page-content"><div id="preamble"><h1>Apache httpd教程：服务器端包含的简介</h1>


<p>服务器端包括提供一种将动态内容添加到现有HTML文档的方法。</p>
</div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><ul id="toc"><li><img alt="" src="../images/down.gif"> <a href="#related">介绍</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#what">什么是SSI？</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#configuring">配置服务器以允许SSI</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#basic">基本SSI指令</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#additionalexamples">其他例子</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#config">我还能配置什么？</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#exec">执行命令</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#advanced">先进的SSI技术</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#conclusion">结论</a></li>
</ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="related" id="related">介绍</a></h2>
 <table class="related"><tbody><tr><th>相关模块</th><th>相关指令</th></tr><tr><td><ul><li><code class="module"><a href="../mod/mod_include.html">mod_include</a></code></li><li><code class="module"><a href="../mod/mod_cgi.html">mod_cgi</a></code></li><li><code class="module"><a href="../mod/mod_expires.html">mod_expires</a></code></li></ul></td><td><ul><li><code class="directive"><a href="../mod/core.html#options">Options</a></code></li><li><code class="directive"><a href="../mod/mod_include.html#xbithack">XBitHack</a></code></li><li><code class="directive"><a href="../mod/mod_mime.html#addtype">AddType</a></code></li><li><code class="directive"><a href="../mod/core.html#setoutputfilter">SetOutputFilter</a></code></li><li><code class="directive"><a href="../mod/mod_setenvif.html#browsermatchnocase">BrowserMatchNoCase</a></code></li></ul></td></tr></tbody></table>

    <p>本文介绍通常称为SSI的服务器端包含。在本文中，我将讨论如何配置服务器以允许SSI，并介绍一些基本的SSI技术，以便将动态内容添加到现有的HTML页面中。</p>

    <p>在本文的后半部分，我们将讨论SSI可以完成的一些更高级的操作，例如SSI指令中的条件语句。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="what" id="what">什么是SSI？</a></h2>

    <p>SSI（服务器端包含）是放置在HTML页面中的指令，并在服务页面时在服务器上对其进行评估。它们使您可以将动态生成的内容添加到现有的HTML页面，而不必通过CGI程序或其他动态技术来提供整个页面。</p>

    <p>例如，您可以将指令放置到现有的HTML页面中，例如：</p>

    <div class="example"><p><code><!--#echo var="DATE_LOCAL" --></code></p></div>

    <p>并且，当该页面被投放时，该片段将被评估并替换为其值：</p>

    <div class="example"><p><code>Tuesday, 15-Jan-2013 19:28:54 EST</code></p></div>

    <p>何时使用SSI以及何时完全由某个程序生成页面的决定通常取决于页面的静态数量，以及每次服务页面时需要重新计算的数量。SSI是添加少量信息（例如当前时间）的一种好方法-如上所示。但是，如果大部分页面是在投放时生成的，则需要寻找其他解决方案。</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="configuring" id="configuring">配置服务器以允许SSI</a></h2>


    <p>要在您的服务器上允许SSI，您必须在您的服务器中具有以下指令<code>httpd.conf</code>文件或<code>.htaccess</code>文件：</p>
<pre class="prettyprint lang-config">Options +Includes</pre>


    <p>这告诉Apache您想允许对文件进行SSI指令解析。请注意，大多数配置包含多个<code class="directive"><a href="../mod/core.html#options">Options</a></code>可以相互覆盖的指令。您可能需要应用<code>Options</code>到要启用SSI的特定目录，以确保最后评估它。</p>

    <p>不仅为SSI指令解析任何文件。您必须告诉Apache应该解析哪些文件。有两种方法可以做到这一点。您可以告诉Apache解析具有特定文件扩展名的任何文件，例如<code>.shtml</code> ，并带有以下指令：</p>
<pre class="prettyprint lang-config">AddType text/html .shtml
AddOutputFilter INCLUDES .shtml</pre>


    <p>这种方法的一个缺点是，如果要向现有页面添加SSI指令，则必须更改该页面的名称以及该页面的所有链接，以便为其指定<code>.shtml</code>扩展名，以便执行这些指令。</p>

    <p>另一种方法是使用<code class="directive"><a href="../mod/mod_include.html#xbithack">XBitHack</a></code>指示：</p>
<pre class="prettyprint lang-config">XBitHack on</pre>


    <p><code class="directive"><a href="../mod/mod_include.html#xbithack">XBitHack</a></code>告诉Apache解析文件以获取SSI指令（如果它们设置了执行位）。因此，要将SSI指令添加到现有页面，而不必更改文件名，只需使用以下命令使文件可执行<code>chmod</code> 。</p>
<div class="example"><p><code>chmod +x pagename.html</code></p></div>

    <p>关于不做什么的简短评论。您偶尔会看到有人建议您只告诉Apache解析所有<code>.html</code>用于SSI的文件，这样您就不必麻烦<code>.shtml</code>文件名。这些人也许没有听说过<code class="directive"><a href="../mod/mod_include.html#xbithack">XBitHack</a></code> 。要记住的事情是，这样做，您需要Apache读取它发送给客户端的每个文件，即使它们不包含任何SSI指令。这会使事情变慢很多，不是一个好主意。</p>

    <p>当然，在Windows上，不需要设置执行位，因此对您的选项有一些限制。</p>

    <p>在默认配置下，Apache不会在SSI页面上发送上次修改日期或内容长度的HTTP标头，因为很难为动态内容计算这些值。这可以防止文档被缓存，并导致客户端性能下降。有两种解决方法：</p>

    <ol>
      <li>使用<code>XBitHack Full</code>组态。这告诉Apache通过仅查看原始请求文件的日期，而忽略任何包含文件的修改日期来确定最后修改日期。</li>

      <li>使用提供的指令<code class="module"><a href="../mod/mod_expires.html">mod_expires</a></code>在文件上设置明确的到期时间，从而使浏览器和代理知道缓存它们是可以接受的。</li>
    </ol>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="basic" id="basic">基本SSI指令</a></h2>

    <p>SSI指令具有以下语法：</p>
<div class="example"><p><code><!--#function attribute=value attribute=value ... --></code></p></div>

    <p>它的格式类似于HTML注释，因此，如果未正确启用SSI，浏览器将忽略它，但在HTML源代码中仍然可见。如果正确配置了SSI，则该指令将被其结果替换。</p>

    <p>函数可以是许多事情之一，在本系列的下一部分中，我们将进一步讨论其中的大多数。现在，这里有一些您可以使用SSI进行操作的示例</p>

<h3><a name="todaysdate" id="todaysdate">今天的日期</a></h3>

<div class="example"><p><code><!--#echo var="DATE_LOCAL" --></code></p></div>

    <p>的<code>echo</code>函数只是吐出一个变量的值。有许多标准变量，包括可用于CGI程序的整套环境变量。另外，您可以使用<code>set</code>功能。</p>

    <p>如果您不喜欢打印日期的格式，可以使用<code>config</code>功能，带有<code>timefmt</code>属性，以修改该格式。</p>

<div class="example"><p><code><!--#config timefmt="%A %B %d, %Y" --><br> Today is <!--#echo var="DATE_LOCAL" --></code></p></div>


<h3><a name="lastmodified" id="lastmodified">文件的修改日期</a></h3>

<div class="example"><p><code>This document last modified <!--#flastmod file="index.html" --></code></p></div>

    <p>此功能也受制于<code>timefmt</code>格式配置。</p>


<h3><a name="cgi" id="cgi">包括CGI程序的结果</a></h3>

    <p>这是SSI的更常见用法之一-输出CGI程序的结果，例如每个人都喜欢的``命中计数器''。''</p>

<div class="example"><p><code><!--#include virtual="/cgi-bin/counter.pl" --></code></p></div>


</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="additionalexamples" id="additionalexamples">其他例子</a></h2>


    <p>以下是一些可以使用SSI在HTML文档中执行的操作的特定示例。</p>

<h3><a name="docmodified" id="docmodified">该文件何时修改？</a></h3>

    <p>在前面，我们提到您可以使用SSI来通知用户最新的文档修改时间。但是，这样做的实际方法还有些疑问。放置在HTML文档中的以下代码将在页面上放置这样的时间戳。当然，如上所述，您将必须正确启用SSI。</p>
<div class="example"><p><code><!--#config timefmt="%A %B %d, %Y" --><br> This file last modified <!--#flastmod file="ssi.shtml" --></code></p></div>

    <p>当然，您需要更换<code>ssi.shtml</code>以及您要引用的文件的实际名称。如果您只是在寻找可以粘贴到任何文件中的通用代码，这可能会很不方便，因此您可能希望使用<code>LAST_MODIFIED</code>变量：</p>
<div class="example"><p><code><!--#config timefmt="%D" --><br> This file last modified <!--#echo var="LAST_MODIFIED" --></code></p></div>

    <p>有关的更多详细信息<code>timefmt</code>格式，请转到您喜欢的搜索网站并查找<code>strftime</code> 。语法是一样的。</p>


<h3><a name="standard-footer" id="standard-footer">包括标准页脚</a></h3>


    <p>如果您要管理的页面超过几个页面，则可能会发现对所有这些页面进行更改可能会非常痛苦，尤其是当您试图在所有这些页面上保持某种标准外观时。</p>

    <p>将包含文件用于页眉和/或页脚可以减少这些更新的负担。您只需要制作一个页脚文件，然后将其与<code>include</code> SSI命令。的<code>include</code>函数可以确定要包含的文件<code>file</code>属性或<code>virtual</code>属性。的<code>file</code> attribute是<em>相对于当前目录</em>的文件路径。这意味着它不能是绝对文件路径（以/开头），也不能包含../作为该路径的一部分。的<code>virtual</code>属性可能更有用，并且应指定相对于所提供文档的URL。它可以以/开头，但必须与所提供的文件位于同一服务器上。</p>
<div class="example"><p><code><!--#include virtual="/footer.html" --></code></p></div>

    <p>我会经常结合最后两件事， <code>LAST_MODIFIED</code>脚注文件中要包含的指令。SSI指令可以包含在包含的文件中，并且包含可以嵌套-也就是说，包含的文件可以包含另一个文件，依此类推。</p>


</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="config" id="config">我还能配置什么？</a></h2>


    <p>除了能够<code>config</code>时间格式，您也可以<code>config</code>另外两件事。</p>

    <p>通常，当您的SSI指令出现问题时，您会收到以下消息：</p>
<div class="example"><p><code>[an error occurred while processing this directive]</code></p></div>

    <p>如果您想将该消息更改为其他内容，可以使用<code>errmsg</code>归因于<code>config</code>功能：</p>
<div class="example"><p><code><!--#config errmsg="[It appears that you don't know how to use SSI]" --></code></p></div>

    <p>希望最终用户永远不会看到此消息，因为您将在站点上线之前解决SSI指令的所有问题。（对？）</p>

    <p>而且你可以<code>config</code>与文件一起返回的文件大小的格式<code>sizefmt</code>属性。您可以指定<code>bytes</code>完整的字节数，或者<code>abbrev</code>缩写为Kb或Mb（视情况而定）。</p>
    </div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="exec" id="exec">执行命令</a></h2>
    

    <p>您还可以使用<code>exec</code>功能。您实际上可以让SSI使用shell执行命令（ <code>/bin/sh</code> ，确切地说-如果您使用的是Win32，则为DOS shell）。例如，以下内容将为您提供目录列表。</p>
<div class="example"><p><code><pre><br> <!--#exec cmd="ls" --><br> </pre></code></p></div>

    <p>或者，在Windows上</p>
<div class="example"><p><code><pre><br> <!--#exec cmd="dir" --><br> </pre></code></p></div>

    <p>您可能会在Windows上注意到此指令的某些奇怪格式，因为来自<code>dir</code>包含字符串``< <code>dir</code> >''，使浏览器感到困惑。</p>

    <p>请注意，此功能极其危险，因为它会执行碰巧嵌入到<code>exec</code>标签。如果您遇到用户可以编辑网页内容的任何情况，例如使用``留言簿''，请确保禁用此功能。您可以允许SSI，但不允许<code>exec</code>功能，与<code>IncludesNOEXEC</code>争论<code>Options</code>指示。</p>
    </div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="advanced" id="advanced">先进的SSI技术</a></h2>


    <p>除了吐出内容之外，Apache SSI还为您提供了设置变量以及在比较和条件条件中使用这些变量的选项。</p>

<h3><a name="variables" id="variables">设定变量</a></h3>

    <p>使用<code>set</code>指令，您可以设置变量以备后用。我们将在后面的讨论中使用它，因此我们将在这里进行讨论。其语法如下：</p>
<div class="example"><p><code><!--#set var="name" value="Rich" --></code></p></div>

    <p>除了像这样直接设置值外，您还可以使用任何其他变量，包括<a href="../env.html">环境变量</a>或上面讨论的变量（例如<code>LAST_MODIFIED</code> （例如）为变量赋值。通过在变量名称前使用美元符号（$），可以指定某物是变量，而不是文字字符串。</p>

    <div class="example"><p><code><!--#set var="modified" value="$LAST_MODIFIED" --></code></p></div>

    <p>要将字面的美元符号放入变量的值，需要用反斜杠对美元符号进行转义。</p>
<div class="example"><p><code><!--#set var="cost" value="\$100" --></code></p></div>

    <p>最后，如果要将变量放在更长的字符串中间，并且变量名有可能与其他字符冲突，从而与这些字符混淆，则可以将变量名花括号中的变量，以消除这种混乱。（很难给出一个很好的例子，但希望您能明白这一点。）</p>
<div class="example"><p><code><!--#set var="date" value="${DATE_LOCAL}_${DATE_GMT}" --></code></p></div>


<h3><a name="conditional" id="conditional">条件表达式</a></h3>


    <p>现在我们有了变量，并且能够设置和比较它们的值，我们可以使用它们来表达条件。这使SSI成为一种微小的编程语言。
    <code class="module"><a href="../mod/mod_include.html">mod_include</a></code>提供一个<code>if</code> ， <code>elif</code> ， <code>else</code> ， <code>endif</code>用于构造条件语句的结构。这使您可以有效地从一个实际页面中生成多个逻辑页面。</p>

    <p>此条件构造的结构为：</p>
<div class="example"><p><code><!--#if expr="test_condition" --><br> <!--#elif expr="test_condition" --><br> <!--#else --><br> <!--#endif --></code></p></div>

    <p><em>test_condition</em>可以是任何形式的逻辑比较-可以相互比较值，也可以测试特定值的``真相''。（如果给定的字符串非空，则为true。）有关您可用的比较运算符的完整列表，请参见<code class="module"><a href="../mod/mod_include.html">mod_include</a></code>文档。</p>
   
    <p>例如，如果您希望基于一天中的时间自定义网页上的文本，则可以使用以下食谱，将其放在HTML页面中：</p>

    <div class="example"><p><code>Good <!--#if expr="%{TIME_HOUR} <12" --><br> morning!<br> <!--#else --><br> afternoon!<br> <!--#endif --><br></code></p></div>

    <p>任何其他变量（您定义的变量或常规环境变量）都可以在条件语句中使用。有关表达式评估引擎的更多信息，请参见<a href="../expr.html">Apache HTTP Server</a>中的表达式。</p>

    <p>借助Apache的功能，可以使用<code>SetEnvIf</code>指令和其他相关指令，此功能可以让您在服务器端执行多种动态内容，而无需使用完整的Web应用程序。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="conclusion" id="conclusion">结论</a></h2>

    <p>SSI当然不能替代CGI或用于生成动态网页的其他技术。但这是在页面上添加少量动态内容的好方法，而无需执行大量额外工作。</p>
</div></div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>

</body></html>