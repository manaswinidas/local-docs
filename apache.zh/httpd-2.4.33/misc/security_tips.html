<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>安全提示-Apache HTTP Server版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body id="manual-page" ><div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="<-" alt="<-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> > <a href="http://httpd.apache.org/">HTTP Server</a> > <a href="http://httpd.apache.org/docs/">文档</a> > <a href="../index.html">版本2.4</a> > <a href="./index.html">其他文档</a></div><div id="page-content"><div id="preamble"><h1>安全提示</h1>


    <p>有关设置Web服务器中安全性问题的一些提示和技巧。其中一些建议是笼统的，其他一些则是针对Apache的。</p>
  </div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><ul id="toc"><li><img alt="" src="../images/down.gif"> <a href="#uptodate">保持最新</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#dos">拒绝服务（DoS）攻击</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#serverroot">ServerRoot目录的权限</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#ssi">服务器端包括</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#cgi">一般的CGI</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#nsaliasedcgi">非脚本别名CGI</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#saliasedcgi">脚本别名CGI</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#dynamic">其他动态内容来源</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#dynamicsec">动态内容安全</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#systemsettings">保护系统设置</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#protectserverfiles">默认情况下保护服务器文件</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#watchyourlogs">看你的日志</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#merging">合并配置部分</a></li>
</ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="uptodate" id="uptodate">保持最新</a></h2>

    <p>Apache HTTP Server在安全性方面有良好的记录，并且开发人员社区高度关注安全性问题。但是，不可避免的是，某些问题（无论大小）都会在发布后在软件中发现。因此，保持对软件更新的了解至关重要。如果您直接从Apache获得了HTTP Server版本，我们强烈建议您订阅<a href="http://httpd.apache.org/lists.html#http-announce">Apache HTTP Server公告列表</a> ，在其中可以随时了解新版本和安全更新。大多数第三方Apache软件发行商都可以提供类似的服务。</p>

    <p>当然，在大多数情况下，Web服务器会受到威胁，这并不是因为HTTP Server代码中的问题。而是来自附加代码，CGI脚本或基础操作系统的问题。因此，您必须始终注意系统上所有软件的问题和更新。</p>

  </div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="dos" id="dos">拒绝服务（DoS）攻击</a></h2>

    

    <p>所有网络服务器都可能遭受拒绝服务攻击，这些攻击试图通过占用服务器资源来阻止对客户端的响应。不可能完全阻止此类攻击，但是您可以做某些事情来减轻它们造成的问题。</p>

    <p>最有效的反DoS工具通常是防火墙或其他操作系统配置。例如，大多数防火墙可以配置为限制来自任何单个IP地址或网络的同时连接数，从而防止一系列简单的攻击。当然，这对抵抗分布式拒绝服务攻击（DDoS）没有帮助。</p>

    <p>还有一些Apache HTTP Server配置设置可以帮助缓解问题：</p>

    <ul>
      <li>的<code class="directive"><a href="../mod/mod_reqtimeout.html#requestreadtimeout">RequestReadTimeout</a></code>指令允许限制客户端发送请求所花费的时间。</li>

      <li>的<code class="directive"><a href="../mod/core.html#timeout">TimeOut</a></code>在遭受DoS攻击的网站上，应降低该指令。将其设置为低至几秒钟可能是合适的。如<code class="directive"><a href="../mod/core.html#timeout">TimeOut</a></code>当前用于多个不同的操作，将其设置为较低的值会导致长期运行的CGI脚本出现问题。</li>

      <li>的<code class="directive"><a href="../mod/core.html#keepalivetimeout">KeepAliveTimeout</a></code>易受DoS攻击的网站上的指令也可能降低。有些网站甚至通过以下方式完全关闭了Keepalive： <code class="directive"><a href="../mod/core.html#keepalive">KeepAlive</a></code> ，当然在性能上还有其他缺点。</li>

      <li>应检查其他模块提供的与超时相关的各种指令的值。</li>

      <li>指令<code class="directive"><a href="../mod/core.html#limitrequestbody">LimitRequestBody</a></code> ， <code class="directive"><a href="../mod/core.html#limitrequestfields">LimitRequestFields</a></code> ， <code class="directive"><a href="../mod/core.html#limitrequestfieldsize">LimitRequestFieldSize</a></code> ， <code class="directive"><a href="../mod/core.html#limitrequestline">LimitRequestLine</a></code>和<code class="directive"><a href="../mod/core.html#limitxmlrequestbody">LimitXMLRequestBody</a></code>应该仔细配置以限制客户端输入触发的资源消耗。</li>

      <li>在支持该功能的操作系统上，请确保使用<code class="directive"><a href="../mod/core.html#acceptfilter">AcceptFilter</a></code>指令将部分请求处理卸载到操作系统。在Apache httpd中，默认情况下此功能是活动的，但可能需要重新配置内核。</li>

      <li>调音<code class="directive"><a href="../mod/mpm_common.html#maxrequestworkers">MaxRequestWorkers</a></code>指令，允许服务器处理最大数量的同时连接，而不会耗尽资源。另请参阅<a href="perf-tuning.html">性能调整文档</a> 。</li>

      <li>使用线程<a href="../mpm.html">mpm</a>可能使您可以处理更多同时连接，从而减轻DoS攻击。此外， <code class="module"><a href="../mod/event.html">event</a></code> mpm使用异步处理来避免将线程专用于每个连接。由于OpenSSL库的性质， <code class="module"><a href="../mod/event.html">event</a></code> MPM目前与<code class="module"><a href="../mod/mod_ssl.html">mod_ssl</a></code>和其他输入过滤器。在这些情况下，它会退回到<code class="module"><a href="../mod/worker.html">worker</a></code>每秒</li>

      <li>通过<a href="http://modules.apache.org/">http://modules.apache.org/</a>提供的许多第三方模块可以限制某些客户端行为，从而缓解DoS问题。</li>

    </ul>

  </div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="serverroot" id="serverroot">ServerRoot目录的权限</a></h2>

    

    <p>在典型的操作中，Apache由root用户启动，并切换到由root用户定义的用户。 <code class="directive"><a href="../mod/mod_unixd.html#user">User</a></code>指令来投放点击。与root用户执行的任何命令一样，您必须注意防止非root用户修改它。文件本身不仅必须只能由root用户写入，而且目录以及所有目录的父目录也必须可以写入。例如，如果您选择将ServerRoot放置在<code>/usr/local/apache</code>那么建议您使用以下命令将其创建为根目录：</p>

    <div class="example"><p><code>mkdir /usr/local/apache <br> cd /usr/local/apache <br> mkdir bin conf logs <br> chown 0 . bin conf logs <br> chgrp 0 . bin conf logs <br> chmod 755 . bin conf logs</code></p></div>

    <p>假设<code>/</code> ， <code>/usr</code>和<code>/usr/local</code>只能由root修改。当您安装<code class="program"><a href="../programs/httpd.html">httpd</a></code>可执行文件，则应确保它受到类似的保护：</p>

    <div class="example"><p><code>cp httpd /usr/local/apache/bin <br> chown 0 /usr/local/apache/bin/httpd <br> chgrp 0 /usr/local/apache/bin/httpd <br> chmod 511 /usr/local/apache/bin/httpd</code></p></div>

    <p>您可以创建一个htdocs子目录，该目录可被其他用户修改-因为root永远不会在其中执行任何文件，因此不应在其中创建文件。</p>

    <p>如果您允许非root用户修改root执行或写入的任何文件，那么您将对root入侵打开系统。例如，有人可以替换<code class="program"><a href="../programs/httpd.html">httpd</a></code>二进制文件，以便下次启动它时，它将执行一些任意代码。如果日志目录是可写的（非root用户），则有人可以用指向其他系统文件的符号链接替换日志文件，然后root可以用任意数据覆盖该文件。如果日志文件本身是可写的（非root用户），则有人可能会用伪造的数据覆盖日志本身。</p>

  </div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="ssi" id="ssi">服务器端包括</a></h2>

    

    <p>服务器端包含（SSI）为服务器管理员带来了一些潜在的安全风险。</p>

    <p>第一个风险是服务器负载增加。所有启用SSI的文件都必须由Apache解析，无论文件中是否包含任何SSI指令。尽管此负载增加很小，但在共享服务器环境中，它可能变得很重要。</p>

    <p>通常，SSI文件还具有与CGI脚本关联的相同风险。使用<code>exec cmd</code>元素，启用SSI的文件可以在用户和Apache组运行的权限下执行任何CGI脚本或程序，如<code>httpd.conf</code> 。</p>

    <p>有一些方法可以增强SSI文件的安全性，同时仍然可以利用它们提供的好处。</p>

    <p>为了隔离任性的SSI文件可能造成的损坏，服务器管理员可以按照<a href="#cgi">CGI常规</a>部分中的说明启用<a href="../suexec.html">suexec</a> 。</p>

    <p>为具有以下功能的文件启用SSI <code>.html</code>要么<code>.htm</code>扩展名可能很危险。在共享或高流量的服务器环境中尤其如此。启用SSI的文件应具有单独的扩展名，例如常规<code>.shtml</code> 。这有助于将服务器负载保持在最低水平，并简化风险管理。</p>

    <p>另一个解决方案是禁用从SSI页面运行脚本和程序的功能。为此替换<code>Includes</code>与<code>IncludesNOEXEC</code>在里面<code class="directive"><a href="../mod/core.html#options">Options</a></code>指示。请注意，用户仍可以使用<code><--#include virtual="..." --></code>如果CGI脚本位于由A指定的目录中，则执行这些脚本<code class="directive"><a href="../mod/mod_alias.html#scriptalias">ScriptAlias</a></code>指示。</p>

  </div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="cgi" id="cgi">一般的CGI</a></h2>

    

    <p>首先，您始终必须记住，您必须信任CGI脚本/程序的编写者，或者您有能力发现CGI中潜在的安全漏洞，无论这些漏洞是有意还是无意的。CGI脚本在Web服务器用户的许可下，可以在系统上运行基本上任意的命令，因此，如果不仔细检查它们，将非常危险。</p>

    <p>所有CGI脚本都将以同一用户身份运行，因此它们有可能（偶然或故意）与其他脚本发生冲突，例如，用户A讨厌用户B，因此他编写了一个脚本来丢弃用户B的CGI数据库。<a href="../suexec.html">suEXEC</a>是一个可用于允许脚本以不同用户身份运行的程序，它自1.2起包含在Apache中，并从Apache服务器代码中的特殊钩子中调用。另一种流行的方法是使用<a href="http://cgiwrap.sourceforge.net/">CGIWrap</a> 。</p>

  </div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="nsaliasedcgi" id="nsaliasedcgi">非脚本别名CGI</a></h2>

    

    <p>仅在以下情况下才应考虑允许用户在任何目录中执行CGI脚本：</p>

    <ul>
      <li>您相信您的用户不要编写有意或无意使您的系统遭受攻击的脚本。</li>
      <li>您认为站点的安全性在其他方面太弱了，以至于再也没有潜在的漏洞了。</li>
      <li>您没有用户，也没有人访问您的服务器。</li>
    </ul>

  </div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="saliasedcgi" id="saliasedcgi">脚本别名CGI</a></h2>

    

    <p>将CGI限制为特殊目录，使管理员可以控制进入这些目录的内容。这比非脚本别名的CGI不可避免地更安全，但是只有在对目录具有写访问权的用户受信任或者管理员愿意测试每个新的CGI脚本/程序中是否存在潜在的安全漏洞时，这种安全性才会提高。</p>

    <p>大多数站点在非脚本别名CGI方法上选择此选项。</p>

  </div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="dynamic" id="dynamic">其他动态内容来源</a></h2>

  

  <p>作为服务器本身一部分运行的嵌入式脚本选项，例如<code>mod_php</code> ， <code>mod_perl</code> ， <code>mod_tcl</code>和<code>mod_python</code> ，以服务器本身的身份运行（请参阅<code class="directive"><a href="../mod/mod_unixd.html#user">User</a></code>指令），因此这些引擎执行的脚本可能会访问服务器用户可以访问的任何内容。某些脚本引擎可能会提供限制，但最好还是不要假设。</p>

  </div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="dynamicsec" id="dynamicsec">动态内容安全</a></h2>

  

  <p>设置动态内容时，例如<code>mod_php</code> ， <code>mod_perl</code>要么<code>mod_python</code> ，许多安全方面的考虑超出了<code>httpd</code>本身，则需要从这些模块中查阅文档。例如，PHP使您可以设置<a href="http://www.php.net/manual/en/ini.sect.safe-mode.php">安全模式</a> ，默认情况下通常会禁用该<a href="http://www.php.net/manual/en/ini.sect.safe-mode.php">模式</a> 。另一个示例是<a href="http://www.hardened-php.net/suhosin/">Suhosin</a> ，这是一个用于提高安全性的PHP插件。有关这些的更多信息，请查阅每个项目文档。</p>

  <p>在Apache级别，可以将名为<a href="http://modsecurity.org/">mod_security</a>的模块视为HTTP防火墙，并且只要对其进行了足够精细的配置，就可以帮助您增强动态内容的安全性。</p>

  </div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="systemsettings" id="systemsettings">保护系统设置</a></h2>

    

    <p>要运行一个非常紧凑的船，您需要阻止用户进行设置<code>.htaccess</code>可以覆盖您已配置的安全功能的文件。这是一种方法。</p>

    <p>在服务器配置文件中，放入</p>

    <pre class="prettyprint lang-config">&lt;Directory "/"&gt;
    AllowOverride None
&lt;/Directory&gt;</pre>


    <p>这会阻止使用<code>.htaccess</code>除专门启用的目录外，所有目录中的文件。</p>

    <p>请注意，此设置是自Apache 2.3.9起的默认设置。</p>

  </div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="protectserverfiles" id="protectserverfiles">默认情况下保护服务器文件</a></h2>

    

    <p>偶尔会被误解的Apache的一个方面是默认访问的功能。也就是说，除非您采取措施对其进行更改，否则服务器如果可以通过常规的URL映射规则找到其到达文件的方式，则可以将其提供给客户端。</p>

    <p>例如，考虑以下示例：</p>

    <div class="example"><p><code># cd /; ln -s / public_html <br> Accessing <code>http://localhost/~root/</code></code></p></div>

    <p>这将允许客户端遍历整个文件系统。要解决此问题，请将以下块添加到服务器的配置中：</p>

    <pre class="prettyprint lang-config">&lt;Directory "/"&gt;
    Require all denied
&lt;/Directory&gt;</pre>


    <p>这将禁止默认访问文件系统位置。添加适当的<code class="directive"><a href="../mod/core.html#directory">Directory</a></code>阻止只在您希望的区域访问。例如，</p>

    <pre class="prettyprint lang-config">&lt;Directory "/usr/users/*/public_html"&gt;
    Require all granted
&lt;/Directory&gt;
&lt;Directory "/usr/local/httpd"&gt;
    Require all granted
&lt;/Directory&gt;</pre>


    <p>要特别注意<code class="directive"><a href="../mod/core.html#location">Location</a></code>和<code class="directive"><a href="../mod/core.html#directory">Directory</a></code>指令;例如，即使<code><Directory "/"></code>拒绝访问， <code><Location "/"></code>指令可能会推翻它。</p>

    <p>也要警惕与<code class="directive"><a href="../mod/mod_userdir.html#userdir">UserDir</a></code>指示;将其设置为类似<code>./</code>对于root，其效果与上述第一个示例相同。强烈建议您在服务器配置文件中包括以下行：</p>

    <pre class="prettyprint lang-config">UserDir disabled root</pre>


  </div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="watchyourlogs" id="watchyourlogs">看你的日志</a></h2>

    

    <p>为了及时了解服务器上实际发生的情况，您必须检查<a href="../logs.html">Log Files</a> 。即使日志文件仅报告已发生的事件，它们也可以使您了解对服务器进行的攻击，并允许您检查是否存在必要的安全级别。</p>

    <p>几个例子：</p>

    <div class="example"><p><code>grep -c "/jsp/source.jsp?/jsp/ /jsp/source.jsp??" access_log <br> grep "client denied" error_log | tail -n 10</code></p></div>

    <p>第一个示例将列出尝试利用<a href="http://online.securityfocus.com/bid/4876/info/">Apache Tomcat源的攻击数量</a><a href="http://online.securityfocus.com/bid/4876/info/">。JSP格式错误的请求信息泄露漏洞</a> ，第二个示例将列出最后十个被拒绝的客户端，例如：</p>

    <div class="example"><p><code>[Thu Jul 11 17:18:39 2002] [error] [client foo.example.com] client denied by server configuration: /usr/local/apache/htdocs/.htpasswd</code></p></div>

    <p>如您所见，日志文件仅报告已经发生的情况，因此，如果客户端能够访问<code>.htpasswd</code>文件，您将看到类似以下内容的文件：</p>

    <div class="example"><p><code>foo.example.com - - [12/Jul/2002:01:59:13 +0200] "GET /.htpasswd HTTP/1.1"</code></p></div>

    <p>在您的<a href="../logs.html#accesslog">访问日志中</a> 。这意味着您可能在服务器配置文件中注释了以下内容：</p>

    <pre class="prettyprint lang-config">&lt;Files ".ht*"&gt;
    Require all denied
&lt;/Files&gt;</pre>


  </div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="merging" id="merging">合并配置部分</a></h2>

    

    <p>配置部分的合并很复杂，有时是特定于指令的。创建有关如何合并指令的依赖项时，请始终测试您的更改。</p>

    <p>对于未实现任何合并逻辑的模块，例如<code class="directive">mod_access_compat</code> ，后面几节中的行为取决于后面几节中是否有来自模块的指令。配置将被继承，直到进行更改为止，此时配置将被<em>替换</em>而不是合并。</p>
  </div></div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>

</body></html>