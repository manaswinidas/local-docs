<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>mod_mime_magic-Apache HTTP服务器版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body >
<div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="&lt;-" alt="&lt;-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP服务器</a> &gt; <a href="http://httpd.apache.org/docs/">文档</a> &gt; <a href="../index.html">版本2.4</a> &gt; <a href="./index.html">模块</a></div>
<div id="page-content">
<div id="preamble"><h1>Apache模块mod_mime_magic</h1>

<table class="module"><tr><th><a href="module-dict.html#Description">描述：</a></th><td>通过查看文件内容的几个字节来确定文件的MIME类型</td></tr>
<tr><th><a href="module-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="module-dict.html#ModuleIdentifier">模块�标识符：</a></th><td>mime_magic_module</td></tr>
<tr><th><a href="module-dict.html#SourceFile">源文件：</a></th><td>mod_mime_magic.c</td></tr></table>
<h3>摘要</h3>

    <p>该模块以与Unix <code>file(1)</code>命令相同的方式确定文件的<a class="glossarylink" href="../glossary.html#mime-type" title="见词汇">MIME类型</a> ：它查看文件的前几个字节。它旨在用作<code class="module"><a href="../mod/mod_mime.html">mod_mime</a></code>无法解决的情况的“第二道防线”。</p>

    <p>该模块来自Unix的<code>file(1)</code>命令的免费版本，该命令使用“魔术数字”和文件内容中的其他提示来确定内容是什么。仅当<code class="directive"><a href="#mimemagicfile">MimeMagicFile</a></code>指令指定了魔术文件时，此模块才处于活动状态。</p>
</div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><h3>话题</h3>
<ul id="topics">
<li><img alt="" src="../images/down.gif"> <a href="#format">魔术文件的格式</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#performance">性能问题</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#notes">笔记</a></li>
</ul><h3 class="directives">指令</h3>
<ul id="toc">
<li><img alt="" src="../images/down.gif"> <a href="#mimemagicfile">MimeMagicFile</a></li>
</ul>
<h3>错误修正清单</h3><ul class="seealso"><li><a href="https://www.apache.org/dist/httpd/CHANGES_2.4">httpd更新日志</a></li><li><a href="https://bz.apache.org/bugzilla/buglist.cgi?bug_status=__open__&amp;list_id=144532&amp;product=Apache httpd-2&amp;query_format=specific&amp;order=changeddate DESC%2Cpriority%2Cbug_severity&amp;component=mod_mime_magic">已知的问题</a></li><li><a href="https://bz.apache.org/bugzilla/enter_bug.cgi?product=Apache httpd-2&amp;component=mod_mime_magic">报告错误</a></li></ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="format" id="format">魔术文件的格式</a></h2>

    <p>文件的内容是4-5列中的纯ASCII文本。允许使用空行，但可以忽略。带注释的行使用井号（ <code>#</code> ）。其余各行针对以下各列进行了解析：</p>

    <table class="bordered"><tr class="header"><th>柱</th><th>描述</th></tr>
<tr><td>1个</td>
        <td>开始检查的字节数<br>“ <code>&gt;</code> ”表示对前一个非“ <code>&gt;</code> ”行的依赖</td></tr>
<tr class="odd"><td>2</td>
        <td><p>要匹配的数据类型</p>
        <table class="bordered">
        
        <tr><td><code>字节</code></td>
            <td>单字符</td></tr>
        <tr><td><code>短</code></td>
            <td>机器顺序的16位整数</td></tr>
        <tr><td><code>长</code></td>
            <td>机器顺序的32位整数</td></tr>
        <tr><td><code>串</code></td>
            <td>任意长度的字符串</td></tr>
        <tr><td><code>日期</code></td>
            <td>长整数日期（自Unix时代/ 1970年以来的秒数）</td></tr>
        <tr><td><code>简而言之</code></td>
            <td>大尾数16位整数</td></tr>
        <tr><td><code>属于</code></td>
            <td>大尾数32位整数</td></tr>
        <tr><td><code>约会</code></td>
            <td>大端32位整数日期</td></tr>
        <tr><td><code>短裤</code></td>
            <td>小尾数16位整数</td></tr>
        <tr><td><code>乐龙</code></td>
            <td>小尾数32位整数</td></tr>
        <tr><td><code>领队</code></td>
            <td>小尾数32位整数日期</td></tr>
        </table></td></tr>
<tr><td>3</td>
        <td>要匹配的数据内容</td></tr>
<tr class="odd"><td>4</td>
        <td>MIME类型（如果匹配）</td></tr>
<tr><td>5</td>
        <td>MIME编码（如果匹配）（可选）</td></tr>
</table>

    <p>例如，以下魔术文件行将识别某些音频格式：</p>

    <div class="example"><pre># Sun/NeXT audio data
0      string      .snd
&gt;12    belong      1       audio/basic
&gt;12    belong      2       audio/basic
&gt;12    belong      3       audio/basic
&gt;12    belong      4       audio/basic
&gt;12    belong      5       audio/basic
&gt;12    belong      6       audio/basic
&gt;12    belong      7       audio/basic
&gt;12    belong     23       audio/x-adpcm</pre></div>

    <p>否则，它们将识别出包含Microsoft Word或FrameMaker文档的<code>*.doc</code>文件之间的区别。（这些是不兼容的文件格式，它们使用相同的文件后缀。）</p>

    <div class="example"><pre># Frame
0  string  \&lt;MakerFile        application/x-frame
0  string  \&lt;MIFFile          application/x-frame
0  string  \&lt;MakerDictionary  application/x-frame
0  string  \&lt;MakerScreenFon   application/x-frame
0  string  \&lt;MML              application/x-frame
0  string  \&lt;Book             application/x-frame
0  string  \&lt;Maker            application/x-frame

# MS-Word
0  string  \376\067\0\043            application/msword
0  string  \320\317\021\340\241\261  application/msword
0  string  \333\245-\0\0\0           application/msword</pre></div>

    <p>第五列可以包含可选的MIME编码。例如，这可以识别压缩的文件并为其设置编码。</p>

    <div class="example"><pre># gzip (GNU zip, not to be confused with
#       [Info-ZIP/PKWARE] zip archiver)

0  string  \037\213  application/octet-stream  x-gzip</pre></div>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="performance" id="performance">性能问题</a></h2>
    <p>此模块不适用于每个系统。如果您的系统几乎无法满足其负载，或者您正在执行Web服务器基准测试，则可能不希望启用此功能，因为处理不是免费的。</p>

    <p>但是，已努力提高原始<code>file(1)</code>代码的性能，使其适合繁忙的Web服务器。它是为服务器设计的，那里有成千上万的用户发布自己的文档。这在Intranet上可能很常见。很多时候，如果服务器可以对文件内容做出比文件名所允许的更多的智能决策，那将很有帮助...即使只是为了减少当用户不正确地命名自己的文件时“为什么我的页面无法工作”的调用。您必须确定额外的工作是否适合您的环境。</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="notes" id="notes">笔记</a></h2>
    <p>以下注释适用于<code class="module"><a href="../mod/mod_mime_magic.html">mod_mime_magic</a></code>模块，并包含在此处是为了符合贡献者的版权限制，并需要得到他们的承认。</p>

    <div class="note">
      <p>mod_mime_magic：通过文件魔术数字查找MIME类型<br>版权所有（c）1996-1997 Cisco Systems，Inc.</p>

      <p>该软件由Cisco Systems在1997年7月提交给Apache Group。此源代码的未来修订版和派生物必须承认Cisco Systems是该模块的原始贡献者。所有其他许可和使用条件均为Apache Group的许可和使用条件。</p>

      <p>此代码中的某些代码源自最初发布到comp.sources.unix的file命令的免费版本。该程序的版权信息如下。</p>
    </div>

    <div class="note">
      <p>-版权所有（c）Ian F.Darwin，1987年。由Ian F. Darwin撰写。</p>

      <p>该软件不受美国电话电报公司或加利福尼亚大学董事会的任何许可。</p>

      <p>任何人均有权在任何计算机系统上以任何目的使用本软件，并对其进行更改和自由分发，但要遵守以下限制：</p>

      <ol>
        <li>作者对此软件的后果不承担任何责任，即使这些后果是由于软件中的缺陷引起的，也不管它们多么可怕。</li>

        <li>不得以明确的主张或以遗漏的方式歪曲本软件的来源。由于很少有用户阅读过源代码，因此必须在文档中显示功劳。</li>

        <li>更改后的版本必须明确标明，并且不得将其误认为是原始软件。由于很少有用户阅读过源代码，因此必须在文档中显示功劳。</li>

        <li>本声明不可删除或更改。</li>
      </ol>
    </div>

    <div class="note">
      <p>为了符合达尔文先生的条款：此命令已从免费的“文件”命令中进行了非常显着的修改。</p>

      <ul>
        <li>从一个版本的Apache迁移到下一个版本时的全合一文件，以方便编译。</li>

        <li>内存分配是通过Apache API的池结构完成的。</li>

        <li>所有功能都有必要的Apache API请求或服务器结构传递给它们，以调用其他Apache API例程。 （ <em>即</em> ，通常用于日志记录，文件或本身或调用函数的内存分配。）</li>

        <li>struct magic已从数组转换为单端链表，因为它一次仅增长一条记录，只能按顺序访问，并且Apache API没有等效的<code>realloc()</code> 。</li>

        <li>功能已更改，可以从服务器配置而不是全局参数中获取其参数。（它现在应该可重入，但尚未在线程环境中进行测试。）</li>

        <li>现在将其用于将结果打印到stdout的位置将它们保存在一个列表中，这些列表用于在Apache请求记录中设置MIME类型。</li>

        <li>命令行标志已被删除，因为它们在此不再使用。</li>
      </ul>
    </div>
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MimeMagicFile" id="MimeMagicFile">MimeMagicFile</a> <a name="mimemagicfile" id="mimemagicfile">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>使用指定的魔术文件根据文件内容启用MIME类型确定</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>MimeMagicFile <var>文件路径</var></code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_mime_magic</td></tr>
</table>
    <p><code class="directive">MimeMagicFile</code>指令可用于启用此模块，默认文件位于<code>conf/magic</code> 。无根路径是相对于<code class="directive"><a href="../mod/core.html#serverroot">ServerRoot</a></code> 。除非使用更特定的设置，否则虚拟主机将使用与主服务器相同的文件，在这种情况下，更特定的设置将覆盖主服务器的文件。</p>

    <div class="example"><h3>例</h3><pre class="prettyprint lang-config">MimeMagicFile conf/magic</pre>
</div>

</div>
</div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>
</body></html>