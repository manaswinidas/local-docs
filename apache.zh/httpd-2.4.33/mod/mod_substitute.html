<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>mod_substitute-Apache HTTP服务器版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body >
<div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="&lt;-" alt="&lt;-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP服务器</a> &gt; <a href="http://httpd.apache.org/docs/">文档</a> &gt; <a href="../index.html">版本2.4</a> &gt; <a href="./index.html">模块</a></div>
<div id="page-content">
<div id="preamble"><h1>Apache模块mod_substitute</h1>

<table class="module"><tr><th><a href="module-dict.html#Description">描述：</a></th><td>在响应正文上执行搜索和替换操作</td></tr>
<tr><th><a href="module-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="module-dict.html#ModuleIdentifier">模块�标识符：</a></th><td>replace_module</td></tr>
<tr><th><a href="module-dict.html#SourceFile">源文件：</a></th><td>mod_substitute.c</td></tr>
<tr><th><a href="module-dict.html#Compatibility">兼容性：</a></th><td>在Apache HTTP Server 2.2.7和更高版本中可用</td></tr></table>
<h3>摘要</h3>

    <p><code class="module"><a href="../mod/mod_substitute.html">mod_substitute</a></code>提供了一种在响应主体上执行正则表达式和固定字符串替换的机制。</p>
</div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><h3 class="directives">指令</h3>
<ul id="toc">
<li><img alt="" src="../images/down.gif"> <a href="#substitute">替代</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#substituteinheritbefore">SubstituteInheritBefore</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#substitutemaxlinelength">替代MaxLineLength</a></li>
</ul>
<h3>错误修正清单</h3><ul class="seealso"><li><a href="https://www.apache.org/dist/httpd/CHANGES_2.4">httpd更新日志</a></li><li><a href="https://bz.apache.org/bugzilla/buglist.cgi?bug_status=__open__&amp;list_id=144532&amp;product=Apache httpd-2&amp;query_format=specific&amp;order=changeddate DESC%2Cpriority%2Cbug_severity&amp;component=mod_substitute">已知的问题</a></li><li><a href="https://bz.apache.org/bugzilla/enter_bug.cgi?product=Apache httpd-2&amp;component=mod_substitute">报告错误</a></li></ul></div>

<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="Substitute" id="Substitute">替代</a> <a name="substitute" id="substitute">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>用于过滤响应内容的模式</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>替换<var>s / pattern / substitution / [infq]</var></code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>目录.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>文件信息</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_substitute</td></tr>
</table>
    <p><code class="directive">Substitute</code>伪指令指定要应用于响应正文的搜索和替换模式。</p>

    <p>可以通过使用以下标志的任意组合来修改模式的含义：</p>

    <dl>
        <dt><code>一世</code></dt>
        <dd>执行不区分大小写的匹配。</dd>
        <dt><code>ñ</code></dt>
        <dd>默认情况下，模式被视为正则表达式。使用<code>n</code>标志强制将模式视为固定字符串。</dd>
        <dt><code>F</code></dt>
        <dd><code>f</code>标志使<code>mod_substitute</code>将替换的结果展平，从而允许以后的替换发生在该替换的边界上。这是默认值。</dd>
        <dt><code>q</code></dt>
        <dd><code>q</code>标志使<code>mod_substitute</code>在每次替换后都不会拉平存储桶。这会导致更快的响应和内存使用率的降低，但是只有在一个替换的结果不可能匹配下一个替换的模式或正则表达式的情况下，才应使用它。</dd>
    </dl>

    <p><var>替换</var>内容可能包含文字文本和正则表达式反向引用</p>

    <div class="example"><h3>例</h3><pre class="prettyprint lang-config">&lt;Location "/"&gt;
    AddOutputFilterByType SUBSTITUTE text/html
    Substitute "s/foo/bar/ni"
&lt;/Location&gt;</pre>
</div>

    <p>用于分隔（或“定界”）替换字符串各个部分的字符称为“定界符”，为此通常使用斜杠。</p>

    <p>如果模式或替换包含斜杠字符，则可以使用替代定界符使指令更具可读性：</p>

    <div class="example"><h3>使用替代定界符的示例</h3><pre class="prettyprint lang-config">&lt;Location "/"&gt;
    AddOutputFilterByType SUBSTITUTE text/html
    Substitute "s|&lt;BR */?&gt;|&lt;br /&gt;|i"
&lt;/Location&gt;</pre>
</div>

    <p>当使用正则表达式时，可以在比较和替换中使用反向引用，如以下示例所示：</p>
    <div class="example"><h3>使用反向引用和捕获的示例</h3><pre class="prettyprint lang-config">&lt;Location "/"&gt;
    AddOutputFilterByType SUBSTITUTE text/html
    # "foo=k,bar=k" -&gt; "foo/bar=k"
    Substitute "s|foo=(\w+),bar=\1|foo/bar=$1|"
&lt;/Location&gt;</pre>
</div>

    <p><code>mod_substitute</code>一种常见使用情况是前端服务器代理请求到后端服务器的请求，后端服务器返回带有带有硬编码嵌入式URL的HTML，这些URL引用了后端服务器。这些URL对最终用户不起作用，因为后端服务器无法访问。</p>

    <p>在这种情况下，可以使用<code>mod_substitute</code>将这些URL重写为可以在前端使用的URL：</p>

    <div class="example"><h3>重写嵌入在代理内容中的URL</h3><pre class="prettyprint lang-config">ProxyPass        "/blog/" "http://internal.blog.example.com/"
ProxyPassReverse "/blog/" "http://internal.blog.example.com/"

Substitute "s|http://internal.blog.example.com/|http://www.example.com/blog/|i"</pre>
</div>

    <p><code class="directive"><a href="../mod/mod_proxy.html#proxypassreverse">ProxyPassReverse</a></code>修改后端服务器发送的任何<code>Location</code> （重定向）标头，在此示例中， <code class="directive">Substitute</code>通过修复HTML响应来解决其余问题。</p>


</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="SubstituteInheritBefore" id="SubstituteInheritBefore">SubstituteInheritBefore</a> <a name="substituteinheritbefore" id="substituteinheritbefore">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>更改继承模式的合并顺序</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>SubstituteInheritBefore on | off</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>SubstituteInheritBefore关闭</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>目录.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>文件信息</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_substitute</td></tr>
<tr><th><a href="directive-dict.html#Compatibility">兼容性：</a></th><td>在httpd 2.4.17及更高版本中可用</td></tr>
</table>
    <p>是先（ <code>on</code> ）还是在当前上下文中的<code>on</code> （ <code>off</code> ）之后应用继承的<code class="directive"><a href="#substitute">Substitute</a></code>模式。
    <code class="directive">SubstituteInheritBefore</code>本身是继承的，因此继承它的上下文（未指定自己的<code class="directive">SubstituteInheritBefore</code>值的上下文）将应用最接近的定义合并顺序。</p>

</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="SubstituteMaxLineLength" id="SubstituteMaxLineLength">替代MaxLineLength</a> <a name="substitutemaxlinelength" id="substitutemaxlinelength">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>设置最大行大小</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>替代MaxLineLength <var>字节</var> （b | B | k | K | m | M | g | G）</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>SubstituteMaxLineLength 1m</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>目录.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>文件信息</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_substitute</td></tr>
<tr><th><a href="directive-dict.html#Compatibility">兼容性：</a></th><td>在httpd 2.4.11及更高版本中可用</td></tr>
</table>
    <p><code class="module"><a href="../mod/mod_substitute.html">mod_substitute</a></code>处理的最大行大小受限制以限制内存使用。可以使用<code class="directive">SubstituteMaxLineLength</code>配置该限制。该值可以作为字节数给出，并且可以后缀单个字母<code>b</code> ， <code>B</code> ， <code>k</code> ， <code>K</code> ， <code>m</code> ， <code>M</code> ， <code>g</code> ， <code>G</code>来分别提供字节，千字节，兆字节或千兆字节的大小。</p>

    <div class="example"><h3>例</h3><pre class="prettyprint lang-config">&lt;Location "/"&gt;
    AddOutputFilterByType SUBSTITUTE text/html
    SubstituteMaxLineLength 10m
    Substitute "s/foo/bar/ni"
&lt;/Location&gt;</pre>
</div>


</div>
</div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>
</body></html>