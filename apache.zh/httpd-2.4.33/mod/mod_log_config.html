<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>mod_log_config-Apache HTTP服务器版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body >
<div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="&lt;-" alt="&lt;-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP服务器</a> &gt; <a href="http://httpd.apache.org/docs/">文档</a> &gt; <a href="../index.html">版本2.4</a> &gt; <a href="./index.html">模块</a></div>
<div id="page-content">
<div id="preamble"><h1>Apache模块mod_log_config</h1>

<table class="module"><tr><th><a href="module-dict.html#Description">描述：</a></th><td>记录对服务器的请求</td></tr>
<tr><th><a href="module-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="module-dict.html#ModuleIdentifier">模块�标识符：</a></th><td>log_config_module</td></tr>
<tr><th><a href="module-dict.html#SourceFile">源文件：</a></th><td>mod_log_config.c</td></tr></table>
<h3>摘要</h3>

    <p>该模块提供了客户端请求的灵活日志记录。日志以可自定义的格式写入，并且可以直接写入文件或外部程序。提供有条件的日志记录，以便可以根据请求的特征将各个请求包括在日志中或从日志中排除。</p>

    <p>此模块提供了三个指令： <code class="directive"><a href="#transferlog">TransferLog</a></code>用于创建日志文件， <code class="directive"><a href="#logformat">LogFormat</a></code>用于设置自定义格式， <code class="directive"><a href="#customlog">CustomLog</a></code>用于定义日志文件和格式。每个服务器中可以多次使用<code class="directive">TransferLog</code>和<code class="directive">CustomLog</code>指令，以使每个请求都记录到多个文件中。</p>
</div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><h3>话题</h3>
<ul id="topics">
<li><img alt="" src="../images/down.gif"> <a href="#formats">自定义日志格式</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#security">安全注意事项</a></li>
</ul><h3 class="directives">指令</h3>
<ul id="toc">
<li><img alt="" src="../images/down.gif"> <a href="#bufferedlogs">缓冲日志</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#customlog">自定义日志</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#globallog">全球日志</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#logformat">日志格式</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#transferlog">传输日志</a></li>
</ul>
<h3>错误修正清单</h3><ul class="seealso"><li><a href="https://www.apache.org/dist/httpd/CHANGES_2.4">httpd更新日志</a></li><li><a href="https://bz.apache.org/bugzilla/buglist.cgi?bug_status=__open__&amp;list_id=144532&amp;product=Apache httpd-2&amp;query_format=specific&amp;order=changeddate DESC%2Cpriority%2Cbug_severity&amp;component=mod_log_config">已知的问题</a></li><li><a href="https://bz.apache.org/bugzilla/enter_bug.cgi?product=Apache httpd-2&amp;component=mod_log_config">报告错误</a></li></ul><h3>也可以看看</h3>
<ul class="seealso">
<li><a href="../logs.html">Apache日志文件</a></li>
</ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="formats" id="formats">自定义日志格式</a></h2>

    <p><code class="directive"><a href="#logformat">LogFormat</a></code>和<code class="directive"><a href="#customlog">CustomLog</a></code>指令的format参数是一个字符串。该字符串用于将每个请求记录到日志文件中。它可以包含复制到日志文件中的文字字符以及C样式的控制字符“ \ n”和“ \ t”，以表示换行符和制表符。文字引号和反斜杠应使用反斜杠转义。</p>

    <p>通过将“ <code>%</code> ”指令放置在格式字符串中来记录请求本身的特征，这些指令在日志文件中由以下值代替：</p>

    <table class="bordered"><tr class="header"><th>格式字符串</th>
        <th>描述</th></tr>
<tr><td><code>%%</code></td>
        <td>百分号。</td></tr>
<tr class="odd"><td><code>％一种</code></td>
        <td>请求的客户端IP地址（请参见<code class="module"><a href="../mod/mod_remoteip.html">mod_remoteip</a></code>模块）。</td></tr>
<tr><td><code>％{c} a</code></td>
        <td>连接的基础对等IP地址（请参见<code class="module"><a href="../mod/mod_remoteip.html">mod_remoteip</a></code>模块）。</td></tr>
<tr class="odd"><td><code>％一种</code></td>
        <td>本地IP地址。</td></tr>
<tr><td><code>％B</code></td>
        <td>响应的大小（以字节为单位），不包括HTTP标头。</td></tr>
<tr class="odd"><td><code>％b</code></td>
        <td>响应的大小（以字节为单位），不包括HTTP标头。采用CLF格式， <em>即</em>当没有字节发送时为' <code>-</code> '而不是0。</td></tr>
<tr><td><code>％{ <var>VARNAME</var> } C</code></td>
        <td>发送到服务器的请求中Cookie <var>VARNAME</var>的内容。仅完全支持版本0 Cookie。</td></tr>
<tr class="odd"><td><code>％D</code></td>
        <td>服务请求所花费的时间（以微秒为单位）。</td></tr>
<tr><td><code>％{ <var>VARNAME</var> } e</code></td>
        <td>环境变量<var>VARNAME</var>的内容。</td></tr>
<tr class="odd"><td><code>％F</code></td>
        <td>文档名称。</td></tr>
<tr><td><code>％H</code></td>
        <td>远程主机名。如果<code class="directive"><a href="../mod/core.html#hostnamelookups">HostnameLookups</a></code>设置为<code>Off</code> ，则将记录IP地址，这是默认设置。如果它仅记录了几台主机的主机名，则您可能具有访问控制指令，并按名称提及了它们。请参阅<a href="mod_authz_host.html#reqhost">需要主机文档</a> 。</td></tr>
<tr class="odd"><td><code>％H</code></td>
        <td>请求协议。</td></tr>
<tr><td><code>％{ <var>VARNAME</var> } i</code></td>
        <td>发送到服务器的请求中<code><var>VARNAME :</var></code>的内容<code><var>VARNAME</var> :</code>标头行。其他模块（例如<code class="module"><a href="../mod/mod_headers.html">mod_headers</a></code> ）所做的更改会对此产生影响。如果您对大多数模块进行修改之前的请求标头感兴趣，请使用<code class="module"><a href="../mod/mod_setenvif.html">mod_setenvif</a></code>将标头复制到内部环境变量中，并使用上述<code>%{ <var>VARNAME</var> }e</code>记录该值。
        </td></tr>
<tr class="odd"><td><code>％k</code></td>
        <td>在此连接上处理的保持活动请求数。如果正在使用<code class="directive"><a href="../mod/core.html#keepalive">KeepAlive</a></code> ，那么有趣的是，例如，“ 1”表示在初始请求之后的第一个keepalive请求，“ 2”表示在第二个请求之后的等等。;否则，它始终为0（表示初始请求）。</td></tr>
<tr><td><code>％l</code></td>
        <td>远程日志名（来自identd，如果提供）。除非存在<code class="module"><a href="../mod/mod_ident.html">mod_ident</a></code>且<code class="directive"><a href="../mod/mod_ident.html#identitycheck">IdentityCheck</a></code>设置为<code>On</code>否则这将返回破折号。</td></tr>
<tr class="odd"><td><code>％L</code></td>
        <td>错误日志中的请求日志ID（如果没有将此请求记录到错误日志中，则为'-'）。查找匹配的错误日志行，以查看导致该错误的请求。</td></tr>
<tr><td><code>％m</code></td>
        <td>请求方法。</td></tr>
<tr class="odd"><td><code>％{ <var>VARNAME</var> } n</code></td>
        <td>来自另一个模块的注释<var>VARNAME</var>的内容。</td></tr>
<tr><td><code>％{ <var>VARNAME</var> } o</code></td>
        <td><code><var>VARNAME :</var></code>的内容<code><var>VARNAME</var> :</code>回复中的标题行。</td></tr>
<tr class="odd"><td><code>％p</code></td>
        <td>服务请求的服务器的规范端口。</td></tr>
<tr><td><code>％{ <var>格式</var> } p</code></td>
        <td>服务请求的服务器的规范端口，或服务器的实际端口，或客户端的实际端口。有效格式是<code>canonical</code> ， <code>local</code>或<code>remote</code>格式。
        </td></tr>
<tr class="odd"><td><code>％P</code></td>
        <td>为请求提供服务的子进程的ID。</td></tr>
<tr><td><code>％{ <var>格式</var> } P</code></td>
        <td>为请求提供服务的子进程的进程ID或线程ID。有效格式为<code>pid</code> ， <code>tid</code>和<code>hextid</code> 。 <code>hextid</code>需要APR 1.2.0或更高版本。
        </td></tr>
<tr class="odd"><td><code>％q</code></td>
        <td>查询字符串（以<code>?</code>开头 如果查询字符串存在，否则为空字符串）。</td></tr>
<tr><td><code>％r</code></td>
        <td>第一行要求。</td></tr>
<tr class="odd"><td><code>％R</code></td>
        <td>生成响应的处理程序（如果有）。</td></tr>
<tr><td><code>％s</code></td>
        <td>状态。对于已在内部重定向的请求，这是<em>原始</em>请求的状态。使用<code>%&gt;s</code>作为最终状态。</td></tr>
<tr class="odd"><td><code>％t</code></td>
        <td>接收请求的时间，格式为<code>[18/Sep/2011:19:18:28 -0400]</code> 。最后一个数字表示与格林尼治标准时间的时区偏移量</td></tr>
<tr><td><code>％{ <var>格式</var> } t</code></td>
        <td>时间，采用格式给定的形式，应采用扩展的<code>strftime(3)</code>格式（可能已本地化）。如果格式以<code>begin:</code>默认）开头，则时间在请求处理开始时开始。如果它以<code>end:</code>开头<code>end:</code>这是日志条目被写入的时间，接近请求处理的结尾。除了<code>strftime(3)</code>支持的格式外，还支持以下格式标记：<table>
        <tr><td><code>秒</code></td><td>自大纪元以来的秒数</td></tr>
        <tr><td><code>毫秒</code></td><td>自纪元以来的毫秒数</td></tr>
        <tr><td><code>有用的</code></td><td>自纪元以来的微秒数</td></tr>
        <tr><td><code>msec_frac</code></td><td>毫秒分数</td></tr>
        <tr><td><code>usec_frac</code></td><td>微秒分数</td></tr>
        </table>这些标记不能互相组合，也不能以相同的格式字符串将<code>strftime(3)</code>格式化。您可以改用多个<code>%{ <var>format</var> }t</code>令牌。
        </td></tr>
<tr class="odd"><td><code>％T</code></td>
        <td>服务请求所花费的时间，以秒为单位。</td></tr>
<tr><td><code>％{ <var>UNIT</var> } T</code></td>
        <td>服务请求所花费的时间，以<code>UNIT</code>给出的时间单位表示。有效单位是<code>ms</code> （毫秒）， <code>us</code> （微秒）和<code>s</code> （秒）。使用<code>s</code>得到与<code>%T</code>相同的结果，但没有任何格式；使用<code>us</code>得到与<code>%D</code>相同的结果。在2.4.13及更高版本中可以将<code>%T</code>与单位组合在一起。</td></tr>
<tr class="odd"><td><code>％u</code></td>
        <td>远程用户（如果请求已通过身份验证）。如果返回状态（ <code>%s</code> ）为401（未经授权），则可能是伪造的。</td></tr>
<tr><td><code>％U</code></td>
        <td>请求的URL路径，不包括任何查询字符串。</td></tr>
<tr class="odd"><td><code>％v</code></td>
        <td>服务请求的服务器的规范<code class="directive"><a href="../mod/core.html#servername">ServerName</a></code> 。</td></tr>
<tr><td><code>％V</code></td>
        <td>根据<code class="directive"><a href="../mod/core.html#usecanonicalname">UseCanonicalName</a></code>设置的服务器名称。</td></tr>
<tr class="odd"><td><code>％X</code></td>
        <td>响应完成时的连接状态：<table>
        
        <tr><td><code>X</code> =</td>
            <td>在响应完成之前，连接已中止。</td></tr>
        <tr><td><code>+</code> =</td>
            <td>发送响应后，连接可以保持活动状态。</td></tr>
        <tr><td><code>-</code> =</td>
            <td>发送响应后，连接将关闭。</td></tr>
        </table>

        </td></tr>
<tr><td><code>％一世</code></td>
        <td>收到的字节，包括请求和标头。不能为零。您需要启用<code class="module"><a href="../mod/mod_logio.html">mod_logio</a></code>才能使用它。</td></tr>
<tr class="odd"><td><code>％O</code></td>
        <td>发送的字节，包括标题。在极少数情况下（例如在发送响应之前中止请求时）可能为零。您需要启用<code class="module"><a href="../mod/mod_logio.html">mod_logio</a></code>才能使用它。</td></tr>
<tr><td><code>％S</code></td>
        <td>传输（接收和发送）的字节（包括请求和标头）不能为零。这是％I和％O的组合。您需要启用<code class="module"><a href="../mod/mod_logio.html">mod_logio</a></code>才能使用它。</td></tr>
<tr class="odd"><td><code>％{ <var>VARNAME</var> } ^ ti</code></td>
        <td>发送给服务器的请求中<code><var>VARNAME :</var></code>的内容<code><var>VARNAME</var> :</code>预告片行。</td></tr>
<tr><td><code>％{ <var>VARNAME</var> } ^至</code></td>
        <td>服务器发送的响应中<code><var>VARNAME :</var></code>的内容<code><var>VARNAME</var> :</code>行。</td></tr>
</table>

    <h3><a name="modifiers" id="modifiers">修饰符</a></h3>

      <p>通过将逗号分隔的状态代码列表紧跟在“％”之后，可以将特定项限制为仅打印具有特定HTTP状态代码的响应。状态代码列表前面可能带有“ <code>!</code> ” <code>!</code>”表示否定。</p>

    <table class="bordered"><tr class="header"><th>格式字符串</th>
    <th>含义</th></tr>
<tr>
    <td><code>％400,501 {User-agent} i</code></td>
    <td>仅在400个错误和501个错误上记录<code>User-agent</code> 。对于其他状态代码，将记录文字字符串<code>"-"</code> 。</td></tr>
<tr class="odd"><td><code>％！200,304,302 {Referer} i</code></td>
    <td>在所有<em>不</em>返回三个指定代码之一的请求上记录<code>Referer</code> ，否则返回“ <code>-</code> ”。
    </td></tr>
</table>

      <p>修饰符“ &lt;”和“&gt;”可用于已在内部重定向的请求，以选择应查询原始请求还是最终（分别）请求。默认情况下， <code>%</code>指令<code>%s, %U, %T, %D,</code>和<code>%r</code>查看原始请求，而其他所有指令查看最终请求。因此，例如， <code>%&gt;s</code>可以用于记录请求的最终状态， <code>%&lt;u</code>可以用于记录在内部重定向到未经身份验证的资源的请求上的原始经过身份验证的用户。</p>

    

    <h3><a name="format-notes" id="format-notes">格式注释</a></h3>

      <p>出于安全原因，从版本2.0.46开始， <code>%r</code> ， <code>%i</code>和<code>%o</code>中的不可打印字符和其他特殊字符使用<code>\x <var>hh</var></code>序列转义，其中<var>hh</var>代表原始字节的十六进制表示形式。该规则的例外是<code>"</code>和<code>\</code> ，它们前面加反斜杠即可转义，所有空白字符均以C样式表示（ <code>\n</code> ， <code>\t</code>等）编写。在2.0.46之前的版本中，没有对这些字符串进行转义，因此在处理原始日志文件时必须非常小心。</p>

      <p>从httpd 2.0开始，与1.3不同， <code>%b</code>和<code>%B</code>格式字符串不代表发送到客户端的字节数，而只是代表HTTP响应的字节大小（例如，如果连接中止，字节数将有所不同）。 ，或者使用SSL）。<code class="module"><a href="../mod/mod_logio.html">mod_logio</a></code>提供的<code>%O</code>格式将记录通过网络发送的实际字节数。</p>

      <div class="note">
      <p>注意： <code class="module"><a href="../mod/mod_cache.html">mod_cache</a></code>是作为快速处理程序而不是标准处理程序实现的。因此，当涉及内容缓存时， <code>%R</code>格式字符串将不返回任何处理程序信息。</p>
      </div>

    

    <h3><a name="examples" id="examples">例子</a></h3>

      <p>一些常用的日志格式字符串是：</p>

      <dl>
        <dt>通用日志格式（CLF）</dt>
        <dd><code>“％h％l％u％t \”％r \“％&gt; s％b”</code></dd>

        <dt>虚拟主机的通用日志格式</dt>
        <dd><code>“％v％h％l％u％t \”％r \“％&gt; s％b”</code></dd>

        <dt>NCSA扩展/组合日志格式</dt>
        <dd><code>“％h％l％u％t \”％r \“％&gt; s％b \”％{Referer} i \“ \”％{User-agent} i \“”</code></dd>

        <dt>引用日志格式</dt>
        <dd><code>“％{Referer} i-&gt;％U”</code></dd>

        <dt>代理（浏览器）日志格式</dt>
        <dd><code>“％{User-agent} i”</code></dd>
      </dl>

      <p>您可以多次使用<code>%{format}t</code>指令，使用诸如<code>msec_frac</code>类的扩展格式标记来建立时间格式：</p>
      <dl>
<dt>时间戳（包括毫秒）</dt>
<dd><code>“％{％d /％b /％Y％T} t。％{msec_frac} t％{％z} t”</code></dd>

      </dl>

    
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="security" id="security">安全注意事项</a></h2>
    <p>请参阅<a href="../misc/security_tips.html#serverroot">安全性提示</a>文档，以获取有关如果启动日志的用户以外的任何人都可写存储日志文件的目录的原因，为什么会损害安全性的详细信息。</p>
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="BufferedLogs" id="BufferedLogs">BufferedLogs</a> <a name="bufferedlogs" id="bufferedlogs">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>写入磁盘之前在内存中缓冲日志条目</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>缓冲登录开|关</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>缓冲注销</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_log_config</td></tr>
</table>
    <p><code class="directive">BufferedLogs</code>指令使<code class="module"><a href="../mod/mod_log_config.html">mod_log_config</a></code>将多个日志条目存储在内存中，然后将它们一起写入磁盘，而不是在每次请求后将它们写入。在某些系统上，这可能导致更有效的磁盘访问并因此获得更高的性能。整个服务器只能设置一次。不能为每个虚拟主机配置它。</p>

    <div class="note">应谨慎使用此指令，因为崩溃可能会导致日志数据丢失。</div>

</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="CustomLog" id="CustomLog">CustomLog</a> <a name="customlog" id="customlog">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>设置日志文件的文件名和格式</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>CustomLog <var>文件</var> | <var>管道</var> <var>格式</var> | <var>昵称</var> [env = [！]<var>环境变量</var> | expr = <var>表达式</var> ]</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_log_config</td></tr>
</table>
    <p><code class="directive">CustomLog</code>指令用于将请求记录到服务器。指定了日志格式，并且可以选择使用环境变量将日志设置为基于请求特征的条件。</p>

    <p>第一个参数指定要写入日志的位置，可以采用以下两种类型之一：</p>

    <dl>
      <dt><var>文件</var></dt>
      <dd>相对于<code class="directive"><a href="../mod/core.html#serverroot">ServerRoot</a></code>文件名。</dd>

      <dt><var>管</var></dt>
      <dd>管道字符“ <code>|</code> ”，后跟程序的路径，以在其标准输入上接收日志信息。有关更多信息，请参见<a href="../logs.html#piped">管道日志中</a>的注释。

      <div class="warning"><h3>安全：</h3>
      <p>如果使用了程序，则它将以启动<code class="program"><a href="../programs/httpd.html">httpd</a></code>的用户身份运行。如果服务器是由root启动的，则它将是root；否则，它将是root。确保程序安全。</p>
      </div>
      <div class="warning"><h3>注意</h3>
        <p>在非Unix平台上输入文件路径时，应注意确保即使平台允许使用反斜杠，也只能使用正斜杠。通常，在整个配置文件中始终使用正斜杠是一个好主意。</p>
      </div></dd>
    </dl>

    <p>第二个参数指定将写入日志文件的内容。它可以指定由先前的<code class="directive"><a href="#logformat">LogFormat</a></code>指令定义的<var>昵称</var> ，也可以是如“ <a href="#formats">日志格式”</a>部分中所述的显式<var>格式</var>字符串。</p>

    <p>例如，以下两组指令具有完全相同的效果：</p>

    <pre class="prettyprint lang-config"># CustomLog with format nickname
LogFormat "%h %l %u %t \"%r\" %&gt;s %b" common
CustomLog "logs/access_log" common

# CustomLog with explicit format string
CustomLog "logs/access_log" "%h %l %u %t \"%r\" %&gt;s %b"</pre>


    <p>第三个参数是可选的，它控制是否记录特定请求。条件可以是存在或不存在（对于' <code>env=!服务器<a href="../env.html">环境中</a>特定变量的<var>name</var></code> ）。或者，该条件可以表示为任意布尔<a href="../expr.html">表达式</a> 。如果不满足条件，则不会记录该请求。在表达式中引用HTTP标头不会导致将标头名称添加到Vary标头中。</p>

    <p>可以使用<code class="module"><a href="../mod/mod_setenvif.html">mod_setenvif</a></code>和/或<code class="module"><a href="../mod/mod_rewrite.html">mod_rewrite</a></code>模块在每个请求的基础上设置环境变量。例如，如果要在单独的日志文件中而不是在主日志中记录对服务器上所有GIF图像的请求，则可以使用：</p>

    <pre class="prettyprint lang-config">SetEnvIf Request_URI \.gif$ gif-image
CustomLog "gif-requests.log" common env=gif-image
CustomLog "nongif-requests.log" common env=!gif-image</pre>


    <p>或者，要重现旧的RefererIgnore指令的行为，可以使用以下命令：</p>

    <pre class="prettyprint lang-config">SetEnvIf Referer example\.com localreferer
CustomLog "referer.log" referer env=!localreferer</pre>


</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="GlobalLog" id="GlobalLog">GlobalLog</a> <a name="globallog" id="globallog">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>设置日志文件的文件名和格式</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>GlobalLog <var>文件</var> | <var>管道</var> <var>格式</var> | <var>昵称</var> [env = [！]<var>环境变量</var> | expr = <var>表达式</var> ]</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_log_config</td></tr>
<tr><th><a href="directive-dict.html#Compatibility">兼容性：</a></th><td>在Apache HTTP Server 2.4.19和更高版本中可用</td></tr>
</table>

    <p><code class="directive">GlobalLog</code>指令定义由主服务器配置和所有定义的虚拟主机共享的日志。</p>

    <p>除了以下差异之外， <code class="directive">GlobalLog</code>指令与<code class="directive">CustomLog</code>指令相同：</p>
    <ul>
       <li><code class="directive">GlobalLog</code>在虚拟主机上下文中无效。</li>
       <li>与全局指定的<code class="directive">CustomLog</code>不同，定义了自己的<code class="directive">CustomLog</code>的虚拟主机使用<code class="directive">GlobalLog</code> 。</li>
    </ul>

</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="LogFormat" id="LogFormat">LogFormat</a> <a name="logformat" id="logformat">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>描述在日志文件中使用的格式</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>LogFormat <var>格式</var> | <var>昵称</var> [ <var>昵称</var> ]</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>LogFormat“％h％l％u％t \”％r \“％&gt; s％b”</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_log_config</td></tr>
</table>
    <p>该伪指令指定访问日志文件的格式。</p>

    <p><code class="directive">LogFormat</code>指令可以采用以下两种形式之一。在第一种形式中，仅指定一个参数，此伪指令设置日志格式，该格式将由后续<code class="directive">TransferLog</code>伪指令中指定的日志使用。单个参数可以指定一种显式<var>格式，</var>如上面的“ <a href="#formats">自定义日志格式”</a>部分所述。或者，它可以使用<var>昵称</var>来引用在先前的<code class="directive">LogFormat</code>指令中定义的日志格式，如下所述。</p>

    <p><code class="directive">LogFormat</code>指令的第二种形式将显式<var>格式</var>与<var>昵称</var>相关联。然后，可以在后续的<code class="directive">LogFormat</code>或<code class="directive"><a href="#customlog">CustomLog</a></code>指令中使用此<var>昵称，</var>而不用重复整个格式字符串。定义昵称的<code class="directive">LogFormat</code>指令<strong>不执行其他操作</strong> -也就是说，它<em>仅</em>定义昵称，实际上不应用格式并将其设置为默认格式。因此，它不会影响后续的<code class="directive"><a href="#transferlog">TransferLog</a></code>指令。此外， <code class="directive">LogFormat</code>不能使用一个昵称来定义另一个昵称。请注意，昵称不应包含百分号（ <code>%</code> ）。</p>

    <div class="example"><h3>例</h3><pre class="prettyprint lang-config">LogFormat "%v %h %l %u %t \"%r\" %&gt;s %b" vhost_common</pre>
</div>
    

</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="TransferLog" id="TransferLog">TransferLog</a> <a name="transferlog" id="transferlog">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>指定日志文件的位置</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>TransferLog <var>文件</var> | <var>管</var></code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_log_config</td></tr>
</table>
    <p>该伪指令具有与<code class="directive"><a href="#customlog">CustomLog</a></code>伪指令完全相同的参数和作用，不同之处在于它不允许显式指定日志格式或不允许有条件地记录请求。而是，日志格式由最近指定的<code class="directive"><a href="#logformat">LogFormat</a></code>指令确定，该指令未定义昵称。如果未指定其他格式，则使用“通用日志格式”。</p>

    <div class="example"><h3>例</h3><pre class="prettyprint lang-config">LogFormat "%h %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-agent}i\""
TransferLog logs/access_log</pre>
</div>

</div>
</div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>
</body></html>