<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>mod_isapi-Apache HTTP服务器版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body >
<div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="&lt;-" alt="&lt;-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP服务器</a> &gt; <a href="http://httpd.apache.org/docs/">文档</a> &gt; <a href="../index.html">版本2.4</a> &gt; <a href="./index.html">模块</a></div>
<div id="page-content">
<div id="preamble"><h1>Apache模块mod_isapi</h1>

<table class="module"><tr><th><a href="module-dict.html#Description">描述：</a></th><td>Windows版Apache中的ISAPI扩展</td></tr>
<tr><th><a href="module-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="module-dict.html#ModuleIdentifier">模块�标识符：</a></th><td>isapi_module</td></tr>
<tr><th><a href="module-dict.html#SourceFile">源文件：</a></th><td>mod_isapi.c</td></tr>
<tr><th><a href="module-dict.html#Compatibility">兼容性：</a></th><td>仅Win32</td></tr></table>
<h3>摘要</h3>

    <p>此模块实现Internet服务器扩展API。它允许Apache for Windows提供Internet服务器扩展（ <em>例如</em> ISAPI .dll模块），但要遵守上述限制。</p>

    <p>ISAPI扩展模块（.dll文件）由第三方编写。Apache Group不编写这些模块，因此我们不为它们提供支持。如果您在运行ISAPI扩展时遇到问题，请直接与ISAPI的作者联系。<strong>请<em>不要</em>将此类问题发布到Apache的列表或错误报告页面。</strong></p>
</div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><h3>话题</h3>
<ul id="topics">
<li><img alt="" src="../images/down.gif"> <a href="#usage">用法</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#notes">附加条款</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#journal">程序员杂志</a></li>
</ul><h3 class="directives">指令</h3>
<ul id="toc">
<li><img alt="" src="../images/down.gif"> <a href="#isapiappendlogtoerrors">ISAPIAppendLogToErrors</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#isapiappendlogtoquery">ISAPIAppendLogToQuery</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#isapicachefile">ISAPICacheFile</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#isapifakeasync">ISAPIFakeAsync</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#isapilognotsupported">ISAPILogNotSupported</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#isapireadaheadbuffer">ISAPIReadAheadBuffer</a></li>
</ul>
<h3>错误修正清单</h3><ul class="seealso"><li><a href="https://www.apache.org/dist/httpd/CHANGES_2.4">httpd更新日志</a></li><li><a href="https://bz.apache.org/bugzilla/buglist.cgi?bug_status=__open__&amp;list_id=144532&amp;product=Apache httpd-2&amp;query_format=specific&amp;order=changeddate DESC%2Cpriority%2Cbug_severity&amp;component=mod_isapi">已知的问题</a></li><li><a href="https://bz.apache.org/bugzilla/enter_bug.cgi?product=Apache httpd-2&amp;component=mod_isapi">报告错误</a></li></ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="usage" id="usage">用法</a></h2>

    <p>在服务器配置文件中，使用<code class="directive"><a href="../mod/mod_mime.html#addhandler">AddHandler</a></code>指令将ISAPI文件与<code>isapi-handler</code>处理程序相关联，并使用文件扩展<code>isapi-handler</code>其映射到它们。若要将任何.dll文件作为ISAPI扩展名进行处理，请编辑httpd.conf文件并添加以下行：</p>
    <pre class="prettyprint lang-config">AddHandler isapi-handler .dll</pre>


    <div class="note">在旧版本的Apache服务器中， <code>isapi-isa</code>是正确的处理程序名称，而不是<code>isapi-handler</code> 。从Apache服务器的2.3开发版本开始， <code>isapi-isa</code>不再有效。您将需要更改配置以改为使用<code>isapi-handler</code> 。</div>

    <p>Apache服务器中没有能力保持请求的模块已加载。但是，您可以通过在httpd.conf中使用以下语法来预加载并保持特定模块的加载：</p>
    <pre class="prettyprint lang-config">ISAPICacheFile c:/WebWork/Scripts/ISAPI/mytest.dll</pre>


    <p>不管您是否已预加载ISAPI扩展，所有ISAPI扩展都受与CGI脚本相同的权限和限制。也就是说，必须为包含ISAPI .dll文件的目录设置<code class="directive"><a href="../mod/core.html#options">Options</a></code> <code>ExecCGI</code> 。</p>

    <p>查看<a href="#notes">其他说明</a>和《 <a href="#journal">程序员杂志》，</a>以获取更多详细信息，并<code class="module"><a href="../mod/mod_isapi.html">mod_isapi</a></code>提供的特定ISAPI支持。</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="notes" id="notes">附加条款</a></h2>

    <p>Apache的ISAPI实现符合所有ISAPI 2.0规范，除了一些处理异步I / O的“ Microsoft特定”扩展之外。 Apache的I / O模型不允许以ISAPI可以访问的方式进行异步读写。如果ISA尝试访问不支持的功能（包括异步I / O），则会在错误日志中放置一条消息以帮助调试。由于这些消息可能会泛滥，因此存在指令<code>ISAPILogNotSupported Off</code>可以消除此噪音。</p>

    <p>某些服务器（例如Microsoft IIS）将ISAPI扩展加载到服务器中，并保持加载状态，直到内存使用率过高，或者除非指定了配置选项。除非指定了<code class="directive"><a href="#isapicachefile">ISAPICacheFile</a></code>指令，否则Apache当前每次都会在每次请求时加载和卸载ISAPI扩展。这效率低下，但是Apache的内存模型使之成为最有效的方法。许多ISAPI模块与Apache服务器都有一定的不兼容，卸载这些模块有助于确保服务器的稳定性。</p>

    <p>另外，请记住，虽然Apache支持ISAPI扩展，但<strong>它不支持ISAPI过滤器</strong> 。以后可能会增加对过滤器的支持，但是目前不计划支持。</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="journal" id="journal">程序员杂志</a></h2>

    <p>如果要编程Apache 2.0 <code class="module"><a href="../mod/mod_isapi.html">mod_isapi</a></code>模块，则必须将对<code>ServerSupportFunction</code>的调用限制为以下指令：</p>

    <dl>
      <dt><code>HSE_REQ_SEND_URL_REDIRECT_RESP</code></dt>
      <dd>将用户重定向到另一个位置。<br>这必须是完全限定的URL（ <em>例如，</em> <code>http://server/location</code> ）。</dd>

      <dt><code>HSE_REQ_SEND_URL</code></dt>
      <dd>将用户重定向到另一个位置。<br>这不能是完全限定的URL，不允许您传递协议或服务器名称（ <em>例如，</em>简单地<code>/location</code> ）。<br>此重定向由服务器而非浏览器处理。<br>
      <div class="warning"><h3>警告</h3>
        <p>在最近的文档中，Microsoft似乎已经放弃了两个<code>HSE_REQ_SEND_URL</code>函数之间的区别。Apache继续将它们视为具有不同要求和行为的两个不同功能。</p>
      </div></dd>

      <dt><code>HSE_REQ_SEND_RESPONSE_HEADER</code></dt>
      <dd>如果Apache跟随header字符串参数中的空白行（两个连续的换行符），则在标题之后接受一个响应正文。该主体不能包含NULL，因为headers参数以NULL终止。</dd>

      <dt><code>HSE_REQ_DONE_WITH_SESSION</code></dt>
      <dd>Apache将此视为无操作，因为当ISAPI从处理返回时，会话将结束。</dd>

      <dt><code>HSE_REQ_MAP_URL_TO_PATH</code></dt>
      <dd>Apache会将虚拟名称转换为物理名称。</dd>

      <dt><code>HSE_APPEND_LOG_PARAMETER</code></dt>
      <dd>可以在以下任何日志中捕获此记录的消息：<ul>
          <li>在<code class="directive"><a href="../mod/mod_log_config.html#customlog">CustomLog</a></code>指令的<code>\"%{isapi-parameter}n\"</code>组件中</li>

          <li>在带有<code class="directive"><a href="#isapiappendlogtoquery">ISAPIAppendLogToQuery</a></code> <code>On</code>指令的<code>%q</code>日志组件中</li>

          <li>在错误日志中使用<code class="directive"><a href="#isapiappendlogtoerrors">ISAPIAppendLogToErrors</a></code> <code>On</code>指令</li>
        </ul>

        <p>第一个选项是<code>%{isapi-parameter}n</code>组件，始终可用并且是首选。</p>
      </dd>

      <dt><code>HSE_REQ_IS_KEEP_CONN</code></dt>
      <dd>将返回协商的Keep-Alive状态。</dd>

      <dt><code>HSE_REQ_SEND_RESPONSE_HEADER_EX</code></dt>
      <dd>尽管会忽略<code>fKeepConn</code>标志，但其行为将与文档中所述<code>fKeepConn</code> 。</dd>

      <dt><code>HSE_REQ_IS_CONNECTED</code></dt>
      <dd>如果请求已中止，将报告false。</dd>
    </dl>

    <p>Apache对任何不支持的<code>ServerSupportFunction</code>调用返回<code>FALSE</code> ，并将<code>GetLastError</code>值设置为<code>ERROR_INVALID_PARAMETER</code> 。</p>

    <p><code>ReadClient</code>检索超出初始缓冲区（由<code class="directive"><a href="#isapireadaheadbuffer">ISAPIReadAheadBuffer</a></code>定义）的请求正文。基于<code class="directive">ISAPIReadAheadBuffer</code>设置（调用ISAPI处理程序之前要缓冲的字节数），较短的请求在被调用时会完整地发送到扩展。如果请求更长，则ISAPI扩展必须使用<code>ReadClient</code>来检索剩余的请求正文。</p>

    <p>支持<code>WriteClient</code> ，但仅使用<code>HSE_IO_SYNC</code>标志或不使用选项标志（值为<code>0</code> ）。其他任何<code>WriteClient</code>请求都将被拒绝，返回值为<code>FALSE</code> ，而<code>GetLastError</code>值为<code>ERROR_INVALID_PARAMETER</code> 。</p>

    <p>尽管不存在扩展服务器变量（由其他服务器定义），但支持<code>GetServerVariable</code> 。可以从<code>GetServerVariable</code>获得所有常规的Apache CGI环境变量以及<code>ALL_HTTP</code>和<code>ALL_RAW</code>值。</p>

    <p>从httpd 2.0开始， <code class="module"><a href="../mod/mod_isapi.html">mod_isapi</a></code>支持ISAPI规范的更高版本中引入的其他功能，以及异步I / O和<code>TransmitFile</code>语义的有限仿真。Apache httpd还支持预加载ISAPI .dll以提高性能。</p>
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="ISAPIAppendLogToErrors" id="ISAPIAppendLogToErrors">ISAPIAppendLogToErrors</a> <a name="isapiappendlogtoerrors" id="isapiappendlogtoerrors">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>将来自ISAPI扩展的<code>HSE_APPEND_LOG_PARAMETER</code>请求记录到错误日志中</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>ISAPIAppendLogToErrors开启|关闭</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>ISAPIAppendLogToErrors关闭</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机，目录，.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>文件信息</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_isapi</td></tr>
</table>
    <p>将来自ISAPI扩展的<code>HSE_APPEND_LOG_PARAMETER</code>请求记录到服务器错误日志中。</p>

</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="ISAPIAppendLogToQuery" id="ISAPIAppendLogToQuery">ISAPIAppendLogToQuery</a> <a name="isapiappendlogtoquery" id="isapiappendlogtoquery">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>将来自ISAPI扩展的<code>HSE_APPEND_LOG_PARAMETER</code>请求记录到查询字段</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>ISAPIAppendLogToQuery开启|关闭</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>ISAPIAppendLogToQuery在</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机，目录，.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>文件信息</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_isapi</td></tr>
</table>
    <p>将来自ISAPI扩展的<code>HSE_APPEND_LOG_PARAMETER</code>请求记录到查询字段（附加到<code class="directive"><a href="../mod/mod_log_config.html#customlog">CustomLog</a></code> <code>%q</code>组件）。</p>

</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="ISAPICacheFile" id="ISAPICacheFile">ISAPICacheFile</a> <a name="isapicachefile" id="isapicachefile">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>ISAPI .dll文件在启动时加载</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>ISAPICacheFile <var>文件路径</var> [ <var>file-path</var> ] ...</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_isapi</td></tr>
</table>
    <p>指定以空格分隔的文件名列表，该文件名将在启动Apache服务器时加载，并保持加载状态，直到服务器关闭为止。可以为每个ISAPI .dll文件重复此指令。应该指定每个文件的完整路径名。如果路径名不是绝对的，则将相对于<code class="directive"><a href="../mod/core.html#serverroot">ServerRoot</a></code>进行处理。</p>

</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="ISAPIFakeAsync" id="ISAPIFakeAsync">ISAPIFakeAsync</a> <a name="isapifakeasync" id="isapifakeasync">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>对ISAPI回调的虚假异步支持</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>ISAPIFakeAsync开启|关闭</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>ISAPIFakeAsync关闭</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机，目录，.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>文件信息</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_isapi</td></tr>
</table>
    <p>设置为on时，将模拟对ISAPI回调的异步支持。</p>

</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="ISAPILogNotSupported" id="ISAPILogNotSupported">ISAPILogNotSupported</a> <a name="isapilognotsupported" id="isapilognotsupported">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>记录来自ISAPI扩展的不支持的功能请求</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>ISAPILogNotSupported开|关</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>ISAPILogNotSupported关闭</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机，目录，.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>文件信息</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_isapi</td></tr>
</table>
    <p>将来自ISAPI扩展的所有不支持功能的请求记录在服务器错误日志中。这可以帮助管理员查找问题。设置为打开并且所有所需的ISAPI模块都可以运行后，应将其设置回关闭。</p>

</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="ISAPIReadAheadBuffer" id="ISAPIReadAheadBuffer">ISAPIReadAheadBuffer</a> <a name="isapireadaheadbuffer" id="isapireadaheadbuffer">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>发送到ISAPI扩展的预读缓冲区的大小</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>ISAPIReadAheadBuffer的<var>大小</var></code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>ISAPIReadAheadBuffer 49152</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机，目录，.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>文件信息</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_isapi</td></tr>
</table>
    <p>定义在初始调用时发送给ISAPI扩展的预读缓冲区的最大大小。必须使用<code>ReadClient</code>回调检索所有剩余数据；某些ISAPI扩展可能不支持<code>ReadClient</code>功能。将问题转给ISAPI扩展的作者。</p>

</div>
</div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>
</body></html>