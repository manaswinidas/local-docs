<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>mod_brotli-Apache HTTP服务器版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body >
<div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="&lt;-" alt="&lt;-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP服务器</a> &gt; <a href="http://httpd.apache.org/docs/">文档</a> &gt; <a href="../index.html">版本2.4</a> &gt; <a href="./index.html">模块</a></div>
<div id="page-content">
<div id="preamble"><h1>Apache模块mod_brotli</h1>

<table class="module"><tr><th><a href="module-dict.html#Description">描述：</a></th><td>在将内容交付给客户端之前，先通过Brotli对其进行压缩</td></tr>
<tr><th><a href="module-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="module-dict.html#ModuleIdentifier">模块�标识符：</a></th><td>brotli_module</td></tr>
<tr><th><a href="module-dict.html#SourceFile">源文件：</a></th><td>mod_brotli.c</td></tr>
<tr><th><a href="module-dict.html#Compatibility">兼容性：</a></th><td>在版本2.4.26和更高版本中可用。</td></tr></table>
<h3>摘要</h3>

    <p><code class="module"><a href="../mod/mod_brotli.html">mod_brotli</a></code>模块提供了<code>BROTLI_COMPRESS</code>输出过滤器，该过滤器允许使用brotli压缩格式对服务器的输出进行压缩，然后再通过网络将其发送到客户端。该模块使用位于<a href="https://github.com/google/brotli">https://github.com/google/brotli</a>的Brotli库。</p>
</div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><h3>话题</h3>
<ul id="topics">
<li><img alt="" src="../images/down.gif"> <a href="#recommended">样本配置</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#enable">启用压缩</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#proxies">处理代理服务器</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#precompressed">提供预压缩的内容</a></li>
</ul><h3 class="directives">指令</h3>
<ul id="toc">
<li><img alt="" src="../images/down.gif"> <a href="#brotlialteretag">BrotliAlterETag</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#brotlicompressionmaxinputblock">BrotliCompressionMaxInputBlock</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#brotlicompressionquality">BrotliCompressionQuality</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#brotlicompressionwindow">BrotliCompressionWindow</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#brotlifilternote">BrotliFilterNote</a></li>
</ul>
<h3>错误修正清单</h3><ul class="seealso"><li><a href="https://www.apache.org/dist/httpd/CHANGES_2.4">httpd更新日志</a></li><li><a href="https://bz.apache.org/bugzilla/buglist.cgi?bug_status=__open__&amp;list_id=144532&amp;product=Apache httpd-2&amp;query_format=specific&amp;order=changeddate DESC%2Cpriority%2Cbug_severity&amp;component=mod_brotli">已知的问题</a></li><li><a href="https://bz.apache.org/bugzilla/enter_bug.cgi?product=Apache httpd-2&amp;component=mod_brotli">报告错误</a></li></ul><h3>也可以看看</h3>
<ul class="seealso">
<li><a href="../filter.html">筛选器</a></li>
</ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="recommended" id="recommended">样本配置</a></h2>
    <div class="warning"><h3>压缩和TLS</h3>
        <p>当TLS连接传输压缩数据时，某些Web应用程序容易受到信息泄露攻击。有关更多信息，请查看“ BREACH”攻击家族的详细信息。</p>
    </div>
    <p>这是压缩常见的基于文本的内容类型的简单配置。</p>

    <div class="example"><h3>仅压缩几种类型</h3><pre class="prettyprint lang-config">AddOutputFilterByType BROTLI_COMPRESS text/html text/plain text/xml text/css text/javascript application/javascript</pre>
</div>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="enable" id="enable">启用压缩</a></h2>
    <div class="warning"><h3>压缩和TLS</h3>
        <p>当TLS连接传输压缩数据时，某些Web应用程序容易受到信息泄露攻击。有关更多信息，请查看“ BREACH”攻击家族的详细信息。</p>
    </div>

    <h3><a name="output" id="output">输出压缩</a></h3>
      <p>压缩由<code>BROTLI_COMPRESS</code> <a href="../filter.html">过滤器实现</a> 。以下伪指令将对文件所在的容器中的文档启用压缩：</p>

      <pre class="prettyprint lang-config">SetOutputFilter BROTLI_COMPRESS
SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png)$ no-brotli</pre>


      <p>通常，如果要将压缩限制为特定的MIME类型，则可以使用<code class="directive"><a href="../mod/mod_filter.html#addoutputfilterbytype">AddOutputFilterByType</a></code>指令。这是仅对Apache文档的html文件启用压缩的示例：</p>

      <pre class="prettyprint lang-config">&lt;Directory "/your-server-root/manual"&gt;
    AddOutputFilterByType BROTLI_COMPRESS text/html
&lt;/Directory&gt;</pre>


      <div class="note"><h3>注意</h3>始终将<code>BROTLI_COMPRESS</code>过滤器插入在PHP或SSI之类的RESOURCE过滤器之后。它从不涉及内部子请求。
      </div>
      <div class="note"><h3>注意</h3>有一个环境变量<code>no-brotli</code> ，通过设置<code class="directive"><a href="../mod/mod_env.html#setenv">SetEnv</a></code> ，其中将禁用brotli压缩为特定的请求，即使它是由客户端所支持。
      </div>

    

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="proxies" id="proxies">处理代理服务器</a></h2>

    <p><code class="module"><a href="../mod/mod_brotli.html">mod_brotli</a></code>模块发送<code>Vary: Accept-Encoding</code> HTTP响应标头，以警告代理缓存的响应仅应发送给发送适当的<code>Accept-Encoding</code>请求标头的客户端。这样可以防止将压缩的内容发送给无法理解的客户端。</p>

    <p>如果您使用某些依赖于（例如） <code>User-Agent</code>标头的特殊排除项，则必须手动配置<code>Vary</code>标头的附加项，以向代理警告其他限制。例如，在典型的配置中，添加<code>BROTLI_COMPRESS</code>过滤器取决于<code>User-Agent</code> ，您应该添加：</p>

    <pre class="prettyprint lang-config">Header append Vary User-Agent</pre>


    <p>如果关于压缩的决定取决于请求标头（ <em>例如</em> HTTP版本）以外的其他信息，则必须将<code>Vary</code>标头设置为值<code>*</code> 。这样可以防止兼容代理完全缓存。</p>

    <div class="example"><h3>例</h3><pre class="prettyprint lang-config">Header set Vary *</pre>
</div>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="precompressed" id="precompressed">提供预压缩的内容</a></h2>

    <p>由于<code class="module"><a href="../mod/mod_brotli.html">mod_brotli</a></code>每次发出请求时<code class="module"><a href="../mod/mod_brotli.html">mod_brotli</a></code>重新压缩内容，因此可以通过预压缩内容并告诉mod_brotli无需重新压缩内容就可以提供一些性能优势。可以使用类似以下的配置来完成此操作：</p>

    <pre class="prettyprint lang-config">&lt;IfModule mod_headers.c&gt;
    # Serve brotli compressed CSS files if they exist
    # and the client accepts brotli.
    RewriteCond "%{HTTP:Accept-encoding}" "br"
    RewriteCond "%{REQUEST_FILENAME}\.br" "-s"
    RewriteRule "^(.*)\.css"              "$1\.css\.br" [QSA]

    # Serve brotli compressed JS files if they exist
    # and the client accepts brotli.
    RewriteCond "%{HTTP:Accept-encoding}" "br"
    RewriteCond "%{REQUEST_FILENAME}\.br" "-s"
    RewriteRule "^(.*)\.js"               "$1\.js\.br" [QSA]


    # Serve correct content types, and prevent double compression.
    RewriteRule "\.css\.br$" "-" [T=text/css,E=no-brotli:1]
    RewriteRule "\.js\.br$"  "-" [T=text/javascript,E=no-brotli:1]


    &lt;FilesMatch "(\.js\.br|\.css\.br)$"&gt;
      # Serve correct encoding type.
      Header append Content-Encoding br

      # Force proxies to cache brotli &amp;
      # non-brotli css/js files separately.
      Header append Vary Accept-Encoding
    &lt;/FilesMatch&gt;
&lt;/IfModule&gt;</pre>


</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="BrotliAlterETag" id="BrotliAlterETag">BrotliAlterETag</a> <a name="brotlialteretag" id="brotlialteretag">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>压缩期间如何修改传出的ETag标头</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>BrotliAlterETag AddSuffix | NoChange |删除</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>BrotliAlterETag添加后缀</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_brotli</td></tr>
</table>
    <p><code class="directive">BrotliAlterETag</code>指令指定在压缩响应时应如何更改ETag hader。</p>
    <dl>
    <dt>添加后缀</dt>
    <dd><p>将压缩方法附加到ETag的末尾，使压缩和未压缩的表示形式具有唯一的ETag。在另一个动态压缩模块mod_deflate中，这是自2.4.0开始的默认设置。该设置防止将“ HTTP未修改”（304）响应提供给对压缩内容的条件请求。</p></dd>
    <dt>没变</dt>
    <dd><p>不要在压缩响应上更改ETag。在另一个动态压缩模块mod_deflate中，这是2.4.0之前的默认设置。此设置不满足HTTP / 1.1属性，即同一资源的所有表示形式都具有唯一的ETag。</p></dd>
    <dt>去掉</dt>
    <dd><p>从压缩响应中删除ETag标头。这样可以避免某些条件请求，但可以避免上述选项的缺点。</p></dd>
    </dl>

</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="BrotliCompressionMaxInputBlock" id="BrotliCompressionMaxInputBlock">BrotliCompressionMaxInputBlock</a> <a name="brotlicompressionmaxinputblock" id="brotlicompressionmaxinputblock">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>最大输入块大小</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>BrotliCompressionMaxInputBlock <var>值</var></code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>（自动）</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_brotli</td></tr>
</table>
    <p><code class="directive">BrotliCompressionMaxInputBlock</code>指令指定最大输入块大小在16到24之间，但需要注意的是，较大的块大小需要更多的内存。</p>

</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="BrotliCompressionQuality" id="BrotliCompressionQuality">BrotliCompressionQuality</a> <a name="brotlicompressionquality" id="brotlicompressionquality">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>压缩质量</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>BrotliCompressionQuality <var>值</var></code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>BrotliCompressionQuality 5</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_brotli</td></tr>
</table>
    <p><code class="directive">BrotliCompressionQuality</code>伪指令指定压缩质量（0到11之间的值）。质量值越高，压缩效果越好，但压缩速度也较慢。
  </p>

</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="BrotliCompressionWindow" id="BrotliCompressionWindow">BrotliCompressionWindow</a> <a name="brotlicompressionwindow" id="brotlicompressionwindow">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>Brotli滑动压缩窗口大小</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>BrotliCompressionWindow <var>值</var></code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>BrotliCompressionWindow 18</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_brotli</td></tr>
</table>
    <p><code class="directive">BrotliCompressionWindow</code>指令指定brotli滑动压缩窗口的大小（介于10到24之间的值）。较大的窗口大小可以提高压缩质量，但需要更多的内存。</p>

</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="BrotliFilterNote" id="BrotliFilterNote">BrotliFilterNote</a> <a name="brotlifilternote" id="brotlifilternote">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>将压缩率放在记录中的注释中</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>BrotliFilterNote [ <var>类型</var> ] <var>音名</var></code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_brotli</td></tr>
</table>
    <p><code class="directive">BrotliFilterNote</code>指令指定有关压缩率的注释应附加到请求中。注释的名称是为指令指定的值。通过将值添加到<a href="../logs.html#accesslog">访问日志中</a> ，可以将该注释用于统计目的。</p>

    <div class="example"><h3>例</h3><pre class="prettyprint lang-config">BrotliFilterNote ratio

LogFormat '"%r" %b (%{ratio}n) "%{User-agent}i"' brotli
CustomLog "logs/brotli_log" brotli</pre>
</div>

    <p>如果要从日志中提取更准确的值，则可以使用<var>type</var>参数指定作为日志记录留下的数据类型。 <var>类型</var>可以是以下之一：</p>

    <dl>
      <dt><code>输入项</code></dt>
      <dd>将过滤器输入流的字节数存储在注释中。</dd>

      <dt><code>输出量</code></dt>
      <dd>将过滤器输出流的字节数存储在注释中。</dd>

      <dt><code>比</code></dt>
      <dd>将压缩比（ <code>output/input * 100</code> ）存储在注释中。如果省略<var>type</var>参数，则这是默认设置。</dd>
    </dl>

    <p>因此，您可以这样记录它：</p>

    <div class="example"><h3>准确记录</h3><pre class="prettyprint lang-config">BrotliFilterNote Input instream
BrotliFilterNote Output outstream
BrotliFilterNote Ratio ratio

LogFormat '"%r" %{outstream}n/%{instream}n (%{ratio}n%%)' brotli
CustomLog "logs/brotli_log" brotli</pre>
</div>

<h3>也可以看看</h3>
<ul>
<li><code class="module"><a href="../mod/mod_log_config.html">mod_log_config</a></code></li>
</ul>
</div>
</div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>
</body></html>