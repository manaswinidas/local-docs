<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>mod_cgi-Apache HTTP服务器版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body >
<div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="&lt;-" alt="&lt;-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP服务器</a> &gt; <a href="http://httpd.apache.org/docs/">文档</a> &gt; <a href="../index.html">版本2.4</a> &gt; <a href="./index.html">模块</a></div>
<div id="page-content">
<div id="preamble"><h1>Apache模块mod_cgi</h1>

<table class="module"><tr><th><a href="module-dict.html#Description">描述：</a></th><td>CGI脚本的执行</td></tr>
<tr><th><a href="module-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="module-dict.html#ModuleIdentifier">模块�标识符：</a></th><td>cgi_module</td></tr>
<tr><th><a href="module-dict.html#SourceFile">源文件：</a></th><td>mod_cgi.c</td></tr></table>
<h3>摘要</h3>

    <p>任何具有处理程序<code>cgi-script</code>文件都将被视为CGI脚本，并由服务器运行，并将其输出返回给客户端。文件通过具有包含由<code class="directive"><a href="../mod/mod_mime.html#addhandler">AddHandler</a></code>指令定义的扩展名的名称或位于<code class="directive"><a href="../mod/mod_alias.html#scriptalias">ScriptAlias</a></code>目录中来获取此处理程序。</p>

    <p>有关将CGI脚本与Apache一起使用的介绍，请参见我们的《使用CGI进行<a href="../howto/cgi.html">动态内容》</a>教程。</p>

    <p>在unix下使用多线程MPM时，应使用模块<code class="module"><a href="../mod/mod_cgid.html">mod_cgid</a></code>代替该模块。在用户级别，这两个模块基本相同。</p>

    <p>为了向后兼容，还将为任何带有mime类型<code>application/x-httpd-cgi</code>文件激活cgi-script处理程序。不建议使用magic mime类型。</p>
</div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><h3>话题</h3>
<ul id="topics">
<li><img alt="" src="../images/down.gif"> <a href="#env">CGI环境变量</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#cgi-debug">CGI调试</a></li>
</ul><h3 class="directives">指令</h3>
<ul id="toc">
<li><img alt="" src="../images/down.gif"> <a href="#scriptlog">脚本日志</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#scriptlogbuffer">ScriptLogBuffer</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#scriptloglength">ScriptLogLength</a></li>
</ul>
<h3>错误修正清单</h3><ul class="seealso"><li><a href="https://www.apache.org/dist/httpd/CHANGES_2.4">httpd更新日志</a></li><li><a href="https://bz.apache.org/bugzilla/buglist.cgi?bug_status=__open__&amp;list_id=144532&amp;product=Apache httpd-2&amp;query_format=specific&amp;order=changeddate DESC%2Cpriority%2Cbug_severity&amp;component=mod_cgi">已知的问题</a></li><li><a href="https://bz.apache.org/bugzilla/enter_bug.cgi?product=Apache httpd-2&amp;component=mod_cgi">报告错误</a></li></ul><h3>也可以看看</h3>
<ul class="seealso">
<li><code class="directive"><a href="../mod/core.html#acceptpathinfo">AcceptPathInfo</a></code></li>
<li><code class="directive"><a href="../mod/core.html#options">Options</a></code> ExecCGI</li>
<li><code class="directive"><a href="../mod/mod_alias.html#scriptalias">脚本别名</a></code></li>
<li><code class="directive"><a href="../mod/mod_mime.html#addhandler">AddHandler</a></code></li>
<li><a href="../suexec.html">在不同的用户ID下运行CGI程序</a></li>
<li><a href="http://www.ietf.org/rfc/rfc3875">CGI规范</a></li>
</ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="env" id="env">CGI环境变量</a></h2>
    <p>服务器将按照<a href="http://www.ietf.org/rfc/rfc3875">CGI规范</a>中的<a href="http://www.ietf.org/rfc/rfc3875">说明</a>设置CGI环境变量，并具有以下规定：</p>

    <dl>
      <dt>PATH_INFO</dt>

      <dd>如果<code class="directive"><a href="../mod/core.html#acceptpathinfo">AcceptPathInfo</a></code>指令显式设置为<code>off</code>则此选项将不可用。如果未给出<code class="directive">AcceptPathInfo</code> ，则默认行为是<code class="module"><a href="../mod/mod_cgi.html">mod_cgi</a></code>将接受路径信息（在URI中的脚本文件名后跟踪<code>/more/path/info</code> ），而核心服务器将为带有附加路径的请求返回404 NOT FOUND错误信息。省略<code class="directive">AcceptPathInfo</code>指令与为<code class="module"><a href="../mod/mod_cgi.html">mod_cgi</a></code>请求将其设置为<code>On</code>具有相同的效果。</dd>

      <dt>远程主机</dt>

      <dd>仅当<code class="directive"><a href="../mod/core.html#hostnamelookups">HostnameLookups</a></code>设置为<code>on</code> （默认情况下为off）并且访问主机地址的反向DNS查找确实找到了主机名时，才设置此属性。</dd>

      <dt>REMOTE_IDENT</dt>

      <dd>仅当<code class="directive"><a href="../mod/mod_ident.html#identitycheck">IdentityCheck</a></code>设置为<code>on</code>并且访问主机支持ident协议时才设置。请注意，由于可以轻易地伪造该变量的内容，因此不能依赖该变量的内容，并且如果客户端和服务器之间存在代理，则通常完全没有用。</dd>

      <dt>REMOTE_USER</dt>

      <dd>仅当CGI脚本需要验证时才设置。</dd>

    </dl>
    <p>该模块还利用核心功能<a href="https://ci.apache.org/projects/httpd/trunk/doxygen/group__APACHE__CORE__SCRIPT.html#ga0e81f9571a8a73f5da0e89e1f46d34b1">ap_add_common_vars</a>和<a href="https://ci.apache.org/projects/httpd/trunk/doxygen/group__APACHE__CORE__SCRIPT.html#ga6b975cd7ff27a338cb8752381a4cc14f">ap_add_cgi_vars</a>添加环境变量，例如：</p> 
       <dl>
           <dt>DOCUMENT_ROOT</dt>

           <dd>设置相关<code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code>指令的内容。</dd>

           <dt>服务器名称</dt>

           <dd>与请求相关的标准域名。</dd>

           <dt>SERVER_ADDR</dt>

           <dd>服务请求的虚拟主机的IP地址。</dd>

           <dt>SERVER_ADMIN</dt>

           <dd>设置相关<code class="directive"><a href="../mod/core.html#serveradmin">ServerAdmin</a></code>指令的内容。</dd>
      </dl>
    <p>对于详尽的列表，建议编写一个基本的CGI脚本，该脚本以方便的格式转储Apache传递的所有环境变量。
    </p>   
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="cgi-debug" id="cgi-debug">CGI调试</a></h2>
    <p>传统上，调试CGI脚本非常困难，这主要是因为无法研究无法正常运行的脚本的输出（标准输出和错误）。这些指令可在错误发生时提供更详细的日志记录。</p>

    <h3>CGI日志文件格式</h3>
      <p>配置后，CGI错误日志会记录任何无法正常执行的CGI。每个无法运行的CGI脚本都会记录多行信息。前两行始终采用以下格式：</p>

      <div class="example"><p><code>%% [ <var>time</var> ] <var>请求热线</var><br>%% <var>HTTP状态</var> <var>CGI脚本文件名</var>
      </code></p></div>

      <p>如果错误是无法运行CGI脚本，则日志文件将另外包含两行：</p>

      <div class="example"><p><code>％％错误<br>
        <var>错误信息</var>
      </code></p></div>

      <p>或者，如果错误是脚本返回不正确的标头信息（通常是由于脚本中的错误所致）的结果，则会记录以下信息：</p>

      <div class="example"><p><code>％请求<br>
        <var>收到所有HTTP请求标头</var><br>
        <var>POST或PUT实体（如果有）</var><br>％响应<br>
        <var>CGI脚本输出的所有标头</var><br>％stdout<br>
        <var>CGI标准输出</var><br>％stderr<br>
        <var>CGI标准错误</var><br>
      </code></p></div>

      <p>（如果脚本在标准输出或标准错误上未输出任何内容，则可能缺少％stdout和％stderr部分）。</p>
    
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="ScriptLog" id="ScriptLog">ScriptLog</a> <a name="scriptlog" id="scriptlog">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>CGI脚本错误日志文件的位置</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>ScriptLog <var>文件路径</var></code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td><code class="module"><a href="../mod/mod_cgi.html">mod_cgi</a></code> ， <code class="module"><a href="../mod/mod_cgid.html">mod_cgid</a></code></td></tr>
</table>
    <p><code class="directive">ScriptLog</code>指令设置CGI脚本错误日志文件。如果未提供<code class="directive">ScriptLog</code> ，则不会创建错误日志。如果给出，则任何CGI错误都将记录到作为参数给出的文件名中。如果这是相对文件或路径，则相对于<code class="directive"><a href="../mod/core.html#serverroot">ServerRoot</a></code>采取。
    </p>

    <div class="example"><h3>例</h3><pre class="prettyprint lang-config">ScriptLog logs/cgi_log</pre>
</div>

    <p>该日志将以运行子进程的用户身份打开， <em>即</em>在主<code class="directive"><a href="../mod/mod_unixd.html#user">User</a></code>指令中指定的<code class="directive"><a href="../mod/mod_unixd.html#user">User</a></code> 。这意味着脚本日志所在的目录需要该用户可写，或者文件需要手动创建并设置为该用户可写。如果将脚本日志放置在主日志目录中，请<strong>不要</strong>更改目录权限，以使运行子进程的用户可写该脚本日志。</p>

    <p>请注意，脚本日志记录是编写CGI脚本时的调试功能，而不是在运行的服务器上连续激活。它不是针对速度或效率进行优化的，如果以非设计方式使用，可能会带来安全问题。</p>

</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="ScriptLogBuffer" id="ScriptLogBuffer">ScriptLogBuffer</a> <a name="scriptlogbuffer" id="scriptlogbuffer">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>将在脚本日志中记录的最大PUT或POST请求数量</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>ScriptLogBuffer <var>字节</var></code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>ScriptLogBuffer 1024</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td><code class="module"><a href="../mod/mod_cgi.html">mod_cgi</a></code> ， <code class="module"><a href="../mod/mod_cgid.html">mod_cgid</a></code></td></tr>
</table>
    <p>记录到文件中的任何PUT或POST实体主体的大小都受到限制，以防止如果接收到较大的主体，则日志文件会过快增大。默认情况下，最多记录1024个字节，但是可以使用此伪指令进行更改。</p>

</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="ScriptLogLength" id="ScriptLogLength">ScriptLogLength</a> <a name="scriptloglength" id="scriptloglength">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>CGI脚本日志文件的大小限制</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>ScriptLogLength <var>字节</var></code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>脚本日志长度10385760</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td><code class="module"><a href="../mod/mod_cgi.html">mod_cgi</a></code> ， <code class="module"><a href="../mod/mod_cgid.html">mod_cgid</a></code></td></tr>
</table>
    <p><code class="directive">ScriptLogLength</code>可用于限制CGI脚本日志文件的大小。由于该日志文件记录了每个CGI错误的大量信息（所有请求标头，所有脚本输出），因此它可以成长为一个大文件。为了防止无限增长引起的问题，可以使用此伪指令为CGI日志文件设置最大文件大小。如果文件超过此大小，将不会再写入任何信息。</p>

</div>
</div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>
</body></html>