<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>mod_negotiation-Apache HTTP服务器版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body >
<div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="&lt;-" alt="&lt;-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP服务器</a> &gt; <a href="http://httpd.apache.org/docs/">文档</a> &gt; <a href="../index.html">版本2.4</a> &gt; <a href="./index.html">模块</a></div>
<div id="page-content">
<div id="preamble"><h1>Apache模块mod_negotiation</h1>

<table class="module"><tr><th><a href="module-dict.html#Description">描述：</a></th><td>提供<a href="../content-negotiation.html">内容协商</a></td></tr>
<tr><th><a href="module-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="module-dict.html#ModuleIdentifier">模块�标识符：</a></th><td>谈判模块</td></tr>
<tr><th><a href="module-dict.html#SourceFile">源文件：</a></th><td>mod_negotiation.c</td></tr></table>
<h3>摘要</h3>

    <p>内容协商，或更准确地说是内容选择，是从多个可用文档之一中选择与客户端功能最匹配的文档。有两种实现。</p>

    <ul>
      <li>类型图（带有处理程序<code>type-map</code>的文件）明确列出包含变体的文件。</li>

      <li>多视图搜索（由“ <code>Multiviews</code> <code class="directive"><a href="../mod/core.html#options">Options</a></code>启用），在该搜索中服务器执行隐式文件名模式匹配，然后从结果中进行选择。</li>
    </ul>
</div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><h3>话题</h3>
<ul id="topics">
<li><img alt="" src="../images/down.gif"> <a href="#typemaps">类型图</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#multiviews">多视图</a></li>
</ul><h3 class="directives">指令</h3>
<ul id="toc">
<li><img alt="" src="../images/down.gif"> <a href="#cachenegotiateddocs">CacheNegotiatedDocs</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#forcelanguagepriority">强制语言优先</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#languagepriority">语言优先</a></li>
</ul>
<h3>错误修正清单</h3><ul class="seealso"><li><a href="https://www.apache.org/dist/httpd/CHANGES_2.4">httpd更新日志</a></li><li><a href="https://bz.apache.org/bugzilla/buglist.cgi?bug_status=__open__&amp;list_id=144532&amp;product=Apache httpd-2&amp;query_format=specific&amp;order=changeddate DESC%2Cpriority%2Cbug_severity&amp;component=mod_negotiation">已知的问题</a></li><li><a href="https://bz.apache.org/bugzilla/enter_bug.cgi?product=Apache httpd-2&amp;component=mod_negotiation">报告错误</a></li></ul><h3>也可以看看</h3>
<ul class="seealso">
<li><code class="directive"><a href="../mod/core.html#options">选件</a></code></li>
<li><code class="module"><a href="../mod/mod_mime.html">mod_mime</a></code></li>
<li><a href="../content-negotiation.html">内容协商</a></li>
<li><a href="../env.html">环境变量</a></li>
</ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="typemaps" id="typemaps">类型图</a></h2>
    <p>类型映射的格式类似于RFC822邮件头。它包含用空行分隔的文档描述，其中以井号（'＃'）开头的行被视为注释。文档描述由几个标题记录组成；如果连续行以空格开头，则记录可以在多行上继续。前导空格将被删除，行将被连接。标头记录由关键字名组成，关键字名总是以冒号结尾，后跟一个值。标头名称和值之间以及值的标记之间允许使用空格。允许的标题为：</p>

    <dl>
      <dt><code>内容编码：</code></dt>
      <dd>文件的编码。Apache仅识别由<code class="directive"><a href="../mod/mod_mime.html#addencoding">AddEncoding</a></code>指令定义的编码。通常包括用于压缩文件的<code>x-compress</code>和用于<code>x-gzip</code>文件的<code>x-gzip</code> 。对于编码比较，将忽略<code>x-</code>前缀。</dd>

      <dt><code>内容语言：</code></dt>
      <dd>变体的一种或多种语言，作为Internet标准语言标签（ <a href="http://www.ietf.org/rfc/rfc1766.txt">RFC 1766</a> ）。<code>en</code>就是一个例子，意思是英语。如果变体包含多种语言，则它们之间用逗号分隔。</dd>

      <dt><code>内容长度：</code></dt>
      <dd>文件的长度，以字节为单位。如果此标头不存在，则使用文件的实际长度。</dd>

      <dt><code>内容类型：</code></dt>

      <dd>文档的<a class="glossarylink" href="../glossary.html#mime-type" title="见词汇">MIME媒体类型</a> ，带有可选参数。参数与媒体类型分隔，并以分号分隔，语法为<code>name=value</code> 。常用参数包括：<dl>
          <dt><code>水平</code></dt>
          <dd>一个整数，指定媒体类型的版本。对于<code>text/html</code>默认值为2，否则为0。</dd>

          <dt><code>s</code></dt>
          <dd>一个浮点数，其值在0 [.000]到1 [.000]的范围内，指示此变体与其他可用变体相比的相对“质量”，而与客户端的功能无关。例如，如果jpeg文件试图代表照片，则其源质量通常高于ASCII文件。但是，如果要表示的资源是ascii art，则ascii文件将比jpeg文件具有更高的源质量。因此，所有<code>qs</code>值都特定于给定资源。</dd>
        </dl>

        <div class="example"><h3>例</h3><p><code>内容类型：图片/ jpeg； qs = 0.8</code></p></div>
      </dd>

      <dt><code>URI：</code></dt>
      <dd>包含变体（给定媒体类型，以给定内容编码进行编码）的文件的uri。这些被解释为相对于地图文件的URL。它们必须位于同一服务器上，并且必须引用如果直接请求客户端将被授予访问权限的文件。</dd>

      <dt><code>身体：</code></dt>
      <dd>资源的实际内容可以使用Body标头包含在类型映射文件中。此标头必须包含一个字符串，该字符串指定正文内容的分隔符。然后，在找到分隔符字符串之前，类型映射文件中的所有后续行都将被视为资源主体的一部分。

      <div class="example"><h3>例：</h3><p><code>身体：-xyz ----<br>&lt;html&gt;<br>&lt;身体&gt;<br>&lt;p&gt;页面内容。&lt;/ p&gt;<br>&lt;/ body&gt;<br>&lt;/ html&gt;<br>---- xyz ----</code></p></div>
      </dd>
    </dl>

    <p>例如，考虑一个名为<code>document.html</code>的资源，该资源以英语，法语和德语提供。这些文件的文件分别称为<code>document.html.en</code> ， <code>document.html.fr</code>和<code>document.html.de</code> 。类型映射文件将称为<code>document.html.var</code> ，并将包含以下内容：</p>

    <div class="example"><p><code>URI：document.html<br>
    <br>内容语言：zh<br>内容类型：text / html<br>URI：document.html.en<br>
    <br>内容语言：fr<br>内容类型：text / html<br>URI：document.html.fr<br>
    <br>内容语言：de<br>内容类型：text / html<br>URI：document.html.de<br>
    <br>

    </code></p></div>

    <p>所有这四个文件应放在同一目录中，并且<code>.var</code>文件应通过<code class="directive"><a href="../mod/mod_mime.html#addhandler">AddHandler</a></code>指令与<code>type-map</code>处理程序关联：</p>

    <pre class="prettyprint lang-config">AddHandler type-map .var</pre>


    <p>在此目录中对<code>document.html.var</code>的请求将导致选择与用户的<code>Accept-Language</code>请求标头中指定的语言首选项最匹配的变体。</p>

    <p>如果启用了<code>Multiviews</code> ，并且<code class="directive"><a href="../mod/mod_mime.html#multiviewsmatch">MultiviewsMatch</a></code>设置为“ handlers”或“ any”，则对<code>document.html</code>的请求将发现<code>document.html.var</code>并继续与显式类型映射进行协商。</p>

    <p>其他配置指令（例如<code class="directive"><a href="../mod/mod_alias.html#alias">Alias</a></code>可用于将<code>document.html</code>映射到<code>document.html.var</code> 。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="multiviews" id="multiviews">多视图</a></h2>
    <p>“多<code>Multiviews</code> <code class="directive"><a href="../mod/core.html#options">Options</a></code>可启用“ <code>Multiviews</code>视图”搜索。如果服务器收到请求<code>/some/dir/foo</code>和<code>/some/dir/foo</code> <em>不</em>存在，则服务器会寻找一个名为所有文件的目录<code>foo.*</code> ，并有效假货一个类型的地图，名称那些文件，为其分配相同的媒体类型和内容编码（如果客户端按名称要求提供其中一种）。然后，它选择最符合客户要求的匹配项，并返回该文档。</p>

    <p><code class="directive"><a href="../mod/mod_mime.html#multiviewsmatch">MultiviewsMatch</a></code>指令配置Apache在选择文件时是否考虑未分配内容协商元信息的文件。</p>
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="CacheNegotiatedDocs" id="CacheNegotiatedDocs">CacheNegotiatedDocs</a> <a name="cachenegotiateddocs" id="cachenegotiateddocs">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>允许内容协商文档由代理服务器缓存</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>CacheNegotiatedDocs开|关</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>CacheNegotiatedDocs关闭</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_negotiation</td></tr>
</table>
    <p>如果设置，则此指令允许代理服务器缓存内容协商的文档。这可能意味着这些代理后面的客户可以检索与其功能不匹配的文档的版本，但这将使缓存更加有效。</p>

    <p>该指令仅适用于来自HTTP / 1.0浏览器的请求。HTTP / 1.1对协商的文档的缓存提供了更好的控制，该指令对HTTP / 1.1请求的响应无效。</p>


</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="ForceLanguagePriority" id="ForceLanguagePriority">ForceLanguagePriority</a> <a name="forcelanguagepriority" id="forcelanguagepriority">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>如果找不到单个可接受的文档，应采取的措施</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>ForceLanguagePriority None | Prefer | Fallback [Prefer | Fallback]</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>强制语言优先</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机，目录，.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>文件信息</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_negotiation</td></tr>
</table>
    <p><code class="directive">ForceLanguagePriority</code>指令使用给定的<code class="directive"><a href="#languagepriority">LanguagePriority</a></code>来满足协商，否则服务器将无法返回单个匹配的文档。</p>

    <p><code>ForceLanguagePriority Prefer</code>使用<code>LanguagePriority</code>来提供一个有效结果，而不是在存在多个同等有效选择时不返回HTTP结果300（MULTIPLE CHOICES）。如果给出了以下指令，并且用户的<code>Accept-Language</code>标头将<code>en</code>和<code>de</code>分别指定为质量<code>.500</code> （同样可以接受），则将提供第一个匹配的变体<code>en</code> 。</p>

    <pre class="prettyprint lang-config">LanguagePriority en fr de
ForceLanguagePriority Prefer</pre>


    <p><code>ForceLanguagePriority Fallback</code>使用<code class="directive"><a href="#languagepriority">LanguagePriority</a></code>来提供有效结果，而不是返回HTTP结果406（无法接受）。如果给出了以下指令，并且用户的<code>Accept-Language</code>仅允许<code>es</code>语言响应，但找不到这样的变体，则将提供下面<code class="directive"><a href="#languagepriority">LanguagePriority</a></code>列表中的第一个变体。</p>

    <pre class="prettyprint lang-config">LanguagePriority en fr de
ForceLanguagePriority Fallback</pre>


    <p>可以同时指定<code>Prefer</code>和<code>Fallback</code>这两个选项，因此，如果可以接受多个以上的变体，则可以使用<code class="directive"><a href="#languagepriority">LanguagePriority</a></code>的第一个匹配变体，如果没有一个变体与客户可接受的语言列表相匹配，则可以使用第一个可用的文档。</p>

<h3>也可以看看</h3>
<ul>
<li><code class="directive"><a href="../mod/mod_mime.html#addlanguage">添加语言</a></code></li>
</ul>
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="LanguagePriority" id="LanguagePriority">语言</a> <a name="languagepriority" id="languagepriority">优先权指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>客户不表达偏好的情况下语言变体的优先顺序</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>LanguagePriority <var>MIME-lang</var> [ <var>MIME-lang</var> ] ...</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机，目录，.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>文件信息</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_negotiation</td></tr>
</table>
    <p>在处理Multiviews请求时，如果客户端不表达偏好，则<code class="directive">LanguagePriority</code>设置语言变体的优先级。 <var>MIME-lang</var>的列表按优先级递减的顺序排列。</p>

    <pre class="prettyprint lang-config">LanguagePriority en fr de</pre>


    <p>对于<code>foo.html</code>的请求，其中<code>foo.html.fr</code>和<code>foo.html.de</code>都存在，但是浏览器未表达语言偏好，则将返回<code>foo.html.fr</code></p>

    <p>请注意，仅当无法通过任何其他方式确定“最佳”语言或<code class="directive"><a href="#forcelanguagepriority">ForceLanguagePriority</a></code>指令不是<code>None</code> ，此指令才有效。通常，客户端确定语言首选项，而不是服务器。</p>

<h3>也可以看看</h3>
<ul>
<li><code class="directive"><a href="../mod/mod_mime.html#addlanguage">添加语言</a></code></li>
</ul>
</div>
</div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>
</body></html>