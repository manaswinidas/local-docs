<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>mod_macro-Apache HTTP服务器版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body >
<div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="&lt;-" alt="&lt;-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP服务器</a> &gt; <a href="http://httpd.apache.org/docs/">文档</a> &gt; <a href="../index.html">版本2.4</a> &gt; <a href="./index.html">模块</a></div>
<div id="page-content">
<div id="preamble"><h1>Apache模块mod_macro</h1>

<table class="module"><tr><th><a href="module-dict.html#Description">描述：</a></th><td>在apache httpd运行时配置文件中提供宏</td></tr>
<tr><th><a href="module-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="module-dict.html#ModuleIdentifier">模块�标识符：</a></th><td>macro_module</td></tr>
<tr><th><a href="module-dict.html#SourceFile">源文件：</a></th><td>mod_macro.c</td></tr></table>
<h3>摘要</h3>


    <p>在Apache httpd运行时配置文件中提供宏，以简化创建大量相似配置块的过程。服务器启动时，将使用提供的参数来扩展宏，并与其余配置文件一起处理结果。</p>

</div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><h3>话题</h3>
<ul id="topics">
<li><img alt="" src="../images/down.gif"> <a href="#usage">用法</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#tips">提示</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#examples">例子</a></li>
</ul><h3 class="directives">指令</h3>
<ul id="toc">
<li><img alt="" src="../images/down.gif"> <a href="#macro">&lt;微距&gt;</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#undefmacro">UndefMacro</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#use">使用</a></li>
</ul>
<h3>错误修正清单</h3><ul class="seealso"><li><a href="https://www.apache.org/dist/httpd/CHANGES_2.4">httpd更新日志</a></li><li><a href="https://bz.apache.org/bugzilla/buglist.cgi?bug_status=__open__&amp;list_id=144532&amp;product=Apache httpd-2&amp;query_format=specific&amp;order=changeddate DESC%2Cpriority%2Cbug_severity&amp;component=mod_macro">已知的问题</a></li><li><a href="https://bz.apache.org/bugzilla/enter_bug.cgi?product=Apache httpd-2&amp;component=mod_macro">报告错误</a></li></ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="usage" id="usage">用法</a></h2>

<p>宏是使用<code class="directive"><a href="#macro">&lt;Macro&gt;</a></code>块定义的，其中包含需要重复配置的部分，并为需要替换的部分提供了变量。</p>

<p>例如，您可以使用宏来定义<code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code>块，以便定义多个相似的虚拟主机：</p>

<pre class="prettyprint lang-config">&lt;Macro VHost $name $domain&gt;
&lt;VirtualHost *:80&gt;
    ServerName $domain
    ServerAlias www.$domain

    DocumentRoot "/var/www/vhosts/$name"
    ErrorLog "/var/log/httpd/$name.error_log"
    CustomLog "/var/log/httpd/$name.access_log" combined
&lt;/VirtualHost&gt;
&lt;/Macro&gt;</pre>


<p>宏名称不区分大小写，例如httpd配置指令。但是，变量名称区分大小写。</p>

<p>然后，您将多次调用此宏以创建虚拟主机：</p>

<pre class="prettyprint lang-config">Use VHost example example.com
Use VHost myhost hostname.org
Use VHost apache apache.org

UndefMacro VHost</pre>


<p>在服务器启动时，如<code class="directive"><a href="#macro">&lt;Macro&gt;</a></code>定义所述，这些<code class="directive"><a href="#use">Use</a></code>调用中的每一个都将扩展为完整的虚拟主机。</p>

<p>使用<code class="directive"><a href="#undefmacro">UndefMacro</a></code>指令，以便以后使用相同变量名的宏不会导致冲突的定义。</p>

<p>在下面的“示例”部分中可以看到此示例的更详细版本。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="tips" id="tips">提示</a></h2>

<p>参数名称应以诸如<code>$</code> ， <code>%</code>或<code>@</code>类的符号开头，以便可以清楚地识别它们，并且还可以帮助处理与其他指令（例如核心<code class="directive"><a href="../mod/core.html#define">Define</a></code>指令）的交互。否则，将导致警告。但是，建议您对整个服务器配置有充分的了解，以避免在不同的范围内重复使用相同的变量，否则可能会造成混淆。</p>

<p>带有<code>$</code>或<code>%</code>前缀的参数不会转义。带<code>@</code>参数前缀用引号引起来。</p>

<p>避免使用包含另一个参数作为前缀的参数（例如<code>$win</code>和<code>$winter</code> ），因为这可能在表达式求值时引起混乱。如果发生此类混淆，将使用最长的参数名称。</p>

<p>如果要在另一个字符串中使用值，则将参数括在大括号中很有用，以避免混淆：</p>

<pre class="prettyprint lang-config">&lt;Macro DocRoot ${docroot}&gt;
    DocumentRoot "/var/www/${docroot}/htdocs"
&lt;/Macro&gt;</pre>


</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="examples" id="examples">例子</a></h2>


<h3>虚拟主机定义</h3>


<p><code class="module"><a href="../mod/mod_macro.html">mod_macro</a></code>的常见用法是创建动态生成的虚拟主机。</p>

<pre class="prettyprint lang-config">## Define a VHost Macro for repetitive configurations

&lt;Macro VHost $host $port $dir&gt;
  Listen $port
  &lt;VirtualHost *:$port&gt;

    ServerName $host
    DocumentRoot "$dir"

    # Public document root
    &lt;Directory "$dir"&gt;
        Require all granted
    &lt;/Directory&gt;

    # limit access to intranet subdir.
    &lt;Directory "$dir/intranet"&gt;
      Require ip 10.0.0.0/8
    &lt;/Directory&gt;
  &lt;/VirtualHost&gt;
&lt;/Macro&gt;

## Use of VHost with different arguments.

Use VHost www.apache.org 80 /vhosts/apache/htdocs
Use VHost example.org 8080 /vhosts/example/htdocs
Use VHost www.example.fr 1234 /vhosts/example.fr/htdocs</pre>

 

<h3>删除宏定义</h3>


<p>建议您在使用宏后取消定义它。这样可以避免在复杂的配置文件中出现混淆，因为其中变量名称可能会发生冲突。</p>

<pre class="prettyprint lang-config">&lt;Macro DirGroup $dir $group&gt;
  &lt;Directory "$dir"&gt;
    Require group $group
  &lt;/Directory&gt;
&lt;/Macro&gt;

Use DirGroup /www/apache/private private
Use DirGroup /www/apache/server  admin

UndefMacro DirGroup</pre>


 

</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="Macro" id="Macro">&lt;宏&gt;</a> <a name="macro" id="macro">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>定义配置文件宏</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>&lt;宏<var>名称</var> [ <var>par1</var> .. <var>parN</var> ]&gt; ... &lt;/ Macro&gt;</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机，目录</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_macro</td></tr>
</table>
    <p><code class="directive">&lt;Macro&gt;</code>指令控制服务器运行时配置文件中宏的定义。第一个参数是宏的名称。其他参数是宏的参数。优良作法是在参数名称前添加' <code>$%@</code> '前缀，而不在宏名称前添加此类字符。
    </p>

    <pre class="prettyprint lang-config">&lt;Macro LocalAccessPolicy&gt;
    Require ip 10.2.16.0/24
&lt;/Macro&gt;

&lt;Macro RestrictedAccessPolicy $ipnumbers&gt;
    Require ip $ipnumbers
&lt;/Macro&gt;</pre>


</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="UndefMacro" id="UndefMacro">UndefMacro</a> <a name="undefmacro" id="undefmacro">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>取消定义宏</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>UndefMacro <var>名称</var></code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机，目录</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_macro</td></tr>
</table>
    <p><code class="directive">UndefMacro</code>指令<code class="directive">UndefMacro</code>定义了<code class="directive">UndefMacro</code>定义的宏。</p>

    <pre class="prettyprint lang-config">UndefMacro LocalAccessPolicy
UndefMacro RestrictedAccessPolicy</pre>


</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="Use" id="Use">使用</a> <a name="use" id="use">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>使用宏</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>使用<var>名称</var> [ <var>value1</var> ... <var>valueN</var> ]</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机，目录</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_macro</td></tr>
</table>
    <p><code class="directive">Use</code>指令控制宏的使用。指定的宏被展开。必须为其提供与宏定义中相同数量的参数。提供的值与它们相应的初始参数相关联，并在处理之前被替换。</p>

    <pre class="prettyprint lang-config">Use LocalAccessPolicy
...
Use RestrictedAccessPolicy "192.54.172.0/24 192.54.148.0/24"</pre>


    <p>使用上面定义的宏，等效于：</p>

    <pre class="prettyprint lang-config">Require ip 10.2.16.0/24
...
Require ip 192.54.172.0/24 192.54.148.0/24</pre>


</div>
</div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>
</body></html>