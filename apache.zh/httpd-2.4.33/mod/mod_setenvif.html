<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>mod_setenvif-Apache HTTP服务器版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body >
<div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="&lt;-" alt="&lt;-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP服务器</a> &gt; <a href="http://httpd.apache.org/docs/">文档</a> &gt; <a href="../index.html">版本2.4</a> &gt; <a href="./index.html">模块</a></div>
<div id="page-content">
<div id="preamble"><h1>Apache模块mod_setenvif</h1>

<table class="module"><tr><th><a href="module-dict.html#Description">描述：</a></th><td>允许根据请求的特征设置环境变量</td></tr>
<tr><th><a href="module-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="module-dict.html#ModuleIdentifier">模块�标识符：</a></th><td>setenvif_module</td></tr>
<tr><th><a href="module-dict.html#SourceFile">源文件：</a></th><td>mod_setenvif.c</td></tr></table>
<h3>摘要</h3>


    <p><code class="module"><a href="../mod/mod_setenvif.html">mod_setenvif</a></code>模块允许您根据请求的不同方面是否匹配您指定的正则表达式来设置内部环境变量。服务器的其他部分可以使用这些环境变量来决定要采取的措施，以及可以用于CGI脚本和SSI页面。</p>

    <p>指令按照它们在配置文件中出现的顺序进行考虑。因此，可以使用更复杂的序列，例如本示例，如果浏览器是mozilla而不是MSIE，则可以设置<code>netscape</code> 。</p>

<pre class="prettyprint lang-config">BrowserMatch ^Mozilla netscape
BrowserMatch MSIE !netscape</pre>


   <p>当服务器通过内部<a class="glossarylink" href="../glossary.html#subrequest" title="see glossary">子请求（</a>例如，查找<code class="directive"><a href="../mod/mod_dir.html#directoryindex">DirectoryIndex</a></code>或使用<code class="module"><a href="../mod/mod_autoindex.html">mod_autoindex</a></code>生成目录列表）查找路径时， <a class="glossarylink" href="../glossary.html#subrequest" title="见词汇">子</a>请求中<em>不会</em>继承每个请求的环境变量。此外，由于API阶段<code class="module"><a href="../mod/mod_setenvif.html">mod_setenvif</a></code>会采取行动，因此在子请求中未单独评估<code class="directive"><a href="#setenvif">SetEnvIf</a></code>指令。</p>

</div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><h3 class="directives">指令</h3>
<ul id="toc">
<li><img alt="" src="../images/down.gif"> <a href="#browsermatch">浏览器匹配</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#browsermatchnocase">BrowserMatchNoCase</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#setenvif">设置环境</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#setenvifexpr">SetEnvIfExpr</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#setenvifnocase">SetEnvIfNoCase</a></li>
</ul>
<h3>错误修正清单</h3><ul class="seealso"><li><a href="https://www.apache.org/dist/httpd/CHANGES_2.4">httpd更新日志</a></li><li><a href="https://bz.apache.org/bugzilla/buglist.cgi?bug_status=__open__&amp;list_id=144532&amp;product=Apache httpd-2&amp;query_format=specific&amp;order=changeddate DESC%2Cpriority%2Cbug_severity&amp;component=mod_setenvif">已知的问题</a></li><li><a href="https://bz.apache.org/bugzilla/enter_bug.cgi?product=Apache httpd-2&amp;component=mod_setenvif">报告错误</a></li></ul><h3>也可以看看</h3>
<ul class="seealso">
<li><a href="../env.html">Apache HTTP Server中的环境变量</a></li>
</ul></div>

<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="BrowserMatch" id="BrowserMatch">BrowserMatch</a> <a name="browsermatch" id="browsermatch">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>设置以HTTP User-Agent为条件的环境变量</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>BrowserMatch <em>正则表达式[！]环境变量</em> [= <em>值</em> ] [[！]<em>环境变量</em> [= <em>值</em> ]] ...</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机，目录，.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>文件信息</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_setenvif</td></tr>
</table>
  <p><code class="directive">BrowserMatch</code>是<code class="directive"><a href="#setenvif">SetEnvIf</a></code>指令的特殊情况，该指令将环境变量设置为以<code>User-Agent</code> HTTP请求标头为条件。以下两行具有相同的效果：</p>
<pre class="prettyprint lang-config">BrowserMatch Robot is_a_robot
SetEnvIf User-Agent Robot is_a_robot</pre>


    <p>一些其他示例：</p>
<pre class="prettyprint lang-config">BrowserMatch ^Mozilla forms jpeg=yes browser=netscape
BrowserMatch "^Mozilla/[2-3]" tables agif frames javascript
BrowserMatch MSIE !javascript</pre>


</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="BrowserMatchNoCase" id="BrowserMatchNoCase">BrowserMatchNoCase</a> <a name="browsermatchnocase" id="browsermatchnocase">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>设置环境变量以用户代理为条件，不考虑大小写</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>BrowserMatchNoCase <em>正则表达式[！]环境变量</em> [= <em>值</em> ] [[！]<em>环境变量</em> [= <em>值</em> ]] ...</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机，目录，.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>文件信息</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_setenvif</td></tr>
</table>

    <p><code class="directive">BrowserMatchNoCase</code>指令在语义上与<code class="directive"><a href="#browsermatch">BrowserMatch</a></code>指令相同。但是，它提供不区分大小写的匹配。例如：</p>
<pre class="prettyprint lang-config">BrowserMatchNoCase mac platform=macintosh
BrowserMatchNoCase win platform=windows</pre>


    <p><code class="directive">BrowserMatch</code>和<code class="directive">BrowserMatchNoCase</code>伪指令是<code class="directive"><a href="#setenvif">SetEnvIf</a></code>和<code class="directive"><a href="#setenvifnocase">SetEnvIfNoCase</a></code>伪指令的特殊情况。以下两行具有相同的效果：</p>
<pre class="prettyprint lang-config">BrowserMatchNoCase Robot is_a_robot
SetEnvIfNoCase User-Agent Robot is_a_robot</pre>


</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="SetEnvIf" id="SetEnvIf">SetEnvIf</a> <a name="setenvif" id="setenvif">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>根据请求的属性设置环境变量</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>SetEnvIf <em>属性正则表达式[！]环境变量</em> [= <em>值</em> ] [[！]<em>环境变量</em> [= <em>值</em> ]] ...</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机，目录，.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>文件信息</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_setenvif</td></tr>
</table>
    <p><code class="directive">SetEnvIf</code>指令根据请求的属性定义环境变量。在第一个参数中指定的<em>属性</em>可以是以下四种之一：</p>

<ol>
<li>HTTP请求标头字段（有关这些的更多信息，请参阅<a href="http://www.rfc-editor.org/rfc/rfc2616.txt">RFC2616</a> ）；例如： <code>Host</code> ， <code>User-Agent</code> ， <code>Referer</code>和<code>Accept-Language</code> 。正则表达式可用于指定一组请求标头。</li>

<li>请求的以下方面之一：<ul>
      <li><code>Remote_Host</code>发出请求的客户端的主机名（如果有）</li>

      <li><code>Remote_Addr</code>发出请求的客户端的IP地址</li>

      <li><code>Server_Addr</code>在其上接收到请求的服务器的IP地址（仅适用于2.0.43之后的版本）</li>

      <li><code>Request_Method</code>使用的方法的名称（ <code>GET</code> ， <code>POST</code> <em>等</em> ）</li>

      <li><code>Request_Protocol</code>发出请求的协议的名称和版本（ <em>例如</em> “ HTTP / 0.9”，“ HTTP / 1.1” <em>等</em> ）</li>

      <li><code>Request_URI</code> -HTTP请求行上请求的资源-通常是方案和主机部分之后的URL部分，没有查询字符串。有关如何匹配查询字符串的更多信息，请参见<code class="module"><a href="../mod/mod_rewrite.html">mod_rewrite</a></code>的<code class="directive"><a href="../mod/mod_rewrite.html#rewritecond">RewriteCond</a></code>指令。</li>
    </ul>
</li>

<li>与请求关联的环境变量列表中的环境变量的名称。这允许<code class="directive">SetEnvIf</code>指令针对先前匹配的结果进行测试。只有早期的<code>SetEnvIf[NoCase]</code>指令定义的那些环境变量才能以这种方式进行测试。“更早”是指它们是在更广泛的范围（例如服务器范围）内定义的，或者是在当前指令的范围内定义的。仅当请求特征之间不匹配并且该<em>属性</em>未使用正则表达式时，才考虑环境变量。</li>

</ol>

<p>第二个参数（ <em>regex</em> ）是一个<a class="glossarylink" href="../glossary.html#regex" title="见词汇">正则表达式</a> 。如果<em>正则表达式</em>与<em>attribute</em>相匹配，则将评估其余参数。</p>

<p>其余参数提供要设置的变量的名称，以及可以选择设置的值。这些采取的形式</p>

    <ol>
      <li><code><em>varname</em></code> ，或</li>

      <li><code>！<em>varname</em></code> ，或</li>

      <li><code><em>varname</em> = <em>值</em></code></li>
    </ol>

    <p>在第一种形式中，该值将设置为“ 1”。第二个将删除给定变量（如果已定义），第三个将将该变量设置为value给出的文字<code><em>value</em></code> 。从2.0.51版开始，Apache httpd将识别出现在<code>$1</code> .. <code>$9</code>之内的<var>值</var> ，并将其替换为<var>regex</var>的带括号的子<var>表达式</var> 。 <code>$0</code>提供对该模式匹配的整个字符串的访问。</p>

<pre class="prettyprint lang-config">SetEnvIf Request_URI "\.gif$" object_is_image=gif
SetEnvIf Request_URI "\.jpg$" object_is_image=jpg
SetEnvIf Request_URI "\.xbm$" object_is_image=xbm
    
SetEnvIf Referer www\.mydomain\.example\.com intra_site_referral
    
SetEnvIf object_is_image xbm XBIT_PROCESSING=1
    
SetEnvIf Request_URI "\.(.*)$" EXTENSION=$1

SetEnvIf ^TS  ^[a-z]  HAVE_TS</pre>


    <p>如果请求是针对图像文件的，则前三个将设置环境变量<code>object_is_image</code>如果引用页面位于<code>www.mydomain.example.com</code>网站上的某个位置，则前四个将设置<code>intra_site_referral</code> 。</p>

    <p>如果请求包含以“ TS”开头的任何标头，且其值以集合[az]中的任何字符开头，则最后一个示例将设置环境变量<code>HAVE_TS</code> 。</p>

<h3>也可以看看</h3>
<ul>
<li>有关其他示例，请<a href="../env.html">参见Apache HTTP Server中的环境变量</a> 。
</li>
</ul>
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="SetEnvIfExpr" id="SetEnvIfExpr">SetEnvIfExpr</a> <a name="setenvifexpr" id="setenvifexpr">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>根据ap_expr表达式设置环境变量</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>SetEnvIfExpr <em>expr [！]环境变量</em> [= <em>值</em> ] [[！]<em>环境变量</em> [= <em>值</em> ]] ...</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机，目录，.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>文件信息</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_setenvif</td></tr>
</table>
    <p><code class="directive">SetEnvIfExpr</code>指令基于<code class="directive"><a href="../mod/core.html#if">&lt;If&gt;</a></code> <code>ap_expr</code>定义环境变量。这些表达式将在运行时求值，并以与<code class="directive">SetEnvIf</code>相同的方式应用<em>env-variable</em> 。</p>

<pre class="prettyprint lang-config">SetEnvIfExpr "tolower(req('X-Sendfile')) == 'd:\images\very_big.iso')" iso_delivered</pre>


    <p>这将设置环境变量<code>iso_delivered</code>我们的每一次应用程序试图通过发送<code>X-Sendfile</code></p>

    <p>一个更有用的示例是，如果远程IP地址是根据RFC 1918的私有地址，则设置变量rfc1918：</p>

<pre class="prettyprint lang-config">SetEnvIfExpr "-R '10.0.0.0/8' || -R '172.16.0.0/12' || -R '192.168.0.0/16'" rfc1918</pre>


<h3>也可以看看</h3>
<ul>
<li><a href="../expr.html">Apache HTTP Server中的表达式</a> ，以获取完整参考和更多示例。</li>
<li><code class="directive"><a href="../mod/core.html#if">&lt;If&gt;</a></code>可用于获得相似的结果。</li>
<li><code class="module"><a href="../mod/mod_filter.html">mod_filter</a></code></li>
</ul>
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="SetEnvIfNoCase" id="SetEnvIfNoCase">SetEnvIfNoCase</a> <a name="setenvifnocase" id="setenvifnocase">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>根据请求的属性设置环境变量，而不考虑大小写</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>SetEnvIfNoCase <em>属性正则表达式[！]环境变量</em> [= <em>值</em> ] [[！]<em>环境变量</em> [= <em>值</em> ]] ...</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置，虚拟主机，目录，.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>文件信息</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>基础</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_setenvif</td></tr>
</table>

    <p><code class="directive">SetEnvIfNoCase</code>在语义上与<code class="directive"><a href="#setenvif">SetEnvIf</a></code>指令相同，不同之处仅在于以区分大小写的方式执行正则表达式匹配。例如：</p>
<pre class="prettyprint lang-config">SetEnvIfNoCase Host Example\.Org site=example</pre>


    <p>如果包含并包含了HTTP请求标头字段<code>Host:</code> ，则会将<code>site</code>环境变量设置为“ <code>example</code> ” <code>Example.Org</code> ， <code>example.org</code>或任何其他组合。</p>

</div>
</div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>
</body></html>