<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>mod_ext_filter-Apache HTTP服务器版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body >
<div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="&lt;-" alt="&lt;-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP服务器</a> &gt; <a href="http://httpd.apache.org/docs/">文档</a> &gt; <a href="../index.html">版本2.4</a> &gt; <a href="./index.html">模块</a></div>
<div id="page-content">
<div id="preamble"><h1>Apache模块mod_ext_filter</h1>

<table class="module"><tr><th><a href="module-dict.html#Description">描述：</a></th><td>在传递给客户端之前，将响应主体通过外部程序传递</td></tr>
<tr><th><a href="module-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="module-dict.html#ModuleIdentifier">模块�标识符：</a></th><td>ext_filter_module</td></tr>
<tr><th><a href="module-dict.html#SourceFile">源文件：</a></th><td>mod_ext_filter.c</td></tr></table>
<h3>摘要</h3>

    <p><code class="module"><a href="../mod/mod_ext_filter.html">mod_ext_filter</a></code>为<a href="../filter.html">过滤器</a>提供了一个简单而熟悉的编程模型。使用此模块，从stdin读取并写入stdout的程序（即Unix样式的filter命令）可以成为Apache的过滤器。这种过滤机制比使用专门为Apache API编写并在Apache服务器进程内部运行的过滤器要慢得多，但是它确实具有以下好处：</p>

    <ul>
      <li>编程模型要简单得多</li>

      <li>可以使用任何编程/脚本语言，只要它允许程序从标准输入读取并写入标准输出即可</li>

      <li>现有程序可以未经修改用作Apache过滤器</li>
    </ul>

    <p>即使性能特征不适合生产使用，也可以将<code class="module"><a href="../mod/mod_ext_filter.html">mod_ext_filter</a></code>用作过滤器的原型环境。</p>

</div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><h3>话题</h3>
<ul id="topics">
<li><img alt="" src="../images/down.gif"> <a href="#examples">例子</a></li>
</ul><h3 class="directives">指令</h3>
<ul id="toc">
<li><img alt="" src="../images/down.gif"> <a href="#extfilterdefine">ExtFilterDefine</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#extfilteroptions">ExtFilterOptions</a></li>
</ul>
<h3>错误修正清单</h3><ul class="seealso"><li><a href="https://www.apache.org/dist/httpd/CHANGES_2.4">httpd更新日志</a></li><li><a href="https://bz.apache.org/bugzilla/buglist.cgi?bug_status=__open__&amp;list_id=144532&amp;product=Apache httpd-2&amp;query_format=specific&amp;order=changeddate DESC%2Cpriority%2Cbug_severity&amp;component=mod_ext_filter">已知的问题</a></li><li><a href="https://bz.apache.org/bugzilla/enter_bug.cgi?product=Apache httpd-2&amp;component=mod_ext_filter">报告错误</a></li></ul><h3>也可以看看</h3>
<ul class="seealso">
<li><a href="../filter.html">筛选器</a></li>
</ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="examples" id="examples">例子</a></h2>

    <h3>从其他类型的响应生成HTML</h3>
      <pre class="prettyprint lang-config"># mod_ext_filter directive to define a filter
# to HTML-ize text/c files using the external
# program /usr/bin/enscript, with the type of
# the result set to text/html
ExtFilterDefine c-to-html mode=output \
    intype=text/c outtype=text/html \
    cmd="/usr/bin/enscript --color -w html -Ec -o -"

&lt;Directory "/export/home/trawick/apacheinst/htdocs/c"&gt;
    # core directive to cause the new filter to
    # be run on output
    SetOutputFilter c-to-html
    
    # mod_mime directive to set the type of .c
    # files to text/c
    AddType text/c .c
&lt;/Directory&gt;</pre>

    

    <h3>实施内容编码过滤器</h3>
      <p>注意：此gzip示例仅用于说明目的。请参考<code class="module"><a href="../mod/mod_deflate.html">mod_deflate</a></code>的实际实现。</p>

      <pre class="prettyprint lang-config"># mod_ext_filter directive to define the external filter
ExtFilterDefine gzip mode=output cmd=/bin/gzip

&lt;Location "/gzipped"&gt;
    
    # core directive to cause the gzip filter to be
    # run on output
    SetOutputFilter gzip
    
    # mod_headers directive to add
    # "Content-Encoding: gzip" header field
    Header set Content-Encoding gzip
&lt;/Location&gt;</pre>

    

    <h3>降低服务器速度</h3>
      <pre class="prettyprint lang-config"># mod_ext_filter directive to define a filter
# which runs everything through cat; cat doesn't
# modify anything; it just introduces extra pathlength
# and consumes more resources
ExtFilterDefine slowdown mode=output cmd=/bin/cat \
    preservescontentlength

&lt;Location "/"&gt;
    # core directive to cause the slowdown filter to
    # be run several times on output
    #
    SetOutputFilter slowdown;slowdown;slowdown
&lt;/Location&gt;</pre>

    

    <h3>使用sed替换响应中的文本</h3>
      <pre class="prettyprint lang-config"># mod_ext_filter directive to define a filter which
# replaces text in the response
#
ExtFilterDefine fixtext mode=output intype=text/html \
    cmd="/bin/sed s/verdana/arial/g"

&lt;Location "/"&gt;
    # core directive to cause the fixtext filter to
    # be run on output
    SetOutputFilter fixtext
&lt;/Location&gt;</pre>


<div class="note">
<p>您可以使用<code class="module"><a href="../mod/mod_substitute.html">mod_substitute</a></code>执行相同的操作，而无需调用外部进程。</p>
</div>
    

    <h3>跟踪另一个过滤器</h3>
      <pre class="prettyprint lang-config"># Trace the data read and written by mod_deflate
# for a particular client (IP 192.168.1.31)
# experiencing compression problems.
# This filter will trace what goes into mod_deflate.
ExtFilterDefine tracebefore \
    cmd="/bin/tracefilter.pl /tmp/tracebefore" \
    EnableEnv=trace_this_client

# This filter will trace what goes after mod_deflate.
# Note that without the ftype parameter, the default
# filter type of AP_FTYPE_RESOURCE would cause the
# filter to be placed *before* mod_deflate in the filter
# chain.  Giving it a numeric value slightly higher than
# AP_FTYPE_CONTENT_SET will ensure that it is placed
# after mod_deflate.
ExtFilterDefine traceafter \
    cmd="/bin/tracefilter.pl /tmp/traceafter" \
    EnableEnv=trace_this_client ftype=21

&lt;Directory "/usr/local/docs"&gt;
    SetEnvIf Remote_Addr 192.168.1.31 trace_this_client
    SetOutputFilter tracebefore;deflate;traceafter
&lt;/Directory&gt;</pre>


      <div class="example"><h3>这是跟踪数据的过滤器：</h3><pre class="prettyprint lang-perl">#!/usr/local/bin/perl -w
use strict;

open(SAVE, "&gt;$ARGV[0]")
    or die "can't open $ARGV[0]: $?";

while (&lt;STDIN&gt;) {
    print SAVE $_;
    print $_;
}

close(SAVE);</pre>
</div>
    
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="ExtFilterDefine" id="ExtFilterDefine">ExtFilter定义</a> <a name="extfilterdefine" id="extfilterdefine">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>定义一个外部过滤器</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>ExtFilter定义<var>filtername</var> <var>参数</var></code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_ext_filter</td></tr>
</table>
    <p><code class="directive">ExtFilterDefine</code>指令定义了外部过滤器的特征，包括要运行的程序及其参数。</p>

    <p><var>filtername</var>指定要定义的过滤器的名称。然后可以在<code class="directive"><a href="../mod/core.html#setoutputfilter">SetOutputFilter</a></code>指令中使用此名称。在所有已注册的过滤器中，它必须是唯一的。
    <em>目前，寄存器过滤器API尚未报告任何错误，因此不会向用户报告名称重复的问题。</em></p>

    <p>后续参数可以按任何顺序出现，并定义要运行的外部命令和某些其他特征。唯一需要的参数是<code>cmd=</code> 。这些参数是：</p>

    <dl>
      <dt><code>cmd = <var>cmdline</var></code></dt>

      <dd>使用<code>cmd=</code>关键字可以指定要运行的外部命令。如果程序名称后面有参数，则命令行应用引号引起来（ <em>例如</em> ， <code>cmd=" <var>/bin/mypgm</var> <var>arg1</var> <var>arg2</var> "</code> 。）由于程序直接绕过外壳程序运行，因此不需要常规的外壳程序报价。程序参数用空格分隔。反斜杠可用于转义空格，空格应作为程序参数的一部分。作为参数一部分的任何反斜杠都必须使用反斜杠自己进行转义。除了标准的CGI环境变量外，还将为程序设置DOCUMENT_URI，DOCUMENT_PATH_INFO和QUERY_STRING_UNESCAPED。</dd>

      <dt><code>模式= <var>模式</var></code></dt>

      <dd>对于处理响应的过滤器，请使用<code>mode=output</code> （默认）。将<code>mode=input</code>用于处理请求的过滤器。 <code>mode=input</code>在Apache 2.1及更高版本中可用。</dd>

      <dt><code>intype = <var>imt</var></code></dt>

      <dd>此参数指定应过滤的文档的Internet媒体类型（ <em>即</em> MIME类型）。默认情况下，将过滤所有文档。如果指定了<code>intype=</code> ，则将对其他类型的文档禁用过滤器。</dd>

      <dt><code>outtype = <var>imt</var></code></dt>

      <dd>此参数指定已过滤文档的Internet媒体类型（ <em>即</em> MIME类型）。当过滤器更改Internet媒体类型作为过滤操作的一部分时，它很有用。默认情况下，Internet媒体类型不变。</dd>

      <dt><code>保留ContentLength</code></dt>

      <dd><code>PreservesContentLength</code>关键字指定过滤器保留内容长度。这不是默认设置，因为大多数过滤器都会更改内容长度。如果过滤器未修改长度，则应指定此关键字。</dd>

      <dt><code>ftype = <var>过滤器类型</var></code></dt>

      <dd>此参数指定应将过滤器注册为的过滤器类型的数值。在大多数情况下，默认值AP_FTYPE_RESOURCE就足够了。如果过滤器需要在过滤器链中的操作点与资源过滤器不同，则此参数是必需的。有关适当的值，请参见util_filter.h中的AP_FTYPE_foo定义。</dd>

      <dt><code>disableenv = <var>env</var></code></dt>

      <dd>此参数指定环境变量的名称，如果设置该名称，将禁用过滤器。</dd>

      <dt><code>enableenv = <var>env</var></code></dt>

      <dd>此参数指定必须设置的环境变量的名称，否则将禁用过滤器。</dd>
    </dl>

</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="ExtFilterOptions" id="ExtFilterOptions">ExtFilterOptions</a> <a name="extfilteroptions" id="extfilteroptions">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>配置<code class="module"><a href="../mod/mod_ext_filter.html">mod_ext_filter</a></code>选项</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>ExtFilterOptions <var>选项</var> [ <var>选项</var> ] ...</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>ExtFilterOptions NoLogStderr</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>目录</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_ext_filter</td></tr>
</table>
    <p><code class="directive">ExtFilterOptions</code>指令为<code class="module"><a href="../mod/mod_ext_filter.html">mod_ext_filter</a></code>指定特殊的处理选项。
    <var>选项</var>可以是以下之一</p>

    <dl>
      <dt><code>LogStderr | NoLogStderr</code></dt>

      <dd><code>LogStderr</code>关键字指定由外部过滤器程序写入标准错误的消息将保存在Apache错误日志中。
      <code>NoLogStderr</code>禁用此功能。</dd>

      <dt><code>Onfail = [中止|删除]</code></dt>
      <dd>确定如果无法启动外部过滤器程序，如何进行。使用<code>abort</code> （默认值），请求将中止。使用<code>remove</code> ，将<code>remove</code>过滤器，并且在没有过滤器的情况下继续进行请求。</dd>
    </dl>

    <pre class="prettyprint lang-config">ExtFilterOptions LogStderr</pre>


    <p>写入过滤器标准错误的消息将存储在Apache错误日志中。</p>

</div>
</div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>
</body></html>