<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>mod_md-Apache HTTP服务器版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body >
<div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="&lt;-" alt="&lt;-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP服务器</a> &gt; <a href="http://httpd.apache.org/docs/">文档</a> &gt; <a href="../index.html">版本2.4</a> &gt; <a href="./index.html">模块</a></div>
<div id="page-content">
<div id="preamble"><h1>Apache模块mod_md</h1>

<table class="module"><tr><th><a href="module-dict.html#Description">描述：</a></th><td>跨虚拟主机管理域，通过ACME协议配置证书</td></tr>
<tr><th><a href="module-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="module-dict.html#ModuleIdentifier">模块�标识符：</a></th><td>md_module</td></tr>
<tr><th><a href="module-dict.html#SourceFile">源文件：</a></th><td>mod_md.c</td></tr>
<tr><th><a href="module-dict.html#Compatibility">兼容性：</a></th><td>在版本2.4.30和更高版本中可用</td></tr></table>
<h3>摘要</h3>

        <p>此模块管理一个或多个虚拟主机的域的通用属性。具体来说，它可以使用ACME协议（ <a href="https://datatracker.ietf.org/doc/draft-ietf-acme-acme/">RFC草案</a> ）来自动进行证书供应。这些将自动为托管域及其虚拟主机配置。这包括在证书过期之前进行证书更新。当前实现ACME协议的最著名的证书颁发机构是<a href="https://letsencrypt.org/">Let's Encrypt</a> 。</p>
        
        <div class="warning"><h3>警告</h3>
            <p>该模块是实验性的。相对于其他标准模块，它的行为，指令和默认值在各个发行版之间可能会有更多更改。鼓励用户查阅“ CHANGES”文件以获取可能的更新。</p>
        </div>

        <p>简单的配置示例：</p>
        
        <div class="note"><h3>VirtualHost上下文中的TLS</h3>
        <pre class="prettyprint lang-config">MDomain example.org

&lt;VirtualHost *:443&gt;
    ServerName example.org
    DocumentRoot htdocs/a

    SSLEngine on
    # no certificates specification
&lt;/VirtualHost&gt;</pre>

        <p>在服务器启动时，此设置将与“ <a href="https://letsencrypt.org/">让我们加密”</a>联系，以请求该域的证书。如果“让我们加密”可以验证域的所有权，则模块将检索证书及其证书链，将其存储在本地文件系统中（请参阅<code class="directive"><a href="#mdstoredir">MDStoreDir</a></code> ），并在下次重新启动时将其提供给mod_ssl。
        </p><p>服务器已经在运行时会发生这种情况。所有其他主机将继续像以前一样工作。当证书不可用时，对托管域的请求将以“ 503服务不可用”得到答复。
        </p>
        </div>

        <div class="note"><h3>先决条件</h3>
        <p>此模块还需要加载<code class="module"><a href="../mod/mod_watchdog.html">mod_watchdog</a></code> 。
        </p><p>使用Let's Encrypt进行证书注册和续订要求您的服务器可以从外部在端口80（http :)上访问。由于安全原因（状态为2018年1月14日），当前禁用了通过端口443（https :)的替代方法。
        </p><p>该模块将从“加密”提供的方法中进行选择。如果LE在将来决定要重新启用它，则<code class="module"><a href="../mod/mod_md.html">mod_md</a></code>将在合适的时候使用它。
        </p><p>但是目前，仅提供端口80变体（称为“ http-01”）。只有当LE可以通过端口80到达服务器时， <code class="module"><a href="../mod/mod_md.html">mod_md</a></code>为您工作。至少现在。
        </p><p>如果您不想再在端口80上提供任何站点，则可以将其保持打开状态，然后将所有请求重定向到https：站点。使用下面描述的<code class="directive"><a href="#mdrequirehttps">MDRequireHttps</a></code>可以方便地进行此操作。这将继续回答http：让我们加密带来的挑战。
        </p>
        </div>
    </div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><h3 class="directives">指令</h3>
<ul id="toc">
<li><img alt="" src="../images/down.gif"> <a href="#mdbaseserver">MDBase服务器</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#mdcachallenges">MDCAC挑战</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#mdcertificateagreement">MDC证书协议</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#mdcertificateauthority">MDC证书颁发机构</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#mdcertificateprotocol">MDC证书协议</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#mddrivemode">MDDrive模式</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#mdhttpproxy">MDHttpProxy</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#mdmember">MD会员</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#mdmembers">MD会员</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#mdmuststaple">MDMust装订</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#mdnotifycmd">MDNotifyCmd</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#mdomain">域名</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#mdomainsetsection">&lt;MDomainSet&gt;</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#mdportmap">MDPortMap</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#mdprivatekeys">MDPrivateKeys</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#mdrenewwindow">MDRenewWindow</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#mdrequirehttps">MDRequireHttps</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#mdstoredir">MDStoreDir</a></li>
</ul>
<h3>错误修正清单</h3><ul class="seealso"><li><a href="https://www.apache.org/dist/httpd/CHANGES_2.4">httpd更新日志</a></li><li><a href="https://bz.apache.org/bugzilla/buglist.cgi?bug_status=__open__&amp;list_id=144532&amp;product=Apache httpd-2&amp;query_format=specific&amp;order=changeddate DESC%2Cpriority%2Cbug_severity&amp;component=mod_md">已知的问题</a></li><li><a href="https://bz.apache.org/bugzilla/enter_bug.cgi?product=Apache httpd-2&amp;component=mod_md">报告错误</a></li></ul></div>

<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MDBaseServer" id="MDBaseServer">MDBaseServer</a> <a name="mdbaseserver" id="mdbaseserver">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>控制是否可以管理基本服务器或仅托管虚拟主机。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>MDBaseServer开|关</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>MDBaseServer关闭</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_md</td></tr>
</table>
            <p>控制基本服务器（所有VirtualHost外部的服务器）是否应由<code class="module"><a href="../mod/mod_md.html">mod_md</a></code>管理。缺省情况是不执行此操作，因为它可能具有令人困惑的副作用。建议您为所有托管域都拥有虚拟主机，并且不要依赖于全局的后备服务器配置。
            </p>
        
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MDCAChallenges" id="MDCAChallenges">MDCAC挑战</a> <a name="mdcachallenges" id="mdcachallenges">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>用于证明域所有权的ACME挑战的类型。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>MDCAC挑战名称[名称...]</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>MDCAChallenges tls-sni-01 http-01</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_md</td></tr>
</table>
            <p>在证明域所有权时设置挑战类型及其执行顺序。名称是特定于协议的。由Let's Encrypt实现的当前ACME协议版本定义了<code class="module"><a href="../mod/mod_md.html">mod_md</a></code>支持的两种质询类型。默认情况下，它将在端口443上尝试一个。
            </p>
        
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MDCertificateAgreement" id="MDCertificateAgreement">MDCertificateAgreement</a> <a name="mdcertificateagreement" id="mdcertificateagreement">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>CA服务器要求您接受的服务条款文档的URL。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>MDCertificateAgreement服务条款网址</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_md</td></tr>
</table>
            <p>使用<code class="module"><a href="../mod/mod_md.html">mod_md</a></code>获得证书时，您将成为CA的客户（例如，让我们加密）。这意味着您需要阅读并同意他们的服务条款，以便了解他们提供的服务以及他们可能排除或要求您提供的服务。
            <code class="module"><a href="../mod/mod_md.html">mod_md</a></code>本身不能同意这样的事情。
            </p>
            <p>如果使用“让我们加密”，则其当前<a href="https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf">的服务条款在此处</a> 。这些术语可能会（并且可能会）随时间变化。因此，证书续订可能需要您更新此协议URL。</p>
            <div class="example"><h3>例</h3><pre class="prettyprint lang-config">MDCertificateAgreement https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf
MDomain example.org www.example.org mail.example.org</pre>
</div>
        
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MDCertificateAuthority" id="MDCertificateAuthority">MDCertificateAuthority</a> <a name="mdcertificateauthority" id="mdcertificateauthority">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>ACME证书颁发机构服务的URL。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>MDCertificateAuthority网址</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>MDCertificateAuthority https://acme-v01.api.letsencrypt.org/directory</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_md</td></tr>
</table>
            <p>CA提供服务的URL。
            </p><p>现在让我们加密提供两个这样的URL。一个用于真实证书，另一个用于测试（其暂存区，位于https://acme-staging.api.letsencrypt.org/directory）。为了使<code class="module"><a href="../mod/mod_md.html">mod_md</a></code>使用此测试服务，请按以下方式配置服务器：</p>
            <div class="example"><h3>LE分级设置</h3><pre class="prettyprint lang-config">MDCertificateAuthority https://acme-staging.api.letsencrypt.org/directory
MDCertificateAgreement https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf</pre>
</div>
        
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MDCertificateProtocol" id="MDCertificateProtocol">MDCertificateProtocol</a> <a name="mdcertificateprotocol" id="mdcertificateprotocol">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>与证书颁发机构一起使用的协议。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>MDCertificateProtocol协议</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>MDCertificateProtocol ACME</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_md</td></tr>
</table>
            <p>指定要使用的协议。当前仅支持<code>ACME</code> 。</p>
        
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MDDriveMode" id="MDDriveMode">MDDriveMode</a> <a name="mddrivemode" id="mddrivemode">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>控制何时允许其获取/更新证书。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>总是|自动|手动</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>MDDriveMode自动</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_md</td></tr>
</table>
            <p>在“自动”模式下， <code class="module"><a href="../mod/mod_md.html">mod_md</a></code>将<em>驱动</em>受管域的属性（例如证书管理）。在任何虚拟主机中未使用MD时，模块将不执行任何操作。如果缺少证书，它将尝试获取一个。证书即将过期时（请参见<code class="directive"><a href="#mdrenewwindow">MDRenewWindow</a></code> ），它将对其进行续订。
            </p><p>在“手动”模式下，这是您的责任。该模块将向mod_ssl提供现有证书（如果有）。但是它不会联系CA进行注册/续订。这在您只希望一个节点执行驱动的群集设置中很有用。
            </p><p>第三种模式“始终”类似于“自动”，区别在于<code class="module"><a href="../mod/mod_md.html">mod_md</a></code>不会检查是否实际使用了MD。
            </p>
        
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MDHttpProxy" id="MDHttpProxy">MDHttpProxy</a> <a name="mdhttpproxy" id="mdhttpproxy">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>为传出连接定义代理。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>MDHttpProxy网址</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_md</td></tr>
</table>
            <p>使用http代理连接到MDCertificateAuthority。如果您的网络服务器只能通过转发代理访问Internet，请定义此选项。
            </p>
        
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MDMember" id="MDMember">MDMember</a> <a name="mdmember" id="mdmember">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>受管域的其他主机名。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>MDMember主机名</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_md</td></tr>
</table>
            <p>您可以使用<code class="directive"><a href="#mdmember">MDMember</a></code>将此类名称添加到托管域中，而不是在同一行上列出所有DNS名称。
            </p>
            <div class="example"><h3>例</h3><pre class="prettyprint lang-config">&lt;MDomainSet example.org&gt;
    MDMember www.example.org
    MDMember mail.example.org
&lt;/MDomainSet example.org&gt;</pre>
</div>
            <p>如果在特定MD之外的全局上下文中使用它，则只能将一个值“ auto”或“ manual”指定为所有其他MD的默认值。有关这些特殊值的说明，请参见<code class="directive"><a href="#mdomain">MDomain</a></code> 。
            </p>
        
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MDMembers" id="MDMembers">MDMembers</a> <a name="mdmembers" id="mdmembers">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>控制是否自动添加别名域名。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>MDMembers自动|手动</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>MDMembers自动</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_md</td></tr>
</table>
            <p>定义是否将VirtualHost的<code class="directive"><a href="../mod/core.html#servername">ServerName</a></code>和<code class="directive"><a href="../mod/core.html#serveralias">ServerAlias</a></code>值自动添加到托管域的成员。
            </p>
        
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MDMustStaple" id="MDMustStaple">MDMustStaple</a> <a name="mdmuststaple" id="mdmuststaple">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>控制新证书是否带有OCSP必须装订标志。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>MDMustStaple开|关</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>MDMust装订</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_md</td></tr>
</table>
            <p>定义新请求的证书是否应设置“ OCSP必须装订”标志。如果证书具有此标志，则要求服务器向每个客户端发送OCSP装订响应。仅当您配置mod_ssl来生成它时才有效（请参阅<code class="directive"><a href="../mod/mod_ssl.html#sslusestapling">SSLUseStapling</a></code>和朋友）。
            </p>
        
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MDNotifyCmd" id="MDNotifyCmd">MDNotifyCmd</a> <a name="mdnotifycmd" id="mdnotifycmd">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>托管域就绪后，运行程序。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>MDNotifyCmd路径</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_md</td></tr>
</table>
            <p>当受管域注册或更新其证书时，将运行配置的可执行文件。它给出了已处理MD的名称作为参数。它应该返回状态码0表示它已经成功运行。
            </p>
        
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MDomain" id="MDomain">MDomain</a> <a name="mdomain" id="mdomain">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>定义属于一组的域名列表。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>MDomain <var>dns名称</var> [ <var>其他dns名称</var> ...] [自动|手动]</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_md</td></tr>
</table>
            <p>列表中的所有名称都作为一个受管域（MD）进行管理。mod_md将请求一个对所有这些名称均有效的证书。该指令使用全局设置（请参阅下面的其他MD指令）。如果您需要一个MD的特定设置，请使用<code class="directive"><a href="#mdomainset">&lt;MDomainSet&gt;</a></code> 。
            </p><p>对于受管域，还有2个其他必需设置： <code class="directive"><a href="../mod/core.html#serveradmin">ServerAdmin</a></code>和<code class="directive"><a href="#mdcertificateagreement">MDCertificateAgreement</a></code> 。<code class="directive"><a href="../mod/core.html#serveradmin">ServerAdmin</a></code>的邮件地址用于在CA进行注册（默认情况下为“让我们加密”）。CA可能会使用它来通知您有关其服务或证书状态的更改。
            </p><p>第二个设置<code class="directive"><a href="#mdcertificateagreement">MDCertificateAgreement</a></code>是CA服务条款的URL。配置URL时，请确认您已阅读并同意链接文档中描述的条款。在执行此操作之前，CA不会将证书分发给您。
            </p>
            <div class="example"><h3>例</h3><pre class="prettyprint lang-config">ServerAdmin mailto:admin@example.org
MDCertificateAgreement https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf
MDomain example.org www.example.org

&lt;VirtualHost *:443&gt;
    ServerName example.org
    DocumentRoot htdocs/root

    SSLEngine on
&lt;/VirtualHost&gt;

&lt;VirtualHost *:443&gt;
    ServerName www.example.org
    DocumentRoot htdocs/www

    SSLEngine on
&lt;/VirtualHost&gt;</pre>
</div>
            <p>您可以在此指令中使用两个特殊名称：“ manual”和“ auto”。这决定了受管域是否应具有已配置（“手动”）的名称列表，还是提供更多便利。通过“自动”，虚拟主机的所有名称都将添加到MD。方便地，“自动”也是默认设置。
            </p>
            <div class="example"><h3>例</h3><pre class="prettyprint lang-config">MDomain example.org

&lt;VirtualHost *:443&gt;
    ServerName example.org
    ServerAlias www.example.org
    DocumentRoot htdocs/root

    SSLEngine on
&lt;/VirtualHost&gt;

MDomain example2.org auto

&lt;VirtualHost *:443&gt;
    ServerName example2.org
    ServerAlias www.example2.org
    ...
&lt;/VirtualHost&gt;</pre>
</div>
            <p>在此示例中，域“ www.example.org”会自动添加到MD“ example.org”中。与“ example2.org”类似，其中显式配置了“ auto”。每当您向该虚拟主机添加更多ServerAlias名称时，它们也将被添加到Manged Domain中。
            </p><p>如果您希望显式声明所有域名，请使用“手动”模式。如果名称与预期名称不匹配，将记录错误。
            </p>
        
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MDomainSetsection" id="MDomainSetsection">&lt;MDomainSet&gt;</a> <a name="mdomainsetsection" id="mdomainsetsection">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>适用于相同托管域的指令的容器。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>&lt;MDomainSet <var>dns-name</var> [ <var>other-dns-name</var> ...]&gt; ... &lt;/ MDomainSet&gt;</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_md</td></tr>
</table>
            <p>通过此伪指令，可以使用与全局MD *设置不同的特定设置来定义受管域（MD）。例如，您可以让这样的MD使用另一个CA，然后再进行加密，使其具有唯一的续订期限等。</p>
            <div class="example"><h3>例</h3><pre class="prettyprint lang-config">&lt;MDomainSet sandbox.example.org&gt;
    MDCertificateAuthority   https://someotherca.com/ACME
    MDCertificateAgreement   https://someotherca.com/terms/v_1.02.pdf
&lt;/MDomainSet&gt;</pre>
</div>
        <p>这是<code class="directive"><a href="#mdomain">MDomain</a></code>的专用版本，仅在需要细粒度的配置时才应使用。
        <code class="directive"><a href="#mdomain">MDomain</a></code>是一般用例的建议选择。</p>
        
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MDPortMap" id="MDPortMap">MDPortMap</a> <a name="mdportmap" id="mdportmap">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>将外部映射到内部端口以进行域所有权验证。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>MDPortMap map1 [map2]</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>MDPortMap 80:80 443：443</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_md</td></tr>
</table>
            <p>ACME协议提供了两种验证域所有权的方法：一种使用端口80，另一种使用端口443。如果您的服务器无法通过两者之一访问，则ACME将无法为您工作。
            </p><p>
                <code class="module"><a href="../mod/mod_md.html">mod_md</a></code>将查看您的服务器配置，并尝试找出其中哪些可用。然后，它可以选择适当的ACME挑战来为您的站点创建证书。
            </p><p>但是，如果您有适当的端口转发功能，则可以从Internet上的端口443访问服务器，但是httpd使用的本地端口是另一个端口。您的服务器可能仅侦听端口5001和5002，但可以侦听端口443和80。<code class="module"><a href="../mod/mod_md.html">mod_md</a></code>应该<code class="module"><a href="../mod/mod_md.html">mod_md</a></code>算出那个？
            </p><p>使用MDPortMap，您可以告诉它哪个“ Internet端口”对应于哪个本地端口。
            </p>
            <div class="example"><h3>例</h3><pre class="prettyprint lang-config">MDPortMap 80:- 443:5002</pre>
</div>
            <p>此示例说明服务器无法从外部通过端口80访问，但是本地端口5002是响应https：请求的端口。
            </p>
        
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MDPrivateKeys" id="MDPrivateKeys">MDPrivateKeys</a> <a name="mdprivatekeys" id="mdprivatekeys">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>设置生成的私钥的类型和大小。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>MDPrivateKeys类型[参数...]</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>MDPrivateKeys RSA 2048</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_md</td></tr>
</table>
            <p>定义为托管域生成哪种私钥以及使用什么参数。现在唯一受支持的类型是“ RSA”，并且它采用的唯一参数是密钥所使用的位数。
            </p><p>当前（2017年）建议至少为2048位，此处不接受较小的建议。较高的数字可提供更长的安全性，但计算上更昂贵，例如，增加服务器的负载。这可能对您来说不是问题。
            </p><p>其他密钥类型将在以后定义。
            </p>
            <div class="example"><h3>例</h3><pre class="prettyprint lang-config">MDPrivateKeys RSA 3072</pre>
</div>
            <p>请注意，此设置仅对新键有效。您拥有的任何现有私钥均不会受到影响。同样，这仅影响为证书生成的私钥。ACME帐户密钥不受此影响。
            </p>
        
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MDRenewWindow" id="MDRenewWindow">MDRenewWindow</a> <a name="mdrenewwindow" id="mdrenewwindow">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>控制何时更新证书。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>MDRenewWindow持续时间</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>MDRenewWindow 33％</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_md</td></tr>
</table>
            <p>如果证书的有效性低于持续时间，则mod_md将获得新的签名证书。
            </p><p>通常，证书的有效期约为90天，而mod_md会在证书过期之前对其进行完整寿命的最早33％的续签（因此，对于90天的有效期，证书将在其过期之前的30天有效）。如果您认为这不是您所需要的，则可以指定确切的时间，例如：</p>
            <div class="example"><h3>例</h3><pre class="prettyprint lang-config"># 21 days before expiry
MDRenewWindow 21d 
# 30 seconds (might be close)
MDRenewWindow 30s
# 10% of the cert lifetime
MDRenewWindow 10%</pre>
</div>
            <p>在自动驱动模式下，该模块至少每12小时检查一次托管域的状态以及是否需要执行某些操作。对于错误（例如，当CA无法访问时），它将在几秒钟后最初重试。如果该操作继续失败，它将退回至每小时检查的最大间隔。
            </p>
        
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MDRequireHttps" id="MDRequireHttps">MDRequireHttps</a> <a name="mdrequirehttps" id="mdrequirehttps">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>将托管域的http：流量重定向到https:。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>MDRequireHttps关闭|临时|永久</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>MDRequireHttps关闭</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_md</td></tr>
</table>
            <p>这是一个方便的指令，可简化从托管域的http：到https：的迁移。带有：</p>
            <div class="example"><h3>例</h3><pre class="prettyprint lang-config">MDRequireHttps temporary</pre>
</div>
            <p>您宣布暂时希望将所有通过http：URL的流量重定向到https:。这是安全的，您可以随时再次将其删除。
            </p><p>
                <strong>结果如下：</strong>如果希望客户端<strong>不再</strong>使用http：URL，请配置：</p>
            <div class="example"><h3>永久（至少半年！）</h3><pre class="prettyprint lang-config">MDRequireHttps permanent</pre>
</div>
            <p>这有两件事：</p>
            <ol>
                <li>使用<code>301</code>状态代码，使用<code>https:</code>方案将对<code>http:</code>资源的所有请求重定向到相同的URL。这告诉客户这将永远存在，并且应该相应地更新他们拥有的所有链接。
                </li>
                <li><code>https:</code>请求的所有答案都将带有标头<code>Strict-Transport-Security</code> ，使用寿命为半年。这告诉浏览器，在与该域名对话时，它（从半年开始） <strong>从不</strong>使用<code>http:</code>浏览器在看到此信息后将拒绝与您未加密的站点联系。这样可以防止恶意中间件降级连接并侦听/操纵流量。哪个好但是您不能简单地再次将其收回。
                </li>
            </ol>
            <p>基本上，您可以使用mod_alias和一些重定向配置来实现相同的目的。如果您自己执行此操作，请确保从重定向中排除路径/.well-known/*，否则mod_md可能无法在新证书上签名。
            </p>
            <p>如果全局设置，则它适用于所有托管域。如果只希望将其用于特定域，请使用：</p>
            <div class="example"><h3>例</h3><pre class="prettyprint lang-config">&lt;MDomainSet xxx.yyy&gt;
  MDRequireHttps temporary
&lt;/MDomainSet&gt;</pre>
</div>
        
</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="MDStoreDir" id="MDStoreDir">MDStoreDir</a> <a name="mdstoredir" id="mdstoredir">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>本地文件系统上存储受管域数据的路径。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>MDStoreDir路径</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>MDStoreDir md</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>服务器配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_md</td></tr>
</table>
            <p>定义托管域数据在本地文件系统上的存储位置。这是相对于服务器根目录的绝对路径或相对路径。默认值将在服务器根目录中创建目录“ md”。
            </p><p>如果您进行了移动并且已经有数据，请确保首先将数据移动/复制到新位置，重新配置然后重新启动服务器。如果重新配置并首先重新启动，则服务器将尝试获取它认为缺少的新证书。
            </p>
        
</div>
</div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>
</body></html>