<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>mod_access_compat-Apache HTTP服务器版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body >
<div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="&lt;-" alt="&lt;-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP服务器</a> &gt; <a href="http://httpd.apache.org/docs/">文档</a> &gt; <a href="../index.html">版本2.4</a> &gt; <a href="./index.html">模块</a></div>
<div id="page-content">
<div id="preamble"><h1>Apache模块mod_access_compat</h1>

<table class="module"><tr><th><a href="module-dict.html#Description">描述：</a></th><td>基于主机（名称或IP地址）的组授权</td></tr>
<tr><th><a href="module-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="module-dict.html#ModuleIdentifier">模块�标识符：</a></th><td>access_compat_module</td></tr>
<tr><th><a href="module-dict.html#SourceFile">源文件：</a></th><td>mod_access_compat.c</td></tr>
<tr><th><a href="module-dict.html#Compatibility">兼容性：</a></th><td>在Apache HTTP Server 2.3中作为与Apache httpd 2.x以前版本的兼容性模块提供。新的authz重构已弃用此模块提供的指令。请参阅<code class="module"><a href="../mod/mod_authz_host.html">mod_authz_host</a></code></td></tr></table>
<h3>摘要</h3>

    <p><code class="module"><a href="../mod/mod_access_compat.html">mod_access_compat</a></code>提供的指令在<code class="directive"><a href="../mod/core.html#directory">&lt;Directory&gt;</a></code> ， <code class="directive"><a href="../mod/core.html#files">&lt;Files&gt;</a></code>和<code class="directive"><a href="../mod/core.html#location">&lt;Location&gt;</a></code>部分以及<code><a href="core.html#accessfilename">.htaccess</a></code>文件中使用，以控制对服务器特定部分的访问。可以根据客户端主机名，IP地址或客户端请求的其他特征来控制访问，如<a href="../env.html">环境变量中所述</a> 。<code class="directive"><a href="#allow">Allow</a></code>和<code class="directive"><a href="#deny">Deny</a></code>伪指令用于指定允许或不允许哪些客户端访问服务器，而<code class="directive"><a href="#order">Order</a></code>伪指令设置默认访问状态，并配置<code class="directive"><a href="#allow">Allow</a></code>和<code class="directive"><a href="#deny">Deny</a></code>伪指令如何交互。</p>

    <p>基于主机的访问限制和基于密码的身份验证都可以同时实现。在这种情况下，可以使用<code class="directive"><a href="#satisfy">Satisfy</a></code>指令来确定两组限制如何相互作用。</p>

    <div class="warning"><h3>注意</h3>
      <p><code class="module"><a href="../mod/mod_access_compat.html">mod_access_compat</a></code>提供的指令已被<code class="module"><a href="../mod/mod_authz_host.html">mod_authz_host</a></code>弃用。从技术上讲，可以将诸如<code class="directive"><a href="#order">Order</a></code> ， <code class="directive"><a href="#allow">Allow</a></code>或<code class="directive"><a href="#deny">Deny</a></code>类的旧指令与<code class="directive"><a href="../mod/mod_authz_core.html#require">Require</a></code>类的新指令混合使用，但不建议这样做。创建该模块是为了支持仅包含旧指令的配置，以促进2.4升级。请查看<a href="../upgrading.html">升级</a>指南以获取更多信息。
      </p>
      </div>

    <p>通常，访问限制指令适用于所有访问方法（ <code>GET</code> ， <code>PUT</code> ， <code>POST</code>等）。在大多数情况下，这是所需的行为。但是，可以通过将指令包含在<code class="directive"><a href="../mod/core.html#limit">&lt;Limit&gt;</a></code>节中来限制某些方法，而使其他方法不受限制。</p>

    <div class="note"> <h3>合并配置部分</h3>
      <p>在新的配置节中使用此模块提供的任何指令时，此模块提供的指令均不会从以前的配置节中继承。</p>
    </div>

</div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><h3 class="directives">指令</h3>
<ul id="toc">
<li><img alt="" src="../images/down.gif"> <a href="#allow">允许</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#deny">拒绝</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#order">订购</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#satisfy">满足</a></li>
</ul>
<h3>错误修正清单</h3><ul class="seealso"><li><a href="https://www.apache.org/dist/httpd/CHANGES_2.4">httpd更新日志</a></li><li><a href="https://bz.apache.org/bugzilla/buglist.cgi?bug_status=__open__&amp;list_id=144532&amp;product=Apache httpd-2&amp;query_format=specific&amp;order=changeddate DESC%2Cpriority%2Cbug_severity&amp;component=mod_access_compat">已知的问题</a></li><li><a href="https://bz.apache.org/bugzilla/enter_bug.cgi?product=Apache httpd-2&amp;component=mod_access_compat">报告错误</a></li></ul><h3>也可以看看</h3>
<ul class="seealso">
<li><code class="directive"><a href="../mod/mod_authz_core.html#require">要求</a></code></li>
<li><code class="module"><a href="../mod/mod_authz_host.html">mod_authz_host</a></code></li>
<li><code class="module"><a href="../mod/mod_authz_core.html">mod_authz_core</a></code></li>
</ul></div>

<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="Allow" id="Allow">允许</a> <a name="allow" id="allow">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>控制哪些主机可以访问服务器区域</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>全部允许| <var>主机</var> | env = [！]<var>env-variable</var> [ <var>host</var> | env = [！]<var>环境变量</var> ] ...</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>目录.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>限制</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_access_compat</td></tr>
</table>
    <p><code class="directive">Allow</code>指令会影响哪些主机可以访问服务器的区域。可以通过主机名，IP地址，IP地址范围或环境变量中捕获的客户端请求的其他特征来控制访问。</p>

    <p>该指令的第一个参数始终是<code>from</code> 。后续参数可以采用三种不同的形式。如果<code>Allow from all</code>被指定，则所有主机允许访问，但须的配置<code class="directive"><a href="#deny">Deny</a></code>和<code class="directive"><a href="#order">Order</a></code>指令，如下所述。要仅允许特定主机或主机组访问服务器，可以以下列任何一种格式指定<em>主机</em> ：</p>

    <dl>
      <dt>一个（部分）域名</dt>

      <dd>
      <pre class="prettyprint lang-config">Allow from example.org
Allow from .net example.edu</pre>

      <p>名称匹配或以该字符串结尾的主机被允许访问。仅匹配完整的组件，因此上面的示例将匹配<code>foo.example.org</code>但将不匹配<code>fooexample.org</code> 。无论<code class="directive"><a href="../mod/core.html#hostnamelookups">HostnameLookups</a></code>指令的设置如何，此配置都会使Apache httpd在客户端IP地址上执行双重DNS查找。它将对IP地址进行反向DNS查找，以找到关联的主机名，然后对主机名进行正向查找，以确保其与原始IP地址匹配。仅当正向和反向DNS一致且主机名匹配时，才允许访问。</p></dd>

      <dt>完整的IP地址</dt>

      <dd>
      <pre class="prettyprint lang-config">Allow from 10.1.2.3
Allow from 192.168.1.104 192.168.1.205</pre>

      <p>主机允许访问的IP地址</p></dd>

      <dt>部分IP地址</dt>

      <dd>
      <pre class="prettyprint lang-config">Allow from 10.1
Allow from 10 172.20 192.168.2</pre>

      <p>IP地址的前1至3个字节，用于子网限制。</p></dd>

      <dt>网络/网络掩码对</dt>

      <dd>
      <pre class="prettyprint lang-config">Allow from 10.1.0.0/255.255.0.0</pre>

      <p>网络abcd和网络掩码wxyz有关更细粒度的子网限制。</p></dd>

      <dt>网络/ nnn CIDR规范</dt>

      <dd>
      <pre class="prettyprint lang-config">Allow from 10.1.0.0/16</pre>

      <p>与前面的情况类似，除了网络掩码由nnn个高1位组成。</p></dd>
    </dl>

    <p>请注意，以上最后三个示例完全匹配同一组主机。</p>

    <p>可以如下所示指定IPv6地址和IPv6子网：</p>

    <pre class="prettyprint lang-config">Allow from 2001:db8::a00:20ff:fea7:ccea
Allow from 2001:db8::a00:20ff:fea7:ccea/10</pre>


    <p><code class="directive">Allow</code>指令的参数的第三种格式<code class="directive">Allow</code>根据<a href="../env.html">环境变量</a>的存在来控制对服务器的访问。当指定<code>Allow from env= <var>env-variable</var></code> ，如果环境变量<var>env-variable</var>存在，则允许访问请求。当<code>Allow from env=!指定了<var>env-variable</var></code> ，如果环境变量<var>env-variable</var>不存在，则允许访问请求。服务器可以使用<code class="module"><a href="../mod/mod_setenvif.html">mod_setenvif</a></code>提供的指令，根据客户端请求的特征灵活地设置环境变量。因此，该指令可用于允许基于客户端<code>User-Agent</code> （浏览器类型）， <code>Referer</code>或其他HTTP请求标头字段等因素进行访问。</p>

    <pre class="prettyprint lang-config">SetEnvIf User-Agent ^KnockKnock/2\.0 let_me_in
&lt;Directory "/docroot"&gt;
    Order Deny,Allow
    Deny from all
    Allow from env=let_me_in
&lt;/Directory&gt;</pre>


    <p>在这种情况下，具有以<code>KnockKnock/2.0</code>开头的用户代理字符串的浏览器将被允许访问，而所有其他浏览器将被拒绝。</p>

    <div class="note"> <h3>合并配置部分</h3>
      <p>在新的配置节中使用此模块提供的任何指令时，此模块提供的指令均不会从以前的配置节中继承。</p>
    </div>


</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="Deny" id="Deny">拒绝</a> <a name="deny" id="deny">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>控制拒绝访问服务器的主机</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>全部拒绝| <var>主机</var> | env = [！]<var>env-variable</var> [ <var>host</var> | env = [！]<var>环境变量</var> ] ...</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>目录.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>限制</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_access_compat</td></tr>
</table>
    <p>该指令允许根据主机名，IP地址或环境变量来限制对服务器的访问。<code class="directive">Deny</code>指令的参数与<code class="directive"><a href="#allow">Allow</a></code>指令的参数相同。</p>

</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="Order" id="Order">订单</a> <a name="order" id="order">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>控制默认访问状态以及评估“ <code class="directive">Allow</code>和<code class="directive">Deny</code>的顺序。</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>订单<var>订购</var></code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>拒绝订单，允许</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>目录.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>限制</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_access_compat</td></tr>
</table>

    <p><code class="directive">Order</code>指令以及<code class="directive"><a href="#allow">Allow</a></code>和<code class="directive"><a href="#deny">Deny</a></code>指令一起控制三遍访问控制系统。第一遍处理<code class="directive"><a href="#order">Order</a></code>指令指定的所有<code class="directive"><a href="#allow">Allow</a></code>指令或所有<code class="directive"><a href="#deny">Deny</a></code>指令。第二遍解析其余指令（ <code class="directive"><a href="#deny">Deny</a></code>或<code class="directive"><a href="#allow">Allow</a></code> ）。第三遍适用于所有与前两个都不匹配的请求。</p>

    <p>请注意，与仅使用第一个匹配项的典型防火墙不同，所有的<code class="directive"><a href="#allow">Allow</a></code>和<code class="directive"><a href="#deny">Deny</a></code>指令均已处理。最后一个匹配有效（也不同于典型的防火墙）。此外，行在配置文件中的显示顺序并不重要-所有“ <code class="directive"><a href="#allow">Allow</a></code>行均作为一个组处理，所有<code class="directive"><a href="#deny">Deny</a></code>行均视为另一组，并且默认状态由其自身考虑。</p>

    <p><em>订购</em>是以下之一：</p>

    <dl>
      <dt><code>允许否认</code></dt>

      <dd>首先，评估所有<code class="directive"><a href="#allow">Allow</a></code>指令；至少一个必须匹配，否则请求被拒绝。接下来，将评估所有<code class="directive"><a href="#deny">Deny</a></code>指令。如果有匹配项，则请求被拒绝。最后，默认情况下会拒绝所有与<code class="directive"><a href="#allow">Allow</a></code>或<code class="directive"><a href="#deny">Deny</a></code>指令不匹配的请求。</dd>

      <dt><code>否认允许</code></dt>

      <dd>首先，评估所有<code class="directive"><a href="#deny">Deny</a></code>指令；如果有匹配项，则该请求将被拒绝， <strong>除非</strong>它也与<code class="directive"><a href="#allow">Allow</a></code>指令匹配。任何与任何<code class="directive"><a href="#allow">Allow</a></code>或<code class="directive"><a href="#deny">Deny</a></code>指令都不匹配的请求都是允许的。</dd>

      <dt><code>相互失败</code></dt>

      <dd>此订单与<code>Order Allow,Deny</code>效果相同，因此不赞成使用。</dd>
    </dl>

    <p>关键字只能用逗号分隔；它们之间不允许<em>有空格</em> 。</p>

    <table class="bordered">
      <tr>
        <th>比赛</th>
        <th>允许，拒绝结果</th>
        <th>拒绝，允许结果</th>
      </tr><tr>
        <th>仅匹配允许</th>
        <td>允许请求</td>
        <td>允许请求</td>
      </tr><tr>
        <th>仅匹配拒绝</th>
        <td>请求被拒绝</td>
        <td>请求被拒绝</td>
      </tr><tr>
        <th>没有匹配</th>
        <td>默认为第二个指令：拒绝</td>
        <td>默认为第二指令：允许</td>
      </tr><tr>
        <th>匹配允许和拒绝</th>
        <td>决赛控制：拒绝</td>
        <td>决赛控制：允许</td>
      </tr>
    </table>

    <p>在以下示例中，允许example.org域中的所有主机访问；所有其他主机都被拒绝访问。</p>

    <pre class="prettyprint lang-config">Order Deny,Allow
Deny from all
Allow from example.org</pre>


    <p>在下一个示例中，example.org域中的所有主机均被允许访问，但foo.example.org子域中的主机被拒绝访问。拒绝example.org域之外的所有主机的访问，因为默认状态为<code class="directive"><a href="#deny">Deny</a></code>访问服务器。</p>

    <pre class="prettyprint lang-config">Order Allow,Deny
Allow from example.org
Deny from foo.example.org</pre>


    <p>另一方面，如果将上一个示例中的<code class="directive">Order</code>更改为<code>Deny,Allow</code> ，将<code>Deny,Allow</code>所有主机访问。发生这种情况的原因是，无论配置文件中指令的实际顺序如何， <code>Allow from example.org</code>的<code>Allow from example.org</code>都会被最后评估，并将覆盖<code>Deny from foo.example.org</code>的<code>Deny from foo.example.org</code> 。也将允许所有非<code>example.org</code>域中的主机访问，因为默认状态为<code class="directive"><a href="#allow">Allow</a></code> 。</p>

    <p>即使没有伴随的<code class="directive"><a href="#allow">Allow</a></code>和<code class="directive"><a href="#deny">Deny</a></code>指令， <code class="directive">Order</code>指令的存在也会影响对服务器一部分的访问，因为它会影响默认访问状态。例如，</p>

    <pre class="prettyprint lang-config">&lt;Directory "/www"&gt;
    Order Allow,Deny
&lt;/Directory&gt;</pre>


    <p>将拒绝对<code>/www</code>目录的所有访问，因为默认访问状态设置为<code class="directive"><a href="#deny">Deny</a></code> 。</p>

    <p><code class="directive">Order</code>指令仅在服务器配置处理的每个阶段内控制访问指令的处理顺序。这意味着，例如，一个<code class="directive"><a href="#allow">Allow</a></code>或<code class="directive"><a href="#deny">Deny</a></code>在一个指令中发生<code class="directive"><a href="../mod/core.html#location">&lt;Location&gt;</a></code>部分将总是被评估后的<code class="directive"><a href="#allow">Allow</a></code>或<code class="directive"><a href="#deny">Deny</a></code>在一个指令中发生<code class="directive"><a href="../mod/core.html#directory">&lt;Directory&gt;</a></code>部或<code>.htaccess</code>文件，而不管的设定的<code class="directive">Order</code>指令。有关合并配置部分的详细信息，请参阅“ <a href="../sections.html">目录，位置和文件”部分的工作方式</a>文档。</p>

    <div class="note"> <h3>合并配置部分</h3>
      <p>在新的配置节中使用此模块提供的任何指令时，此模块提供的指令均不会从以前的配置节中继承。</p>
    </div>


</div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="directive-section"><h2><a name="Satisfy" id="Satisfy">满足</a> <a name="satisfy" id="satisfy">指令</a></h2>
<table class="directive">
<tr><th><a href="directive-dict.html#Description">描述：</a></th><td>主机级访问控制和用户身份验证之间的交互</td></tr>
<tr><th><a href="directive-dict.html#Syntax">句法：</a></th><td><code>满足任何条件|全部</code></td></tr>
<tr><th><a href="directive-dict.html#Default">默认：</a></th><td><code>全部满足</code></td></tr>
<tr><th><a href="directive-dict.html#Context">内容：</a></th><td>目录.htaccess</td></tr>
<tr><th><a href="directive-dict.html#Override">覆写：</a></th><td>验证配置</td></tr>
<tr><th><a href="directive-dict.html#Status">状态：</a></th><td>延期</td></tr>
<tr><th><a href="directive-dict.html#Module">模块：</a></th><td>mod_access_compat</td></tr>
<tr><th><a href="directive-dict.html#Compatibility">兼容性：</a></th><td>受版本2.0.51及更高版本中的<code class="directive"><a href="../mod/core.html#limit">&lt;Limit&gt;</a></code>和<code class="directive"><a href="../mod/core.html#limitexcept">&lt;LimitExcept&gt;</a></code>影响</td></tr>
</table>
    <p>如果同时使用了“ <code class="directive"><a href="#allow">Allow</a></code>和“ <code class="directive"><a href="../mod/mod_authz_core.html#require">Require</a></code>则为访问策略。该参数可以是<code>All</code>或<code>Any</code> 。仅当用户名/密码<em>和</em>客户端主机地址都限制了对特定区域的访问时，此指令才有用。在这种情况下，默认行为（ <code>All</code> ）是要求客户端通过地址访问限制<em>并</em>输入有效的用户名和密码。使用“ <code>Any</code>选项，如果客户端通过主机限制或输入有效的用户名和密码，将被授予访问权限。这可用于密码限制区域，但允许来自特定地址的客户端进入而无需提示输入密码。</p>

    <p>例如，如果您想让网络中的人无限制地访问网站的一部分，但要求网络外的人提供密码，则可以使用类似于以下的配置：</p>

    <pre class="prettyprint lang-config">Require valid-user
Allow from 192.168.1
Satisfy Any</pre>


    <p><code class="directive">Satisfy</code>指令的另一个常见用法是放宽对子目录的访问限制：</p>

    <pre class="prettyprint lang-config">&lt;Directory "/var/www/private"&gt;
    Require valid-user
&lt;/Directory&gt;

&lt;Directory "/var/www/private/public"&gt;
    Allow from all
    Satisfy Any
&lt;/Directory&gt;</pre>


    <p>在上面的示例中， <code>/var/www/private</code>目录将需要身份验证，而<code>/var/www/private/public</code>目录将不需要身份验证。</p>

    <p>从版本2.0.51开始，可以通过<code class="directive"><a href="../mod/core.html#limit">&lt;Limit&gt;</a></code>和<code class="directive"><a href="../mod/core.html#limitexcept">&lt;LimitExcept&gt;</a></code>部分将<code class="directive">Satisfy</code>指令限制为特定的方法。</p>

    <div class="note"> <h3>合并配置部分</h3>
      <p>在新的配置节中使用此模块提供的任何指令时，此模块提供的指令均不会从以前的配置节中继承。</p>
    </div>


<h3>也可以看看</h3>
<ul>
<li><code class="directive"><a href="#allow">允许</a></code></li>
<li><code class="directive"><a href="../mod/mod_authz_core.html#require">要求</a></code></li>
</ul>
</div>
</div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>
</body></html>