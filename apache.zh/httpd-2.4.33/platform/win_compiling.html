<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>为Microsoft Windows编译Apache-Apache HTTP Server版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body id="manual-page" ><div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="<-" alt="<-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> > <a href="http://httpd.apache.org/">HTTP Server</a> > <a href="http://httpd.apache.org/docs/">文档</a> > <a href="../index.html">版本2.4</a> > <a href="./index.html">平台特定说明</a></div><div id="page-content"><div id="preamble"><h1>为Microsoft Windows编译Apache</h1>



    <p>在开始编译Apache HTTP Server（httpd）之前，需要考虑许多重要点。开始之前，请参阅<a href="windows.html">在Microsoft Windows上使用Apache HTTP Server</a> 。</p>

    <p>可以使用基于cmake的构建系统在Windows上构建httpd，也可以使用httpd开发人员维护的Visual Studio项目文件构建httpd。基于cmake的生成系统直接支持Visual Studio的更多版本，但当前具有相当大的功能限制。</p>

  </div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><ul id="toc"><li><img alt="" src="../images/down.gif"> <a href="#vstudio">使用随附的Visual Studio项目文件构建httpd</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#cmake">用cmake构建httpd</a></li>
</ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="vstudio" id="vstudio">使用随附的Visual Studio项目文件构建httpd</a></h2>
  

  <h3><a name="requirements" id="requirements">要求</a></h3>

    

    <p>编译Apache需要正确安装以下环境：</p>

    <ul>
      <li>
        <p>磁盘空间</p>

        <p>确保您至少有200 MB的可用磁盘空间。安装后，Apache需要大约80 MB的磁盘空间，以及用于日志和缓存文件的空间，这些空间会快速增长。实际的磁盘空间要求将根据您选择的配置和任何第三方模块或库而有很大不同，尤其是在还构建了OpenSSL的情况下。由于许多文件都是文本并且非常容易压缩，因此NTFS文件系统压缩将这些要求减少了一半。</p>
      </li>

      <li>
        <p>适当的补丁</p>

        <p>httpd二进制文件是在第三方软件包的多个修补程序的帮助下构建的，可确保发布的代码可构建和调试。这些修补程序可从<a href="http://www.apache.org/dist/httpd/binaries/win32/patches_applied/">http://www.apache.org/dist/httpd/binaries/win32/patches_applied/</a>获得和分发，建议将其应用于获得与“官方” ASF分布式二进制文件相同的结果。</p>
      </li>

      <li>
        <p>Microsoft Visual C ++ 6.0（Visual Studio 97）或更高版本。</p>

        <p>可以使用命令行工具或从Visual Studio IDE工作台中构建Apache。命令行构建需要环境反映<code>PATH</code> ， <code>INCLUDE</code> ， <code>LIB</code>以及其他可以通过<code>vcvars32.bat</code>脚本。</p>

        <div class="note">对于ml.exe汇编程序，您可能希望使用旧版本的Visual Studio的Visual Studio处理器包或较新的Visual Studio版本的完整（而非Express）版本。如果需要，这将允许您使用更有效的汇编代码实现来构建OpenSSL。</div>

        <div class="note">活动的httpd贡献者仅积极支持Microsoft编译器工具链。尽管该项目定期接受补丁以确保MinGW和其他替代版本能够正常工作并对其进行改进，但它们并未得到积极维护，并且经常在正常开发过程中被破坏。</div>
      </li>

      <li>
        <p>2003年2月或之后更新了Microsoft Windows Platform SDK。</p>

        <p>在Visual C ++ 7.1（Visual Studio 2002）的完整（非快速/精简版）版本中，默认情况下包括适当的Windows Platform SDK，除非明确选择更新或不同版本的Platform SDK，否则这些用户可以忽略这些步骤。</p>

        <p>要使用Visual C ++ 6.0或7.0（Studio 2000 .NET），必须使用以下命令准备Platform SDK环境。 <code>setenv.bat</code>脚本（由Platform SDK安装）在开始命令行构建或启动msdev / devenv GUI环境之前。安装适用于Visual Studio Express版本（2003及更高版本）的Platform SDK时，应适当调整默认环境。</p>

        <div class="example"><p><code>"c:\Program Files\Microsoft Visual Studio\VC98\Bin\VCVARS32"<br> "c:\Program Files\Platform SDK\setenv.bat"</code></p></div>
      </li>

      <li>
        <p>Perl和AWK</p>

        <p>这里建议的几个步骤在构建准备过程中需要一个perl解释器，但否则不是必需的。</p>

        <p>要在构建系统中安装Apache，请使用<code>awk.exe</code>效用。选择awk是因为它下载量很小（与Perl或WSH / VB相比），并且完成了安装时修改配置文件的任务。Brian Kernighan的<a href="http://www.cs.princeton.edu/~bwk/btl.mirror/">http://www.cs.princeton.edu/~bwk/btl.mirror/</a>网站具有一个已编译的本地Win32二进制文件，即<a href="http://www.cs.princeton.edu/~bwk/btl.mirror/awk95.exe">http://www.cs.princeton.edu/~bwk/btl.mirror/awk95。</a>您必须使用名称保存的<a href="http://www.cs.princeton.edu/~bwk/btl.mirror/awk95.exe">exe</a> <code>awk.exe</code> （而不是<code>awk95.exe</code> ）。</p>

        <div class="note">如果找不到awk.exe，Makefile.win的安装目标将不会在已安装的.conf文件中执行替换。您必须手动修改已安装的.conf文件，以允许服务器启动。搜索并替换所有的“ @ token @”标签。</div>

        <div class="note">Visual Studio IDE只会找到<code>awk.exe</code>从PATH或菜单选项“工具->选项->（项目->）目录”中指定的可执行路径。确保awk.exe在您的系统路径中。</div>

        <div class="note">还要注意，如果您使用的是Cygwin工具（ <a href="http://www.cygwin.com/">http://www.cygwin.com/），awk</a>实用程序将被命名为<code>gawk.exe</code>那个文件<code>awk.exe</code>确实是与<code>gawk.exe</code>文件。Windows命令外壳无法识别符号链接，因此，由于该版本，InstallBin将失败。解决方法是删除<code>awk.exe</code>从cygwin安装并复制<code>gawk.exe</code>至<code>awk.exe</code> 。另请注意，gawk 3.0.x的cygwin / mingw端口存在故障，请在尝试使用任何gawk端口之前升级至3.1.x。</div>
      </li>

      <li>
        <p>[可选] zlib库（用于<code class="module"><a href="../mod/mod_deflate.html">mod_deflate</a></code> ）</p>

        <p>Zlib必须安装到<code>srclib</code>子目录名为<code>zlib</code> 。这必须就地构建。Zlib可以从<a href="http://www.zlib.net/">http://www.zlib.net/</a>获得- <code class="module"><a href="../mod/mod_deflate.html">mod_deflate</a></code>确认可以在1.2.3版中正常使用。</p>

        <div class="example"><p><code>nmake -f win32\Makefile.msc<br> nmake -f win32\Makefile.msc test</code></p></div>
      </li>

      <li>
        <p>[可选] OpenSSL库（用于<code class="module"><a href="../mod/mod_ssl.html">mod_ssl</a></code>和<code>ab.exe</code>带有ssl支持）</p>

        <div class="note">OpenSSL库是加密软件。您当前居住的国家/地区可能对加密软件的导入，拥有，使用和/或再出口到另一个国家/地区有所限制。在使用任何加密软件之前，请检查您所在国家/地区有关导入，拥有，使用和再出口加密软件的法律，法规和政策，以查看是否允许这样做。有关更多信息，请参见<a href="http://www.wassenaar.org/">http://www.wassenaar.org/</a> 。</div>

        <p>配置和构建OpenSSL需要安装perl。</p>

        <p>必须将OpenSSL安装到<code>srclib</code>子目录名为<code>openssl</code> （可从<a href="http://www.openssl.org/source/">http://www.openssl.org/source/</a>获得）进行编译<code class="module"><a href="../mod/mod_ssl.html">mod_ssl</a></code>或者<code>abs.exe</code>专案（已启用SSL支援的Ab.c）。要准备将OpenSSL链接到Apache mod_ssl或abs.exe，并禁用OpenSSL中的专利保护功能，可以使用以下构建命令：</p>

        <div class="example"><p><code>perl Configure no-rc5 no-idea enable-mdc2 enable-zlib VC-WIN32 -Ipath/to/srclib/zlib -Lpath/to/srclib/zlib<br> ms\do_masm.bat<br> nmake -f ms\ntdll.mak</code></p></div>

        <div class="note">不建议使用zlib-dynamic，因为这会将deflate SSL流的成本转移到必须加载zlib dll的第一个请求中。请注意，建议的修补程序使-L标志可以与Windows构建一起使用，更正了zdll.lib的名称，并确保生成了.pdb文件以进行故障排除。如果未安装汇编程序，则可以在上面添加no-asm并使用ms \ do_ms.bat而不是ms \ do_masm.bat脚本。</div>
      </li>

      <li>
        <p>[可选]数据库库（用于<code class="module"><a href="../mod/mod_dbd.html">mod_dbd</a></code>和<code class="module"><a href="../mod/mod_authn_dbm.html">mod_authn_dbm</a></code> ）</p>

        <p>apr-util库向dbd服务器及其模块公开了dbm（密钥数据库）和dbd（面向查询的数据库）客户端功能，例如身份验证和授权。sdbm dbm和odbc dbd提供程序是无条件编译的。</p>

        <p>dbd支持包括Oracle Instantclient软件包，MySQL，PostgreSQL和sqlite。要构建所有这些，例如，设置LIB包括库路径，INCLUDE包括头路径，PATH包括所有四个SDK的dll bin路径，并设置DBD_LIST环境变量以通知构建哪个客户端驱动程序SDK已正确安装，例如；</p>

        <div class="example"><p><code>set DBD_LIST=sqlite3 pgsql oracle mysql</code></p></div>

        <p>同样，可以通过先配置LIB，INCLUDE和PATH来确保客户端库库和标头可用，然后用DBM_LIST扩展dbm支持以构建Berkeley DB提供程序（db）和/或gdbm提供程序。</p>

        <div class="example"><p><code>set DBM_LIST=db gdbm</code></p></div>

        <div class="note">根据数据库分布的选择，可能有必要更改srclib \ apr-util目录中相应.dsp / .mak文件中列出的实际链接目标名称（例如gdbm.lib与libgdb.lib）。 \ dbd或... \ dbm。</div>

        <p>有关获取各种数据库驱动程序SDK的更多提示，请参见README-win32.txt文件。</p>
      </li>
    </ul>

  

  <h3><a name="unixsrcbuild" id="unixsrcbuild">从Unix源码构建</a></h3>

    

    <p>Apache HTTP Server项目的策略是仅发布Unix源。可供下载的Windows源软件包已由志愿者提供，可能并非每个版本都可用。您仍然可以通过Unix源tarball在Windows上构建服务器，仅需执行几个附加步骤。</p>

    <ol>
    	<li>下载并解压缩最新版本的Unix源tarball。</li>
    	<li>下载并解压缩最新版本的APR，AR-Util和APR-Iconv的Unix源tarball，并将这些源放置在目录httpd-2.xx \ srclib \ apr，httpd-2.xx \ srclib \ apr-util和httpd- 2.xx \ srclib \ apr-iconv</li>
    	<li>打开命令提示符并CD到httpd-2.xx文件夹</li>
    	<li>在提示符下运行行尾转换实用程序；</li>
    </ol>

    <div class="example"><p><code>perl srclib\apr\build\lineends.pl</code></p></div>

    <p>现在，您可以使用IDE在Visual Studio开发环境中构建服务器。除非您按照以下说明导出.mak文件，否则无法从Unix源进行服务器的命令行构建。
    </p>

  

  <h3><a name="commandbuild" id="commandbuild">命令行构建</a></h3>

    

    <p><code>Makefile.win</code>是顶级Apache Makefile。要在Windows上编译Apache，只需使用以下命令之一来构建<code>release</code>要么<code>debug</code>味道：</p>

    <div class="example"><p><code>nmake /f Makefile.win _apacher<br><br> nmake /f Makefile.win _apached</code></p></div>

    <p>这两个命令都将编译Apache。后者将禁用对结果文件的优化，从而使单步执行代码查找错误和查找问题更加容易。</p>

    <p>您可以使用其他make（环境）变量DBD_LIST和DBM_LIST添加apr-util dbd和dbm提供程序选项，请参阅上面有关[Optional]数据库库的注释。查看Makefile.win中的初始注释，以获取调用构建时可以提供的其他选项。</p>

  

  <h3><a name="workspacebuild" id="workspacebuild">Developer Studio Workspace IDE构建</a></h3>

    

    <p>还可以使用VC ++的Visual Studio开发环境来编译Apache。为了简化此过程，可以使用Visual Studio工作区， <code>Apache.dsw</code>提供。该工作空间公开了整个工作清单<code>.dsp</code>完整的Apache二进制发行版所需的项目。它包括项目之间的依赖关系，以确保它们以适当的顺序构建。</p>

    <p>打开<code>Apache.dsw</code>工作区，然后选择<code>InstallBin</code> （ <code>Release</code>要么<code>Debug</code>根据需要进行构建）。 <code>InstallBin</code>导致所有相关项目被构建，然后调用<code>Makefile.win</code>移动已编译的可执行文件和dll。您可以个性化<code>INSTDIR=</code>通过改变选择<code>InstallBin</code>的设置，常规标签，构建命令行条目。 <code>INSTDIR</code>默认为<code>/Apache2</code>目录。如果您只想进行测试编译（无需安装），则可以构建<code>BuildBin</code>项目。</p>

    <p>的<code>.dsp</code>项目文件以Visual Studio 6.0（98）格式分发。Visual C ++ 5.0（97）将识别它们。Visual Studio 2002（.NET）和更高版本的用户必须进行转换<code>Apache.dsw</code>加上<code>.dsp</code>文件成<code>Apache.sln</code>加<code>.msproj</code>文件。确保您将<code>.msproj</code>如果其来源再次归档<code>.dsp</code>文件更改！这真的很简单，只是打开<code>Apache.dsw</code>再次在VC ++ 7.0 IDE中重新进行转换。</p>

    <div class="note">.dsp文件的.vcproj转换中存在缺陷。对于包含长引号/ D'efines且包含空格的RC标志，devenv.exe将误解析/ D标志。命令：<div class="example"><p><code>perl srclib\apr\build\cvtdsp.pl -2005</code></p></div>会将/ D标志转换为RC标志，以使用其他可解析语法；不幸的是，Visual Studio 97或其导出的.mak文件不支持此语法。这些/ D标志用于将对mod_apachemodule.so文件的详细说明传递到共享的.rc资源版本标识符版本。</div>

	<div class="note"><strong>使用OpenSSL 1.1.0及更高</strong>版本进行构建由于从版本1.1.0开始的OpenSSL的构建结构不同，您将需要将受cvtdsp.pl影响的dsp文件转换为APR 1.6或更高版本。命令：<div class="example"><p><code>perl srclib\apr\build\cvtdsp.pl -ossl11</code></p></div>
	</div>

    <p>Visual Studio 2002（.NET）和更高版本的用户还应该使用“生成”菜单，“配置管理器”对话框来取消选中<code>Debug</code>和<code>Release</code>解决方案模块<code>abs</code> ， <code class="module"><a href="../mod/mod_deflate.html">mod_deflate</a></code>和<code class="module"><a href="../mod/mod_ssl.html">mod_ssl</a></code>组件以及每个以开头的组件<code>apr_db*</code> 。这些模块是通过调用构建的<code>nmake</code> ，或直接使用IDE <code>BinBuild</code>目标，如果<code>srclib</code>目录<code>openssl</code>和/或<code>zlib</code>存在，并基于<code>DBD_LIST</code>和<code>DBM_LIST</code>环境变量。</p>

  

  <h3><a name="exportingmakfiles" id="exportingmakfiles">导出命令行.mak文件</a></h3>

    

    <p>已出口<code>.mak</code>文件带来了更大的麻烦，但是Visual C ++ 5.0用户需要它们来构建<code class="module"><a href="../mod/mod_ssl.html">mod_ssl</a></code> ，abs（ <code class="program"><a href="../programs/ab.html">ab</a></code>具有SSL支持）和/或<code class="module"><a href="../mod/mod_deflate.html">mod_deflate</a></code> 。.mak文件还支持更广泛的C ++工具链发行版，例如Visual Studio Express。</p>

    <p>您必须首先构建所有项目才能创建所有动态自动生成的目标，以便可以正确解析依赖项。使用以下命令从Visual Studio 6.0（98）IDE中构建整个项目。 <code>BuildAll</code>目标，然后对所有makefile使用“项目菜单导出”（检查“具有依赖项”。）运行以下命令以将绝对路径更正为相对路径，以便它们可以在任何地方构建：</p>

    <div class="example"><p><code>perl srclib\apr\build\fixwin32mak.pl</code></p></div>

    <p>您必须从httpd源树的<em>顶级</em>目录中键入此命令。每一个<code>.mak</code>和<code>.dep</code>当前目录及以下目录中的项目文件将被更正，并且时间戳将进行调整以反映<code>.dsp</code> 。</p>

    <p>始终查看生成的<code>.mak</code>和<code>.dep</code> Platform SDK的文件或其他本地的，计算机特定的文件路径。的<code>DevStudio\Common\MSDev98\bin\</code> （VC6）目录包含一个<code>sysincl.dat</code>文件，其中列出了所有例外。更新此文件（包括正斜杠路径和反斜杠路径，例如都<code>sys/time.h</code>和<code>sys\time.h</code> ）以忽略此类较新的依赖项。在分布式中包括本地安装路径<code>.mak</code>文件将导致构建完全失败。</p>

    <p>如果您提供修改项目文件的补丁，则我们必须以Visual Studio 6.0格式提交项目文件。更改应该很简单，并且所有Visual Studio环境都可以识别出最少的编译和链接标志。</p>

  

  <h3><a name="installation" id="installation">安装</a></h3>

    

    <p>编译Apache之后，需要将其安装在其服务器根目录中。默认为<code>\Apache2</code>同一驱动器的目录。</p>

    <p>要将所有文件自动生成并安装到所需的文件夹<em>目录中</em> ，请使用以下方法之一<code>nmake</code>命令：</p>

    <div class="example"><p><code>nmake /f Makefile.win installr INSTDIR=<em>dir</em><br> nmake /f Makefile.win installd INSTDIR=<em>dir</em></code></p></div>

    <p><em>dir</em>参数<code>INSTDIR</code>提供安装目录；如果要安装Apache，则可以省略<code>\Apache22</code> （当前驱动器的）。</p>

  

  <h3><a name="projectcomponents-warn" id="projectcomponents-warn">关于从开发树构建Apache的警告</a></h3>

    

    <div class="note">仅注意<code>.dsp</code>文件之间保持<code>release</code>建立。的<code>.mak</code>由于审阅者时间的巨大浪费，无法重新生成文件。因此，您不能依靠<code>NMAKE</code>以上命令构建修改<code>.dsp</code>项目文件，除非您随后全部导出<code>.mak</code>从项目中归档文件。如果您在Microsoft Developer Studio环境中进行构建，则没有必要。</div>

  
  </div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="cmake" id="cmake">用cmake构建httpd</a></h2>
  

  <p>该构建机制的主要文档位于<code>README.cmake</code>源分发中的文件。请参阅该文件以获取详细说明。</p>

  <p>使用cmake构建httpd需要分别构建APR和APR-util。参考他们<code>README.cmake</code>说明文件。</p>

  <p>基于cmake的构建的主要限制是从APR-util项目继承的，由于它们对httpd的影响，下面列出了这些限制：</p>

  <ul>
    <li>没有适用于APR-iconv子项目的cmake构建，并且APR-util cmake构建无法使用现有的APR-iconv构建。从而， <code class="module"><a href="../mod/mod_charset_lite.html">mod_charset_lite</a></code>可能无法使用某些第三方模块。</li>
    <li>APR-util子项目的cmake构建不支持所包含的Visual Studio项目文件支持的大多数可选DBM和DBD库。这限制了许多捆绑模块和第三方模块支持的数据库后端。</li>
  </ul>

  </div></div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>

</body></html>