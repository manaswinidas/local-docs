<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>apxs-APache eXtenSion工具-Apache HTTP Server版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body id="manual-page" ><div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="<-" alt="<-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> > <a href="http://httpd.apache.org/">HTTP服务器</a> > <a href="http://httpd.apache.org/docs/">文档</a> > <a href="../index.html">版本2.4</a> > <a href="./index.html">程序</a></div><div id="page-content"><div id="preamble"><h1>apxs-APache eXtenSion工具</h1>


    <p><code>apxs</code>是用于为Apache超文本传输协议（HTTP）服务器构建和安装扩展模块的工具。这是通过从一个或多个源或对象构建动态共享对象（DSO）来实现的<var>files</var>然后可以在运行时通过以下方式将其加载到Apache服务器中： <code class="directive"><a href="../mod/mod_so.html#loadmodule">LoadModule</a></code>来自的指令<code class="module"><a href="../mod/mod_so.html">mod_so</a></code> 。</p>

    <p>因此，要使用此扩展机制，您的平台必须支持DSO功能和Apache <code class="program"><a href="../programs/httpd.html">httpd</a></code>二进制文件必须使用<code class="module"><a href="../mod/mod_so.html">mod_so</a></code>模块。的<code>apxs</code>如果不是这种情况，工具会自动进行投诉。您可以通过手动运行命令自己检查</p>

    <div class="example"><p><code>$ httpd -l</code></p></div>

    <p>模块<code class="module"><a href="../mod/mod_so.html">mod_so</a></code>应该是显示列表的一部分。如果满足了这些要求，您可以借助DSO机制安装自己的模块，从而轻松扩展Apache服务器的功能。 <code>apxs</code>工具：</p>

    <div class="example"><p><code>$ apxs -i -a -c mod_foo.c<br> gcc -fpic -DSHARED_MODULE -I/path/to/apache/include -c mod_foo.c<br> ld -Bshareable -o mod_foo.so mod_foo.o<br> cp mod_foo.so /path/to/apache/modules/mod_foo.so<br> chmod 755 /path/to/apache/modules/mod_foo.so<br> [activating module `foo' in /path/to/apache/etc/httpd.conf]<br> $ apachectl restart<br> /path/to/apache/sbin/apachectl restart: httpd not running, trying to start<br> [Tue Mar 31 11:27:55 1998] [debug] mod_so.c(303): loaded module foo_module<br> /path/to/apache/sbin/apachectl restart: httpd started<br> $ _</code></p></div>

    <p>论点<var>files</var>可以是任何C源文件（.c），目标文件（.o）甚至库归档文件（.a）。的<code>apxs</code>该工具会自动识别这些扩展名，并自动将C源文件用于编译，而仅将对象文件和归档文件用于链接阶段。但是，当使用此类预编译对象时，请确保将其编译为位置无关代码（PIC），以便能够将其用于动态加载的共享对象。例如，对于GCC，您始终只需要使用<code>-fpic</code> 。对于其他C编译器，请查阅其手册页或关注标志<code>apxs</code>用于编译目标文件。</p>

    <p>有关Apache中DSO支持的更多详细信息，请阅读以下文档： <code class="module"><a href="../mod/mod_so.html">mod_so</a></code>甚至阅读<code>src/modules/standard/mod_so.c</code>源文件。</p>
</div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><ul id="toc"><li><img alt="" src="../images/down.gif"> <a href="#synopsis">概要</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#options">选件</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#examples">例子</a></li>
</ul><h3>也可以看看</h3><ul class="seealso"><li><code class="program"><a href="../programs/apachectl.html">apachectl</a></code></li><li><code class="program"><a href="../programs/httpd.html">httpd</a></code></li></ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="synopsis" id="synopsis">概要</a></h2>
    <p><code><strong>apxs</strong> -<strong>g</strong> [ -<strong>S</strong> <var>name</var>=<var>value</var> ] -<strong>n</strong> <var>modname</var></code></p>

    <p><code><strong>apxs</strong> -<strong>q</strong> [ -<strong>v</strong> ] [ -<strong>S</strong> <var>name</var>=<var>value</var> ] <var>query</var> ...</code></p>

    <p><code><strong>apxs</strong> -<strong>c</strong> [ -<strong>S</strong> <var>name</var>=<var>value</var> ] [ -<strong>o</strong> <var>dsofile</var> ] [ -<strong>I</strong> <var>incdir</var> ] [ -<strong>D</strong> <var>name</var>=<var>value</var> ] [ -<strong>L</strong> <var>libdir</var> ] [ -<strong>l</strong> <var>libname</var> ] [ -<strong>Wc,</strong><var>compiler-flags</var> ] [ -<strong>Wl,</strong><var>linker-flags</var> ] <var>files</var> ...</code></p>

    <p><code><strong>apxs</strong> -<strong>i</strong> [ -<strong>S</strong> <var>name</var>=<var>value</var> ] [ -<strong>n</strong> <var>modname</var> ] [ -<strong>a</strong> ] [ -<strong>A</strong> ] <var>dso-file</var> ...</code></p>

    <p><code><strong>apxs</strong> -<strong>e</strong> [ -<strong>S</strong> <var>name</var>=<var>value</var> ] [ -<strong>n</strong> <var>modname</var> ] [ -<strong>a</strong> ] [ -<strong>A</strong> ] <var>dso-file</var> ...</code></p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="options" id="options">选件</a></h2>
    <h3><a name="options.common" id="options.common">常用选项</a></h3>
      <dl>
      <dt><code>-n <var>modname</var></code></dt>
      <dd>这将显式设置模块名称<code>-i</code> （安装）并<code>-g</code> （模板生成）选项。使用它来显式指定模块名称。对于选项<code>-g</code>这是必需的，以供选择<code>-i</code>的<code>apxs</code>工具会尝试从源文件中确定名称，或者至少通过从文件名中猜测来作为后备名称。</dd>
      </dl>
    

    <h3><a name="options.query" id="options.query">查询选项</a></h3>
      <dl>
      <dt><code>-q</code></dt>
      <dd>查询用于构建的变量和环境设置<code>httpd</code> 。不带时调用<var>query</var>参数，它会打印所有已知变量及其值。可选的<code>-v</code>参数格式化列表输出。

      <p>使用它来手动确定用于构建<code>httpd</code>这将加载您的模块。例如使用</p>
      <div class="example"><p><code>INC=-I`apxs -q INCLUDEDIR`</code></p></div>

      <p>如果您需要手动访问Apache的C头文件，请在自己的Makefile中使用。</p></dd>
      </dl>
    

    <h3><a name="options.conf" id="options.conf">配置选项</a></h3>
      <dl>
      <dt><code>-S <var>name</var>=<var>value</var></code></dt>
      <dd>此选项更改上述apxs设置。</dd>
      </dl>
    

    <h3><a name="options.template" id="options.template">模板生成选项</a></h3>
      <dl>
      <dt><code>-g</code></dt>
      <dd>这将生成一个子目录<var>name</var> （请参阅选项<code>-n</code> ）和两个文件：名为的示例模块源文件<code>mod_<var>name</var>.c</code>可以用作创建自己的模块的模板，也可以用作使用apxs机制的快速入门。和一个对应的<code>Makefile</code>以便更轻松地构建和安装此模块。</dd>
      </dl>
    

    <h3><a name="options.dso" id="options.dso">DSO编译选项</a></h3>
      <dl>
      <dt><code>-c</code></dt>
      <dd>这表示编译操作。它首先编译C的C源文件（.c） <var>files</var>放入相应的对象文件（.o），然后在其中建立动态共享的对象<var>dsofile</var>通过链接这些目标文件以及其余的目标文件（.o和.a） <var>files</var> 。如果不<code>-o</code>指定了选项，从中的第一个文件名猜测输出文件<var>files</var>因此通常默认为<code>mod_<var>name</var>.so</code> 。</dd>

      <dt><code>-o <var>dsofile</var></code></dt>
      <dd>明确指定创建的动态共享对象的文件名。如果未指定，则无法从<var>files</var>清单，后备名称<code>mod_unknown.so</code>用来。</dd>

      <dt><code>-D <var>name</var>=<var>value</var></code></dt>
      <dd>此选项直接传递给编译命令。使用它可以在构建过程中添加自己的定义。</dd>

      <dt><code>-I <var>incdir</var></code></dt>
      <dd>此选项直接传递给编译命令。使用它来添加您自己的包含目录以搜索到构建过程。</dd>

      <dt><code>-L <var>libdir</var></code></dt>
      <dd>此选项直接传递给链接器命令。使用它来添加您自己的库目录以搜索到构建过程。</dd>

      <dt><code>-l <var>libname</var></code></dt>
      <dd>此选项直接传递给链接器命令。使用它来添加您自己的库以搜索到构建过程。</dd>

      <dt><code>-Wc,<var>compiler-flags</var></code></dt>
      <dd>该选项通过<var>compiler-flags</var>作为附加标志<code>libtool --mode=compile</code>命令。使用此选项可添加特定于本地编译器的选项。</dd>

      <dt><code>-Wl,<var>linker-flags</var></code></dt>
      <dd>该选项通过<var>linker-flags</var>作为附加标志<code>libtool --mode=link</code>命令。使用它来添加特定于本地链接器的选项。</dd>

      <dt><code>-p</code></dt>
      <dd>此选项使apxs链接到apr / apr-util库。在编译使用apr / apr-util库的帮助程序时，这很有用。</dd>
      </dl>
    

    <h3><a name="options.dsoinstall" id="options.dsoinstall">DSO安装和配置选项</a></h3>
    
      <dl>
      <dt><code>-i</code></dt>
      <dd>这表示安装操作，并将一个或多个动态共享的对象安装到服务器的<var>modules</var>目录。</dd>

      <dt><code>-a</code></dt>
      <dd>这会通过自动添加相应的<code class="directive"><a href="../mod/mod_so.html#loadmodule">LoadModule</a></code>符合Apache的<code>httpd.conf</code>配置文件，或者如果已存在则启用它。</dd>

      <dt><code>-A</code></dt>
      <dd>与选项相同<code>-a</code>但是创造的<code class="directive"><a href="../mod/mod_so.html#loadmodule">LoadModule</a></code>指令以井号（ <code>#</code> ）， <em>即</em>模块只是为以后的激活做准备，但最初被禁用。</dd>

      <dt><code>-e</code></dt>
      <dd>这表示编辑操作，可以与<code>-a</code>和<code>-A</code>选项类似于<code>-i</code>编辑Apache的操作<code>httpd.conf</code>配置文件，而无需尝试安装模块。</dd>
      </dl>
    
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="examples" id="examples">例子</a></h2>
    <p>假设您有一个名为的Apache模块<code>mod_foo.c</code>可用，这应该扩展Apache的服务器功能。为此，您首先必须通过以下命令将C源代码编译成适合于在运行时加载到Apache服务器中的共享库：</p>

    <div class="example"><p><code>$ apxs -c mod_foo.c<br> /path/to/libtool --mode=compile gcc ... -c mod_foo.c<br> /path/to/libtool --mode=link gcc ... -o mod_foo.la mod_foo.slo<br> $ _</code></p></div>

    <p>然后，您必须通过确保以下内容来更新Apache配置： <code class="directive"><a href="../mod/mod_so.html#loadmodule">LoadModule</a></code>存在指令以加载此共享库。为了简化此步骤<code>apxs</code>提供了一种自动方法来将共享库安装在其“模块”目录中并更新<code>httpd.conf</code>相应地归档。这可以通过运行：</p>

    <div class="example"><p><code>$ apxs -i -a mod_foo.la<br> /path/to/instdso.sh mod_foo.la /path/to/apache/modules<br> /path/to/libtool --mode=install cp mod_foo.la /path/to/apache/modules ... chmod 755 /path/to/apache/modules/mod_foo.so<br> [activating module `foo' in /path/to/apache/conf/httpd.conf]<br> $ _</code></p></div>

    <p>这样一条线叫</p>

    <div class="example"><p><code>LoadModule foo_module modules/mod_foo.so</code></p></div>

    <p>如果仍然不存在，则会将其添加到配置文件。如果您希望默认禁用此功能，请使用<code>-A</code>选项， <em>即</em></p>

    <div class="example"><p><code>$ apxs -i -A mod_foo.c</code></p></div>

    <p>为了快速测试apxs机制，您可以通过以下步骤创建示例Apache模块模板以及相应的Makefile：</p>

    <div class="example"><p><code>$ apxs -g -n foo<br> Creating [DIR] foo<br> Creating [FILE] foo/Makefile<br> Creating [FILE] foo/modules.mk<br> Creating [FILE] foo/mod_foo.c<br> Creating [FILE] foo/.deps<br> $ _</code></p></div>

    <p>然后，您可以立即将此示例模块编译为共享对象，并将其加载到Apache服务器中：</p>

    <div class="example"><p><code>$ cd foo<br> $ make all reload<br> apxs -c mod_foo.c<br> /path/to/libtool --mode=compile gcc ... -c mod_foo.c<br> /path/to/libtool --mode=link gcc ... -o mod_foo.la mod_foo.slo<br> apxs -i -a -n "foo" mod_foo.la<br> /path/to/instdso.sh mod_foo.la /path/to/apache/modules<br> /path/to/libtool --mode=install cp mod_foo.la /path/to/apache/modules ... chmod 755 /path/to/apache/modules/mod_foo.so<br> [activating module `foo' in /path/to/apache/conf/httpd.conf]<br> apachectl restart<br> /path/to/apache/sbin/apachectl restart: httpd not running, trying to start<br> [Tue Mar 31 11:27:55 1998] [debug] mod_so.c(303): loaded module foo_module<br> /path/to/apache/sbin/apachectl restart: httpd started<br> $ _</code></p></div>

</div></div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>

</body></html>