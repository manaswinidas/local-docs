<html lang="zh-Hans"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type">
<title>基于名称的虚拟主机支持-Apache HTTP Server版本2.4</title>
<link href="../style/css/manual-zip.css" rel="stylesheet" type="text/css" title="Main stylesheet" media="all">
<link href="../style/css/manual-zip-100pc.css" rel="alternate stylesheet" type="text/css" title="No Sidebar - Default font size" media="all">
<link href="../style/css/manual-print.css" rel="stylesheet" type="text/css" media="print"><link rel="stylesheet" type="text/css" href="../style/css/prettify.css">
<script src="../style/scripts/prettify.min.js" type="text/javascript">
</script>
</head>
<body id="manual-page" ><div id="page-header">
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p>
<p class="apache">Apache HTTP服务器版本2.4</p>
<img alt="" src="../images/feather.png"></div>
<div class="up"><a href="./index.html"><img title="<-" alt="<-" src="../images/left.gif"></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> > <a href="http://httpd.apache.org/">HTTP服务器</a> > <a href="http://httpd.apache.org/docs/">文档</a> > <a href="../index.html">版本2.4</a> > <a href="./index.html">虚拟主机</a></div><div id="page-content"><div id="preamble"><h1>基于名称的虚拟主机支持</h1>


    <p>本文档介绍了何时以及如何使用基于名称的虚拟主机。</p>
</div>
<div id="quickview"><a href="https://www.apache.org/foundation/contributing.html" class="badge"><img src="https://www.apache.org/images/SupportApache-small.png" alt="支持Apache！"></a><ul id="toc"><li><img alt="" src="../images/down.gif"> <a href="#namevip">基于名称和基于IP的虚拟主机</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#alg">服务器如何选择适当的基于名称的虚拟主机</a></li>
<li><img alt="" src="../images/down.gif"> <a href="#using">使用基于名称的虚拟主机</a></li>
</ul><h3>也可以看看</h3><ul class="seealso"><li><a href="ip-based.html">基于IP的虚拟主机支持</a></li><li><a href="details.html">虚拟主机匹配的深入讨论</a></li><li><a href="mass.html">动态配置的大规模虚拟主机</a></li><li><a href="examples.html">常见设置的虚拟主机示例</a></li></ul></div>
<div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="namevip" id="namevip">基于名称和基于IP的虚拟主机</a></h2>

    <p><a href="ip-based.html">基于IP的虚拟主机</a>使用连接的IP地址来确定要服务的正确虚拟主机。因此，每个主机都需要有一个单独的IP地址。</p>

    <p>使用基于名称的虚拟主机时，服务器依靠客户端将主机名报告为HTTP标头的一部分。使用此技术，许多不同的主机可以共享相同的IP地址。</p>

    <p>基于名称的虚拟主机通常更简单，因为您只需要配置DNS服务器以将每个主机名映射到正确的IP地址，然后配置Apache HTTP Server即可识别不同的主机名。基于名称的虚拟主机还可以缓解对稀缺IP地址的需求。因此，除非您使用的设备明确要求基于IP的托管，否则应使用基于名称的虚拟托管。基于客户端支持的基于IP的虚拟托管的历史原因不再适用于通用Web服务器。</p>

    <p>基于名称的虚拟主机建立在基于IP的虚拟主机选择算法的基础之上，这意味着仅在具有最佳基于IP的地址的虚拟主机之间才搜索正确的服务器名称。</p>

</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="alg" id="alg">服务器如何选择适当的基于名称的虚拟主机</a></h2>

    <p>必须认识到，基于名称的虚拟主机解析的第一步是基于IP的解析。基于名称的虚拟主机解析仅在将候选范围缩小到最佳的基于IP的匹配之后才选择最合适的基于名称的虚拟主机。在所有VirtualHost伪指令中对IP地址使用通配符（*），使基于IP的映射无关紧要。</p>

    <p>当请求到达时，服务器将找到最佳（最特定）匹配项<code class="directive"><a href="../mod/core.html#virtualhost"><VirtualHost></a></code>参数基于请求使用的IP地址和端口。如果有多个包含此最佳匹配地址和端口组合的虚拟主机，Apache将进一步比较<code class="directive"><a href="../mod/core.html#servername">ServerName</a></code>和<code class="directive"><a href="../mod/core.html#serveralias">ServerAlias</a></code>请求中存在的服务器名称的指令。</p>

    <p>如果您省略<code class="directive"><a href="../mod/core.html#servername">ServerName</a></code>如果从任何基于名称的虚拟主机发出指令，则服务器将默认为从系统主机名派生的标准域名（FQDN）。隐式设置的服务器名称可能导致虚拟主机匹配违反直觉，因此不建议使用。</p>
 
    <h3><a name="defaultvhost" id="defaultvhost">IP和端口组合的默认基于名称的虚拟主机</a></h3>
    <p>如果在包含最特定的匹配IP地址和端口组合的虚拟主机集中未找到匹配的ServerName或ServerAlias，则将使用将与之匹配<strong>的第一个列出的虚拟主机</strong> 。</p>
</div><div class="top"><a href="#page-header"><img alt="最佳" src="../images/up.gif"></a></div>
<div class="section">
<h2><a name="using" id="using">使用基于名称的虚拟主机</a></h2>

<table class="related"><tbody><tr><th>相关模块</th><th>相关指令</th></tr><tr><td><ul><li><code class="module"><a href="../mod/core.html">core</a></code></li></ul></td><td><ul><li><code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code></li><li><code class="directive"><a href="../mod/core.html#serveralias">ServerAlias</a></code></li><li><code class="directive"><a href="../mod/core.html#servername">ServerName</a></code></li><li><code class="directive"><a href="../mod/core.html#virtualhost"><VirtualHost></a></code></li></ul></td></tr></tbody></table>

    <p>第一步是创建一个<code class="directive"><a href="../mod/core.html#virtualhost"><VirtualHost></a></code>屏蔽您要服务的每个不同的主机。里面每个<code class="directive"><a href="../mod/core.html#virtualhost"><VirtualHost></a></code>块，您至少需要一个<code class="directive"><a href="../mod/core.html#servername">ServerName</a></code>指令指定要服务的主机和<code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code>指令以显示该主机的内容在文件系统中的何处。</p>

    <div class="note"><h3>主主机消失</h3>
        <p>任何与现有不匹配的请求<code class="directive"><a href="../mod/core.html#virtualhost"><VirtualHost></a></code>由全局服务器配置处理，而不管主机名还是ServerName。</p>

        <p>当您将基于名称的虚拟主机添加到现有服务器时，并且虚拟主机参数匹配预先存在的IP和端口组合时，请求现在将由显式虚拟主机处理。在这种情况下，它通常是明智的做法是创建一个<a href="#defaultvhost">默认的虚拟主机</a>用<code class="directive"><a href="../mod/core.html#servername">ServerName</a></code>与基础服务器匹配。然后可以将同一接口和端口上的新域，但需要单独配置，添加为后续（非默认）虚拟主机。</p>
    </div>

    <div class="note"><h3>ServerName继承</h3>
       <p>最好始终明确列出<code class="directive"><a href="../mod/core.html#servername">ServerName</a></code>在每个基于名称的虚拟主机中。</p>
       <p>如果一个<code class="directive"><a href="../mod/core.html#virtualhost">VirtualHost</a></code>没有指定<code class="directive"><a href="../mod/core.html#servername">ServerName</a></code> ，服务器名称将从基本服务器配置中继承。如果未全局指定任何服务器名称，则在启动时会通过第一个侦听地址的反向DNS解析检测到服务器名称。无论哪种情况，此继承的服务器名称都会影响基于名称的虚拟主机解析，因此最好始终显式列出一个<code class="directive"><a href="../mod/core.html#servername">ServerName</a></code>在每个基于名称的虚拟主机中。</p>
    </div>

    <p>例如，假设您正在提供域<code>www.example.com</code>并且您希望添加虚拟主机<code>other.example.com</code> ，它指向相同的IP地址。然后，您只需将以下内容添加到<code>httpd.conf</code> ：</p>

    <pre class="prettyprint lang-config">&lt;VirtualHost *:80&gt;
    # This first-listed virtual host is also the default for *:80
    ServerName www.example.com
    ServerAlias example.com 
    DocumentRoot "/www/domain"
&lt;/VirtualHost&gt;

&lt;VirtualHost *:80&gt;
    ServerName other.example.com
    DocumentRoot "/www/otherdomain"
&lt;/VirtualHost&gt;</pre>


    <p>您也可以指定一个明确的IP地址来代替<code>*</code>在<code class="directive"><a href="../mod/core.html#virtualhost"><VirtualHost></a></code>指令。例如，您可能想执行此操作，以便在一个IP地址上运行某些基于名称的虚拟主机，而在另一个地址上运行基于IP的或另一组基于名称的虚拟主机。</p>

    <p>许多服务器希望通过多个名称进行访问。这是可能的<code class="directive"><a href="../mod/core.html#serveralias">ServerAlias</a></code>指令，放在<code class="directive"><a href="../mod/core.html#virtualhost"><VirtualHost></a></code>部分。例如在第一个<code class="directive"><a href="../mod/core.html#virtualhost"><VirtualHost></a></code>上面的块<code class="directive"><a href="../mod/core.html#serveralias">ServerAlias</a></code>指令指示列出的名称是其他人可以用来查看同一网站的名称：</p>

    <pre class="prettyprint lang-config">ServerAlias example.com *.example.com</pre>


    <p>然后请求<code>example.com</code>域将由<code>www.example.com</code>虚拟主机。通配符<code>*</code>和<code>?</code>可用于匹配名称。当然，您不能只是编造名称并将其放置在<code class="directive"><a href="../mod/core.html#servername">ServerName</a></code>要么<code>ServerAlias</code> 。首先，必须正确配置DNS服务器，以将这些名称映射到与服务器关联的IP地址。</p>

    <p>基于名称的虚拟主机，用于最匹配的一组<code class="directive"><a href="../mod/core.html#virtualhost"><virtualhost></a></code>按照它们在配置中出现的顺序进行处理。第一次匹配<code class="directive"><a href="../mod/core.html#servername">ServerName</a></code>要么<code class="directive"><a href="../mod/core.html#serveralias">ServerAlias</a></code>使用，通配符的优先级没有不同（ServerName和ServerAlias也不相同）。</p>

    <p>名称中的完整列表<code class="directive"><a href="../mod/core.html#virtualhost">VirtualHost</a></code>指令被视为（非通配符） <code class="directive"><a href="../mod/core.html#serveralias">ServerAlias</a></code> 。</p>

    <p>最后，您可以通过在虚拟主机中放置其他指令来微调虚拟主机的配置。 <code class="directive"><a href="../mod/core.html#virtualhost"><VirtualHost></a></code>容器。大部分指令可以放在这些容器中，然后仅更改相关虚拟主机的配置。要了解是否允许使用特定指令，请检查指令的<a href="../mod/directive-dict.html#Context">上下文</a> 。在<em>主服务器上下文中</em>设置的配置指令（在任何外部） <code class="directive"><a href="../mod/core.html#virtualhost"><VirtualHost></a></code>容器）将仅在虚拟主机设置未覆盖它们的情况下使用。</p>

</div></div>
<div id="footer">
<p class="apache">版权所有2018 The Apache Software Foundation。<br>根据<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache许可，版本2.0许可</a> 。</p>
<p class="menu"><a href="../mod/index.html">模块</a> | <a href="../mod/directives.html">指令</a> | <a href="http://wiki.apache.org/httpd/FAQ">常见问题</a> | <a href="../glossary.html">词汇表</a> | <a href="../sitemap.html">网站地图</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>

</body></html>