<html class="no-js" ><!--<![endif]--><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>快速入门-Spark 2.4.4文档</title>
        
          <meta name="description" content="Quick start tutorial for Spark 2.4.4">
        

        

        <link rel="stylesheet" href="css/bootstrap.min.css">
        <style>
            body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
        </style>
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="css/bootstrap-responsive.min.css">
        <link rel="stylesheet" href="css/main.css">

        <script src="js/vendor/modernizr-2.6.1-respond-1.1.0.min.js"></script>

        <link rel="stylesheet" href="css/pygments-default.css">

        
        <!-- Google analytics script -->
        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-32518208-2']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>
        

    </head>
    <body >
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="https://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

        <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

        <div class="navbar navbar-fixed-top" id="topbar">
            <div class="navbar-inner">
                <div class="container">
                    <div class="brand"><a href="index.html"><img src="img/spark-logo-hd.png" style="height:50px"></a> <span class="version">2.4.4</span>
                    </div>
                    <ul class="nav">
                        <!--TODO(andyk): Add class="active" attribute to li some how.-->
                        <li><a href="index.html">总览</a></li>

                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">编程指南<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="quick-start.html">快速开始</a></li>
                                <li><a href="rdd-programming-guide.html">RDD，累加器，广播变量</a></li>
                                <li><a href="sql-programming-guide.html">SQL，数据框和数据集</a></li>
                                <li><a href="structured-streaming-programming-guide.html">结构化流</a></li>
                                <li><a href="streaming-programming-guide.html">火花流（DStreams）</a></li>
                                <li><a href="ml-guide.html">MLlib（机器学习）</a></li>
                                <li><a href="graphx-programming-guide.html">GraphX（图形处理）</a></li>
                                <li><a href="sparkr.html">SparkR（Spark上的R）</a></li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">API文件<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="api/scala/index.html#org.apache.spark.package">斯卡拉</a></li>
                                <li><a href="api/java/index.html">爪哇</a></li>
                                <li><a href="api/python/index.html">蟒蛇</a></li>
                                <li><a href="api/R/index.html">[R</a></li>
                                <li><a href="api/sql/index.html">SQL，内置函数</a></li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">部署中<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="cluster-overview.html">总览</a></li>
                                <li><a href="submitting-applications.html">提交申请</a></li>
                                <li class="divider"></li>
                                <li><a href="spark-standalone.html">Spark独立</a></li>
                                <li><a href="running-on-mesos.html">梅索斯</a></li>
                                <li><a href="running-on-yarn.html">纱</a></li>
                                <li><a href="running-on-kubernetes.html">Kubernetes</a></li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a href="api.html" class="dropdown-toggle" data-toggle="dropdown">更多<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="configuration.html">组态</a></li>
                                <li><a href="monitoring.html">监控方式</a></li>
                                <li><a href="tuning.html">调音指南</a></li>
                                <li><a href="job-scheduling.html">作业调度</a></li>
                                <li><a href="security.html">安全</a></li>
                                <li><a href="hardware-provisioning.html">硬件配置</a></li>
                                <li class="divider"></li>
                                <li><a href="building-spark.html">建筑火花</a></li>
                                <li><a href="https://spark.apache.org/contributing.html">为Spark贡献</a></li>
                                <li><a href="https://spark.apache.org/third-party-projects.html">第三方项目</a></li>
                            </ul>
                        </li>
                    </ul>
                    <!--<p class="navbar-text pull-right"><span class="version-text">v2.4.4</span></p>-->
                </div>
            </div>
        </div>

        <div class="container-wrapper">

            
                <div class="content" id="content">
                    
                        <h1 class="title">快速开始</h1>
                    

                    <ul id="markdown-toc">
  <li><a href="#security" id="markdown-toc-security">安全</a></li>
  <li><a href="#interactive-analysis-with-the-spark-shell" id="markdown-toc-interactive-analysis-with-the-spark-shell">使用Spark Shell进行交互式分析</a>    <ul>
      <li><a href="#basics" id="markdown-toc-basics">基本</a></li>
      <li><a href="#more-on-dataset-operations" id="markdown-toc-more-on-dataset-operations">有关数据集操作的更多信息</a></li>
      <li><a href="#caching" id="markdown-toc-caching">快取</a></li>
    </ul>
  </li>
  <li><a href="#self-contained-applications" id="markdown-toc-self-contained-applications">自包含的应用程序</a></li>
  <li><a href="#where-to-go-from-here" id="markdown-toc-where-to-go-from-here">从这往哪儿走</a></li>
</ul>

<p>本教程提供了使用Spark的快速介绍。我们将首先通过Spark的交互式外壳（在Python或Scala中）介绍API，然后展示如何用Java，Scala和Python编写应用程序。</p>

<p>要遵循本指南，请首先从<a href="https://spark.apache.org/downloads.html">Spark网站</a>下载Spark的打包版本。由于我们不会使用HDFS，因此您可以下载适用于任何版本Hadoop的软件包。</p>

<p>请注意，在Spark 2.0之前，Spark的主要编程接口是弹性分布式数据集（RDD）。在Spark 2.0之后，RDD被Dataset取代，Dataset的类型像RDD一样强，但在后台进行了更丰富的优化。仍支持RDD界面，您可以在<a href="rdd-programming-guide.html">RDD编程指南中</a>获得更详细的参考。但是，我们强烈建议您切换到使用数据集，该数据集的性能比RDD更好。请参阅《 <a href="sql-programming-guide.html">SQL编程指南》</a>以获取有关数据集的更多信息。</p>

<h1 id="security">安全</h1>

<p>默认情况下，Spark中的安全性处于关闭状态。这可能意味着您默认情况下容易受到攻击。运行Spark之前，请参阅<a href="security.html">Spark Security</a> 。</p>

<h1 id="interactive-analysis-with-the-spark-shell">使用Spark Shell进行交互式分析</h1>

<h2 id="basics">基本</h2>

<p>Spark的外壳提供了学习API的简单方法，以及强大的工具来交互式地分析数据。它可以在Scala（可在Java VM上运行，因此是使用现有Java库的好方法）或Python中提供。通过在Spark目录中运行以下命令来启动它：</p>

<div class="codetabs">
<div data-lang="scala">

    <pre><code>./bin/spark-shell
</code></pre>

    <p>Spark的主要抽象是称为数据集的项目的分布式集合。可以从Hadoop InputFormats（例如HDFS文件）或通过转换其他数据集来创建数据集。让我们从Spark源目录中的README文件的文本中创建一个新的数据集：</p>

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span></span><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">textFile</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">textFile</span><span class="o">(</span><span class="s">&quot;README.md&quot;</span><span class="o">)</span>
<span class="n">textFile</span><span class="k">:</span> <span class="kt">org.apache.spark.sql.Dataset</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">[</span><span class="kt">value:</span> <span class="kt">string</span><span class="o">]</span></code></pre></figure>

    <p>您可以通过调用某些操作直接从数据集中获取值，或转换数据集以获取新值。有关更多详细信息，请阅读<em><a href="api/scala/index.html#org.apache.spark.sql.Dataset">API文档</a></em> 。</p>

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span></span><span class="n">scala</span><span class="o">&gt;</span> <span class="n">textFile</span><span class="o">.</span><span class="n">count</span><span class="o">()</span> <span class="c1">// Number of items in this Dataset</span>
<span class="n">res0</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">126</span> <span class="c1">// May be different from yours as README.md will change over time, similar to other outputs</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">textFile</span><span class="o">.</span><span class="n">first</span><span class="o">()</span> <span class="c1">// First item in this Dataset</span>
<span class="n">res1</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="k">#</span> <span class="nc">Apache</span> <span class="nc">Spark</span></code></pre></figure>

    <p>现在，让我们将此数据集转换为新的数据集。我们称之为<code>filter</code>返回带有文件项的子集的新数据集。</p>

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span></span><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">linesWithSpark</span> <span class="k">=</span> <span class="n">textFile</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="n">line</span> <span class="k">=&gt;</span> <span class="n">line</span><span class="o">.</span><span class="n">contains</span><span class="o">(</span><span class="s">&quot;Spark&quot;</span><span class="o">))</span>
<span class="n">linesWithSpark</span><span class="k">:</span> <span class="kt">org.apache.spark.sql.Dataset</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">[</span><span class="kt">value:</span> <span class="kt">string</span><span class="o">]</span></code></pre></figure>

    <p>我们可以将转换和动作链接在一起：</p>

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span></span><span class="n">scala</span><span class="o">&gt;</span> <span class="n">textFile</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="n">line</span> <span class="k">=&gt;</span> <span class="n">line</span><span class="o">.</span><span class="n">contains</span><span class="o">(</span><span class="s">&quot;Spark&quot;</span><span class="o">)).</span><span class="n">count</span><span class="o">()</span> <span class="c1">// How many lines contain &quot;Spark&quot;?</span>
<span class="n">res3</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">15</span></code></pre></figure>

  </div>
<div data-lang="python">

    <pre><code>./bin/pyspark
</code></pre>

    <p>或者，如果在当前环境中PySpark与pip一起安装：</p>

    <pre><code>pyspark
</code></pre>

    <p>Spark的主要抽象是称为数据集的项目的分布式集合。可以从Hadoop InputFormats（例如HDFS文件）或通过转换其他数据集来创建数据集。由于Python的动态性质，我们不需要在Python中对数据集进行强类型化。结果，Python中的所有数据集都是Dataset [Row]，我们称之为<code>DataFrame</code>与Pandas和R中的数据框架概念一致。让我们从Spark源目录中的README文件的文本中创建一个新的DataFrame：</p>

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">textFile</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;README.md&quot;</span><span class="p">)</span></code></pre></figure>

    <p>您可以通过调用一些操作直接从DataFrame中获取值，或转换DataFrame以获取新的值。有关更多详细信息，请阅读<em><a href="api/python/index.html#pyspark.sql.DataFrame">API文档</a></em> 。</p>

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">textFile</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>  <span class="c1"># Number of rows in this DataFrame</span>
<span class="mi">126</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">textFile</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>  <span class="c1"># First row in this DataFrame</span>
<span class="n">Row</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;# Apache Spark&#39;</span><span class="p">)</span></code></pre></figure>

    <p>现在，让我们将此DataFrame转换为一个新的。我们称之为<code>filter</code>返回一个新的DataFrame以及文件中行的子集。</p>

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">linesWithSpark</span> <span class="o">=</span> <span class="n">textFile</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">textFile</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Spark&quot;</span><span class="p">))</span></code></pre></figure>

    <p>我们可以将转换和动作链接在一起：</p>

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">textFile</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">textFile</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;Spark&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>  <span class="c1"># How many lines contain &quot;Spark&quot;?</span>
<span class="mi">15</span></code></pre></figure>

  </div>
</div>

<h2 id="more-on-dataset-operations">有关数据集操作的更多信息</h2>
<p>数据集操作和转换可用于更复杂的计算。假设我们要查找包含最多单词的行：</p>

<div class="codetabs">
<div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span></span><span class="n">scala</span><span class="o">&gt;</span> <span class="n">textFile</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">line</span> <span class="k">=&gt;</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="o">(</span><span class="s">&quot; &quot;</span><span class="o">).</span><span class="n">size</span><span class="o">).</span><span class="n">reduce</span><span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="k">if</span> <span class="o">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="o">)</span> <span class="n">a</span> <span class="k">else</span> <span class="n">b</span><span class="o">)</span>
<span class="n">res4</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">15</span></code></pre></figure>

    <p>首先，将一条线映射到一个整数值，以创建一个新的数据集。 <code>reduce</code>在该数据集上调用，以找到最大的字数。的论点<code>map</code>和<code>reduce</code>是Scala函数文字（闭包），可以使用任何语言功能或Scala / Java库。例如，我们可以轻松地调用在其他地方声明的函数。我们将使用<code>Math.max()</code>使此代码更易于理解的函数：</p>

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span></span><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">java.lang.Math</span>
<span class="k">import</span> <span class="nn">java.lang.Math</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">textFile</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">line</span> <span class="k">=&gt;</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="o">(</span><span class="s">&quot; &quot;</span><span class="o">).</span><span class="n">size</span><span class="o">).</span><span class="n">reduce</span><span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Math</span><span class="o">.</span><span class="n">max</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">))</span>
<span class="n">res5</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">15</span></code></pre></figure>

    <p>一种常见的数据流模式是Hadoop流行的MapReduce。Spark可以轻松实现MapReduce流：</p>

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span></span><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">wordCounts</span> <span class="k">=</span> <span class="n">textFile</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">line</span> <span class="k">=&gt;</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="o">(</span><span class="s">&quot; &quot;</span><span class="o">)).</span><span class="n">groupByKey</span><span class="o">(</span><span class="n">identity</span><span class="o">).</span><span class="n">count</span><span class="o">()</span>
<span class="n">wordCounts</span><span class="k">:</span> <span class="kt">org.apache.spark.sql.Dataset</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Long</span><span class="o">)]</span> <span class="k">=</span> <span class="o">[</span><span class="kt">value:</span> <span class="kt">string</span>, <span class="kt">count</span><span class="o">(</span><span class="err">1</span><span class="o">)</span><span class="kt">:</span> <span class="kt">bigint</span><span class="o">]</span></code></pre></figure>

    <p>在这里，我们打电话<code>flatMap</code>将线的数据集转换为单词的数据集，然后组合<code>groupByKey</code>和<code>count</code>以将文件中的每个单词计数计算为（字符串，长整数）对的数据集。要收集外壳中的字数，我们可以调用<code>collect</code> ：</p>

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span></span><span class="n">scala</span><span class="o">&gt;</span> <span class="n">wordCounts</span><span class="o">.</span><span class="n">collect</span><span class="o">()</span>
<span class="n">res6</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">((</span><span class="n">means</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="n">under</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="k">this</span><span class="o">,</span><span class="mi">3</span><span class="o">),</span> <span class="o">(</span><span class="nc">Because</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="nc">Python</span><span class="o">,</span><span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="n">agree</span><span class="o">,</span><span class="mi">1</span><span class="o">),</span> <span class="o">(</span><span class="n">cluster</span><span class="o">.,</span><span class="mi">1</span><span class="o">),</span> <span class="o">...)</span></code></pre></figure>

  </div>
<div data-lang="python">

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">textFile</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">textFile</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;\s+&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s2">&quot;numWords&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;numWords&quot;</span><span class="p">)))</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="p">[</span><span class="n">Row</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">numWords</span><span class="p">)</span><span class="o">=</span><span class="mi">15</span><span class="p">)]</span></code></pre></figure>

    <p>首先，将一条线映射到一个整数值，并将其别名为“ numWords”，从而创建一个新的DataFrame。 <code>agg</code>在该DataFrame上调用，以找到最大的字数。的论点<code>select</code>和<code>agg</code>都是<em><a href="api/python/index.html#pyspark.sql.Column">Column</a></em> ，我们可以使用<code>df.colName</code>从DataFrame获取列。我们还可以导入pyspark.sql.functions，它提供了许多方便的功能来从旧的列构建新的列。</p>

    <p>一种常见的数据流模式是Hadoop流行的MapReduce。Spark可以轻松实现MapReduce流：</p>

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">wordCounts</span> <span class="o">=</span> <span class="n">textFile</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">explode</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">textFile</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;\s+&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;word&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&quot;word&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span></code></pre></figure>

    <p>在这里，我们使用<code>explode</code>发挥作用<code>select</code> ，将线的数据集转换为单词的数据集，然后组合<code>groupBy</code>和<code>count</code>以2列的DataFrame计算文件中的每个单词计数：“单词”和“计数”。要收集外壳中的字数，我们可以调用<code>collect</code> ：</p>

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">wordCounts</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="p">[</span><span class="n">Row</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;online&#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">Row</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;graphs&#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="o">...</span><span class="p">]</span></code></pre></figure>

  </div>
</div>

<h2 id="caching">快取</h2>
<p>Spark还支持将数据集提取到群集范围的内存中缓存中。当重复访问数据时，例如查询小的“热”数据集或运行迭代算法（如PageRank）时，这非常有用。作为一个简单的例子，让我们标记一下<code>linesWithSpark</code>要缓存的数据集：</p>

<div class="codetabs">
<div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span></span><span class="n">scala</span><span class="o">&gt;</span> <span class="n">linesWithSpark</span><span class="o">.</span><span class="n">cache</span><span class="o">()</span>
<span class="n">res7</span><span class="k">:</span> <span class="kt">linesWithSpark.</span><span class="k">type</span> <span class="o">=</span> <span class="o">[</span><span class="kt">value:</span> <span class="kt">string</span><span class="o">]</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">linesWithSpark</span><span class="o">.</span><span class="n">count</span><span class="o">()</span>
<span class="n">res8</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">15</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">linesWithSpark</span><span class="o">.</span><span class="n">count</span><span class="o">()</span>
<span class="n">res9</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">15</span></code></pre></figure>

    <p>使用Spark浏览和缓存100行文本文件似乎很愚蠢。有趣的是，即使在数十个或数百个节点上进行条带化时，这些相同的函数也可以用于非常大的数据集。您也可以通过以下方式以交互方式进行操作： <code>bin/spark-shell</code>如<a href="rdd-programming-guide.html#using-the-shell">RDD编程指南中</a>所述，将其迁移到群集。</p>

  </div>
<div data-lang="python">

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">linesWithSpark</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">linesWithSpark</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="mi">15</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">linesWithSpark</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="mi">15</span></code></pre></figure>

    <p>使用Spark浏览和缓存100行文本文件似乎很愚蠢。有趣的是，即使在数十个或数百个节点上进行条带化时，这些相同的函数也可以用于非常大的数据集。您也可以通过以下方式以交互方式进行操作： <code>bin/pyspark</code>如<a href="rdd-programming-guide.html#using-the-shell">RDD编程指南中</a>所述，将其迁移到群集。</p>

  </div>
</div>

<h1 id="self-contained-applications">自包含的应用程序</h1>
<p>假设我们希望使用Spark API编写一个独立的应用程序。我们将逐步介绍一个Scala（带有sbt），Java（带有Maven）和Python（pip）的简单应用程序。</p>

<div class="codetabs">
<div data-lang="scala">

    <p>我们将在Scala中创建一个非常简单的Spark应用程序-实际上，它是如此简单，其名称为<code>SimpleApp.scala</code> ：</p>

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span></span><span class="cm">/* SimpleApp.scala */</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span>

<span class="k">object</span> <span class="nc">SimpleApp</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">logFile</span> <span class="k">=</span> <span class="s">&quot;YOUR_SPARK_HOME/README.md&quot;</span> <span class="c1">// Should be some file on your system</span>
    <span class="k">val</span> <span class="n">spark</span> <span class="k">=</span> <span class="nc">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="o">(</span><span class="s">&quot;Simple Application&quot;</span><span class="o">).</span><span class="n">getOrCreate</span><span class="o">()</span>
    <span class="k">val</span> <span class="n">logData</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">textFile</span><span class="o">(</span><span class="n">logFile</span><span class="o">).</span><span class="n">cache</span><span class="o">()</span>
    <span class="k">val</span> <span class="n">numAs</span> <span class="k">=</span> <span class="n">logData</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="n">line</span> <span class="k">=&gt;</span> <span class="n">line</span><span class="o">.</span><span class="n">contains</span><span class="o">(</span><span class="s">&quot;a&quot;</span><span class="o">)).</span><span class="n">count</span><span class="o">()</span>
    <span class="k">val</span> <span class="n">numBs</span> <span class="k">=</span> <span class="n">logData</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="n">line</span> <span class="k">=&gt;</span> <span class="n">line</span><span class="o">.</span><span class="n">contains</span><span class="o">(</span><span class="s">&quot;b&quot;</span><span class="o">)).</span><span class="n">count</span><span class="o">()</span>
    <span class="n">println</span><span class="o">(</span><span class="s">s&quot;Lines with a: </span><span class="si">$numAs</span><span class="s">, Lines with b: </span><span class="si">$numBs</span><span class="s">&quot;</span><span class="o">)</span>
    <span class="n">spark</span><span class="o">.</span><span class="n">stop</span><span class="o">()</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

    <p>请注意，应用程序应定义一个<code>main()</code>方法而不是扩展<code>scala.App</code> 。的子类<code>scala.App</code>可能无法正常工作。</p>

    <p>该程序只计算Spark自述文件中包含“ a”的行数和包含“ b”的行数。请注意，您需要用安装Spark的位置替换YOUR_SPARK_HOME。与前面带有初始化自己的SparkSession的Spark shell示例不同，我们将SparkSession初始化为程序的一部分。</p>

    <p>我们称之为<code>SparkSession.builder</code>构造一个[[SparkSession]]，然后设置应用程序名称，最后调用<code>getOrCreate</code>获取[[SparkSession]]实例。</p>

    <p>我们的应用程序依赖于Spark API，因此我们还将包含一个sbt配置文件， <code>build.sbt</code> ，这说明Spark是依赖项。该文件还添加了Spark依赖的存储库：</p>

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span></span><span class="n">name</span> <span class="o">:=</span> <span class="s">&quot;Simple Project&quot;</span>

<span class="n">version</span> <span class="o">:=</span> <span class="s">&quot;1.0&quot;</span>

<span class="n">scalaVersion</span> <span class="o">:=</span> <span class="s">&quot;2.12.8&quot;</span>

<span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">&quot;org.apache.spark&quot;</span> <span class="o">%%</span> <span class="s">&quot;spark-sql&quot;</span> <span class="o">%</span> <span class="s">&quot;2.4.4&quot;</span></code></pre></figure>

    <p>为了使sbt正常工作，我们需要进行布局<code>SimpleApp.scala</code>和<code>build.sbt</code>根据典型的目录结构。设置好之后，我们可以创建一个包含应用程序代码的JAR包，然后使用<code>spark-submit</code>脚本来运行我们的程序。</p>

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="c1"># Your directory layout should look like this</span>
$ find .
.
./build.sbt
./src
./src/main
./src/main/scala
./src/main/scala/SimpleApp.scala

<span class="c1"># Package a jar containing your application</span>
$ sbt package
...
<span class="o">[</span>info<span class="o">]</span> Packaging <span class="o">{</span>..<span class="o">}</span>/<span class="o">{</span>..<span class="o">}</span>/target/scala-2.12/simple-project_2.12-1.0.jar

<span class="c1"># Use spark-submit to run your application</span>
$ YOUR_SPARK_HOME/bin/spark-submit <span class="se">\</span>
  --class <span class="s2">&quot;SimpleApp&quot;</span> <span class="se">\</span>
  --master local<span class="o">[</span><span class="m">4</span><span class="o">]</span> <span class="se">\</span>
  target/scala-2.12/simple-project_2.12-1.0.jar
...
Lines with a: <span class="m">46</span>, Lines with b: <span class="m">23</span></code></pre></figure>

  </div>
<div data-lang="java">
    <p>本示例将使用Maven编译应用程序JAR，但是任何类似的构建系统都可以使用。</p>

    <p>我们将创建一个非常简单的Spark应用程序， <code>SimpleApp.java</code> ：</p>

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="cm">/* SimpleApp.java */</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleApp</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">logFile</span> <span class="o">=</span> <span class="s">&quot;YOUR_SPARK_HOME/README.md&quot;</span><span class="o">;</span> <span class="c1">// Should be some file on your system</span>
    <span class="n">SparkSession</span> <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">appName</span><span class="o">(</span><span class="s">&quot;Simple Application&quot;</span><span class="o">).</span><span class="na">getOrCreate</span><span class="o">();</span>
    <span class="n">Dataset</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">logData</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">textFile</span><span class="o">(</span><span class="n">logFile</span><span class="o">).</span><span class="na">cache</span><span class="o">();</span>

    <span class="kt">long</span> <span class="n">numAs</span> <span class="o">=</span> <span class="n">logData</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">s</span> <span class="o">-&gt;</span> <span class="n">s</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;a&quot;</span><span class="o">)).</span><span class="na">count</span><span class="o">();</span>
    <span class="kt">long</span> <span class="n">numBs</span> <span class="o">=</span> <span class="n">logData</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">s</span> <span class="o">-&gt;</span> <span class="n">s</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;b&quot;</span><span class="o">)).</span><span class="na">count</span><span class="o">();</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Lines with a: &quot;</span> <span class="o">+</span> <span class="n">numAs</span> <span class="o">+</span> <span class="s">&quot;, lines with b: &quot;</span> <span class="o">+</span> <span class="n">numBs</span><span class="o">);</span>

    <span class="n">spark</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

    <p>该程序只计算Spark自述文件中包含“ a”的行数和包含“ b”的行数。请注意，您需要用安装Spark的位置替换YOUR_SPARK_HOME。与前面带有初始化自己的SparkSession的Spark shell示例不同，我们将SparkSession初始化为程序的一部分。</p>

    <p>为了构建程序，我们还编写了一个Maven <code>pom.xml</code>将Spark列为依赖项的文件。请注意，Spark工件带有Scala版本标记。</p>

    <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;project&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>edu.berkeley<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>simple-project<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
  <span class="nt">&lt;name&gt;</span>Simple Project<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span> <span class="c">&lt;!-- Spark dependency --&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.apache.spark<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>spark-sql_2.12<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>2.4.4<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre></figure>

    <p>我们根据规范的Maven目录结构对这些文件进行布局：</p>

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ find .
./pom.xml
./src
./src/main
./src/main/java
./src/main/java/SimpleApp.java</code></pre></figure>

    <p>现在，我们可以使用Maven打包应用程序并使用<code>./bin/spark-submit</code> 。</p>

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="c1"># Package a JAR containing your application</span>
$ mvn package
...
<span class="o">[</span>INFO<span class="o">]</span> Building jar: <span class="o">{</span>..<span class="o">}</span>/<span class="o">{</span>..<span class="o">}</span>/target/simple-project-1.0.jar

<span class="c1"># Use spark-submit to run your application</span>
$ YOUR_SPARK_HOME/bin/spark-submit <span class="se">\</span>
  --class <span class="s2">&quot;SimpleApp&quot;</span> <span class="se">\</span>
  --master local<span class="o">[</span><span class="m">4</span><span class="o">]</span> <span class="se">\</span>
  target/simple-project-1.0.jar
...
Lines with a: <span class="m">46</span>, Lines with b: <span class="m">23</span></code></pre></figure>

  </div>
<div data-lang="python">

    <p>现在，我们将展示如何使用Python API（PySpark）编写应用程序。</p>

    <p>如果要构建打包的PySpark应用程序或库，则可以按以下方式将其添加到setup.py文件中：</p>

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span>    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;pyspark=={site.SPARK_VERSION}&#39;</span>
    <span class="p">]</span></code></pre></figure>

    <p>举例来说，我们将创建一个简单的Spark应用程序， <code>SimpleApp.py</code> ：</p>

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="sd">&quot;&quot;&quot;SimpleApp.py&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">logFile</span> <span class="o">=</span> <span class="s2">&quot;YOUR_SPARK_HOME/README.md&quot;</span>  <span class="c1"># Should be some file on your system</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;SimpleApp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="n">logData</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">logFile</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

<span class="n">numAs</span> <span class="o">=</span> <span class="n">logData</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">logData</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">numBs</span> <span class="o">=</span> <span class="n">logData</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">logData</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Lines with a: </span><span class="si">%i</span><span class="s2">, lines with b: </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">numAs</span><span class="p">,</span> <span class="n">numBs</span><span class="p">))</span>

<span class="n">spark</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></code></pre></figure>

    <p>该程序只计算文本文件中包含“ a”的行数和包含“ b”的行数。请注意，您需要用安装Spark的位置替换YOUR_SPARK_HOME。与Scala和Java示例一样，我们使用SparkSession创建数据集。对于使用自定义类或第三方库的应用程序，我们还可以将代码依赖项添加到<code>spark-submit</code>通过其<code>--py-files</code>通过将它们打包到一个.zip文件中来进行论证（请参阅<code>spark-submit --help</code>有关详细信息）。
<code>SimpleApp</code>非常简单，我们不需要指定任何代码依赖项。</p>

    <p>我们可以使用<code>bin/spark-submit</code>脚本：</p>

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="c1"># Use spark-submit to run your application</span>
$ YOUR_SPARK_HOME/bin/spark-submit <span class="se">\</span>
  --master local<span class="o">[</span><span class="m">4</span><span class="o">]</span> <span class="se">\</span>
  SimpleApp.py
...
Lines with a: <span class="m">46</span>, Lines with b: <span class="m">23</span></code></pre></figure>

    <p>如果您的环境中安装了PySpark pip（例如， <code>pip install pyspark</code> ），则可以使用常规Python解释器运行您的应用程序，也可以根据需要使用提供的“火花提交”。</p>

    <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="c1"># Use the Python interpreter to run your application</span>
$ python SimpleApp.py
...
Lines with a: <span class="m">46</span>, Lines with b: <span class="m">23</span></code></pre></figure>

  </div>
</div>

<h1 id="where-to-go-from-here">从这往哪儿走</h1>
<p>祝贺您运行第一个Spark应用程序！</p>

<ul>
  <li>有关API的深入概述， <a href="rdd-programming-guide.html">请先阅读RDD编程指南</a>和<a href="sql-programming-guide.html">SQL编程指南</a> ，或查看“编程指南”菜单中的其他组件。</li>
  <li>要在集群上运行应用程序，请转至<a href="cluster-overview.html">部署概述</a> 。</li>
  <li>最后，Spark在<code>examples</code>目录（ <a href="https://github.com/apache/spark/tree/master/examples/src/main/scala/org/apache/spark/examples">Scala</a> ， <a href="https://github.com/apache/spark/tree/master/examples/src/main/java/org/apache/spark/examples">Java</a> ， <a href="https://github.com/apache/spark/tree/master/examples/src/main/python">Python</a> ， <a href="https://github.com/apache/spark/tree/master/examples/src/main/r">R</a> ）。您可以如下运行它们：</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="c1"># For Scala and Java, use run-example:</span>
./bin/run-example SparkPi

<span class="c1"># For Python examples, use spark-submit directly:</span>
./bin/spark-submit examples/src/main/python/pi.py

<span class="c1"># For R examples, use spark-submit directly:</span>
./bin/spark-submit examples/src/main/r/dataframe.R</code></pre></figure>



                </div>
            
             <!-- /container -->
        </div>

        <script src="js/vendor/jquery-1.12.4.min.js"></script>
        <script src="js/vendor/bootstrap.min.js"></script>
        <script src="js/vendor/anchor.min.js"></script>
        <script src="js/main.js"></script>

        <!-- MathJax Section -->
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
                TeX: { equationNumbers: { autoNumber: "AMS" } }
            });
        </script>
        <script>
            // Note that we load MathJax this way to work with local file (file://), HTTP and HTTPS.
            // We could use "//cdn.mathjax...", but that won't support "file://".
            (function(d, script) {
                script = d.createElement('script');
                script.type = 'text/javascript';
                script.async = true;
                script.onload = function(){
                    MathJax.Hub.Config({
                        tex2jax: {
                            inlineMath: [ ["$", "$"], ["\\\\(","\\\\)"] ],
                            displayMath: [ ["$$","$$"], ["\\[", "\\]"] ],
                            processEscapes: true,
                            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
                        }
                    });
                };
                script.src = ('https:' == document.location.protocol ? 'https://' : 'http://') +
                    'cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js' +
                    '?config=TeX-AMS-MML_HTMLorMML';
                d.getElementsByTagName('head')[0].appendChild(script);
            }(document));
        </script>
    

</body></html>