<html class="no-js" ><head></head><body >﻿<!--<![endif]-->
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>分类和回归-Spark 2.4.4文档</title>
        

        

        <link rel="stylesheet" href="css/bootstrap.min.css">
        <style>
            body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
        </style>
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="css/bootstrap-responsive.min.css">
        <link rel="stylesheet" href="css/main.css">

        <script src="js/vendor/modernizr-2.6.1-respond-1.1.0.min.js"></script>

        <link rel="stylesheet" href="css/pygments-default.css">

        
        <!-- Google analytics script -->
        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-32518208-2']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>
        

    
    
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="https://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

        <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

        <div class="navbar navbar-fixed-top" id="topbar">
            <div class="navbar-inner">
                <div class="container">
                    <div class="brand"><a href="index.html"><img src="img/spark-logo-hd.png" style="height:50px"></a> <span class="version">2.4.4</span>
                    </div>
                    <ul class="nav">
                        <!--TODO(andyk): Add class="active" attribute to li some how.-->
                        <li><a href="index.html">总览</a></li>

                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">编程指南<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="quick-start.html">快速开始</a></li>
                                <li><a href="rdd-programming-guide.html">RDD，累加器，广播变量</a></li>
                                <li><a href="sql-programming-guide.html">SQL，数据框和数据集</a></li>
                                <li><a href="structured-streaming-programming-guide.html">结构化流</a></li>
                                <li><a href="streaming-programming-guide.html">火花流（DStreams）</a></li>
                                <li><a href="ml-guide.html">MLlib（机器学习）</a></li>
                                <li><a href="graphx-programming-guide.html">GraphX（图形处理）</a></li>
                                <li><a href="sparkr.html">SparkR（Spark上的R）</a></li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">API文件<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="api/scala/index.html#org.apache.spark.package">斯卡拉</a></li>
                                <li><a href="api/java/index.html">爪哇</a></li>
                                <li><a href="api/python/index.html">蟒蛇</a></li>
                                <li><a href="api/R/index.html">[R</a></li>
                                <li><a href="api/sql/index.html">SQL，内置函数</a></li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">部署中<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="cluster-overview.html">总览</a></li>
                                <li><a href="submitting-applications.html">提交申请</a></li>
                                <li class="divider"></li>
                                <li><a href="spark-standalone.html">Spark独立</a></li>
                                <li><a href="running-on-mesos.html">梅索斯</a></li>
                                <li><a href="running-on-yarn.html">纱</a></li>
                                <li><a href="running-on-kubernetes.html">Kubernetes</a></li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a href="api.html" class="dropdown-toggle" data-toggle="dropdown">更多<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="configuration.html">组态</a></li>
                                <li><a href="monitoring.html">监控方式</a></li>
                                <li><a href="tuning.html">调音指南</a></li>
                                <li><a href="job-scheduling.html">作业调度</a></li>
                                <li><a href="security.html">安全</a></li>
                                <li><a href="hardware-provisioning.html">硬件配置</a></li>
                                <li class="divider"></li>
                                <li><a href="building-spark.html">建筑火花</a></li>
                                <li><a href="https://spark.apache.org/contributing.html">为Spark贡献</a></li>
                                <li><a href="https://spark.apache.org/third-party-projects.html">第三方项目</a></li>
                            </ul>
                        </li>
                    </ul>
                    <!--<p class="navbar-text pull-right"><span class="version-text">v2.4.4</span></p>-->
                </div>
            </div>
        </div>

        <div class="container-wrapper">

            
                
                    <div class="left-menu-wrapper">
    <div class="left-menu">
        <h3><a href="ml-guide.html">MLlib：主要指南</a></h3>
        
<ul>

    <li>
        <a href="ml-statistics.html">基本统计</a>
    </li>
    
    

    <li>
        <a href="ml-datasource">数据源</a>
    </li>
    
    

    <li>
        <a href="ml-pipeline.html">流水线</a>
    </li>
    
    

    <li>
        <a href="ml-features.html">提取，转换和选择特征</a>
    </li>
    
    

    <li>
        <a href="ml-classification-regression.html">
            
                <b>分类与回归</b>
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-clustering.html">聚类</a>
    </li>
    
    

    <li>
        <a href="ml-collaborative-filtering.html">协同过滤</a>
    </li>
    
    

    <li>
        <a href="ml-frequent-pattern-mining.html">频繁模式挖掘</a>
    </li>
    
    

    <li>
        <a href="ml-tuning.html">模型选择和调整</a>
    </li>
    
    

    <li>
        <a href="ml-advanced.html">进阶主题</a>
    </li>
    
    

</ul>

        <h3><a href="mllib-guide.html">MLlib：基于RDD的API指南</a></h3>
        
<ul>

    <li>
        <a href="mllib-data-types.html">资料类型</a>
    </li>
    
    

    <li>
        <a href="mllib-statistics.html">基本统计</a>
    </li>
    
    

    <li>
        <a href="mllib-classification-regression.html">分类与回归</a>
    </li>
    
    

    <li>
        <a href="mllib-collaborative-filtering.html">协同过滤</a>
    </li>
    
    

    <li>
        <a href="mllib-clustering.html">聚类</a>
    </li>
    
    

    <li>
        <a href="mllib-dimensionality-reduction.html">降维</a>
    </li>
    
    

    <li>
        <a href="mllib-feature-extraction.html">特征提取和转换</a>
    </li>
    
    

    <li>
        <a href="mllib-frequent-pattern-mining.html">频繁模式挖掘</a>
    </li>
    
    

    <li>
        <a href="mllib-evaluation-metrics.html">评估指标</a>
    </li>
    
    

    <li>
        <a href="mllib-pmml-model-export.html">PMML模型导出</a>
    </li>
    
    

    <li>
        <a href="mllib-optimization.html">优化（开发人员）</a>
    </li>
    
    

</ul>

    </div>
</div>
                
                <input id="nav-trigger" class="nav-trigger" type="checkbox" checked>
                <label for="nav-trigger"></label>
                <div class="content-with-sidebar" id="content">
                    
                        <h1 class="title">分类与回归</h1>
                    

                    <p><code>\[ \newcommand{\R}{\mathbb{R}} \newcommand{\E}{\mathbb{E}} \newcommand{\x}{\mathbf{x}} \newcommand{\y}{\mathbf{y}} \newcommand{\wv}{\mathbf{w}} \newcommand{\av}{\mathbf{\alpha}} \newcommand{\bv}{\mathbf{b}} \newcommand{\N}{\mathbb{N}} \newcommand{\id}{\mathbf{I}} \newcommand{\ind}{\mathbf{1}} \newcommand{\0}{\mathbf{0}} \newcommand{\unit}{\mathbf{e}} \newcommand{\one}{\mathbf{1}} \newcommand{\zero}{\mathbf{0}} \]</code></p>

<p>本页涵盖分类和回归算法。它还包括讨论特定算法类别的部分，例如线性方法，树和合奏。</p>

<p><strong>目录</strong></p>

<ul id="markdown-toc">
  <li><a href="#classification" id="markdown-toc-classification">分类</a>    <ul>
      <li><a href="#logistic-regression" id="markdown-toc-logistic-regression">逻辑回归</a>        <ul>
          <li><a href="#binomial-logistic-regression" id="markdown-toc-binomial-logistic-regression">二项式逻辑回归</a></li>
          <li><a href="#multinomial-logistic-regression" id="markdown-toc-multinomial-logistic-regression">多项逻辑回归</a></li>
        </ul>
      </li>
      <li><a href="#decision-tree-classifier" id="markdown-toc-decision-tree-classifier">决策树分类器</a></li>
      <li><a href="#random-forest-classifier" id="markdown-toc-random-forest-classifier">随机森林分类器</a></li>
      <li><a href="#gradient-boosted-tree-classifier" id="markdown-toc-gradient-boosted-tree-classifier">梯度提升树分类器</a></li>
      <li><a href="#multilayer-perceptron-classifier" id="markdown-toc-multilayer-perceptron-classifier">多层感知器分类器</a></li>
      <li><a href="#linear-support-vector-machine" id="markdown-toc-linear-support-vector-machine">线性支持向量机</a></li>
      <li><a href="#one-vs-rest-classifier-aka-one-vs-all" id="markdown-toc-one-vs-rest-classifier-aka-one-vs-all">相对于静止的分类器（又名相对于所有）</a></li>
      <li><a href="#naive-bayes" id="markdown-toc-naive-bayes">朴素贝叶斯</a></li>
    </ul>
  </li>
  <li><a href="#regression" id="markdown-toc-regression">回归</a>    <ul>
      <li><a href="#linear-regression" id="markdown-toc-linear-regression">线性回归</a></li>
      <li><a href="#generalized-linear-regression" id="markdown-toc-generalized-linear-regression">广义线性回归</a>        <ul>
          <li><a href="#available-families" id="markdown-toc-available-families">可用家庭</a></li>
        </ul>
      </li>
      <li><a href="#decision-tree-regression" id="markdown-toc-decision-tree-regression">决策树回归</a></li>
      <li><a href="#random-forest-regression" id="markdown-toc-random-forest-regression">随机森林回归</a></li>
      <li><a href="#gradient-boosted-tree-regression" id="markdown-toc-gradient-boosted-tree-regression">梯度提升树回归</a></li>
      <li><a href="#survival-regression" id="markdown-toc-survival-regression">生存回归</a></li>
      <li><a href="#isotonic-regression" id="markdown-toc-isotonic-regression">等渗回归</a></li>
    </ul>
  </li>
  <li><a href="#linear-methods" id="markdown-toc-linear-methods">线性方法</a></li>
  <li><a href="#decision-trees" id="markdown-toc-decision-trees">决策树</a>    <ul>
      <li><a href="#inputs-and-outputs" id="markdown-toc-inputs-and-outputs">输入和输出</a>        <ul>
          <li><a href="#input-columns" id="markdown-toc-input-columns">输入栏</a></li>
          <li><a href="#output-columns" id="markdown-toc-output-columns">输出列</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#tree-ensembles" id="markdown-toc-tree-ensembles">树木乐团</a>    <ul>
      <li><a href="#random-forests" id="markdown-toc-random-forests">随机森林</a>        <ul>
          <li><a href="#inputs-and-outputs-1" id="markdown-toc-inputs-and-outputs-1">输入和输出</a>            <ul>
              <li><a href="#input-columns-1" id="markdown-toc-input-columns-1">输入栏</a></li>
              <li><a href="#output-columns-predictions" id="markdown-toc-output-columns-predictions">输出列（预测）</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#gradient-boosted-trees-gbts" id="markdown-toc-gradient-boosted-trees-gbts">渐变树（GBT）</a>        <ul>
          <li><a href="#inputs-and-outputs-2" id="markdown-toc-inputs-and-outputs-2">输入和输出</a>            <ul>
              <li><a href="#input-columns-2" id="markdown-toc-input-columns-2">输入栏</a></li>
              <li><a href="#output-columns-predictions-1" id="markdown-toc-output-columns-predictions-1">输出列（预测）</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h1 id="classification">分类</h1>

<h2 id="logistic-regression">逻辑回归</h2>

<p>Logistic回归是一种用于预测分类响应的流行方法。这是<a href="https://en.wikipedia.org/wiki/Generalized_linear_model">广义线性模型的</a>一种特殊情况，可以预测结果的可能性。在<code>spark.ml</code> Logistic回归可用于通过使用二项式Logistic回归来预测二元结果，或者可用于通过使用多项式Logistic回归来预测多类结果。使用<code>family</code>参数以在这两种算法之间进行选择，或者将其保留为未设置状态，Spark会推断出正确的变体。</p>

<blockquote>
  <p>可以通过将多项式逻辑回归设置为<code>family</code>参数为“多项式”。它将产生两组系数和两个截距。</p>
</blockquote>

<blockquote>
  <p>当对具有恒定非零列的数据集进行LogisticRegressionModel拟合而没有截距时，Spark MLlib为恒定非零列输出零系数。此行为与R glmnet相同，但与LIBSVM不同。</p>
</blockquote>

<h3 id="binomial-logistic-regression">二项式逻辑回归</h3>

<p>有关实施二项式逻辑回归的更多背景信息和更多信息，请参阅《 <a href="mllib-linear-methods.html#logistic-regression">Logistic回归》中</a>的文档。 <a href="mllib-linear-methods.html#logistic-regression"><code>spark.mllib</code></a> 。</p>

<p><strong>例子</strong></p>

<p>以下示例显示了如何使用弹性网正则化训练二项式和多项式逻辑回归模型进行二分类。 <code>elasticNetParam</code>对应于$ \ alpha $和<code>regParam</code>对应于$ \ lambda $。</p>

<div class="codetabs">

<div data-lang="scala">

    <p>有关参数的更多详细信息，请参见<a href="api/scala/index.html#org.apache.spark.ml.classification.LogisticRegression">Scala API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.ml.classification.LogisticRegression</span>

<span class="c1">// Load training data</span>
<span class="k">val</span> <span class="n">training</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">lr</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LogisticRegression</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setMaxIter</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setRegParam</span><span class="o">(</span><span class="mf">0.3</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setElasticNetParam</span><span class="o">(</span><span class="mf">0.8</span><span class="o">)</span>

<span class="c1">// Fit the model</span>
<span class="k">val</span> <span class="n">lrModel</span> <span class="k">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">training</span><span class="o">)</span>

<span class="c1">// Print the coefficients and intercept for logistic regression</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Coefficients: </span><span class="si">${</span><span class="n">lrModel</span><span class="o">.</span><span class="n">coefficients</span><span class="si">}</span><span class="s"> Intercept: </span><span class="si">${</span><span class="n">lrModel</span><span class="o">.</span><span class="n">intercept</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>

<span class="c1">// We can also use the multinomial family for binary classification</span>
<span class="k">val</span> <span class="n">mlr</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LogisticRegression</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setMaxIter</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setRegParam</span><span class="o">(</span><span class="mf">0.3</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setElasticNetParam</span><span class="o">(</span><span class="mf">0.8</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setFamily</span><span class="o">(</span><span class="s">&quot;multinomial&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">mlrModel</span> <span class="k">=</span> <span class="n">mlr</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">training</span><span class="o">)</span>

<span class="c1">// Print the coefficients and intercepts for logistic regression with multinomial family</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Multinomial coefficients: </span><span class="si">${</span><span class="n">mlrModel</span><span class="o">.</span><span class="n">coefficientMatrix</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Multinomial intercepts: </span><span class="si">${</span><span class="n">mlrModel</span><span class="o">.</span><span class="n">interceptVector</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / scala / org / apache / spark / examples / ml / LogisticRegressionWithElasticNetExample.scala”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="java">

    <p>有关参数的更多详细信息，请参见<a href="api/java/org/apache/spark/ml/classification/LogisticRegression.html">Java API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.LogisticRegression</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.LogisticRegressionModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>

<span class="c1">// Load training data</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">training</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="o">);</span>

<span class="n">LogisticRegression</span> <span class="n">lr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LogisticRegression</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setMaxIter</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setRegParam</span><span class="o">(</span><span class="mf">0.3</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setElasticNetParam</span><span class="o">(</span><span class="mf">0.8</span><span class="o">);</span>

<span class="c1">// Fit the model</span>
<span class="n">LogisticRegressionModel</span> <span class="n">lrModel</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">training</span><span class="o">);</span>

<span class="c1">// Print the coefficients and intercept for logistic regression</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Coefficients: &quot;</span>
  <span class="o">+</span> <span class="n">lrModel</span><span class="o">.</span><span class="na">coefficients</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; Intercept: &quot;</span> <span class="o">+</span> <span class="n">lrModel</span><span class="o">.</span><span class="na">intercept</span><span class="o">());</span>

<span class="c1">// We can also use the multinomial family for binary classification</span>
<span class="n">LogisticRegression</span> <span class="n">mlr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LogisticRegression</span><span class="o">()</span>
        <span class="o">.</span><span class="na">setMaxIter</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
        <span class="o">.</span><span class="na">setRegParam</span><span class="o">(</span><span class="mf">0.3</span><span class="o">)</span>
        <span class="o">.</span><span class="na">setElasticNetParam</span><span class="o">(</span><span class="mf">0.8</span><span class="o">)</span>
        <span class="o">.</span><span class="na">setFamily</span><span class="o">(</span><span class="s">&quot;multinomial&quot;</span><span class="o">);</span>

<span class="c1">// Fit the model</span>
<span class="n">LogisticRegressionModel</span> <span class="n">mlrModel</span> <span class="o">=</span> <span class="n">mlr</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">training</span><span class="o">);</span>

<span class="c1">// Print the coefficients and intercepts for logistic regression with multinomial family</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Multinomial coefficients: &quot;</span> <span class="o">+</span> <span class="n">lrModel</span><span class="o">.</span><span class="na">coefficientMatrix</span><span class="o">()</span>
  <span class="o">+</span> <span class="s">&quot;\nMultinomial intercepts: &quot;</span> <span class="o">+</span> <span class="n">mlrModel</span><span class="o">.</span><span class="na">interceptVector</span><span class="o">());</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / java / org / apache / spark / examples / ml / JavaLogisticRegressionWithElasticNetExample.java”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="python">

    <p>有关参数的更多详细信息，请参见<a href="api/python/pyspark.ml.html#pyspark.ml.classification.LogisticRegression">Python API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="c1"># Load training data</span>
<span class="n">training</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;libsvm&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="p">)</span>

<span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">maxIter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">regParam</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">elasticNetParam</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

<span class="c1"># Fit the model</span>
<span class="n">lrModel</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training</span><span class="p">)</span>

<span class="c1"># Print the coefficients and intercept for logistic regression</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Coefficients: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lrModel</span><span class="o">.</span><span class="n">coefficients</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Intercept: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lrModel</span><span class="o">.</span><span class="n">intercept</span><span class="p">))</span>

<span class="c1"># We can also use the multinomial family for binary classification</span>
<span class="n">mlr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">maxIter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">regParam</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">elasticNetParam</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s2">&quot;multinomial&quot;</span><span class="p">)</span>

<span class="c1"># Fit the model</span>
<span class="n">mlrModel</span> <span class="o">=</span> <span class="n">mlr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training</span><span class="p">)</span>

<span class="c1"># Print the coefficients and intercepts for logistic regression with multinomial family</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Multinomial coefficients: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mlrModel</span><span class="o">.</span><span class="n">coefficientMatrix</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Multinomial intercepts: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mlrModel</span><span class="o">.</span><span class="n">interceptVector</span><span class="p">))</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / python / ml / logistic_regression_with_elastic_net.py”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="r">

    <p>有关参数的更多详细信息，请参见<a href="api/R/spark.logit.html">R API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="c1"># Load training data</span>
df <span class="o">&lt;-</span> read.df<span class="p">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="p">,</span> <span class="kn">source</span> <span class="o">=</span> <span class="s">&quot;libsvm&quot;</span><span class="p">)</span>
training <span class="o">&lt;-</span> df
test <span class="o">&lt;-</span> df

<span class="c1"># Fit an binomial logistic regression model with spark.logit</span>
model <span class="o">&lt;-</span> spark.logit<span class="p">(</span>training<span class="p">,</span> label <span class="o">~</span> features<span class="p">,</span> maxIter <span class="o">=</span> <span class="m">10</span><span class="p">,</span> regParam <span class="o">=</span> <span class="m">0.3</span><span class="p">,</span> elasticNetParam <span class="o">=</span> <span class="m">0.8</span><span class="p">)</span>

<span class="c1"># Model summary</span>
<span class="kp">summary</span><span class="p">(</span>model<span class="p">)</span>

<span class="c1"># Prediction</span>
predictions <span class="o">&lt;-</span> predict<span class="p">(</span>model<span class="p">,</span> test<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>predictions<span class="p">)</span>
</pre></div>
    <div><small>在“ examples / src / main / r / ml / logit中找到完整的示例代码。Spark仓库中的R”。</small></div>
  </div>

</div>

<p>的<code>spark.ml</code> Logistic回归的实现还支持提取训练集中的模型摘要。请注意，将预测和指标存储为<code>DataFrame</code>在<code>LogisticRegressionSummary</code>被注释<code>@transient</code>因此仅在驱动程序上可用。</p>

<div class="codetabs">

<div data-lang="scala">

    <p><a href="api/scala/index.html#org.apache.spark.ml.classification.LogisticRegressionTrainingSummary"><code>LogisticRegressionTrainingSummary</code></a>提供一个摘要<a href="api/scala/index.html#org.apache.spark.ml.classification.LogisticRegressionModel"><code>LogisticRegressionModel</code></a> 。在二进制分类的情况下，某些附加指标可用，例如ROC曲线。二进制摘要可以通过<code>binarySummary</code>方法。看到<a href="api/scala/index.html#org.apache.spark.ml.classification.BinaryLogisticRegressionTrainingSummary"><code>BinaryLogisticRegressionTrainingSummary</code></a> 。</p>

    <p>继续前面的示例：</p>

    <div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.ml.classification.LogisticRegression</span>

<span class="c1">// Extract the summary from the returned LogisticRegressionModel instance trained in the earlier</span>
<span class="c1">// example</span>
<span class="k">val</span> <span class="n">trainingSummary</span> <span class="k">=</span> <span class="n">lrModel</span><span class="o">.</span><span class="n">binarySummary</span>

<span class="c1">// Obtain the objective per iteration.</span>
<span class="k">val</span> <span class="n">objectiveHistory</span> <span class="k">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">objectiveHistory</span>
<span class="n">println</span><span class="o">(</span><span class="s">&quot;objectiveHistory:&quot;</span><span class="o">)</span>
<span class="n">objectiveHistory</span><span class="o">.</span><span class="n">foreach</span><span class="o">(</span><span class="n">loss</span> <span class="k">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="n">loss</span><span class="o">))</span>

<span class="c1">// Obtain the receiver-operating characteristic as a dataframe and areaUnderROC.</span>
<span class="k">val</span> <span class="n">roc</span> <span class="k">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">roc</span>
<span class="n">roc</span><span class="o">.</span><span class="n">show</span><span class="o">()</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;areaUnderROC: </span><span class="si">${</span><span class="n">trainingSummary</span><span class="o">.</span><span class="n">areaUnderROC</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>

<span class="c1">// Set the model threshold to maximize F-Measure</span>
<span class="k">val</span> <span class="n">fMeasure</span> <span class="k">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">fMeasureByThreshold</span>
<span class="k">val</span> <span class="n">maxFMeasure</span> <span class="k">=</span> <span class="n">fMeasure</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="n">max</span><span class="o">(</span><span class="s">&quot;F-Measure&quot;</span><span class="o">)).</span><span class="n">head</span><span class="o">().</span><span class="n">getDouble</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
<span class="k">val</span> <span class="n">bestThreshold</span> <span class="k">=</span> <span class="n">fMeasure</span><span class="o">.</span><span class="n">where</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;F-Measure&quot;</span> <span class="o">===</span> <span class="n">maxFMeasure</span><span class="o">)</span>
  <span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">&quot;threshold&quot;</span><span class="o">).</span><span class="n">head</span><span class="o">().</span><span class="n">getDouble</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
<span class="n">lrModel</span><span class="o">.</span><span class="n">setThreshold</span><span class="o">(</span><span class="n">bestThreshold</span><span class="o">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / scala / org / apache / spark / examples / ml / LogisticRegressionSummaryExample.scala”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="java">
    <p><a href="api/java/org/apache/spark/ml/classification/LogisticRegressionTrainingSummary.html"><code>LogisticRegressionTrainingSummary</code></a>提供一个摘要<a href="api/java/org/apache/spark/ml/classification/LogisticRegressionModel.html"><code>LogisticRegressionModel</code></a> 。在二进制分类的情况下，某些附加指标可用，例如ROC曲线。二进制摘要可以通过<code>binarySummary</code>方法。看到<a href="api/java/org/apache/spark/ml/classification/BinaryLogisticRegressionTrainingSummary.html"><code>BinaryLogisticRegressionTrainingSummary</code></a> 。</p>

    <p>继续前面的示例：</p>

    <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.BinaryLogisticRegressionTrainingSummary</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.LogisticRegression</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.LogisticRegressionModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.functions</span><span class="o">;</span>

<span class="c1">// Extract the summary from the returned LogisticRegressionModel instance trained in the earlier</span>
<span class="c1">// example</span>
<span class="n">BinaryLogisticRegressionTrainingSummary</span> <span class="n">trainingSummary</span> <span class="o">=</span> <span class="n">lrModel</span><span class="o">.</span><span class="na">binarySummary</span><span class="o">();</span>

<span class="c1">// Obtain the loss per iteration.</span>
<span class="kt">double</span><span class="o">[]</span> <span class="n">objectiveHistory</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="na">objectiveHistory</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">double</span> <span class="n">lossPerIteration</span> <span class="o">:</span> <span class="n">objectiveHistory</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">lossPerIteration</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// Obtain the receiver-operating characteristic as a dataframe and areaUnderROC.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">roc</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="na">roc</span><span class="o">();</span>
<span class="n">roc</span><span class="o">.</span><span class="na">show</span><span class="o">();</span>
<span class="n">roc</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;FPR&quot;</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">trainingSummary</span><span class="o">.</span><span class="na">areaUnderROC</span><span class="o">());</span>

<span class="c1">// Get the threshold corresponding to the maximum F-Measure and rerun LogisticRegression with</span>
<span class="c1">// this selected threshold.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">fMeasure</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="na">fMeasureByThreshold</span><span class="o">();</span>
<span class="kt">double</span> <span class="n">maxFMeasure</span> <span class="o">=</span> <span class="n">fMeasure</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">functions</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="s">&quot;F-Measure&quot;</span><span class="o">)).</span><span class="na">head</span><span class="o">().</span><span class="na">getDouble</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
<span class="kt">double</span> <span class="n">bestThreshold</span> <span class="o">=</span> <span class="n">fMeasure</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">fMeasure</span><span class="o">.</span><span class="na">col</span><span class="o">(</span><span class="s">&quot;F-Measure&quot;</span><span class="o">).</span><span class="na">equalTo</span><span class="o">(</span><span class="n">maxFMeasure</span><span class="o">))</span>
  <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;threshold&quot;</span><span class="o">).</span><span class="na">head</span><span class="o">().</span><span class="na">getDouble</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
<span class="n">lrModel</span><span class="o">.</span><span class="na">setThreshold</span><span class="o">(</span><span class="n">bestThreshold</span><span class="o">);</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / java / org / apache / spark / examples / ml / JavaLogisticRegressionSummaryExample.java”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="python">
    <p><a href="api/python/pyspark.ml.html#pyspark.ml.classification.LogisticRegressionSummary"><code>LogisticRegressionTrainingSummary</code></a>提供一个摘要<a href="api/python/pyspark.ml.html#pyspark.ml.classification.LogisticRegressionModel"><code>LogisticRegressionModel</code></a> 。在二进制分类的情况下，某些附加指标可用，例如ROC曲线。看到<a href="api/python/pyspark.ml.html#pyspark.ml.classification.BinaryLogisticRegressionTrainingSummary"><code>BinaryLogisticRegressionTrainingSummary</code></a> 。</p>

    <p>继续前面的示例：</p>

    <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="c1"># Extract the summary from the returned LogisticRegressionModel instance trained</span>
<span class="c1"># in the earlier example</span>
<span class="n">trainingSummary</span> <span class="o">=</span> <span class="n">lrModel</span><span class="o">.</span><span class="n">summary</span>

<span class="c1"># Obtain the objective per iteration</span>
<span class="n">objectiveHistory</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">objectiveHistory</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;objectiveHistory:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">objective</span> <span class="ow">in</span> <span class="n">objectiveHistory</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span>

<span class="c1"># Obtain the receiver-operating characteristic as a dataframe and areaUnderROC.</span>
<span class="n">trainingSummary</span><span class="o">.</span><span class="n">roc</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;areaUnderROC: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trainingSummary</span><span class="o">.</span><span class="n">areaUnderROC</span><span class="p">))</span>

<span class="c1"># Set the model threshold to maximize F-Measure</span>
<span class="n">fMeasure</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">fMeasureByThreshold</span>
<span class="n">maxFMeasure</span> <span class="o">=</span> <span class="n">fMeasure</span><span class="o">.</span><span class="n">groupBy</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s1">&#39;F-Measure&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;max(F-Measure)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">bestThreshold</span> <span class="o">=</span> <span class="n">fMeasure</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">fMeasure</span><span class="p">[</span><span class="s1">&#39;F-Measure&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">maxFMeasure</span><span class="p">[</span><span class="s1">&#39;max(F-Measure)&#39;</span><span class="p">])</span> \
    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;threshold&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()[</span><span class="s1">&#39;threshold&#39;</span><span class="p">]</span>
<span class="n">lr</span><span class="o">.</span><span class="n">setThreshold</span><span class="p">(</span><span class="n">bestThreshold</span><span class="p">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / python / ml / logistic_regression_summary_example.py”中找到完整的示例代码。</small></div>
  </div>

</div>

<h3 id="multinomial-logistic-regression">多项逻辑回归</h3>

<p>通过多项逻辑（softmax）回归支持多类分类。在多项逻辑回归中，该算法生成$ K $系数集或维数$ K \ times J $的矩阵，其中$ K $是结果类的数量，而$ J $是特征的数量。如果该算法适合截距项，则截距的长度$ K $向量可用。</p>

<blockquote>
  <p>多项式系数可用<code>coefficientMatrix</code>和拦截器可用<code>interceptVector</code> 。</p>
</blockquote>

<blockquote>
  <p><code>coefficients</code>和<code>intercept</code>不支持使用多项式族训练的逻辑回归模型的方法。使用<code>coefficientMatrix</code>和<code>interceptVector</code>代替。</p>
</blockquote>

<p>使用softmax函数对{1，2，…，K} $中的结果类别$ k \ in的条件概率进行建模。</p>

<p><code>\[ P(Y=k|\mathbf{X}, \boldsymbol{\beta}_k, \beta_{0k}) = \frac{e^{\boldsymbol{\beta}_k \cdot \mathbf{X} + \beta_{0k}}}{\sum_{k'=0}^{K-1} e^{\boldsymbol{\beta}_{k'} \cdot \mathbf{X} + \beta_{0k'}}} \]</code></p>

<p>我们使用多项式响应模型最小化加权负对数似然率，并使用弹性网罚来控制过度拟合。</p>

<p><code>\[ \min_{\beta, \beta_0} -\left[\sum_{i=1}^L w_i \cdot \log P(Y = y_i|\mathbf{x}_i)\right] + \lambda \left[\frac{1}{2}\left(1 - \alpha\right)||\boldsymbol{\beta}||_2^2 + \alpha ||\boldsymbol{\beta}||_1\right] \]</code></p>

<p>有关详细推导，请参见<a href="https://en.wikipedia.org/wiki/Multinomial_logistic_regression#As_a_log-linear_model">此处</a> 。</p>

<p><strong>例子</strong></p>

<p>以下示例显示了如何使用弹性网正则化训练多类逻辑回归模型，以及如何提取多类训练摘要以评估模型。</p>

<div class="codetabs">

<div data-lang="scala">
    <div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.ml.classification.LogisticRegression</span>

<span class="c1">// Load training data</span>
<span class="k">val</span> <span class="n">training</span> <span class="k">=</span> <span class="n">spark</span>
  <span class="o">.</span><span class="n">read</span>
  <span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_multiclass_classification_data.txt&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">lr</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LogisticRegression</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setMaxIter</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setRegParam</span><span class="o">(</span><span class="mf">0.3</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setElasticNetParam</span><span class="o">(</span><span class="mf">0.8</span><span class="o">)</span>

<span class="c1">// Fit the model</span>
<span class="k">val</span> <span class="n">lrModel</span> <span class="k">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">training</span><span class="o">)</span>

<span class="c1">// Print the coefficients and intercept for multinomial logistic regression</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Coefficients: \n</span><span class="si">${</span><span class="n">lrModel</span><span class="o">.</span><span class="n">coefficientMatrix</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Intercepts: \n</span><span class="si">${</span><span class="n">lrModel</span><span class="o">.</span><span class="n">interceptVector</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">trainingSummary</span> <span class="k">=</span> <span class="n">lrModel</span><span class="o">.</span><span class="n">summary</span>

<span class="c1">// Obtain the objective per iteration</span>
<span class="k">val</span> <span class="n">objectiveHistory</span> <span class="k">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">objectiveHistory</span>
<span class="n">println</span><span class="o">(</span><span class="s">&quot;objectiveHistory:&quot;</span><span class="o">)</span>
<span class="n">objectiveHistory</span><span class="o">.</span><span class="n">foreach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span>

<span class="c1">// for multiclass, we can inspect metrics on a per-label basis</span>
<span class="n">println</span><span class="o">(</span><span class="s">&quot;False positive rate by label:&quot;</span><span class="o">)</span>
<span class="n">trainingSummary</span><span class="o">.</span><span class="n">falsePositiveRateByLabel</span><span class="o">.</span><span class="n">zipWithIndex</span><span class="o">.</span><span class="n">foreach</span> <span class="o">{</span> <span class="k">case</span> <span class="o">(</span><span class="n">rate</span><span class="o">,</span> <span class="n">label</span><span class="o">)</span> <span class="k">=&gt;</span>
  <span class="n">println</span><span class="o">(</span><span class="s">s&quot;label </span><span class="si">$label</span><span class="s">: </span><span class="si">$rate</span><span class="s">&quot;</span><span class="o">)</span>
<span class="o">}</span>

<span class="n">println</span><span class="o">(</span><span class="s">&quot;True positive rate by label:&quot;</span><span class="o">)</span>
<span class="n">trainingSummary</span><span class="o">.</span><span class="n">truePositiveRateByLabel</span><span class="o">.</span><span class="n">zipWithIndex</span><span class="o">.</span><span class="n">foreach</span> <span class="o">{</span> <span class="k">case</span> <span class="o">(</span><span class="n">rate</span><span class="o">,</span> <span class="n">label</span><span class="o">)</span> <span class="k">=&gt;</span>
  <span class="n">println</span><span class="o">(</span><span class="s">s&quot;label </span><span class="si">$label</span><span class="s">: </span><span class="si">$rate</span><span class="s">&quot;</span><span class="o">)</span>
<span class="o">}</span>

<span class="n">println</span><span class="o">(</span><span class="s">&quot;Precision by label:&quot;</span><span class="o">)</span>
<span class="n">trainingSummary</span><span class="o">.</span><span class="n">precisionByLabel</span><span class="o">.</span><span class="n">zipWithIndex</span><span class="o">.</span><span class="n">foreach</span> <span class="o">{</span> <span class="k">case</span> <span class="o">(</span><span class="n">prec</span><span class="o">,</span> <span class="n">label</span><span class="o">)</span> <span class="k">=&gt;</span>
  <span class="n">println</span><span class="o">(</span><span class="s">s&quot;label </span><span class="si">$label</span><span class="s">: </span><span class="si">$prec</span><span class="s">&quot;</span><span class="o">)</span>
<span class="o">}</span>

<span class="n">println</span><span class="o">(</span><span class="s">&quot;Recall by label:&quot;</span><span class="o">)</span>
<span class="n">trainingSummary</span><span class="o">.</span><span class="n">recallByLabel</span><span class="o">.</span><span class="n">zipWithIndex</span><span class="o">.</span><span class="n">foreach</span> <span class="o">{</span> <span class="k">case</span> <span class="o">(</span><span class="n">rec</span><span class="o">,</span> <span class="n">label</span><span class="o">)</span> <span class="k">=&gt;</span>
  <span class="n">println</span><span class="o">(</span><span class="s">s&quot;label </span><span class="si">$label</span><span class="s">: </span><span class="si">$rec</span><span class="s">&quot;</span><span class="o">)</span>
<span class="o">}</span>


<span class="n">println</span><span class="o">(</span><span class="s">&quot;F-measure by label:&quot;</span><span class="o">)</span>
<span class="n">trainingSummary</span><span class="o">.</span><span class="n">fMeasureByLabel</span><span class="o">.</span><span class="n">zipWithIndex</span><span class="o">.</span><span class="n">foreach</span> <span class="o">{</span> <span class="k">case</span> <span class="o">(</span><span class="n">f</span><span class="o">,</span> <span class="n">label</span><span class="o">)</span> <span class="k">=&gt;</span>
  <span class="n">println</span><span class="o">(</span><span class="s">s&quot;label </span><span class="si">$label</span><span class="s">: </span><span class="si">$f</span><span class="s">&quot;</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">accuracy</span> <span class="k">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">accuracy</span>
<span class="k">val</span> <span class="n">falsePositiveRate</span> <span class="k">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">weightedFalsePositiveRate</span>
<span class="k">val</span> <span class="n">truePositiveRate</span> <span class="k">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">weightedTruePositiveRate</span>
<span class="k">val</span> <span class="n">fMeasure</span> <span class="k">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">weightedFMeasure</span>
<span class="k">val</span> <span class="n">precision</span> <span class="k">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">weightedPrecision</span>
<span class="k">val</span> <span class="n">recall</span> <span class="k">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">weightedRecall</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Accuracy: </span><span class="si">$accuracy</span><span class="s">\nFPR: </span><span class="si">$falsePositiveRate</span><span class="s">\nTPR: </span><span class="si">$truePositiveRate</span><span class="s">\n&quot;</span> <span class="o">+</span>
  <span class="s">s&quot;F-measure: </span><span class="si">$fMeasure</span><span class="s">\nPrecision: </span><span class="si">$precision</span><span class="s">\nRecall: </span><span class="si">$recall</span><span class="s">&quot;</span><span class="o">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / scala / org / apache / spark / examples / ml / MulticlassLogisticRegressionWithElasticNetExample.scala”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="java">
    <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.LogisticRegression</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.LogisticRegressionModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.LogisticRegressionTrainingSummary</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>

<span class="c1">// Load training data</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">training</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_multiclass_classification_data.txt&quot;</span><span class="o">);</span>

<span class="n">LogisticRegression</span> <span class="n">lr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LogisticRegression</span><span class="o">()</span>
        <span class="o">.</span><span class="na">setMaxIter</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
        <span class="o">.</span><span class="na">setRegParam</span><span class="o">(</span><span class="mf">0.3</span><span class="o">)</span>
        <span class="o">.</span><span class="na">setElasticNetParam</span><span class="o">(</span><span class="mf">0.8</span><span class="o">);</span>

<span class="c1">// Fit the model</span>
<span class="n">LogisticRegressionModel</span> <span class="n">lrModel</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">training</span><span class="o">);</span>

<span class="c1">// Print the coefficients and intercept for multinomial logistic regression</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Coefficients: \n&quot;</span>
        <span class="o">+</span> <span class="n">lrModel</span><span class="o">.</span><span class="na">coefficientMatrix</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; \nIntercept: &quot;</span> <span class="o">+</span> <span class="n">lrModel</span><span class="o">.</span><span class="na">interceptVector</span><span class="o">());</span>
<span class="n">LogisticRegressionTrainingSummary</span> <span class="n">trainingSummary</span> <span class="o">=</span> <span class="n">lrModel</span><span class="o">.</span><span class="na">summary</span><span class="o">();</span>

<span class="c1">// Obtain the loss per iteration.</span>
<span class="kt">double</span><span class="o">[]</span> <span class="n">objectiveHistory</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="na">objectiveHistory</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">double</span> <span class="n">lossPerIteration</span> <span class="o">:</span> <span class="n">objectiveHistory</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">lossPerIteration</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// for multiclass, we can inspect metrics on a per-label basis</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;False positive rate by label:&quot;</span><span class="o">);</span>
<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="kt">double</span><span class="o">[]</span> <span class="n">fprLabel</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="na">falsePositiveRateByLabel</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">double</span> <span class="n">fpr</span> <span class="o">:</span> <span class="n">fprLabel</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;label &quot;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">fpr</span><span class="o">);</span>
    <span class="n">i</span><span class="o">++;</span>
<span class="o">}</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;True positive rate by label:&quot;</span><span class="o">);</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="kt">double</span><span class="o">[]</span> <span class="n">tprLabel</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="na">truePositiveRateByLabel</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">double</span> <span class="n">tpr</span> <span class="o">:</span> <span class="n">tprLabel</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;label &quot;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">tpr</span><span class="o">);</span>
    <span class="n">i</span><span class="o">++;</span>
<span class="o">}</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Precision by label:&quot;</span><span class="o">);</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="kt">double</span><span class="o">[]</span> <span class="n">precLabel</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="na">precisionByLabel</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">double</span> <span class="n">prec</span> <span class="o">:</span> <span class="n">precLabel</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;label &quot;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">prec</span><span class="o">);</span>
    <span class="n">i</span><span class="o">++;</span>
<span class="o">}</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Recall by label:&quot;</span><span class="o">);</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="kt">double</span><span class="o">[]</span> <span class="n">recLabel</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="na">recallByLabel</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">double</span> <span class="n">rec</span> <span class="o">:</span> <span class="n">recLabel</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;label &quot;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">rec</span><span class="o">);</span>
    <span class="n">i</span><span class="o">++;</span>
<span class="o">}</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;F-measure by label:&quot;</span><span class="o">);</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="kt">double</span><span class="o">[]</span> <span class="n">fLabel</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="na">fMeasureByLabel</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">double</span> <span class="n">f</span> <span class="o">:</span> <span class="n">fLabel</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;label &quot;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">f</span><span class="o">);</span>
    <span class="n">i</span><span class="o">++;</span>
<span class="o">}</span>

<span class="kt">double</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="na">accuracy</span><span class="o">();</span>
<span class="kt">double</span> <span class="n">falsePositiveRate</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="na">weightedFalsePositiveRate</span><span class="o">();</span>
<span class="kt">double</span> <span class="n">truePositiveRate</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="na">weightedTruePositiveRate</span><span class="o">();</span>
<span class="kt">double</span> <span class="n">fMeasure</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="na">weightedFMeasure</span><span class="o">();</span>
<span class="kt">double</span> <span class="n">precision</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="na">weightedPrecision</span><span class="o">();</span>
<span class="kt">double</span> <span class="n">recall</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="na">weightedRecall</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Accuracy: &quot;</span> <span class="o">+</span> <span class="n">accuracy</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;FPR: &quot;</span> <span class="o">+</span> <span class="n">falsePositiveRate</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;TPR: &quot;</span> <span class="o">+</span> <span class="n">truePositiveRate</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;F-measure: &quot;</span> <span class="o">+</span> <span class="n">fMeasure</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Precision: &quot;</span> <span class="o">+</span> <span class="n">precision</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Recall: &quot;</span> <span class="o">+</span> <span class="n">recall</span><span class="o">);</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / java / org / apache / spark / examples / ml / JavaMulticlassLogisticRegressionWithElasticNetExample.java”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="python">
    <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="c1"># Load training data</span>
<span class="n">training</span> <span class="o">=</span> <span class="n">spark</span> \
    <span class="o">.</span><span class="n">read</span> \
    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;libsvm&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/mllib/sample_multiclass_classification_data.txt&quot;</span><span class="p">)</span>

<span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">maxIter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">regParam</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">elasticNetParam</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

<span class="c1"># Fit the model</span>
<span class="n">lrModel</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training</span><span class="p">)</span>

<span class="c1"># Print the coefficients and intercept for multinomial logistic regression</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Coefficients: </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lrModel</span><span class="o">.</span><span class="n">coefficientMatrix</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Intercept: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lrModel</span><span class="o">.</span><span class="n">interceptVector</span><span class="p">))</span>

<span class="n">trainingSummary</span> <span class="o">=</span> <span class="n">lrModel</span><span class="o">.</span><span class="n">summary</span>

<span class="c1"># Obtain the objective per iteration</span>
<span class="n">objectiveHistory</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">objectiveHistory</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;objectiveHistory:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">objective</span> <span class="ow">in</span> <span class="n">objectiveHistory</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span>

<span class="c1"># for multiclass, we can inspect metrics on a per-label basis</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;False positive rate by label:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trainingSummary</span><span class="o">.</span><span class="n">falsePositiveRateByLabel</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;label </span><span class="si">%d</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rate</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;True positive rate by label:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trainingSummary</span><span class="o">.</span><span class="n">truePositiveRateByLabel</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;label </span><span class="si">%d</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rate</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Precision by label:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">prec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trainingSummary</span><span class="o">.</span><span class="n">precisionByLabel</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;label </span><span class="si">%d</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">prec</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Recall by label:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trainingSummary</span><span class="o">.</span><span class="n">recallByLabel</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;label </span><span class="si">%d</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rec</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;F-measure by label:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trainingSummary</span><span class="o">.</span><span class="n">fMeasureByLabel</span><span class="p">()):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;label </span><span class="si">%d</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>

<span class="n">accuracy</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">accuracy</span>
<span class="n">falsePositiveRate</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">weightedFalsePositiveRate</span>
<span class="n">truePositiveRate</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">weightedTruePositiveRate</span>
<span class="n">fMeasure</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">weightedFMeasure</span><span class="p">()</span>
<span class="n">precision</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">weightedPrecision</span>
<span class="n">recall</span> <span class="o">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">weightedRecall</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Accuracy: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">FPR: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">TPR: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">F-measure: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">Precision: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">Recall: </span><span class="si">%s</span><span class="s2">&quot;</span>
      <span class="o">%</span> <span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">falsePositiveRate</span><span class="p">,</span> <span class="n">truePositiveRate</span><span class="p">,</span> <span class="n">fMeasure</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">))</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / python / ml / multiclass_logistic_regression_with_elastic_net.py”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="r">

    <p>有关参数的更多详细信息，请参见<a href="api/R/spark.logit.html">R API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="c1"># Load training data</span>
df <span class="o">&lt;-</span> read.df<span class="p">(</span><span class="s">&quot;data/mllib/sample_multiclass_classification_data.txt&quot;</span><span class="p">,</span> <span class="kn">source</span> <span class="o">=</span> <span class="s">&quot;libsvm&quot;</span><span class="p">)</span>
training <span class="o">&lt;-</span> df
test <span class="o">&lt;-</span> df

<span class="c1"># Fit a multinomial logistic regression model with spark.logit</span>
model <span class="o">&lt;-</span> spark.logit<span class="p">(</span>training<span class="p">,</span> label <span class="o">~</span> features<span class="p">,</span> maxIter <span class="o">=</span> <span class="m">10</span><span class="p">,</span> regParam <span class="o">=</span> <span class="m">0.3</span><span class="p">,</span> elasticNetParam <span class="o">=</span> <span class="m">0.8</span><span class="p">)</span>

<span class="c1"># Model summary</span>
<span class="kp">summary</span><span class="p">(</span>model<span class="p">)</span>

<span class="c1"># Prediction</span>
predictions <span class="o">&lt;-</span> predict<span class="p">(</span>model<span class="p">,</span> test<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>predictions<span class="p">)</span>
</pre></div>
    <div><small>在“ examples / src / main / r / ml / logit中找到完整的示例代码。Spark仓库中的R”。</small></div>
  </div>

</div>

<h2 id="decision-tree-classifier">决策树分类器</h2>

<p>决策树是流行的分类和回归方法系列。有关的更多信息<code>spark.ml</code>有关实现的更多信息，请参见<a href="#decision-trees">决策树部分</a> 。</p>

<p><strong>例子</strong></p>

<p>以下示例以LibSVM格式加载数据集，将其分为训练集和测试集，在第一个数据集上进行训练，然后对保留的测试集进行评估。我们使用两个特征转换器准备数据。这些帮助为标签和分类功能的索引类别，将元数据添加到<code>DataFrame</code>决策树算法可以识别的内容。</p>

<div class="codetabs">
<div data-lang="scala">

    <p>有关参数的更多详细信息，请参见<a href="api/scala/index.html#org.apache.spark.ml.classification.DecisionTreeClassifier">Scala API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.classification.DecisionTreeClassificationModel</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.classification.DecisionTreeClassifier</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.</span><span class="o">{</span><span class="nc">IndexToString</span><span class="o">,</span> <span class="nc">StringIndexer</span><span class="o">,</span> <span class="nc">VectorIndexer</span><span class="o">}</span>

<span class="c1">// Load the data stored in LIBSVM format as a DataFrame.</span>
<span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="o">)</span>

<span class="c1">// Index labels, adding metadata to the label column.</span>
<span class="c1">// Fit on whole dataset to include all labels in index.</span>
<span class="k">val</span> <span class="n">labelIndexer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">StringIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setInputCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setOutputCol</span><span class="o">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
<span class="c1">// Automatically identify categorical features, and index them.</span>
<span class="k">val</span> <span class="n">featureIndexer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">VectorIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setInputCol</span><span class="o">(</span><span class="s">&quot;features&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setOutputCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setMaxCategories</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="c1">// features with &gt; 4 distinct values are treated as continuous.</span>
  <span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>

<span class="c1">// Split the data into training and test sets (30% held out for testing).</span>
<span class="k">val</span> <span class="nc">Array</span><span class="o">(</span><span class="n">trainingData</span><span class="o">,</span> <span class="n">testData</span><span class="o">)</span> <span class="k">=</span> <span class="n">data</span><span class="o">.</span><span class="n">randomSplit</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mf">0.7</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">))</span>

<span class="c1">// Train a DecisionTree model.</span>
<span class="k">val</span> <span class="n">dt</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">DecisionTreeClassifier</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setLabelCol</span><span class="o">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setFeaturesCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>

<span class="c1">// Convert indexed labels back to original labels.</span>
<span class="k">val</span> <span class="n">labelConverter</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">IndexToString</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setInputCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setOutputCol</span><span class="o">(</span><span class="s">&quot;predictedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setLabels</span><span class="o">(</span><span class="n">labelIndexer</span><span class="o">.</span><span class="n">labels</span><span class="o">)</span>

<span class="c1">// Chain indexers and tree in a Pipeline.</span>
<span class="k">val</span> <span class="n">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="n">labelIndexer</span><span class="o">,</span> <span class="n">featureIndexer</span><span class="o">,</span> <span class="n">dt</span><span class="o">,</span> <span class="n">labelConverter</span><span class="o">))</span>

<span class="c1">// Train model. This also runs the indexers.</span>
<span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">trainingData</span><span class="o">)</span>

<span class="c1">// Make predictions.</span>
<span class="k">val</span> <span class="n">predictions</span> <span class="k">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="o">(</span><span class="n">testData</span><span class="o">)</span>

<span class="c1">// Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">&quot;predictedLabel&quot;</span><span class="o">,</span> <span class="s">&quot;label&quot;</span><span class="o">,</span> <span class="s">&quot;features&quot;</span><span class="o">).</span><span class="n">show</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>

<span class="c1">// Select (prediction, true label) and compute test error.</span>
<span class="k">val</span> <span class="n">evaluator</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MulticlassClassificationEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setLabelCol</span><span class="o">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setPredictionCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setMetricName</span><span class="o">(</span><span class="s">&quot;accuracy&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">accuracy</span> <span class="k">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="o">(</span><span class="n">predictions</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Test Error = </span><span class="si">${</span><span class="o">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">accuracy</span><span class="o">)</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">treeModel</span> <span class="k">=</span> <span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">DecisionTreeClassificationModel</span><span class="o">]</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Learned classification tree model:\n </span><span class="si">${</span><span class="n">treeModel</span><span class="o">.</span><span class="n">toDebugString</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / scala / org / apache / spark / examples / ml / DecisionTreeClassificationExample.scala”中找到完整的示例代码。</small></div>

  </div>

<div data-lang="java">

    <p>有关参数的更多详细信息，请参见<a href="api/java/org/apache/spark/ml/classification/DecisionTreeClassifier.html">Java API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.PipelineModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.PipelineStage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.DecisionTreeClassifier</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.DecisionTreeClassificationModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>

<span class="c1">// Load the data stored in LIBSVM format as a DataFrame.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">spark</span>
  <span class="o">.</span><span class="na">read</span><span class="o">()</span>
  <span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="o">);</span>

<span class="c1">// Index labels, adding metadata to the label column.</span>
<span class="c1">// Fit on whole dataset to include all labels in index.</span>
<span class="n">StringIndexerModel</span> <span class="n">labelIndexer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>

<span class="c1">// Automatically identify categorical features, and index them.</span>
<span class="n">VectorIndexerModel</span> <span class="n">featureIndexer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VectorIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">&quot;features&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMaxCategories</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="c1">// features with &gt; 4 distinct values are treated as continuous.</span>
  <span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>

<span class="c1">// Split the data into training and test sets (30% held out for testing).</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;[]</span> <span class="n">splits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">randomSplit</span><span class="o">(</span><span class="k">new</span> <span class="kt">double</span><span class="o">[]{</span><span class="mf">0.7</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">});</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">trainingData</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">testData</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>

<span class="c1">// Train a DecisionTree model.</span>
<span class="n">DecisionTreeClassifier</span> <span class="n">dt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DecisionTreeClassifier</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setLabelCol</span><span class="o">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setFeaturesCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">);</span>

<span class="c1">// Convert indexed labels back to original labels.</span>
<span class="n">IndexToString</span> <span class="n">labelConverter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IndexToString</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">&quot;predictedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setLabels</span><span class="o">(</span><span class="n">labelIndexer</span><span class="o">.</span><span class="na">labels</span><span class="o">());</span>

<span class="c1">// Chain indexers and tree in a Pipeline.</span>
<span class="n">Pipeline</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Pipeline</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setStages</span><span class="o">(</span><span class="k">new</span> <span class="n">PipelineStage</span><span class="o">[]{</span><span class="n">labelIndexer</span><span class="o">,</span> <span class="n">featureIndexer</span><span class="o">,</span> <span class="n">dt</span><span class="o">,</span> <span class="n">labelConverter</span><span class="o">});</span>

<span class="c1">// Train model. This also runs the indexers.</span>
<span class="n">PipelineModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">trainingData</span><span class="o">);</span>

<span class="c1">// Make predictions.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">testData</span><span class="o">);</span>

<span class="c1">// Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;predictedLabel&quot;</span><span class="o">,</span> <span class="s">&quot;label&quot;</span><span class="o">,</span> <span class="s">&quot;features&quot;</span><span class="o">).</span><span class="na">show</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>

<span class="c1">// Select (prediction, true label) and compute test error.</span>
<span class="n">MulticlassClassificationEvaluator</span> <span class="n">evaluator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MulticlassClassificationEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setLabelCol</span><span class="o">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setPredictionCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMetricName</span><span class="o">(</span><span class="s">&quot;accuracy&quot;</span><span class="o">);</span>
<span class="kt">double</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">predictions</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Test Error = &quot;</span> <span class="o">+</span> <span class="o">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">accuracy</span><span class="o">));</span>

<span class="n">DecisionTreeClassificationModel</span> <span class="n">treeModel</span> <span class="o">=</span>
  <span class="o">(</span><span class="n">DecisionTreeClassificationModel</span><span class="o">)</span> <span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="na">stages</span><span class="o">()[</span><span class="mi">2</span><span class="o">]);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Learned classification tree model:\n&quot;</span> <span class="o">+</span> <span class="n">treeModel</span><span class="o">.</span><span class="na">toDebugString</span><span class="o">());</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / java / org / apache / spark / examples / ml / JavaDecisionTreeClassificationExample.java”中找到完整的示例代码。</small></div>

  </div>

<div data-lang="python">

    <p>有关参数的更多详细信息，请参见<a href="api/python/pyspark.ml.html#pyspark.ml.classification.DecisionTreeClassifier">Python API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">StringIndexer</span><span class="p">,</span> <span class="n">VectorIndexer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.evaluation</span> <span class="kn">import</span> <span class="n">MulticlassClassificationEvaluator</span>

<span class="c1"># Load the data stored in LIBSVM format as a DataFrame.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;libsvm&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="p">)</span>

<span class="c1"># Index labels, adding metadata to the label column.</span>
<span class="c1"># Fit on whole dataset to include all labels in index.</span>
<span class="n">labelIndexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;indexedLabel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># Automatically identify categorical features, and index them.</span>
<span class="c1"># We specify maxCategories so features with &gt; 4 distinct values are treated as continuous.</span>
<span class="n">featureIndexer</span> <span class="o">=</span>\
    <span class="n">VectorIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;indexedFeatures&quot;</span><span class="p">,</span> <span class="n">maxCategories</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Split the data into training and test sets (30% held out for testing)</span>
<span class="p">(</span><span class="n">trainingData</span><span class="p">,</span> <span class="n">testData</span><span class="p">)</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>

<span class="c1"># Train a DecisionTree model.</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">labelCol</span><span class="o">=</span><span class="s2">&quot;indexedLabel&quot;</span><span class="p">,</span> <span class="n">featuresCol</span><span class="o">=</span><span class="s2">&quot;indexedFeatures&quot;</span><span class="p">)</span>

<span class="c1"># Chain indexers and tree in a Pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">labelIndexer</span><span class="p">,</span> <span class="n">featureIndexer</span><span class="p">,</span> <span class="n">dt</span><span class="p">])</span>

<span class="c1"># Train model.  This also runs the indexers.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainingData</span><span class="p">)</span>

<span class="c1"># Make predictions.</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">testData</span><span class="p">)</span>

<span class="c1"># Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="s2">&quot;indexedLabel&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Select (prediction, true label) and compute test error</span>
<span class="n">evaluator</span> <span class="o">=</span> <span class="n">MulticlassClassificationEvaluator</span><span class="p">(</span>
    <span class="n">labelCol</span><span class="o">=</span><span class="s2">&quot;indexedLabel&quot;</span><span class="p">,</span> <span class="n">predictionCol</span><span class="o">=</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="n">metricName</span><span class="o">=</span><span class="s2">&quot;accuracy&quot;</span><span class="p">)</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Test Error = </span><span class="si">%g</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">accuracy</span><span class="p">))</span>

<span class="n">treeModel</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="c1"># summary only</span>
<span class="k">print</span><span class="p">(</span><span class="n">treeModel</span><span class="p">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / python / ml / decision_tree_classification_example.py”中找到完整的示例代码。</small></div>

  </div>

<div data-lang="r">

    <p>有关更多详细信息，请参考<a href="api/R/spark.decisionTree.html">R API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="c1"># Load training data</span>
df <span class="o">&lt;-</span> read.df<span class="p">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="p">,</span> <span class="kn">source</span> <span class="o">=</span> <span class="s">&quot;libsvm&quot;</span><span class="p">)</span>
training <span class="o">&lt;-</span> df
test <span class="o">&lt;-</span> df

<span class="c1"># Fit a DecisionTree classification model with spark.decisionTree</span>
model <span class="o">&lt;-</span> spark.decisionTree<span class="p">(</span>training<span class="p">,</span> label <span class="o">~</span> features<span class="p">,</span> <span class="s">&quot;classification&quot;</span><span class="p">)</span>

<span class="c1"># Model summary</span>
<span class="kp">summary</span><span class="p">(</span>model<span class="p">)</span>

<span class="c1"># Prediction</span>
predictions <span class="o">&lt;-</span> predict<span class="p">(</span>model<span class="p">,</span> test<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>predictions<span class="p">)</span>
</pre></div>
    <div><small>在“ examples / src / main / r / ml / decisionTree中找到完整的示例代码。Spark仓库中的R”。</small></div>

  </div>

</div>

<h2 id="random-forest-classifier">随机森林分类器</h2>

<p>随机森林是一种流行的分类和回归方法系列。有关的更多信息<code>spark.ml</code>有关实现的更多信息，请参见<a href="#random-forests">随机森林部分</a> 。</p>

<p><strong>例子</strong></p>

<p>以下示例以LibSVM格式加载数据集，将其分为训练集和测试集，在第一个数据集上进行训练，然后对保留的测试集进行评估。我们使用两个特征转换器准备数据。这些帮助为标签和分类功能的索引类别，将元数据添加到<code>DataFrame</code>基于树的算法可以识别。</p>

<div class="codetabs">
<div data-lang="scala">

    <p>有关更多详细信息，请参考<a href="api/scala/index.html#org.apache.spark.ml.classification.RandomForestClassifier">Scala API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.classification.</span><span class="o">{</span><span class="nc">RandomForestClassificationModel</span><span class="o">,</span> <span class="nc">RandomForestClassifier</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.</span><span class="o">{</span><span class="nc">IndexToString</span><span class="o">,</span> <span class="nc">StringIndexer</span><span class="o">,</span> <span class="nc">VectorIndexer</span><span class="o">}</span>

<span class="c1">// Load and parse the data file, converting it to a DataFrame.</span>
<span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="o">)</span>

<span class="c1">// Index labels, adding metadata to the label column.</span>
<span class="c1">// Fit on whole dataset to include all labels in index.</span>
<span class="k">val</span> <span class="n">labelIndexer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">StringIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setInputCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setOutputCol</span><span class="o">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
<span class="c1">// Automatically identify categorical features, and index them.</span>
<span class="c1">// Set maxCategories so features with &gt; 4 distinct values are treated as continuous.</span>
<span class="k">val</span> <span class="n">featureIndexer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">VectorIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setInputCol</span><span class="o">(</span><span class="s">&quot;features&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setOutputCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setMaxCategories</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
  <span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>

<span class="c1">// Split the data into training and test sets (30% held out for testing).</span>
<span class="k">val</span> <span class="nc">Array</span><span class="o">(</span><span class="n">trainingData</span><span class="o">,</span> <span class="n">testData</span><span class="o">)</span> <span class="k">=</span> <span class="n">data</span><span class="o">.</span><span class="n">randomSplit</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mf">0.7</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">))</span>

<span class="c1">// Train a RandomForest model.</span>
<span class="k">val</span> <span class="n">rf</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">RandomForestClassifier</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setLabelCol</span><span class="o">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setFeaturesCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setNumTrees</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>

<span class="c1">// Convert indexed labels back to original labels.</span>
<span class="k">val</span> <span class="n">labelConverter</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">IndexToString</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setInputCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setOutputCol</span><span class="o">(</span><span class="s">&quot;predictedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setLabels</span><span class="o">(</span><span class="n">labelIndexer</span><span class="o">.</span><span class="n">labels</span><span class="o">)</span>

<span class="c1">// Chain indexers and forest in a Pipeline.</span>
<span class="k">val</span> <span class="n">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="n">labelIndexer</span><span class="o">,</span> <span class="n">featureIndexer</span><span class="o">,</span> <span class="n">rf</span><span class="o">,</span> <span class="n">labelConverter</span><span class="o">))</span>

<span class="c1">// Train model. This also runs the indexers.</span>
<span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">trainingData</span><span class="o">)</span>

<span class="c1">// Make predictions.</span>
<span class="k">val</span> <span class="n">predictions</span> <span class="k">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="o">(</span><span class="n">testData</span><span class="o">)</span>

<span class="c1">// Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">&quot;predictedLabel&quot;</span><span class="o">,</span> <span class="s">&quot;label&quot;</span><span class="o">,</span> <span class="s">&quot;features&quot;</span><span class="o">).</span><span class="n">show</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>

<span class="c1">// Select (prediction, true label) and compute test error.</span>
<span class="k">val</span> <span class="n">evaluator</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MulticlassClassificationEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setLabelCol</span><span class="o">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setPredictionCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setMetricName</span><span class="o">(</span><span class="s">&quot;accuracy&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">accuracy</span> <span class="k">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="o">(</span><span class="n">predictions</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Test Error = </span><span class="si">${</span><span class="o">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">accuracy</span><span class="o">)</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">rfModel</span> <span class="k">=</span> <span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">RandomForestClassificationModel</span><span class="o">]</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Learned classification forest model:\n </span><span class="si">${</span><span class="n">rfModel</span><span class="o">.</span><span class="n">toDebugString</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / scala / org / apache / spark / examples / ml / RandomForestClassifierExample.scala”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="java">

    <p>有关更多详细信息，请参考<a href="api/java/org/apache/spark/ml/classification/RandomForestClassifier.html">Java API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.PipelineModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.PipelineStage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.RandomForestClassificationModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.RandomForestClassifier</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>

<span class="c1">// Load and parse the data file, converting it to a DataFrame.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">).</span><span class="na">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="o">);</span>

<span class="c1">// Index labels, adding metadata to the label column.</span>
<span class="c1">// Fit on whole dataset to include all labels in index.</span>
<span class="n">StringIndexerModel</span> <span class="n">labelIndexer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
<span class="c1">// Automatically identify categorical features, and index them.</span>
<span class="c1">// Set maxCategories so features with &gt; 4 distinct values are treated as continuous.</span>
<span class="n">VectorIndexerModel</span> <span class="n">featureIndexer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VectorIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">&quot;features&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMaxCategories</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>

<span class="c1">// Split the data into training and test sets (30% held out for testing)</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;[]</span> <span class="n">splits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">randomSplit</span><span class="o">(</span><span class="k">new</span> <span class="kt">double</span><span class="o">[]</span> <span class="o">{</span><span class="mf">0.7</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">});</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">trainingData</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">testData</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>

<span class="c1">// Train a RandomForest model.</span>
<span class="n">RandomForestClassifier</span> <span class="n">rf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RandomForestClassifier</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setLabelCol</span><span class="o">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setFeaturesCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">);</span>

<span class="c1">// Convert indexed labels back to original labels.</span>
<span class="n">IndexToString</span> <span class="n">labelConverter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IndexToString</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">&quot;predictedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setLabels</span><span class="o">(</span><span class="n">labelIndexer</span><span class="o">.</span><span class="na">labels</span><span class="o">());</span>

<span class="c1">// Chain indexers and forest in a Pipeline</span>
<span class="n">Pipeline</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Pipeline</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setStages</span><span class="o">(</span><span class="k">new</span> <span class="n">PipelineStage</span><span class="o">[]</span> <span class="o">{</span><span class="n">labelIndexer</span><span class="o">,</span> <span class="n">featureIndexer</span><span class="o">,</span> <span class="n">rf</span><span class="o">,</span> <span class="n">labelConverter</span><span class="o">});</span>

<span class="c1">// Train model. This also runs the indexers.</span>
<span class="n">PipelineModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">trainingData</span><span class="o">);</span>

<span class="c1">// Make predictions.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">testData</span><span class="o">);</span>

<span class="c1">// Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;predictedLabel&quot;</span><span class="o">,</span> <span class="s">&quot;label&quot;</span><span class="o">,</span> <span class="s">&quot;features&quot;</span><span class="o">).</span><span class="na">show</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>

<span class="c1">// Select (prediction, true label) and compute test error</span>
<span class="n">MulticlassClassificationEvaluator</span> <span class="n">evaluator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MulticlassClassificationEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setLabelCol</span><span class="o">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setPredictionCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMetricName</span><span class="o">(</span><span class="s">&quot;accuracy&quot;</span><span class="o">);</span>
<span class="kt">double</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">predictions</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Test Error = &quot;</span> <span class="o">+</span> <span class="o">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">accuracy</span><span class="o">));</span>

<span class="n">RandomForestClassificationModel</span> <span class="n">rfModel</span> <span class="o">=</span> <span class="o">(</span><span class="n">RandomForestClassificationModel</span><span class="o">)(</span><span class="n">model</span><span class="o">.</span><span class="na">stages</span><span class="o">()[</span><span class="mi">2</span><span class="o">]);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Learned classification forest model:\n&quot;</span> <span class="o">+</span> <span class="n">rfModel</span><span class="o">.</span><span class="na">toDebugString</span><span class="o">());</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / java / org / apache / spark / examples / ml / JavaRandomForestClassifierExample.java”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="python">

    <p>有关更多详细信息，请参考<a href="api/python/pyspark.ml.html#pyspark.ml.classification.RandomForestClassifier">Python API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">IndexToString</span><span class="p">,</span> <span class="n">StringIndexer</span><span class="p">,</span> <span class="n">VectorIndexer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.evaluation</span> <span class="kn">import</span> <span class="n">MulticlassClassificationEvaluator</span>

<span class="c1"># Load and parse the data file, converting it to a DataFrame.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;libsvm&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="p">)</span>

<span class="c1"># Index labels, adding metadata to the label column.</span>
<span class="c1"># Fit on whole dataset to include all labels in index.</span>
<span class="n">labelIndexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;indexedLabel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Automatically identify categorical features, and index them.</span>
<span class="c1"># Set maxCategories so features with &gt; 4 distinct values are treated as continuous.</span>
<span class="n">featureIndexer</span> <span class="o">=</span>\
    <span class="n">VectorIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;indexedFeatures&quot;</span><span class="p">,</span> <span class="n">maxCategories</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Split the data into training and test sets (30% held out for testing)</span>
<span class="p">(</span><span class="n">trainingData</span><span class="p">,</span> <span class="n">testData</span><span class="p">)</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>

<span class="c1"># Train a RandomForest model.</span>
<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">labelCol</span><span class="o">=</span><span class="s2">&quot;indexedLabel&quot;</span><span class="p">,</span> <span class="n">featuresCol</span><span class="o">=</span><span class="s2">&quot;indexedFeatures&quot;</span><span class="p">,</span> <span class="n">numTrees</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Convert indexed labels back to original labels.</span>
<span class="n">labelConverter</span> <span class="o">=</span> <span class="n">IndexToString</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;predictedLabel&quot;</span><span class="p">,</span>
                               <span class="n">labels</span><span class="o">=</span><span class="n">labelIndexer</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>

<span class="c1"># Chain indexers and forest in a Pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">labelIndexer</span><span class="p">,</span> <span class="n">featureIndexer</span><span class="p">,</span> <span class="n">rf</span><span class="p">,</span> <span class="n">labelConverter</span><span class="p">])</span>

<span class="c1"># Train model.  This also runs the indexers.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainingData</span><span class="p">)</span>

<span class="c1"># Make predictions.</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">testData</span><span class="p">)</span>

<span class="c1"># Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;predictedLabel&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Select (prediction, true label) and compute test error</span>
<span class="n">evaluator</span> <span class="o">=</span> <span class="n">MulticlassClassificationEvaluator</span><span class="p">(</span>
    <span class="n">labelCol</span><span class="o">=</span><span class="s2">&quot;indexedLabel&quot;</span><span class="p">,</span> <span class="n">predictionCol</span><span class="o">=</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="n">metricName</span><span class="o">=</span><span class="s2">&quot;accuracy&quot;</span><span class="p">)</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Test Error = </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">accuracy</span><span class="p">))</span>

<span class="n">rfModel</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">rfModel</span><span class="p">)</span>  <span class="c1"># summary only</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / python / ml / random_forest_classifier_example.py”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="r">

    <p>有关更多详细信息，请参考<a href="api/R/spark.randomForest.html">R API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="c1"># Load training data</span>
df <span class="o">&lt;-</span> read.df<span class="p">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="p">,</span> <span class="kn">source</span> <span class="o">=</span> <span class="s">&quot;libsvm&quot;</span><span class="p">)</span>
training <span class="o">&lt;-</span> df
test <span class="o">&lt;-</span> df

<span class="c1"># Fit a random forest classification model with spark.randomForest</span>
model <span class="o">&lt;-</span> spark.randomForest<span class="p">(</span>training<span class="p">,</span> label <span class="o">~</span> features<span class="p">,</span> <span class="s">&quot;classification&quot;</span><span class="p">,</span> numTrees <span class="o">=</span> <span class="m">10</span><span class="p">)</span>

<span class="c1"># Model summary</span>
<span class="kp">summary</span><span class="p">(</span>model<span class="p">)</span>

<span class="c1"># Prediction</span>
predictions <span class="o">&lt;-</span> predict<span class="p">(</span>model<span class="p">,</span> test<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>predictions<span class="p">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / r / ml / randomForest.R”中找到完整的示例代码。</small></div>
  </div>

</div>

<h2 id="gradient-boosted-tree-classifier">梯度提升树分类器</h2>

<p>梯度增强树（GBT）是一种使用决策树集合的流行分类和回归方法。有关的更多信息<code>spark.ml</code>有关实现的更多信息，请<a href="#gradient-boosted-trees-gbts">参见GBT部分</a> 。</p>

<p><strong>例子</strong></p>

<p>以下示例以LibSVM格式加载数据集，将其分为训练集和测试集，在第一个数据集上进行训练，然后对保留的测试集进行评估。我们使用两个特征转换器准备数据。这些帮助为标签和分类功能的索引类别，将元数据添加到<code>DataFrame</code>基于树的算法可以识别。</p>

<div class="codetabs">
<div data-lang="scala">

    <p>有关更多详细信息，请参考<a href="api/scala/index.html#org.apache.spark.ml.classification.GBTClassifier">Scala API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.classification.</span><span class="o">{</span><span class="nc">GBTClassificationModel</span><span class="o">,</span> <span class="nc">GBTClassifier</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.</span><span class="o">{</span><span class="nc">IndexToString</span><span class="o">,</span> <span class="nc">StringIndexer</span><span class="o">,</span> <span class="nc">VectorIndexer</span><span class="o">}</span>

<span class="c1">// Load and parse the data file, converting it to a DataFrame.</span>
<span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="o">)</span>

<span class="c1">// Index labels, adding metadata to the label column.</span>
<span class="c1">// Fit on whole dataset to include all labels in index.</span>
<span class="k">val</span> <span class="n">labelIndexer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">StringIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setInputCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setOutputCol</span><span class="o">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
<span class="c1">// Automatically identify categorical features, and index them.</span>
<span class="c1">// Set maxCategories so features with &gt; 4 distinct values are treated as continuous.</span>
<span class="k">val</span> <span class="n">featureIndexer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">VectorIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setInputCol</span><span class="o">(</span><span class="s">&quot;features&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setOutputCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setMaxCategories</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
  <span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>

<span class="c1">// Split the data into training and test sets (30% held out for testing).</span>
<span class="k">val</span> <span class="nc">Array</span><span class="o">(</span><span class="n">trainingData</span><span class="o">,</span> <span class="n">testData</span><span class="o">)</span> <span class="k">=</span> <span class="n">data</span><span class="o">.</span><span class="n">randomSplit</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mf">0.7</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">))</span>

<span class="c1">// Train a GBT model.</span>
<span class="k">val</span> <span class="n">gbt</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">GBTClassifier</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setLabelCol</span><span class="o">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setFeaturesCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setMaxIter</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setFeatureSubsetStrategy</span><span class="o">(</span><span class="s">&quot;auto&quot;</span><span class="o">)</span>

<span class="c1">// Convert indexed labels back to original labels.</span>
<span class="k">val</span> <span class="n">labelConverter</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">IndexToString</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setInputCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setOutputCol</span><span class="o">(</span><span class="s">&quot;predictedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setLabels</span><span class="o">(</span><span class="n">labelIndexer</span><span class="o">.</span><span class="n">labels</span><span class="o">)</span>

<span class="c1">// Chain indexers and GBT in a Pipeline.</span>
<span class="k">val</span> <span class="n">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="n">labelIndexer</span><span class="o">,</span> <span class="n">featureIndexer</span><span class="o">,</span> <span class="n">gbt</span><span class="o">,</span> <span class="n">labelConverter</span><span class="o">))</span>

<span class="c1">// Train model. This also runs the indexers.</span>
<span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">trainingData</span><span class="o">)</span>

<span class="c1">// Make predictions.</span>
<span class="k">val</span> <span class="n">predictions</span> <span class="k">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="o">(</span><span class="n">testData</span><span class="o">)</span>

<span class="c1">// Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">&quot;predictedLabel&quot;</span><span class="o">,</span> <span class="s">&quot;label&quot;</span><span class="o">,</span> <span class="s">&quot;features&quot;</span><span class="o">).</span><span class="n">show</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>

<span class="c1">// Select (prediction, true label) and compute test error.</span>
<span class="k">val</span> <span class="n">evaluator</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MulticlassClassificationEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setLabelCol</span><span class="o">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setPredictionCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setMetricName</span><span class="o">(</span><span class="s">&quot;accuracy&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">accuracy</span> <span class="k">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="o">(</span><span class="n">predictions</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Test Error = </span><span class="si">${</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">accuracy</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">gbtModel</span> <span class="k">=</span> <span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">GBTClassificationModel</span><span class="o">]</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Learned classification GBT model:\n </span><span class="si">${</span><span class="n">gbtModel</span><span class="o">.</span><span class="n">toDebugString</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / scala / org / apache / spark / examples / ml / GradientBoostedTreeClassifierExample.scala”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="java">

    <p>有关更多详细信息，请参考<a href="api/java/org/apache/spark/ml/classification/GBTClassifier.html">Java API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.PipelineModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.PipelineStage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.GBTClassificationModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.GBTClassifier</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>

<span class="c1">// Load and parse the data file, converting it to a DataFrame.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">spark</span>
  <span class="o">.</span><span class="na">read</span><span class="o">()</span>
  <span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="o">);</span>

<span class="c1">// Index labels, adding metadata to the label column.</span>
<span class="c1">// Fit on whole dataset to include all labels in index.</span>
<span class="n">StringIndexerModel</span> <span class="n">labelIndexer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
<span class="c1">// Automatically identify categorical features, and index them.</span>
<span class="c1">// Set maxCategories so features with &gt; 4 distinct values are treated as continuous.</span>
<span class="n">VectorIndexerModel</span> <span class="n">featureIndexer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VectorIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">&quot;features&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMaxCategories</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>

<span class="c1">// Split the data into training and test sets (30% held out for testing)</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;[]</span> <span class="n">splits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">randomSplit</span><span class="o">(</span><span class="k">new</span> <span class="kt">double</span><span class="o">[]</span> <span class="o">{</span><span class="mf">0.7</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">});</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">trainingData</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">testData</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>

<span class="c1">// Train a GBT model.</span>
<span class="n">GBTClassifier</span> <span class="n">gbt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GBTClassifier</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setLabelCol</span><span class="o">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setFeaturesCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMaxIter</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>

<span class="c1">// Convert indexed labels back to original labels.</span>
<span class="n">IndexToString</span> <span class="n">labelConverter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IndexToString</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">&quot;predictedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setLabels</span><span class="o">(</span><span class="n">labelIndexer</span><span class="o">.</span><span class="na">labels</span><span class="o">());</span>

<span class="c1">// Chain indexers and GBT in a Pipeline.</span>
<span class="n">Pipeline</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Pipeline</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setStages</span><span class="o">(</span><span class="k">new</span> <span class="n">PipelineStage</span><span class="o">[]</span> <span class="o">{</span><span class="n">labelIndexer</span><span class="o">,</span> <span class="n">featureIndexer</span><span class="o">,</span> <span class="n">gbt</span><span class="o">,</span> <span class="n">labelConverter</span><span class="o">});</span>

<span class="c1">// Train model. This also runs the indexers.</span>
<span class="n">PipelineModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">trainingData</span><span class="o">);</span>

<span class="c1">// Make predictions.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">testData</span><span class="o">);</span>

<span class="c1">// Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;predictedLabel&quot;</span><span class="o">,</span> <span class="s">&quot;label&quot;</span><span class="o">,</span> <span class="s">&quot;features&quot;</span><span class="o">).</span><span class="na">show</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>

<span class="c1">// Select (prediction, true label) and compute test error.</span>
<span class="n">MulticlassClassificationEvaluator</span> <span class="n">evaluator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MulticlassClassificationEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setLabelCol</span><span class="o">(</span><span class="s">&quot;indexedLabel&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setPredictionCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMetricName</span><span class="o">(</span><span class="s">&quot;accuracy&quot;</span><span class="o">);</span>
<span class="kt">double</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">predictions</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Test Error = &quot;</span> <span class="o">+</span> <span class="o">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">accuracy</span><span class="o">));</span>

<span class="n">GBTClassificationModel</span> <span class="n">gbtModel</span> <span class="o">=</span> <span class="o">(</span><span class="n">GBTClassificationModel</span><span class="o">)(</span><span class="n">model</span><span class="o">.</span><span class="na">stages</span><span class="o">()[</span><span class="mi">2</span><span class="o">]);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Learned classification GBT model:\n&quot;</span> <span class="o">+</span> <span class="n">gbtModel</span><span class="o">.</span><span class="na">toDebugString</span><span class="o">());</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / java / org / apache / spark / examples / ml / JavaGradientBoostedTreeClassifierExample.java”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="python">

    <p>有关更多详细信息，请参考<a href="api/python/pyspark.ml.html#pyspark.ml.classification.GBTClassifier">Python API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">GBTClassifier</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">StringIndexer</span><span class="p">,</span> <span class="n">VectorIndexer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.evaluation</span> <span class="kn">import</span> <span class="n">MulticlassClassificationEvaluator</span>

<span class="c1"># Load and parse the data file, converting it to a DataFrame.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;libsvm&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="p">)</span>

<span class="c1"># Index labels, adding metadata to the label column.</span>
<span class="c1"># Fit on whole dataset to include all labels in index.</span>
<span class="n">labelIndexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;indexedLabel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># Automatically identify categorical features, and index them.</span>
<span class="c1"># Set maxCategories so features with &gt; 4 distinct values are treated as continuous.</span>
<span class="n">featureIndexer</span> <span class="o">=</span>\
    <span class="n">VectorIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;indexedFeatures&quot;</span><span class="p">,</span> <span class="n">maxCategories</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Split the data into training and test sets (30% held out for testing)</span>
<span class="p">(</span><span class="n">trainingData</span><span class="p">,</span> <span class="n">testData</span><span class="p">)</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>

<span class="c1"># Train a GBT model.</span>
<span class="n">gbt</span> <span class="o">=</span> <span class="n">GBTClassifier</span><span class="p">(</span><span class="n">labelCol</span><span class="o">=</span><span class="s2">&quot;indexedLabel&quot;</span><span class="p">,</span> <span class="n">featuresCol</span><span class="o">=</span><span class="s2">&quot;indexedFeatures&quot;</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Chain indexers and GBT in a Pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">labelIndexer</span><span class="p">,</span> <span class="n">featureIndexer</span><span class="p">,</span> <span class="n">gbt</span><span class="p">])</span>

<span class="c1"># Train model.  This also runs the indexers.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainingData</span><span class="p">)</span>

<span class="c1"># Make predictions.</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">testData</span><span class="p">)</span>

<span class="c1"># Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="s2">&quot;indexedLabel&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Select (prediction, true label) and compute test error</span>
<span class="n">evaluator</span> <span class="o">=</span> <span class="n">MulticlassClassificationEvaluator</span><span class="p">(</span>
    <span class="n">labelCol</span><span class="o">=</span><span class="s2">&quot;indexedLabel&quot;</span><span class="p">,</span> <span class="n">predictionCol</span><span class="o">=</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="n">metricName</span><span class="o">=</span><span class="s2">&quot;accuracy&quot;</span><span class="p">)</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Test Error = </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">accuracy</span><span class="p">))</span>

<span class="n">gbtModel</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">gbtModel</span><span class="p">)</span>  <span class="c1"># summary only</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / python / ml / gradient_boosted_tree_classifier_example.py”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="r">

    <p>有关更多详细信息，请参考<a href="api/R/spark.gbt.html">R API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="c1"># Load training data</span>
df <span class="o">&lt;-</span> read.df<span class="p">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="p">,</span> <span class="kn">source</span> <span class="o">=</span> <span class="s">&quot;libsvm&quot;</span><span class="p">)</span>
training <span class="o">&lt;-</span> df
test <span class="o">&lt;-</span> df

<span class="c1"># Fit a GBT classification model with spark.gbt</span>
model <span class="o">&lt;-</span> spark.gbt<span class="p">(</span>training<span class="p">,</span> label <span class="o">~</span> features<span class="p">,</span> <span class="s">&quot;classification&quot;</span><span class="p">,</span> maxIter <span class="o">=</span> <span class="m">10</span><span class="p">)</span>

<span class="c1"># Model summary</span>
<span class="kp">summary</span><span class="p">(</span>model<span class="p">)</span>

<span class="c1"># Prediction</span>
predictions <span class="o">&lt;-</span> predict<span class="p">(</span>model<span class="p">,</span> test<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>predictions<span class="p">)</span>
</pre></div>
    <div><small>在“ examples / src / main / r / ml / gbt”中找到完整的示例代码。Spark仓库中的R”。</small></div>
  </div>

</div>

<h2 id="multilayer-perceptron-classifier">多层感知器分类器</h2>

<p>多层感知器分类器（MLPC）是基于<a href="https://en.wikipedia.org/wiki/Feedforward_neural_network">前馈人工神经网络</a>的分类器。MLPC由多层节点组成。每一层都完全连接到网络中的下一层。输入层中的节点代表输入数据。所有其他节点通过输入与节点权重的线性组合将输入映射到输出<code>$\wv$</code>和偏见<code>$\bv$</code>并应用激活功能。对于MLPC，可以用矩阵形式编写<code>$K+1$</code>图层如下： <code>\[ \mathrm{y}(\x) = \mathrm{f_K}(...\mathrm{f_2}(\wv_2^T\mathrm{f_1}(\wv_1^T \x+b_1)+b_2)...+b_K) \]</code>中间层中的节点使用S型（逻辑）功能： <code>\[ \mathrm{f}(z_i) = \frac{1}{1 + e^{-z_i}} \]</code>输出层中的节点使用softmax函数： <code>\[ \mathrm{f}(z_i) = \frac{e^{z_i}}{\sum_{k=1}^N e^{z_k}} \]</code>节点数<code>$N$</code>在输出层中对应的类数。</p>

<p>MLPC使用反向传播来学习模型。我们使用逻辑损失函数进行优化，并使用L-BFGS作为优化例程。</p>

<p><strong>例子</strong></p>

<div class="codetabs">

<div data-lang="scala">

    <p>有关更多详细信息，请参考<a href="api/scala/index.html#org.apache.spark.ml.classification.MultilayerPerceptronClassifier">Scala API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.ml.classification.MultilayerPerceptronClassifier</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator</span>

<span class="c1">// Load the data stored in LIBSVM format as a DataFrame.</span>
<span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_multiclass_classification_data.txt&quot;</span><span class="o">)</span>

<span class="c1">// Split the data into train and test</span>
<span class="k">val</span> <span class="n">splits</span> <span class="k">=</span> <span class="n">data</span><span class="o">.</span><span class="n">randomSplit</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mf">0.6</span><span class="o">,</span> <span class="mf">0.4</span><span class="o">),</span> <span class="n">seed</span> <span class="k">=</span> <span class="mi">1234L</span><span class="o">)</span>
<span class="k">val</span> <span class="n">train</span> <span class="k">=</span> <span class="n">splits</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
<span class="k">val</span> <span class="n">test</span> <span class="k">=</span> <span class="n">splits</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>

<span class="c1">// specify layers for the neural network:</span>
<span class="c1">// input layer of size 4 (features), two intermediate of size 5 and 4</span>
<span class="c1">// and output of size 3 (classes)</span>
<span class="k">val</span> <span class="n">layers</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">[</span><span class="kt">Int</span><span class="o">](</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>

<span class="c1">// create the trainer and set its parameters</span>
<span class="k">val</span> <span class="n">trainer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MultilayerPerceptronClassifier</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setLayers</span><span class="o">(</span><span class="n">layers</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setBlockSize</span><span class="o">(</span><span class="mi">128</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setSeed</span><span class="o">(</span><span class="mi">1234L</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setMaxIter</span><span class="o">(</span><span class="mi">100</span><span class="o">)</span>

<span class="c1">// train the model</span>
<span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">train</span><span class="o">)</span>

<span class="c1">// compute accuracy on the test set</span>
<span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="o">(</span><span class="n">test</span><span class="o">)</span>
<span class="k">val</span> <span class="n">predictionAndLabels</span> <span class="k">=</span> <span class="n">result</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">,</span> <span class="s">&quot;label&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">evaluator</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MulticlassClassificationEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setMetricName</span><span class="o">(</span><span class="s">&quot;accuracy&quot;</span><span class="o">)</span>

<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Test set accuracy = </span><span class="si">${</span><span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="o">(</span><span class="n">predictionAndLabels</span><span class="o">)</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / scala / org / apache / spark / examples / ml / MultilayerPerceptronClassifierExample.scala”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="java">

    <p>有关更多详细信息，请参考<a href="api/java/org/apache/spark/ml/classification/MultilayerPerceptronClassifier.html">Java API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.MultilayerPerceptronClassificationModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.MultilayerPerceptronClassifier</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator</span><span class="o">;</span>

<span class="c1">// Load training data</span>
<span class="n">String</span> <span class="n">path</span> <span class="o">=</span> <span class="s">&quot;data/mllib/sample_multiclass_classification_data.txt&quot;</span><span class="o">;</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">dataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">).</span><span class="na">load</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>

<span class="c1">// Split the data into train and test</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;[]</span> <span class="n">splits</span> <span class="o">=</span> <span class="n">dataFrame</span><span class="o">.</span><span class="na">randomSplit</span><span class="o">(</span><span class="k">new</span> <span class="kt">double</span><span class="o">[]{</span><span class="mf">0.6</span><span class="o">,</span> <span class="mf">0.4</span><span class="o">},</span> <span class="mi">1234L</span><span class="o">);</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">train</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">test</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>

<span class="c1">// specify layers for the neural network:</span>
<span class="c1">// input layer of size 4 (features), two intermediate of size 5 and 4</span>
<span class="c1">// and output of size 3 (classes)</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">layers</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">};</span>

<span class="c1">// create the trainer and set its parameters</span>
<span class="n">MultilayerPerceptronClassifier</span> <span class="n">trainer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MultilayerPerceptronClassifier</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setLayers</span><span class="o">(</span><span class="n">layers</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setBlockSize</span><span class="o">(</span><span class="mi">128</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setSeed</span><span class="o">(</span><span class="mi">1234L</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMaxIter</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>

<span class="c1">// train the model</span>
<span class="n">MultilayerPerceptronClassificationModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">train</span><span class="o">);</span>

<span class="c1">// compute accuracy on the test set</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">test</span><span class="o">);</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">predictionAndLabels</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">,</span> <span class="s">&quot;label&quot;</span><span class="o">);</span>
<span class="n">MulticlassClassificationEvaluator</span> <span class="n">evaluator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MulticlassClassificationEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setMetricName</span><span class="o">(</span><span class="s">&quot;accuracy&quot;</span><span class="o">);</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Test set accuracy = &quot;</span> <span class="o">+</span> <span class="n">evaluator</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">predictionAndLabels</span><span class="o">));</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / java / org / apache / spark / examples / ml / JavaMultilayerPerceptronClassifierExample.java”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="python">

    <p>有关更多详细信息，请参考<a href="api/python/pyspark.ml.html#pyspark.ml.classification.MultilayerPerceptronClassifier">Python API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">MultilayerPerceptronClassifier</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.evaluation</span> <span class="kn">import</span> <span class="n">MulticlassClassificationEvaluator</span>

<span class="c1"># Load training data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;libsvm&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/mllib/sample_multiclass_classification_data.txt&quot;</span><span class="p">)</span>

<span class="c1"># Split the data into train and test</span>
<span class="n">splits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="mi">1234</span><span class="p">)</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">splits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">splits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># specify layers for the neural network:</span>
<span class="c1"># input layer of size 4 (features), two intermediate of size 5 and 4</span>
<span class="c1"># and output of size 3 (classes)</span>
<span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="c1"># create the trainer and set its parameters</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">MultilayerPerceptronClassifier</span><span class="p">(</span><span class="n">maxIter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="n">layers</span><span class="p">,</span> <span class="n">blockSize</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">)</span>

<span class="c1"># train the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>

<span class="c1"># compute accuracy on the test set</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">predictionAndLabels</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">)</span>
<span class="n">evaluator</span> <span class="o">=</span> <span class="n">MulticlassClassificationEvaluator</span><span class="p">(</span><span class="n">metricName</span><span class="o">=</span><span class="s2">&quot;accuracy&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Test set accuracy = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">predictionAndLabels</span><span class="p">)))</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / python / ml / multilayer_perceptron_classification.py”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="r">

    <p>有关更多详细信息，请参考<a href="api/R/spark.mlp.html">R API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="c1"># Load training data</span>
df <span class="o">&lt;-</span> read.df<span class="p">(</span><span class="s">&quot;data/mllib/sample_multiclass_classification_data.txt&quot;</span><span class="p">,</span> <span class="kn">source</span> <span class="o">=</span> <span class="s">&quot;libsvm&quot;</span><span class="p">)</span>
training <span class="o">&lt;-</span> df
test <span class="o">&lt;-</span> df

<span class="c1"># specify layers for the neural network:</span>
<span class="c1"># input layer of size 4 (features), two intermediate of size 5 and 4</span>
<span class="c1"># and output of size 3 (classes)</span>
layers <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>

<span class="c1"># Fit a multi-layer perceptron neural network model with spark.mlp</span>
model <span class="o">&lt;-</span> spark.mlp<span class="p">(</span>training<span class="p">,</span> label <span class="o">~</span> features<span class="p">,</span> maxIter <span class="o">=</span> <span class="m">100</span><span class="p">,</span>
                   layers <span class="o">=</span> layers<span class="p">,</span> blockSize <span class="o">=</span> <span class="m">128</span><span class="p">,</span> seed <span class="o">=</span> <span class="m">1234</span><span class="p">)</span>

<span class="c1"># Model summary</span>
<span class="kp">summary</span><span class="p">(</span>model<span class="p">)</span>

<span class="c1"># Prediction</span>
predictions <span class="o">&lt;-</span> predict<span class="p">(</span>model<span class="p">,</span> test<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>predictions<span class="p">)</span>
</pre></div>
    <div><small>在“ examples / src / main / r / ml / mlp”中找到完整的示例代码。Spark仓库中的R”。</small></div>
  </div>

</div>

<h2 id="linear-support-vector-machine">线性支持向量机</h2>

<p><a href="https://en.wikipedia.org/wiki/Support_vector_machine">支持向量机</a>在高维或无限维空间中构建一个超平面或一组超平面，可用于分类，回归或其他任务。直观地，通过超平面可以实现良好的分离，该超平面到任何类别的最近训练数据点都具有最大距离（所谓的功能裕量），因为通常裕量越大，分类器的泛化误差越低。Spark ML中的LinearSVC支持使用线性SVM进行二进制分类。在内部，它使用OWLQN优化器优化<a href="https://en.wikipedia.org/wiki/Hinge_loss">铰链损耗</a> 。</p>

<p><strong>例子</strong></p>

<div class="codetabs">

<div data-lang="scala">

    <p>有关更多详细信息，请参考<a href="api/scala/index.html#org.apache.spark.ml.classification.LinearSVC">Scala API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.ml.classification.LinearSVC</span>

<span class="c1">// Load training data</span>
<span class="k">val</span> <span class="n">training</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">lsvc</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LinearSVC</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setMaxIter</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setRegParam</span><span class="o">(</span><span class="mf">0.1</span><span class="o">)</span>

<span class="c1">// Fit the model</span>
<span class="k">val</span> <span class="n">lsvcModel</span> <span class="k">=</span> <span class="n">lsvc</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">training</span><span class="o">)</span>

<span class="c1">// Print the coefficients and intercept for linear svc</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Coefficients: </span><span class="si">${</span><span class="n">lsvcModel</span><span class="o">.</span><span class="n">coefficients</span><span class="si">}</span><span class="s"> Intercept: </span><span class="si">${</span><span class="n">lsvcModel</span><span class="o">.</span><span class="n">intercept</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / scala / org / apache / spark / examples / ml / LinearSVCExample.scala”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="java">

    <p>有关更多详细信息，请参考<a href="api/java/org/apache/spark/ml/classification/LinearSVC.html">Java API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.LinearSVC</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.LinearSVCModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>

<span class="c1">// Load training data</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">training</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="o">);</span>

<span class="n">LinearSVC</span> <span class="n">lsvc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinearSVC</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setMaxIter</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setRegParam</span><span class="o">(</span><span class="mf">0.1</span><span class="o">);</span>

<span class="c1">// Fit the model</span>
<span class="n">LinearSVCModel</span> <span class="n">lsvcModel</span> <span class="o">=</span> <span class="n">lsvc</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">training</span><span class="o">);</span>

<span class="c1">// Print the coefficients and intercept for LinearSVC</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Coefficients: &quot;</span>
  <span class="o">+</span> <span class="n">lsvcModel</span><span class="o">.</span><span class="na">coefficients</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; Intercept: &quot;</span> <span class="o">+</span> <span class="n">lsvcModel</span><span class="o">.</span><span class="na">intercept</span><span class="o">());</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / java / org / apache / spark / examples / ml / JavaLinearSVCExample.java”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="python">

    <p>有关更多详细信息，请参考<a href="api/python/pyspark.ml.html#pyspark.ml.classification.LinearSVC">Python API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">LinearSVC</span>

<span class="c1"># Load training data</span>
<span class="n">training</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;libsvm&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="p">)</span>

<span class="n">lsvc</span> <span class="o">=</span> <span class="n">LinearSVC</span><span class="p">(</span><span class="n">maxIter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">regParam</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Fit the model</span>
<span class="n">lsvcModel</span> <span class="o">=</span> <span class="n">lsvc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training</span><span class="p">)</span>

<span class="c1"># Print the coefficients and intercept for linear SVC</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Coefficients: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lsvcModel</span><span class="o">.</span><span class="n">coefficients</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Intercept: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lsvcModel</span><span class="o">.</span><span class="n">intercept</span><span class="p">))</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / python / ml / linearsvc.py”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="r">

    <p>有关更多详细信息，请参考<a href="api/R/spark.svmLinear.html">R API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="c1"># load training data</span>
t <span class="o">&lt;-</span> <span class="kp">as.data.frame</span><span class="p">(</span>Titanic<span class="p">)</span>
training <span class="o">&lt;-</span> createDataFrame<span class="p">(</span><span class="kp">t</span><span class="p">)</span>

<span class="c1"># fit Linear SVM model</span>
model <span class="o">&lt;-</span> spark.svmLinear<span class="p">(</span>training<span class="p">,</span>  Survived <span class="o">~</span> <span class="m">.</span><span class="p">,</span> regParam <span class="o">=</span> <span class="m">0.01</span><span class="p">,</span> maxIter <span class="o">=</span> <span class="m">10</span><span class="p">)</span>

<span class="c1"># Model summary</span>
<span class="kp">summary</span><span class="p">(</span>model<span class="p">)</span>

<span class="c1"># Prediction</span>
prediction <span class="o">&lt;-</span> predict<span class="p">(</span>model<span class="p">,</span> training<span class="p">)</span>
showDF<span class="p">(</span>prediction<span class="p">)</span>
</pre></div>
    <div><small>在“ examples / src / main / r / ml / svmLinear”中找到完整的示例代码。Spark仓库中的R”。</small></div>
  </div>

</div>

<h2 id="one-vs-rest-classifier-aka-one-vs-all">相对于静止的分类器（又名相对于所有）</h2>

<p><a href="http://en.wikipedia.org/wiki/Multiclass_classification#One-vs.-rest">OneVsRest</a>是机器学习简化的一个示例，它提供了可以有效执行二进制分类的基本分类器，从而执行了多分类。也称为“一对多”。</p>

<p><code>OneVsRest</code>被实现为<code>Estimator</code> 。对于基本分类器，它需要以下实例<code>Classifier</code>并为k个类的每一个创建一个二进制分类问题。训练类别i的分类器以预测标签是否为i，从而将类别i与所有其他类别区分开。</p>

<p>通过评估每个二进制分类器来完成预测，并且将最有信心的分类器的索引作为标签输出。</p>

<p><strong>例子</strong></p>

<p>下面的示例演示如何加载<a href="http://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass/iris.scale">Iris数据集</a> ，将其解析为DataFrame并使用以下方法执行多类分类<code>OneVsRest</code> 。计算测试误差以测量算法准确性。</p>

<div class="codetabs">
<div data-lang="scala">

    <p>有关更多详细信息，请参考<a href="api/scala/index.html#org.apache.spark.ml.classification.OneVsRest">Scala API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.ml.classification.</span><span class="o">{</span><span class="nc">LogisticRegression</span><span class="o">,</span> <span class="nc">OneVsRest</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator</span>

<span class="c1">// load data file.</span>
<span class="k">val</span> <span class="n">inputData</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_multiclass_classification_data.txt&quot;</span><span class="o">)</span>

<span class="c1">// generate the train/test split.</span>
<span class="k">val</span> <span class="nc">Array</span><span class="o">(</span><span class="n">train</span><span class="o">,</span> <span class="n">test</span><span class="o">)</span> <span class="k">=</span> <span class="n">inputData</span><span class="o">.</span><span class="n">randomSplit</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mf">0.8</span><span class="o">,</span> <span class="mf">0.2</span><span class="o">))</span>

<span class="c1">// instantiate the base classifier</span>
<span class="k">val</span> <span class="n">classifier</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LogisticRegression</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setMaxIter</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setTol</span><span class="o">(</span><span class="mi">1</span><span class="n">E</span><span class="o">-</span><span class="mi">6</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setFitIntercept</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>

<span class="c1">// instantiate the One Vs Rest Classifier.</span>
<span class="k">val</span> <span class="n">ovr</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">OneVsRest</span><span class="o">().</span><span class="n">setClassifier</span><span class="o">(</span><span class="n">classifier</span><span class="o">)</span>

<span class="c1">// train the multiclass model.</span>
<span class="k">val</span> <span class="n">ovrModel</span> <span class="k">=</span> <span class="n">ovr</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">train</span><span class="o">)</span>

<span class="c1">// score the model on test data.</span>
<span class="k">val</span> <span class="n">predictions</span> <span class="k">=</span> <span class="n">ovrModel</span><span class="o">.</span><span class="n">transform</span><span class="o">(</span><span class="n">test</span><span class="o">)</span>

<span class="c1">// obtain evaluator.</span>
<span class="k">val</span> <span class="n">evaluator</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MulticlassClassificationEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setMetricName</span><span class="o">(</span><span class="s">&quot;accuracy&quot;</span><span class="o">)</span>

<span class="c1">// compute the classification error on test data.</span>
<span class="k">val</span> <span class="n">accuracy</span> <span class="k">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="o">(</span><span class="n">predictions</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Test Error = </span><span class="si">${</span><span class="mi">1</span> <span class="o">-</span> <span class="n">accuracy</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / scala / org / apache / spark / examples / ml / OneVsRestExample.scala”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="java">

    <p>有关更多详细信息，请参考<a href="api/java/org/apache/spark/ml/classification/OneVsRest.html">Java API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.LogisticRegression</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.OneVsRest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.OneVsRestModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>

<span class="c1">// load data file.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">inputData</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_multiclass_classification_data.txt&quot;</span><span class="o">);</span>

<span class="c1">// generate the train/test split.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;[]</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">inputData</span><span class="o">.</span><span class="na">randomSplit</span><span class="o">(</span><span class="k">new</span> <span class="kt">double</span><span class="o">[]{</span><span class="mf">0.8</span><span class="o">,</span> <span class="mf">0.2</span><span class="o">});</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">train</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">test</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>

<span class="c1">// configure the base classifier.</span>
<span class="n">LogisticRegression</span> <span class="n">classifier</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LogisticRegression</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setMaxIter</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setTol</span><span class="o">(</span><span class="mf">1E-6</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setFitIntercept</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

<span class="c1">// instantiate the One Vs Rest Classifier.</span>
<span class="n">OneVsRest</span> <span class="n">ovr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OneVsRest</span><span class="o">().</span><span class="na">setClassifier</span><span class="o">(</span><span class="n">classifier</span><span class="o">);</span>

<span class="c1">// train the multiclass model.</span>
<span class="n">OneVsRestModel</span> <span class="n">ovrModel</span> <span class="o">=</span> <span class="n">ovr</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">train</span><span class="o">);</span>

<span class="c1">// score the model on test data.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">ovrModel</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">test</span><span class="o">)</span>
  <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">,</span> <span class="s">&quot;label&quot;</span><span class="o">);</span>

<span class="c1">// obtain evaluator.</span>
<span class="n">MulticlassClassificationEvaluator</span> <span class="n">evaluator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MulticlassClassificationEvaluator</span><span class="o">()</span>
        <span class="o">.</span><span class="na">setMetricName</span><span class="o">(</span><span class="s">&quot;accuracy&quot;</span><span class="o">);</span>

<span class="c1">// compute the classification error on test data.</span>
<span class="kt">double</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">predictions</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Test Error = &quot;</span> <span class="o">+</span> <span class="o">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">accuracy</span><span class="o">));</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / java / org / apache / spark / examples / ml / JavaOneVsRestExample.java”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="python">

    <p>有关更多详细信息，请参考<a href="api/python/pyspark.ml.html#pyspark.ml.classification.OneVsRest">Python API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">OneVsRest</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.evaluation</span> <span class="kn">import</span> <span class="n">MulticlassClassificationEvaluator</span>

<span class="c1"># load data file.</span>
<span class="n">inputData</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;libsvm&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/mllib/sample_multiclass_classification_data.txt&quot;</span><span class="p">)</span>

<span class="c1"># generate the train/test split.</span>
<span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span> <span class="o">=</span> <span class="n">inputData</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>

<span class="c1"># instantiate the base classifier.</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">maxIter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1E-6</span><span class="p">,</span> <span class="n">fitIntercept</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># instantiate the One Vs Rest Classifier.</span>
<span class="n">ovr</span> <span class="o">=</span> <span class="n">OneVsRest</span><span class="p">(</span><span class="n">classifier</span><span class="o">=</span><span class="n">lr</span><span class="p">)</span>

<span class="c1"># train the multiclass model.</span>
<span class="n">ovrModel</span> <span class="o">=</span> <span class="n">ovr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>

<span class="c1"># score the model on test data.</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">ovrModel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>

<span class="c1"># obtain evaluator.</span>
<span class="n">evaluator</span> <span class="o">=</span> <span class="n">MulticlassClassificationEvaluator</span><span class="p">(</span><span class="n">metricName</span><span class="o">=</span><span class="s2">&quot;accuracy&quot;</span><span class="p">)</span>

<span class="c1"># compute the classification error on test data.</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Test Error = </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">accuracy</span><span class="p">))</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / python / ml / one_vs_rest_example.py”中找到完整的示例代码。</small></div>
  </div>
</div>

<h2 id="naive-bayes">朴素贝叶斯</h2>

<p><a href="http://en.wikipedia.org/wiki/Naive_Bayes_classifier">朴素贝叶斯分类器</a>是一系列简单的概率分类器，基于贝叶斯定理，在每对特征之间使用强（朴素）独立性假设。</p>

<p>朴素贝叶斯可以非常有效地训练。通过一次传递训练数据，就可以计算给定每个标签的每个特征的条件概率分布。为了进行预测，它使用贝叶斯定理来计算给定观察值的每个标签的条件概率分布。</p>

<p>MLlib支持<a href="http://en.wikipedia.org/wiki/Naive_Bayes_classifier#Multinomial_naive_Bayes">多项式朴素贝叶斯</a>和<a href="http://nlp.stanford.edu/IR-book/html/htmledition/the-bernoulli-model-1.html">Bernoulli朴素贝叶斯</a> 。</p>

<p><em>输入数据</em> ：这些模型通常用于<a href="http://nlp.stanford.edu/IR-book/html/htmledition/naive-bayes-text-classification-1.html">文档分类</a> 。在这种情况下，每个观察结果都是一个文档，每个功能都代表一个术语。要素的值是术语的频率（在多项式朴素贝叶斯中），或者为零或一，表示是否在文档中找到了该术语（在Bernoulli Naive Bayes中）。特征值必须<em>为非负数</em> 。使用可选参数“ multinomial”或“ bernoulli”（默认值为“ multinomial”）选择模型类型。对于文档分类，输入特征向量通常应为稀疏向量。由于训练数据仅使用一次，因此无需将其缓存。</p>

<p>可以通过设置参数$ \ lambda $（默认值为$ 1.0 $）来使用<a href="http://en.wikipedia.org/wiki/Lidstone_smoothing">加法平滑</a> 。</p>

<p><strong>例子</strong></p>

<div class="codetabs">
<div data-lang="scala">

    <p>有关更多详细信息，请参考<a href="api/scala/index.html#org.apache.spark.ml.classification.NaiveBayes">Scala API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.ml.classification.NaiveBayes</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator</span>

<span class="c1">// Load the data stored in LIBSVM format as a DataFrame.</span>
<span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="o">)</span>

<span class="c1">// Split the data into training and test sets (30% held out for testing)</span>
<span class="k">val</span> <span class="nc">Array</span><span class="o">(</span><span class="n">trainingData</span><span class="o">,</span> <span class="n">testData</span><span class="o">)</span> <span class="k">=</span> <span class="n">data</span><span class="o">.</span><span class="n">randomSplit</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mf">0.7</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">),</span> <span class="n">seed</span> <span class="k">=</span> <span class="mi">1234L</span><span class="o">)</span>

<span class="c1">// Train a NaiveBayes model.</span>
<span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">NaiveBayes</span><span class="o">()</span>
  <span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">trainingData</span><span class="o">)</span>

<span class="c1">// Select example rows to display.</span>
<span class="k">val</span> <span class="n">predictions</span> <span class="k">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="o">(</span><span class="n">testData</span><span class="o">)</span>
<span class="n">predictions</span><span class="o">.</span><span class="n">show</span><span class="o">()</span>

<span class="c1">// Select (prediction, true label) and compute test error</span>
<span class="k">val</span> <span class="n">evaluator</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MulticlassClassificationEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setLabelCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setPredictionCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setMetricName</span><span class="o">(</span><span class="s">&quot;accuracy&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">accuracy</span> <span class="k">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="o">(</span><span class="n">predictions</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Test set accuracy = </span><span class="si">$accuracy</span><span class="s">&quot;</span><span class="o">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / scala / org / apache / spark / examples / ml / NaiveBayesExample.scala”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="java">

    <p>有关更多详细信息，请参考<a href="api/java/org/apache/spark/ml/classification/NaiveBayes.html">Java API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.NaiveBayes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.NaiveBayesModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>

<span class="c1">// Load training data</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">dataFrame</span> <span class="o">=</span>
  <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">).</span><span class="na">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="o">);</span>
<span class="c1">// Split the data into train and test</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;[]</span> <span class="n">splits</span> <span class="o">=</span> <span class="n">dataFrame</span><span class="o">.</span><span class="na">randomSplit</span><span class="o">(</span><span class="k">new</span> <span class="kt">double</span><span class="o">[]{</span><span class="mf">0.6</span><span class="o">,</span> <span class="mf">0.4</span><span class="o">},</span> <span class="mi">1234L</span><span class="o">);</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">train</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">test</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>

<span class="c1">// create the trainer and set its parameters</span>
<span class="n">NaiveBayes</span> <span class="n">nb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NaiveBayes</span><span class="o">();</span>

<span class="c1">// train the model</span>
<span class="n">NaiveBayesModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">train</span><span class="o">);</span>

<span class="c1">// Select example rows to display.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">test</span><span class="o">);</span>
<span class="n">predictions</span><span class="o">.</span><span class="na">show</span><span class="o">();</span>

<span class="c1">// compute accuracy on the test set</span>
<span class="n">MulticlassClassificationEvaluator</span> <span class="n">evaluator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MulticlassClassificationEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setLabelCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setPredictionCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMetricName</span><span class="o">(</span><span class="s">&quot;accuracy&quot;</span><span class="o">);</span>
<span class="kt">double</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">predictions</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Test set accuracy = &quot;</span> <span class="o">+</span> <span class="n">accuracy</span><span class="o">);</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / java / org / apache / spark / examples / ml / JavaNaiveBayesExample.java”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="python">

    <p>有关更多详细信息，请参考<a href="api/python/pyspark.ml.html#pyspark.ml.classification.NaiveBayes">Python API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">NaiveBayes</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.evaluation</span> <span class="kn">import</span> <span class="n">MulticlassClassificationEvaluator</span>

<span class="c1"># Load training data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;libsvm&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="p">)</span>

<span class="c1"># Split the data into train and test</span>
<span class="n">splits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="mi">1234</span><span class="p">)</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">splits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">splits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># create the trainer and set its parameters</span>
<span class="n">nb</span> <span class="o">=</span> <span class="n">NaiveBayes</span><span class="p">(</span><span class="n">smoothing</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">modelType</span><span class="o">=</span><span class="s2">&quot;multinomial&quot;</span><span class="p">)</span>

<span class="c1"># train the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>

<span class="c1"># select example rows to display.</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">predictions</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># compute accuracy on the test set</span>
<span class="n">evaluator</span> <span class="o">=</span> <span class="n">MulticlassClassificationEvaluator</span><span class="p">(</span><span class="n">labelCol</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">predictionCol</span><span class="o">=</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
                                              <span class="n">metricName</span><span class="o">=</span><span class="s2">&quot;accuracy&quot;</span><span class="p">)</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Test set accuracy = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">accuracy</span><span class="p">))</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / python / ml / naive_bayes_example.py”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="r">

    <p>有关更多详细信息，请参考<a href="api/R/spark.naiveBayes.html">R API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="c1"># Fit a Bernoulli naive Bayes model with spark.naiveBayes</span>
titanic <span class="o">&lt;-</span> <span class="kp">as.data.frame</span><span class="p">(</span>Titanic<span class="p">)</span>
titanicDF <span class="o">&lt;-</span> createDataFrame<span class="p">(</span>titanic<span class="p">[</span>titanic<span class="o">$</span>Freq <span class="o">&gt;</span> <span class="m">0</span><span class="p">,</span> <span class="m">-5</span><span class="p">])</span>
nbDF <span class="o">&lt;-</span> titanicDF
nbTestDF <span class="o">&lt;-</span> titanicDF
nbModel <span class="o">&lt;-</span> spark.naiveBayes<span class="p">(</span>nbDF<span class="p">,</span> Survived <span class="o">~</span> Class <span class="o">+</span> Sex <span class="o">+</span> Age<span class="p">)</span>

<span class="c1"># Model summary</span>
<span class="kp">summary</span><span class="p">(</span>nbModel<span class="p">)</span>

<span class="c1"># Prediction</span>
nbPredictions <span class="o">&lt;-</span> predict<span class="p">(</span>nbModel<span class="p">,</span> nbTestDF<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>nbPredictions<span class="p">)</span>
</pre></div>
    <div><small>在“ examples / src / main / r / ml / naiveBayes”中找到完整的示例代码。Spark仓库中的R”。</small></div>
  </div>

</div>

<h1 id="regression">回归</h1>

<h2 id="linear-regression">线性回归</h2>

<p>用于线性回归模型和模型摘要的界面类似于逻辑回归情况。</p>

<blockquote>
  <p>当通过“ l-bfgs”求解器拟合LinearRegressionModel而不对具有恒定非零列的数据集进行截距时，Spark MLlib为恒定非零列输出零系数。此行为与R glmnet相同，但与LIBSVM不同。</p>
</blockquote>

<p><strong>例子</strong></p>

<p>以下示例演示了如何训练弹性网正则化线性回归模型并提取模型摘要统计信息。</p>

<div class="codetabs">

<div data-lang="scala">

    <p>有关参数的更多详细信息，请参见<a href="api/scala/index.html#org.apache.spark.ml.regression.LinearRegression">Scala API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.ml.regression.LinearRegression</span>

<span class="c1">// Load training data</span>
<span class="k">val</span> <span class="n">training</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_linear_regression_data.txt&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">lr</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LinearRegression</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setMaxIter</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setRegParam</span><span class="o">(</span><span class="mf">0.3</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setElasticNetParam</span><span class="o">(</span><span class="mf">0.8</span><span class="o">)</span>

<span class="c1">// Fit the model</span>
<span class="k">val</span> <span class="n">lrModel</span> <span class="k">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">training</span><span class="o">)</span>

<span class="c1">// Print the coefficients and intercept for linear regression</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Coefficients: </span><span class="si">${</span><span class="n">lrModel</span><span class="o">.</span><span class="n">coefficients</span><span class="si">}</span><span class="s"> Intercept: </span><span class="si">${</span><span class="n">lrModel</span><span class="o">.</span><span class="n">intercept</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>

<span class="c1">// Summarize the model over the training set and print out some metrics</span>
<span class="k">val</span> <span class="n">trainingSummary</span> <span class="k">=</span> <span class="n">lrModel</span><span class="o">.</span><span class="n">summary</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;numIterations: </span><span class="si">${</span><span class="n">trainingSummary</span><span class="o">.</span><span class="n">totalIterations</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;objectiveHistory: [</span><span class="si">${</span><span class="n">trainingSummary</span><span class="o">.</span><span class="n">objectiveHistory</span><span class="o">.</span><span class="n">mkString</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">)</span><span class="si">}</span><span class="s">]&quot;</span><span class="o">)</span>
<span class="n">trainingSummary</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">show</span><span class="o">()</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;RMSE: </span><span class="si">${</span><span class="n">trainingSummary</span><span class="o">.</span><span class="n">rootMeanSquaredError</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;r2: </span><span class="si">${</span><span class="n">trainingSummary</span><span class="o">.</span><span class="n">r2</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / scala / org / apache / spark / examples / ml / LinearRegressionWithElasticNetExample.scala”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="java">

    <p>有关参数的更多详细信息，请参见<a href="api/java/org/apache/spark/ml/regression/LinearRegression.html">Java API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.ml.regression.LinearRegression</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.regression.LinearRegressionModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.regression.LinearRegressionTrainingSummary</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>

<span class="c1">// Load training data.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">training</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_linear_regression_data.txt&quot;</span><span class="o">);</span>

<span class="n">LinearRegression</span> <span class="n">lr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinearRegression</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setMaxIter</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setRegParam</span><span class="o">(</span><span class="mf">0.3</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setElasticNetParam</span><span class="o">(</span><span class="mf">0.8</span><span class="o">);</span>

<span class="c1">// Fit the model.</span>
<span class="n">LinearRegressionModel</span> <span class="n">lrModel</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">training</span><span class="o">);</span>

<span class="c1">// Print the coefficients and intercept for linear regression.</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Coefficients: &quot;</span>
  <span class="o">+</span> <span class="n">lrModel</span><span class="o">.</span><span class="na">coefficients</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; Intercept: &quot;</span> <span class="o">+</span> <span class="n">lrModel</span><span class="o">.</span><span class="na">intercept</span><span class="o">());</span>

<span class="c1">// Summarize the model over the training set and print out some metrics.</span>
<span class="n">LinearRegressionTrainingSummary</span> <span class="n">trainingSummary</span> <span class="o">=</span> <span class="n">lrModel</span><span class="o">.</span><span class="na">summary</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;numIterations: &quot;</span> <span class="o">+</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="na">totalIterations</span><span class="o">());</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;objectiveHistory: &quot;</span> <span class="o">+</span> <span class="n">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="n">trainingSummary</span><span class="o">.</span><span class="na">objectiveHistory</span><span class="o">()));</span>
<span class="n">trainingSummary</span><span class="o">.</span><span class="na">residuals</span><span class="o">().</span><span class="na">show</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;RMSE: &quot;</span> <span class="o">+</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="na">rootMeanSquaredError</span><span class="o">());</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;r2: &quot;</span> <span class="o">+</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="na">r2</span><span class="o">());</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / java / org / apache / spark / examples / ml / JavaLinearRegressionWithElasticNetExample.java”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="python">
    <!-- TODO: Add python model summaries once implemented -->

    <p>有关参数的更多详细信息，请参见<a href="api/python/pyspark.ml.html#pyspark.ml.regression.LinearRegression">Python API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.regression</span> <span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="c1"># Load training data</span>
<span class="n">training</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;libsvm&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/mllib/sample_linear_regression_data.txt&quot;</span><span class="p">)</span>

<span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">maxIter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">regParam</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">elasticNetParam</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

<span class="c1"># Fit the model</span>
<span class="n">lrModel</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training</span><span class="p">)</span>

<span class="c1"># Print the coefficients and intercept for linear regression</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Coefficients: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">lrModel</span><span class="o">.</span><span class="n">coefficients</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Intercept: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">lrModel</span><span class="o">.</span><span class="n">intercept</span><span class="p">))</span>

<span class="c1"># Summarize the model over the training set and print out some metrics</span>
<span class="n">trainingSummary</span> <span class="o">=</span> <span class="n">lrModel</span><span class="o">.</span><span class="n">summary</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;numIterations: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">totalIterations</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;objectiveHistory: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">trainingSummary</span><span class="o">.</span><span class="n">objectiveHistory</span><span class="p">))</span>
<span class="n">trainingSummary</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;RMSE: </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">rootMeanSquaredError</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;r2: </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">r2</span><span class="p">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / python / ml / linear_regression_with_elastic_net.py”中找到完整的示例代码。</small></div>
  </div>

</div>

<h2 id="generalized-linear-regression">广义线性回归</h2>

<p>与假设输出遵循高斯分布的线性回归相反， <a href="https://en.wikipedia.org/wiki/Generalized_linear_model">广义线性模型</a> （GLM）是线性模型的规范，其中响应变量$ Y_i $遵循<a href="https://en.wikipedia.org/wiki/Exponential_family">指数分布族的</a>某种<a href="https://en.wikipedia.org/wiki/Exponential_family">分布</a> 。火花的<code>GeneralizedLinearRegression</code>接口允许灵活地指定GLM，可用于各种类型的预测问题，包括线性回归，泊松回归，逻辑回归等。目前在<code>spark.ml</code> ，仅支持指数族分布的一个子集，它们在<a href="#available-families">下面</a>列出。</p>

<p><strong>注意</strong> ：Spark当前仅通过其最多支持4096个功能<code>GeneralizedLinearRegression</code>接口，如果超出此约束，将引发异常。有关更多详细信息，请参见<a href="ml-advanced">高级部分</a> 。尽管如此，对于线性和逻辑回归，可以使用<code>LinearRegression</code>和<code>LogisticRegression</code>估计量。</p>

<p>GLM需要可以以其“规范”或“自然”形式（也称为<a href="https://en.wikipedia.org/wiki/Natural_exponential_family">自然指数族分布）</a>编写的<a href="https://en.wikipedia.org/wiki/Natural_exponential_family">指数族分布</a> 。自然指数族分布的形式为：</p>

<script type="math/tex; mode=display">f_Y(y|\theta, \tau) = h(y, \tau)\exp{\left( \frac{\theta \cdot y - A(\theta)}{d(\tau)} \right)}</script>

<p>其中$ \ theta $是感兴趣的参数，$ \ tau $是分散参数。在GLM中，假定响应变量$ Y_i $来自自然指数族分布：</p>

<script type="math/tex; mode=display">Y_i \sim f\left(\cdot|\theta_i, \tau \right)</script>

<p>其中感兴趣的参数$ \ theta_i $与响应变量$ \ mu_i $的期望值相关</p>

<script type="math/tex; mode=display">\mu_i = A'(\theta_i)</script>

<p>在此，$ A'（\ theta_i）$由所选分布的形式定义。GLM还允许指定链接函数，该链接函数定义了响应变量$ \ mu_i $的期望值与所谓的<em>线性预测变量</em> $ \ eta_i $之间的关系：</p>

<script type="math/tex; mode=display">g(\mu_i) = \eta_i = \vec{x_i}^T \cdot \vec{\beta}</script>

<p>通常，选择链接函数以使$ A'= g ^ {-1} $，这会在目标参数$ \ theta $和线性预测变量$ \ eta $之间产生简化的关系。在这种情况下，链接函数$ g（\ mu）$被称为“规范”链接函数。</p>

<script type="math/tex; mode=display">\theta_i = A'^{-1}(\mu_i) = g(g^{-1}(\eta_i)) = \eta_i</script>

<p>GLM找到使似然函数最大化的回归系数$ \ vec {\ beta} $。</p>

<script type="math/tex; mode=display">\max_{\vec{\beta}} \mathcal{L}(\vec{\theta}|\vec{y},X) =
\prod_{i=1}^{N} h(y_i, \tau) \exp{\left(\frac{y_i\theta_i - A(\theta_i)}{d(\tau)}\right)}</script>

<p>其中感兴趣的参数$ \ theta_i $与回归系数$ \ vec {\ beta} $相关</p>

<script type="math/tex; mode=display">\theta_i = A'^{-1}(g^{-1}(\vec{x_i} \cdot \vec{\beta}))</script>

<p>Spark的广义线性回归接口还提供了用于诊断GLM模型拟合的摘要统计信息，包括残差，p值，偏差，Akaike信息准则等。</p>

<p><a href="http://data.princeton.edu/wws509/notes/">请参阅此处</a> ，以更全面地了解GLM及其应用程序。</p>

<h3 id="available-families">可用家庭</h3>

<table class="table">
  <thead>
    <tr>
      <th>家庭</th>
      <th>回应类型</th>
      <th>支持的链接</th></tr>
  </thead>
  <tbody>
    <tr>
      <td>高斯型</td>
      <td>连续</td>
      <td>身份*，对数，逆</td>
    </tr>
    <tr>
      <td>二项式</td>
      <td>二元</td>
      <td>Logit *，Probit，CLogLog</td>
    </tr>
    <tr>
      <td>泊松</td>
      <td>计数</td>
      <td>日志*，身份，Sqrt</td>
    </tr>
    <tr>
      <td>伽玛</td>
      <td>连续</td>
      <td>逆*，密度，对数</td>
    </tr>
    <tr>
      <td>粗花呢</td>
      <td>零充气连续</td>
      <td>电源链接功能</td>
    </tr>
    </tbody><tfoot><tr><td colspan="4">*规范链接</td></tr></tfoot>
  
</table>

<p><strong>例子</strong></p>

<p>以下示例演示了使用高斯响应和身份链接功能训练GLM并提取模型摘要统计信息。</p>

<div class="codetabs">

<div data-lang="scala">

    <p>有关更多详细信息，请参考<a href="api/scala/index.html#org.apache.spark.ml.regression.GeneralizedLinearRegression">Scala API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.ml.regression.GeneralizedLinearRegression</span>

<span class="c1">// Load training data</span>
<span class="k">val</span> <span class="n">dataset</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_linear_regression_data.txt&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">glr</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">GeneralizedLinearRegression</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setFamily</span><span class="o">(</span><span class="s">&quot;gaussian&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setLink</span><span class="o">(</span><span class="s">&quot;identity&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setMaxIter</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setRegParam</span><span class="o">(</span><span class="mf">0.3</span><span class="o">)</span>

<span class="c1">// Fit the model</span>
<span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="n">glr</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">dataset</span><span class="o">)</span>

<span class="c1">// Print the coefficients and intercept for generalized linear regression model</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Coefficients: </span><span class="si">${</span><span class="n">model</span><span class="o">.</span><span class="n">coefficients</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Intercept: </span><span class="si">${</span><span class="n">model</span><span class="o">.</span><span class="n">intercept</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>

<span class="c1">// Summarize the model over the training set and print out some metrics</span>
<span class="k">val</span> <span class="n">summary</span> <span class="k">=</span> <span class="n">model</span><span class="o">.</span><span class="n">summary</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Coefficient Standard Errors: </span><span class="si">${</span><span class="n">summary</span><span class="o">.</span><span class="n">coefficientStandardErrors</span><span class="o">.</span><span class="n">mkString</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">)</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;T Values: </span><span class="si">${</span><span class="n">summary</span><span class="o">.</span><span class="n">tValues</span><span class="o">.</span><span class="n">mkString</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">)</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;P Values: </span><span class="si">${</span><span class="n">summary</span><span class="o">.</span><span class="n">pValues</span><span class="o">.</span><span class="n">mkString</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">)</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Dispersion: </span><span class="si">${</span><span class="n">summary</span><span class="o">.</span><span class="n">dispersion</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Null Deviance: </span><span class="si">${</span><span class="n">summary</span><span class="o">.</span><span class="n">nullDeviance</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Residual Degree Of Freedom Null: </span><span class="si">${</span><span class="n">summary</span><span class="o">.</span><span class="n">residualDegreeOfFreedomNull</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Deviance: </span><span class="si">${</span><span class="n">summary</span><span class="o">.</span><span class="n">deviance</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Residual Degree Of Freedom: </span><span class="si">${</span><span class="n">summary</span><span class="o">.</span><span class="n">residualDegreeOfFreedom</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;AIC: </span><span class="si">${</span><span class="n">summary</span><span class="o">.</span><span class="n">aic</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">&quot;Deviance Residuals: &quot;</span><span class="o">)</span>
<span class="n">summary</span><span class="o">.</span><span class="n">residuals</span><span class="o">().</span><span class="n">show</span><span class="o">()</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / scala / org / apache / spark / examples / ml / GeneralizedLinearRegressionExample.scala”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="java">

    <p>有关更多详细信息，请参考<a href="api/java/org/apache/spark/ml/regression/GeneralizedLinearRegression.html">Java API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.regression.GeneralizedLinearRegression</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.regression.GeneralizedLinearRegressionModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.regression.GeneralizedLinearRegressionTrainingSummary</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>

<span class="c1">// Load training data</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_linear_regression_data.txt&quot;</span><span class="o">);</span>

<span class="n">GeneralizedLinearRegression</span> <span class="n">glr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GeneralizedLinearRegression</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setFamily</span><span class="o">(</span><span class="s">&quot;gaussian&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setLink</span><span class="o">(</span><span class="s">&quot;identity&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMaxIter</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setRegParam</span><span class="o">(</span><span class="mf">0.3</span><span class="o">);</span>

<span class="c1">// Fit the model</span>
<span class="n">GeneralizedLinearRegressionModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">glr</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">dataset</span><span class="o">);</span>

<span class="c1">// Print the coefficients and intercept for generalized linear regression model</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Coefficients: &quot;</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="na">coefficients</span><span class="o">());</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Intercept: &quot;</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="na">intercept</span><span class="o">());</span>

<span class="c1">// Summarize the model over the training set and print out some metrics</span>
<span class="n">GeneralizedLinearRegressionTrainingSummary</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">summary</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Coefficient Standard Errors: &quot;</span>
  <span class="o">+</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">summary</span><span class="o">.</span><span class="na">coefficientStandardErrors</span><span class="o">()));</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;T Values: &quot;</span> <span class="o">+</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">summary</span><span class="o">.</span><span class="na">tValues</span><span class="o">()));</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;P Values: &quot;</span> <span class="o">+</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">summary</span><span class="o">.</span><span class="na">pValues</span><span class="o">()));</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Dispersion: &quot;</span> <span class="o">+</span> <span class="n">summary</span><span class="o">.</span><span class="na">dispersion</span><span class="o">());</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Null Deviance: &quot;</span> <span class="o">+</span> <span class="n">summary</span><span class="o">.</span><span class="na">nullDeviance</span><span class="o">());</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Residual Degree Of Freedom Null: &quot;</span> <span class="o">+</span> <span class="n">summary</span><span class="o">.</span><span class="na">residualDegreeOfFreedomNull</span><span class="o">());</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Deviance: &quot;</span> <span class="o">+</span> <span class="n">summary</span><span class="o">.</span><span class="na">deviance</span><span class="o">());</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Residual Degree Of Freedom: &quot;</span> <span class="o">+</span> <span class="n">summary</span><span class="o">.</span><span class="na">residualDegreeOfFreedom</span><span class="o">());</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;AIC: &quot;</span> <span class="o">+</span> <span class="n">summary</span><span class="o">.</span><span class="na">aic</span><span class="o">());</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Deviance Residuals: &quot;</span><span class="o">);</span>
<span class="n">summary</span><span class="o">.</span><span class="na">residuals</span><span class="o">().</span><span class="na">show</span><span class="o">();</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / java / org / apache / spark / examples / ml / JavaGeneralizedLinearRegressionExample.java”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="python">

    <p>有关更多详细信息，请参考<a href="api/python/pyspark.ml.html#pyspark.ml.regression.GeneralizedLinearRegression">Python API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.regression</span> <span class="kn">import</span> <span class="n">GeneralizedLinearRegression</span>

<span class="c1"># Load training data</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;libsvm&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/mllib/sample_linear_regression_data.txt&quot;</span><span class="p">)</span>

<span class="n">glr</span> <span class="o">=</span> <span class="n">GeneralizedLinearRegression</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">&quot;gaussian&quot;</span><span class="p">,</span> <span class="n">link</span><span class="o">=</span><span class="s2">&quot;identity&quot;</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">regParam</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Fit the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">glr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

<span class="c1"># Print the coefficients and intercept for generalized linear regression model</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Coefficients: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">coefficients</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Intercept: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">intercept</span><span class="p">))</span>

<span class="c1"># Summarize the model over the training set and print out some metrics</span>
<span class="n">summary</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">summary</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Coefficient Standard Errors: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">coefficientStandardErrors</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;T Values: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">tValues</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;P Values: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">pValues</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Dispersion: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">dispersion</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Null Deviance: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">nullDeviance</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Residual Degree Of Freedom Null: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">residualDegreeOfFreedomNull</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Deviance: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">deviance</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Residual Degree Of Freedom: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">residualDegreeOfFreedom</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;AIC: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">aic</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Deviance Residuals: &quot;</span><span class="p">)</span>
<span class="n">summary</span><span class="o">.</span><span class="n">residuals</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / python / ml / generalized_linear_regression_example.py”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="r">

    <p>有关更多详细信息，请参考<a href="api/R/spark.glm.html">R API文档</a> 。</p>

    <div class="highlight"><pre><span></span>training <span class="o">&lt;-</span> read.df<span class="p">(</span><span class="s">&quot;data/mllib/sample_multiclass_classification_data.txt&quot;</span><span class="p">,</span> <span class="kn">source</span> <span class="o">=</span> <span class="s">&quot;libsvm&quot;</span><span class="p">)</span>
<span class="c1"># Fit a generalized linear model of family &quot;gaussian&quot; with spark.glm</span>
df_list <span class="o">&lt;-</span> randomSplit<span class="p">(</span>training<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="m">7</span><span class="p">,</span> <span class="m">3</span><span class="p">),</span> <span class="m">2</span><span class="p">)</span>
gaussianDF <span class="o">&lt;-</span> df_list<span class="p">[[</span><span class="m">1</span><span class="p">]]</span>
gaussianTestDF <span class="o">&lt;-</span> df_list<span class="p">[[</span><span class="m">2</span><span class="p">]]</span>
gaussianGLM <span class="o">&lt;-</span> spark.glm<span class="p">(</span>gaussianDF<span class="p">,</span> label <span class="o">~</span> features<span class="p">,</span> family <span class="o">=</span> <span class="s">&quot;gaussian&quot;</span><span class="p">)</span>

<span class="c1"># Model summary</span>
<span class="kp">summary</span><span class="p">(</span>gaussianGLM<span class="p">)</span>

<span class="c1"># Prediction</span>
gaussianPredictions <span class="o">&lt;-</span> predict<span class="p">(</span>gaussianGLM<span class="p">,</span> gaussianTestDF<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>gaussianPredictions<span class="p">)</span>

<span class="c1"># Fit a generalized linear model with glm (R-compliant)</span>
gaussianGLM2 <span class="o">&lt;-</span> glm<span class="p">(</span>label <span class="o">~</span> features<span class="p">,</span> gaussianDF<span class="p">,</span> family <span class="o">=</span> <span class="s">&quot;gaussian&quot;</span><span class="p">)</span>
<span class="kp">summary</span><span class="p">(</span>gaussianGLM2<span class="p">)</span>

<span class="c1"># Fit a generalized linear model of family &quot;binomial&quot; with spark.glm</span>
training2 <span class="o">&lt;-</span> read.df<span class="p">(</span><span class="s">&quot;data/mllib/sample_multiclass_classification_data.txt&quot;</span><span class="p">,</span> <span class="kn">source</span> <span class="o">=</span> <span class="s">&quot;libsvm&quot;</span><span class="p">)</span>
training2 <span class="o">&lt;-</span> <span class="kp">transform</span><span class="p">(</span>training2<span class="p">,</span> label <span class="o">=</span> cast<span class="p">(</span>training2<span class="o">$</span>label <span class="o">&gt;</span> <span class="m">1</span><span class="p">,</span> <span class="s">&quot;integer&quot;</span><span class="p">))</span>
df_list2 <span class="o">&lt;-</span> randomSplit<span class="p">(</span>training2<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="m">7</span><span class="p">,</span> <span class="m">3</span><span class="p">),</span> <span class="m">2</span><span class="p">)</span>
binomialDF <span class="o">&lt;-</span> df_list2<span class="p">[[</span><span class="m">1</span><span class="p">]]</span>
binomialTestDF <span class="o">&lt;-</span> df_list2<span class="p">[[</span><span class="m">2</span><span class="p">]]</span>
binomialGLM <span class="o">&lt;-</span> spark.glm<span class="p">(</span>binomialDF<span class="p">,</span> label <span class="o">~</span> features<span class="p">,</span> family <span class="o">=</span> <span class="s">&quot;binomial&quot;</span><span class="p">)</span>

<span class="c1"># Model summary</span>
<span class="kp">summary</span><span class="p">(</span>binomialGLM<span class="p">)</span>

<span class="c1"># Prediction</span>
binomialPredictions <span class="o">&lt;-</span> predict<span class="p">(</span>binomialGLM<span class="p">,</span> binomialTestDF<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>binomialPredictions<span class="p">)</span>

<span class="c1"># Fit a generalized linear model of family &quot;tweedie&quot; with spark.glm</span>
training3 <span class="o">&lt;-</span> read.df<span class="p">(</span><span class="s">&quot;data/mllib/sample_multiclass_classification_data.txt&quot;</span><span class="p">,</span> <span class="kn">source</span> <span class="o">=</span> <span class="s">&quot;libsvm&quot;</span><span class="p">)</span>
tweedieDF <span class="o">&lt;-</span> <span class="kp">transform</span><span class="p">(</span>training3<span class="p">,</span> label <span class="o">=</span> training3<span class="o">$</span>label <span class="o">*</span> <span class="kp">exp</span><span class="p">(</span>randn<span class="p">(</span><span class="m">10</span><span class="p">)))</span>
tweedieGLM <span class="o">&lt;-</span> spark.glm<span class="p">(</span>tweedieDF<span class="p">,</span> label <span class="o">~</span> features<span class="p">,</span> family <span class="o">=</span> <span class="s">&quot;tweedie&quot;</span><span class="p">,</span>
                        var.power <span class="o">=</span> <span class="m">1.2</span><span class="p">,</span> link.power <span class="o">=</span> <span class="m">0</span><span class="p">)</span>

<span class="c1"># Model summary</span>
<span class="kp">summary</span><span class="p">(</span>tweedieGLM<span class="p">)</span>
</pre></div>
    <div><small>在“ examples / src / main / r / ml / glm”中找到完整的示例代码。Spark仓库中的R”。</small></div>
  </div>

</div>

<h2 id="decision-tree-regression">决策树回归</h2>

<p>决策树是流行的分类和回归方法系列。有关的更多信息<code>spark.ml</code>有关实现的更多信息，请参见<a href="#decision-trees">决策树部分</a> 。</p>

<p><strong>例子</strong></p>

<p>以下示例以LibSVM格式加载数据集，将其分为训练集和测试集，在第一个数据集上进行训练，然后对保留的测试集进行评估。我们使用功能转换器对分类功能建立索引，将元数据添加到<code>DataFrame</code>决策树算法可以识别的内容。</p>

<div class="codetabs">
<div data-lang="scala">

    <p>有关参数的更多详细信息，请参见<a href="api/scala/index.html#org.apache.spark.ml.regression.DecisionTreeRegressor">Scala API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.evaluation.RegressionEvaluator</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.VectorIndexer</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.regression.DecisionTreeRegressionModel</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.regression.DecisionTreeRegressor</span>

<span class="c1">// Load the data stored in LIBSVM format as a DataFrame.</span>
<span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="o">)</span>

<span class="c1">// Automatically identify categorical features, and index them.</span>
<span class="c1">// Here, we treat features with &gt; 4 distinct values as continuous.</span>
<span class="k">val</span> <span class="n">featureIndexer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">VectorIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setInputCol</span><span class="o">(</span><span class="s">&quot;features&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setOutputCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setMaxCategories</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
  <span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>

<span class="c1">// Split the data into training and test sets (30% held out for testing).</span>
<span class="k">val</span> <span class="nc">Array</span><span class="o">(</span><span class="n">trainingData</span><span class="o">,</span> <span class="n">testData</span><span class="o">)</span> <span class="k">=</span> <span class="n">data</span><span class="o">.</span><span class="n">randomSplit</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mf">0.7</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">))</span>

<span class="c1">// Train a DecisionTree model.</span>
<span class="k">val</span> <span class="n">dt</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">DecisionTreeRegressor</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setLabelCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setFeaturesCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>

<span class="c1">// Chain indexer and tree in a Pipeline.</span>
<span class="k">val</span> <span class="n">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="n">featureIndexer</span><span class="o">,</span> <span class="n">dt</span><span class="o">))</span>

<span class="c1">// Train model. This also runs the indexer.</span>
<span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">trainingData</span><span class="o">)</span>

<span class="c1">// Make predictions.</span>
<span class="k">val</span> <span class="n">predictions</span> <span class="k">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="o">(</span><span class="n">testData</span><span class="o">)</span>

<span class="c1">// Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">,</span> <span class="s">&quot;label&quot;</span><span class="o">,</span> <span class="s">&quot;features&quot;</span><span class="o">).</span><span class="n">show</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>

<span class="c1">// Select (prediction, true label) and compute test error.</span>
<span class="k">val</span> <span class="n">evaluator</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">RegressionEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setLabelCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setPredictionCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setMetricName</span><span class="o">(</span><span class="s">&quot;rmse&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">rmse</span> <span class="k">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="o">(</span><span class="n">predictions</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Root Mean Squared Error (RMSE) on test data = </span><span class="si">$rmse</span><span class="s">&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">treeModel</span> <span class="k">=</span> <span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">DecisionTreeRegressionModel</span><span class="o">]</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Learned regression tree model:\n </span><span class="si">${</span><span class="n">treeModel</span><span class="o">.</span><span class="n">toDebugString</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / scala / org / apache / spark / examples / ml / DecisionTreeRegressionExample.scala”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="java">

    <p>有关参数的更多详细信息，请参见<a href="api/java/org/apache/spark/ml/regression/DecisionTreeRegressor.html">Java API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.PipelineModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.PipelineStage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.evaluation.RegressionEvaluator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.VectorIndexer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.VectorIndexerModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.regression.DecisionTreeRegressionModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.regression.DecisionTreeRegressor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>

<span class="c1">// Load the data stored in LIBSVM format as a DataFrame.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="o">);</span>

<span class="c1">// Automatically identify categorical features, and index them.</span>
<span class="c1">// Set maxCategories so features with &gt; 4 distinct values are treated as continuous.</span>
<span class="n">VectorIndexerModel</span> <span class="n">featureIndexer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VectorIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">&quot;features&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMaxCategories</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>

<span class="c1">// Split the data into training and test sets (30% held out for testing).</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;[]</span> <span class="n">splits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">randomSplit</span><span class="o">(</span><span class="k">new</span> <span class="kt">double</span><span class="o">[]{</span><span class="mf">0.7</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">});</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">trainingData</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">testData</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>

<span class="c1">// Train a DecisionTree model.</span>
<span class="n">DecisionTreeRegressor</span> <span class="n">dt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DecisionTreeRegressor</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setFeaturesCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">);</span>

<span class="c1">// Chain indexer and tree in a Pipeline.</span>
<span class="n">Pipeline</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Pipeline</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setStages</span><span class="o">(</span><span class="k">new</span> <span class="n">PipelineStage</span><span class="o">[]{</span><span class="n">featureIndexer</span><span class="o">,</span> <span class="n">dt</span><span class="o">});</span>

<span class="c1">// Train model. This also runs the indexer.</span>
<span class="n">PipelineModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">trainingData</span><span class="o">);</span>

<span class="c1">// Make predictions.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">testData</span><span class="o">);</span>

<span class="c1">// Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">,</span> <span class="s">&quot;features&quot;</span><span class="o">).</span><span class="na">show</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>

<span class="c1">// Select (prediction, true label) and compute test error.</span>
<span class="n">RegressionEvaluator</span> <span class="n">evaluator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RegressionEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setLabelCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setPredictionCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMetricName</span><span class="o">(</span><span class="s">&quot;rmse&quot;</span><span class="o">);</span>
<span class="kt">double</span> <span class="n">rmse</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">predictions</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Root Mean Squared Error (RMSE) on test data = &quot;</span> <span class="o">+</span> <span class="n">rmse</span><span class="o">);</span>

<span class="n">DecisionTreeRegressionModel</span> <span class="n">treeModel</span> <span class="o">=</span>
  <span class="o">(</span><span class="n">DecisionTreeRegressionModel</span><span class="o">)</span> <span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="na">stages</span><span class="o">()[</span><span class="mi">1</span><span class="o">]);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Learned regression tree model:\n&quot;</span> <span class="o">+</span> <span class="n">treeModel</span><span class="o">.</span><span class="na">toDebugString</span><span class="o">());</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / java / org / apache / spark / examples / ml / JavaDecisionTreeRegressionExample.java”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="python">

    <p>有关参数的更多详细信息，请参见<a href="api/python/pyspark.ml.html#pyspark.ml.regression.DecisionTreeRegressor">Python API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.regression</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">VectorIndexer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.evaluation</span> <span class="kn">import</span> <span class="n">RegressionEvaluator</span>

<span class="c1"># Load the data stored in LIBSVM format as a DataFrame.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;libsvm&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="p">)</span>

<span class="c1"># Automatically identify categorical features, and index them.</span>
<span class="c1"># We specify maxCategories so features with &gt; 4 distinct values are treated as continuous.</span>
<span class="n">featureIndexer</span> <span class="o">=</span>\
    <span class="n">VectorIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;indexedFeatures&quot;</span><span class="p">,</span> <span class="n">maxCategories</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Split the data into training and test sets (30% held out for testing)</span>
<span class="p">(</span><span class="n">trainingData</span><span class="p">,</span> <span class="n">testData</span><span class="p">)</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>

<span class="c1"># Train a DecisionTree model.</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">featuresCol</span><span class="o">=</span><span class="s2">&quot;indexedFeatures&quot;</span><span class="p">)</span>

<span class="c1"># Chain indexer and tree in a Pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">featureIndexer</span><span class="p">,</span> <span class="n">dt</span><span class="p">])</span>

<span class="c1"># Train model.  This also runs the indexer.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainingData</span><span class="p">)</span>

<span class="c1"># Make predictions.</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">testData</span><span class="p">)</span>

<span class="c1"># Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Select (prediction, true label) and compute test error</span>
<span class="n">evaluator</span> <span class="o">=</span> <span class="n">RegressionEvaluator</span><span class="p">(</span>
    <span class="n">labelCol</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">predictionCol</span><span class="o">=</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="n">metricName</span><span class="o">=</span><span class="s2">&quot;rmse&quot;</span><span class="p">)</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Root Mean Squared Error (RMSE) on test data = </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rmse</span><span class="p">)</span>

<span class="n">treeModel</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># summary only</span>
<span class="k">print</span><span class="p">(</span><span class="n">treeModel</span><span class="p">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / python / ml / decision_tree_regression_example.py”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="r">

    <p>有关更多详细信息，请参考<a href="api/R/spark.decisionTree.html">R API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="c1"># Load training data</span>
df <span class="o">&lt;-</span> read.df<span class="p">(</span><span class="s">&quot;data/mllib/sample_linear_regression_data.txt&quot;</span><span class="p">,</span> <span class="kn">source</span> <span class="o">=</span> <span class="s">&quot;libsvm&quot;</span><span class="p">)</span>
training <span class="o">&lt;-</span> df
test <span class="o">&lt;-</span> df

<span class="c1"># Fit a DecisionTree regression model with spark.decisionTree</span>
model <span class="o">&lt;-</span> spark.decisionTree<span class="p">(</span>training<span class="p">,</span> label <span class="o">~</span> features<span class="p">,</span> <span class="s">&quot;regression&quot;</span><span class="p">)</span>

<span class="c1"># Model summary</span>
<span class="kp">summary</span><span class="p">(</span>model<span class="p">)</span>

<span class="c1"># Prediction</span>
predictions <span class="o">&lt;-</span> predict<span class="p">(</span>model<span class="p">,</span> test<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>predictions<span class="p">)</span>
</pre></div>
    <div><small>在“ examples / src / main / r / ml / decisionTree中找到完整的示例代码。Spark仓库中的R”。</small></div>
  </div>

</div>

<h2 id="random-forest-regression">随机森林回归</h2>

<p>随机森林是一种流行的分类和回归方法系列。有关的更多信息<code>spark.ml</code>有关实现的更多信息，请参见<a href="#random-forests">随机森林部分</a> 。</p>

<p><strong>例子</strong></p>

<p>以下示例以LibSVM格式加载数据集，将其分为训练集和测试集，在第一个数据集上进行训练，然后对保留的测试集进行评估。我们使用功能转换器对分类功能建立索引，将元数据添加到<code>DataFrame</code>基于树的算法可以识别。</p>

<div class="codetabs">
<div data-lang="scala">

    <p>有关更多详细信息，请参考<a href="api/scala/index.html#org.apache.spark.ml.regression.RandomForestRegressor">Scala API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.evaluation.RegressionEvaluator</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.VectorIndexer</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.regression.</span><span class="o">{</span><span class="nc">RandomForestRegressionModel</span><span class="o">,</span> <span class="nc">RandomForestRegressor</span><span class="o">}</span>

<span class="c1">// Load and parse the data file, converting it to a DataFrame.</span>
<span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="o">)</span>

<span class="c1">// Automatically identify categorical features, and index them.</span>
<span class="c1">// Set maxCategories so features with &gt; 4 distinct values are treated as continuous.</span>
<span class="k">val</span> <span class="n">featureIndexer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">VectorIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setInputCol</span><span class="o">(</span><span class="s">&quot;features&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setOutputCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setMaxCategories</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
  <span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>

<span class="c1">// Split the data into training and test sets (30% held out for testing).</span>
<span class="k">val</span> <span class="nc">Array</span><span class="o">(</span><span class="n">trainingData</span><span class="o">,</span> <span class="n">testData</span><span class="o">)</span> <span class="k">=</span> <span class="n">data</span><span class="o">.</span><span class="n">randomSplit</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mf">0.7</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">))</span>

<span class="c1">// Train a RandomForest model.</span>
<span class="k">val</span> <span class="n">rf</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">RandomForestRegressor</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setLabelCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setFeaturesCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>

<span class="c1">// Chain indexer and forest in a Pipeline.</span>
<span class="k">val</span> <span class="n">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="n">featureIndexer</span><span class="o">,</span> <span class="n">rf</span><span class="o">))</span>

<span class="c1">// Train model. This also runs the indexer.</span>
<span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">trainingData</span><span class="o">)</span>

<span class="c1">// Make predictions.</span>
<span class="k">val</span> <span class="n">predictions</span> <span class="k">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="o">(</span><span class="n">testData</span><span class="o">)</span>

<span class="c1">// Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">,</span> <span class="s">&quot;label&quot;</span><span class="o">,</span> <span class="s">&quot;features&quot;</span><span class="o">).</span><span class="n">show</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>

<span class="c1">// Select (prediction, true label) and compute test error.</span>
<span class="k">val</span> <span class="n">evaluator</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">RegressionEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setLabelCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setPredictionCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setMetricName</span><span class="o">(</span><span class="s">&quot;rmse&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">rmse</span> <span class="k">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="o">(</span><span class="n">predictions</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Root Mean Squared Error (RMSE) on test data = </span><span class="si">$rmse</span><span class="s">&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">rfModel</span> <span class="k">=</span> <span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">RandomForestRegressionModel</span><span class="o">]</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Learned regression forest model:\n </span><span class="si">${</span><span class="n">rfModel</span><span class="o">.</span><span class="n">toDebugString</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / scala / org / apache / spark / examples / ml / RandomForestRegressorExample.scala”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="java">

    <p>有关更多详细信息，请参考<a href="api/java/org/apache/spark/ml/regression/RandomForestRegressor.html">Java API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.PipelineModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.PipelineStage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.evaluation.RegressionEvaluator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.VectorIndexer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.VectorIndexerModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.regression.RandomForestRegressionModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.regression.RandomForestRegressor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>

<span class="c1">// Load and parse the data file, converting it to a DataFrame.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">).</span><span class="na">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="o">);</span>

<span class="c1">// Automatically identify categorical features, and index them.</span>
<span class="c1">// Set maxCategories so features with &gt; 4 distinct values are treated as continuous.</span>
<span class="n">VectorIndexerModel</span> <span class="n">featureIndexer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VectorIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">&quot;features&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMaxCategories</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>

<span class="c1">// Split the data into training and test sets (30% held out for testing)</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;[]</span> <span class="n">splits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">randomSplit</span><span class="o">(</span><span class="k">new</span> <span class="kt">double</span><span class="o">[]</span> <span class="o">{</span><span class="mf">0.7</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">});</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">trainingData</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">testData</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>

<span class="c1">// Train a RandomForest model.</span>
<span class="n">RandomForestRegressor</span> <span class="n">rf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RandomForestRegressor</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setLabelCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setFeaturesCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">);</span>

<span class="c1">// Chain indexer and forest in a Pipeline</span>
<span class="n">Pipeline</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Pipeline</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setStages</span><span class="o">(</span><span class="k">new</span> <span class="n">PipelineStage</span><span class="o">[]</span> <span class="o">{</span><span class="n">featureIndexer</span><span class="o">,</span> <span class="n">rf</span><span class="o">});</span>

<span class="c1">// Train model. This also runs the indexer.</span>
<span class="n">PipelineModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">trainingData</span><span class="o">);</span>

<span class="c1">// Make predictions.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">testData</span><span class="o">);</span>

<span class="c1">// Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">,</span> <span class="s">&quot;label&quot;</span><span class="o">,</span> <span class="s">&quot;features&quot;</span><span class="o">).</span><span class="na">show</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>

<span class="c1">// Select (prediction, true label) and compute test error</span>
<span class="n">RegressionEvaluator</span> <span class="n">evaluator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RegressionEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setLabelCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setPredictionCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMetricName</span><span class="o">(</span><span class="s">&quot;rmse&quot;</span><span class="o">);</span>
<span class="kt">double</span> <span class="n">rmse</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">predictions</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Root Mean Squared Error (RMSE) on test data = &quot;</span> <span class="o">+</span> <span class="n">rmse</span><span class="o">);</span>

<span class="n">RandomForestRegressionModel</span> <span class="n">rfModel</span> <span class="o">=</span> <span class="o">(</span><span class="n">RandomForestRegressionModel</span><span class="o">)(</span><span class="n">model</span><span class="o">.</span><span class="na">stages</span><span class="o">()[</span><span class="mi">1</span><span class="o">]);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Learned regression forest model:\n&quot;</span> <span class="o">+</span> <span class="n">rfModel</span><span class="o">.</span><span class="na">toDebugString</span><span class="o">());</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / java / org / apache / spark / examples / ml / JavaRandomForestRegressorExample.java”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="python">

    <p>有关更多详细信息，请参考<a href="api/python/pyspark.ml.html#pyspark.ml.regression.RandomForestRegressor">Python API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.regression</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">VectorIndexer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.evaluation</span> <span class="kn">import</span> <span class="n">RegressionEvaluator</span>

<span class="c1"># Load and parse the data file, converting it to a DataFrame.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;libsvm&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="p">)</span>

<span class="c1"># Automatically identify categorical features, and index them.</span>
<span class="c1"># Set maxCategories so features with &gt; 4 distinct values are treated as continuous.</span>
<span class="n">featureIndexer</span> <span class="o">=</span>\
    <span class="n">VectorIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;indexedFeatures&quot;</span><span class="p">,</span> <span class="n">maxCategories</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Split the data into training and test sets (30% held out for testing)</span>
<span class="p">(</span><span class="n">trainingData</span><span class="p">,</span> <span class="n">testData</span><span class="p">)</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>

<span class="c1"># Train a RandomForest model.</span>
<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">featuresCol</span><span class="o">=</span><span class="s2">&quot;indexedFeatures&quot;</span><span class="p">)</span>

<span class="c1"># Chain indexer and forest in a Pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">featureIndexer</span><span class="p">,</span> <span class="n">rf</span><span class="p">])</span>

<span class="c1"># Train model.  This also runs the indexer.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainingData</span><span class="p">)</span>

<span class="c1"># Make predictions.</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">testData</span><span class="p">)</span>

<span class="c1"># Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Select (prediction, true label) and compute test error</span>
<span class="n">evaluator</span> <span class="o">=</span> <span class="n">RegressionEvaluator</span><span class="p">(</span>
    <span class="n">labelCol</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">predictionCol</span><span class="o">=</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="n">metricName</span><span class="o">=</span><span class="s2">&quot;rmse&quot;</span><span class="p">)</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Root Mean Squared Error (RMSE) on test data = </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rmse</span><span class="p">)</span>

<span class="n">rfModel</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">rfModel</span><span class="p">)</span>  <span class="c1"># summary only</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / python / ml / random_forest_regressor_example.py”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="r">

    <p>有关更多详细信息，请参考<a href="api/R/spark.randomForest.html">R API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="c1"># Load training data</span>
df <span class="o">&lt;-</span> read.df<span class="p">(</span><span class="s">&quot;data/mllib/sample_linear_regression_data.txt&quot;</span><span class="p">,</span> <span class="kn">source</span> <span class="o">=</span> <span class="s">&quot;libsvm&quot;</span><span class="p">)</span>
training <span class="o">&lt;-</span> df
test <span class="o">&lt;-</span> df

<span class="c1"># Fit a random forest regression model with spark.randomForest</span>
model <span class="o">&lt;-</span> spark.randomForest<span class="p">(</span>training<span class="p">,</span> label <span class="o">~</span> features<span class="p">,</span> <span class="s">&quot;regression&quot;</span><span class="p">,</span> numTrees <span class="o">=</span> <span class="m">10</span><span class="p">)</span>

<span class="c1"># Model summary</span>
<span class="kp">summary</span><span class="p">(</span>model<span class="p">)</span>

<span class="c1"># Prediction</span>
predictions <span class="o">&lt;-</span> predict<span class="p">(</span>model<span class="p">,</span> test<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>predictions<span class="p">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / r / ml / randomForest.R”中找到完整的示例代码。</small></div>
  </div>

</div>

<h2 id="gradient-boosted-tree-regression">梯度提升树回归</h2>

<p>梯度增强树（GBT）是一种使用决策树集合的流行回归方法。有关的更多信息<code>spark.ml</code>有关实现的更多信息，请<a href="#gradient-boosted-trees-gbts">参见GBT部分</a> 。</p>

<p><strong>例子</strong></p>

<p>注意：对于此示例数据集， <code>GBTRegressor</code>实际上只需要1次迭代，但通常情况下并非如此。</p>

<div class="codetabs">
<div data-lang="scala">

    <p>有关更多详细信息，请参考<a href="api/scala/index.html#org.apache.spark.ml.regression.GBTRegressor">Scala API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.evaluation.RegressionEvaluator</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.VectorIndexer</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.regression.</span><span class="o">{</span><span class="nc">GBTRegressionModel</span><span class="o">,</span> <span class="nc">GBTRegressor</span><span class="o">}</span>

<span class="c1">// Load and parse the data file, converting it to a DataFrame.</span>
<span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="o">)</span>

<span class="c1">// Automatically identify categorical features, and index them.</span>
<span class="c1">// Set maxCategories so features with &gt; 4 distinct values are treated as continuous.</span>
<span class="k">val</span> <span class="n">featureIndexer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">VectorIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setInputCol</span><span class="o">(</span><span class="s">&quot;features&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setOutputCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setMaxCategories</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
  <span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>

<span class="c1">// Split the data into training and test sets (30% held out for testing).</span>
<span class="k">val</span> <span class="nc">Array</span><span class="o">(</span><span class="n">trainingData</span><span class="o">,</span> <span class="n">testData</span><span class="o">)</span> <span class="k">=</span> <span class="n">data</span><span class="o">.</span><span class="n">randomSplit</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mf">0.7</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">))</span>

<span class="c1">// Train a GBT model.</span>
<span class="k">val</span> <span class="n">gbt</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">GBTRegressor</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setLabelCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setFeaturesCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setMaxIter</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>

<span class="c1">// Chain indexer and GBT in a Pipeline.</span>
<span class="k">val</span> <span class="n">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="n">featureIndexer</span><span class="o">,</span> <span class="n">gbt</span><span class="o">))</span>

<span class="c1">// Train model. This also runs the indexer.</span>
<span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">trainingData</span><span class="o">)</span>

<span class="c1">// Make predictions.</span>
<span class="k">val</span> <span class="n">predictions</span> <span class="k">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="o">(</span><span class="n">testData</span><span class="o">)</span>

<span class="c1">// Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">,</span> <span class="s">&quot;label&quot;</span><span class="o">,</span> <span class="s">&quot;features&quot;</span><span class="o">).</span><span class="n">show</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>

<span class="c1">// Select (prediction, true label) and compute test error.</span>
<span class="k">val</span> <span class="n">evaluator</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">RegressionEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setLabelCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setPredictionCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setMetricName</span><span class="o">(</span><span class="s">&quot;rmse&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">rmse</span> <span class="k">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="o">(</span><span class="n">predictions</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Root Mean Squared Error (RMSE) on test data = </span><span class="si">$rmse</span><span class="s">&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">gbtModel</span> <span class="k">=</span> <span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">GBTRegressionModel</span><span class="o">]</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Learned regression GBT model:\n </span><span class="si">${</span><span class="n">gbtModel</span><span class="o">.</span><span class="n">toDebugString</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / scala / org / apache / spark / examples / ml / GradientBoostedTreeRegressorExample.scala”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="java">

    <p>有关更多详细信息，请参考<a href="api/java/org/apache/spark/ml/regression/GBTRegressor.html">Java API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.PipelineModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.PipelineStage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.evaluation.RegressionEvaluator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.VectorIndexer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.VectorIndexerModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.regression.GBTRegressionModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.regression.GBTRegressor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>

<span class="c1">// Load and parse the data file, converting it to a DataFrame.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">).</span><span class="na">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="o">);</span>

<span class="c1">// Automatically identify categorical features, and index them.</span>
<span class="c1">// Set maxCategories so features with &gt; 4 distinct values are treated as continuous.</span>
<span class="n">VectorIndexerModel</span> <span class="n">featureIndexer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VectorIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">&quot;features&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMaxCategories</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>

<span class="c1">// Split the data into training and test sets (30% held out for testing).</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;[]</span> <span class="n">splits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">randomSplit</span><span class="o">(</span><span class="k">new</span> <span class="kt">double</span><span class="o">[]</span> <span class="o">{</span><span class="mf">0.7</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">});</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">trainingData</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">testData</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>

<span class="c1">// Train a GBT model.</span>
<span class="n">GBTRegressor</span> <span class="n">gbt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GBTRegressor</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setLabelCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setFeaturesCol</span><span class="o">(</span><span class="s">&quot;indexedFeatures&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMaxIter</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>

<span class="c1">// Chain indexer and GBT in a Pipeline.</span>
<span class="n">Pipeline</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Pipeline</span><span class="o">().</span><span class="na">setStages</span><span class="o">(</span><span class="k">new</span> <span class="n">PipelineStage</span><span class="o">[]</span> <span class="o">{</span><span class="n">featureIndexer</span><span class="o">,</span> <span class="n">gbt</span><span class="o">});</span>

<span class="c1">// Train model. This also runs the indexer.</span>
<span class="n">PipelineModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">trainingData</span><span class="o">);</span>

<span class="c1">// Make predictions.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">testData</span><span class="o">);</span>

<span class="c1">// Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">,</span> <span class="s">&quot;label&quot;</span><span class="o">,</span> <span class="s">&quot;features&quot;</span><span class="o">).</span><span class="na">show</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>

<span class="c1">// Select (prediction, true label) and compute test error.</span>
<span class="n">RegressionEvaluator</span> <span class="n">evaluator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RegressionEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setLabelCol</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setPredictionCol</span><span class="o">(</span><span class="s">&quot;prediction&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMetricName</span><span class="o">(</span><span class="s">&quot;rmse&quot;</span><span class="o">);</span>
<span class="kt">double</span> <span class="n">rmse</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">predictions</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Root Mean Squared Error (RMSE) on test data = &quot;</span> <span class="o">+</span> <span class="n">rmse</span><span class="o">);</span>

<span class="n">GBTRegressionModel</span> <span class="n">gbtModel</span> <span class="o">=</span> <span class="o">(</span><span class="n">GBTRegressionModel</span><span class="o">)(</span><span class="n">model</span><span class="o">.</span><span class="na">stages</span><span class="o">()[</span><span class="mi">1</span><span class="o">]);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Learned regression GBT model:\n&quot;</span> <span class="o">+</span> <span class="n">gbtModel</span><span class="o">.</span><span class="na">toDebugString</span><span class="o">());</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / java / org / apache / spark / examples / ml / JavaGradientBoostedTreeRegressorExample.java”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="python">

    <p>有关更多详细信息，请参考<a href="api/python/pyspark.ml.html#pyspark.ml.regression.GBTRegressor">Python API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.regression</span> <span class="kn">import</span> <span class="n">GBTRegressor</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">VectorIndexer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.evaluation</span> <span class="kn">import</span> <span class="n">RegressionEvaluator</span>

<span class="c1"># Load and parse the data file, converting it to a DataFrame.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;libsvm&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/mllib/sample_libsvm_data.txt&quot;</span><span class="p">)</span>

<span class="c1"># Automatically identify categorical features, and index them.</span>
<span class="c1"># Set maxCategories so features with &gt; 4 distinct values are treated as continuous.</span>
<span class="n">featureIndexer</span> <span class="o">=</span>\
    <span class="n">VectorIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;indexedFeatures&quot;</span><span class="p">,</span> <span class="n">maxCategories</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Split the data into training and test sets (30% held out for testing)</span>
<span class="p">(</span><span class="n">trainingData</span><span class="p">,</span> <span class="n">testData</span><span class="p">)</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>

<span class="c1"># Train a GBT model.</span>
<span class="n">gbt</span> <span class="o">=</span> <span class="n">GBTRegressor</span><span class="p">(</span><span class="n">featuresCol</span><span class="o">=</span><span class="s2">&quot;indexedFeatures&quot;</span><span class="p">,</span> <span class="n">maxIter</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Chain indexer and GBT in a Pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">featureIndexer</span><span class="p">,</span> <span class="n">gbt</span><span class="p">])</span>

<span class="c1"># Train model.  This also runs the indexer.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainingData</span><span class="p">)</span>

<span class="c1"># Make predictions.</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">testData</span><span class="p">)</span>

<span class="c1"># Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Select (prediction, true label) and compute test error</span>
<span class="n">evaluator</span> <span class="o">=</span> <span class="n">RegressionEvaluator</span><span class="p">(</span>
    <span class="n">labelCol</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">predictionCol</span><span class="o">=</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="n">metricName</span><span class="o">=</span><span class="s2">&quot;rmse&quot;</span><span class="p">)</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Root Mean Squared Error (RMSE) on test data = </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rmse</span><span class="p">)</span>

<span class="n">gbtModel</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">gbtModel</span><span class="p">)</span>  <span class="c1"># summary only</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / python / ml / gradient_boosted_tree_regressor_example.py”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="r">

    <p>有关更多详细信息，请参考<a href="api/R/spark.gbt.html">R API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="c1"># Load training data</span>
df <span class="o">&lt;-</span> read.df<span class="p">(</span><span class="s">&quot;data/mllib/sample_linear_regression_data.txt&quot;</span><span class="p">,</span> <span class="kn">source</span> <span class="o">=</span> <span class="s">&quot;libsvm&quot;</span><span class="p">)</span>
training <span class="o">&lt;-</span> df
test <span class="o">&lt;-</span> df

<span class="c1"># Fit a GBT regression model with spark.gbt</span>
model <span class="o">&lt;-</span> spark.gbt<span class="p">(</span>training<span class="p">,</span> label <span class="o">~</span> features<span class="p">,</span> <span class="s">&quot;regression&quot;</span><span class="p">,</span> maxIter <span class="o">=</span> <span class="m">10</span><span class="p">)</span>

<span class="c1"># Model summary</span>
<span class="kp">summary</span><span class="p">(</span>model<span class="p">)</span>

<span class="c1"># Prediction</span>
predictions <span class="o">&lt;-</span> predict<span class="p">(</span>model<span class="p">,</span> test<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>predictions<span class="p">)</span>
</pre></div>
    <div><small>在“ examples / src / main / r / ml / gbt”中找到完整的示例代码。Spark仓库中的R”。</small></div>
  </div>

</div>

<h2 id="survival-regression">生存回归</h2>

<p>在<code>spark.ml</code> ，我们实现了<a href="https://en.wikipedia.org/wiki/Accelerated_failure_time_model">加速故障时间（AFT）</a>模型，该模型是用于审查数据的参数生存回归模型。它描述了生存时间的对数模型，因此通常称为对数线性模型进行生存分析。与为相同目的设计的<a href="https://en.wikipedia.org/wiki/Proportional_hazards_model">比例风险</a>模型不同，AFT模型更易于并行化，因为每个实例独立地对目标函数做出贡献。</p>

<p>给定协变量$ x ^ {'} $的值，对于受试者i = 1，...，n的随机寿命$ t_ {i} $，并可能进行右删失，AFT模型下的似然函数为： <code>\[ L(\beta,\sigma)=\prod_{i=1}^n[\frac{1}{\sigma}f_{0}(\frac{\log{t_{i}}-x^{'}\beta}{\sigma})]^{\delta_{i}}S_{0}(\frac{\log{t_{i}}-x^{'}\beta}{\sigma})^{1-\delta_{i}} \]</code>其中$ \ delta_ {i} $是事件发生的指示符，即是否未经审查。使用$ \ epsilon_ {i} = \ frac {\ log {t_ {i}}-x ^ {'} \ beta} {\ sigma} $，对数似然函数采用以下形式： <code>\[ \iota(\beta,\sigma)=\sum_{i=1}^{n}[-\delta_{i}\log\sigma+\delta_{i}\log{f_{0}}(\epsilon_{i})+(1-\delta_{i})\log{S_{0}(\epsilon_{i})}] \]</code>其中$ S_ {0}（\ epsilon_ {i}）$是基线幸存者函数，而$ f_ {0}（\ epsilon_ {i}）$是相应的密度函数。</p>

<p>最常用的AFT模型基于生存时间的Weibull分布。生存期的Weibull分布对应于生存期的对数的极值分布，并且$ S_ {0}（\ epsilon）$函数为： <code>\[ S_{0}(\epsilon_{i})=\exp(-e^{\epsilon_{i}}) \]</code> $ f_ {0}（\ epsilon_ {i}）$函数为： <code>\[ f_{0}(\epsilon_{i})=e^{\epsilon_{i}}\exp(-e^{\epsilon_{i}}) \]</code>具有寿命的Weibull分布的AFT模型的对数似然函数为： <code>\[ \iota(\beta,\sigma)= -\sum_{i=1}^n[\delta_{i}\log\sigma-\delta_{i}\epsilon_{i}+e^{\epsilon_{i}}] \]</code>由于最小化等效于最大后验概率的负对数似然性，我们用于优化的损失函数为$-\ iota（\ beta，\ sigma）$。$ \ beta $和$ \ log \ sigma $的梯度函数分别为： <code>\[ \frac{\partial (-\iota)}{\partial \beta}=\sum_{1=1}^{n}[\delta_{i}-e^{\epsilon_{i}}]\frac{x_{i}}{\sigma} \]</code>
<code>\[ \frac{\partial (-\iota)}{\partial (\log\sigma)}=\sum_{i=1}^{n}[\delta_{i}+(\delta_{i}-e^{\epsilon_{i}})\epsilon_{i}] \]</code></p>

<p>AFT模型可以公式化为凸优化问题，即寻找依赖于系数矢量$ \ beta $和尺度对数的凸函数$-\ iota（\ beta，\ sigma）$的最小化器的任务参数$ \ log \ sigma $。实现基础的优化算法是L-BFGS。该实现与R的生存函数<a href="https://stat.ethz.ch/R-manual/R-devel/library/survival/html/survreg.html">survreg</a>的结果匹配</p>

<blockquote>
  <p>在具有非零常量列的数据集上拟合AFTSurvivalRegressionModel且不进行截取时，Spark MLlib为非零常量列输出零系数。此行为不同于R Survival :: survreg。</p>
</blockquote>

<p><strong>例子</strong></p>

<div class="codetabs">

<div data-lang="scala">

    <p>有关更多详细信息，请参考<a href="api/scala/index.html#org.apache.spark.ml.regression.AFTSurvivalRegression">Scala API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.regression.AFTSurvivalRegression</span>

<span class="k">val</span> <span class="n">training</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mf">1.218</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="o">(</span><span class="mf">1.560</span><span class="o">,</span> <span class="o">-</span><span class="mf">0.605</span><span class="o">)),</span>
  <span class="o">(</span><span class="mf">2.949</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="o">(</span><span class="mf">0.346</span><span class="o">,</span> <span class="mf">2.158</span><span class="o">)),</span>
  <span class="o">(</span><span class="mf">3.627</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="o">(</span><span class="mf">1.380</span><span class="o">,</span> <span class="mf">0.231</span><span class="o">)),</span>
  <span class="o">(</span><span class="mf">0.273</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="o">(</span><span class="mf">0.520</span><span class="o">,</span> <span class="mf">1.151</span><span class="o">)),</span>
  <span class="o">(</span><span class="mf">4.199</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="o">(</span><span class="mf">0.795</span><span class="o">,</span> <span class="o">-</span><span class="mf">0.226</span><span class="o">))</span>
<span class="o">)).</span><span class="n">toDF</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">,</span> <span class="s">&quot;censor&quot;</span><span class="o">,</span> <span class="s">&quot;features&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">quantileProbabilities</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="mf">0.3</span><span class="o">,</span> <span class="mf">0.6</span><span class="o">)</span>
<span class="k">val</span> <span class="n">aft</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">AFTSurvivalRegression</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setQuantileProbabilities</span><span class="o">(</span><span class="n">quantileProbabilities</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setQuantilesCol</span><span class="o">(</span><span class="s">&quot;quantiles&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="n">aft</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">training</span><span class="o">)</span>

<span class="c1">// Print the coefficients, intercept and scale parameter for AFT survival regression</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Coefficients: </span><span class="si">${</span><span class="n">model</span><span class="o">.</span><span class="n">coefficients</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Intercept: </span><span class="si">${</span><span class="n">model</span><span class="o">.</span><span class="n">intercept</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Scale: </span><span class="si">${</span><span class="n">model</span><span class="o">.</span><span class="n">scale</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="o">(</span><span class="n">training</span><span class="o">).</span><span class="n">show</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / scala / org / apache / spark / examples / ml / AFTSurvivalRegressionExample.scala”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="java">

    <p>有关更多详细信息，请参考<a href="api/java/org/apache/spark/ml/regression/AFTSurvivalRegression.html">Java API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.regression.AFTSurvivalRegression</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.regression.AFTSurvivalRegressionModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.VectorUDT</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.DataTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="n">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">1.218</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">1.560</span><span class="o">,</span> <span class="o">-</span><span class="mf">0.605</span><span class="o">)),</span>
  <span class="n">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">2.949</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">0.346</span><span class="o">,</span> <span class="mf">2.158</span><span class="o">)),</span>
  <span class="n">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">3.627</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">1.380</span><span class="o">,</span> <span class="mf">0.231</span><span class="o">)),</span>
  <span class="n">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">0.273</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">0.520</span><span class="o">,</span> <span class="mf">1.151</span><span class="o">)),</span>
  <span class="n">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">4.199</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">0.795</span><span class="o">,</span> <span class="o">-</span><span class="mf">0.226</span><span class="o">))</span>
<span class="o">);</span>
<span class="n">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StructType</span><span class="o">(</span><span class="k">new</span> <span class="n">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="n">StructField</span><span class="o">(</span><span class="s">&quot;label&quot;</span><span class="o">,</span> <span class="n">DataTypes</span><span class="o">.</span><span class="na">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="n">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="n">StructField</span><span class="o">(</span><span class="s">&quot;censor&quot;</span><span class="o">,</span> <span class="n">DataTypes</span><span class="o">.</span><span class="na">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="n">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="n">StructField</span><span class="o">(</span><span class="s">&quot;features&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">VectorUDT</span><span class="o">(),</span> <span class="kc">false</span><span class="o">,</span> <span class="n">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">training</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>
<span class="kt">double</span><span class="o">[]</span> <span class="n">quantileProbabilities</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[]{</span><span class="mf">0.3</span><span class="o">,</span> <span class="mf">0.6</span><span class="o">};</span>
<span class="n">AFTSurvivalRegression</span> <span class="n">aft</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AFTSurvivalRegression</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setQuantileProbabilities</span><span class="o">(</span><span class="n">quantileProbabilities</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setQuantilesCol</span><span class="o">(</span><span class="s">&quot;quantiles&quot;</span><span class="o">);</span>

<span class="n">AFTSurvivalRegressionModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">aft</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">training</span><span class="o">);</span>

<span class="c1">// Print the coefficients, intercept and scale parameter for AFT survival regression</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Coefficients: &quot;</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="na">coefficients</span><span class="o">());</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Intercept: &quot;</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="na">intercept</span><span class="o">());</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Scale: &quot;</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="na">scale</span><span class="o">());</span>
<span class="n">model</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">training</span><span class="o">).</span><span class="na">show</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / java / org / apache / spark / examples / ml / JavaAFTSurvivalRegressionExample.java”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="python">

    <p>有关更多详细信息，请参考<a href="api/python/pyspark.ml.html#pyspark.ml.regression.AFTSurvivalRegression">Python API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.regression</span> <span class="kn">import</span> <span class="n">AFTSurvivalRegression</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>

<span class="n">training</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mf">1.218</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="mf">1.560</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.605</span><span class="p">)),</span>
    <span class="p">(</span><span class="mf">2.949</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="mf">0.346</span><span class="p">,</span> <span class="mf">2.158</span><span class="p">)),</span>
    <span class="p">(</span><span class="mf">3.627</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="mf">1.380</span><span class="p">,</span> <span class="mf">0.231</span><span class="p">)),</span>
    <span class="p">(</span><span class="mf">0.273</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="mf">0.520</span><span class="p">,</span> <span class="mf">1.151</span><span class="p">)),</span>
    <span class="p">(</span><span class="mf">4.199</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="mf">0.795</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.226</span><span class="p">))],</span> <span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;censor&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">])</span>
<span class="n">quantileProbabilities</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]</span>
<span class="n">aft</span> <span class="o">=</span> <span class="n">AFTSurvivalRegression</span><span class="p">(</span><span class="n">quantileProbabilities</span><span class="o">=</span><span class="n">quantileProbabilities</span><span class="p">,</span>
                            <span class="n">quantilesCol</span><span class="o">=</span><span class="s2">&quot;quantiles&quot;</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">aft</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training</span><span class="p">)</span>

<span class="c1"># Print the coefficients, intercept and scale parameter for AFT survival regression</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Coefficients: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">coefficients</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Intercept: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">intercept</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Scale: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">scale</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">training</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / python / ml / aft_survival_regression.py”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="r">

    <p>有关更多详细信息，请参考<a href="api/R/spark.survreg.html">R API文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="c1"># Use the ovarian dataset available in R survival package</span>
<span class="kn">library</span><span class="p">(</span>survival<span class="p">)</span>

<span class="c1"># Fit an accelerated failure time (AFT) survival regression model with spark.survreg</span>
ovarianDF <span class="o">&lt;-</span> <span class="kp">suppressWarnings</span><span class="p">(</span>createDataFrame<span class="p">(</span>ovarian<span class="p">))</span>
aftDF <span class="o">&lt;-</span> ovarianDF
aftTestDF <span class="o">&lt;-</span> ovarianDF
aftModel <span class="o">&lt;-</span> spark.survreg<span class="p">(</span>aftDF<span class="p">,</span> Surv<span class="p">(</span>futime<span class="p">,</span> fustat<span class="p">)</span> <span class="o">~</span> ecog_ps <span class="o">+</span> rx<span class="p">)</span>

<span class="c1"># Model summary</span>
<span class="kp">summary</span><span class="p">(</span>aftModel<span class="p">)</span>

<span class="c1"># Prediction</span>
aftPredictions <span class="o">&lt;-</span> predict<span class="p">(</span>aftModel<span class="p">,</span> aftTestDF<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>aftPredictions<span class="p">)</span>
</pre></div>
    <div><small>在“ examples / src / main / r / ml / survreg”中找到完整的示例代码。Spark仓库中的R”。</small></div>
  </div>

</div>

<h2 id="isotonic-regression">等渗回归</h2>
<p><a href="http://en.wikipedia.org/wiki/Isotonic_regression">等渗回归</a>属于回归算法家族。在给定有限实数集的情况下，形式等渗回归是一个问题<code>$Y = {y_1, y_2, ..., y_n}$</code>代表观察到的反应和<code>$X = {x_1, x_2, ..., x_n}$</code>要拟合的未知响应值找到最小化的函数</p>

<p><code>\begin{equation} f(x) = \sum_{i=1}^n w_i (y_i - x_i)^2 \end{equation}</code></p>

<p>关于完整订单<code>$x_1\le x_2\le ...\le x_n$</code>哪里<code>$w_i$</code>是正权重。结果函数称为等张回归，并且是唯一的。可以将其视为在顺序限制下的最小二乘问题。从本质上讲，等渗回归是最适合原始数据点的<a href="http://en.wikipedia.org/wiki/Monotonic_function">单调函数</a> 。</p>

<p>我们实现了一个<a href="http://doi.org/10.1198/TECH.2010.10111">池违反者算法</a> ，该<a href="http://doi.org/10.1198/TECH.2010.10111">算法</a>使用了<a href="http://doi.org/10.1007/978-3-642-99789-1_10">等渗回归并行化的方法</a> 。训练输入是一个DataFrame，其中包含三列标签，特征和权重。此外，IsotonicRegression算法具有一个称为$ isotonic $的可选参数，默认为true。该参数指定等渗回归是等渗（单调增加）还是反渗（单调减少）。</p>

<p>训练返回一个IsotonicRegressionModel，可用于预测已知和未知特征的标签。等渗回归的结果被视为分段线性函数。因此，预测规则为：</p>

<ul>
  <li>如果预测输入与训练功能完全匹配，则返回关联的预测。如果有多个具有相同特征的预测，则返回其中之一。哪一个未定义（与java.util相同）。Arrays.binarySearch）。</li>
  <li>如果预测输入低于或高于所有训练特征，则分别返回具有最低或最高特征的预测。如果存在多个具有相同特征的预测，则分别返回最低或最高。</li>
  <li>如果预测输入介于两个训练特征之间，则将预测视为分段线性函数，并根据两个最接近特征的预测来计算内插值。如果有多个具有相同特征的值，则使用与上一点相同的规则。</li>
</ul>

<p><strong>例子</strong></p>

<div class="codetabs">
<div data-lang="scala">

    <p>请参阅<a href="api/scala/index.html#org.apache.spark.ml.regression.IsotonicRegression"><code>IsotonicRegression</code></a>有关API的详细信息，请参见<a href="api/scala/index.html#org.apache.spark.ml.regression.IsotonicRegression">Scala文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.ml.regression.IsotonicRegression</span>

<span class="c1">// Loads data.</span>
<span class="k">val</span> <span class="n">dataset</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_isotonic_regression_libsvm_data.txt&quot;</span><span class="o">)</span>

<span class="c1">// Trains an isotonic regression model.</span>
<span class="k">val</span> <span class="n">ir</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">IsotonicRegression</span><span class="o">()</span>
<span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="n">ir</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">dataset</span><span class="o">)</span>

<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Boundaries in increasing order: </span><span class="si">${</span><span class="n">model</span><span class="o">.</span><span class="n">boundaries</span><span class="si">}</span><span class="s">\n&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Predictions associated with the boundaries: </span><span class="si">${</span><span class="n">model</span><span class="o">.</span><span class="n">predictions</span><span class="si">}</span><span class="s">\n&quot;</span><span class="o">)</span>

<span class="c1">// Makes predictions.</span>
<span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="o">(</span><span class="n">dataset</span><span class="o">).</span><span class="n">show</span><span class="o">()</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / scala / org / apache / spark / examples / ml / IsotonicRegressionExample.scala”中找到完整的示例代码。</small></div>
  </div>
<div data-lang="java">

    <p>请参阅<a href="api/java/org/apache/spark/ml/regression/IsotonicRegression.html"><code>IsotonicRegression</code></a>有关该API的详细信息的<a href="api/java/org/apache/spark/ml/regression/IsotonicRegression.html">Java文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.ml.regression.IsotonicRegression</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.regression.IsotonicRegressionModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>

<span class="c1">// Loads data.</span>
<span class="n">Dataset</span><span class="o">&lt;</span><span class="n">Row</span><span class="o">&gt;</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;libsvm&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">&quot;data/mllib/sample_isotonic_regression_libsvm_data.txt&quot;</span><span class="o">);</span>

<span class="c1">// Trains an isotonic regression model.</span>
<span class="n">IsotonicRegression</span> <span class="n">ir</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IsotonicRegression</span><span class="o">();</span>
<span class="n">IsotonicRegressionModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">ir</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">dataset</span><span class="o">);</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Boundaries in increasing order: &quot;</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="na">boundaries</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Predictions associated with the boundaries: &quot;</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="na">predictions</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="o">);</span>

<span class="c1">// Makes predictions.</span>
<span class="n">model</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">dataset</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / java / org / apache / spark / examples / ml / JavaIsotonicRegressionExample.java”中找到完整的示例代码。</small></div>
  </div>
<div data-lang="python">

    <p>请参阅<a href="api/python/pyspark.ml.html#pyspark.ml.regression.IsotonicRegression"><code>IsotonicRegression</code></a>有关该API的更多详细信息的<a href="api/python/pyspark.ml.html#pyspark.ml.regression.IsotonicRegression">Python文档</a> 。</p>

    <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.regression</span> <span class="kn">import</span> <span class="n">IsotonicRegression</span>

<span class="c1"># Loads data.</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;libsvm&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/mllib/sample_isotonic_regression_libsvm_data.txt&quot;</span><span class="p">)</span>

<span class="c1"># Trains an isotonic regression model.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">IsotonicRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Boundaries in increasing order: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">boundaries</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Predictions associated with the boundaries: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predictions</span><span class="p">))</span>

<span class="c1"># Makes predictions.</span>
<span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
    <div><small>在Spark存储库中的“ examples / src / main / python / ml / isotonic_regression_example.py”中找到完整的示例代码。</small></div>
  </div>

<div data-lang="r">

    <p>请参阅<a href="api/R/spark.isoreg.html"><code>IsotonicRegression</code> R API文档</a>以获取有关<a href="api/R/spark.isoreg.html">API</a>的更多详细信息。</p>

    <div class="highlight"><pre><span></span><span class="c1"># Load training data</span>
df <span class="o">&lt;-</span> read.df<span class="p">(</span><span class="s">&quot;data/mllib/sample_isotonic_regression_libsvm_data.txt&quot;</span><span class="p">,</span> <span class="kn">source</span> <span class="o">=</span> <span class="s">&quot;libsvm&quot;</span><span class="p">)</span>
training <span class="o">&lt;-</span> df
test <span class="o">&lt;-</span> df

<span class="c1"># Fit an isotonic regression model with spark.isoreg</span>
model <span class="o">&lt;-</span> spark.isoreg<span class="p">(</span>training<span class="p">,</span> label <span class="o">~</span> features<span class="p">,</span> isotonic <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>

<span class="c1"># Model summary</span>
<span class="kp">summary</span><span class="p">(</span>model<span class="p">)</span>

<span class="c1"># Prediction</span>
predictions <span class="o">&lt;-</span> predict<span class="p">(</span>model<span class="p">,</span> test<span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>predictions<span class="p">)</span>
</pre></div>
    <div><small>在“ examples / src / main / r / ml / isoreg”中找到完整的示例代码。Spark仓库中的R”。</small></div>
  </div>

</div>

<h1 id="linear-methods">线性方法</h1>

<p>我们使用$ L_1 $或$ L_2 $正则化实现了流行的线性方法，例如逻辑回归和线性最小二乘。有关实现和调整的详细信息，请参阅<a href="mllib-linear-methods.html">基于RDD的API的线性方法指南</a> 。此信息仍然有用。</p>

<p>我们还包括用于<a href="http://en.wikipedia.org/wiki/Elastic_net_regularization">Elastic net</a>的DataFrame API， <a href="http://users.stat.umn.edu/~zouxx019/Papers/elasticnet.pdf">Zou等人</a>提出的$ L_1 $和$ L_2 $正则化混合体<a href="http://users.stat.umn.edu/~zouxx019/Papers/elasticnet.pdf">，正则化和通过弹性网进行变量选择</a> 。在数学上，它定义为$ L_1 $和$ L_2 $正则化项的凸组合： <code>\[ \alpha \left( \lambda \|\wv\|_1 \right) + (1-\alpha) \left( \frac{\lambda}{2}\|\wv\|_2^2 \right) , \alpha \in [0, 1], \lambda \geq 0 \]</code>通过适当设置$ \ alpha $，弹性网既包含$ L_1 $，又包含$ L_2 $正则化，这是特殊情况。例如，如果使用弹性净参数$ \ alpha $设置为$ 1 $来训练<a href="https://en.wikipedia.org/wiki/Linear_regression">线性回归</a>模型，则它等效于<a href="http://en.wikipedia.org/wiki/Least_squares#Lasso_method">Lasso</a>模型。另一方面，如果将$ \ alpha $设置为$ 0 $，则训练后的模型将简化为<a href="http://en.wikipedia.org/wiki/Tikhonov_regularization">岭回归</a>模型。我们通过弹性净正则化实现线性回归和逻辑回归的Pipelines API。</p>

<h1 id="decision-trees">决策树</h1>

<p><a href="http://en.wikipedia.org/wiki/Decision_tree_learning">决策树</a>及其集成是用于机器学习任务的分类和回归的流行方法。决策树被广泛使用，因为它们易于解释，处理分类特征，扩展到多类分类设置，不需要特征缩放并且能够捕获非线性和特征交互。树木分类算法（例如随机森林和boosting）在分类和回归任务中表现最佳。</p>

<p>的<code>spark.ml</code>实现使用连续和分类功能，支持用于二进制和多类分类以及用于回归的决策树。该实现按行对数据进行分区，从而允许对数百万甚至数十亿个实例进行分布式训练。</p>

<p>用户可以在<a href="mllib-decision-tree.html">MLlib决策树指南中</a>找到有关决策树算法的更多信息。此API与<a href="mllib-decision-tree.html">原始MLlib决策树API</a>之间的主要区别是：</p>

<ul>
  <li>支持ML管道</li>
  <li>分类与回归的决策树分离</li>
  <li>使用DataFrame元数据来区分连续特征和分类特征</li>
</ul>

<p>决策树的管道API比原始API提供了更多功能。<br>特别是，对于分类，用户可以获得每个类别的预测概率（又称类别条件概率）；对于回归，用户可以获得预测的有偏差的样本方差。</p>

<p>树木合奏（随机森林和渐变树）在下面的“ <a href="#tree-ensembles">树木合奏”部分中进行介绍</a> 。</p>

<h2 id="inputs-and-outputs">输入和输出</h2>

<p>我们在此处列出输入和输出（预测）列类型。所有输出列都是可选的；要排除输出列，请将其对应的Param设置为空字符串。</p>

<h3 id="input-columns">输入栏</h3>

<table class="table">
  <thead>
    <tr>
      <th align="left">参数名称</th>
      <th align="left">类型</th>
      <th align="left">默认</th>
      <th align="left">描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>标签颜色</td>
      <td>双</td>
      <td>“标签”</td>
      <td>标签来预测</td>
    </tr>
    <tr>
      <td>功能</td>
      <td>向量</td>
      <td>“特征”</td>
      <td>特征向量</td>
    </tr>
  </tbody>
</table>

<h3 id="output-columns">输出列</h3>

<table class="table">
  <thead>
    <tr>
      <th align="left">参数名称</th>
      <th align="left">类型</th>
      <th align="left">默认</th>
      <th align="left">描述</th>
      <th align="left">笔记</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>预测颜色</td>
      <td>双</td>
      <td>“预测”</td>
      <td>预测标签</td>
      <td></td>
    </tr>
    <tr>
      <td>rawPredictionCol</td>
      <td>向量</td>
      <td>“ rawPrediction”</td>
      <td>长度为＃个类的向量，在进行预测的树节点上有训练实例标签的数量</td>
      <td>仅分类</td>
    </tr>
    <tr>
      <td>概率值</td>
      <td>向量</td>
      <td>“可能性”</td>
      <td>长度为＃的类的向量等于归一化为多项式分布的rawPrediction</td>
      <td>仅分类</td>
    </tr>
    <tr>
      <td>方差</td>
      <td>双</td>
      <td></td>
      <td>有偏的样本方差预测</td>
      <td>仅回归</td>
      </tr>
  </tbody>
</table>

<h1 id="tree-ensembles">树木乐团</h1>

<p>DataFrame API支持两种主要的树集成算法： <a href="http://en.wikipedia.org/wiki/Random_forest">随机森林</a>和<a href="http://en.wikipedia.org/wiki/Gradient_boosting">梯度增强树（GBT）</a> 。两者都使用<a href="ml-classification-regression.html#decision-trees"><code>spark.ml</code>决策树</a>作为其基础模型。</p>

<p>用户可以在<a href="mllib-ensembles.html">MLlib Ensemble指南中</a>找到有关集成算法的更多信息。<br>在本节中，我们演示用于集成的DataFrame API。</p>

<p>此API与<a href="mllib-ensembles.html">原始MLlib集成API</a>之间的主要区别是：</p>

<ul>
  <li>支持DataFrames和ML Pipelines</li>
  <li>分类与回归分离</li>
  <li>使用DataFrame元数据来区分连续特征和分类特征</li>
  <li>随机森林的更多功能：特征重要性的估计以及分类的每个类别的预测概率（即类别条件概率）。</li>
</ul>

<h2 id="random-forests">随机森林</h2>

<p><a href="http://en.wikipedia.org/wiki/Random_forest">随机森林</a>是<a href="ml-classification-regression.html#decision-trees">决策树的</a>集合体。随机森林结合了许多决策树，以减少过度拟合的风险。的<code>spark.ml</code>实现使用连续和分类功能，支持用于二进制和多类分类以及用于回归的随机森林。</p>

<p>有关算法本身的更多信息，请参见<a href="mllib-ensembles.html#random-forests"><code>spark.mllib</code>有关随机森林的文件</a> 。</p>

<h3 id="inputs-and-outputs-1">输入和输出</h3>

<p>我们在此处列出输入和输出（预测）列类型。所有输出列都是可选的；要排除输出列，请将其对应的Param设置为空字符串。</p>

<h4 id="input-columns-1">输入栏</h4>

<table class="table">
  <thead>
    <tr>
      <th align="left">参数名称</th>
      <th align="left">类型</th>
      <th align="left">默认</th>
      <th align="left">描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>标签颜色</td>
      <td>双</td>
      <td>“标签”</td>
      <td>标签来预测</td>
    </tr>
    <tr>
      <td>功能</td>
      <td>向量</td>
      <td>“特征”</td>
      <td>特征向量</td>
    </tr>
  </tbody>
</table>

<h4 id="output-columns-predictions">输出列（预测）</h4>

<table class="table">
  <thead>
    <tr>
      <th align="left">参数名称</th>
      <th align="left">类型</th>
      <th align="left">默认</th>
      <th align="left">描述</th>
      <th align="left">笔记</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>预测颜色</td>
      <td>双</td>
      <td>“预测”</td>
      <td>预测标签</td>
      <td></td>
    </tr>
    <tr>
      <td>rawPredictionCol</td>
      <td>向量</td>
      <td>“ rawPrediction”</td>
      <td>长度为＃个类的向量，在进行预测的树节点上有训练实例标签的数量</td>
      <td>仅分类</td>
    </tr>
    <tr>
      <td>概率值</td>
      <td>向量</td>
      <td>“可能性”</td>
      <td>长度为＃的类的向量等于归一化为多项式分布的rawPrediction</td>
      <td>仅分类</td>
    </tr>
  </tbody>
</table>

<h2 id="gradient-boosted-trees-gbts">渐变树（GBT）</h2>

<p><a href="http://en.wikipedia.org/wiki/Gradient_boosting">梯度增强树（GBT）</a>是<a href="ml-classification-regression.html#decision-trees">决策树的</a>集合。GBT反复训练决策树，以使损失函数最小化。的<code>spark.ml</code>实现使用连续和分类功能支持GBT用于二进制分类和回归。</p>

<p>有关算法本身的更多信息，请参见<a href="mllib-ensembles.html#gradient-boosted-trees-gbts"><code>spark.mllib</code> GBT文件</a> 。</p>

<h3 id="inputs-and-outputs-2">输入和输出</h3>

<p>我们在此处列出输入和输出（预测）列类型。所有输出列都是可选的；要排除输出列，请将其对应的Param设置为空字符串。</p>

<h4 id="input-columns-2">输入栏</h4>

<table class="table">
  <thead>
    <tr>
      <th align="left">参数名称</th>
      <th align="left">类型</th>
      <th align="left">默认</th>
      <th align="left">描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>标签颜色</td>
      <td>双</td>
      <td>“标签”</td>
      <td>标签来预测</td>
    </tr>
    <tr>
      <td>功能</td>
      <td>向量</td>
      <td>“特征”</td>
      <td>特征向量</td>
    </tr>
  </tbody>
</table>

<p>注意<code>GBTClassifier</code>当前仅支持二进制标签。</p>

<h4 id="output-columns-predictions-1">输出列（预测）</h4>

<table class="table">
  <thead>
    <tr>
      <th align="left">参数名称</th>
      <th align="left">类型</th>
      <th align="left">默认</th>
      <th align="left">描述</th>
      <th align="left">笔记</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>预测颜色</td>
      <td>双</td>
      <td>“预测”</td>
      <td>预测标签</td>
      <td></td>
    </tr>
  </tbody>
</table>

<p>在将来， <code>GBTClassifier</code>还将输出用于<code>rawPrediction</code>和<code>probability</code> ， 就像<code>RandomForestClassifier</code>做。</p>



                </div>
            
             <!-- /container -->
        </div>

        <script src="js/vendor/jquery-1.12.4.min.js"></script>
        <script src="js/vendor/bootstrap.min.js"></script>
        <script src="js/vendor/anchor.min.js"></script>
        <script src="js/main.js"></script>

        <!-- MathJax Section -->
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
                TeX: { equationNumbers: { autoNumber: "AMS" } }
            });
        </script>
        <script>
            // Note that we load MathJax this way to work with local file (file://), HTTP and HTTPS.
            // We could use "//cdn.mathjax...", but that won't support "file://".
            (function(d, script) {
                script = d.createElement('script');
                script.type = 'text/javascript';
                script.async = true;
                script.onload = function(){
                    MathJax.Hub.Config({
                        tex2jax: {
                            inlineMath: [ ["$", "$"], ["\\\\(","\\\\)"] ],
                            displayMath: [ ["$$","$$"], ["\\[", "\\]"] ],
                            processEscapes: true,
                            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
                        }
                    });
                };
                script.src = ('https:' == document.location.protocol ? 'https://' : 'http://') +
                    'cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js' +
                    '?config=TeX-AMS-MML_HTMLorMML';
                d.getElementsByTagName('head')[0].appendChild(script);
            }(document));
        </script>
    

</body></html>