<html ><head>
<link rel="stylesheet" type="text/css" href="../css/style.css">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<title>Apache JMeter-用户手册：最佳实践</title>
<style>
  .code { font-weight: bold; }
</style>
</head>

<body bgcolor="#ffffff"  text="#000000" link="#525D76">
<table border="0" cellspacing="0">
<tbody><tr>
<td align="left">
<a href="http://www.apache.org"><img title="Apache软件基金会" width="261" height="106" src="../images/asf-logo.png" border="0" style="margin:0px 30px 0px 0px"></a>
</td>
<td align="right">
<a href="http://jmeter.apache.org/"><img width="259" height="88" src="../images/jmeter.png" alt="Apache JMeter" title="Apache JMeter" border="0"></a>
</td>
</tr>
</tbody></table>
<table border="0" cellspacing="4">
<tbody><tr><td>
<hr noshade size="1">
</td></tr>
<tr>
<td align="left" valign="top">
<table>
<tbody><tr>
<td bgcolor="#525D76">
<div align="right"><a href="index.html"><font size="-1" color="#ffffff" face="arial,helvetica,sanserif">指数</font></a></div>
</td>
<td bgcolor="#525D76">
<div align="right"><a href="boss.html"><font size="-1" color="#ffffff" face="arial,helvetica,sanserif">下一个</font></a></div>
</td>
<td bgcolor="#525D76">
<div align="right"><a href="realtime-results.html"><font size="-1" color="#ffffff" face="arial,helvetica,sanserif">上一个</font></a></div>
</td>
</tr>
</tbody></table>
<br>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="best_practices"><strong>16。最佳实践</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
</blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="use_latest_version"><strong>16.1始终使用最新版本的JMeter</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>JMeter的性能正在不断提高，因此强烈建议用户使用最新版本。<br>确保您始终阅读<a href="../changes.html">更改列表</a> ，以了解新的改进和组件。您绝对应该避免使用比最后一个版本早3个版本的版本。
</p></blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="sizing_threads"><strong>16.2使用正确的线程数</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>您的硬件功能以及测试计划设计都将影响您可以使用JMeter有效运行的线程数。该数字还取决于服务器的运行速度（更快的服务器会使JMeter更加努力地工作，因为它会更快地返回响应）。与任何负载测试工具一样，如果您没有正确设置线程数的大小，则会遇到“协调遗漏”问题，这可能会给您带来错误或不正确的结果。如果您需要大规模的负载测试，请考虑使用分布式模式在多台计算机上运行多个CLI JMeter实例（是否需要）。使用分布式模式时，结果文件将在Controller节点上合并，如果使用多个自治实例，则可以合并样本结果文件以进行后续分析。为了测试JMeter在给定平台上的性能，可以使用JavaTest采样器。它不需要任何网络访问，因此可以对可实现的最大吞吐量有所了解。
</p><p>JMeter可以选择延迟创建线程，直到线程开始采样为止，即在任何线程组延迟和线程本身的启动时间之后。前提是并发活动的线程数量不多，这将允许非常大的线程总数。
</p></blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="put_cookie_manager"><strong>16.3放置Cookie管理器的位置</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>有关信息，请参见<a href="build-web-test-plan.html#adding_cookie_support">构建Web测试</a> 。</p></blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="put_auth_manager"><strong>16.4放置授权管理器的位置</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>有关信息，请参见<a href="build-adv-web-test-plan.html#header_manager">构建高级Web测试</a> 。</p></blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="proxy_server"><strong>16.5使用HTTP（S）测试脚本记录器</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>有关设置<a href="../usermanual/component_reference.html#HTTP(S)_Test_Script_Recorder">记录器</a>的详细信息，请参考<a href="../usermanual/component_reference.html#HTTP(S)_Test_Script_Recorder">HTTP（S）测试脚本记录</a>器。最重要的是过滤掉所有您不感兴趣的请求。例如，记录图像请求毫无意义（可以指示JMeter在页面上下载所有图像-请参阅<a href="../usermanual/component_reference.html#HTTP_Request">HTTP Request</a> ）。这些只会使您的测试计划变得混乱。最有可能的是，您的所有文件共享都有一个扩展名，例如<tt class="code">.jsp</tt> ， <tt class="code">.asp</tt> ， <tt class="code">.php</tt> ， <tt class="code">.html</tt>等。您应该通过输入“ <tt class="code">包括</tt> ”这些内容<tt class="code">。* \。jsp</tt> “作为“包含模式”。</p><p>或者，您可以通过输入“”排除图像<tt class="code">。* \。gif</tt> “作为“排除模式”。根据您的应用程序，这可能不是更好的方法。您可能还必须排除样式表，javascript文件和其他包含的文件。测试您的设置以验证您正在录制所需的内容，然后擦除并重新开始。</p><p>HTTP（S）测试脚本记录器希望找到一个带有记录控制器的ThreadGroup元素，该元素将在其中记录HTTP请求。这样可以方便地将所有样品打包在一个控制器下，该控制器可以命名为描述测试用例的名称。</p><p>现在，完成一个测试用例的步骤。如果您没有预定义的测试用例，请使用JMeter记录您的操作以定义您的测试用例。完成一系列确定的步骤后，将整个测试用例保存在一个适当命名的文件中。然后，擦拭干净并开始一个新的测试用例。通过这样做，您可以快速记录大量的测试用例“草稿”。</p><p>HTTP（S）测试脚本记录器最有用的功能之一是，您可以从记录的样本中抽象出某些常见元素。通过在“测试计划”级别或“ <a href="../usermanual/component_reference.html#User_Defined_Variables">用户定义的变量”</a>元素中定义一些<a href="functions.html">用户</a> <a href="../usermanual/component_reference.html#User_Defined_Variables">定义的变量</a> ，您可以让JMeter自动替换记录的样本中的值。例如，如果要在服务器“ <tt class="code">xxx.example.com</tt> ”上测试应用程序，则可以定义一个名为“ <tt class="code">server</tt> ”的变量，其值应为“ <tt class="code">xxx.example.com</tt> ”，并在记录的任何位置找到该值样本将被替换为“ <tt class="code">$ {server}</tt> ”。

</p><p>
</p><table border="1" bgcolor="#bbbb00" width="50%" cellspacing="0" cellpadding="2">
<tbody><tr><td>请注意，匹配区分大小写。</td></tr>
</tbody></table>
<p></p>


<p></p><p>如果JMeter不记录任何样本，请检查浏览器是否确实在使用代理。如果即使JMeter不在运行，浏览器也可以正常工作，则浏览器无法使用代理。一些浏览器会忽略<tt class="code">localhost</tt>或<tt class="code">127.0.0.1的</tt>代理设置；尝试改用本地主机名或IP。
</p><p>错误“ <tt class="code">unknown_ca</tt> ”可能意味着您正在尝试记录HTTPS，并且浏览器未接受JMeter代理服务器证书。
</p></blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="user_variables"><strong>16.6用户变量</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>一些测试计划需要为不同的用户/线程使用不同的值。例如，您可能想测试一个序列，该序列要求每个用户都具有唯一的登录名。使用JMeter提供的功能很容易实现。
</p><p>例如：</p><ul>
<li>创建一个包含用户名和密码的文本文件，用逗号分隔。将其放在测试计划所在的目录中。
</li>
<li>将CSV数据集配置元素添加到测试计划。将变量命名为<tt class="code">USER</tt>和<tt class="code">PASS</tt> 。</li>
<li>在适当的采样器上，将登录名替换为<tt class="code">$ {USER}</tt> ，将密码替换<tt class="code">为$ {PASS}</tt></li>
</ul><p>CSV数据集元素将为每个线程读取一个新行。
</p></blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="lean_mean"><strong>16.7减少资源需求</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>关于减少资源使用的一些建议。
</p><ul>
<li>使用CLI模式： <tt class="code">jmeter -n -t test.jmx -l test.jtl</tt></li>
<li>使用尽可能少的侦听器；如果使用上述的<tt class="code">-l</tt>标志，则可以全部删除或禁用它们。</li>
<li>在负载测试期间，请勿使用“查看结果树”或“在表中查看结果”侦听器，仅在脚本编写阶段使用它们来调试脚本。</li>
<li>与其使用大量相似的采样器，不如在循环中使用相同的采样器，并使用变量（CSV数据集）来改变采样。[包含控制器在这里没有帮助，因为它将文件中的所有测试元素添加到测试计划中。
</li>
<li>不要使用功能模式</li>
<li>使用CSV输出而不是XML</li>
<li>只保存您需要的数据</li>
<li>使用尽可能少的断言</li>
<li>使用性能最高的脚本语言（请参阅“ JSR223”部分）</li>
</ul><p>如果您的测试需要大量数据（特别是需要将其随机化），请在可通过CSV数据集读取的文件中创建测试数据。这样可以避免在运行时浪费资源。
</p></blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="beanshell_server"><strong>16.8 BeanShell服务器</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>BeanShell解释器具有非常有用的功能-它可以充当服务器，可以通过telnet或http访问。
</p><p>
</p><table border="1" bgcolor="#bbbb00" width="50%" cellspacing="0" cellpadding="2">
<tbody><tr><td>没有安全性。可以连接到该端口的任何人都可以发出任何BeanShell命令。这些可以提供对JMeter应用程序和主机的无限制访问。
<b>除非端口被保护（例如，通过防火墙）以防止访问，否则请勿启用服务器。</b>
</td></tr>
</tbody></table>
<p></p>
<p>如果您希望使用服务器，请在<tt class="code">jmeter.properties中</tt>定义以下<tt class="code">内容</tt> ：</p><div align="left">
<table cellspacing="4" cellpadding="0" border="0">
<tbody><tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#ffffff"><pre>
beanshell.server.port=9000
beanshell.server.file=../extras/startup.bsh
</pre></td>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
</tbody></table>
</div>
<p>在上面的示例中，服务器将启动，并将侦听端口<tt class="code">9000</tt>和<tt class="code">9001</tt> 。端口<tt class="code">9000</tt>将用于http访问。端口<tt class="code">9001</tt>将用于telnet访问。服务器将处理<tt class="code">startup.bsh</tt>文件，该文件可用于定义各种功能和设置变量。启动文件定义了用于设置和打印JMeter的方法以及系统属性。这是您在JMeter控制台中应该看到的内容：</p><div align="left">
<table cellspacing="4" cellpadding="0" border="0">
<tbody><tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#ffffff"><pre>
Startup script running
Startup script completed
Httpd started on port: 9000
Session started on port: 9001
</pre></td>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
</tbody></table>
</div>
<p>有一个示例脚本（ <tt class="code">extras / remote.bsh</tt> ）可用于测试服务器。[看看它是如何工作的。]
<br>在JMeter <tt class="code">bin</tt>目录中启动它时（如果从其他位置运行，请根据需要调整路径），输出应如下所示：</p><div align="left">
<table cellspacing="4" cellpadding="0" border="0">
<tbody><tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#ffffff"><pre>
$ java -jar ../lib/bshclient.jar localhost 9000 ../extras/remote.bsh
Connecting to BSH server on localhost:9000
Reading responses from server …
BeanShell 2.0b5 - by Pat Niemeyer (pat@pat.net)
bsh % remote.bsh starting
user.home = C:\Documents and Settings\User
user.dir = D:\eclipseworkspaces\main\JMeter_trunk\bin
Setting property 'EXAMPLE' to '0'.
Setting property 'EXAMPLE' to '1'.
Setting property 'EXAMPLE' to '2'.
Setting property 'EXAMPLE' to '3'.
Setting property 'EXAMPLE' to '4'.
Setting property 'EXAMPLE' to '5'.
Setting property 'EXAMPLE' to '6'.
Setting property 'EXAMPLE' to '7'.
Setting property 'EXAMPLE' to '8'.
Setting property 'EXAMPLE' to '9'.
EXAMPLE = 9
remote.bsh ended
bsh % … disconnected from server.
</pre></td>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
</tbody></table>
</div>

<p></p><p>作为一个实际示例，假设您在CLI模式下运行了一个长时间运行的JMeter测试，并且您想在测试期间的不同时间改变吞吐量。测试计划包括一个常量吞吐量计时器，该计时器根据属性定义，例如<tt class="code">$ {__ P（throughput）}</tt> 。以下BeanShell命令可用于更改测试：</p><div align="left">
<table cellspacing="4" cellpadding="0" border="0">
<tbody><tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#ffffff"><pre>
printprop(&quot;throughput&quot;);
curr = Integer.decode(args[0]);  // Start value
inc  = Integer.decode(args[1]);  // Increment
end  = Integer.decode(args[2]);  // Final value
secs = Integer.decode(args[3]);  // Wait between changes
while(curr &lt;= end) {
  setprop(&quot;throughput&quot;,curr.toString()); // Needs to be a string here
  Thread.sleep(secs*1000);
  curr += inc;
}
printprop(&quot;throughput&quot;);
</pre></td>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
</tbody></table>
</div>
<p>该脚本可以存储在一个文件（例如， <tt class="code">throughput.bsh</tt> ）中，并使用<tt class="code">bshclient.jar</tt>发送到服务器。例如：</p><div align="left">
<table cellspacing="4" cellpadding="0" border="0">
<tbody><tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#ffffff"><pre>
java -jar ../lib/bshclient.jar localhost 9000 throughput.bsh 70 5 100 60
</pre></td>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
</tbody></table>
</div>
</blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="bsh_scripting"><strong>16.9 BeanShell脚本</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>
</p><table border="1" bgcolor="#bbbb00" width="50%" cellspacing="0" cellpadding="2">
<tbody><tr><td>从JMeter 3.1开始，我们建议从BeanShell切换到JSR223测试元素（有关更多详细信息，请参见下面的JSR223部分），并从<tt class="code"><a href="functions.html#__BeanShell">__Beanshell</a></tt>函数切换到<a href="functions.html#__groovy">__groovy</a>函数。</td></tr>
</tbody></table>
<p></p>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#828DA6">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="bsh_overview"><strong>16.9.1概述</strong></a>
</font>
</td></tr>
<tr><td>
<blockquote>
<p>每个BeanShell测试元素都有自己的解释器副本（针对每个线程）。如果测试元素被重复调用（例如在循环内），则解释器将在两次调用之间保留，除非“ <tt class="code">Reset bsh”。选择“ 每个呼叫之前的翻译</tt> ”选项。
</p><p>一些长时间运行的测试可能会导致解释器使用大量内存。如果是这种情况，请尝试使用重置选项。
</p><p>您可以使用命令行解释器在JMeter外部测试BeanShell脚本：</p><div align="left">
<table cellspacing="4" cellpadding="0" border="0">
<tbody><tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#ffffff"><pre>
$ java -cp bsh-xxx.jar[;other jars as needed] bsh.Interpreter file.bsh [parameters]
</pre></td>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
</tbody></table>
</div>要么<div align="left">
<table cellspacing="4" cellpadding="0" border="0">
<tbody><tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#ffffff"><pre>
$ java -cp bsh-xxx.jar bsh.Interpreter
bsh% source(&quot;file.bsh&quot;);
bsh% exit(); // or use EOF key (e.g. ^Z or ^D)
</pre></td>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
</tbody></table>
</div>

<p></p></blockquote>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#828DA6">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="bsh_variables"><strong>16.9.2共享变量</strong></a>
</font>
</td></tr>
<tr><td>
<blockquote>
<p>可以在启动（初始化）脚本中定义变量。除非使用reset选项，否则这些将在test元素的调用之间保留。
</p><p>脚本还可以使用<tt class="code">vars</tt>变量的<tt class="code">get（）</tt>和<tt class="code">put（）</tt>方法访问JMeter变量，例如：</p><div align="left">
<table cellspacing="4" cellpadding="0" border="0">
<tbody><tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#ffffff"><pre>vars.get(&quot;HOST&quot;);
vars.put(&quot;MSG&quot;,&quot;Successful&quot;);</pre></td>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
</tbody></table>
</div><tt class="code">get（）</tt>和<tt class="code">put（）</tt>方法仅支持具有String值的变量，但是还有<tt class="code">getObject（）</tt>和<tt class="code">putObject（）</tt>方法可用于任意对象。JMeter变量是线程本地的，但是可以用于所有测试元素（不仅限于Beanshell）。
<p></p><p>如果需要在线程之间共享变量，则可以使用JMeter属性：</p><div align="left">
<table cellspacing="4" cellpadding="0" border="0">
<tbody><tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#ffffff"><pre>
import org.apache.jmeter.util.JMeterUtils;
String value = JMeterUtils.getPropDefault(&quot;name&quot;,&quot;&quot;);
JMeterUtils.setProperty(&quot;name&quot;, &quot;value&quot;);
</pre></td>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
</tbody></table>
</div>样本<tt class="code">.bshrc</tt>文件包含<tt class="code">getprop（）</tt>和<tt class="code">setprop（）</tt>方法的样本定义。
<p></p><p>共享变量的另一种可能方法是使用“ <tt class="code">bsh.shared</tt> ”共享名称空间。例如：</p><div align="left">
<table cellspacing="4" cellpadding="0" border="0">
<tbody><tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#ffffff"><pre>
if (bsh.shared.myObj == void){
    // not yet defined, so create it:
    myObj = new AnyObject();
}
bsh.shared.myObj.process();
</pre></td>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
</tbody></table>
</div>可以在JMeter属性“ <tt class="code">beanshell.init.file</tt> ”定义的启动文件中创建对象，而不是在test元素中创建对象。这仅处理一次。
<p></p></blockquote>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
</blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="developing_scripts"><strong>16.10用Groovy或Jexl3等开发脚本函数</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>将脚本作为功能编写和测试非常困难。但是，JMeter具有JSR223采样器，可以与支持它的任何语言一起使用。我们建议使用<a href="http://www.groovy-lang.org/">Apache Groovy</a>或任何支持<tt class="code"><a href="https://docs.oracle.com/javase/8/docs/api/javax/script/Compilable.html">JSR223的Compilable</a></tt>接口的语言。
</p><p>创建一个包含JSR223 Sampler和Tree View Listener的简单测试计划。在采样器脚本窗格中编写脚本代码，然后通过运行测试对其进行测试。如果有任何错误，这些错误将显示在Tree View和<tt class="code">jmeter.log</tt>文件中。运行脚本的结果也将显示为响应。
</p><p>脚本正常运行后，可以将其作为变量存储在测试计划中。然后可以使用脚本变量创建函数调用。例如，假设Groovy脚本存储在变量<tt class="code">RANDOM_NAME中</tt> 。然后可以将函数调用编码为<tt class="code">$ {__ groovy（$ {RANDOM_NAME}）}</tt> 。无需在脚本中转义任何逗号，因为函数调用是在插入变量的值之前进行解析的。
</p></blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="parameterising_tests"><strong>16.11参数化测试</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>能够使用不同的设置重新运行同一测试通常很有用。例如，更改线程或循环数，或更改主机名。
</p><p>一种方法是在测试计划中定义一组变量，然后在测试元素中使用这些变量。例如，可以定义变量<tt class="code">LOOPS = 10</tt> ，并将其在线程组中称为<tt class="code">$ {LOOPS}</tt> 。要使用20个循环运行测试，只需更改测试计划中<tt class="code">LOOPS</tt>变量的值即可。
</p><p>如果要在CLI模式下运行大量测试，这很快就会变得乏味。一种解决方案是根据属性定义测试计划变量，例如<tt class="code">LOOPS = $ {__ P（loops，10）}</tt> 。这使用属性“ <tt class="code">loops</tt> ”的值，如果找不到该属性，则默认为<tt class="code">10</tt> 。然后可以在JMeter命令行上定义“ <tt class="code">loops</tt> ”属性：</p><div align="left">
<table cellspacing="4" cellpadding="0" border="0">
<tbody><tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#ffffff"><pre>jmeter … -Jloops=12 …</pre></td>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
</tbody></table>
</div>如果有很多属性需要一起更改，那么一种实现方法是使用一组属性文件。可以使用<tt class="code">-q</tt>命令行选项将适当的属性文件传递给JMeter。
<p></p></blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="jsr223"><strong>16.12 JSR223元素</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>对于密集的负载测试，推荐的脚本语言是ScriptingEngine实现<tt class="code"><a href="https://docs.oracle.com/javase/8/docs/api/javax/script/Compilable.html">Compilable</a></tt>接口的一种脚本语言。Groovy脚本引擎实现<tt class="code"><a href="https://docs.oracle.com/javase/8/docs/api/javax/script/Compilable.html">Compilable</a></tt> 。但是，从JMeter 3.1发行之日起，Beanshell和Javascript都没有这样做，因此建议您避免使用它们进行密集的负载测试。
</p><p>
</p><table border="1" bgcolor="#bbbb00" width="50%" cellspacing="0" cellpadding="2">
<tbody><tr><td>注意：Beanshell实现了<tt class="code"><a href="https://docs.oracle.com/javase/8/docs/api/javax/script/Compilable.html">Compilable</a></tt>接口，但尚未进行编码-该方法仅引发Exception。JMeter针对此错误进行了明确的工作。</td></tr>
</tbody></table>
<p></p>使用JSR 223元素时，建议检查“ <tt class="code">缓存编译的脚本”是否有可用</tt>属性，以确保在基础语言支持的情况下缓存脚本编译。在这种情况下，确保脚本不使用任何变量使用<tt class="code">$ {varName中}</tt>如缓存将采取只<tt class="code">$ {varName的}</tt>第一个值。而是使用：<div align="left">
<table cellspacing="4" cellpadding="0" border="0">
<tbody><tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#ffffff"><pre>
vars.get(&quot;varName&quot;)
</pre></td>
<td bgcolor="#023264" width="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
<tr>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
<td bgcolor="#023264" width="1" height="1"><img src="/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td>
</tr>
</tbody></table>
</div>

<p></p><p>您还可以将它们作为参数传递给脚本并以这种方式使用它们。
</p></blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="sharing_variables"><strong>16.13在线程和线程组之间共享变量</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>变量是线程本地的；一个线程中设置的变量无法在另一个线程中读取。这是设计使然。有关在测试开始之前可以确定的变量，请参见<a href="#parameterising_tests">参数化测试</a> （上文）。如果在测试开始之前不知道该值，则有多种选择：</p><ul>
<li>将变量存储为属性-属性对于JMeter实例是全局的</li>
<li>将变量写入文件并重新读取。</li>
<li>使用<tt class="code">bsh.shared</tt>命名空间-参见<a href="#bsh_variables">上文</a></li>
<li>编写自己的Java类</li>
</ul>
<p></p></blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="properties"><strong>16.14管理属性</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>当需要修改jmeter属性时，请确保不修改<tt class="code">jmeter.properties</tt>文件， <b>而是从<tt class="code">jmeter.properties</tt>复制该属性，并在<tt class="code">user.properties</tt>文件中修改其值</b> 。<br>这样做将简化您向JMeter下一版本的迁移。<br>请注意，在文档<tt class="code">jmeter.properties</tt>中经常提到它，但应将其理解为“将要修改的属性从<tt class="code">jmeter.properties</tt>复制到<tt class="code">user.properties</tt> ，并在后一个文件中这样做”。</p><p>
</p><table border="1" bgcolor="#bbbb00" width="50%" cellspacing="0" cellpadding="2">
<tbody><tr><td><tt class="code">user.properties</tt>文件取代<tt class="code">jmeter.properties中</tt>定义的属性</td></tr>
</tbody></table>
<p></p>
</blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="deprecation"><strong>16.15过时的元素</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>建议不要使用已弃用的元素（在<a href="../changes.html">更改列表</a>和<a href="./component_reference.html">组件参考中</a>标记为已弃用的元素），如果有可用的新方法或执行相同操作的新方法，请迁移到新的建议元素。<br>已弃用的元素在版本N中从菜单中删除，但可以通过修改<tt class="code">user.properties</tt>文件中的<tt class="code">not_in_menu</tt>属性并从那里删除元素的完整类名称来启用迁移。<br>
</p><p>
</p><table border="1" bgcolor="#bbbb00" width="50%" cellspacing="0" cellpadding="2">
<tbody><tr><td>请注意，版本N + 1中肯定会删除版本N中已弃用的元素，因此请确保尽快停止使用它们。</td></tr>
</tbody></table>
<p></p>
</blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<br>
<table>
<tbody><tr>
<td bgcolor="#525D76">
<div align="right"><a href="index.html"><font size="-1" color="#ffffff" face="arial,helvetica,sanserif">指数</font></a></div>
</td>
<td bgcolor="#525D76">
<div align="right"><a href="boss.html"><font size="-1" color="#ffffff" face="arial,helvetica,sanserif">下一个</font></a></div>
</td>
<td bgcolor="#525D76">
<div align="right"><a href="realtime-results.html"><font size="-1" color="#ffffff" face="arial,helvetica,sanserif">上一个</font></a></div>
</td>
</tr>
</tbody></table>
</td>
</tr>
<tr><td>
<hr noshade size="1">
</td></tr>
<tr>
<td>
<table width="100%">
<tbody><tr>
<td>
<font color="#525D76" size="-1"><em>版权所有©1999-2019，Apache软件基金会</em></font>
</td>
<td align="right">
<font color="#525D76" size="-1"><em>$ Id $</em></font>
</td>
</tr>
<tr><td colspan="2">
<div align="center"><font color="#525D76" size="-1">Apache，Apache JMeter，JMeter，Apache Feather和Apache JMeter徽标是Apache Software Foundation的商标。
</font>
</div>
</td></tr>
</tbody></table>
</td>
</tr>
</tbody></table>


<!-- end the processing -->














































</body></html>