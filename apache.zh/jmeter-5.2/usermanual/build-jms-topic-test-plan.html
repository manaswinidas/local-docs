<html ><head>
<link rel="stylesheet" type="text/css" href="../css/style.css">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<title>Apache JMeter-用户手册：构建JMS（Java消息服务）测试计划</title>
<style>
  .code { font-weight: bold; }
</style>
</head>

<body bgcolor="#ffffff"  text="#000000" link="#525D76">
<table border="0" cellspacing="0">
<tbody><tr>
<td align="left">
<a href="http://www.apache.org"><img title="Apache软件基金会" width="261" height="106" src="../images/asf-logo.png" border="0" style="margin:0px 30px 0px 0px"></a>
</td>
<td align="right">
<a href="http://jmeter.apache.org/"><img width="259" height="88" src="../images/jmeter.png" alt="Apache JMeter" title="Apache JMeter" border="0"></a>
</td>
</tr>
</tbody></table>
<table border="0" cellspacing="4">
<tbody><tr><td>
<hr noshade size="1">
</td></tr>
<tr>
<td align="left" valign="top">
<table>
<tbody><tr>
<td bgcolor="#525D76">
<div align="right"><a href="index.html"><font size="-1" color="#ffffff" face="arial,helvetica,sanserif">指数</font></a></div>
</td>
<td bgcolor="#525D76">
<div align="right"><a href="listeners.html"><font size="-1" color="#ffffff" face="arial,helvetica,sanserif">下一个</font></a></div>
</td>
<td bgcolor="#525D76">
<div align="right"><a href="build-jms-point-to-point-test-plan.html"><font size="-1" color="#ffffff" face="arial,helvetica,sanserif">上一个</font></a></div>
</td>
</tr>
</tbody></table>
<br>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="building"><strong>11。建立一个JMS主题测试计划</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>
</p><table border="1" bgcolor="#bbbb00" width="50%" cellspacing="0" cellpadding="2">
<tbody><tr><td>JMS需要下载一些可选的jar。有关完整的详细信息，请参阅《 <a href="get-started.html">入门》</a> 。
</td></tr>
</tbody></table>
<p></p>
<p>在本节中，您将学习如何创建<a href="build-test-plan.html">测试计划</a>以测试JMS提供者。您将创建5个订阅者和1个发布者。您将创建2个线程组，并将每个线程组设置为10个迭代。消息总数为（6个线程）x（1条消息）x（重复10次）= 60条消息。要构建测试计划，您将使用以下元素： <a href="test_plan.html#thread_group">线程组</a> ， <a href="../usermanual/component_reference.html#JMS_Publisher">JMS Publisher</a> ， <a href="../usermanual/component_reference.html#JMS_Subscriber">JMS Subscriber</a>和<a href="../usermanual/component_reference.html#Graph_Results">Graph Results</a> 。</p><p>关于JMS的一般说明：当前有两个JMS采样器。一个使用JMS主题，另一个使用队列。主题消息通常称为发布/订阅消息。主题消息传递通常用于生产者发布消息并被多个订户使用的情况。队列消息传递通常用于发送方期望响应的事务。消息系统与普通的HTTP请求有很大的不同。在HTTP中，单个用户发送请求并获得响应。消息系统可以在同步和异步模式下工作。JMS采样器需要JMS实施jar文件。例如，来自Apache ActiveMQ。请参阅<a href="get-started.html#libraries_activemq">此处</a>以获取ActiveMQ提供的jar列表。</p></blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="adding_users"><strong>11.1添加用户</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>第一步是添加<a href="test_plan.html#thread_group">线程组</a>元素。线程组告诉JMeter您要模拟的用户数量，用户应多久发送一次请求以及应发送多少次请求。</p><p>继续并通过首先选择“测试计划”来添加ThreadGroup元素，单击鼠标右键以获取“ <span class="menuchoice"><span class="guimenuitem">添加”</span></span>菜单，然后选择“ <span class="menuchoice"><span class="guimenuitem">添加”</span> →“ <span class="guimenuitem">ThreadGroup”</span></span> 。</p><p>现在，您应该在“测试计划”下看到“线程组”元素。如果没有看到该元素，则通过单击“测试计划”元素来“扩展”测试计划树。</p><p>接下来，您需要修改默认属性。如果尚未选择线程组元素，则在树中选择它。现在，您应该在JMeter窗口的右侧看到线程组控制面板（请参见下面的图11.1）</p><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td><img src="../images/screenshots/webtest/threadgroup.png"><br>
<font size="-1">图11.1。具有默认值的线程组</font></td></tr></tbody></table>
<p>首先为我们的线程组提供一个更具描述性的名称。在名称字段中，输入<tt class="code">Subscribers</tt> 。</p><p>接下来，将用户（称为线程）数量增加到<tt class="code">5个</tt> 。</p><p>在下一个字段“加速周期”中，将该值设置为<tt class="code">0</tt>秒。该属性告诉JMeter启动每个用户之间要延迟多长时间。例如，如果您输入5秒钟的加速期，JMeter将在5秒钟结束时完成所有用户的启动。因此，如果我们有5个用户和5秒钟的加速期，则启动用户之间的延迟将为1秒（5个用户/ 5秒= 1个用户每秒）。如果将该值设置为0，JMeter将立即启动所有用户。</p><p>清除标记为“ <tt class="code">Forever</tt> ”的复选框，然后在“循环计数”字段中输入值<tt class="code">10</tt> 。该属性告诉JMeter重复测试多少次。如果输入的循环计数值为<tt class="code">0</tt> ，那么JMeter将仅运行一次测试。要让JMeter重复运行您的测试计划，请选择<tt class="code">永久</tt>复选框。</p><p>重复该过程并添加另一个线程组。对于第二个线程组，在名称字段中输入“ <tt class="code">Publisher</tt> ”，将线程数设置为<tt class="code">1</tt> ，并将迭代次数设置为<tt class="code">10</tt> 。
</p><p>
</p><table border="1" bgcolor="#bbbb00" width="50%" cellspacing="0" cellpadding="2">
<tbody><tr><td>在大多数应用程序中，您必须手动接受在控制面板中所做的更改。但是，在JMeter中，控制面板会在您进行更改时自动接受它们。如果更改元素的名称，则在离开控制面板后（例如，选择另一个树元素时），树将使用新文本进行更新。</td></tr>
</tbody></table>
<p></p>
</blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="adding_subscriber_publisher"><strong>11.2添加JMS订阅服务器和发布服务器</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>确保所需的jar文件在JMeter的<tt class="code">lib</tt>目录中。如果不是，请关闭JMeter，将jar文件复制过来，然后重新启动JMeter。</p><p>首先将采样器<a href="../usermanual/component_reference.html#JMS_Subscriber">JMS订阅</a>服务器<span class="menuchoice"><span class="guimenuitem">添加</span></span>到Subscribers元素（ <span class="menuchoice"><span class="guimenuitem">添加</span> → <span class="guimenuitem">采样器</span> → <span class="guimenuitem">JMS订阅服务器</span></span> ）。然后，在树中选择“ JMS订阅服务器”元素并编辑以下属性：</p><ol>
<li>将“名称”字段更改为“ <tt class="code">Sample Subscriber</tt> ”</li>
<li>如果JMS提供程序使用<tt class="code">jndi.properties</tt>文件，请选中该框</li>
<li>输入InitialContextFactory类的名称。例如，对于ActiveMQ 5.4，该值为“ <tt class="code">org.apache.activemq.jndi。ActiveMQInitialContextFactory</tt></li>
<li>输入提供商URL。这是JNDI服务器的URL（如果有）。例如，对于具有默认端口的本地计算机上的ActiveMQ 5.4，值是“ <tt class="code">tcp：// localhost：61616</tt> ”</li>
<li>输入连接工厂的名称。请参阅JMS提供程序的文档以获取信息。对于ActiveMQ，默认值为“ <tt class="code">ConnectionFactory</tt> ”</li>
<li>输入消息主题的名称。对于ActiveMQ动态主题（动态创建主题），示例值为“ <tt class="code">dynamicTopics / MyStaticTopic1</tt> ”<p>
</p><table border="1" bgcolor="#bbbb00" width="50%" cellspacing="0" cellpadding="2">
<tbody><tr><td>注意：启动时进行设置意味着JMeter在测试开始时就开始侦听目标，而没有可能更改名称。在每个样本上进行设置意味着JMeter在运行每个JMS Subscriber样本之前（重新）开始侦听，此最后一个选项允许具有一些JMeter变量的Destination名称</td></tr>
</tbody></table>
<p></p>
</li>
<li>如果JMS提供者需要身份验证，请选中“ <tt class="code">required</tt> ”，然后输入用户名和密码。例如，Orion JMS需要身份验证，而ActiveMQ和MQSeries不需要身份验证</li>
<li>在“ <tt class="code">要汇总的样本数</tt> ”中输入<tt class="code">10</tt> 。出于性能原因，采样器将聚合消息，因为小消息将很快到达。如果采样器未聚合消息，JMeter将无法跟上。</li>
<li>如果您想阅读回复，请选中该框</li>
<li>订户有两种客户端实现。如果JMS提供程序在一个客户端上显示僵尸线程，请尝试另一个客户端。</li>
</ol>
<p></p><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td><img width="718" height="526" src="../images/screenshots/jms/jms_sub.png"><br>
<font size="-1">图11.2。JMS订户</font></td></tr></tbody></table>
<p>接下来，将采样器<a href="../usermanual/component_reference.html#JMS_Publisher">JMS Publisher</a>添加到Publisher元素（ <span class="menuchoice"><span class="guimenuitem">添加</span> → <span class="guimenuitem">采样器</span> → <span class="guimenuitem">JMS Publisher</span></span> ）。然后，在树中选择JMS Publisher元素并编辑以下属性：</p><ol>
<li>将名称字段更改为“ <tt class="code">Sample Publisher</tt> ”。</li>
<li>如果JMS提供程序使用<tt class="code">jndi.properties</tt>文件，请选中该框</li>
<li>输入InitialContextFactory类的名称。例如，对于ActiveMQ 5.4，该值为“ <tt class="code">org.apache.activemq.jndi。ActiveMQInitialContextFactory</tt></li>
<li>输入提供商URL。这是JNDI服务器的URL（如果有）。例如，对于具有默认端口的本地计算机上的ActiveMQ 5.4，值是“ <tt class="code">tcp：// localhost：61616</tt> ”</li>
<li>输入连接工厂的名称。请参阅JMS提供程序的文档以获取信息。对于ActiveMQ，默认值为“ <tt class="code">ConnectionFactory</tt> ”</li>
<li>输入消息主题的名称。对于ActiveMQ动态主题（动态创建主题），示例值为“ <tt class="code">dynamicTopics / MyStaticTopic1</tt> ”。
<p>
</p><table border="1" bgcolor="#bbbb00" width="50%" cellspacing="0" cellpadding="2">
<tbody><tr><td>注意：启动时进行设置意味着JMeter在测试开始时就开始与目标的连接，而没有名称更改的可能。在每个样本上进行设置意味着JMeter在运行每个JMS Publisher样本之前（重新）启动连接，这最后一个选项允许具有一些JMeter变量的Destination名称</td></tr>
</tbody></table>
<p></p>
</li>
<li>如果JMS提供者需要身份验证，请选中“ <tt class="code">required</tt> ”，然后输入用户名和密码。例如，Orion JMS需要身份验证，而ActiveMQ和MQSeries不需要身份验证</li>
<li>在“ <tt class="code">要汇总的样本数</tt> ”中输入<tt class="code">10</tt> 。出于性能原因，采样器将聚合消息，因为小消息将很快到达。如果采样器未聚合消息，JMeter将无法跟上。</li>
<li>选择适当的配置以获取要发布的消息。如果希望采样器随机选择消息，请将消息放置在目录中，然后使用浏览选择目录。</li>
<li>选择消息类型。如果消息是对象格式或地图消息，请确保正确生成了消息。</li>
</ol><p></p><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td><img width="720" height="652" src="../images/screenshots/jms/jms_pub.png"><br>
<font size="-1">图11.3JMS发布者</font></td></tr></tbody></table>
</blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<table border="0" cellspacing="0" cellpadding="2" width="100%">
<tbody><tr><td bgcolor="#525D76">
<font color="#ffffff" face="arial,helvetica,sanserif">
<a name="adding_listener"><strong>11.3添加侦听器以查看存储测试结果</strong></a></font>
</td></tr>
<tr><td>
<blockquote>
<p>您需要添加到测试计划中的最后一个元素是<a href="component_reference.html#listeners">Listener</a> 。该元素负责将HTTP请求的所有结果存储在文件中，并提供数据的可视模型。</p><p>选择“测试计划”元素并添加一个“ <a href="../usermanual/component_reference.html#Graph_Results">图形结果”</a>侦听器（“ <span class="menuchoice"><span class="guimenuitem">添加”</span> →“ <span class="guimenuitem">侦听器”</span> →“ <span class="guimenuitem">图形结果”</span></span> ）。接下来，您需要指定输出文件的目录和文件名。您可以在“文件名”字段中键入它，或选择“浏览”按钮并浏览到目录，然后输入文件名。</p><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td><img width="915" height="686" src="../images/screenshots/graph_results.png"><br>
<font size="-1">图11.4。图结果侦听器</font></td></tr></tbody></table>
</blockquote>
<p></p>
</td></tr>
<tr><td><br></td></tr>
</tbody></table>
<br>
<table>
<tbody><tr>
<td bgcolor="#525D76">
<div align="right"><a href="index.html"><font size="-1" color="#ffffff" face="arial,helvetica,sanserif">指数</font></a></div>
</td>
<td bgcolor="#525D76">
<div align="right"><a href="listeners.html"><font size="-1" color="#ffffff" face="arial,helvetica,sanserif">下一个</font></a></div>
</td>
<td bgcolor="#525D76">
<div align="right"><a href="build-jms-point-to-point-test-plan.html"><font size="-1" color="#ffffff" face="arial,helvetica,sanserif">上一个</font></a></div>
</td>
</tr>
</tbody></table>
</td>
</tr>
<tr><td>
<hr noshade size="1">
</td></tr>
<tr>
<td>
<table width="100%">
<tbody><tr>
<td>
<font color="#525D76" size="-1"><em>版权所有©1999-2019，Apache软件基金会</em></font>
</td>
<td align="right">
<font color="#525D76" size="-1"><em>$ Id $</em></font>
</td>
</tr>
<tr><td colspan="2">
<div align="center"><font color="#525D76" size="-1">Apache，Apache JMeter，JMeter，Apache Feather和Apache JMeter徽标是Apache Software Foundation的商标。
</font>
</div>
</td></tr>
</tbody></table>
</td>
</tr>
</tbody></table>


<!-- end the processing -->














































</body></html>