<html lang="zh-Hans" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="./images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9（9.0.21）-Windows服务操作方法</title><meta name="author" content="Mladen Turk"><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/windows-service-howto">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script></head><body ><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="./images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="./images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>Apache Tomcat 9</h1><div class="versionInfo">版本9.0.21， <time datetime="2019-06-04"> 2019年6月4日</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>链接</h2><ul><li><a href="index.html">文件首页</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">常问问题</a></li><li><a href="#comments_section">用户评论</a></li></ul></div><div><h2>用户指南</h2><ul><li><a href="introduction.html">1）简介</a></li><li><a href="setup.html">2）设定</a></li><li><a href="appdev/index.html">3）第一个webapp</a></li><li><a href="deployer-howto.html">4）部署者</a></li><li><a href="manager-howto.html">5）经理</a></li><li><a href="host-manager-howto.html">6）主机管理员</a></li><li><a href="realm-howto.html">7）领域和AAA</a></li><li><a href="security-manager-howto.html">8）安全经理</a></li><li><a href="jndi-resources-howto.html">9）JNDI资源</a></li><li><a href="jndi-datasource-examples-howto.html">10）JDBC数据源</a></li><li><a href="class-loader-howto.html">11）类加载</a></li><li><a href="jasper-howto.html">12）JSP</a></li><li><a href="ssl-howto.html">13）SSL / TLS</a></li><li><a href="ssi-howto.html">14）SSI</a></li><li><a href="cgi-howto.html">15）CGI</a></li><li><a href="proxy-howto.html">16）代理支持</a></li><li><a href="mbeans-descriptors-howto.html">17）MBean描述符</a></li><li><a href="default-servlet.html">18）默认Servlet</a></li><li><a href="cluster-howto.html">19）聚类</a></li><li><a href="balancer-howto.html">20）负载均衡器</a></li><li><a href="connectors.html">21）连接器</a></li><li><a href="monitoring.html">22）监控与管理</a></li><li><a href="logging.html">23）记录</a></li><li><a href="apr.html">24）APR /本地</a></li><li><a href="virtual-hosting-howto.html">25）虚拟主机</a></li><li><a href="aio.html">26）高级IO</a></li><li><a href="extras.html">27）附加组件</a></li><li><a href="maven-jars.html">28）行刑</a></li><li><a href="security-howto.html">29）安全注意事项</a></li><li><a href="windows-service-howto.html">30）Windows服务</a></li><li><a href="windows-auth-howto.html">31）Windows身份验证</a></li><li><a href="jdbc-pool.html">32）Tomcat的JDBC池</a></li><li><a href="web-socket-howto.html">33）WebSocket</a></li><li><a href="rewrite.html">34）改写</a></li></ul></div><div><h2>参考</h2><ul><li><a href="RELEASE-NOTES.txt">发行说明</a></li><li><a href="config/index.html">组态</a></li><li><a href="api/index.html">Tomcat Java文档</a></li><li><a href="servletapi/index.html">Servlet Java文档</a></li><li><a href="jspapi/index.html">JSP 2.3 Java文档</a></li><li><a href="elapi/index.html">EL 3.0 Java文档</a></li><li><a href="websocketapi/index.html">WebSocket 1.1 Java文档</a></li><li><a href="https://tomcat.apache.org/connectors-doc/">JK 1.2文档</a></li></ul></div><div><h2>Apache Tomcat开发</h2><ul><li><a href="building.html">建造</a></li><li><a href="changelog.html">变更日志</a></li><li><a href="https://wiki.apache.org/tomcat/TomcatVersions">状态</a></li><li><a href="developers.html">开发者</a></li><li><a href="architecture/index.html">建筑</a></li><li><a href="funcspecs/index.html">功能规格。</a></li><li><a href="tribes/introduction.html">部族</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>Windows Service的操作方法</h2><h3 id="Table_of_Contents">目录</h3><div class="text">
<ul><li><a href="#Tomcat_service_application">Tomcat服务应用</a></li><li><a href="#Tomcat_monitor_application">Tomcat监视器应用程序</a></li><li><a href="#Command_line_arguments">命令行参数</a></li><li><a href="#Command_line_parameters">命令行参数</a></li><li><a href="#Installing_services">安装服务</a></li><li><a href="#Updating_services">更新服务</a></li><li><a href="#Removing_services">删除服务</a></li><li><a href="#Debugging_services">调试服务</a></li><li><a href="#Multiple_Instances">多个实例</a></li></ul>
</div><h3 id="Tomcat_service_application">Tomcat服务应用</h3><div class="text">
<p>
    <b>Tomcat9</b>是用于将Tomcat 9作为Windows服务运行的服务应用程序。
</p>
</div><h3 id="Tomcat_monitor_application">Tomcat监视器应用程序</h3><div class="text">
<p>
    <b>Tomcat9w</b>是用于监视和配置Tomcat服务的GUI应用程序。
</p>
    <p>可用的命令行选项包括：</p>

    <table class="defaultTable">
    <tbody><tr><td><b>// ES //</b></td>
        <td>编辑服务配置</td>
        <td>这是默认操作。如果提供了no选项，但是将可执行文件重命名为<b>servicenameW.exe</b> ，则调用该方法</td>
    </tr>
    <tr><td><b>//女士//</b></td>
        <td>监控服务</td>
        <td>将图标放入系统托盘</td>
    </tr>
    </tbody></table>

</div><h3 id="Command_line_arguments">命令行参数</h3><div class="text">
<p>每个命令行指令的形式为<b>// XX // ServiceName</b>
</p>
    <p>可用的命令行选项包括：</p>

    <table class="defaultTable">
    <tbody><tr><td><b>// TS //</b></td>
        <td>将服务作为控制台应用程序运行</td>
        <td>这是默认操作。如果提供no选项，则调用它。ServiceName是不带exe后缀的可执行文件的名称，表示Tomcat9</td>
    </tr>
    <tr><td><b>// RS //</b></td>
        <td>运行服务</td>
        <td>仅从ServiceManager调用</td>
    </tr>
    <tr><td><b>// SS //</b></td>
        <td>停止服务</td>
        <td></td>
    </tr>
    <tr><td><b>//我们//</b></td>
        <td>更新服务参数</td>
        <td></td>
    </tr>
    <tr><td><b>// IS //</b></td>
        <td>安装服务</td>
        <td></td>
    </tr>
    <tr><td><b>// DS //</b></td>
        <td>删除服务</td>
        <td>如果正在运行，则停止服务</td>
    </tr>
    </tbody></table>

</div><h3 id="Command_line_parameters">命令行参数</h3><div class="text">
<p>每个命令行参数都以<b>-</b>为前缀。如果命令行参数以<b>++</b>为前缀，则其值将附加到现有选项中。如果环境变量与命令行参数同名但前缀为<code>PR_</code>存在，它将优先。例如：</p>
<div class="codeBox"><pre><code>set PR_CLASSPATH=xx.jar</code></pre></div>

<p>相当于提供</p>
<div class="codeBox"><pre><code>--Classpath=xx.jar</code></pre></div>
<p>作为命令行参数。</p>

    <table class="defaultTable">
    <tbody><tr>
    <th>参数名称</th>
    <th>默认</th>
    <th>描述</th>
    </tr>
    <tr>
    <td>- 描述</td>
    <td></td>
    <td>服务名称说明（最多1024个字符）</td>
    </tr>
    <tr>
    <td>- 显示名称</td>
    <td>服务名称</td>
    <td>服务显示名称</td>
    </tr>
    <tr>
    <td>- 安装</td>
    <td>procrun.exe // RS //服务名</td>
    <td>安装图片</td>
    </tr>
    <tr>
    <td>- 启动</td>
    <td>手册</td>
    <td>服务启动模式可以是<b>自动</b>或<b>手动</b></td>
    </tr>
    <tr>
    <td>- 依赖于取决于</td>
    <td></td>
    <td>该服务所依赖的服务列表。使用<b>＃</b>或<b>;</b>分隔相关服务<b>。</b>人物</td>
    </tr>
    <tr>
    <td>- 环境</td>
    <td></td>
    <td>将以<b>key = value</b>形式提供给服务的环境变量列表。它们用<b>＃</b>或<b>;</b>分隔<b>。</b>字符。如果您需要使用<b>＃</b>或<b>;</b>字符，然后将整个值括在单引号内。</td>
    </tr>
    <tr>
    <td>- 用户</td>
    <td></td>
    <td>用于运行可执行文件的用户帐户。它仅用于StartMode <b>java</b>或<b>exe，</b>并在没有LogonAsService特权的情况下以帐户身份运行应用程序。</td>
    </tr>
    <tr>
    <td>- 密码</td>
    <td></td>
    <td>--User参数设置的用户帐户密码</td>
    </tr>
    <tr>
    <td>--JavaHome</td>
    <td>JAVA_HOME</td>
    <td>设置不同于JAVA_HOME环境变量定义的JAVA_HOME</td>
    </tr>
    <tr>
    <td>-吉恩</td>
    <td>汽车</td>
    <td>使用<b>自动</b> （即从Windows注册表中找到JVM）或指定<b>jvm.dll</b>的完整路径。您可以在此处使用环境变量扩展。</td>
    </tr>
    <tr>
    <td>--JvmOptions</td>
    <td>-Xrs</td>
    <td>将以<b>-D</b>或<b>-X</b>形式显示的选项列表，这些选项将传递给JVM。使用<b>＃</b>或<b>;</b>分隔选项<b>。</b>字符。如果需要嵌入<b>＃</b>或<b>;</b>字符，将它们放在单引号内。（在<b>exe</b>模式下不使用。）</td>
    </tr>
    <tr>
    <td>--JvmOptions9</td>
    <td></td>
    <td>当在Java 9或更高版本上运行时，将以<b>-D</b>或<b>-X</b>形式显示的选项列表将传递给JVM。使用<b>＃</b>或<b>;</b>分隔选项<b>。</b>字符。如果需要嵌入<b>＃</b>或<b>;</b>字符，将它们放在单引号内。（在<b>exe</b>模式下不使用。）</td>
    </tr>
    <tr>
    <td>--Classpath</td>
    <td></td>
    <td>设置Java类路径。（在<b>exe</b>模式下不使用。）</td>
    </tr>
    <tr>
    <td>--JvmMs</td>
    <td></td>
    <td>初始内存池大小，以MB为单位。 （不在<b>exe</b>模式下使用。）</td>
    </tr>
    <tr>
    <td>--JvmMx</td>
    <td></td>
    <td>最大内存池大小（以MB为单位）。 （不在<b>exe</b>模式下使用。）</td>
    </tr>
    <tr>
    <td>--JvmSs</td>
    <td></td>
    <td>线程堆栈大小（以KB为单位）。 （不在<b>exe</b>模式下使用。）</td>
    </tr>
    <tr>
    <td>-开始模式</td>
    <td></td>
    <td><b>jvm</b> ， <b>Java</b>或<b>exe之一</b> 。这些模式是：<ul>
        <li>jvm-启动Java进程。取决于jvm.dll，请参阅<b>--Jvm</b> 。</li>
        <li>Java-与exe相同，但会自动使用默认Java可执行文件，即％JAVA_HOME％\ bin \ java.exe。确保正确设置了JAVA_HOME，或使用--JavaHome提供正确的位置。如果两者均未设置，则procrun将尝试从Windows注册表中查找默认的JDK（而非JRE）。</li>
        <li>exe-将图像作为单独的进程运行</li>
      </ul>
    </td>
    </tr>
    <tr>
    <td>--StartImage</td>
    <td></td>
    <td>将运行的可执行文件。仅适用于<b>exe</b>模式。</td>
    </tr>
    <tr>
    <td>--StartPath</td>
    <td></td>
    <td>起始映像可执行文件的工作路径。</td>
    </tr>
    <tr>
    <td>--StartClass</td>
    <td>主要</td>
    <td>包含启动方法的类。适用于<b>jvm</b>和<b>Java</b>模式。（在<b>exe</b>模式下不使用。）</td>
    </tr>
    <tr>
    <td>--StartMethod</td>
    <td>主要</td>
    <td>方法名称如果不同则主要</td>
    </tr>
    <tr>
    <td>--StartParams</td>
    <td></td>
    <td>将传递给StartImage或StartClass的参数列表。使用<b>＃</b>或<b>;</b>分隔参数<b>。</b>字符。</td>
    </tr>
    <tr>
    <td>-停止模式</td>
    <td></td>
    <td><b>jvm</b> ， <b>Java</b>或<b>exe之一</b> 。有关更多详细信息，请参见<b>--StartMode</b> 。</td>
    </tr>
    <tr>
    <td>--StopImage</td>
    <td></td>
    <td>将在Stop服务信号上运行的可执行文件。仅适用于<b>exe</b>模式。</td>
    </tr>
    <tr>
    <td>--StopPath</td>
    <td></td>
    <td>停止图像可执行文件的工作路径。不适用于<b>JVM</b>模式。</td>
    </tr>
    <tr>
    <td>--StopClass</td>
    <td>主要</td>
    <td>将在“停止”服务信号上使用的类。适用于<b>jvm</b>和<b>Java</b>模式。</td>
    </tr>
    <tr>
    <td>--StopMethod</td>
    <td>主要</td>
    <td>方法名称如果不同则主要</td>
    </tr>
    <tr>
    <td>--StopParams</td>
    <td></td>
    <td>将传递给StopImage或StopClass的参数列表。使用<b>＃</b>或<b>;</b>分隔参数<b>。</b>字符。</td>
    </tr>
    <tr>
    <td>--StopTimeout</td>
    <td>没有超时</td>
    <td>定义procrun等待服务正常退出的超时时间（以秒为单位）。</td>
    </tr>
    <tr>
    <td>--LogPath</td>
    <td>％SystemRoot％\ System32 \ LogFiles \ Apache</td>
    <td>定义日志记录的路径。如有必要，创建目录。</td>
    </tr>
    <tr>
    <td>--LogPrefix</td>
    <td>公地守护进程</td>
    <td>定义服务日志文件名前缀。日志文件在LogPath目录中创建，其中包含<code>.YEAR-MONTH-DAY.log</code>后缀</td>
    </tr>
    <tr>
    <td>--LogLevel</td>
    <td>信息</td>
    <td>定义日志记录级别，可以是<b>Error</b> ， <b>Info</b> ， <b>Warn</b>或<b>Debug</b> 。（不区分大小写）。</td>
    </tr>
    <tr>
    <td>--StdOutput</td>
    <td></td>
    <td>重定向标准输出文件名。如果命名为<b>auto，</b>则会在<b>LogPath</b>内部创建一个名为<b>service-stdout的文件。YEAR-MONTH-DAY.log</b> 。</td>
    </tr>
    <tr>
    <td>--StdError</td>
    <td></td>
    <td>重定向的stderr文件名。如果命名为<b>auto，</b>则会在<b>LogPath</b>内部使用名称<b>service-stderr创建文件<b>。YEAR-MONTH-DAY.log</b> 。</b></td>
    </tr>
    <tr>
    <td>--PidFile</td>
    <td></td>
    <td>定义用于存储正在运行的进程ID的文件名。实际文件在<b>LogPath</b>目录中创建</td>
    </tr>
    </tbody></table>

</div><h3 id="Installing_services">安装服务</h3><div class="text">
<p>手动安装服务的最安全方法是使用提供的<b>service.bat</b>脚本。运行此脚本需要管理员特权。如有必要，您可以使用<code>/user</code>开关以指定用于安装服务的用户。
</p>
<p>
<strong>注意：</strong>在Windows Vista或启用了用户帐户控制（UAC）的任何更高版本的操作系统上，脚本启动'Tomcat9.exe'时，系统会要求您提供其他特权。<br>如果您希望将其他选项作为服务传递给服务安装程序<code>PR_*</code>环境变量，您必须在OS中全局配置它们，或者启动以较高特权设置它们的程序（例如，在Windows 8（或更高版本）或Windows Server上右键单击cmd.exe并选择“以管理员身份运行” 2012（或更高版本），可以通过单击“文件”菜单栏从资源管理器中打开当前目录的提升权限的命令提示符。有关详细信息，请参见问题<a href="https://bz.apache.org/bugzilla/show_bug.cgi?id=56143">56143</a> 。
</p>

<div class="codeBox"><pre><code>Install the service named 'Tomcat9'
C:\&gt; service.bat install</code></pre></div>

<p>有一个第二个可选参数，可让您指定服务的名称，如Windows服务中所示。</p>

<div class="codeBox"><pre><code>Install the service named 'MyService'
C:\&gt; service.bat install MyService</code></pre></div>

<p>如果使用tomcat9.exe，则需要使用<b>// IS //</b>参数。</p>

<div class="codeBox"><pre><code>Install the service named 'Tomcat9'
C:\&gt; tomcat9 //IS//Tomcat9 --DisplayName="Apache Tomcat 9" ^
     --Install="C:\Program Files\Tomcat\bin\tomcat9.exe" --Jvm=auto ^
     --StartMode=jvm --StopMode=jvm ^
     --StartClass=org.apache.catalina.startup.Bootstrap --StartParams=start ^
     --StopClass=org.apache.catalina.startup.Bootstrap --StopParams=stop</code></pre></div>

</div><h3 id="Updating_services">更新服务</h3><div class="text">
<p>要更新服务参数，您需要使用<b>// US //</b>参数。
</p>

<div class="codeBox"><pre><code>Update the service named 'Tomcat9'
C:\&gt; tomcat9 //US//Tomcat9 --Description="Apache Tomcat Server - https://tomcat.apache.org/ " ^
     --Startup=auto --Classpath=%JAVA_HOME%\lib\tools.jar;%CATALINA_HOME%\bin\bootstrap.jar</code></pre></div>

<p>如果为服务提供了一个可选名称，则需要这样指定：</p>

<div class="codeBox"><pre><code>Update the service named 'MyService'
C:\&gt; tomcat9 //US//MyService --Description="Apache Tomcat Server - https://tomcat.apache.org/ " ^
     --Startup=auto --Classpath=%JAVA_HOME%\lib\tools.jar;%CATALINA_HOME%\bin\bootstrap.jar</code></pre></div>

</div><h3 id="Removing_services">删除服务</h3><div class="text">
<p>要删除该服务，您需要使用<b>// DS //</b>参数。<br>如果服务正在运行，它将停止然后删除。</p>

<div class="codeBox"><pre><code>Remove the service named 'Tomcat9'
C:\&gt; tomcat9 //DS//Tomcat9</code></pre></div>

<p>如果为服务提供了一个可选名称，则需要这样指定：</p>

<div class="codeBox"><pre><code>Remove the service named 'MyService'
C:\&gt; tomcat9 //DS//MyService</code></pre></div>

</div><h3 id="Debugging_services">调试服务</h3><div class="text">
<p>要在控制台模式下运行服务，您需要使用<b>// TS //</b>参数。可以通过按<b>CTRL + C</b>或<b>CTRL + BREAK</b>来启动服务关闭。如果将tomcat9.exe重命名为testservice.exe，则只需执行testservice.exe，默认情况下将执行此命令模式。</p>

<div class="codeBox"><pre><code>Run the service named 'Tomcat9' in console mode
C:\&gt; tomcat9 //TS//Tomcat9 [additional arguments]
Or simply execute:
C:\&gt; tomcat9</code></pre></div>

</div><h3 id="Multiple_Instances">多个实例</h3><div class="text">
<p>Tomcat支持安装多个实例。您可以一次安装Tomcat，同时在不同IP /端口组合上运行多个实例，或者在多个Tomcat版本中，每个版本在不同IP /端口上运行一个或多个实例。</p>
<p>每个实例文件夹将需要以下结构：</p>
<ul>
<li>conf</li>
<li>日志</li>
<li>温度</li>
<li>网络应用</li>
<li>工作</li>
</ul>
<p>conf至少应包含CATALINA_HOME \ conf \中以下文件的副本。默认情况下，将从CATALINA_HOME \ conf中拾取所有未复制和编辑的文件，即CATALINA_BASE \ conf文件将覆盖CATALINA_HOME \ conf中的默认文件。</p>
<ul>
<li>server.xml</li>
<li>web.xml</li>
</ul>
<p>您必须编辑CATALINA_BASE \ conf \ server.xml，以指定实例要侦听的唯一IP /端口。查找包含的行<code><Connector port="8080" ...</code>并添加地址属性和/或更新端口号，以指定唯一的IP /端口组合。</p>
<p>要安装实例，请首先将CATALINA_HOME环境变量设置为Tomcat安装目录的名称。然后创建第二个环境变量CATALINA_BASE并将其指向实例文件夹。然后运行“ service.bat install”命令，指定服务名称。</p>

<div class="codeBox"><pre><code>set CATALINA_HOME=c:\tomcat_9
set CATALINA_BASE=c:\tomcat_9\instances\instance1
service.bat install instance1</code></pre></div>

<p>要修改服务设置，可以运行<b>tomcat9w // ES // instance1</b> 。
</p>
<p>对于其他实例，请创建其他实例文件夹，更新CATALINA_BASE环境变量，然后再次运行“ service.bat install”。</p>

<div class="codeBox"><pre><code>set CATALINA_BASE=c:\tomcat_9\instances\instance2
service.bat install instance2</code></pre></div>

</div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="./comments.html">这里</a>解释<a href="./comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>