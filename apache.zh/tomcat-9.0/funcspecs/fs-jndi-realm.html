<html lang="zh-Hans" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="../images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Catalina功能规格（9.0.21）-JNDIRealm</title><meta name="author" content="Craig McClanahan"><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/funcspecs/fs-jndi-realm">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script></head><body ><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="../images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="../images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>卡塔利娜功能规格</h1><div class="versionInfo">版本9.0.21， <time datetime="2019-06-04"> 2019年6月4日</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>链接</h2><ul><li><a href="../index.html">文件首页</a></li><li><a href="index.html">功能规格</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">常问问题</a></li><li><a href="#comments_section">用户评论</a></li></ul></div><div><h2>行政应用</h2><ul><li><a href="fs-admin-apps.html">总体要求</a></li><li><a href="mbean-names.html">Tomcat MBean名称</a></li><li><a href="fs-admin-objects.html">管理对象</a></li><li><a href="fs-admin-opers.html">支持的运营</a></li></ul></div><div><h2>内部Servlet</h2><ul><li><a href="fs-default.html">默认Servlet</a></li></ul></div><div><h2>领域实现</h2><ul><li><a href="fs-jdbc-realm.html">JDBC领域</a></li><li><a href="fs-jndi-realm.html">JNDI领域</a></li><li><a href="fs-memory-realm.html">内存领域</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>JNDIRealm</h2><h3 id="Table_of_Contents">目录</h3><div class="text">
<ul><li><a href="#Overview">总览</a><ol><li><a href="#Introduction">介绍</a></li><li><a href="#External_Specifications">外部规格</a></li><li><a href="#Implementation_Requirements">实施要求</a></li></ol></li><li><a href="#Dependencies">依存关系</a><ol><li><a href="#Environmental_Dependencies">环境依赖性</a></li><li><a href="#Container_Dependencies">容器依赖</a></li></ol></li><li><a href="#Functionality">功能性</a><ol><li><a href="#Operational_Modes">操作模式</a></li><li><a href="#Administrator_Login_Mode_Functionality">管理员登录模式功能</a></li><li><a href="#Username_Login_Mode_Functionality">用户名登录模式功能</a></li></ol></li><li><a href="#Testable_Assertions">可测断言</a></li></ul>
</div><h3 id="Overview">总览</h3><div class="text">


  <div class="subsection"><h4 id="Introduction">介绍</h4><div class="text">

    <p><strong>JNDIRealm</strong>实现的目的是提供一种机制，Tomcat可以通过该机制从目录服务器或其他通过JNDI API访问的服务中获取对Web应用程序用户进行身份验证并定义其安全角色所需的信息。为了与Catalina集成，此类必须实现<code>org.apache.catalina.Realm</code>接口。</p>

    <p>本规范反映了已存在的功能的组合<code>org.apache.catalina.realm.JNDIRealm</code>类，以及已讨论的增强功能要求。在适当的地方，需求声明会标记为<em>[当前]</em>和<em>[已请求]</em>以区分它们。</p>

    <p>该功能规范的当前状态为“ <strong>建议”</strong> 。尚未在TOMCAT-DEV邮件列表上进行讨论和同意。</p>

    <p>当前版本中的代码<code>JNDIRealm</code>以及本功能规范中表达的思想是许多个人的贡献的结果，包括（按字母顺序）：</p>
    <ul>
    <li>约翰·霍尔曼<j.g.holman@qmw.ac.uk></j.g.holman@qmw.ac.uk></li>
    <li>埃伦·洛克哈特<elockhart@home.com></elockhart@home.com></li>
    <li>克雷格·麦克拉纳汉<craigmcc@apache.org></craigmcc@apache.org></li>
    </ul>

  </div></div>


  <div class="subsection"><h4 id="External_Specifications">外部规格</h4><div class="text">

    <p>此功能的实现取决于以下外部规范：</p>
    <ul>
    <li><a href="http://docs.oracle.com/javase/7/docs/technotes/guides/jndi/index.html">Java命名和目录接口</a> （1.2.1版或更高版本）</li>
    </ul>

  </div></div>


  <div class="subsection"><h4 id="Implementation_Requirements">实施要求</h4><div class="text">

    <p>此功能的实现应符合以下要求：</p>
    <ul>
    <li>在一个或多个实现类中实现。</li>
    <li>实施<code>org.apache.catalina.Realm</code>接口。[当前]</li>
    <li>实施<code>org.apache.catalina.Lifecycle</code>接口。[当前]</li>
    <li>子类化<code>org.apache.catalina.realm.RealmBase</code>基类。</li>
    <li>住在<code>org.apache.catalina.realm</code>包。[当前]</li>
    <li>支持可配置的调试详细信息级别。[当前]</li>
    <li>通过以下方式记录调试和操作消息（适当国际化） <code>getContainer().log()</code>方法。[当前]</li>
    </ul>

  </div></div>


</div><h3 id="Dependencies">依存关系</h3><div class="text">


  <div class="subsection"><h4 id="Environmental_Dependencies">环境依赖性</h4><div class="text">

    <p>为了使JNDIRealm正确运行，必须满足以下环境依赖性：</p>
    <ul>
    <li>使用JNDIRealm的愿望必须在<code>$CATALINA_BASE/conf/server.xml</code> ， 在一个<code><Realm></code>嵌套在相应元素内的元素<code><Engine></code> ， <code><Host></code> ， 要么<code><Context></code>元件。</li>
    <li>如果选择<em>管理员登录</em>操作模式，则必须在相应的目录服务器中配置所配置的管理员用户名和密码。</li>
    <li>如果选择“ <em>用户名登录”</em>操作模式，则必须将相应的目录服务器配置为接受使用将传递给用户名和密码的登录名<code>JNDIRealm</code>通过适当的<code>Authenticator</code> 。
        </li>
    </ul>

  </div></div>


  <div class="subsection"><h4 id="Container_Dependencies">容器依赖</h4><div class="text">

    <p>JNDIRealm的正确操作取决于周围容器的以下特定功能：</p>
    <ul>
    <li>与的互动<code>JNDIRealm</code>将由适当的发起<code>Authenticator</code>实现，基于所选的登录方法。</li>
    </ul>

  </div></div>


</div><h3 id="Functionality">功能性</h3><div class="text">


  <div class="subsection"><h4 id="Operational_Modes">操作模式</h4><div class="text">

    <p>已完成<code>JNDIRealm</code>为了支持所有必需的用例，必须支持两种主要的操作模式。为了本文档的目的，这些模式称为<em>管理员登录</em>和<em>用户名登录</em> 。在以下段落中将对它们进行进一步描述。</p>

    <p>对于<em>管理员登录</em>模式， <code>JNDIRealm</code>将配置为使用“系统管理员”用户名和密码，使用JNDI API建立与适当目录服务器的一个或多个连接（使用连接池）。这类似于通常用于配置的方法<code>JDBCRealm</code>访问数据库中的身份验证和访问控制信息。假定已配置的系统管理员用户名和密码在目录服务器中提供足够的特权，以读取（但不能修改）与此相关联的Web应用程序的每个有效用户的用户名，密码和分配的角色<code>Realm</code> 。密码可以以明文形式存储，也可以以密码支持的一种摘要模式存储。 <code>org.apache.catalina.realm.RealmBase</code>基类。</p>

    <p>对于<em>用户名登录</em>模式， <code>JNDIRealm</code>通常不会保持与目录服务器的连接。而是，每当要对用户进行身份验证时，都会尝试连接到目录服务器（使用从身份验证器收到的用户名和密码）。如果此连接成功，则假定用户已成功通过身份验证。然后利用此连接读取与此用户关联的相应安全角色，然后断开连接。</p>

    <p><strong>注意</strong> -如果选择了登录方式，则无法使用<em>用户名登录</em>方式<code>DIGEST</code>在您的Web应用程序部署描述符中（ <code>web.xml</code> ）文件。之所以存在此限制，是因为明文密码永远不会对容器可用，因此无法使用用户的用户名和密码绑定到目录服务器。</p>

    <p>由于这些操作模式的工作原理截然不同，因此将分别描述每种模式的功能。单个类是否实际支持这两种模式（相对于每个模式一个类），这是设计者的具体实现细节。</p>

    <p><strong>注</strong> –当前实现仅实现部分<em>管理员查找</em>模式要求。目前，它根本不支持<em>用户名查找</em>模式。</p>

  </div></div>


  <div class="subsection"><h4 id="Administrator_Login_Mode_Functionality">管理员登录模式功能</h4><div class="text">


    <h3>可配置的属性</h3>

    <p>该实现应支持可以使用JavaBeans属性设置器配置的以下属性：</p>
    <ul>
    <li><code>connectionURL</code> -我们将联系的目录服务器的URL。</li>
    <li><code>contextFactory</code> -用于检索我们的InitialContext的JNDI上下文工厂的全限定类名。[com.sun.jndi.ldap。LdapCtxFactory]</li>
    <li>建立适当的连接所需的其他配置属性。[要求]</li>
    <li>连接池配置属性。[要求]</li>
    <li>定义如何认证特定用户的配置属性。应该支持以下功能：<ul>
        <li>将指定的用户名替换为字符串。[要求]</li>
        <li>通过LDAP搜索字符串检索授权用户的专有名称（DN），该字符串带有用户名的替换占位符，并将密码与从搜索结果中检索到的可配置属性进行比较。[当前]</li>
        </ul></li>
    <li>配置属性，定义如何检索与特定身份验证的用户关联的角色。应该支持以下方法：<ul>
        <li>从LDAP搜索表达式中检索指定的属性（可能是多值），并使用用户DN的替换占位符。[当前]</li>
        <li>检索一组隐式定义的角色名称（通过选择与搜索模式匹配的主体），而不是显式定义的（通过查找特定的属性值）。[要求]</li>
        </ul></li>
    </ul>

    <h3>生命周期功能</h3>

    <p>当执行以下操作时，必须执行以下处理<code>start()</code>方法称为：</p>
    <ul>
    <li>使用配置的系统管理员用户名和密码建立与配置的目录服务器的连接。[当前]</li>
    <li>配置并建立到目录服务器的连接的连接池。[要求]</li>
    </ul>

    <p>当执行以下操作时，必须执行以下处理<code>stop()</code>方法称为：</p>
    <ul>
    <li>关闭到目录服务器的所有打开的连接。</li>
    </ul>


    <h3>方法authenticate（）功能</h3>

    <p>什么时候<code>authenticate()</code>被调用时，需要进行以下处理：</p>
    <ul>
    <li>获取一个唯一的连接[当前]或从连接池中获取一个连接[请求]。</li>
    <li>根据指定的用户名和密码，通过检索用户的专有名称来对用户进行身份验证。</li>
    <li>如果用户未通过身份验证，则释放分配的连接并返回<code>null</code> 。</li>
    <li>获取一个<code>List</code>分配给已验证用户的安全角色。</li>
    <li>构造一个新的类实例<code>org.apache.catalina.realm.GenericPrincipal</code> ，作为构造函数参数传递：该领域实例，经过身份验证的用户名和<code>List</code>与该用户相关联的安全角色。</li>
    <li><strong>警告</strong> -请勿尝试缓存和重用以前的版本<code>GenericPrincipal</code>对象是特定用户的对象，因为自上次对该用户进行身份验证以来，目录服务器中的信息可能已更改。</li>
    <li>退还新建的<code>GenericPrincipal</code> 。</li>
    </ul>


    <h3>方法hasRole（）功能</h3>

    <p>什么时候<code>hasRole()</code>被调用时，需要进行以下处理：</p>
    <ul>
    <li>的<code>principal</code>作为参数传递的参数应该是我们返回的参数（instanceof类<code>org.apache.catalina.realm.GenericPrincipal</code> ，带有<code>realm</code>属性等于我们的实例。</li>
    <li>如果通过了<code>principal</code>符合这些条件，请对照由返回的列表检查指定的角色<code>getRoles()</code> ，然后返回<code>true</code>如果包括指定的角色；否则，返回<code>false</code> 。</li>
    <li>如果通过了<code>principal</code>不符合这些条件，返回<code>false</code> 。</li>
    </ul>

  </div></div>


  <div class="subsection"><h4 id="Username_Login_Mode_Functionality">用户名登录模式功能</h4><div class="text">

    <h3>可配置的属性</h3>

    <p>该实现应支持可以使用JavaBeans属性设置器配置的以下属性：</p>
    <ul>
    <li><code>connectionURL</code> -我们将联系的目录服务器的URL。</li>
    <li><code>contextFactory</code> -用于检索我们的InitialContext的JNDI上下文工厂的全限定类名。[com.sun.jndi.ldap。LdapCtxFactory]</li>
    <li>建立适当的连接所需的其他配置属性。[要求]</li>
    <li>连接池配置属性。[要求]</li>
    <li>配置属性，用于定义在绑定到目录服务器之前是否以及如何查找用户。应该支持以下方法：<ul>
        <li>不需要以前的查找-用户指定的用户名与用于向目录服务器进行身份验证的用户名相同。</li>
        <li>将指定的用户名替换为字符串。</li>
        <li>根据配置的条件搜索目录服务器，以检索用户的专有名称，然后尝试使用该专有名称进行绑定。</li>
        </ul></li>
    <li>配置属性，定义如何检索与特定身份验证的用户关联的角色。应该支持以下方法：<ul>
        <li>从LDAP搜索表达式中检索指定的属性（可能是多值），并使用用户DN的替换占位符。[当前]</li>
        </ul></li>
    </ul>

    <h3>生命周期功能</h3>

    <p>当执行以下操作时，必须执行以下处理<code>start()</code>方法称为：</p>
    <ul>
    <li>不需要。</li>
    </ul>

    <p>当执行以下操作时，必须执行以下处理<code>stop()</code>方法称为：</p>
    <ul>
    <li>不需要。</li>
    </ul>


    <h3>方法authenticate（）功能</h3>

    <p>什么时候<code>authenticate()</code>被调用时，需要进行以下处理：</p>
    <ul>
    <li>尝试使用用户提供的用户名和密码绑定到目录服务器。</li>
    <li>如果用户未通过身份验证，则释放分配的连接并返回<code>null</code> 。</li>
    <li>获取一个<code>List</code>分配给已验证用户的安全角色。</li>
    <li>构造一个新的类实例<code>org.apache.catalina.realm.GenericPrincipal</code> ，作为构造函数参数传递：该领域实例，经过身份验证的用户名和<code>List</code>与该用户相关联的安全角色。</li>
    <li><strong>警告</strong> -请勿尝试缓存和重用以前的版本<code>GenericPrincipal</code>对象是特定用户的对象，因为自上次对该用户进行身份验证以来，目录服务器中的信息可能已更改。</li>
    <li>退还新建的<code>GenericPrincipal</code> 。</li>
    </ul>


    <h3>方法hasRole（）功能</h3>

    <p>什么时候<code>hasRole()</code>被调用时，需要进行以下处理：</p>
    <ul>
    <li>的<code>principal</code>作为参数传递的参数应该是我们返回的参数（instanceof类<code>org.apache.catalina.realm.GenericPrincipal</code> ，带有<code>realm</code>属性等于我们的实例。</li>
    <li>如果通过了<code>principal</code>符合这些条件，请对照由返回的列表检查指定的角色<code>getRoles()</code> ，然后返回<code>true</code>如果包括指定的角色；否则，返回<code>false</code> 。</li>
    <li>如果通过了<code>principal</code>不符合这些条件，返回<code>false</code> 。</li>
    </ul>

  </div></div>

</div><h3 id="Testable_Assertions">可测断言</h3><div class="text">

  <p>除了上面列出的功能要求所暗含的断言之外，还应对以下其他断言进行测试，以验证<code>JNDIRealm</code> ：</p>
  <ul>
  </ul>

</div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="../comments.html">这里</a>解释<a href="../comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>