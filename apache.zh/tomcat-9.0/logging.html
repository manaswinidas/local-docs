<html lang="zh-Hans" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="./images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9（9.0.21）-登录Tomcat</title><meta name="author" content="Allistair Crossley"><meta name="author" content="Yoav Shapira"><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/logging">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script></head><body ><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="./images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="./images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>Apache Tomcat 9</h1><div class="versionInfo">版本9.0.21， <time datetime="2019-06-04"> 2019年6月4日</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>链接</h2><ul><li><a href="index.html">文件首页</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">常问问题</a></li><li><a href="#comments_section">用户评论</a></li></ul></div><div><h2>用户指南</h2><ul><li><a href="introduction.html">1）简介</a></li><li><a href="setup.html">2）设定</a></li><li><a href="appdev/index.html">3）第一个webapp</a></li><li><a href="deployer-howto.html">4）部署者</a></li><li><a href="manager-howto.html">5）经理</a></li><li><a href="host-manager-howto.html">6）主机管理员</a></li><li><a href="realm-howto.html">7）领域和AAA</a></li><li><a href="security-manager-howto.html">8）安全经理</a></li><li><a href="jndi-resources-howto.html">9）JNDI资源</a></li><li><a href="jndi-datasource-examples-howto.html">10）JDBC数据源</a></li><li><a href="class-loader-howto.html">11）类加载</a></li><li><a href="jasper-howto.html">12）JSP</a></li><li><a href="ssl-howto.html">13）SSL / TLS</a></li><li><a href="ssi-howto.html">14）SSI</a></li><li><a href="cgi-howto.html">15）CGI</a></li><li><a href="proxy-howto.html">16）代理支持</a></li><li><a href="mbeans-descriptors-howto.html">17）MBean描述符</a></li><li><a href="default-servlet.html">18）默认Servlet</a></li><li><a href="cluster-howto.html">19）聚类</a></li><li><a href="balancer-howto.html">20）负载均衡器</a></li><li><a href="connectors.html">21）连接器</a></li><li><a href="monitoring.html">22）监控与管理</a></li><li><a href="logging.html">23）记录</a></li><li><a href="apr.html">24）APR /本地</a></li><li><a href="virtual-hosting-howto.html">25）虚拟主机</a></li><li><a href="aio.html">26）高级IO</a></li><li><a href="extras.html">27）附加组件</a></li><li><a href="maven-jars.html">28）行刑</a></li><li><a href="security-howto.html">29）安全注意事项</a></li><li><a href="windows-service-howto.html">30）Windows服务</a></li><li><a href="windows-auth-howto.html">31）Windows身份验证</a></li><li><a href="jdbc-pool.html">32）Tomcat的JDBC池</a></li><li><a href="web-socket-howto.html">33）WebSocket</a></li><li><a href="rewrite.html">34）改写</a></li></ul></div><div><h2>参考</h2><ul><li><a href="RELEASE-NOTES.txt">发行说明</a></li><li><a href="config/index.html">组态</a></li><li><a href="api/index.html">Tomcat Java文档</a></li><li><a href="servletapi/index.html">Servlet Java文档</a></li><li><a href="jspapi/index.html">JSP 2.3 Java文档</a></li><li><a href="elapi/index.html">EL 3.0 Java文档</a></li><li><a href="websocketapi/index.html">WebSocket 1.1 Java文档</a></li><li><a href="https://tomcat.apache.org/connectors-doc/">JK 1.2文档</a></li></ul></div><div><h2>Apache Tomcat开发</h2><ul><li><a href="building.html">建造</a></li><li><a href="changelog.html">变更日志</a></li><li><a href="https://wiki.apache.org/tomcat/TomcatVersions">状态</a></li><li><a href="developers.html">开发者</a></li><li><a href="architecture/index.html">建筑</a></li><li><a href="funcspecs/index.html">功能规格。</a></li><li><a href="tribes/introduction.html">部族</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>登录Tomcat</h2><h3 id="Table_of_Contents">目录</h3><div class="text">
<ul><li><a href="#Introduction">介绍</a><ol><li><a href="#Java_logging_API_%E2%80%94_java.util.logging">Java日志记录API — java.util.logging</a></li><li><a href="#Servlets_logging_API">Servlet日志记录API</a></li><li><a href="#Console">安慰</a></li><li><a href="#Access_logging">访问日志</a></li></ol></li><li><a href="#Using_java.util.logging_(default)">使用java.util.logging（默认）</a><ol><li><a href="#Documentation_references">文档参考</a></li><li><a href="#Considerations_for_production_usage">生产使用注意事项</a></li></ol></li></ul>
</div><h3 id="Introduction">介绍</h3><div class="text">
    <p>Apache Tomcat的内部日志记录使用JULI，JULI是<a href="https://commons.apache.org/logging">Apache Commons Logging</a>的打包重命名的分叉，经过硬编码后可以使用<code>java.util.logging</code>框架。这样可以确保Tomcat的内部日志记录和任何Web应用程序日志都将保持独立，即使Web应用程序使用Apache Commons Logging。
    </p>

    <p>要将Tomcat配置为使用替代日志记录框架进行内部日志记录，请遵循替代日志记录框架提供的指示信息，以重定向使用以下命令的应用程序的日志记录<code>java.util.logging</code> 。请记住，替代的日志记录框架将需要能够在不同类加载器中可能存在具有相同名称的不同记录器的环境中工作。
    </p>

    <p>在Apache Tomcat上运行的Web应用程序可以：</p>
    <ul>
      <li>使用其选择的任何日志记录框架。
      </li>
      <li>使用系统日志记录API， <code>java.util.logging</code> 。
      </li>
      <li>使用Java Servlets规范提供的日志记录API， <code>javax.servlet.ServletContext.log(...)</code>
      </li>
    </ul>

    <p>不同的Web应用程序使用的日志记录框架是独立的。有关更多详细信息，请参见<a href="class-loader-howto.html">类加载</a> 。该规则的例外是<code>java.util.logging</code> 。如果它由日志库直接或间接使用，则它的元素将在Web应用程序之间共享，因为它是由系统类加载器加载的。
    </p>

    <div class="subsection"><h4 id="Java_logging_API_—_java.util.logging">Java日志记录API — java.util.logging</h4><div class="text">

    <p>Apache Tomcat具有自己的以下几个关键要素的实现<code>java.util.logging</code> API。此实现称为JULI。关键组件有一个自定义的LogManager实现，该实现了解Tomcat上运行的不同Web应用程序（及其不同的类加载器）。它支持每个应用程序的专用日志记录配置。当从内存中卸载Web应用程序时，Tomcat也会通知它，以便可以清除对其类的引用，从而防止内存泄漏。
    </p>

    <p>这个<code>java.util.logging</code>通过在启动Java时提供某些系统属性来启用实现。Apache Tomcat启动脚本会为您执行此操作，但是如果您使用其他工具运行Tomcat（例如jsvc或从IDE内部运行Tomcat），则应该自己照顾它们。
    </p>

    <p>有关java.util.logging的更多详细信息，可以在您的JDK文档及其Javadoc页面上找到。 <code>java.util.logging</code>包。
    </p>

    <p>可以在下面找到有关Tomcat JULI的更多详细信息。
    </p>

    </div></div>

    <div class="subsection"><h4 id="Servlets_logging_API">Servlet日志记录API</h4><div class="text">

    <p>致电<code>javax.servlet.ServletContext.log(...)</code>写入日志消息由内部Tomcat日志处理。这样的消息被记录到名为</p>
      <div class="codeBox"><pre><code>org.apache.catalina.core.ContainerBase.[${engine}].[${host}].[${context}]</code></pre></div>
    <p>该日志记录是根据Tomcat日志记录配置执行的。您不能在Web应用程序中覆盖它。
    </p>

    <p>Servlets记录API早于<code>java.util.logging</code> Java现在提供的API。因此，它没有为您提供太多选择。例如，您无法控制日志级别。但是，应该指出的是，在Apache Tomcat实现中，对<code>ServletContext.log(String)</code>要么<code>GenericServlet.log(String)</code>以INFO级别记录。致电<code>ServletContext.log(String, Throwable)</code>要么<code>GenericServlet.log(String, Throwable)</code>以严重级别记录。
    </p>

    </div></div>

    <div class="subsection"><h4 id="Console">安慰</h4><div class="text">

    <p>在Unix上运行Tomcat时，通常将控制台输出重定向到名为<code>catalina.out</code> 。该名称可使用环境变量进行配置。（请参阅启动脚本）。无论写什么<code>System.err/out</code>将被捕获到该文件中。其中可能包括：</p>

    <ul>
      <li>未被记录的异常<code>java.lang.ThreadGroup.uncaughtException(..)</code></li>
      <li>线程转储（如果通过系统信号请求它们）</li>
    </ul>

    <p>在Windows上作为服务运行时，也会捕获并重定向控制台输出，但是文件名不同。
    </p>

    <p>Apache Tomcat中的默认日志记录配置会将相同的消息写入控制台和日志文件。使用Tomcat进行开发时，这很好，但在生产中通常不需要。
    </p>

    <p>仍在使用的旧应用程序<code>System.out</code>要么<code>System.err</code>可以通过设置来欺骗<code>swallowOutput</code> <a href="config/context.html">Context</a>上的属性。如果该属性设置为<code>true</code> ，致电<code>System.out/err</code>在请求处理期间，它将被拦截，并且它们的输出将使用<code>javax.servlet.ServletContext.log(...)</code>电话。<br>
      <strong>请注意</strong> ， <code>swallowOutput</code>功能实际上是一个技巧，它有其局限性。它仅适用于直接调用<code>System.out/err</code> ，并且仅在请求处理周期内。它可能无法在应用程序可能创建的其他线程中工作。它不能用来拦截本身写入系统流的日志记录框架，因为它们早就开始并且可以在重定向发生之前获得对流的直接引用。
    </p>

    </div></div>

    <div class="subsection"><h4 id="Access_logging">访问日志</h4><div class="text">

    <p>访问日志记录是一个相关但不同的功能，它被实现为<code>Valve</code> 。它使用独立的逻辑来写入其日志文件。访问日志记录的基本要求是以低开销处理大量连续的数据流，因此它仅对自己的调试消息使用Apache Commons Logging。这种实施方法避免了额外的开销和潜在的复杂配置。请参阅<a href="config/valve.html#Access_Logging">阀门</a>文档以获取有关其配置的更多详细信息，包括各种报告格式。
    </p>

    </div></div>

  </div><h3 id="Using_java.util.logging_(default)">使用java.util.logging（默认）</h3><div class="text">

  <p>JDK中提供的java.util.logging的默认实现太受限制而无法使用。关键限制是无法进行每个Web应用程序日志记录，因为该配置是基于每个VM的。结果，Tomcat将以默认配置用名为JULI的容器友好实现替换默认LogManager实现，从而解决了这些缺点。
  </p>
  <p>JULI支持与标准JDK相同的配置机制<code>java.util.logging</code> ，使用编程方法或属性文件。主要区别在于可以设置每个类加载器的属性文件（这使得可以轻松地重新部署友好的Webapp配置），并且属性文件支持扩展的结构，从而为定义处理程序并将其分配给记录程序提供了更大的自由。
  </p>
  <p>JULI默认情况下处于启用状态，并且除了常规的全局java.util.logging配置之外，还支持每个类加载器配置。这意味着可以在以下几层上配置日志记录：</p>
    <ul>
      <li>在全球范围内。通常是在<code>${catalina.base}/conf/logging.properties</code>文件。该文件由<code>java.util.logging.config.file</code>由启动脚本设置的系统属性。如果它不可读或未配置，则默认为使用<code>${java.home}/lib/logging.properties</code>文件放在JRE中。</li>
      <li>在Web应用程序中。该文件将是<code>WEB-INF/classes/logging.properties</code>
      </li>
    </ul>
  <p>默认值<code>logging.properties</code>在JRE中指定一个<code>ConsoleHandler</code>将日志记录路由到System.err。默认值<code>conf/logging.properties</code>在Apache Tomcat中还添加了几个<code>AsyncFileHandler</code>写入文件的。
  </p>
  <p>处理程序的日志级别阈值为<code>INFO</code>默认情况下，可以使用<code>SEVERE</code> ， <code>WARNING</code> ， <code>INFO</code> ， <code>CONFIG</code> ， <code>FINE</code> ， <code>FINER</code> ， <code>FINEST</code>要么<code>ALL</code> 。您还可以定位特定的软件包以从中收集日志并指定级别。
  </p>
  <p>要为Tomcat内部的一部分启用调试日志记录，您应该同时配置适当的记录器和适当的处理程序，以使用<code>FINEST</code>要么<code>ALL</code>水平。例如：</p>
  <div class="codeBox"><pre><code>org.apache.catalina.session.level=ALL
java.util.logging.ConsoleHandler.level=ALL</code></pre></div>
  <p>启用调试日志记录时，建议在尽可能小的范围内启用它，因为调试日志记录会生成大量信息。
  </p>
  <p>JULI使用的配置与plain支持的配置相同<code>java.util.logging</code> ，但使用一些扩展名可以在配置记录器和处理程序时提供更大的灵活性。主要区别在于：</p>
  <ul>
      <li>可以在处理程序名称中添加前缀，以便可以实例化单个类的多个处理程序。前缀是一个字符串，以数字开头，以'结尾。'。例如， <code>22foobar.</code>是有效的前缀。</li>
      <li>对包含以下内容的属性值执行系统属性替换<code>${systemPropertyName}</code> 。</li>
      <li>如果使用的类加载器实现了<code>org.apache.juli.WebappProperties</code>接口（Tomcat的Web应用程序类加载器执行），然后还针对<code>${classloader.webappName}</code> ， <code>${classloader.hostName}</code>和<code>${classloader.serviceName}</code>分别用Web应用程序名称，主机名和服务名替换。
      </li>
      <li>默认情况下，如果记录器具有关联的处理程序，则它们不会委派给其父级。每个记录器都可以使用<code>loggerName.useParentHandlers</code>属性，该属性接受布尔值。</li>
      <li>根记录器可以使用以下命令定义其处理程序集<code>.handlers</code>属性。</li>
      <li>默认情况下，日志文件将保留在文件系统上<code>90</code>天。每个处理程序都可以使用<code>handlerName.maxDays</code>属性。如果该属性的指定值为<code>≤0</code>则日志文件将永远保存在文件系统上，否则将保留指定的最长天数。</li>
  </ul>
  <p>还有几个其他的实现类，可以与Java提供的实现类一起使用。值得注意的是<code>org.apache.juli.FileHandler</code>和<code>org.apache.juli.AsyncFileHandler</code> 。
  </p>
  <p>
    <code>org.apache.juli.FileHandler</code>支持日志的缓冲。默认情况下不启用缓冲。要配置它，请使用<code>bufferSize</code>处理程序的属性。的价值<code>0</code>使用系统默认缓冲（通常将使用8K缓冲）。值<code><0</code>在每次写入日志时强制写入器刷新。一个值<code>>0</code>使用具有已定义值的BufferedOutputStream，但请注意，还将应用系统默认缓冲。
  </p>
  <p>
    <code>org.apache.juli.AsyncFileHandler</code>是的子类<code>FileHandler</code>将日志消息排队并将它们异步写入日志文件。可以通过设置一些<a href="config/systemprops.html#Logging">系统属性</a>来配置它的其他行为。
  </p>
  <p>放置在$ CATALINA_BASE / conf中的示例logging.properties文件：</p>
  <div class="codeBox"><pre><code>handlers = 1catalina.org.apache.juli.FileHandler, \
           2localhost.org.apache.juli.FileHandler, \
           3manager.org.apache.juli.FileHandler, \
           java.util.logging.ConsoleHandler

.handlers = 1catalina.org.apache.juli.FileHandler, java.util.logging.ConsoleHandler

############################################################
# Handler specific properties.
# Describes specific configuration info for Handlers.
############################################################

1catalina.org.apache.juli.FileHandler.level = FINE
1catalina.org.apache.juli.FileHandler.directory = ${catalina.base}/logs
1catalina.org.apache.juli.FileHandler.prefix = catalina.
1catalina.org.apache.juli.FileHandler.maxDays = 90
1catalina.org.apache.juli.FileHandler.encoding = UTF-8

2localhost.org.apache.juli.FileHandler.level = FINE
2localhost.org.apache.juli.FileHandler.directory = ${catalina.base}/logs
2localhost.org.apache.juli.FileHandler.prefix = localhost.
2localhost.org.apache.juli.FileHandler.maxDays = 90
2localhost.org.apache.juli.FileHandler.encoding = UTF-8

3manager.org.apache.juli.FileHandler.level = FINE
3manager.org.apache.juli.FileHandler.directory = ${catalina.base}/logs
3manager.org.apache.juli.FileHandler.prefix = manager.
3manager.org.apache.juli.FileHandler.bufferSize = 16384
3manager.org.apache.juli.FileHandler.maxDays = 90
3manager.org.apache.juli.FileHandler.encoding = UTF-8

java.util.logging.ConsoleHandler.level = FINE
java.util.logging.ConsoleHandler.formatter = java.util.logging.OneLineFormatter
java.util.logging.ConsoleHandler.encoding = UTF-8

############################################################
# Facility specific properties.
# Provides extra control for each logger.
############################################################

org.apache.catalina.core.ContainerBase.[Catalina].[localhost].level = INFO
org.apache.catalina.core.ContainerBase.[Catalina].[localhost].handlers = \
   2localhost.org.apache.juli.FileHandler

org.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/manager].level = INFO
org.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/manager].handlers = \
   3manager.org.apache.juli.FileHandler

# For example, set the org.apache.catalina.util.LifecycleBase logger to log
# each component that extends LifecycleBase changing state:
#org.apache.catalina.util.LifecycleBase.level = FINE</code></pre></div>

    <p>servlet-examples Web应用程序的示例logging.properties将放置在Web应用程序内的WEB-INF / classs中：</p>
    <div class="codeBox"><pre><code>handlers = org.apache.juli.FileHandler, java.util.logging.ConsoleHandler

############################################################
# Handler specific properties.
# Describes specific configuration info for Handlers.
############################################################

org.apache.juli.FileHandler.level = FINE
org.apache.juli.FileHandler.directory = ${catalina.base}/logs
org.apache.juli.FileHandler.prefix = ${classloader.webappName}.

java.util.logging.ConsoleHandler.level = FINE
java.util.logging.ConsoleHandler.formatter = java.util.logging.OneLineFormatter</code></pre></div>


    <div class="subsection"><h4 id="Documentation_references">文档参考</h4><div class="text">
      <p>有关其他信息，请参见以下资源：</p>
      <ul>
        <li>适用于的Apache Tomcat Javadoc <a href="api/org/apache/juli/package-summary.html"><code>org.apache.juli</code></a>包。
        </li>
        <li>适用于Oracle Java 6 Javadoc的<a href="http://docs.oracle.com/javase/6/docs/api/java/util/logging/package-summary.html"><code>java.util.logging</code></a>包。
        </li>
      </ul>
    </div></div>

    <div class="subsection"><h4 id="Considerations_for_production_usage">生产使用注意事项</h4><div class="text">
      <p>您可能需要注意以下几点：</p>
      <ul>
        <li>考虑删除<code>ConsoleHandler</code>从配置。默认情况下（由于<code>.handlers</code>设置）日志都转到<code>FileHandler</code>和一个<code>ConsoleHandler</code> 。后者的输出通常捕获到文件中，例如<code>catalina.out</code> 。因此，您最终得到相同消息的两个副本。</li>
        <li>考虑删除<code>FileHandler</code>适用于您不使用的应用程序。例如，一个<code>host-manager</code> 。</li>
        <li>默认情况下，处理程序使用系统默认编码来写入日志文件。可以配置<code>encoding</code>属性。有关详细信息，请参见Javadoc。</li>
        <li>考虑配置<a href="config/valve.html#Access_Logging">访问日志</a> 。</li>
      </ul>
    </div></div>

  </div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="./comments.html">这里</a>解释<a href="./comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>