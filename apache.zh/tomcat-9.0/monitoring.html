<html lang="zh-Hans" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="./images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9（9.0.21）-监视和管理Tomcat</title><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/monitoring">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script></head><body ><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="./images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="./images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>Apache Tomcat 9</h1><div class="versionInfo">版本9.0.21， <time datetime="2019-06-04"> 2019年6月4日</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>链接</h2><ul><li><a href="index.html">文件首页</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">常问问题</a></li><li><a href="#comments_section">用户评论</a></li></ul></div><div><h2>用户指南</h2><ul><li><a href="introduction.html">1）简介</a></li><li><a href="setup.html">2）设定</a></li><li><a href="appdev/index.html">3）第一个webapp</a></li><li><a href="deployer-howto.html">4）部署者</a></li><li><a href="manager-howto.html">5）经理</a></li><li><a href="host-manager-howto.html">6）主机管理员</a></li><li><a href="realm-howto.html">7）领域和AAA</a></li><li><a href="security-manager-howto.html">8）安全经理</a></li><li><a href="jndi-resources-howto.html">9）JNDI资源</a></li><li><a href="jndi-datasource-examples-howto.html">10）JDBC数据源</a></li><li><a href="class-loader-howto.html">11）类加载</a></li><li><a href="jasper-howto.html">12）JSP</a></li><li><a href="ssl-howto.html">13）SSL / TLS</a></li><li><a href="ssi-howto.html">14）SSI</a></li><li><a href="cgi-howto.html">15）CGI</a></li><li><a href="proxy-howto.html">16）代理支持</a></li><li><a href="mbeans-descriptors-howto.html">17）MBean描述符</a></li><li><a href="default-servlet.html">18）默认Servlet</a></li><li><a href="cluster-howto.html">19）聚类</a></li><li><a href="balancer-howto.html">20）负载均衡器</a></li><li><a href="connectors.html">21）连接器</a></li><li><a href="monitoring.html">22）监控与管理</a></li><li><a href="logging.html">23）记录</a></li><li><a href="apr.html">24）APR /本地</a></li><li><a href="virtual-hosting-howto.html">25）虚拟主机</a></li><li><a href="aio.html">26）高级IO</a></li><li><a href="extras.html">27）附加组件</a></li><li><a href="maven-jars.html">28）行刑</a></li><li><a href="security-howto.html">29）安全注意事项</a></li><li><a href="windows-service-howto.html">30）Windows服务</a></li><li><a href="windows-auth-howto.html">31）Windows身份验证</a></li><li><a href="jdbc-pool.html">32）Tomcat的JDBC池</a></li><li><a href="web-socket-howto.html">33）WebSocket</a></li><li><a href="rewrite.html">34）改写</a></li></ul></div><div><h2>参考</h2><ul><li><a href="RELEASE-NOTES.txt">发行说明</a></li><li><a href="config/index.html">组态</a></li><li><a href="api/index.html">Tomcat Java文档</a></li><li><a href="servletapi/index.html">Servlet Java文档</a></li><li><a href="jspapi/index.html">JSP 2.3 Java文档</a></li><li><a href="elapi/index.html">EL 3.0 Java文档</a></li><li><a href="websocketapi/index.html">WebSocket 1.1 Java文档</a></li><li><a href="https://tomcat.apache.org/connectors-doc/">JK 1.2文档</a></li></ul></div><div><h2>Apache Tomcat开发</h2><ul><li><a href="building.html">建造</a></li><li><a href="changelog.html">变更日志</a></li><li><a href="https://wiki.apache.org/tomcat/TomcatVersions">状态</a></li><li><a href="developers.html">开发者</a></li><li><a href="architecture/index.html">建筑</a></li><li><a href="funcspecs/index.html">功能规格。</a></li><li><a href="tribes/introduction.html">部族</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>监视和管理Tomcat</h2><h3 id="Table_of_Contents">目录</h3><div class="text">
<ul><li><a href="#Introduction">介绍</a></li><li><a href="#Enabling_JMX_Remote">启用JMX远程</a></li><li><a href="#Manage_Tomcat_with_JMX_remote_Ant_Tasks">使用JMX远程Ant任务管理Tomcat</a></li><li><a href="#JMXAccessorOpenTask_-_JMX_open_connection_task">JMXAccessorOpenTask-JMX打开连接任务</a></li><li><a href="#JMXAccessorGetTask:__get_attribute_value_Ant_task">JMXAccessorGetTask：获取属性值Ant任务</a></li><li><a href="#JMXAccessorSetTask:__set_attribute_value_Ant_task">JMXAccessorSetTask：设置属性值Ant任务</a></li><li><a href="#JMXAccessorInvokeTask:__invoke_MBean_operation_Ant_task">JMXAccessorInvokeTask：调用MBean操作Ant任务</a></li><li><a href="#JMXAccessorQueryTask:__query_MBean_Ant_task">JMXAccessorQueryTask：查询MBean Ant任务</a></li><li><a href="#JMXAccessorCreateTask:__remote_create_MBean_Ant_task">JMXAccessorCreateTask：远程创建MBean Ant任务</a></li><li><a href="#JMXAccessorUnregisterTask:__remote_unregister_MBean_Ant_task">JMXAccessorUnregisterTask：远程注销MBean Ant任务</a></li><li><a href="#JMXAccessorCondition:__express_condition">JMXAccessorCondition：表达条件</a></li><li><a href="#JMXAccessorEqualsCondition:__equals_MBean_Ant_condition">JMXAccessorEqualsCondition：等于MBean Ant条件</a></li><li><a href="#Using_the_JMXProxyServlet">使用JMXProxyServlet</a></li></ul>
</div><h3 id="Introduction">介绍</h3><div class="text">

  <p>监视是系统管理的关键方面。查看正在运行的服务器内部，获取一些统计信息或重新配置应用程序的某些方面，这都是日常管理任务。</p>

  </div><h3 id="Enabling_JMX_Remote">启用JMX远程</h3><div class="text">

    <p><strong>注意：</strong>仅当您要远程监视Tomcat时才需要此配置。如果要使用与Tomcat一起运行的同一用户在本地对其进行监视，则不需要它。</p>

    <p>Oracle网站包含选项列表以及如何在Java 6上配置JMX Remote： <a href="http://docs.oracle.com/javase/6/docs/technotes/guides/management/agent.html">http</a> : <a href="http://docs.oracle.com/javase/6/docs/technotes/guides/management/agent.html">//docs.oracle.com/javase/6/docs/technotes/guides/management/agent.html</a> 。</p>
    <p>以下是Java 6的快速配置指南：</p>
    <p>将以下参数添加到<code>setenv.bat</code> Tomcat脚本（有关详细信息，请参阅<a href="RUNNING.txt">RUNNING.txt</a> ）。<br>
    <em>注意：</em>此语法适用于Microsoft Windows。该命令必须在同一行上。它被包装为更具可读性。如果Tomcat作为Windows服务运行，请使用其配置对话框为该服务设置java选项。对于un * xes删除<code>"set "</code>从行的开头。
    </p>
<div class="codeBox"><pre><code>set CATALINA_OPTS=-Dcom.sun.management.jmxremote
  -Dcom.sun.management.jmxremote.port=%my.jmx.port%
  -Dcom.sun.management.jmxremote.ssl=false
  -Dcom.sun.management.jmxremote.authenticate=false</code></pre></div>

    <ol>
    <li>如果您需要授权，请添加并更改此内容：<div class="codeBox"><pre><code>  -Dcom.sun.management.jmxremote.authenticate=true
  -Dcom.sun.management.jmxremote.password.file=../conf/jmxremote.password
  -Dcom.sun.management.jmxremote.access.file=../conf/jmxremote.access</code></pre></div>
    </li>
    <li>编辑访问授权文件<em>$ CATALINA_BASE / conf / jmxremote.access</em> ：<div class="codeBox"><pre><code>monitorRole readonly
controlRole readwrite</code></pre></div>
    </li>
    <li>编辑密码文件<em>$ CATALINA_BASE / conf / jmxremote.password</em> ：<div class="codeBox"><pre><code>monitorRole tomcat
controlRole tomcat</code></pre></div>
    <b>提示</b> ：密码文件应该是只读的，并且只能由运行Tomcat的操作系统用户访问。
    </li>
    </ol>
    <p><strong>注意：</strong> JSR 160 JMX适配器会在随机端口上打开第二个数据通道。当您安装了本地防火墙时，这就是一个问题。要解决此问题，请配置一个<code>JmxRemoteLifecycleListener</code> ，如<a href="config/listeners.html">侦听器</a>文档中所述。
    </p>

  </div><h3 id="Manage_Tomcat_with_JMX_remote_Ant_Tasks">使用JMX远程Ant任务管理Tomcat</h3><div class="text">
   <p>为了简化Ant 1.6.x的JMX使用，提供了一组可与antlib一起使用的任务。</p>
   <p><b>antlib</b> ：将您的catalina-ant.jar从$ CATALINA_HOME / lib复制到$ ANT_HOME / lib。</p>
   <p>以下示例显示了JMX访问器的用法：<br>
   <em>注意：</em> <code>name</code>将属性值包装在此处以提高可读性。它必须全部在同一行上，没有空格。</p>
   <div class="codeBox"><pre><code>&lt;project name="Catalina Ant JMX"
      xmlns:jmx="antlib:org.apache.catalina.ant.jmx"
      default="state"
      basedir="."&gt;
  &lt;property name="jmx.server.name" value="localhost" /&gt;
  &lt;property name="jmx.server.port" value="9012" /&gt;
  &lt;property name="cluster.server.address" value="192.168.1.75" /&gt;
  &lt;property name="cluster.server.port" value="9025" /&gt;

  &lt;target name="state" description="Show JMX Cluster state"&gt;
    &lt;jmx:open
      host="${jmx.server.name}"
      port="${jmx.server.port}"
      username="controlRole"
      password="tomcat"/&gt;
    &lt;jmx:get
      name=
"Catalina:type=IDataSender,host=localhost,
senderAddress=${cluster.server.address},senderPort=${cluster.server.port}"
      attribute="connected"
      resultproperty="IDataSender.backup.connected"
      echo="false"
    /&gt;
    &lt;jmx:get
      name="Catalina:type=ClusterSender,host=localhost"
      attribute="senderObjectNames"
      resultproperty="senderObjectNames"
      echo="false"
    /&gt;
    &lt;!-- get current maxActiveSession from ClusterTest application
       echo it to Ant output and store at
       property &lt;em&gt;clustertest.maxActiveSessions.orginal&lt;/em&gt;
    --&gt;
    &lt;jmx:get
      name="Catalina:type=Manager,context=/ClusterTest,host=localhost"
      attribute="maxActiveSessions"
      resultproperty="clustertest.maxActiveSessions.orginal"
      echo="true"
    /&gt;
    &lt;!-- set maxActiveSession to 100
    --&gt;
    &lt;jmx:set
      name="Catalina:type=Manager,context=/ClusterTest,host=localhost"
      attribute="maxActiveSessions"
      value="100"
      type="int"
    /&gt;
    &lt;!-- get all sessions and split result as delimiter &lt;em&gt;SPACE&lt;/em&gt; for easy
       access all session ids directly with Ant property sessions.[0..n].
    --&gt;
    &lt;jmx:invoke
      name="Catalina:type=Manager,context=/ClusterTest,host=localhost"
      operation="listSessionIds"
      resultproperty="sessions"
      echo="false"
      delimiter=" "
    /&gt;
    &lt;!-- Access session attribute &lt;em&gt;Hello&lt;/em&gt; from first session.
    --&gt;
    &lt;jmx:invoke
      name="Catalina:type=Manager,context=/ClusterTest,host=localhost"
      operation="getSessionAttribute"
      resultproperty="Hello"
      echo="false"
    &gt;
      &lt;arg value="${sessions.0}"/&gt;
      &lt;arg value="Hello"/&gt;
    &lt;/jmx:invoke&gt;
    &lt;!-- Query for all application manager.of the server from all hosts
       and bind all attributes from all found manager MBeans.
    --&gt;
    &lt;jmx:query
      name="Catalina:type=Manager,*"
      resultproperty="manager"
      echo="true"
      attributebinding="true"
    /&gt;
    &lt;!-- echo the create properties --&gt;
&lt;echo&gt;
senderObjectNames: ${senderObjectNames.0}
IDataSender.backup.connected: ${IDataSender.backup.connected}
session: ${sessions.0}
manager.length: ${manager.length}
manager.0.name: ${manager.0.name}
manager.1.name: ${manager.1.name}
hello: ${Hello}
manager.ClusterTest.0.name: ${manager.ClusterTest.0.name}
manager.ClusterTest.0.activeSessions: ${manager.ClusterTest.0.activeSessions}
manager.ClusterTest.0.counterSend_EVT_SESSION_EXPIRED:
 ${manager.ClusterTest.0.counterSend_EVT_SESSION_EXPIRED}
manager.ClusterTest.0.counterSend_EVT_GET_ALL_SESSIONS:
 ${manager.ClusterTest.0.counterSend_EVT_GET_ALL_SESSIONS}
&lt;/echo&gt;

  &lt;/target&gt;

&lt;/project&gt;</code></pre></div>
   <p><b>import：使用以下命令</b>导入JMX Accessor项目<em><import file="${CATALINA.HOME}/bin/catalina-tasks.xml"></import></em>并使用<em>jmxOpen</em> ， <em>jmxSet</em> ， <em>jmxGet</em> ， <em>jmxQuery</em> ， <em>jmxInvoke</em> ， <em>jmxEquals</em>和<em>jmxCondition</em>引用任务。</p>

  </div><h3 id="JMXAccessorOpenTask_-_JMX_open_connection_task">JMXAccessorOpenTask-JMX打开连接任务</h3><div class="text">
<p>属性清单</p>
<table class="defaultTable">

  <tbody><tr>
    <th>属性</th>
    <th>描述</th>
    <th>默认值</th>
  </tr>

  <tr>
    <td>网址</td>
    <td>设置JMX连接URL- <em>service：jmx：rmi：/// jndi / rmi：// localhost：8050 / jmxrmi</em>
    </td>
    <td></td>
  </tr>

  <tr>
    <td>主办</td>
    <td>设置主机，快捷方式非常长的URL语法。
    </td>
    <td><code class="noHighlight">localhost</code></td>
  </tr>

  <tr>
    <td>港口</td>
    <td>设置远程连接端口</td>
    <td><code class="noHighlight">8050</code></td>
  </tr>

  <tr>
    <td>用户名</td>
    <td>远程JMX连接用户名。
    </td>
    <td></td>
  </tr>

  <tr>
    <td>密码</td>
    <td>远程JMX连接密码。
    </td>
    <td></td>
  </tr>

  <tr>
    <td>参考</td>
    <td>内部连接引用的名称。使用此属性，您可以在同一Ant项目中配置更多一个连接。
    </td>
    <td><code class="noHighlight">jmx.server</code></td>
  </tr>

  <tr>
    <td>回声</td>
    <td>回显命令用法（用于访问分析或调试）</td>
    <td><code class="noHighlight">false</code></td>
  </tr>

  <tr>
    <td>如果</td>
    <td>仅当当前项目中<b>存在</b>给定名称的属性时才执行。
    </td>
    <td></td>
  </tr>

  <tr>
    <td>除非</td>
    <td>仅当当前项目中<b>不存在</b>给定名称的属性时才执行。
    </td>
    <td></td>
  </tr>

</tbody></table>

<p>打开新的JMX连接的示例</p>
<div class="codeBox"><pre><code>  &lt;jmx:open
    host="${jmx.server.name}"
    port="${jmx.server.port}"
  /&gt;</code></pre></div>

<p>通过URL打开具有授权的JMX连接并在其他参考处进行存储的示例</p>
<div class="codeBox"><pre><code>  &lt;jmx:open
    url="service:jmx:rmi:///jndi/rmi://localhost:9024/jmxrmi"
    ref="jmx.server.9024"
    username="controlRole"
    password="tomcat"
  /&gt;</code></pre></div>

<p>示例从URL打开具有授权的JMX连接并在其他引用处进行存储，但仅当属性<em>jmx.if</em>存在且<em>jmx.unless</em>不存在时</p>
<div class="codeBox"><pre><code>  &lt;jmx:open
    url="service:jmx:rmi:///jndi/rmi://localhost:9024/jmxrmi"
    ref="jmx.server.9024"
    username="controlRole"
    password="tomcat"
    if="jmx.if"
    unless="jmx.unless"
  /&gt;</code></pre></div>

<p><b>注意</b> ： <em>jmxOpen</em>任务的所有属性在所有其他任务和条件下也存在。
</p>

</div><h3 id="JMXAccessorGetTask:__get_attribute_value_Ant_task">JMXAccessorGetTask：获取属性值Ant任务</h3><div class="text">
<p>属性清单</p>
<table class="defaultTable">

  <tbody><tr>
    <th>属性</th>
    <th>描述</th>
    <th>默认值</th>
  </tr>

  <tr>
    <td>名称</td>
    <td>完全限定的JMX ObjectName- <em>Catalina：type = Server</em>
    </td>
    <td></td>
  </tr>

  <tr>
    <td>属性</td>
    <td>现有的MBean属性（请参阅上面的Tomcat MBean描述）</td>
    <td></td>
  </tr>

  <tr>
    <td>参考</td>
    <td>JMX连接参考</td>
    <td><code class="noHighlight">jmx.server</code></td>
  </tr>

  <tr>
    <td>回声</td>
    <td>回声命令用法（访问和结果）</td>
    <td><code class="noHighlight">false</code></td>
  </tr>

  <tr>
    <td>结果属性</td>
    <td>将结果保存在此项目属性中</td>
    <td></td>
  </tr>

  <tr>
    <td>定界符</td>
    <td>用定界符（java.util。StringTokenizer）并使用resultproperty作为前缀来存储令牌。
    </td>
    <td></td>
  </tr>

  <tr>
    <td>单独的数组结果</td>
    <td>当返回值是一个数组时，将结果另存为属性列表（ <em>$ resultproperty。[0 ..N]</em>和<em>$ resultproperty.length</em> ）</td>
    <td><code class="noHighlight">true</code></td>
  </tr>

</tbody></table>

<p>从默认JMX连接获取远程MBean属性的示例</p>
<div class="codeBox"><pre><code>  &lt;jmx:get
    name="Catalina:type=Manager,context=/servlets-examples,host=localhost"
    attribute="maxActiveSessions"
    resultproperty="servlets-examples.maxActiveSessions"
  /&gt;</code></pre></div>

<p>获取和结果数组并将其拆分为单独属性的示例</p>
<div class="codeBox"><pre><code>  &lt;jmx:get
      name="Catalina:type=ClusterSender,host=localhost"
      attribute="senderObjectNames"
      resultproperty="senderObjectNames"
  /&gt;</code></pre></div>
<p>通过以下方式访问senderObjectNames属性：</p>
<div class="codeBox"><pre><code>  ${senderObjectNames.length} give the number of returned sender list.
  ${senderObjectNames.[0..N]} found all sender object names</code></pre></div>


<p>仅在配置群集时使IDataSender属性连接的示例。<br>
<em>注意：</em> <code>name</code>将属性值包装在此处以提高可读性。它必须全部在同一行上，没有空格。
</p>
<div class="codeBox"><pre><code>
  &lt;jmx:query
    failonerror="false"
    name="Catalina:type=Cluster,host=${tomcat.application.host}"
    resultproperty="cluster"
  /&gt;
  &lt;jmx:get
    name=
"Catalina:type=IDataSender,host=${tomcat.application.host},
senderAddress=${cluster.backup.address},senderPort=${cluster.backup.port}"
    attribute="connected"
    resultproperty="datasender.connected"
    if="cluster.0.name" /&gt;</code></pre></div>

</div><h3 id="JMXAccessorSetTask:__set_attribute_value_Ant_task">JMXAccessorSetTask：设置属性值Ant任务</h3><div class="text">
<p>属性清单</p>
<table class="defaultTable">

  <tbody><tr>
    <th>属性</th>
    <th>描述</th>
    <th>默认值</th>
  </tr>

  <tr>
    <td>名称</td>
    <td>完全限定的JMX ObjectName- <em>Catalina：type = Server</em>
    </td>
    <td></td>
  </tr>

  <tr>
    <td>属性</td>
    <td>现有的MBean属性（请参阅上面的Tomcat MBean描述）</td>
    <td></td>
  </tr>

  <tr>
    <td>值</td>
    <td>设置为属性的值</td>
    <td></td>
  </tr>

  <tr>
    <td>类型</td>
    <td>属性的类型。
    </td>
    <td><code class="noHighlight">java.lang.String</code></td>
  </tr>

  <tr>
    <td>参考</td>
    <td>JMX连接参考</td>
    <td><code class="noHighlight">jmx.server</code></td>
  </tr>

  <tr>
    <td>回声</td>
    <td>回声命令用法（访问和结果）</td>
    <td><code class="noHighlight">false</code></td>
  </tr>

</tbody></table>

<p>设置远程MBean属性值的示例</p>
<div class="codeBox"><pre><code>  &lt;jmx:set
    name="Catalina:type=Manager,context=/servlets-examples,host=localhost"
    attribute="maxActiveSessions"
    value="500"
    type="int"
  /&gt;</code></pre></div>


</div><h3 id="JMXAccessorInvokeTask:__invoke_MBean_operation_Ant_task">JMXAccessorInvokeTask：调用MBean操作Ant任务</h3><div class="text">
<p>属性清单</p>
<table class="defaultTable">

  <tbody><tr>
    <th>属性</th>
    <th>描述</th>
    <th>默认值</th>
  </tr>

  <tr>
    <td>名称</td>
    <td>完全限定的JMX ObjectName- <em>Catalina：type = Server</em>
    </td>
    <td></td>
  </tr>

  <tr>
    <td>运作</td>
    <td>现有的MBean操作（请参阅Tomcat <a href="funcspecs/fs-admin-opers.html">funcspecs / fs-admin-opers.html</a> ）。
    </td>
    <td></td>
  </tr>

  <tr>
    <td>参考</td>
    <td>JMX连接参考</td>
    <td><code class="noHighlight">jmx.server</code></td>
  </tr>

  <tr>
    <td>回声</td>
    <td>回声命令用法（访问和结果）</td>
    <td><code class="noHighlight">false</code></td>
  </tr>

  <tr>
    <td>结果属性</td>
    <td>将结果保存在此项目属性中</td>
    <td></td>
  </tr>

  <tr>
    <td>定界符</td>
    <td>用定界符（java.util。StringTokenizer）并使用resultproperty作为前缀来存储令牌。
    </td>
    <td></td>
  </tr>

  <tr>
    <td>单独的数组结果</td>
    <td>当返回值是一个数组时，将结果另存为属性列表（ <em>$ resultproperty。[0 ..N]</em>和<em>$ resultproperty.length</em> ）</td>
    <td><code class="noHighlight">true</code></td>
  </tr>

</tbody></table>

<p>停止申请</p>
<div class="codeBox"><pre><code>  &lt;jmx:invoke
    name="Catalina:type=Manager,context=/servlets-examples,host=localhost"
    operation="stop"/&gt;</code></pre></div>
<p>现在，您可以在<em>$ {sessions。[0 ..N}个</em>属性，并使用$ {sessions.length}属性访问计数。
</p>
<p>获取所有会话ID的示例</p>
<div class="codeBox"><pre><code>  &lt;jmx:invoke
    name="Catalina:type=Manager,context=/servlets-examples,host=localhost"
    operation="listSessionIds"
    resultproperty="sessions"
    delimiter=" "
  /&gt;</code></pre></div>
<p>现在，您可以在<em>$ {sessions。[0 ..N}个</em>属性，并使用$ {sessions.length}属性访问计数。
</p>
<p>从会话$ {sessionid.0}获取远程MBean会话属性的示例</p>
<div class="codeBox"><pre><code>  &lt;jmx:invoke
    name="Catalina:type=Manager,context=/ClusterTest,host=localhost"
    operation="getSessionAttribute"
    resultproperty="hello"&gt;
     &lt;arg value="${sessionid.0}"/&gt;
     &lt;arg value="Hello" /&gt;
  &lt;/jmx:invoke&gt;</code></pre></div>

<p>在vhost <em>本地主机</em>上创建新的访问记录器阀门的示例
</p>
<div class="codeBox"><pre><code> &lt;jmx:invoke
         name="Catalina:type=MBeanFactory"
         operation="createAccessLoggerValve"
         resultproperty="accessLoggerObjectName"
 &gt;
     &lt;arg value="Catalina:type=Host,host=localhost"/&gt;
 &lt;/jmx:invoke&gt;</code></pre></div>
<p>现在，您可以找到名称存储在<em>$ {accessLoggerObjectName}</em>属性中的新MBean。
</p>

</div><h3 id="JMXAccessorQueryTask:__query_MBean_Ant_task">JMXAccessorQueryTask：查询MBean Ant任务</h3><div class="text">
<p>属性清单</p>
<table class="defaultTable">

  <tbody><tr>
    <th>属性</th>
    <th>描述</th>
    <th>默认值</th>
  </tr>

  <tr>
    <td>名称</td>
    <td>JMX ObjectName查询字符串<em>-Catalina：type = Manager，*</em>
    </td>
    <td></td>
  </tr>

  <tr>
    <td>参考</td>
    <td>JMX连接参考</td>
    <td><code class="noHighlight">jmx.server</code></td>
  </tr>

  <tr>
    <td>回声</td>
    <td>回声命令用法（访问和结果）</td>
    <td><code class="noHighlight">false</code></td>
  </tr>

  <tr>
    <td>结果属性</td>
    <td>为所有已建立的MBeans（ <em>mbeans。[0 ..N] .objectname</em> ）</td>
    <td></td>
  </tr>

  <tr>
    <td>属性绑定</td>
    <td>绑定除<em>名称</em>之外的所有MBean属性
    </td>
    <td><code class="noHighlight">false</code></td>
  </tr>

  <tr>
    <td>定界符</td>
    <td>用定界符（java.util。StringTokenizer）并使用resultproperty作为前缀来存储令牌。
    </td>
    <td></td>
  </tr>

  <tr>
    <td>单独的数组结果</td>
    <td>当返回值是一个数组时，将结果另存为属性列表（ <em>$ resultproperty。[0 ..N]</em>和<em>$ resultproperty.length</em> ）</td>
    <td><code class="noHighlight">true</code></td>
  </tr>

</tbody></table>

<p>从所有服务和主机获取所有Manager ObjectNames</p>
<div class="codeBox"><pre><code>  &lt;jmx:query
    name="Catalina:type=Manager,*
    resultproperty="manager" /&gt;</code></pre></div>
<p>现在，您可以在<em>$ {manager。[0 ..N] .name}</em>属性，并使用$ {manager.length}属性访问结果对象计数器。
</p>
<p>从<em>servlet-examples</em>应用程序获取Manager并绑定所有MBean属性的<em>示例</em></p>
<div class="codeBox"><pre><code>  &lt;jmx:query
    name="Catalina:type=Manager,context=/servlet-examples,host=localhost*"
    attributebinding="true"
    resultproperty="manager.servletExamples" /&gt;</code></pre></div>
<p>现在，您可以在<em>$ {manager.servletExamples.0.name}</em>属性中找到管理器，并可以使用<em>$ {manager.servletExamples.0。[manager属性名称]</em> }从该管理器访问所有属性。MBeans的结果对象计数器存储在$ {manager.length}属性中。
</p>

<p>从服务器获取所有MBean并将其存储在外部XML属性文件中的示例</p>
<div class="codeBox"><pre><code>&lt;project name="jmx.query"
            xmlns:jmx="antlib:org.apache.catalina.ant.jmx"
            default="query-all" basedir="."&gt;
&lt;property name="jmx.host" value="localhost"/&gt;
&lt;property name="jmx.port" value="8050"/&gt;
&lt;property name="jmx.username" value="controlRole"/&gt;
&lt;property name="jmx.password" value="tomcat"/&gt;

&lt;target name="query-all" description="Query all MBeans of a server"&gt;
  &lt;!-- Configure connection --&gt;
  &lt;jmx:open
    host="${jmx.host}"
    port="${jmx.port}"
    ref="jmx.server"
    username="${jmx.username}"
    password="${jmx.password}"/&gt;

  &lt;!-- Query MBean list --&gt;
  &lt;jmx:query
    name="*:*"
    resultproperty="mbeans"
    attributebinding="false"/&gt;

  &lt;echoproperties
    destfile="mbeans.properties"
    prefix="mbeans."
    format="xml"/&gt;

  &lt;!-- Print results --&gt;
  &lt;echo message=
    "Number of MBeans in server ${jmx.host}:${jmx.port} is ${mbeans.length}"/&gt;
&lt;/target&gt;
&lt;/project&gt;</code></pre></div>
<p>现在，您可以在文件<em>mbeans.properties中</em>找到所有MBean。
</p>

</div><h3 id="JMXAccessorCreateTask:__remote_create_MBean_Ant_task">JMXAccessorCreateTask：远程创建MBean Ant任务</h3><div class="text">
<p>属性清单</p>
<table class="defaultTable">

  <tbody><tr>
    <th>属性</th>
    <th>描述</th>
    <th>默认值</th>
  </tr>

  <tr>
    <td>名称</td>
    <td>完全限定的JMX ObjectName- <em>Catalina：type = MBeanFactory</em>
    </td>
    <td></td>
  </tr>

  <tr>
    <td>班级名称</td>
    <td>现有的MBean完整合格的类名（请参阅上面的Tomcat MBean描述）</td>
    <td></td>
  </tr>

  <tr>
    <td>classLoader</td>
    <td>服务器或Web应用程序类加载器的ObjectName<br>（ <em>Catalina：type = ServerClassLoader，name = [server，common，shared]</em>或<br>
     <em>Catalina：类型= WebappClassLoader，上下文= / myapps，主机=本地主机</em> ）</td>
    <td></td>
  </tr>

  <tr>
    <td>参考</td>
    <td>JMX连接参考</td>
    <td><code class="noHighlight">jmx.server</code></td>
  </tr>

  <tr>
    <td>回声</td>
    <td>回声命令用法（访问和结果）</td>
    <td><code class="noHighlight">false</code></td>
  </tr>

</tbody></table>

<p>创建远程MBean的示例</p>
<div class="codeBox"><pre><code>  &lt;jmx:create
    ref="${jmx.reference}"
    name="Catalina:type=MBeanFactory"
    className="org.apache.commons.modeler.BaseModelMBean"
    classLoader="Catalina:type=ServerClassLoader,name=server"&gt;
    &lt;arg value="org.apache.catalina.mbeans.MBeanFactory" /&gt;
  &lt;/jmx:create&gt;</code></pre></div>

<p>
    <b>警告</b> ：许多Tomcat MBean一次都无法链接到其父级<br>创建。Valve，Cluster和Realm MBean不会自动<br>与父母联系。使用<em>MBeanFactory</em>创建<br>操作代替。
</p>

</div><h3 id="JMXAccessorUnregisterTask:__remote_unregister_MBean_Ant_task">JMXAccessorUnregisterTask：远程注销MBean Ant任务</h3><div class="text">
<p>属性清单</p>
<table class="defaultTable">

  <tbody><tr>
    <th>属性</th>
    <th>描述</th>
    <th>默认值</th>
  </tr>

  <tr>
    <td>名称</td>
    <td>完全限定的JMX ObjectName- <em>Catalina：type = MBeanFactory</em>
    </td>
    <td></td>
  </tr>

  <tr>
    <td>参考</td>
    <td>JMX连接参考</td>
    <td><code class="noHighlight">jmx.server</code></td>
  </tr>

  <tr>
    <td>回声</td>
    <td>回声命令用法（访问和结果）</td>
    <td><code class="noHighlight">false</code></td>
  </tr>

</tbody></table>

<p>取消注册远程MBean的示例</p>
<div class="codeBox"><pre><code>  &lt;jmx:unregister
    name="Catalina:type=MBeanFactory"
  /&gt;</code></pre></div>

<p>
    <b>警告</b> ：不能取消注册许多Tomcat MBean。<br>MBean并未与其父级解除链接。使用<em>MBeanFactory</em><br>而是删除操作。
</p>

</div><h3 id="JMXAccessorCondition:__express_condition">JMXAccessorCondition：表达条件</h3><div class="text">
<p>属性清单</p>
<table class="defaultTable">

  <tbody><tr>
    <th>属性</th>
    <th>描述</th>
    <th>默认值</th>
  </tr>

 <tr>
    <td>网址</td>
    <td>设置JMX连接URL- <em>service：jmx：rmi：/// jndi / rmi：// localhost：8050 / jmxrmi</em>
    </td>
    <td></td>
  </tr>

  <tr>
    <td>主办</td>
    <td>设置主机，快捷方式非常长的URL语法。
    </td>
    <td><code class="noHighlight">localhost</code></td>
  </tr>

  <tr>
    <td>港口</td>
    <td>设置远程连接端口</td>
    <td><code class="noHighlight">8050</code></td>
  </tr>

  <tr>
    <td>用户名</td>
    <td>远程JMX连接用户名。
    </td>
    <td></td>
  </tr>

  <tr>
    <td>密码</td>
    <td>远程JMX连接密码。
    </td>
    <td></td>
  </tr>

  <tr>
    <td>参考</td>
    <td>内部连接引用的名称。使用此属性，您可以在同一Ant项目中配置更多一个连接。
    </td>
    <td><code class="noHighlight">jmx.server</code></td>
  </tr>

  <tr>
    <td>名称</td>
    <td>完全限定的JMX ObjectName- <em>Catalina：type = Server</em>
    </td>
    <td></td>
  </tr>

  <tr>
    <td>回声</td>
    <td>回声条件的使用（访问和结果）</td>
    <td><code class="noHighlight">false</code></td>
  </tr>

  <tr>
    <td>如果</td>
    <td>仅当当前项目中<b>存在</b>给定名称的属性时才执行。
    </td>
    <td></td>
  </tr>

  <tr>
    <td>除非</td>
    <td>仅当当前项目中<b>不存在</b>给定名称的属性时才执行。
    </td>
    <td></td>
  </tr>

  <tr>
    <td>值（必填）</td>
    <td>操作的第二个参数</td>
    <td></td>
  </tr>

  <tr>
    <td>类型</td>
    <td>表示操作的值类型（支持<em>long</em>和<em>double</em> ）</td>
    <td><code class="noHighlight">long</code></td>
  </tr>

  <tr>
    <td>运作</td>
    <td>表达一个<ul>
    <li>==等于</li>
    <li>！=不等于</li>
    <li>>大于（>）</li>
    <li>> =大于或等于（> =）</li>
    <li><小于（<）</li>
    <li><=小于或等于（<=）</li>
    </ul>
    </td>
    <td><code class="noHighlight">==</code></td>
  </tr>

</tbody></table>

<p>等待服务器连接，并且该群集备份节点可访问</p>
<div class="codeBox"><pre><code>&lt;target name="wait"&gt;
  &lt;waitfor maxwait="${maxwait}" maxwaitunit="second" timeoutproperty="server.timeout" &gt;
    &lt;and&gt;
      &lt;socket server="${server.name}" port="${server.port}"/&gt;
      &lt;http url="${url}"/&gt;
      &lt;jmx:condition
        operation="=="
        host="localhost"
        port="9014"
        username="controlRole"
        password="tomcat"
        name=
"Catalina:type=IDataSender,host=localhost,senderAddress=192.168.111.1,senderPort=9025"
        attribute="connected"
        value="true"
      /&gt;
    &lt;/and&gt;
  &lt;/waitfor&gt;
  &lt;fail if="server.timeout" message="Server ${url} don't answer inside ${maxwait} sec" /&gt;
  &lt;echo message="Server ${url} alive" /&gt;
&lt;/target&gt;</code></pre></div>

</div><h3 id="JMXAccessorEqualsCondition:__equals_MBean_Ant_condition">JMXAccessorEqualsCondition：等于MBean Ant条件</h3><div class="text">
<p>属性清单</p>
<table class="defaultTable">

  <tbody><tr>
    <th>属性</th>
    <th>描述</th>
    <th>默认值</th>
  </tr>

 <tr>
    <td>网址</td>
    <td>设置JMX连接URL- <em>service：jmx：rmi：/// jndi / rmi：// localhost：8050 / jmxrmi</em>
    </td>
    <td></td>
  </tr>

  <tr>
    <td>主办</td>
    <td>设置主机，快捷方式非常长的URL语法。
    </td>
    <td><code class="noHighlight">localhost</code></td>
  </tr>

  <tr>
    <td>港口</td>
    <td>设置远程连接端口</td>
    <td><code class="noHighlight">8050</code></td>
  </tr>

  <tr>
    <td>用户名</td>
    <td>远程JMX连接用户名。
    </td>
    <td></td>
  </tr>

  <tr>
    <td>密码</td>
    <td>远程JMX连接密码。
    </td>
    <td></td>
  </tr>

  <tr>
    <td>参考</td>
    <td>内部连接引用的名称。使用此属性，您可以在同一Ant项目中配置更多一个连接。
    </td>
    <td><code class="noHighlight">jmx.server</code></td>
  </tr>

  <tr>
    <td>名称</td>
    <td>完全限定的JMX ObjectName- <em>Catalina：type = Server</em>
    </td>
    <td></td>
  </tr>


  <tr>
    <td>回声</td>
    <td>回声条件的使用（访问和结果）</td>
    <td><code class="noHighlight">false</code></td>
  </tr>

</tbody></table>

<p>等待服务器连接，并且该群集备份节点可访问</p>
<div class="codeBox"><pre><code>&lt;target name="wait"&gt;
  &lt;waitfor maxwait="${maxwait}" maxwaitunit="second" timeoutproperty="server.timeout" &gt;
    &lt;and&gt;
      &lt;socket server="${server.name}" port="${server.port}"/&gt;
      &lt;http url="${url}"/&gt;
      &lt;jmx:equals
        host="localhost"
        port="9014"
        username="controlRole"
        password="tomcat"
        name=
"Catalina:type=IDataSender,host=localhost,senderAddress=192.168.111.1,senderPort=9025"
        attribute="connected"
        value="true"
      /&gt;
    &lt;/and&gt;
  &lt;/waitfor&gt;
  &lt;fail if="server.timeout" message="Server ${url} don't answer inside ${maxwait} sec" /&gt;
  &lt;echo message="Server ${url} alive" /&gt;
&lt;/target&gt;</code></pre></div>

</div><h3 id="Using_the_JMXProxyServlet">使用JMXProxyServlet</h3><div class="text">

    <p>Tomcat提供了一种使用远程（甚至本地）JMX连接的替代方法，同时仍使您可以访问JMX必须提供的所有功能：Tomcat的<a href="api/org/apache/catalina/manager/JMXProxyServlet.html">JMXProxyServlet</a> 。
    </p>

    <p>JMXProxyServlet允许客户端通过HTTP接口发出JMX查询。与直接从客户端程序使用JMX相比，该技术具有以下优点：</p>

    <ul>
      <li>您不必启动完整的JVM并建立远程JMX连接，而只需从正在运行的服务器中请求一小部分数据</li>
      <li>您不必知道如何使用JMX连接</li>
      <li>您不需要本页面其余部分介绍的任何复杂配置</li>
      <li>您的客户端程序不必用Java编写</li>
    </ul>

    <p>在流行的服务器监视软件（例如Nagios或Icinga）中，可以看到JMX过度杀伤的一个完美示例：如果要通过JMX监视10个项目，则必须启动10个JVM，建立10个JMX连接，然后关闭他们每隔几分钟就下来。使用JMXProxyServlet，您可以建立10个HTTP连接并完成它。
    </p>

    <p>您可以在<a href="manager-howto.html#Using_the_JMX_Proxy_Servlet">Tomcat管理器</a>的文档中找到有关JMXProxyServlet的更多信息。
    </p>
  </div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="./comments.html">这里</a>解释<a href="./comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>