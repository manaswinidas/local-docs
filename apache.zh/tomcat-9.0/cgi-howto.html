<html lang="zh-Hans" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="./images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9（9.0.21）-CGI如何</title><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/cgi-howto">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script></head><body ><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="./images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="./images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>Apache Tomcat 9</h1><div class="versionInfo">版本9.0.21， <time datetime="2019-06-04"> 2019年6月4日</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>链接</h2><ul><li><a href="index.html">文件首页</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">常问问题</a></li><li><a href="#comments_section">用户评论</a></li></ul></div><div><h2>用户指南</h2><ul><li><a href="introduction.html">1）简介</a></li><li><a href="setup.html">2）设定</a></li><li><a href="appdev/index.html">3）第一个webapp</a></li><li><a href="deployer-howto.html">4）部署者</a></li><li><a href="manager-howto.html">5）经理</a></li><li><a href="host-manager-howto.html">6）主机管理员</a></li><li><a href="realm-howto.html">7）领域和AAA</a></li><li><a href="security-manager-howto.html">8）安全经理</a></li><li><a href="jndi-resources-howto.html">9）JNDI资源</a></li><li><a href="jndi-datasource-examples-howto.html">10）JDBC数据源</a></li><li><a href="class-loader-howto.html">11）类加载</a></li><li><a href="jasper-howto.html">12）JSP</a></li><li><a href="ssl-howto.html">13）SSL / TLS</a></li><li><a href="ssi-howto.html">14）SSI</a></li><li><a href="cgi-howto.html">15）CGI</a></li><li><a href="proxy-howto.html">16）代理支持</a></li><li><a href="mbeans-descriptors-howto.html">17）MBean描述符</a></li><li><a href="default-servlet.html">18）默认Servlet</a></li><li><a href="cluster-howto.html">19）聚类</a></li><li><a href="balancer-howto.html">20）负载均衡器</a></li><li><a href="connectors.html">21）连接器</a></li><li><a href="monitoring.html">22）监控与管理</a></li><li><a href="logging.html">23）记录</a></li><li><a href="apr.html">24）APR /本地</a></li><li><a href="virtual-hosting-howto.html">25）虚拟主机</a></li><li><a href="aio.html">26）高级IO</a></li><li><a href="extras.html">27）附加组件</a></li><li><a href="maven-jars.html">28）行刑</a></li><li><a href="security-howto.html">29）安全注意事项</a></li><li><a href="windows-service-howto.html">30）Windows服务</a></li><li><a href="windows-auth-howto.html">31）Windows身份验证</a></li><li><a href="jdbc-pool.html">32）Tomcat的JDBC池</a></li><li><a href="web-socket-howto.html">33）WebSocket</a></li><li><a href="rewrite.html">34）改写</a></li></ul></div><div><h2>参考</h2><ul><li><a href="RELEASE-NOTES.txt">发行说明</a></li><li><a href="config/index.html">组态</a></li><li><a href="api/index.html">Tomcat Java文档</a></li><li><a href="servletapi/index.html">Servlet Java文档</a></li><li><a href="jspapi/index.html">JSP 2.3 Java文档</a></li><li><a href="elapi/index.html">EL 3.0 Java文档</a></li><li><a href="websocketapi/index.html">WebSocket 1.1 Java文档</a></li><li><a href="https://tomcat.apache.org/connectors-doc/">JK 1.2文档</a></li></ul></div><div><h2>Apache Tomcat开发</h2><ul><li><a href="building.html">建造</a></li><li><a href="changelog.html">变更日志</a></li><li><a href="https://wiki.apache.org/tomcat/TomcatVersions">状态</a></li><li><a href="developers.html">开发者</a></li><li><a href="architecture/index.html">建筑</a></li><li><a href="funcspecs/index.html">功能规格。</a></li><li><a href="tribes/introduction.html">部族</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>CGI如何</h2><h3 id="Table_of_Contents">目录</h3><div class="text">
<ul><li><a href="#Introduction">介绍</a></li><li><a href="#Installation">安装</a></li><li><a href="#Configuration">组态</a></li></ul>
</div><h3 id="Introduction">介绍</h3><div class="text">

<p>CGI（通用网关接口）为Web服务器定义了一种与外部内容生成程序进行交互的方式，这些程序通常称为CGI程序或CGI脚本。
</p>

<p>在Tomcat中，当您将Tomcat用作HTTP服务器并需要CGI支持时，可以添加CGI支持。通常，当您不想运行Apache httpd这样的Web服务器时，这是在开发期间完成的。Tomcat的CGI支持在很大程度上与Apache httpd兼容，但是存在一些限制（例如，只有一个cgi-bin目录）。
</p>

<p>使用Servlet类实现CGI支持<code>org.apache.catalina.servlets.CGIServlet</code> 。传统上，此servlet映射到URL模式“ / cgi-bin / *”。</p>

<p>默认情况下，Tomcat中禁用了CGI支持。</p>
</div><h3 id="Installation">安装</h3><div class="text">

<p><strong>注意</strong> -CGI脚本用于执行Tomcat JVM外部的程序。如果您使用的是Java SecurityManager，它将绕过您的安全策略配置<code>catalina.policy.</code></p>

<p>要启用CGI支持：</p>

<ol>
<li><p>默认情况下，CGI servlet有注释掉的样本servlet和servlet映射元素。 <code>$CATALINA_BASE/conf/web.xml</code>文件。要在您的Web应用程序中启用CGI支持，请将该servlet和servlet映射声明复制到<code>WEB-INF/web.xml</code> Web应用程序的文件。</p>

<p>取消注释servlet和servlet映射<code>$CATALINA_BASE/conf/web.xml</code>文件同时为所有已安装的Web应用程序启用CGI。</p>
</li>

<li><p>组<code>privileged="true"</code>在您的Web应用程序的Context元素上。</p>

<p>仅允许将标记为特权的上下文使用CGI Servlet。注意修改全局<code>$CATALINA_BASE/conf/context.xml</code>文件会影响所有Web应用程序。有关详细信息，请参见<a href="config/context.html">上下文文档</a> 。</p>
</li>
</ol>

</div><h3 id="Configuration">组态</h3><div class="text">

<p>有几个servlet初始化参数可用于配置CGI servlet的行为。</p>
<ul>
<li><strong>cgiMethods-</strong>逗号分隔的HTTP方法列表。使用这些方法之一的请求将传递到CGI脚本，以使脚本生成响应。默认值为<code>GET,POST</code> 。使用<code>*</code>该脚本可以处理所有请求，而与方法无关。除非被此参数的配置所覆盖，否则使用HEAD，OPTIONS或TRACE的请求将由超类处理。</li>
<li><strong>cgiPathPrefix</strong> -CGI搜索路径将从Web应用程序的根目录+ File.separator +此前缀开始。默认情况下，没有值，这导致将Web应用程序根目录用作搜索路径。推荐值是<code>WEB-INF/cgi</code></li>
<li><strong>cmdLineArgumentsDecoded-</strong>如果启用了命令行参数（通过<strong>enableCmdLineArguments</strong> ）并且Tomcat在Windows上运行，则每个解码的命令行参数都必须与此模式匹配，否则请求将被拒绝。这是为了防止已知问题从Java传递命令行参数到Windows。这些问题可能导致远程执行代码。有关这些问题的更多信息，请参阅<a href="https://codewhitesec.blogspot.com/2016/02/java-and-command-line-injections-in-windows.html">Markus Wulftange的博客</a>以及<a href="https://web.archive.org/web/20161228144344/https://blogs.msdn.microsoft.com/twistylittlepassagesallalike/2011/04/23/everyone-quotes-command-line-arguments-the-wrong-way/">Daniel Colascione的</a>已存档<a href="https://web.archive.org/web/20161228144344/https://blogs.msdn.microsoft.com/twistylittlepassagesallalike/2011/04/23/everyone-quotes-command-line-arguments-the-wrong-way/">博客</a> 。</li>
<li><strong>cmdLineArgumentsEncoded-</strong>如果启用了命令行参数（通过<strong>enableCmdLineArguments</strong> ），则单个编码的命令行参数必须与此模式匹配，否则该请求将被拒绝。默认值与RFC3875定义的允许值匹配，并且为<code>[a-zA-Z0-9\Q%;/?:@&,$-_.!~*'()\E]+</code></li>
<li><strong>enableCmdLineArguments-</strong>是否根据3875 RFC的4.4节从查询字符串生成了命令行参数？默认是<code>false</code> 。</li>
<li><strong>环境变量</strong> -为CGI脚本的执行环境设置的环境。变量的名称取自参数名称。要配置名为FOO的环境变量，请配置名为environment-variable-FOO的参数。参数值用作环境变量值。默认为无环境变量。</li>
<li><strong>可执行文件</strong> -用于运行脚本的可执行<strong>文件</strong>的名称。如果脚本本身是可执行文件（例如exe文件），则可以将该参数显式设置为空字符串。默认为<code>perl</code> 。</li>
<li><strong>可执行文件arg-1</strong> ， <strong>可执行文件arg-2</strong>等等-可执行文件的其他参数。这些在CGI脚本名称之前。默认情况下，没有其他参数。</li>
<li><strong>envHttpHeaders-</strong>一个正则表达式，用于选择作为环境变量传递给CGI进程的HTTP标头。请注意，在匹配之前，标头已转换为大写，并且整个标头名称必须与模式匹配。默认为<code>ACCEPT[-0-9A-Z]*|CACHE-CONTROL|COOKIE|HOST|IF-[-0-9A-Z]*|REFERER|USER-AGENT</code>
</li>
<li><strong>parameterEncoding-</strong>与CGI Servlet一起使用的参数编码的名称。默认是<code>System.getProperty("file.encoding","UTF-8")</code> 。这是系统默认编码，如果该系统属性不可用，则为UTF-8。</li>
<li><strong>passShellEnvironment-</strong>是否应将Tomcat进程中的shell环境变量（如果有）传递给CGI脚本？默认为<code>false</code> 。</li>
<li><strong>stderrTimeout-</strong>在终止CGI进程之前等待stderr读取完成的时间（以毫秒为单位）。默认为<code>2000</code> 。</li>
</ul>

<p>执行的CGI脚本取决于CGI Servlet的配置以及请求如何映射到CGI Servlet。CGI搜索路径从Web应用程序的根目录+ File.separator + cgiPathPrefix开始。然后搜索<strong>pathInfo，</strong>除非它是<code>null</code> -在这种情况下，将搜索<strong>servletPath</strong> 。</p>

<p>搜索从第一个路径段开始，并一次扩展一个路径段，直到没有剩余路径段（导致404）或找到脚本为止。所有剩余的路径段都将传递到<strong>PATH_INFO</strong>环境变量中的脚本中。</p>

</div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="./comments.html">这里</a>解释<a href="./comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>