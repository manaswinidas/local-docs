<html lang="zh-Hans" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="./images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9（9.0.21）-WebSocket操作方法</title><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/web-socket-howto">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script></head><body ><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="./images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="./images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>Apache Tomcat 9</h1><div class="versionInfo">版本9.0.21， <time datetime="2019-06-04"> 2019年6月4日</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>链接</h2><ul><li><a href="index.html">文件首页</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">常问问题</a></li><li><a href="#comments_section">用户评论</a></li></ul></div><div><h2>用户指南</h2><ul><li><a href="introduction.html">1）简介</a></li><li><a href="setup.html">2）设定</a></li><li><a href="appdev/index.html">3）第一个webapp</a></li><li><a href="deployer-howto.html">4）部署者</a></li><li><a href="manager-howto.html">5）经理</a></li><li><a href="host-manager-howto.html">6）主机管理员</a></li><li><a href="realm-howto.html">7）领域和AAA</a></li><li><a href="security-manager-howto.html">8）安全经理</a></li><li><a href="jndi-resources-howto.html">9）JNDI资源</a></li><li><a href="jndi-datasource-examples-howto.html">10）JDBC数据源</a></li><li><a href="class-loader-howto.html">11）类加载</a></li><li><a href="jasper-howto.html">12）JSP</a></li><li><a href="ssl-howto.html">13）SSL / TLS</a></li><li><a href="ssi-howto.html">14）SSI</a></li><li><a href="cgi-howto.html">15）CGI</a></li><li><a href="proxy-howto.html">16）代理支持</a></li><li><a href="mbeans-descriptors-howto.html">17）MBean描述符</a></li><li><a href="default-servlet.html">18）默认Servlet</a></li><li><a href="cluster-howto.html">19）聚类</a></li><li><a href="balancer-howto.html">20）负载均衡器</a></li><li><a href="connectors.html">21）连接器</a></li><li><a href="monitoring.html">22）监控与管理</a></li><li><a href="logging.html">23）记录</a></li><li><a href="apr.html">24）APR /本地</a></li><li><a href="virtual-hosting-howto.html">25）虚拟主机</a></li><li><a href="aio.html">26）高级IO</a></li><li><a href="extras.html">27）附加组件</a></li><li><a href="maven-jars.html">28）行刑</a></li><li><a href="security-howto.html">29）安全注意事项</a></li><li><a href="windows-service-howto.html">30）Windows服务</a></li><li><a href="windows-auth-howto.html">31）Windows身份验证</a></li><li><a href="jdbc-pool.html">32）Tomcat的JDBC池</a></li><li><a href="web-socket-howto.html">33）WebSocket</a></li><li><a href="rewrite.html">34）改写</a></li></ul></div><div><h2>参考</h2><ul><li><a href="RELEASE-NOTES.txt">发行说明</a></li><li><a href="config/index.html">组态</a></li><li><a href="api/index.html">Tomcat Java文档</a></li><li><a href="servletapi/index.html">Servlet Java文档</a></li><li><a href="jspapi/index.html">JSP 2.3 Java文档</a></li><li><a href="elapi/index.html">EL 3.0 Java文档</a></li><li><a href="websocketapi/index.html">WebSocket 1.1 Java文档</a></li><li><a href="https://tomcat.apache.org/connectors-doc/">JK 1.2文档</a></li></ul></div><div><h2>Apache Tomcat开发</h2><ul><li><a href="building.html">建造</a></li><li><a href="changelog.html">变更日志</a></li><li><a href="https://wiki.apache.org/tomcat/TomcatVersions">状态</a></li><li><a href="developers.html">开发者</a></li><li><a href="architecture/index.html">建筑</a></li><li><a href="funcspecs/index.html">功能规格。</a></li><li><a href="tribes/introduction.html">部族</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>WebSocket的方法</h2><h3 id="Table_of_Contents">目录</h3><div class="text">
<ul><li><a href="#Overview">总览</a></li><li><a href="#Application_development">应用开发</a></li><li><a href="#Tomcat_WebSocket_specific_configuration">Tomcat WebSocket特定配置</a></li></ul>
</div><h3 id="Overview">总览</h3><div class="text">
<p>Tomcat提供对<a href="https://tools.ietf.org/html/rfc6455">RFC 6455</a>定义的WebSocket的支持。</p>
</div><h3 id="Application_development">应用开发</h3><div class="text">
<p>Tomcat实现了<a href="https://www.jcp.org/en/jsr/detail?id=356">JSR-356</a>定义的Java WebSocket 1.1 API。</p>

<p>有几个示例应用程序演示了如何使用WebSocket API。您将需要同时查看客户端<a href="https://svn.apache.org/viewvc/tomcat/trunk/webapps/examples/websocket/">HTML</a>和服务器端<a href="https://svn.apache.org/viewvc/tomcat/trunk/webapps/examples/WEB-INF/classes/websocket/">代码</a> 。</p>
</div><h3 id="Tomcat_WebSocket_specific_configuration">Tomcat WebSocket特定配置</h3><div class="text">

<p>Tomcat为WebSocket提供了许多Tomcat特定的配置选项。预计随着时间的推移，这些将被纳入WebSocket规范中。</p>

<p>在阻塞模式下发送WebSocket消息时使用的写超时默认为20000毫秒（20秒）。可以通过设置属性来更改<code>org.apache.tomcat.websocket.BLOCKING_SEND_TIMEOUT</code>在附加到WebSocket会话的用户属性集合中。分配给该属性的值应为<code>Long</code>并表示要使用的超时（以毫秒为单位）。对于无限超时，请使用<code>-1</code> 。</p>

<p>如果应用程序未定义<code>MessageHandler.Partial</code>对于传入的二进制消息，任何传入的二进制消息都必须被缓冲，以便整个消息可以在一次调用中传递到已注册的<code>MessageHandler.Whole</code>用于二进制消息。二进制消息的默认缓冲区大小为8192字节。对于Web应用程序，可以通过设置Servlet上下文初始化参数来更改此设置<code>org.apache.tomcat.websocket.binaryBufferSize</code>到所需的字节值。</p>

<p>如果应用程序未定义<code>MessageHandler.Partial</code>对于传入的文本消息，任何传入的文本消息都必须进行缓冲，以便可以在单个调用中将整个消息传递到已注册的<code>MessageHandler.Whole</code>用于短信。文本消息的默认缓冲区大小为8192字节。对于Web应用程序，可以通过设置Servlet上下文初始化参数来更改此设置<code>org.apache.tomcat.websocket.textBufferSize</code>到所需的字节值。</p>

<p>在第一个端点启动WebSocket握手之后，Java WebSocket规范1.0不允许以编程方式部署。默认情况下，Tomcat继续允许其他程序部署。此行为由<code>org.apache.tomcat.websocket.noAddAfterHandshake</code> servlet上下文初始化参数。默认值可以通过设置<code>org.apache.tomcat.websocket.STRICT_SPEC_COMPLIANCE</code>系统属性<code>true</code>但是servlet上下文上的任何显式设置将始终优先。</p>

<p>使用WebSocket客户端连接到服务器端点时，建立连接时IO操作的超时由<code>userProperties</code>提供的<code>javax.websocket.ClientEndpointConfig</code> 。该属性是<code>org.apache.tomcat.websocket.IO_TIMEOUT_MS</code>并且作为一个超时<code>String</code>以毫秒为单位。默认值为5000（5秒）。</p>

<p>使用WebSocket客户端连接到安全服务器端点时，客户端SSL配置由<code>userProperties</code>提供的<code>javax.websocket.ClientEndpointConfig</code> 。支持以下用户属性：</p>
   <ul>
     <li><code>org.apache.tomcat.websocket.SSL_CONTEXT</code></li>
     <li><code>org.apache.tomcat.websocket.SSL_PROTOCOLS</code></li>
     <li><code>org.apache.tomcat.websocket.SSL_TRUSTSTORE</code></li>
     <li><code>org.apache.tomcat.websocket.SSL_TRUSTSTORE_PWD</code></li>
   </ul>
   <p>默认的信任库密码是<code>changeit</code> 。</p>

<p>如果<code>org.apache.tomcat.websocket.SSL_CONTEXT</code>设置属性，然后<code>org.apache.tomcat.websocket.SSL_TRUSTSTORE</code>和<code>org.apache.tomcat.websocket.SSL_TRUSTSTORE_PWD</code>属性将被忽略。</p>

<p>对于安全的服务器端点，默认情况下启用主机名验证。要绕过此验证（不推荐），必须提供一个自定义<code>SSLContext</code>通过<code>org.apache.tomcat.websocket.SSL_CONTEXT</code>用户属性。风俗<code>SSLContext</code>必须使用自定义配置<code>TrustManager</code>延伸<code>javax.net.ssl.X509ExtendedTrustManager</code> 。然后，可以通过各个抽象方法的适当实现来控制所需的验证（或缺少验证）。</p>

<p>使用WebSocket客户端连接到服务器端点时，客户端将遵循的HTTP重定向次数由<code>userProperties</code>提供的<code>javax.websocket.ClientEndpointConfig</code> 。该属性是<ocde>org.apache.tomcat.websocket。MAX_REDIRECTIONS</ocde> 。预设值为20。可以通过将值配置为零来禁用重定向支持。</p>

</div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="./comments.html">这里</a>解释<a href="./comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>