<html lang="zh-Hans" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="./images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9（9.0.21）-Jasper 2 JSP Engine如何</title><meta name="author" content="Glenn L. Nielsen"><meta name="author" content="Peter Rossbach"><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/jasper-howto">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script></head><body ><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="./images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="./images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>Apache Tomcat 9</h1><div class="versionInfo">版本9.0.21， <time datetime="2019-06-04"> 2019年6月4日</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>链接</h2><ul><li><a href="index.html">文件首页</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">常问问题</a></li><li><a href="#comments_section">用户评论</a></li></ul></div><div><h2>用户指南</h2><ul><li><a href="introduction.html">1）简介</a></li><li><a href="setup.html">2）设定</a></li><li><a href="appdev/index.html">3）第一个webapp</a></li><li><a href="deployer-howto.html">4）部署者</a></li><li><a href="manager-howto.html">5）经理</a></li><li><a href="host-manager-howto.html">6）主机管理员</a></li><li><a href="realm-howto.html">7）领域和AAA</a></li><li><a href="security-manager-howto.html">8）安全经理</a></li><li><a href="jndi-resources-howto.html">9）JNDI资源</a></li><li><a href="jndi-datasource-examples-howto.html">10）JDBC数据源</a></li><li><a href="class-loader-howto.html">11）类加载</a></li><li><a href="jasper-howto.html">12）JSP</a></li><li><a href="ssl-howto.html">13）SSL / TLS</a></li><li><a href="ssi-howto.html">14）SSI</a></li><li><a href="cgi-howto.html">15）CGI</a></li><li><a href="proxy-howto.html">16）代理支持</a></li><li><a href="mbeans-descriptors-howto.html">17）MBean描述符</a></li><li><a href="default-servlet.html">18）默认Servlet</a></li><li><a href="cluster-howto.html">19）聚类</a></li><li><a href="balancer-howto.html">20）负载均衡器</a></li><li><a href="connectors.html">21）连接器</a></li><li><a href="monitoring.html">22）监控与管理</a></li><li><a href="logging.html">23）记录</a></li><li><a href="apr.html">24）APR /本地</a></li><li><a href="virtual-hosting-howto.html">25）虚拟主机</a></li><li><a href="aio.html">26）高级IO</a></li><li><a href="extras.html">27）附加组件</a></li><li><a href="maven-jars.html">28）行刑</a></li><li><a href="security-howto.html">29）安全注意事项</a></li><li><a href="windows-service-howto.html">30）Windows服务</a></li><li><a href="windows-auth-howto.html">31）Windows身份验证</a></li><li><a href="jdbc-pool.html">32）Tomcat的JDBC池</a></li><li><a href="web-socket-howto.html">33）WebSocket</a></li><li><a href="rewrite.html">34）改写</a></li></ul></div><div><h2>参考</h2><ul><li><a href="RELEASE-NOTES.txt">发行说明</a></li><li><a href="config/index.html">组态</a></li><li><a href="api/index.html">Tomcat Java文档</a></li><li><a href="servletapi/index.html">Servlet Java文档</a></li><li><a href="jspapi/index.html">JSP 2.3 Java文档</a></li><li><a href="elapi/index.html">EL 3.0 Java文档</a></li><li><a href="websocketapi/index.html">WebSocket 1.1 Java文档</a></li><li><a href="https://tomcat.apache.org/connectors-doc/">JK 1.2文档</a></li></ul></div><div><h2>Apache Tomcat开发</h2><ul><li><a href="building.html">建造</a></li><li><a href="changelog.html">变更日志</a></li><li><a href="https://wiki.apache.org/tomcat/TomcatVersions">状态</a></li><li><a href="developers.html">开发者</a></li><li><a href="architecture/index.html">建筑</a></li><li><a href="funcspecs/index.html">功能规格。</a></li><li><a href="tribes/introduction.html">部族</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>Jasper 2 JSP Engine如何</h2><h3 id="Table_of_Contents">目录</h3><div class="text">
<ul><li><a href="#Introduction">介绍</a></li><li><a href="#Configuration">组态</a></li><li><a href="#Known_issues">已知的问题</a></li><li><a href="#Production_Configuration">生产配置</a></li><li><a href="#Web_Application_Compilation">Web应用程序编译</a></li><li><a href="#Optimisation">优化</a></li></ul>
</div><h3 id="Introduction">介绍</h3><div class="text">

<p>Tomcat 9.0使用Jasper 2 JSP Engine来实现<a href="https://wiki.apache.org/tomcat/Specifications">JavaServer Pages 2.3</a>规范。</p>

<p>Jasper 2已经过重新设计，以显着提高原始Jasper的性能。除了对常规代码进行了改进之外，还进行了以下更改：</p>
<ul>
<li><strong>JSP自定义标签池</strong> -为JSP自定义标签实例化的Java对象现在可以被池化并重新使用。这极大地提高了使用自定义标记的JSP页面的性能。</li>
<li><strong>后台JSP编译</strong> -如果对已经编译过的JSP页面进行更改，Jasper 2可以在后台重新编译该页面。先前编译的JSP页面仍可用于处理请求。成功编译新页面后，它将替换旧页面。这有助于提高生产服务器上JSP页面的可用性。</li>
<li><strong>当包含的页面发生更改时重新编译JSP</strong> -Jasper 2现在可以检测到在编译时包含在JSP中的页面何时发生了更改，然后重新编译父JSP。</li>
<li><strong>用于编译JSP页面</strong>的JDT-Eclipse JDT Java编译器现在用于执行JSP Java源代码编译。该编译器从容器类加载器加载源依赖项。仍然可以使用Ant和javac。</li>
</ul>


<p>Jasper是使用servlet类实现的<code>org.apache.jasper.servlet.JspServlet</code> 。</p>

</div><h3 id="Configuration">组态</h3><div class="text">

<p>默认情况下，Jasper配置为在进行Web应用程序开发时使用。有关配置Jasper以在生产Tomcat服务器上使用的信息，请参见<a href="#Production_Configuration">生产配置</a>部分。</p>

<p>实现Jasper的servlet是使用您全局变量中的init参数配置的<code>$CATALINA_BASE/conf/web.xml</code> 。
</p>
<ul>
<li><strong>checkInterval-</strong>如果开发错误，并且checkInterval大于零，则启用后台编译。 checkInterval是两次检查是否需要重新编译JSP页面（及其相关文件）之间的时间（以秒为单位）。默认<code>0</code>秒。</li>

<li><strong>classdebuginfo-</strong>应该用调试信息编译类文件吗？ <code>true</code> 要么<code>false</code> ，默认<code>true</code> 。
</li>

<li><strong>classpath-</strong>定义用于编译生成的servlet的类路径。仅当ServletContext属性org.apache.jasper时此参数才有效。常数。未设置SERVLET_CLASSPATH。在Tomcat中使用Jasper时，始终设置此属性。默认情况下，类路径是基于当前Web应用程序动态创建的。</li>

<li><strong>编译</strong>器-Ant应该使用哪个编译器来编译JSP页面。有效值与Ant的<a href="https://ant.apache.org/manual/Tasks/javac.html#compilervalues">javac</a>任务的编译器属性相同。如果未设置该值，那么将使用默认的Eclipse JDT Java编译器，而不是使用Ant。没有默认值。如果设置了此属性，则<code>setenv.[sh|bat]</code>应该用来添加<code>ant.jar</code> ， <code>ant-launcher.jar</code>和<code>tools.jar</code>到<code>CLASSPATH</code>环境变量。</li>

<li><strong>compilerSourceVM</strong> -什么JDK版本是源文件兼容？（默认值： <code>1.8</code> ）</li>

<li><strong>compilerTargetVM</strong> -什么JDK版本是生成的文件兼容？（默认值： <code>1.8</code> ）</li>

<li><strong>开发</strong> -Jasper是否在开发模式下使用？如果为true，则可以通过ModifyTestInterval参数指定检查JSP修改的频率。 <code>true</code>要么<code>false</code> ，默认<code>true</code> 。</li>

<li><strong>displaySourceFragment-</strong>异常消息中应包含源片段吗？ <code>true</code> 要么<code>false</code> ，默认<code>true</code> 。</li>

<li><strong>dumpSmap-</strong>是否应将用于JSR45调试的SMAP信息转储到文件中？ <code>true</code> 要么<code>false</code> ，默认<code>false</code> 。 <code>false</code>如果preventSmap为true。</li>

<li><strong>enablePooling-</strong>确定是否启用标记处理程序池。这是一个编译选项。它不会改变已经编译的JSP的行为。 <code>true</code>要么<code>false</code> ，默认<code>true</code> 。
</li>

<li><strong>engineOptionsClass-</strong>允许指定用于配置Jasper的Options类。如果不存在，将使用默认的EmbeddedServletOptions。如果在SecurityManager下运行，则忽略此选项。
</li>

<li><strong>errorOnUseBeanInvalidClassAttribute-</strong>当useBean操作中的类属性的值不是有效的bean类时，Jasper是否应发出错误？ <code>true</code> 要么<code>false</code> ，默认<code>true</code> 。</li>

<li><strong>fork-</strong>是否已编译Ant fork JSP页面，以便在与Tomcat分开的JVM中执行它们？ <code>true</code> 要么<code>false</code> ，默认<code>true</code> 。</li>

<li><strong>genStringAsCharArray-</strong>是否应将文本字符串生成为char数组，以在某些情况下提高性能？默认<code>false</code> 。</li>

<li><strong>ieClassId-</strong>使用<jsp:plugin>标签时要发送到Internet Explorer的class-id值<jsp:plugin>。默认<code>clsid:8AD9C840-044E-11D1-B3E9-00805F499D93</code> 。</jsp:plugin></jsp:plugin></li>

<li><strong>javaEncoding-</strong>用于生成Java源文件的Java文件编码。默认<code>UTF8</code> 。</li>

<li><strong>keepgeneration-</strong>我们应该保留每个页面生成的Java源代码，而不是删除它吗？ <code>true</code> 要么<code>false</code> ，默认<code>true</code> 。</li>

<li><strong>映射文件</strong> -我们是否应该在每行输入一条打印语句的情况下生成静态内容，以简化调试工作？
<code>true</code>要么<code>false</code> ，默认<code>true</code> 。</li>

<li><strong>maxLoadedJsps-</strong>将为Web应用程序加载的JSP的最大数量。如果加载的JSP数量超过此数量，则将卸载最近最少使用的JSP，以便在任何一次加载的JSP数量均不超过此限制。零或更少的值表示没有限制。默认<code>-1</code></li>

<li><strong>jspIdleTimeout</strong> -JSP在被卸载之前可以空闲的时间（以秒为单位）。零或更少的值表示永不卸载。默认<code>-1</code></li>

<li><strong>modifyTestInterval-</strong>导致自上次检查JSP的修改以来的指定时间间隔（以秒为单位），不检查JSP（及其相关文件）的修改。值为0将导致在每次访问时都要检查JSP。仅在开发模式下使用。默认为<code>4</code>秒。</li>

<li><strong>recompileOnFail-</strong>如果JSP编译失败，是否应该忽略modificationTestInterval，并且下次访问会触发重新编译尝试？仅在开发模式下使用，并且默认情况下被禁用，因为编译可能很昂贵，并且可能导致过多的资源使用。</li>

<li><strong>scratchdir-</strong>编译JSP页面时应该使用哪个草稿目录？默认值为当前Web应用程序的工作目录。如果在SecurityManager下运行，则忽略此选项。</li>

<li><strong>suppressSmap</strong> -应该为JSR45调试SMAP信息的生成被抑制？ <code>true</code> 要么<code>false</code> ，默认<code>false</code> 。</li>

<li><strong>trimSpaces-应从</strong>输出中删除完全由空格组成的模板文本（ <code>true</code> ），用单个空格（ <code>single</code> ）或保持不变（ <code>false</code> ）？请注意，如果JSP页面或标记文件指定了<code>trimDirectiveWhitespaces</code>的价值<code>true</code> ，它将优先于该页面/标签的此配置设置。默认<code>false</code> 。</li>

<li><strong>xpoweredBy-</strong>确定是否由生成的Servlet添加X-Powered-By响应标头。 <code>true</code>要么<code>false</code> ，默认<code>false</code> 。</li>

<li><strong>strictQuoteEscaping-</strong>将scriptlet表达式用于属性值时，是否应严格应用JSP.1.6中用于将引号字符转义的规则？ <code>true</code> 要么<code>false</code> ，默认<code>true</code> 。</li>

<li><strong>quoteAttributeEL-</strong>当在JSP页面的属性值中使用EL时，是否应将JSP.1.6中描述的属性引用规则应用于表达式？ <code>true</code> 要么<code>false</code> ，默认<code>true</code> 。</li>
</ul>

<p>Eclipse JDT中的Java编译器作为默认编译器包含在内。它是一个高级Java编译器，它将从Tomcat类加载器加载所有依赖项，在带有数十个JAR的大型安装中进行编译时，这将极大地帮助您。在快速服务器上，这将允许亚秒级的重新编译周期，即使是大型JSP页面也是如此。</p>

<p>通过如上所述配置编译器属性，可以在以前的Tomcat版本中使用Apache Ant代替新的编译器。
</p>

<p>如果您需要更改应用程序的JSP Servlet设置，则可以通过在以下位置重新定义JSP Servlet来覆盖默认配置。 <code>/WEB-INF/web.xml</code> 。但是，如果您尝试将应用程序部署到另一个容器上，则可能会引起问题，因为JSP Servlet类可能无法识别。您可以通过使用特定于Tomcat的方法来解决此问题<code>/WEB-INF/tomcat-web.xml</code>部署描述符。格式与<code>/WEB-INF/web.xml</code> 。它将覆盖所有默认设置，但不会覆盖其中的那些默认设置<code>/WEB-INF/web.xml</code> 。由于它是特定于Tomcat的，因此只有在将应用程序部署在Tomcat上时才进行处理。</p>

</div><h3 id="Known_issues">已知的问题</h3><div class="text">

<p>如<a href="https://bz.apache.org/bugzilla/show_bug.cgi?id=39089">错误39089中所述</a> ，已知的JVM问题（ <a href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6294277">错误6294277</a> ）可能会导致<code>java.lang.InternalError: name is too long to represent</code>编译非常大的JSP时发生异常。如果观察到这种情况，则可以使用以下方法之一解决该问题：</p>
<ul>
<li>减小JSP的大小</li>
<li>通过设置禁用SMAP生成和JSR-045支持<code>suppressSmap</code>至<code>true</code> 。</li>
</ul>

</div><h3 id="Production_Configuration">生产配置</h3><div class="text">

<p>可以完成的主要JSP优化是JSP的预编译。但是，这可能是不可能的（例如，当使用jsp-property-group功能时）或不实用，在这种情况下，Jasper servlet的配置变得至关重要。</p>

<p>在生产Tomcat服务器中使用Jasper 2时，应考虑对默认配置进行以下更改。</p>
<ul>
<li><strong>开发</strong> -要禁用对JSP页面编译的访问检查，请将其设置为<code>false</code> 。</li>
<li><strong>genStringAsCharArray-</strong>要生成效率更高的char数组，请将其设置为<code>true</code> 。</li>
<li><strong>modifyTestInterval-</strong>如果必须将开发设置为<code>true</code>出于任何原因（例如动态生成JSP），将此值设置为较高的值都将大大提高性能。</li>
<li><strong>trimSpaces-</strong>要从响应中删除无用的字节，请将其设置为<code>true</code> 。</li>
</ul>

</div><h3 id="Web_Application_Compilation">Web应用程序编译</h3><div class="text">

<p>使用Ant是使用JSPC编译Web应用程序的首选方法。请注意，当预编译JSP时，仅当preventSmap为false且compile为true时，SMAP信息才包含在最终类中。使用下面给出的脚本（“部署程序”下载中包含类似的脚本）来预编译Webapp：</p>

<div class="codeBox"><pre><code>&lt;project name="Webapp Precompilation" default="all" basedir="."&gt;

   &lt;import file="${tomcat.home}/bin/catalina-tasks.xml"/&gt;

   &lt;target name="jspc"&gt;

    &lt;jasper
             validateXml="false"
             uriroot="${webapp.path}"
             webXmlInclude="${webapp.path}/WEB-INF/generated_web.xml"
             outputDir="${webapp.path}/WEB-INF/src" /&gt;

  &lt;/target&gt;

  &lt;target name="compile"&gt;

    &lt;mkdir dir="${webapp.path}/WEB-INF/classes"/&gt;
    &lt;mkdir dir="${webapp.path}/WEB-INF/lib"/&gt;

    &lt;javac destdir="${webapp.path}/WEB-INF/classes"
           debug="on" failonerror="false"
           srcdir="${webapp.path}/WEB-INF/src"
           excludes="**/*.smap"&gt;
      &lt;classpath&gt;
        &lt;pathelement location="${webapp.path}/WEB-INF/classes"/&gt;
        &lt;fileset dir="${webapp.path}/WEB-INF/lib"&gt;
          &lt;include name="*.jar"/&gt;
        &lt;/fileset&gt;
        &lt;pathelement location="${tomcat.home}/lib"/&gt;
        &lt;fileset dir="${tomcat.home}/lib"&gt;
          &lt;include name="*.jar"/&gt;
        &lt;/fileset&gt;
        &lt;fileset dir="${tomcat.home}/bin"&gt;
          &lt;include name="*.jar"/&gt;
        &lt;/fileset&gt;
      &lt;/classpath&gt;
      &lt;include name="**" /&gt;
      &lt;exclude name="tags/**" /&gt;
    &lt;/javac&gt;

  &lt;/target&gt;

  &lt;target name="all" depends="jspc,compile"&gt;
  &lt;/target&gt;

  &lt;target name="cleanup"&gt;
    &lt;delete&gt;
        &lt;fileset dir="${webapp.path}/WEB-INF/src"/&gt;
        &lt;fileset dir="${webapp.path}/WEB-INF/classes/org/apache/jsp"/&gt;
    &lt;/delete&gt;
  &lt;/target&gt;

&lt;/project&gt;</code></pre></div>

<p>以下命令行可用于运行脚本（将令牌替换为Tomcat基本路径和应预编译的webapp路径）：</p>
<div class="codeBox"><pre><code>$ANT_HOME/bin/ant -Dtomcat.home=&lt;$TOMCAT_HOME&gt; -Dwebapp.path=&lt;$WEBAPP_PATH&gt;</code></pre></div>


<p>然后，必须将预编译期间生成的Servlet的声明和映射添加到Web应用程序部署描述符中。插入<code>${webapp.path}/WEB-INF/generated_web.xml</code>在正确的位置<code>${webapp.path}/WEB-INF/web.xml</code>文件。重新启动Web应用程序（使用管理器）并对其进行测试，以验证其是否可以在预编译的Servlet正常运行。放置在Web应用程序部署描述符中的适当令牌也可以用于使用Ant过滤功能自动插入生成的Servlet声明和映射。实际上，这就是在构建过程中如何自动编译与Tomcat一起分发的所有Web应用程序的方式。
</p>

<p>在碧玉任务中，您可以使用<code>addWebXmlMappings</code>用于自动合并<code>${webapp.path}/WEB-INF/generated_web.xml</code>使用当前的Web应用程序部署描述符<code>${webapp.path}/WEB-INF/web.xml</code> 。如果要在JSP中使用Java 6功能，请添加以下javac编译器任务属性： <code>source="1.6" target="1.6"</code> 。对于实时应用程序，您还可以使用以下命令禁用调试信息<code>debug="off"</code> 。
</p>

<p>当您不想在第一次JSP语法错误时停止JSP生成时，请使用<code>failOnError="false"</code>与<code>showSuccess="true"</code>所有成功的<i>JSP到Java的</i>生成都已打印出来。有时在清理生成的Java源文件时非常有帮助<code>${webapp.path}/WEB-INF/src</code>以及在以下位置编译JSP servlet类<code>${webapp.path}/WEB-INF/classes/org/apache/jsp</code> 。
</p>

<p><strong>提示：</strong></p>
<ul>
<li>当您切换到另一个Tomcat版本时，请使用新的Tomcat版本重新生成并重新编译您的JSP。</li>
<li>在服务器运行时使用Java系统属性来禁用PageContext池<code>org.apache.jasper.runtime.JspFactoryImpl.USE_POOL=false</code> 。并限制缓冲<code>org.apache.jasper.runtime.BodyContentImpl.LIMIT_BUFFER=true</code> 。请注意，更改默认设置可能会影响性能，但具体取决于应用程序。</li>
</ul>
</div><h3 id="Optimisation">优化</h3><div class="text">
<p>Jasper中提供了许多扩展点，这些扩展点使用户可以优化其环境的行为。
</p>

<p>这些扩展点中的第一个是标签插件机制。这允许将标记处理程序的替代实现提供给Web应用程序使用。标签插件通过<code>tagPlugins.xml</code>文件位于<code>WEB-INF</code> 。Jasper随附了JSTL的示例插件。
</p>

<p>第二个扩展点是表达式语言解释器。可以通过以下方式配置其他解释器<code>ServletContext</code> 。见<code>ELInterpreterFactory</code>有关如何配置备用EL解释器的详细信息，请参见javadoc。
</p>
</div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="./comments.html">这里</a>解释<a href="./comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>