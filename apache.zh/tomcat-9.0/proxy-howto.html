<html lang="zh-Hans" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="./images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9（9.0.21）-代理支持方法</title><meta name="author" content="Craig R. McClanahan"><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/proxy-howto">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script></head><body ><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="./images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="./images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>Apache Tomcat 9</h1><div class="versionInfo">版本9.0.21， <time datetime="2019-06-04"> 2019年6月4日</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>链接</h2><ul><li><a href="index.html">文件首页</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">常问问题</a></li><li><a href="#comments_section">用户评论</a></li></ul></div><div><h2>用户指南</h2><ul><li><a href="introduction.html">1）简介</a></li><li><a href="setup.html">2）设定</a></li><li><a href="appdev/index.html">3）第一个webapp</a></li><li><a href="deployer-howto.html">4）部署者</a></li><li><a href="manager-howto.html">5）经理</a></li><li><a href="host-manager-howto.html">6）主机管理员</a></li><li><a href="realm-howto.html">7）领域和AAA</a></li><li><a href="security-manager-howto.html">8）安全经理</a></li><li><a href="jndi-resources-howto.html">9）JNDI资源</a></li><li><a href="jndi-datasource-examples-howto.html">10）JDBC数据源</a></li><li><a href="class-loader-howto.html">11）类加载</a></li><li><a href="jasper-howto.html">12）JSP</a></li><li><a href="ssl-howto.html">13）SSL / TLS</a></li><li><a href="ssi-howto.html">14）SSI</a></li><li><a href="cgi-howto.html">15）CGI</a></li><li><a href="proxy-howto.html">16）代理支持</a></li><li><a href="mbeans-descriptors-howto.html">17）MBean描述符</a></li><li><a href="default-servlet.html">18）默认Servlet</a></li><li><a href="cluster-howto.html">19）聚类</a></li><li><a href="balancer-howto.html">20）负载均衡器</a></li><li><a href="connectors.html">21）连接器</a></li><li><a href="monitoring.html">22）监控与管理</a></li><li><a href="logging.html">23）记录</a></li><li><a href="apr.html">24）APR /本地</a></li><li><a href="virtual-hosting-howto.html">25）虚拟主机</a></li><li><a href="aio.html">26）高级IO</a></li><li><a href="extras.html">27）附加组件</a></li><li><a href="maven-jars.html">28）行刑</a></li><li><a href="security-howto.html">29）安全注意事项</a></li><li><a href="windows-service-howto.html">30）Windows服务</a></li><li><a href="windows-auth-howto.html">31）Windows身份验证</a></li><li><a href="jdbc-pool.html">32）Tomcat的JDBC池</a></li><li><a href="web-socket-howto.html">33）WebSocket</a></li><li><a href="rewrite.html">34）改写</a></li></ul></div><div><h2>参考</h2><ul><li><a href="RELEASE-NOTES.txt">发行说明</a></li><li><a href="config/index.html">组态</a></li><li><a href="api/index.html">Tomcat Java文档</a></li><li><a href="servletapi/index.html">Servlet Java文档</a></li><li><a href="jspapi/index.html">JSP 2.3 Java文档</a></li><li><a href="elapi/index.html">EL 3.0 Java文档</a></li><li><a href="websocketapi/index.html">WebSocket 1.1 Java文档</a></li><li><a href="https://tomcat.apache.org/connectors-doc/">JK 1.2文档</a></li></ul></div><div><h2>Apache Tomcat开发</h2><ul><li><a href="building.html">建造</a></li><li><a href="changelog.html">变更日志</a></li><li><a href="https://wiki.apache.org/tomcat/TomcatVersions">状态</a></li><li><a href="developers.html">开发者</a></li><li><a href="architecture/index.html">建筑</a></li><li><a href="funcspecs/index.html">功能规格。</a></li><li><a href="tribes/introduction.html">部族</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>代理支持方法</h2><h3 id="Table_of_Contents">目录</h3><div class="text">
<ul><li><a href="#Introduction">介绍</a></li><li><a href="#Apache_httpd_Proxy_Support">Apache httpd代理支持</a></li></ul>
</div><h3 id="Introduction">介绍</h3><div class="text">

<p>使用Tomcat的标准配置，Web应用程序可以要求将请求定向到的服务器名称和端口号进行处理。当Tomcat通过<a href="config/http.html">HTTP / 1.1连接器</a>独立运行时，通常会报告请求中指定的服务器名称以及<strong>连接器</strong>正在侦听的端口号。为此，感兴趣的Servlet API调用是：</p>
<ul>
<li><code>ServletRequest.getServerName()</code> ：返回请求发送到的服务器的主机名。</li>
<li><code>ServletRequest.getServerPort()</code> ：返回请求发送到的服务器的端口号。</li>
<li><code>ServletRequest.getLocalName()</code> ：返回在其上接收到请求的Internet协议（IP）接口的主机名。</li>
<li><code>ServletRequest.getLocalPort()</code> ：返回接收请求的接口的Internet协议（IP）端口号。</li>
</ul>

<p>当您在代理服务器（或配置为行为类似于代理服务器的Web服务器）后面运行时，有时您会更喜欢管理这些调用返回的值。特别是，您通常希望端口号反映原始请求中指定的端口号，而不是<strong>连接器</strong>本身正在侦听的端口号。您可以使用<code>proxyName</code>和<code>proxyPort</code>上的属性<code><Connector></code>元素以配置这些值。</p>

<p>代理支持可以采取多种形式。以下各节描述了几种常见情况的代理配置。</p>

</div><h3 id="Apache_httpd_Proxy_Support">Apache httpd代理支持</h3><div class="text">

<p>Apache httpd 1.3和更高版本支持可选模块（ <code>mod_proxy</code> ），将网络服务器配置为充当代理服务器。这可用于将对特定Web应用程序的请求转发到Tomcat实例，而无需配置Web连接器，例如<code>mod_jk</code> 。为此，您需要执行以下任务：</p>
<ol>
<li><p>配置您的Apache副本，使其包括<code>mod_proxy</code>模块。如果您是从源代码构建的，则最简单的方法是将<code>--enable-module=proxy</code>关于的指令<code>./configure</code>命令行。</p></li>
<li><p>如果尚未为您添加，请确保您正在加载<code>mod_proxy</code>通过在您的Apache中使用以下指令，在Apache启动时添加模块<code>httpd.conf</code>文件：</p>
<div class="codeBox"><pre><code>LoadModule proxy_module  {path-to-modules}/mod_proxy.so
</code></pre></div></li>
<li><p>在您的指令中包含两个指令<code>httpd.conf</code>您希望转发到Tomcat的每个Web应用程序的文件。例如，在上下文路径下转发应用程序<code>/myapp</code> ：</p>
<div class="codeBox"><pre><code>ProxyPass         /myapp  http://localhost:8081/myapp
ProxyPassReverse  /myapp  http://localhost:8081/myapp</code></pre></div>
    <p>告诉Apache转发形式的URL <code>http://localhost/myapp/*</code>侦听端口8081上的Tomcat连接器。</p></li>
<li><p>配置您的Tomcat副本以包括特殊的<code><Connector></code>元素，并带有适当的代理设置，例如：</p>
<div class="codeBox"><pre><code>&lt;Connector port="8081" ...
              proxyName="www.mycompany.com"
              proxyPort="80"/&gt;</code></pre></div>
    <p>这将导致该Web应用程序中的servlet认为所有代理请求都已定向到<code>www.mycompany.com</code>在端口80上。</p></li>
<li><p>省略<code>proxyName</code>来自的属性<code><Connector></code>元件。如果这样做，则返回的值<code>request.getServerName()</code>将按运行Tomcat的主机名。在上面的示例中， <code>localhost</code> 。</p></li>
<li><p>如果您还有<code><Connector></code>通过侦听端口8080（位于同一<a href="config/service.html">Service</a>元素中），对任一端口的请求将共享同一组虚拟主机和Web应用程序。</p></li>
<li><p>您可能希望使用操作系统的IP筛选功能来限制到端口8081的连接（在此示例中） <strong>仅</strong>允许运行Apache的服务器允许。</p></li>
<li><p>或者，您可以设置一系列只能通过代理使用的Web应用程序，如下所示：</p>
    <ul>
    <li>配置另一个<code><Service></code>只包含一个<code><Connector></code>用于代理端口。</li>
    <li>为可通过代理访问的虚拟主机和Web应用程序配置适当的<a href="config/engine.html">Engine</a> ， <a href="config/host.html">Host</a>和<a href="config/context.html">Context</a>元素。</li>
    <li>（可选）使用IP过滤器保护端口8081，如前所述。</li>
    </ul></li>
<li><p>当请求由Apache代理时，Web服务器会将这些请求记录在其访问日志中。因此，通常将需要禁用Tomcat本身执行的所有访问日志记录。</p></li>
</ol>

<p>当以这种方式代理请求时，Tomcat将处理对已配置Web应用程序的<strong>所有</strong>请求（包括对静态内容的请求）。您可以使用<code>mod_jk</code> Web连接器而不是<code>mod_proxy</code> 。
<code>mod_jk</code>可以配置为使Web服务器提供静态内容，而该静态内容未被Web应用程序的部署描述符中定义的过滤器或安全性约束处理（ <code>/WEB-INF/web.xml</code> ）。</p>

</div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="./comments.html">这里</a>解释<a href="./comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>