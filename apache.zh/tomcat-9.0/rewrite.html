<html lang="zh-Hans" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="./images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9（9.0.21）-重写Valve</title><meta name="author" content="Remy Maucherat"><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/rewrite">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script></head><body ><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="./images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="./images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>Apache Tomcat 9</h1><div class="versionInfo">版本9.0.21， <time datetime="2019-06-04"> 2019年6月4日</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>链接</h2><ul><li><a href="index.html">文件首页</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">常问问题</a></li><li><a href="#comments_section">用户评论</a></li></ul></div><div><h2>用户指南</h2><ul><li><a href="introduction.html">1）简介</a></li><li><a href="setup.html">2）设定</a></li><li><a href="appdev/index.html">3）第一个webapp</a></li><li><a href="deployer-howto.html">4）部署者</a></li><li><a href="manager-howto.html">5）经理</a></li><li><a href="host-manager-howto.html">6）主机管理员</a></li><li><a href="realm-howto.html">7）领域和AAA</a></li><li><a href="security-manager-howto.html">8）安全经理</a></li><li><a href="jndi-resources-howto.html">9）JNDI资源</a></li><li><a href="jndi-datasource-examples-howto.html">10）JDBC数据源</a></li><li><a href="class-loader-howto.html">11）类加载</a></li><li><a href="jasper-howto.html">12）JSP</a></li><li><a href="ssl-howto.html">13）SSL / TLS</a></li><li><a href="ssi-howto.html">14）SSI</a></li><li><a href="cgi-howto.html">15）CGI</a></li><li><a href="proxy-howto.html">16）代理支持</a></li><li><a href="mbeans-descriptors-howto.html">17）MBean描述符</a></li><li><a href="default-servlet.html">18）默认Servlet</a></li><li><a href="cluster-howto.html">19）聚类</a></li><li><a href="balancer-howto.html">20）负载均衡器</a></li><li><a href="connectors.html">21）连接器</a></li><li><a href="monitoring.html">22）监控与管理</a></li><li><a href="logging.html">23）记录</a></li><li><a href="apr.html">24）APR /本地</a></li><li><a href="virtual-hosting-howto.html">25）虚拟主机</a></li><li><a href="aio.html">26）高级IO</a></li><li><a href="extras.html">27）附加组件</a></li><li><a href="maven-jars.html">28）行刑</a></li><li><a href="security-howto.html">29）安全注意事项</a></li><li><a href="windows-service-howto.html">30）Windows服务</a></li><li><a href="windows-auth-howto.html">31）Windows身份验证</a></li><li><a href="jdbc-pool.html">32）Tomcat的JDBC池</a></li><li><a href="web-socket-howto.html">33）WebSocket</a></li><li><a href="rewrite.html">34）改写</a></li></ul></div><div><h2>参考</h2><ul><li><a href="RELEASE-NOTES.txt">发行说明</a></li><li><a href="config/index.html">组态</a></li><li><a href="api/index.html">Tomcat Java文档</a></li><li><a href="servletapi/index.html">Servlet Java文档</a></li><li><a href="jspapi/index.html">JSP 2.3 Java文档</a></li><li><a href="elapi/index.html">EL 3.0 Java文档</a></li><li><a href="websocketapi/index.html">WebSocket 1.1 Java文档</a></li><li><a href="https://tomcat.apache.org/connectors-doc/">JK 1.2文档</a></li></ul></div><div><h2>Apache Tomcat开发</h2><ul><li><a href="building.html">建造</a></li><li><a href="changelog.html">变更日志</a></li><li><a href="https://wiki.apache.org/tomcat/TomcatVersions">状态</a></li><li><a href="developers.html">开发者</a></li><li><a href="architecture/index.html">建筑</a></li><li><a href="funcspecs/index.html">功能规格。</a></li><li><a href="tribes/introduction.html">部族</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>改写阀</h2><h3 id="Introduction">介绍</h3><div class="text">

  <p>重写阀以与Apache HTTP Server中的mod_rewrite非常相似的方式实现URL重写功能。</p>

</div><h3 id="Configuration">组态</h3><div class="text">

  <p>改写阀通过使用<code>org.apache.catalina.valves.rewrite.RewriteValve</code>班级名称。</p>

  <p>重写阀可以配置为主机中添加的阀。有关如何配置<a href="config/host.html">虚拟服务器</a>的信息，请参见<a href="config/host.html">虚拟服务器</a>文档。它将使用<code>rewrite.config</code>包含重写指令的文件，必须将其放置在主机配置文件夹中。
  </p>

  <p>它也可以位于webapp的context.xml中。然后，阀门将使用<code>rewrite.config</code>包含重写指令的文件，必须将其放置在Web应用程序的WEB-INF文件夹中</p>

</div><h3 id="Directives">指令</h3><div class="text">

  <p>rewrite.config文件包含一系列指令，这些指令与mod_rewrite使用的指令非常相似，尤其是中央的RewriteRule和RewriteCond指令。以a开头的行<code>#</code>字符被视为注释，将被忽略。</p>

  <p>注意：本部分是mod_rewrite文档的修改版本，该文档的版权为1995-2006 The Apache Software Foundation版权所有，并根据Apache License 2.0版获得许可。</p>

  <div class="subsection"><h4 id="RewriteCond">RewriteCond</h4><div class="text">

    <p>句法：<code>RewriteCond TestString CondPattern</code></p>

    <p>RewriteCond指令定义规则条件。一个或多个RewriteCond可以位于RewriteRule指令之前。然后，仅当URI的当前状态都与它的模式匹配并且满足这些条件时，才使用以下规则。</p>

      <p><em>TestString</em>是一个字符串，除了纯文本之外， <em>它还</em>可以包含以下扩展结构：</p>

      <ul>
        <li>
          <strong>RewriteRule反向引用</strong> ：这些是表单的反向引用<strong><code>$N</code></strong> （0 <= N <= 9），可从以下位置访问图案的分组部分（括号中） <code>RewriteRule</code>这取决于当前的<code>RewriteCond</code>条件..
        </li>
        <li>
          <strong>RewriteCond反向引用</strong> ：这些是表单的反向引用<strong><code>%N</code></strong> （1 <= N <= 9），从最后一个匹配项开始访问模式的分组部分（再次用括号括起来） <code>RewriteCond</code>在当前条件下。
        </li>
        <li>
          <strong>RewriteMap扩展</strong> ：这些是表单的扩展<strong><code>${mapname:key|default}</code></strong> 。有关更多详细信息，请参见<a href="#mapfunc">RewriteMap文档</a> 。
        </li>
        <li>
          <strong>服务器变量</strong> ：这些是形式的变量<strong><code>%{</code> <em>NAME_OF_VARIABLE</em> <code>}</code></strong>其中<em>NAME_OF_VARIABLE</em>可以是以下列表中的字符串：<ul>
          <li>
          <p><b>HTTP标头：</b></p>
          <p>HTTP_USER_AGENT<br>HTTP_REFERER<br>HTTP_COOKIE<br>HTTP_FORWARDED<br>HTTP_HOST<br>HTTP_PROXY_CONNECTION<br>HTTP_ACCEPT<br>
          </p>
          </li>
          <li>
          <p><b>连接和请求：</b></p>
          <p>REMOTE_ADDR<br>远程主机<br>REMOTE_PORT<br>REMOTE_USER<br>REMOTE_IDENT<br>REQUEST_METHOD<br>SCRIPT_FILENAME<br>REQUEST_PATH<br>CONTEXT_PATH<br>SERVLET_PATH<br>PATH_INFO<br>请求参数<br>AUTH_TYPE<br>
          </p>
          </li>
          <li>
          <p><b>服务器内部：</b></p>
          <p>DOCUMENT_ROOT<br>服务器名称<br>SERVER_ADDR<br>服务器端口<br>SERVER_PROTOCOL<br>SERVER_SOFTWARE<br>
          </p>
          </li>
          <li>
          <p><b>日期和时间：</b></p>
          <p>TIME_YEAR<br>TIME_MON<br>TIME_DAY<br>TIME_HOUR<br>TIME_MIN<br>TIME_SEC<br>TIME_WDAY<br>时间<br>
          </p>
          </li>
          <li>
          <p><b>特价：</b></p>
          <p>THE_REQUEST<br>REQUEST_URI<br>REQUEST_FILENAME<br>HTTPS<br>
          </p>
          </li>
          </ul>

                <p>这些变量都对应于类似命名的HTTP MIME标头和Servlet API方法。大部分记录在手册或CGI规范的其他地方。重写阀专用的那些包括以下内容。</p>

                <dl>

                  <dt><code>REQUEST_PATH</code></dt>

                  <dd>对应于用于映射的完整路径。</dd>

                  <dt><code>CONTEXT_PATH</code></dt>

                  <dd>对应于映射上下文的路径。</dd>

                  <dt><code>SERVLET_PATH</code></dt>

                  <dd>对应于servlet路径。</dd>

                  <dt><code>THE_REQUEST</code></dt>

                  <dd>浏览器发送到服务器的完整HTTP请求行（例如，“ <code>GET /index.html HTTP/1.1</code> ”）。这不包括浏览器发送的任何其他标头。</dd>

                  <dt><code>REQUEST_URI</code></dt>

                  <dd>HTTP请求行中请求的资源。（在上面的示例中，该名称为“ /index.html”。）</dd>

                  <dt><code>REQUEST_FILENAME</code></dt>

                  <dd>匹配请求的文件或脚本的完整本地文件系统路径。</dd>

                  <dt><code>HTTPS</code></dt>

                  <dd>如果连接使用的是SSL / TLS，则将包含文本“ on”，否则将包含“ off”。</dd>

                </dl>

        </li>
      </ul>

      <p>您应该注意的其他事项：</p>

      <ol>
        <li>变量SCRIPT_FILENAME和REQUEST_FILENAME包含相同的值- <code>filename</code>内部领域<code>request_rec</code> Apache服务器的结构。第一个名称是众所周知的CGI变量名称，第二个名称是REQUEST_URI的对应名称（其中包含<code>uri</code>现场<code>request_rec</code> ）。</li>

        <li>
        <code>%{ENV:variable}</code> ，其中<em>variable</em>可以是任何Java系统属性，也可以使用。</li>

        <li>
        <code>%{SSL:variable}</code> ，其中<em>variable</em>是SSL环境变量的名称，尚未实现。例： <code>%{SSL:SSL_CIPHER_USEKEYSIZE}</code>可能扩大到<code>128</code> 。</li>

        <li>
        <code>%{HTTP:header}</code> （ <em>标头</em>可以是任何HTTP MIME-标头名称），始终可以用来获取HTTP请求中发送的标头的值。例： <code>%{HTTP:Proxy-Connection}</code>是HTTP标头的值`` <code>Proxy-Connection:</code> ”。</li>

      </ol>

      <p><em>CondPattern</em>是条件模式，它是一个正则表达式，适用于<em>TestString</em>的当前实例。
      首先对<em>TestString</em>进行评估，然后再与<em>CondPattern</em>进行匹配。</p>

      <p><strong>请记住：</strong> <em>CondPattern</em>是与<em>Perl兼容的正则表达式</em> ，其中包含一些附加内容：</p>

      <ol>
        <li>您可以在模式字符串前添加' <code>!</code> '字符（感叹号）以指定<strong>不</strong>匹配的模式。</li>

        <li><em>CondPatterns</em>有一些特殊的变体。除了真正的正则表达式字符串，您还可以使用以下之一：<ul>
            <li>' <strong><condpattern>< /strong="">'（按字典顺序在前）<br>将<em>CondPattern</em>视为纯字符串，并按字典顺序将其与<em>TestString</em>进行比较。如果<em>TestString在</em>字典上位于<em>CondPattern</em>之前，则为true。</condpattern><></strong></li>

            <li>' <strong>> CondPattern</strong> '（按字母顺序排列）<br>将<em>CondPattern</em>视为纯字符串，并按字典顺序将其与<em>TestString</em>进行比较。如果<em>TestString在</em>字典上遵循<em>CondPattern，</em>则为true。</li>

            <li>' <strong>= CondPattern</strong> '（在字典上相等）<br>将<em>CondPattern</em>视为纯字符串，并按字典顺序将其与<em>TestString</em>进行比较。如果<em>TestString</em>在字典上等于<em>CondPattern</em> （两个字符串完全相同，一个字符一个字符），则为true。如果<em>CondPattern</em>为<code>""</code> （两个引号），这会将<em>TestString</em>与空字符串进行比较。</li>

            <li>' <strong>-d</strong> '（是<strong>d</strong> ）<br>将<em>TestString</em>视为路径名，并测试它是否存在，并且是目录。</li>

            <li><strong>'-f'（</strong>是常规<strong>˚FILE）</strong><br>将<em>TestString</em>视为路径名，并测试它是否存在，并且是常规文件。</li>

            <li><strong>'-S'（</strong>是普通文件，其中<strong>s</strong> IZE）<br>将<em>TestString</em>视为路径名并测试它是否存在，并且是大小大于零的常规文件。</li>

          </ul>

<strong>注意：</strong>所有这些测试都可以在前面加上感叹号（'！'）否定其含义。

        </li>

        <li>您还可以通过附加为<em>CondPattern</em>设置特殊标志<strong><code>[</code> <em>标志</em> <code>]</code></strong>作为第三个论点<code>RewriteCond</code>指令，其中<em>flags</em>是以下任意<em>标志</em>的逗号分隔列表：<ul>
        <li>' <strong><code>nocase|NC</code></strong> <strong>'（N</strong> <strong>摄氏度</strong> ASE）<br>这使得测试用例不敏感-在扩展的<em>TestString</em>和<em>CondPattern中</em> ，“ AZ”和“ az”之间的差异都将被忽略。该标志仅对<em>TestString</em>和<em>CondPattern</em>之间的比较有效。它对文件系统和子请求检查没有影响。</li>

        <li>' <strong><code>ornext|OR</code></strong> '（ <strong>或</strong>下一个条件）<br>使用它可以将规则条件与局部OR（而不是隐式AND）组合。典型示例：<div class="codeBox"><pre><code>RewriteCond %{REMOTE_HOST}  ^host1.*  [OR]
RewriteCond %{REMOTE_HOST}  ^host2.*  [OR]
RewriteCond %{REMOTE_HOST}  ^host3.*
RewriteRule ...some special stuff for any of these hosts...</code></pre></div>没有此标志，您将必须写入条件/规则对三遍。
        </li>
      </ul>
      </li>
     </ol>

      <p><strong>例：</strong></p>

       <p>要根据`` <code>User-Agent:</code> ”请求的标头，您可以使用以下代码：</p>

<div class="codeBox"><pre><code>RewriteCond  %{HTTP_USER_AGENT}  ^Mozilla.*
RewriteRule  ^/$                 /homepage.max.html  [L]

RewriteCond  %{HTTP_USER_AGENT}  ^Lynx.*
RewriteRule  ^/$                 /homepage.min.html  [L]

RewriteRule  ^/$                 /homepage.std.html  [L]</code></pre></div>

        <p>说明：如果使用的浏览器将自己标识为“ Mozilla”（包括Netscape Navigator，Mozilla等），则将获得最大主页（其中可能包括框架或其他特殊功能）。如果您使用Lynx浏览器（基于终端），则将获得min主页（该主页可能是设计用于轻松进行纯文本浏览的版本）。如果这些条件都不适用（您使用任何其他浏览器，或者您的浏览器将自身标识为非标准），则您将获得std（标准）主页。</p>

  </div></div>

  <div class="subsection"><h4 id="RewriteMap">重写地图</h4><div class="text">

    <p>句法：<code>RewriteMap name rewriteMapClassName optionalParameters</code></p>

    <p>使用用户必须实现的接口来实现地图。它的类别名称是<code>org.apache.catalina.valves.rewrite.RewriteMap</code> ，其代码为：</p>

<div class="codeBox"><pre><code>package org.apache.catalina.valves.rewrite;

public interface RewriteMap {
    public String setParameters(String params);
    public String lookup(String key);
}</code></pre></div>

  </div></div>

  <div class="subsection"><h4 id="RewriteRule">重写规则</h4><div class="text">

    <p>句法：<code>RewriteRule Pattern Substitution</code></p>

      <p>RewriteRule指令是真正的重写主力。该指令可以多次出现，每个实例定义一个重写规则。定义这些规则的顺序很重要-这是它们在运行时应用的顺序。</p>

      <p>模式是与Perl兼容的正则表达式，应用于当前URL。 ``当前''是指应用此规则时URL的值。这可能不是最初请求的URL，它可能已经与以前的规则匹配，并且已被更改。</p>

      <p><strong>安全警告：</strong>由于Java的正则表达式匹配完成的方式，格式不正确的正则表达式模式很容易遭受“灾难性回溯”，也就是“正则表达式拒绝服务”或ReDoS。因此，应特别注意RewriteRule模式。通常，很难自动检测到这种易受攻击的正则表达式，因此，好的防御方法是对灾难性的回溯问题有所了解。<a href="https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS">OWASP ReDoS指南</a>是一个很好的参考。</p>

      <p>关于正则表达式语法的一些提示：</p>


<pre>
<strong>Text:</strong>
  <strong><code>.</code></strong>           Any single character
  <strong><code>[</code></strong>chars<strong><code>]</code></strong>     Character class: Any character of the class ``chars''
  <strong><code>[^</code></strong>chars<strong><code>]</code></strong>    Character class: Not a character of the class ``chars''
  text1<strong><code>|</code></strong>text2 Alternative: text1 or text2

<strong>Quantifiers:</strong>
  <strong><code>?</code></strong>           0 or 1 occurrences of the preceding text
  <strong><code>*</code></strong>           0 or N occurrences of the preceding text (N &gt; 0)
  <strong><code>+</code></strong>           1 or N occurrences of the preceding text (N &gt; 1)

<strong>Grouping:</strong>
  <strong><code>(</code></strong>text<strong><code>)</code></strong>      Grouping of text
              (used either to set the borders of an alternative as above, or
              to make backreferences, where the <strong>N</strong>th group can
              be referred to on the RHS of a RewriteRule as <code>$</code><strong>N</strong>)

<strong>Anchors:</strong>
  <strong><code>^</code></strong>           Start-of-line anchor
  <strong><code>$</code></strong>           End-of-line anchor

<strong>Escaping:</strong>
  <strong><code>\</code></strong>char       escape the given char
              (for instance, to specify the chars "<code>.[]()</code>" <em>etc.</em>)
</pre>

      <p>有关正则表达式的更多信息，请查看perl正则表达式联机帮助页（“ <a href="https://perldoc.perl.org/perlre.html">perldoc perlre</a> ”）。如果您对有关正则表达式及其变体（POSIX正则表达式等）的更详细信息感兴趣，则可以参考以下书籍：</p>

      <p class="indent">
        <em>掌握正则表达式，第二版</em><br>杰弗里·弗里德<br>O'Reilly＆Associates，Inc. 2002<br>ISBN 978-0-596-00289-3<br>
      </p>

      <p>在规则中，NOT字符（' <code>!</code> '）也可用作可能的模式前缀。这使您可以否定模式。例如：`` <em>如果当前URL与该模式<strong>不</strong>匹配</em> ''。这可以用于例外情况，在这种情况下更容易匹配否定模式，或者用作最后的默认规则。</p>

<p>注意：使用NOT字符取反模式时，不能在该模式中包括分组的通配符部分。这是因为，如果模式不匹配（即，否定匹配），则组中没有内容。因此，如果使用取反的模式，则不能使用<code>$N</code>在替换字符串中！
</p>

      <p>重写规则的<em id="rhs">取代</em>是被取代（或替换），该<em>模式</em>匹配的原始URL的字符串。除纯文本外，还可以包括</p>

      <ol>
        <li>反向引用（ <code>$N</code> ）到RewriteRule模式</li>

        <li>反向引用（ <code>%N</code> ）到最后一个匹配的RewriteCond模式</li>

        <li>服务器变量，如规则条件测试字符串（ <code>%{VARNAME}</code> ）</li>

        <li><a href="#mapfunc">映射函数</a>调用（ <code>${mapname:key|default}</code> ）</li>
      </ol>
      <p>反向引用是形式的标识符<code>$</code> <strong>N</strong> （ <strong>N</strong> = 0..9），它将由匹配<em>Pattern</em>的第<strong>N</strong>组内容替换。服务器变量与a的<em>TestString</em>相同<code>RewriteCond</code>指示。映射功能来自<code>RewriteMap</code>指令，并在那里进行说明。这三种类型的变量按上述顺序扩展。</p>

      <p>如前所述，所有重写规则都将应用于<em>替换</em> （按在配置文件中定义的顺序）。该URL <strong>完全</strong>由<em>Substitution替换</em> ，重写过程将继续进行，直到应用了所有规则，或者由一个URL明确终止为止。 <code><strong>L</strong></code>旗。</p>

      <p>特殊字符<code>$</code>和<code>%</code>可以通过在其前面加上反斜杠字符来对其进行引用<code>\</code> 。</p>

      <p>有一个名为“ <code>-</code> '表示： <strong>无替代</strong> ！这在提供<strong>仅</strong>与URL匹配但不替代任何URL的重写规则时很有用。它通常与<strong>C</strong> （链）标志一起使用，以便在替换发生之前应用多个模式。</p>

      <p>与较新的mod_rewrite版本不同，Tomcat重写阀不会自动支持绝对URL（必须使用特定的重定向标志才能指定绝对URL，请参见下文）或直接提供文件。</p>

      <p>另外，您可以通过附加特殊<span id="rewriteflags">标志</span>来设置<em>替换</em> <span id="rewriteflags">标志</span> <strong><code>[</code> <em>标志</em> <code>]</code></strong>作为第三个论点<code>RewriteRule</code>指示。<em>标志</em>是以下任何<em>标志</em>的逗号分隔列表：</p>

      <ul>
        <li>' <strong><code>chain|C</code></strong> <strong>'（c。</strong>与下一个规则hained）<br>该标志将当前规则与下一个规则链接在一起（该规则本身可以与以下规则链接，依此类推）。这具有以下效果：如果规则匹配，则处理将照常继续-该标志无效。如果规则<strong>不</strong>匹配，则以下所有链接的规则将被跳过。例如，它可以用于删除`` <code>.www</code> ''部分，在每个目录规则集中，当您进行外部重定向时（其中的`` <code>.www</code> ''部分不应发生！）。</li>

        <li>' <strong><code>cookie|CO=</code></strong> <em><em>NAME：VAL：</em></em> <em>域</em> [： <em>寿命</em> [： <em>路径</em> ]]”（一组<strong>共同</strong> okie）<br>这将在客户端的浏览器中设置cookie。Cookie的名称由<em>NAME</em>指定，值为<em>VAL</em> 。 <em>domain</em>字段是cookie的域，例如“ .apache.org”，可选<em>生存期</em>是cookie的生存时间（以分钟为单位），可选<em>路径</em>是cookie的路径</li>

        <li>' <strong><code>env|E=</code></strong> <em><em>VAR：VAL'（</em></em>集合<strong>E</strong> nvironment变量）<br>这会强制将名为<em>VAR</em>的请求属性设置为值<em>VAL</em> ，其中<em>VAL</em>可以包含regexp向后引用（ <code>$N</code>和<code>%N</code> ），它将进行扩展。您可以多次使用此标志，以设置多个变量。</li>

        <li>' <strong><code>forbidden|F</code></strong> '（强制URL为<strong>F</strong> orbidden）<br>这将强制当前URL被禁止-它立即发回HTTP响应403（FORBIDDEN）。将此标志与适当的RewriteConds结合使用可有条件地阻止某些URL。</li>

        <li>' <strong><code>gone|G</code></strong> '（强制URL为<strong>g</strong> ）<br>这将强制当前URL消失-它立即发回HTTP响应410（GONE）。使用此标志标记不再存在的页面。</li>

        <li>' <strong><code>host|H</code></strong> = <em>主机</em> '（申请重写到<strong>h</strong> OST）<br>与其重写URL，不如说是重写虚拟主机。</li>

        <li>' <strong><code>last|L</code></strong> <strong>'（L</strong> AST规则）<br>在此处停止重写过程，不要再应用任何重写规则。这对应于Perl <code>last</code>命令或<code>break</code> C中的命令。使用此标志可防止遵循以下规则进一步重写当前重写的URL。例如，使用它重写根路径URL（' <code>/</code> '）到一个真实的， <em>例如</em> ，' <code>/e/www/</code> '。</li>

        <li>' <strong><code>next|N</code></strong> <strong>'（N</strong> EXT轮）<br>重新运行重写过程（从第一个重写规则重新开始）。这次，要匹配的URL不再是原始URL，而是最后重写规则返回的URL。这对应于Perl <code>next</code>命令或<code>continue</code> C中的命令。使用此标志重新启动重写过程-立即转到循环的顶部。<br>
         <strong>注意不要创建无限循环！</strong></li>

        <li>' <strong><code>nocase|NC</code></strong> <strong>'（N</strong> <strong>摄氏度</strong> ASE）<br>这使得<em>模式</em>不区分大小写，当<em>模式</em>与当前URL匹配时，将忽略“ AZ”和“ az”之间的差异。</li>

        <li>' <strong><code>noescape|NE</code></strong> <strong>'（N</strong> 2 O <strong>URIË</strong>输出的scaping）<br>该标志防止重写阀将通常的URI转义规则应用于重写结果。通常，特殊字符（例如'％'，'$'，';'等）将被转义为等效的十六进制代码（分别为'％25'，'％24'和'％3B'）；该标志可防止这种情况的发生。允许百分号出现在输出中，如<div class="codeBox"><pre><code>RewriteRule /foo/(.*) /bar?arg=P1\%3d$1 [R,NE]</code></pre></div>会变成<code>/foo/zed</code> “变成对“的安全要求” <code>/bar?arg=P1=zed</code> '。
        </li>



        <li>' <strong><code>qsappend|QSA</code></strong> <strong>'（Q</strong> uery <strong>小号</strong>特林<strong>一个</strong> PPEND）<br>该标志强制重写引擎将替换字符串的查询字符串部分追加到现有字符串中，而不是替换它。当您想通过重写规则将更多数据添加到查询字符串时，请使用此选项。</li>

         <li>' <strong><code>redirect|R</code> [= <em>代码</em> ]'（</strong>力<span id="redirect"><strong>R</strong> edirect）</span><br>前缀<em>替换</em>为<code>http://thishost[:thisport]/</code> （使新的URL成为URI）以强制进行外部重定向。如果未提供任何<em>代码</em> ，则将返回HTTP响应302（找到，先前已临时移动）。如果要使用300-399范围内的其他响应代码，只需指定适当的数字或使用以下符号名称之一： <code>temp</code> （默认）， <code>permanent</code> ， <code>seeother</code> 。使用此规则来规范化URL并将其返回给客户端-翻译`` <code>/~</code> ``变成'' <code>/u/</code> ”，或始终在其后添加斜线<code>/u/</code> <em>用户</em>等<br>
          <strong>注意：</strong>使用此标志时，请确保替换字段是有效的URL！否则，您将被重定向到无效位置。请记住，此标志仅会放在前面<code>http://thishost[:thisport]/</code> URL，然后重写将继续。通常，您将需要在此时停止重写并立即重定向。要停止重写，您应该添加“ L”标志。
        </li>

        <li>' <strong><code>skip|S</code></strong> = <em>NUM'（</em>一个<strong>或多个</strong>屈伸下一个规则（一个或多个））<br>如果当前规则匹配，则此标志强制重写引擎按顺序跳过下一个<em>num</em>规则。使用它来构造伪if-then-else构造：then子句的最后一条规则变为<code>skip=N</code> ，其中N是else子句中的规则数。（这是<strong>不</strong>一样的“链| C”！标记）</li>

        <li>' <strong><code>type|T</code></strong> = <em>MIME类型</em> '（力MIME <strong>吨</strong> YPE）<br>强制将目标文件的<em>MIME类型</em>设置为<em>MIME-type</em> 。这可用于根据某些条件设置内容类型。例如，以下代码段允许<code>.php</code>要<em>显示</em>的文件<code>mod_php</code>如果他们被称为<code>.phps</code>延期：<div class="codeBox"><pre><code>RewriteRule ^(.+\.php)s$ $1 [T=application/x-httpd-php-source]</code></pre></div>
        </li>
      </ul>

  </div></div>

</div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="./comments.html">这里</a>解释<a href="./comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>