<html lang="zh-Hans" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="../images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9配置参考（9.0.21）-Cluster Valve对象</title><meta name="author" content="Filip Hanik"><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/config/cluster-valve">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script></head><body ><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="../images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="../images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>Apache Tomcat 9配置参考</h1><div class="versionInfo">版本9.0.21， <time datetime="2019-06-04"> 2019年6月4日</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>链接</h2><ul><li><a href="../index.html">文件首页</a></li><li><a href="index.html">配置参考家</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">常问问题</a></li><li><a href="#comments_section">用户评论</a></li></ul></div><div><h2>顶级元素</h2><ul><li><a href="server.html">服务器</a></li><li><a href="service.html">服务</a></li></ul></div><div><h2>执行者</h2><ul><li><a href="executor.html">执行者</a></li></ul></div><div><h2>连接器</h2><ul><li><a href="http.html">HTTP / 1.1</a></li><li><a href="http2.html">HTTP / 2</a></li><li><a href="ajp.html">AJP</a></li></ul></div><div><h2>货柜</h2><ul><li><a href="context.html">语境</a></li><li><a href="engine.html">发动机</a></li><li><a href="host.html">主办</a></li><li><a href="cluster.html">簇</a></li></ul></div><div><h2>嵌套组件</h2><ul><li><a href="cookie-processor.html">Cookie处理器</a></li><li><a href="credentialhandler.html">凭证处理程序</a></li><li><a href="globalresources.html">全球资源</a></li><li><a href="jar-scanner.html">JarScanner</a></li><li><a href="jar-scan-filter.html">JarScanFilter</a></li><li><a href="listeners.html">听众</a></li><li><a href="loader.html">装载机</a></li><li><a href="manager.html">经理</a></li><li><a href="realm.html">领域</a></li><li><a href="resources.html">资源资源</a></li><li><a href="sessionidgenerator.html">SessionIdGenerator</a></li><li><a href="valve.html">阀</a></li></ul></div><div><h2>集群元素</h2><ul><li><a href="cluster.html">簇</a></li><li><a href="cluster-manager.html">经理</a></li><li><a href="cluster-channel.html">渠道</a></li><li><a href="cluster-membership.html">频道/会员</a></li><li><a href="cluster-sender.html">频道/发件人</a></li><li><a href="cluster-receiver.html">频道/接收器</a></li><li><a href="cluster-interceptor.html">通道/拦截器</a></li><li><a href="cluster-valve.html">阀</a></li><li><a href="cluster-deployer.html">部署者</a></li><li><a href="cluster-listener.html">集群监听器</a></li></ul></div><div><h2>web.xml</h2><ul><li><a href="filter.html">过滤</a></li></ul></div><div><h2>其他</h2><ul><li><a href="systemprops.html">系统属性</a></li><li><a href="jaspic.html">日本宝石</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>群集阀对象</h2><h3 id="Table_of_Contents">目录</h3><div class="text">
<ul><li><a href="#Introduction">介绍</a></li><li><a href="#org.apache.catalina.ha.tcp.ReplicationValve">org.apache.catalina.ha.tcp。复制阀</a><ol><li><a href="#org.apache.catalina.ha.tcp.ReplicationValve/Attributes">属性</a></li></ol></li><li><a href="#org.apache.catalina.ha.session.JvmRouteBinderValve">org.apache.catalina.ha.session。JvmRouteBinderValve</a><ol><li><a href="#org.apache.catalina.ha.session.JvmRouteBinderValve/Attributes">属性</a></li></ol></li><li><a href="#org.apache.catalina.ha.authenticator.ClusterSingleSignOn">org.apache.catalina.ha.authenticator。ClusterSingleSignOn</a><ol><li><a href="#org.apache.catalina.ha.authenticator.ClusterSingleSignOn/Attributes">属性</a></li></ol></li></ul>
</div><h3 id="Introduction">介绍</h3><div class="text">
  <p>集群阀与任何其他<a href="valve.html">Tomcat一样<code>Valve</code></a> 。群集阀门是HTTP请求的调用链中的拦截器，并且群集实现使用这些阀门对数据以及何时复制数据进行智能决策。
  </p>
  <p>集束阀必须实现<code>org.apache.catalina.ha.ClusterValve</code>接口。这是一个简单的界面，扩展了<code>org.apache.catalina.Valve</code>接口。
  </p>
</div><h3 id="org.apache.catalina.ha.tcp.ReplicationValve">org.apache.catalina.ha.tcp。复制阀</h3><div class="text">的<code>ReplicationValve</code>会在HTTP请求结束时通知集群，以便集群可以决定是否有要复制的数据。
  <div class="subsection"><h4 id="org.apache.catalina.ha.tcp.ReplicationValve/Attributes">属性</h4><div class="text">
    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><strong><code class="attributeName">className</code></strong></td><td>设置为<code>org.apache.catalina.ha.tcp.ReplicationValve</code>
      </td></tr><tr><td><code class="attributeName">filter</code></td><td>对于已知的文件扩展名或URL，您可以使用此Valve通知集群，该会话在此请求期间尚未被修改，并且集群不必探测会话管理器以进行更改。如果请求与此过滤器模式匹配，则集群将假定会话没有更改。一个示例过滤器看起来像<code>filter=".*\.gif|.*\.js|.*\.jpeg|.*\.jpg|.*\.png|.*\.htm|.*\.html|.*\.css|.*\.txt"</code> 。过滤器是一个正则表达式，使用<code>java.util.regex</code> 。
      </td></tr><tr><td><code class="attributeName">primaryIndicator</code></td><td>布尔值，因此为true，复制阀将插入请求属性，其名称由<code>primaryIndicatorName</code>属性。插入到request属性中的值是<code>Boolean.TRUE</code>要么<code>Boolean.FALSE</code>
      </td></tr><tr><td><code class="attributeName">primaryIndicatorName</code></td><td>默认值为<code>org.apache.catalina.ha.tcp.isPrimarySession</code>此处定义的值是请求属性的名称，该属性包含布尔值（如果会话在此服务器上是否为主要会话）。
      </td></tr><tr><td><code class="attributeName">statistics</code></td><td>布尔值。调成<code>true</code>如果您要阀门收集请求统计信息。默认值为<code>false</code>
      </td></tr></tbody></table>
  </div></div>
</div><h3 id="org.apache.catalina.ha.session.JvmRouteBinderValve">org.apache.catalina.ha.session。JvmRouteBinderValve</h3><div class="text">如果发生mod_jk故障转移， <code>JvmRouteBinderValve</code>将取代<code>jvmWorker</code>会话ID中的属性，以使将来的请求坚持到该节点。如果要使用后备功能，请不要启用此阀，但是如果您希望故障转移得以维持，并且为了使mod_jk不必继续探测发生故障的节点，请使用此阀。
  <div class="subsection"><h4 id="org.apache.catalina.ha.session.JvmRouteBinderValve/Attributes">属性</h4><div class="text">
    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><strong><code class="attributeName">className</code></strong></td><td>
        <code>org.apache.catalina.ha.session.JvmRouteBinderValve</code>
      </td></tr><tr><td><code class="attributeName">enabled</code></td><td>默认值为<code>true</code>要打开和关闭会话的jvmRoute值的运行时属性。
      </td></tr><tr><td><code class="attributeName">sessionIdAttribute</code></td><td>故障转移之前的旧sessionid使用该属性注册在请求属性中。默认属性名称为<code>org.apache.catalina.ha.session.JvmRouteOrignalSessionID</code> 。
      </td></tr></tbody></table>
  </div></div>
</div><h3 id="org.apache.catalina.ha.authenticator.ClusterSingleSignOn">org.apache.catalina.ha.authenticator。ClusterSingleSignOn</h3><div class="text">的<code>ClusterSingleSignOn</code>支持群集中的单点登录功能。通过使用<code>ClusterSingleSignOn</code> ，由一个Web应用程序认证的安全身份将被同一虚拟主机上的其他Web应用程序识别，并将其传播到群集中的其他节点。

  <p>有关更多信息，请参见<strong>Host</strong>元素上的<a href="host.html#Single_Sign_On">Single Sign On</a>特殊功能。</p>

  <p><strong>注意：</strong> ClusterSingleSignOn只能在主机级别的集群上配置。
  </p>

  <div class="subsection"><h4 id="org.apache.catalina.ha.authenticator.ClusterSingleSignOn/Attributes">属性</h4><div class="text">
    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><strong><code class="attributeName">className</code></strong></td><td>
        <p>使用的Java类名称。必须将此设置为<strong>org.apache.catalina.ha.authenticator。ClusterSingleSignOn</strong> 。</p>
      </td></tr><tr><td><code class="attributeName">cookieDomain</code></td><td>
        <p>设置要用于sso cookie的主机域。</p>
      </td></tr><tr><td><code class="attributeName">mapSendOptions</code></td><td>
        <p>Valve使用复制的映射。您可以设置该映射如何发送消息的标志。默认值为<code>6</code> （同步）。请注意，如果使用异步消息传递，则接收节点可能以与发送消息不同的顺序来处理更新消息。</p>
      </td></tr><tr><td><code class="attributeName">requireReauthentication</code></td><td>
        <p>默认为false。用于确定是否需要将每个请求重新认证到安全<strong>领域的</strong>标志。如果为“ true”，则此Valve使用缓存的安全凭证（用户名和密码）将与SSO会话关联的每个请求重新认证到<strong>Realm</strong> 。如果为“ false”，则Valve自身可以基于有效SSO cookie的存在对请求进行身份验证，而无需与<strong>Realm</strong>进行重新检查。</p>
      </td></tr><tr><td><code class="attributeName">rpcTimeout</code></td><td>
        <p>Valve使用复制的映射。这是向集群中的其他节点传输状态或从集群其他节点传输状态的消息的超时。如果未指定，则默认值为<code>15000</code>使用毫秒。
        </p>
      </td></tr><tr><td><code class="attributeName">terminateOnStartFailure</code></td><td>
        <p>调成<code>true</code>如果您希望此Valve在基础复制无法启动时失败。如果阀门发生故障，则关联的容器将无法启动。如果将此属性设置为false，并且基础复制无法启动，则Valve将启动，它将尝试加入集群并在心跳过程中启动复制。如果未指定，则默认值为<code>false</code>用来。</p>
      </td></tr><tr><td><code class="attributeName">accessTimeout</code></td><td>ping消息超时。如果远程地图在此超时时间内没有响应，则视为已消失。默认值为<code>5000</code>毫秒。
      </td></tr></tbody></table>
  </div></div>
</div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="../comments.html">这里</a>解释<a href="../comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>