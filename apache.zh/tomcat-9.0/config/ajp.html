<html lang="zh-Hans" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="../images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9配置参考（9.0.21）-AJP连接器</title><meta name="author" content="Yoav Shapira"><meta name="author" content="Andrew R. Jaquith"><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/config/ajp">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script></head><body ><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="../images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="../images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>Apache Tomcat 9配置参考</h1><div class="versionInfo">版本9.0.21， <time datetime="2019-06-04"> 2019年6月4日</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>链接</h2><ul><li><a href="../index.html">文件首页</a></li><li><a href="index.html">配置参考家</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">常问问题</a></li><li><a href="#comments_section">用户评论</a></li></ul></div><div><h2>顶级元素</h2><ul><li><a href="server.html">服务器</a></li><li><a href="service.html">服务</a></li></ul></div><div><h2>执行者</h2><ul><li><a href="executor.html">执行者</a></li></ul></div><div><h2>连接器</h2><ul><li><a href="http.html">HTTP / 1.1</a></li><li><a href="http2.html">HTTP / 2</a></li><li><a href="ajp.html">AJP</a></li></ul></div><div><h2>货柜</h2><ul><li><a href="context.html">语境</a></li><li><a href="engine.html">发动机</a></li><li><a href="host.html">主办</a></li><li><a href="cluster.html">簇</a></li></ul></div><div><h2>嵌套组件</h2><ul><li><a href="cookie-processor.html">Cookie处理器</a></li><li><a href="credentialhandler.html">凭证处理程序</a></li><li><a href="globalresources.html">全球资源</a></li><li><a href="jar-scanner.html">JarScanner</a></li><li><a href="jar-scan-filter.html">JarScanFilter</a></li><li><a href="listeners.html">听众</a></li><li><a href="loader.html">装载机</a></li><li><a href="manager.html">经理</a></li><li><a href="realm.html">领域</a></li><li><a href="resources.html">资源资源</a></li><li><a href="sessionidgenerator.html">SessionIdGenerator</a></li><li><a href="valve.html">阀</a></li></ul></div><div><h2>集群元素</h2><ul><li><a href="cluster.html">簇</a></li><li><a href="cluster-manager.html">经理</a></li><li><a href="cluster-channel.html">渠道</a></li><li><a href="cluster-membership.html">频道/会员</a></li><li><a href="cluster-sender.html">频道/发件人</a></li><li><a href="cluster-receiver.html">频道/接收器</a></li><li><a href="cluster-interceptor.html">通道/拦截器</a></li><li><a href="cluster-valve.html">阀</a></li><li><a href="cluster-deployer.html">部署者</a></li><li><a href="cluster-listener.html">集群监听器</a></li></ul></div><div><h2>web.xml</h2><ul><li><a href="filter.html">过滤</a></li></ul></div><div><h2>其他</h2><ul><li><a href="systemprops.html">系统属性</a></li><li><a href="jaspic.html">日本宝石</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>AJP连接器</h2><h3 id="Table_of_Contents">目录</h3><div class="text">
<ul><li><a href="#Introduction">介绍</a></li><li><a href="#Attributes">属性</a><ol><li><a href="#Common_Attributes">共同属性</a></li><li><a href="#Standard_Implementations">标准实施</a></li><li><a href="#Java_TCP_socket_attributes">Java TCP套接字属性</a></li><li><a href="#NIO_specific_configuration">NIO特定配置</a></li><li><a href="#NIO2_specific_configuration">NIO2特定配置</a></li><li><a href="#APR/native_specific_configuration">APR /本机特定配置</a></li></ol></li><li><a href="#Nested_Components">嵌套组件</a></li><li><a href="#Special_Features">特殊功能</a><ol><li><a href="#Proxy_Support">代理支持</a></li><li><a href="#Connector_Comparison">连接器比较</a></li></ol></li></ul>
</div><h3 id="Introduction">介绍</h3><div class="text">

  <p><strong>AJP Connector</strong>元素代表一个<strong>Connector</strong>组件，该组件通过<code>AJP</code>协议。这用于以下情况：希望将Tomcat无形地集成到现有（或新的）Apache安装中，并且希望Apache处理Web应用程序中包含的静态内容，和/或利用Apache的SSL处理。</p>

  <p>当与连接器一起使用时，此连接器支持负载平衡。 <code>jvmRoute</code> <a href="engine.html">引擎的</a>属性。</p>

  <p>此Tomcat发行版支持的本机连接器是：</p>
    <ul>
      <li>JK 1.2.x和任何受支持的服务器。有关详细信息，请参见<a href="https://tomcat.apache.org/connectors-doc/">JK文档</a> 。</li>
      <li>在启用了AJP的Apache httpd 2.x（默认情况下包括在Apache HTTP Server 2.2中）上的mod_proxy：有关详细信息，请参见<a href="https://httpd.apache.org/docs/2.2/mod/mod_proxy_ajp.html">httpd文档</a> 。</li>
    </ul>

  <p><b>支持AJP的其他本机连接器可能会起作用，但不再受支持。</b></p>

</div><h3 id="Attributes">属性</h3><div class="text">

  <div class="subsection"><h4 id="Common_Attributes">共同属性</h4><div class="text">

  <p><strong>连接器的</strong>所有实现均支持以下属性：</p>

  <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">ajpFlush</code></td><td>
      <p>一个布尔值，可用于在显式刷新发生时启用或禁用向前端代理发送AJP刷新消息。默认值为<code>true</code> 。<br>AJP刷新消息是没有正文内容的SEND_BODY_CHUNK数据包。诸如mod_jk或mod_proxy_ajp之类的代理实现会在收到此类数据包时将Web服务器中缓冲的数据刷新到客户端。设置为<code>false</code>可以减少AJP数据包流量，但可能会延迟将数据包发送到客户端。在响应结束时，AJP始终会刷新到客户端。</p>
    </td></tr><tr><td><code class="attributeName">allowTrace</code></td><td>
      <p>一个布尔值，可用于启用或禁用TRACE HTTP方法。如果未指定，则此属性设置为false。</p>
    </td></tr><tr><td><code class="attributeName">asyncTimeout</code></td><td>
      <p>异步请求的默认超时（以毫秒为单位）。如果未指定，则此属性设置为Servlet规范默认值30000（30秒）。</p>
    </td></tr><tr><td><code class="attributeName">enableLookups</code></td><td>
      <p>调成<code>true</code>如果您想致电<code>request.getRemoteHost()</code>执行DNS查找以返回远程客户端的实际主机名。调成<code>false</code>跳过DNS查找并改为以字符串形式返回IP地址（从而提高性能）。默认情况下，DNS查找被禁用。</p>
    </td></tr><tr><td><code class="attributeName">maxHeaderCount</code></td><td>
      <p>容器允许的请求中的最大标头数。标头超过指定限制的请求将被拒绝。小于0的值表示没有限制。如果未指定，则使用默认值100。</p>
    </td></tr><tr><td><code class="attributeName">maxParameterCount</code></td><td>
      <p>容器将自动解析的参数和值对的最大数量（GET加POST）。超出此限制的参数和值对将被忽略。小于0的值表示没有限制。如果未指定，则使用默认值10000。注意<code>FailedRequestFilter</code> <a href="filter.html">过滤器</a>可用于拒绝达到限制的请求。</p>
    </td></tr><tr><td><code class="attributeName">maxPostSize</code></td><td>
      <p>容器FORM URL参数解析将处理的POST的最大大小（以字节为单位）。可以通过将此属性设置为小于零的值来禁用该限制。如果未指定，则此属性设置为2097152（2兆字节）。请注意<a href="filter.html#Failed_Request_Filter"><code>FailedRequestFilter</code></a>可用于拒绝超出此限制的请求。</p>
    </td></tr><tr><td><code class="attributeName">maxSavePostSize</code></td><td>
      <p>在FORM或CLIENT-CERT身份验证期间，容器将保存/缓冲的POST的最大大小（以字节为单位）。对于这两种类型的身份验证，将在对用户进行身份验证之前保存/缓冲POST。对于CLIENT-CERT身份验证，在SSL握手期间将对POST进行缓冲，并在处理请求时将其清空。对于FORM身份验证，POST被保存，而用户被重定向到登录表单，并一直保留到用户成功进行身份验证或与身份验证请求关联的会话到期为止。可以通过将此属性设置为-1来禁用该限制。将该属性设置为零将禁用身份验证期间的POST数据保存。如果未指定，则此属性设置为4096（4 KB）。</p>
    </td></tr><tr><td><code class="attributeName">parseBodyMethods</code></td><td>
      <p>请求主体使用的HTTP方法的逗号分隔列表<code>application/x-www-form-urlencoded</code>将解析与POST相同的请求参数。这在想要支持PUT请求的POST样式语义的RESTful应用程序中很有用。请注意，除<code>POST</code>导致Tomcat的行为违背Servlet规范的意图。根据HTTP规范，此处特别禁止使用HTTP方法TRACE。默认是<code>POST</code></p>
    </td></tr><tr><td><strong><code class="attributeName">port</code></strong></td><td>
      <p><strong>连接器</strong>将在其上创建服务器套接字并等待传入连接的TCP端口号。您的操作系统将仅允许一个服务器应用程序侦听特定IP地址上的特定端口号。如果使用特殊值0（零），则Tomcat将随机选择一个空闲端口用于此连接器。这通常仅在嵌入式和测试应用程序中有用。</p>
    </td></tr><tr><td><code class="attributeName">protocol</code></td><td>
      <p>设置协议以处理传入流量。要配置AJP连接器，必须指定它。如果未提供协议值，则将配置<a href="http.html">HTTP连接器</a>而不是AJP连接器。<br>AJP连接器的标准协议值为<code>AJP/1.3</code>它使用自动切换机制来选择基于Java NIO的连接器或基于APR / native的连接器。如果<code>PATH</code> （Windows）或<code>LD_LIBRARY_PATH</code> （在大多数Unix系统上）环境变量包含Tomcat本机库，将使用本机/ APR连接器。如果找不到本机库，则将使用基于Java NIO的连接器。<br>要使用显式协议而不是依赖于上述自动切换机制，可以使用以下值：<br>
        <code>org.apache.coyote.ajp.AjpNioProtocol</code> -非阻塞Java NIO连接器。<br>
        <code>org.apache.coyote.ajp.AjpNio2Protocol</code> -非阻塞Java NIO2连接器。<br>
        <code>org.apache.coyote.ajp.AjpAprProtocol</code> -APR /本机连接器。<br>也可以使用自定义实现。<br>看看我们的<a href="#Connector_Comparison">连接器比较</a>表。
      </p>
    </td></tr><tr><td><code class="attributeName">proxyName</code></td><td>
      <p>如果在代理配置中使用了此<strong>连接器</strong> ，请配置此属性以指定要返回的服务器名称以调用<code>request.getServerName()</code> 。有关更多信息，请参见<a href="#Proxy_Support">代理支持</a> 。</p>
    </td></tr><tr><td><code class="attributeName">proxyPort</code></td><td>
      <p>如果在代理配置中使用了此<strong>连接器</strong> ，请配置此属性以指定要返回的服务器端口以调用<code>request.getServerPort()</code> 。有关更多信息，请参见<a href="#Proxy_Support">代理支持</a> 。</p>
    </td></tr><tr><td><code class="attributeName">redirectPort</code></td><td>
      <p>如果此<strong>连接器</strong>支持非SSL请求，并且接收到匹配的请求<code><security-constraint></code>需要SSL传输，Catalina将自动将请求重定向到此处指定的端口号。</p>
    </td></tr><tr><td><code class="attributeName">scheme</code></td><td>
      <p>将此属性设置为您希望通过调用返回的协议的名称<code>request.getScheme()</code> 。例如，您可以将此属性设置为“ <code>https</code> “用于SSL连接器。默认值为“ <code>http</code> ”。
      </p>
    </td></tr><tr><td><code class="attributeName">secure</code></td><td>
      <p>将此属性设置为<code>true</code>如果您想致电<code>request.isSecure()</code>返回<code>true</code>该连接器收到的请求。您可能希望在SSL连接器或从SSL加速器（例如加密卡，SSL设备甚至Web服务器）接收数据的非SSL连接器上使用此连接器。默认值为<code>false</code> 。</p>
    </td></tr><tr><td><code class="attributeName">URIEncoding</code></td><td>
      <p>在％xx解码URL之后，这指定用于解码URI字节的字符编码。如果未指定，将使用UTF-8，除非<code>org.apache.catalina.STRICT_SERVLET_COMPLIANCE</code> <a href="systemprops.html">系统属性</a>设置为<code>true</code>在这种情况下，将使用ISO-8859-1。</p>
    </td></tr><tr><td><code class="attributeName">useBodyEncodingForURI</code></td><td>
      <p>这指定是否应将contentType中指定的编码用于URI查询参数，而不是使用URIEncoding。出现此设置是为了与Tomcat 4.1.x兼容，其中在contentType中指定的编码或使用Request.setCharacterEncoding方法显式设置的编码也用于URL中的参数。默认值为<code>false</code> 。
      </p>
      <p><em>注意：</em>请参阅<a href="http.html">HTTP连接器</a>文档中有关此属性的注释。</p>
    </td></tr><tr><td><code class="attributeName">useIPVHosts</code></td><td>
      <p>将此属性设置为<code>true</code>使Tomcat使用本机Web服务器传递的IP地址来确定将请求发送到的主机。默认值为<code>false</code> 。</p>
    </td></tr><tr><td><code class="attributeName">xpoweredBy</code></td><td>
      <p>将此属性设置为<code>true</code>使Tomcat使用规范中建议的标头宣传对Servlet规范的支持。默认值为<code>false</code> 。</p>
    </td></tr></tbody></table>

  </div></div>

  <div class="subsection"><h4 id="Standard_Implementations">标准实施</h4><div class="text">

  <p>要使用AJP，必须指定协议属性（请参见上文）。</p>

  <p>标准AJP连接器（NIO，NIO2和APR / native）除上面列出的通用连接器属性外，还支持以下属性。</p>

  <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">acceptCount</code></td><td>
      <p>使用所有可能的请求处理线程时，传入连接请求的最大队列长度。队列已满时收到的任何请求都将被拒绝。默认值为100。</p>
    </td></tr><tr><td><code class="attributeName">acceptorThreadCount</code></td><td>
      <p>用于接受连接的线程数。在多CPU机器上增加此值，尽管您永远不需要<code>2</code> 。另外，在有许多非保持活动连接的情况下，您可能还希望增加此值。默认值为<code>1</code> 。</p>
    </td></tr><tr><td><code class="attributeName">acceptorThreadPriority</code></td><td>
      <p>受体线程的优先级。用于接受新连接的线程。默认值为<code>5</code> （ <code>java.lang.Thread.NORM_PRIORITY</code>不变）。请参阅JavaDoc <code>java.lang.Thread</code>类，了解有关此优先级含义的更多详细信息。</p>
    </td></tr><tr><td><code class="attributeName">address</code></td><td>
      <p>对于具有多个IP地址的服务器，此属性指定将用于侦听指定端口的地址。默认情况下，此端口将用于与服务器关联的所有IP地址。值<code>127.0.0.1</code>表示连接器将仅侦听回送接口。</p>
    </td></tr><tr><td><code class="attributeName">bindOnInit</code></td><td>
      <p>控制何时绑定连接器使用的套接字。默认情况下，它在启动连接器时绑定，而在销毁连接器时取消绑定。如果设置为<code>false</code> ，套接字将在连接器启动时绑定，而在连接器停止时取消绑定。</p>
    </td></tr><tr><td><code class="attributeName">clientCertProvider</code></td><td>
      <p>当客户端证书信息以除实例以外的形式呈现时<code>java.security.cert.X509Certificate</code>它需要先转换，然后才能使用，并且此属性控制使用哪个JSSE提供程序执行转换。例如，它与AJP连接器， <a href="http.html">HTTP APR连接器</a>以及<a href="valve.html#SSL_Authenticator_Valve">org.apache.catalina.valves一起使用。SSLValve</a> 。如果未指定，将使用默认提供程序。</p>
    </td></tr><tr><td><code class="attributeName">connectionLinger</code></td><td>
      <p>关闭<strong>连接器</strong>时，此<strong>连接器</strong>使用的插座停留的秒数。默认值为<code>-1</code>禁用套接字延迟。</p>
    </td></tr><tr><td><code class="attributeName">connectionTimeout</code></td><td>
      <p>接受连接后，此<strong>连接器</strong>将等待呈现请求URI行的毫秒数。AJP协议连接器的默认值为<code>-1</code> （即无限）。</p>
    </td></tr><tr><td><code class="attributeName">executor</code></td><td>
      <p>对<a href="executor.html">Executor</a>元素中名称的引用。如果设置了此属性，并且命名的执行程序存在，则连接器将使用该执行程序，所有其他线程属性将被忽略。请注意，如果未为连接器指定共享执行器，则连接器将使用私有的内部执行器来提供线程池。</p>
    </td></tr><tr><td><code class="attributeName">executorTerminationTimeoutMillis</code></td><td>
      <p>私有内部执行器在继续执行停止连接器过程之前等待请求处理线程终止的时间。如果未设置，则默认为<code>5000</code> （5秒）。</p>
    </td></tr><tr><td><code class="attributeName">keepAliveTimeout</code></td><td>
      <p>该<strong>连接器</strong>在关闭连接之前将等待另一个AJP请求的毫秒数。默认值是使用为connectionTimeout属性设置的值。</p>
    </td></tr><tr><td><code class="attributeName">maxConnections</code></td><td>
      <p>服务器在任何给定时间将接受和处理的最大连接数。达到此数目后，服务器将接受但不处理另一个连接。在处理的连接数降至<strong>maxConnections</strong>以下之前，该附加连接将被阻止，此时服务器将再次开始接受和处理新的连接。请注意，一旦达到限制，操作系统仍然可以根据以下情况接受连接： <code>acceptCount</code>设置。默认值因连接器类型而异。对于NIO和NIO2，默认值为<code>10000</code> 。对于APR /本机，默认值为<code>8192</code> 。</p>
      <p>请注意，对于Windows上的APR /本机，配置的值将减小为1024的最大倍，该最大值小于或等于maxConnections。这样做是出于性能原因。<br>如果设置为-1，将禁用maxConnections功能，并且不计算连接数。</p>
    </td></tr><tr><td><code class="attributeName">maxCookieCount</code></td><td>
      <p>请求允许的最大Cookie数。小于零的值表示没有限制。如果未指定，将使用默认值200。</p>
    </td></tr><tr><td><code class="attributeName">maxThreads</code></td><td>
      <p>此<strong>Connector</strong>将创建的请求处理线程的最大数量，因此确定了可以处理的同时请求的最大数量。如果未指定，则此属性设置为200。如果执行程序与此连接器相关联，则此属性将被忽略，因为连接器将使用执行程序而不是内部线程池执行任务。请注意，如果配置了执行程序，则将正确记录为此属性设置的任何值，但会（例如通过JMX）将其报告为<code>-1</code>明确表示未使用。</p>
    </td></tr><tr><td><code class="attributeName">minSpareThreads</code></td><td>
      <p>始终保持运行状态的最小线程数。这包括活动线程和空闲线程。如果未指定，则默认为<code>10</code>用来。如果执行程序与此连接器相关联，则此属性将被忽略，因为连接器将使用执行程序而不是内部线程池执行任务。请注意，如果配置了执行程序，则将正确记录为此属性设置的任何值，但会（例如通过JMX）将其报告为<code>-1</code>明确表示未使用。</p>
    </td></tr><tr><td><code class="attributeName">packetSize</code></td><td>
      <p>此属性设置最大AJP数据包大小（以字节为单位）。最大值为65536。它应该与<code>max_packet_size</code>为mod_jk配置的指令。通常，没有必要更改最大数据包大小。发送证书或证书链时，已报告默认值问题。默认值为8192。如果设置为小于8192，则该设置将被忽略，并使用默认值8192。</p>
    </td></tr><tr><td><code class="attributeName">processorCache</code></td><td>
      <p>协议处理程序缓存Processor对象以提高性能。此设置指示要缓存多少这些对象。
      <code>-1</code>表示无限，默认为<code>200</code> 。如果未使用Servlet 3.0异步处理，则一个很好的默认设置是使用与maxThreads设置相同的设置。如果使用Servlet 3.0异步处理，一个好的默认设置是使用maxThreads中的较大者和预期的并发请求（同步和异步）的最大数量。</p>
    </td></tr><tr><td><code class="attributeName">requiredSecret</code></td><td>
      <p>仅接受来自使用此秘密关键字的工作人员的请求。
      </p>
    </td></tr><tr><td><code class="attributeName">tcpNoDelay</code></td><td>
      <p>如果设置为<code>true</code> ，将在服务器套接字上设置TCP_NO_DELAY选项，从而在大多数情况下提高性能。设置为<code>true</code>默认。</p>
    </td></tr><tr><td><code class="attributeName">threadPriority</code></td><td>
      <p>JVM中请求处理线程的优先级。默认值为<code>5</code> （ <code>java.lang.Thread.NORM_PRIORITY</code>不变）。请参阅JavaDoc <code>java.lang.Thread</code>类，了解有关此优先级含义的更多详细信息。如果执行程序与此连接器相关联，则此属性将被忽略，因为连接器将使用执行程序而不是内部线程池执行任务。请注意，如果配置了执行程序，则将正确记录为此属性设置的任何值，但会（例如通过JMX）将其报告为<code>-1</code>明确表示未使用。</p>
    </td></tr><tr><td><code class="attributeName">throwOnFailure</code></td><td>
      <p>如果连接器在生命周期过渡期间遇到异常，是否应重新抛出或记录该异常？如果未指定，则默认为<code>false</code>将会被使用。请注意，默认设置可以通过<code>org.apache.catalina.startup.EXIT_ON_INIT_FAILURE</code>系统属性。</p>
    </td></tr><tr><td><code class="attributeName">tomcatAuthentication</code></td><td>
      <p>如果设置为<code>true</code> ，身份验证将在Tomcat中完成。否则，将从本地Web服务器传播经过身份验证的主体，并将其用于Tomcat中的授权。请注意，此主体将没有与其关联的角色。默认值为<code>true</code> 。如果<code>tomcatAuthorization</code>被设定为<code>true</code>此属性无效。</p>
    </td></tr><tr><td><code class="attributeName">tomcatAuthorization</code></td><td>
      <p>如果设置为<code>true</code> ，则将从本地Web服务器传播经过身份验证的主体，并认为已在Tomcat中进行了身份验证。如果Web应用程序具有一个或多个安全性约束，则将由Tomcat执行授权，并将角色分配给已验证的主体。如果适合该请求的Tomcat Realm无法识别提供的用户名，则仍将创建一个Principal，但它没有任何角色。默认值为<code>false</code> 。</p>
    </td></tr></tbody></table>

  </div></div>

  <div class="subsection"><h4 id="Java_TCP_socket_attributes">Java TCP套接字属性</h4><div class="text">

    <p>NIO和NIO2实现除了上面列出的公共连接器和HTTP属性外，还支持以下Java TCP套接字属性。</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">socket.rxBufSize</code></td><td>
        <p>（int）套接字接收缓冲区（SO_RCVBUF）的大小，以字节为单位。如果未设置，则使用JVM默认值。</p>
      </td></tr><tr><td><code class="attributeName">socket.txBufSize</code></td><td>
        <p>（int）套接字发送缓冲区（SO_SNDBUF）的大小，以字节为单位。如果未设置，则使用JVM默认值。</p>
      </td></tr><tr><td><code class="attributeName">socket.tcpNoDelay</code></td><td>
        <p>（布尔）这等效于标准属性<strong>tcpNoDelay</strong> 。</p>
      </td></tr><tr><td><code class="attributeName">socket.soKeepAlive</code></td><td>
        <p>（布尔）套接字的保持活动设置的布尔值（SO_KEEPALIVE）。如果未设置，则使用JVM默认值。</p>
      </td></tr><tr><td><code class="attributeName">socket.ooBInline</code></td><td>
        <p>（布尔）套接字OOBINLINE设置的布尔值。如果未设置，则使用JVM默认值。</p>
      </td></tr><tr><td><code class="attributeName">socket.soReuseAddress</code></td><td>
        <p>套接字重用地址选项（SO_REUSEADDR）的（布尔）布尔值。如果未设置，则使用JVM默认值。</p>
      </td></tr><tr><td><code class="attributeName">socket.soLingerOn</code></td><td>
        <p>（bool）套接字so linger选项的布尔值（SO_LINGER）。标准属性<strong>connectionLinger的</strong>值> = 0等于将其设置为<code>true</code> 。标准属性<strong>connectionLinger的</strong>值小于0等于将其设置为<code>false</code> 。此属性和<code>soLingerTime</code>必须设置，否则将使用JVM默认值。</p>
      </td></tr><tr><td><code class="attributeName">socket.soLingerTime</code></td><td>
        <p>（int）套接字so linger选项（SO_LINGER）的秒数。这等效于标准属性<strong>connectionLinger</strong> 。此属性和<code>soLingerOn</code>必须设置，否则将使用JVM默认值。</p>
      </td></tr><tr><td><code class="attributeName">socket.soTimeout</code></td><td>
        <p>这等效于标准属性<strong>connectionTimeout</strong> 。</p>
      </td></tr><tr><td><code class="attributeName">socket.performanceConnectionTime</code></td><td>
        <p>（int）性能设置的第一个值。请参阅<a href="http://docs.oracle.com/javase/6/docs/api/java/net/Socket.html#setPerformancePreferences(int, int, int)">套接字性能选项。</a>必须设置所有三个性能属性，否则将对所有三个属性使用JVM默认值。</p>
      </td></tr><tr><td><code class="attributeName">socket.performanceLatency</code></td><td>
        <p>（int）性能设置的第二个值。请参阅<a href="http://docs.oracle.com/javase/6/docs/api/java/net/Socket.html#setPerformancePreferences(int, int, int)">套接字性能选项。</a>必须设置所有三个性能属性，否则将对所有三个属性使用JVM默认值。</p>
      </td></tr><tr><td><code class="attributeName">socket.performanceBandwidth</code></td><td>
        <p>（int）性能设置的第三个值。请参阅<a href="http://docs.oracle.com/javase/6/docs/api/java/net/Socket.html#setPerformancePreferences(int, int, int)">套接字性能选项。</a>必须设置所有三个性能属性，否则将对所有三个属性使用JVM默认值。</p>
      </td></tr><tr><td><code class="attributeName">socket.unlockTimeout</code></td><td>
        <p>（int）套接字解锁的超时。当连接器停止时，它将尝试通过打开自身的连接器来释放接收器线程。默认值为<code>250</code>值以毫秒为单位</p>
      </td></tr></tbody></table>
  </div></div>

  <div class="subsection"><h4 id="NIO_specific_configuration">NIO特定配置</h4><div class="text">

    <p>以下属性特定于NIO连接器。</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">socket.directBuffer</code></td><td>
        <p>（布尔）布尔值，是使用直接ByteBuffer还是Java映射的ByteBuffer。默认为<code>false</code> 。<br>使用直接缓冲区时，请确保为直接内存空间分配了适当的内存量。在Sun的JDK上，类似<code>-XX:MaxDirectMemorySize=256m</code> 。
        </p>
      </td></tr><tr><td><code class="attributeName">socket.appReadBufSize</code></td><td>
        <p>（int）在Tomcat中打开的每个连接都与读取的ByteBuffer关联。此属性控制此缓冲区的大小。默认情况下，此读取缓冲区的大小为<code>8192</code>个字节。对于较低的并发，可以增加此值以缓冲更多数据。对于极大量的保持活动连接，请减少此数目或增加堆大小。</p>
      </td></tr><tr><td><code class="attributeName">socket.appWriteBufSize</code></td><td>
        <p>（int）在Tomcat中打开的每个连接都与一个写ByteBuffer相关联。此属性控制此缓冲区的大小。默认情况下，此写缓冲区的大小为<code>8192</code>个字节。对于低并发性，您可以增加此值以缓冲更多响应数据。对于极大量的保持活动连接，请减少此数目或增加堆大小。<br>这里的默认值非常低，如果不处理成千上万的并发连接，则应将其调高。</p>
      </td></tr><tr><td><code class="attributeName">socket.bufferPool</code></td><td>
        <p>（int）NIO连接器使用称为NioChannel的类，该类保存链接到套接字的元素。为了减少垃圾收集，NIO连接器会缓存这些通道对象。此值指定此缓存的大小。默认值为<code>500</code> ，并表示该缓存将容纳500个NioChannel对象。其他值是<code>-1</code>无限缓存和<code>0</code>没有缓存。</p>
      </td></tr><tr><td><code class="attributeName">socket.bufferPoolSize</code></td><td>
        <p>（int）NioChannel池也可以基于大小，而不是基于对象。大小计算如下：<br>NioChannel<code>buffer size = read buffer size + write buffer size</code><br>SecureNioChannel<code>buffer size = application read buffer size + application write buffer size + network read buffer size + network write buffer size</code><br>该值以字节为单位，默认值为<code>1024*1024*100</code> （100MB）。</p>
      </td></tr><tr><td><code class="attributeName">socket.processorCache</code></td><td>
        <p>（int）Tomcat将缓存SocketProcessor对象以减少垃圾收集。整数值指定最多在缓存中保留多少个对象。默认是<code>500</code> 。其他值是<code>-1</code>无限缓存和<code>0</code>没有缓存。</p>
      </td></tr><tr><td><code class="attributeName">socket.keyCache</code></td><td>
        <p>（int）Tomcat将缓存KeyAttachment对象以减少垃圾收集。整数值指定最多在缓存中保留多少个对象。默认是<code>500</code> 。其他值是<code>-1</code>无限缓存和<code>0</code>没有缓存。</p>
      </td></tr><tr><td><code class="attributeName">socket.eventCache</code></td><td>
        <p>（int）Tomcat将缓存PollerEvent对象以减少垃圾收集。整数值指定最多在缓存中保留多少个对象。默认是<code>500</code> 。其他值是<code>-1</code>无限缓存和<code>0</code>没有缓存。</p>
      </td></tr><tr><td><code class="attributeName">selectorPool.maxSelectors</code></td><td>
        <p>（int）池中使用的最大选择器，以减少选择器争用。命令行时使用此选项<code>org.apache.tomcat.util.net.NioSelectorShared</code>值设置为false。默认值为<code>200</code> 。</p>
      </td></tr><tr><td><code class="attributeName">selectorPool.maxSpareSelectors</code></td><td>
        <p>（int）池中使用的最大备用选择器，以减少选择器争用。当选择器返回到池中时，系统可以决定保留它还是让它成为GC。命令行时使用此选项<code>org.apache.tomcat.util.net.NioSelectorShared</code>值设置为false。默认值为<code>-1</code> （无限）。</p>
      </td></tr><tr><td><code class="attributeName">command-line-options</code></td><td>
        <p>以下命令行选项可用于NIO连接器：<br>
        <code>-Dorg.apache.tomcat.util.net.NioSelectorShared=true|false</code> -默认为<code>true</code> 。将此值设置为<code>false</code>如果您希望为每个线程使用选择器。当您将其设置为<code>false</code> ，您可以使用<strong>selectorPool.maxSelectors</strong>属性控制选择器池的大小。</p>
      </td></tr></tbody></table>
  </div></div>

  <div class="subsection"><h4 id="NIO2_specific_configuration">NIO2特定配置</h4><div class="text">

    <p>以下属性特定于NIO2连接器。</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">useCaches</code></td><td>
        <p>（布尔）使用此属性可以启用或禁用对象缓存以减少产生的GC对象的数量。默认值为<code>false</code> 。</p>
      </td></tr><tr><td><code class="attributeName">socket.directBuffer</code></td><td>
        <p>（布尔）布尔值，是使用直接ByteBuffer还是Java映射的ByteBuffer。默认为<code>false</code> 。<br>使用直接缓冲区时，请确保为直接内存空间分配了适当的内存量。在Sun的JDK上，类似<code>-XX:MaxDirectMemorySize=256m</code> 。
        </p>
      </td></tr><tr><td><code class="attributeName">socket.appReadBufSize</code></td><td>
        <p>（int）在Tomcat中打开的每个连接都与读取的ByteBuffer关联。此属性控制此缓冲区的大小。默认情况下，此读取缓冲区的大小为<code>8192</code>个字节。对于较低的并发，可以增加此值以缓冲更多数据。对于极大量的保持活动连接，请减少此数目或增加堆大小。</p>
      </td></tr><tr><td><code class="attributeName">socket.appWriteBufSize</code></td><td>
        <p>（int）在Tomcat中打开的每个连接都与一个写ByteBuffer相关联。此属性控制此缓冲区的大小。默认情况下，此写缓冲区的大小为<code>8192</code>个字节。对于低并发性，您可以增加此值以缓冲更多响应数据。对于极大量的保持活动连接，请减少此数目或增加堆大小。<br>这里的默认值非常低，如果不处理成千上万的并发连接，则应将其调高。</p>
      </td></tr><tr><td><code class="attributeName">socket.bufferPoolSize</code></td><td>
        <p>（int）NIO2连接器使用称为Nio2Channel的类，该类保存链接到套接字的元素。为了减少垃圾收集，NIO连接器会缓存这些通道对象。此值指定此缓存的大小。默认值为<code>500</code> ，并表示该缓存将容纳500个Nio2Channel对象。其他值是<code>-1</code>无限缓存和<code>0</code>没有缓存。</p>
      </td></tr><tr><td><code class="attributeName">socket.processorCache</code></td><td>
        <p>（int）Tomcat将缓存SocketProcessor对象以减少垃圾收集。整数值指定最多在缓存中保留多少个对象。默认是<code>500</code> 。其他值是<code>-1</code>无限缓存和<code>0</code>没有缓存。</p>
      </td></tr></tbody></table>
  </div></div>

  <div class="subsection"><h4 id="APR/native_specific_configuration">APR /本机特定配置</h4><div class="text">

    <p>除了上面列出的公共连接器和AJP属性外，APR /本机实现还支持以下属性。</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">pollTime</code></td><td>
        <p>轮询呼叫的持续时间（以微秒为单位）。降低此值将在某些情况下稍微减少保持活动状态的连接的延迟，但是随着进行更多的轮询调用，将使用更多的CPU。默认值为2000（2毫秒）。
        </p>
    </td></tr></tbody></table>

  </div></div>

</div><h3 id="Nested_Components">嵌套组件</h3><div class="text">

  <p>目前没有。</p>

</div><h3 id="Special_Features">特殊功能</h3><div class="text">

  <div class="subsection"><h4 id="Proxy_Support">代理支持</h4><div class="text">

  <p>的<code>proxyName</code>和<code>proxyPort</code>当Tomcat在代理服务器后面运行时，可以使用属性。这些属性修改返回给调用了<code>request.getServerName()</code>和<code>request.getServerPort()</code>方法，通常用于构造用于重定向的绝对URL。如果不配置这些属性，则返回的值将反映接收到来自代理服务器的连接的服务器名称和端口，而不是客户端将原始请求定向到的服务器名称和端口。</p>

  <p>有关更多信息，请参见<a href="../proxy-howto.html">代理支持方法</a> 。</p>

  </div></div>

  <div class="subsection"><h4 id="Connector_Comparison">连接器比较</h4><div class="text">

    <p>下面的小图显示了连接器的不同之处。</p>

    <table class="defaultTable" style="text-align:center">
      <tbody><tr>
        <th></th>
        <th style="text-align:center">Java Nio连接器<br>蔚来</th>
        <th style="text-align:center">Java Nio2连接器<br>NIO2</th>
        <th style="text-align:center">APR /本地连接器<br>年利率</th>
      </tr>
      <tr>
        <th>班级名称</th>
        <td><code class="noHighlight">AjpNioProtocol</code></td>
        <td><code class="noHighlight">AjpNio2Protocol</code></td>
        <td><code class="noHighlight">AjpAprProtocol</code></td>
      </tr>
      <tr>
        <th>Tomcat版本</th>
        <td>从7.x开始</td>
        <td>从8.x开始</td>
        <td>5.5.x以上</td>
      </tr>
      <tr>
        <th>支持轮询</th>
        <td>是</td>
        <td>是</td>
        <td>是</td>
      </tr>
      <tr>
        <th>轮询大小</th>
        <td><code class="noHighlight">maxConnections</code></td>
        <td><code class="noHighlight">maxConnections</code></td>
        <td><code class="noHighlight">maxConnections</code></td>
      </tr>
      <tr>
        <th>读取请求标题</th>
        <td>封锁</td>
        <td>封锁</td>
        <td>封锁</td>
      </tr>
      <tr>
        <th>读取请求正文</th>
        <td>封锁</td>
        <td>封锁</td>
        <td>封锁</td>
      </tr>
      <tr>
        <th>写响应标题和正文</th>
        <td>封锁</td>
        <td>封锁</td>
        <td>封锁</td>
      </tr>
      <tr>
        <th>等待下一个请求</th>
        <td>非阻塞</td>
        <td>非阻塞</td>
        <td>非阻塞</td>
      </tr>
      <tr>
        <th>最大连接数</th>
        <td><code class="noHighlight">maxConnections</code></td>
        <td><code class="noHighlight">maxConnections</code></td>
        <td><code class="noHighlight">maxConnections</code></td>
      </tr>
    </tbody></table>

  </div></div>

</div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="../comments.html">这里</a>解释<a href="../comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>