<html lang="zh-Hans" ><head></head><body >﻿<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="../images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9配置参考（9.0.21）-容器提供的过滤器</title><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/config/filter">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="../images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="../images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>Apache Tomcat 9配置参考</h1><div class="versionInfo">版本9.0.21， <time datetime="2019-06-04"> 2019年6月4日</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>链接</h2><ul><li><a href="../index.html">文件首页</a></li><li><a href="index.html">配置参考家</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">常问问题</a></li><li><a href="#comments_section">用户评论</a></li></ul></div><div><h2>顶级元素</h2><ul><li><a href="server.html">服务器</a></li><li><a href="service.html">服务</a></li></ul></div><div><h2>执行者</h2><ul><li><a href="executor.html">执行者</a></li></ul></div><div><h2>连接器</h2><ul><li><a href="http.html">HTTP / 1.1</a></li><li><a href="http2.html">HTTP / 2</a></li><li><a href="ajp.html">AJP</a></li></ul></div><div><h2>货柜</h2><ul><li><a href="context.html">语境</a></li><li><a href="engine.html">发动机</a></li><li><a href="host.html">主办</a></li><li><a href="cluster.html">簇</a></li></ul></div><div><h2>嵌套组件</h2><ul><li><a href="cookie-processor.html">Cookie处理器</a></li><li><a href="credentialhandler.html">凭证处理程序</a></li><li><a href="globalresources.html">全球资源</a></li><li><a href="jar-scanner.html">JarScanner</a></li><li><a href="jar-scan-filter.html">JarScanFilter</a></li><li><a href="listeners.html">听众</a></li><li><a href="loader.html">装载机</a></li><li><a href="manager.html">经理</a></li><li><a href="realm.html">领域</a></li><li><a href="resources.html">资源资源</a></li><li><a href="sessionidgenerator.html">SessionIdGenerator</a></li><li><a href="valve.html">阀</a></li></ul></div><div><h2>集群元素</h2><ul><li><a href="cluster.html">簇</a></li><li><a href="cluster-manager.html">经理</a></li><li><a href="cluster-channel.html">渠道</a></li><li><a href="cluster-membership.html">频道/会员</a></li><li><a href="cluster-sender.html">频道/发件人</a></li><li><a href="cluster-receiver.html">频道/接收器</a></li><li><a href="cluster-interceptor.html">通道/拦截器</a></li><li><a href="cluster-valve.html">阀</a></li><li><a href="cluster-deployer.html">部署者</a></li><li><a href="cluster-listener.html">集群监听器</a></li></ul></div><div><h2>web.xml</h2><ul><li><a href="filter.html">过滤</a></li></ul></div><div><h2>其他</h2><ul><li><a href="systemprops.html">系统属性</a></li><li><a href="jaspic.html">日本宝石</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>容器提供的过滤器</h2><h3 id="Table_of_Contents">目录</h3><div class="text">
<ul><li><a href="#Introduction">介绍</a></li><li><a href="#Add_Default_Character_Set_Filter">添加默认字符集过滤器</a><ol><li><a href="#Add_Default_Character_Set_Filter/Introduction">介绍</a></li><li><a href="#Add_Default_Character_Set_Filter/Filter_Class_Name">过滤器类别名称</a></li><li><a href="#Add_Default_Character_Set_Filter/Initialisation_parameters">初始化参数</a></li></ol></li><li><a href="#CORS_Filter">CORS过滤器</a><ol><li><a href="#CORS_Filter/Introduction">介绍</a></li><li><a href="#CORS_Filter/Filter_Class_Name">过滤器类别名称</a></li><li><a href="#CORS_Filter/Initialisation_parameters">初始化参数</a></li><li><a href="#CORS_Filter_and_HttpServletRequest_attributes">CORS筛选器和HttpServletRequest属性</a></li></ol></li><li><a href="#CSRF_Prevention_Filter">CSRF预防过滤器</a><ol><li><a href="#CSRF_Prevention_Filter/Introduction">介绍</a></li><li><a href="#CSRF_Prevention_Filter/Filter_Class_Name">过滤器类别名称</a></li><li><a href="#CSRF_Prevention_Filter/Initialisation_parameters">初始化参数</a></li></ol></li><li><a href="#CSRF_Prevention_Filter_for_REST_APIs">REST API的CSRF预防过滤器</a><ol><li><a href="#CSRF_Prevention_Filter_for_REST_APIs/Introduction">介绍</a></li><li><a href="#CSRF_Prevention_Filter_for_REST_APIs/Basic_configuration_sample">基本配置样本</a></li><li><a href="#RestCsrfPreventionFilter_and_HttpServletRequest_parameters">RestCsrfPreventionFilter和HttpServletRequest参数</a></li><li><a href="#CSRF_Prevention_Filter_for_REST_APIs/Filter_Class_Name">过滤器类别名称</a></li><li><a href="#CSRF_Prevention_Filter_for_REST_APIs/Initialisation_parameters">初始化参数</a></li></ol></li><li><a href="#Expires_Filter">过期过滤器</a><ol><li><a href="#Expires_Filter/Introduction">介绍</a></li><li><a href="#Expires_Filter/Basic_configuration_sample">基本配置样本</a></li><li><a href="#Alternate_Syntax">替代语法</a></li><li><a href="#Expiration_headers_generation_eligibility">到期标头生成资格</a></li><li><a href="#Expiration_configuration_selection">到期配置选择</a></li><li><a href="#Expires_Filter/Filter_Class_Name">过滤器类别名称</a></li><li><a href="#Expires_Filter/Initialisation_parameters">初始化参数</a></li><li><a href="#Troubleshooting">故障排除</a></li></ol></li><li><a href="#Failed_Request_Filter">请求过滤失败</a><ol><li><a href="#Failed_Request_Filter/Introduction">介绍</a></li><li><a href="#Failed_Request_Filter/Filter_Class_Name">过滤器类别名称</a></li><li><a href="#Failed_Request_Filter/Initialisation_parameters">初始化参数</a></li></ol></li><li><a href="#HTTP_Header_Security_Filter">HTTP标头安全性过滤器</a><ol><li><a href="#HTTP_Header_Security_Filter/Introduction">介绍</a></li><li><a href="#HTTP_Header_Security_Filter/Filter_Class_Name">过滤器类别名称</a></li><li><a href="#HTTP_Header_Security_Filter/Initialisation_parameters">初始化参数</a></li></ol></li><li><a href="#Remote_Address_Filter">远程地址过滤器</a><ol><li><a href="#Remote_Address_Filter/Introduction">介绍</a></li><li><a href="#Remote_Address_Filter/Filter_Class_Name">过滤器类别名称</a></li><li><a href="#Remote_Address_Filter/Initialisation_parameters">初始化参数</a></li><li><a href="#Remote_Address_Filter/Example">例</a></li></ol></li><li><a href="#Remote_Host_Filter">远程主机过滤器</a><ol><li><a href="#Remote_Host_Filter/Introduction">介绍</a></li><li><a href="#Remote_Host_Filter/Filter_Class_Name">过滤器类别名称</a></li><li><a href="#Remote_Host_Filter/Initialisation_parameters">初始化参数</a></li></ol></li><li><a href="#Remote_CIDR_Filter">远程CIDR筛选器</a><ol><li><a href="#Remote_CIDR_Filter/Introduction">介绍</a></li><li><a href="#Remote_CIDR_Filter/Filter_Class_Name">过滤器类别名称</a></li><li><a href="#Remote_CIDR_Filter/Initialisation_parameters">初始化参数</a></li><li><a href="#Remote_CIDR_Filter/Example">例</a></li></ol></li><li><a href="#Remote_IP_Filter">远程IP过滤器</a><ol><li><a href="#Remote_IP_Filter/Introduction">介绍</a></li><li><a href="#Remote_IP_Filter/Filter_Class_Name">过滤器类别名称</a></li><li><a href="#Basic_configuration_to_handle_'x-forwarded-for'">处理“ x-forward-for”的基本配置</a></li><li><a href="#Basic_configuration_to_handle_'x-forwarded-for'_and_'x-forwarded-proto'">处理“ x-forwarded-for”和“ x-forwarded-proto”的基本配置</a></li><li><a href="#Advanced_configuration_with_internal_proxies">具有内部代理的高级配置</a></li><li><a href="#Advanced_configuration_with_trusted_proxies">带有受信任代理的高级配置</a></li><li><a href="#Advanced_configuration_with_internal_and_trusted_proxies">具有内部和受信任代理的高级配置</a></li><li><a href="#Advanced_configuration_with_an_untrusted_proxy">具有不受信任的代理的高级配置</a></li><li><a href="#Remote_IP_Filter/Initialisation_parameters">初始化参数</a></li></ol></li><li><a href="#Request_Dumper_Filter">请求自卸车过滤器</a><ol><li><a href="#Request_Dumper_Filter/Introduction">介绍</a></li><li><a href="#Request_Dumper_Filter/Filter_Class_Name">过滤器类别名称</a></li><li><a href="#Request_Dumper_Filter/Initialisation_parameters">初始化参数</a></li><li><a href="#Request_Dumper_Filter/Sample_Configuration">样本配置</a></li></ol></li><li><a href="#Session_Initializer_Filter">会话初始化过滤器</a><ol><li><a href="#Session_Initializer_Filter/Introduction">介绍</a></li><li><a href="#Session_Initializer_Filter/Filter_Class_Name">过滤器类别名称</a></li><li><a href="#Session_Initializer_Filter/Initialisation_parameters">初始化参数</a></li><li><a href="#Session_Initializer_Filter/Sample_Configuration">样本配置</a></li></ol></li><li><a href="#Set_Character_Encoding_Filter">设置字符编码过滤器</a><ol><li><a href="#Set_Character_Encoding_Filter/Introduction">介绍</a></li><li><a href="#Set_Character_Encoding_Filter/Filter_Class_Name">过滤器类别名称</a></li><li><a href="#Set_Character_Encoding_Filter/Initialisation_parameters">初始化参数</a></li></ol></li><li><a href="#WebDAV_Fix_Filter">WebDAV修复过滤器</a><ol><li><a href="#WebDAV_Fix_Filter/Introduction">介绍</a></li><li><a href="#WebDAV_Fix_Filter/Filter_Class_Name">过滤器类别名称</a></li><li><a href="#WebDAV_Fix_Filter/Initialisation_parameters">初始化参数</a></li></ol></li></ul>
</div><h3 id="Introduction">介绍</h3><div class="text">

  <p>Tomcat提供了许多<strong>过滤器</strong> ，这些<strong>过滤器</strong>可以配置为与使用以下命令的所有Web应用程序一起使用<code>$CATALINA_BASE/conf/web.xml</code>或可以通过在应用程序的<code>WEB-INF/web.xml</code> 。每个过滤器如下所述。</p>

    <p><em>此描述使用变量名$ CATALINA_BASE来引用可解决大多数相对路径的基本目录。如果尚未通过设置CATALINA_BASE目录为多个实例配置Tomcat，则$ CATALINA_BASE将设置为$ CATALINA_HOME的值，该目录已将Tomcat安装到该目录中。</em></p>

</div><h3 id="Add_Default_Character_Set_Filter">添加默认字符集过滤器</h3><div class="text">

  <div class="subsection"><h4 id="Add_Default_Character_Set_Filter/Introduction">介绍</h4><div class="text">

    <p>HTTP规范明确指出，如果没有为“文本”媒体类型的媒体子类型指定任何字符集，则必须使用ISO-8859-1字符集。但是，浏览器可能会尝试自动检测字符集。攻击者可能利用此漏洞执行XSS攻击。Internet Explorer和其他浏览器都有启用此行为的选项。</p>

    <p>该过滤器通过显式设置字符集来防止攻击。除非提供的字符集被用户显式覆盖，否则浏览器将遵守显式设置的字符集，从而防止XSS攻击。</p>

  </div></div>

  <div class="subsection"><h4 id="Add_Default_Character_Set_Filter/Filter_Class_Name">过滤器类别名称</h4><div class="text">

    <p>添加默认字符集过滤器的过滤器类名称为<strong><code>org.apache.catalina.filters.AddDefaultCharsetFilter</code></strong> 。</p>

  </div></div>

  <div class="subsection"><h4 id="Add_Default_Character_Set_Filter/Initialisation_parameters">初始化参数</h4><div class="text">

    <p>添加默认字符集过滤器支持以下初始化参数：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">encoding</code></td><td>
        <p>如果Servlet没有显式设置其他字符集，则应设置的字符集名称。此参数有两个特殊值<code>default</code>和<code>system</code> 。值<code>system</code>使用JVM范围内的默认字符集，通常由语言环境设置。值<code>default</code>将使用<strong>ISO-8859-1</strong> 。</p>
      </td></tr></tbody></table>

  </div></div>

</div><h3 id="CORS_Filter">CORS过滤器</h3><div class="text">
  <div class="subsection"><h4 id="CORS_Filter/Introduction">介绍</h4><div class="text">
    <p>此筛选器是W3C的CORS（跨源资源共享） <a href="https://www.w3.org/TR/cors/">规范的实现</a> ，该<a href="https://www.w3.org/TR/cors/">规范</a>是一种启用跨域请求的机制。</p>
    <p>过滤器通过添加必需项来工作<code>Access-Control-*</code> HttpServletResponse对象的标头。该过滤器还可以防止HTTP响应拆分。如果请求无效或不允许，则将使用HTTP状态代码403（禁止）拒绝请求。可以使用<a href="../images/cors-flowchart.png">流程图</a>演示此过滤器的请求处理。</p>
    <p>使用此过滤器所需的最低配置为：</p>
    <div class="codeBox"><pre><code>&lt;filter&gt;
  &lt;filter-name&gt;CorsFilter&lt;/filter-name&gt;
  &lt;filter-class&gt;org.apache.catalina.filters.CorsFilter&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
  &lt;filter-name&gt;CorsFilter&lt;/filter-name&gt;
  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;</code></pre></div>
    <p>以上配置启用了过滤器，但没有放宽跨域策略。至少，您将需要添加如下所述的<strong>cors.allowed.origins</strong>初始化参数，以启用跨域请求。根据您的要求，您可能需要提供其他配置。</p>
    <p>此过滤器的一个实例只能实现一个策略。如果要对Web应用程序中的不同URL或URL集应用不同的策略（例如，不同的允许的来源），则需要为每个要配置的策略配置此过滤器的单独实例。</p>
  </div></div>
  <div class="subsection"><h4 id="CORS_Filter/Filter_Class_Name">过滤器类别名称</h4><div class="text">
    <p>CORS过滤器的过滤器类名称为<strong><code>org.apache.catalina.filters.CorsFilter</code></strong> 。</p>
  </div></div>
  <div class="subsection"><h4 id="CORS_Filter/Initialisation_parameters">初始化参数</h4><div class="text">
    <p>CORS筛选器支持以下初始化参数：</p>
    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">cors.allowed.origins</code></td><td>
        <p>允许访问资源的<a href="https://tools.ietf.org/html/rfc6454">来源</a>列表。一种<code>*</code>可以指定以允许从任何来源访问资源。否则，可以提供逗号分隔的来源白名单。例如： <code>https://www.w3.org, https://www.apache.org</code> 。
        <strong>默认值：</strong>空字符串。（不允许任何来源访问资源）。</p>
      </td></tr><tr><td><code class="attributeName">cors.allowed.methods</code></td><td>
        <p>逗号分隔的HTTP方法列表，可用于使用跨域请求访问资源。这些方法也将包含在其中<code>Access-Control-Allow-Methods</code>飞行前响应中的标题。例如： <code>GET, POST</code> 。
        <strong>默认值：</strong> <code>GET, POST, HEAD, OPTIONS</code></p>
      </td></tr><tr><td><code class="attributeName">cors.allowed.headers</code></td><td>
        <p>逗号分隔的请求标头列表，可在发出实际请求时使用。这些标头也将作为的一部分返回<code>Access-Control-Allow-Headers</code>飞行前响应中的标题。例如： <code>Origin,Accept</code> 。<strong>默认值：</strong>
        <code>Origin, Accept, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers</code></p>
      </td></tr><tr><td><code class="attributeName">cors.exposed.headers</code></td><td>
        <p>除允许浏览器访问的简单响应标头以外，标头以逗号分隔的列表。这些标头也将包含在其中<code>Access-Control-Expose-Headers</code>飞行前响应中的标头。例如： <code>X-CUSTOM-HEADER-PING,X-CUSTOM-HEADER-PONG</code> 。
        <strong>默认值：</strong>无。默认情况下，不公开非简单标头。</p>
      </td></tr><tr><td><code class="attributeName">cors.preflight.maxage</code></td><td>
        <p>允许浏览器缓存飞行前请求结果的秒数。这将包含在其中<code>Access-Control-Max-Age</code>飞行前响应中的标头。负值将阻止CORS筛选器将此响应标头添加到飞行前响应。<strong>默认值：</strong>
        <code>1800</code></p>
      </td></tr><tr><td><code class="attributeName">cors.support.credentials</code></td><td>
        <p>一个标志，指示资源是否支持用户凭据。此标志作为<code>Access-Control-Allow-Credentials</code>飞行前响应中的标题。它可以帮助浏览器确定是否可以使用凭据发出实际请求。<strong>默认值：</strong>
        <code>false</code></p>
      </td></tr><tr><td><code class="attributeName">cors.request.decorate</code></td><td>
        <p>一个标志，用于控制是否应将CORS特定属性添加到HttpServletRequest对象。<strong>默认值：</strong>
        <code>true</code></p>
      </td></tr></tbody></table>
    <p>这是一个更高级的配置示例，它将覆盖默认值：</p>
    <div class="codeBox"><pre><code>&lt;filter&gt;
  &lt;filter-name&gt;CorsFilter&lt;/filter-name&gt;
  &lt;filter-class&gt;org.apache.catalina.filters.CorsFilter&lt;/filter-class&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;cors.allowed.origins&lt;/param-name&gt;
    &lt;param-value&gt;https://www.apache.org&lt;/param-value&gt;
  &lt;/init-param&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;cors.allowed.methods&lt;/param-name&gt;
    &lt;param-value&gt;GET,POST,HEAD,OPTIONS,PUT&lt;/param-value&gt;
  &lt;/init-param&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;cors.allowed.headers&lt;/param-name&gt;
    &lt;param-value&gt;Content-Type,X-Requested-With,accept,Origin,Access-Control-Request-Method,Access-Control-Request-Headers&lt;/param-value&gt;
  &lt;/init-param&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;cors.exposed.headers&lt;/param-name&gt;
    &lt;param-value&gt;Access-Control-Allow-Origin,Access-Control-Allow-Credentials&lt;/param-value&gt;
  &lt;/init-param&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;cors.support.credentials&lt;/param-name&gt;
    &lt;param-value&gt;true&lt;/param-value&gt;
  &lt;/init-param&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;cors.preflight.maxage&lt;/param-name&gt;
    &lt;param-value&gt;10&lt;/param-value&gt;
  &lt;/init-param&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
  &lt;filter-name&gt;CorsFilter&lt;/filter-name&gt;
  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;</code></pre></div>
  </div></div>
  <div class="subsection"><h4 id="CORS_Filter_and_HttpServletRequest_attributes">CORS筛选器和HttpServletRequest属性</h4><div class="text">
    <p>CORS筛选器在HttpServletRequest对象中添加有关请求的信息，以供下游使用。如果设置以下属性<code>cors.request.decorate</code>初始化参数为<code>true</code> ：</p>
    <ul>
      <li><strong>cors.isCorsRequest：</strong>标记以确定请求是否为CORS请求。</li>
      <li><strong>cors.request.origin：</strong>原始URL，即发出请求的页面的URL。</li>
      <li><strong>cors.request.type：</strong> CORS请求的类型。可能的值：<ul>
          <li><code>SIMPLE</code> ：没有飞行前请求的请求。</li>
          <li><code>ACTUAL</code> ：先于飞行前请求的请求。</li>
          <li><code>PRE_FLIGHT</code> ：飞行前请求。</li>
          <li><code>NOT_CORS</code> ：正常的同源请求。</li>
          <li><code>INVALID_CORS</code> ：跨域请求，该请求无效。</li>
        </ul>
      </li>
      <li><strong>cors.request.headers：</strong>请求标头发送为<code>Access-Control-Request-Headers</code>标头，用于飞行前请求。</li>
    </ul>
  </div></div>
</div><h3 id="CSRF_Prevention_Filter">CSRF预防过滤器</h3><div class="text">

  <div class="subsection"><h4 id="CSRF_Prevention_Filter/Introduction">介绍</h4><div class="text">

    <p>此筛选器为Web应用程序提供基本的CSRF保护。过滤器假定它已映射到<code>/*</code>并且返回给客户端的所有URL均通过调用进行编码<code>HttpServletResponse#encodeRedirectURL(String)</code>要么<code>HttpServletResponse#encodeURL(String)</code> 。</p>

    <p>该过滤器通过生成随机数并将其存储在会话中来防止CSRF。URL也使用相同的随机数进行编码。当接收到下一个请求时，将请求中的随机数与会话中的随机数进行比较，并且只有它们相同时才允许继续请求。</p>

  </div></div>

  <div class="subsection"><h4 id="CSRF_Prevention_Filter/Filter_Class_Name">过滤器类别名称</h4><div class="text">

    <p>CSRF预防筛选器的筛选器类名称为<strong><code>org.apache.catalina.filters.CsrfPreventionFilter</code></strong> 。</p>

  </div></div>

  <div class="subsection"><h4 id="CSRF_Prevention_Filter/Initialisation_parameters">初始化参数</h4><div class="text">

    <p>CSRF预防筛选器支持以下初始化参数：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">denyStatus</code></td><td>
        <p>拒绝被拒绝的请求时使用的HTTP响应状态代码。默认值为<code>403</code> 。</p>
      </td></tr><tr><td><code class="attributeName">entryPoints</code></td><td>
        <p>逗号分隔的URL列表，将不会测试是否存在有效的随机数。它们用于提供一种在离开受保护的应用程序后导航回到受保护的应用程序的方法。入口点将仅限于HTTP GET请求，并且不应触发任何对安全性敏感的操作。</p>
      </td></tr><tr><td><code class="attributeName">nonceCacheSize</code></td><td>
        <p>将在LRU的基础上缓存以支持并行请求的先前发出的随机数，在浏览器中有限地使用刷新和返回，以及类似的行为，可能导致提交先前的随机数而不是当前的随机数。如果未设置，将使用默认值5。</p>
      </td></tr><tr><td><code class="attributeName">randomClass</code></td><td>
        <p>用于生成随机数的类的名称。该类必须是的实例<code>java.util.Random</code> 。如果未设置，则默认值为<code>java.security.SecureRandom</code>将会被使用。</p>
      </td></tr></tbody></table>

  </div></div>

</div><h3 id="CSRF_Prevention_Filter_for_REST_APIs">REST API的CSRF预防过滤器</h3><div class="text">

  <div class="subsection"><h4 id="CSRF_Prevention_Filter_for_REST_APIs/Introduction">介绍</h4><div class="text">

    <p>该过滤器为REST API提供基本的CSRF保护。 CSRF保护仅适用于将HTTP请求（与GET，HEAD，OPTIONS不同）修改为受保护的资源。它基于自定义标头<code>X-CSRF-Token</code>提供有效的随机数。</p>

    <p>REST API的CSRF保护机制包括以下步骤：</p><ul>
        <li>客户要求有效的随机数。这是通过对受保护资源进行的非修改“获取”请求来执行的。</li>
        <li>服务器以映射到当前用户会话的有效随机数作为响应。</li>
        <li>客户端在同一用户会话的框架中的后续修改请求中提供此随机数。</li>
        <li>服务器拒绝对不包含有效随机数的受保护资源的所有修改请求。</li>
      </ul>
    <p></p>

  </div></div>

  <div class="subsection"><h4 id="CSRF_Prevention_Filter_for_REST_APIs/Basic_configuration_sample">基本配置样本</h4><div class="text">

    <p>在服务器端</p>

    <ul>
      <li>所有受CSRF保护的REST API都应使用身份验证机制进行保护。</li>
      <li>使用此过滤器保护修改的REST API。</li>
      <li>提供至少一项非修改操作。</li>
    </ul>
      <div class="codeBox"><pre><code>&lt;filter&gt;
  &lt;filter-name&gt;RestCSRF&lt;/filter-name&gt;
  &lt;filter-class&gt;org.apache.catalina.filters.RestCsrfPreventionFilter&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
  &lt;filter-name&gt;RestCSRF&lt;/filter-name&gt;
  &lt;!-- Modifying operations --&gt;
  &lt;url-pattern&gt;/resources/removeResource&lt;/url-pattern&gt;
  &lt;url-pattern&gt;/resources/addResource&lt;/url-pattern&gt;
  &lt;!-- Non-modifying operations --&gt;
  &lt;url-pattern&gt;/resources/listResources&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;</code></pre></div>

    <p>在客户端</p>

    <ul>
      <li>进行非修改的“提取”请求，以获得有效的随机数。这可以通过发送其他标头来完成<code>X-CSRF-Token: Fetch</code></li>
      <li>缓存返回的会话ID和随机数，以便在随后对受保护资源的修改请求中提供它们。</li>
      <li>修改请求可以被拒绝并且标头<code>X-CSRF-Token: Required</code>如果无效或丢失的随机数，会话过期或服务器更改了会话ID，则将返回。</li>
    </ul>
      <div class="codeBox"><pre><code>Client Request:
GET /rest/resources/listResources HTTP/1.1
X-CSRF-Token: Fetch
Authorization: Basic ...
Host: localhost:8080
...

Server Response:
HTTP/1.1 200 OK
Set-Cookie: JSESSIONID=...; Path=/rest; HttpOnly
X-CSRF-Token: ...
...

Client Request:
POST /rest/resources/addResource HTTP/1.1
Cookie: JSESSIONID=...
X-CSRF-Token: ...
Authorization: Basic ...
Host: localhost:8080
...

Server Response:
HTTP/1.1 200 OK
...</code></pre></div>

  </div></div>

  <div class="subsection"><h4 id="RestCsrfPreventionFilter_and_HttpServletRequest_parameters">RestCsrfPreventionFilter和HttpServletRequest参数</h4><div class="text">

    <p>如果客户端无法在其对REST API的调用中插入自定义标头，则可以使用其他功能来配置URL，对于这些URL，将接受有效的随机数作为请求参数。</p>

    <p>注意：如果有<code>X-CSRF-Token</code>标头，优先于请求中具有相同名称的任何参数。请求参数不能用于获取新的随机数，只能使用标头来请求新的随机数。</p>

    <div class="codeBox"><pre><code>&lt;filter&gt;
  &lt;filter-name&gt;RestCSRF&lt;/filter-name&gt;
  &lt;filter-class&gt;org.apache.catalina.filters.RestCsrfPreventionFilter&lt;/filter-class&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;pathsAcceptingParams&lt;/param-name&gt;
    &lt;param-value&gt;/resources/removeResource,/resources/addResource&lt;/param-value&gt;
  &lt;/init-param&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
  &lt;filter-name&gt;RestCSRF&lt;/filter-name&gt;
  &lt;url-pattern&gt;/resources/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;</code></pre></div>

  </div></div>

  <div class="subsection"><h4 id="CSRF_Prevention_Filter_for_REST_APIs/Filter_Class_Name">过滤器类别名称</h4><div class="text">

    <p>REST API的CSRF预防性过滤器的过滤器类名称为<strong><code>org.apache.catalina.filters.RestCsrfPreventionFilter</code></strong> 。</p>

  </div></div>

  <div class="subsection"><h4 id="CSRF_Prevention_Filter_for_REST_APIs/Initialisation_parameters">初始化参数</h4><div class="text">

    <p>REST API的CSRF预防筛选器支持以下初始化参数：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">denyStatus</code></td><td>
        <p>拒绝被拒绝的请求时使用的HTTP响应状态代码。默认值为<code>403</code> 。</p>
      </td></tr><tr><td><code class="attributeName">pathsAcceptingParams</code></td><td>
        <p>网址的逗号分隔列表，可以通过请求参数接受随机数<code>X-CSRF-Token</code> 。对于无法通过头提供随机数信息的用例，可以通过请求参数来提供。如果有<code>X-CSRF-Token</code>标头，优先于请求中具有相同名称的任何参数。请求参数不能用于获取新的随机数，只能使用标头来请求新的随机数。</p>
      </td></tr><tr><td><code class="attributeName">randomClass</code></td><td>
        <p>用于生成随机数的类的名称。该类必须是的实例<code>java.util.Random</code> 。如果未设置，则默认值为<code>java.security.SecureRandom</code>将会被使用。</p>
      </td></tr></tbody></table>

  </div></div>

</div><h3 id="Expires_Filter">过期过滤器</h3><div class="text">

  <div class="subsection"><h4 id="Expires_Filter/Introduction">介绍</h4><div class="text">

    <p>ExpiresFilter是<a href="https://httpd.apache.org/docs/2.2/mod/mod_expires.html">Apache mod_expires</a>的Java Servlet API端口。此过滤器控制<code>Expires</code> HTTP标头和<code>max-age</code>的指令<code>Cache-Control</code>服务器响应中的HTTP标头。可以将到期日期设置为相对于上次修改源文件的时间，还是相对于客户端访问的时间。
    </p>

    <p>这些HTTP标头是对客户端的有关文档有效性和持久性的指令。如果已缓存，则可以从缓存中而不是从源中获取文档，直到该时间过去为止。之后，缓存副本被视为“过期”且无效，并且必须从源中获取新副本。
    </p>
    <p>修改<code>Cache-Control</code>指令以外的<code>max-age</code> （请参阅<a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9">RFC 2616第14.9节</a> ），可以使用其他servlet过滤器或<a href="https://httpd.apache.org/docs/2.2/mod/mod_headers.html">Apache Httpd mod_headers</a>模块。
    </p>

  </div></div>

  <div class="subsection"><h4 id="Expires_Filter/Basic_configuration_sample">基本配置样本</h4><div class="text">
    <p>基本配置中添加“ <code>Expires</code> '和' <code>Cache-Control: max-age=</code> '图片，css和javascript的标头。
    </p>

    <div class="codeBox"><pre><code>&lt;filter&gt;
 &lt;filter-name&gt;ExpiresFilter&lt;/filter-name&gt;
 &lt;filter-class&gt;org.apache.catalina.filters.ExpiresFilter&lt;/filter-class&gt;
 &lt;init-param&gt;
    &lt;param-name&gt;ExpiresByType image&lt;/param-name&gt;
    &lt;param-value&gt;access plus 10 minutes&lt;/param-value&gt;
 &lt;/init-param&gt;
 &lt;init-param&gt;
    &lt;param-name&gt;ExpiresByType text/css&lt;/param-name&gt;
    &lt;param-value&gt;access plus 10 minutes&lt;/param-value&gt;
 &lt;/init-param&gt;
 &lt;init-param&gt;
    &lt;param-name&gt;ExpiresByType application/javascript&lt;/param-name&gt;
    &lt;param-value&gt;access plus 10 minutes&lt;/param-value&gt;
 &lt;/init-param&gt;
&lt;/filter&gt;
...
&lt;filter-mapping&gt;
 &lt;filter-name&gt;ExpiresFilter&lt;/filter-name&gt;
 &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
 &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
&lt;/filter-mapping&gt;</code></pre></div>

  </div></div>

  <div class="subsection"><h4 id="Alternate_Syntax">替代语法</h4><div class="text">
    <p>的<code>ExpiresDefault</code>和<code>ExpiresByType</code>指令也可以采用以下形式的可读性更高的语法进行定义：</p>

    <div class="codeBox"><pre><code>&lt;init-param&gt;
 &lt;param-name&gt;ExpiresDefault&lt;/param-name&gt;
 &lt;param-value&gt;&lt;base&gt; [plus] {&lt;num&gt; &lt;type&gt;}*&lt;/param-value&gt;
&lt;/init-param&gt;

&lt;init-param&gt;
 &lt;param-name&gt;ExpiresByType type&lt;/param-name&gt;
 &lt;param-value&gt;&lt;base&gt; [plus] {&lt;num&gt; &lt;type&gt;}*&lt;/param-value&gt;
&lt;/init-param&gt;

&lt;init-param&gt;
 &lt;param-name&gt;ExpiresByType type;encoding&lt;/param-name&gt;
 &lt;param-value&gt;&lt;base&gt; [plus] {&lt;num&gt; &lt;type&gt;}*&lt;/param-value&gt;
&lt;/init-param&gt;</code></pre></div>
    <p>哪里<code><base></code>是其中之一：</p>
    <ul>
    <li><code>access</code></li>
    <li><code>now</code> （相当于 ' <code>access</code> '）</li>
    <li><code>modification</code></li>
    </ul>

    <p>的<code>plus</code>关键字是可选的。 <code><num></code>应为整数值（可接受<code>Integer.parseInt()</code> ），以及<code><type></code>是其中之一：</p>
    <ul>
    <li><code>year</code> ，<code>years</code></li>
    <li><code>month</code> ，<code>months</code></li>
    <li><code>week</code> ，<code>weeks</code></li>
    <li><code>day</code> ，<code>days</code></li>
    <li><code>hour</code> ，<code>hours</code></li>
    <li><code>minute</code> ，<code>minutes</code></li>
    <li><code>second</code> ，<code>seconds</code></li>
    </ul>
    <p>例如，默认情况下，以下任何伪指令可用于使文档在访问后1个月后过期：</p>

    <div class="codeBox"><pre><code>&lt;init-param&gt;
 &lt;param-name&gt;ExpiresDefault&lt;/param-name&gt;
 &lt;param-value&gt;access plus 1 month&lt;/param-value&gt;
&lt;/init-param&gt;

&lt;init-param&gt;
 &lt;param-name&gt;ExpiresDefault&lt;/param-name&gt;
 &lt;param-value&gt;access plus 4 weeks&lt;/param-value&gt;
&lt;/init-param&gt;

&lt;init-param&gt;
 &lt;param-name&gt;ExpiresDefault&lt;/param-name&gt;
 &lt;param-value&gt;access plus 30 days&lt;/param-value&gt;
&lt;/init-param&gt;</code></pre></div>
<p>可以通过添加多个“ <code><num> <type></code> '子句：</p>

<div class="codeBox"><pre><code>&lt;init-param&gt;
 &lt;param-name&gt;ExpiresByType text/html&lt;/param-name&gt;
 &lt;param-value&gt;access plus 1 month 15 days 2 hours&lt;/param-value&gt;
&lt;/init-param&gt;

&lt;init-param&gt;
 &lt;param-name&gt;ExpiresByType image/gif&lt;/param-name&gt;
 &lt;param-value&gt;modification plus 5 hours 3 minutes&lt;/param-value&gt;
&lt;/init-param&gt;</code></pre></div>
    <p>请注意，如果您使用基于修改日期的设置， <code>Expires</code>标头<strong>不会</strong>添加到不是来自磁盘上文件的内容中。这是由于没有针对此类内容的修改时间这一事实。
    </p>
  </div></div>

  <div class="subsection"><h4 id="Expiration_headers_generation_eligibility">到期标头生成资格</h4><div class="text">
    <p>回应有资格通过<code>ExpiresFilter</code>如果：</p>
    <ol>
    <li>没有定义过期标头（ <code>Expires</code>标头或<code>max-age</code>的指令<code>Cache-Control</code>标头），</li>
    <li>指令未排除响应状态代码<code>ExpiresExcludedResponseStatusCodes</code> ，</li>
    <li>的<code>Content-Type</code>的响应与in中定义的一种类型匹配<code>ExpiresByType</code>指令或<code>ExpiresDefault</code>指令已定义。</li>
    </ol>

    <p>注意：如果<code>Cache-Control</code>标头包含除<code>max-age</code> ，它们与<code>max-age</code>由添加的指令<code>ExpiresFilter</code> 。
    </p>

  </div></div>

  <div class="subsection"><h4 id="Expiration_configuration_selection">到期配置选择</h4><div class="text">
    <p>到期配置（如果根据以下算法选择）：</p>
    <ol>
    <li><code>ExpiresByType</code>匹配由返回的确切内容类型<code>HttpServletResponse.getContentType()</code>可能包括字符集（例如' <code>text/xml;charset=UTF-8</code> '），</li>
    <li><code>ExpiresByType</code>如果没有字符集，则匹配内容类型，如果<code>HttpServletResponse.getContentType()</code>包含一个字符集（例如' <code>text/xml;charset=UTF-8</code> '->' <code>text/xml</code> '），</li>
    <li><code>ExpiresByType</code>匹配主要类型（例如'前的子字符串<code>/</code> '） <code>HttpServletResponse.getContentType()</code> （例如，“ <code>text/xml;charset=UTF-8</code> '->' <code>text</code> '），</li>
    <li><code>ExpiresDefault</code></li>
    </ol>

  </div></div>

  <div class="subsection"><h4 id="Expires_Filter/Filter_Class_Name">过滤器类别名称</h4><div class="text">

    <p>过期过滤器的过滤器类名称为<strong><code>org.apache.catalina.filters.ExpiresFilter</code></strong> 。</p>

  </div></div>

  <div class="subsection"><h4 id="Expires_Filter/Initialisation_parameters">初始化参数</h4><div class="text">

    <p><strong>Expires筛选器</strong>支持以下初始化参数：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">ExpiresExcludedResponseStatusCodes</code></td><td>
         <p>该指令定义了http响应状态代码， <code>ExpiresFilter</code>将不会生成过期标头。默认情况下， <code>304</code>状态码（“ <code>Not modified</code> “）被跳过。该值是逗号分隔的http状态代码列表。
         </p>
         <p>该指令对于简化使用<code>ExpiresDefault</code>指示。确实， <code>304 Not modified</code> （它确实指定了一个<code>Content-Type</code>标头）与<code>Expires</code>和<code>Cache-Control:max-age=</code>标头可能很难理解。
         </p>
         <p><i>请参阅表格下方的样本</i></p>
      </td></tr><tr><td><code class="attributeName">ExpiresByType <content-type></code></td><td>
         <p>该指令定义了<code>Expires</code>标头和<code>max-age</code>的指令<code>Cache-Control</code>为指定类型的文档生成的标头（ <i>例如</i> ， <code>text/html</code> ）。第二个参数设置将添加到基准时间以构造到期日期的秒数。的<code>Cache-Control: max-age</code>通过从到期日期中减去请求时间并以秒表示结果来计算。
         </p>
         <p>基本时间可以是文件的最后修改时间，也可以是客户端访问文档的时间。应使用哪个由<code><code></code>领域; <code>M</code>表示文件的最后修改时间应用作基准时间，并且<code>A</code>表示应该使用客户端的访问时间。持续时间以秒表示。 <code>A2592000</code>代表<code>access plus 30 days</code>用其他语法。
         </p>
         <p>效果上的差别是微妙的。如果<code>M</code> （ <code>modification</code> （使用备用语法），所有高速缓存中文档的所有当前副本将在同一时间到期，这对于每周都在同一URL上找到每周通知等情况可能会有所帮助。如果<code>A</code> （ <code>access</code>要么<code>now</code>使用备用语法），则每个客户端的到期日期都不相同；这对于不经常更改的图像文件可能是好的，特别是对于一组都引用相同图像的相关文档（ <i>即</i> ，将在相对较短的时间范围内重复访问图像）而言。
         </p>
         <p>
         <strong>注意：</strong>当内容类型包含字符集时（例如， <code>'ExpiresByType text/xml;charset=utf-8'</code> ），Tomcat会删除“ <code>;</code>和<code>charset</code> '关键字。因此，具有字符集的到期配置必须<strong>不能</strong>包含这样的空格字符。
         </p>
         <p><i>请参阅表格下方的样本</i></p>
         <p><i>仅</i>对于指定的MIME类型，它会覆盖由设置的任何到期日期<code>ExpiresDefault</code>指示。
         </p>
         <p>您还可以使用本文档前面介绍的替代语法来指定到期时间计算。
         </p>
      </td></tr><tr><td><code class="attributeName">ExpiresDefault</code></td><td>
         <p>该指令设置默认算法，用于计算受影响领域中所有文档的到期时间。可以按类型逐个覆盖它。 <code>ExpiresByType</code>指示。有关该参数的语法以及“替代语法”的详细信息，请参见该指令的描述。
         </p>
      </td></tr></tbody></table>

    <p><i>示例：排除响应状态代码302、500和503</i></p>

<div class="codeBox"><pre><code>&lt;init-param&gt;
 &lt;param-name&gt;ExpiresExcludedResponseStatusCodes&lt;/param-name&gt;
 &lt;param-value&gt;302, 500, 503&lt;/param-value&gt;
&lt;/init-param&gt;</code></pre></div>

    <p><i>ExpiresByType初始化参数的样本</i></p>

         <div class="codeBox"><pre><code>&lt;init-param&gt;
   &lt;param-name&gt;ExpiresByType text/html&lt;/param-name&gt;
   &lt;param-value&gt;access plus 1 month 15   days 2 hours&lt;/param-value&gt;
&lt;/init-param&gt;

&lt;init-param&gt;
   &lt;!-- 2592000 seconds = 30 days --&gt;
   &lt;param-name&gt;ExpiresByType image/gif&lt;/param-name&gt;
   &lt;param-value&gt;A2592000&lt;/param-value&gt;
&lt;/init-param&gt;</code></pre></div>

  </div></div>

  <div class="subsection"><h4 id="Troubleshooting">故障排除</h4><div class="text">
    <p>要进行故障排除，请在<code>org.apache.catalina.filters.ExpiresFilter</code> 。
    </p>
    <p>logging.properties的摘录</p>

    <div class="codeBox"><pre><code>org.apache.catalina.filters.ExpiresFilter.level = FINE    </code></pre></div>
    <p>初始化日志消息样本：</p>

    <div class="codeBox"><pre><code>Mar 26, 2010 2:01:41 PM org.apache.catalina.filters.ExpiresFilter init
FINE: Filter initialized with configuration ExpiresFilter[
 excludedResponseStatusCode=[304],
 default=null,
 byType={
    image=ExpiresConfiguration[startingPoint=ACCESS_TIME, duration=[10 MINUTE]],
    text/css=ExpiresConfiguration[startingPoint=ACCESS_TIME, duration=[10 MINUTE]],
    text/javascript=ExpiresConfiguration[startingPoint=ACCESS_TIME, duration=[10 MINUTE]]}]</code></pre></div>
    <p>每个请求日志消息的示例，其中<code>ExpiresFilter</code>在下面添加一个到期日期。该消息在一行上，并包装在此处以提高可读性。
    </p>

    <div class="codeBox"><pre><code>Mar 26, 2010 2:09:47 PM org.apache.catalina.filters.ExpiresFilter onBeforeWriteResponseBody
FINE: Request "/tomcat.gif" with response status "200"
 content-type "image/gif", set expiration date 3/26/10 2:19 PM</code></pre></div>
    <p>每个请求日志消息的示例，其中<code>ExpiresFilter</code>不添加到期日期：</p>

    <div class="codeBox"><pre><code>Mar 26, 2010 2:10:27 PM org.apache.catalina.filters.ExpiresFilter onBeforeWriteResponseBody
FINE: Request "/docs/config/manager.html" with response status "200"
 content-type "text/html", no expiration configured</code></pre></div>
  </div></div>

</div><h3 id="Failed_Request_Filter">请求过滤失败</h3><div class="text">

  <div class="subsection"><h4 id="Failed_Request_Filter/Introduction">介绍</h4><div class="text">

    <p>如果由于解析错误或请求大小限制（例如， <code>maxParameterCount</code> <a href="http.html">连接器中的</a>属性）。该过滤器可用于确保不会丢失客户端提交的参数值。</p>

    <p>请注意，参数解析可能会消耗HTTP请求的正文，因此，如果此过滤器保护的servlet使用<code>request.getInputStream()</code>要么<code>request.getReader()</code>电话。通常，通过添加此过滤器来破坏Web应用程序的风险不是很高，因为参数解析会在使用请求主体之前检查请求的内容类型。</p>

    <p>请注意，要正确解析POST请求， <code>SetCharacterEncodingFilter</code>过滤器必须配置在此之上。有关详细信息，请参见FAQ中的CharacterEncoding页面。</p>

    <p>该请求将被HTTP状态代码400（错误请求）拒绝。</p>

  </div></div>

  <div class="subsection"><h4 id="Failed_Request_Filter/Filter_Class_Name">过滤器类别名称</h4><div class="text">

    <p>失败请求过滤器的过滤器类名称为<strong><code>org.apache.catalina.filters.FailedRequestFilter</code></strong> 。</p>

  </div></div>

  <div class="subsection"><h4 id="Failed_Request_Filter/Initialisation_parameters">初始化参数</h4><div class="text">

    <p>失败的请求过滤器不支持任何初始化参数。</p>

  </div></div>

</div><h3 id="HTTP_Header_Security_Filter">HTTP标头安全性过滤器</h3><div class="text">

  <div class="subsection"><h4 id="HTTP_Header_Security_Filter/Introduction">介绍</h4><div class="text">

    <p>可以将许多HTTP标头添加到响应中，以提高连接的安全性。该过滤器提供了添加这些标头的机制。注意，具有更复杂要求的与安全相关的标头（如CORS）被实现为单独的过滤器。</p>

  </div></div>

  <div class="subsection"><h4 id="HTTP_Header_Security_Filter/Filter_Class_Name">过滤器类别名称</h4><div class="text">

    <p>HTTP标头安全过滤器的过滤器类名称为<strong><code>org.apache.catalina.filters.HttpHeaderSecurityFilter</code></strong> 。</p>

  </div></div>

  <div class="subsection"><h4 id="HTTP_Header_Security_Filter/Initialisation_parameters">初始化参数</h4><div class="text">

    <p>HTTP标头安全筛选器支持以下初始化参数：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">hstsEnabled</code></td><td>
        <p>HTTP严格传输安全（HSTS）标头（ <code>Strict-Transport-Security</code> ）上设置安全请求的响应。任何已经存在的HSTS标头都将被替换。有关HSTS的更多详细信息，请参见<a href="https://tools.ietf.org/html/rfc6797">RFC 6797</a> 。如果未指定，则默认值为<code>true</code>将会被使用。</p>
      </td></tr><tr><td><code class="attributeName">hstsMaxAgeSeconds</code></td><td>
        <p>HSTS标头中应使用的最大年龄值。负值将被视为零。如果未指定，则默认值为<code>0</code>将会被使用。</p>
      </td></tr><tr><td><code class="attributeName">hstsIncludeSubDomains</code></td><td>
        <p>HSTS标头中是否应包含includeSubDomains参数。如果未指定，则默认值为<code>false</code>将会被使用。</p>
      </td></tr><tr><td><code class="attributeName">hstsPreload</code></td><td>
        <p>preload参数是否应包含在HSTS标头中。如果未指定，则默认值为<code>false</code>将会被使用。有关此参数的重要信息，请参见<a href="https://hstspreload.org/">https://hstspreload.org</a> 。</p>
      </td></tr><tr><td><code class="attributeName">antiClickJackingEnabled</code></td><td>
        <p>反点击劫持标头（ <code>X-Frame-Options</code> ）设置为响应。任何已经存在的防点击劫持标头都将被替换。如果未指定，则默认值为<code>true</code>将会被使用。</p>
      </td></tr><tr><td><code class="attributeName">antiClickJackingOption</code></td><td>
        <p>防点击劫持标头应使用什么值？必须是以下之一<code>DENY</code> ， <code>SAMEORIGIN</code> ， <code>ALLOW-FROM</code> （不区分大小写）。如果未指定，则默认值为<code>DENY</code>将会被使用。</p>
      </td></tr><tr><td><code class="attributeName">antiClickJackingUri</code></td><td>
        <p>如果ALLOW-FROM用于<strong>antiClickJackingOption</strong> ，则应允许使用哪个URI？如果未指定，将使用空字符串的默认值。</p>
      </td></tr><tr><td><code class="attributeName">blockContentTypeSniffingEnabled</code></td><td>
        <p>阻止内容的标题应该是嗅探（ <code>X-Content-Type-Options</code> ）设置在每个响应上。如果已经存在，则将替换标题。如果未指定，则默认值为<code>true</code>将会被使用。</p>
      </td></tr><tr><td><code class="attributeName">xssProtectionEnabled</code></td><td>
        <p>启用浏览器跨站点脚本的标头应过滤保护（ <code>X-XSS-Protection: 1; mode=block</code> ）设置在每个响应上。如果已经存在，则将替换标题。如果未指定，则默认值为<code>true</code>将会被使用。</p>
      </td></tr></tbody></table>

  </div></div>

</div><h3 id="Remote_Address_Filter">远程地址过滤器</h3><div class="text">

  <div class="subsection"><h4 id="Remote_Address_Filter/Introduction">介绍</h4><div class="text">

    <p><strong>远程地址过滤</strong>器使您可以将提交此请求的客户端的IP地址与一个或多个<em>正则表达式进行比较</em> ，并允许请求继续或拒绝处理来自此客户端的请求。</p>

    <p><em>正则表达式</em>的语法与“标准”通配符匹配的语法不同。Tomcat使用<code>java.util.regex</code>包。请查询Java文档以获取所支持表达式的详细信息。</p>

    <p><strong>注意：</strong>将此过滤器与IPv6地址一起使用时， <strong>请注意</strong> 。该阀正在处理的IP地址的格式取决于用于获取它的API。如果该地址是使用Inet6Address类从Java套接字获取的，则其格式为<code>x:x:x:x:x:x:x:x</code> 。也就是说，本地主机的IP地址将是<code>0:0:0:0:0:0:0:1</code>而不是更广泛地使用<code>::1</code> 。请查阅您的访问日志以获取实际值。</p>

    <p>另请参阅： <a href="#Remote_Host_Filter">远程主机过滤器</a> 。</p>
  </div></div>

  <div class="subsection"><h4 id="Remote_Address_Filter/Filter_Class_Name">过滤器类别名称</h4><div class="text">

    <p>远程地址筛选器的筛选器类名称为<strong><code>org.apache.catalina.filters.RemoteAddrFilter</code></strong> 。</p>

  </div></div>

  <div class="subsection"><h4 id="Remote_Address_Filter/Initialisation_parameters">初始化参数</h4><div class="text">

    <p><strong>远程地址筛选器</strong>支持以下初始化参数：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">allow</code></td><td>
        <p>正则表达式（使用<code>java.util.regex</code> ）与远程客户端的IP地址进行比较。如果指定了此属性，则远程地址必须与该请求匹配。如果未指定此属性，则所有请求都将被接受，除非远程地址与<code>deny</code>图案。</p>
      </td></tr><tr><td><code class="attributeName">deny</code></td><td>
        <p>正则表达式（使用<code>java.util.regex</code> ）与远程客户端的IP地址进行比较。如果指定了此属性，则远程地址必须不匹配才能接受此请求。如果未指定此属性，则请求接受仅由<code>accept</code>属性。</p>
      </td></tr><tr><td><code class="attributeName">denyStatus</code></td><td>
        <p>拒绝被拒绝的请求时使用的HTTP响应状态代码。默认值为<code>403</code> 。例如，可以将其设置为<code>404</code> 。</p>
      </td></tr></tbody></table>

  </div></div>

  <div class="subsection"><h4 id="Remote_Address_Filter/Example">例</h4><div class="text">
    <p>要仅允许从本地主机连接的客户端访问，请执行以下操作：</p>
<div class="codeBox"><pre><code>    &lt;filter&gt;
      &lt;filter-name&gt;Remote Address Filter&lt;/filter-name&gt;
      &lt;filter-class&gt;org.apache.catalina.filters.RemoteAddrFilter&lt;/filter-class&gt;
      &lt;init-param&gt;
        &lt;param-name&gt;allow&lt;/param-name&gt;
        &lt;param-value&gt;127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1&lt;/param-value&gt;
      &lt;/init-param&gt;
    &lt;/filter&gt;
    &lt;filter-mapping&gt;
      &lt;filter-name&gt;Remote Address Filter&lt;/filter-name&gt;
      &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;</code></pre></div>
  </div></div>

</div><h3 id="Remote_Host_Filter">远程主机过滤器</h3><div class="text">

  <div class="subsection"><h4 id="Remote_Host_Filter/Introduction">介绍</h4><div class="text">

    <p><strong>远程主机筛选</strong>器使您可以将提交此请求的客户端的主机名与一个或多个<em>正则表达式进行比较</em> ，并允许请求继续或拒绝处理来自此客户端的请求。</p>

    <p><em>正则表达式</em>的语法与“标准”通配符匹配的语法不同。Tomcat使用<code>java.util.regex</code>包。请查询Java文档以获取所支持表达式的详细信息。</p>

    <p><strong>注意：</strong>此过滤器处理方法返回的值<code>ServletRequest.getRemoteHost()</code> 。要允许该方法返回正确的主机名，必须在<strong>连接器</strong>上启用“ DNS查找”功能。</p>

    <p>另请参阅： <a href="#Remote_Address_Filter">远程地址筛选器</a> ， <a href="http.html">HTTP连接器</a>配置。</p>
  </div></div>

  <div class="subsection"><h4 id="Remote_Host_Filter/Filter_Class_Name">过滤器类别名称</h4><div class="text">

    <p>远程地址筛选器的筛选器类名称为<strong><code>org.apache.catalina.filters.RemoteHostFilter</code></strong> 。</p>

  </div></div>

  <div class="subsection"><h4 id="Remote_Host_Filter/Initialisation_parameters">初始化参数</h4><div class="text">

    <p><strong>远程主机筛选器</strong>支持以下初始化参数：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">allow</code></td><td>
        <p>正则表达式（使用<code>java.util.regex</code> ），比较远程客户端的主机名。如果指定了此属性，则远程主机名必须与该请求匹配。如果未指定此属性，则所有请求都将被接受，除非远程主机名与<code>deny</code>图案。</p>
      </td></tr><tr><td><code class="attributeName">deny</code></td><td>
        <p>正则表达式（使用<code>java.util.regex</code> ），比较远程客户端的主机名。如果指定了此属性，则远程主机名必须与要接受的请求不匹配。如果未指定此属性，则请求接受仅由<code>accept</code>属性。</p>
      </td></tr><tr><td><code class="attributeName">denyStatus</code></td><td>
        <p>拒绝被拒绝的请求时使用的HTTP响应状态代码。默认值为<code>403</code> 。例如，可以将其设置为<code>404</code> 。</p>
      </td></tr></tbody></table>

  </div></div>

</div><h3 id="Remote_CIDR_Filter">远程CIDR筛选器</h3><div class="text">

  <div class="subsection"><h4 id="Remote_CIDR_Filter/Introduction">介绍</h4><div class="text">

    <p><strong>远程CIDR筛选</strong>器使您可以将提交此请求的客户端的IP地址与遵循CIDR表示法的一个或多个网络掩码进行比较，并允许请求继续进行或拒绝处理来自此客户端的请求。完全支持IPv4和IPv6。
    </p>

    <p>此筛选器模仿Apache httpd的<code>Order</code> ， <code>Allow from</code>和<code>Deny from</code>指令，但有以下限制：</p>

    <ul>
      <li><code>Order</code>一直会<code>allow, deny</code> ;</li>
      <li>不支持网络掩码的点分四元符号（即，您不能编写<code>192.168.1.0/255.255.255.0</code> ，你必须写<code>192.168.1.0/24</code> ;</li>
      <li>捷径，例如<code>10.10.</code> ，相当于<code>10.10.0.0/16</code> ，不受支持；</li>
      <li>如过滤器名称所示，这是仅CIDR的过滤器，因此子域表示法如下<code>.mydomain.com</code>也不受支持。
      </li>
    </ul>

    <p>此过滤器的其他一些功能包括：</p>

    <ul>
      <li>如果省略CIDR前缀，则此过滤器将成为单个IP过滤器；</li>
      <li>与“ <a href="#Remote_Host_Filter">远程主机过滤器”不同</a> ，它可以压缩形式处理IPv6地址（ <code>::1</code> ， <code>fe80::/71</code>等）。</li>
    </ul>

  </div></div>

  <div class="subsection"><h4 id="Remote_CIDR_Filter/Filter_Class_Name">过滤器类别名称</h4><div class="text">

    <p>远程地址筛选器的筛选器类名称为<strong><code>org.apache.catalina.filters.RemoteCIDRFilter</code></strong> 。</p>

  </div></div>

  <div class="subsection"><h4 id="Remote_CIDR_Filter/Initialisation_parameters">初始化参数</h4><div class="text">

    <p><strong>远程CIDR筛选器</strong>支持以下初始化参数：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">allow</code></td><td>
        <p>与远程客户端的IP地址匹配的IPv4或IPv6网络掩码或地址的逗号分隔列表。如果指定了此属性，则远程地址必须与该请求匹配。如果未指定此属性，则所有请求都将被接受，除非远程IP与网络中的网络掩码匹配。 <code>deny</code>属性。
        </p>
      </td></tr><tr><td><code class="attributeName">deny</code></td><td>
        <p>与远程客户端的IP地址匹配的IPv4或IPv6网络掩码或地址的逗号分隔列表。如果指定了此属性，则远程地址必须不匹配才能接受此请求。如果未指定此属性，则请求接受仅由<code>accept</code>属性。
        </p>
      </td></tr></tbody></table>

  </div></div>

  <div class="subsection"><h4 id="Remote_CIDR_Filter/Example">例</h4><div class="text">
    <p>要仅允许从本地主机连接的客户端访问，请执行以下操作：</p>
    <pre>
      &lt;filter&gt;
      &lt;filter-name&gt;Remote CIDR Filter&lt;/filter-name&gt;
      &lt;filter-class&gt;org.apache.catalina.filters.RemoteCIDRFilter&lt;/filter-class&gt;
      &lt;init-param&gt;
      &lt;param-name&gt;allow&lt;/param-name&gt;
      &lt;param-value&gt;127.0.0.0/8, ::1&lt;/param-value&gt;
      &lt;/init-param&gt;
      &lt;/filter&gt;
      &lt;filter-mapping&gt;
      &lt;filter-name&gt;Remote CIDR Filter&lt;/filter-name&gt;
      &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
      &lt;/filter-mapping&gt;
    </pre>
  </div></div>

</div><h3 id="Remote_IP_Filter">远程IP过滤器</h3><div class="text">

  <div class="subsection"><h4 id="Remote_IP_Filter/Introduction">介绍</h4><div class="text">

    <p>Tomcat端口的<a href="https://httpd.apache.org/docs/trunk/mod/mod_remoteip.html">mod_remoteip</a> ，此过滤器使用代理或负载均衡器通过请求标头（例如“ X-Forwarded-For”）提供的IP地址列表替换请求的表观客户端远程IP地址和主机名。</p>

    <p>此过滤器的另一个功能是替换外观方案（http / https），服务器端口和<code>request.secure</code>通过代理或负载平衡器通过请求标头（例如“ X-Forwarded-Proto”）提供的方案。</p>

    <p>如果与远程地址/主机过滤器结合使用，则应首先定义此过滤器，以确保向远程地址/主机过滤器提供正确的客户端IP地址。</p>

    <p><strong>注意：</strong>默认情况下，此过滤器对写入访问日志的值不起作用。当请求处理离开过滤器时，将恢复原始值，并且原始值通常早于访问日志记录发生。要将此过滤器设置的远程地址，远程主机，服务器端口和协议值传递到访问日志，它们将放入请求属性中。默认情况下，在此处发布这些值是启用的，但是<code>AccessLogValve</code>应该明确配置为使用它们。请参阅说明文件<code>requestAttributesEnabled</code>的属性<code>AccessLogValve</code> 。</p>

    <p>由该过滤器设置的并且可以由访问日志记录使用的请求属性的名称如下：</p>

    <ul>
      <li><code>org.apache.catalina.AccessLog.RemoteAddr</code></li>
      <li><code>org.apache.catalina.AccessLog.RemoteHost</code></li>
      <li><code>org.apache.catalina.AccessLog.Protocol</code></li>
      <li><code>org.apache.catalina.AccessLog.ServerPort</code></li>
      <li><code>org.apache.tomcat.remoteAddr</code></li>
    </ul>

  </div></div>

  <div class="subsection"><h4 id="Remote_IP_Filter/Filter_Class_Name">过滤器类别名称</h4><div class="text">

    <p>远程IP筛选器的筛选器类名称为<strong><code>org.apache.catalina.filters.RemoteIpFilter</code></strong> 。</p>

  </div></div>

  <div class="subsection"><h4 id="Basic_configuration_to_handle_'x-forwarded-for'">处理“ x-forward-for”的基本配置</h4><div class="text">
    <p>过滤器将处理<code>x-forwarded-for</code> http标头。
    </p>
    <div class="codeBox"><pre><code>      &lt;filter&gt;
        &lt;filter-name&gt;RemoteIpFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;org.apache.catalina.filters.RemoteIpFilter&lt;/filter-class&gt;
      &lt;/filter&gt;

      &lt;filter-mapping&gt;
        &lt;filter-name&gt;RemoteIpFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
        &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
      &lt;/filter-mapping&gt;</code></pre></div>
  </div></div>

  <div class="subsection"><h4 id="Basic_configuration_to_handle_'x-forwarded-for'_and_'x-forwarded-proto'">处理“ x-forwarded-for”和“ x-forwarded-proto”的基本配置</h4><div class="text">

    <p>过滤器将处理<code>x-forwarded-for</code>和<code>x-forwarded-proto</code> http标头。的期望值<code>x-forwarded-proto</code>如果是SSL连接，则标头为<code>https</code> （不区分大小写）。</p>
    <div class="codeBox"><pre><code>      &lt;filter&gt;
        &lt;filter-name&gt;RemoteIpFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;org.apache.catalina.filters.RemoteIpFilter&lt;/filter-class&gt;
        &lt;init-param&gt;
          &lt;param-name&gt;protocolHeader&lt;/param-name&gt;
          &lt;param-value&gt;x-forwarded-proto&lt;/param-value&gt;
        &lt;/init-param&gt;
      &lt;/filter&gt;

      &lt;filter-mapping&gt;
        &lt;filter-name&gt;RemoteIpFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
        &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
      &lt;/filter-mapping&gt;</code></pre></div>
  </div></div>

  <div class="subsection"><h4 id="Advanced_configuration_with_internal_proxies">具有内部代理的高级配置</h4><div class="text">
    <p>RemoteIpFilter配置：</p>
    <div class="codeBox"><pre><code>     &lt;filter&gt;
       &lt;filter-name&gt;RemoteIpFilter&lt;/filter-name&gt;
       &lt;filter-class&gt;org.apache.catalina.filters.RemoteIpFilter&lt;/filter-class&gt;
       &lt;init-param&gt;
         &lt;param-name&gt;allowedInternalProxies&lt;/param-name&gt;
         &lt;param-value&gt;192\.168\.0\.10|192\.168\.0\.11&lt;/param-value&gt;
       &lt;/init-param&gt;
       &lt;init-param&gt;
         &lt;param-name&gt;remoteIpHeader&lt;/param-name&gt;
         &lt;param-value&gt;x-forwarded-for&lt;/param-value&gt;
       &lt;/init-param&gt;
       &lt;init-param&gt;
         &lt;param-name&gt;remoteIpProxiesHeader&lt;/param-name&gt;
         &lt;param-value&gt;x-forwarded-by&lt;/param-value&gt;
       &lt;/init-param&gt;
       &lt;init-param&gt;
         &lt;param-name&gt;protocolHeader&lt;/param-name&gt;
         &lt;param-value&gt;x-forwarded-proto&lt;/param-value&gt;
       &lt;/init-param&gt;
     &lt;/filter&gt;</code></pre></div>
    <p>请求值：</p>
    <table class="defaultTable">
      <tbody><tr>
        <th>属性</th>
        <th>RemoteIpFilter之前的值</th>
        <th>RemoteIpFilter之后的值</th>
      </tr>
      <tr>
        <td>request.remoteAddr</td>
        <td>192.168.0.10</td>
        <td>140.211.11.130</td>
      </tr>
      <tr>
        <td>request.header <code>[</code> 'x-forward-for' <code>]</code> </td>
        <td>140.211.11.130，192.168.0.10</td>
        <td>空值</td>
      </tr>
      <tr>
        <td>request.header <code>[</code> “ x转发者” <code>]</code> </td>
        <td>空值</td>
        <td>空值</td>
      </tr>
      <tr>
        <td>request.header <code>[</code> 'x-forward-proto' <code>]</code> </td>
        <td>https</td>
        <td>https</td>
      </tr>
      <tr>
        <td>请求方案</td>
        <td>http</td>
        <td>https</td>
      </tr>
      <tr>
        <td>请求安全</td>
        <td>假</td>
        <td>真正</td>
      </tr>
      <tr>
        <td>request.serverPort</td>
        <td>80</td>
        <td>443</td>
      </tr>
    </tbody></table>

    <p>注意 ： <code>x-forwarded-by</code>标头为<code>null</code>因为该请求仅遍历内部代理。 <code>x-forwarded-for</code>是<code>null</code>因为所有代理都是受信任的或内部的。
    </p>
  </div></div>


  <div class="subsection"><h4 id="Advanced_configuration_with_trusted_proxies">带有受信任代理的高级配置</h4><div class="text">
    <p>RemoteIpFilter配置：</p>
    <div class="codeBox"><pre><code>     &lt;filter&gt;
       &lt;filter-name&gt;RemoteIpFilter&lt;/filter-name&gt;
       &lt;filter-class&gt;org.apache.catalina.filters.RemoteIpFilter&lt;/filter-class&gt;
       &lt;init-param&gt;
         &lt;param-name&gt;allowedInternalProxies&lt;/param-name&gt;
         &lt;param-value&gt;192\.168\.0\.10|192\.168\.0\.11&lt;/param-value&gt;
       &lt;/init-param&gt;
       &lt;init-param&gt;
         &lt;param-name&gt;remoteIpHeader&lt;/param-name&gt;
         &lt;param-value&gt;x-forwarded-for&lt;/param-value&gt;
       &lt;/init-param&gt;
       &lt;init-param&gt;
         &lt;param-name&gt;remoteIpProxiesHeader&lt;/param-name&gt;
         &lt;param-value&gt;x-forwarded-by&lt;/param-value&gt;
       &lt;/init-param&gt;
       &lt;init-param&gt;
         &lt;param-name&gt;trustedProxies&lt;/param-name&gt;
         &lt;param-value&gt;proxy1|proxy2&lt;/param-value&gt;
       &lt;/init-param&gt;
     &lt;/filter&gt;</code></pre></div>
    <p>请求值：</p>
    <table class="defaultTable">
      <tbody><tr>
        <th>属性</th>
        <th>RemoteIpFilter之前的值</th>
        <th>RemoteIpFilter之后的值</th>
      </tr>
      <tr>
        <td>request.remoteAddr</td>
        <td>192.168.0.10</td>
        <td>140.211.11.130</td>
      </tr>
      <tr>
        <td>request.header <code>[</code> 'x-forward-for' <code>]</code> </td>
        <td>140.211.11.130，proxy1，proxy2</td>
        <td>空值</td>
      </tr>
      <tr>
        <td>request.header <code>[</code> “ x转发者” <code>]</code> </td>
        <td>空值</td>
        <td>proxy1，proxy2</td>
      </tr>
    </tbody></table>

    <p>注意 ： <code>proxy1</code>和<code>proxy2</code>都是可信赖的代理<code>x-forwarded-for</code>标头，它们都迁移到<code>x-forwarded-by</code>标头。 <code>x-forwarded-for</code>是<code>null</code>因为所有代理都是受信任的或内部的。
    </p>
  </div></div>

  <div class="subsection"><h4 id="Advanced_configuration_with_internal_and_trusted_proxies">具有内部和受信任代理的高级配置</h4><div class="text">
    <p>RemoteIpFilter配置：</p>
    <div class="codeBox"><pre><code>     &lt;filter&gt;
       &lt;filter-name&gt;RemoteIpFilter&lt;/filter-name&gt;
       &lt;filter-class&gt;org.apache.catalina.filters.RemoteIpFilter&lt;/filter-class&gt;
       &lt;init-param&gt;
         &lt;param-name&gt;allowedInternalProxies&lt;/param-name&gt;
         &lt;param-value&gt;192\.168\.0\.10|192\.168\.0\.11&lt;/param-value&gt;
       &lt;/init-param&gt;
       &lt;init-param&gt;
         &lt;param-name&gt;remoteIpHeader&lt;/param-name&gt;
         &lt;param-value&gt;x-forwarded-for&lt;/param-value&gt;
       &lt;/init-param&gt;
       &lt;init-param&gt;
         &lt;param-name&gt;remoteIpProxiesHeader&lt;/param-name&gt;
         &lt;param-value&gt;x-forwarded-by&lt;/param-value&gt;
       &lt;/init-param&gt;
       &lt;init-param&gt;
         &lt;param-name&gt;trustedProxies&lt;/param-name&gt;
         &lt;param-value&gt;proxy1|proxy2&lt;/param-value&gt;
       &lt;/init-param&gt;
     &lt;/filter&gt;</code></pre></div>
    <p>请求值：</p>
    <table class="defaultTable">
      <tbody><tr>
        <th>属性</th>
        <th>RemoteIpFilter之前的值</th>
        <th>RemoteIpFilter之后的值</th>
      </tr>
      <tr>
        <td>request.remoteAddr</td>
        <td>192.168.0.10</td>
        <td>140.211.11.130</td>
      </tr>
      <tr>
        <td>request.header <code>[</code> 'x-forward-for' <code>]</code> </td>
        <td>140.211.11.130，proxy1，proxy2、192.168.0.10</td>
        <td>空值</td>
      </tr>
      <tr>
        <td>request.header <code>[</code> “ x转发者” <code>]</code> </td>
        <td>空值</td>
        <td>proxy1，proxy2</td>
      </tr>
    </tbody></table>

    <p>注意 ： <code>proxy1</code>和<code>proxy2</code>都是可信赖的代理<code>x-forwarded-for</code>标头，它们都迁移到<code>x-forwarded-by</code>标头。如<code>192.168.0.10</code>是内部代理，它不会出现在<code>x-forwarded-by</code> 。
    <code>x-forwarded-for</code>是<code>null</code>因为所有代理都是受信任的或内部的。
    </p>
  </div></div>

  <div class="subsection"><h4 id="Advanced_configuration_with_an_untrusted_proxy">具有不受信任的代理的高级配置</h4><div class="text">

    <p>RemoteIpFilter配置：</p>
    <div class="codeBox"><pre><code>     &lt;filter&gt;
       &lt;filter-name&gt;RemoteIpFilter&lt;/filter-name&gt;
       &lt;filter-class&gt;org.apache.catalina.filters.RemoteIpFilter&lt;/filter-class&gt;
       &lt;init-param&gt;
         &lt;param-name&gt;allowedInternalProxies&lt;/param-name&gt;
         &lt;param-value&gt;192\.168\.0\.10|192\.168\.0\.11&lt;/param-value&gt;
       &lt;/init-param&gt;
       &lt;init-param&gt;
         &lt;param-name&gt;remoteIpHeader&lt;/param-name&gt;
         &lt;param-value&gt;x-forwarded-for&lt;/param-value&gt;
       &lt;/init-param&gt;
       &lt;init-param&gt;
         &lt;param-name&gt;remoteIpProxiesHeader&lt;/param-name&gt;
         &lt;param-value&gt;x-forwarded-by&lt;/param-value&gt;
       &lt;/init-param&gt;
       &lt;init-param&gt;
         &lt;param-name&gt;trustedProxies&lt;/param-name&gt;
         &lt;param-value&gt;proxy1|proxy2&lt;/param-value&gt;
       &lt;/init-param&gt;
     &lt;/filter&gt;</code></pre></div>
    <p>请求值：</p>
    <table class="defaultTable">
      <tbody><tr>
        <th>属性</th>
        <th>RemoteIpFilter之前的值</th>
        <th>RemoteIpFilter之后的值</th>
      </tr>
      <tr>
        <td>request.remoteAddr</td>
        <td>192.168.0.10</td>
        <td>不可信代理</td>
      </tr>
      <tr>
        <td>request.header <code>[</code> 'x-forward-for' <code>]</code> </td>
        <td>140.211.11.130，不受信任的代理，proxy1</td>
        <td>140.211.11.130</td>
      </tr>
      <tr>
        <td>request.header <code>[</code> “ x转发者” <code>]</code> </td>
        <td>空值</td>
        <td>proxy1</td>
      </tr>
    </tbody></table>

    <p>注意 ： <code>x-forwarded-by</code>拥有受信任的代理<code>proxy1</code> 。
    <code>x-forwarded-by</code>持有<code>140.211.11.130</code>因为<code>untrusted-proxy</code>不被信任，因此，我们不能相信<code>untrusted-proxy</code>是实际的远程IP。
    <code>request.remoteAddr</code>是<code>untrusted-proxy</code>这是由IP验证的IP <code>proxy1</code> 。
    </p>
  </div></div>

  <div class="subsection"><h4 id="Remote_IP_Filter/Initialisation_parameters">初始化参数</h4><div class="text">

    <p><strong>远程IP筛选器</strong>支持以下初始化参数：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">remoteIpHeader</code></td><td>
        <p>该阀门读取的HTTP标头的名称，该标头包含从发出请求的客户端开始的遍历IP地址的列表。如果未指定，则默认为<code>x-forwarded-for</code>用来。</p>
      </td></tr><tr><td><code class="attributeName">internalProxies</code></td><td>
        <p>正则表达式（使用<code>java.util.regex</code> ），则代理的IP地址必须匹配才能被视为内部代理。出现在<strong>remoteIpHeader</strong>中的内部代理将受到信任，并且不会出现在<strong>proxiesHeader</strong>值中。如果未指定，则默认值为<code>10\.\d{1,3}\.\d{1,3}\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|169\.254\.\d{1,3}\.\d{1,3}|127\.\d{1,3}\.\d{1,3}\.\d{1,3}|172\.1[6-9]{1}\.\d{1,3}\.\d{1,3}|172\.2[0-9]{1}\.\d{1,3}\.\d{1,3}|172\.3[0-1]{1}\.\d{1,3}\.\d{1,3}|0:0:0:0:0:0:0:1</code>将会被使用。</p>
      </td></tr><tr><td><code class="attributeName">proxiesHeader</code></td><td>
        <p>此阀创建的HTTP标头的名称，以保存在传入<strong>remoteIpHeader中</strong>已处理的代理列表。如果未指定，则默认为<code>x-forwarded-by</code>用来。</p>
      </td></tr><tr><td><code class="attributeName">requestAttributesEnabled</code></td><td>
        <p>调成<code>true</code>设置AccessLog实现使用的请求属性，以覆盖请求所返回的远程地址，远程主机，服务器端口和协议的值。请求属性还用于使转发的远程地址显示在Manager Web应用程序的状态页上。如果未设置，则默认值为<code>true</code>将会被使用。</p>
      </td></tr><tr><td><code class="attributeName">trustedProxies</code></td><td>
        <p>正则表达式（使用<code>java.util.regex</code> ），则代理的IP地址必须匹配才能被视为受信任的代理。出现在<strong>remoteIpHeader</strong>中的受信任代理将受到信任，并出现在<strong>proxiesHeader</strong>值中。如果未指定，则不会信任任何代理。</p>
      </td></tr><tr><td><code class="attributeName">protocolHeader</code></td><td>
        <p>该阀读取的HTTP标头的名称，该标头保存客户端用于连接到代理的协议。如果未指定，则默认为<code>X-Forwarded-Proto</code>用来。</p>
      </td></tr><tr><td><code class="attributeName">portHeader</code></td><td>
        <p>该阀读取的HTTP标头的名称，该标头保存客户端用于连接到代理的端口。如果未指定，则默认为<code>null</code>用来。</p>
      </td></tr><tr><td><code class="attributeName">protocolHeaderHttpsValue</code></td><td>
        <p><strong>protocolHeader的</strong>值，指示它是HTTPS请求。如果未指定，则默认为<code>https</code>用来。</p>
      </td></tr><tr><td><code class="attributeName">httpServerPort</code></td><td>
        <p>传回的值<code>ServletRequest.getServerPort()</code>当<strong>protocolHeader</strong>指示<code>http</code>协议，并且不存在<strong>portHeader</strong> 。如果未指定，则默认为<code>80</code>用来。</p>
      </td></tr><tr><td><code class="attributeName">httpsServerPort</code></td><td>
        <p>传回的值<code>ServletRequest.getServerPort()</code>当<strong>protocolHeader</strong>指示<code>https</code>协议，并且不存在<strong>portHeader</strong> 。如果未指定，则默认为<code>443</code>用来。</p>
      </td></tr><tr><td><code class="attributeName">changeLocalPort</code></td><td>
        <p>如果<code>true</code> ，由传回的值<code>ServletRequest.getLocalPort()</code>和<code>ServletRequest.getServerPort()</code>由此过滤器修改。如果未指定，则默认为<code>false</code>用来。</p>
      </td></tr></tbody></table>


  </div></div>

</div><h3 id="Request_Dumper_Filter">请求自卸车过滤器</h3><div class="text">

  <div class="subsection"><h4 id="Request_Dumper_Filter/Introduction">介绍</h4><div class="text">

    <p>请求转储程序过滤器记录来自请求和响应对象的信息，并用于调试目的。使用此过滤器时，建议<code>org.apache.catalina.filter.RequestDumperFilter</code>记录器定向到专用文件，并且<code>org.apache.juli.VerbatimFormatter</code>用来。</p>

    <p><strong>警告：使用此过滤器会有副作用。</strong>  该过滤器的输出包括请求中包含的任何参数。这些参数将使用默认平台编码进行解码。以后的任何呼叫<code>request.setCharacterEncoding()</code> Web应用程序中的内容将无效。</p>

  </div></div>

  <div class="subsection"><h4 id="Request_Dumper_Filter/Filter_Class_Name">过滤器类别名称</h4><div class="text">

    <p>请求转储过滤器的过滤器类名称为<strong><code>org.apache.catalina.filters.RequestDumperFilter</code></strong> 。</p>

  </div></div>

  <div class="subsection"><h4 id="Request_Dumper_Filter/Initialisation_parameters">初始化参数</h4><div class="text">

    <p>请求转储过滤器不支持任何初始化参数。</p>

  </div></div>

  <div class="subsection"><h4 id="Request_Dumper_Filter/Sample_Configuration">样本配置</h4><div class="text">

    <p>Web应用程序的web.xml中的以下条目将为该Web应用程序的所有请求启用Request Dumper过滤器。如果将条目添加到<code>CATALINA_BASE/conf/web.xml</code> ，则将为所有Web应用程序启用请求转储过滤器。</p>
    <div class="codeBox"><pre><code>&lt;filter&gt;
    &lt;filter-name&gt;requestdumper&lt;/filter-name&gt;
    &lt;filter-class&gt;
        org.apache.catalina.filters.RequestDumperFilter
    &lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
    &lt;filter-name&gt;requestdumper&lt;/filter-name&gt;
    &lt;url-pattern&gt;*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;</code></pre></div>

    <p>CATALINA_BASE / conf / logging.properties中的以下条目将为Request Dumper Filter输出创建一个单独的日志文件。</p>
    <div class="codeBox"><pre><code># To this configuration below, 1request-dumper.org.apache.juli.FileHandler
# also needs to be added to the handlers property near the top of the file
1request-dumper.org.apache.juli.FileHandler.level = INFO
1request-dumper.org.apache.juli.FileHandler.directory = ${catalina.base}/logs
1request-dumper.org.apache.juli.FileHandler.prefix = request-dumper.
1request-dumper.org.apache.juli.FileHandler.encoding = UTF-8
1request-dumper.org.apache.juli.FileHandler.formatter = org.apache.juli.VerbatimFormatter
org.apache.catalina.filters.RequestDumperFilter.level = INFO
org.apache.catalina.filters.RequestDumperFilter.handlers = \
  1request-dumper.org.apache.juli.FileHandler</code></pre></div>
  </div></div>
</div><h3 id="Session_Initializer_Filter">会话初始化过滤器</h3><div class="text">

  <div class="subsection"><h4 id="Session_Initializer_Filter/Introduction">介绍</h4><div class="text">
    <p>会话初始化过滤器初始化<code>javax.servlet.http.HttpSession</code>在处理请求之前。如果符合JSR-356的WebSocket实现，则这是必需的<code>HttpSession</code>在握手阶段需要。</p>

    <p>WebSocket的Java API没有强制要求<code>HttpSession</code>将根据请求进行初始化，因此<code>javax.servlet.http.HttpServletRequest</code>的<code>getSession()</code>退货<code>null</code>如果<code>HttpSession</code>尚未预先初始化。</p>

    <p>此筛选器通过初始化任何内容的HttpSession来解决该问题。 <code>HttpServletRequest</code>与其匹配<code>url-pattern</code> 。</p>
  </div></div>

  <div class="subsection"><h4 id="Session_Initializer_Filter/Filter_Class_Name">过滤器类别名称</h4><div class="text">
    <p>会话初始化程序过滤器的过滤器类名称为<strong><code>org.apache.catalina.filters.SessionInitializerFilter</code></strong> 。</p>
  </div></div>

  <div class="subsection"><h4 id="Session_Initializer_Filter/Initialisation_parameters">初始化参数</h4><div class="text">
    <p>会话初始化程序过滤器不支持任何初始化参数。</p>
  </div></div>

  <div class="subsection"><h4 id="Session_Initializer_Filter/Sample_Configuration">样本配置</h4><div class="text">
    <p>Web应用程序部署描述符<strong>web.xml中</strong>的以下条目将为与给定URL模式（在此示例中为“ / ws / *”）匹配的请求启用会话初始化程序过滤器。</p>

    <div class="codeBox"><pre><code>&lt;filter&gt;
    &lt;filter-name&gt;SessionInitializer&lt;/filter-name&gt;
    &lt;filter-class&gt;org.apache.catalina.filters.SessionInitializerFilter&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
    &lt;filter-name&gt;SessionInitializer&lt;/filter-name&gt;
    &lt;url-pattern&gt;/ws/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;</code></pre></div>
    </div></div>
</div><h3 id="Set_Character_Encoding_Filter">设置字符编码过滤器</h3><div class="text">

  <div class="subsection"><h4 id="Set_Character_Encoding_Filter/Introduction">介绍</h4><div class="text">

    <p>用户代理并不总是在请求中包含字符编码信息。根据处理请求的方式，通常使用ISO-8859-1的默认编码。这并不总是可取的。该过滤器提供用于设置该编码或将其强制为特定值的选项。本质上，此过滤器调用<code>ServletRequest.setCharacterEncoding()</code>方法。</p>

    <p>如果参数解析发生在此过滤器之后，则在解析POST请求中的参数时会有效地使用此过滤器设置的值。因此，过滤器映射的顺序很重要。请注意，此处未设置GET请求的编码，而是在<b>Connector上设置</b> 。有关详细信息，请参见FAQ中的CharacterEncoding页面。</p>

  </div></div>

  <div class="subsection"><h4 id="Set_Character_Encoding_Filter/Filter_Class_Name">过滤器类别名称</h4><div class="text">

    <p>设置字符编码过滤器的过滤器类名称为<strong><code>org.apache.catalina.filters.SetCharacterEncodingFilter</code></strong> 。</p>

  </div></div>

  <div class="subsection"><h4 id="Set_Character_Encoding_Filter/Initialisation_parameters">初始化参数</h4><div class="text">

    <p>设置字符编码过滤器支持以下初始化参数：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><strong><code class="attributeName">encoding</code></strong></td><td>
        <p>应设置的字符编码名称。</p>
      </td></tr><tr><td><code class="attributeName">ignore</code></td><td>
        <p>确定是否忽略用户代理指定的任何字符编码。如果此属性是<code>true</code> ，则将忽略用户代理提供的任何值。如果<code>false</code> ，只有在用户代理未指定编码时才设置编码。默认值为<code>false</code> 。</p>
      </td></tr></tbody></table>

  </div></div>

</div><h3 id="WebDAV_Fix_Filter">WebDAV修复过滤器</h3><div class="text">

  <div class="subsection"><h4 id="WebDAV_Fix_Filter/Introduction">介绍</h4><div class="text">

    <p>Microsoft操作系统具有两个WebDAV客户端。一个用于端口80，另一个用于所有其他端口。与端口80一起使用的实现不符合WebDAV规范，并且在尝试与Tomcat WebDAV Servlet通信时失败。该过滤器通过强制使用有效的WebDAV实现（即使通过端口80连接）也为此提供了修复。</p>

  </div></div>

  <div class="subsection"><h4 id="WebDAV_Fix_Filter/Filter_Class_Name">过滤器类别名称</h4><div class="text">

    <p>WebDAV修复筛选器的筛选器类名称为<strong><code>org.apache.catalina.filters.WebdavFixFilter</code></strong> 。</p>

  </div></div>

  <div class="subsection"><h4 id="WebDAV_Fix_Filter/Initialisation_parameters">初始化参数</h4><div class="text">

    <p>WebDAV修复筛选器不支持任何初始化参数。</p>

  </div></div>

</div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="../comments.html">这里</a>解释<a href="../comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>