<html lang="zh-Hans" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="../images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9配置参考（9.0.21）-群集对象</title><meta name="author" content="Filip Hanik"><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/config/cluster">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script></head><body ><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="../images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="../images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>Apache Tomcat 9配置参考</h1><div class="versionInfo">版本9.0.21， <time datetime="2019-06-04"> 2019年6月4日</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>链接</h2><ul><li><a href="../index.html">文件首页</a></li><li><a href="index.html">配置参考家</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">常问问题</a></li><li><a href="#comments_section">用户评论</a></li></ul></div><div><h2>顶级元素</h2><ul><li><a href="server.html">服务器</a></li><li><a href="service.html">服务</a></li></ul></div><div><h2>执行者</h2><ul><li><a href="executor.html">执行者</a></li></ul></div><div><h2>连接器</h2><ul><li><a href="http.html">HTTP / 1.1</a></li><li><a href="http2.html">HTTP / 2</a></li><li><a href="ajp.html">AJP</a></li></ul></div><div><h2>货柜</h2><ul><li><a href="context.html">语境</a></li><li><a href="engine.html">发动机</a></li><li><a href="host.html">主办</a></li><li><a href="cluster.html">簇</a></li></ul></div><div><h2>嵌套组件</h2><ul><li><a href="cookie-processor.html">Cookie处理器</a></li><li><a href="credentialhandler.html">凭证处理程序</a></li><li><a href="globalresources.html">全球资源</a></li><li><a href="jar-scanner.html">JarScanner</a></li><li><a href="jar-scan-filter.html">JarScanFilter</a></li><li><a href="listeners.html">听众</a></li><li><a href="loader.html">装载机</a></li><li><a href="manager.html">经理</a></li><li><a href="realm.html">领域</a></li><li><a href="resources.html">资源资源</a></li><li><a href="sessionidgenerator.html">SessionIdGenerator</a></li><li><a href="valve.html">阀</a></li></ul></div><div><h2>集群元素</h2><ul><li><a href="cluster.html">簇</a></li><li><a href="cluster-manager.html">经理</a></li><li><a href="cluster-channel.html">渠道</a></li><li><a href="cluster-membership.html">频道/会员</a></li><li><a href="cluster-sender.html">频道/发件人</a></li><li><a href="cluster-receiver.html">频道/接收器</a></li><li><a href="cluster-interceptor.html">通道/拦截器</a></li><li><a href="cluster-valve.html">阀</a></li><li><a href="cluster-deployer.html">部署者</a></li><li><a href="cluster-listener.html">集群监听器</a></li></ul></div><div><h2>web.xml</h2><ul><li><a href="filter.html">过滤</a></li></ul></div><div><h2>其他</h2><ul><li><a href="systemprops.html">系统属性</a></li><li><a href="jaspic.html">日本宝石</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>群集对象</h2><h3 id="Table_of_Contents">目录</h3><div class="text">
<ul><li><a href="#Introduction">介绍</a></li><li><a href="#Security">安全</a></li><li><a href="#Engine_vs_Host_placement">引擎与主机位置</a></li><li><a href="#Context_Attribute_Replication">上下文属性复制</a></li><li><a href="#Nested_Components">嵌套组件</a></li><li><a href="#Deprecated_configuration_options">弃用的配置选项</a></li><li><a href="#Attributes">属性</a><ol><li><a href="#SimpleTcpCluster_Attributes">SimpleTcpCluster属性</a></li></ol></li></ul>
</div><h3 id="Introduction">介绍</h3><div class="text">
  <p>tomcat群集实现提供会话复制，上下文属性复制和群集范围的WAR文件部署。而<code>Cluster</code>配置相当复杂，默认配置对大多数人来说都是开箱即用的。</p><p>Tomcat集群的实现非常可扩展，因此我们暴露了无数的选项，使配置看起来很多，但不要失去信心，相反，您可以对发生的事情进行全面控制。</p>
</div><h3 id="Security">安全</h3><div class="text">

<p>在将安全，受信任的网络用于所有与群集相关的网络流量的基础上编写群集实现。在不安全，不受信任的网络上运行群集是不安全的。</p>

<p>有许多选项可提供安全，可信任的网络，以供Tomcat群集使用。这些包括：</p>
<ul>
  <li>专用局域网</li>
  <li>虚拟专用网（VPN）</li>
  <li>IPSEC</li>
</ul>

</div><h3 id="Engine_vs_Host_placement">引擎与主机位置</h3><div class="text">
  <p>您可以将<code><Cluster></code>内的元素<code><Engine></code>容器或<code><Host></code>容器。<br>将其放在引擎中，意味着您将在Tomcat的所有虚拟主机中支持集群，并共享消息传递组件。当您放置<code><Cluster></code>在 - 的里面<code><Engine></code>元素，集群会将每个会话管理器的主机名附加到管理器名称，这样，具有相同名称但位于两个不同主机内的两个上下文将是可区分的。
  </p>
</div><h3 id="Context_Attribute_Replication">上下文属性复制</h3><div class="text">
  <p>要配置上下文属性复制，只需替换掉用于您的应用程序上下文的上下文实现即可。</p>
  <div class="codeBox"><pre><code>&lt;Context className="org.apache.catalina.ha.context.ReplicatedContext"/&gt;</code></pre></div>
  <p>此上下文扩展了Tomcat <code><a href="context.html">StandardContext</a></code>因此<a href="context.html">基本实现</a>中的所有选项均有效。
  </p>
</div><h3 id="Nested_Components">嵌套组件</h3><div class="text">
  <p><b><a href="cluster-manager.html">经理</a> ：</b> <br>会话管理器元素标识在此集群实现中使用哪种会话管理器。此管理器配置与您在常规配置中使用的配置相同<code><a href="context.html#Nested_Components"><Context></a></code>组态。
    <br>默认值为<code>org.apache.catalina.ha.session.DeltaManager</code>与<code>SimpleTcpCluster</code>实施。其他经理如<code>org.apache.catalina.ha.session.BackupManager</code>是/可能是松散耦合的，并且不依赖于<code>SimpleTcpCluster</code>用于其数据复制。
  </p>
  <p><b><a href="cluster-channel.html">频道</a> ：</b> <br>Channel及其子组件都是集群组IO层的一部分，并且本身就是一个模块，我们将其昵称为“部落”<br>网络层，消息传递和成员资格逻辑的任何配置和调整都将在通道及其嵌套组件中完成。您总是可以找到有关<a href="../tribes/introduction.html">Apache Tribes的</a>更多信息
  </p>
  <p><b><a href="cluster-valve.html">阀门</a> ：</b> <br>Tomcat群集实现使用<code>Tomcat <a href="valve.html">Valves</a></code>跟踪请求何时进入和退出servlet容器。它使用这些阀门能够对何时复制数据做出明智的决定，而这总是在请求结束时进行。</p>
  <p><b><a href="cluster-deployer.html">部署者</a> ：</b> <br>Deployer组件是Tomcat Farm Deployer。它允许您在整个群集范围内部署和取消部署应用程序。
  </p>
  <p><b><a href="cluster-listener.html">ClusterListener</a> ：</b> <br>ClusterListener用于跟踪使用以下方式发送和接收的消息<code>SimpleTcpCluster</code> 。如果您希望跟踪消息，则可以在此处添加一个侦听器，或者可以向该通道对象添加一个阀。
  </p>
</div><h3 id="Deprecated_configuration_options">弃用的配置选项</h3><div class="text">
  <p>
    <b>不建议使用的设置：</b>在Tomcat的早期版本中，您可以使用管理器来控制会话管理器设置。 <property>=值。由于它的编写方式干扰了在一个集群实现下支持多个不同管理器类的能力，因此该方法已被终止，因为相同的属性可能对不同的管理器产生不同的影响。
  </property></p>
</div><h3 id="Attributes">属性</h3><div class="text">
  <div class="subsection"><h4 id="SimpleTcpCluster_Attributes">SimpleTcpCluster属性</h4><div class="text">
  <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><strong><code class="attributeName">className</code></strong></td><td>
      <p>主集群类，目前只有一个可用， <code>org.apache.catalina.ha.tcp.SimpleTcpCluster</code>
      </p>
    </td></tr><tr><td><strong><code class="attributeName">channelSendOptions</code></strong></td><td>
      <p>部落频道发送选项，默认为<code>8</code> 。<br>此选项用于设置所有通过SimpleTcpCluster发送的消息都使用的标志。该标志决定如何发送消息，它是一个简单的逻辑或。</p>

      <div class="codeBox"><pre><code>int options = Channel.SEND_OPTIONS_ASYNCHRONOUS |
              Channel.SEND_OPTIONS_SYNCHRONIZED_ACK |
              Channel.SEND_OPTIONS_USE_ACK;</code></pre></div>
      <p>其中一些值是：<br>
      <code>Channel.SEND_OPTIONS_SYNCHRONIZED_ACK = 0x0004</code><br>
      <code>Channel.SEND_OPTIONS_ASYNCHRONOUS = 0x0008</code><br>
      <code>Channel.SEND_OPTIONS_USE_ACK = 0x0002</code><br>因此，要使用ACK和ASYNC消息传递，标记为<code>10</code> （8 + 2）<br>请注意，如果您使用ASYNC消息传递，则可能由接收节点以与发送消息的顺序不同的顺序来处理会话的更新消息。
      </p>
      <p>您也可以将这些选项设置为逗号分隔的字符串，例如“异步，多播”，该字符串将转换为<code>Channel.SEND_OPTIONS_ASYNCHRONOUS | Channel.SEND_OPTIONS_MULTICAST</code>
      <br>有效的选项名称为“异步”（别名“异步”），“字节消息”（别名“字节”），“多播”，“安全”，“ synchronized_ack”（别名“ sync”），“ udp”和“ use_ack”</p>
    </td></tr><tr><td><code class="attributeName">channelStartOptions</code></td><td>
      <p>设置<channel>集群使用的<channel>对象的开始和停止标志<channel>。默认是<code>Channel.DEFAULT</code>这将启动所有通道服务，例如发送者，接收者，成员资格发送者和成员资格接收者。以下标志今天可用：</channel></channel></channel></p>
         <div class="codeBox"><pre><code>Channel.DEFAULT = Channel.SND_RX_SEQ (1) |
                  Channel.SND_TX_SEQ (2) |
                  Channel.MBR_RX_SEQ (4) |
                  Channel.MBR_TX_SEQ (8);</code></pre></div>
    </td></tr><tr><td><code class="attributeName">heartbeatBackgroundEnabled</code></td><td>
      <p>标记是否在容器后台线程调用通道心跳。默认值为false。启用此标志不要忘记禁用通道心跳线。
      </p>
    </td></tr><tr><td><code class="attributeName">notifyLifecycleListenerOnFailure</code></td><td>
      <p>如果所有ClusterListener都不接受通道消息，则标记是否通知LifecycleListeners。默认值为false。
      </p>
    </td></tr></tbody></table>
  </div></div>
</div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="../comments.html">这里</a>解释<a href="../comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>