<html lang="zh-Hans" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="../images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9配置参考（9.0.21）-集群成员对象</title><meta name="author" content="Filip Hanik"><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/config/cluster-membership">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script></head><body ><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="../images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="../images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>Apache Tomcat 9配置参考</h1><div class="versionInfo">版本9.0.21， <time datetime="2019-06-04"> 2019年6月4日</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>链接</h2><ul><li><a href="../index.html">文件首页</a></li><li><a href="index.html">配置参考家</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">常问问题</a></li><li><a href="#comments_section">用户评论</a></li></ul></div><div><h2>顶级元素</h2><ul><li><a href="server.html">服务器</a></li><li><a href="service.html">服务</a></li></ul></div><div><h2>执行者</h2><ul><li><a href="executor.html">执行者</a></li></ul></div><div><h2>连接器</h2><ul><li><a href="http.html">HTTP / 1.1</a></li><li><a href="http2.html">HTTP / 2</a></li><li><a href="ajp.html">AJP</a></li></ul></div><div><h2>货柜</h2><ul><li><a href="context.html">语境</a></li><li><a href="engine.html">发动机</a></li><li><a href="host.html">主办</a></li><li><a href="cluster.html">簇</a></li></ul></div><div><h2>嵌套组件</h2><ul><li><a href="cookie-processor.html">Cookie处理器</a></li><li><a href="credentialhandler.html">凭证处理程序</a></li><li><a href="globalresources.html">全球资源</a></li><li><a href="jar-scanner.html">JarScanner</a></li><li><a href="jar-scan-filter.html">JarScanFilter</a></li><li><a href="listeners.html">听众</a></li><li><a href="loader.html">装载机</a></li><li><a href="manager.html">经理</a></li><li><a href="realm.html">领域</a></li><li><a href="resources.html">资源资源</a></li><li><a href="sessionidgenerator.html">SessionIdGenerator</a></li><li><a href="valve.html">阀</a></li></ul></div><div><h2>集群元素</h2><ul><li><a href="cluster.html">簇</a></li><li><a href="cluster-manager.html">经理</a></li><li><a href="cluster-channel.html">渠道</a></li><li><a href="cluster-membership.html">频道/会员</a></li><li><a href="cluster-sender.html">频道/发件人</a></li><li><a href="cluster-receiver.html">频道/接收器</a></li><li><a href="cluster-interceptor.html">通道/拦截器</a></li><li><a href="cluster-valve.html">阀</a></li><li><a href="cluster-deployer.html">部署者</a></li><li><a href="cluster-listener.html">集群监听器</a></li></ul></div><div><h2>web.xml</h2><ul><li><a href="filter.html">过滤</a></li></ul></div><div><h2>其他</h2><ul><li><a href="systemprops.html">系统属性</a></li><li><a href="jaspic.html">日本宝石</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>集群成员对象</h2><h3 id="Table_of_Contents">目录</h3><div class="text">
<ul><li><a href="#Introduction">介绍</a></li><li><a href="#Default_Implementation">默认实施</a></li><li><a href="#Attributes">属性</a><ol><li><a href="#Common_Attributes">共同属性</a></li><li><a href="#Multicast_Attributes">组播属性</a></li><li><a href="#Static_Membership_Attributes">静态成员资格属性</a></li></ol></li><li><a href="#Nested_Components">嵌套组件</a><ol><li><a href="#StaticMember_Attributes">StaticMember属性</a></li><li><a href="#Setting">设置</a></li></ol></li></ul>
</div><h3 id="Introduction">介绍</h3><div class="text">
  <p>Apache Tribes <a href="cluster-channel.html">Channel中</a>的成员资格组件负责动态发现集群中的其他成员（节点）。当前有两种不同的会员服务， <code>org.apache.catalina.tribes.membership.McastService</code>和<code>org.apache.catalina.tribes.membership.StaticMembershipService</code> 。的<code>McastService</code>构建基于多播的成员资格服务，该服务将UDP数据包发送到多播IP地址。的<code>StaticMembershipService</code>构建基于单播的成员资格服务，该服务将TCP数据包发送到预定义的成员地址。
  </p>
</div><h3 id="Default_Implementation">默认实施</h3><div class="text">
  <p>群集组通知的默认实现建立在使用UDP数据包发送到多播IP地址的多播心跳之上。群集成员通过使用相同的多播地址/端口组合进行分组。每个成员以给定的间隔发出心跳（ <code>frequency</code> ），并且此心跳用于动态发现。以类似的方式，如果在指定的时间范围内未收到心跳<code>dropTime</code>女士。成员被视为可疑成员，并且将通知该频道和任何成员资格侦听器。
  </p>
</div><h3 id="Attributes">属性</h3><div class="text">
  <div class="subsection"><h4 id="Common_Attributes">共同属性</h4><div class="text">
    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><strong><code class="attributeName">className</code></strong></td><td>
        <p>成员资格组件的实现。有两种实现方式， <code>org.apache.catalina.tribes.membership.McastService</code>和<code>org.apache.catalina.tribes.membership.StaticMembershipService</code> 。
        </p>
      </td></tr></tbody></table>
  </div></div>
  <div class="subsection"><h4 id="Multicast_Attributes">组播属性</h4><div class="text">

  <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><strong><code class="attributeName">className</code></strong></td><td>
      <p>值是<code>org.apache.catalina.tribes.membership.McastService</code> 。此实现将多播心跳用于成员发现。
      </p>
    </td></tr><tr><td><code class="attributeName">address</code></td><td>
      <p>成员资格将广播其存在并侦听其他心跳的多播地址。默认值为<code>228.0.0.4</code>确保您的网络已启用多播流量。<br>多播地址，以及<code>port</code>是创建集群组的原因。要将您的服务器场分为几个不同的组，或将质量检查与生产分开，请更改<code>port</code>或者<code>address</code>
      <br>以前称为mcastAddr。
      </p>
    </td></tr><tr><td><code class="attributeName">port</code></td><td>
      <p>组播端口，默认值为<code>45564</code><br>多播端口，与<code>address</code>是创建集群组的原因。要将您的服务器场分为几个不同的组，或将质量检查与生产分开，请更改<code>port</code>或者<code>address</code>
      </p>
    </td></tr><tr><td><code class="attributeName">frequency</code></td><td>
      <p>发送心跳的频率（以毫秒为单位）。默认值为<code>500</code>女士。<br>在大多数情况下，默认值已足够。更改此值，只需更改两次心跳之间的间隔。
      </p>
    </td></tr><tr><td><code class="attributeName">dropTime</code></td><td>
      <p>成员资格组件将使成员超时，如果成员在给定时间内未能发送心跳，则通知频道。默认值为<code>3000</code>女士。这意味着，如果在该时间段内未从成员收到心跳，则成员资格组件将将此通知集群。<br>在高延迟的网络上，您可能希望增加此值，以防止误报。<br>Apache Tribes还提供了<a href="cluster-interceptor.html#org.apache.catalina.tribes.group.interceptors.TcpFailureDetector_Attributes"><code>TcpFailureDetector</code></a>当发生心跳超时时，它将使用TCP连接来验证超时。这样可以防止误报。
      </p>
    </td></tr><tr><td><code class="attributeName">bind</code></td><td>
      <p>如果您希望将多播流量绑定到特定的网络接口，请使用此属性。默认情况下，或者未设置此属性时，它尝试绑定到<code>0.0.0.0</code>有时在多宿主主机上，这将成为一个问题。
      </p>
    </td></tr><tr><td><code class="attributeName">ttl</code></td><td>
      <p>组播心跳的生存时间设置。此设置应为0到255之间的值。默认值为特定于VM的实施。
      </p>
    </td></tr><tr><td><code class="attributeName">domain</code></td><td>
      <p>通过使用此domain属性，Apache Tribes能够将成员按逻辑分组到域中。的<code>org.apache.catalina.tribes.Member.getDomain()</code>方法返回此处指定的值。
      </p>
    </td></tr><tr><td><code class="attributeName">soTimeout</code></td><td>
      <p>心跳的发送和接收是在单个线程上完成的，因此，为了避免永远阻塞该线程，您可以控制<code>SO_TIMEOUT</code>此套接字上的值。<br>如果显示的值小于或等于0，则代码会将默认值设置为频率</p>
    </td></tr><tr><td><code class="attributeName">recoveryEnabled</code></td><td>
      <p>如果发生网络故障，Java多播套接字不会透明地进行故障转移，而是在每次接收请求时，套接字将连续抛出IOException。当recoveryEnabled设置为true时，这将关闭多播套接字并打开一个具有与上面定义的相同属性的新套接字。<br>默认是<code>true</code> 。<br>
      </p>
    </td></tr><tr><td><code class="attributeName">recoveryCounter</code></td><td>
      <p>什么时候<code>recoveryEnabled==true</code>此值指示尝试恢复之前错误必须发生多少次。默认是<code>10</code> 。<br>
      </p>
    </td></tr><tr><td><code class="attributeName">recoverySleepTime</code></td><td>
      <p>什么时候<code>recoveryEnabled==true</code>此值指示系统在两次恢复尝试之间将休眠多长时间（以毫秒为单位），直到成功恢复为止。默认是<code>5000</code> （5秒）。<br>
      </p>
    </td></tr><tr><td><code class="attributeName">localLoopbackDisabled</code></td><td>
      <p>成员资格使用多播，它将调用<code>java.net.MulticastSocket.setLoopbackMode(localLoopbackDisabled)</code> 。什么时候<code>localLoopbackDisabled==true</code>多播消息将不会到达同一本地计算机上的其他节点。默认是<code>false</code> 。<br>
      </p>
    </td></tr></tbody></table>

  </div></div>

  <div class="subsection"><h4 id="Static_Membership_Attributes">静态成员资格属性</h4><div class="text">
    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><strong><code class="attributeName">className</code></strong></td><td>
        <p>值是<code>org.apache.catalina.tribes.membership.StaticMembershipService</code> 。
        </p>
      </td></tr><tr><td><code class="attributeName">connectTimeout</code></td><td>
        <p>尝试TCP连接到预定义静态成员地址的超时。默认为<code>500</code>女士。
        </p>
      </td></tr><tr><td><code class="attributeName">expirationTime</code></td><td>
        <p>如果成员未能在给定时间内更新其生存时间，则此成员资格将通知memberDisappeared事件进行群集。默认为<code>5000</code>女士。
        </p>
      </td></tr><tr><td><code class="attributeName">rpcTimeout</code></td><td>
        <p>用于与其他节点之间的成员通知的消息超时。默认为<code>3000</code>女士。
        </p>
      </td></tr><tr><td><code class="attributeName">useThread</code></td><td>
        <p>如果设置为true，则该成员资格服务将启动本地线程以发送ping消息。如果设置为<code>false</code> ，频道心跳将发送ping消息。默认为<code>false</code> 。
        </p>
      </td></tr><tr><td><code class="attributeName">pingInterval</code></td><td>
        <p>如果<code>useThread</code> == <code>true</code>定义发送ping消息的间隔。默认为<code>1000</code>女士。
        </p>
      </td></tr></tbody></table>
  </div></div>

</div><h3 id="Nested_Components">嵌套组件</h3><div class="text">
  <p>静态会员服务允许嵌套<strong><localmember></localmember></strong>和<strong><member></member></strong>元件。
  </p>
  <div class="subsection"><h4 id="StaticMember_Attributes">StaticMember属性</h4><div class="text">
    <p><b>LocalMember：</b> <br>静态成员，它是静态群集组的本地成员。
    </p>
    <p><strong>注意：</strong>在Tomcat 9.0.17及更高版本中，不需要设置本地成员。可以设置包括本地成员在内的所有群集成员的列表，而不用设置此组件。
    </p>
    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><strong><code class="attributeName">className</code></strong></td><td>仅有一种实现方式： <code>org.apache.catalina.tribes.membership.StaticMember</code>
      </td></tr><tr><td><code class="attributeName">port</code></td><td>无需设置。此属性的值继承自群集接收器设置。
      </td></tr><tr><td><code class="attributeName">securePort</code></td><td>无需设置。此属性的值继承自群集接收器设置。
      </td></tr><tr><td><code class="attributeName">host</code></td><td>无需设置。此属性的值继承自群集接收器设置。
      </td></tr><tr><td><code class="attributeName">domain</code></td><td>该静态成员的逻辑集群域侦听集群消息。两种不同类型的值是可能的：<br>1。常规字符串值（例如“ staging-domain”或“ tomcat-cluster”）将使用ISO-8859-1编码转换为字节。2.字符串形式的字节数组，例如{216,123,12,3}<br>
      </td></tr><tr><td><strong><code class="attributeName">uniqueId</code></strong></td><td>此静态成员的通用uniqueId。值必须为16个字节，格式如下：<br>1.字符串形式的字节数组，例如{0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15}<br>
      </td></tr></tbody></table>

    <p><b>会员：</b> <br>添加到静态群集组的静态成员。
    </p>
    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><strong><code class="attributeName">className</code></strong></td><td>仅有一种实现方式： <code>org.apache.catalina.tribes.membership.StaticMember</code>
      </td></tr><tr><td><strong><code class="attributeName">port</code></strong></td><td>该静态成员侦听集群消息的端口</td></tr><tr><td><code class="attributeName">securePort</code></td><td>该静态成员侦听加密群集消息的安全端口，默认值为<code>-1</code> ，此值表示成员未在安全端口上侦听</td></tr><tr><td><strong><code class="attributeName">host</code></strong></td><td>该静态成员侦听群集消息的主机（或网络接口）。三种不同类型的值是可能的：<br>1。格式为“ 216.123.1.23”的IP地址<br>2。只要正确解析主机名，例如“ tomcat01.mydomain.com”或“ tomcat01”<br>3.字符串形式的字节数组，例如{216,123,12,3}<br>
      </td></tr><tr><td><code class="attributeName">domain</code></td><td>该静态成员的逻辑集群域侦听集群消息。两种不同类型的值是可能的：<br>1。常规字符串值（例如“ staging-domain”或“ tomcat-cluster”）将使用ISO-8859-1编码转换为字节。<br>2.字符串形式的字节数组，例如{216,123,12,3}<br>
      </td></tr><tr><td><strong><code class="attributeName">uniqueId</code></strong></td><td>此静态成员的通用uniqueId。值必须为16个字节，格式如下：<br>1.字符串形式的字节数组，例如{0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15}<br>
      </td></tr></tbody></table>
  </div></div>

  <div class="subsection"><h4 id="Setting">设置</h4><div class="text">
    <p><b>Tomcat 9.0.16之前</b> <br>
    </p><div class="codeBox"><pre><code>     &lt;Membership className="org.apache.catalina.tribes.membership.StaticMembershipService"&gt;
       &lt;LocalMember className="org.apache.catalina.tribes.membership.StaticMember"
                  uniqueId="{0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15}"/&gt;
       &lt;Member className="org.apache.catalina.tribes.membership.StaticMember"
                  port="4004"
                  host="tomcat02.mydomain.com"
                  uniqueId="{1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1}"/&gt;
     &lt;/Membership&gt;</code></pre></div>
     <p></p>
     <p><b>Tomcat9.0.17及更高版本</b> <br>
      </p><div class="codeBox"><pre><code>     &lt;Membership className="org.apache.catalina.tribes.membership.StaticMembershipService"&gt;
       &lt;Member className="org.apache.catalina.tribes.membership.StaticMember"
                  port="4004"
                  host="tomcat01.mydomain.com"
                  uniqueId="{0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15}"/&gt;
       &lt;Member className="org.apache.catalina.tribes.membership.StaticMember"
                  port="4004"
                  host="tomcat02.mydomain.com"
                  uniqueId="{1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1}"/&gt;
     &lt;/Membership&gt;</code></pre></div>
     <p></p>
  </div></div>
</div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="../comments.html">这里</a>解释<a href="../comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>