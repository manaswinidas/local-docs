<html lang="zh-Hans" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="../images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9配置参考（9.0.21）-资源组件</title><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/config/resources">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script></head><body ><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="../images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="../images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>Apache Tomcat 9配置参考</h1><div class="versionInfo">版本9.0.21， <time datetime="2019-06-04"> 2019年6月4日</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>链接</h2><ul><li><a href="../index.html">文件首页</a></li><li><a href="index.html">配置参考家</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">常问问题</a></li><li><a href="#comments_section">用户评论</a></li></ul></div><div><h2>顶级元素</h2><ul><li><a href="server.html">服务器</a></li><li><a href="service.html">服务</a></li></ul></div><div><h2>执行者</h2><ul><li><a href="executor.html">执行者</a></li></ul></div><div><h2>连接器</h2><ul><li><a href="http.html">HTTP / 1.1</a></li><li><a href="http2.html">HTTP / 2</a></li><li><a href="ajp.html">AJP</a></li></ul></div><div><h2>货柜</h2><ul><li><a href="context.html">语境</a></li><li><a href="engine.html">发动机</a></li><li><a href="host.html">主办</a></li><li><a href="cluster.html">簇</a></li></ul></div><div><h2>嵌套组件</h2><ul><li><a href="cookie-processor.html">Cookie处理器</a></li><li><a href="credentialhandler.html">凭证处理程序</a></li><li><a href="globalresources.html">全球资源</a></li><li><a href="jar-scanner.html">JarScanner</a></li><li><a href="jar-scan-filter.html">JarScanFilter</a></li><li><a href="listeners.html">听众</a></li><li><a href="loader.html">装载机</a></li><li><a href="manager.html">经理</a></li><li><a href="realm.html">领域</a></li><li><a href="resources.html">资源资源</a></li><li><a href="sessionidgenerator.html">SessionIdGenerator</a></li><li><a href="valve.html">阀</a></li></ul></div><div><h2>集群元素</h2><ul><li><a href="cluster.html">簇</a></li><li><a href="cluster-manager.html">经理</a></li><li><a href="cluster-channel.html">渠道</a></li><li><a href="cluster-membership.html">频道/会员</a></li><li><a href="cluster-sender.html">频道/发件人</a></li><li><a href="cluster-receiver.html">频道/接收器</a></li><li><a href="cluster-interceptor.html">通道/拦截器</a></li><li><a href="cluster-valve.html">阀</a></li><li><a href="cluster-deployer.html">部署者</a></li><li><a href="cluster-listener.html">集群监听器</a></li></ul></div><div><h2>web.xml</h2><ul><li><a href="filter.html">过滤</a></li></ul></div><div><h2>其他</h2><ul><li><a href="systemprops.html">系统属性</a></li><li><a href="jaspic.html">日本宝石</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>资源组件</h2><h3 id="Table_of_Contents">目录</h3><div class="text">
<ul><li><a href="#Introduction">介绍</a></li><li><a href="#Attributes">属性</a><ol><li><a href="#Common_Attributes">共同属性</a></li><li><a href="#Standard_Implementation">标准实施</a></li></ol></li><li><a href="#Nested_Components">嵌套组件</a></li><li><a href="#Special_Features">特殊功能</a></li></ul>
</div><h3 id="Introduction">介绍</h3><div class="text">

  <p><strong>Resources</strong>元素表示Web应用程序可用的所有资源。这包括类，JAR文件，HTML，JSP以及对Web应用程序有贡献的任何其他文件。提供了使用目录，JAR文件和WAR作为这些资源的来源的实现，并且可以扩展资源实现以提供对以其他形式（例如数据库或版本库）存储的文件的支持。</p>

  <p>资源是默认缓存的。</p>

  <p><strong>注意：仅当webapp不依赖直接文件系统对其自身资源的访问，而是使用ServletContext接口中的方法来访问它们时，才可以使用非基于文件系统的Resources实现来运行webapp。</strong></p>

  <p>Resources元素可以嵌套在<a href="context.html">Context</a>组件内。如果不包括它，将自动创建一个基于默认文件系统的资源，足以满足大多数要求。</p>

</div><h3 id="Attributes">属性</h3><div class="text">

  <div class="subsection"><h4 id="Common_Attributes">共同属性</h4><div class="text">

    <p><strong>资源的</strong>所有实现都支持以下属性：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">allowLinking</code></td><td>
        <p>如果此标志的值为<code>true</code> ，符号链接将被允许在Web应用程序内部，指向Web应用程序基本路径内部或外部的资源。如果未指定，则标志的默认值为<code>false</code> 。</p>
        <p><b>注意：此标志不得在Windows平台（或任何其他不具有区分大小写的文件系统的操作系统）上设置为true，因为它将禁用区分大小写检查，从而允许JSP源代码公开以及其他安全问题。</b></p>
      </td></tr><tr><td><code class="attributeName">cacheMaxSize</code></td><td>
        <p>静态资源缓存的最大大小（以千字节为单位）。如果未指定，则默认值为<code>10240</code> （10 MB）。在Web应用程序运行时（例如，通过JMX）可以更改此值。如果高速缓存使用的内存超过新限制，则高速缓存将尝试随着时间的推移减小大小以满足新限制。如有必要，将减小<strong>cacheObjectMaxSize，</strong>以确保它不大于<code>cacheMaxSize/20</code> 。</p>
      </td></tr><tr><td><code class="attributeName">cacheObjectMaxSize</code></td><td>
        <p>将放置在缓存中的静态资源的最大大小。如果未指定，则默认值为<code>512</code> （512 KB）。如果该值大于<code>cacheMaxSize/20</code>它将减少到<code>cacheMaxSize/20</code> 。在Web应用程序运行时（例如，通过JMX）可以更改此值。</p>
      </td></tr><tr><td><code class="attributeName">cacheTtl</code></td><td>
        <p>重新验证缓存条目之间的时间（以毫秒为单位）。如果未指定，则默认值为<code>5000</code> （5秒）。在Web应用程序运行时（例如，通过JMX）可以更改此值。缓存资源时，它将继承缓存时有效的TTL，并保留该TTL，直到将该资源从缓存中逐出为止，无论对该属性进行任何后续更改。</p>
      </td></tr><tr><td><code class="attributeName">cachingAllowed</code></td><td>
        <p>如果此标志的值为<code>true</code> ，将使用静态资源的缓存。如果未指定，则标志的默认值为<code>true</code> 。在Web应用程序运行时（例如，通过JMX）可以更改此值。禁用缓存后，将从缓存中清除当前缓存中的所有资源。</p>
      </td></tr><tr><td><code class="attributeName">className</code></td><td>
        <p>使用的Java类名称。此类必须实现<code>org.apache.catalina.WebResourceRoot</code>接口。如果未指定，将使用标准值（定义如下）。</p>
      </td></tr><tr><td><code class="attributeName">trackLockedFiles</code></td><td>
        <p>控制是否启用了跟踪锁定文件功能。如果启用，对返回锁定文件的对象的方法的所有调用都需要关闭以释放该锁定（例如， <code>ServletContext.getResourceAsStream()</code> ）将执行许多其他任务。</p>
        <ul>
          <li>调用该方法时的堆栈跟踪将被记录并与返回的对象相关联。</li>
          <li>返回的对象将被包装，以便可以检测到调用close（）（或等效对象）以释放资源的点。一旦释放资源，对对象的跟踪将停止。</li>
          <li>Web应用程序关闭时所有剩余的锁定资源将被记录，然后关闭。</li>
        </ul>
        <p>如果未指定，则默认值为<code>false</code>将会被使用。</p>
      </td></tr></tbody></table>

  </div></div>


  <div class="subsection"><h4 id="Standard_Implementation">标准实施</h4><div class="text">

    <h3>标准根实施</h3>

    <p><strong>资源</strong>的标准实现是<strong>org.apache.catalina.webresources。StandardRoot</strong> 。它不支持任何其他属性。</p>

    <h3>提取根实现</h3>

    <p><strong>资源</strong>的提取实现是<strong>org.apache.catalina.webresources。ExtractingRoot</strong> 。它不支持任何其他属性。</p>

    <p>将Web应用程序作为打包的WAR文件部署时，提取根目录将提取以下文件中的所有JAR文件： <code>/WEB-INF/lib</code>到一个<code>application-jars</code>该目录位于Web应用程序的工作目录中。Web应用程序停止时，将删除这些提取的JAR。</p>

    <p>从打包的WAR中提取JAR文件可能会提高性能，特别是在Web应用程序启动时，当应用程序需要JAR扫描时。</p>

  </div></div>

</div><h3 id="Nested_Components">嵌套组件</h3><div class="text">

  <p>Web应用程序的主要资源由为<a href="context.html">Context</a>定义的<strong>docBase</strong>定义。通过定义一个或多个嵌套组件，可以使其他资源可用于Web应用程序。</p>

  <h3>预资源</h3>

  <p>PreResources在主要资源之前进行搜索。将按照定义的顺序搜索它们。要配置PreResources，请<pre><code>&lt;Resources&gt;
  &lt;PostResources base="D:\Projects\external\classes"
                 className="org.apache.catalina.webresources.DirResourceSet"
                 webAppMount="/WEB-INF/classes"/&gt;
  &lt;PostResources base="D:\Projects\lib\library1.jar"
                 className="org.apache.catalina.webresources.FileResourceSet"
                 webAppMount="/WEB-INF/lib/library1.jar"/&gt;
&lt;/Resources&gt;</code></pre></div>

  <p>由于这两个资源都是PostResources，因此可以预期<code>D:\Projects\external\classes</code>将会在之前搜索课程<code>D:\Projects\lib\library1.jar</code> 。但是，通过使用<code>FileResourceSet</code> ，将JAR映射到<code>/WEB-INF/lib</code>并将在应用程序启动时与其他JAR一起进行处理<code>/WEB-INF/lib</code> 。JAR文件中的类将添加到ClassResources中，这意味着将在从<code>D:\Projects\external\classes</code> 。如果期望的行为是<code>D:\Projects\external\classes</code>之前被搜索过<code>D:\Projects\lib\library1.jar</code>那么需要稍有不同的配置：</p>

  <div class="codeBox"><pre><code>&lt;Resources&gt;
  &lt;PostResources base="D:\Projects\external\classes"
                 className="org.apache.catalina.webresources.DirResourceSet"
                 webAppMount="/WEB-INF/classes"/&gt;
  &lt;PostResources base="D:\Projects\lib\library1.jar"
                 className="org.apache.catalina.webresources.JarResourceSet"
                 webAppMount="/WEB-INF/classes"/&gt;
&lt;/Resources&gt;</code></pre></div>

  <p>简而言之，应将JAR文件添加为<code>JarResourceSet</code>映射到<code>/WEB-INF/classes</code>而不是使用<code>FileResourceSet</code>映射到<code>/WEB-INF/lib</code> 。
  </p>

</div><h3 id="Special_Features">特殊功能</h3><div class="text">

  <p>没有特殊功能与<strong>Resources</strong>元素相关联。</p>

</div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="../comments.html">这里</a>解释<a href="../comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>