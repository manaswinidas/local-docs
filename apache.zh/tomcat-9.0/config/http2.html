<html lang="zh-Hans" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="../images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9配置参考（9.0.21）-HTTP2升级协议</title><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/config/http2">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script></head><body ><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="../images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="../images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>Apache Tomcat 9配置参考</h1><div class="versionInfo">版本9.0.21， <time datetime="2019-06-04"> 2019年6月4日</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>链接</h2><ul><li><a href="../index.html">文件首页</a></li><li><a href="index.html">配置参考家</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">常问问题</a></li><li><a href="#comments_section">用户评论</a></li></ul></div><div><h2>顶级元素</h2><ul><li><a href="server.html">服务器</a></li><li><a href="service.html">服务</a></li></ul></div><div><h2>执行者</h2><ul><li><a href="executor.html">执行者</a></li></ul></div><div><h2>连接器</h2><ul><li><a href="http.html">HTTP / 1.1</a></li><li><a href="http2.html">HTTP / 2</a></li><li><a href="ajp.html">AJP</a></li></ul></div><div><h2>货柜</h2><ul><li><a href="context.html">语境</a></li><li><a href="engine.html">发动机</a></li><li><a href="host.html">主办</a></li><li><a href="cluster.html">簇</a></li></ul></div><div><h2>嵌套组件</h2><ul><li><a href="cookie-processor.html">Cookie处理器</a></li><li><a href="credentialhandler.html">凭证处理程序</a></li><li><a href="globalresources.html">全球资源</a></li><li><a href="jar-scanner.html">JarScanner</a></li><li><a href="jar-scan-filter.html">JarScanFilter</a></li><li><a href="listeners.html">听众</a></li><li><a href="loader.html">装载机</a></li><li><a href="manager.html">经理</a></li><li><a href="realm.html">领域</a></li><li><a href="resources.html">资源资源</a></li><li><a href="sessionidgenerator.html">SessionIdGenerator</a></li><li><a href="valve.html">阀</a></li></ul></div><div><h2>集群元素</h2><ul><li><a href="cluster.html">簇</a></li><li><a href="cluster-manager.html">经理</a></li><li><a href="cluster-channel.html">渠道</a></li><li><a href="cluster-membership.html">频道/会员</a></li><li><a href="cluster-sender.html">频道/发件人</a></li><li><a href="cluster-receiver.html">频道/接收器</a></li><li><a href="cluster-interceptor.html">通道/拦截器</a></li><li><a href="cluster-valve.html">阀</a></li><li><a href="cluster-deployer.html">部署者</a></li><li><a href="cluster-listener.html">集群监听器</a></li></ul></div><div><h2>web.xml</h2><ul><li><a href="filter.html">过滤</a></li></ul></div><div><h2>其他</h2><ul><li><a href="systemprops.html">系统属性</a></li><li><a href="jaspic.html">日本宝石</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>HTTP2升级协议</h2><h3 id="Table_of_Contents">目录</h3><div class="text">
<ul><li><a href="#Introduction">介绍</a></li><li><a href="#Attributes">属性</a><ol><li><a href="#Common_Attributes">共同属性</a></li><li><a href="#Standard_Implementation">标准实施</a></li></ol></li><li><a href="#Nested_Components">嵌套组件</a></li><li><a href="#Special_Features">特殊功能</a></li></ul>
</div><h3 id="Introduction">介绍</h3><div class="text">

  <p><strong>HTTP升级协议</strong>元素表示支持HTTP / 2协议的<strong>升级协议</strong>组件。此组件的实例必须与现有的<a href="http.html">HTTP / 1.1 Connector</a>关联。</p>

  <p>HTTP / 2连接器使用非阻塞I / O，仅在有读写数据时才使用线程池中的容器线程。但是，由于Servlet API从根本上是阻塞的，因此每个HTTP / 2流在该流的持续时间内都需要一个专用的容器线程。</p>

</div><h3 id="Attributes">属性</h3><div class="text">

  <div class="subsection"><h4 id="Common_Attributes">共同属性</h4><div class="text">

  <p><strong>升级协议的</strong>所有实现均支持以下属性：</p>

  <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><strong><code class="attributeName">className</code></strong></td><td>
      <p>这一定是<code>org.apache.coyote.http2.Http2Protocol</code> 。</p>
    </td></tr></tbody></table>

  </div></div>

  <div class="subsection"><h4 id="Standard_Implementation">标准实施</h4><div class="text">

  <p>除了上面列出的公共属性外，HTTP / 2 <strong>升级协议</strong>实现还支持以下属性。</p>

  <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">allowedTrailerHeaders</code></td><td>
      <p>默认情况下，Tomcat在处理HTTP / 2连接时将忽略所有尾部标头。对于要处理的标头，必须将其添加到此标头名称的逗号分隔列表中。</p>
    </td></tr><tr><td><code class="attributeName">compressibleMimeType</code></td><td>
      <p>该值是逗号分隔的MIME类型列表，可以对其使用HTTP压缩。默认值为<code>text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json,application/xml</code> 。
      </p>
    </td></tr><tr><td><code class="attributeName">compression</code></td><td>
      <p>HTTP / 2协议可能会使用压缩来尝试节省服务器带宽。该参数的可接受值为“ off”（禁用压缩），“ on”（允许压缩，这将导致压缩文本数据），“ force”（在所有情况下均强制压缩）或数字整数值（即等效于“ on”，但指定压缩输出之前的最小数据量。如果内容长度未知，并且压缩设置为“ on”或更具攻击性，则输出也将被压缩。如果未指定，则此属性设置为“ off”。</p>
      <p><em>注意</em> ：在使用压缩（节省带宽）和使用sendfile功能（节省CPU周期）之间需要权衡。如果连接器支持sendfile功能（例如NIO2连接器），则使用sendfile将优先于压缩。症状是大于48 Kb的静态文件将以未压缩的形式发送。您可以通过设置关闭sendfile <code>useSendfile</code>协议的属性，如下所述，或者在默认情况下在<a href="../default-servlet.html">DefaultServlet</a>的配置中更改sendfile使用阈值<code>conf/web.xml</code>或在<code>web.xml</code>您的Web应用程序。
      </p>
    </td></tr><tr><td><code class="attributeName">compressionMinSize</code></td><td>
      <p>如果<strong>压缩</strong>设置为“ on”，则此属性可用于指定压缩输出之前的最小数据量。如果未指定，则此属性默认为“ 2048”。</p>
    </td></tr><tr><td><code class="attributeName">initialWindowSize</code></td><td>
      <p>控制Tomcat通告给客户端的流的流控制窗口的初始大小。如果未指定，则默认值为<code>65535</code>用来。</p>
    </td></tr><tr><td><code class="attributeName">keepAliveTimeout</code></td><td>
      <p>当没有活动Stream时，Tomcat在HTTP / 2帧之间等待的时间（以毫秒为单位），然后关闭连接。负值将被视为无限超时。如果未指定，则默认值为<code>20000</code>将会被使用。</p>
    </td></tr><tr><td><code class="attributeName">maxConcurrentStreamExecution</code></td><td>
      <p>控制可以从容器线程池分配线程的任何一个连接的最大流数。如果活动的流多于可用线程，则这些流将不得不等待流变为可用。如果未指定，则默认值为<code>20</code>将会被使用。</p>
    </td></tr><tr><td><code class="attributeName">maxConcurrentStreams</code></td><td>
      <p>控制任何一个连接允许的最大活动流数。如果客户端尝试打开的活动流超过此限制，则流将重置为<code>STREAM_REFUSED</code>错误。如果未指定，则默认值为<code>100</code>将会被使用。</p>
    </td></tr><tr><td><code class="attributeName">maxHeaderCount</code></td><td>
      <p>容器允许的请求中的最大标头数。标头超过指定限制的请求将被拒绝。小于0的值表示没有限制。如果未指定，则使用默认值100。</p>
    </td></tr><tr><td><code class="attributeName">maxHeaderSize</code></td><td>
      <p>容器所允许的请求中所有标头的最大总大小。标头的总大小计算为标头名称的未压缩大小（以字节为单位），加上标头值的未压缩大小（以字节为单位）加上每个标头3个字节的HTTP / 2开销。包含一组头要求超过指定限制的请求将被拒绝。小于0的值表示没有限制。如果未指定，则使用默认值8192。</p>
    </td></tr><tr><td><code class="attributeName">maxTrailerCount</code></td><td>
      <p>容器允许的请求中的拖车标头的最大数量。包含超过指定限制的尾部标头的请求将被拒绝。小于0的值表示没有限制。如果未指定，则使用默认值100。</p>
    </td></tr><tr><td><code class="attributeName">maxTrailerSize</code></td><td>
      <p>容器所允许的请求中所有拖车标头的最大总大小。标头的总大小计算为标头名称的未压缩大小（以字节为单位），加上标头值的未压缩大小（以字节为单位）加上每个标头3个字节的HTTP / 2开销。包含一组要求超过指定限制的尾部标头的请求将被拒绝。小于0的值表示没有限制。如果未指定，则使用默认值8192。</p>
    </td></tr><tr><td><code class="attributeName">noCompressionUserAgents</code></td><td>
      <p>该值是一个正则表达式（使用<code>java.util.regex</code> ）匹配<code>user-agent</code> HTTP客户端的标头，不应该对其进行压缩，因为这些客户端尽管确实宣传了对该功能的支持，但它们的实现方式很糟糕。默认值为空字符串（禁用正则表达式匹配）。</p>
    </td></tr><tr><td><code class="attributeName">overheadCountFactor</code></td><td>
      <p>计算开销帧以确定连接开销是否过高并应关闭时应用的因子。开销计数始于<code>-10</code> 。对于发送或接收的每个数据帧以及接收的每个报头帧，减少计数。计数增加<code>overheadCountFactor</code>对于收到的每个设置，收到的优先级帧和收到的ping。如果开销计数超过零，则连接将关闭。小于<code>1</code>禁用此保护。在正常使用中，值为<code>3</code>或更多内容将在任何流可以完成之前关闭连接。如果未指定，则默认值为<code>1</code>将会被使用。</p>
    </td></tr><tr><td><code class="attributeName">readTimeout</code></td><td>
      <p>收到部分HTTP / 2帧后，Tomcat等待更多数据的时间（以毫秒为单位）。负值将被视为无限超时。如果未指定，则默认值为<code>5000</code>将会被使用。</p>
    </td></tr><tr><td><code class="attributeName">streamReadTimeout</code></td><td>
      <p>当应用程序正在执行阻止的I / O读取并且需要其他数据时，Tomcat等待其他数据帧到达流的时间（以毫秒为单位）。负值将被视为无限超时。如果未指定，则默认值为<code>20000</code>将会被使用。</p>
    </td></tr><tr><td><code class="attributeName">streamWriteTimeout</code></td><td>
      <p>当应用程序正在执行阻塞的I / O写入并且流和/或连接流控制窗口对于应用程序执行阻塞时，Tomcat等待其他窗口更新帧到达流和/或连接的时间（以毫秒为单位）。写完成。负值将被视为无限超时。如果未指定，则默认值为<code>20000</code>将会被使用。</p>
    </td></tr><tr><td><code class="attributeName">useSendfile</code></td><td>
      <p>使用此布尔值属性可以启用或禁用sendfile功能。默认值为<code>true</code> 。</p>
    </td></tr><tr><td><code class="attributeName">writeTimeout</code></td><td>
      <p>当部分写入HTTP / 2帧时，Tomcat等待写入其他数据的时间（以毫秒为单位）。负值将被视为无限超时。如果未指定，则默认值为<code>5000</code>将会被使用。</p>
    </td></tr></tbody></table>

  <p>HTTP / 2升级协议还将从嵌套的<a href="http.html">HTTP连接器</a>继承以下限制：</p>

  <ul>
    <li>maxCookieCount</li>
    <li>maxParameterCount</li>
    <li>maxPostSize</li>
    <li>maxSavePostSize</li>
  </ul>

  </div></div>

</div><h3 id="Nested_Components">嵌套组件</h3><div class="text">

  <p>该组件不支持任何嵌套组件。</p>

</div><h3 id="Special_Features">特殊功能</h3><div class="text">

  <p>该组件不支持任何特殊功能。</p>

</div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="../comments.html">这里</a>解释<a href="../comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>