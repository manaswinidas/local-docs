<html lang="zh-Hans" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="../images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9配置参考（9.0.21）-LifeCycle侦听器组件</title><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/config/listeners">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script></head><body ><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="../images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="../images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>Apache Tomcat 9配置参考</h1><div class="versionInfo">版本9.0.21， <time datetime="2019-06-04"> 2019年6月4日</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>链接</h2><ul><li><a href="../index.html">文件首页</a></li><li><a href="index.html">配置参考家</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">常问问题</a></li><li><a href="#comments_section">用户评论</a></li></ul></div><div><h2>顶级元素</h2><ul><li><a href="server.html">服务器</a></li><li><a href="service.html">服务</a></li></ul></div><div><h2>执行者</h2><ul><li><a href="executor.html">执行者</a></li></ul></div><div><h2>连接器</h2><ul><li><a href="http.html">HTTP / 1.1</a></li><li><a href="http2.html">HTTP / 2</a></li><li><a href="ajp.html">AJP</a></li></ul></div><div><h2>货柜</h2><ul><li><a href="context.html">语境</a></li><li><a href="engine.html">发动机</a></li><li><a href="host.html">主办</a></li><li><a href="cluster.html">簇</a></li></ul></div><div><h2>嵌套组件</h2><ul><li><a href="cookie-processor.html">Cookie处理器</a></li><li><a href="credentialhandler.html">凭证处理程序</a></li><li><a href="globalresources.html">全球资源</a></li><li><a href="jar-scanner.html">JarScanner</a></li><li><a href="jar-scan-filter.html">JarScanFilter</a></li><li><a href="listeners.html">听众</a></li><li><a href="loader.html">装载机</a></li><li><a href="manager.html">经理</a></li><li><a href="realm.html">领域</a></li><li><a href="resources.html">资源资源</a></li><li><a href="sessionidgenerator.html">SessionIdGenerator</a></li><li><a href="valve.html">阀</a></li></ul></div><div><h2>集群元素</h2><ul><li><a href="cluster.html">簇</a></li><li><a href="cluster-manager.html">经理</a></li><li><a href="cluster-channel.html">渠道</a></li><li><a href="cluster-membership.html">频道/会员</a></li><li><a href="cluster-sender.html">频道/发件人</a></li><li><a href="cluster-receiver.html">频道/接收器</a></li><li><a href="cluster-interceptor.html">通道/拦截器</a></li><li><a href="cluster-valve.html">阀</a></li><li><a href="cluster-deployer.html">部署者</a></li><li><a href="cluster-listener.html">集群监听器</a></li></ul></div><div><h2>web.xml</h2><ul><li><a href="filter.html">过滤</a></li></ul></div><div><h2>其他</h2><ul><li><a href="systemprops.html">系统属性</a></li><li><a href="jaspic.html">日本宝石</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>LifeCycle侦听器组件</h2><h3 id="Table_of_Contents">目录</h3><div class="text">
<ul><li><a href="#Introduction">介绍</a></li><li><a href="#Attributes">属性</a><ol><li><a href="#Common_Attributes">共同属性</a></li></ol></li><li><a href="#Nested_Components">嵌套组件</a></li><li><a href="#Standard_Implementations">标准实施</a><ol><li><a href="#APR_Lifecycle_Listener_-_org.apache.catalina.core.AprLifecycleListener">APR生命周期侦听器-org.apache.catalina.core。AprLifecycleListener</a></li><li><a href="#Global_Resources_Lifecycle_Listener_-_org.apache.catalina.mbeans.GlobalResourcesLifecycleListener">全局资源生命周期侦听器-org.apache.catalina.mbeans。GlobalResourcesLifecycleListener</a></li><li><a href="#JNI_Library_Loading_Listener_-_org.apache.catalina.core.JniLifecycleListener">JNI库加载侦听器-org.apache.catalina.core。JniLifecycleListener</a></li><li><a href="#JRE_Memory_Leak_Prevention_Listener_-_org.apache.catalina.core.JreMemoryLeakPreventionListener">JRE内存泄漏预防侦听器-org.apache.catalina.core。JreMemoryLeakPreventionListener</a><ol><li><a href="#JreMemoryLeakPreventionListener_Examples">JreMemoryLeakPreventionListener示例</a></li></ol></li><li><a href="#Security_Lifecycle_Listener_-_org.apache.catalina.security.SecurityListener">安全生命周期侦听器-org.apache.catalina.security。安全监听器</a></li><li><a href="#StoreConfig_Lifecycle_Listener_-_org.apache.catalina.storeconfig.StoreConfigLifecycleListener">StoreConfig生命周期侦听器-org.apache.catalina.storeconfig。StoreConfigLifecycleListener</a></li><li><a href="#ThreadLocal_Leak_Prevention_Listener_-_org.apache.catalina.core.ThreadLocalLeakPreventionListener">ThreadLocal泄漏预防侦听器-org.apache.catalina.core。ThreadLocalLeakPreventionListener</a></li><li><a href="#UserConfig_-_org.apache.catalina.startup.UserConfig">UserConfig-org.apache.catalina.startup。用户配置</a></li><li><a href="#Version_Logging_Lifecycle_Listener_-_org.apache.catalina.startup.VersionLoggerListener">版本日志记录生命周期侦听器-org.apache.catalina.startup。VersionLoggerListener</a></li><li><a href="#JMX_Remote_Lifecycle_Listener_-_org.apache.catalina.mbeans.JmxRemoteLifecycleListener">JMX远程生命周期侦听器-org.apache.catalina.mbeans。JmxRemoteLifecycleListener</a></li><li><a href="#HTTPD_mod_heartmonitor_Listener_-_org.apache.catalina.ha.backend.HeartbeatListener">HTTPD mod_heartmonitor侦听器-org.apache.catalina.ha.backend。心跳监听器</a></li></ol></li></ul>
</div><h3 id="Introduction">介绍</h3><div class="text">

  <p><strong>侦听器</strong>元素定义一个组件，该组件在发生特定事件（通常是Tomcat启动或Tomcat停止）时执行操作。</p>

  <p>侦听器可以嵌套在<a href="server.html">服务器</a> ， <a href="engine.html">引擎</a> ， <a href="host.html">主机</a>或<a href="context.html">上下文中</a> 。某些侦听器仅旨在嵌套在特定元素内。这些限制在下面的文档中说明。</p>

</div><h3 id="Attributes">属性</h3><div class="text">

  <div class="subsection"><h4 id="Common_Attributes">共同属性</h4><div class="text">

    <p><strong>侦听器的</strong>所有实现均支持以下属性：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><strong><code class="attributeName">className</code></strong></td><td>
        <p>使用的Java类名称。此类必须实现<code>org.apache.catalina.LifecycleListener</code>接口。</p>
      </td></tr></tbody></table>

  </div></div>

</div><h3 id="Nested_Components">嵌套组件</h3><div class="text">

  <p>没有元素可以嵌套在<strong>Listener中</strong> 。</p>

</div><h3 id="Standard_Implementations">标准实施</h3><div class="text">

  <p>与大多数Catalina组件不同，有几种标准的<strong>侦听器</strong>实现可用。结果， <code>className</code>属性必须用于选择您要使用的实现。</p>

  <div class="subsection"><h4 id="APR_Lifecycle_Listener_-_org.apache.catalina.core.AprLifecycleListener">APR生命周期侦听器-org.apache.catalina.core。AprLifecycleListener</h4><div class="text">

    <p><strong>APR Lifecycle Listener会</strong>检查APR /本机库是否存在，如果存在，则加载该库。有关更多信息，请参阅<a href="../apr.html">APR /本机指南</a> 。</p>

    <p>此侦听器只能嵌套在<a href="server.html">Server</a>元素内。</p>

    <p><strong>APR Lifecycle Listener</strong>支持以下其他属性：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">SSLEngine</code></td><td>
        <p>要使用的SSLEngine的名称。 <code>off</code> ：不要使用SSL， <code>on</code> ：使用SSL，但不使用特定的引擎。</p>
        <p>默认值为<b>on</b> 。这将初始化本机SSL引擎，必须使用APR / native连接器在本机中启用它<code>SSLEnabled</code>属性。</p>
        <p>有关受支持的SSL硬件引擎和制造商的更多详细信息，请参见<a href="http://www.openssl.org/">OpenSSL官方网站</a> 。
        </p>
      </td></tr><tr><td><code class="attributeName">SSLRandomSeed</code></td><td>
        <p>熵源，用于为SSLEngine的PRNG设置种子。默认值为<code>builtin</code> 。在开发系统上，您可能需要将此设置为<code>/dev/urandom</code>以缩短启动时间。</p>
      </td></tr><tr><td><code class="attributeName">FIPSMode</code></td><td>
        <p>调成<code>on</code>要求OpenSSL处于FIPS模式（如果OpenSSL已经处于FIPS模式，它将保持在FIPS模式）。调成<code>enter</code>强制OpenSSL进入FIPS模式（如果OpenSSL已经处于FIPS模式将发生错误）。调成<code>require</code>要求OpenSSL <i>已经</i>处于FIPS模式（如果OpenSSL尚未处于FIPS模式将发生错误）。</p>
        <p>FIPS模式<em>要求您具有支持FIPS的OpenSSL库，您必须自己构建该库</em> 。如果将此属性设置为上述任何值， <b>则还</b>必须启用<b>SSLEngine</b> 。</p>
        <p>默认值为<code>off</code> 。</p>
      </td></tr><tr><td><code class="attributeName">useAprConnector</code></td><td>
        <p>此属性控制连接器实现的自动选择。当<strong>协议</strong>指定为<code>HTTP/1.1</code>要么<code>AJP/1.3</code>那么如果这个属性是<code>true</code>将使用APR /本机连接器，但如果此属性为false，则将使用NIO连接器。</p>
      </td></tr><tr><td><code class="attributeName">useOpenSSL</code></td><td>
        <p>此属性控制OpenSSL JSSE实现的自动选择。默认是<code>true</code>如果本机库可用并且使用了NIO或NIO2连接器，它将使用OpenSSL。</p>
      </td></tr></tbody></table>

  </div></div>

  <div class="subsection"><h4 id="Global_Resources_Lifecycle_Listener_-_org.apache.catalina.mbeans.GlobalResourcesLifecycleListener">全局资源生命周期侦听器-org.apache.catalina.mbeans。GlobalResourcesLifecycleListener</h4><div class="text">

    <p><strong>全局资源生命周期侦听器</strong>将在server.xml中定义的全局JNDI资源初始化为<a href="globalresources.html">全局资源</a>元素的一部分。没有此侦听器，将不会有全局资源可用。</p>

    <p>此侦听器只能嵌套在<a href="server.html">Server</a>元素内。</p>

    <p><strong>全局资源生命周期侦听器</strong>不支持其他属性。</p>

  </div></div>

  <div class="subsection"><h4 id="JNI_Library_Loading_Listener_-_org.apache.catalina.core.JniLifecycleListener">JNI库加载侦听器-org.apache.catalina.core。JniLifecycleListener</h4><div class="text">

    <p>通过使用共享类加载器（通常是Common类加载器，但在某些配置中可能有所不同）来加载本机库， <strong>JNI库加载侦听</strong>器使多个Web应用程序可以使用本机库。</p>

    <p>侦听器支持两个互斥属性，因此必须使用其中一个，但不能同时使用它们：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">libraryName</code></td><td>
        <p>本机库的名称，如<code>java.lang.System.loadLibrary()</code>
        </p>
      </td></tr><tr><td><code class="attributeName">libraryPath</code></td><td>
        <p>本机库的绝对路径，如中所定义<code>java.lang.System.load()</code>
        </p>
      </td></tr></tbody></table>
  </div></div>

  <div class="subsection"><h4 id="JRE_Memory_Leak_Prevention_Listener_-_org.apache.catalina.core.JreMemoryLeakPreventionListener">JRE内存泄漏预防侦听器-org.apache.catalina.core。JreMemoryLeakPreventionListener</h4><div class="text">

    <p><strong>JRE内存泄漏防护侦听器</strong>为Java运行时环境使用上下文类加载器加载单例的已知位置提供了解决方法，因为如果Web应用程序类加载器当时恰好是上下文类加载器，则这将导致内存泄漏。解决方法是在此侦听器启动时初始化这些单例，因为Tomcat的公共类加载器当时是上下文类加载器。它还为可能导致锁定JAR文件的已知问题提供了解决方法。</p>

    <p>此侦听器只能嵌套在<a href="server.html">Server</a>元素内。</p>

    <p><strong>JRE Memory Leak Prevention Listener</strong>支持以下其他属性：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">appContextProtection</code></td><td>
        <p>启用保护，以便对<code>sun.awt.AppContext.getAppContext()</code> Web应用程序触发的事件不会导致内存泄漏。请注意，除非以无头模式启动Java，否则启用此保护将触发对图形环境的要求。默认是<code>false</code> 。
        </p>
      </td></tr><tr><td><code class="attributeName">AWTThreadProtection</code></td><td>
        <p>启用保护，以便对<code>java.awt.Toolkit.getDefaultToolkit()</code> Web应用程序触发的事件不会导致内存泄漏。默认为<code>false</code>因为启动了AWT线程。如果在Java 9或更高版本上运行，则将禁用此保护，因为已针对Java 9或更高版本修复了泄漏。</p>
      </td></tr><tr><td><code class="attributeName">classesToInitialize</code></td><td>
        <p>在此侦听器启动期间加载和初始化的逗号分隔的完全限定的类名列表。如果在请求处理过程中加载了已知会导致类加载器泄漏的类，则可以预加载这些类。可以引用非JRE类，例如<code>oracle.jdbc.driver.OracleTimeoutThreadPerVM</code> 。缺省值为空，但是特定的JRE类由此侦听器的其他属性管理的其他泄漏保护功能加载。</p>
      </td></tr><tr><td><code class="attributeName">driverManagerProtection</code></td><td>
        <p>第一次使用<code>java.sql.DriverManager</code>将触发当前类加载器及其父级可见的JDBC驱动程序的加载。Web应用程序级别的内存泄漏保护在大多数情况下可以解决此问题，但在此处触发加载的副作用较小。默认是<code>true</code> 。</p>
      </td></tr><tr><td><code class="attributeName">forkJoinCommonPoolProtection</code></td><td>
        <p>启用保护，以便为<code>ForkJoinPool.commonPool()</code>不会导致内存泄漏。通过设置<code>java.util.concurrent.ForkJoinPool.common.threadFactory</code>系统属性。如果在Tomcat启动时设置了此属性，则即使显式启用了此保护，Tomcat也不会覆盖它。默认是<code>true</code> 。如果在Java 9或更高版本上运行，则将禁用此保护，因为已针对Java 9或更高版本修复了泄漏。</p>
      </td></tr><tr><td><code class="attributeName">gcDaemonProtection</code></td><td>
        <p>启用保护，以便对<code>sun.misc.GC.requestLatency(long)</code> Web应用程序触发的事件不会导致内存泄漏。使用RMI可能会触发对此方法的调用。启用此保护的副作用是创建了一个名为“ GC Daemon”的线程。该保护使用反射来访问内部Sun类，并且可能会在非Sun JVM上启动时产生错误。默认是<code>true</code> 。如果在Java 9或更高版本上运行，则将禁用此保护，因为已针对Java 9或更高版本修复了泄漏。</p>
      </td></tr><tr><td><code class="attributeName">ldapPoolProtection</code></td><td>
        <p>启用保护，以使PoolCleaner线程由<code>com.sun.jndi.ldap.LdapPoolManager</code>不会导致内存泄漏。线程在第一次启动时启动<code>LdapPoolManager</code>如果系统属性使用类<code>com.sun.jndi.ldap.connect.pool.timeout</code>设置为大于0的值。如果没有这种保护，则如果Web应用程序使用此类，则PoolCleaner线程将被配置为将线程的上下文类加载器设置为Web应用程序类加载器，从而在重新加载时触发内存泄漏。默认为<code>true</code> 。如果在Java 9或更高版本上运行，则将禁用此保护，因为已针对Java 9或更高版本修复了泄漏。</p>
      </td></tr><tr><td><code class="attributeName">tokenPollerProtection</code></td><td>
        <p>启用保护，以便任何由以下人员初始化的令牌轮询器线程<code>sun.security.pkcs11.SunPKCS11.initToken()</code>不会导致内存泄漏。作为Java密码体系结构初始化的一部分，根据各种条件启动线程。如果没有保护，则可能会在Webapp部署过程中初始化用于生成会话ID的MessageDigest时发生。结果，线程将Webapp类加载器作为其线程上下文类加载器。启用保护会在Tomcat启动期间及早初始化JCA。默认为<code>true</code> 。如果在Java 9或更高版本上运行，则将禁用此保护，因为已针对Java 9或更高版本修复了泄漏。</p>
      </td></tr><tr><td><code class="attributeName">urlCacheProtection</code></td><td>
        <p>启用保护，以便使用以下命令从JAR文件读取资源<code>java.net.URLConnection</code> s不会导致JAR文件被锁定。请注意，启用此保护后，默认情况下将禁用通过缓存获取的所有资源的缓存<code>java.net.URLConnection</code> s。可以根据需要根据情况重新启用缓存。默认为<code>true</code> 。</p>
      </td></tr><tr><td><code class="attributeName">xmlParsingProtection</code></td><td>
        <p>启用保护，以便在Web应用程序中解析XML文件不会导致内存泄漏。请注意，内存分析器可能不会显示与此泄漏关联的GC根目录，这使其特别难以诊断。默认为<code>true</code> 。如果在Java 9或更高版本上运行，则将禁用此保护，因为已针对Java 9或更高版本修复了泄漏。</p>
      </td></tr></tbody></table>

    <div class="subsection"><h4 id="JreMemoryLeakPreventionListener_Examples">JreMemoryLeakPreventionListener示例</h4><div class="text">

      <p>以下是如何配置<code>classesToInitialize</code>此侦听器的属性。</p>

      <p>如果此侦听器在server.xml中配置为：</p>

      <div class="codeBox"><pre><code>  &lt;Listener className="org.apache.catalina.core.JreMemoryLeakPreventionListener"
            classesToInitialize="oracle.jdbc.driver.OracleTimeoutThreadPerVM" /&gt;</code></pre></div>

      <p>然后<code>OracleTimeoutThreadPerVM</code>类将在侦听器启动期间而不是在请求处理期间加载和初始化。</p>

    </div></div>

  </div></div>

  <div class="subsection"><h4 id="Security_Lifecycle_Listener_-_org.apache.catalina.security.SecurityListener">安全生命周期侦听器-org.apache.catalina.security。安全监听器</h4><div class="text">

    <p><strong>安全生命周期侦听器</strong>在Tomcat启动时执行许多安全检查，并在失败时阻止Tomcat启动。默认情况下未启用侦听器。要启用它，请取消注释$ CATALINA_BASE / conf / server.xml中的侦听器。对于9.0.7之前的Tomcat版本，如果操作系统支持umask，则$ CATALINA_HOME / bin / catalina.sh中获取umask的行也无需取消注释。对于Tomcat 9.0.7及更高版本，umask会自动传递到Tomcat中。</p>

    <p>此侦听器只能嵌套在<a href="server.html">Server</a>元素内。</p>

    <p><strong>安全生命周期侦听器</strong>支持以下其他属性：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">checkedOsUsers</code></td><td>
        <p>逗号分隔的OS用户列表，不得用于启动Tomcat。如果未指定，则使用<b>root</b>的默认值。要禁用此检查，请将属性设置为空字符串。用户名以不区分大小写的方式检查。</p>
      </td></tr><tr><td><code class="attributeName">minimumUmask</code></td><td>
        <p>在Tomcat启动之前必须配置的限制最少的umask。如果未指定，则使用默认值<b>0007</b> 。要禁用此检查，请将属性设置为空字符串。在Windows平台上不执行检查。</p>
      </td></tr></tbody></table>

  </div></div>

  <div class="subsection"><h4 id="StoreConfig_Lifecycle_Listener_-_org.apache.catalina.storeconfig.StoreConfigLifecycleListener">StoreConfig生命周期侦听器-org.apache.catalina.storeconfig。StoreConfigLifecycleListener</h4><div class="text">

    <p><strong>StoreConfig Lifecycle Listener</strong>配置一个StoreConfig MBean，该MBean可以用于将server.xml中的当前服务器配置或context.xml文件中的Web应用程序的当前配置保存。</p>

    <p>此侦听器只能嵌套在<a href="server.html">Server</a>元素内。</p>

    <p><strong>StoreConfig Lifecycle Listener</strong>支持以下其他属性：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">storeConfigClass</code></td><td>
        <p>的名称<code>IStoreConfig</code>实施使用。如果未指定默认值<code>org.apache.catalina.storeconfig.StoreConfig</code>将会被使用。</p>
      </td></tr><tr><td><code class="attributeName">storeRegistry</code></td><td>
        <p>配置文件的网址，用于配置如何<code>IStoreConfig</code>是保存配置。如果未指定内置资源<code>/org/apache/catalina/storeconfig/server-registry.xml</code>将会被使用。</p>
      </td></tr></tbody></table>

  </div></div>

  <div class="subsection"><h4 id="ThreadLocal_Leak_Prevention_Listener_-_org.apache.catalina.core.ThreadLocalLeakPreventionListener">ThreadLocal泄漏预防侦听器-org.apache.catalina.core。ThreadLocalLeakPreventionListener</h4><div class="text">

    <p>当<a href="context.html">上下文</a>停止时， <strong>ThreadLocal防泄漏侦听器</strong>将触发<a href="executor.html">执行程序</a>池中的线程更新，以避免与线程本地相关的内存泄漏。活动线程在执行任务后回到池中时，它们将被一个接一个地更新。更新仅在具有它们的上下文的情况下发生<code>renewThreadsWhenStoppingContext</code>属性设置为<code>true</code> 。</p>

    <p>此侦听器只能嵌套在<a href="server.html">Server</a>元素内。</p>

    <p><strong>ThreadLocal泄漏预防侦听器</strong>不支持其他属性。</p>

  </div></div>

  <div class="subsection"><h4 id="UserConfig_-_org.apache.catalina.startup.UserConfig">UserConfig-org.apache.catalina.startup。用户配置</h4><div class="text">

    <p><strong>UserConfig</strong>提供用户Web应用程序的功能。用户Web应用程序将以波浪号（“〜”）和用户名开头的请求URI映射到服务器上该用户主目录中的目录（通常称为public_html）。</p>

    <p>有关更多信息，请参见<strong>Host</strong>元素上的<a href="host.html#User_Web_Applications">User Web Applications</a>特殊功能。</p>

    <p><strong>UserConfig</strong>支持以下附加属性：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">directoryName</code></td><td>
        <p>在每个用户主目录中要搜索的目录名称。默认是<code>public_html</code> 。</p>
      </td></tr><tr><td><code class="attributeName">userClass</code></td><td>
        <p>用户数据库类的类名称。当前有两个用户数据库， <code>org.apache.catalina.startup.PasswdUserDatabase</code>在使用/ etc / passwd文件标识有效用户的Unix系统上使用。的<code>org.apache.catalina.startup.HomesUserDatabase</code>在未使用/ etc / passwd的服务器上使用。HomesUserDatabase部署在指定基本目录中找到的所有目录。</p>
      </td></tr><tr><td><code class="attributeName">homeBase</code></td><td>
        <p>包含用户主目录的基本目录。仅在以下情况下有效<code>org.apache.catalina.startup.HomesUserDatabase</code>用来。</p>
      </td></tr><tr><td><code class="attributeName">allow</code></td><td>
        <p>定义允许部署的用户的正则表达式。如果指定了此属性，则要部署的用户必须与此模式匹配。如果未指定此属性，则除非用户匹配拒绝模式，否则将部署所有用户。</p>
      </td></tr><tr><td><code class="attributeName">deny</code></td><td>
        <p>定义拒绝部署的用户的正则表达式。如果指定了此属性，则部署的用户不得与此模式匹配。如果未指定此属性，则用户的部署将由allow属性控制。</p>
      </td></tr></tbody></table>

  </div></div>

  <div class="subsection"><h4 id="Version_Logging_Lifecycle_Listener_-_org.apache.catalina.startup.VersionLoggerListener">版本日志记录生命周期侦听器-org.apache.catalina.startup。VersionLoggerListener</h4><div class="text">

    <p>当Tomcat启动时， <strong>版本日志记录生命周期侦听器</strong>将记录Tomcat，Java和操作系统信息。</p>

    <p>此侦听器只能嵌套在<a href="server.html">Server</a>元素内，并且应该是定义的第一个侦听器。</p>

    <p><strong>版本日志记录生命周期侦听器</strong>支持以下其他属性：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">logArgs</code></td><td>
        <p>如果<code>true</code> ，将记录Tomcat启动时传递给Java的命令行参数。如果未指定，则默认值为<code>true</code>将会被使用。</p>
      </td></tr><tr><td><code class="attributeName">logEnv</code></td><td>
        <p>如果<code>true</code> ，将记录Tomcat启动时的当前环境变量。如果未指定，则默认值为<code>false</code>将会被使用。</p>
      </td></tr><tr><td><code class="attributeName">logProps</code></td><td>
        <p>如果<code>true</code> ，将记录当前的Java系统属性。如果未指定，则默认值为<code>false</code>将会被使用。</p>
      </td></tr></tbody></table>

  </div></div>

  <div class="subsection"><h4 id="JMX_Remote_Lifecycle_Listener_-_org.apache.catalina.mbeans.JmxRemoteLifecycleListener">JMX远程生命周期侦听器-org.apache.catalina.mbeans。JmxRemoteLifecycleListener</h4><div class="text">

    <p><strong>JMX远程生命周期侦听器</strong>修复了JMX / RMI服务器使用的端口，如果您需要将visualvm或类似工具连接到在防火墙后运行的远程Tomcat实例，则使事情变得更加简单。</p>

    <p>其余的配置可以通过用于配置JMX的标准系统属性来完成。有关配置JMX的更多信息，请参阅Java SDK文档随附的<a href="http://docs.oracle.com/javase/6/docs/technotes/guides/management/agent.html">使用JMX进行监视和管理</a> 。</p>

    <p>此侦听器只能嵌套在<a href="server.html">Server</a>元素内。</p>

    <p>除了下面在“ SSL配置”部分中指出的与SSL相关的属性外， <strong>JMX Remote Lifecycle Listener</strong>还支持以下其他属性：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">accessFile</code></td><td>
        <p>定义使用的访问文件。该属性将设置为<code>com.sun.management.jmxremote.access.file</code>系统属性（如果已定义）。</p>
      </td></tr><tr><td><code class="attributeName">authenticate</code></td><td>
        <p>定义是否使用身份验证。默认为<code>true</code> 。该属性将设置为<code>com.sun.management.jmxremote.authenticate</code>系统属性（如果已定义）。</p>
      </td></tr><tr><td><code class="attributeName">loginModuleName</code></td><td>
        <p>定义使用的登录模块。该属性将设置为<code>com.sun.management.jmxremote.login.config</code>系统属性（如果已定义）。</p>
      </td></tr><tr><td><code class="attributeName">passwordFile</code></td><td>
        <p>定义使用的密码文件。该属性将设置为<code>com.sun.management.jmxremote.password.file</code>系统属性（如果已定义）。</p>
      </td></tr><tr><td><code class="attributeName">rmiBindAddress</code></td><td>
        <p>JMX / RMI服务器要使用的接口的地址。</p>
      </td></tr><tr><td><strong><code class="attributeName">rmiRegistryPortPlatform</code></strong></td><td>
        <p>JMX / RMI注册表用于平台MBean的端口。这取代了<code>com.sun.management.jmxremote.port</code>使用此侦听器时不应设置的系统属性。</p>
      </td></tr><tr><td><code class="attributeName">rmiRegistrySSL</code></td><td>
        <p>定义RMI注册表是否将使用SSL。默认为<code>true</code> 。该属性将设置为<code>com.sun.management.jmxremote.registry.ssl</code>系统属性（如果已定义）。</p>
      </td></tr><tr><td><strong><code class="attributeName">rmiServerPortPlatform</code></strong></td><td>
        <p>Platform JMX / RMI服务器要使用的端口。</p>
      </td></tr><tr><td><code class="attributeName">rmiServerSSL</code></td><td>
        <p>定义JMX远程服务器是否将使用SSL。默认为<code>true</code> 。该属性将设置为<code>com.sun.management.jmxremote.ssl</code>系统属性（如果已定义）。</p>
      </td></tr><tr><td><code class="attributeName">useLocalPorts</code></td><td>
        <p>是否应强制所有使用这些端口的客户端使用本地端口连接到JMX / RMI服务器。当通过SSH或类似方式建立连接隧道时，这很有用。默认为<code>false</code> 。</p>
      </td></tr></tbody></table>

    <h3>使用基于文件的身份验证和授权</h3>

    <p>如果此侦听器在server.xml中配置为：</p>
  <div class="codeBox"><pre><code>  &lt;Listener className="org.apache.catalina.mbeans.JmxRemoteLifecycleListener"
          rmiRegistryPortPlatform="10001" rmiServerPortPlatform="10002" /&gt;</code></pre></div>
    <p>设置了以下系统属性（例如在setenv.sh中）：</p>
  <div class="codeBox"><pre><code>  -Dcom.sun.management.jmxremote.password.file=$CATALINA_BASE/conf/jmxremote.password
  -Dcom.sun.management.jmxremote.access.file=$CATALINA_BASE/conf/jmxremote.access
  -Dcom.sun.management.jmxremote.ssl=false</code></pre></div>
    <p>$ CATALINA_BASE / conf / jmxremote.password包含：</p>
  <div class="codeBox"><pre><code>admin letmein</code></pre></div>
    <p>$ CATALINA_BASE / conf / jmxremote.access包含：</p>
  <div class="codeBox"><pre><code>admin readwrite</code></pre></div>
    <p>然后在防火墙中打开端口10001（RMI注册表）和10002（JMX / RMI服务器）将使jconsole使用以下形式的连接字符串连接到在防火墙后面运行的Tomcat实例：</p>
  <div class="codeBox"><pre><code>service:jmx:rmi://&lt;hostname&gt;:10002/jndi/rmi://&lt;hostname&gt;:10001/jmxrmi</code></pre></div>
    <p>用户名为<code>admin</code>和密码<code>letmein</code> 。
    </p>

    <h3>SSL配置</h3>

    <p>注意：可以使用与<a href="http.html#SSL_Support_-_SSLHostConfig">SSLHostConfig</a>相同的属性以及为<a href="http.html#SSL_Support_-_Certificate">SSLHostConfigCertificate</a>定义的默认证书的属性来完成SSL配置。这将创建一个JSSE SSLContext，它将在创建服务器套接字时提供给JMX / RMI注册表。由于JMX远程只能使用常规SSLContext， <strong>因此不能</strong>在配置中使用OpenSSL特定的属性。</p>

    <p>可以使用密钥库为服务器定义证书：</p>
  <div class="codeBox"><pre><code>  &lt;Listener className="org.apache.catalina.mbeans.JmxRemoteLifecycleListener"
               rmiRegistryPortPlatform="10001" rmiServerPortPlatform="10002"
               certificateKeystoreFile="${catalina.home}/conf/mykeystore.jks" /&gt;</code></pre></div>

    <h3>使用JAAS</h3>

    <p>如果我们改用以下系统属性：</p>
  <div class="codeBox"><pre><code>  -Dcom.sun.management.jmxremote.login.config=Tomcat
  -Djava.security.auth.login.config=$CATALINA_BASE/conf/login.config
  -Dcom.sun.management.jmxremote.access.file=$CATALINA_BASE/conf/jmxremote.access
  -Dcom.sun.management.jmxremote.ssl=false</code></pre></div>
    <p>$ CATALINA_BASE / conf / login.config包含您选择的JAAS LoginModule实现，例如：</p>
  <div class="codeBox"><pre><code>  Tomcat { /* should match to the com.sun.management.jmxremote.login.config property */

    /* for illustration purposes only */
    com.sun.security.auth.module.LdapLoginModule REQUIRED
      userProvider="ldap://ldap-svr/ou=people,dc=example,dc=com"
      userFilter="(&amp;(uid={USERNAME})(objectClass=inetOrgPerson))"
      authzIdentity="admin"
      debug=true;
  };</code></pre></div>
    <p>$ CATALINA_BASE / conf / jmxremote.access包含：</p>
  <div class="codeBox"><pre><code>admin readwrite</code></pre></div>
    <p>那么我们将需要提供LDAP凭据。
    </p>

    <p><strong>请注意，以上示例未使用SSL。应将JMX访问视为等同于管理访问，并应予以相应保护。
    </strong></p>

  </div></div>

  <div class="subsection"><h4 id="HTTPD_mod_heartmonitor_Listener_-_org.apache.catalina.ha.backend.HeartbeatListener">HTTPD mod_heartmonitor侦听器-org.apache.catalina.ha.backend。心跳监听器</h4><div class="text">

    <p><strong>HTTPD mod_heartmonitor侦听器</strong>允许tomcat将心跳消息发送到Apache HTTPD mod_heartmonitor模块。</p>

    <p><strong>HTTPD mod_heartmonitor侦听器</strong>支持以下其他属性：</p>

    <table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="attributeName">Port</code></td><td>
        <p>移植将接收来自HTTPD代理流量的连接器，默认情况下将使用第一个连接器</p>
      </td></tr><tr><td><code class="attributeName">Host</code></td><td>
        <p>主机是与将接收代理流量的连接器<strong>地址</strong>相对应的IP，默认为空，将使用<strong>端口</strong></p>
      </td></tr><tr><td><code class="attributeName">proxyURL</code></td><td>
        <p>proxyURL是与心跳处理程序的httpd配置中的<strong>位置</strong>相对应的URL，默认为/ HeartbeatListener</p>
      </td></tr><tr><td><code class="attributeName">ProxyList</code></td><td>
        <p>ProxyList是雄猫将要从中接收请求的代理列表，格式为“ address：port，address：port”，一旦填充，则禁用多播逻辑并且忽略多参数</p>
      </td></tr><tr><td><code class="attributeName">Group</code></td><td>
        <p>组是用于将消息广播到HTTPD的多播IP，默认值为224.0.1.105</p>
      </td></tr><tr><td><code class="attributeName">Multiport</code></td><td>
        <p>Multiport是用于将消息广播到HTTPD的Multicast端口，默认为23364</p>
      </td></tr><tr><td><code class="attributeName">Ttl</code></td><td>
        <p>Ttl是板载消息的TTL，默认值为16</p>
      </td></tr></tbody></table>
  </div></div>

</div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="../comments.html">这里</a>解释<a href="../comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>