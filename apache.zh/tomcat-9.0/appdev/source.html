<html lang="zh-Hans" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="../images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>应用程序开发人员指南（9.0.21）-源组织</title><meta name="author" content="Craig R. McClanahan"><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/appdev/source">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script></head><body ><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="../images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="../images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>Application Developer's Guide</h1><div class="versionInfo">
          Version 9.0.21,
          <time datetime="2019-06-04">Jun 4 2019</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>Links</h2><ul><li><a href="../index.html">Docs Home</a></li><li><a href="index.html">App Dev Guide Home</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">FAQ</a></li><li><a href="#comments_section">User Comments</a></li></ul></div><div><h2>Contents</h2><ul><li><a href="index.html">Contents</a></li><li><a href="introduction.html">Introduction</a></li><li><a href="installation.html">Installation</a></li><li><a href="deployment.html">Deployment</a></li><li><a href="source.html">Source Code</a></li><li><a href="processes.html">Processes</a></li><li><a href="sample/">Example App</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>Source Organization</h2><h3 id="Table_of_Contents">Table of Contents</h3><div class="text">
<ul><li><a href="#Directory_Structure">Directory Structure</a><ol><li><a href="#External_Dependencies">External Dependencies</a></li></ol></li><li><a href="#Source_Code_Control">Source Code Control</a></li><li><a href="#BUILD.XML_Configuration_File">BUILD.XML Configuration File</a></li></ul>
</div><h3 id="Directory_Structure">Directory Structure</h3><div class="text">

    <p><em>The description below uses the variable name $CATALINA_BASE to refer the
    base directory against which most relative paths are resolved. If you have
    not configured Tomcat for multiple instances by setting a CATALINA_BASE
    directory, then $CATALINA_BASE will be set to the value of $CATALINA_HOME,
    the directory into which you have installed Tomcat.</em></p>

<p>A key recommendation of this manual is to separate the directory
hierarchy containing your source code (described in this section) from
the directory hierarchy containing your deployable application
(described in the preceding section).  Maintaining this separation has
the following advantages:</p>
<ul>
<li><p>The contents of the source directories can be more easily administered,
    moved, and backed up if the "executable" version of the application
    is not intermixed.
    </p></li>
<li><p>Source code control is easier to manage on directories that contain
    only source files.
    </p></li>
<li><p>The files that make up an installable distribution of your
    application are much easier to select when the deployment
    hierarchy is separate.</p></li>
</ul>

<p>As we will see, the <code>ant</code> development tool makes the creation
and processing of such directory hierarchies nearly painless.</p>

<p>The actual directory and file hierarchy used to contain the source code
of an application can be pretty much anything you like.  However, the
following organization has proven to be quite generally applicable, and is
expected by the example <code>build.xml</code> configuration file that
is discussed below.  All of these components exist under a top level
<em>project source directory</em> for your application:</p>
<ul>
<li><strong>docs/</strong> - Documentation for your application, in whatever
    format your development team is using.<br><br></li>
<li><strong>src/</strong> - Java source files that generate the servlets,
    beans, and other Java classes that are unique to your application.
    If your source code is organized in packages (<strong>highly</strong>
    recommended), the package hierarchy should be reflected as a directory
    structure underneath this directory.<br><br></li>
<li><strong>web/</strong> - The static content of your web site (HTML pages,
    JSP pages, JavaScript files, CSS stylesheet files, and images) that will
    be accessible to application clients.  This directory will be the
    <em>document root</em> of your web application, and any subdirectory
    structure found here will be reflected in the request URIs required to
    access those files.<br><br></li>
<li><strong>web / WEB-INF /</strong> -应用程序所需的特殊配置文件，包括Web应用程序部署描述符（ <code>web.xml</code> （在<a href="https://wiki.apache.org/tomcat/Specifications">Servlet规范中</a>定义），用于已创建的自定义标签库的标签库描述符以及希望包含在Web应用程序中的其他资源文件。即使此目录似乎是<em>文档根</em>目录的子目录，Servlet规范也禁止将该目录的内容（或其包含的任何文件）直接提供给客户请求。因此，这是存储敏感配置信息（例如数据库连接用户名和密码）的好地方，但是配置信息是应用程序成功运行所必需的。</li>
</ul>

<p>在开发过程中，将临时创建两个其他目录：</p>
<ul>
<li><strong>构建/</strong> -执行默认构建时（ <code>ant</code> ），此目录将包含此应用程序的Web应用程序档案中文件的确切图像。Tomcat允许您将应用程序复制到以下这样的解压缩目录中： <code>$CATALINA_BASE/webapps</code>目录，或通过“ Manager” Web应用程序进行<em>安装</em> 。后一种方法在开发过程中非常有用，下面将进行说明。
    <br><br></li>
<li><strong>dist /</strong> -执行<code>ant dist</code>目标，将创建此目录。它将为您的Web应用程序创建二进制分发的精确映像，包括您准备的许可证信息，文档和自述文件。</li>
</ul>

<p>请注意，这两个目录应该<strong>不会</strong>在你的源代码控制系统的开发过程中需要存档，因为它们删除并重新创建（从零开始）。因此，如果要保留更改的永久记录，则不应编辑这些目录中的任何源文件，因为在下次执行构建时，更改将丢失。</p>

  <div class="subsection"><h4 id="External_Dependencies">外部依赖</h4><div class="text">

  <p>如果您的应用程序需要外部项目或程序包中的JAR文件（或其他资源），该怎么办？一个常见的示例是您需要在Web应用程序中包括JDBC驱动程序才能进行操作。</p>

  <p>不同的开发人员针对此问题采用不同的方法。有些人会鼓励为每个需要那些JAR文件的应用程序将您依赖的JAR文件的副本检查到源代码控制档案中。但是，当您在许多应用程序中使用相同的JAR时，这可能会导致重大的管理问题，尤其是当需要升级到该JAR文件的不同版本时。</p>

  <p>因此，本手册建议您<strong>不要</strong>在应用程序的源代码管理档案中存储您依赖的软件包的副本。相反，应将外部依赖项集成为<strong>构建</strong>应用程序的过程的一部分。这样，您始终可以从开发系统管理员安装过的任何位置获取相应版本的JAR文件，而不必担心每次更改依赖JAR文件的版本时都会更新您的应用程序。</p>

  <p>在示例蚂蚁<code>build.xml</code>文件，我们将演示如何定义<em>构建属性</em> ，这些<em>属性</em>使您可以配置要复制的文件的位置，而无需修改<code>build.xml</code>这些文件更改时。特定开发人员使用的构建属性可以基于每个应用程序进行自定义，或者默认为存储在开发人员主目录中的“标准”构建属性。</p>

  <p>在许多情况下，您的开发系统管理员已经将所需的JAR文件安装到了<code>lib</code> Tomcat目录。完成此操作后，您根本无需采取任何操作-该示例<code>build.xml</code>文件会自动构造一个包含这些文件的编译类路径。</p>

  </div></div>

</div><h3 id="Source_Code_Control">源代码控制</h3><div class="text">

<p>如前所述，强烈建议您将构成应用程序的所有源文件置于源代码控制系统（如并行版本系统（CVS））的管理下。如果选择这样做，则应注册并保存源层次结构中的每个目录和文件-但不生成任何文件。如果注册二进制格式的文件（例如图像或JAR库），请确保在源代码控制系统中指出这一点。</p>

<p>我们建议（在上一节中）您不应存储以下内容： <code>build/</code>和<code>dist/</code>您的开发过程在源代码控制系统中创建的目录。告诉CVS忽略这些目录的一种简单方法是创建一个名为<code>.cvsignore</code> （请注意前置期间）在顶级源目录中，其内容如下：</p>
<div class="codeBox"><pre><code>build
dist
build.properties</code></pre></div>

<p>提及的原因<code>build.properties</code>此处将在“ <a href="processes.html">流程”</a>部分中进行说明。</p>

<p>有关源代码控制环境的详细说明超出了本手册的范围。但是，使用命令行CVS客户端时，请遵循以下步骤：</p>
<ul>
<li>要将源代码的状态刷新为源存储库中存储的状态，请转至项目源目录，然后执行<code>cvs update -dP</code> 。
    <br><br></li>
<li>在源代码层次结构中创建新的子目录时，请使用以下命令在CVS中注册它<code>cvs add {subdirname}</code> 。
    <br><br></li>
<li>首次创建新的源代码文件时，请导航至包含该文件的目录，并使用以下命令注册新文件： <code>cvs add {filename}</code> 。
    <br><br></li>
<li>如果您不再需要特定的源代码文件，请导航到包含的目录并删除该文件。然后，使用以下命令在CVS中注销它<code>cvs remove {filename}</code> 。
    <br><br></li>
<li>在创建，修改和删除源文件时，更改尚未反映在服务器存储库中。要将更改保存为当前状态，请转到项目源目录并执行<code>cvs commit</code> 。您将被要求写下您刚刚完成的更改的简短描述，并将其与任何更新的源文件的新版本一起存储。</li>
</ul>

<p>像其他源代码控制系统一样，CVS具有许多其他功能（例如，标记组成特定发行版的文件的功能，以及对以后可以合并的多个开发分支的支持）。有关更多信息，请参见“ <a href="introduction.html">简介”中</a>的链接和参考。</p>

</div><h3 id="BUILD.XML_Configuration_File">BUILD.XML配置文件</h3><div class="text">

<p>我们将使用<strong>ant</strong>工具来管理Java源代码文件的编译以及部署层次结构的创建。Ant在构建文件的控制下运行，通常称为<code>build.xml</code> ，它定义了所需的处理步骤。此文件存储在源代码层次结构的顶级目录中，并且应签入源代码控制系统。</p>

<p>就像Makefile一样， <code>build.xml</code>文件提供了一些支持可选开发活动的“目标”（例如，创建关联的Javadoc文档，擦除部署主目录，以便您可以从头开始构建项目，或创建Web应用程序归档文件，以便可以分发应用程序。一个结构良好的<code>build.xml</code>文件将包含内部文档，这些文档描述了设计用于开发人员的目标以及内部使用的目标。要要求Ant显示项目文档，请转到包含以下内容的目录： <code>build.xml</code>文件和类型：</p>
<div class="codeBox"><pre><code>ant -projecthelp</code></pre></div>

<p>为了让您有一个良好的开端，提供了一个<a href="build.xml.txt">基本的build.xml文件</a> ，您可以自定义该<a href="build.xml.txt">文件</a>并将其安装在应用程序的项目源目录中。该文件包含描述可以执行的各种目标的注释。简要地说，通常提供以下目标：</p>
<ul>
<li><strong>干净</strong> -此目标删除所有现有目标<code>build</code>和<code>dist</code>目录，以便可以从头开始重建它们。这样可以保证您没有进行源代码修改，而由于没有重新编译所有受影响的类，这些修改将在运行时导致问题。
    <br><br></li>
<li><strong>编译</strong> -此目标用于编译自上次编译以来已更改的任何源代码。生成的类文件在<code>WEB-INF/classes</code>您的子目录<code>build</code>目录，正是Web应用程序的结构要求它们所在的位置。由于此命令在开发过程中经常执行，因此通常将其作为“默认”目标，这样一来， <code>ant</code>命令将执行它。
    <br><br></li>
<li><strong>全部</strong> -此目标是运行<code>clean</code>目标，然后是<code>compile</code>目标。因此，它保证您将重新编译整个应用程序，以确保您在不知不觉中引入了任何不兼容的更改。
    <br><br></li>
<li><strong>javadoc-</strong>此目标为该Web应用程序中的Java类创建Javadoc API文档。这个例子<code>build.xml</code>档案假设您想在应用程式发行版本中加入API文件，因此会在的子目录中产生文件<code>dist</code>目录。由于通常不需要在每次编译时都生成Javadocs，因此该目标通常是<code>dist</code>目标，但不是目标<code>compile</code>目标。
    <br><br></li>
<li><strong>dist-</strong>此目标为您的应用程序创建分发目录，包括所有必需的文档，Java类的Javadocs以及Web应用程序存档（WAR）文件，这些文件将交付给希望安装您的应用程序的系统管理员。因为这个目标还取决于<code>deploy</code>目标，Web应用程序归档文件还将获取部署时包含的所有外部依赖项。</li>
</ul>

<p>为了使用Tomcat交互式开发和测试Web应用程序，定义了以下附加目标：</p>
<ul>
<li><strong>安装</strong> -告诉当前正在运行的Tomcat使正在开发的应用程序立即可用于执行和测试。此操作不需要重新启动Tomcat，但是在下次重新启动Tomcat之后也不会记住该操作。
    <br><br></li>
<li><strong>重新加载</strong> -安装应用程序后，您可以继续进行更改并使用重新编译<code>compile</code>目标。Tomcat将自动识别对JSP页面所做的更改，而不是对Servlet或JavaBean类所做的更改-此命令将告诉Tomcat重新启动当前安装的应用程序，以便识别此类更改。
    <br><br></li>
<li><strong>remove-</strong>完成开发和测试活动后，可以选择告诉Tomcat从服务中删除该应用程序。
    </li>
</ul>

<p>使用开发和测试目标需要一些额外的一次性设置，这将在下一页中进行介绍。</p>

</div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="../comments.html">这里</a>解释<a href="../comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>