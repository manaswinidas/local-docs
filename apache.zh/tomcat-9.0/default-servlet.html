<html lang="zh-Hans" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="./images/docs-stylesheet.css" rel="stylesheet" type="text/css"><title>Apache Tomcat 9（9.0.21）-默认Servlet参考</title><meta name="author" content="Tim Funk"><script type="application/javascript" data-comments-identifier="tomcat-9.0-doc/default-servlet">
    "use strict"; // Enable strict mode

    (function() {
      var thisScript = document.currentScript;
      if (!thisScript) { // Workaround for IE <= 11
        var scripts = document.getElementsByTagName("script");
        thisScript = scripts[scripts.length - 1];
      }
      document.addEventListener("DOMContentLoaded", (function() {
        var commentsDiv = document.getElementById("comments_thread");
        var commentsShortname = "tomcat";
        var commentsIdentifier = "https://tomcat.apache.org/" +
          thisScript.getAttribute("data-comments-identifier") + ".html";

        (function(w, d) {
          if (w.location.hostname.toLowerCase() == "tomcat.apache.org") {
            var s = d.createElement("script");
            s.type = "application/javascript";
            s.async = true;
            s.src = "https://comments.apache.org/show_comments.lua?site=" +
              encodeURIComponent(commentsShortname) +
              "&page=" + encodeURIComponent(commentsIdentifier);
            d.head.appendChild(s);
          } else {
            commentsDiv.appendChild(d.createTextNode("Comments are disabled for this page at the moment."));
          }
        })(window, document);
      }), false);
    })();
  </script></head><body ><div id="wrapper"><header><div id="header"><div><div><div class="logo noPrint"><a href="https://tomcat.apache.org/"><img alt="Tomcat主页" src="./images/tomcat.png"></a></div><div style="height:1px"></div><div class="asfLogo noPrint"><a href="https://www.apache.org/" target="_blank"><img src="./images/asf-logo.svg" alt="Apache软件基金会" style="width:266px;height:83px"></a></div><h1>Apache Tomcat 9</h1><div class="versionInfo">版本9.0.21， <time datetime="2019-06-04"> 2019年6月4日</time></div><div style="height:1px"></div><div style="clear:left"></div></div></div></div></header><div id="middle"><div><div id="mainLeft" class="noprint"><div><nav><div><h2>链接</h2><ul><li><a href="index.html">文件首页</a></li><li><a href="https://wiki.apache.org/tomcat/FAQ">常问问题</a></li><li><a href="#comments_section">用户评论</a></li></ul></div><div><h2>用户指南</h2><ul><li><a href="introduction.html">1）简介</a></li><li><a href="setup.html">2）设定</a></li><li><a href="appdev/index.html">3）第一个webapp</a></li><li><a href="deployer-howto.html">4）部署者</a></li><li><a href="manager-howto.html">5）经理</a></li><li><a href="host-manager-howto.html">6）主机管理员</a></li><li><a href="realm-howto.html">7）领域和AAA</a></li><li><a href="security-manager-howto.html">8）安全经理</a></li><li><a href="jndi-resources-howto.html">9）JNDI资源</a></li><li><a href="jndi-datasource-examples-howto.html">10）JDBC数据源</a></li><li><a href="class-loader-howto.html">11）类加载</a></li><li><a href="jasper-howto.html">12）JSP</a></li><li><a href="ssl-howto.html">13）SSL / TLS</a></li><li><a href="ssi-howto.html">14）SSI</a></li><li><a href="cgi-howto.html">15）CGI</a></li><li><a href="proxy-howto.html">16）代理支持</a></li><li><a href="mbeans-descriptors-howto.html">17）MBean描述符</a></li><li><a href="default-servlet.html">18）默认Servlet</a></li><li><a href="cluster-howto.html">19）聚类</a></li><li><a href="balancer-howto.html">20）负载均衡器</a></li><li><a href="connectors.html">21）连接器</a></li><li><a href="monitoring.html">22）监控与管理</a></li><li><a href="logging.html">23）记录</a></li><li><a href="apr.html">24）APR /本地</a></li><li><a href="virtual-hosting-howto.html">25）虚拟主机</a></li><li><a href="aio.html">26）高级IO</a></li><li><a href="extras.html">27）附加组件</a></li><li><a href="maven-jars.html">28）行刑</a></li><li><a href="security-howto.html">29）安全注意事项</a></li><li><a href="windows-service-howto.html">30）Windows服务</a></li><li><a href="windows-auth-howto.html">31）Windows身份验证</a></li><li><a href="jdbc-pool.html">32）Tomcat的JDBC池</a></li><li><a href="web-socket-howto.html">33）WebSocket</a></li><li><a href="rewrite.html">34）改写</a></li></ul></div><div><h2>参考</h2><ul><li><a href="RELEASE-NOTES.txt">发行说明</a></li><li><a href="config/index.html">组态</a></li><li><a href="api/index.html">Tomcat Java文档</a></li><li><a href="servletapi/index.html">Servlet Java文档</a></li><li><a href="jspapi/index.html">JSP 2.3 Java文档</a></li><li><a href="elapi/index.html">EL 3.0 Java文档</a></li><li><a href="websocketapi/index.html">WebSocket 1.1 Java文档</a></li><li><a href="https://tomcat.apache.org/connectors-doc/">JK 1.2文档</a></li></ul></div><div><h2>Apache Tomcat开发</h2><ul><li><a href="building.html">建造</a></li><li><a href="changelog.html">变更日志</a></li><li><a href="https://wiki.apache.org/tomcat/TomcatVersions">状态</a></li><li><a href="developers.html">开发者</a></li><li><a href="architecture/index.html">建筑</a></li><li><a href="funcspecs/index.html">功能规格。</a></li><li><a href="tribes/introduction.html">部族</a></li></ul></div></nav></div></div><div id="mainRight"><div id="content"><h2>默认Servlet参考</h2><h3 id="Table_of_Contents">目录</h3><div class="text">
<ul><li><a href="#what">什么是DefaultServlet</a></li><li><a href="#where">声明在哪里？</a></li><li><a href="#change">我可以改变什么？</a></li><li><a href="#dir">如何自定义目录列表？</a></li><li><a href="#secure">如何保护目录列表？</a></li></ul>
</div><h3 id="what">什么是DefaultServlet</h3><div class="text">
<p>缺省的Servlet是既提供静态资源又提供目录列表的Servlet（如果启用了目录列表）。
</p>
</div><h3 id="where">声明在哪里？</h3><div class="text">
<p>它在<i>$ CATALINA_BASE / conf / web.xml中</i>全局声明。默认情况下，它是声明：</p>
<div class="codeBox"><pre><code>    <servlet>
        <servlet-name>default</servlet-name>
        <servlet-class>
          org.apache.catalina.servlets.DefaultServlet
        </servlet-class>
        <init-param>
            <param-name>debug</param-name>
            <param-value>0</param-value>
        </init-param>
        <init-param>
            <param-name>listings</param-name>
            <param-value>false</param-value>
        </init-param>
        <load-on-startup>1</load-on-startup>
    </servlet>

...

    <servlet-mapping>
        <servlet-name>default</servlet-name>
        <url-pattern>/</url-pattern>
    </servlet-mapping></code></pre></div>

<p>因此，默认情况下，默认servlet在webapp启动时加载，并且目录列表被禁用，调试被关闭。</p>

<p>如果您需要更改应用程序的DefaultServlet设置，则可以通过在以下位置重新定义DefaultServlet来覆盖默认配置： <code>/WEB-INF/web.xml</code> 。但是，如果您尝试将应用程序部署到另一个容器上，这将导致问题，因为将无法识别DefaultServlet类。您可以通过使用特定于Tomcat的方法来解决此问题<code>/WEB-INF/tomcat-web.xml</code>部署描述符。格式与<code>/WEB-INF/web.xml</code> 。它将覆盖所有默认设置，但不会覆盖其中的那些默认设置<code>/WEB-INF/web.xml</code> 。由于它是特定于Tomcat的，因此只有在将应用程序部署在Tomcat上时才进行处理。</p>
</div><h3 id="change">我可以改变什么？</h3><div class="text">
<p>DefaultServlet允许以下initParamters：</p>

<table class="defaultTable"><tbody><tr><th style="width:15%">属性</th><th style="width:85%">描述</th></tr><tr><td><code class="propertyName">debug</code></td><td>调试级别。除非您是tomcat开发人员，否则它不是很有用。在撰写本文时，有用的值为0、1、11、1000。[0]</td></tr><tr><td><code class="propertyName">listings</code></td><td>如果没有欢迎文件，可以显示目录列表吗？值可以是<b>true</b>或<b>false</b> [false]<br>欢迎文件是servlet API的一部分。
        <br>
        <b>警告：</b>包含许多条目的目录清单很昂贵。大型目录列表的多个请求会消耗大量服务器资源。
  </td></tr><tr><td><code class="propertyName">precompressed</code></td><td>如果存在文件的预压缩版本（带有<code>.br</code>要么<code>.gz</code>如果用户代理支持匹配的内容编码（br或gzip）并且启用了此选项，则Tomcat将提供预压缩的文件（附加在原始文件旁边的文件名后面）。 [假]<br>带有的预压缩文件<code>.br</code>要么<code>.gz</code>如果直接请求扩展名，则可以访问该扩展名，因此，如果原始资源受到安全约束的保护，则预压缩版本也必须受到类似的保护。
        <br>也可以配置预压缩格式的列表。语法是逗号分隔的列表<code>[content-encoding]=[file-extension]</code>对。例如： <code>br=.br,gzip=.gz,bzip2=.bz2</code> 。如果指定了多种格式，则客户端支持多个格式，并且客户端不表达首选项，格式列表的顺序将被视为服务器首选项顺序，并用于选择返回的格式。
  </td></tr><tr><td><code class="propertyName">readmeFile</code></td><td>如果显示目录列表，则自述文件也可能与列表一起显示。该文件将按原样插入，因此可能包含HTML。</td></tr><tr><td><code class="propertyName">globalXsltFile</code></td><td>如果您希望自定义目录列表，则可以使用XSL转换。该值是一个相对文件名（到$ CATALINA_BASE / conf /或$ CATALINA_HOME / conf /），将用于所有目录列表。可以按上下文和/或每个目录覆盖。请参阅下面的<strong>contextXsltFile</strong>和<strong>localXsltFile</strong> 。xml的格式如下所示。
  </td></tr><tr><td><code class="propertyName">contextXsltFile</code></td><td>您还可以通过配置上下文来自定义目录列表<code>contextXsltFile</code> 。这必须是上下文相关路径（例如： <code>/path/to/context.xslt</code> ）到带有<code>.xsl</code>要么<code>.xslt</code>延期。此优先<code>globalXsltFile</code> 。如果存在此值但文件不存在，则<code>globalXsltFile</code>将会被使用。如果<code>globalXsltFile</code>不存在，则将显示默认目录列表。
  </td></tr><tr><td><code class="propertyName">localXsltFile</code></td><td>您还可以通过配置来按目录自定义目录列表<code>localXsltFile</code> 。该目录必须是列表所在目录中的文件，并带有<code>.xsl</code>要么<code>.xslt</code>延期。此优先<code>globalXsltFile</code>和<code>contextXsltFile</code> 。如果存在此值但文件不存在，则<code>contextXsltFile</code>将会被使用。如果<code>contextXsltFile</code>不存在，那么<code>globalXsltFile</code>将会被使用。如果<code>globalXsltFile</code>不存在，则将显示默认目录列表。
  </td></tr><tr><td><code class="propertyName">input</code></td><td>读取要提供的资源时的输入缓冲区大小（以字节为单位）。[2048]</td></tr><tr><td><code class="propertyName">output</code></td><td>写入要服务的资源时的输出缓冲区大小（以字节为单位）。[2048]</td></tr><tr><td><code class="propertyName">readonly</code></td><td>此上下文是“只读”的，因此拒绝了HTTP命令（例如PUT和DELETE）？[真正]</td></tr><tr><td><code class="propertyName">fileEncoding</code></td><td>读取静态资源时要使用的文件编码。[平台默认]</td></tr><tr><td><code class="propertyName">useBomIfPresent</code></td><td>如果静态文件包含字节顺序标记（BOM），则应优先于fileEncoding使用它来确定文件编码。 [真正]</td></tr><tr><td><code class="propertyName">sendfileSize</code></td><td>如果使用的连接器支持sendfile，则这表示将使用sendfile的最小文件大小（以KB为单位）。使用负值可始终禁用发送文件。[48]</td></tr><tr><td><code class="propertyName">useAcceptRanges</code></td><td>如果为true，则在适合响应时将设置Accept-Ranges标头。 [真正]</td></tr><tr><td><code class="propertyName">showServerInfo</code></td><td>启用目录列表后，应在发送给客户端的响应中显示服务器信息。 [真正]</td></tr><tr><td><code class="propertyName">sortListings</code></td><td>服务器应将目录中的列表排序。 [假]</td></tr><tr><td><code class="propertyName">sortDirectoriesFirst</code></td><td>服务器应在所有文件之前列出所有目录。 [假]</td></tr></tbody></table>
</div><h3 id="dir">如何自定义目录列表？</h3><div class="text">
<p>您可以使用自己的实现覆盖DefaultServlet，并在web.xml声明中使用它。如果您能理解所讲的内容，我们将假定您可以阅读DefaultServlet servlet的代码并进行适当的调整。（如果没有，那么该方法不适合您）</p>
<p>您可以使用<code>localXsltFile</code>要么<code>globalXsltFile</code>并且DefaultServlet将创建一个xml文档，并根据xml中提供的值通过xsl转换运行它<code>localXsltFile</code>和<code>globalXsltFile</code> 。 <code>localXsltFile</code>首先检查，然后<code>globalXsltFile</code> ，则发生默认行为。
</p>

<p>格式：</p>
<div class="codeBox"><pre><code>    <listing>
     <entries>
      <entry type='file|dir' urlPath='aPath' size='###' date='gmt date'>
        fileName1
      </entry>
      <entry type='file|dir' urlPath='aPath' size='###' date='gmt date'>
        fileName2
      </entry>
      ...
     </entries>
     <readme></readme>
    </listing></code></pre></div>
<ul>
  <li>如果缺少大小<code>type='dir'</code></li>
  <li>自述文件是CDATA条目</li>
</ul>

<p>以下是模拟默认tomcat行为的示例xsl文件：</p>
<div class="codeBox"><pre><code><?xml version="1.0" encoding="UTF-8"?>

<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  version="3.0">

  <xsl:output method="html" html-version="5.0"
    encoding="UTF-8" indent="no"
    doctype-system="about:legacy-compat"/>

  <xsl:template match="listing">
   <html>
    <head>
      <title>
        Sample Directory Listing For
        <xsl:value-of select="@directory"/>
      </title>
      <style>
        h1 {color : white;background-color : #0086b2;}
        h3 {color : white;background-color : #0086b2;}
        body {font-family : sans-serif,Arial,Tahoma;
             color : black;background-color : white;}
        b {color : white;background-color : #0086b2;}
        a {color : black;} HR{color : #0086b2;}
        table td { padding: 5px; }
      </style>
    </head>
    <body>
      <h1>Sample Directory Listing For
            <xsl:value-of select="@directory"/>
      </h1>
      <hr style="height: 1px;" />
      <table style="width: 100%;">
        <tr>
          <th style="text-align: left;">Filename</th>
          <th style="text-align: center;">Size</th>
          <th style="text-align: right;">Last Modified</th>
        </tr>
        <xsl:apply-templates select="entries"/>
        </table>
      <xsl:apply-templates select="readme"/>
      <hr style="height: 1px;" />
      <h3>Apache Tomcat/<version-major-minor/></h3>
    </body>
   </html>
  </xsl:template>


  <xsl:template match="entries">
    <xsl:apply-templates select="entry"/>
  </xsl:template>

  <xsl:template match="readme">
    <hr style="height: 1px;" />
    <pre><xsl:apply-templates/></pre>
  </xsl:template>

  <xsl:template match="entry">
    <tr>
      <td style="text-align: left;">
        <xsl:variable name="urlPath" select="@urlPath"/>
        <a href="{$urlPath}">
          <pre><xsl:apply-templates/></pre>
        </a>
      </td>
      <td style="text-align: right;">
        <pre><xsl:value-of select="@size"/></pre>
      </td>
      <td style="text-align: right;">
        <pre><xsl:value-of select="@date"/></pre>
      </td>
    </tr>
  </xsl:template>

</xsl:stylesheet></code></pre></div>

</div><h3 id="secure">如何保护目录列表？</h3><div class="text">在每个单独的Web应用程序中使用web.xml。请参阅Servlet规范的安全性部分。

</div><div class="noprint"><h3 id="comments_section">评论</h3><div class="text"><p class="notice"><strong>注意：</strong>此注释部分收集有关改进Apache Tomcat文档的建议。<br><br>如果您遇到问题并需要帮助，请阅读“ <a href="https://tomcat.apache.org/findhelp.html">查找帮助”</a>页面，然后在tomcat-users <a href="https://tomcat.apache.org/lists.html">邮件列表中</a>询问您的问题。不要在这里问这样的问题。这不是“问答”部分。<br><br><a href="./comments.html">这里</a>解释<a href="./comments.html">了</a> Apache Comments System。如果评论已被实施或被认为无效/偏离主题，则我们的主持人可能会将其删除。
                  </p><div id="comments_thread"></div></div></div></div></div></div></div><footer><div id="footer">版权所有©1999-2019，Apache软件基金会</div></footer></div></body></html>