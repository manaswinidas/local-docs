<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - JAX-RS Filters">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script src='/resources/highlighter/scripts/shBrushXml.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-JAX-RS过滤器</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="restful-services.html">RESTful服务</a> > <a href="jax-rs.html">JAX-RS</a> > <a href="jax-rs-filters.html">JAX-RS过滤器</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><form id="cse-search-box" enctype="application/x-www-form-urlencoded" method="get" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="搜索">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><p><span style="font-size:2em;font-weight:bold">JAX-RS过滤器</span>


 </p><p> </p><p><style type="text/css">/*<![CDATA[*/
div.rbtoc1552406172613 {padding: 0px;}
div.rbtoc1552406172613 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1552406172613 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style></p><div class="toc-macro rbtoc1552406172613">
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSFilters-Filters">筛选器</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSFilters-DifferencebetweenJAXRSfiltersandCXFinterceptors">JAXRS过滤器和CXF拦截器之间的区别</a></li></ul>
</li><li><a shape="rect" href="#JAX-RSFilters-Overridingrequestandresponseproperties">覆盖请求和响应属性</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSFilters-OverridingHTTPmethod">覆盖HTTP方法</a></li><li><a shape="rect" href="#JAX-RSFilters-OverridingrequestURI,queryandheaders">覆盖请求URI，查询和标头</a></li><li><a shape="rect" href="#JAX-RSFilters-Overridingresponsestatuscodeandheaders">覆盖响应状态代码和标头</a></li></ul>
</li><li><a shape="rect" href="#JAX-RSFilters-IgnoringJAXRSMessageBodyWriters">忽略JAXRS MessageBodyWriters</a></li><li><a shape="rect" href="#JAX-RSFilters-Custominvokers">自定义调用者</a></li></ul>
</div><h1 id="JAX-RSFilters-Filters">筛选器</h1><p>通常，有必要根据许多要求对某些请求进行预处理或后处理。<br clear="none">例如，类似</p><p>GET /资源？_type = xml由特定于CXF的RequestPreprocessor代码支持，该代码修改输入消息<br clear="none">通过更新其标题之一。</p><p>更新请求或响应属性的标准机制是使用JAX-RS 2.0 ContainerRequestFilter或ContainerResponseFilter。</p><p>在JAX-RS资源选择过程开始之前，将运行带有@PreMatching批注的ContainerRequestFilters。匹配前过滤器应用于修改请求URI或标头或输入流。匹配后过滤器仅在执行所选资源方法之前运行。</p><p>可以使用@Priority批注来订购多个ContainerRequestFilter和ContainerResponseFilter过滤器。</p><p> </p><p>可以像其他任何类型的提供程序一样注册实现：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;beans&gt;
    &lt;jaxrs:server id="customerService" address="/"&gt;
        &lt;jaxrs:serviceBeans&gt;
            &lt;bean class="org.CustomerService" /&gt;
        &lt;/jaxrs:serviceBeans&gt;

        &lt;jaxrs:providers&gt;
            &lt;ref bean="authorizationFilter" /&gt;
        &lt;/jaxrs:providers&gt;
        &lt;bean id="authorizationFilter" class="com.bar.providers.AuthorizationContainerRequestFilter"&gt;
            &lt;!-- authorization bean properties --&gt;
        &lt;/bean&gt;
    &lt;/jaxrs:server&gt;
&lt;/beans&gt;
</pre>
</div></div><h2 id="JAX-RSFilters-DifferencebetweenJAXRSfiltersandCXFinterceptors">JAXRS过滤器和CXF拦截器之间的区别</h2><p>JAXRS运行时流程主要由一对“经典” CXF拦截器实现。JAXRSInInterceptor当前处于阶段。UNMARSHAL（处于阶段。CAXF 2.2.2）阶段之前的PRE_STREAM，而JAXRSOutInterceptor当前处于阶段。MARSHAL阶段。</p><p>可以将JAXRS过滤器视为其他处理程序。在调用之前，JAXRSInInterceptor处理一系列的Pre Match和Post Match ContainerRequestFilters。JAXRSOutInterceptor在调用之后但消息正文编写者获得机会之前处理一系列ContainerResponseFilters。</p><p>有时您可能想使用CXF拦截器，而不是编写JAXRS过滤器。例如，假设您结合使用JAXWS和JAXRS，并且只需要记录入站或出站消息。您可以重用现有的CXF拦截器：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;beans&gt;
    &lt;bean id="logInbound" class="org.apache.cxf.interceptor.LoggingInInterceptor"/&gt;
    &lt;bean id="logOutbound" class="org.apache.cxf.interceptor.LoggingOutInterceptor"/&gt;

    &lt;jaxrs:server&gt; 
        &lt;jaxrs:inInterceptors&gt;
            &lt;ref bean="logInbound"/&gt;
        &lt;/jaxrs:inInterceptors&gt;
        &lt;jaxrs:outInterceptors&gt;
            &lt;ref bean="logOutbound"/&gt;
        &lt;/jaxrs:outInterceptors&gt;
    &lt;/jaxrs:server&gt;

    &lt;jaxws:endpoint&gt;
        &lt;jaxws:inInterceptors&gt;
            &lt;ref bean="logInbound"/&gt;
        &lt;/jaxws:inInterceptors&gt;
        &lt;jaxws:outInterceptors&gt;
            &lt;ref bean="logOutbound"/&gt;
        &lt;/jaxws:outInterceptors&gt;
    &lt;/jaxws:endpoint&gt;

&lt;/beans&gt;
</pre>
</div></div><p>重用其他CXF拦截器/功能（例如GZIP处理程序）也可能很有用。</p><h1 id="JAX-RSFilters-Overridingrequestandresponseproperties">覆盖请求和响应属性</h1><p>有时需要覆盖各种请求和响应属性，例如HTTP方法或请求URI，<br clear="none">响应标头或状态代码，甚至是请求或响应正文。JAX-RS响应可以用于指定自定义状态和响应头，但是将其添加到方法签名中可能会带来干扰。</p><p>使用过滤器和拦截器可以覆盖所有需要的请求/响应属性。</p><h2 id="JAX-RSFilters-OverridingHTTPmethod">覆盖HTTP方法</h2><p>使用@PreMatching ContainerRequestFilter或在自感知过滤器中注册自定义CXF，它将替换由键入的当前方法值<br clear="none">信息。给定消息中的HTTP_REQUEST_METHOD。</p><h2 id="JAX-RSFilters-OverridingrequestURI,queryandheaders">覆盖请求URI，查询和标头</h2><p>可以通过@PreMatching ContainerRequestFilter或CXF输入拦截器（在早期阶段注册，例如USER_STREAM）来做到这一点，例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">String s = m.get(Message.REQUEST_URI);
s += "/data/";
m.put(Message.REQUEST_URI, s);
</pre>
</div></div><p>如果更新后的请求URI具有新的查询字符串，那么您还需要更新消息。QUERY_STRING属性。</p><p>同样，可以通过修改消息来更新请求HTTP标头。REQUEST_HEADERS消息对象，它是一个包含字符串和字符串列表条目的映射。</p><h2 id="JAX-RSFilters-Overridingresponsestatuscodeandheaders">覆盖响应状态代码和标头</h2><p>这里假定用户不希望在应用程序代码中不使用显式Response对象。<br clear="none">这可以通过ContainerResponseFilter或CXF输出拦截器（类似于MARSHALL的阶段）来完成，例如，此代码将同时适用于JAXRS和JAXWS：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">import java.util.Map;
import java.util.TreeMap;

import org.apache.cxf.message.Message;
import org.apache.cxf.phase.AbstractPhaseInterceptor;
import org.apache.cxf.phase.Phase;


public class CustomOutInterceptor extends AbstractOutDatabindingInterceptor {
    
    public CustomOutInterceptor() {
        super(Phase.MARSHAL);
    }

    public void handleMessage(Message outMessage) {
        Map&lt;String, List&lt;String&gt;&gt; headers = (Map&lt;String, List&lt;String&gt;&gt;)outMessage.get(Message.PROTOCOL_HEADERS);
        if (headers == null) {
            headers = new TreeMap&lt;String, List&lt;String&gt;&gt;(String.CASE_INSENSITIVE_ORDER);
            message.put(Message.PROTOCOL_HEADERS, headers);
        }
        // modify headers  
    }    
</pre>
</div></div><p>目前，无法覆盖在JAXRSOutInterceptor之前运行的CXF拦截器的响应状态代码，例如上面的CustomOutInterceptor，它将得到修复。<br clear="none">目前唯一的选择是使用自定义ResponseHandler，它将用另一个包含所需状态的对象替换当前的Response对象。</p><h1 id="JAX-RSFilters-IgnoringJAXRSMessageBodyWriters">忽略JAXRS MessageBodyWriters</h1><p>在某些情况下，您可能希望拥有一个JAXRS Response实体，该实体已将给定的过滤器生成为直接写入输出流。例如，CXF JAXRS WADLGenerator过滤器生成的XML内容不必由JAXRS MessageBodyWriters序列化。如果确实需要忽略编写者，则在自定义处理程序的当前交换中设置以下属性：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">message.getExchange().put("ignore.message.writers", true);
</pre>
</div></div><h1 id="JAX-RSFilters-Custominvokers">自定义调用者</h1><p><strong>注意</strong>此功能从CXF 2.2.2开始可用</p><p>使用自定义JAXR-RS调用程序是预处理或后处理给定调用的另一种方法。例如，此<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/CustomJAXRSInvoker.java">调用程序</a>在委派给默认JAXRS调用程序之前进行安全检查。定制的调用程序（如请求过滤器）可以访问在处理给定调用期间累积的所有信息，但是此外，它还可以检查实际的方法参数值。</p><p>自定义调用程序可以这样注册：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;beans&gt;

    &lt;jaxrs:server address="/"&gt; 
        &lt;jaxrs:invoker&gt;
            &lt;bean class="org.apache.cxf.systest.jaxrs.CustomJAXRSInvoker"/&gt;
        &lt;/jaxrs:invoker&gt;
    &lt;/jaxrs:server&gt;

&lt;/beans&gt;
</pre>
</div></div></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=24190937">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=24190937&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>