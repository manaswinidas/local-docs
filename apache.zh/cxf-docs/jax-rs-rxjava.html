<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - JAX-RS RxJava">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-JAX-RS RxJava</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="restful-services.html">RESTful服务</a> > <a href="jax-rs.html">JAX-RS</a> > <a href="jax-rs-rxjava.html">JAX-RS RxJava</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><form id="cse-search-box" enctype="application/x-www-form-urlencoded" method="get" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="搜索">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><p><style type="text/css">/*<![CDATA[*/
div.rbtoc1524513393998 {padding: 0px;}
div.rbtoc1524513393998 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1524513393998 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style></p><div class="toc-macro rbtoc1524513393998">
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSRxJava-RxJava2FlowableandObservablesupport">RxJava2 Flowable和Observable支持</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSRxJava-Introduction">介绍</a></li><li><a shape="rect" href="#JAX-RSRxJava-Client">客户</a></li><li><a shape="rect" href="#JAX-RSRxJava-Server">服务器</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSRxJava-Asamethodreturnvalue">作为方法的返回值</a></li><li><a shape="rect" href="#JAX-RSRxJava-CombiningFlowablewithAsyncResponse">将Flowable与AsyncResponse结合</a></li></ul>
</li></ul>
</li><li><a shape="rect" href="#JAX-RSRxJava-RxJava1rx.Observablesupport">RxJava1 rx。可观察的支持</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSRxJava-Introduction.1">介绍</a></li><li><a shape="rect" href="#JAX-RSRxJava-Client.1">客户</a></li><li><a shape="rect" href="#JAX-RSRxJava-Server.1">服务器</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSRxJava-Asamethodreturnvalue.1">作为方法的返回值</a></li></ul>
</li></ul>
</li></ul>
</div><h1 id="JAX-RSRxJava-RxJava2FlowableandObservablesupport">RxJava2 Flowable和Observable支持</h1><h2 id="JAX-RSRxJava-Introduction">介绍</h2><p>从CXF 3.2.0开始，客户端和服务器端都支持RxJava 2 Flowable和Observable。从CXF 3.2.3开始，RxJava和RxJava2支持分为不同的模块，下面的Maven坐标表示CXF 3.2.3的状态。</p><p>需要org.apache.cxf / cxf-rt-rs-extension-rx2 / 3.2.3和io.reactivex.rxjava2 / rxjava / 2.1.3依赖项。</p><h2 id="JAX-RSRxJava-Client">客户</h2><p>下面的简单示例使用ObservableRxInvoker。 org.apache.cxf.jaxrs.rx2.client。如果需要，可以使用FlowableRxInvoker。回顾我们的系统<a shape="rect" class="external-link" href="https://github.com/apache/cxf/tree/master/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/reactive" rel="nofollow">测试的反应性</a>也可能有所帮助。</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">@Test
public void testGetHelloWorldJson() throws Exception {
    String address = "http://localhost:" + PORT + "/rx2/observable/textJson";
    List&lt;Object&gt; providers = new LinkedList&lt;&gt;();
    providers.add(new JacksonJsonProvider());
    providers.add(new ObservableRxInvokerProvider());
    WebClient wc = WebClient.create(address, providers);
    Observable&lt;HelloWorldBean&gt; obs = wc.accept("application/json")
        .rx(ObservableRxInvoker.class)
        .get(HelloWorldBean.class);
    
    Holder&lt;HelloWorldBean&gt; holder = new Holder&lt;HelloWorldBean&gt;();
    obs.subscribe(v -&gt; {
        holder.value = v;
    });
    Thread.sleep(2000);
    assertEquals("Hello", holder.value.getGreeting());
    assertEquals("World", holder.value.getAudience());
}</pre>
</div></div><h2 id="JAX-RSRxJava-Server">服务器</h2><h3 id="JAX-RSRxJava-Asamethodreturnvalue">作为方法的返回值</h3><p>一个简单地返回io.reactivex。该方法和运行时的Flowable将确保Flowable流完成后最终确定响应。</p><p>唯一的要求是必须注册一个自定义JAX-RS调用程序org.apache.cxf.jaxrs.rx2.server。FlowableInvoker。它执行所有默认的JAXRSInvoker所做的所有工作，并且仅检查是否返回了Flowable-如果是，则将其内部与JAX-RS AsyncResponse链接。</p><p>如果需要，请使用io.reactivex。可以改为返回Observable（使用org.apache.cxf.jaxrs.rx2.server。已注册ObservableInvoker）</p><h3 id="JAX-RSRxJava-CombiningFlowablewithAsyncResponse">将Flowable与AsyncResponse结合</h3><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">JAXRSServerFactoryBean sf = new JAXRSServerFactoryBean();
sf.setProvider(new JacksonJsonProvider());
new ReactiveIOCustomizer().customize(sf); // use a JAXRSServerFactoryCustomizationExtension to customize the server
sf.setResourceClasses(RxJava2FlowableService.class);
sf.setResourceProvider(RxJava2FlowableService.class,
                       new SingletonResourceProvider(new RxJava2FlowableService(), true));
sf.setAddress("http://localhost:" + PORT + "/");
server = sf.create();</pre>
</div></div><p> </p><p> </p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">import org.apache.cxf.jaxrs.rx2.server.JsonStreamingAsyncSubscriber;
import io.reactive.Flowable;
import io.reactivex.schedulers.Schedulers;

   &#160;// return a JSON array, write to the output stream as soon as the next JSON object becomes available
    @GET
    @Produces("application/json")
    @Path("textJsonImplicitListAsyncStream")
    public void getJsonImplicitListStreamingAsync(@Suspended AsyncResponse ar) {
        Flowable.just("Hello", "Ciao")
            .map(s -&gt; new HelloWorldBean(s))
            .subscribeOn(Schedulers.computation())
            .subscribe(new JsonStreamingAsyncSubscriber&lt;HelloWorldBean&gt;(ar));
    }</pre>
</div></div><p> </p><h1 id="JAX-RSRxJava-RxJava1rx.Observablesupport">RxJava1 rx。可观察的支持</h1><h2 id="JAX-RSRxJava-Introduction.1">介绍</h2><p>RxJava 1接收。从CXF 3.2.0开始，客户端和服务器端都支持Observable。</p><p>需要org.apache.cxf / cxf-rt-rs-extension-rx / 3.2.3和io.reactivex / rxjava / 1.3.0依赖项。</p><h2 id="JAX-RSRxJava-Client.1">客户</h2><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">import org.apache.cxf.jaxrs.rx.client.ObservableRxInvoker;
import org.apache.cxf.jaxrs.rx.client.ObservableRxInvokerProvider;
import rx.Observable;
&#160;
    @Test
    public void testObservableWithWebClient() throws Exception {
        String address = "http://localhost:" + PORT + "/observable/textAsync";
        WebClient wc = WebClient.create(address,
                                        Collections.singletonList(new ObservableRxInvokerProvider()));
        Observable&lt;String&gt; obs = wc.accept("text/plain")
            .rx(ObservableRxInvoker.class)
            .get(String.class);
        obs.map(s -&gt; {
            return s + s;
        });

        Thread.sleep(3000);

        obs.subscribe(s -&gt; assertDuplicateResponse(s));
    }
    @Test
    public void testObservableJaxrs21With404Response() throws Exception {
        String address = "http://localhost:" + PORT + "/observable/textAsync404";
        Invocation.Builder b = ClientBuilder.newClient().register(new ObservableRxInvokerProvider())
            .target(address).request();
        b.rx(ObservableRxInvoker.class).get(String.class).subscribe(
            s -&gt; {
                fail("Exception expected");
            },
            t -&gt; validateT((ExecutionException)t));
    }

    private void validateT(ExecutionException t) {
        assertTrue(t.getCause() instanceof NotFoundException);
    }
    private void assertDuplicateResponse(String s) {
        assertEquals("Hello, world!Hello, world!", s);
    }</pre>
</div></div><p> </p><h2 id="JAX-RSRxJava-Server.1">服务器</h2><h3 id="JAX-RSRxJava-Asamethodreturnvalue.1">作为方法的返回值</h3><p>只需从该方法返回一个Observable即可，并且一旦Observable流完成，运行时将确保最终确定响应。</p><p>唯一的要求是必须注册一个自定义JAX-RS调用程序org.apache.cxf.jaxrs.rx.server。ObservableInvoker。它执行所有默认的JAXRSInvoker所做的所有工作，并且仅检查是否返回了Observable-如果是，则将其内部与JAX-RS AsyncResponse链接。</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">JAXRSServerFactoryBean sf = new JAXRSServerFactoryBean();
sf.setProvider(new JacksonJsonProvider());
new ObservableCustomizer().customize(sf); // use a JAXRSServerFactoryCustomizationExtension to customize the server
sf.setResourceClasses(RxJavaObservableService.class);
sf.setResourceProvider(RxJavaObservableService.class,
                       new SingletonResourceProvider(new RxJavaObservableService(), true));
sf.setAddress("http://localhost:" + PORT + "/");
server = sf.create();</pre>
</div></div></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=73634837">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=73634837&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>