<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - JAX-RS Token Authorization">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script src='/resources/highlighter/scripts/shBrushXml.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-JAX-RS令牌授权</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="restful-services.html">RESTful服务</a> > <a href="jax-rs.html">JAX-RS</a> > <a href="jax-rs-token-authorization.html">JAX-RS令牌授权</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><form id="cse-search-box" enctype="application/x-www-form-urlencoded" method="get" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="搜索">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><p> <span style="font-size:2em;font-weight:bold">JAX-RS：令牌授权</span>


<br clear="none"></p><p><style type="text/css">/*<![CDATA[*/
div.rbtoc1537289834919 {padding: 0px;}
div.rbtoc1537289834919 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1537289834919 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style></p><div class="toc-macro rbtoc1537289834919">
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSTokenAuthorization-Introduction">介绍</a></li><li><a shape="rect" href="#JAX-RSTokenAuthorization-Backwardscompatibilityconfigurationnote">向后兼容性配置说明</a></li><li><a shape="rect" href="#JAX-RSTokenAuthorization-Mavendependencies">Maven依赖</a></li><li><a shape="rect" href="#JAX-RSTokenAuthorization-Claimsbasedaccesscontrol">基于声明的访问控制</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSTokenAuthorization-Claimsannotations">声明注释</a></li><li><a shape="rect" href="#JAX-RSTokenAuthorization-EnforcingClaimsauthorization">执行索赔授权</a></li></ul>
</li><li><a shape="rect" href="#JAX-RSTokenAuthorization-Rolebasedaccesscontrol">基于角色的访问控制</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSTokenAuthorization-SimpleAuthorizingInterceptor">SimpleAuthorizingInterceptor</a></li><li><a shape="rect" href="#JAX-RSTokenAuthorization-Usingannotations">使用注释</a></li></ul>
</li></ul>
</div><h1 id="JAX-RSTokenAuthorization-Introduction">介绍</h1><p>CXF JAX-RS提供了一个扩展，使用户可以基于<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/core/src/main/java/org/apache/cxf/security/claims/authorization/Claim.java" rel="nofollow">Claim</a>和<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/core/src/main/java/org/apache/cxf/security/claims/authorization/Claims.java" rel="nofollow">Claims</a>批注以及<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/core/src/main/java/org/apache/cxf/security/claims/authorization/ClaimMode.java" rel="nofollow">ClaimMode</a>枚举类来实施新的细粒度基于声明的访问控制（CBAC）。它适用于SAML令牌和JWT令牌（从3.3.0版本开始）。</p><p>另请参见<a shape="rect" href="jax-rs-xml-security.html">JAX-RS XML安全性</a> ， <a shape="rect" href="jax-rs-saml.html">JAX-RS SAML</a>和<a shape="rect" href="jax-rs-jose.html">JAX-RS JOSE</a> 。</p><h1 id="JAX-RSTokenAuthorization-Backwardscompatibilityconfigurationnote">向后兼容性配置说明</h1><p>从Apache CXF 3.1.0起，用于配置XML签名或加密的基于WS-Security的配置标签（“ ws-security- *”）已更改为仅以“ security-”开头。除此之外，它们是完全相同的。CXF 3.1.0继续接受较旧的“ ws-security-”值。要将本页中的任何配置示例与旧版本的CXF一起使用，只需在配置标签中添加“ ws-”前缀即可。</p><p>Claim，Claims和ClaimMode批注的包已从“ org.apache.cxf.rs.security.saml.authorization”更改为“ org.apache.cxf.security.claims.authorization”。从CXF 2.7.1开始，声明的默认名称格式为“ urn：oasis：names：tc：SAML：2.0：attrname-format：unspecified”，而不是“ <a shape="rect" class="external-link" href="http://schemas.xmlsoap.org/ws/2005/05/identity/claims" rel="nofollow">http://schemas.xmlsoap.org/ws/2005/ 05 / identity / claims</a> ”。</p><p>从3.3.0版本开始，Claims访问控制注释/拦截器<a shape="rect" class="external-link" href="https://issues.apache.org/jira/browse/CXF-6727">现在可以</a>与JWT令牌（以及SAML令牌）一起使用。这导致以下程序包更改：</p><ul><li>ClaimsAuthorizingInterceptor已从cxf-rt-security-saml模块移至cxf-rt-security模块。ClaimsAuthorizingInterceptor的程序包名称已更改：从org.apache.cxf.rt.security.saml.interceptor。org.apache.cxf.rt.security.claims.interceptor的ClaimsAuthorizingInterceptor。ClaimsAuthorizingInterceptor。</li><li>ClaimsAuthorizingFilter已从cxf-rt-rs-security-xml模块移至cxf-rt-frontend-jaxrs模块。ClaimsAuthorizingFilter的程序包名称已更改：从org.apache.cxf.rs.security.saml.authorization。ClaimsAuthorizingFilter到org.apache.cxf.jaxrs.security。ClaimsAuthorizingFilter</li></ul><h1 id="JAX-RSTokenAuthorization-Mavendependencies">Maven依赖</h1><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt;
  &lt;artifactId&gt;cxf-rt-security&lt;/artifactId&gt;
  &lt;version&gt;3.3.0&lt;/version&gt;
&lt;/dependency&gt;
</pre>
</div></div><p>另外，如果使用SAML令牌，则需要cxf-rt-rs-security-xml；如果使用JWT令牌，则需要cxf-rt-rs-security-jose-jaxrs。</p><h1 id="JAX-RSTokenAuthorization-Claimsbasedaccesscontrol">基于声明的访问控制</h1><h2 id="JAX-RSTokenAuthorization-Claimsannotations">声明注释</h2><p>这是一个使用Claims注释保护服务对象安全的简单代码片段：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">import org.apache.cxf.security.claims.authorization.Claim;
import org.apache.cxf.security.claims.authorization.Claims;

@Path("/bookstore")
public class SecureClaimBookStore {
    
    @POST
    @Path("/books")
    @Produces("application/xml")
    @Consumes("application/xml")
    @Claims({ 
        @Claim({"admin" }),
        @Claim(name = "http://claims/authentication-format", 
               format = "http://claims/authentication", 
               value = {"fingertip", "smartcard" })
    })
    public Book addBook(Book book) {
        return book;
    }
    
}
</pre>
</div></div><p>仅当Subject满足以下要求时，才可以调用SecureClaimBookStore.addBook（Book）：它需要具有一个值为“ admin”的Claim和另一个Claim来确认使用“ fingertip”或“ smartcard”方法对它进行了身份验证。请注意，@ Claim（{“ admin”}）没有设置名称和格式分类器-它依赖于默认名称和格式值，即“ http://schemas.xmlsoap.org/ws/2005/05/identity/claims/角色”和“ urn：oasis：names：tc：SAML：2.0：attrname-format：unspecified”（CXF 2.7.1之前的“ http://schemas.xmlsoap.org/ws/2005/05/identity/claims”）分别。这些默认值将来可能会更改，具体取决于发现最常使用的声明-但是如您所见，您始终可以提供将限定给定声明值范围的名称和格式值。</p><p>请注意，在上面的示例中，名称为“ http：// claims / authentication-format”的Claim具有两个值，“ fingertip”和“ smartcard”。默认情况下，为了满足此声明，主题需要具有“ fingertip”或“ smartcard”值的声明。如果期望主题需要具有“ fingertip”和“ smartcard”值的Claim，那么需要进行以下更改：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">import org.apache.cxf.security.claims.authorization.Claim;
import org.apache.cxf.security.claims.authorization.Claims;

@Path("/bookstore")
public class SecureClaimBookStore {
    
    @POST
    @Path("/books")
    @Produces("application/xml")
    @Consumes("application/xml")
    @Claims({ 
        @Claim({"admin" }),
        @Claim(name = "http://claims/authentication-format", 
               format = "http://claims/authentication", 
               value = {"fingertip", "smartcard" },
               matchAll = true)
    })
    public Book addBook(Book book) {
        return book;
    }
    
}
</pre>
</div></div><p>可以使用单独的@Claim批注指定声明，可以在类级别设置声明，并在方法级别覆盖声明，最后可以指定宽松的检查模式：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">import org.apache.cxf.security.claims.authorization.Claim;
import org.apache.cxf.security.claims.authorization.Claims;

@Path("/bookstore")
@Claim({"user"})
public class SecureClaimBookStore {
    
    @POST
    @Path("/books")
    @Produces("application/xml")
    @Consumes("application/xml")
    @Claims({ 
        @Claim({"admin" }),
        @Claim(name = "http://claims/authentication-format", 
               format = "http://claims/authentication", 
               value = {"fingertip", "smartcard" },
               matchAll = true)
    })
    public Book addBook(Book book) {
        return book;
    }

    @GET
    @Claim(name = "http://claims/authentication-format", 
               format = "http://claims/authentication", 
               value = {"password" },
               mode = ClaimMode.LAX)
    public Book getBook() {
        //...
    }

    @GET
    public BookList getBookList() {
        //...
    }
    
    
}
</pre>
</div></div><p>在上面的示例中，如果Subject的Claim值为“ user”，则可以调用getBookList（）。 addBook（）已覆盖它-应该是“ admin”，认证格式也为Claim；如果Subject的Claim值为“ user”，并且还必须具有身份验证格式Claim的值为“ password”，或者根本没有此类Claim，则可以调用getBook（）。</p><p>org.apache.cxf.rt.security.claims.interceptor。ClaimsAuthorizingInterceptor（“ org.apache.cxf.rt.security.saml.interceptor。CXF 3.3.0之前的ClaimsAuthorizingInterceptor”强制实施CBAC规则。可以直接使用规则覆盖和配置此过滤器，如果在代码中不需要与Claim相关的注释，该过滤器将非常有用。支持地图nameAliases和formatAliases属性，以使@Claim批注看起来更简单，例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">@Claim(name = "auth-format", format = "authentication", value = {"password" })
</pre>
</div></div><p>其中“ auth-format”和“ authentication”分别是“ http：// claims / authentication-format”和“ http：// claims / authentication”的别名。</p><h2 id="JAX-RSTokenAuthorization-EnforcingClaimsauthorization">执行索赔授权</h2><p>根据以上示例，仅添加Claims批注不足以实施基于声明的授权。</p><p>首先，我们需要配置适当的拦截器/过滤器，以验证我们希望从中提取声明的令牌的类型。有关如何配置SAML的信息，请参见<a shape="rect" href="jax-rs-saml.html">JAX-RS SAML</a>页面；有关如何配置JWT的信息，请参见<a shape="rect" href="jax-rs-jose.html">JAX-RS JOSE</a>页面。</p><p>对于SAML和JWT，一旦验证了传入令牌， <a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/security/src/main/java/org/apache/cxf/rt/security/claims/ClaimsSecurityContext.java" rel="nofollow">便将</a>创建<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/security/src/main/java/org/apache/cxf/rt/security/claims/ClaimsSecurityContext.java" rel="nofollow">ClaimsSecurityContext</a>安全上下文，其中包含令牌中包含的声明以及经过身份验证的主题和角色（声明）。</p><p>要强制执行声明授权，必须将<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/security/src/main/java/org/apache/cxf/rt/security/claims/interceptor/ClaimsAuthorizingInterceptor.java" rel="nofollow">ClaimsAuthorizingInterceptor</a>设置为“ inInterceptor”，并将对安全对象的引用传递给它。在ClaimsAuthorizingInterceptor周围还有一个JAX-RS过滤器包装，称为<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/security/ClaimsAuthorizingFilter.java" rel="nofollow">ClaimsAuthorizingFilter</a> 。</p><p>org.apache.cxf.rs.security.saml.authorization的实例。ClaimsAuthorizingFilter（请注意org.apache.cxf.rs.security.claims。CXF 3.3.0中的ClaimsAuthorizingFilter）用于强制实施CBAC。这是围绕ClaimsAuthorizingInterceptor的简单JAX-RS过滤器包装。</p><p>这是对JWT令牌强制执行Claims授权的示例。BookStoreAuthn是使用Claims批注进行批注的服务对象。ClaimsAuthorizingFilter作为JAX-RS提供程序添加到端点，并包装了serviceBean。还添加了JwtAuthenticationFilter实例以验证接收到的JWT令牌并设置ClaimsSecurityContext。<a shape="rect" class="external-link" href="http://rs.security.signature.in" rel="nofollow">rs.security.signature.in</a> .properties属性用于验证收到的令牌上的签名。</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;bean id="serviceBean" class="org.apache.cxf.systest.jaxrs.security.jose.jwt.BookStoreAuthn"/&gt;

&lt;bean id="claimsHandler" class="org.apache.cxf.jaxrs.security.ClaimsAuthorizingFilter"&gt;
    &lt;property name="securedObject" ref="serviceBean"/&gt;
&lt;/bean&gt;

&lt;bean id="jwtAuthzFilter" class="org.apache.cxf.rs.security.jose.jaxrs.JwtAuthenticationFilter"&gt;
    &lt;property name="roleClaim" value="role"/&gt;
&lt;/bean&gt;

&lt;jaxrs:server address="https://localhost:${testutil.ports.jaxrs-jwt-authn-authz}/signedjwtauthz"&gt;
        &lt;jaxrs:serviceBeans&gt;
            &lt;ref bean="serviceBean"/&gt;
        &lt;/jaxrs:serviceBeans&gt;
        &lt;jaxrs:providers&gt;
            &lt;ref bean="jwtAuthzFilter"/&gt;
            &lt;ref bean="claimsHandler"/&gt;
        &lt;/jaxrs:providers&gt;
        &lt;jaxrs:properties&gt;
            &lt;entry key="rs.security.signature.in.properties"
                   value="org/apache/cxf/systest/jaxrs/security/bob.jwk.properties"/&gt;
        &lt;/jaxrs:properties&gt;
&lt;/jaxrs:server&gt;</pre>
</div></div><h1 id="JAX-RSTokenAuthorization-Rolebasedaccesscontrol">基于角色的访问控制</h1><p>如果我们有一个SAML声明或JWT令牌，其中的声明已知可以表示角色，那么可以轻松地使这些声明与RBAC系统一起工作。</p><h2 id="JAX-RSTokenAuthorization-SimpleAuthorizingInterceptor">SimpleAuthorizingInterceptor</h2><p>一种选择是强制使用给定角色的只有用户才能访问服务bean中的方法，即使用CXF的SimpleAuthorizingInterceptor。它具有“ methodRolesMap”属性，可以将方法名称映射到角色。然后必须将此拦截器添加到服务端点的inInterceptor链中。例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;bean id="serviceBean" class="org.apache.cxf.systest.jaxrs.security.jose.jwt.BookStoreAuthn"/&gt;

&lt;bean id="jwtAuthzFilter" class="org.apache.cxf.rs.security.jose.jaxrs.JwtAuthenticationFilter"&gt;
    &lt;property name="roleClaim" value="role"/&gt;
&lt;/bean&gt;

&lt;bean id="authorizationInterceptor" 
    class="org.apache.cxf.interceptor.security.SimpleAuthorizingInterceptor"&gt;
    &lt;property name="methodRolesMap"&gt;
        &lt;map&gt;
            &lt;entry key="echoBook" value="boss"/&gt;
            &lt;entry key="echoBook2" value="boss"/&gt;
        &lt;/map&gt;
    &lt;/property&gt; 
&lt;/bean&gt;

&lt;jaxrs:server address="https://localhost:${testutil.ports.jaxrs-jwt-authn-authz}/signedjwtauthz"&gt;
        &lt;jaxrs:serviceBeans&gt;
            &lt;ref bean="serviceBean"/&gt;
        &lt;/jaxrs:serviceBeans&gt;
        &lt;jaxrs:providers&gt;
            &lt;ref bean="jwtAuthzFilter"/&gt;
        &lt;/jaxrs:providers&gt;
        &lt;jaxrs:inInterceptors&gt;
            &lt;ref bean="authorizationInterceptor"/&gt;
        &lt;/jaxrs:inInterceptors&gt;
       &#160;&lt;jaxrs:properties&gt;
            &lt;entry key="rs.security.signature.in.properties"
                   value="org/apache/cxf/systest/jaxrs/security/bob.jwk.properties"/&gt;
        &lt;/jaxrs:properties&gt;
&lt;/jaxrs:server&gt;</pre>
</div></div><h2 id="JAX-RSTokenAuthorization-Usingannotations">使用注释</h2><p>代替使用SimpleAuthorizingInterceptor将方法名称映射到角色，我们可以使用javax.annotation.security在服务bean中对其进行注释。允许的角色或org.springframework.security.annotation。安全的注释。例如：</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup span="1"><col span="1"></colgroup><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code class="java keyword">import</code> <code class="java plain"><a shape="rect" href="https://cwiki.apache.org/confluence/display/CXF20DOC/org.springframework.security.annotation.Secured;">org.springframework.security.annotation.Secured;</a></code><br clear="none"> <br clear="none"><code class="java color1">@Path</code><code class="java plain">(</code><code class="java string">"/bookstore"</code><code class="java plain">)</code><br clear="none"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">SecureBookStore {</code><br clear="none"><code class="java spaces">    </code> <br clear="none"><code class="java spaces">    </code><code class="java color1">@POST</code><br clear="none"><code class="java spaces">    </code><code class="java color1">@Secured</code><code class="java plain">(</code><code class="java string">"admin"</code><code class="java plain">)</code><br clear="none"><code class="java spaces">    </code><code class="java keyword">public</code> <code class="java plain">Book addBook(Book book) {</code><br clear="none"><code class="java spaces">        </code><code class="java keyword">return</code> <code class="java plain">book;</code><br clear="none"><code class="java spaces">    </code><code class="java plain">}</code><br clear="none"><code class="java plain">}</code></p></td></tr></tbody></table></div><p>如果需要，可以将@Secured替换为@RoledAllowed，可以使用以下配置：</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup span="1"><col span="1"></colgroup><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p><code class="java plain"><bean id=</code><code class="java string">"serviceBeanRoles"</code> <code class="java keyword">class</code><code class="java plain">=</code><code class="java string">"<a shape="rect" href="https://cwiki.apache.org/confluence/display/CXF20DOC/org.apache.cxf.systest.jaxrs.security.saml.SecureBookStore">org.apache.cxf.systest.jaxrs.security.saml.SecureBookStore</a>"</code><code class="java plain">/></code><br clear="none"><code class="java plain"><bean id=</code><code class="java string">"samlEnvHandler"</code> <code class="java keyword">class</code><code class="java plain">=</code><code class="java string">"<a shape="rect" href="https://cwiki.apache.org/confluence/display/CXF20DOC/org.apache.cxf.rs.security.saml.SamlEnvelopedInHandler">org.apache.cxf.rs.security.saml.SamlEnvelopedInHandler</a>"</code><code class="java plain">></code><br clear="none"><code class="java spaces"> </code><code class="java plain"><property name=</code><code class="java string">"securityContextProvider"</code><code class="java plain">></code><br clear="none"><code class="java spaces">    </code><code class="java plain"><bean</code><code class="java keyword">class</code><code class="java plain">=</code><code class="java string">"<a shape="rect" href="https://cwiki.apache.org/confluence/display/CXF20DOC/org.apache.cxf.systest.jaxrs.security.saml.CustomSecurityContextProvider">org.apache.cxf.systest.jaxrs.security.saml.CustomSecurityContextProvider</a>"</code><code class="java plain">/></code><br clear="none"><code class="java spaces"> </code><code class="java plain"></property></code><br clear="none"><code class="java plain"></bean></code><br clear="none"> <br clear="none"><code class="java plain"><bean id=</code><code class="java string">"authorizationInterceptor"</code> <code class="java keyword">class</code><code class="java plain">=</code><code class="java string">"<a shape="rect" href="https://cwiki.apache.org/confluence/display/CXF20DOC/org.apache.cxf.interceptor.security.SecureAnnotationsInterceptor">org.apache.cxf.interceptor.security.SecureAnnotationsInterceptor</a>"</code><code class="java plain">></code><br clear="none"><code class="java spaces">    </code><code class="java plain"><property name=</code><code class="java string">"securedObject"</code> <code class="java plain">ref=</code><code class="java string">"serviceBean"</code><code class="java plain">/></code><br clear="none"><code class="java spaces">    </code><code class="java plain"><property name=</code><code class="java string">"annotationClassName"</code><br clear="none"><code class="java spaces">              </code><code class="java plain">value=</code><code class="java string">"<a shape="rect" href="https://cwiki.apache.org/confluence/display/CXF20DOC/org.springframework.security.annotation.Secured">org.springframework.security.annotation.Secured</a>"</code><code class="java plain">/></code><br clear="none"><code class="java plain"></bean></code><br clear="none"><code class="java spaces">    </code> <br clear="none"><code class="java plain"><bean id=</code><code class="java string">"rolesHandler"</code> <code class="java keyword">class</code><code class="java plain">=</code><code class="java string">"<a shape="rect" href="https://cwiki.apache.org/confluence/display/CXF20DOC/org.apache.cxf.jaxrs.security.SimpleAuthorizingFilter">org.apache.cxf.jaxrs.security.SimpleAuthorizingFilter</a>"</code><code class="java plain">></code><br clear="none"><code class="java spaces">    </code><code class="java plain"><property name=</code><code class="java string">"interceptor"</code> <code class="java plain">ref=</code><code class="java string">"authorizationInterceptor"</code><code class="java plain">/></code><br clear="none"><code class="java plain"></bean></code><br clear="none"><code class="java spaces">    </code> <br clear="none"><code class="java plain"><jaxrs:server address=</code><code class="java string">"/saml-roles"</code><code class="java plain">></code><br clear="none"><code class="java spaces">  </code><code class="java plain"><jaxrs:serviceBeans></code><br clear="none"><code class="java spaces">     </code><code class="java plain"><ref bean=</code><code class="java string">"serviceBeanRoles"</code><code class="java plain">/></code><br clear="none"><code class="java spaces">  </code><code class="java plain"></jaxrs:serviceBeans></code><br clear="none"><code class="java spaces">  </code><code class="java plain"><jaxrs:providers></code><br clear="none"><code class="java spaces">      </code><code class="java plain"><ref bean=</code><code class="java string">"samlEnvHandler"</code><code class="java plain">/></code><br clear="none"><code class="java spaces">      </code><code class="java plain"><ref bean=</code><code class="java string">"rolesHandler"</code><code class="java plain">/></code><br clear="none"><code class="java spaces">  </code><code class="java plain"></jaxrs:providers></code><br clear="none"><code class="java spaces">  </code> <br clear="none"><code class="java spaces">  </code><code class="java plain"><!-- If</code><code class="java keyword">default</code> <code class="java plain">role qualifier and format are not supported:</code><br clear="none"><code class="java spaces">       </code> <br clear="none"><code class="java spaces">  </code><code class="java plain"><jaxrs:properties></code><br clear="none"><code class="java spaces">     </code><code class="java plain"><entry key=</code><code class="java string">"<a shape="rect" href="https://cwiki.apache.org/confluence/display/CXF20DOC/org.apache.cxf.saml.claims.role.nameformat">org.apache.cxf.saml.claims.role.nameformat</a>"</code><br clear="none"><code class="java spaces">                </code><code class="java plain">value=</code><code class="java string">"urn:oasis:names:tc:SAML:<a shape="rect" href="https://cwiki.apache.org/confluence/display/CXF20DOC/2.0:attrname-format:uri">2.0:attrname-format:uri</a>"</code><code class="java plain">/></code><br clear="none"><code class="java spaces">     </code><code class="java plain"><entry key=</code><code class="java string">"<a shape="rect" href="https://cwiki.apache.org/confluence/display/CXF20DOC/org.apache.cxf.saml.claims.role.qualifier">org.apache.cxf.saml.claims.role.qualifier</a>"</code><br clear="none"><code class="java spaces">                </code><code class="java plain">value=</code><code class="java string">"urn:oid:<a shape="rect" href="https://cwiki.apache.org/confluence/display/CXF20DOC/1.3.6.1.4.1.5923.1.1.1.1">1.3.6.1.4.1.5923.1.1.1.1</a>"</code><code class="java plain">/></code><br clear="none"><code class="java spaces">  </code><code class="java plain"></jaxrs:properties></code><br clear="none"><code class="java spaces">  </code><code class="java plain">--></code><br clear="none"><code class="java plain"></jaxrs:server></code></p></td></tr></tbody></table></div><p>这就是所需要的。请注意，为了帮助默认的SAML SecurityContextProvider找出哪些声明是角色，可以设置两个属性，如上所示-如果知道声明角色的声明具有默认值的NameFormat和Name值（即“目前分别为“ <a shape="rect" class="external-link" href="http://schemas.xmlsoap.org/ws/2005/05/identity/claims" rel="nofollow">http://schemas.xmlsoap.org/ws/2005/05/identity/claims</a> ”和“ <a shape="rect" class="external-link" href="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/role" rel="nofollow">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/role</a> ”。</p><p>请注意，您可以将RBAC和CBAC结合使用，以实施更复杂的访问控制规则，同时仍保持现有代码完全依赖@RolesAllowed或@Secured。覆盖ClaimsAuthorizingFilter并直接使用Claims规则对其进行配置，并将其与SimpleAuthorizingFilter一起注册，然后开始。</p><p>还要注意SecureAnnotationsInterceptor如何处理不同类型的角色注释，默认情况下支持@RolesAllowed。</p></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=93323401">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=93323401&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>