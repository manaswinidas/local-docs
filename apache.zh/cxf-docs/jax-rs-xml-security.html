<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - JAX-RS XML Security">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script src='/resources/highlighter/scripts/shBrushXml.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-JAX-RS XML安全性</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="restful-services.html">RESTful服务</a> > <a href="jax-rs.html">JAX-RS</a> > <a href="jax-rs-xml-security.html">JAX-RS XML安全性</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><form id="cse-search-box" enctype="application/x-www-form-urlencoded" method="get" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="搜索">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><p><span style="font-size:2em;font-weight:bold">JAX-RS：XML安全性</span>


<br clear="none"></p><p><style type="text/css">/*<![CDATA[*/
div.rbtoc1553637436591 {padding: 0px;}
div.rbtoc1553637436591 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1553637436591 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style></p><div class="toc-macro rbtoc1553637436591">
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSXMLSecurity-Introduction">介绍</a></li><li><a shape="rect" href="#JAX-RSXMLSecurity-Mavendependencies">Maven依赖</a></li><li><a shape="rect" href="#JAX-RSXMLSecurity-Backwardscompatibilityconfigurationnote">向后兼容性配置说明</a></li><li><a shape="rect" href="#JAX-RSXMLSecurity-XMLSignature">XML签名</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSXMLSecurity-Envelopedsignatures">信封签名</a></li><li><a shape="rect" href="#JAX-RSXMLSecurity-Envelopingsignatures">信封签名</a></li><li><a shape="rect" href="#JAX-RSXMLSecurity-Detachedsignatures">分离的签名</a></li><li><a shape="rect" href="#JAX-RSXMLSecurity-Customizingthesignature">自定义签名</a></li><li><a shape="rect" href="#JAX-RSXMLSecurity-SignatureKeyInfoValidation">签名密钥信息验证</a></li></ul>
</li><li><a shape="rect" href="#JAX-RSXMLSecurity-XMLEncryption">XML加密</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSXMLSecurity-Usingtherequestsignaturecertificatesfortheencryption">使用请求签名证书进行加密</a></li><li><a shape="rect" href="#JAX-RSXMLSecurity-Customizingtheencryption">自定义加密</a></li><li><a shape="rect" href="#JAX-RSXMLSecurity-GCMAlgorithmandBouncyCastleprovider">GCM算法和BouncyCastle提供程序</a></li></ul>
</li><li><a shape="rect" href="#JAX-RSXMLSecurity-Restrictingencryptionandsignaturealgorithms">限制加密和签名算法</a></li><li><a shape="rect" href="#JAX-RSXMLSecurity-Interoperability">互通性</a></li></ul>
</div><h1 id="JAX-RSXMLSecurity-Introduction">介绍</h1><p>CXF 2.5.0引入了对使用<a shape="rect" class="external-link" href="http://www.w3.org/TR/xmldsig-core/" rel="nofollow">XML签名</a>和<a shape="rect" class="external-link" href="http://www.w3.org/TR/xmlenc-core/" rel="nofollow">XML加密</a>保护JAX-RS客户端和端点的初始支持。<br clear="none">这是一项正在进行的工作，增强功能将定期应用。还将适时提供对替代签名和加密技术的支持。</p><h1 id="JAX-RSXMLSecurity-Mavendependencies">Maven依赖</h1><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt;
  &lt;artifactId&gt;cxf-rt-rs-security-xml&lt;/artifactId&gt;
  &lt;version&gt;2.5.2&lt;/version&gt;
&lt;/dependency&gt;
</pre>
</div></div><h1 id="JAX-RSXMLSecurity-Backwardscompatibilityconfigurationnote">向后兼容性配置说明</h1><p>从Apache CXF 3.1.0起，用于配置XML签名或加密的基于WS-Security的配置标签（“ ws-security- *”）已更改为仅以“ security-”开头。除此之外，它们是完全相同的。CXF 3.1.0继续接受较旧的“ ws-security-”值。要将本页中的任何配置示例与旧版本的CXF一起使用，只需在配置标签中添加“ ws-”前缀即可。</p><h1 id="JAX-RSXMLSecurity-XMLSignature">XML签名</h1><p><a shape="rect" class="external-link" href="http://www.w3.org/TR/xmldsig-core/" rel="nofollow">XML签名</a>定义了三种签名类型：信封签名，信封签名和分离签名。CXF JAX-RS支持所有这三种类型。</p><p><strong>新增功能</strong>从CXF 2.5.2开始，还可以在服务器端添加XML签名，并在客户端进行验证。</p><h2 id="JAX-RSXMLSecurity-Envelopedsignatures">信封签名</h2><p>有效负载：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;Book ID="4bd59819-7b78-47a5-bb61-cc08348e9d48"&gt;
   &lt;id&gt;126&lt;/id&gt;
   &lt;name&gt;CXF&lt;/name&gt;

   &lt;ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
      &lt;ds:SignedInfo&gt;
         &lt;ds:CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/&gt;
         &lt;ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/&gt;
         &lt;ds:Reference URI="#4bd59819-7b78-47a5-bb61-cc08348e9d48"&gt;
           &lt;ds:Transforms&gt;
             &lt;ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/&gt;
             &lt;ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/&gt;
           &lt;/ds:Transforms&gt;
           &lt;ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/&gt;
           &lt;ds:DigestValue&gt;eFduzs6Cg1/Wd6jagUmr8vRYxHY=&lt;/ds:DigestValue&gt;
         &lt;/ds:Reference&gt;
      &lt;/ds:SignedInfo&gt;
&lt;ds:SignatureValue&gt;DLD+wU85G+Q+H/SNoMr1I7tOCAZAjd3lYE84sBGU5tuMtzbwxKOIgg10g2F1SUbpujy1CZZ9BPkQNA+gA1CH4
FE3uiBzp3DDSVv6o5l6Q76Ci0XI28ylO7O1OCY+q2nbP0WtERFWOn9f9nniVKbduz6YQHjv6cNLd8pf4+k2U3g=&lt;/ds:SignatureValue&gt;

       &lt;ds:KeyInfo&gt;
         &lt;ds:X509Data&gt;&lt;ds:X509Certificate&gt;MIICGjCCAYOgAwIBAgIESVRgATANBgkqhkiG9w0BAQUFADAzMRMwEQYDVQQKEwphcGFjaGUub3JnMQwwCgYDVQQL
EwNlbmcxDjAMBgNVBAMTBWN4ZmNhMB4XDTcwMDEwMTAwMDAwMFoXDTM4MDExOTAzMTQwN1owMzETMBEGA1UEChMKYXBhY2hlLm9yZzEMMAoGA1UECxMDZW5nMQ4wDAYDVQ
QDEwVhbGljZTCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAvu747/VShQ85f16DGSc4Ixh9PVpGguyEqrCsK8q9XHOYX9l9/g5wEC6ZcR2FwfNsoaHcKNPjd5sSTzVt
BWmQjfBEfIqwTR7vuihOxyNTwEzVwIJzvo7p8/aYxk+VdBtQxq4UweIcf/iFkUbM1cZ1oiXRQzciRBi+C1BQCQE0qzsCAwEAAaM7MDkwIQYDVR0SBBowGIIWTk9UX0ZPUl
9QUk9EVUNUSU9OX1VTRTAUBgNVHREEDTALgglsb2NhbGhvc3QwDQYJKoZI
hvcNAQEFBQADgYEAhLwkm+8psKt4gnbikGzV0TgpSWGcWxWKBi+z8tI2n6hFA5v1jVHHa4G9h3s0nxQ2TewzeR/k7gmgV2sI483NgrYHmTmLKaDBWza2pAuZuDhQH8GAEh
JakFtKBP++EC9rNNpZnqqHxx3qb2tW25qRtBzDmK921gg9PMomMc7uqRQ=&lt;/ds:X509Certificate&gt;
        &lt;/ds:X509Data&gt;

        &lt;ds:KeyValue&gt;
          &lt;ds:RSAKeyValue&gt;
             &lt;ds:Modulus&gt;vu747/VShQ85f16DGSc4Ixh9PVpGguyEqrCsK8q9XHOYX9l9/g5wEC6ZcR2FwfNsoaHcKNPjd5sSTzVtBWmQjfBEfIqwTR7vuihOxyNTw
EzVwIJzvo7p8/aYxk+VdBtQxq4UweIcf/iFkUbM1cZ1oiXRQzciRBi+C1BQCQE0qzs=&lt;/ds:Modulus&gt;
             &lt;ds:Exponent&gt;AQAB&lt;/ds:Exponent&gt;
          &lt;/ds:RSAKeyValue&gt;
        &lt;/ds:KeyValue&gt;
       &lt;/ds:KeyInfo&gt;
     &lt;/ds:Signature&gt;

&lt;/Book&gt;
</pre>
</div></div><p>请注意，Book根元素已签名，包括其名称和id子元素，并且签名ds：Reference链接到Book。</p><p>服务器配置片段：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;bean id="serviceBean" class="org.apache.cxf.systest.jaxrs.security.BookStore"/&gt;
&lt;bean id="xmlSigHandler" class="org.apache.cxf.rs.security.xml.XmlSigInHandler"/&gt;
&lt;bean id="xmlSigOutHandler" class="org.apache.cxf.rs.security.xml.XmlSigOutInterceptor"/&gt;

&lt;jaxrs:server address="/xmlsig"&gt; 
    &lt;jaxrs:serviceBeans&gt;
      &lt;ref bean="serviceBean"/&gt;
    &lt;/jaxrs:serviceBeans&gt;
    &lt;!-- 
       Required for validating the in signature and removing it from the payload.
       It also persists the signature on the current Message which can be disabled.
    --&gt;
    &lt;jaxrs:providers&gt;
      &lt;ref bean="xmlSigHandler"/&gt;
    &lt;/jaxrs:providers&gt; 
    &lt;!-- 
       Required for adding a new signature to the outbound payload
    --&gt;
    &lt;jaxrs:outInterceptors&gt;
          &lt;ref bean="xmlSigOutHandler"/&gt;
    &lt;/jaxrs:outInterceptors&gt;

    &lt;jaxrs:properties&gt;
          &lt;entry key="security.callback-handler" 
                  value="org.apache.cxf.systest.jaxrs.security.saml.KeystorePasswordCallback"/&gt;
          &lt;entry key="security.signature.properties" 
                  value="org/apache/cxf/systest/jaxrs/security/alice.properties"/&gt;
    &lt;/jaxrs:properties&gt;
&lt;/jaxrs:server&gt;

</pre>
</div></div><p>请注意，org.apache.cxf.rs.security.xml。XmlSigInHandler负责验证附加到入站有效负载的签名，并且能够处理所有3种XML签名。</p><p>org.apache.cxf.rs.security.xml。XmlSigOutInterceptor负责向出站有效负载添加新的签名。</p><p>客户代码：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">String address = "https://localhost:8080/xmlsig/bookstore/books";
JAXRSClientFactoryBean bean = new JAXRSClientFactoryBean();
bean.setAddress(address);

// setup properties
Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();
properties.put("security.callback-handler", 
               "org.apache.cxf.systest.jaxrs.security.saml.KeystorePasswordCallback");
properties.put("security.signature.username", "alice");
properties.put("security.signature.properties", 
               "org/apache/cxf/systest/jaxrs/security/alice.properties");
bean.setProperties(properties);

// add the interceptor which will add a signature to the outbound payload
XmlSigOutInterceptor sigOutInterceptor = new XmlSigOutInterceptor();
bean.getOutInterceptors().add(sigOutInterceptor);

// add the interceptor which will validate a signature in the inbound payload
XmlSigInInterceptor sigInInterceptor = new XmlSigInInterceptor();
bean.getInInterceptors().add(sigInInterceptor);


// load a bus with HTTPS configuration:
SpringBusFactory bf = new SpringBusFactory();
Bus bus = bf.createBus(configLocation);
bean.setBus(bus);
        
// use WebClient (or proxy) as usual
WebClient wc = bean.createWebClient();
Book book = wc.post(new Book("CXF", 126L), Book.class);
</pre>
</div></div><p>弹簧配置也可以使用。<br clear="none">还请检查<a shape="rect" href="secure-jax-rs-services.html">Secure JAX-RS服务</a> ，了解如何从Spring配置HTTPS。</p><h2 id="JAX-RSXMLSecurity-Envelopingsignatures">信封签名</h2><p>有效负载：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
   &lt;ds:SignedInfo&gt;
      &lt;ds:CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/&gt;
      &lt;ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/&gt;
      &lt;ds:Reference URI="#88e688e6-6512-406f-9e88-a58e5d781ff0"&gt;
        &lt;ds:Transforms&gt;
           &lt;ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/&gt;
        &lt;/ds:Transforms&gt;
        &lt;ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/&gt;
        &lt;ds:DigestValue&gt;Cq3zl3t3DqWTvuZ+4EtZgGs4ikk=&lt;/ds:DigestValue&gt;
      &lt;/ds:Reference&gt;
   &lt;/ds:SignedInfo&gt;&lt;ds:SignatureValue&gt;NvcCS8vx3YJkc8fHMf8bQkC+lwasC6CwiS7HfKSm8t+6TtYdM7TRbYxSuqfCTkF4
vBIldWIzl6UngON592FfJdbvrgE2CusCkIybrP7BBmP7zTSV0GjH4/60L6ObkhGPkMNoKzw4V+zgF7Zo+F7ngsz5ZUWZX/GWETmTtYtcfT0=&lt;/ds:SignatureValue&gt;
   &lt;ds:KeyInfo&gt;
     &lt;ds:X509Data&gt;
       &lt;ds:X509Certificate&gt;&lt;!-- Omitted for brevity--&gt;&lt;/ds:X509Certificate&gt;
     &lt;/ds:X509Data&gt;
     &lt;ds:KeyValue&gt;
      &lt;ds:RSAKeyValue&gt;&lt;ds:Modulus&gt;vu747/VShQ85f16DGSc4Ixh9PVpGguyEqrCsK8q9XHOYX9l9/g5wEC6ZcR2FwfNsoaHcKNPjd5sST
zVtBWmQjfBEfIqwTR7vuihOxyNTwEzVwIJzvo7p8/aYxk+VdBtQxq4UweIcf/iFkUbM1cZ1oiXRQzciRBi+C1BQCQE0qzs=&lt;/ds:Modulus&gt;
       &lt;ds:Exponent&gt;AQAB&lt;/ds:Exponent&gt;
      &lt;/ds:RSAKeyValue&gt;
     &lt;/ds:KeyValue&gt;
   &lt;/ds:KeyInfo&gt;
   &lt;ds:Object ID="88e688e6-6512-406f-9e88-a58e5d781ff0"&gt;

      &lt;Book&gt;
         &lt;id&gt;126&lt;/id&gt;
         &lt;name&gt;CXF&lt;/name&gt;
      &lt;/Book&gt;
   &lt;/ds:Object&gt;
&lt;/ds:Signature&gt;
</pre>
</div></div><p>这次，签名使用ds：Reference链接到的ds：Object包装器封装Book元素。</p><p>服务器配置片段与“信封签名”部分中显示的片段相同。</p><p>客户端代码与“信封签名”部分中显示的代码几乎相同，不同之处在于XmlSigOutInterceptor需要设置其他属性：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">// add the interceptor dealing with adding a signature
XmlSigOutInterceptor sigInterceptor = new XmlSigOutInterceptor();
sigInterceptor.setStyle("enveloping");

</pre>
</div></div><h2 id="JAX-RSXMLSecurity-Detachedsignatures">分离的签名</h2><p>有效负载：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;env:Envelope xmlns:env="http://org.apache.cxf/rs/env"&gt;

  &lt;Book ID="e9836bc2-cb5a-453f-b967-a9ddbaf9a6de"&gt;
    &lt;id&gt;125&lt;/id&gt;
    &lt;name&gt;CXF&lt;/name&gt;
   &lt;/Book&gt;
   &lt;ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
     &lt;ds:SignedInfo&gt;
       &lt;ds:CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/&gt;
       &lt;ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/&gt;
       &lt;ds:Reference URI="#e9836bc2-cb5a-453f-b967-a9ddbaf9a6de"&gt;
         &lt;ds:Transforms&gt;
           &lt;ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/&gt;
         &lt;/ds:Transforms&gt;
         &lt;ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/&gt;
         &lt;ds:DigestValue&gt;Pxz77Hlg6I/MRsJz4gixkaMFtYI=&lt;/ds:DigestValue&gt;
       &lt;/ds:Reference&gt;
     &lt;/ds:SignedInfo&gt;
&lt;ds:SignatureValue&gt;JSwgiVqZT1EtJ9xqtb90juS54pvZguzFMne7cQyGMQDvBW7b65aAAIfVx/PmFB7Tuy4qB4zqNFCzCwHlhDurNP9NYB7PEzFsA3v
3vSyEcHnpUhu41xmBvjT5HWEKbuzqX0dHekizuUefbfzG5WpluVPmOgjashrm9DIhfEf+Hyg=&lt;/ds:SignatureValue&gt;
     &lt;ds:KeyInfo&gt;
      &lt;ds:X509Data&gt;
         &lt;ds:X509Certificate&gt;&lt;!--Omitted for Brewity--&gt;&lt;/ds:X509Certificate&gt;
      &lt;/ds:X509Data&gt;
      &lt;ds:KeyValue&gt;
        &lt;ds:RSAKeyValue&gt;
          &lt;ds:Modulus&gt;vu747/VShQ85f16DGSc4Ixh9PVpGguyEqrCsK8q9XHOYX9l9/g5wEC6ZcR2FwfNsoaHcKNPjd5sSTzVtBWmQjfBEfIqwTR7v
uihOxyNTwEzVwIJzvo7p8/aYxk+VdBtQxq4UweIcf/iFkUbM1cZ1oiXRQzciRBi+C1BQCQE0qzs=&lt;/ds:Modulus&gt;
          &lt;ds:Exponent&gt;AQAB&lt;/ds:Exponent&gt;
        &lt;/ds:RSAKeyValue&gt;
      &lt;/ds:KeyValue&gt;
     &lt;/ds:KeyInfo&gt;
   &lt;/ds:Signature&gt;

    &lt;saml2:Assertion xmlns:saml2="urn:oasis:names:tc:SAML:2.0:assertion" xmlns:xs="http://www.w3.org/2001/XMLSchema" 
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" ID="_E462768C678896CE9913202742137181" 
IssueInstant="2011-11-02T22:50:13.718Z" Version="2.0" xsi:type="saml2:AssertionType"&gt;

&lt;saml2:Issuer&gt;https://idp.example.org/SAML2&lt;/saml2:Issuer&gt;

&lt;ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
 &lt;!-- 
    Enveloped/embedded SAML Assertion XML Signature is omitted for brevity
    See the JAX-RS SAML section for more info
 --&gt;
&lt;/ds:Signature&gt;
&lt;!-- the rest of SAML assertion --&gt;
&lt;/saml2:Assertion&gt;
&lt;/env:Envelope&gt;
</pre>
</div></div><p>请注意，整个有效负载都由可配置的元素包装器封装。Book实例是信封的一部分，并由分离的签名签名（请参阅第一个ds：Signature，其ds：Reference链接到Book）。信封还具有嵌入式SAML声明，该声明具有自己的封装签名。</p><p>org.apache.cxf.rs.security.xml的实例。XmlSigInHandler将在服务器端处理Book XML片段的分离的XML签名。有关如何处理SAML断言的更多信息，请参见<a shape="rect" href="jax-rs-saml.html">JAX-RS SAML</a> 。</p><p>客户端代码与“信封签名”部分中显示的代码几乎相同，不同之处在于XmlSigOutInterceptor需要设置其他属性：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">// add the interceptor dealing with adding a signature
XmlSigOutInterceptor sigInterceptor = new XmlSigOutInterceptor();
sigInterceptor.setStyle("detached");

</pre>
</div></div><h2 id="JAX-RSXMLSecurity-Customizingthesignature">自定义签名</h2><p>org.apache.cxf.rs.security.xml。XmlSigOutInterceptor在客户端管理签名的创建。<br clear="none">目前可以在其上设置以下属性：</p><p>“样式”：可能的值是“包围”（默认），“包围”和“分离”<br clear="none">“ envelopedName”：仅用于“分离式”样式，默认值为“ { <a shape="rect" class="external-link" rel="nofollow" href="http://org.apache.cxf/rs/env">http：//org.apache.cxf/rs/env</a> }信封”<br clear="none">“ signatureAlgorithm”：默认为“ http://www.w3.org/2000/09/xmldsig#rsa-sha1”<br clear="none">“ digestAlgorithm”：默认为“ http://www.w3.org/2000/09/xmldsig#sha1”</p><h2 id="JAX-RSXMLSecurity-SignatureKeyInfoValidation">签名密钥信息验证</h2><p>默认情况下，ds：Signature应该包含ds：KeyInfo元素。</p><p>在输出拦截器上将“ keyInfoMustBeAvailable”属性设置为false会导致不包含KeyInfo。</p><p>如果在in拦截器上将相同属性设置为false，则将使用经过身份验证的主体名称或默认存储别名来加载用于验证签名的证书。</p><h1 id="JAX-RSXMLSecurity-XMLEncryption">XML加密</h1><p>对XML有效负载进行加密可以降低对HTTPS的要求。</p><p>这是有效负载示例：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;xenc:EncryptedData xmlns:xenc="http://www.w3.org/2001/04/xmlenc#"&gt;
  &lt;xenc:EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#aes128-cbc"/&gt;
  &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
    &lt;ds:RetrievalMethod Type="http://www.w3.org/2001/04/xmlenc#EncryptedKey"/&gt;
    &lt;xenc:EncryptedKey Id="EK-B353DDCEE7C575B6A213203188664772"&gt;
      &lt;xenc:EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p"/&gt;
        &lt;ds:KeyInfo&gt;
            &lt;ds:X509Data&gt;
               &lt;ds:X509Certificate&gt;&lt;!-- Omitted for brevity --&gt;&lt;/ds:X509Certificate&gt;
           &lt;/ds:X509Data&gt;
        &lt;/ds:KeyInfo&gt;
        &lt;xenc:CipherData&gt;&lt;xenc:CipherValue&gt;tPtZz4pnVWquaV2a7O0y+VrHoeWwk3Eu5Jnu3RHz5rGDB/MLyG6rBamhit03J2xWaV52zUtDAPEj8sr4oy5y2KLB09Hu317IbQjinePabUpd
+DLnwNn5iHZpHWJPfndkh07JdYZSrMwqOvJ3fqrNJ+LQeLzZDneT8sC1vRyhSDU=&lt;/xenc:CipherValue&gt;
        &lt;/xenc:CipherData&gt;
    &lt;/xenc:EncryptedKey&gt;
  &lt;/ds:KeyInfo&gt;
  &lt;xenc:CipherData&gt;
     &lt;xenc:CipherValue&gt;3ZPQ3SapAxemJwqG58sWh+r8B5SMRf/DZ2w/REswgl0zr8kpk0x4tayC5hl7IbSE8CPQYYHX8sXVnUFUoHOtJA==&lt;/xenc:CipherValue&gt;
  &lt;/xenc:CipherData&gt;
&lt;/xenc:EncryptedData&gt;
</pre>
</div></div><p>这是服务器配置片段：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;bean id="serviceBean" class="org.apache.cxf.systest.jaxrs.security.BookStore"/&gt;
&lt;bean id="xmlSigInHandler" class="org.apache.cxf.rs.security.xml.XmlSigInHandler"/&gt;
&lt;bean id="xmlEncInHandler" class="org.apache.cxf.rs.security.xml.XmlEncInHandler"/&gt;
    
&lt;jaxrs:server address="/xmlsig"&gt; 
    &lt;jaxrs:serviceBeans&gt;
      &lt;ref bean="serviceBean"/&gt;
    &lt;/jaxrs:serviceBeans&gt;
    &lt;jaxrs:providers&gt;
       &lt;ref bean="xmlEncHandler"/&gt;
       &lt;ref bean="xmlSigHandler"/&gt;
    &lt;/jaxrs:providers&gt; 
     &lt;jaxrs:properties&gt;
           &lt;entry key="security.callback-handler" 
                  value="org.apache.cxf.systest.jaxrs.security.saml.KeystorePasswordCallback"/&gt;
           &lt;entry key="security.encryption.properties" 
                  value="org/apache/cxf/systest/jaxrs/security/bob.properties"/&gt;
           &lt;entry key="security.signature.properties" 
                  value="org/apache/cxf/systest/jaxrs/security/alice.properties"/&gt;       
     &lt;/jaxrs:properties&gt; 
&lt;/jaxrs:server&gt;

</pre>
</div></div><p>此配置支持接收签名的然后加密的XML有效负载。</p><p>代码：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">String address = "https://localhost:8080/xmlencryption/bookstore/books";
JAXRSClientFactoryBean bean = new JAXRSClientFactoryBean();
bean.setAddress(address);

// setup properties
Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();

properties.put("security.callback-handler", 
               "org.apache.cxf.systest.jaxrs.security.saml.KeystorePasswordCallback");
properties.put("security.encryption.username", "bob");
properties.put("security.encryption.properties", 
                       "org/apache/cxf/systest/jaxrs/security/bob.properties");

// if signature required: 
properties.put("security.signature.username", "alice");
properties.put("security.signature.properties", 
               "org/apache/cxf/systest/jaxrs/security/alice.properties");

bean.setProperties(properties);

// if signature required: add the interceptor dealing with adding a signature
XmlSigOutInterceptor sigInterceptor = new XmlSigOutInterceptor();
bean.getOutInterceptors().add(sigInterceptor);

// add the interceptor dealing with the encryption

XmlEncOutInterceptor encInterceptor = new XmlEncOutInterceptor();
encInterceptor.setSymmetricEncAlgorithm("http://www.w3.org/2001/04/xmlenc#aes128-cbc");
bean.getOutInterceptors().add(encInterceptor);

       
// use WebClient (or proxy) as usual
WebClient wc = bean.createWebClient();
Response r = wc.post(new Book("CXF", 126L), Book.class);
assertEquals(200, r.getStatus());
</pre>
</div></div><p>请注意，XmlEncOutInterceptor拦截器的“ symmetricEncAlgorithm”属性设置为较弱的类型，只是为了使CXF测试通过。</p><p>实际的应用程序客户端代码不会期望诸如Book back之类的有效负载，但是如果确实如此，则将服务器配置为对响应进行加密将非常简单：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;bean id="serviceBean" class="org.apache.cxf.systest.jaxrs.security.BookStore"/&gt;
&lt;bean id="xmlSigInHandler" class="org.apache.cxf.rs.security.xml.XmlSigInHandler"/&gt;
&lt;bean id="xmlSigOutHandler" class="org.apache.cxf.rs.security.xml.XmlSigOutInterceptor"/&gt;

&lt;bean id="xmlEncInHandler" class="org.apache.cxf.rs.security.xml.XmlEncInHandler"/&gt;
&lt;bean id="xmlEncOutHandler" class="org.apache.cxf.rs.security.xml.XmlEncOutInterceptor"&gt;
        &lt;property name="symmetricEncAlgorithm" value="aes128-cbc"/&gt;
&lt;/bean&gt;

&lt;jaxrs:server address="/xmlsec"&gt; 
    &lt;jaxrs:serviceBeans&gt;
      &lt;ref bean="serviceBean"/&gt;
    &lt;/jaxrs:serviceBeans&gt;
    &lt;jaxrs:providers&gt;
       &lt;ref bean="xmlEncInHandler"/&gt;
       &lt;ref bean="xmlSigInHandler"/&gt;
    &lt;/jaxrs:providers&gt; 
    &lt;jaxrs:outInterceptors&gt;
        &lt;ref bean="xmlSigOutHandler"/&gt; 
        &lt;ref bean="xmlEncOutHandler"/&gt;
     &lt;/jaxrs:outInterceptors&gt;
     &lt;jaxrs:properties&gt;
         &lt;entry key="security.callback-handler" 
                  value="org.apache.cxf.systest.jaxrs.security.saml.KeystorePasswordCallback"/&gt;
         &lt;entry key="security.encryption.properties" 
                  value="org/apache/cxf/systest/jaxrs/security/alice.properties"/&gt;
         &lt;entry key="security.signature.properties" 
                  value="org/apache/cxf/systest/jaxrs/security/bob.properties"/&gt;
 
    &lt;/jaxrs:properties&gt; 
&lt;/jaxrs:server&gt;
</pre>
</div></div><p>现在，可以更新客户端代码，以期望经过加密和签名的Book back：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">// Use the previous code fragment, add the in interceptors:
XmlEncInInterceptor encInInterceptor = new XmlEncInInterceptor();
bean.getInInterceptors().add(encInInterceptor);
XmlSigInInterceptor sigInInterceptor = new XmlSigInInterceptor();
bean.getInInterceptors().add(sigInInterceptor);
</pre>
</div></div><h2 id="JAX-RSXMLSecurity-Usingtherequestsignaturecertificatesfortheencryption">使用请求签名证书进行加密</h2><p><strong>从CXF 2.6.1和2.5.4：</strong></p><p>当多个客户端发布加密和签名的有效负载时，以下配置将导致请求签名证书被用于加密用于加密响应的对称密钥：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;!-- server --&gt;
&lt;jaxrs:server&gt;
&lt;jaxrs:properties&gt;
         &lt;entry key="security.callback-handler" 
                  value="org.apache.cxf.systest.jaxrs.security.saml.KeystorePasswordCallback"/&gt;
         &lt;entry key="security.encryption.properties" 
                  value="org/apache/cxf/systest/jaxrs/security/alice.properties"/&gt;
         &lt;entry key="security.encryption.username" value="useReqSigCert"/&gt;
         &lt;entry key="security.signature.properties" 
                  value="org/apache/cxf/systest/jaxrs/security/bob.properties"/&gt;
 
    &lt;/jaxrs:properties&gt;
&lt;/jaxrs:server&gt;
&lt;jaxrs:client&gt;
    &lt;jaxrs:properties&gt;
         &lt;entry key="security.callback-handler" 
                  value="org.apache.cxf.systest.jaxrs.security.saml.KeystorePasswordCallback"/&gt;
         &lt;entry key="security.encryption.properties" 
                  value="org/apache/cxf/systest/jaxrs/security/bob.properties"/&gt;
         &lt;entry key="security.encryption.username" value="bob"/&gt;
         &lt;entry key="security.signature.properties" 
                  value="org/apache/cxf/systest/jaxrs/security/alice.properties"/&gt;
         &lt;entry key="security.signature.username" value="alice"/&gt;
    &lt;/jaxrs:properties&gt;
&lt;/jaxrs:client&gt;
</pre>
</div></div><p>服务器“ security.encryption.username”属性设置为“ useReqSigCert”。</p><p>请注意，客户端配置假定Alice（及其alice.properties）表示给定的客户端Bob（及其bob.properties）-接收器/服务器。</p><p>在服务器端，加密属性指向alice.properties，signature.properties指向bob.properties。这是因为出站签名需要使用Bob的证书和加密来完成-使用特定的Alice的证书或入站签名中的证书。请注意，in加密处理程序将首先检查签名属性-这将确保in签名处理程序类似地验证用于加密客户端数据的Bob证书。</p><h2 id="JAX-RSXMLSecurity-Customizingtheencryption">自定义加密</h2><p>org.apache.cxf.rs.security.xml。XmlEncOutInterceptor管理加密过程。<br clear="none">目前可以在其上设置以下属性：<br clear="none">“ symmetricEncAlgorithm”：默认为“ http://www.w3.org/2001/04/xmlenc#aes256-cbc”，支持完整的URI或短标识符，例如“ aes128-cbc”或“ http：// www.w3.org/2001/04/xmlenc#aes256-cbc”。<br clear="none">“ digestAlgorithm”：可选，例如可以设置“ http://www.w3.org/2001/04/xmlenc#sha256”。<br clear="none">“ keyEncAlgorithm”：默认为“ http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p”<br clear="none">“ keyIdentifierType”：默认为“ X509_KEY”，也支持“ X509_ISSUER_SERIAL”-在不应嵌入整个x509Certificate时很有用</p><h2 id="JAX-RSXMLSecurity-GCMAlgorithmandBouncyCastleprovider">GCM算法和BouncyCastle提供程序</h2><p>请参阅Colm的<a shape="rect" class="external-link" href="http://coheigea.blogspot.com/2012/04/note-on-cve-2011-1096.html" rel="nofollow">博客</a> ，以获取有关可能对XML加密和GCM算法进行攻击以防止这种攻击的信息。</p><h1 id="JAX-RSXMLSecurity-Restrictingencryptionandsignaturealgorithms">限制加密和签名算法</h1><p><strong>从CXF 2.6.1和2.5.4：</strong></p><p>可以使用限制客户端可以使用的加密和签名算法的属性来配置in加密和签名处理程序，例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">    &lt;bean id="sigProps" class="org.apache.cxf.rs.security.xml.SignatureProperties"&gt;
       &lt;property name="signatureAlgo" 
                 value="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/&gt;
       &lt;property name="signatureDigestAlgo" 
                 value="http://www.w3.org/2000/09/xmldsig#sha1"/&gt;
       &lt;property name="signatureC14Method" 
                 value="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/&gt;
       &lt;property name="signatureC14Transform" 
                 value="http://www.w3.org/2001/10/xml-exc-c14n#"/&gt;                                                  
    &lt;/bean&gt;
    
    &lt;bean id="encProps" class="org.apache.cxf.rs.security.xml.EncryptionProperties"&gt;
       &lt;property name="encryptionKeyTransportAlgo" 
                 value="http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p"/&gt;
       &lt;property name="encryptionSymmetricKeyAlgo" 
                 value="http://www.w3.org/2001/04/xmlenc#aes128-cbc"/&gt;
    &lt;/bean&gt;
    
    &lt;bean id="xmlSigInHandlerWithProps" class="org.apache.cxf.rs.security.xml.XmlSigInHandler"&gt;
        &lt;property name="signatureProperties" ref="sigProps"/&gt;
    &lt;/bean&gt;
        
    &lt;bean id="xmlEncInHandlerWithProps" class="org.apache.cxf.rs.security.xml.XmlEncInHandler"&gt;
        &lt;property name="encryptionProperties" ref="encProps"/&gt;
    &lt;/bean&gt;

    &lt;!-- the following ensures that the outbound handlers will use the same algorithms that the client used --&gt;  
    &lt;bean id="xmlSigOutHandlerWithProps" class="org.apache.cxf.rs.security.xml.XmlSigOutInterceptor"&gt;
        &lt;property name="signatureProperties" ref="sigProps"/&gt;
    &lt;/bean&gt;
        
    &lt;bean id="xmlEncOutHandlerWithProps" class="org.apache.cxf.rs.security.xml.XmlEncOutInterceptor"&gt;
        &lt;property name="encryptionProperties" ref="encProps"/&gt;
    &lt;/bean&gt;
</pre>
</div></div><p>使用出站处理程序注册相同的SignatureProperties和EncryptionProperties Bean（具有“ sigProps”和“ encProps” ID），将确保当前客户端使用的算法不仅已在入站侧进行了验证，而且还在出站侧进行了验证加密和签名数据。</p><p>请注意，从CXF 2.7.1、2.6.4和2.5.7开始，XmlEncInHandler将默认要求将RSA-OAEP算法用作密钥传输加密算法。由于XmlEncOutInterceptor默认使用此算法，因此无需任何操作，除非您在出站侧指定其他算法。在这种情况下，需要使用所需的密钥传输算法在XmlEncInHandler上配置EncryptionProperties对象。</p><h1 id="JAX-RSXMLSecurity-Interoperability">互通性</h1><p>包含信封XML签名的有效负载是根据XML签名规范进行构造的，因此，任何能够处理信封签名并提取签名的有效负载的XML签名感知使用者都可以使用它。</p><p>封装签名也是如此，例如，签名的SAML断言始终包含封装签名。</p><p>CXF创建分离的XML签名的方式是实验性的，因此，目前需要在两端都需要CXF来创建和验证分离的签名。</p><p>当前的XML加密支持符合规范，因此有能力的非CXF使用者将能够解密有效负载。</p></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=27830245">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=27830245&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>