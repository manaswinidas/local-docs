<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - JAXRS Services Configuration">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script src='/resources/highlighter/scripts/shBrushXml.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-JAXRS服务配置</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="restful-services.html">RESTful服务</a> > <a href="jax-rs.html">JAX-RS</a> > <a href="jaxrs-services-configuration.html">JAXRS服务配置</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><form id="cse-search-box" enctype="application/x-www-form-urlencoded" method="get" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="搜索">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><p>  <span style="font-size:2em;font-weight:bold">JAX-RS：服务配置</span>


 </p><p><br clear="none"></p><p><style type="text/css">/*<![CDATA[*/
div.rbtoc1535644577944 {padding: 0px;}
div.rbtoc1535644577944 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1535644577944 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style></p><div class="toc-macro rbtoc1535644577944">
<ul class="toc-indentation"><li><a shape="rect" href="#JAXRSServicesConfiguration-ConfiguringJAX-RSservicesprogrammatically">以编程方式配置JAX-RS服务</a></li><li><a shape="rect" href="#JAXRSServicesConfiguration-OSGI">OSGI</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAXRSServicesConfiguration-Blueprint">蓝图</a></li><li><a shape="rect" href="#JAXRSServicesConfiguration-Spring">弹簧</a></li></ul>
</li><li><a shape="rect" href="#JAXRSServicesConfiguration-SpringBoot">春季靴</a></li><li><a shape="rect" href="#JAXRSServicesConfiguration-ConfiguringJAX-RSendpointsprogrammaticallywithoutSpring">在没有Spring的情况下以编程方式配置JAX-RS端点</a></li><li><a shape="rect" href="#JAXRSServicesConfiguration-BlueprintWeb">蓝图网</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAXRSServicesConfiguration-Mavendependencies">Maven依赖</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAXRSServicesConfiguration-OSGI.1">OSGI</a></li><li><a shape="rect" href="#JAXRSServicesConfiguration-ServletContainer">Servlet容器</a></li></ul>
</li><li><a shape="rect" href="#JAXRSServicesConfiguration-Commonexample">常见的例子</a></li></ul>
</li><li><a shape="rect" href="#JAXRSServicesConfiguration-ConfiguringJAX-RSservicesincontainerwithSpringconfigurationfile.">使用Spring配置文件在容器中配置JAX-RS服务。</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAXRSServicesConfiguration-web.xml">web.xml</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAXRSServicesConfiguration-UsingSpringContextLoaderListener">使用Spring ContextLoaderListener</a></li><li><a shape="rect" href="#JAXRSServicesConfiguration-UsingCXFServletinitparameters">使用CXFServlet初始化参数</a></li></ul>
</li><li><a shape="rect" href="#JAXRSServicesConfiguration-beans.xml">beans.xml</a></li></ul>
</li><li><a shape="rect" href="#JAXRSServicesConfiguration-ConfiguringJAX-RSservicesusingexplicitbeanconfiguration">使用显式bean配置来配置JAX-RS服务</a></li><li><a shape="rect" href="#JAXRSServicesConfiguration-SpringAOP">春季AOP</a></li><li><a shape="rect" href="#JAXRSServicesConfiguration-ConfiguringJAX-RSservicesincontainerwithoutSpring">在没有Spring的容器中配置JAX-RS服务</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAXRSServicesConfiguration-AttachingJAXRSendpointstoanexistingJettyserver">将JAXRS端点附加到现有的Jetty服务器</a></li></ul>
</li><li><a shape="rect" href="#JAXRSServicesConfiguration-JAX-RSRuntimeDelegateandApplications">JAX-RS RuntimeDelegate和应用程序</a></li><li><a shape="rect" href="#JAXRSServicesConfiguration-ConfiguringJAX-RSservicesprogrammaticallywithSpringconfigurationfile.">使用Spring配置文件以编程方式配置JAX-RS服务。</a></li><li><a shape="rect" href="#JAXRSServicesConfiguration-Lifecyclemanagement">生命周期管理</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAXRSServicesConfiguration-FromSpring">从春天开始</a></li><li><a shape="rect" href="#JAXRSServicesConfiguration-WithCXFNonSpringJaxrsServlet">使用CXFNonSpringJaxrsServlet</a></li><li><a shape="rect" href="#JAXRSServicesConfiguration-Programmatically">以编程方式</a></li><li><a shape="rect" href="#JAXRSServicesConfiguration-PostConstructandPreDestroy">构造后和销毁前</a></li></ul>
</li><li><a shape="rect" href="#JAXRSServicesConfiguration-Locatingcustomresourcesinwebapplications">在Web应用程序中查找自定义资源</a></li><li><a shape="rect" href="#JAXRSServicesConfiguration-Multipleendpointsandresourceclasses">多个端点和资源类</a></li><li><a shape="rect" href="#JAXRSServicesConfiguration-Sharingprovidersbetweenmultipleendpoints">在多个端点之间共享提供商</a></li><li><a shape="rect" href="#JAXRSServicesConfiguration-DynamicservletsandasingleJAX-RSendpoint">动态servlet和单个JAX-RS端点</a></li><li><a shape="rect" href="#JAXRSServicesConfiguration-Auto-discoveryofrootresourcesandproviders">自动发现根资源和提供者</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAXRSServicesConfiguration-Spring.1">弹簧</a></li></ul>
</li><li><a shape="rect" href="#JAXRSServicesConfiguration-ServletandApplicationContainerConfiguration">Servlet和应用程序容器配置</a></li></ul>
</div><h1 id="JAXRSServicesConfiguration-ConfiguringJAX-RSservicesprogrammatically">以编程方式配置JAX-RS服务</h1><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">import org.apache.cxf.jaxrs.JAXRSServerFactoryBean;
...

JAXRSServerFactoryBean sf = new JAXRSServerFactoryBean();
sf.setResourceClasses(CustomerService.class);
sf.setAddress("http://localhost:9000/");
sf.create();
</pre>
</div></div><p>注意事项：</p><ul><li>JAXRSServerFactoryBean在CXF内部创建一个服务器，该服务器开始侦听指定URL上的请求。</li><li>检查<a shape="rect" href="http://cxf.apache.org/javadoc/latest/org/apache/cxf/jaxrs/JAXRSServerFactoryBean.html">JAXRSServerFactoryBean API</a>中是否有添加多个根资源的方法。</li><li>setResourceClasses（）仅用于根资源，对于@Provider注释的类，请使用setProvider（）或setProviders（）。</li><li><p>默认情况下，JAX-RS运行时负责资源类的生命周期，默认生命周期是每个请求的生命周期。您可以使用以下行将生命周期设置为单例：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">sf.setResourceProvider(BookStore.class, new SingletonResourceProvider(new BookStore()));
</pre>
</div></div></li><li><p>如果您不想让JAX-RS运行时为您处理资源类生命周期（例如，可能是您的资源类是由其他容器（例如Spring）创建的，则可以执行以下操作：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">JAXRSServerFactoryBean sf = new JAXRSServerFactoryBean();
CustomerService cs = new CustomerService();
sf.setServiceBeans(cs);
sf.setAddress("http://localhost:9080/");
sf.create();
</pre>
</div></div></li></ul><h1 id="JAXRSServicesConfiguration-OSGI">OSGI</h1><h2 id="JAXRSServicesConfiguration-Blueprint">蓝图</h2><p>以下示例显示了如何在支持Blueprint的OSGI容器中配置JAX-RS端点：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:jaxrs="http://cxf.apache.org/blueprint/jaxrs"
           xmlns:cxf="http://cxf.apache.org/blueprint/core"
           xsi:schemaLocation="
             http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
             http://cxf.apache.org/blueprint/jaxrs http://cxf.apache.org/schemas/blueprint/jaxrs.xsd
             http://cxf.apache.org/blueprint/core http://cxf.apache.org/schemas/blueprint/core.xsd
             "&gt;

    &lt;cxf:bus&gt;
        &lt;cxf:features&gt;
            &lt;cxf:logging/&gt;
        &lt;/cxf:features&gt;
    &lt;/cxf:bus&gt;

     &lt;jaxrs:server id="customerService" address="/customers"&gt;
        &lt;jaxrs:serviceBeans&gt;
           &lt;ref component-id="serviceBean" /&gt;
        &lt;/jaxrs:serviceBeans&gt;
     &lt;/jaxrs:server&gt;

     &lt;bean id="serviceBean" class="service.CustomerService"/&gt;
&lt;/blueprint&gt;
</pre>
</div></div><h2 id="JAXRSServicesConfiguration-Spring">弹簧</h2><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:jaxrs="http://cxf.apache.org/jaxrs"
      xsi:schemaLocation="
         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
         http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd"&gt;

     &lt;jaxrs:server id="customerService" address="/customers"&gt;
        &lt;jaxrs:serviceBeans&gt;
           &lt;ref bean="serviceBean"/&gt;
        &lt;/jaxrs:serviceBeans&gt;
     &lt;/jaxrs:server&gt;
      
     &lt;bean id="serviceBean" class="service.CustomerService"/&gt; 
&lt;/beans&gt;

</pre>
</div></div><h1 id="JAXRSServicesConfiguration-SpringBoot">春季靴</h1><p>请参阅CXF <a shape="rect" href="http://cxf.apache.org/docs/springboot.html#SpringBoot-SpringBootCXFJAX-RSStarter">SpringBoot</a>文档。</p><p>请参阅<a shape="rect" class="external-link" href="https://github.com/apache/cxf/tree/master/distribution/src/main/release/samples/jax_rs/spring_boot" rel="nofollow">JAX-RS Spring Boot</a>和<a shape="rect" class="external-link" href="https://github.com/apache/cxf/tree/master/distribution/src/main/release/samples/jax_rs/spring_boot_scan/application" rel="nofollow">JAX-RS Spring Boot Scan</a>演示。</p><p>请参阅<a shape="rect" href="jaxrsclientspringboot.html">JAXRSClientSpringBoot</a>文档，了解如何在SpringBoot应用程序中使用CXF <a shape="rect" href="jax-rs-client-api.html">JAX-RS客户端</a> 。</p><p> </p><h1 id="JAXRSServicesConfiguration-ConfiguringJAX-RSendpointsprogrammaticallywithoutSpring">在没有Spring的情况下以编程方式配置JAX-RS端点</h1><p>请注意，即使上一节中未明确使用Spring，默认情况下仍会使用它来向总线注册各种CXF组件，例如运输工厂。如果类路径上没有可用的Spring库，请遵循以下示例：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">JAXRSServerFactoryBean sf = new JAXRSServerFactoryBean();
sf.setResourceClasses(CustomerService.class);
sf.setResourceProvider(CustomerService.class, new SingletonResourceProvider(new CustomerService()));
sf.setAddress("http://localhost:9000/");
BindingFactoryManager manager = sf.getBus().getExtension(BindingFactoryManager.class);
JAXRSBindingFactory factory = new JAXRSBindingFactory();
factory.setBus(sf.getBus());
manager.registerBindingFactory(JAXRSBindingFactory.JAXRS_BINDING_ID, factory);
sf.create();
</pre>
</div></div><h1 id="JAXRSServicesConfiguration-BlueprintWeb">蓝图网</h1><p>本节描述如何使用CXFBlueprintServlet和Blueprint上下文引导CXF JAX-RS端点。</p><p>建议将这种方法推荐给构建CXF JAX-RS终结点的开发人员，该终结点将部署在OSGI中，并且将执行基于RequestDispatcher的转发。</p><p>另外，它允许在OSGI和非OSGI部署之间重用相同的Blueprint上下文。</p><p>以下两个选项均适用于CXF 3.1.3：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt;
  &lt;artifactId&gt;cxf-rt-frontend-jaxrs&lt;/artifactId&gt;
  &lt;version&gt;3.1.3&lt;/version&gt;
&lt;/dependency&gt;
</pre>
</div></div><p> </p><h2 id="JAXRSServicesConfiguration-Mavendependencies">Maven依赖</h2><h3 id="JAXRSServicesConfiguration-OSGI.1">OSGI</h3><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.aries.blueprint&lt;/groupId&gt;
  &lt;artifactId&gt;org.apache.aries.blueprint.webosgi&lt;/artifactId&gt;
  &lt;version&gt;1.0.1&lt;/version&gt;
&lt;/dependency&gt;
</pre>
</div></div><p>在OSGI（Karaf）中，还应该安装“战争”功能。</p><h3 id="JAXRSServicesConfiguration-ServletContainer">Servlet容器</h3><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.aries.blueprint&lt;/groupId&gt;
  &lt;artifactId&gt;org.apache.aries.blueprint.web&lt;/artifactId&gt;
  &lt;version&gt;1.1.1&lt;/version&gt;
&lt;/dependency&gt;
</pre>
</div></div><p> </p><h2 id="JAXRSServicesConfiguration-Commonexample">常见的例子</h2><p> </p><p>此<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/systests/jaxrs/src/test/resources/jaxrs_soap_blueprint/WEB-INF/web.xml" rel="nofollow">web.xml</a>显示如何设置CXFBlueprintServlet来处理<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/systests/jaxrs/src/test/resources/jaxrs_soap_blueprint/WEB-INF/beans.xml" rel="nofollow">此Blueprint上下文。</a> 它在OSGI和非OSGI环境中的工作方式完全相同。</p><h1 id="JAXRSServicesConfiguration-ConfiguringJAX-RSservicesincontainerwithSpringconfigurationfile.">使用Spring配置文件在容器中配置JAX-RS服务。</h1><h2 id="JAXRSServicesConfiguration-web.xml">web.xml</h2><p>在web.xml中，需要注册一个或多个CXFServlet并链接到应用程序上下文配置。</p><h3 id="JAXRSServicesConfiguration-UsingSpringContextLoaderListener">使用Spring ContextLoaderListener</h3><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;

&lt;!DOCTYPE web-app
    PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
    "http://java.sun.com/dtd/web-app_2_3.dtd"&gt;
&lt;web-app&gt;
	&lt;context-param&gt;
		&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
		&lt;param-value&gt;WEB-INF/beans.xml&lt;/param-value&gt;
	&lt;/context-param&gt;

	&lt;listener&gt;
		&lt;listener-class&gt;
			org.springframework.web.context.ContextLoaderListener
		&lt;/listener-class&gt;
	&lt;/listener&gt;

	&lt;servlet&gt;
		&lt;servlet-name&gt;CXFServlet&lt;/servlet-name&gt;
		&lt;display-name&gt;CXF Servlet&lt;/display-name&gt;
		&lt;servlet-class&gt;
			org.apache.cxf.transport.servlet.CXFServlet
		&lt;/servlet-class&gt;
		&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
	&lt;/servlet&gt;

	&lt;servlet-mapping&gt;
		&lt;servlet-name&gt;CXFServlet&lt;/servlet-name&gt;
		&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
	&lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</pre>
</div></div><p>在所有CXFServlet之间共享应用程序上下文配置</p><h3 id="JAXRSServicesConfiguration-UsingCXFServletinitparameters">使用CXFServlet初始化参数</h3><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;

&lt;!DOCTYPE web-app
    PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
    "http://java.sun.com/dtd/web-app_2_3.dtd"&gt;
&lt;web-app&gt;
	&lt;servlet&gt;
		&lt;servlet-name&gt;CXFServlet1&lt;/servlet-name&gt;
		&lt;display-name&gt;CXF Servlet1&lt;/display-name&gt;
		&lt;servlet-class&gt;
			org.apache.cxf.transport.servlet.CXFServlet
		&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;config-location&lt;/param-name&gt;
            &lt;param-value&gt;/WEB-INF/beans1.xml&lt;/param-value&gt;
        &lt;/init-param&gt;
		&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
	&lt;/servlet&gt;

    &lt;servlet&gt;
		&lt;servlet-name&gt;CXFServlet2&lt;/servlet-name&gt;
		&lt;display-name&gt;CXF Servlet2&lt;/display-name&gt;
		&lt;servlet-class&gt;
			org.apache.cxf.transport.servlet.CXFServlet
		&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;config-location&lt;/param-name&gt;
            &lt;param-value&gt;/WEB-INF/beans2.xml&lt;/param-value&gt;
        &lt;/init-param&gt;
		&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
	&lt;/servlet&gt;

	&lt;servlet-mapping&gt;
		&lt;servlet-name&gt;CXFServlet1&lt;/servlet-name&gt;
		&lt;url-pattern&gt;/1/*&lt;/url-pattern&gt;
	&lt;/servlet-mapping&gt;

    &lt;servlet-mapping&gt;
		&lt;servlet-name&gt;CXFServlet2&lt;/servlet-name&gt;
		&lt;url-pattern&gt;/2/*&lt;/url-pattern&gt;
	&lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</pre>
</div></div><p>每个CXFServlet都可以获得唯一的应用程序上下文配置。注意，在这种情况下，不会在web.xml中注册任何Spring ContextLoaderListener。</p><h2 id="JAXRSServicesConfiguration-beans.xml">beans.xml</h2><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:jaxrs="http://cxf.apache.org/jaxrs"
  xsi:schemaLocation="
http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans.xsd
http://cxf.apache.org/jaxrs
http://cxf.apache.org/schemas/jaxrs.xsd"&gt;

  &lt;!-- do not use import statements if CXFServlet init parameters link to this beans.xml --&gt; 

  &lt;import resource="classpath:META-INF/cxf/cxf.xml" /&gt;
  &lt;import resource="classpath:META-INF/cxf/cxf-servlet.xml" /&gt;

  &lt;jaxrs:server id="customerService" address="/service1"&gt;
    &lt;jaxrs:serviceBeans&gt;
      &lt;ref bean="customerBean" /&gt;
    &lt;/jaxrs:serviceBeans&gt;
  &lt;/jaxrs:server&gt;

  &lt;bean id="customerBean" class="demo.jaxrs.server.CustomerService" /&gt;
&lt;/beans&gt;
</pre>
</div></div><p>在以上配置中，所有资源都将配置为单例，有关创建按请求资源的信息，请参见<a shape="rect" href="jaxrs-services-configuration.html">下文</a> 。</p><h1 id="JAXRSServicesConfiguration-ConfiguringJAX-RSservicesusingexplicitbeanconfiguration">使用显式bean配置来配置JAX-RS服务</h1><p>请注意，jaxrs：server（和jaxrs：client）声明取决于'http://cxf.apache.org/jaxrs'的Spring NamespaceHandler，可在类路径上使用。有时，由于类加载限制或复杂部署期间暴露的底层容器中的错误，或者由于多个Spring库相互干扰，因此无法找到NamespaceHandler，因此无法创建jaxrs端点。<br clear="none">请向开发容器本身的团队报告此类问题。</p><p>如果您需要进行Spring配置并遇到与缺少的NamespaceHandler有关的错误，那么作为一种解决方法，请考虑使用实际上处理jaxrs：server端点创建的CXF bean配置jaxrs端点。这稍微复杂一点，但是总的来说，配置最终变得非常相似，例如，上述jaxrs：server端点可以这样配置：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="
http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

  &lt;import resource="classpath:META-INF/cxf/cxf.xml" /&gt;
  &lt;import resource="classpath:META-INF/cxf/cxf-servlet.xml" /&gt;

  &lt;bean class="org.apache.cxf.jaxrs.JAXRSServerFactoryBean" init-method="create"&gt;
    &lt;property name="address" value="/service1"/&gt;
    &lt;property name="serviceBeans"&gt;
      &lt;ref bean="customerBean" /&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="customerBean" class="demo.jaxrs.server.CustomerService" /&gt;
&lt;/beans&gt;

</pre>
</div></div><h1 id="JAXRSServicesConfiguration-SpringAOP">春季AOP</h1><p>CXF JAX-RS能够与应用于Spring的资源类的AOP拦截器一起使用。<br clear="none">例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;beans xmlns:jaxrs="http://cxf.apache.org/jaxrs" xmlns:aop="http://www.springframework.org/schema/aop" 
  xsi:schemaLocation=" http://www.springframework.org/schema/beans
  http://www.springframework.org/schema/beans/spring-beans.xsd
  http://www.springframework.org/schema/aop  
  http://www.springframework.org/schema/aop/spring-aop.xsd 
  http://cxf.apache.org/jaxrs 
  http://cxf.apache.org/schemas/jaxrs.xsd"&gt;
  &lt;import resource="classpath:META-INF/cxf/cxf.xml"/&gt;
  &lt;import resource="classpath:META-INF/cxf/cxf-extension-jaxrs-binding.xml"/&gt;
  &lt;import resource="classpath:META-INF/cxf/cxf-servlet.xml"/&gt;

  &lt;jaxrs:server id="bookservice" address="/"&gt;
	&lt;jaxrs:serviceBeans&gt;
          &lt;ref bean="bookstore"/&gt;
          &lt;ref bean="bookstoreInterface"/&gt;
        &lt;/jaxrs:serviceBeans&gt;
   &lt;/jaxrs:server&gt;
   &lt;bean id="bookstore" class="org.apache.cxf.systest.jaxrs.BookStore"/&gt;
   &lt;bean id="bookstoreInterface" class="org.apache.cxf.systest.jaxrs.BookStoreWithInterface"/&gt;

   &lt;aop:config&gt;
	&lt;aop:aspect id="loggingAspect" ref="simpleLogger"&gt;
          &lt;aop:before method="logBefore" 
              pointcut="execution(* org.apache.cxf.systest.jaxrs.BookStore*.*(..))"/&gt;
          &lt;aop:after-returning method="logAfter" 
              pointcut="execution(* org.apache.cxf.systest.jaxrs.BookStore*.*(..))"/&gt;
        &lt;/aop:aspect&gt;
   &lt;/aop:config&gt;
   &lt;bean id="simpleLogger" 
         class="org.apache.cxf.systest.jaxrs.SimpleLoggingAspect"/&gt;
&lt;/beans&gt;

</pre>
</div></div><p>注意，一些AOP配置应用于两个JAX-RS资源类。默认情况下，如果要被代理的类至少实现一个接口或CGLIB代理，则Spring使用JDK动态代理。</p><p>例如，这是org.apache.cxf.systest.jaxrs的方式。BookStoreWithInterface看起来像：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">public interface BookInterface {
    @GET
    @Path("/thosebooks/{bookId}/")
    @Produces("application/xml")
    Book getThatBook(Long id) throws BookNotFoundFault;
}

public class BookStoreWithInterface extends BookStoreStorage 
    implements BookInterface {

    public Book getThatBook(@PathParam("bookId") Long id) 
        throws BookNotFoundFault {
        return doGetBook(id);
    }

    @Path("/thebook")
    public Book getTheBook(@PathParam("bookId") Long id) 
        throws BookNotFoundFault {
        return doGetBook(id);
    }
}
</pre>
</div></div><p>在这种情况下，Spring将使用JDK动态代理包装BookStoreWithInterface类。同样重要的是，需要调用的方法（如getThatBook（...））将成为接口的一部分。</p><p>另一种方法getTheBook（）不能由JAX-RS运行时调度，因为无法通过JDK代理发现它。如果还需要调用此方法，则应将该方法添加到接口中，或者必须显式启用CGLIB代理（有关更多详细信息，请参阅Spring AOP文档）。例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;aop:config proxy-target-class="true"/&gt;
</pre>
</div></div><h1 id="JAXRSServicesConfiguration-ConfiguringJAX-RSservicesincontainerwithoutSpring">在没有Spring的容器中配置JAX-RS服务</h1><p>如果愿意，可以借助CXFNonSpringJaxrsServlet而不依赖Spring来注册JAX-RS端点：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;servlet&gt;
 &lt;servlet-name&gt;CXFServlet&lt;/servlet-name&gt;
 &lt;display-name&gt;CXF Servlet&lt;/display-name&gt;
 &lt;servlet-class&gt;
   org.apache.cxf.jaxrs.servlet.CXFNonSpringJaxrsServlet
 &lt;/servlet-class&gt;
 &lt;init-param&gt;
  &lt;param-name&gt;jaxrs.serviceClasses&lt;/param-name&gt;
  &lt;param-value&gt;
    org.apache.cxf.systest.jaxrs.BookStore1,
    org.apache.cxf.systest.jaxrs.BookStore2		      
  &lt;/param-value&gt;
 &lt;/init-param&gt;
 &lt;init-param&gt;
  &lt;param-name&gt;jaxrs.providers&lt;/param-name&gt;
  &lt;param-value&gt;
    org.apache.cxf.systest.jaxrs.BookStoreProvider1,
    org.apache.cxf.systest.jaxrs.BookStoreProvider2		      
  &lt;/param-value&gt;
 &lt;/init-param&gt;
 &lt;!-- enables schema validation --&gt;
 &lt;init-param&gt;
  &lt;param-name&gt;jaxrs.schemaLocations&lt;/param-name&gt;
  &lt;param-value&gt;
    classpath:/WEB-INF/schemas/schema1.xsd
    classpath:/WEB-INF/schemas/schema2.xsd		      
  &lt;/param-value&gt;
 &lt;/init-param&gt; 
 &lt;!-- registers CXF in interceptors --&gt;
 &lt;init-param&gt;
  &lt;param-name&gt;jaxrs.inInterceptors&lt;/param-name&gt;
  &lt;param-value&gt;
    org.apache.cxf.systest.jaxrs.CustomInInterceptor
  &lt;/param-value&gt;
 &lt;/init-param&gt; 
 &lt;!-- registers CXF out interceptors --&gt;
 &lt;init-param&gt;
  &lt;param-name&gt;jaxrs.outInterceptors&lt;/param-name&gt;
  &lt;param-value&gt;
    org.apache.cxf.systest.jaxrs.CustomOutInterceptor
  &lt;/param-value&gt;
 &lt;/init-param&gt;
 &lt;!-- registers extension mappings --&gt;
 &lt;init-param&gt;
  &lt;param-name&gt;jaxrs.extensions&lt;/param-name&gt;
  &lt;param-value&gt;
    xml=application/xml
    json=application/json
  &lt;/param-value&gt;
 &lt;/init-param&gt;
 &lt;!-- registers contextual properties --&gt;
 &lt;init-param&gt;
  &lt;param-name&gt;jaxrs.properties&lt;/param-name&gt;
  &lt;param-value&gt;
    property1=value
    property2=value
  &lt;/param-value&gt;
 &lt;/init-param&gt;
&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
</pre>
</div></div><p>以这种方式注册服务类和提供者时，默认生命周期为“单人”。您可以通过将“ jaxrs.scope”参数设置为“ prototype”（相当于每个请求）的值来覆盖它。<br clear="none">默认情况下，端点地址为“ /”。可以使用“ jaxrs.address”参数提供更具体的值。</p><p>请注意，多个服务或提供程序类名称用逗号分隔。用户可能希望在以下情况下使用值为“ space”的“ class.parameter.split.char” servlet参数。</p><p>从旧的CXF版本迁移过来的是，该空间用于分隔多个类名。</p><p>如果所引用的服务类未使用JAX-RS注释进行注释，则外部用户模型也可以链接到：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;servlet&gt;
 &lt;servlet-name&gt;CXFServlet&lt;/servlet-name&gt;
 &lt;display-name&gt;CXF Servlet&lt;/display-name&gt;
 &lt;servlet-class&gt;
   org.apache.cxf.jaxrs.servlet.CXFNonSpringJaxrsServlet
 &lt;/servlet-class&gt;
 &lt;init-param&gt;
  &lt;param-name&gt;jaxrs.serviceClasses&lt;/param-name&gt;
  &lt;param-value&gt;
    org.apache.cxf.systest.jaxrs.BookStore
  &lt;/param-value&gt;
 &lt;/init-param&gt;
 &lt;!-- link to the user model --&gt;
 &lt;init-param&gt;
  &lt;param-name&gt;user.model&lt;/param-name&gt;
  &lt;param-value&gt;
    classpath:/models/resources.xml
  &lt;/param-value&gt;
 &lt;/init-param&gt; 
 &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
</pre>
</div></div><p>使用CXFNonSpringJaxrsServlet注册资源类和提供程序的更可移植的方法是使用JAX-RS Application <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/BookApplication.java">实现</a> ：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;servlet&gt;
 &lt;servlet-name&gt;CXFServlet&lt;/servlet-name&gt;
 &lt;display-name&gt;CXF Servlet&lt;/display-name&gt;
 &lt;servlet-class&gt;
   org.apache.cxf.jaxrs.servlet.CXFNonSpringJaxrsServlet
 &lt;/servlet-class&gt;
 &lt;init-param&gt;
  &lt;param-name&gt;javax.ws.rs.Application&lt;/param-name&gt;
  &lt;param-value&gt;
    org.apache.cxf.systest.jaxrs.BookApplication	      
  &lt;/param-value&gt;
 &lt;/init-param&gt;
 &lt;!-- 
    This parameter is recognized only starting from CXF 2.3.1
    @ApplicationPath value will be ignored if this parameter is set to true
 --&gt;
 &lt;init-param&gt;
  &lt;param-name&gt;jaxrs.application.address.ignore&lt;/param-name&gt;
  &lt;param-value&gt;true&lt;/param-value&gt;
 &lt;/init-param&gt;
&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
</pre>
</div></div><p>请注意，Application.getClasses（）方法返回一组每个请求的资源类名称。Application.getSingletons（）返回单例资源和提供程序类的列表。</p><p>从CXF 2.3.7 / 2.4.3 / 2.5.0开始，可以简化资源和应用程序类，提供程序和拦截器的属性：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;servlet&gt;
 &lt;servlet-name&gt;CXFServlet&lt;/servlet-name&gt;
 &lt;display-name&gt;CXF Servlet&lt;/display-name&gt;
 &lt;servlet-class&gt;
   org.apache.cxf.jaxrs.servlet.CXFNonSpringJaxrsServlet
 &lt;/servlet-class&gt;
 &lt;init-param&gt;
  &lt;param-name&gt;javax.ws.rs.Application&lt;/param-name&gt;
  &lt;param-value&gt;
    org.apache.cxf.systest.jaxrs.BookApplication
    (name=1 id=2)	      
  &lt;/param-value&gt;
 &lt;/init-param&gt;
 &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
</pre>
</div></div><p>在上面的示例中，为org.apache.cxf.systest.jaxrs。BookApplication应该具有setName和setId设置程序，并且具有单个基本类型或List参数类型。</p><p><strong>请注意</strong> ，从web.xml引用了web-app_2_3.dtd DTD可能会阻止'param-value'包含空格，并使得很难像这样指定多个提供程序：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default"> &lt;init-param&gt;
  &lt;param-name&gt;jaxrs.providers&lt;/param-name&gt;
  &lt;param-value&gt;
    mypackage.Provider1 
    mypackage.Provider2	      
  &lt;/param-value&gt;
 &lt;/init-param&gt;
 &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
</pre>
</div></div><p>在这种情况下，请考虑移至Web-app 2.5模式或扩展CXFNonSpringJaxrsProviders或引入一个Application。</p><h2 id="JAXRSServicesConfiguration-AttachingJAXRSendpointstoanexistingJettyserver">将JAXRS端点附加到现有的Jetty服务器</h2><p>这是一个代码片段，显示了如何借助CxfNonSpringJaxrsServlet来完成：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">CXFNonSpringJAXRSServlet cxf = new CXFNonSpringJaxrsServlet();

...

ServletHolder servlet = new ServletHolder(cxf);
servlet.setInitParameter("javax.ws.rs.Application", "com.acme.MyServiceImpl");
servlet.setName("services");
servlet.setForcedPath("services");
root.addServlet(servlet, "/*");

</pre>
</div></div><h1 id="JAXRSServicesConfiguration-JAX-RSRuntimeDelegateandApplications">JAX-RS RuntimeDelegate和应用程序</h1><p>如果您有可用的JAX-RS应用程序实现，并且希望最大程度地减少与CXF JAX-RS特定API的交互，则可能要使用JAX-RS RuntimeDelegate：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">import javax.ws.rs.ext.RuntimeDelegate;
import org.apache.cxf.endpoint.Server;
import org.apache.cxf.jaxrs.JAXRSServerFactoryBean;

RuntimeDelegate delegate = RuntimeDelegate.getInstance();
JAXRSServerFactoryBean bean = delegate.createEndpoint(new CustomApplication(), JAXRSServerFactoryBean.class);

// before CXF 2.3.1 :
// bean.setAddress("http://localhost:8080/services");

bean.setAddress("http://localhost:8080/services" + bean.getAddress());

Server server = bean.create();
server.start();
// and finally
server.stop();

</pre>
</div></div><p>请注意，上面的代码确保将@ApplicationPath值（如果CustomApplication具有此批注）考虑在内。</p><h1 id="JAXRSServicesConfiguration-ConfiguringJAX-RSservicesprogrammaticallywithSpringconfigurationfile.">使用Spring配置文件以编程方式配置JAX-RS服务。</h1><p>在代码中显式使用Spring时，您可能需要遵循以下示例：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">ClassPathXmlApplicationContext ctx = new ClassPathXmlApplicationContext(new String[]
                      {"/org/apache/cxf/jaxrs/spring/servers.xml"});

// 'simple' is the id of the jaxrs server bean
JAXRSServerFactoryBean sfb = (JAXRSServerFactoryBean)ctx.getBean("simple");
sfb.create();
</pre>
</div></div><p>请注意，在这种情况下，您的Spring配置文件应导入cxf-extension-http-jetty.xml而不是cxf-servlet.xml：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;!--
&lt;import resource="classpath:META-INF/cxf/cxf-servlet.xml" /&gt;
--&gt;
&lt;import resource="classpath:META-INF/cxf/cxf-extension-http-jetty.xml" /&gt;
</pre>
</div></div><h1 id="JAXRSServicesConfiguration-Lifecyclemanagement">生命周期管理</h1><h2 id="JAXRSServicesConfiguration-FromSpring">从春天开始</h2><p>缺省情况下，运行时将直接从jaxrs：server端点声明中引用的服务bean视为单例JAX-RS根资源。例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;beans&gt;
  &lt;jaxrs:server id="customerService" address="/service1"&gt;
    &lt;jaxrs:serviceBeans&gt;
      &lt;ref bean="customerBean" /&gt;
    &lt;/jaxrs:serviceBeans&gt;
  &lt;/jaxrs:server&gt;
  &lt;!--
    The scope attribute, if any, will be ignored. For example, adding the scope attribute with the value
    "request", "prototype", etc, won't have any effect, the customerBean will still be treated as 
    a JAX-RS singleton by the runtime.
  --&gt; 
  &lt;bean id="customerBean" class="demo.jaxrs.server.CustomerService" /&gt;
&lt;/beans&gt;
</pre>
</div></div><p>Spring实例化并注入customerBean引用，然后运行时将直接访问该引用。实际上，在这种情况下， <strong>将</strong>忽略在customerBean bean声明中可能出现的scope属性， <strong>除非使用Spring AOP强制执行所需的范围</strong> （有关更多信息，请参见下文）。</p><p>'serviceFactories'元素或beanNames属性必须用于'prototype'，'request'和其他Spring bean作用域。</p><p>例如，serviceFactories元素可以引用一个或多个类型为'org.apache.cxf.jaxrs.spring的bean。SpringResourceFactory”，而后者又引用了实际的服务bean。</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;beans&gt;
  &lt;jaxrs:server id="customerService" address="/service1"&gt;
    &lt;jaxrs:serviceFactories&gt;
      &lt;ref bean="sfactory1" /&gt;
      &lt;ref bean="sfactory2" /&gt; 
    &lt;/jaxrs:serviceFactories&gt;
  &lt;/jaxrs:server&gt;
  
  &lt;bean id="sfactory1" class="org.apache.cxf.jaxrs.spring.SpringResourceFactory"&gt;
     &lt;property name="beanId" value="customerBean1"/&gt;
  &lt;/bean&gt;
  &lt;bean id="sfactory2" class="org.apache.cxf.jaxrs.spring.SpringResourceFactory"&gt;
     &lt;property name="beanId" value="customerBean2"/&gt;
  &lt;/bean&gt;

  &lt;bean id="customerBean1" class="demo.jaxrs.server.CustomerRootResource1" scope="prototype"/&gt; 
  &lt;bean id="customerBean2" class="demo.jaxrs.server.CustomerRootResource2"  scope="prototype"/&gt; 
&lt;/beans&gt;
</pre>
</div></div><p>在此示例中，jaxrs：server端点具有两个具有Spring'prototype'范围的JAX-RS根资源（customerBean1和customerBean2）。<br clear="none">也可以支持其他范围。</p><p>如果使用jaxrs：serviceFactories元素似乎有点冗长，则可以使用'beanNames'属性代替：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;beans&gt;
  &lt;jaxrs:server id="customerService" address="/service1"
    beanNames="customerBean1 customerBean2"/&gt;
  
  &lt;bean id="customerBean1" class="demo.jaxrs.server.CustomerRootResource1" scope="prototype"/&gt; 
  &lt;bean id="customerBean2" class="demo.jaxrs.server.CustomerRootResource2"  scope="prototype"/&gt; 
&lt;/beans&gt;
</pre>
</div></div><p>beanNames属性列出了服务bean的名称/标识，以空格分隔。用户注册自定义CXF JAX-RS <a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/lifecycle/ResourceProvider.java">ResourceProvider</a>实现时，必须使用jaxrs：serviceFactories元素。</p><p>在Spring中支持复杂范围的另一种方法是使用Spring AOP。例如，以下片段显示了如何支持Spring“请求”范围：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;beans
	xmlns="http://www.springframework.org/schema/beans"
	xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:jaxrs="http://cxf.apache.org/jaxrs"
	xmlns:cxf="http://cxf.apache.org/core"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/aop     http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
		http://cxf.apache.org/jaxrs                   http://cxf.apache.org/schemas/jaxrs.xsd
		http://cxf.apache.org/core                    http://cxf.apache.org/schemas/core.xsd"&gt;

	&lt;import resource="classpath:META-INF/cxf/cxf.xml"/&gt;
	&lt;import resource="classpath:META-INF/cxf/cxf-servlet.xml"/&gt;

	&lt;bean class="org.springframework.context.annotation.CommonAnnotationBeanPostProcessor"/&gt;

	&lt;jaxrs:server id="example" address="/"&gt;
       	    &lt;jaxrs:serviceBeans&gt;
   	        &lt;bean class="org.apache.cxf.systest.jaxrs.CustomerService" scope="request"&gt;&lt;aop:scoped-proxy /&gt;&lt;/bean&gt;
	    &lt;/jaxrs:serviceBeans&gt;
	&lt;/jaxrs:server&gt;
&lt;/beans&gt;
</pre>
</div></div><p>另外，必须将以下servlet侦听器添加到web.xml：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;listener&gt;
    &lt;listener-class&gt;org.springframework.web.context.request.RequestContextListener&lt;/listener-class&gt;
&lt;/listener&gt;
</pre>
</div></div><p>请求范围的服务Bean实例（例如org.apache.cxf.systest.jaxrs。CustomerService实例）在初始化时实际上并不可用，因此上述配置的一个局限性是不可能将JAX-RS上下文注入这些服务bean中。这不是一个障碍，因为可以将诸如UriInfo之类的上下文作为资源方法参数传入。但是，如果需要注入字段或通过方法设置器，则需要对org.apache.cxf.jaxrs.spring进行一些自定义。SpringResourceFactory可以解决问题。特别是，Spring ApplicationContext报告说，请求作用域的bean是单例的，但是考虑到实际实例不可用，JAX-RS运行时无法注入线程本地代理；如上所述。实际上，请求范围的bean并不是真正的JAX-RS单例。因此，一个简单的自定义工厂像<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/RequestScopeResourceFactory.java">这样一个</a>需要，它必须使用以下方法：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;beans&gt;
  &lt;jaxrs:server id="customerService" address="/service1"&gt;
    &lt;jaxrs:serviceFactories&gt;
       &lt;bean class="org.apache.cxf.systest.jaxrs.RequestScopeResourceFactory"&gt;
          &lt;property name="beanId" value="customerBean"/&gt;
       &lt;/bean&gt; 
    &lt;/jaxrs:serviceFactories&gt;
  &lt;/jaxrs:server&gt;
  
  &lt;bean id="customerBean" class="org.apache.cxf.systest.jaxrs.CustomerService" scope="request"&gt;&lt;aop:scoped-proxy /&gt;&lt;/bean&gt;
&lt;/beans&gt;
</pre>
</div></div><p>如果没有将customerBean bean视为JAX-RS单例，则上述配置可确保CXF JAX-RS运行时在请求时注入值。仅当需要注入上下文时才需要此方法。</p><h2 id="JAXRSServicesConfiguration-WithCXFNonSpringJaxrsServlet">使用CXFNonSpringJaxrsServlet</h2><p>CXFNonSpringJaxrsServlet使用“ Singleton”作为由“ jaxrs.serviceClasses” servlet参数指定的服务类的默认范围。可以通过将“ jaxrs.scope”参数设置为“ prototype”值或完全不使用“ jaxrs.serviceClasses”参数并注册一个JAXRS Application实现来覆盖它。请参阅描述CXFNonSpringJaxrsServlet的部分以获取更多详细信息。</p><p>CXFNonSpringJaxrsServlet可以为类的构造函数提供JAXRS上下文支持类的单例作用域，目前它只能注入ServletContext或ServletConfig上下文：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">@Path("/")
public class SingletonResourceClass {
   public SingletonResourceClass(@Context ServletContext context, @Context ServletConfig context2) {}
}
</pre>
</div></div><h2 id="JAXRSServicesConfiguration-Programmatically">以编程方式</h2><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">JAXRSServerFactoryBean sf = new JAXRSServerFactoryBean();
sf.setResourceClass(CustomerService.class);
sf.setResourceProvider(new SingletonResourceProvider(new CustomerService()));
sf.setResourceClass(CustomerService2.class);
sf.setResourceProvider(new PerRequestResourceProvider(CustomerService.class));
</pre>
</div></div><h2 id="JAXRSServicesConfiguration-PostConstructandPreDestroy">构造后和销毁前</h2><p>使用@PostConstruct和@PreDestroy批注进行批注的Bean方法将按范围规则预期的那样被调用。<br clear="none">创建端点时，单例bean将调用其postconstruct方法。如果某个给定的单例资源实例是由Spring创建的，则它的predestroy方法也将在例如将要卸载使用它的Web应用程序之后调用。目前，由CXFNonSpringJaxrsServlet或以编程方式创建的单例将仅调用其postconstruct方法（如果有）。</p><p>原型bean将在调用资源方法之前，调用返回之后，但实际上尚未序列化响应之前立即调用其postconstruct和predestroy方法。您可以通过添加“ org.apache.cxf.service.scope”来指示在请求完全超出范围之后（即，如果响应正文已写入输出流之后），则必须调用predestroy方法。 ”属性，其值设置为“ request”。</p><p>您还可以通过扩展org.apache.cxf.jaxrs.spring注册一个自定义的Spring资源工厂。还是提供SpringResourceFactory一个更复杂的实现。</p><h1 id="JAXRSServicesConfiguration-Locatingcustomresourcesinwebapplications">在Web应用程序中查找自定义资源</h1><p>通常使用classpath：前缀来引用诸如模式，自定义XSLT模板和用户模型之类的资源。因此，可以将它们添加到给定Web应用程序中的WEB-INF / classes文件夹中。<br clear="none">由于CXF 2.2.3可以将它们直接放在WEB-INF下，例如放入WEB-INF / xslt，WEB-INF / schemas，WEB-INF / model中，并像'classpath：/ WEB-INF / xslt / template一样引用它们.xsl'。</p><h1 id="JAXRSServicesConfiguration-Multipleendpointsandresourceclasses">多个端点和资源类</h1><p>可以根据给定应用程序的需要配置任意多个jaxrs：server端点，每个端点都可能提供指向单个资源bean的替代路径。每个端点可以根据需要使用任意数量的共享或唯一资源类，并具有公共或不同的提供程序。</p><h1 id="JAXRSServicesConfiguration-Sharingprovidersbetweenmultipleendpoints">在多个端点之间共享提供商</h1><p>在多个端点之间共享多个提供程序的一种方法是从jaxrs：provider部分中引用相同的提供程序bean：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;beans&gt;
  &lt;jaxrs:server id="customerService" address="/service1"&gt;
    &lt;jaxrs:serviceBeans&gt;
      &lt;bean class="org.apache.cxf.systest.jaxrs.CustomerService"/&gt;
    &lt;/jaxrs:serviceBeans&gt;
    &lt;jaxrs:providers&gt;
      &lt;bean ref="customProvider"/&gt;
    &lt;/jaxrs:providers&gt;

  &lt;/jaxrs:server&gt;

  &lt;jaxrs:server id="customerService" address="/service2"&gt;
    &lt;jaxrs:serviceBeans&gt;
      &lt;bean class="org.apache.cxf.systest.jaxrs.CustomerService2"/&gt;
    &lt;/jaxrs:serviceBeans&gt;
    &lt;jaxrs:providers&gt;
      &lt;bean ref="customProvider"/&gt;
    &lt;/jaxrs:providers&gt;
  &lt;/jaxrs:server&gt;
  
  &lt;bean id="customProvider" class="org.apache.cxf.systest.jaxrs.CustomerProvider"/&gt;
&lt;/beans&gt;

</pre>
</div></div><p>从CXF 2.7.2开始，可以在总线上直接将提供程序注册为总线属性，并使用此总线在所有提供程序之间共享它们：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;beans&gt;
  
  &lt;cxf:bus&gt;
        &lt;cxf:properties&gt;
            &lt;entry key="javax.ws.rs.ext.ExceptionMapper" value-ref="exceptionMapper"/&gt;
        &lt;/cxf:properties&gt;
  &lt;/cxf:bus

  &lt;bean id="exceptionMapper" class="org.apache.cxf.systest.jaxrs.RuntimeExceptionMapper"/&gt;

  &lt;jaxrs:server id="customerService" address="/service1"&gt;
    &lt;jaxrs:serviceBeans&gt;
      &lt;bean class="org.apache.cxf.systest.jaxrs.CustomerService"/&gt;
    &lt;/jaxrs:serviceBeans&gt;
  &lt;/jaxrs:server&gt;

  &lt;jaxrs:server id="customerService" address="/service2"&gt;
    &lt;jaxrs:serviceBeans&gt;
      &lt;bean class="org.apache.cxf.systest.jaxrs.CustomerService2"/&gt;
    &lt;/jaxrs:serviceBeans&gt;
  &lt;/jaxrs:server&gt;
  
  &lt;/beans&gt;
</pre>
</div></div><p>请注意，已使用接口名称“ javax.ws.rs.ext”注册了全局异常映射器。ExceptionMapper”，所有异常映射器都必须实现。</p><p>请注意，一次可以使用“ javax.ws.rs.ext”注册全局每总线提供程序。ExceptionMapper”，“ javax.ws.rs.ext。MessageBodyReader”或“ javax.ws.rs.ext”。带有已注册提供程序的MessageBodyWriter“总线属性，有望实现这些接口之一。</p><p>或者，可以使用“ org.apache.cxf.jaxrs.bus.providers”列表属性在总线上注册所有提供程序（特定于JAX-RS和CXF）：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;beans xmlns:util="http://www.springframework.org/schema/util"&gt;
  
  &lt;cxf:bus&gt;
        &lt;cxf:properties&gt;
            &lt;entry key="org.apache.cxf.jaxrs.bus.providers" value-ref="busProviders"/&gt;
        &lt;/cxf:properties&gt;
  &lt;/cxf:bus

  &lt;util:list id="busProviders"&gt;
    &lt;ref bean="exceptionMapper"/&gt;
    &lt;ref bean="customMessageBodyReader"/&gt;
    &lt;ref bean="customMessageBodyWriter"/&gt;
  &lt;/util:list&gt;

  &lt;bean id="exceptionMapper" class="org.apache.cxf.systest.jaxrs.RuntimeExceptionMapper"/&gt;
  &lt;bean id="customMessageBodyReader" class="org.apache.cxf.systest.jaxrs.CustomReader"/&gt;
  &lt;bean id="customMessageBodyWriter" class="org.apache.cxf.systest.jaxrs.CustomWriter"/&gt; 

  &lt;jaxrs:server id="customerService" address="/service1"&gt;
    &lt;jaxrs:serviceBeans&gt;
      &lt;bean class="org.apache.cxf.systest.jaxrs.CustomerService"/&gt;
    &lt;/jaxrs:serviceBeans&gt;
  &lt;/jaxrs:server&gt;

  &lt;jaxrs:server id="customerService" address="/service2"&gt;
    &lt;jaxrs:serviceBeans&gt;
      &lt;bean class="org.apache.cxf.systest.jaxrs.CustomerService2"/&gt;
    &lt;/jaxrs:serviceBeans&gt;
  &lt;/jaxrs:server&gt;
  
  &lt;/beans&gt;
</pre>
</div></div><h1 id="JAXRSServicesConfiguration-DynamicservletsandasingleJAX-RSendpoint">动态servlet和单个JAX-RS端点</h1><p>注意：从CXF 3.0.0-milestone1开始，默认情况下不需要这样做</p><p>在某些高级情况下，您可能希望动态添加新的servlet（CXFServlet或CXFNonSpringJaxrsServlet），并且它们都服务于相同的JAX-RS端点。在这种情况下，您很可能希望配置servlet，以便不覆盖CXF端点地址：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">{code:xml}
&lt;servlet&gt;
 &lt;servlet-name&gt;CXFServlet&lt;/servlet-name&gt;
 &lt;display-name&gt;CXF Servlet&lt;/display-name&gt;
 &lt;servlet-class&gt;
     org.apache.cxf.transport.servlet.CXFServlet
 &lt;/servlet-class&gt;
 &lt;init-param&gt;
    &lt;param-name&gt;config-location&lt;/param-name&gt;
    &lt;param-value&gt;/WEB-INF/beans1.xml&lt;/param-value&gt;
 &lt;/init-param&gt;
 &lt;init-param&gt;
    &lt;param-name&gt;disable-address-updates&lt;/param-name&gt;
    &lt;param-value&gt;true&lt;/param-value&gt;
 &lt;/init-param&gt;
 &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
</pre>
</div></div><h1 id="JAXRSServicesConfiguration-Auto-discoveryofrootresourcesandproviders">自动发现根资源和提供者</h1><p>从CXF 3.0.0开始，可以使用以XML完成的常规CXF JAX-RS端点声明来启用JAX-RS根目录和提供程序的自动发现。目前只有Spring才有可能。支持Blueprint的补丁已可用，将尽快处理。</p><pre>&#160;</pre><h2 id="JAXRSServicesConfiguration-Spring.1">弹簧</h2><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:jaxrs="http://cxf.apache.org/jaxrs"
      xsi:schemaLocation="
         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
         http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd"&gt;

     &lt;import resource="classpath:META-INF/cxf/cxf.xml" /&gt;
     
     &lt;!-- 
         Discover all root resources and providers in packages starting from "a.b.c" 
     --&gt;
     &lt;jaxrs:server address="/customers" basePackages="a.b.c"/&gt;

     &lt;!-- 
       Discover a root resource and providers in packages starting from "a.b.c" and "d.e.f",
       Note that in case of jaxrs:client, having multiple discoverable root resources can lead to
       unexpected results, as only the single root can be recognized 
     --&gt;
     &lt;jaxrs:client address="http://customers" basePackages="a.b.c,d.e.f"/&gt;

&#160;&lt;/beans&gt;

</pre>
</div></div><p>请注意，以上内容不需要Spring注释，例如添加到JAX-RS提供程序或资源中的@Component。</p><p>如果您希望进行纯基于Spring的自动发现，则可以将@Component添加到JAX-RS应用程序类中并执行</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;beans xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:jaxrs="http://cxf.apache.org/jaxrs"
      xsi:schemaLocation="
         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
         http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd"&gt;

     &lt;import resource="classpath:META-INF/cxf/cxf.xml" /&gt;
     
     &lt;!-- 
         Discover all root resources and providers in packages starting from "a.b.c" 
     --&gt;
     &lt;jaxrs:server address="/customers"/&gt;
     &lt;context:component-scan base-package="a.b.c"/&gt;

&#160;&lt;/beans&gt;

</pre>
</div></div><p> </p><h1 id="JAXRSServicesConfiguration-ServletandApplicationContainerConfiguration">Servlet和应用程序容器配置</h1><p>请参阅此<a shape="rect" href="https://cwiki.apache.org/confluence/display/CXF20DOC/JAX-RS+Deployment">页面</a>以获取更多信息。</p><p>从CXF 3.1.0开始：org.apache.cxf.jaxrs.servlet.sci。JaxrsServletContainerInitializer实现javax.servlet。ServletContainerInitializer随附在cxf-rt-rs-http-sci模块中。</p><p>添加此模块将支持no-web.xml和其他JAX-RS部署，具体取决于JSR-339（JAX-RS 2.0）的2.3.2节中描述的容器自动发现机制。</p><p> </p></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=24190821">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=24190821&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>