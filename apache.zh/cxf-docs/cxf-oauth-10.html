<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - CXF OAuth 1.0">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script src='/resources/highlighter/scripts/shBrushBash.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-CXF OAuth 1.0</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="cxf-oauth-10.html">CXF OAuth 1.0</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><form id="cse-search-box" enctype="application/x-www-form-urlencoded" method="get" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="搜索">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><h1 id="CXFOAuth1.0-CXFOAuth1.0extension">CXF OAuth 1.0扩展</h1>

<p><strong>注意</strong> ：本页介绍了由卢卡斯·莫雷恩（Lucasz Moren）领导的OAuth GSOC 2009项目。请访问<a shape="rect" href="jax-rs-oauth.html">JAX-RS OAuth</a>页面以获取最新信息。</p>

<p>在Google Summer of Code 2010计划期间已构建了CXF OAuth 1.0扩展。它实现了规范： <a shape="rect" class="external-link" href="http://tools.ietf.org/html/rfc5849" rel="nofollow">OAuth 1.0协议（RFC 5849），</a>并允许CXF用户构建OAuth服务器</p>

<p>并通过隐藏复杂的OAuth流来轻松地对其JAXRS服务执行OAuth 1.0授权。</p>

<h3 id="CXFOAuth1.0-DownloadingCXFOAuth1.0module"><span style="color:rgb(0,51,102)"><strong>下载CXF OAuth 1.0模块</strong></span></h3>


<h3 id="CXFOAuth1.0-OAuthServerbasicconfiguration">OAuth服务器基本配置</h3>

<p>CXF为OAuth 1.0规范中的三个端点提供了实现：</p>
<ul><li><strong>临时凭证端点</strong></li><li><strong>授权端点</strong></li><li><strong>令牌凭证端点</strong></li></ul>


<p>这是通常的JAX-RS资源。它们允许客户端应用程序从服务器接收访问令牌，以访问该服务器上的资源。</p>

<p>配置与每个JAX-RS服务完全相同：</p>
<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">
&lt;!-- Publish OAuth endpoints--&gt;
&#160;&#160; &#160;&lt;jaxrs:server id="oauthServer" address="/oauth/"&gt;
&#160;&#160; &#160; &#160; &#160;&lt;jaxrs:serviceBeans&gt;
&#160;&#160; &#160; &#160; &#160; &#160; &#160;&lt;ref bean="oauthServices"/&gt;
&#160;&#160; &#160; &#160; &#160;&lt;/jaxrs:serviceBeans&gt;
&#160;&#160; &#160; &#160; &#160;&lt;jaxrs:providers&gt;
&#160;&#160; &#160; &#160; &#160; &#160; &#160;&lt;ref bean="dispatchProvider"/&gt;
&#160;&#160; &#160; &#160; &#160;&lt;/jaxrs:providers&gt;
&#160;&#160; &#160;&lt;/jaxrs:server&gt;

&#160;&#160; &#160;&lt;!--Definitions of OAuth module endpoints--&gt;
&#160;&#160; &#160;&lt;bean id="oauthServices"
&#160;&#160; &#160; &#160; &#160; &#160;class="org.apache.cxf.auth.oauth.endpoints.OAuthDefaultServices"&gt;
&#160;&#160; &#160; &#160; &#160;&lt;property name="displayVerifierURL" value="http://www.example.com/app/displayVerifier"/&gt;
&#160;&#160; &#160;&lt;/bean&gt;

&#160;&#160; &#160;&lt;!--Redirects from Resource Owner Authorization Endpoint to sign in page--&gt;
&#160;&#160; &#160;&lt;bean id="dispatchProvider"&gt;
&#160;&#160; &#160; &#160; &#160;&lt;property name="resourcePath" value="/oAuthLogin.jsp"/&gt;
&#160;&#160; &#160;&lt;/bean&gt;
</pre>
</div></div>
<p>OAuth服务器需要从特定于Web应用程序的持久性存储中保存和读取OAuth数据（OAuth令牌，oauth_verifier，客户端标识符...）。</p>

<p>为了使开发人员对它透明，CXF使用了：</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">
org.apache.cxf.auth.oauth.provider.OAuthDataProvider
</pre>
</div></div>
<p>接口作为库与应用程序之间的集成点。提供了用于管理存储在内存中的数据的接口的示例实现：</p>


<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">
org.apache.cxf.auth.oauth.provider.MemoryOauthDataProvider
</pre>
</div></div>

<p>位于核心OAuth模块中，</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">
org.apache.cxf.auth.oauth.demo.server.oauth.SampleOAuthDataProvider
</pre>
</div></div>
<p>在OAuth演示服务器模块中。</p>

<h2 id="CXFOAuth1.0-OAuthEndpointsexplained"><strong>OAuth端点说明</strong></h2>

<h5 id="CXFOAuth1.0-TemporaryCredentials"><a shape="rect" class="external-link" href="http://tools.ietf.org/html/rfc5849#section-2.1" rel="nofollow">临时凭证</a></h5>

<p>客户端发送oauth必需的参数以接收临时请求令牌。CXF处理请求，对其进行验证，读取有关客户端的必需信息并</p>

<p>保存下一个OAuth请求中的状态（响应中返回给客户端的请求令牌）。 CXF返回符合OAuth 1.0a规范的响应。</p>

<h5 id="CXFOAuth1.0-ResourceOwnerAuthorization"><a shape="rect" class="external-link" href="http://tools.ietf.org/html/rfc5849#section-2.2" rel="nofollow">资源所有者授权</a></h5>

<p>为了确保更灵活的授权和对服务器资源的访问控制，添加了两个自定义参数，客户端可通过这些参数指定<br clear="none">想要访问（范围）哪些资源，以及如何访问（权限）：</p>
<ul><li><strong>x_oauth_scope-</strong>指定客户端希望访问的逗号分隔的服务器uri</li><li><strong>x_oauth_permission-</strong>指定客户端希望拥有的x_oauth_scope uri的权限的逗号分隔列表（每个权限都与角色，ROLE_USER，ROLE_ADMIN等相关联。）</li></ul>


<p>即：<br clear="none">在用户授予服务器资源许可后，CXF保存此数据，这将在以后的访问控制评估中使用，生成oauth_verifier并将其返回给客户端。<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-content-image-border" src="cxf-oauth-10.data/confirmation.png"></span></p>

<p><strong>服务器用户允许/拒绝访问第三方应用程序请求的范围和权限的示例屏幕</strong></p>

<p>可以通过注册调度提供程序来配置上述确认屏幕的位置，如OAuth Server基本配置所示。如果客户端请求错误，CXF将返回OAuth兼容错误。</p>


<h5 id="CXFOAuth1.0-TokenCredentials"><a shape="rect" class="external-link" href="http://tools.ietf.org/html/rfc5849#section-2.3" rel="nofollow">令牌凭证</a></h5>

<p>客户端向授权服务器发送请求，以便将在上一步<strong>oauth_verifier中</strong>收到的访问令牌交换。同样，在此步骤中，CXF处理请求并返回适当的响应。<br clear="none">如果请求正确，则客户端会收到OAuth访问令牌。<br clear="none">访问令牌将权限授予特定客户端上的用户，以访问具有关联权限的先前授权的作用域。<br clear="none">客户端需要在每个请求中附加访问令牌以认证受保护的资源。在此实现中，由字符串表示的访问令牌包含以下信息：</p>

<ul><li>客户申请</li><li>资源所有者，提供凭据以授权客户端访问服务器</li><li>资源所有者接受的范围列表</li><li>权限列表（角色列表）</li></ul>


<h2 id="CXFOAuth1.0-InterceptingOAuthauthenticatedrequests"><span style="color:rgb(0,51,102)">拦截OAuth身份验证的请求</span></h2>

<p>OAuthSecurityFilter</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">
org.apache.cxf.auth.oauth.interceptors.OAuthSecurityFilter
</pre>
</div></div>
<p>截获OAuth身份验证的请求，执行基本的OAuth验证，并检查请求的范围是否不超过资源所有者的授权。</p>

<p>初始的HTTP请求被覆盖以重写：getUserPrincipal和isUserInRole方法，并进一步传递。OAuth安全过滤器不能确保基于与范围关联的权限的访问控制。它需要由开发人员或</p>

<p>通过使用：SpringOAuthAuthenticationFilter</p>

<h2 id="CXFOAuth1.0-SpringSecurityIntegration"><span style="color:rgb(0,51,102)">春季安全集成</span></h2>


<h3 id="CXFOAuth1.0-SpringOAuthAuthenticationFilter">SpringOAuthAuthenticationFilter</h3>

<p>Spring Security扩展提供了OAuth流与安全注释的集成，例如：@RolesAllowed或@Secured</p>

<p>唯一需要做的就是添加</p>
<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">
org.apache.cxf.auth.oauth.integration.spring.security.SpringOAuthAuthenticationFilter
</pre>
</div></div>
<p>在OAuthSecurityFilter之后的web.xml文件中<strong>进行</strong>配置。SpringOAuthAuthenticationFilter初始化SpringSecurityContext并允许从Spring Security框架中受益。<br clear="none">样本JAX-RS服务可能类似于：</p>
<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">
@Path("/")
public class SampleResourceProvider {

    @GET
    @Produces("text/html")
    @Path("/person/get/{name}")
    @Secured ({"ROLE_USER"})
    public Response getInfo(@PathParam("name") String name, @Context HttpServletRequest request) {
        return Response.ok("Successfully accessed OAuth protected person: " + name).build();
    }
}
</pre>
</div></div>

<p>在上面的示例中， <em>getInfo</em>资源只能由附加了资源所有者授权的访问令牌的客户端调用<br clear="none">范围：/ *，人员/ *，人员/获取/ *或/人员/获取/ $ particular_name，并具有与角色相关的许可：ROLE_USER。</p>

<h3 id="CXFOAuth1.0-SpringSecurityExceptionMapper">SpringSecurityExceptionMapper</h3>
<p>该异常映射器将Spring Security异常（即AccessDeniedException）转换为符合OAuth 1.0规范的http响应。</p>

<h2 id="CXFOAuth1.0-OAuthDemoServer"><span style="color:rgb(0,51,102)">OAuth演示服务器</span></h2>
<p>使用CXF OAuth扩展构建的OAuth服务器的示例实现。提供用于预注册OAuth客户端，查看授权客户端和撤消对服务器访问的简单功能。</p>

<h2 id="CXFOAuth1.0-OAuthDemoClient"><span style="color:rgb(0,51,102)">OAuth演示客户端</span></h2>
<p>能够发出OAuth身份验证请求的OAuth 1.0客户端Web应用程序</p></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=24188735">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=24188735&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>