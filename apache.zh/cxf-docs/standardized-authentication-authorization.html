<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - Standardized Authentication / Authorization">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-标准化身份验证/授权</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="standardized-authentication-authorization.html">标准化身份验证/授权</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><form id="cse-search-box" enctype="application/x-www-form-urlencoded" method="get" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="搜索">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><p> </p><p> </p><p> </p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body">想法/提案</div></div><p> </p><p>CXF已经支持各种身份验证和授权方法。不幸的是，它们的配置都不同，并且彼此之间集成得不好。</p><p>因此，想法是在CXF中创建一个标准化的身份验证/授权流，然后在其中插入模块。有很多安全框架可以用作此的基础。问题是尽管每个框架（例如Shiro或Spring Security）都使用其自己的未标准化机制。因此，通过选择一个框架，我们将迫使我们的用户依赖于此。</p><p>Java中最好的标准化安全框架是JAAS。它已经包含在Java中，并且大多数安全框架都可以插入其中。因此，让我们研究一下使用JAAS可以做什么。</p><h2 id="StandardizedAuthentication/Authorization-AuthenticationusingJAAS">使用JAAS进行身份验证</h2><p>通过创建LoginContext并对其进行登录来完成JAAS身份验证。要配置的是登录配置的名称和回调处理程序。因此，CXF需要用户设置机制名称的机制，并且需要提供CallBackHandlers来提供凭据。</p><h2 id="StandardizedAuthentication/Authorization-CallbackHandlers">回调处理程序</h2><p>CXF需要根据选择的身份验证变体提供不同的数据来标识用户。</p><p>基本身份验证：HTTP标头中的用户名和密码</p><p>WS-Security UserNameToken：SOAP标头中的用户名和密码</p><p>Spnego：来自HTTP标头的Kerberos令牌</p><p>HTTPS客户端证书：证书信息</p><p>我们可以简单地检测到提供了哪些信息，并为我们可以提供的每种信息配置Callbackhandler。根据登录发生的时间，我们可以使用拦截器在Message中收集CallbackHandlers。</p><h2 id="StandardizedAuthentication/Authorization-JAASconfiguration">JAAS配置</h2><p>JAAS配置的提供方式有所不同，具体取决于运行CXF的运行时。</p><p>独立：对于独立使用，JAAS配置可以仅来自文件。</p><p>Servlet容器：不确定。有没有标准的方法呢？</p><p>Apache Karaf：Karaf已经提供了JAAS集成，因此我们只需要配置JAAS配置名称并在karaf中提供合适的配置</p><h2 id="StandardizedAuthentication/Authorization-SupplyingRoleandUserinformation">提供角色和用户信息</h2><p>JAAS将身份信息存储在JAAS主题中。getPrincipals方法返回Principal对象，这些对象可以是用户，角色甚至其他身份信息。要区分角色和用户，有两种常用方法。</p><ol><li>不同的类，例如UserPrincipal或RolePrincipal。似乎有一个Group界面，该界面可以区分“用户”和“ Groups”，还可以查看组成员。</li><li>前缀。例如，角色以role-开头。这种方法没有标准</li></ol><h2 id="StandardizedAuthentication/Authorization-Authorization">授权书</h2><p>授权具有非常多样化的要求。因此，我们需要确保我们与不同的方法很好地集成在一起。</p><p>通常，此想法是将授权基于JAAS登录数据。登录JAAS后，可以通过标准方式检索JAAS主题：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">AccessControlContext acc = AccesController.getContext();
Subject subject = Subject.getSubject(acc);</pre>
</div></div><p>因此，我们的想法是，我们提供某些默认授权变种，这些变种依赖于上述内容以标准化方式检索身份验证信息。因此，授权与身份验证和完全基于标准的关系很好地脱钩了。</p><p>然后，这也为用户或其他框架提供了一个不错的界面，用于访问身份验证信息并提供自定义授权变体。</p><h2 id="StandardizedAuthentication/Authorization-DefaultAuthorizationVariants">默认授权变体</h2><h3 id="StandardizedAuthentication/Authorization-JEEannotations">JEE批注</h3><p>Java EE提供了一些标准注释，例如@RolesAllowed。我们可以提供一个拦截器，该拦截器读取serivce impls的注释并像在JEE容器中那样提供授权。</p><h3 id="StandardizedAuthentication/Authorization-XACMLPEP">XACML PEP</h3><p>XACML策略实施点可以检索JAAS登录数据并针对XACML策略决策点（PDP）进行授权。</p><h2 id="StandardizedAuthentication/Authorization-SeparatingAuthorizationfromCXF">将授权与CXF分开</h2><p>由于授权不仅与Web服务相关，因此将授权代码与cxf分开也是有意义的。因此，实现授权的一种方法是将其放入蓝图扩展中。当然，这仅涵盖OSGi和蓝图，但这只是一个开始。</p><p>它的工作方式类似于XA事务支持。与tx支持不同，我们可以扫描所有bean以获取安全注释，例如@RolesAllowed。然后，对于每个具有此批注的bean，我们可以将其代理给一个进行安全检查的类。这将允许具有最少的xml配置。</p><p>另一种方法是像tx支持一样使用xml将bean标记为进行安全检查。然后，此变体也可以很好地用于XACML授权，因为在这种情况下，没有要扫描的注释。</p><h3 id="StandardizedAuthentication/Authorization-KarafrolebasedOSGiserviceAuthorization">基于Karaf角色的OSGi服务授权</h3><p>Karaf 3已经在OSGi服务级别上支持授权，并使用JAAS进行身份验证。因此，如果我们在CXF中进行JAAS登录，并且服务隐含代码调用OSGi服务，则基于Karaf角色的安全性应该已经可以立即使用。我们可以在基于karaf的代码中添加基于注释的授权，以使其变得更好并且需要更少的配置。</p><h2 id="StandardizedAuthentication/Authorization-Exceptionhandlingandanswergeneration">异常处理和答案生成</h2><p>当前，认证和授权模块通常还生成呼叫者的答案。解耦可能是一个好主意。</p><p>在身份验证和授权中，我们仅抛出定义的异常：</p><ul><li>认证失败：javax.security.auth.login。LoginException也可能更具体，例如AccountLockedException</li><li>授权失败：org.apache.cxf.interceptor.security。AccessDeniedException或java.security。AccessControlException。后者对于与cxf分开的代码更好，因为它不依赖于CXF。</li></ul><p>然后在类似于http传输的传输中，我们将异常映射到已定义的状态代码和http响应：</p><ul><li>LoginException：HTTP代码401</li><li>AccessDeniedException，AccessControlException：HTTP代码403</li></ul><p>不幸的是，CXF当前不处理传输中的状态码生成。该异常已映射到PhaseInterceptorChain的Fault中。然后，故障将保留statusCode，默认情况下为500。因此，进行映射的一种简单方法是在Fault构造函数中将异常类型映射到错误代码。这是不可扩展的，但从一开始就可以做到。</p><h2 id="StandardizedAuthentication/Authorization-JAASFeature">JAAS功能</h2><p>JAAS功能需要一些配置，例如jaas上下文名称。因此，将其与OSGi中的config admin集成并发布为OSGi服务是有意义的。因此，我们可以使JAAS配置保持集中状态，并将其排除在每个捆绑软件之外。</p><p>只要配置非常有限，我们当然也可以将其集成到每个捆绑的cxf总线中。这样做的好处是它也可以在OSGi之外运行。</p><h2 id="StandardizedAuthentication/Authorization-Authenticationactivation">身份验证激活</h2><p>理想情况下，我们应该以一种新的方式集成新的身份验证/授权模型，该模型使用户能够为karaf服务器打开身份验证，而无需在实现服务的用户捆绑包中进行特定配置。这种非常松散耦合的方法的一个问题是，打开身份验证可以保护所有服务，但是可能希望其中一些服务不能工作。另一个问题是服务可能在auth模块之前启动，然后在不安全的情况下运行。</p><p>因此，我们需要一种标记需要认证的服务的方法。这样做的一种现有方法是将自动注册功能绑定为OSGi服务，然后“手动”将其添加到功能中。这有点冗长，但另一方面，很清楚会发生什么。</p><p>另一种方法是将功能发布为具有唯一ID（功能已经存在）的OSGi服务。然后我们可以为cxf：bus和这样的端点创建一个新的Element：</p><p><namedfeatures>身份验证，xacmlAuthorization</namedfeatures></p><p>该元素意味着cxf仅在同时存在这两个命名功能时才发布端点，并将功能添加到端点/ bus。</p><h2 id="StandardizedAuthentication/Authorization-Problems">问题</h2><p>进行完整的JAAS登录需要使用subject.doAs来填充AcessControlContext。这在CXF拦截器中是不可能的，因为该拦截器仅对消息起作用，而不能为doAs调用下一个拦截器。所以问题是在哪里进行JAAS登录和doAs？</p><h2 id="StandardizedAuthentication/Authorization-Links">链接</h2><p><a shape="rect" class="external-link" href="http://docs.oracle.com/javase/6/docs/technotes/guides/security/jaas/JAASRefGuide.html" rel="nofollow">http://docs.oracle.com/javase/6/docs/technotes/guides/security/jaas/JAASRefGuide.html</a></p></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=42568988">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=42568988&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>