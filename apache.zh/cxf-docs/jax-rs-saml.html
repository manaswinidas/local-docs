<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - JAX-RS SAML">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script src='/resources/highlighter/scripts/shBrushXml.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-JAX-RS SAML</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="restful-services.html">RESTful服务</a> > <a href="jax-rs.html">JAX-RS</a> > <a href="jax-rs-saml.html">JAX-RS SAML</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><form id="cse-search-box" enctype="application/x-www-form-urlencoded" method="get" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="搜索">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><p> <span style="font-size:2em;font-weight:bold">JAX-RS：SAML</span>


<br clear="none"></p><p><style type="text/css">/*<![CDATA[*/
div.rbtoc1536936978657 {padding: 0px;}
div.rbtoc1536936978657 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1536936978657 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style></p><div class="toc-macro rbtoc1536936978657">
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSSAML-Introduction">介绍</a></li><li><a shape="rect" href="#JAX-RSSAML-Backwardscompatibilityconfigurationnote">向后兼容性配置说明</a></li><li><a shape="rect" href="#JAX-RSSAML-Mavendependencies">Maven依赖</a></li><li><a shape="rect" href="#JAX-RSSAML-EnvelopedSAMLassertions">信封式SAML断言</a></li><li><a shape="rect" href="#JAX-RSSAML-SAMLassertionsinAuthorizationheader">授权标头中的SAML断言</a></li><li><a shape="rect" href="#JAX-RSSAML-SAMLassertionsasFormvalues">SAML断言作为表单值</a></li><li><a shape="rect" href="#JAX-RSSAML-CreatingSAMLAssertions">创建SAML断言</a></li><li><a shape="rect" href="#JAX-RSSAML-SAMLAssertionValidation">SAML断言验证</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSSAML-ValidatingSAMLSubjects">验证SAML主题</a></li></ul>
</li><li><a shape="rect" href="#JAX-RSSAML-SAMLAuthorization">SAML授权</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSSAML-ClaimsBasedAccessControl">基于声明的访问控制</a></li><li><a shape="rect" href="#JAX-RSSAML-RoleBasedAccessControl">基于角色的访问控制</a></li></ul>
</li><li><a shape="rect" href="#JAX-RSSAML-SAMLWebSSOProfile">SAML Web SSO配置文件</a></li></ul>
</div><h1 id="JAX-RSSAML-Introduction">介绍</h1><p>CXF 2.5.0引入了对使用<a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/SAML_2.0" rel="nofollow">SAML2</a>断言的初始支持。到目前为止，重点一直放在确保SAML断言可以包含在针对应用程序终结点的HTTP请求中：嵌入XML有效负载内或作为编码的HTTP标头或表单值传递。</p><p>另请参见<a shape="rect" href="jax-rs-xml-security.html">JAX-RS XML安全性</a> 。</p><h1 id="JAX-RSSAML-Backwardscompatibilityconfigurationnote">向后兼容性配置说明</h1><p>从Apache CXF 3.1.0起，用于配置XML签名或加密的基于WS-Security的配置标签（“ ws-security- *”）已更改为仅以“ security-”开头。除此之外，它们是完全相同的。CXF 3.1.0继续接受较旧的“ ws-security-”值。要将本页中的任何配置示例与旧版本的CXF一起使用，只需在配置标签中添加“ ws-”前缀即可。</p><h1 id="JAX-RSSAML-Mavendependencies">Maven依赖</h1><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt;
  &lt;artifactId&gt;cxf-rt-rs-security-xml&lt;/artifactId&gt;
  &lt;version&gt;2.5.0&lt;/version&gt;
&lt;/dependency&gt;
</pre>
</div></div><p>该模块依赖于Apache WSS4J，因为它包含许多基于OpenSAML的有用实用程序代码。</p><h1 id="JAX-RSSAML-EnvelopedSAMLassertions">信封式SAML断言</h1><p>有效负载：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;env:Envelope xmlns:env="http://org.apache.cxf/rs/env"&gt;

&lt;Book ID="67ca6441-0c4e-4430-af0e-9463ce9226aa"&gt;
  &lt;id&gt;125&lt;/id&gt;
  &lt;name&gt;CXF&lt;/name&gt;
&lt;/Book&gt;
&lt;ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
  &lt;!-- Book signature, omitted for brewity --&gt;
&lt;/ds:Signature&gt;

&lt;!-- SAML assertion with an enveloped signature --&gt; 
&lt;saml2:Assertion xmlns:saml2="urn:oasis:names:tc:SAML:2.0:assertion" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  ID="_62D574706635C0B9F413203247720501" IssueInstant="2011-11-03T12:52:52.050Z" Version="2.0" xsi:type="saml2:AssertionType"&gt;

&lt;saml2:Issuer&gt;https://idp.example.org/SAML2&lt;/saml2:Issuer&gt;

&lt;ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
   &lt;ds:SignedInfo&gt;
    &lt;ds:CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/&gt;
    &lt;ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/&gt;
    &lt;ds:Reference URI="#_62D574706635C0B9F413203247720501"&gt;
      &lt;ds:Transforms&gt;
       &lt;ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/&gt;
       &lt;ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"&gt;
         &lt;ec:InclusiveNamespaces xmlns:ec="http://www.w3.org/2001/10/xml-exc-c14n#" PrefixList="xs"/&gt;
       &lt;/ds:Transform&gt;
      &lt;/ds:Transforms&gt;
      &lt;ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/&gt;
      &lt;ds:DigestValue&gt;IDD9nFocVm/7FpUbiGI3ZvpY2ps=&lt;/ds:DigestValue&gt;
    &lt;/ds:Reference&gt;
   &lt;/ds:SignedInfo&gt;
   &lt;ds:SignatureValue&gt;JA2I7u/SmNsXGgWNdrLSovkipiM3JmGHsmpoP0EeIOwPwnLMx0WvV0C3xNGNiT1jOBe2uv8+WchtPoppGTC2JTJVX/t8PmKQCYZo4kVJo6Nms...&lt;/ds:SignatureValue&gt;
   &lt;ds:KeyInfo&gt;
    &lt;ds:X509Data&gt;
     &lt;ds:X509Certificate&gt;&lt;!-- Omitted for brewity --&gt; &lt;/ds:X509Certificate&gt;
    &lt;/ds:X509Data&gt;
   &lt;/ds:KeyInfo&gt;
 &lt;/ds:Signature&gt;

 &lt;saml2:Subject&gt;
   &lt;saml2:NameID Format="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified" NameQualifier="www.mock-sts.com"&gt;uid=sts-client,o=mock-sts.com&lt;/saml2:NameID&gt;
   &lt;saml2:SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:cm:sender-vouches"/&gt;
 &lt;/saml2:Subject&gt;

 &lt;saml2:Conditions NotBefore="2011-11-03T12:52:52.063Z" NotOnOrAfter="2011-11-03T12:52:52.063Z"&gt;
  &lt;saml2:AudienceRestriction&gt;
   &lt;saml2:Audience&gt;https://sp.example.com/SAML2&lt;/saml2:Audience&gt;
  &lt;/saml2:AudienceRestriction&gt;
 &lt;/saml2:Conditions&gt;
 &lt;saml2:AuthnStatement AuthnInstant="2011-11-03T12:52:51.981Z" SessionIndex="123456"&gt;
    &lt;saml2:AuthnContext&gt;&lt;saml2:AuthnContextClassRef/&gt;&lt;/saml2:AuthnContext&gt;
 &lt;/saml2:AuthnStatement&gt;

 &lt;saml2:AttributeStatement&gt;
    &lt;saml2:Attribute FriendlyName="subject-role" 
                     Name="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/role" 
                     NameFormat="http://schemas.xmlsoap.org/ws/2005/05/identity/claims"&gt;
       &lt;saml2:AttributeValue xsi:type="xs:string"&gt;user&lt;/saml2:AttributeValue&gt;
    &lt;/saml2:Attribute&gt;
    &lt;saml2:Attribute Name="http://claims/authentication" 
                     NameFormat="http://claims/authentication-format"&gt;
       &lt;saml2:AttributeValue xsi:type="xs:string"&gt;password&lt;/saml2:AttributeValue&gt;
    &lt;/saml2:Attribute&gt;
 &lt;/saml2:AttributeStatement&gt;
&lt;/saml2:Assertion&gt;
&lt;/env:Envelope&gt;
</pre>
</div></div><p>请注意，Book和SAML断言是单独签名的，但信封包装器本身未签名。</p><p>这是另一个有效载荷，显示包括Book和SAML断言在内的整个信封签名，这次只有一个签名可用：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;env:Envelope xmlns:env="http://org.apache.cxf/rs/env" ID="e795cdd1-c19d-4a5c-8d86-e8a781af4787"&gt;

&lt;saml2:Assertion xmlns:saml2="urn:oasis:names:tc:SAML:2.0:assertion" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  ID="_C76E3D5BBEE4C4D87913203281641141" IssueInstant="2011-11-03T13:49:24.114Z" Version="2.0" xsi:type="saml2:AssertionType"&gt;
&lt;saml2:Issuer&gt;https://idp.example.org/SAML2&lt;/saml2:Issuer&gt;
&lt;saml2:Subject&gt;
&lt;saml2:NameID Format="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified" NameQualifier="www.mock-sts.com"&gt;uid=sts-client,o=mock-sts.com&lt;/saml2:NameID&gt;
&lt;saml2:SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:cm:sender-vouches"/&gt;
&lt;/saml2:Subject&gt;
&lt;saml2:Conditions NotBefore="2011-11-03T13:49:24.127Z" NotOnOrAfter="2011-11-03T13:49:24.127Z"&gt;
&lt;saml2:AudienceRestriction&gt;
&lt;saml2:Audience&gt;https://sp.example.com/SAML2&lt;/saml2:Audience&gt;
&lt;/saml2:AudienceRestriction&gt;
&lt;/saml2:Conditions&gt;
&lt;saml2:AuthnStatement AuthnInstant="2011-11-03T13:49:24.044Z" SessionIndex="123456"&gt;
&lt;saml2:AuthnContext&gt;
&lt;saml2:AuthnContextClassRef/&gt;
&lt;/saml2:AuthnContext&gt;
&lt;/saml2:AuthnStatement&gt;
&lt;saml2:AttributeStatement&gt;
&lt;saml2:Attribute FriendlyName="subject-role" Name="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/role" 
    NameFormat="http://schemas.xmlsoap.org/ws/2005/05/identity/claims"&gt;
&lt;saml2:AttributeValue xmlns:xs="http://www.w3.org/2001/XMLSchema" xsi:type="xs:string"&gt;user&lt;/saml2:AttributeValue&gt;
&lt;/saml2:Attribute&gt;
&lt;saml2:Attribute Name="http://claims/authentication" NameFormat="http://claims/authentication-format"&gt;
&lt;saml2:AttributeValue xmlns:xs="http://www.w3.org/2001/XMLSchema" xsi:type="xs:string"&gt;password&lt;/saml2:AttributeValue&gt;
&lt;/saml2:Attribute&gt;
&lt;/saml2:AttributeStatement&gt;
&lt;/saml2:Assertion&gt;

&lt;Book&gt;
&lt;id&gt;125&lt;/id&gt;
&lt;name&gt;CXF&lt;/name&gt;
&lt;/Book&gt;

&lt;ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
  &lt;ds:SignedInfo&gt;
    &lt;ds:CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/&gt;
    &lt;ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/&gt;
    &lt;ds:Reference URI="#e795cdd1-c19d-4a5c-8d86-e8a781af4787"&gt;
      &lt;ds:Transforms&gt;
        &lt;ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/&gt;
        &lt;ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/&gt;
      &lt;/ds:Transforms&gt;
      &lt;ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/&gt;
      &lt;ds:DigestValue&gt;GR1pHd2JpxYiCzl6ouCmTZjq/AA=&lt;/ds:DigestValue&gt;
    &lt;/ds:Reference&gt;
  &lt;/ds:SignedInfo&gt;
  &lt;ds:SignatureValue&gt;C2qUDOFwart2GHFjX6kB3E3z73AMXtRR/6Qjgyp6XP/vTn/Fr2epDNub3q+gNdT0KgjLE2rSynM3QTcpHov9C8...&lt;/ds:SignatureValue&gt;
  &lt;ds:KeyInfo&gt;
    &lt;ds:X509Data&gt;&lt;ds:X509Certificate&gt;&lt;!-- Omitted for brewity --&gt;&lt;/ds:X509Certificate&gt;&lt;/ds:X509Data&gt;
    &lt;ds:KeyValue&gt;&lt;ds:RSAKeyValue&gt;&lt;ds:Modulus&gt;vu747/VShQ85f16DGSc4Ixh9...&lt;/ds:Modulus&gt;&lt;ds:Exponent&gt;AQAB&lt;/ds:Exponent&gt;&lt;/ds:RSAKeyValue&gt;&lt;/ds:KeyValue&gt;
  &lt;/ds:KeyInfo&gt;
&lt;/ds:Signature&gt;
&lt;/env:Envelope&gt;
</pre>
</div></div><p>服务器配置片段：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">    &lt;bean id="serviceBean" class="org.apache.cxf.systest.jaxrs.security.BookStore"/&gt;
    &lt;bean id="samlHandler" class="org.apache.cxf.rs.security.saml.SamlEnvelopedInHandler"/&gt;
    
    &lt;!-- only needed if the detached signature signing the application data is expected --&gt; 
    &lt;bean id="xmlSigHandler" class="org.apache.cxf.rs.security.xml.XmlSigInHandler"/&gt;
    
    
    &lt;jaxrs:server 
       address="https://localhost:${testutil.ports.jaxrs-saml}/samlxml"&gt; 
       &lt;jaxrs:serviceBeans&gt;
          &lt;ref bean="serviceBean"/&gt;
       &lt;/jaxrs:serviceBeans&gt;
       &lt;jaxrs:providers&gt;
          &lt;ref bean="xmlSigHandler"/&gt;
          &lt;ref bean="samlHandler"/&gt;
       &lt;/jaxrs:providers&gt;
       
       &lt;jaxrs:properties&gt;
           &lt;entry key="security.signature.properties" 
                  value="org/apache/cxf/systest/jaxrs/security/alice.properties"/&gt;
       &lt;/jaxrs:properties&gt;
        
    &lt;/jaxrs:server&gt;
</pre>
</div></div><p>客户代码：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">private WebClient createWebClient(String address) {
  JAXRSClientFactoryBean bean = new JAXRSClientFactoryBean();
  bean.setAddress(address);
  
  Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();
  properties.put("security.callback-handler", 
                "org.apache.cxf.systest.jaxrs.security.saml.KeystorePasswordCallback");
  properties.put("security.saml-callback-handler", 
                 "org.apache.cxf.systest.jaxrs.security.saml.SamlCallbackHandler");
  properties.put("security.signature.username", "alice");
  properties.put("security.signature.properties", 
                 "org/apache/cxf/systest/jaxrs/security/alice.properties");
  bean.setProperties(properties);
        
  bean.getOutInterceptors().add(new SamlEnvelopedOutInterceptor(!selfSigned));
  XmlSigOutInterceptor xmlSig = new XmlSigOutInterceptor();
  if (selfSigned) {
      xmlSig.setStyle(XmlSigOutInterceptor.DETACHED_SIG);
  }
  return bean.createWebClient();
}
</pre>
</div></div><p>当我们还需要对诸如Book之类的应用程序负载进行签名时，我们需要确保为Book创建了分离的XML签名。当整个信封都签名后，需要在XmlSigOutInterceptor之前放置SamlEnvelopedOutInterceptor，因此“新的SamlEnvelopedOutInterceptor（！selfSigned）“构造函数被调用。</p><h1 id="JAX-RSSAML-SAMLassertionsinAuthorizationheader">授权标头中的SAML断言</h1><p>记录输出：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">Address: https://localhost:9000/samlheader/bookstore/books/123
Http-Method: GET
Headers: {Accept=[application/xml], Authorization=[SAML eJydV1mTokgQfu9fYTCPrs2htGKMHVEcKq2gKOLxsoFQAsqhFAjNr99CW1ud7t2ZjdA...], ...}
</pre>
</div></div><p>请注意，Authorization标头具有一个编码的SAML断言作为其值。原始的SAML断言可以选择使用放气编码进行压缩，然后进行base64编码。该编码值可以自己签名-但目前无法实现。</p><p>服务器配置类似于“信封式SAML断言”部分中的配置，唯一的区别是需要替换SAML处理程序：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">    &lt;bean id="serviceBean" class="org.apache.cxf.systest.jaxrs.security.BookStore"/&gt;
    &lt;bean id="samlHandler" class="org.apache.cxf.rs.security.saml.SamlHeaderInHandler"/&gt;
    
    &lt;!-- same as in the Enveloped SAML Assertions section --&gt; 
</pre>
</div></div><p>客户代码：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">private WebClient createWebClient(String address) {
  JAXRSClientFactoryBean bean = new JAXRSClientFactoryBean();
  bean.setAddress(address);
  
  Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();
  properties.put("security.callback-handler", 
                "org.apache.cxf.systest.jaxrs.security.saml.KeystorePasswordCallback");
  properties.put("security.saml-callback-handler", 
                 "org.apache.cxf.systest.jaxrs.security.saml.SamlCallbackHandler");
  properties.put("security.signature.username", "alice");
  properties.put("security.signature.properties", 
                 "org/apache/cxf/systest/jaxrs/security/alice.properties");

  bean.setProperties(properties);
        
  bean.getOutInterceptors().add(new SamlHeaderOutInterceptor());
  
  return bean.createWebClient();
}
</pre>
</div></div><h1 id="JAX-RSSAML-SAMLassertionsasFormvalues">SAML断言作为表单值</h1><p>记录输出：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">Address: https://localhost:9000/samlform/bookstore/books
Encoding: ISO-8859-1
Http-Method: POST
Content-Type: application/x-www-form-urlencoded
Headers: {Accept=[application/xml], Cache-Control=[no-cache], connection=[keep-alive], Content-Length=[2206], content-type=[application/x-www-form-urlencoded], 
Host=[localhost:9000], Pragma=[no-cache], User-Agent=[Apache CXF ${project.version}]}
Payload: name=CXF&amp;id=125&amp;SAMLToken=eJydV1tzqkgQfs+vsDiPWcNFjWIdUzUIGqJgQMTLyxYOI6BclAFBfv0OGo16kt1ztk...
</pre>
</div></div><p>请注意，在SAML处理程序处理SAMLToken表单字段中编码的SAML断言之后，将仅保留表单“名称”和“ id”字段。原始的SAML断言可以选择使用放气编码进行压缩，然后进行base64编码。可以对这个编码值进行签名-但目前尚无法实现。</p><p>服务器配置类似于“信封式SAML断言”部分中的配置，唯一的区别是需要替换SAML处理程序：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">    &lt;bean id="serviceBean" class="org.apache.cxf.systest.jaxrs.security.BookStore"/&gt;
    &lt;bean id="samlHandler" class="org.apache.cxf.rs.security.saml.SamlFormInHandler"/&gt;
    
    &lt;!-- same as in the Enveloped SAML Assertions section --&gt; 
</pre>
</div></div><p>客户端代码与Authorization标头部分中的SAML断言相同，除了必须注册SamlFormOutInterceptor的实例：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">bean.getOutInterceptors().add(new SamlFormOutInterceptor());
</pre>
</div></div><h1 id="JAX-RSSAML-CreatingSAMLAssertions">创建SAML断言</h1><p>如果您使用CXF JAX-RS客户端API尝试SAML，那么您所需要做的就是注册适当的out拦截器，如上面的代码片段所示。拦截器将确保创建SAML断言并将其添加为格式或HTTP标头值的XML信封。<br clear="none">所有SAML输出拦截器都依赖于链接到自定义javax.security.auth.callback的“ security.saml-callback-handler”属性。回调实现，在其handle（Callbacks）方法中向org.apache.ws.security.saml.ext提供创建SAML断言所需的信息。例如，SAMLCallback回调实例，请参见此<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/saml/SamlCallbackHandler.java" rel="nofollow">自定义实现</a> 。</p><p>在需要时，将借助CXF（WS）STSClient支持由身份提供者创建的涉及SAML断言的更多案例。</p><h1 id="JAX-RSSAML-SAMLAssertionValidation">SAML断言验证</h1><p>在服务器端收到SAML断言时，将对它们进行验证，以确保封装的签名正确。还检查SubjectConfirmation方法（发件人凭证，密钥持有人，不记名）。<br clear="none">如果需要，可以将验证委派给STS。默认情况下，服务器端SAML处理程序将“ samlValidator”属性设置为org.apache.ws.security.validate的实例。SamlAssertionValidator对声明进行彻底验证。如果需要，请使用org.apache.cxf.ws.security.trust。可以改为设置STSTokenValidator，它将使用STS来验证断言。<br clear="none">如果需要，可以注册扩展WSS4J SamlAssertionValidator并执行其他特定于应用程序的验证的自定义验证器。</p><p>请注意，默认验证很大程度上依赖于WS-Security实现大量使用的代码，这一事实无关紧要-它是为了完成验证而单独进行集成的一个示例。例如，WS- * STS在当今的企业中被大量使用，并且如果可能的话，依靠它来验证SAML断言完全有意义。</p><p>可以使用封装的SAML声明轻松验证SubjectConfirm的发件人凭证和密钥持有者方法，因为可以对照用于签名信封的签名或自定义有效负载（如Book）来检查嵌入式SAML签名和密钥信息。</p><p>当在标头或表单中提供断言时，目前无法正确验证这些方法，将需要附加的签名来对已编码的SAML令牌进行签名-将在适当的时候提供支持。在这种情况下，请使用“承载”。</p><h2 id="JAX-RSSAML-ValidatingSAMLSubjects">验证SAML主题</h2><p>首先要做的最重要的事情是验证一个断言Subject可以映射到一个公认的身份实例。</p><p>有多种验证主题的方法。</p><p>如果要求STS验证断言，则IDP的成功响应可能足以让CXF信任提供者的身份。<br clear="none">如果断言签名是使用IDP的公钥在本地验证的，那么它也可能是一个足够好的确认。</p><p>另外，也可以使用自定义验证程序，扩展<a shape="rect" class="external-link" href="http://org.apache.ws" rel="nofollow">org.apache.ws</a> .security.validate。可以向服务器端SAML处理程序注册SamlAssertionValidator或CXF SAML <a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/rs/security/xml/src/main/java/org/apache/cxf/rs/security/saml/authorization/SecurityContextProvider.java" rel="nofollow">SecurityContextProvider</a> <a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/rs/security/xml/src/main/java/org/apache/cxf/rs/security/saml/authorization/SecurityContextProviderImpl.java" rel="nofollow">实现</a> 。</p><p>首选后一种选项，因为不仅可以验证使用者，而且还可以确保生成的SecurityContext将返回具有适当名称的用户Principal，因为断言中可用的实际使用者名称可能需要转换为可识别的名称。本地安全存储或应用程序。可能需要检查断言的Subject和AttributeStatement元素的组合以建立真实名称。</p><p>在这种情况下，即使您有STS验证断言，也可能要注册自定义SecurityContextProvider。另一个原因是要检索有关给定主题的角色的信息，或将断言声明映射到与RBAC合作成功的角色，有关更多信息，请参见下一部分。</p><p>请看以下服务器配置示例：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;bean id="serviceBeanClaims" class="org.apache.cxf.systest.jaxrs.security.saml.SecureClaimBookStore"/&gt;
&lt;bean id="samlEnvHandler" class="org.apache.cxf.rs.security.saml.SamlEnvelopedInHandler"&gt;
 &lt;property name="securityContextProvider"&gt;
    &lt;bean class="org.apache.cxf.systest.jaxrs.security.saml.CustomSecurityContextProvider"/&gt;
 &lt;/property&gt;
&lt;/bean&gt;

&lt;jaxrs:server address="/saml-claims"&gt; 
       &lt;jaxrs:serviceBeans&gt;
          &lt;ref bean="serviceBeanClaims"/&gt;
       &lt;/jaxrs:serviceBeans&gt;
       &lt;jaxrs:providers&gt;
          &lt;ref bean="samlEnvHandler"/&gt;
       &lt;/jaxrs:providers&gt;
&lt;/jaxrs:server&gt;
</pre>
</div></div><pre><br clear="none"></pre><h1 id="JAX-RSSAML-SAMLAuthorization">SAML授权</h1><p>SAML断言可能包含所谓的声明，这些声明由包含一个或多个属性的一系列SAML AttributeStatements表示，例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;saml2:Assertion&gt;
 &lt;!-- ... --&gt;
 &lt;saml2:AttributeStatement&gt;
    &lt;saml2:Attribute NameFormat="http://schemas.xmlsoap.org/ws/2005/05/identity/claims"
                 Name="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/role" 
                 FriendlyName="subject-role"&gt;
       &lt;saml2:AttributeValue xmlns:xs="http://www.w3.org/2001/XMLSchema" xsi:type="xs:string"&gt;user&lt;/saml2:AttributeValue&gt;
    &lt;/saml2:Attribute&gt;
    &lt;saml2:Attribute NameFormat="http://claims/authentication"
                     Name="http://claims/authentication-format"&gt;
        &lt;saml2:AttributeValue xmlns:xs="http://www.w3.org/2001/XMLSchema" xsi:type="xs:string"&gt;password&lt;/saml2:AttributeValue&gt;
    &lt;/saml2:Attribute&gt;
 &lt;/saml2:AttributeStatement&gt;
 &lt;!-- ... --&gt;
&lt;/saml2:Assertion&gt;
</pre>
</div></div><p>单个声明的范围受NameFormat和Name属性的限制。NameFormat类似于名称空间，而Name标识此声明的值表示什么，例如，在上面的片段中提供了两个声明，一个声明的值“ user”代表断言的Subject的角色，另一个声明的值代表“ password”的值，它标识Subject对其自身进行身份验证的方式，即Subject提供了其密码（大概是IDP）。</p><p>现在，有趣的是看看是否可以将这些声明与基于角色的访问控制（例如，端点依赖于@RolesAllowed批注）以及更复杂的授权逻辑一起使用（例如，让这仅当Subject使用密码在IDP上进行身份验证时，才会调用资源。</p><h2 id="JAX-RSSAML-ClaimsBasedAccessControl">基于声明的访问控制</h2><p>CXF JAX-RS支持使用从SAML断言中提取的声明，基于<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/core/src/main/java/org/apache/cxf/security/claims/authorization/Claim.java" rel="nofollow">声明</a>和<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/core/src/main/java/org/apache/cxf/security/claims/authorization/Claims.java" rel="nofollow">声明</a>注释的基于声明的访问控制（CBAC）。请参阅<span><a shape="rect" href="jax-rs-token-authorization.html">JAX-RS令牌授权</a></span>页面以获取更多信息。</p><h2 id="JAX-RSSAML-RoleBasedAccessControl">基于角色的访问控制</h2><p>CXF JAX-RS还基于从SAML断言中提取的角色声明支持基于角色的访问控制（RBAC）。请参阅<span><span><a shape="rect" href="jax-rs-token-authorization.html">JAX-RS令牌授权</a></span></span>页面以获取更多信息。</p><h1 id="JAX-RSSAML-SAMLWebSSOProfile">SAML Web SSO配置文件</h1><p>请参阅<a shape="rect" href="saml-web-sso.html">此页面</a>以获取更多信息</p></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=27830327">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=27830327&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>