<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - JAX-RS Advanced Features">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script src='/resources/highlighter/scripts/shBrushXml.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-JAX-RS高级功能</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="restful-services.html">RESTful服务</a> > <a href="jax-rs.html">JAX-RS</a> > <a href="jax-rs-advanced-features.html">JAX-RS高级功能</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><div class="aui-message aui-message-error"><p class="title"><strong>呈现宏'html'时出错</strong></p><p>您的Confluence管理员不允许在HTML宏中使用Javascript。可以使用HTML for Confluence Configuration更改此设置。请与您的管理员联系以获取详细信息。</p></div><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><p><br clear="none"><span style="font-size:2em;font-weight:bold">JAX-RS：高级功能</span>


<br clear="none"></p><p><br clear="none"></p><p><style type="text/css">/*<![CDATA[*/
div.rbtoc1566604703401 {padding: 0px;}
div.rbtoc1566604703401 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1566604703401 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style></p><div class="toc-macro rbtoc1566604703401">
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSAdvancedFeatures-JMSSupport">JMS支持</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSAdvancedFeatures-Endpoints">终点</a></li><li><a shape="rect" href="#JAX-RSAdvancedFeatures-Client">客户</a></li></ul>
</li><li><a shape="rect" href="#JAX-RSAdvancedFeatures-AdvancedSearch">高级搜索</a></li><li><a shape="rect" href="#JAX-RSAdvancedFeatures-Onewayinvocations">单向调用</a></li><li><a shape="rect" href="#JAX-RSAdvancedFeatures-SupportforContinuations">支持延续</a></li><li><a shape="rect" href="#JAX-RSAdvancedFeatures-Client-sidecaching">客户端缓存</a></li><li><a shape="rect" href="#JAX-RSAdvancedFeatures-Server-sidecaching">服务器端缓存</a></li><li><a shape="rect" href="#JAX-RSAdvancedFeatures-RESTfulserviceswithoutannotations">不含注释的RESTful服务</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSAdvancedFeatures-Configuration">组态</a></li></ul>
</li><li><a shape="rect" href="#JAX-RSAdvancedFeatures-QueryStringCustomization">查询字符串自定义</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSAdvancedFeatures-Collection/List">收藏/清单</a></li></ul>
</li></ul>
</div><h1 id="JAX-RSAdvancedFeatures-JMSSupport">JMS支持</h1><p>CXF的设计使得可以为给定的端点支持多种传输。CXF JAX-RS端点和代理可以选择支持JMS传输。</p><h2 id="JAX-RSAdvancedFeatures-Endpoints">终点</h2><p>如果您希望您的JAXRS端点不仅能够服务HTTP，而且能够服务JMS请求，那么您需要指定一个JMS transportId，例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;jaxrs:server serviceName="s:BookService" transportId="http://cxf.apache.org/transports/jms" address="/"&gt;
 &lt;jaxrs:serviceBeans&gt;
   &lt;bean class="org.apache.cxf.systest.jaxrs.JMSBookStore"/&gt;
 &lt;/jaxrs:serviceBeans&gt;
&lt;/jaxrs:server&gt;
</pre>
</div></div><p>另外，需要完成JMS队列或主题<a shape="rect" href="http://cxf.apache.org/docs/using-the-jmsconfigfeature.html">配置</a> ，例如，请参阅this <a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/jms/jms_server_config.xml" rel="nofollow">beans.xml</a> 。请注意，如何使用serviceName属性为jaxrs端点指定服务QName（默认值为{ <a shape="rect" class="external-link" href="http://reverse.package.name" rel="nofollow">http://reverse.package.name</a> } ServiceClassName），此服务名称用于配置jms目的地。</p><p>这是实际<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/jms/JAXRSJmsTest.java" rel="nofollow">测试</a> 。</p><p>以下是JMS属性，可帮助在JAXRS端点上匹配所需的方法：</p><ul class="alternate"><li>“ Content-Type”：默认为“ text / xml”</li><li>“接受”：默认为“ <strong>/</strong> ”</li><li>“ OnewayMessage”：默认为“ false”</li><li>“ org.apache.cxf.message。信息。REQUEST_URI”：默认为“ /”</li><li>“ org.apache.cxf.message。信息。HTTP_REQUEST_METHOD“：默认为“ POST”</li></ul><p>如果将JMS消息发送到主题目的地，则必须设置“ OnewayMessage”属性或确保使用org.apache.cxf.jaxrs.ext注释目标JAXRS方法。单程。</p><p>就REQUEST_URI而言，它最初是与jaxrs：server / @ address匹配的。因此，如果未将REQUEST_URI设置为“ /”，则jaxrs：server / @ address必须设置为“ /”。如果REQUEST_URI设置为“ / bar / foo”，并且<br clear="none">jaxrs：server / @ address设置为“ / bar”，那么它将是“ / foo”，用于查找根资源类及其方法。</p><p>通过引用诸如'org.apache.cxf.systest.jaxrs之类的bean。通过从多个jaxrs端点获取“ JMSBookStore”，您可以确保HTTP和JMS请求都由同一服务bean处理。在这种情况下，您可能需要使用CXF JAXRS特定的<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/ext/ProtocolHeaders.java" rel="nofollow">ProtocolHeader</a>上下文，该上下文将使您可以获取HTTP或JMS头。</p><h2 id="JAX-RSAdvancedFeatures-Client">客户</h2><p>从CXF 2.5.5和CXF 2.6.2开始，可以使用客户端代理在JMS端点上调用。所有需要做的就是提供一个JMS端点地址，然后照常继续使用代理。例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">// setup the the client
String endpointAddressUrlEncoded = "jms:jndi:dynamicQueues/test.jmstransport.text"
             + "?jndiInitialContextFactory=org.apache.activemq.jndi.ActiveMQInitialContextFactory"
             + "&amp;replyToName=dynamicQueues/test.jmstransport.response"
             + "&amp;jndiURL=tcp://localhost:" + JMS_PORT
             + "&amp;jndiConnectionFactoryName=ConnectionFactory";
               
JMSBookStore client = JAXRSClientFactory.create(endpointAddressUrlEncoded, JMSBookStore.class);
Book book = client.getBook("123");
assertEquals("Get a wrong response code.", 200, WebClient.client(client).getResponse().getStatus());
assertEquals("Get a wrong book id.", 123, book.getId());
</pre>
</div></div><p>客户端运行时将根据JAX-RS和其他注释（例如org.apache.cxf.jaxrs.ext）设置上一部分中描述的JMS属性。JMSBookStore资源类中可用）。</p><h1 id="JAX-RSAdvancedFeatures-AdvancedSearch">高级搜索</h1><p>请参阅<a shape="rect" href="jax-rs-search.html">JAX-RS搜索</a>以获取更多信息</p><h1 id="JAX-RSAdvancedFeatures-Onewayinvocations">单向调用</h1><p>带有org.apache.cxf.jaxrs.ext的资源方法。单向注释将被单向调用，原始请求返回202 HTTP状态。如果不能添加Oneway注释，则HTTP或JMS客户端也可以添加“ OnewayRequest”标头。</p><h1 id="JAX-RSAdvancedFeatures-SupportforContinuations">支持延续</h1><p>请参阅<a shape="rect" class="external-link" href="http://sberyozkin.blogspot.com/2008/12/continuations-in-cxf.html" rel="nofollow">此博客条目，其中</a>描述了JAX-RS（以及实际上）JAX-WS服务如何可以依赖CXF Continuations API。</p><p>请参阅“ <a shape="rect" href="continuations.html">继续”</a>页面以获取更多信息。</p><h1 id="JAX-RSAdvancedFeatures-Client-sidecaching">客户端缓存</h1><p>如果JAX-RS响应消息包含“ Cache-Control” HTTP标头，则可以使用<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/rs/client/src/main/java/org/apache/cxf/jaxrs/client/cache/CacheControlFeature.java" rel="nofollow">CacheControlFeature</a>在客户端缓存响应有效负载。CacheControlFeature使用javax.cache。缓存API（在cxf-rt-rs-client中是可选的）。因此，要使用CacheControlFeature，必须添加javax.cache API以及实现（例如EhCache）。例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;dependency&gt;
    &lt;groupId&gt;javax.cache&lt;/groupId&gt;
    &lt;artifactId&gt;cache-api&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.ehcache&lt;/groupId&gt;
    &lt;artifactId&gt;ehcache&lt;/artifactId&gt;
    &lt;version&gt;3.0.3&lt;/version&gt;
&lt;/dependency&gt;</pre>
</div></div><p>CacheControlFeature解析Cache-Control标头，并在适用于Cache-Control的“ max-age”属性（如果未指定max-age，则为“ Expires” HTTP标头）的情况下缓存Response有效负载。客户端下次调用远程服务时（目前仅支持GET），将从缓存中检索Response有效负载并取而代之（假设它没有过期），从而避免了不必要的往返。这是一个例子：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">CacheControlFeature cacheControlFeature = new CacheControlFeature();
cacheControlFeature.setCacheResponseInputStream(true);
Client client = ClientBuilder.newBuilder()
                           .register(cacheControlFeature)
                           .build();
WebTarget target = client.target(endpointAddress);

// First call
Response response = target.request().get();
// Second call should be cached
target.request().get();</pre>
</div></div><p>如果来自服务的初始响应包含“ ETag” HTTP标头，则消息过期后，CXF会将此值作为“ If-None-Match”标头发送给服务。同样，“ Last-Modified”作为“ If-Modified-Since”发送。CXF客户端还将缓存过期的有效负载。如果服务以304状态码响应，则旧消息有效负载将返回给客户端。</p><h1 id="JAX-RSAdvancedFeatures-Server-sidecaching">服务器端缓存</h1><p><a shape="rect" class="external-link" href="http://ehcache.org/documentation/web_caching.html" rel="nofollow">Ehcache-Web</a>和其他类似框架可用于为服务器端缓存提供高级支持。</p><p>例如，假设战争的名字是“ ehcache-cxf”，那么您唯一需要做的就是在CXF JAX-RS端点上插入Ehcache-Web到web.xml中添加以下声明：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;context-param&gt;
    &lt;param-name&gt;webAppRootKey&lt;/param-name&gt;
    &lt;param-value&gt;ehcache-cxf&lt;/param-value&gt;
&lt;/context-param&gt;
&lt;filter&gt;
    &lt;filter-name&gt;SimplePageCachingFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;net.sf.ehcache.constructs.web.filter.SimplePageCachingFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;varyHeader&lt;/param-name&gt;
        &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/init-param&gt;
&lt;/filter&gt;
    
&lt;filter-mapping&gt;
    &lt;filter-name&gt;SimplePageCachingFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
</pre>
</div></div><p>请参阅<a shape="rect" class="external-link" href="http://ehcache.org/documentation/web_caching.html" rel="nofollow">Ehcache-Web</a>页面以获取有关如何配置它的更多信息，这是一个示例：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;ehcache xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="../../main/config/ehcache.xsd"
    updateCheck="false"
    monitoring="autodetect"
    dynamicConfig="true"&gt;
	
	&lt;defaultCache
		maxElementsInMemory="10"
		eternal="false"
		timeToIdleSeconds="5"
		timeToLiveSeconds="10"
		overflowToDisk="true" /&gt;
	
    &lt;cache name="SimplePageCachingFilter"
		maxElementsInMemory="100"
		eternal="false"
		overflowToDisk="false"
		timeToIdleSeconds="5"
		timeToLiveSeconds="10"
        memoryStoreEvictionPolicy="LFU" /&gt;
&lt;/ehcache&gt;
</pre>
</div></div><p>此配置必须保存在ehcache-web.xml文件中，并且可以从根开始作为类路径资源使用。</p><h1 id="JAX-RSAdvancedFeatures-RESTfulserviceswithoutannotations">不含注释的RESTful服务</h1><p>最新的CXF JAX-RS扩展之一允许用户向外部模型提供运行时通常从诸如@ Path，@ PathParam，@ Consumes，@ Produces等JAX-RS批注中获取的信息。<br clear="none">在许多情况下，描述给定资源如何作为RESTful服务公开而不实际修改该资源可能是有利的。例如，当注册新的动态接口实现时，无法修改源代码时，将来的更新成本（例如，修改@Path批注的值）昂贵时，等等。</p><p>用户模型模式类型在<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/frontend/jaxrs/src/main/resources/schemas/jaxrs-common.xsd" rel="nofollow">jaxrs.xsd</a>中进行了<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/frontend/jaxrs/src/main/resources/schemas/jaxrs-common.xsd" rel="nofollow">描述</a> 。</p><p>顶级“模型”元素可以具有“资源”子元素。“资源”元素描述的资源类可以是根资源类，也可以是子资源类，并且可以具有描述“路径”，“产生”和“消耗”值的属性，并且具有“名称”属性，标识完全合格的资源类。<br clear="none">“资源”元素可以具有多个指向资源方法的“操作”元素（具有“名称”属性），并且可以具有“路径”，“产生”，“消耗”和“动词”（HTTP方法）值。不具有“动词”属性的“操作”元素被视为子资源定位符-相应的资源类必须在模型中可用，其“名称”属性与该操作的返回类型名称相匹配。<br clear="none">每个操作可以具有多个“参数”元素。“ param”元素的“ name”属性应与类资源方法中的相应参数名称匹配。它的“类型”可以具有以下值：“ PATH”，“ QUERY”，“ CONTEXT”，“ HEADER”，“ MATRIX”，“ COOKIE”，“ FORM”或“ REQUEST_BODY”。不必描述与响应类型相对应的参数。它还可以设置“ defaultValue”和“ encoded”值。</p><p>从CXF 2.3.2-SNAPSHOT开始，“单向”属性也可以应用于单个操作。</p><p>这是一个例子：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;model xmlns="http://cxf.apache.org/jaxrs"&gt;
  &lt;resource name="org.apache.cxf.systest.jaxrs.BookStoreNoAnnotations" path="bookstore"
    produces="application/json" consumes="application/json"&gt;
    &lt;operation name="getBook" verb="GET" path="/books/{id}" produces="application/xml"&gt;
       &lt;param name="id" type="PATH"/&gt;
    &lt;/operation&gt;
    &lt;operation name="getBookChapter" path="/books/{id}/chapter"&gt;
       &lt;param name="id" type="PATH"/&gt;
    &lt;/operation&gt;
    &lt;operation name="updateBook" verb="PUT"&gt;
       &lt;param name="book" type="REQUEST_BODY"/&gt;
    &lt;/operation&gt;
  &lt;/resource&gt;
  &lt;resource name="org.apache.cxf.systest.jaxrs.ChapterNoAnnotations"&gt;
    &lt;operation name="getItself" verb="GET"/&gt;
    &lt;operation name="updateChapter" verb="PUT" consumes="application/xml"&gt;
        &lt;param name="content" type="REQUEST_BODY"/&gt;
    &lt;/operation&gt;
  &lt;/resource&gt;
&lt;/model&gt;
</pre>
</div></div><p>该模型描述了两个资源，BookStoreNoAnnotations和ChapterNoAnnotations。BookStoreNoAnnotations资源具有三个资源操作，即“ getBook”，“ getBookChapter”和“ updateBook”。请注意，“ getBookChapter”操作元素（在模型中描述）没有“ verb”属性，因此运行时会将其标识为子资源定位符。<br clear="none">运行时将自检<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/BookStoreNoAnnotations.java" rel="nofollow">org.apache.cxf.systest.jaxrs。BookStoreNoAnnotations</a>类，并检查“ getBook”和“ getBookChapter”方法的返回类型。BookStoreNoAnnotations.getBookChapter（）方法的返回类型为<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/ChapterNoAnnotations.java" rel="nofollow">org.apache.cxf.systest.jaxrs。ChapterNoAnnotations，</a>因此将检查模型是否包含具有'name'属性等于'org.apache.cxf.systest.jaxrs的资源元素。ChapterNoAnnotations”。找到此资源后，将ChapterNoAnnotations类识别为子资源，然后检查其“ getItself”方法。</p><p>另外，BookStoreNoAnnotations资源声明其所有资源方法都产生“ application / json” mediaTypes，而其“ getBook”方法用其自己的“ produces”值覆盖它。BookStoreNoAnnotations资源还具有“ consums”属性，该属性要求所有资源方法（例如“ updateBook”）使用“ application / json”格式。ChapterNoAnnotations“ updateChapter”资源操作需要“ application / xml”格式。</p><p>如果需要，您可以使用逗号分隔的媒体类型值列表，例如，produces（“ application / xml; charset = utf-8，application / json”）或消耗（“ application / xml; charset = utf-8， application / json”）。</p><p>还请参见此<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/resources/resources2.xml" rel="nofollow">模型文件</a>作为示例。提供此文件将使此模型实例中描述的接口的所有实现都公开为JAX-RS运行时支持的RESTful服务。</p><h2 id="JAX-RSAdvancedFeatures-Configuration">组态</h2><p>可以通过多种方式引用用户模型。它可以嵌入jaxrs：server端点定义中，或通过jaxrs：server modelRef属性链接为类路径资源。</p><p>请参阅此<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/systests/jaxrs/src/test/resources/jaxrs/WEB-INF/beans.xml" rel="nofollow">bean</a> Spring配置文件，查看具有'bookservice6'和'bookservice7'名称的jaxrs服务器bean。</p><p>请注意，从Spring注册模型时，无需声明jaxrs服务器的serviceBeans部分-运行时将实例化bean本身。如果确实需要从Spring向服务bean中注入某些属性，则也需要声明服务bean。在这种情况下，该bean将被实例化两次-一次在模型自省期间由运行时实例化，一次由Spring实例化，但是最后将使用Spring创建的bean，然后将其删除。<br clear="none">您可以通过模型描述实际的根资源Bean将实现的接口来避免这种双重实例化。在这种情况下，只有Spring会创建一个bean，运行时会将模型描述应用于该注入的bean。请注意，如果Spring代理了您的bean（例如，通过向其应用事务方面），则该模型确实必须描述一个接口，以使模型与注入的bean代理之间的匹配成功。</p><p>请看一下<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/systests/jaxrs/src/test/resources/jaxrs_proxy/WEB-INF/beans.xml" rel="nofollow">这个春豆</a> 。标识为'bookservice2'的jaxrs端点将创建两次BookStoreWithNoAnnotations，但它将是Spring创建的BookStoreWithNoAnnotations Bean，它将充当资源类实例。标识为'bookservice3'的jaxrs终结点将具有仅由Spring实例化的BookStoreWithNoAnnotationsImpl类，该模型仅描述该类实现的BookStoreWithNoAnnotationsInterface。</p><p>您还可以通过编程方式注册模型，例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">JAXRSServerFactoryBean sf = new JAXRSServerFactoryBean();
            sf.setAddress("http://localhost:9080/");
String modelRef = "classpath:/org/apache/cxf/systest/jaxrs/resources/resources2.xml";
sf.setModelRef(modelRef);

// or if you have interface classes described in the model already loaded, ex : OSGI
// sf.setModelRefWithServiceClass(modelRef, BookStoreNoAnnotationsInterface.class);

// register an actual bean only if the model describes interfaces
sf.setServiceBeans(new BookStoreNoAnnotationsImpl());
</pre>
</div></div><p>另请参见此<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/JAXRSClientServerUserResourceTest.java" rel="nofollow">系统测试</a> ，以获取有关如何以编程方式创建和注册模型bean（例如UserResource）的示例。</p><p>同样，您可以从jaxrs：client或以编程方式在客户端注册用户模型，例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">JAXRSClientFactoryBean cf = new JAXRSClientFactoryBean();
cf.setAddress("http://localhost:9080/");
String modelRef = "classpath:/org/apache/cxf/systest/jaxrs/resources/resources2.xml";
sf.setModelRef(modelRef);
BookStoreNoAnnotations proxy = cf.create(BookStoreNoAnnotations.class);
</pre>
</div></div><p>目前，只能使用最新的2.2.3-SNAPSHOT向CXFNonSpringJAXRSServlet注册用户模型，就像在此<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/systests/jaxrs/src/test/resources/jaxrs_non_spring/WEB-INF/web.xml" rel="nofollow">web.xml中</a>完成的方式一样。请参阅CXFServlet3和CXFServlet4 Servlet声明。请注意，CXFServlet4注册了一个包含接口的模型，因此它还注册了BookStoreNoAnnotationsImpl服务类。</p><p>解决方法是创建一个自定义servlet：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">public class JAXRSUserModelServlet extends CXFNonSpringJaxrsServlet  {

    @Override
    public void loadBus(ServletConfig servletConfig) throws ServletException {
        super.loadBus(servletConfig);

        JAXRSServerFactoryBean sf = new JAXRSServerFactoryBean();
        String address = servletConfig.getInitParameter(SERVICE_ADDRESS_PARAM); //jaxrs.address
        if (address == null) {
            address = "/";
        }
        sf.setAddress(address);

        // modelRef needs to start from 'classpath:', ex 'classpath:/WEB-INF/models/model1.xml
        String modelRef = servletConfig.getInitParameter("user.model");
        sf.setModelRef(modelRef);
        sf.create();
    }
} </pre>
</div></div><h1 class="auto-cursor-target" id="JAX-RSAdvancedFeatures-QueryStringCustomization">查询字符串自定义</h1><p>CXF提供了有关查询字符串解析和扩展的高级功能。</p><h2 id="JAX-RSAdvancedFeatures-Collection/List">收藏/清单</h2><p><a shape="rect" class="external-link" rel="nofollow" href="https://tools.ietf.org/html/rfc6570">RFC-6570：URI模板</a> （ <a shape="rect" class="external-link" rel="nofollow" href="https://tools.ietf.org/html/rfc6570">https://tools.ietf.org/html/rfc6570</a> ）中描述了管理集合/列表查询参数的典型方法，并且基本上假定名称/值对的重复，例如： <a shape="rect" class="external-link" rel="nofollow" href="http://localhost:8080/MovieDB/GetJson?name=Actor1,Actor2,Actor3&startDate=20120101&endDate=20120505" title="跟随链接">http ：// localhost：8080 / MovieDB / GetJson？name = Actor1＆name = Actor2＆name = Actor3＆startDate = 20120101＆endDate = 2012050</a></p><p>从<strong>3.1.8+开始</strong> ，可以使用服务器端的<strong>“ parse.query.value.as.collection”</strong>属性来调整此行为，该属性增加了对以逗号分隔的值传递的collection / list参数的支持，例如： <a shape="rect" class="external-link" title="跟随链接" href="http://localhost:8080/MovieDB/GetJson?name=Actor1,Actor2,Actor3&startDate=20120101&endDate=20120505" rel="nofollow">http：/ / localhost：8080 / MovieDB / GetJson？name = Actor1，Actor2，Actor3＆startDate = 20120101＆endDate = 2012050</a></p><p>缺少客户端支持，并在<strong>3.3.4+ / 3.2.11+ / 3.4.0+中</strong>为所有类型的客户端（WebClient，JAX-RS客户端代理和Microprofile客户端）添加了客户端支持。匹配的属性名称是<strong>“ expand.query.value.as.collection”</strong> ，可以在创建客户端实例期间指定，例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">MyClient client = JAXRSClientFactory
    .create("http://localhost:8080", MyClient.class,
        Collections.singletonMap("expand.query.value.as.collection", "true"));</pre>
</div></div><p><br clear="none"></p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">WebClient client = WebClient.create("http://localhost:8080", 
    Collections.singletonMap("expand.query.value.as.collection", "true"));</pre>
</div></div><p><br clear="none"></p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">MyClient client = RestClientBuilder
    .newBuilder()
    .property("expand.query.value.as.collection", "true")
    .baseUri(new URI("http://localhost:8080"))
    .build(MyClient.class);
</pre>
</div></div><p><br clear="none"></p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">WebTarget target = ClientBuilder
    .newClient()
    .property("expand.query.value.as.collection", "true")
    .target("http://localhost:8080");</pre>
</div></div></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=24190907">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=24190907&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>