<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - MTOM">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script src='/resources/highlighter/scripts/shBrushXml.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-MTOM</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="wsdl-bindings.html">WSDL绑定</a> > <a href="mtom.html">MTOM</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><form id="cse-search-box" enctype="application/x-www-form-urlencoded" method="get" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="搜索">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><h1 id="MTOM-UsingMTOM">使用MTOM</h1><p>SOAP消息传输优化机制（ <a shape="rect" class="external-link" href="http://www.w3.org/TR/soap12-mtom/" rel="nofollow">MTOM</a> ）指定了一种用于将二进制数据作为SOAP消息的一部分发送的优化方法。与带有附件的SOAP不同，MTOM需要使用XML二进制优化打包（XOP）包来传输二进制数据。使用MTOM发送二进制数据不需要您将SOAP Multipart / Related消息完全定义为SOAP绑定的一部分。但是，它确实要求您执行以下操作：</p><ol><li>注释要作为附件发送的数据。<br class="atl-forced-newline" clear="none">您可以注释WSDL或实现数据的Java类。</li><li>启用运行时的MTOM支持。<br class="atl-forced-newline" clear="none">这可以通过编程或通过配置来完成。</li><li>开发一个<code>DataHandler</code>用于作为附件传递的数据。</li></ol><h2 id="MTOM-AnnotatingDataTypestouseMTOM">注释数据类型以使用MTOM</h2><h3 id="MTOM-Overview">总览</h3><p>在WSDL中定义用于传递二进制数据块（例如图像文件或声音文件）的数据类型时，您将数据元素定义为类型<code>xsd:base64Binary</code> 。默认情况下，任何类型的元素<code>xsd:base64Binary</code>导致产生一个<code>byte[]</code>可以使用MTOM序列化。但是，代码生成器的默认行为并未充分利用序列化。</p><p>为了充分利用MTOM，必须将注释添加到服务的WSDL文档或实现二进制数据结构的JAXB类中。在WSDL文档中添加注释会强制代码生成器为二进制数据生成流数据处理程序。注释JAXB类涉及指定适当的内容类型，还可能涉及更改包含二进制数据的字段的类型规范。</p><h3 id="MTOM-WSDLfirst">WSDL首先</h3><p>以下示例显示了一个Web服务的WSDL文档，该文档使用一条消息，该消息包含一个字符串字段，一个整数字段和一个二进制字段。二进制字段旨在携带大图像文件，因此不适合作为普通SOAP消息的一部分发送。</p><div class="code panel pdl" style="border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px"><b>给MTOM的消息</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions name="XrayStorage"
    targetNamespace="http://mediStor.org/x-rays"
    xmlns="http://schemas.xmlsoap.org/wsdl/"
    xmlns:tns="http://mediStor.org/x-rays"
    xmlns:soap12="http://schemas.xmlsoap.org/wsdl/soap12/"
    xmlns:xsd1="http://mediStor.org/types/"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;

  &lt;types&gt;
    &lt;schema targetNamespace="http://mediStor.org/types/"
            xmlns="http://www.w3.org/2001/XMLSchema"&gt;
      &lt;complexType name="xRayType"&gt;
        &lt;sequence&gt;
          &lt;element name="patientName" type="xsd:string" /&gt;
          &lt;element name="patientNumber" type="xsd:int" /&gt;
          &lt;element name="imageData" type="xsd:base64Binary" /&gt;
        &lt;/sequence&gt;
      &lt;/complexType&gt;
      &lt;element name="xRay" type="xsd1:xRayType" /&gt;
    &lt;/schema&gt;
  &lt;/types&gt;

  &lt;message name="storRequest"&gt;
    &lt;part name="record" element="xsd1:xRay"/&gt;
  &lt;/message&gt;
  &lt;message name="storResponse"&gt;
    &lt;part name="success" type="xsd:boolean"/&gt;
  &lt;/message&gt;

  &lt;portType name="xRayStorage"&gt;
    &lt;operation name="store"&gt;
      &lt;input message="tns:storRequest" name="storRequest"/&gt;
      &lt;output message="tns:storResponse" name="storResponse"/&gt;
    &lt;/operation&gt;
  &lt;/portType&gt;

  &lt;binding name="xRayStorageSOAPBinding" type="tns:xRayStorage"&gt;
    &lt;soap12:binding style="document" transport="http://schemas.xmlsoap.org/soap/http"/&gt;
    &lt;operation name="store"&gt;
      &lt;soap12:operation soapAction="" style="document"/&gt;
      &lt;input name="storRequest"&gt;
        &lt;soap12:body use="literal"/&gt;
      &lt;/input&gt;
      &lt;output name="storResponse"&gt;
        &lt;soap12:body use="literal"/&gt;
      &lt;/output&gt;
    &lt;/operation&gt;
  &lt;/binding&gt;
  ...
&lt;/definitions&gt;
</pre>
</div></div><p>如果您想使用MTOM作为优化的附件发送邮件的二进制部分，则需要添加<code>xmime:expectedContentTypes</code>属性包含二进制数据的元素。此属性在<code><a shape="rect" class="external-link" href="http://www.w3.org/2005/05/xmlmime" rel="nofollow">http://www.w3.org/2005/05/xmlmime</a></code>名称空间，并指定元素应包含的MIME类型。您可以指定以逗号分隔的MIME类型列表。此属性的设置将更改代码生成器如何为数据创建JAXB类。对于大多数MIME类型，代码生成器将创建一个<code>DataHandler</code> 。某些MIME类型（例如图像的MIME类型）已定义了映射。</p><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>MIME类型由Internet号码分配机构（IANA）维护，并在<strong>多用途Internet邮件扩展（MIME）第一部分：Internet邮件正文的格式</strong> （ <a shape="rect" class="external-link" href="ftp://ftp.isi.edu/in-notes/rfc2045.txt" rel="nofollow">ftp://ftp.isi.edu/in-notes/rfc2045</a> ）中进行了详细描述<a shape="rect" class="external-link" href="ftp://ftp.isi.edu/in-notes/rfc2045.txt" rel="nofollow">.txt</a> ）和<strong>多用途Internet邮件扩展（MIME）第二部分：媒体类型</strong> （ <a shape="rect" class="external-link" href="ftp://ftp.isi.edu/in-notes/rfc2046.txt" rel="nofollow">ftp://ftp.isi.edu/in-notes/rfc2046.txt</a> ）</p></div></div><div class="confluence-information-macro confluence-information-macro-tip"><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>对于大多数用途，您可以指定<code>application/octet-stream</code> 。</p></div></div><p>以下示例显示了如何修改<code>xRayType</code>使用MTOM。</p><div class="code panel pdl" style="border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px"><b>MTOM的二进制数据</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">...
  &lt;types&gt;
    &lt;schema targetNamespace="http://mediStor.org/types/"
            xmlns="http://www.w3.org/2001/XMLSchema"
            xmlns:xmime="http://www.w3.org/2005/05/xmlmime"&gt;
      &lt;complexType name="xRayType"&gt;
        &lt;sequence&gt;
          &lt;element name="patientName" type="xsd:string" /&gt;
          &lt;element name="patientNumber" type="xsd:int" /&gt;
          &lt;element name="imageData" type="xsd:base64Binary"
                   xmime:expectedContentTypes="application/octet-stream"/&gt;
        &lt;/sequence&gt;
      &lt;/complexType&gt;
      &lt;element name="xRay" type="xsd1:xRayType" /&gt;
    &lt;/schema&gt;
  &lt;/types&gt;
...
</pre>
</div></div><p>为以下生成的JAXB类<code>xRayType</code>将不再包含<code>byte[]</code> 。相反，代码生成器将看到<code>xmime:expectedContentTypes</code>属性并生成一个<code>DataHandler</code>为了<code>imageData</code>领域。</p><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>您无需更改绑定元素即可使用MTOM。发送数据时，运行时将进行适当的更改。</p></div></div><h3 id="MTOM-Javafirst">Java优先</h3><p>如果您正在进行Java首次开发，则可以通过执行以下操作来准备JAXB类MTOM：</p><ol><li>确保包含二进制数据的字段是<code>DataHandler</code> 。</li><li>添加<code>@XmlMimeType()</code>包含要作为MTOM附件流传输的数据的字段的注释。</li></ol><p>以下示例显示了一个注释为使用MTOM的JAXB类。</p><div class="code panel pdl" style="border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px"><b>MTOM的JAXB类</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">@XmlType
public class XRayType {
    protected String patientName;
    protected int patientNumber;
    @XmlMimeType("application/octet-stream")
    protected DataHandler imageData;
  ...
}
</pre>
</div></div><h2 id="MTOM-EnablingMTOM">启用MTOM</h2><p>默认情况下，运行时不启用MTOM支持。它会将所有二进制数据作为普通SOAP消息的一部分或未优化的附件发送。您可以通过编程或使用配置来激活MTOM支持。</p><h3 id="MTOM-UsingJAX-WSAPIs">使用JAX-WS API</h3><p>客户端和服务器都需要启用MTOM优化。JAX-WS API为每种类型的端点提供不同的机制。</p><h4 id="MTOM-server">服务器</h4><p>如果使用JAX-WS API发布服务器，则可以启用运行时的MTOM支持，如下所示：</p><ol><li>进入<code>Endpoint</code>您发布的服务的对象。<br class="atl-forced-newline" clear="none">最简单的方法<code>Endpoint</code>对象是发布端点时的对象。</li><li><p>从取得SOAP绑定<code>Endpoint</code>使用其<code>getBinding()</code>方法如下图所示。</p><div class="code panel pdl" style="border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px"><b>从端点获取SOAP绑定</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">// Endpoint ep is declared previously
SOAPBinding binding = (SOAPBinding)ep.getBinding();
</pre>
</div></div><p>您必须将返回的绑定对象强制转换为<code>SOAPBinding</code>对象以访问MTOM属性。</p></li><li><p>使用绑定的setMTOMEnabled（）方法将绑定的MTOM enabled属性设置为true，如下所示。</p><div class="code panel pdl" style="border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px"><b>设置服务提供商的MTOM启用属性</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">binding.setMTOMEnabled(true);
</pre>
</div></div></li></ol><h4 id="MTOM-Client">客户</h4><p>要使MTOM启用JAX-WS客户端，请执行以下操作：</p><ol><li>将客户的代理服务器转换为<code>BindingProvider</code>宾语。</li><li><p>从取得SOAP绑定<code>BindingProvider</code>使用其<code>getBinding()</code>方法如下图所示。</p><div class="code panel pdl" style="border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px"><b>从BindingProvider获取SOAP绑定</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">// BindingProvider bp declared previously
SOAPBinding binding = (SOAPBinding)bp.getBinding();
</pre>
</div></div></li><li><p>将绑定MTOM启用属性设置为<code>true</code>使用绑定的<code>setMTOMEnabled()</code>方法如下图所示。</p><div class="code panel pdl" style="border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px"><b>设置消费者启用MTOM的属性</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">binding.setMTOMEnabled(true);
</pre>
</div></div></li></ol><h3 id="MTOM-Usingconfiguration">使用配置</h3><h4 id="MTOM-Overview.1">总览</h4><p>如果使用XML发布服务，例如在部署到容器中时，可以在端点的配置文件中启用端点的MTOM支持。</p><h4 id="MTOM-ConfigFileProcedure"><span class="confluence-anchor-link" id="MTOM-ConfigFile"></span>程序</h4><p>MTOM属性设置在<code>jaxws:endpoint</code>端点的元素。要启用MTOM，请执行以下操作：</p><ol><li>添加一个<code>jaxws:property</code>端点的子元素<code>jaxws:endpoint</code>元件。</li><li>添加一个<code>entry</code>子元素<code>jaxws:property</code>元件。</li><li>设置<code>entry</code>元素的<code>key</code>归因于<code>mtom-enabled</code> 。</li><li>设置<code>entry</code>元素的<code>value</code>归因于<code>true</code> 。</li></ol><h4 id="MTOM-Example">例</h4><p>以下示例显示了启用了MTOM的端点。</p><div class="code panel pdl" style="border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px"><b>启用MTOM的配置</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jaxws="http://cxf.apache.org/jaxws"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
                           http://cxf.apache.org/jaxws http://cxf.apache.org/schema/jaxws.xsd"&gt;

  &lt;jaxws:endpoint id="xRayStorage"
                  implementor="demo.spring.xRayStorImpl"
                  address="http://localhost/xRayStorage"&gt;
    &lt;jaxws:properties&gt;
      &lt;entry key="mtom-enabled" value="true"/&gt;
    &lt;/jaxws:properties&gt;
  &lt;/jaxws:endpoint&gt;
&lt;/beans&gt;
</pre>
</div></div></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=60618">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=60618&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>