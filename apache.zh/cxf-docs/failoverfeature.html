<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - FailoverFeature">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script src='/resources/highlighter/scripts/shBrushXml.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-故障转移功能</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="configuration.html">配置</a> > <a href="featureslist.html">功能</a>列表> <a href="failoverfeature.html">故障转移功能</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><form id="cse-search-box" enctype="application/x-www-form-urlencoded" method="get" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="搜索">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><h1 id="FailoverFeature-FailoverandLoadDistributorFeature">故障转移和负载分配器功能</h1><p><style type="text/css">/*<![CDATA[*/
div.rbtoc1524513423792 {padding: 0px;}
div.rbtoc1524513423792 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1524513423792 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style></p><div class="toc-macro rbtoc1524513423792">
<ul class="toc-indentation"><li><a shape="rect" href="#FailoverFeature-FailoverandLoadDistributorFeature">故障转移和负载分配器功能</a></li><li><a shape="rect" href="#FailoverFeature-Failover">故障转移</a></li><li><a shape="rect" href="#FailoverFeature-CircuitBreakersFailover">断路器故障转移</a></li><li><a shape="rect" href="#FailoverFeature-LoadDistribution">负荷分配</a></li><li><a shape="rect" href="#FailoverFeature-ConfiguringJAX-RSclients">配置JAX-RS客户端</a></li></ul>
</div><h1 id="FailoverFeature-Failover">故障转移</h1><p>CXF故障转移功能允许将CXF前端客户端配置为在目标端点不可用时重试呼叫。<br clear="none">可以使用多种重试策略：客户端可以顺序访问备用地址，也可以随机选择。<br clear="none">可以将每种策略配置为在选择地址之间进行延迟。</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jaxws="http://cxf.apache.org/jaxws"
       xmlns:clustering="http://cxf.apache.org/clustering"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="
http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd
http://cxf.apache.org/clustering http://cxf.apache.org/schemas/clustering.xsd
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd"&gt;
    &lt;bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"/&gt;
    
    &lt;util:list id="addressList"&gt;
        &lt;value&gt;http://localhost:${testutil.ports.Server.1}/services1&lt;/value&gt;
        &lt;value&gt;http://localhost:${testutil.ports.Server.2}/services2&lt;/value&gt;
        &lt;value&gt;http://localhost:${testutil.ports.Server.3}/services3&lt;/value&gt;
    &lt;/util:list&gt;

    &lt;bean id="SequentialAddresses" class="org.apache.cxf.clustering.SequentialStrategy"&gt;
        &lt;property name="alternateAddresses"&gt;
            &lt;ref bean="addressList"/&gt;
        &lt;/property&gt;
        &lt;!-- delay a retry for 1/10 of a second --&gt;
        &lt;property name="delayBetweenRetries" value="100"/&gt;
    &lt;/bean&gt;

    &lt;bean id="RandomAddresses" class="org.apache.cxf.clustering.RandomStrategy"&gt;
        &lt;property name="alternateAddresses"&gt;
            &lt;ref bean="addressList"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;!-- other jaxws:client attributes and elements are omitted for brevity --&gt;
    
    &lt;jaxws:client id="clientWithSeqFailoverSupport" address="http://localhost:8080/services"&gt;
       &lt;jaxws:features&gt;
           &lt;clustering:failover&gt;
                &lt;clustering:strategy&gt;
                    &lt;ref bean="SequentialAddresses"/&gt;
                &lt;/clustering:strategy&gt;
            &lt;/clustering:failover&gt;
       &lt;/jaxws:features&gt;
    &lt;/jaxws:client&gt;

    &lt;!-- other jaxws:client attributes and elements are omitted for brevity --&gt;

    &lt;jaxws:client id="clientWithRandomFailoverSupport" address="http://localhost:8080/initialAddress"&gt;
       &lt;jaxws:features&gt;
           &lt;clustering:failover&gt;
                &lt;clustering:strategy&gt;
                    &lt;ref bean="RandomAddresses"/&gt;
                &lt;/clustering:strategy&gt;
            &lt;/clustering:failover&gt;
       &lt;/jaxws:features&gt;
    &lt;/jaxws:client&gt;

&lt;/beans&gt;
</pre>
</div></div><p>注意，org.apache.cxf.clustering。在切换到下一个地址之前，可以使用RetryStrategy重试相同的最后一个地址有限次。使用RetryStrategy'maxNumberOfRetries'属性。RetryStrategy当前使用顺序算法来选择地址。</p><h1 id="FailoverFeature-CircuitBreakersFailover">断路器故障转移</h1><p>CXF故障转移功能的最新添加是基于断路器的实现，更确切地说是基于Apache Zest（ <a shape="rect" class="external-link" href="https://zest.apache.org/">https://zest.apache.org/</a> ）库。该配置与常规故障转移策略非常相似，唯一的区别是使用<strong>clustering：circuit-breaker-failover</strong>元素。</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jaxws="http://cxf.apache.org/jaxws"
       xmlns:clustering="http://cxf.apache.org/clustering"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="
http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd
http://cxf.apache.org/clustering http://cxf.apache.org/schemas/clustering.xsd
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd"&gt;
    &lt;bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"/&gt;
    
    &lt;util:list id="addressList"&gt;
        &lt;value&gt;http://localhost:${testutil.ports.Server.1}/services1&lt;/value&gt;
        &lt;value&gt;http://localhost:${testutil.ports.Server.2}/services2&lt;/value&gt;
        &lt;value&gt;http://localhost:${testutil.ports.Server.3}/services3&lt;/value&gt;
    &lt;/util:list&gt;

    &lt;bean id="SequentialAddresses" class="org.apache.cxf.clustering.SequentialStrategy"&gt;
        &lt;property name="alternateAddresses"&gt;
            &lt;ref bean="addressList"/&gt;
        &lt;/property&gt;
        &lt;!-- delay a retry for 1/10 of a second --&gt;
        &lt;property name="delayBetweenRetries" value="100"/&gt;
    &lt;/bean&gt;

    &lt;bean id="RandomAddresses" class="org.apache.cxf.clustering.RandomStrategy"&gt;
        &lt;property name="alternateAddresses"&gt;
            &lt;ref bean="addressList"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;!-- other jaxws:client attributes and elements are omitted for brevity --&gt;
    
    &lt;jaxws:client id="clientWithSeqFailoverSupport" address="http://localhost:8080/services"&gt;
       &lt;jaxws:features&gt;
           &lt;clustering:circuit-breaker-failover threshold="1" timeout="60000"&gt;
               &lt;clustering:strategy&gt;                   
                   &lt;ref bean="SequentialAddresses"/&gt;
               &lt;/clustering:strategy&gt;
            &lt;/clustering:circuit-breaker-failover&gt;
       &lt;/jaxws:features&gt;
    &lt;/jaxws:client&gt;

    &lt;!-- other jaxws:client attributes and elements are omitted for brevity --&gt;

    &lt;jaxws:client id="clientWithRandomFailoverSupport" address="http://localhost:8080/initialAddress"&gt;
       &lt;jaxws:features&gt;
           &lt;clustering:circuit-breaker-failover threshold="1" timeout="60000"&gt;
                &lt;clustering:strategy&gt;
                    &lt;ref bean="RandomAddresses"/&gt;
                &lt;/clustering:strategy&gt;
            &lt;/clustering:circuit-breaker-failover&gt;
       &lt;/jaxws:features&gt;
    &lt;/jaxws:client&gt;

&lt;/beans&gt;</pre>
</div></div><p>断路器已经推荐自己作为一种行之有效的策略来处理和监视与外部服务呼叫相关的故障，从而通过防止无休止的重试或超时，使外部系统有时间恢复。因此，可以调整两个配置参数：</p><ul style="list-style-type:square"><li><strong>阈值</strong> ：打开断路器的错误阈值</li><li><strong>timeout</strong> ：尝试下一次调用之前要等待的超时</li></ul><h1 id="FailoverFeature-LoadDistribution">负荷分配</h1><p>负载分配器功能是一种故障转移功能，该功能可以使客户端在每个新呼叫上遍历备用地址，而不管最后一个呼叫是否已达到其目标。它可以帮助控制源自各个服务器上CXF客户端的流量。</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jaxws="http://cxf.apache.org/jaxws"
       xmlns:clustering="http://cxf.apache.org/clustering"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="
http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd
http://cxf.apache.org/clustering http://cxf.apache.org/schemas/clustering.xsd
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd"&gt;
    &lt;bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"/&gt;     

    &lt;util:list id="addressList"&gt;
        &lt;value&gt;http://localhost:${testutil.ports.Server.1}/services1&lt;/value&gt;
        &lt;value&gt;http://localhost:${testutil.ports.Server.2}/services2&lt;/value&gt;
        &lt;value&gt;http://localhost:${testutil.ports.Server.3}/services3&lt;/value&gt;
    &lt;/util:list&gt;

    &lt;bean id="SequentialAddresses" class="org.apache.cxf.clustering.SequentialStrategy"&gt;
        &lt;property name="alternateAddresses"&gt;
            &lt;ref bean="addressList"/&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;!-- other jaxws:client attributes and elements are omitted for brevity --&gt;
    
    &lt;jaxws:client id="clientWithLoadDistributor" address="http://localhost:8080/services"&gt;
       &lt;jaxws:features&gt;
           &lt;clustering:loadDistributor&gt;
                &lt;clustering:strategy&gt;
                    &lt;ref bean="SequentialAddresses"/&gt;
                &lt;/clustering:strategy&gt;
            &lt;/clustering:loadDistributor&gt;
       &lt;/jaxws:features&gt;
    &lt;/jaxws:client&gt;
&lt;/beans&gt;
</pre>
</div></div><h1 id="FailoverFeature-ConfiguringJAX-RSclients">配置JAX-RS客户端</h1><p>JAX-RS客户端的配置与JAX-WS客户端的配置完全相同，请参阅<a shape="rect" href="https://cwiki.apache.org/confluence/display/CXF20DOC/JAX-RS+Failover">此页面</a>以获取更多信息。</p></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=33298616">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=33298616&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>