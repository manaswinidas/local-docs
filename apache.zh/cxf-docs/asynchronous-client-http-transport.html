<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - Asynchronous Client HTTP Transport">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-异步客户端HTTP传输</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="transports.html">传输</a> > <a href="http-transport.html">HTTP传输</a> > <a href="asynchronous-client-http-transport.html">异步客户端HTTP传输</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><form id="cse-search-box" enctype="application/x-www-form-urlencoded" method="get" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="搜索">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><h1 id="AsynchronousClientHTTPTransport-AsynchronousClientHTTPTransport">异步客户端HTTP传输</h1><p>默认情况下，CXF使用基于JDK中HttpURLConnection对象的传输来执行HTTP请求。HttpURLConnection对象对所有需要按线程执行模型的IO操作使用阻塞模型。从纯粹的性能角度来看，该模型通常表现很好，但是当需要同时执行许多请求时，它确实存在缩放问题。</p><p>而且，JAX-WS规范允许在生成的代理上生成异步方法，以及在Dispatch对象上使用异步方法。这些方法可以采用AsyncHandler对象，并返回轮询Future对象，因此应用程序不必等待响应。使用基于HttpURLConnection的传输，CXF被迫为每个未完成的请求消耗一个后台线程。</p><p>CXF还具有基于<a shape="rect" class="external-link" href="http://hc.apache.org/httpcomponents-asyncclient-dev/index.html">Apache HTTP组件HttpAsyncClient</a>库的HTTP客户端传输。它的MavenartifactId是<span style="line-height:1.4285715">cxf-rt-transports-http-hc。</span> <span style="line-height:1.4285715"> HttpAsyncClient库使用非阻塞IO模型。这允许处理更多的请求，而不会占用额外的后台线程。它还允许对诸如Keep-Alive处理之类的事情进行更好的控制，这对于基于HttpURLConnection的传输来说是非常困难或不可能的。但是，非阻塞模型的性能不及纯同步请求/响应事务的阻塞模型。</span></p><p>默认情况下，如果在类路径上找到cxf-rt-transports-http-hc模块，则CXF将对任何Async调用使用基于HttpAsyncClient的实现，但将继续对同步调用使用基于HttpURLConnection的传输。这样可以在常见的同步案例与异步案例的可伸缩性之间实现良好的性能平衡。但是，使用上下文属性“ use.async.http.conduit”并将其设置为true / false，则可以控制使用异步版本还是阻止版本。如果为“ true”，则即使进行同步调用也将使用HttpAsyncClient；如果为“ false”，则异步调用将依赖于使用HTTPURLConnection和工作队列来模仿异步性的传统方法。而且，如果TLSClientParameters设置了SSLSocketFactory，则因为SocketFactory类和SocketFactory＃createSocket方法特别固有地阻塞，并且以这种方式实例化的套接字不能用于异步，因此这导致使用基于HttpURLConnection的传输。</p><p>使用异步传输的另一个原因是使用HttpURLConnection不支持的HTTP方法。例如，在某些情况下，github.com REST API指定使用PATCH，但是HttpURLConnection拒绝PATCH。</p><h3 id="AsynchronousClientHTTPTransport-UsingtheHTTPComponentsTransportfromJavaCode">使用Java代码中的HTTP组件传输</h3><p>要强制全局使用HTTP组件传输，可以设置总线级属性：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;"> Bus bus = BusFactory.getDefaultBus();
 // insist on the async connector to use PATCH.
 bus.setProperty(AsyncHTTPConduit.USE_ASYNC, Boolean.TRUE);</pre>
</div></div><pre><span style="font-size: 16.0px;line-height: 1.5625;font-family: Arial , sans-serif;">Setting Credentials</span></pre><p>通过BindingProvider设置用户凭据的“普通” CXF / JAX-WS方法。USERNAME_PROPERTY / PASSWORD_PROPERTY也将与异步传输一起使用。但是，HttpAsyncClient库确实具有一些可以利用的NTLM附加功能。为了使用它，您需要：</p><ul><li>打开自动重定向，然后关闭导管的分块。这将允许CXF以允许传输在身份验证协商期间继续重新发送请求的方式缓存响应。</li></ul><ul><li><p>即使同步调用也强制使用异步传输</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">bp.getRequestContext().put("use.async.http.conduit", Boolean.TRUE);
</pre>
</div></div></li></ul><ul><li><p>设置属性“ org.apache.http.auth。凭证”到该凭证的实例。例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">Credentials creds = new NTCredentials("username", "pswd", null, "domain");
bp.getRequestContext().put(Credentials.class.getName(), creds);
</pre>
</div></div></li></ul><h3 id="AsynchronousClientHTTPTransport-Configuration">组态</h3><p>异步HTTP传输具有几个选项，可以使用总线属性或通过OSGi配置服务来设置这些选项，以控制基础Apache HTTP组件HttpAsyncClient对象的各个方面。</p><p>与基础TCP套接字相关的设置（请参阅<a shape="rect" class="external-link" href="http://docs.oracle.com/javase/7/docs/api/java/net/Socket.html" rel="nofollow">java.net。这些值的定义的套接字</a> ）：</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.cxf.transport.http.async。TCP_NODELAY（默认为true）</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.cxf.transport.http.async。SO_KEEPALIVE</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.cxf.transport.http.async。SO_LINGER</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.cxf.transport.http.async。SO_TIMEOUT</p></td></tr></tbody></table></div><p>与保持活动连接管理相关的设置：</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.cxf.transport.http.async。CONNECTION_TTL</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>建立连接的最长时间（从创建到到期） <span> </span> 。默认值为60000</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.cxf.transport.http.async。MAX_CONNECTIONS</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>总共打开的最大连接数。默认值为5000。</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.cxf.transport.http.async。MAX_PER_HOST_CONNECTIONS</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>每个主机打开的最大连接数。默认值为1000。</span></p></td></tr></tbody></table></div><p>与Apache HttpAsyncClient线程和选择器相关的设置：</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.cxf.transport.http.async.ioThreadCount</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>HttpAsyncClient用于处理IO事件的线程数。默认值为“ -1”，表示每个CPU内核一个线程。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.cxf.transport.http.async.interestOpQueued</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>兴趣操作是队列还是直接处理是否正确。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.cxf.transport.http.async.selectInterval</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>默认值1000毫秒如果没有事件来处理其他事件（例如队列到期），则选择器线程多久唤醒一次。</p></td></tr></tbody></table></div><p>设置以控制使用哪个导管</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.cxf.transport.http.async.usePolicy</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>永远，永远不要ASYNC_ONLY。</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>在含义上与上述“ use.async.http.conduit”上下文属性相似。是否将HttpAsyncClient：始终用于同步和异步调用，是否将ASYNC_ONLY（默认）仅用于异步调用，从不将HTTPURLConnection用于两种类型的调用。</p></td></tr></tbody></table></div></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=30737094">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=30737094&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>