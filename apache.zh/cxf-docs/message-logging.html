<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - Message Logging">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script src='/resources/highlighter/scripts/shBrushXml.js'></script>
<script src='/resources/highlighter/scripts/shBrushBash.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-消息记录</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="debugging-and-logging.html">调试和记录</a> > <a href="message-logging.html">消息记录</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><div class="aui-message aui-message-error"><p class="title"><strong>呈现宏'html'时出错</strong></p><p>您的Confluence管理员不允许在HTML宏中使用Javascript。可以使用HTML for Confluence Configuration更改此设置。请与您的管理员联系以获取详细信息。</p></div><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><div class="container" title="提示：双击以选择代码"><p>从CXF 3.1开始，消息记录代码被移到一个单独的模块中并收集了一些新功能。</p><ul><li>自动记录现有的CXF端点和客户端</li><li>使用slf4j MDC分别记录元数据</li><li>为Rest调用添加元数据</li><li>添加MD5消息ID和交换ID以进行关联</li><li>编写自己的追加程序的简单界面</li></ul><h2 id="MessageLogging-ManualUsage">手动使用</h2><div class="code panel pdl" style="border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px"><b>CXF记录功能</b></div><div class="codeContent panelContent pdl">
<pre class="brush: xml; gutter: false; theme: Default">    &lt;jaxws:endpoint ...&gt;
      &lt;jaxws:features&gt;
       &lt;bean class="org.apache.cxf.ext.logging.LoggingFeature"/&gt;
      &lt;/jaxws:features&gt;
    &lt;/jaxws:endpoint&gt;</pre>
</div></div><p>LoggingFeature可以与JAXWS以及JAXRS端点和客户端一起使用。也可以使用@Features批注指定它。应该使用该功能，而不是手动添加LoggingIn / OutInterceptors。</p><h2 id="MessageLogging-Properties">性质</h2><p>可以在LoggingFeature上设置以下属性：</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup span="1"><col span="1"><col span="1"></colgroup><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh">属性</th><th colspan="1" rowspan="1" class="confluenceTh">说明</th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">限制</td><td colspan="1" rowspan="1" class="confluenceTd">日志中截断消息的大小限制。默认值为48 * 1024。</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">阈值</td><td colspan="1" rowspan="1" class="confluenceTd"><p>将消息写入磁盘时的大小限制。默认值为-1，表示不写入磁盘。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">prettyLogging</td><td colspan="1" rowspan="1" class="confluenceTd">对于XML内容，请在日志中启用漂亮的打印。默认为false。</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">logBinary</td><td colspan="1" rowspan="1" class="confluenceTd">默认情况下记录二进制有效负载。默认为false。</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">logMultipart</td><td colspan="1" rowspan="1" class="confluenceTd">默认情况下记录多部分负载。默认值为true。</td></tr></tbody></table></div><p><br clear="none"></p><h2 id="MessageLogging-Slf4jMDCvaluesformetadata">元数据的Slf4j MDC值</h2><p>这是您从SOAP调用获得的原始日志记录信息：</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup span="1"><col span="1"><col span="1"></colgroup><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh">领域</th><th colspan="1" rowspan="1" class="confluenceTh">值</th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">@时间戳</td><td colspan="1" rowspan="1" class="confluenceTd">2015-06-08T14：43：27,097Z</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">MDC地址</td><td colspan="1" rowspan="1" class="confluenceTd"><a shape="rect" class="external-link" href="http://localhost:8181/cxf/personService" rel="nofollow">http：// localhost：8181 / cxf / personService</a></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><a shape="rect" class="external-link" href="http://MDC.bundle.id" rel="nofollow">MDC.bundle.id</a></td><td colspan="1" rowspan="1" class="confluenceTd">90</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><a shape="rect" class="external-link" href="http://MDC.bundle.name" rel="nofollow">MDC.bundle.name</a></td><td colspan="1" rowspan="1" class="confluenceTd">org.apache.cxf.cxf-rt功能记录</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">MDC.bundle.version</td><td colspan="1" rowspan="1" class="confluenceTd">3.1.0</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">MDC.content-type</td><td colspan="1" rowspan="1" class="confluenceTd">text / xml;字符集= UTF-8</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">MDC编码</td><td colspan="1" rowspan="1" class="confluenceTd">UTF-8</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">MDC.exchangeId</td><td colspan="1" rowspan="1" class="confluenceTd">56b037e3-d254-4fe5-8723-f442835fa128</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">MDC标头</td><td colspan="1" rowspan="1" class="confluenceTd">{content-type = text / xml; charset = UTF-8，连接= keep-alive，主机= localhost：8181，Content-Length = 251，SOAPAction =“”，User-Agent = Apache CXF 3.1.0，Accept = * / *，Pragma = no-cache ，Cache-Control = no-cache}</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">MDC.http方法</td><td colspan="1" rowspan="1" class="confluenceTd">开机自检</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">MDC.messageId</td><td colspan="1" rowspan="1" class="confluenceTd">a46eebd2-60af-4975-ba42-8b8205ac884c</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">MDC.portName</td><td colspan="1" rowspan="1" class="confluenceTd">PersonServiceImplPort</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">MDC.portTypeName</td><td colspan="1" rowspan="1" class="confluenceTd">人员服务</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">MDC.serviceName</td><td colspan="1" rowspan="1" class="confluenceTd">PersonServiceImplService</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">MDC类型</td><td colspan="1" rowspan="1" class="confluenceTd">REQ_IN</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">水平</td><td colspan="1" rowspan="1" class="confluenceTd">信息</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">位置类</td><td colspan="1" rowspan="1" class="confluenceTd">org.apache.cxf.ext.logging.slf4j。Slf4jEventSender</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">loc.file</td><td colspan="1" rowspan="1" class="confluenceTd">Slf4jEventSender.java</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">定位线</td><td colspan="1" rowspan="1" class="confluenceTd">55</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">定位方法</td><td colspan="1" rowspan="1" class="confluenceTd">发送</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">loggerClass</td><td colspan="1" rowspan="1" class="confluenceTd">org.ops4j.pax.logging.slf4j。Slf4jLogger</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">loggerName</td><td colspan="1" rowspan="1" class="confluenceTd">org.apache.cxf.services。PersonService。REQ_IN</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">信息</td><td colspan="1" rowspan="1" class="confluenceTd"><soap:envelope class="external-link" href="http://schemas.xmlsoap.org/soap/envelope/"%3E%3Csoap:Body%3E%3Cns2:getAll" rel="nofollow" xmlns:soap="<a shape=" rec="=">http://schemas.xmlsoap.org/soap/envelope/“> <soap:body><ns2:getall>< /a="">xmlns：ns2 =” <a shape="rect" class="external-link" href="http://model.personservice.cxf.karaf.tutorial.lr.net/"" rel="nofollow">http://model.personservice.cxf.karaf.tutorial.lr.net/“</a> ; xmlns：ns3 =” <a shape="rect" class="external-link" rel="nofollow" href="http://person.jms2rest.camel.karaf.tutorial.lr.net"/%3E%3C/soap:Body%3E%3C/soap:Envelope%3E">http：// person.jms2rest.camel.karaf.tutorial.lr.net“ /></a></ns2:getall><></soap:body></soap:envelope> ;</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">线程名</td><td colspan="1" rowspan="1" class="confluenceTd">qtp80604361-78</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">时间戳记</td><td colspan="1" rowspan="1" class="confluenceTd">1433774607097</td></tr></tbody></table></div><p><br clear="none">MDC值中包含许多详细信息，默认情况下，这些值通常不会显示在日志文件中。您需要更改pax日志记录配置以使其可见。或将某些服务记录到另一个文件中。</p><h2 id="MessageLogging-Enablling/disablingloggingbychangingtheloggerconfig">通过更改记录器配置来启用/禁用记录</h2><p>记录器的名称为“ <service namespace=""><servicename>.. <type>”。在karaf日志文件中，默认情况下，它仅显示类型，但是您可以更改此类型。</type></servicename></service></p><p>您可以使用记录器名称来微调您要以这种方式记录的服务。例如，将嘈杂的服务的调试级别设置为WARN，以避免记录它们。</p><h2 id="MessageLogging-Messageidandexchangeid">消息ID和交换ID</h2><p>即使消息是从多个服务器收集的，messageId也可以唯一地标识消息。它也通过电线传输，因此在一台机器上发送的请求可以与另一台机器上接收的请求相关。</p><p>对于传入的请求和响应，exchangeId将是相同的；对于传出的请求和响应，exchangeId将在另一侧。这允许关联请求和响应，因此可以跟踪对话。</p><h2 id="MessageLogging-Simpleinterfacetowritecustomappenders">编写自定义附加程序的简单界面</h2><p>编写一个自定义<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/features/logging/src/main/java/org/apache/cxf/ext/logging/event/LogEventSender.java" rel="nofollow">LogEventSender</a>并将其设置在<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/features/logging/src/main/java/org/apache/cxf/ext/logging/LoggingFeature.java" rel="nofollow">LoggingFeature上</a>以执行自定义日志记录。可以从<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/features/logging/src/main/java/org/apache/cxf/ext/logging/event/LogEvent.java" rel="nofollow">LogEvent</a>类访问所有元数据。</p></div><h2 id="MessageLogging-Changingthelogginglevel">更改日志记录级别</h2><p>默认情况下，Slf4jEventSender将消息记录为“ INFO”级别。从CXF 3.3.3开始，可以通过在Slf4jEventSender上设置日志级别并将其连接到LoggingFeature来轻松更改此设置。例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px"><b>设置调试日志</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;bean id="eventSender" class="org.apache.cxf.ext.logging.slf4j.Slf4jVerboseEventSender"&gt;
    &lt;property name="loggingLevel" value="DEBUG" /&gt;
&lt;/bean&gt;

&lt;cxf:bus&gt;
    &lt;cxf:features&gt;
        &lt;bean class="org.apache.cxf.ext.logging.LoggingFeature"&gt;
            &lt;property name="sender" ref="eventSender"/&gt;
        &lt;/bean&gt;
    &lt;/cxf:features&gt;
&lt;/cxf:bus&gt;</pre>
</div></div><p><br clear="none"></p><p><br clear="none"></p><div class="container" title="提示：双击以选择代码"><h2 id="MessageLogging-AutologgingforexistingCXFendpointsandclientsinApacheKaraf">自动记录Apache Karaf中现有的CXF端点和客户端</h2><p>要使用karaf中的消息记录功能，需要将其安装为功能部件。然后可以使用配置为所有端点激活它。</p><div class="code panel pdl" style="border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px"><b>karaf中的日志记录功能</b></div><div class="codeContent panelContent pdl">
<pre class="brush: bash; gutter: false; theme: Default">feature:repo-add cxf 3.1.0
feature:install cxf-features-logging
config:property-set -p org.apache.cxf.features.logging enabled true</pre>
</div></div><p>在日志记录功能之后安装的所有CXF端点都将自动通过消息日志记录功能进行增强。</p>默认情况下，所有SOAP和Rest调用都将使用slf4j记录。因此，记录数据将通过pax记录进行处理，并且默认情况下会出现在您的karaf日志中。<p>日志条目如下所示：</p><div class="code panel pdl" style="border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px"><b>样本日志条目</b></div><div class="codeContent panelContent pdl">
<pre class="brush: bash; gutter: false; theme: Default">2015-06-08 16:35:54,068 | INFO  | qtp1189348109-73 | REQ_IN                           | 90 - org.apache.cxf.cxf-rt-features-logging - 3.1.0 | &lt;soap:Envelope 
xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"&gt;&lt;soap:Body&gt;&lt;ns2:addPerson xmlns:ns2="http://model.personservice.cxf.karaf.tutorial.lr.net/" 
xmlns:ns3="http://person.jms2rest.camel.karaf.tutorial.lr.net"&gt;&lt;arg0&gt;&lt;id&gt;3&lt;/id&gt;&lt;name&gt;Test2&lt;/name&gt;&lt;url&gt;&lt;/url&gt;&lt;/arg0&gt;&lt;/ns2:addPerson&gt;&lt;/soap:Body&gt;&lt;/soap:Envelope&gt;</pre>
</div></div><p>这看起来并不十分有用。您只能在日志消息中看到它是一个传入请求（REQ_IN）和SOAP消息。日志记录功能可提供更多信息。为了利用这些，可以更改pax日志记录配置以显示相关的MDC值。</p><h2 id="MessageLogging-Karafdecantersupporttowriteintoelasticsearch">卡拉夫can水器支持写入弹性搜索</h2><p>许多人使用弹性搜索进行日志记录。幸运的是，您无需为此编写特殊的LogSender。标准的CXF日志记录功能已经可以使用。</p><p>它是这样的：</p><ul><li>CXF将消息作为slf4j事件发送，由pax日志记录处理</li><li>Karaf Decanter LogCollector附加到pax日志记录并将所有日志事件发送到karaf消息总线中（EventAdmin主题）</li><li>Karaf Decanter ElasticSearchAppender将日志事件发送到可配置的弹性搜索实例</li></ul><p>由于Decanter还提供了用于本地弹性搜索和kibana实例的功能，因此您可以在几分钟之内完成准备工作。</p><div class="code panel pdl" style="border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px"><b>安装用于CXF日志记录的Decanter</b></div><div class="codeContent panelContent pdl">
<pre class="brush: bash; gutter: false; theme: Default">feature:repo-add mvn:org.apache.karaf.decanter/apache-karaf-decanter/3.0.0-SNAPSHOT/xml/features
feature:install decanter-collector-log decanter-appender-elasticsearch elasticsearch kibana</pre>
</div></div><p><br clear="none">之后，打开位于<a shape="rect" class="external-link" href="http://localhost:8181/kibana" rel="nofollow">http：// localhost：8181 / kibana</a>的浏览器。释放de水器时，将完全设置kibana。目前，您必须添加logstash仪表板并将索引名称更改为<strong>[karaf-] YYYY.MM.DD。</strong></p><p>然后，您应该看到这样的cxf消息：</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.liquid-reality.de/download/attachments/13860866/Screenshot from 2015-06-08 17%3A21%3A20.png?version=1&modificationDate=1433777354000&api=v2" data-image-src="http://www.liquid-reality.de/download/attachments/13860866/Screenshot from 2015-06-08 17%3A21%3A20.png?version=1&modificationDate=1433777354000&api=v2"></span></p><p>Kibana可以轻松过滤特定服务，并关联请求和响应。</p><p>这只是de水器的预览。当第一个版本发布时，我将做更详细的文章。</p><br clear="none"><br clear="none"><p><br clear="none"></p></div></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=61330676">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=61330676&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>