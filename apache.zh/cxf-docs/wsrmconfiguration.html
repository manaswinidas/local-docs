<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - WSRMConfiguration">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script src='/resources/highlighter/scripts/shBrushXml.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-WSRM配置</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="configuration.html">配置</a> > <a href="wsrmconfiguration.html">WSRMConfiguration</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><form id="cse-search-box" enctype="application/x-www-form-urlencoded" method="get" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="搜索">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><h1 id="WSRMConfiguration-UsingWS-ReliableMessaging">使用WS可靠的消息传递</h1><p>为了使两个端点之间的消息交换可靠，您需要确保将RM拦截器和（由于WS-Reliable消息传递依赖于WS-Addressing）地址拦截器添加到拦截器链中。这可以通过以下方式之一来实现：</p><h2 id="WSRMConfiguration-UsingtheRMAssertionandtheCXFWS-PolicyFramework">使用RMAssertion和CXF WS-Policy框架</h2><p>如果</p><ol><li>带有RMAssertion元素的Policy附加到wsdl：service元素（或根据WS-Policy Attachment的规则是Policy或PolicyReference元素的附加点的任何其他wsdl元素）</li><li>启用了CXF WS-Policy框架</li></ol><p>RM拦截器将通过策略框架自动添加到其各自的拦截器链中。断言属性控制源/目标的行为。</p><p>例如，要在服务器端启用WS-Policy Framework，您的配置文件应如下所示：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;jaxws:endpoint ...&gt;
    &lt;jaxws:features&gt;
        &lt;p:policies/&gt;
    &lt;/jaxws:features&gt;
&lt;/jaxws:endpoint&gt;
</pre>
</div></div><p>和您的wsdl：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;wsp:Policy wsu:Id="RM" xmlns:wsp="http://www.w3.org/2006/07/ws-policy"
xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"&gt;
    &lt;wsam:Addressing xmlns:wsam="http://www.w3.org/2007/02/addressing/metadata"&gt;
        &lt;wsp:Policy/&gt;
    &lt;/wsam:Addressing&gt;
    &lt;wsrmp:RMAssertion xmlns:wsrmp="http://schemas.xmlsoap.org/ws/2005/02/rm/policy"&gt;
        &lt;wsrmp:BaseRetransmissionInterval Milliseconds="10000"/&gt; 
    &lt;/wsrmp:RMAssertion&gt;
&lt;/wsp:Policy&gt;
...
&lt;wsdl:service name="ReliableGreeterService"&gt;
    &lt;wsdl:port binding="tns:GreeterSOAPBinding" name="GreeterPort"&gt;
        &lt;soap:address location="http://localhost:9020/SoapContext/GreeterPort"/&gt;
        &lt;wsp:PolicyReference URI="#RM" xmlns:wsp="http://www.w3.org/2006/07/ws-policy"/&gt;        
    &lt;/wsdl:port&gt;
&lt;/wsdl:service&gt;
</pre>
</div></div><p>您可以将其指定为策略功能的子元素，例如对于服务器端点，而不是将附加的PolicyReference附加到wsdl：port元素。</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;wsp:Policy wsu:Id="RM" xmlns:wsp="http://www.w3.org/2006/07/ws-policy" ...&gt;
&lt;/wsp:Policy&gt;

&lt;jaxws:endpoint ...&gt;
    &lt;jaxws:features&gt;
        &lt;p:policies&gt;
            &lt;wsp:PolicyReference URI="#RM" xmlns:wsp="http://www.w3.org/2006/07/ws-policy"/&gt;
        &lt;/p:policies&gt;
    &lt;/jaxws:features&gt;
&lt;/jaxws:endpoint&gt;
</pre>
</div></div><p>从CXF 3.0.0开始，既支持较旧的WS-ReliableMessagingPolicy 1.0（提交版本），也支持正式的WS-ReliableMessagingPolicy 1.2。如果要在运行时支持WS-ReliableMessaging 1.2，则必须在策略中使用WS-ReliableMessagingPolicy 1.2。</p><h2 id="WSRMConfiguration-UsingtheReliableMessagingFeature">使用可靠的消息传递功能</h2><p>如果您不想涉及WS-Policy Framework，或者不想配置其他参数，例如序列终止策略或持久性存储，则可以使用可靠的消息传递功能。它在名称空间<a shape="rect" href="http://cxf.apache.org/ws/rm/manager">http://cxf.apache.org/ws/rm/manager中</a>定义，并且支持以下子元素：</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>名称</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>值</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>RM断言</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>RMAssertion类型的元素。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>交付保证</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>类型为DeliveryAssuranceType的元素，该元素描述应应用的交付保证（AtMostOnce，AtLeastOnce，InOrder）。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>sourcePolicy</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>SourcePolicyType类型的元素，它允许您配置RM源的详细信息，例如商品是否应始终包含在CreateSequence请求中或序列终止策略。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>destinationPolicy</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>类型DestinationPolicyType的元素，允许您配置RM目标的详细信息，例如是否应接受入站商品。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>商店</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>要使用的商店（默认值：null）。它必须是jdbcStore类型的元素（在同一名称空间中），或者是一个bean或对实现RMStore接口的bean的引用。</p></td></tr></tbody></table></div><p>有关此名称空间中使用的元素类型的详细信息，请参考<a shape="rect" href="http://cxf.apache.org/ws/rm/manager">http://cxf.apache.org/ws/rm/manager</a>名称空间的架构（ <a shape="rect" href="http://cxf.apache.org/schemas/configuration/wsrm-manager.xsd">http://cxf.apache.org/schemas/configuration/wsrm- manager.xsd</a>和<a shape="rect" href="http://cxf.apache.org/schemas/configuration/wsrm-manager-types.xsd">http://cxf.apache.org/schemas/configuration/wsrm-manager-types.xsd</a> ）。 jbdcStore元素类型如下所述。</p><p>示例（在总线级别应用的功能）：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;cxf:bus&gt;
    &lt;cxf:features&gt;
        &lt;wsa:addressing/&gt;
        &lt;wsrm-mgr:reliableMessaging&gt;
            &lt;wsrm-policy:RMAssertion&gt;
                &lt;wsrm-policy:BaseRetransmissionInterval Milliseconds="4000"/&gt;           
                &lt;wsrm-policy:AcknowledgementInterval Milliseconds="2000"/&gt;          
            &lt;/wsrm-policy:RMAssertion&gt; 
            &lt;wsrm-mgr:sourcePolicy&gt;
                &lt;wsrm-mgr:sequenceTerminationPolicy maxLength="5"/&gt;                    
            &lt;/wsrm-mgr:sourcePolicy&gt;     
            &lt;wsrm-mgr:destinationPolicy acceptOffers="false"&gt;            
            &lt;wsrm:store&gt;
               &lt;ref bean="myStore"/&gt;
            &lt;/wsrm:store&gt;
        &lt;/wsrm-mgr:reliableMessaging&gt;
    &lt;/cxf:features&gt;
&lt;/cxf:bus&gt;
</pre>
</div></div><h2 id="WSRMConfiguration-ConfiguringtheReliableMessagingStore">配置可靠的邮件存储</h2><p>要启用持久性，必须指定实现RM的持久性存储的对象。您可以开发自己的存储，也可以使用CXF附带的基于JDBC的存储（类org.apache.cxf.ws.rm.persistence.jdbc。RMTxStore）。您可以使用wsrm-mgr：reliableMessaging元素内的自定义jdbcStore bean（名称空间<a shape="rect" href="http://cxf.apache.org/ws/rm/manager">http://cxf.apache.org/ws/rm/manager</a> ）配置后者。jdbcStore bean支持以下属性：</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>属性名称</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>类型</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>默认</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>数据源</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>串</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>空值</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>driverClassName</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>串</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.derby.jdbc。嵌入式驱动器</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>initialReconnectDelay</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>长</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>0</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>keepConnection</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>布尔值</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>假</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>maxReconnectAttempts</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>整型</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>0</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>密码</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>串</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>空值</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>tableExistsCode</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>整型</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>0</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>tableExistsState</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>串</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>空值</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>schemaName</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>串</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>空值</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>用户名</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>串</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>空值</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>网址</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>串</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>jdbc：derby：rmdb; create = true</p></td></tr></tbody></table></div><p>例：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;wsrm-mgr:jdbcStore xmlns:wsrm-mgr="http://cxf.apache.org/ws/rm/manager" id="myStore"
    driverClassName="org.apache.derby.jdbc.ClientDriver"
    url="jdbc:derby://localhost:1527/rmdb;create=true"
    password="password"/&gt;
</pre>
</div></div><p>有关属性用法的更多详细信息，请参见<a shape="rect" href="http://cxf.apache.org/schemas/configuration/wsrm-manager.xsd">RM Manager架构中</a>的jdbcStore元素定义。</p><h2 id="WSRMConfiguration-AddingtheReliableMessagingInterceptorsManually">手动添加可靠的消息拦截器</h2><p>为了确保将“可靠消息传递”拦截器添加到适当的拦截器链（例如，对于所有客户端和服务器端点）：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;bean id="rmLogicalOut" class="org.apache.cxf.ws.rm.RMOutInterceptor"&gt;
    &lt;property name="bus" ref="cxf"/&gt;
&lt;/bean&gt;
&lt;bean id="rmLogicalIn" class="org.apache.cxf.ws.rm.RMInInterceptor"&gt;
    &lt;property name="bus" ref="cxf"/&gt;
&lt;/bean&gt;
&lt;bean id="rmCodec" class="org.apache.cxf.ws.rm.soap.RMSoapInterceptor"/&gt;

&lt;cxf:bus ...&gt;
    &lt;cxf:inInterceptors&gt;
        &lt;ref bean="rmLogicalIn"/&gt;
        &lt;ref bean="rmCodec"/&gt;
    &lt;/cxf:inInterceptors&gt;
    &lt;cxf:inFaultInterceptors&gt;
        &lt;ref bean="rmLogicalIn"/&gt;
        &lt;ref bean="rmCodec"/&gt;
    &lt;/cxf:inFaultInterceptors&gt;
    &lt;cxf:outInterceptors&gt;
        &lt;ref bean="rmLogicalOut"/&gt;
        &lt;ref bean="rmCodec"/&gt;
    &lt;/cxf:outInterceptors&gt;
    &lt;cxf:outFaultInterceptors&gt;
        &lt;ref bean="rmLogicalOut"/&gt;
        &lt;ref bean="rmCodec"/&gt;
    &lt;cxf:outFaultInterceptors&gt;
&lt;/cxf:bus&gt;
</pre>
</div></div><p>RetransmissionIntercepor将由RMOutInterceptor即时添加，因此不需要出现在您的配置文件中。</p><h2 id="WSRMConfiguration-ConfiguringtheReliableMessagingManagerManually">手动配置可靠消息管理器</h2><p>要配置RM Manager的属性，可以使用<a shape="rect" href="http://cxf.apache.org/ws/rm/manager">http://cxf.apache.org/ws/rm/manager</a>命名空间中的rmManager元素。它支持与上面的可靠消息功能元素相同的子元素。例如，在不使用功能的情况下，可以确定序列的最大长度为5，如下所示：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;wsrm-mgr:rmManager xmlns:wsrm-mgr="http://cxf.apache.org/ws/rm/manager"&gt;
    &lt;wsrm-mgr:sourcePolicy&gt;
        &lt;wsrm-mgr:sequenceTerminationPolicy maxLength="5"/&gt;                    
    &lt;/wsrm-mgr:sourcePolicy&gt;
&lt;/wsrm-mgr:rmManager&gt;
</pre>
</div></div></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=63092">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=63092&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>