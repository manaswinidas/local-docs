<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - JAX-RS Multiparts">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script src='/resources/highlighter/scripts/shBrushXml.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-JAX-RS多部分</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="restful-services.html">RESTful服务</a> > <a href="jax-rs.html">JAX-RS</a> > <a href="jax-rs-multiparts.html">JAX-RS多部分</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><form id="cse-search-box" enctype="application/x-www-form-urlencoded" method="get" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="搜索">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><p><br clear="none"><span style="font-size:2em;font-weight:bold">JAX-RS：支持多部分</span>


 </p><p><br clear="none"></p><p><style type="text/css">/*<![CDATA[*/
div.rbtoc1528711018536 {padding: 0px;}
div.rbtoc1528711018536 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1528711018536 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style></p><div class="toc-macro rbtoc1528711018536">
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSMultiparts-Readingattachments">阅读附件</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSMultiparts-MultipartannotationandOptionalattachments">多部分注释和可选附件</a></li></ul>
</li><li><a shape="rect" href="#JAX-RSMultiparts-Writingattachments">写作附件</a></li><li><a shape="rect" href="#JAX-RSMultiparts-UploadingfileswithClientAPI">使用客户端API上传文件</a></li><li><a shape="rect" href="#JAX-RSMultiparts-Readinglargeattachments">阅读大附件</a>
<ul class="toc-indentation"><li><a shape="rect" href="#JAX-RSMultiparts-Formsandmultiparts">形式和多部分</a></li><li><a shape="rect" href="#JAX-RSMultiparts-Content-DispositionUTF-8filenames">内容处置UTF-8文件名</a></li></ul>
</li><li><a shape="rect" href="#JAX-RSMultiparts-XOPsupport">XOP支持</a></li><li><a shape="rect" href="#JAX-RSMultiparts-MultipartFilters">多部分过滤器</a></li><li><a shape="rect" href="#JAX-RSMultiparts-SigningMultiparts">多重签名</a></li><li><a shape="rect" href="#JAX-RSMultiparts-NoteaboutStruts">关于Struts的注意事项</a></li></ul>
</div><h1 id="JAX-RSMultiparts-Readingattachments">阅读附件</h1><p>各个部分可以映射到StreamSource，InputStream，DataSource或提供消息正文阅读器的自定义Java类型。</p><p>例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">@POST
@Path("/books/jaxbjson")
@Produces("text/xml")
public Response addBookJaxbJson(
        @Multipart(value = "rootPart", type = "text/xml") Book2 b1,
        @Multipart(value = "book2", type = "application/json") Book b2) 
        throws Exception {
}
</pre>
</div></div><p>请注意，在此示例中，期望的根部分名为“ rootPart”是text-xml Book表示形式，而名为“ book2”的部分是Book JSON序列。</p><p>可以将所有附件作为<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/ext/multipart/Attachment.java">附件</a>列表进行访问，并带有附件，可以轻松处理给定的部分：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">@POST
public void addAttachments(List&lt;Attachment&gt; atts) throws Exception {
}
</pre>
</div></div><p>例如，在处理文件的表单提交时，附件类可用于获取<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/ext/multipart/ContentDisposition.java">Content-Disposition</a>标头。</p><p>类似地，整个请求主体可以表示为<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/ext/multipart/MultipartBody.java">MultipartBody</a> ：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">@POST
public void addAttachments(MultipartBody body) throws Exception {
body.getAllAtachments();
body.getRootAttachment();
}
</pre>
</div></div><p>处理复杂的多部分/表单数据提交（例如包含文件的提交）时，需要直接使用MultipartBody（和附件）。在较简单的情况下，当每个表单部分都可以由字符串捕获时，下面的代码就足够了：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">@POST
@Consumes("multipart/form-data")
public void addForm1(@FormParam("name") String title, @FormParam("id") Long id) throws Exception {
}

@POST
@Consumes("multipart/form-data")
public void addForm2(@FormParam("") BookBean book) throws Exception {
}

@POST
@Consumes("multipart/form-data")
public void addForm3(MultivaluedMap&lt;String, String&gt; formData) throws Exception {
}
</pre>
</div></div><p>当使用“附件列表”或“ MultipartBody”时，可能需要借助一些自定义过程来处理各个部分。从CXF 2.3.0开始，还可以执行以下操作：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">@POST
public void addAttachments(MultipartBody body) throws Exception {
    Book book = body.getAttachmentObject("bookPart", Book.class);
}

@POST
public void addAttachments(List&lt;Attachment&gt; attachments) throws Exception {
    for (Attachment attachment : attachments) {
        Book book = attachment.getObject(Book.class);
    }  
}

</pre>
</div></div><p>当用户代码已注入<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/ext/MessageContext.java">MessageContext时</a> ，应用程序代码也可以使用<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/utils/multipart/AttachmentUtils.java">AttachmentUtils</a> 。</p><p>请参阅这些<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/MultipartStore.java">测试资源类</a>和<a shape="rect" class="external-link" href="http://sberyozkin.blogspot.com/2009/02/multiparts-in-cxf-jaxrs.html" rel="nofollow">博客条目</a>以获取更多示例。</p><h2 id="JAX-RSMultiparts-MultipartannotationandOptionalattachments">多部分注释和可选附件</h2><p>当您编写这样的代码时</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">@POST
@Path("/books/jaxbjson")
@Produces("text/xml")
public Response addBookJaxbJson(
        @Multipart("rootPart") Book2 b1,
        @Multipart("book2") Book b2)  {}
</pre>
</div></div><p>如果在多部分负载中找不到“ rootPart”或“ book2”部分，则运行时将返回400状态。<br clear="none">从2.5.1开始，可以在缺少零件的情况下请求运行时报告空值：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">@POST
@Path("/books/jaxbjson")
@Produces("text/xml")
public Response addBookJaxbJson(
        @Multipart("rootPart") Book2 b1,
        @Multipart(value = "book2", required = false) Book b2) {}
</pre>
</div></div><p>上面的代码要求“ rootPart”部分可用，并且可以处理缺少“ book2”部分的情况。</p><h1 id="JAX-RSMultiparts-Writingattachments">写作附件</h1><p>从2.2.4开始，还可以在客户端和服务器端将附件写入输出流。</p><p>在服务器端，为给定方法更新@Produces值就足够了：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">public class Resource {
   private List&lt;Book&gt; books; 
   @Produces("multipart/mixed;type=text/xml")
   public List&lt;Book&gt; getBooksAsMultipart() {
      return booksList;
   }

   @Produces("multipart/mixed;type=text/xml")
   public Book getBookAsMultipart() {
      return booksList;
   }
}
</pre>
</div></div><p>请注意，“ multipart / mixed”媒体类型的“ type”参数表明，对于getBooksAsMultipart（）和getBookAsMultipart（）方法响应，multiparts响应中的所有部分都应将Content-Type标头设置为“ text / xml”。getBooksAsMultipart（）响应将分为3部分，第一部分将其Content-ID标头设置为“ root.message@cxf.apache.org”，接下来的部分将具有“ 1”和“ 2” ID。getBookAsMultipart（）响应将只有一个部分，其Content-ID标头设置为“ root.message@cxf.apache.org”。</p><p>返回包含不同类型对象的混合多部分时，可以将具有媒体类型字符串值的Map返回到Object对或MultipartBody：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">public class Resource {
   private List&lt;Book&gt; books; 
   @Produces("multipart/mixed")
   public Map&lt;String, Object&gt; getBooks() {
      Map&lt;String, Object&gt; map = new LinkedHashMap&lt;String, Object&gt;();
      map.put("text/xml", new JaxbBook());
      map.put("application/json", new JSONBook());
      map.put("application/octet-stream", imageInputStream);
      return map;  
   } 

   @Produces("multipart/mixed")
   public MultipartBody getBooks2() {
      List&lt;Attachment&gt; atts = new LinkedList&lt;Attachment&gt;();
      atts.add(new Attachment("root", "application/json", new JSONBook()));
      atts.add(new Attachment("image", "application/octet-stream", getImageInputStream()));
      return new MultipartBody(atts, true);  
   }

}
</pre>
</div></div><p>与在上一个代码片段中返回列表的方法类似，getBooks（）将响应序列化为多部分，其中第一部分的Content-ID标头设置为“ root.message@cxf.apache.org”，接下来的部分将具有ID，例如“ 1”，“ 2”等。</p><p>在getBooks2（）中，可以控制各个部分的内容ID。</p><p>您还可以通过使用Multipart批注来控制root附件的contentId和媒体类型：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">public class Resource {
   @Produces("multipart/form-data")
   @Multipart(value = "root", type = "application/octet-stream") 
   public File testGetImageFromForm() {
      return getClass().getResource("image.png").getFile();
   }
}
</pre>
</div></div><p>也可以将DataHandler，DataSource，Attachment，字节数组或InputStreams的列表或映射作为多部分处理。</p><p>在客户端，可以用相同的方式编写多部分。例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">WebClient client = WebClient.create("http://books");
client.type("multipart/mixed").accept("multipart/mixed");
List&lt;Attachment&gt; atts = new LinkedList&lt;Attachment&gt;();
atts.add(new Attachment("root", "application/json", new JSONBook()));
atts.add(new Attachment("image", "application/octet-stream", getImageInputStream()));
List&lt;Attachment&gt; atts = client.postAndGetCollection(atts, Attachment.class);
</pre>
</div></div><p>请注意一个新的WebClient.postAndGetCollection，可用于对集合进行类型安全的检索。还添加了类似的WebClient.getCollection。</p><p>使用代理时，还可以使用附加到方法参数的Multipart批注设置根contentId和媒体类型。代理目前不支持使用Multipart注释的多个方法参数（与服务器端相对），而仅支持单个multipart参数：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">public class Resource {
    @Produces("multipart/mixed")
    @Consumes("multipart/form-data")
    @Multipart(value = "root", type = "application/octet-stream") 
    public File postGetFile(@Multipart(value = "root2", type = "application/octet-stream") File file) {}
}
</pre>
</div></div><p>方法级别的Multipart批注将影响服务器端的编写和客户端的读取。参数级别的Multipart批注将影响在客户端（代理）端的写入和在服务器端的读取。您不必使用Multipart批注。</p><h1 id="JAX-RSMultiparts-UploadingfileswithClientAPI">使用客户端API上传文件</h1><p>目前，上传文件的唯一方法是使用MultipartBody，附件或文件：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">WebClient client = WebClient.create("http://books");
client.type("multipart/form-data");
ContentDisposition cd = new ContentDisposition("attachment;filename=image.jpg");
Attachment att = new Attachment("root", imageInputStream, cd);
client.post(new MultipartBody(att));

// or just post the attachment if it's a single part request only
client.post(att);

// or just use a file
client.post(getClass().getResource("image.png").getFile());

</pre>
</div></div><p>使用文件提供了一种更简单的方法，因为运行时可以弄清楚如何从文件创建ContentDisposition。</p><h1 id="JAX-RSMultiparts-Readinglargeattachments">阅读大附件</h1><p>处理大型附件时，可以使用以下属性来设置文件夹，内存阈值和最大大小（从CXF 2.4.4和2.5开始）：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;beans&gt;
  &lt;jaxrs:server id="bookstore1"&gt;
     &lt;jaxrs:properties&gt;
         &lt;entry key="attachment-directory" value="/temp/bookstore1"/&gt;
         &lt;!-- 200K--&gt;
         &lt;entry key="attachment-memory-threshold" value="404800"/&gt;
         
         &lt;entry key="attachment-max-size" value="404800"/&gt;
     &lt;/jaxrs:properties&gt;
  &lt;/jaxrs:server&gt;  
&lt;/beans&gt;
</pre>
</div></div><p>请注意，可以在每个端点的基础上设置此类属性。或者，您可以直接在org.apache.cxf.jaxrs.provider上设置“ attachmentDirectory”，“ attachmentThreshold”和“ attachmentMaxSize”属性。MultipartProvider，或者在处理多部分/表单数据有效载荷时为org.apache.cxf.jaxrs.provider。FormEncodingProvider。</p><p>或者，您可能想要设置以下系统属性，这些属性将应用于所有端点：</p><p>> -Dorg.apache.cxf.io。CachedOutputStream。阈值= 102400<br clear="none">和<br clear="none">> -Dorg.apache.cxf.io。CachedOutputStream。OutputDirectory = / temp</p><p>从CXF 2.5.0和2.4.4开始：<br clear="none">> -Dorg.apache.cxf.io。CachedOutputStream。最大大小= 10000000</p><p>请注意，如果给定的附件超过最大大小属性（默认为无限制），则将返回HTTP 413状态。有关这些配置属性的更多信息，请参见“ <a shape="rect" href="securing-cxf-services.html">确保CXF服务安全</a> ”文档。</p><h2 id="JAX-RSMultiparts-Formsandmultiparts">形式和多部分</h2><p><a shape="rect" class="external-link" href="http://www.w3.org/TR/html401/interact/forms.html" rel="nofollow">HTML文档中</a>的<a shape="rect" class="external-link" href="http://www.w3.org/TR/html401/interact/forms.html" rel="nofollow">表单</a>建议<a shape="rect" class="external-link" href="http://www.w3.org/TR/html401/interact/forms.html#h-17.13.4.2" rel="nofollow">建议</a>应将多部分/表单数据请求主要用于上传文件。</p><p>如上一节所述，处理多部分/表单数据提交的一种方法是直接处理CXF JAXRS Attachment类并获取Content-Disposition标头和/或基础输入流。</p><p>现在（从2.2.5开始）可以通过注册的JAX-RS MessageBodyReader读取单个multipart / form-data部件，对于诸如multipart / mixed或multipart / related之类的类型，这已经可以实现。</p><p>例如，可以通过具有以下签名的方法来处理此<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/resources/attachmentFormJson">请求</a> ：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">@POST
@Path("/books/jsonform")
@Consumes("multipart/form-data")
public Response addBookJsonFromForm(Book b1)  {...}
</pre>
</div></div><p>同样，可以通过具有以下签名的方法来处理此<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/resources/attachmentFormJsonJaxb">请求</a> ：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">@POST
@Path("/books/jsonjaxbform")
@Consumes("multipart/form-data")
public Response addBookJaxbJsonForm(@Multipart("jsonPart") Book b1,
                                        @Multipart("jaxbPart") Book b2) {}
</pre>
</div></div><p>请注意，一旦请求包含两个以上的部分，则需要开始使用@Multipart，这些值可以引用ContentId标头或ContentDisposition / name。请注意，除非使用纯名称/值提交，否则使用@Multipart优于使用@FormParam。原因是@Multipart还可以指定单个部分的预期媒体类型，因此其行为类似于@Consume批注。</p><p>当处理多个部分时，可以避免使用@Multipart，而只需使用List，ex，List \ <atachment\>，List \ <book\>等。</book\></atachment\></p><p>最后，也可以支持包含多个文件的多部分/表单数据请求（文件上传）。例如，可以通过签名如下的方法来处理此<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/resources/attachmentFormJsonFiles">请求</a> ：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">@POST
@Path("/books/filesform")
@Produces("text/xml")
@Consumes("multipart/form-data")
public Response addBookFilesForm(@Multipart("owner") String name,
                                 @Multipart("files") List&lt;Book&gt; books) {} 
</pre>
</div></div><p>如果您需要了解嵌入在“文件”外部的各个文件部分的名称（例如“ book1”和“ book2”），请改用List <attachment>。当前无法使用Multipart批注来引用此类内部零件，但是您可以轻松地从代表这些内部零件的各个Attachment实例中获取名称。</attachment></p><p>请注意，这只是根据有关如何上传多个文件的建议构造的最后一个请求，但比本节中链接的其他更简单的请求更复杂。</p><p>请注意，建议使用JAX-RS FormParams处理仅包含名称/值对的纯应用程序/ www-url编码的提交。</p><h2 id="JAX-RSMultiparts-Content-DispositionUTF-8filenames">内容处置UTF-8文件名</h2><p>从CXF 3.0.4开始，可以使用“ filename *” Content-Disposition扩展参数而不是“ filename”，以UTF-8格式指定Content-Disposition文件名。</p><p>请参阅<a shape="rect" class="external-link" href="https://tools.ietf.org/html/rfc6266" rel="nofollow">RFC 6266</a>和<a shape="rect" class="external-link" href="https://git-wip-us.apache.org/repos/asf?p=cxf.git;a=blob;f=core/src/test/java/org/apache/cxf/attachment/AttachmentUtilTest.java;h=6eeedd42e965f4df8390ee6077222b34e1520732;hb=HEAD">此单元测试</a>以获取更多信息。</p><h1 id="JAX-RSMultiparts-XOPsupport">XOP支持</h1><p>CXF JAXRS客户端和端点可以支持<a shape="rect" class="external-link" href="http://www.w3.org/TR/xop10/" rel="nofollow">XML二进制优化打包（XOP）</a> 。<br clear="none">实际上，这是指使用多部分打包对包含二进制数据的JAXB bean进行序列化，其根部分仅包含非二进制数据，而且还链接到包含实际二进制有效载荷的共置部分。接下来，在服务器端将其反序列化为JAXB bean。</p><p>如果要尝试XOP，则需要在CXF jaxrs端点和客户端上设置“启用了mtom”的属性。<br clear="none">有关更多详细信息，请参见<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/JAXRSMultipartTest.java">JAXRSMultipartTest</a> （testXopWebClient）和<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/MultipartStore.java">MultipartStore</a> （addBookXop）。</p><h1 id="JAX-RSMultiparts-MultipartFilters">多部分过滤器</h1><p> </p><p>从CXF 3.1.12开始，可以拦截附件的写或读过程。</p><p>引入了<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/ext/multipart/MultipartInputFilter.java" rel="nofollow">MultipartInputFilter</a>和<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/ext/multipart/MultipartOutputFilter.java" rel="nofollow">MultipartOutputFilter</a> 。这些过滤器可用于修改附件零件的列表或自定义个别零件的某些属性，例如，替换零件输入流等。</p><p>可以从JAX-RS 2.0客户端或容器请求/响应过滤器或CXF输入/输出拦截器中注册这些过滤器。<a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/utils/multipart/AttachmentUtils.java#L71" rel="nofollow">可以将</a> <a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/ext/multipart/MultipartInputFilter.java" rel="nofollow">MultipartInputFilter</a> <a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/utils/multipart/AttachmentUtils.java#L71" rel="nofollow">添加</a>到输入过滤器的列表中，该列表由当前CXF消息上的“ multipart.input.filters”属性标识。同样， <a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/utils/multipart/AttachmentUtils.java#L61" rel="nofollow">可以将</a> <a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/ext/multipart/MultipartOutputFilter.java" rel="nofollow">MultipartOutputFilter</a> <a shape="rect" class="external-link" href="https://github.com/apache/cxf/blob/master/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/utils/multipart/AttachmentUtils.java#L61" rel="nofollow">添加</a>到输出过滤器的列表中，该列表由当前CXF消息上的“ multipart.output.filters”属性标识。</p><h1 id="JAX-RSMultiparts-SigningMultiparts">多重签名</h1><p>有关更多信息，请参见<a shape="rect" href="http://cxf.apache.org/docs/jax-rs-jose.html#JAX-RSJOSE-SigningandVerificationofHTTPAttachments">本节</a> 。</p><h1 id="JAX-RSMultiparts-NoteaboutStruts">关于Struts的注意事项</h1><p>如果要在同一应用程序中使用CXF和<a shape="rect" class="external-link" href="http://struts.apache.org/2.2.1/index.html">Struts2</a> ，并期望CXF处理多部分/表单数据有效负载，则需要确保Struts2调度程序没有使用请求输入流。</p><p>一种选择是让Struts2处理仅匹配某些特定模式的URI，例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">&lt;web-app&gt;
&lt;filter&gt;
      &lt;filter-name&gt;struts2&lt;/filter-name&gt;
      &lt;filter-class&gt;
           org.apache.struts2.dispatcher.FilterDispatcher
       &lt;/filter-class&gt;
   &lt;/filter&gt;

   &lt;filter-mapping&gt;
       &lt;filter-name&gt;struts2&lt;/filter-name&gt;
       &lt;url-pattern&gt;*.action&lt;/url-pattern&gt;
   &lt;/filter-mapping&gt;

   &lt;filter-mapping&gt;
       &lt;filter-name&gt;struts2&lt;/filter-name&gt;
       &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;
   &lt;/filter-mapping&gt;
&lt;/web-app&gt;
</pre>
</div></div><p>另外，禁用“ struts.multipart.parser”属性可能会有所帮助。</p></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=24190815">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=24190815&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>