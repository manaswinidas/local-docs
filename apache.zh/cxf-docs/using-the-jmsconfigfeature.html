<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - Using the JMSConfigFeature">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script src='/resources/highlighter/scripts/shBrushBash.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-使用JMSConfigFeature</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="transports.html">传输</a> > <a href="jms-transport.html">JMS传输</a> > <a href="using-the-jmsconfigfeature.html">使用JMSConfigFeature</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><form id="cse-search-box" enctype="application/x-www-form-urlencoded" method="get" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="搜索">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><p>通过定义JMSConduit或JMSDestination，可以完成CXF中的标准JMS传输配置。但是，有一个更简单的配置选项更符合Spring依赖注入。此外，新配置提供了更多选项。例如，不再需要使用JNDI来解决连接工厂。而是可以在Spring配置中定义它。</p><p>以下示例配置使用spring 2.5中的<a shape="rect" class="external-link" href="http://static.springframework.org/spring/docs/2.5.x/reference/beans.html" rel="nofollow">p-namespace</a> ，但也可以使用旧的spring bean样式。</p><p>在功能元素内部，可以定义JMSConfigFeature。</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;jaxws:client id="CustomerService"
	xmlns:customer="http://customerservice.example.com/"
	serviceName="customer:CustomerServiceService"
	endpointName="customer:CustomerServiceEndpoint" address="jms://"
	serviceClass="com.example.customerservice.CustomerService"&gt;
	&lt;jaxws:features&gt;
		&lt;bean xmlns="http://www.springframework.org/schema/beans"
			class="org.apache.cxf.transport.jms.JMSConfigFeature"
			p:jmsConfig-ref="jmsConfig"/&gt;
	&lt;/jaxws:features&gt;
&lt;/jaxws:client&gt;
</pre>
</div></div><p>在上面的示例中，它引用了一个“ jmsConfig” bean，可以在其中完成JMS传输的整个配置。</p><p>jaxws端点可以用相同的方式定义：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;jaxws:endpoint
	xmlns:customer="http://customerservice.example.com/"
	id="CustomerService"
	address="jms://"
	serviceName="customer:CustomerServiceService"
	endpointName="customer:CustomerServiceEndpoint"
	implementor="com.example.customerservice.impl.CustomerServiceImpl"&gt;
	&lt;jaxws:features&gt;
		&lt;bean class="org.apache.cxf.transport.jms.JMSConfigFeature"
			p:jmsConfig-ref="jmsConfig" /&gt;
	&lt;/jaxws:features&gt;
&lt;/jaxws:endpoint&gt;
</pre>
</div></div><p>JMSConfiguration bean至少需要一个对连接工厂和目标目的地的引用。</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;bean id="jmsConfig" class="org.apache.cxf.transport.jms.JMSConfiguration"
	p:connectionFactory-ref="jmsConnectionFactory"
	p:targetDestination="test.cxf.jmstransport.queue"
/&gt;
</pre>
</div></div><p>如果ConnectionFactory不缓存连接，则应将其包装在弹簧SingleConnectionFactory中。这是必需的，因为JMS传输会为每个消息创建一个新的连接，并且需要SingleConnectionFactory来缓存此连接。</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;bean id="jmsConnectionFactory" class="org.springframework.jms.connection.SingleConnectionFactory"&gt;
	&lt;property name="targetConnectionFactory"&gt;
		&lt;bean class="org.apache.activemq.ActiveMQConnectionFactory"&gt;
			&lt;property name="brokerURL" value="tcp://localhost:61616" /&gt;
		&lt;/bean&gt;
	&lt;/property&gt;
&lt;/bean&gt;
</pre>
</div></div><h2 id="UsingtheJMSConfigFeature-UsingJMSConfigurationfromJava">从Java使用JMSConfiguration</h2><p>要从Java做到这一点，您需要初始化JMSConfiguration对象，然后将对它的引用存储在JMSConfigFeature中，然后将其添加到服务器工厂的功能中。下面的代码是零碎的。请注意，您不能在服务器工厂中设置的端点URI中使用查询参数，所有配置都必须在JMSConfiguration对象中。</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">public static JMSConfiguration newJMSConfiguration(String taskId, String jmsBrokerUrl) {
        String destinationUri = "jms:queue:" + taskId;
        JMSConfiguration conf = new JMSConfiguration();
        conf.setRequestURI(destinationUri);
        JNDIConfiguration jndiConfig = new JNDIConfiguration();
        JndiTemplate jt = new JndiTemplate();
        Properties env = new Properties();
        env.put(Context.PROVIDER_URL, jmsBrokerUrl); 
        env.put(Context.INITIAL_CONTEXT_FACTORY, "org.apache.activemq.jndi.ActiveMQInitialContextFactory");
        jt.setEnvironment(env);
        jndiConfig.setJndiConnectionFactoryName("ConnectionFactory");
        jndiConfig.setEnvironment(env);
        conf.setJndiTemplate(jt);
        conf.setTargetDestination("com.basistech.jug." + taskId);
        conf.setJndiConfig(jndiConfig);
        conf.setTimeToLive(0);
        return conf;
}
{
        JMSConfigFeature jmsConfigFeature = new JMSConfigFeature();
        JMSConfiguration jmsConfig = JmsUtils.newJMSConfiguration(taskId, jmsBrokerUrl);
        jmsConfig.setConcurrentConsumers(maxServiceThreads);
        jmsConfig.setMaxConcurrentConsumers(maxServiceThreads);
        jmsConfigFeature.setJmsConfig(jmsConfig);
        svrFactory.getFeatures().add(jmsConfigFeature);
        svrFactory.getFeatures().add(jmsConfigFeature);

        server = svrFactory.create();
}
</pre>
</div></div><h2 id="UsingtheJMSConfigFeature-JMSConfigurationoptions">JMSConfiguration选项</h2><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>名称</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>描述</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>connectionFactory</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>必填项。对定义jms ConnectionFactory的bean的引用。当不使用池化ConnectionFactory时，请记住像上面描述的那样包装connectionFactory</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>wrapInSingleConnectionFactory</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>自CXF 3.0.0起已删除此选项。</span>将使用Spring SingleConnectionFactory包装connectionFactory，这可以提高jms传输的性能。默认为true。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>reconnectOnException</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>（</span> <strong>不建议使用</strong> <span>）</span>如果使用Spring SingleConnectionFactory封装connectionFactory且reconnectOnException为true，则在引发异常时将创建新的连接，否则在引发异常时将不尝试重新连接。默认为false。从CXF 3.0.0起，CXF总是<span style="line-height:1.4285715">在出现异常时重新连接</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>targetDestination</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>目标的JNDI名称或提供程序特定的名称。ActiveMQ的示例：<br class="atl-forced-newline" clear="none">test.cxf.jmstransport.queue</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>destinationResolver</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>对Spring DestinationResolver的引用。这允许定义如何将目标名称解析为jms目标。默认情况下，使用DynamicDestinationResolver。它使用jms提供程序功能解析目标。如果引用JndiDestinationResolver，则可以使用JNDI解析目标名称。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>transactionManager</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>参考Spring事务管理器。这允许您通过Web服务参与JTA Transactions。您还可以注册spring JMS事务管理器以进行本地事务。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>taskExecutor</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>自CXF 3.0.0起已删除此选项。</span>引用spring TaskExecutor。在侦听器中使用它来决定如何处理传入的消息。默认值为spring SimpleAsyncTaskExecutor。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>useJms11</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>自CXF 3.0.0起已删除此选项。</p><p>true表示使用了JMS 1.1功能<br class="atl-forced-newline" clear="none">false表示仅使用JMS 1.0.2功能。默认为false。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>messageIdEnabled</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>默认为true。<span>自CXF 3.0.0起已删除此选项。</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>messageTimestampEnabled</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>默认为true。<span>自CXF 3.0.0起已删除此选项。</span></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>cacheLevel</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>自CXF 3.0.0起已删除此选项。</span></p><p>指定允许应用JMS侦听器容器的缓存级别。<br class="atl-forced-newline" clear="none">请查看org.springframework.jms.listenerDefaultMessageListenerContainer的Java文档以获取更多信息。默认值为-1。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>pubSubNoLocal</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>如果为true，则在使用主题时不会收到您自己的消息。默认为false。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>receiveTimeout</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>等待响应消息的毫秒数。 0（默认）表示无限期等待。从CXF 3.0开始，默认值更改为60000（60秒）</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>explicitQosEnabled</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>如果为true，则表示为每个消息设置QoS参数。默认为false。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>deliveryMode</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>NON_PERSISTENT = 1条消息将仅保留在内存中<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none">PERSISTENT = 2 <span>（默认）</span>消息将保留到磁盘</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>优先</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>消息的优先级。默认值是4。有关详细信息，请参见您的JMS提供者文档。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>生存时间</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>在此时间之后，该消息将被jms提供程序丢弃（默认为0）。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>sessionTransacted</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>如果为true，则表示使用JMS事务。（默认为false）。在2.7.x中，您还需要向JMSConfiguration注册JMS事务管理器，以便启用事务。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>并发消费者</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>并发消费者<span>N个</span>棕土为监听器（缺省为1）。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>maxConcurrentConsumers</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>自CXF 3.0.0起已删除此选项。</span>侦听器的最大并发使用者数（默认为1）。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>maxConcurrentTasks</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p><span>自CXF 3.0.0起已删除此选项。</span> （ <strong>不建议使用</strong> ）处理接收到的请求的最大线程数（默认为10）。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>messageSelector</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>jms选择器可过滤传入消息（允许共享队列）</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>subscriptionDurable</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>默认为false。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>持久订阅名称</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>messageType</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>文字（默认）<br class="atl-forced-newline" clear="none">二元<br class="atl-forced-newline" clear="none">字节</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>pubSubDomain</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>假（默认）表示使用队列<br class="atl-forced-newline" clear="none">真实意味着使用主题</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>jmsProviderTibcoEms</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>true表示jms提供程序是Tibco EMS。默认为false。当前，这激活了从标头JMS_TIBCO_SENDER填充SecurityContext中的主体。 （可从cxf版本2.2.6获得）</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="p1">maxSuspendedContinuations</p></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>从CXF 3.0.0开始</strong> ，JMS目标可能具有的最大挂起连续数，如果当前的挂起连续数超过最大值，则<span style="line-height:1.4285715">JMSListenerContainer将停止。</span>默认值为-1，表示禁用此功能。</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p class="p1">reconnectPercentOfMax</p></td><td colspan="1" rowspan="1" class="confluenceTd"><strong>从CXF 3.0.0开始，</strong>如果<span>JMSListenerContainer因当前的暂停连续数超过最大值而停止，则当当前的暂停连续数低于（ <span>maxSuspendedContinuations * <span>reconnectPercentOfMax / 100）</span></span>的值时，JMSListenerContainer将重新启动<span><span>。</span></span></span> 默认值为70。</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">createSecurityContext</td><td colspan="1" rowspan="1" class="confluenceTd"><p><strong>（从2.7.14，3.0.3开始）</strong> true（默认）表示为传入消息创建用户安全上下文。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">propogateExceptions</td><td colspan="1" rowspan="1" class="confluenceTd"><strong>（自2.7.15开始）仅2.7.x</strong> true（默认）表示在处理传入消息时发生的任何异常都将被传播。仅当设置了事务管理器和sessionTransacted时，此设置才有意义。</td></tr></tbody></table></div></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=100809">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=100809&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>