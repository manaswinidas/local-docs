<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - XML Key Management Service (XKMS)">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script src='/resources/highlighter/scripts/shBrushXml.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-XML密钥管理服务（XKMS）</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="xml-key-management-service-xkms.html">XML密钥管理服务（XKMS）</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><form id="cse-search-box" enctype="application/x-www-form-urlencoded" method="get" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="搜索">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><h1 id="XMLKeyManagementService(XKMS)-XMLKeyManagementService(XKMS)">XML密钥管理服务（XKMS）</h1><p>自CXF 2.7.7起可用。</p><h2 id="XMLKeyManagementService(XKMS)-Usecase">用例</h2><p>CXF使用非对称算法实现不同目的：对对称密钥和有效负载进行加密，对安全令牌和消息进行签名，拥有证明等。<br clear="none">通常，公共密钥（以X509证书的形式）存储在Java密钥库中。</p><p>例如，如果发送方对发送给接收方的消息有效载荷进行加密，则他应该有权访问保存在本地密钥库中的接收方证书。<br clear="none">发送者使用此证书进行消息加密，接收者使用相应的私钥解密请求：</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="xml-key-management-service-xkms.data/classic-message-encryption.jpg"></span></p><p>似乎还可以吗？现在想象一下，您的生产环境中有100个此服务的不同客户端，并且服务证书已过期。您应该在所有客户端密钥库中重新颁发并替换证书！更重要的是，如果将密钥库打包到war文件或OSGi捆绑软件中，则应将其解包并更新。对于企业环境而言，这并不是真正可以接受的。</p><p>因此，大型服务环境支持中央证书管理。这意味着X509证书不在本地存储在密钥库中，而是集中提供和管理。</p><p>通常，这是组织中建立的<a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/Public-key_infrastructure" rel="nofollow">公钥基础结构</a> （PKI）的责任。PKI负责创建，管理，存储，分发，同步和吊销公共证书和证书颁发机构（CA）。</p><h2 id="XMLKeyManagementService(XKMS)-XKMSSpecification">XKMS规范</h2><p>W3C指定了一种协议，用于分发和注册可用于基于XML的加密的公共密钥，证书和CA，包括签名和加密： <a shape="rect" class="external-link" href="http://www.w3.org/TR/xkms2/" rel="nofollow">XML密钥管理规范</a> （XKMS 2.0）。<br clear="none">XKMS规范包括两部分-描述密钥查找和证书验证的运行时方面的XML密钥信息服务规范（XKISS），以及描述注册，更新，吊销和恢复证书的管理方面的XML密钥注册服务规范（XKRSS）。 。<br clear="none">XKMS服务实现了规范的两个部分。</p><p>XKMS SOAP接口可以用作访问公共密钥基础结构（PKI）的标准前端。使用XKMS消息加密方案时，消息加密图片将以以下方式更改：</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="xml-key-management-service-xkms.data/classic-message-encryption-PKI-XKMS.jpg"></span></p><p>收件人X509证书不再保存到发件人的本地密钥库中。取而代之的是，证书存储在中央PKI中，并且可以使用标准XKMS界面进行定位，验证和管理。这从本质上改善了大型服务环境中对证书的控制。</p><p>管理员可以更新，续订和吊销证书，管理证书颁发机构和吊销列表。</p><h3 id="XMLKeyManagementService(XKMS)-IntegratingtheXKMSclientintotheCXFruntime">将XKMS客户端集成到CXF运行时</h3><p>XKMS客户端可以使用自定义的Crypto provider实现以非常优雅的方式集成到CXF和WSS4J中。在这种情况下，当WSS4J请求或验证证书时，将自动调用XKMS服务。有关详细信息， <a shape="rect" class="external-link" href="http://ashakirin.blogspot.de/2013/04/cxf-security-getting-certificates-from.html" rel="nofollow">请参见此博客</a> 。WSS4J加密接口的基本XKMS实现在XKMS客户端组件（XKMSCryptoProvider和XKMSCryptoProviderFactory）中可用。实现使用Ehcache缓存从XKMS服务接收的证书。</p><h3 id="XMLKeyManagementService(XKMS)-XKMSServiceDesign">XKMS服务设计</h3><p>XKMS服务的内部结构如下图所示：</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="xml-key-management-service-xkms.data/XKMS-cxf.jpg"></span></p><p>XKMS服务公开了<a shape="rect" class="external-link" href="http://www.w3.org/TR/xkms2/" rel="nofollow">XKMS 2.0中</a>指定的SOAP接口。<br clear="none">XKMS实现实现<a shape="rect" class="external-link" href="http://en.wikipedia.org/wiki/Chain-of-responsibility_pattern" rel="nofollow">了责任链设计模式</a> 。<br clear="none">每个XKMS操作都定义一个处理程序接口，并提供此接口的一个或多个实现。处理程序实现连接到一个链中。<br clear="none">操作实现从预配置的链中依次调用处理程序，直到将处理所有处理程序或发生严重错误。<br clear="none">这种设计使XKMS内部实现相当灵活：添加/删除处理程序，更改其顺序，引入支持新后端的处理程序等都很容易。<br clear="none">例如，可以先通过LDAP查找处理程序在LDAP存储库中搜索证书，如果在证书存储库中找不到证书，则可以使用适当的查找处理程序在远程PKI中另外查找证书。验证操作逻辑组织得井井有条：第一个验证处理程序检查X509证书的格式和到期日期，下一个检查证书信任链。</p><p>当前，XKMS服务支持基于简单文件和LDAP后端。<br clear="none">XKMS处理程序的样本弹簧配置如下所示：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:cxf="http://cxf.apache.org/core" xmlns:jaxws="http://cxf.apache.org/jaxws"
    xmlns:test="http://apache.org/hello_world_soap_http" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:util="http://www.springframework.org/schema/util"
    xsi:schemaLocation="
        http://cxf.apache.org/core
        http://cxf.apache.org/schemas/core.xsd
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
        http://cxf.apache.org/jaxws                                     
        http://cxf.apache.org/schemas/jaxws.xsd
        http://www.springframework.org/schema/util
        http://www.springframework.org/schema/util/spring-util-2.0.xsd"&gt;


    &lt;bean id="dateValidator" class="org.apache.cxf.xkms.x509.validator.DateValidator" /&gt;

    &lt;bean id="trustedAuthorityValidator"
        class="org.apache.cxf.xkms.x509.validator.TrustedAuthorityValidator"&gt;
        &lt;constructor-arg ref="certificateRepo" /&gt;
    &lt;/bean&gt;

    &lt;bean id="x509Locator" class="org.apache.cxf.xkms.x509.handlers.X509Locator"&gt;
        &lt;constructor-arg ref="certificateRepo" /&gt;
    &lt;/bean&gt;

    &lt;bean id="x509Register"
        class="org.apache.cxf.xkms.x509.handlers.x509Register"&gt;
        &lt;constructor-arg ref="certificateRepo" /&gt;
    &lt;/bean&gt;


    &lt;!-- LDAP based implementation --&gt;

    &lt;bean id="certificateRepo"
        class="org.apache.cxf.xkms.x509.repo.ldap.LdapCertificateRepo"&gt;
        &lt;constructor-arg ref="ldapSearch" /&gt;
        &lt;constructor-arg ref="ldapSchemaConfig" /&gt;
        &lt;constructor-arg value="dc=example,dc=com" /&gt;
    &lt;/bean&gt;

    &lt;bean id="ldapSearch" class="org.apache.cxf.xkms.x509.repo.ldap.LdapSearch"&gt;
        &lt;constructor-arg value="ldap://localhost:2389" /&gt;
        &lt;constructor-arg value="cn=Directory Manager,dc=example,dc=com" /&gt;
        &lt;constructor-arg value="test" /&gt;
        &lt;constructor-arg value="2" /&gt;
    &lt;/bean&gt;

    &lt;bean id="ldapSchemaConfig" class="org.apache.cxf.xkms.x509.repo.ldap.LdapSchemaConfig"&gt;
        &lt;property name="certObjectClass" value="inetOrgPerson" /&gt;
        &lt;property name="attrUID" value="uid" /&gt;
        &lt;property name="attrIssuerID" value="manager" /&gt;
        &lt;property name="attrSerialNumber" value="employeeNumber" /&gt;
        &lt;property name="attrCrtBinary" value="userCertificate;binary" /&gt;
        &lt;property name="constAttrNamesCSV" value="sn" /&gt;
        &lt;property name="constAttrValuesCSV" value="X509 certificate" /&gt;
        &lt;property name="serviceCertRDNTemplate" value="cn=%s,ou=services" /&gt;
        &lt;property name="serviceCertUIDTemplate" value="cn=%s" /&gt;
	&lt;property name="trustedAuthorityFilter" value="(&amp;#038;(objectClass=inetOrgPerson)(ou:dn:=CAs))" /&gt;
	&lt;property name="intermediateFilter" value="(objectClass=inetOrgPerson)" /&gt;
    &lt;/bean&gt;


    &lt;!-- File based implementation --&gt;

    &lt;!-- bean id="certificateRepo"
        class="org.apache.cxf.xkms.x509.repo.file.FileCertificateRepo"&gt;
        &lt;constructor-arg value="../conf/certs" /&gt;
    &lt;/bean--&gt;

&lt;/beans&gt;
</pre>
</div></div><p>dateValidator和trustedAuthorityValidator Bean是用于日期和可信链验证的Validator接口的实现。<br clear="none">x509Locator和x509Register是X509证书的Locator和Register接口的实现。<br clear="none">certificateRepo是LDAP后端的存储库实现。LdapSearch和LdapSchemaConfig包含下表中描述的LDAP配置：</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>属性</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>样本值</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>描述</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>ldapServerConfig参数</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>LDAP服务器的URL，baseDN和凭据</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>certObjectClass</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>inetOrgPerson</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>用于存储证书的LDAP对象类</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>属性</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>uid</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>包含X509主题DN的属性</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>attrIssuerID</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>经理</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>包含X509发行者DN的LDAP属性</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>attrSerialNumber</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>员工编号</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>包含X509序列号的LDAP属性</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">attrEndpoint</td><td colspan="1" rowspan="1" class="confluenceTd">标记的URI</td><td colspan="1" rowspan="1" class="confluenceTd">包含服务端点的LDAP属性（用于基于端点的查找）</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>attrCrtBinary</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>用户证书</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>包含X509证书内容的LDAP属性</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>constAttrNamesCSV</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>锡</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>逗号分隔的必需LDAP属性列表</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>constAttrValuesCSV</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>X509证书</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>逗号分隔的必需LDAP属性值列表</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>serviceCertRDNTemplate</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>cn =％s，ou =服务</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>服务证书的相对专有名称</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>serviceCertUIDTemplate</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>cn =％s</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>将服务QName转换为DN以便存储到attrUID的模板</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>TrustedAuthorityFilter</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>（＆（objectClass = inetOrgPerson）（ou：dn：= CAs））</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>进行过滤以确定用于可信链验证的可信CA</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>middleFilter</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>（objectClass = inetOrgPerson）</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>过滤以确定中间证书以进行可信链验证</p></td></tr></tbody></table></div><h4 id="XMLKeyManagementService(XKMS)-Supportedcertificatestypes.">支持的证书类型。</h4><p>XKMS区分以下X509证书类型：</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>类型</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>描述</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>用户</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>普通用户X509证书</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>服务</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>证书标识服务。通过查找和注册，所需的应用程序“ urn：apache：cxf：service：soap”。标识为{SERVICE_ NAMESPACE} SERVICE_NAME</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>受信任的CA</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>CA被证书验证用作可信锚。可以使用trustedAuthorityFilter属性来检索受信任的CA。</p></td></tr></tbody></table></div><p>XKMS服务端点以以下方式配置：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">    &lt;bean id="xkmsProviderBean" class="org.apache.cxf.xkms.service.XKMSService"&gt;
        &lt;property name="validators"&gt;
            &lt;list&gt;
                &lt;ref bean="dateValidator" /&gt;
                &lt;ref bean="trustedAuthorityValidator" /&gt;
            &lt;/list&gt;
        &lt;/property&gt;
        &lt;property name="locators"&gt;
            &lt;list&gt;
                &lt;ref bean="x509Locator" /&gt;
            &lt;/list&gt;
        &lt;/property&gt;
        &lt;property name="keyRegisterHandlers"&gt;
            &lt;list&gt;
                &lt;ref bean="x509Register" /&gt;
            &lt;/list&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;jaxws:endpoint id="XKMSService"
        xmlns:serviceNamespace="http://www.w3.org/2002/03/xkms#wsdl"
        serviceName="serviceNamespace:XKMSService" endpointName="serviceNamespace:XKMSPort"
        implementor="#xkmsProviderBean" address="/XKMS"&gt;
    &lt;/jaxws:endpoint&gt;
</pre>
</div></div><h4 id="XMLKeyManagementService(XKMS)-DataFormats">资料格式</h4><p>输入和输出数据格式在XML密钥管理服务规范版本2.0中指定（请参阅<a shape="rect" class="external-link" href="http://www.w3.org/TR/xkms2/" rel="nofollow">XKMS 2.0</a> ）。XKMS服务仅支持指定请求和响应的子集。<br clear="none">下表描述了请求和响应格式的限制：</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>元素XPath</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>支持价值</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>描述</p></th></tr><tr><td colspan="1" rowspan="3" class="confluenceTd"><p>RootElement / QueryKeyBinding / UseKeyWith @ Application</p><p> </p><p> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>骨灰盒：ietf：rfc：2459</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>应用程序在标识符属性中指定X509 SubjectDN。用于普通用户证书</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>urn：apache：cxf：service：name</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>应用程序在“标识符”属性中将服务名称指定为{SERVICE_ NAMESPACE} SERVICE_NAME。用于服务证书</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd">urn：apache：cxf：service：endpoint</td><td colspan="1" rowspan="1" class="confluenceTd">应用程序在“标识符”属性中指定服务端点</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>RootElement / QueryKeyBinding / UseKeyWith @ Identifier</p></td><td colspan="1" rowspan="1" class="confluenceTd"><ul><li>X509 Subject DN;</li><li>服务名称为{SERVICE_ NAMESPACE} SERVICE_NAME</li><li>服务端点</li></ul></td><td colspan="1" rowspan="1" class="confluenceTd"><p>根据应用程序属性，将公钥标识为X509主题DN或服务名称服务证书</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>RootElement / UnverifiedKeyBinding / KeyInfo</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>X509Data / X509Certificate</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>仅支持带有X509Certificate的X509Data</p></td></tr></tbody></table></div><h4 id="XMLKeyManagementService(XKMS)-ErrorHandling">错误处理</h4><p><a shape="rect" class="external-link" href="http://www.w3.org/TR/xkms2/" rel="nofollow">XKMS 2.0</a>中指定了成功和故障响应格式。使用根响应元素中的ResultMajor和ResultMinor属性报告XKMS服务中的错误情况。<br clear="none">XKMS服务使用以下值作为响应代码：</p><p>结果重大</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>值</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>描述</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>成功</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>操作成功。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>接收者</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>接收器发生错误。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>发件人</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>由于发件人发送的消息而发生错误。</p></td></tr></tbody></table></div><p>结果小</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>值</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>描述</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>失败</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>服务尝试执行请求，但操作失败。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>无比赛</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>找不到与提供的搜索原型匹配的内容。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>太多回应</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>该请求导致响应数量超出了服务确定的限制。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>TimeInstantNotSupported</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>接收者拒绝了该操作，因为它不支持TimeInstant元素。</p></td></tr></tbody></table></div><h4 id="XMLKeyManagementService(XKMS)-Deployment">部署方式</h4><p>XKMS服务可以部署到Web和OSGi容器中。该服务实现已通过Tomcat和Karaf进行了测试。</p><h4 id="XMLKeyManagementService(XKMS)-SampleRequestsandResponses">样本请求和响应</h4><p>定位操作的样本请求：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"&gt;
    &lt;soap:Body&gt;
        &lt;ns2:LocateRequest xmlns="http://www.w3.org/2000/09/xmldsig#"
            xmlns:ns2="http://www.w3.org/2002/03/xkms#" 
            xmlns:ns3="http://www.w3.org/2001/04/xmlenc#"
            Id="I047257513d19456687e6b4f4a2a72606" Service="http://cxf.apache.org/services/XKMS/"&gt;
            &lt;ns2:QueryKeyBinding&gt;
                &lt;ns2:UseKeyWith Application="urn:ietf:rfc:2459"
                    Identifier="EMAILADDRESS=client@client.com, CN=www.client.com, OU=IT Department, 
O=Sample Client -- NOT FOR PRODUCTION, L=Niagara Falls, ST=New York, C=US" /&gt;
            &lt;/ns2:QueryKeyBinding&gt;
        &lt;/ns2:LocateRequest&gt;
    &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre>
</div></div><p>查找操作的样本响应：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"&gt;
    &lt;soap:Body&gt;
        &lt;ns2:LocateResult ResultMajor="http://www.w3.org/2002/03/xkms#Success"
            RequestId="I047257513d19456687e6b4f4a2a72606" Id="I0758390284847918129574923948"
            Service="http://cxf.apache.org/services/XKMS/" 
            xmlns:ns2="http://www.w3.org/2002/03/xkms#"
            xmlns:ns3="http://www.w3.org/2001/04/xmlenc#" 
            xmlns:ns4="http://www.w3.org/2000/09/xmldsig#"
            xmlns:ns5="http://www.w3.org/2002/03/xkms#wsdl"&gt;
            &lt;ns2:UnverifiedKeyBinding&gt;
                &lt;ns4:KeyInfo&gt;
                    &lt;ns4:X509Data&gt;
                        &lt;ns4:X509Certificate&gt;&#8230; &lt;/ns4:X509Certificate&gt;
                    &lt;/ns4:X509Data&gt;
                &lt;/ns4:KeyInfo&gt;
            &lt;/ns2:UnverifiedKeyBinding&gt;
        &lt;/ns2:LocateResult&gt;
    &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre>
</div></div><p>示例错误消息：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"&gt;
    &lt;soap:Body&gt;
        &lt;ns2:LocateResult ResultMajor="http://www.w3.org/2002/03/xkms#Receiver"
            ResultMinor="http://www.w3.org/2002/03/xkms#Failure"
            RequestId="I047257513d19456687e6b4f4a2a72606" Id="I0758390284847918129574923948"
            Service="http://cxf.apache.org/services/XKMS/" 
            xmlns:ns2="http://www.w3.org/2002/03/xkms#"
            xmlns:ns3="http://www.w3.org/2001/04/xmlenc#" 
            xmlns:ns4="http://www.w3.org/2000/09/xmldsig#"
            xmlns:ns5="http://www.w3.org/2002/03/xkms#wsdl"&gt;

            &lt;ns2:MessageExtension xsi:type="ns5:resultDetails"
                xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
                &lt;Details&gt;Search certificates failure: Application
                    identifier not supported&lt;/Details&gt;
            &lt;/ns2:MessageExtension&gt;
        &lt;/ns2:LocateResult&gt;
    &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre>
</div></div><h4 id="XMLKeyManagementService(XKMS)-CurrentrestrictionsandToDos">当前限制和待办事项</h4><ul><li>仅支持X509证书作为密钥；</li><li>仅支持基于LDAP和文件的后端；</li><li>需要更多的集成测试</li></ul></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=31820321">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=31820321&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>