<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - Multiplexed EndpointReferences">




    <title>Apache CXF-多路复用端点参考</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="advanced-integration.html">高级集成</a> > <a href="multiplexed-endpointreferences.html">复用端点参考</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><form id="cse-search-box" enctype="application/x-www-form-urlencoded" method="get" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="搜索">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><p>CXF中对Multiplexed EndpointReferences的支持允许单个无状态服务实例表示/模拟多个服务实例。单个服务本身不维护任何状态，而是使用当前目标EndpointReference的属性来标识实例数据。EndpointReference中的状态搭载是应用程序级别多路复用的一种形式。</p>

<p>为了说明这一点，请考虑一个名为<em>Number</em>的简单Web服务，该服务代表一个整数并支持单个操作<em>isEven</em> ，如果<em>Number</em>是偶数，则返回true。还考虑一个<em>NumberFactory</em>服务，该服务通过操作<em>create（int）</em>将Endpoint References（EPR）返回给<em>Numbers</em> 。</p>

<p>NumberFactory.create（）的典型实现将为每个请求的整数值实例化并发布一个终结点，并将相应的EPR返回给调用方。给定无限可能的<em>Number</em>值集，随着创建不同值的调用数量增加，此实现的伸缩性将很差。</p>

<p>输入多路复用端点引用。NumberFactory.create（）的实现实例化并发布一个模板服务。然后，对于Number的每个唯一值，该实现（使用CXF API）针对该特定值生成多路EPR。该EPR返回给呼叫者。</p>

<p>单个模板编号服务的实现需要一种在运行时动态确定其当前状态或值的机制。它基于目标EndpointReference从CXF获得此信息。然后，它继续确定当前值是否为偶数，并将结果返回给调用方。</p>

<p>这样，单个服务实例可以表示所有可能的号码，唯一的状态将嵌入在由调用方维护的多路复用端点引用中。</p>

<p>这是NumberFactory.create（）的基本实现：</p>

<div class="preformatted panel" style="border-width:1px"><div class="preformattedContent panelContent">
<pre>EndpointReferenceType create(int val) {
   synchronized (this) {
     if (!servicePublished) {
        publishSingleInstanceServant(SERVICE_QNAME);
        servicePublished = true;
     }
   }
   String state = String.valueOf(val);
   String portName = null; // unless there are multiple ports in the service 
   return EndpointReferenceUtils.getEndpointReferenceWithId(SERVICE_QNAME, 
              portName, state, BusFactory.getDefaultBus()); 
}
</pre>
</div></div> 

<p>这是Number.isEven（）的基本实现：</p>

<div class="preformatted panel" style="border-width:1px"><div class="preformattedContent panelContent">
<pre> 
@Resource
protected WebServiceContext wsContext;
    
public boolean isEven() {

    MessageContext messageContext = wsContext.getMessageContext();
    String state = EndpointReferenceUtils
        .getCurrentEndpointReferenceId(messageContext);
        
    int val = Integer.parseInt(state);
    return valIsEven(val);
}
</pre>
</div></div> 

<h5 id="MultiplexedEndpointReferences-HowdoesitWork">它是如何工作的</h5>
<p>该API使用WS-Addressing（WS-A）参考参数将用户状态嵌入到EndpointReference中。参考参数是返回给调用方的EPR的一部分。WS-A拦截器用于在使用返回的EPR的后续调用中，将参考参数作为肥皂头传播。在接收端，查询当前的WS-A MEP以从参考参数中提取状态。</p>


<h5 id="MultiplexedEndpointReferences-WorkingwithoutWS-Addressing">在没有WS-Addressing的情况下工作</h5>
<p>WS-A为状态转移提供了一种与传输/协议无关的方法，并且是CXF支持的默认复用机制。但是，某些传输（尤其是HTTP）对上下文和查询参数形式的复用具有隐式支持。CXF HTTP传输支持<em>multiplexWithAddress</em>配置属性，该属性在启用时会否决WS-A的使用，并强制将状态嵌入URL上下文中。</p>

<p>例如，在上面的数字方案中，单个数字服务端点将发布以下形式的URL： <a shape="rect" class="external-link" rel="nofollow" href="http://host:port/NumberService/Number/">http：// host：port / NumberService / Number /，</a>且URL匹配策略为stem。调用NumberFactory.create（22）会导致EPR包含地址元素<a shape="rect" class="external-link" href="http://localhost:9080/NumberService/Number/22" rel="nofollow">http：// localhost：9080 / NumberService / Number / 22</a> 。通过这种方式，多路复用状态成为HTTP端点地址URL的自然部分，可以由本机HTTP客户端使用。</p>

<p>通过将以下内容添加到cxf.xml来启用HTTP的<em>multiplexWithAddress</em>属性</p>
<div class="preformatted panel" style="border-width:1px"><div class="preformattedContent panelContent">
<pre>&lt;bean name="&lt;port name&gt;.http-destination" abstract="true"&gt;
  &lt;property name="multiplexWithAddress" value="true"/&gt;
&lt;/bean&gt;

&lt;!-- or for all http ports (using a wildcard) --&gt;
&lt;bean name="*" abstract="true" class="org.apache.cxf.transport.http_jetty.JettyHTTPDestination"&gt;
  &lt;property name="multiplexWithAddress" value="true"/&gt;
&lt;/bean&gt;
</pre>
</div></div> 


<h5 id="MultiplexedEndpointReferences-UsingEndpointRefernceswithaJAX-WSService">将EndpointRefernces与JAX-WS服务一起使用</h5>
<p>JAX-WS 2.0提供的API允许使用EPR创建端口。 CXF正在努力获得与JAX-WS 2.0不兼容的JAX-WS 1.0认证。因此，在短期内，CXF将不会公开有用的JAX-WS 2.0 API。作为一个临时解决方案，CXF提供了一个实用程序类<em>ServiceDelegateAccessor</em> ，该类允许JAX-WS客户端引用存在getPort（EndpointReferenceType ..）方法的基础提供程序实现对象。</p>

<p>示例JAX-WS客户端代码将执行以下操作以使用EPR访问Number实例-</p>
<div class="preformatted panel" style="border-width:1px"><div class="preformattedContent panelContent">
<pre> 
NumberFactoryService service = new NumberFactoryService();
NumberFactory factory = service.getNumberFactoryPort();
        
EndpointReferenceType epr = factory.create("20");
NumberService numService = new NumberService();
ServiceImpl serviceImpl = ServiceDelegateAccessor.get(numService);                   
Number num = (Number)serviceImpl.getPort(epr, Number.class);
...
</pre>
</div></div> </div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=52211">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=52211&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>