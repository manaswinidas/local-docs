<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - ATOM Logging">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script src='/resources/highlighter/scripts/shBrushXml.js'></script>
<script src='/resources/highlighter/scripts/shBrushBash.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-ATOM日志记录</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="debugging-and-logging.html">调试和日志记录</a> > <a href="atom-logging.html">ATOM日志记录</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><form id="cse-search-box" enctype="application/x-www-form-urlencoded" method="get" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="搜索">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><p><strong>此功能自CXF 2.3.0起作为cxf-rt-management-web组件的一部分提供，但自CXF 3.2.0起不再存在。<br clear="none"></strong></p><p>CXF支持收集日志事件，将其转换为<a shape="rect" class="external-link" href="http://tools.ietf.org/html/rfc4287" rel="nofollow">ATOM联合格式，</a>并将其推送给支持Atom的使用者或使其可用于轮询。日志基于自定义<code>java.util.logging</code> （JUL）处理程序，可以向记录器注册，以扩展当今的发布协议。</p><p><strong>CXF JAXRS和JAXWS端点</strong>可以利用此功能。</p><h2 id="ATOMLogging-PushStyle">推式</h2><p>推式处理程序使从记录器发布的日志记录排队。在队列大小超过可配置的“批处理大小”之后，将触发这些记录的收集处理（以批处理大小为单位）。日志事件的批处理由转换器转换为ATOM元素，然后由交付者将其推送到客户端。转换器和交付器都是可配置的单元，可以更改转换和运输策略。如果需要，可以在预定义的自定义实现旁边使用–请参见示例。批处理将按顺序进行处理，以允许客户端重新创建事件流。</p><p><strong>限制：</strong>开箱即用不支持可靠性，但是有预定义的重试交付策略。还不支持持久性，关闭时所有排队和未送达的日志事件都会丢失。传递端点的定义是静态的，尚不支持回调URI的订阅。</p><h3 id="ATOMLogging-Springconfiguration">弹簧配置</h3><p>在最简单的情况下，可以通过以下方式声明推送ATOM Feed：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">   &lt;bean class="org.apache.cxf.management.web.logging.atom.AtomPushBean" init-method="init"&gt;
       &lt;property name="url" value="http://somewhere.com/foo/bar"/&gt;
       &lt;property name="level" value="ALL" /&gt;
   &lt;/bean&gt;
</pre>
</div></div><p>Spring bean创建ATOM推送处理程序，并在所有日志级别的根记录器中注册它。此设置导致记录所有CXF，Spring和其他内容。由于未指定批量大小，因此使用默认值1-每个事件都打包为单个提要，并推送到指定的URL。使用默认的转换策略和基于WebClient的默认传递。</p><p>更复杂的示例显示了如何指定非root记录器并定义批处理大小：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">   &lt;bean class="org.apache.cxf.management.web.logging.atom.AtomPushBean" init-method="init"&gt;
       &lt;property name="url" value="http://somewhere.com/foo/bar"/&gt;
       &lt;property name="logger" value="org.apache.cxf.jaxrs" /&gt;
       &lt;property name="level" value="INFO" /&gt;
       &lt;property name="batchSize" value="10" /&gt;
   &lt;/bean&gt;
</pre>
</div></div><p>要推送由不同级别的不同记录器生成的客户端事件，必须使用“ loggers”属性来代替“ logger”和“ level”对：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">   &lt;bean class="org.apache.cxf.jaxrs.management.web.atom.AtomPushBean" init-method="init"&gt;
       &lt;property name="url" value="http://somewhere.com/foo/bar"/&gt;
       &lt;property name="loggers" value="
           org.apache.cxf:DEBUG,
           org.apache.cxf.jaxrs,
           org.apache.cxf.bus:ERROR,
           myNamedLogger:INFO" /&gt;
   &lt;/bean&gt;
</pre>
</div></div><p>在上面的示例中，第二个记录器没有指定级别，在这种情况下，使用默认级别“ INFO”。</p><p>在上述所有情况下，当首次交付失败时，ATOM推送处理程序的引擎将关闭，并且不会处理和推送任何事件，直到重新加载配置。为了避免这种频繁的情况，可以启用重试：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">   &lt;bean class="org.apache.cxf.management.web.logging.atom.AtomPushBean" init-method="init"&gt;
       &lt;property name="url" value="http://somewhere.com/foo/bar"/&gt;
       &lt;property name="logger" value="org.apache.cxf.jaxrs" /&gt;
       &lt;property name="level" value="INFO" /&gt;
       &lt;property name="retryPause" value="linear" /&gt;
       &lt;property name="retryPauseTime" value="60" /&gt;
       &lt;property name="retryTimeout" value="300" /&gt;
   &lt;/bean&gt;
</pre>
</div></div><p>在这种情况下，交付失败后持续5分钟（“ retryTimeout”），每次都会重复1分钟的暂停（“ retryPauseTime”），并具有相同的值（“ retryPause”为“ linear”）。代替相同的暂停时间，可以使用“ retryPause”的“指数”值-每次下一次暂停时间加倍。当超时值设置为0时，重试是无限的。如果值无效或缺失，则使用默认值：暂停时间30秒，超时0（无限）。代替相同的暂停时间，可以使用“ retryPauseType”的“指数”值-每次下一次暂停时间加倍。当超时值设置为0时，重试是无限的。如果值无效或缺失，则使用默认值：暂停时间30秒，超时0（无限）。</p><p>最终控制由“转换器”和“传递者”属性提供。可以使用预定义或自定义类的Bean（有关更多详细信息，请参见“编程风格”一章）。下面的示例显示使用与默认协议不同的传输协议的自定义类：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">   &lt;bean id="soapDeliverer" ...
   ...
   &lt;bean class="org.apache.cxf.management.web.logging.atom.AtomPushBean" init-method="init"&gt;
       &lt;property name="deliverer"&gt;
           &lt;ref bean="soapDeliverer"/&gt;
       &lt;/property&gt;
       &lt;property name="loggers" ... /&gt;
   &lt;/bean&gt;
</pre>
</div></div><p>请注意，指定自定义传递程序会导致忽略“ url”和“ retryXxx”，因为在底层配置中，已使用提供的一个替换了RetryingDeliverer和WebClientDeliverer的已用串联。</p><p>当必须将ATOM提要传递到多个端点并且另外，每个端点由不同的记录器提供时，只需在Spring配置中使用多个ATOM推送bean：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">   &lt;bean id="atom1" class="org.apache.cxf.management.web.logging.atom.AtomPushBean" init-method="init"&gt;
       &lt;property name="url" value="http://someplace.com/foo/bar"/&gt;
       ...
   &lt;/bean&gt;
   &lt;bean id="atom2" class="org.apache.cxf.jaxrs.management.web.atom.AtomPushBean" init-method="init"&gt;
       &lt;property name="url" value="http://otherplace.com/baz/blah"/&gt;
       ...
   &lt;/bean&gt;
   ....
</pre>
</div></div><h3 id="ATOMLogging-Propertiesfile">属性文件</h3><p>如果在不使用Spring的情况下使用CXF或使用属性文件配置日志记录，则对这种类型的配置的支持将变得很方便。ATOM推处理程序支持带有属性文件的“简单配置”。与JUL配置的表达方式相一致的简单方法，仅限于以下情况：每种类型的处理程序只能使用一次并在root记录器中注册。</p><p>属性集与Spring配置非常相似，但有以下例外：</p><ul><li>属性指定自定义传递程序和转换器的类，而不是实例。</li><li>自定义传递程序必须具有仅带有String参数的公共构造函数；创建的实例将传递客户端的URL。</li><li>开箱即用不支持多个客户端端点（无法像在Spring中那样实例化多个处理程序）</li></ul><p>例：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;"> handlers = org.apache.cxf.management.web.logging.atom.AtomPushHandler, java.util.logging.ConsoleHandler
 .level = INFO
 ...
 org.apache.cxf.jaxrs.ext.management.web.AtomPushHandler.url = http://localhost:9080
 org.apache.cxf.jaxrs.ext.management.web.AtomPushHandler.batchSize = 10
 org.apache.cxf.jaxrs.ext.management.web.AtomPushHandler.deliverer = WebClientDeliverer 
 org.apache.cxf.jaxrs.ext.management.web.AtomPushHandler.converter = foo.bar.MyConverter
 org.apache.cxf.jaxrs.ext.management.web.AtomPushHandler.retry.pause = linear
 org.apache.cxf.jaxrs.ext.management.web.AtomPushHandler.retry.pause.time = 10
 org.apache.cxf.jaxrs.ext.management.web.AtomPushHandler.retry.timeout = 360
 ...
</pre>
</div></div><h3 id="ATOMLogging-Programmingstyle">程式风格</h3><p>在大多数复杂情况下，使用<code><a shape="rect" href="http://cxf.apache.org/javadoc/latest/org/apache/cxf/management/web/logging/atom/package-summary.html">org.apache.cxf.jaxrs.ext.logging.atom</a></code>包装可能是必要的。在这种情况下，AtomPushHandler类是主要工件，而Deliverer和Converter接口及其实现是必需的组件。</p><p>以下示例：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">    Deliverer d = new WebClientDeliverer("http://somewhere.com/foo/bar");
    d = new RetryingDeliverer(d, 300, 60, true);
    Converter c = new SingleEntryContentConverter();
    AtomPushHandler h = new AtomPushHandler(1, c, d);    
    Logger l = Logger.getLogger("org.apache.cxf.jaxrs");
    l.setLevel(Level.INFO);
    l.addHandler(h);
</pre>
</div></div><p>等同于Spring配置：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">   &lt;bean class="org.apache.cxf.management.web.logging.atom.AtomPushBean" init-method="init"&gt;
       &lt;property name="url" value="http://somewhere.com/foo/bar"/&gt;
       &lt;property name="logger" value="org.apache.cxf.jaxrs" /&gt;
       &lt;property name="level" value="INFO" /&gt;
       &lt;property name="retryPause" value="linear" /&gt;
       &lt;property name="retryPauseTime" value="60" /&gt;
       &lt;property name="retryTimeout" value="300" /&gt;
   &lt;/bean&gt;
</pre>
</div></div><h2 id="ATOMLogging-PollStyle">投票方式</h2><p><a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/rt/management-web/src/main/java/org/apache/cxf/management/web/logging/atom/AtomPullServer.java">AtomPullServer</a>充当Atom提要端点，并使它积累或从某个外部存储读取的所有日志事件可用于轮询。</p><p>日志事件在页面中可用，即提要实例将列出最多可配置的条目数，并且还将包括类型为“上一个”，“下一个”，“第一个”和“最后一个”的原子链接，从而使其可以浏览所有日志记录。</p><h3 id="ATOMLogging-Springconfiguration.1">弹簧配置</h3><p>在配置AtomPullServer端点时，可以像对AtomPushBeans一样设置'loggers'属性，例如：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">   &lt;bean class="org.apache.cxf.management.web.logging.atom.AtomPullServer" init-method="init"&gt;
       &lt;property name="loggers" value="
           org.apache.cxf:DEBUG,
           org.apache.cxf.jaxrs,
           org.apache.cxf.bus:ERROR,
           myNamedLogger:INFO" /&gt;
       &lt;property name="pageSize" value="30"/&gt;
   &lt;/bean&gt;
</pre>
</div></div><p>除了'loggers'属性之外，还设置了'pageSize'属性，该属性将每页的条目数限制为30（默认值为40）。</p><p>如果必须定期从内存中卸载日志记录并在重新启动后持续存在，则可以将<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/rt/management-web/src/main/java/org/apache/cxf/management/web/logging/ReadWriteLogStorage.java">ReadWriteLogStorage</a> bean注入AtomPushBean中：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">   &lt;bean id="storage" class="org.apache.cxf.systest.jaxrs.JAXRSLoggingAtomPullSpringTest$Storage"/&gt;

   &lt;bean class="org.apache.cxf.management.web.logging.atom.AtomPullServer" init-method="init"&gt;
       &lt;property name="loggers" value="org.apache.cxf.jaxrs" /&gt;
       &lt;property name="maxInMemorySize" value="400"/&gt;
       &lt;property name="storage"&gt;
           &lt;ref bean="storage"/&gt;
       &lt;/property&gt;
   &lt;/bean&gt;
</pre>
</div></div><p>当内存中的记录数达到400（默认值为500）时，记录将被卸载到提供的存储中，并在重新启动后或客户端请求相关页面时从存储中读取。如果没有可用的存储空间，则在达到内存限制后，最早的记录将被丢弃，可以根据需要将maxInMemorySize属性设置为足够大的值。</p><p>另一个选择是要求给定的AtomPullServer通过注册<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/cxf/trunk/rt/management-web/src/main/java/org/apache/cxf/management/web/logging/ReadableLogStorage.java">ReadableLogStorage</a> bean从外部只读存储中读取。例如，很多时候，运行时已经在登录某个外部文件，因此仅在ReadableLogStorage的帮助下，才可以要求AtomPullServer从该文件读取，而AtomPullServer也不必捕获日志事件。</p><p>配置AtomPullServer之后，必须使用jaxrs端点将其注册为服务bean，以便Atom感知客户端（博客阅读器等）可以开始对其进行轮询：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;jaxrs:server id="atomServer" address="/atom"&gt;
 &lt;jaxrs:serviceBeans&gt;
   &lt;ref bean="atomPullServer"/&gt;
 &lt;/jaxrs:serviceBeans&gt;

 &lt;jaxrs:providers&gt;
  &lt;ref bean="feed"/&gt;
  &lt;ref bean="entry"/&gt;
 &lt;/jaxrs:providers&gt;
&lt;/jaxrs:server&gt;

&lt;bean id="feed" class="org.apache.cxf.jaxrs.provider.AtomFeedProvider"/&gt;
&lt;bean id="entry" class="org.apache.cxf.jaxrs.provider.AtomEntryProvider"/&gt;
</pre>
</div></div><h3 id="ATOMLogging-LinkingtoAtomendpointsfromCXFServicespage">从CXF服务页面链接到Atom端点</h3><p>如果您希望用户找到从端点收集日志事件的Atom提要，那么AtomPullServer将需要注入CXF总线，并告知相应的原子提要端点和jaxrs的地址或jaxws端点：</p><div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">&lt;bean id="atomPullServer" class="org.apache.cxf.management.web.logging.atom.AtomPullServer" init-method="init"&gt;
   &lt;property name="loggers" value="org.apache.cxf.systest.jaxrs.JAXRSLoggingAtomPullSpringTest$Resource:ALL"/&gt;
   &lt;property name="bus"&gt;
      &lt;ref bean="cxf"/&gt;
   &lt;/property&gt;
   &lt;!-- this is a jaxrs:server/@adrress or jaxws:endpoint/@address of the endpoint generating the log events --&gt;
   &lt;property name="endpointAddress" value="/resource"/&gt;
   &lt;!-- this is a jaxrs:server/@address of the endpoint for which this atomPullServer bean is registered as a service bean --&gt;
   &lt;property name="serverAddress" value="/atom"/&gt;
&lt;/bean&gt;
</pre>
</div></div></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=61330679">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=61330679&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>