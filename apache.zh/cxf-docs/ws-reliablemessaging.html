<html ><head>

<link type="text/css" rel="stylesheet" href="/resources/site.css">
<script src='/resources/space.js'></script>

<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<meta name="keywords" content="business integration, EAI, SOA, Service Oriented Architecture, web services, SOAP, JBI, JMS, WSDL, XML, EDI, Electronic Data Interchange, standards support, integration standards, application integration, middleware, software, solutions, services, CXF, open source">
<meta name="description" content="Apache CXF, Services Framework - WS-ReliableMessaging">


<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shCoreCXF.css">
<link type="text/css" rel="stylesheet" href="/resources/highlighter/styles/shThemeCXF.css">

<script src='/resources/highlighter/scripts/shCore.js'></script>
<script src='/resources/highlighter/scripts/shBrushJava.js'></script>
<script src='/resources/highlighter/scripts/shBrushBash.js'></script>
<script>
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
</script>


    <title>Apache CXF-WS-ReliableMessaging</title>
  </head>
<body  onload="init()">


<table width="100%" cellpadding="0" cellspacing="0">
  <tbody><tr>
    <td id="cell-0-0" colspan="2"> </td>
    <td id="cell-0-1"> </td>
    <td id="cell-0-2" colspan="2"> </td>
  </tr>
  <tr>
    <td id="cell-1-0"> </td>
    <td id="cell-1-1"> </td>
    <td id="cell-1-2">
      <!-- Banner -->
<div class="banner" id="banner"><div><table border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" colspan="1" nowrap>
<a shape="rect" href="http://cxf.apache.org/" title="Apache CXF"><span style="font-weight:bold;font-size:170%;color:white">Apache CXF</span></a>
</td><td align="right" colspan="1" nowrap>
<a shape="rect" href="http://www.apache.org/" title="阿帕奇软件基金会"><img border="0" alt="ASF徽标" src="http://cxf.apache.org/images/asf-logo.png"></a>
</td></tr></tbody></table></div></div>
      <!-- Banner -->
      <div id="top-menu">
        <table border="0" cellpadding="1" cellspacing="0" width="100%">
          <tbody><tr>
            <td>
              <div align="left">
                <!-- Breadcrumbs --> <a href="index.html">索引</a> > <a href="ws-support.html">WS- *支持</a> > <a href="ws-reliablemessaging.html">WS-ReliableMessaging</a> <!-- Breadcrumbs -->
              </div>
            </td>
            <td>
              <div align="right">
                <!-- Quicklinks -->
<div id="quicklinks"><p><a shape="rect" href="http://cxf.apache.org/download.html">下载</a> | <a shape="rect" href="http://cxf.apache.org/docs/index.html">文献资料</a></p></div>
                <!-- Quicklinks -->
              </div>
            </td>
          </tr>
        </tbody></table>
      </div>
    </td>
    <td id="cell-1-3"> </td>
    <td id="cell-1-4"> </td>
  </tr>
  <tr>
    <td id="cell-2-0" colspan="2"> </td>
    <td id="cell-2-1">
      <table>
        <tbody><tr valign="top">
          <td height="100%">
            <div id="wrapper-menu-page-right">
              <div id="wrapper-menu-page-top">
                <div id="wrapper-menu-page-bottom">
                  <div id="menu-page">
                    <!-- NavigationBar -->
<div id="navigation"><ul class="alternate"><li><a shape="rect" href="overview.html">总览</a></li><li><a shape="rect" href="how-tos.html">操作方法</a></li><li><a shape="rect" href="frontends.html">前端</a></li><li><a shape="rect" href="databindings.html">数据绑定</a></li><li><a shape="rect" href="transports.html">运输工具</a></li><li><a shape="rect" href="configuration.html">组态</a></li><li><a shape="rect" href="debugging-and-logging.html">调试和记录</a></li><li><a shape="rect" href="tools.html">工具类</a></li><li><a shape="rect" href="restful-services.html">RESTful服务</a></li><li><a shape="rect" href="wsdl-bindings.html">WSDL绑定</a></li><li><a shape="rect" href="service-routing.html">服务路由</a></li><li><a shape="rect" href="dynamic-languages.html">动态语言</a></li><li><a shape="rect" href="ws-support.html">WS- *支持</a></li><li><a shape="rect" href="advanced-integration.html">进阶整合</a></li><li><a shape="rect" href="deployment.html">部署方式</a></li><li><a shape="rect" href="schemas-and-namespaces.html">模式和命名空间的使用</a></li></ul><hr><ul class="alternate"><li><p>搜索</p></li></ul><form id="cse-search-box" enctype="application/x-www-form-urlencoded" method="get" action="http://www.google.com/cse">
  <div>
    <input type="hidden" name="cx" value="002890367768291051730:o99qiwa09y4">
    <input type="hidden" name="ie" value="UTF-8">
    <input type="text" name="q" size="21">
    <input type="submit" name="sa" value="搜索">
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script><hr><ul class="alternate"><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest/">API 3.2.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/javadoc/latest-3.1.x/">API 3.1.x（Javadoc）</a></li><li><a shape="rect" href="http://cxf.apache.org/">CXF网站</a></li></ul><p> </p><p><a shape="rect" class="external-link" href="http://www.apache.org/events/current-event.html"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://www.apache.org/events/current-event-125x125.png" data-image-src="http://www.apache.org/events/current-event-125x125.png"></span></a></p></div>
                    <!-- NavigationBar -->
                  </div>
              </div>
            </div>
          </div>
         </td>
         <td height="100%">
           <!-- Content -->
           <div class="wiki-content">
<div id="ConfluenceContent"><h1 id="WS-ReliableMessaging-WS-ReliableMessaging">WS可靠消息传递</h1>

<p>CXF同时支持官方的<a shape="rect" class="external-link" href="http://docs.oasis-open.org/ws-rx/wsrm/200702" rel="nofollow">1.1 / 1.2的Web服务可靠消息传递</a>使用（WS-ReliableMessaging的）协议<span class="nolink">http://docs.oasis-open.org/ws-rx/wsrm/200702</span>命名空间和过时的<a shape="rect" class="external-link" href="http://schemas.xmlsoap.org/ws/2005/02/rm/" rel="nofollow">2005年2月提交的版本</a>使用<span class="nolink">http ：//schemas.xmlsoap.org/ws/2005/02/rm/</span>名称空间。</p>

<p>提交版本使用<span class="nolink">http://schemas.xmlsoap.org/ws/2004/08/addressing</span>名称空间指定了WS-Addressing的过时版本，此名称空间已由官方的<span class="nolink">http://www.w3.org</span>取代<span class="nolink">。 / 2005/08 / addressing</span>名称空间。支持WS-ReliableMessaging提交版本的大多数其他Web服务实现已偏离规范，而转向具有<span class="nolink">http://www.w3.org/2005/08/addressing</span>命名空间的正式WS-Addressing版本。CXF支持带有WS-Addressing名称空间的RM的提交版本。</p>

<p>为了与旧版本的CXF兼容，默认设置是将RM的2005年2月提交版本与WS-Addressing的提交版本一起使用。在客户端，您可以为要使用的任何版本的WS-ReliableMessaging配置CXF（请参阅《 <a shape="rect" href="wsrmconfiguration.html">Reliable Messaging配置指南》</a>以及下面的Runtime控件属性）。在提供者方面，CXF可以适应客户端使用的WS-ReliableMessaging版本并做出适当的响应。</p>

<p>像CXF中的大多数其他功能一样，它也是基于拦截器的。WS-Reliable Messaging实现总共包含6个拦截器：</p>

<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>拦截器</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>任务</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.cxf.ws.rm。RMOut拦截器</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>负责发送CreateSequence请求并等待其CreateSequenceResponse响应，并汇总应用程序消息的序列属性（标识和消息号）。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.cxf.ws.rm。RMIn拦截器</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>拦截和处理RM协议消息（它们不是应用程序级别），以及在应用程序消息上附带的SequenceAcknowledgments。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.cxf.ws.rm。RMCaptureInInterceptor</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>缓存传入消息以进行持久存储。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.cxf.ws.rm。RMDeliveryInterceptor</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>确保消息按顺序传递到应用程序。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.cxf.ws.rm.soap。RMSoapInterceptor</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>编码和解码RM标头</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>org.apache.cxf.ws.rm.soap。重传拦截器</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>负责创建应用程序消息的副本以供将来重新发送。</p></td></tr></tbody></table></div>


<h2 id="WS-ReliableMessaging-InterceptorBasedQOS">基于拦截器的QOS</h2>

<p>RM拦截器仅在各个拦截器链上的存在将确保在必要时交换RM协议消息。例如，在出站拦截器链上拦截了第一个应用程序消息后，RMOutInterceptor将发送一个CreateSequence请求，并且只有在收到具有CreateSequenceResponse响应的原始应用程序消息后，才继续进行处理。此外，RM拦截器负责将Sequence头添加到应用程序消息，并在目标端从消息中提取它们。</p>

<p>这意味着无需更改应用程序代码即可使消息交换可靠！</p>

<p>但是，您仍然可以通过配置来控制序列划分和可靠交换的其他方面。例如，虽然CXF默认情况下尝试最大化序列的生存期，从而减少了RM协议消息的开销，但您可以通过配置RM源的序列终止策略（设置最大序列长度为1）。有关<a shape="rect" href="wsrmconfiguration.html">配置</a>可靠交换的此方面和其他方面的详细信息，请参阅《 <a shape="rect" href="wsrmconfiguration.html">可靠消息配置指南》</a> 。</p>

<h2 id="WS-ReliableMessaging-Runtimecontrol">运行时控制</h2>

<p>可以在客户端代码中设置几个消息上下文属性值，以在运行时控制RM操作，其键值由org.apache.cxf.ws.rm中的公共常量定义。RMManager：</p>

<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>键</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>值</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>WSRM_VERSION_PROPERTY</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>字符串WS-RM版本名称空间（ <span class="nolink">http://schemas.xmlsoap.org/ws/2005/02/rm/</span>或<span class="nolink">http://docs.oasis-open.org/ws-rx/wsrm/200702</span> ）</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>WSRM_WSA_VERSION_PROPERTY</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>字符串WS-Addressing版本名称空间（ <span class="nolink">http://schemas.xmlsoap.org/ws/2004/08/addressing</span>或<span class="nolink">http://www.w3.org/2005/08/addressing）-</span>除非您使用<span class="nolink">http://schemas.xmlsoap.org/ws/2005/02/rm/</span> RM名称空间）</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>WSRM_LAST_MESSAGE_PROPERTY</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>布尔值TRUE告诉RM代码正在发送最后一条消息，从而允许代码关闭RM序列并释放资源（从CXF的3.0.0版本开始，默认情况下，RM代码将在您关闭时关闭RM序列您的客户端；早期版本的CXF不会关闭序列，除非告知您使用此标志或已配置了源策略<wsrm-mgr:sequenceterminationpolicy terminateonshutdown="true"></wsrm-mgr:sequenceterminationpolicy> ）</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>WSRM_INACTIVITY_TIMEOUT_PROPERTY</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>长时间不活动超时（以毫秒为单位）</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>WSRM_RETRANSMISSION_INTERVAL_PROPERTY</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>基本重传间隔长（以毫秒为单位）</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>WSRM_EXPONENTIAL_BACKOFF_PROPERTY</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>布尔指数退避标志</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>WSRM_ACKNOWLEDGEMENT_INTERVAL_PROPERTY</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>较长的确认间隔（以毫秒为单位）</p></td></tr></tbody></table></div>


<p>您还可以使用CXF的<a shape="rect" href="jmx-management.html">JMX管理</a>功能监视和控制RM的许多方面。 JMX操作的完整列表由org.apache.cxf.ws.rm定义。ManagedRMManager和org.apache.cxf.ws.rm。ManagedRMEndpoint，但是这些操作包括查看当前RM状态直至单个消息级别。您还可以使用JXM关闭和/或终止RM序列，并接收有关远程RM端点何时确认先前发送的消息的通知。</p>

<p>例如，如果在客户端配置中启用了JMX服务器，则可以使用以下代码来跟踪收到的最后一个确认号：</p>
<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default" style="font-size:12px;">
    private static class AcknowledgementListener implements NotificationListener {
        private volatile long lastAcknowledgement;
        
        @Override
        public void handleNotification(Notification notification, Object handback) {
            if (notification instanceof AcknowledgementNotification) {
                AcknowledgementNotification ack = (AcknowledgementNotification)notification;
                lastAcknowledgement = ack.getMessageNumber();
            }
        }
     
        // initialize client
    ...
        // attach to JMX bean for notifications
        //  NOTE: you must have sent at least one message to initialize RM before executing this code
        Endpoint ep = ClientProxy.getClient(client).getEndpoint();
        InstrumentationManager im = bus.getExtension(InstrumentationManager.class);
        MBeanServer mbs = im.getMBeanServer();
        RMManager clientManager = bus.getExtension(RMManager.class);
        ObjectName name = RMUtils.getManagedObjectName(clientManager, ep);
        System.out.println("Looking for endpoint name " + name);
        AcknowledgementListener listener = new AcknowledgementListener();
        mbs.addNotificationListener(name, listener, null, null);
        
        // send messages using RM with acknowledgement status reported to listener
    ...

</pre>
</div></div></div>
           </div>
           <!-- Content -->
         </td>
        </tr>
      </tbody></table>
   </td>
   <td id="cell-2-2" colspan="2"> </td>
  </tr>
  <tr>
   <td id="cell-3-0"> </td>
   <td id="cell-3-1"> </td>
   <td id="cell-3-2">
     <div id="footer">
       <!-- Footer -->
       <div id="site-footer">
         <a href="http://cxf.apache.org/privacy-policy.html">隐私政策</a> -（ <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=63532">编辑页面</a> ）（ <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=63532&showComments=true&showCommentArea=true#addcomment">添加评论</a> ）<br>Apache CXF，CXF，Apache，Apache Feather徽标是The Apache Software Foundation的商标。<br>提及的所有其他商标可能是其各自所有者的商标或注册商标。
       </div>
       <!-- Footer -->
     </div>
   </td>
   <td id="cell-3-3"> </td>
   <td id="cell-3-4"> </td>
  </tr>
  <tr>
    <td id="cell-4-0" colspan="2"> </td>
    <td id="cell-4-1"> </td>
    <td id="cell-4-2" colspan="2"> </td>
  </tr>
</tbody></table>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-4458903-1");
pageTracker._trackPageview();
} catch(err) {}</script>




</body></html>