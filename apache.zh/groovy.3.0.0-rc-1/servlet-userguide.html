<html lang="zh-Hans" ><head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Servlet支持</title>
<link rel="stylesheet" href="./assets/css/style.css">
<link rel="stylesheet" href="asset?aid=0">
</head>
<body class="book toc2 toc-left" >
<div id="header">
<h1>Servlet支持</h1>
<div class="details">
<span id="revnumber">版本3.0.0-rc-1</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">目录</div>
<ul class="sectlevel1">
<li><a href="#_implicit_variables">1。隐式变量</a></li>
<li><a href="#_setting_up_groovylets">2。设置groovylet</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>您可以用Groovy（称为Groovlets）编写（Java）Servlet。</p>
</div>
<div class="paragraph">
<p>还有一个<code>GroovyServlet</code> 。</p>
</div>
<div class="paragraph">
<p>此功能将自动编译.groovy源文件，将它们转换为字节码，加载类并对其进行缓存，直到更改源文件为止。</p>
</div>
<div class="paragraph">
<p>这是一个简单的示例，向您展示可以通过Groovlet执行的操作。</p>
</div>
<div class="paragraph">
<p>注意使用隐式变量访问会话，输出和请求。还要注意，这更像是脚本，因为它没有类包装器。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">if (!session) {
  session = request.getSession(true)
}

if (!session.counter) {
  session.counter = 1
}

println """
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Groovy Servlet&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;p&gt;
Hello, ${request.remoteHost}: ${session.counter}! ${new Date()}
        &lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;
"""
session.counter = session.counter + 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者，使用MarkupBuilder执行相同的操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">if (!session) {
    session = request.getSession(true)
}

if (!session.counter) {
    session.counter = 1
}

html.html { // html is implicitly bound to new MarkupBuilder(out)
  head {
      title('Groovy Servlet')
  }
  body {
    p("Hello, ${request.remoteHost}: ${session.counter}! ${new Date()}")
  }
}
session.counter = session.counter + 1</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implicit_variables"><a class="anchor" href="#_implicit_variables"></a> 1。隐式变量</h2>
<div class="sectionbody">
<div class="paragraph">
<p>可以在Groovlets中使用以下变量：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">变量名</th>
<th class="tableblock halign-left valign-top">势必</th>
<th class="tableblock halign-left valign-top">注意</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servlet请求</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>--</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServletResponse</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>--</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">语境</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServletContext</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>--</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">应用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServletContext</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>--</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">会议</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getSession（false）</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>可以为空！参见<1></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">参数</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>地图对象</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">标头</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>地图对象</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">出</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">response.getWriter（）</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>参见<2></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">出口</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">response.getOutputStream（）</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>参见<2></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">html</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">新的MarkupBuilder（out）</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>参见<2></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">新的StreamingJsonBuilder（out）</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>参见<2></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>如果已有会话对象，则仅设置会话变量。见<code>if (session == null)</code>检查上面的示例。</p>
</li>
<li>
<p>这些变量不能在内部重新分配<code>Groovlet</code> 。它们在首次访问时受到限制，从而允许在<code>response</code>使用之前的对象<code>out</code> 。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_up_groovylets"><a class="anchor" href="#_setting_up_groovylets"></a> 2。设置groovylet</h2>
<div class="sectionbody">
<div class="paragraph">
<p>将以下内容添加到您的<code>web.xml</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;servlet&gt;
    &lt;servlet-name&gt;Groovy&lt;/servlet-name&gt;
    &lt;servlet-class&gt;groovy.servlet.GroovyServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;Groovy&lt;/servlet-name&gt;
    &lt;url-pattern&gt;*.groovy&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后将所需的groovy jar文件放入<code>WEB-INF/lib</code> 。</p>
</div>
<div class="paragraph">
<p>现在，将.groovy文件放入根目录（例如，将html文件放入的目录）。的<code>GroovyServlet</code>负责编译.groovy文件。</p>
</div>
<div class="paragraph">
<p>因此，例如使用tomcat，您可以编辑<code>tomcat/conf/server.xml</code>像这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;Context path="/groovy" docBase="c:/groovy-servlet"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后使用<a href="http://localhost:8080/groovy/hello.groovy" class="bare">http：// localhost：8080 / groovy / hello.groovy</a>访问它</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">版本3.0.0-rc-1<br>最近更新时间2019-10-22 17:47:02 AEST</div>
</div>
<link rel="stylesheet" href="asset?aid=1">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>prettyPrint()</script>

</body></html>