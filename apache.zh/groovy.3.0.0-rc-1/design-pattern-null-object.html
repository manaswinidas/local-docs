<html lang="zh-Hans" ><head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>空对象模式</title>
<link rel="stylesheet" href="./assets/css/style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left" >
<div id="header">
<h1>空对象模式</h1>
<div class="details">
<span id="revnumber">版本3.0.0-rc-1</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">目录</div>
<ul class="sectlevel1">
<li><a href="#_simple_example">1。简单的例子</a></li>
<li><a href="#_tree_example">2。树例</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/Null_Object_pattern">空对象模式</a>涉及使用表示空的特殊对象位置标记对象。通常，如果您引用了null，则无法调用<code>reference.field</code>要么<code>reference.method()</code>您会收到可怕的消息<code>NullPointerException</code> 。空对象模式使用代表空的特殊对象，而不是实际的<code>null</code> 。这使您可以在空对象上调用字段和方法引用。使用null对象的结果在语义上应等效于不<em>执行任何操作</em> 。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_simple_example"><a class="anchor" href="#_simple_example"></a> 1。简单的例子</h2>
<div class="sectionbody">
<div class="paragraph">
<p>假设我们有以下系统：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class Job {
    def salary
}

class Person {
    def name
    def Job job
}

def people = [
    new Person(name: 'Tom', job: new Job(salary: 1000)),
    new Person(name: 'Dick', job: new Job(salary: 1200)),
]

def biggestSalary = people.collect { p -&gt; p.job.salary }.max()
println biggestSalary</code></pre>
</div>
</div>
<div class="paragraph">
<p>运行时，将打印出<code>1200</code> 。现在假设我们现在调用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">people &lt;&lt; new Person(name: 'Harry')</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果我们现在尝试计算<code>biggestSalary</code>再次，我们收到一个空指针异常。</p>
</div>
<div class="paragraph">
<p>为了解决这个问题，我们可以引入<code>NullJob</code>类并将上面的语句更改为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class NullJob extends Job { def salary = 0 }

people &lt;&lt; new Person(name: 'Harry', job: new NullJob())
biggestSalary = people.collect { p -&gt; p.job.salary }.max()
println biggestSalary</code></pre>
</div>
</div>
<div class="paragraph">
<p>这可以按照我们的要求工作，但它并非始终是使用Groovy做到这一点的最佳方法。Groovy的安全引用运算符（ <code>?.</code> ）运算符和null感知闭包通常使Groovy避免需要创建特殊的null对象或null类。通过研究编写上面示例的更简单的方式可以说明这一点：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">people &lt;&lt; new Person(name:'Harry')
biggestSalary = people.collect { p -&gt; p.job?.salary }.max()
println biggestSalary</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了使此工作正常进行，有两件事在进行。首先， <code>max()</code>是<em>“空感知”的，</em>因此[300，null，400] .max（）== 400。其次， <code>?.</code>运算符，类似<code>p?.job?.salary</code>如果等于，则等于null <code>salary</code>等于null，或者<code>job</code>等于`null或<code>p</code>等于null。如果...那么...则不需要编写复杂的嵌套代码，否则可以避免<code>NullPointerException</code> 。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tree_example"><a class="anchor" href="#_tree_example"></a> 2。树例</h2>
<div class="sectionbody">
<div class="paragraph">
<p>考虑下面的示例，在该示例中我们要计算树结构中所有值的大小，累积总和和累积乘积。</p>
</div>
<div class="paragraph">
<p>我们的首次尝试在计算方法内具有特殊的逻辑以处理空值。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class NullHandlingTree {
    def left, right, value

    def size() {
        1 + (left ? left.size() : 0) + (right ? right.size() : 0)
    }

    def sum() {
       value + (left ? left.sum() : 0) + (right ? right.sum() : 0)
    }

    def product() {
       value * (left ? left.product() : 1) * (right ? right.product() : 1)
    }
}

def root = new NullHandlingTree(
    value: 2,
    left: new NullHandlingTree(
        value: 3,
        right: new NullHandlingTree(value: 4),
        left: new NullHandlingTree(value: 5)
    )
)

println root.size()
println root.sum()
println root.product()</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果我们引入空对象模式（此处通过定义<code>NullTree</code>类），我们现在可以简化逻辑<code>size()</code> ， <code>sum()</code>和`product（）`方法。现在，这些方法可以更清楚地表示正常（现在是通用）情况的逻辑。内的每种方法<code>NullTree</code>返回一个表示什么都不做的值。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class Tree {
    def left = new NullTree(), right = new NullTree(), value

    def size() {
        1 + left.size() + right.size()
    }

    def sum() {
       value + left.sum() + right.sum()
    }

    def product() {
       value * left.product() * right.product()
    }
}

class NullTree {
    def size() { 0 }
    def sum() { 0 }
    def product() { 1 }
}

def root = new Tree(
    value: 2,
    left: new Tree(
        value: 3,
        right: new Tree(value: 4),
        left: new Tree(value: 5)
    )
)

println root.size()
println root.sum()
println root.product()</code></pre>
</div>
</div>
<div class="paragraph">
<p>运行以下两个示例之一的结果是：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>4
14
120</pre>
</div>
</div>
<div class="paragraph">
<p>注意：null对象模式的微小变化是将其与单例模式组合。因此，如上所述，我们在需要空对象的地方都不会编写新的NullTree（）。相反，我们将有一个空对象实例，可以根据需要将其放置在数据结构中。</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">版本3.0.0-rc-1<br>最近更新时间2019-10-22 17:47:03 AEST</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>prettyPrint()</script>

</body></html>