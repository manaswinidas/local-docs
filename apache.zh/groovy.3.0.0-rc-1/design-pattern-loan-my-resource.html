<html lang="zh-Hans" ><head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>贷款我的资源模式</title>
<link rel="stylesheet" href="./assets/css/style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left" >
<div id="header">
<h1>贷款我的资源模式</h1>
<div class="details">
<span id="revnumber">版本3.0.0-rc-1</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">目录</div>
<ul class="sectlevel1">
<li><a href="#_example">1。例</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://wiki.scala-lang.org/display/SYGN/Loan">贷款我的资源</a>模式可确保一旦超出范围，就可以确定性地处置资源。</p>
</div>
<div class="paragraph">
<p>该模式内置于许多Groovy帮助器方法中。如果您需要使用Groovy支持的以外的方式来处理资源，则应该考虑自己使用它。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example"><a class="anchor" href="#_example"></a> 1。例</h2>
<div class="sectionbody">
<div class="paragraph">
<p>考虑以下适用于文件的代码。首先，我们可以在文件中写一些行，然后打印其大小：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def f = new File('junk.txt')
f.withPrintWriter { pw -&gt;
    pw.println(new Date())
    pw.println(this.class.name)
}
println f.size()
// =&gt; 42</code></pre>
</div>
</div>
<div class="paragraph">
<p>我们还可以一次读回一行文件的内容，并打印出每一行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">f.eachLine { line -&gt;
    println line
}
// =&gt;
// Mon Jun 18 22:38:17 EST 2007
// RunPattern</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意普通的Java <code>Reader</code>和<code>PrintWriter</code> Groovy在后台使用了对象，但是代码编写者不必担心显式创建或关闭这些资源。内置的Groovy方法将各自的读取器或写入器借给结束代码，然后自行整理。因此，您无需任何工作即可使用此模式。</p>
</div>
<div class="paragraph">
<p>但是，有时候您希望做的事情与使用Groovy的内置机制免费获得的东西有所不同。您应该考虑在自己的资源处理操作中利用此模式。</p>
</div>
<div class="paragraph">
<p>考虑如何处理文件中每一行的单词列表。实际上，我们也可以使用Groovy的内置函数来执行此操作，但是请忍受并假设我们必须自己做一些资源处理。这是不使用此模式就可以编写代码的方式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def reader = f.newReader()
reader.splitEachLine(' ') { wordList -&gt;
    println wordList
}
reader.close()
// =&gt;
// [ "Mon", "Jun", "18", "22:38:17", "EST", "2007" ]
// [ "RunPattern" ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，我们现在有一个明确的调用<code>close()</code>在我们的代码中。如果我们没有编写正确的代码（这里我们没有将代码包含在<code>try …​ finally</code>块，我们冒着打开文件句柄的风险。</p>
</div>
<div class="paragraph">
<p>现在让我们应用贷款模式。首先，我们将编写一个辅助方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">def withListOfWordsForEachLine(File f, Closure c) {
    def r = f.newReader()
    try {
        r.splitEachLine(' ', c)
    } finally {
        r?.close()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在，我们可以重新编写我们的代码，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">withListOfWordsForEachLine(f) { wordList -&gt;
    println wordList
}
// =&gt;
// [ "Mon", "Jun", "18", "22:38:17", "EST", "2007" ]
// [ "RunPattern" ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>这要简单得多，并且删除了显式<code>close()</code> 。现在可以一站式解决这个问题，因此我们可以在一个地方进行适当级别的测试或审查，以确保我们没有问题。</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">版本3.0.0-rc-1<br>最近更新时间2019-10-22 17:47:02 AEST</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>prettyPrint()</script>

</body></html>