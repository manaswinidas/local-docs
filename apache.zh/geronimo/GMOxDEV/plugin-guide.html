<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=0">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="Plugin Guide">
    <meta name="Keywords" content="Apache Geronimo development documentation Plugin Guide">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2009-01-06">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2011, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo开发：插件指南</title>

  </head>

  <body  onload="init()">

    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">主页</a> > <a href="index.html">索引</a> > <a href="plugin-guide.html">插件指南</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo开发</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">插件指南</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=70520"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=70520">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDEV"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDEV">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDEV&fromPageId=70520"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDEV&fromPageId=70520">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDEV&fromPageId=70520"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDEV&fromPageId=70520">添加新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>
<p>现在，Apache Geronimo v2.1完全由包含服务器配置文件的插件组装而成，并且只要您使用geronimo计划“预部署”模块，maven就会构建一个插件。我们将解释插件系统功能，以便您可以了解如何指定安装活动，自定义点以及何时启动插件，以及如何在Maven构建中访问这些功能。</p>



<h1 id="PluginGuide-Pluginsystemoverview">插件系统概述</h1>
<p>geronimo插件包括类加载器规范，可选类，可选服务或组件配置，以及有关如何在Geroninimo中安装它的信息。在Geronimo计划（以及可能的其他计划，例如javaee spec DD或注释）中指定了类加载器规范和服务配置。有关如何安装插件的信息，请参见<strong><code>META-INF/geronimo-plugin.xml</code></strong>文件。该文件包括诸如类别和描述之类的详细信息，显示此插件还需要安装什么的相关性信息，有关安装时要解压缩的文件的信息以及显示如何以及何时启动该插件的配置信息。在查看插件的更复杂方面之前，我们先来看一个简单的示例<strong><code>geronimo-plugin.xml</code></strong> 。这是码头网络容器的示例：</p>

<p>首先，我们看到相当明显的编目信息：</p>

<parameter ac:name="">xml</parameter> <parameter ac:name="borderStyle">solid</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" standalone="yes" ?=""--><geronimo-plugin xmlns="http://geronimo.apache.org/xml/ns/plugins-1.3" xmlns:ns2="http://geronimo.apache.org/xml/ns/attributes-1.2"><name>Geronimo Configs :: Jetty 6</name> <category>Jetty</category> <description>Geronimo Jetty Web服务器集成。</description>
    <url>http://geronimo.apache.org/</url> <author>Apache Geronimo开发社区</author> <license osi-approved="true">Apache软件许可，版本2.0</license>
</geronimo-plugin><!--?xml--></plain-text-body>

<p>每<strong><code>geronimo-plugin.xml</code></strong>可以为“相同”插件的多个版本指定信息，因此为一个版本指定信息的<strong>plugin-artifact</strong>元素可以多次出现。这里只有一个。首先，我们看到插件<strong>moduleId</strong>和将要安装的依赖项列表（如果尚不存在）。</p>

<parameter ac:name="">xml</parameter> <parameter ac:name="borderStyle">solid</parameter> <plain-text-body><plugin-artifact><module-id><groupid>org.apache.geronimo.configs</groupid> <artifactid>jetty6</artifactid> <version>2.1-SNAPSHOT</version> <type>汽车</type></module-id> <geronimo-version>2.1-SNAPSHOT</geronimo-version> <jvm-version>1.5</jvm-version> <dependency start="true"><groupid>org.apache.geronimo.configs</groupid> <artifactid>j2ee服务器</artifactid> <version>2.1-SNAPSHOT</version> <type>汽车</type></dependency> <dependency start="true"><groupid>org.apache.geronimo.configs</groupid> <artifactid>服务器安全性配置</artifactid> <version>2.1-SNAPSHOT</version> <type>汽车</type></dependency> <dependency start="true"><groupid>组织。 apache.geronimo.configs</groupid> <artifactid>事务</artifactid> <version>2.1-SNAPSHOT</version> <type>汽车</type></dependency> <dependency start="true"><groupid>org.apache.geronimo.modules</groupid> <artifactid>geronimo-jetty6</artifactid> <version>2.1-SNAPSHOT</version> <type>jar</type></dependency> <dependency start="true"><groupid>org.apache.geronimo.configs</groupid> <artifactid>集群</artifactid> <version>2.1-SNAPSHOT</version> <type>汽车</type></dependency> <dependency start="true"><groupid>org.slf4j</groupid> <artifactid>slf4j-api</artifactid> <version>1.4.3</version> <type>jar</type></dependency> <dependency start="true"><groupid>org.slf4j</groupid> <artifactid>slf4j -jcl</artifactid> <version>1.4.3</version> <type>jar</type></dependency> <dependency start="true"><groupid>org.mortbay.jetty</groupid> <artifactid>码头</artifactid> <version>6.1.5</version> <type>jar</type></dependency> <dependency start="true"><groupid>org.mortbay.jetty</groupid> <artifactid>jetty-ajp</artifactid> <version>6.1.5</version> <type>jar</type></dependency> <dependency start="true"><groupid>org.mortbay.jetty</groupid> <artifactid>jetty-sslengine</artifactid> <version>6.1.5</version> <type>jar</type></dependency> <dependency start="true"><groupid>org.mortbay.jetty</groupid> <artifactid>jetty-util</artifactid> <version>6.1。 5</version> <type>jar</type></dependency> <dependency start="true"><groupid>org.apache.geronimo.configs</groupid> <artifactid>webservices-common</artifactid> <version>2.1-SNAPSHOT</version> <type>汽车</type></dependency></plugin-artifact></plain-text-body>

<p>现在，我们将看到此插件可用的存储库列表。我们通常包括本地maven存储库，以使开发插件更加容易。</p>

<parameter ac:name="">xml</parameter> <parameter ac:name="borderStyle">固体</parameter> <plain-text-body><source-repository>〜/ .m2 / repository /</source-repository> <source-repository>http://repo1.maven.org/maven2/</source-repository> <source-repository>http://people.apache.org/repo/m2-snapshot-repository/</source-repository> <source-repository>http://people.apache.org/repo / m2-incubating-repository /</source-repository></plain-text-body>

<p>在这里，我们看到了插件自定义的原型。的<strong><code>config.xml</code></strong>文件为它知道的每个模块或插件都有一个小节，并将<strong>config-xml-content的内容</strong>复制到这样的元素中。注意使用替代变量，例如<strong>$ {ServerHostname}</strong> 。</p>

<parameter ac:name="">xml</parameter> <parameter ac:name="borderStyle">固体</parameter> <plain-text-body><config-xml-content><ns2:gbean name="JettyWebConnector"><ns2:attribute name="host">$ \ {ServerHostname \}</ns2:attribute> <ns2:attribute name="port">$ \ {HTTPPort + PortOffset \}</ns2:attribute> <ns2:attribute name="redirectPort">$ \ {HTTPSPortPrimary + PortOffset \}</ns2:attribute></ns2:gbean> <ns2:gbean name="JettyAJP13Connector"><ns2:attribute name="host">$ \ {ServerHostname \}</ns2:attribute> <ns2:attribute name="port">$ \ {AJPPort + PortOffset \}</ns2:attribute> <ns2:attribute name="redirectPort">$ \ {HTTPSPortPrimary + PortOffset \}</ns2:attribute></ns2:gbean> <ns2:gbean name="JettySSLConnector"><ns2:attribute name="host">$ \ {ServerHostname \}</ns2:attribute> <ns2:attribute name="port">$ \ {HTTPSPort + PortOffset \}</ns2:attribute></ns2:gbean></config-xml-content></plain-text-body>

<p>在这里，我们看到了替换变量的默认值。这些被复制到<strong><code>config-substitutions.properties</code></strong>文件;您应根据需要手动进行修改。</p>

<parameter ac:name="">xml</parameter> <parameter ac:name="borderStyle">固体</parameter> <plain-text-body><config-substitution key="HTTPPort">8080</config-substitution> <config-substitution key="AJPPort">8009</config-substitution> <config-substitution key="HTTPSPort">8443</config-substitution> <config-substitution key="ServerHostname">0.0.0.0</config-substitution> <config-substitution key="webcontainer">JettyWebContainer</config-substitution> <config-substitution key="webcontainerName">jetty6</config-substitution></plain-text-body>

<p>此示例缺少的是<strong><artifact-alias></artifact-alias></strong>可用于将一个插件替换为另一个插件的元素。例如，您可以通过部署<strong>postgres-system-database</strong>并指定<strong><artifact-alias key="org.apache.geronimo.configs/system-database/2.1-SNAPSHOT/car">org.apache.geronimo.configs / postgres-system-database / 2.1-SNAPSHOT / car</artifact-alias></strong>来切换数据库</p>

<parameter ac:name="">XML</parameter> <parameter ac:name="borderStyle">固体</parameter> <plain-text-body>
    

</plain-text-body>

<p>Geronimo最明显的部分之一是包含jar和插件的存储库。但是，插件本身不执行任何操作。我们需要一些有关启动哪些服务器以及如何对其进行自定义的信息，以使服务器正常运行。这种信息通常存储在var / config目录中的配置文件中，例如<strong><code>config.xml</code></strong> ， <strong><code>config-substitutions.properties</code></strong>和<strong><code>artifact_aliases.properties</code></strong> 。您可以在正常的Geronimo安装中启动多个“服务器”，例如“服务器”，应用程序客户端容器，部署程序和jsr88工具。插件系统使用指定属性存储的<strong>ServerInstance</strong> gbean来抽象“服务器实例”的概念（与<code>config.xml</code>和<code>config-substitutions.xml</code>文件）和工件解析器（与<code>artifact_aliases.properties</code>文件）。因此，插件系统要求您为希望在Geronimo安装中启动的所有类型的服务器设置<strong>ServerInstances</strong> 。例如，常规的Geronimo设置包括以下内容：</p>

<parameter ac:name="">xml</parameter> <parameter ac:name="borderStyle">固态</parameter> <plain-text-body><gbean name="DefaultServer" class="org.apache.geronimo.system.plugin.ServerInstance"><attribute name="serverName">默认</attribute> <reference name="PluginAttributeStore"><name>AttributeManager</name></reference> <reference name="ArtifactResolver"><name>ArtifactResolver</name></reference></gbean> <gbean name="Offline" class="org.apache.geronimo.system.plugin.ServerInstance"><attribute name="serverName">脱机</attribute> <reference name="PluginAttributeStore"><name>OfflineAttributeManager</name></reference> <reference name="ArtifactResolver"><name>ArtifactResolver</name></reference></gbean> <gbean name="OfflineAttributeManager" class="org.apache.geronimo.system.configuration.LocalAttributeManager"><reference name="ServerInfo"><name>ServerInfo</name></reference> <attribute name="readOnly">true</attribute> <attribute name="configFile">var / config / offline-deployer-config.xml</attribute> <attribute name="substitutionsFile">var / config / config-substitutions.properties</attribute> <attribute name="substitutionPrefix">org.apache.geronimo.config.substitution。</attribute>
    </gbean> <gbean name="Client" class="org.apache.geronimo.system.plugin.ServerInstance"><attribute name="serverName">客户端</attribute> <reference name="PluginAttributeStore"><name>AttributeManager</name></reference> <reference name="ArtifactResolver"><name>ClientArtifactResolver</name></reference></gbean> <gbean name="ClientArtifactResolver" class="org.apache.geronimo.system.resolver.ExplicitDefaultArtifactResolver"><reference name="ArtifactManager"><name>ArtifactManager</name></reference> <reference name="Repositories"></reference> <attribute name="versionMapLocation">var / config / client_artifact_aliases.properties</attribute> <reference name="ServerInfo"><name>ServerInfo</name></reference></gbean> <gbean name="Jsr88" class="org.apache.geronimo.system.plugin.ServerInstance"><attribute name="serverName">jsr88</attribute> <reference name="PluginAttributeStore"><name>Jsr88AttributeManager</name></reference> <reference name="ArtifactResolver"><name>ArtifactResolver</name></reference></gbean> <gbean name="Jsr88AttributeManager" class="org.apache.geronimo.system.configuration.LocalAttributeManager"><reference name="ServerInfo"><name>ServerInfo</name></reference> <attribute name="readOnly">true</attribute> <attribute name="configFile">var / config / jsr88-configurer-config.xml</attribute> <attribute name="substitutionsFile">var / config / config-substitutions.properties</attribute> <attribute name="substitutionPrefix">org.apache.geronimo.config.substitution。</attribute>
    </gbean>
</plain-text-body>

<p>默认情况下，插件安装在默认服务器实例中。如果需要安装到其他实例，则可以在<strong>config-xml-content</strong> ， <strong>config-substitution</strong>和<strong>artifact-alias</strong>元素中进行指定。这是来自<strong>client-transaction</strong>的示例，展示了它如何将任何依赖关系重定向到服务器事务插件本身。</p>

<parameter ac:name="">xml</parameter> <parameter ac:name="borderStyle">固态</parameter> <plain-text-body><artifact-alias server="client" key="org.apache.geronimo.configs/transaction//car">org.apache.geronimo.configs / client-transaction / 2.1-SNAPSHOT / car</artifact-alias> <artifact-alias server="client" key="org.apache.geronimo.configs/transaction/2.1-SNAPSHOT/car">org.apache.geronimo.configs / client-transaction / 2.1-SNAPSHOT / car</artifact-alias></plain-text-body>

<h1 id="PluginGuide-UsingmaventogeneratetheGeronimoplugindescriptor">使用Maven生成Geronimo插件描述符</h1>

<p>中的很多信息<strong><code>geronimo-plugin.xml</code></strong>文件通常是Maven已知的，例如模块ID和依赖项。因此， <strong>car-maven-plugin</strong>与生成car文件一起生成<strong><code>geronimo-plugin.xml</code></strong> 。许多内容只是简单地复制，但是还有一些其他配置选择。让我们看一下码头网络容器插件<strong><code>pom.xml</code></strong>文件。</p>

<p><strong>moduleId</strong> ， <strong>name</strong>和<strong>description</strong>进入<strong><code>geronimo-plugin.xml</code></strong> 。</p>

<parameter ac:name="">xml</parameter> <parameter ac:name="borderStyle">solid</parameter> <plain-text-body><project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"><modelversion>4.0.0</modelversion> <parent><groupid>org.apache.geronimo.configs</groupid> <artifactid>配置</artifactid> <version>2.1-SNAPSHOT</version> <relativepath>../pom.xml</relativepath></parent> <artifactid>jetty6</artifactid> <name>Geronimo Configs :: Jetty 6</name> <packaging>车</packaging> <description>Geronimo Jetty Web服务器集成。</description>

    <dependencies><!-- dependencies ommitted --></dependencies> <build><plugins><plugin><groupid>org.apache.geronimo.plugins</groupid> <artifactid>car-maven-plugin</artifactid> <configuration>
</configuration></plugin></plugins></build></project></plain-text-body>

<p>对于大多数插件，作为插件的所有依赖项都应正在运行。在这种情况下，我们可以使用未修改的Maven依赖项作为Geronimo依赖项。对于某些插件（通常是部署者），需要加载一些从属插件，以便它们的类可用，但可能不需要启动它们（例如，它们可能会打开可能会冲突的端口）。在这种情况下，您需要指示不使用Maven依赖项，并在本节中明确指定它们。这里的依赖关系都进入了<strong><code>plan.xml</code></strong>文件和<strong><code>geronimo-plugin.xml</code></strong>文件。</p>

<parameter ac:name="">xml</parameter> <parameter ac:name="borderStyle">solid</parameter> <plain-text-body><usemavendependencies><value>true</value> <includeversion>true</includeversion></usemavendependencies> <category>码头</category></plain-text-body>

<p>实例的内容几乎不变地复制到<strong><code>geronimo-plugin.xml</code></strong> 。您可以在父pom插件配置中指定<strong>default-instance</strong>元素，该元素将合并到<strong><code>geronimo-plugin.xml</code></strong>在所有的孩子中。请注意，由于Maven xml处理的某些特殊性，您必须使用<strong>＃{foo}</strong>而不是<strong>$ {foo}</strong>来代替变量。</p>

<parameter ac:name="">xml</parameter> <parameter ac:name="borderStyle">solid</parameter> <plain-text-body><instance><plugin-artifact><config-xml-content><gbean name="JettyWebConnector"><attribute name="host">＃{ServerHostname}</attribute> <attribute name="port">＃{HTTPPort + PortOffset}</attribute> <attribute name="redirectPort">＃{HTTPSPortPrimary + PortOffset}</attribute></gbean> <gbean name="JettyAJP13Connector"><attribute name="host">＃{ServerHostname}</attribute> <attribute name="port">＃{AJPPort + PortOffset}</attribute> <attribute name="redirectPort">＃{HTTPSPortPrimary + PortOffset}</attribute></gbean> <gbean name="JettySSLConnector"><attribute name="host">＃{ServerHostname}</attribute> <attribute name="port">＃{HTTPSPort + PortOffset}</attribute></gbean></config-xml-content> <config-substitution key="HTTPPort">8080</config-substitution> <config-substitution key="AJPPort">8009</config-substitution> <config-substitution key="HTTPSPort">8443</config-substitution> <config-substitution key="ServerHostname">0.0.0.0</config-substitution> <config-substitution key="webcontainer">JettyWebContainer</config-substitution> <config-substitution key="webcontainerName">jetty6</config-substitution></plugin-artifact></instance></plain-text-body></div>
        </div>

        
      </div>
    </div>

    <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo Development : Plugin Guide';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2011，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-4380560-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>
  

</body></html>