<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=0">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="2 - GBeans Architecture">
    <meta name="Keywords" content="Apache Geronimo development documentation 2 - GBeans Architecture">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2009-01-06">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2011, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo开发：2-GBeans架构</title>

  </head>

  <body  onload="init()">

    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">主页</a> > <a href="index.html">索引</a> > <a href="geronimo-architecture.html">Geronimo体系结构</a> > <a href="2-gbeans-architecture.html">2-GBeans体系结构</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo开发</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">2-GBeans架构</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=32189"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=32189">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDEV"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDEV">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDEV&fromPageId=32189"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDEV&fromPageId=32189">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDEV&fromPageId=32189"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDEV&fromPageId=32189">添加新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>

<h1 id="id-2-GBeansArchitecture-Introduction">介绍</h1>
<p>Geronimo Bean或GBean是Geronimo Application Server中的实体，可在Geronimo系统内使用（通过Geronimo Kernel）。GBean允许与系统中其他实体的松散耦合的交互以及模块和子系统之间的依赖关系注入。GBean可与JMX工具互操作，但与JMX MBean分开实现。可以通过geronimo-system模块中的适配器类通过JMX技术访问GBean。</p>

<h3 id="id-2-GBeansArchitecture-GBeansvs.MBeans">GBeans与MBeans</h3>
<p>JMX与GBeans具有非常相似的概念。在JMX中，等效于GBeans的是MBean，而等效于MBeanServer的是Geronimo内核。Geronimo开发人员创建了GBean，因此应用程序服务器的每个部分都不需要依赖完整的JMX堆栈。通过将两者分开，Geronimo的内部组件可以依靠重量更轻的GBean。当外部应用程序需要访问Geronimo模块时，JMX调用将委派给适当的GBean或GBean内核方法。</p>

<h3 id="id-2-GBeansArchitecture-WhatisaGBean?">什么是GBean？</h3>
<p>GBean是一个Java对象，具有一个名为getGBeanInfo（）的方法，该方法返回GBeanInfo类的实例。GBeanInfo具有三个主要目的。一种是定义应向其他子系统公开的方法，第二种是定义属性和引用，以便它们可以在运行时注入，第三种是定义有关GBean的信息，以便以后可以定位。这些将在下面详细讨论。在为GBean定义GBeanInfo对象的实例时，不应直接构造GBeanInfo。而是有一个GBeanInfoBuilder类将简化该过程（请参见下面的// 1）。以下是从Log4jService类创建GBeanInfo，然后在getGBeanInfo（）方法中返回它的示例：</p>

<parameter ac:name="title">Log4jService.java</parameter> <parameter ac:name="borderStyle">固态</parameter> <plain-text-body>// ...静态{GBeanInfoBuilder infoFactory = GBeanInfoBuilder.createStatic（Log4jService.class，“ SystemLog”）; // 1 infoFactory.addAttribute（“ configFileName”，String.class，true）; // 2 infoFactory.addAttribute（“ refreshPeriodSeconds”，int.class，true）; infoFactory.addAttribute（“ configuration”，String.class，false）; infoFactory.addAttribute（“ rootLoggerLevel”，String.class，false）; infoFactory.addReference（“ ServerInfo”，ServerInfo.class，“ GBean”）; // 3 infoFactory.addOperation（“ reconfigure”）; // 4 infoFactory.addOperation（“ setLoggerLevel”，new Class [] {String.class，String 。类}）; infoFactory.addOperation（“ getLoggerLevel”，new Class [] {String.class}）; infoFactory.addOperation（“ getLoggerEffectiveLevel”，new Class [] {String.class}）; infoFactory.addInterface（SystemLog.class）; // 5 infoFactory.setConstructor（new String [] {“ configFileName”，“ refreshPeriodSeconds”，“ ServerInfo”}））; // 6 GBEAN_INFO = infoFactory.getBeanInfo（）; }公共静态GBeanInfo getGBeanInfo（）{return GBEAN_INFO; } // ...
</plain-text-body>

<p>从上面要注意一些重要的事情。按照约定，GBeanInfo对象是在静态初始化器中构造的。同样按照约定，GBeanInfo对象被命名为GBEAN_INFO。以下是与Log4jService相关的部署计划的一部分（位于$ GERONIMO_HOME / configs / j2ee-system / src / plan / plan.xml中）。</p>

<parameter ac:name="">xml</parameter> <plain-text-body><gbean name="Logger" class="org.apache.geronimo.system.logging.log4j.Log4jService"><attribute name="configFileName">var / log / server-log4j.properties</attribute> <!--1--> <attribute name="refreshPeriodSeconds">60</attribute> <reference name="ServerInfo"><name>ServerInfo</name></reference></gbean></plain-text-body>

<p>部署计划允许注入依赖项，属性等，并维持系统之间的松散耦合。Geronimo内核将（使用部署计划）在加载GBean时自动注入这些依赖项。下面将详细解释代码示例。</p>

<h5 id="id-2-GBeansArchitecture-Attributes">属性</h5>
<p>在上面的代码片段中，// 2指向在GBean中添加属性。它定义属性的名称（在本例中为“ configFileName”），类型（字符串）以及其是否持久（true）。现在已经在GBeanInfo中定义了该属性，可以通过Geronimo Kernel注入该属性。要将值注入此GBean中，需要在部署计划中指定它。在上述XML的注释一中，它表示将字符串“ var / log / server-log4j.properties”分配给属性configFileName。当内核读入此内容时，它将调用setConfigFileName（）方法并将字符串作为参数传递。</p>

<h5 id="id-2-GBeansArchitecture-References">参考文献</h5>
<p>在上面的Java代码的注释3中，一个引用正在添加到GBeanInfo对象。引用就像属性一样，它是在运行时注入的，但是引用是另一个GBean，而不是String或整数。在运行时，Geronimo内核将定位（在这种情况下）ServerInfo GBean并将其注入Log4jService GBean。</p>

<h5 id="id-2-GBeansArchitecture-ExecutingMethods">执行方法</h5>
<p>GBean方法可以通过两种方式执行。一种方法是上面评论4列出的一种方法。这在GBean中定义了一个“操作”。通过内核，可以反射地调用该方法。调用方法的另一种方法是从内核中检索GBean，然后直接执行它。关于反思性地调用方法的一个重要点是，它可能较慢。Geronimo的内部使用此反射方法调用，因此性能至关重要。为了帮助提高性能，Geronimo开发人员创建了<em>Raw Invoker</em> 。<em>Raw Invoker</em>本质上使用CGLib（高性能反射库）反射调用的缓存副本。调用该方法时，将使用包含缓存的CGLib方法调用的<em>原始</em>调用程序，从而节省了一些执行时间。</p>

<h5 id="id-2-GBeansArchitecture-AddingInterfaces">添加接口</h5>
<p>上面的注释5将接口SystemLog.class添加到GBeanInfo对象。基本上，像上面那样添加接口是在接口中单独添加所有内容的一种较短的方法。接口中的所有变量将作为属性添加，所有方法将作为操作添加。</p>

<h5 id="id-2-GBeansArchitecture-Constructors">建设者</h5>
<p>上面的注释6向GBeanInfo对象添加了一个构造函数。由于Log4jService GBean没有默认（无参数）构造函数，因此必须定义该构造函数。当内核创建GBean的实例时，注释6使其知道要传递给构造函数的内容。请注意，数组中的每个元素都是GBeanInfo中定义的属性/引用。</p>

<h3 id="id-2-GBeansArchitecture-GBeanLifecycle">GBean生命周期</h3>
<p>尽管不需要为GBean实现任何接口，但是在GBean启动或关闭时能够执行代码通常很有用。实现GBeanLifecycle接口将允许在启动，关闭和失败时通知GBean。在GBeanLifecycle接口中实现的必需方法是：doStart（），doStop（）和doFail（）。以下是来自同一Log4jService GBean的一些示例代码：</p>

<parameter ac:name="title">Log4jService.java</parameter> <parameter ac:name="borderStyle">solid</parameter> <plain-text-body>public void doStart（）{LogFactory logFactory = LogFactory.getFactory（）;如果（logon instanceof GeronimoLogFactory）{已同步（this）{timer = new Timer（true）; //定期检查配置文件schedule（）; //确保根Logger已加载Logger logger = LogManager.getRootLogger（）; reconfigure（）;文件文件= resolveConfigurationFile（）;如果（文件！= null）{lastChanged = file.lastModified（）; } logEnvInfo（logger）; } //更改所有记录器以使用log4j GeronimoLogFactory geronimoLogFactory =（GeronimoLogFactory）logFactory;同步（geronimoLogFactory）{如果（！（geronimoLogFactory.getLogFactory（）CachingLog4jLogFactory的实例））{geronimoLogFactory.setLogFactory（new CachingLog4jLogFactory（））; }}}同步（this）{running = true; }}公共同步void doStop（）{running = false;如果（监视！= null）{monitor.cancel（）; monitor = null; } if（timer！= null）{timer.cancel（）; timer = null; }} public void doFail（）{doStop（）; }</plain-text-body>

<p>不必了解上述代码的所有详细信息，仅了解在doStart（）中创建了Timer或可以认为是睡眠线程的线程就足够了。编写代码的人想要确保GBean停止时线程也将停止。当GBean停止时，将调用doStop（）方法，然后可以安全地停止Timer。还要注意，如果发生故障，也将调用doStop（）方法，以安全地停止Timer。</p></div>
        </div>

        
      </div>
    </div>

    <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo Development : 2 - GBeans Architecture';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2011，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-4380560-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>
  

</body></html>