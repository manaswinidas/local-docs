<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=0">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="GBeansArticle1">
    <meta name="Keywords" content="Apache Geronimo development documentation GBeansArticle1">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2009-01-06">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2011, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo开发：GBeansArticle1</title>

  </head>

  <body  onload="init()">

    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">首页</a> > <a href="index.html">索引</a> > <a href="gbeansarticle1.html">GBeansArticle1</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo开发</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">GBeansArticle1</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=13582"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=13582">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDEV"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDEV">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDEV&fromPageId=13582"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDEV&fromPageId=13582">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDEV&fromPageId=13582"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDEV&fromPageId=13582">添加新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent">

<p><strong>内容</strong> </p>



<h1 id="GBeansArticle1-GeronimoGBeanArchitecture">Geronimo GBean体系结构</h1>

<h2 id="GBeansArticle1-Abstract">抽象</h2>

<p>Geronimo建立在对J2EE一无所知的内核上，而是一个通用的控制反转（IOC）框架，用于名为GBeans的组件。本文解释了控制反转的理论方面，然后通过一些示例描述了GBean生命周期，GBean状态和依赖注入，然后解释了如何编写简单的GBean。</p>

<h2 id="GBeansArticle1-Introduction">介绍</h2>

<p>考虑一个像Linux或Windows这样的平台，该平台具有一个操作系统核心，该核心提供系统调用以及在这些系统调用之上运行的一组应用程序。Geronimo建立在对J2EE一无所知的类似内核上，该内核Geronimo Kernel本质上是一个称为GBeans的组件的框架。可以将任何复杂的系统建模为保持状态的一组组件，它们之间的一组关系以及每个组件如何对某些事件做出反应。Geronimo内核通过以下服务为GBean提供了一个框架：</p>

<ol><li>GBean可以保存状态（持久性或非持久性）</li><li>可以使用它们定义GBean之间的关系</li><li>GBean可以包含定义它们如何对事件做出反应的逻辑</li></ol>


<p>Geronimo中的几乎所有东西都是GBean：容器，连接器，适配器，应用程序等。GBean之间的关系可以视为组件的网格，如下图所示：</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://apache.org/~hemapani/images/geronimo-gbean-archi.png" data-image-src="http://apache.org/~hemapani/images/geronimo-gbean-archi.png"></span> </p>

<p>任何J2EE容器都由两类公民组成：第一类公民是提供核心服务的Web容器和EJB容器，第二类公民是部署在第一类公民中的EJB和Servlet之类的应用程序。Geronimo的体系结构可以用GBean行为来解释。Geronimo是一组正在运行的GBean，每个头等公民都是一组彼此相关的GBean。它们是通过“计划”加载的，“计划”本质上是GBean的XML序列化。加载并启动计划后，将启动计划中包含的GBean，即，将启动EJB容器和/或Web容器。</p>

<p>在J2EE容器中运行的应用程序由打包为J2EE应用程序归档文件的部署描述符和Java类描述。Geronimo Deployer解析这些归档文件并从中构造GBean。启动GBean时，应用程序将部署并可用。GBean可以被序列化和存储，因此，一旦将应用程序转换为GBean并添加到Geronimo中，即使重新启动服务器，该GBean也将可用。</p>

<h2 id="GBeansArticle1-GBeansFromaConceptualPointofView">从概念的角度看GBeans</h2>

<p>从Geronimo内核是Control IOC框架的反转的意义上讲，为GBean提供基础的概念的历史要长得多，其中IOC也称为依赖项注入。IOC或依赖项注入的本质是创建一个松散耦合的体系结构，其中组件之间的依赖项由框架管理。当一个组件依赖于其他组件时，IOC框架将找到正确的组件并将其提供给第一个组件。依赖项注入名称来自以下事实：框架自动将依赖项注入组件。IOC或依赖注入的最简单形式是通过系统范围的已知值。例如，让我们假设这是要在Axis内部署的Web Service，不用担心Axis，而只是假设Axis将加载以下类并调用doit（）方法。</p>

<plain-text-body>公共类WS {公共WS（MesageContext msgctx）{} public void doit（）{}}</plain-text-body>

<p>但是轴有一个叫做</p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p>！具有所有配置信息的<a shape="rect" class="unresolved" href="#">MessageContext</a> 。以供参考！WS类Axis的<a shape="rect" class="unresolved" href="#">MessageContext</a>可以说“如果您有类似XX（！</p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><a shape="rect" class="unresolved" href="#">MessageContext</a> ），或者您有类似setMessageContext（！<a shape="rect" class="unresolved" href="#">MessageContext</a> msgctx）我将注入！<a shape="rect" class="unresolved" href="#">MessageContext</a>给您”。<p></p>

<p>这是依赖注入的最简单形式，框架会查看该类并发现该类期望一个！要插入的<a shape="rect" class="unresolved" href="#">MessageContext</a> 。换句话说，IOC框架将检查我们的组件的方法，参数和构造方法中的某些模式，以确保在找到该模式后会向组件提供服务，在该示例中，我们认为该服务正在引用消息Context。</p>

<p>为了更好地了解IOC的使用，应查看用于开发具有解耦组件的系统的方法。系统的解耦全部与组件之间的交互有关。</p>

<ol><li>接口和头文件以及工厂一起提供了最少的编码系统解耦。</li><li>属性文件与接口和工厂一起使用（例如，使用属性文件加载JNDI的不同实现。）可以在不重新编译代码的情况下实现解耦。</li><li>注册表服务和查找通过将服务信息隐藏在名称后，将其与调用者分离开来。</li><li>IOC或依赖项注入允许在引用可用时自动注入。</li></ol>


<p>IOC的想法是根据框架级别的配置定义组件之间的所有关系，并且当第一个组件可用时，每个组件都会注入到引用该服务的其他组件中。例如，让我们考虑一下GBean G1如何获取对配置存储的引用。G1被配置为指定期望的参考模式。</p>

<plain-text-body>例如bean.setReferencePatterns（“ configStore，*：type = configStore，*”）;</plain-text-body>

<p>当另一个名称与模式“ <strong>：type = configStore，</strong> ”相匹配的GBean启动时，它将自动注入G1中。这更像是面向方面的编程，即AOP，其中开发人员对框架说需要做什么而不是怎么做。</p>

<ul><li>但这并不意味着IOC是创建解耦系统的唯一方法，所有这四种方法都是有用的，并且在实践中得到了使用。选择适合这种场合的工具很重要，每种情况都有好例子，也有不好的例子。</li></ul>


<h2 id="GBeansArticle1-GBeanLifeCycle">GBean生命周期</h2>

<p>GBean可以处于以下三种状态中的任何一种： <em>存储</em> ， <em>加载</em>或<em>运行</em> 。在<em>存储</em>状态下，它保存在配置存储中（也称为“计划”）。<em>加载时</em> ，内核已将其映射到名称并知道该名称。每个GBean在启动时都会绑定一个名称。该名称不是永久性的。可以用类推来解释，我们可以将GBean视为Java类，并将名称视为引用该类的特定实例的变量名称。与类可以具有多个实例的方式相同，同一GBean可以以多个名称加载并存储在多个位置。</p>

<h2 id="GBeansArticle1-StateofGBeans">GBean状态</h2>

<p>GBean具有两种类型的状态，即属性和引用。参考文献将在第三部分中介绍。属性有两种类型，持久性和非持久性。可以使用内置支持来存储和还原GBean。该架构定义了特殊类型的魔术属性。加载的magic属性的值取决于加载GBean的环境。例如，魔术属性“内核”是指内核，当在构造函数中指定内核属性时，框架会自动将其注入到类中。同样！<a shape="rect" class="unresolved" href="#">ClassLoader</a>属性注入当前的类加载器和！<a shape="rect" class="unresolved" href="#">ObjectName</a>属性注入GBean起始的当前名称。可以在内核的GBeanMBean类中找到所有魔术属性的完整列表。魔术属性不能持久化，因为它们与启动环境绑定在一起。请注意，在第一个将Web服务部署到Axis的依赖项注入示例中，！<a shape="rect" class="unresolved" href="#">MessageContext</a>是一个神奇的属性。</p>

<p>具有一个属性“ val”的GBean将如下所示：</p>

<plain-text-body>公共类MyGBean实现GBeanLifecycle {private final String val;静态{GBeanInfoBuilder infoFactory = ...//属性infoFactory.addAttribute（“ val”，String.class，true）; //操作infoFactory.addOperation（“ getBean1”）; infoFactory.setConstructor（new String [] {“ val”}）; GBEAN_INFO = infoFactory.getBeanInfo（）; } public ConstructorInjectionGbean（String val）{this.val = val; } ...}</plain-text-body>

<p>我们可以使用以下代码启动GBean。GBean实现在JMX之上完成，并且GBeanMBean接受GBean信息并将其转换为Mbean。</p>

<plain-text-body>GBeanMBean gmb =新的GBeanMBean（MyGBean。GBEAN_INFO）; gmb.setAttribute（“ value”，“是或不是那个问题”）； ObjectName myGbeanName = ObjectName.newInstance（“ Geronimo.my:name=mine”）; kernel.loadGBean（myGbeanName，gmb）; kernel.startGBean（myGbeanName）; // workwork kernel.stopGBean（myGbeanName）; kernel.unloadGBean（myGbeanName）;</plain-text-body>

<h2 id="GBeansArticle1-DependencyInjection">依赖注入</h2>

<p>关系有两种类型</p>

<ol><li>单一参考</li><li>参考资料集</li></ol>


<h3 id="GBeansArticle1-SingleReferences">单一参考</h3>

<p>引用以两种方式之一注入GBean。根据如何将依赖项注入到用于实现GBean的java类中，进行getter / setter注入和构造函数注入。通过getter和setter注入框架，可以使用getter和setter方法注入属性/引用，而构造函数注入则将参数作为构造函数参数注入。第二种方法更可取，因为GBeans支持所谓的良好公民模式，以确保GBean一旦启动就处于可用状态。Geronimo支持这两种方法，但将朝着完整的构造函数注入迈进。</p>

<p>以下是使用构造函数注入的简单GBean。</p>

<plain-text-body>公共类MyGBean实现GBeanLifecycle {私有最终字符串GBean1 bean1;静态{GBeanInfoBuilder infoFactory = ...//属性infoFactory.addReferance（“ Bean1”，GBean1.class，true）; ---------（A）//操作infoFactory.setConstructor（new String [] {“ Bean1”}）; -------------（B）GBEAN_INFO = infoFactory.getBeanInfo（）; } public ConstructorInjectionGbean（GBean1 bean1）{-----------（C）this.bean1 = bean1; } ...}</plain-text-body>

<p>在这里，行（A）表示存在对GBean1的引用，行（B）注册了匹配的构造函数（C）。在以下代码中，开发人员指定了GBean1的引用实例并启动了GBeans。</p>

<plain-text-body>ObjectName GBean1 = ObjectName.newInstance（“ Geronimo.my:name=gb1”）; ... //启动GBean 1 GBeanMBean gmb = new GBeanMBean（MyGBean。GBEAN_INFO）; gmb.setReferencePatterns（“ GBean1”，GBean1Name）; ObjectName myGbeanName = ObjectName.newInstance（“ Geronimo.my:name=mine”）; kernel.loadGBean（myGbeanName，gmb）; kernel.startGBean（myGbeanName）; //做工作</plain-text-body>

<p>当MyGBean启动时，将通过构造函数注入GBean1的实例。</p>

<h3 id="GBeansArticle1-ReferenceCollections">参考资料集</h3>

<p>使用Reference集合时，唯一的区别是将上述示例中的GBean1引用替换为Collection，并且指定了引用的GBean的名称时，将其指定为带有“ *”和“？”的模式。”。</p>

<plain-text-body>bean.setReferencePatterns（“ Geronimo.my:*”）;</plain-text-body>

<p>代码要求框架提供所有具有域名“ Geronimo.my：”的GBean。当启动与模式匹配的GBean时，它将自动注入到裁判GBean中。</p>

<h4 id="GBeansArticle1-LogicinGBeans">GBeans中的逻辑</h4>

<p>GBean或多或少地以通常的Java代码形式保留了逻辑处理，并且可以通过添加一个GBean将GBean类中的方法注册到GBean。</p>

<plain-text-body>infoFactory.addOperation（“ doit”，new Object [] {val1，val2}，new String [] {val1.getClass（）。getName（），val2.getClass（）。getName（）}）； -  -  -  - - （一种）</plain-text-body>

<p>内核支持kernel.invoke（“ objectName”，“ methodName”，...），通过它可以调用任何其他GBean中的任何方法。但是不鼓励使用此方法，并且接受的方法是注册参考模式并获取注入的其他GBean的实例并在代码上编码简单的Java样式。</p>

<p>例如，说GBean G1需要在GBean G2上调用doit（），粗略的方法是</p>

<plain-text-body>kernel.invoke（“ G2Name”，“ doit”）;</plain-text-body>

<p>正确的方法是像写G1</p>

<plain-text-body>G1类实现GBeanLifeCycle {...私人决赛G2 g2；静态{GBeanInfoBuilder infoFactory =新的GBeanInfoBuilder（“ G1”，G1.class）; infoFactory.addReference（“ G2”，G2.class）; ---------（A）infoFactory.addConstructor（“ G2”）; ----------------（B）GBEAN_INFO = infoFactory.getBeanInfo（）; } public ConstructorInjectionGbean（G2 g2）{this.g2 = g2; } public void doG1Work（）{g2.doit（）; }}</plain-text-body>

<p>在（A）行定义了对G2的引用，在（B）行添加了注入G2和G1的构造函数，从而获得了对G2的引用。然后使用简单的Java代码实现逻辑。GBean具有使GBean实现给定方法的接口。通过使GBean类实现该接口并放置一个infoFactory.addInterface（“ interfaceName”）条目，该接口中的所有方法将自动添加到GBean，并且getter和setter将映射到属性。</p>

<h2 id="GBeansArticle1-SampleCode">样例代码</h2>

<p>您可以从<a shape="rect" class="external-link" href="http://apache.org/~hemapani/docs/gbeans-sample.zip">http://apache.org/~hemapani/docs/gbeans-sample.zip中</a>找到一些示例GBean和一些测试用例来演示其用法。要运行测试用例，您需要在计算机中安装Maven。</p>

<h2 id="GBeansArticle1-Summary">摘要</h2>

<p>GBean架构对J2EE一无所知，而对于使用IOC开发的松耦合系统的通用框架一无所知。它可以在Geronimo之外使用，并且有可能成为松耦合系统的通用体系结构。本文介绍了概念以及如何使用GBean。</p>

<h2 id="GBeansArticle1-References">参考文献</h2>

<p><a shape="rect" class="unresolved" href="#">1</a> Sam Newman撰写的文章，《 IoC简介》，2004年2月10日， <a shape="rect" class="external-link" href="http://today.java.net/pub/a/today/2004/02/10/ioc.html" rel="nofollow">http：</a> //today.java.net/pub/a/today/2004/02/10/ioc.html </p>

<p><a shape="rect" class="unresolved" href="#">2</a>控制容器的反转和依赖注入模式，作者：Martin Fowler， <a shape="rect" class="external-link" href="http://www.martinfowler.com/articles/injection.html" rel="nofollow">http：//www.martinfowler.com/articles/injection.html</a> </p>

<p><a shape="rect" class="unresolved" href="#">3</a> IoC概述，Web Work仪表板， <a shape="rect" class="external-link" href="http://wiki.opensymphony.com/display/WW/IoC+Overview" rel="nofollow">http：//wiki.opensymphony.com/display/WW/IoC+Overview</a> </p>

<p><a shape="rect" class="unresolved" href="#">4</a>文章依赖反转原则， <a shape="rect" class="external-link" href="http://www.objectmentor.com/resources/articles/dip.pdf" rel="nofollow">http：//www.objectmentor.com/resources/articles/dip.pdf</a> </p>

<p><a shape="rect" class="unresolved" href="#">5</a>服务器端的Dian Sundstrom访谈， <a shape="rect" class="external-link" href="http://www.theserverside.com/talks/videos/DainSundstrom/dsl/q01.html" rel="nofollow">http：//www.theserverside.com/talks/videos/DainSundstrom/dsl/q01.html</a> </p>

<p><a shape="rect" class="unresolved" href="#">6</a> Geronimo内核模块， <a shape="rect" class="external-link" href="http://geronimo.apache.org">http：//geronimo.apache.org</a> </p>

<p>-请随时进行更改，并在Srinath Perera < <a shape="rect" class="external-link" href="mailto:hemapani@apache.org" rel="nofollow">hemapani@apache.org</a> >上给我发个笔记，以便我保持同步</p></div>
        </div>

        
      </div>
    </div>

    <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo Development : GBeansArticle1';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2011，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-4380560-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>
  

</body></html>