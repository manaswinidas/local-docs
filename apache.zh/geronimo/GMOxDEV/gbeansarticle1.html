<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="GBeansArticle1" />
    <META name="Keywords" content="Apache Geronimo development documentation GBeansArticle1" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2009-01-06" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2011, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo Development : GBeansArticle1</title>

  </head>

  <body onload="init()">

    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="index.html">Index</a>&nbsp;&gt;&nbsp;<a href="gbeansarticle1.html">GBeansArticle1</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo Development</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">GBeansArticle1</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=13582">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=13582">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDEV">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDEV">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDEV&fromPageId=13582">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDEV&fromPageId=13582">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDEV&fromPageId=13582">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDEV&fromPageId=13582">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent">

<p><strong>Content</strong> </p>



<h1 id="GBeansArticle1-GeronimoGBeanArchitecture">Geronimo GBean Architecture</h1>

<h2 id="GBeansArticle1-Abstract">Abstract</h2>

<p>Geronimo is built on a Kernel that knows nothing about J2EE, rather it's a general-purpose Inversion of Control (IOC) framework for components called GBeans.  This article explains the theoretical aspects of inversion of control, then describes the GBean Life Cycle, GBean States and Dependency Injection with a few examples, and then explains how to write a simple GBean. </p>

<h2 id="GBeansArticle1-Introduction">Introduction</h2>

<p>Consider a platform like Linux or Windows which has an operating system core that provides system calls and set of applications that run on top of the those system calls. Geronimo is built on a similar core which knows nothing about J2EE and that core, the Geronimo Kernel, is essentially a framework for components called GBeans. Any complex system can be modeled as set of components that hold states, a set of relationships among them, and how each component reacts to certain events.  The Geronimo Kernel provides a framework for the GBeans with following services: </p>

<ol><li>GBeans can hold states (either persistent or non-persistent)</li><li>Relationships among the GBeans can be defined with them</li><li>GBeans can contain logic that defines how they react to events</li></ol>


<p>Almost everything in Geronimo is a GBean: containers, connectors, adapters, applications and so on.  The relationship between GBeans can be viewed as a mesh of components as explained by the following figure: </p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="http://apache.org/~hemapani/images/geronimo-gbean-archi.png" data-image-src="http://apache.org/~hemapani/images/geronimo-gbean-archi.png"></span> </p>

<p>Any J2EE Container is comprised of two classes of citizens; the first class citizens like Web Containers and EJB Containers that provide the core services, and the second class citizens which are the applications such as EJB's and Servlets that are deployed in the first class citizens.  Geronimo's architecture can be explained in terms of GBean behaviors. Geronimo is set of running GBeans, and each first class citizen is a set of GBeans that are related to one another. They are loaded via "plans" which are essentially an XML serialization of GBeans. When the plans are loaded and started the GBeans that are included in the plans will be started, i.e. the EJB Containers and/or the Web Containers will be started.  </p>

<p>The applications that run in a J2EE Container are described by Deployment Descriptors and Java Classes that are packed as a J2EE application archive.  The Geronimo Deployer parses those archives and constructs GBeans out of them. When the GBeans are started the application is deployed and available. The GBeans can be serialized and stored and as a result once an application is converted to GBeans and added to Geronimo it will be available even after the server is restarted.  </p>

<h2 id="GBeansArticle1-GBeansFromaConceptualPointofView">GBeans From a Conceptual Point of View</h2>

<p>The concepts that provide the base for the GBeans have much longer history in the sense that the Geronimo Kernel is an inversion of Control, IOC framework where the  IOC is also known as the dependency injection.  The essence of IOC or the dependency injection is to create a loosely coupled architecture where the dependencies among components are managed by the framework. When a component has a dependency on other component the IOC framework will find the correct component and make it available to the first component. The dependency injection name comes from the fact that the framework automatically injects the dependencies to the component.  Most simple form of IOC or the Dependency injection is to by system wide known values. For an instance let us assume this is Web Service that is to deployed inside Axis, do not worry about Axis but just assume that the Axis will load the following class and call the doit() method.  </p>

<plain-text-body>
public class WS {
    public WS(MesageContext msgctx) {
    }
    
    public void doit() {
    }
}
</plain-text-body>

<p>But Axis has something called </p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p>!<a shape="rect" class="unresolved" href="#">MessageContext</a> that has all the configuration information. In order to give a reference of !<a shape="rect" class="unresolved" href="#">MessageContext</a> to the WS class Axis can say "if you have a Constructor like XX(!</p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><a shape="rect" class="unresolved" href="#">MessageContext</a>) or you have a method like setMessageContext(!<a shape="rect" class="unresolved" href="#">MessageContext</a> msgctx) I will inject the !<a shape="rect" class="unresolved" href="#">MessageContext</a> to you". <p></p>

<p>This is the simplest form of dependency injection the framework look at the class and find out that the class expected a  !<a shape="rect" class="unresolved" href="#">MessageContext</a> to be inject it in. Or in other words the IOC framework inspect our components for certain patterns in methods, Parameters and the Constructors that when the pattern is found provides a Service to the Component, in the example we consider the service is giving a reference to the message Context.  </p>

<p>To get a better understanding about the use of the IOC one should look at the methods that were used to develop the system with decoupled components. The decoupling of the system is all about the interaction among the components.  </p>

<ol><li>Interfaces and Header files together with Factories provide decoupling of the system with minimal amount of coding.</li><li>The property files together with the, interfaces and factories (e.g. loading of the different implementations of JNDI using the property files.) make it possible to decouple with out recompilation of the code.</li><li>Registry Service together with lookups separate the service information from the caller by hiding them behind a name.</li><li>IOC or the dependency injection allows the automatic injection of references as they become available.</li></ol>


<p>The Idea of IOC is to define all the relationships among the components in terms of the framework level configurations and each component is injected to the other components that refer the service when the first component is available.  For an example let us consider the how a GBean G1 obtains a reference to a Configuration Store. The G1 is configured specifying the patterns of the reference it is expected.  </p>

<plain-text-body>
e.g. bean.setReferencePatterns("configStore,*:type=configStore,*");
</plain-text-body>

<p>When a another GBean whose name match the pattern "<strong>:type=configStore,</strong>" is started it is automatically injected in to the G1. This is more like Aspect Oriented programming, AOP where the developer says to the framework what is need to be done rather than how to do it.  </p>

<ul><li>But this does not means that the IOC is the only way to create decoupled systems and all the four ways of doing is useful and used in practice. It is matter of choosing the right tool for the occasion and there are good examples as well as bad examples for each.</li></ul>


<h2 id="GBeansArticle1-GBeanLifeCycle">GBean Life Cycle</h2>

<p>A GBean can be in any of the three states: <em>stored</em>, <em>loaded</em> or <em>running</em>.  In the <em>stored</em> state it is saved in a configuration store (also known as a "plan").  When it is <em>loaded</em> the kernel has mapped it to a name and knows about it.  Each GBean is bound with a name at start up; that name is not persistent. This can be explained by an analogy, we can think about the GBean as a Java Class and the name as a variable name that refers to a specific instance of the class. In the same way that the class can have more than one instance, the same GBean can be loaded under more than one name and stored in number of places.  </p>

<h2 id="GBeansArticle1-StateofGBeans">State of GBeans</h2>

<p>GBeans have two types of states, attributes and references. The references will be covered under the third part. The attributes are two types, persistent and non-persistence. The GBeans can be stored and restored using the built-in support.  There are special types of magic attributes defined by the architecture; the values for the magic attributes loaded depend on the environment the GBean loaded on. For an example the magic attribute "kernel" refers to the Kernel and when it is specified at the constructor it is automatically injected to the class by the framework. Similarly the !<a shape="rect" class="unresolved" href="#">ClassLoader</a> attributes inject the current class loader and the !<a shape="rect" class="unresolved" href="#">ObjectName</a> attributes inject the current name the GBean started under.  Complete list of all magic attributes can be found in the GBeanMBean class in the kernel.  The magic attributes can not be persistent as they are bound with the environment it is started. Note that in our first example of dependency injection where a Web Service is deployed to Axis, the !<a shape="rect" class="unresolved" href="#">MessageContext</a> is a magic attribute.  </p>

<p>A GBean with one attribute "val" will look like this: </p>

<plain-text-body>
public class MyGBean implements GBeanLifecycle {
    private final String val;
    
    static {
        GBeanInfoBuilder infoFactory =  ...
        // attributes
        infoFactory.addAttribute("val", String.class, true);
        // operations
        infoFactory.addOperation("getBean1");
        infoFactory.setConstructor(new String[]{"val"});
        GBEAN_INFO = infoFactory.getBeanInfo();
    }

    public ConstructorInjectionGbean(String val ) {
        this.val = val;
    }
    ...
}
</plain-text-body>

<p>We can start our GBean with the following code. The GBean implementation is done on top of JMX and the GBeanMBean accepts a GBean info and converts it into an Mbean. </p>

<plain-text-body>
GBeanMBean gmb = new GBeanMBean(MyGBean.GBEAN_INFO);
gmb.setAttribute("value","To be or not to be that is the question");
ObjectName myGbeanName = ObjectName.newInstance("Geronimo.my:name=mine");
kernel.loadGBean(myGbeanName,gmb);
kernel.startGBean(myGbeanName);
//dowork
kernel.stopGBean(myGbeanName);
kernel.unloadGBean(myGbeanName);
</plain-text-body>

<h2 id="GBeansArticle1-DependencyInjection">Dependency Injection</h2>

<p>There are two types of relationships  </p>

<ol><li>Single references</li><li>Reference Collections</li></ol>


<h3 id="GBeansArticle1-SingleReferences">Single References</h3>

<p>The references are injected to a GBean in one of the two ways; the getter/setter injection and the constructor injection based on how the dependencies injected in to the java Class that use to implements the GBean. With the getter and setter injection framework injects the attributes/ references using the getter and setter methods whereas the constructor injection injects the parameters as constructor parameters. The second approach is more preferable as with that the GBeans support so called good citizen pattern making sure that the GBean is in usable state once it is started. Geronimo supports both methods but moving towards the complete constructor injection.  </p>

<p>Following is a simple GBean that uses constructor injection. </p>

<plain-text-body>
public class MyGBean implements GBeanLifecycle {
    private final String GBean1 bean1;
    static {
        GBeanInfoBuilder infoFactory =  ...
        // attributes
        infoFactory.addReferance("Bean1", GBean1.class, true); ---------(A)
        // operations
        infoFactory.setConstructor(new String[]{"Bean1"}); -------------(B)
        GBEAN_INFO = infoFactory.getBeanInfo();
    }

    public ConstructorInjectionGbean(GBean1 bean1) {-----------(C)
        this.bean1 = bean1;
    }
...
}
</plain-text-body>

<p>Here the Line (A) said that there is a reference to the GBean1 and line (B) registered the matching constructor (C). In the Following code the developer specified the reference instance of GBean1 and start GBeans. </p>

<plain-text-body>
ObjectName GBean1= ObjectName.newInstance("Geronimo.my:name=gb1");
... //start the GBean 1
GBeanMBean gmb = new GBeanMBean(MyGBean.GBEAN_INFO);
gmb.setReferencePatterns("GBean1", GBean1Name);

ObjectName myGbeanName = ObjectName.newInstance("Geronimo.my:name=mine");
kernel.loadGBean(myGbeanName,gmb);
kernel.startGBean(myGbeanName);
//dowork
</plain-text-body>

<p>When the MyGBean is started an instance of GBean1 is injected via the constructor. </p>

<h3 id="GBeansArticle1-ReferenceCollections">Reference Collections</h3>

<p>Only difference when the Reference collection come in to play is replacing the GBean1 references in the above example with Collection and when specifying the name of the referenced GBean it is specified as a pattern with "*" and "?". </p>

<plain-text-body>
bean.setReferencePatterns("Geronimo.my:*");
</plain-text-body>

<p>The code asks the framework to make available all the GBeans with the Domain name "Geronimo.my:". When a GBean that whose matches the patterns is started it is automatically injected to the referee GBean.  </p>

<h4 id="GBeansArticle1-LogicinGBeans">Logic in GBeans</h4>

<p>GBeans leave the handling of the logic more or less in the form of usual java code and the Methods in the GBean class can be register to the GBean by adding a          </p>

<plain-text-body>
infoFactory.addOperation("doit",
new Object[]{val1,val2},new String[]{
val1.getClass().getName(),
val2.getClass().getName()}); --------- (A)
</plain-text-body>

<p>Kernel supports kernel.invoke("objectName","methodName",...)  using which one can call any method in any other GBean. But use of this is discouraged and accepted way to do it is to register reference pattern and obtain the instance of the other GBean injected in and code simple Java style on the code.  </p>

<p>E.g. Say GBean G1 need to call the doit() on GBean G2 the crude way to do it is to   </p>

<plain-text-body>
kernel.invoke("G2Name","doit");
</plain-text-body>

<p>Correct way to do it is write G1 like  </p>

<plain-text-body>
class G1 implements GBeanLifeCycle {
    ...
    private final G2 g2;
    
    static {
        GBeanInfoBuilder infoFactory = new GBeanInfoBuilder("G1", G1.class);
        infoFactory.addReference("G2",G2.class); --------- (A)
        infoFactory.addConstructor("G2"); ---------------- (B)
        GBEAN_INFO = infoFactory.getBeanInfo();
    }
    
    public ConstructorInjectionGbean(G2 g2 )     {
        this.g2 = g2;
    }
    
    public void doG1Work(){
        g2.doit();
    }
}
</plain-text-body>

<p>At line (A) defining there is a reference to G2 and at line (B) adding a constructor that inject the G2 and G1 obtain a reference to the G2. Then   logic is implemented using simple Java code.  GBeans have interfaces that make the GBean implements a given method. By making the GBean class implements the interface and putting a entry  infoFactory.addInterface("interfaceName") will automatically add the all the methods in the interface to the GBean and the getters and setter will be mapped to the attributes.  </p>

<h2 id="GBeansArticle1-SampleCode">Sample Code</h2>

<p>You can find few Sample GBeans and few Test Cases that demonstrate their use from <a shape="rect" class="external-link" href="http://apache.org/~hemapani/docs/gbeans-sample.zip">http://apache.org/~hemapani/docs/gbeans-sample.zip</a>. To run the test case you need maven installed in your machine.  </p>

<h2 id="GBeansArticle1-Summary">Summary</h2>

<p>The GBean architecture knows nothing about J2EE and a General framework for the developed loosely coupled System with IOC. It can be used outside Geronimo and can have potential to be the generic Architecture for loosely coupled Systems. This article explains the concepts and how to use the GBeans. </p>

<h2 id="GBeansArticle1-References">References</h2>

<p><a shape="rect" class="unresolved" href="#">1</a> The Article, A Brief Introduction to IoC by Sam Newman, 02/10/2004,  <a shape="rect" class="external-link" href="http://today.java.net/pub/a/today/2004/02/10/ioc.html" rel="nofollow">http://today.java.net/pub/a/today/2004/02/10/ioc.html</a> </p>

<p><a shape="rect" class="unresolved" href="#">2</a> Inversion of Control Containers and the Dependency Injection pattern, by Martin Fowler, <a shape="rect" class="external-link" href="http://www.martinfowler.com/articles/injection.html" rel="nofollow">http://www.martinfowler.com/articles/injection.html</a> </p>

<p><a shape="rect" class="unresolved" href="#">3</a> IoC Overview, Web Work dashboard, <a shape="rect" class="external-link" href="http://wiki.opensymphony.com/display/WW/IoC+Overview" rel="nofollow">http://wiki.opensymphony.com/display/WW/IoC+Overview</a> </p>

<p><a shape="rect" class="unresolved" href="#">4</a> Article Dependency Inversion Principle, <a shape="rect" class="external-link" href="http://www.objectmentor.com/resources/articles/dip.pdf" rel="nofollow">http://www.objectmentor.com/resources/articles/dip.pdf</a> </p>

<p><a shape="rect" class="unresolved" href="#">5</a> Interview with Dian Sundstrom, at Server Side, <a shape="rect" class="external-link" href="http://www.theserverside.com/talks/videos/DainSundstrom/dsl/q01.html" rel="nofollow">http://www.theserverside.com/talks/videos/DainSundstrom/dsl/q01.html</a> </p>

<p><a shape="rect" class="unresolved" href="#">6</a> Geronimo Kernel Module, <a shape="rect" class="external-link" href="http://geronimo.apache.org">http://geronimo.apache.org</a> </p>

<p>--Please feel free to do the alternation and drop me a note at Srinath Perera&lt;<a shape="rect" class="external-link" href="mailto:hemapani@apache.org" rel="nofollow">hemapani@apache.org</a>&gt; so I keep this in sync </p></div>
        </div>

        
      </div>
    </div>

    <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo Development : GBeansArticle1';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2011, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-4380560-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>
  </body>
</html>
