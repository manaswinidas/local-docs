<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=0">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="Configuring run-as and Default Subjects, and principal-role mapping">
    <meta name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Configuring run-as and Default Subjects, and principal-role mapping">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2010-05-11">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>

  <link href="asset?aid=4" rel="stylesheet" type="text/css">
  <link href="asset?aid=5" rel="stylesheet" type="text/css">
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shCore.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushJava.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushXml.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushPlain.js' type='text/javascript'></script>
  
  <script type="text/javascript">
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
  </script>

    <title>Apache Geronimo v3.0文档：配置运行方式和默认主题以及主体角色映射</title>
  </head>

  <body  onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">Home</a> > <a href="documentation.html">文档</a> > <a href="configuring-and-administering.html">配置和管理</a> > <a href="administering-security.html">管理安全性</a> > <a href="configuring-run-as-and-default-subjects-and-principal-role-mapping.html">配置运行方式和默认主题以及主体角色映射</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo v3.0</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">配置运行方式和默认主题以及主体角色映射</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645468"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645468">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645468"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645468">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645468"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645468">新增新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><h1 id="Configuringrun-asandDefaultSubjects,andprincipal-rolemapping-Introduction">介绍</h1>

<p>从版本2.0.1开始，Geronimo遵循以下基本原则：所有安全性都来自登录到安全领域所产生的主题。在先前的Geronimo发行版中，运行方式和缺省主题的安全性信息完全是在任何安全领域之外构造的。遵循新原则的结果是，运行身份和默认身份现在可以使用诸如命名凭据之类的功能完全参与安全性，以访问诸如连接器和Web服务之类的外部系统，并且JACC系统现在可以更完全地插入。</p>

<p>但是，由于现在运行方式主题和默认主题来自登录到安全领域，因此要使用此类主题，您需要提供每个此类主题的登录信息。此信息封装在CredentialStore中。我们在您的Geronimo计划中提供了使用XML的简单CredentialStore实现。请注意，这包括运行方式和默认主题的纯文本密码。对于许多环境，这可能不是合适的实现。</p>

<p>每个应用程序都可以选择使用默认的全局凭据存储，或指定一个特定的存储（可能特定于该应用程序）。</p>

<h1 id="Configuringrun-asandDefaultSubjects,andprincipal-rolemapping-ConfiguringaSimpleCredentialStoreImpl">配置SimpleCredentialStoreImpl</h1>

<p>对于可通过凭证存储访问的每个主题，您需要指定一个id，要登录的领域和凭证，这取决于安全领域的要求，但通常是名称和密码。该架构如下：</p>呈现宏“代码”时出错：为参数“ java.lang”指定了无效的值。空指针异常'<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!--
    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
--&gt;

&lt;!-- $Rev$ $Date$ --&gt;

&lt;xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema"
            xmlns:cs="http://geronimo.apache.org/xml/ns/credentialstore-1.0"
            targetNamespace="http://geronimo.apache.org/xml/ns/credentialstore-1.0"
            elementFormDefault="qualified" attributeFormDefault="unqualified"
            version="1.0"&gt;

    &lt;xsd:annotation&gt;
        &lt;xsd:documentation&gt;
            This is an XML Schema Definition for credential store configuration.
            CredentialStore configuration is
            specified by the element credential-store with namespace
            specified as xmlns =
            "http://geronimo.apache.org/xml/ns/credentialstore-1.0".
        &lt;/xsd:documentation&gt;
    &lt;/xsd:annotation&gt;

    &lt;xsd:element name="credential-store" type="cs:credential-storeType"&gt;
        &lt;xsd:annotation&gt;
            &lt;xsd:documentation&gt;
                The root element for Geronimo credential store configuration. This
                is a tree structure of realm, id, and sets of credentials such as name and password
            &lt;/xsd:documentation&gt;
        &lt;/xsd:annotation&gt;
    &lt;/xsd:element&gt;

    &lt;xsd:complexType name="credential-storeType"&gt;
        &lt;xsd:annotation&gt;
            &lt;xsd:documentation&gt;
                Defines the list of realms
            &lt;/xsd:documentation&gt;
        &lt;/xsd:annotation&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="realm" type="cs:realmType" minOccurs="0" maxOccurs="unbounded"&gt;
                &lt;xsd:annotation&gt;
                    &lt;xsd:documentation&gt;
                        The realm element contains the credentials for subjects in that realm.
                    &lt;/xsd:documentation&gt;
                &lt;/xsd:annotation&gt;
            &lt;/xsd:element&gt;
        &lt;/xsd:sequence&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="realmType"&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="subject" type="cs:subjectType" minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xsd:sequence&gt;
        &lt;xsd:attribute name="name" type="xsd:string" use="required"&gt;
            &lt;xsd:annotation&gt;
                &lt;xsd:documentation&gt;
                    The name attribute specifies the login realm name
                &lt;/xsd:documentation&gt;
            &lt;/xsd:annotation&gt;
        &lt;/xsd:attribute&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="subjectType"&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="id" type="xsd:string"&gt;
                &lt;xsd:annotation&gt;
                    &lt;xsd:documentation&gt;
                        The id element serves to identify the subject externally. For subjects with meaningful
                        names it might be convenient to use the name as id.
                    &lt;/xsd:documentation&gt;
                &lt;/xsd:annotation&gt;
            &lt;/xsd:element&gt;
            &lt;xsd:element name="credential" type="cs:credentialType" minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xsd:sequence&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="credentialType"&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="type" type="xsd:string"&gt;
                &lt;xsd:annotation&gt;
                    &lt;xsd:documentation&gt;
                        Class name or alias of the callback handler that will accept this credential
                    &lt;/xsd:documentation&gt;
                &lt;/xsd:annotation&gt;
            &lt;/xsd:element&gt;
            &lt;xsd:element name="value" type="xsd:string"&gt;
                &lt;xsd:annotation&gt;
                    &lt;xsd:documentation&gt;
                        credential value as a string.
                    &lt;/xsd:documentation&gt;
                &lt;/xsd:annotation&gt;
            &lt;/xsd:element&gt;
        &lt;/xsd:sequence&gt;
    &lt;/xsd:complexType&gt;


&lt;/xsd:schema&gt;
</pre>


<p>目前，Geronimo为名称和密码提供了回调处理程序。对于其他安全领域要求（例如证书），您将必须编写一个回调处理程序。</p>

<p>凭据存储配置的一个简单示例如下所示：</p>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>凭证存储示例</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
    &lt;gbean name="CredentialStore" class="org.apache.geronimo.security.credentialstore.SimpleCredentialStoreImpl"&gt;
        &lt;xml-attribute name="credentialStore"&gt;
            &lt;credential-store xmlns="http://geronimo.apache.org/xml/ns/credentialstore-1.0"&gt;
                &lt;realm name="my-properties-realm"&gt;
                    &lt;subject&gt;
                        &lt;id&gt;admin-run-as&lt;/id&gt;
                        &lt;credential&gt;
                            &lt;type&gt;org.apache.geronimo.security.credentialstore.NameCallbackHandler&lt;/type&gt;
                            &lt;value&gt;system&lt;/value&gt;
                        &lt;/credential&gt;
                        &lt;credential&gt;
                            &lt;type&gt;org.apache.geronimo.security.credentialstore.PasswordCallbackHandler&lt;/type&gt;
                            &lt;value&gt;manager&lt;/value&gt;
                        &lt;/credential&gt;
                    &lt;/subject&gt;
                    &lt;subject&gt;
                        &lt;id&gt;user-run-as&lt;/id&gt;
                        &lt;credential&gt;
                            &lt;type&gt;org.apache.geronimo.security.credentialstore.NameCallbackHandler&lt;/type&gt;
                            &lt;value&gt;user&lt;/value&gt;
                        &lt;/credential&gt;
                        &lt;credential&gt;
                            &lt;type&gt;org.apache.geronimo.security.credentialstore.PasswordCallbackHandler&lt;/type&gt;
                            &lt;value&gt;user-password&lt;/value&gt;
                        &lt;/credential&gt;
                    &lt;/subject&gt;
                    &lt;subject&gt;
                        &lt;id&gt;default&lt;/id&gt;
                        &lt;credential&gt;
                            &lt;type&gt;org.apache.geronimo.security.credentialstore.NameCallbackHandler&lt;/type&gt;
                            &lt;value&gt;default&lt;/value&gt;
                        &lt;/credential&gt;
                        &lt;credential&gt;
                            &lt;type&gt;org.apache.geronimo.security.credentialstore.PasswordCallbackHandler&lt;/type&gt;
                            &lt;value&gt;default&lt;/value&gt;
                        &lt;/credential&gt;
                    &lt;/subject&gt;
                &lt;/realm&gt;
            &lt;/credential-store&gt;
        &lt;/xml-attribute&gt;
    &lt;/gbean&gt;

</pre>
</div></div>

<p>再次注意，PasswordCallbackHandler值元素包含用户的纯文本密码。</p>

<h1 id="Configuringrun-asandDefaultSubjects,andprincipal-rolemapping-ConfiguringyourapplicationtouseaparticularCredentialStore">配置您的应用程序以使用特定的CredentialStore</h1>

<p>请注意，Geronimo安全性的这一方面是完全可插入的，此处仅描述默认实现。</p>

<p>JavaEE应用程序的Geronimo安全要求<security>在您的应用程序的GHeronimo计划中（其中之一）包含一个<security>元素。这描述了主体角色映射，以将主题从您的安全领域连接到规范部署描述符（和注释）中使用的角色。它还描述了如何通过指定凭据存储以及用作运行方式的每个角色的ID和领域来将运行方式角色解释为主题。同样，可以在凭据存储中指定默认主题。</security></security></p>

<p>安全配置的架构如下：</p>呈现宏“代码”时出错：为参数“ java.lang”指定了无效的值。空指针异常'<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
--&gt;

&lt;!-- $Rev$ $Date$ --&gt;

&lt;xsd:schema
        xmlns:xsd="http://www.w3.org/2001/XMLSchema"
        xmlns:j2ee="http://java.sun.com/xml/ns/j2ee"
        xmlns:geronimo="http://geronimo.apache.org/xml/ns/security-2.0"
        targetNamespace="http://geronimo.apache.org/xml/ns/security-2.0"
        xmlns:app="http://geronimo.apache.org/xml/ns/j2ee/application-2.0"
        xmlns:sys="http://geronimo.apache.org/xml/ns/deployment-1.2"
        elementFormDefault="qualified"
        attributeFormDefault="unqualified"
        version="2.0"&gt;

    &lt;xsd:import namespace="http://www.w3.org/XML/1998/namespace" schemaLocation="http://www.w3.org/2001/xml.xsd"/&gt;
    &lt;xsd:import namespace="http://geronimo.apache.org/xml/ns/j2ee/application-2.0" schemaLocation="geronimo-application-2.0.xsd"/&gt;
    &lt;xsd:import namespace="http://geronimo.apache.org/xml/ns/deployment-1.2"  schemaLocation="geronimo-module-1.2.xsd"/&gt;

    &lt;xsd:element name="security" type="geronimo:securityType" substitutionGroup="app:security"/&gt;
    &lt;xsd:element name="credential-store" type="sys:patternType"/&gt;
    &lt;xsd:element name="default-subject" type="geronimo:subject-infoType"/&gt;

    &lt;xsd:complexType name="securityType"&gt;
        &lt;xsd:annotation&gt;
            &lt;xsd:documentation&gt;
                Security entries

                If this element is present, all web and EJB modules MUST make the
                appropriate access checks as outlined in the JACC spec.
            &lt;/xsd:documentation&gt;
        &lt;/xsd:annotation&gt;
        &lt;xsd:complexContent&gt;
            &lt;xsd:extension base="app:abstract-securityType"&gt;

                &lt;xsd:sequence&gt;
                    &lt;xsd:element name="description" type="geronimo:descriptionType" minOccurs="0"
                                 maxOccurs="unbounded"/&gt;
                    &lt;xsd:element name="credential-store-ref" type="sys:patternType" minOccurs="0"/&gt;
                    &lt;xsd:element name="default-subject" type="geronimo:subject-infoType" minOccurs="0"/&gt;
                    &lt;xsd:element name="role-mappings" type="geronimo:role-mappingsType" minOccurs="0"/&gt;
                &lt;/xsd:sequence&gt;
                &lt;xsd:attribute name="doas-current-caller" type="xsd:boolean" default="false"&gt;
                    &lt;xsd:annotation&gt;
                        &lt;xsd:documentation&gt;
                            Set this attribute to "true" if the work is to be performed
                            as the calling Subject.
                        &lt;/xsd:documentation&gt;
                    &lt;/xsd:annotation&gt;
                &lt;/xsd:attribute&gt;
                &lt;xsd:attribute name="use-context-handler" type="xsd:boolean" default="false"&gt;
                    &lt;xsd:annotation&gt;
                        &lt;xsd:documentation&gt;
                            Set this attribute to "true" if the installed JACC policy
                            contexts will use PolicyContextHandlers.
                        &lt;/xsd:documentation&gt;
                    &lt;/xsd:annotation&gt;
                &lt;/xsd:attribute&gt;
                &lt;xsd:attribute name="default-role" type="xsd:string"&gt;
                    &lt;xsd:annotation&gt;
                        &lt;xsd:documentation&gt;
                            Used by the the Deployer to assign method permissions for
                            all of the unspecified methods, either by assigning them
                            to security roles, or by marking them as unchecked. If
                            the value of default-role is empty, then the unspecified
                            methods are marked unchecked
                        &lt;/xsd:documentation&gt;
                    &lt;/xsd:annotation&gt;
                &lt;/xsd:attribute&gt;
            &lt;/xsd:extension&gt;
        &lt;/xsd:complexContent&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="descriptionType"&gt;
        &lt;xsd:simpleContent&gt;
            &lt;xsd:extension base="xsd:string"&gt;
                &lt;xsd:attribute ref="xml:lang"/&gt;
            &lt;/xsd:extension&gt;
        &lt;/xsd:simpleContent&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="named-username-password-credentialType"&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="name" type="xsd:string"/&gt;
            &lt;xsd:element name="username" type="xsd:string"/&gt;
            &lt;xsd:element name="password" type="xsd:string"/&gt;
        &lt;/xsd:sequence&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="role-mappingsType"&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="role" type="geronimo:roleType" minOccurs="1" maxOccurs="unbounded"/&gt;
        &lt;/xsd:sequence&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="roleType"&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="description" type="geronimo:descriptionType" minOccurs="0" maxOccurs="unbounded"/&gt;
            &lt;xsd:element name="run-as-subject" type="geronimo:subject-infoType" minOccurs="0"/&gt;
            &lt;xsd:element name="realm-principal" type="geronimo:realmPrincipalType" minOccurs="0" maxOccurs="unbounded"/&gt;
            &lt;xsd:element name="login-domain-principal" type="geronimo:loginDomainPrincipalType" minOccurs="0"
                         maxOccurs="unbounded"/&gt;
            &lt;xsd:element name="principal" type="geronimo:principalType" minOccurs="0" maxOccurs="unbounded"/&gt;
            &lt;xsd:element name="distinguished-name" type="geronimo:distinguishedNameType" minOccurs="0"
                         maxOccurs="unbounded"/&gt;
        &lt;/xsd:sequence&gt;
        &lt;xsd:attribute name="role-name" type="xsd:string" use="required"/&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="realmPrincipalType"&gt;
        &lt;xsd:complexContent&gt;
            &lt;xsd:extension base="geronimo:loginDomainPrincipalType"&gt;
                &lt;xsd:attribute name="realm-name" type="xsd:string" use="required"/&gt;
            &lt;/xsd:extension&gt;
        &lt;/xsd:complexContent&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="loginDomainPrincipalType"&gt;
        &lt;xsd:complexContent&gt;
            &lt;xsd:extension base="geronimo:principalType"&gt;
                &lt;xsd:attribute name="domain-name" type="xsd:string" use="required"/&gt;
            &lt;/xsd:extension&gt;
        &lt;/xsd:complexContent&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="principalType"&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="description" type="geronimo:descriptionType" minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xsd:sequence&gt;
        &lt;xsd:attribute name="class" type="xsd:string" use="required"/&gt;
        &lt;xsd:attribute name="name" type="xsd:string" use="required"/&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="distinguishedNameType"&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="description" type="geronimo:descriptionType" minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xsd:sequence&gt;
        &lt;xsd:attribute name="name" type="xsd:string" use="required"/&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="subject-infoType"&gt;
        &lt;xsd:sequence&gt;
            &lt;xsd:element name="description" type="geronimo:descriptionType" minOccurs="0" maxOccurs="unbounded"/&gt;
            &lt;xsd:element name="realm" type="xsd:string"/&gt;
            &lt;xsd:element name="id" type="xsd:string"/&gt;
        &lt;/xsd:sequence&gt;
    &lt;/xsd:complexType&gt;

    &lt;!--&lt;xsd:complexType name="credential-storeType"&gt;--&gt;
        &lt;!--&lt;xsd:sequence&gt;--&gt;
            &lt;!--&lt;xsd:element name="pattern" type="sys:patternType"&gt;--&gt;
                &lt;!--&lt;xsd:annotation&gt;--&gt;
                    &lt;!--&lt;xsd:documentation&gt;--&gt;
                        &lt;!--The pattern element defines a components of the--&gt;
                        &lt;!--abstract name of GBean referred. It (optionally) includes--&gt;
                        &lt;!--the groupId, artifactId, version,--&gt;
                        &lt;!--module, type, and name of the GBean module.--&gt;
                    &lt;!--&lt;/xsd:documentation&gt;--&gt;
                &lt;!--&lt;/xsd:annotation&gt;--&gt;
            &lt;!--&lt;/xsd:element&gt;--&gt;
        &lt;!--&lt;/xsd:sequence&gt;--&gt;
    &lt;!--&lt;/xsd:complexType&gt;--&gt;

&lt;/xsd:schema&gt;
</pre>


<p>在credential-store-ref中指定要使用的凭证存储。通常，您只需要提供凭证存储名称的名称部分：对于大多数用途，您很可能在应用计划中包括特定于应用程序的凭证存储，但是否则，您需要确保凭证存储gbean位于以下项的祖先配置中应用程序。</p>

<p>默认主题或每个运行方式角色使用subject-infoType元素指定获取主题所需的信息。</p>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>安全配置示例</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
      &lt;security use-context-handler="false" xmlns="http://geronimo.apache.org/xml/ns/security-2.0"&gt;
        &lt;default-subject&gt;
          &lt;realm&gt;my-properties-realm&lt;/realm&gt;
          &lt;id&gt;default&lt;/id&gt;
        &lt;/default-subject&gt;
        &lt;role-mappings&gt;
          &lt;role role-name="Administrator"&gt;
            &lt;principal class="org.apache.geronimo.security.realm.providers.GeronimoUserPrincipal" name="system"/&gt;
          &lt;/role&gt;
          &lt;role role-name="User"&gt;
            &lt;run-as-subject&gt;
                &lt;realm&gt;my-properties-realm&lt;/realm&gt;
                &lt;id&gt;user-run-as&lt;/id&gt;
            &lt;/run-as-subject&gt;the loi
            &lt;principal class="org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal" name="user"/&gt;
          &lt;/role&gt;
        &lt;/role-mappings&gt;
      &lt;/security&gt;
</pre>
</div></div>

<p>上面的示例显示了最简单的主体角色映射：您为映射到特定角色的每个主体指定主体类和名称。通常，这足以区分主体。但是，您可能有几个登录模块或安全领域，它们可以产生相同的主体但含义不同。在这种情况下，您可以包括登录域名或领域名称以区分主体。</p>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>其他主要规格</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;!-- normal, no domain or realm info --&gt;
&lt;principal class="org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal" name="user"/&gt;

&lt;!-- login domain name specified --&gt;
&lt;login-domain-principal domain-name="mydomain" class="org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal" name="user"/&gt;

&lt;~-- realm name and login domain name specified&gt;
&lt;realm-principal realm-name="my-properties-realm" domain-name="mydomain" class="org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal" name="user"/&gt;

</pre>
</div></div></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Configuring run-as and Default Subjects, and principal-role mapping';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2013，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  

</body></html>