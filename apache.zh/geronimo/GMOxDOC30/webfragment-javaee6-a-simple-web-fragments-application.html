<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="webfragment-javaee6 - A simple web fragments application" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi webfragment-javaee6 - A simple web fragments application" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0 Documentation: webfragment-javaee6 - A simple web fragments application</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="reference.html">Reference</a>&nbsp;&gt;&nbsp;<a href="samples.html">Samples</a>&nbsp;&gt;&nbsp;<a href="java-ee-sample-applications.html">Java EE sample applications</a>&nbsp;&gt;&nbsp;<a href="webfragment-javaee6-a-simple-web-fragments-application.html">webfragment-javaee6 - A simple web fragments application</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">webfragment-javaee6 - A simple web fragments application</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=23338367">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=23338367">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=23338367">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=23338367">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=23338367">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=23338367">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>

<h1 id="webfragment-javaee6-Asimplewebfragmentsapplication-Applicationoverview">Application overview</h1>
<p>This sample demonstrates the modularity and plug-ability features in Servlet 3.0 specification, which is also call as web fragments. A web fragment is like a part of a web application, which consumes almost all the same elements as a web application within its deployment descriptor, however, the deployment descriptor of a web fragment must be named as <code>web-fragment.xml</code> and put in <code>META-INF/</code> directory of the fragment. And the top-level element must be <strong>&lt;web-fragment&gt;</strong>. You can update a web fragment without any impact to the web application.</p>

<p>Within the web application, all configuration files such as <code>web.xml</code> and <code>web-fragment.xml</code> are loaded and scanned. You can specify the ordering requirements of the web application use either <strong>&lt;absolute-ordering&gt;</strong> or <strong>&lt;order&gt;</strong> element. This sample only shows the usage of <strong>&lt;absolute-ordering&gt;</strong> element.</p>

<h1 id="webfragment-javaee6-Asimplewebfragmentsapplication-Applicationcontent">Application content</h1>

<p>The sample application consists of following list of packages and classes.</p>

<div class="indent0 inline" style="margin-left: 0px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><strong>org.apache.geronimo.samples.javaee6.webfragment.fragment1</strong> is the first fragment of the web application</p></div>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><ul><li><strong>FilterFragment1.java</strong> is a filter classes in fragment1 to the request to <strong>/messageRecord</strong>.</li></ul></div>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><ul><li><strong>QueryAll.java</strong> displays all items you can buy.</li></ul></div>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><ul><li><strong>META-INF/web-fragment.xml</strong> is the deployment descriptor of the fragment1.</li></ul></div>

<div class="indent0 inline" style="margin-left: 0px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><strong>org.apache.geronimo.samples.javaee6.webfragment.fragment2</strong> is the second fragment of the web application</p></div>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><ul><li><strong>FilterFragment2.java</strong> is a filter classes in fragment2 to the request to <strong>/messageRecord</strong>.</li></ul></div>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><ul><li><strong>BuyRecordItem.java</strong> perform the actual <strong>buy</strong> action.</li></ul></div>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><ul><li><strong>ShoppingCart.java</strong> puts the items you bought into a shopping cart.</li></ul></div>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><ul><li><strong>META-INF/web-fragment.xml</strong> is the deployment descriptor of the fragment2.</li></ul></div>

<div class="indent0 inline" style="margin-left: 0px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><strong>org.apache.geronimo.samples.javaee6.webfragment.fragment3</strong> is the first fragment of the web application</p></div>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><ul><li><strong>FilterFragment3.java</strong> is a filter classes in fragment3 to the request to <strong>/messageRecord</strong>.</li></ul></div>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><ul><li><strong>Payment.java</strong> calculate how much you should pay.</li></ul></div>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><ul><li><strong>ServletListener.java</strong> is a listener class in fragment3 to all the request to <strong>/Payment</strong> servlet.</li></ul></div>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><ul><li><strong>META-INF/web-fragment.xml</strong> is the deployment descriptor of the fragment3.</li></ul></div>

<div class="indent0 inline" style="margin-left: 0px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><strong>org.apache.geronimo.samples.javaee6.webfragment</strong> is the main body of the web application</p></div>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><ul><li><strong>WelcomePage.java</strong> shows the welcome page and the brief introduction of the sample application.</li></ul></div>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><ul><li><strong>messageRecord.java</strong> displays all the filter messages and listener messages during the purchase.</li></ul></div>

<p>The list of web application files in the webfragment application is depicted in the following.</p>
<div class="indent0 inline" style="margin-left: 0px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p>+-WEB-INF</p></div>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p>|_ web.xml</p></div>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p>|_ geronimo-web.xml</p></div>
<div class="indent0 inline" style="margin-left: 0px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p>|_ index.html</p></div>
<div class="indent0 inline" style="margin-left: 0px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p>|_ header.html</p></div>
<div class="indent0 inline" style="margin-left: 0px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p>|_ Sample-docu.html</p></div>



<h1 id="webfragment-javaee6-Asimplewebfragmentsapplication-Applicationimplementation">Application implementation</h1>

<p><strong>geronimo-web.xml</strong> specifies the module's information and the url for the web application</p>

<p>Information about the project sucha as module's unique identification, dependencies is described inside the <strong>&lt;sys:environment/&gt;</strong> tags. It is a good practise to give a module an unique identification, so that it can later be referenced by some other deployable application. This module is in the group <strong>org.apache.geronimo.samples</strong>. The path specified in the <strong>&lt;context-root&gt;</strong> tag will be the entry point of this web application. Therefore you can access this web application at <strong>http://&lt;hostname&gt;:&lt;port&gt;/webfragment-javaee6</strong>.</p>

<parameter ac:name="">xml</parameter><parameter ac:name="title">geronimo-web.xml</parameter><plain-text-body>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns="http://geronimo.apache.org/xml/ns/j2ee/web-2.0.1"
         xmlns:naming="http://geronimo.apache.org/xml/ns/naming-1.2"
         xmlns:sec="http://geronimo.apache.org/xml/ns/security-2.0"
         xmlns:sys="http://geronimo.apache.org/xml/ns/deployment-1.2"&gt;

  &lt;sys:environment&gt;
    &lt;sys:moduleId&gt;
      &lt;sys:groupId&gt;org.apache.geronimo.samples&lt;/sys:groupId&gt;
      &lt;sys:artifactId&gt;webfragment-javaee6&lt;/sys:artifactId&gt;
      &lt;sys:version&gt;${version}&lt;/sys:version&gt;
      &lt;sys:type&gt;car&lt;/sys:type&gt;
    &lt;/sys:moduleId&gt;
    &lt;sys:dependencies/&gt;
    &lt;sys:hidden-classes/&gt;
    &lt;sys:non-overridable-classes/&gt;
  &lt;/sys:environment&gt;

  &lt;context-root&gt;/webfragment-javaee6&lt;/context-root&gt;

&lt;/web-app&gt;
</plain-text-body>

<p><strong>web.xml</strong> defines the welcome page of the webfragment application and the order of resources to be composed from fragments. Using <strong>&lt;absolute-ordering&gt;</strong> means that web.xml must be processed first, fragment3 and fragment2 must be processed sequentially. <strong>&lt;others/&gt;</strong> element makes sure the other web fragments being processed before fragment1. And fragment1 is the last one to be processed.</p>
<parameter ac:name="">xml</parameter><parameter ac:name="title">web.xml</parameter><plain-text-body>
...
    &lt;welcome-file-list&gt;
        &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
    &lt;/welcome-file-list&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;WelcomePage&lt;/servlet-name&gt;
        &lt;servlet-class&gt;WelcomePage&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;WelcomePage&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/WelcomePage/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;    
    &lt;session-config&gt;
        &lt;session-timeout&gt;30&lt;/session-timeout&gt;
    &lt;/session-config&gt;

    &lt;absolute-ordering&gt;
        &lt;name&gt;fragment3&lt;/name&gt;
        &lt;name&gt;fragment2&lt;/name&gt;
        &lt;others/&gt;
        &lt;name&gt;fragment1&lt;/name&gt;
    &lt;/absolute-ordering&gt;
&lt;/web-app&gt;
</plain-text-body>

<p><strong>WelcomePage.java</strong> is a servlet component which sends the request to another servlet <strong>QueryAll</strong> in fragment1.</p>
<parameter ac:name="">java</parameter><parameter ac:name="1">WelcomePage.java</parameter><plain-text-body>
...
public class WelcomePage extends HttpServlet {
   ...
   protected void processRequest(HttpServletRequest request, HttpServletResponse response)
    throws ServletException, IOException {
        response.setContentType("text/html;charset=UTF-8");
        PrintWriter out = response.getWriter();
        try {
         ...
         out.println("&lt;input type=\"submit\" name=\"QueryAll\" value=\"Query All Items\"&gt;");
         ...
            }finally { 
        out.close();}
...
</plain-text-body>

<p><strong>web-fragment.xml</strong> uses the same elements as in <strong>web.xml</strong> except that the top-level element must be <strong>&lt;web-fragment&gt;</strong>. And <strong>metadata-complete="true"</strong> means any annotatons in the class files within this fragment will not be processed. <strong>&lt;name&gt;fragment1&lt;/name&gt;</strong> must be consistent with the one in <strong>web.xml</strong> of webfragment application.</p>
<parameter ac:name="">xml</parameter><parameter ac:name="title">web-fragment.xml of fragment1</parameter><plain-text-body>
...
&lt;web-fragment metadata-complete="true" version="3.0" 
    xmlns="http://java.sun.com/xml/ns/javaee" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-fragment_3_0.xsd"&gt;
  &lt;name&gt;fragment1&lt;/name&gt;
  &lt;filter&gt;
    &lt;icon/&gt;
    &lt;filter-name&gt;FilterFragment1&lt;/filter-name&gt;
    &lt;filter-class&gt;org.apache.geronimo.samples.javaee6.webfragment.fragment1.FilterFragment1&lt;/filter-class&gt;
   &lt;/filter&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;FilterFragment1&lt;/filter-name&gt;
    &lt;url-pattern&gt;/messageRecord&lt;/url-pattern&gt;
    &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
  &lt;/filter-mapping&gt;
  &lt;servlet&gt;
      &lt;servlet-name&gt;QueryAll&lt;/servlet-name&gt;
      &lt;servlet-class&gt;org.apache.geronimo.samples.javaee6.webfragment.fragment1.QueryAll&lt;/servlet-class&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;QueryAll&lt;/servlet-name&gt;
      &lt;url-pattern&gt;/QueryAll&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
&lt;/web-fragment&gt;
</plain-text-body>

<p>You can look into other web framents, and you will notice the similar configuration information and some other servlets which are pretty easy to understand.</p>

<h1 id="webfragment-javaee6-Asimplewebfragmentsapplication-Getthesourcecode">Get the source code</h1>
<p>Please reference <a shape="rect" href="java-ee-sample-applications.html">Samples General Information</a> for information on obtaining and building the source for this and other samples.</p>

<h2 id="webfragment-javaee6-Asimplewebfragmentsapplication-Buildthewebapplication">Build the web application</h2>

<p>Once all the sources get checked out the next step is to build <strong>webfragment-javaee6</strong>. It requires Maven 2 for building the binaries.</p>

<p>From the <strong>&lt;</strong><strong>webfragment-javaee6_home&gt;</strong> directory run the following command.</p>
<rich-text-body>
<p>mvn clean install</p></rich-text-body>

<p>This process will take a couple of minutes. The binaries will be generated in the corresponding <strong>target</strong> directory .</p>

<h2 id="webfragment-javaee6-Asimplewebfragmentsapplication-Deploythewebapplication">Deploy the web application</h2>

<p>Deploying sample application is pretty straight forward as we are going to use the Geronimo Console.</p>
<ol><li>Scroll down to <strong>Deploy New</strong> from the Console Navigation panel.</li><li>Load <strong>webfragment-javaee6-war-3.0-SNAPSHOT.war</strong> from <strong>webfragment-javaee6-war/target</strong> folder in to the <strong>Archive</strong> input box.</li><li>Press <strong>Install</strong> button to deploy application in the server.</li></ol>


<h2 id="webfragment-javaee6-Asimplewebfragmentsapplication-Testthewebapplication">Test the web application</h2>

<p>The app is visible at <a shape="rect" class="external-link" href="http://localhost:8080/webfragment-javaee6/" rel="nofollow">http://localhost:8080/webfragment-javaee6/</a></p>

<p>Input the ID and quantity you want to buy, then click <strong>Add to cart</strong><br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-content-image-border" src="webfragment-javaee6-a-simple-web-fragments-application.data/webfragment1.jpg"></span></p>

<p>Click <strong>Go to Pay</strong> to see how much you should pay and all messages that the filter or listener classes recorded.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-content-image-border" src="webfragment-javaee6-a-simple-web-fragments-application.data/webfragment2.jpg"></span></p></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : webfragment-javaee6 - A simple web fragments application';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
