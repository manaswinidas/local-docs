<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="persistence.xml" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi persistence.xml" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0 Documentation: persistence.xml</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="creating-deployment-plans.html">Creating deployment plans</a>&nbsp;&gt;&nbsp;<a href="understanding-deployment-plans.html">Understanding deployment plans</a>&nbsp;&gt;&nbsp;<a href="persistencexml.html">persistence.xml</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">persistence.xml</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645410">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645410">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645410">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645410">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645410">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645410">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><div class="toc-macro client-side-toc-macro" data-headerelements="H1,H2,H3,H4,H5,H6,H7"></div>
<h1 id="persistence.xml-Overview">Overview</h1>
<p>The <strong>persistence.xml</strong> file describes persistence units. It is the deployment descriptor file for persistence using Java Persistence API (JPA).  It is used to declare the following.</p>

<ul><li>Managed persistence classes.<br clear="none">
  The managed classes are, for example, those which are annotated using <strong>@Entity</strong>, <strong>@Embeddable</strong> or <br clear="none">
  <strong>@MappedSuperclass</strong>.</li><li>Specify object/relation mapping.<br clear="none">
  JPA provides several mechanisms to map the java classes to tables in a relational database.</li><li>Configuration information for entity managers and entity manager factory classes.</li></ul>


<p>The <strong>persistence.xml</strong> file is placed in the <strong>META-INF</strong> directory of the root of the persistence unit. The object/relational mapping information is provided by the following ways. </p>

<ul><li>Annotations on the managed persistence classes</li><li>One or more XML files contained in the root of the persistence unit</li><li>One or more XML files outside the root of the persistence unit on the classpath and referenced from the<br clear="none">
  <strong>persistence.xml</strong>, or a combination of these.</li></ul>


<p>In Java EE, the root of a persistence unit can be one of the following</p>

<ul><li>EJB-JAR file</li><li><strong>WEB-INF/classes</strong> directory of a WAR file</li><li>A jar file in the <strong>WEB-INF/lib</strong> directory of a WAR file</li><li>A jar file in the root of the EAR</li><li>A jar file in the EAR library directory</li><li>An application client jar file</li></ul>


<p>The location of the managed persistence classes can be as follows.</p>

<ul><li>Within the root of the persistence unit.</li><li>Can be specified by reference in the <strong>persistence.xml</strong> by naming the classes, archives, or mapping XML files<br clear="none">
  that are accessible on the application classpath. </li><li>Some combinations of the above methods.</li></ul>


<h2 id="persistence.xml-Packaging">Packaging</h2>
<p>The <strong>persistence.xml</strong> file is placed in the <strong>META-INF</strong> directory of the root of the persistence unit. </p>

<h1 id="persistence.xml-Schema">Schema</h1>
<p>The schema of the <strong>persistence.xml</strong> is at this <a shape="rect" class="external-link" href="http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd" rel="nofollow">link</a>. Apache geronimo uses <a shape="rect" class="external-link" href="http://openjpa.apache.org/">OpenJPA</a> as the JPA provider. </p>

<h2 id="persistence.xml-Schematoplevelelements">Schema top level elements</h2>
<p>The top level element of the <strong>persistence.xml</strong> is <strong>&lt;persistence&gt;</strong>. The below sections explain the sub-elements of the <strong>&lt;persistence&gt;</strong> element. Typical <strong>persistence.xml</strong> looks like below.</p>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>persistence.xml</b></div><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot;
 xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; version=&quot;1.0&quot;
 xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/persistence 
 http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd&quot;&gt;
 ...
 ...
&lt;/persistence&gt;
]]></script>
</div></div>

<h3 id="persistence.xml-&lt;persistence-unit&gt;">&lt;persistence-unit&gt;</h3>
<p>The <strong>&lt;persistence&gt;</strong> element can consist of more than one <strong>&lt;persistence-unit&gt;</strong> element each describing a persistence unit. The <strong>persistence-unit</strong> element consists of the following attributes.</p>

<h4 id="persistence.xml-Attribute:name">Attribute : name</h4>
<p>This attribute is required. The <strong>name</strong> attribute defines the name for the persistence unit. It uniquely identifies a persistence context. This name is used to identify a persistence unit referred to by the <strong>PersistenceContext</strong> and <strong>PersistenceUnit</strong> annotations. It is also referred while creating an entity manager factory object. The following note illustrates the usage in an application.</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>1. The below annotation injects <strong>EntityManager</strong> object that corresponds to <strong>Tutorial</strong> persistence unit <br clear="none">
    to the variable <strong>em</strong> .</p>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
  @PersistenceContext(unitName=&quot;Tutorial&quot;)
  private EntityManager em; 
]]></script>
</div></div>
<p>2. The below annotation injects <strong>EntityManagerFactory</strong> object that corresponds to <strong>Account</strong> <br clear="none">
    persistence unit to the variable <strong>emf</strong>. From the <strong>emf</strong>, the <strong>EntityManager</strong> object can be created. </p>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
@PersistenceUnit(unitName=&quot;Account&quot;)
private EntityManagerFactory emf;
]]></script>
</div></div></div></div>

<h4 id="persistence.xml-Attribute:transaction-type">Attribute : transaction-type</h4>
<p>This attribute can have the following values.</p>

<ul><li><strong>JTA</strong></li><li><strong>RESOURCE_LOCAL</strong></li></ul>


<p>The <strong>transaction-type</strong> attribute is used to specify whether the entity managers provided by the entity manager factory for the persistence unit must be JTA entity managers or resource-local entity managers. The value of this element is <strong>JTA</strong> or <strong>RESOURCE_LOCAL</strong>. A <strong>transaction-type</strong> of JTA assumes that a JTA data source will be  provided. It is provided either as specified by the <strong>jta-data-source</strong> element or provided by the container. In general, in Java EE environments, a <strong>transaction-type</strong> of <strong>RESOURCE_LOCAL</strong> assumes that a non-JTA datasource will be provided. In a Java EE environment, if this element is not specified, the default is <strong>JTA</strong>. In a Java SE environment, if this element is not specified, a default of <strong>RESOURCE_LOCAL</strong> may be assumed.</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>1. The below declaration is for a persistence unit named <strong>Account</strong> and the transaction type is <strong>JTA</strong>. </p>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;persistence-unit name=&quot;Account&quot; transaction-type=&quot;JTA&quot;&gt;
...
...
&lt;/persistence-unit&gt;
]]></script>
</div></div>
<p>2. The below declaration is for a persistence unit named <strong>Account</strong> and the transaction type is <br clear="none">
    <strong>RESOURCE_LOCAL</strong>.</p>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[ 
&lt;persistence-unit name=&quot;Account&quot; transaction-type=&quot;RESOURCE_LOCAL&quot;&gt;
...
...
&lt;/persistence-unit&gt;
]]></script>
</div></div>

<p>Please note that there are two types of entity managers and corresponding persistence contexts. These are container managed entity manager and application managed entity manager. </p>

<p>The container managed entity manager is the one whose persistence context is managed by container. The persistence context is propagated along the active transaction. The persistence scope of the container managed entity manager is transaction by default. The transaction type of the entity manager is always <strong>JTA</strong>. The <strong>EntityManager</strong> object is injected by the container to the application.</p>

<p>The application managed entity manager is the one whose persistence context is managed by the application. The persistence context is not propagated along the transaction. The persistence context will be active even after the current transaction completes. The transaction type of the entity manager is <strong>RESOURCE_LOCAL</strong> by default. The <strong>EntityManager</strong> object should be created by using <strong>EntityManagerFactory</strong> object in the application.</p></div></div>

<h4 id="persistence.xml-&lt;description&gt;">&lt;description&gt;</h4>
<p>The description element provides optional descriptive information about the persistence unit.</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>1. The below XML content illustrate the use of the element.</p>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[ 
&lt;persistence-unit name=&quot;Account&quot; transaction-type=&quot;JTA&quot;&gt;
 &lt;description&gt;Entities related to bank accounts&lt;/description&gt;
 ...                 
 ...
&lt;/persistence-unit&gt;
]]></script>
</div></div></div></div>

<h4 id="persistence.xml-&lt;provider&gt;">&lt;provider&gt;</h4>
<p>The provider element specifies the name of the persistence provider's <code>javax.persistence.spi.PersistenceProvider</code> class. The provider element must be specified if the application is dependent upon a particular persistence provider being used. The provider class supplies EntityManagers for this persistence unit.</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>1. The below XML content illustrate the use of the element.</p>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;persistence-unit name=&quot;Account&quot; transaction-type=&quot;JTA&quot;&gt;
&lt;description&gt;Entities related to bank accounts&lt;/description&gt;
&lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
...
...
&lt;/persistence-unit&gt;
]]></script>
</div></div>
<p>For OpenJPA, the value of the provider is <strong>org.apache.openjpa.persistence.PersistenceProviderImpl</strong>. </p></div></div>

<h4 id="persistence.xml-&lt;jta-data-source&gt;,&lt;non-jta-data-source&gt;">&lt;jta-data-source&gt;, &lt;non-jta-data-source&gt;</h4>
<p>In Java EE environments, the jta-data-source and non-jta-data-source elements are used to specify the global JNDI name of the JTA and non-JTA data source respectively to be used by the persistence provider. If neither is specified, the deployer must specify a JTA data source at deployment or a JTA data source must be provided by the container, and a JTA EntityManagerFactory will be created to correspond to it. These elements name the data source in the local environment. The format/syntax of these names and the ability to specify the names are product specific. In Java SE environments, these elements may be used or the data source information may be specified by other means; depending upon the requirements of the provider.</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>In the geronimo server, users can deploy datasources (database connection pools) on databases from various vendors like DB2, Oracle, MySQL, MS-SQLServer etc,. When creating a datasource, users have to specify the datasource name in the deployment plan. The name given to the datasource is to be provided in the <strong>jta-data-source</strong> and <strong>non-jta-data-source</strong> elements. The below XML fragment illustrates the usage.</p>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;persistence-unit name=&quot;Account&quot; transaction-type=&quot;JTA&quot;&gt;
  &lt;description&gt;ContainerManagedJPA&lt;/description&gt;
  &lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
  &lt;jta-data-source&gt;AccountDB2DataSource&lt;/jta-data-source&gt;
  ...
  ...
&lt;/persistence-unit&gt;
]]></script>
</div></div></div></div>

<p>The <strong>non-jta-datasource</strong> must be a datasource that has no transaction support. It can be deployed on the geronimo server by using the <strong>&lt;no-transaction/&gt;</strong> element instead of <strong>&lt;local-transaction/&gt;</strong> or <strong>&lt;xa-transaction&gt;</strong> in the connector plan as illustrated below.</p>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;connector xmlns=&quot;http://geronimo.apache.org/xml/ns/j2ee/connector-1.2&quot;&gt;
...
...
 &lt;resourceadapter&gt;
 ...
 ...
  &lt;connectionmanager&gt;
   &lt;local-transaction/&gt;
    &lt;no-transaction/&gt;
     &lt;max-size&gt;10&lt;/max-size&gt;
     &lt;min-size&gt;0&lt;/min-size&gt;
     &lt;match-one/&gt;
    &lt;/single-pool&gt;
  &lt;/connectionmanager&gt;
 ...
 ...
 &lt;/resourceadapter&gt;
...
...
&lt;/connector&gt;
]]></script>
</div></div>

<h4 id="persistence.xml-&lt;mapping-file&gt;">&lt;mapping-file&gt;</h4>
<p>An object/relational mapping XML file contains mapping information for the classes listed in it. The mapping files can be provided as follows.</p>

<ul><li>Object/relational mapping XML file named <strong>orm.xml</strong> may be specified in the <strong>META-INF</strong> directory in the root of the<br clear="none">
  persistence unit.</li></ul>


<ul><li>Object/relational mapping XML file named <strong>orm.xml</strong> may be specified  in the <strong>META-INF</strong> directory of any jar file<br clear="none">
  referenced by the <strong>persistence.xml</strong>. </li></ul>


<ul><li>In addition, other mapping files may be referenced by the mapping-file elements of the persistence-unit<br clear="none">
  element, and may be present anywhere on the classpath. </li></ul>


<p>An <strong>orm.xml</strong> file or other mapping file is loaded as a resource by the persistence provider. If a mapping file is specified, the classes and mapping information specified in the mapping file will be used. If multiple mapping files are specified (possibly including one or more <strong>orm.xml</strong> files), the resulting mappings are obtained by combining the mappings from all of the files. The result is undefined if multiple mapping files (including any <strong>orm.xml</strong> file) referenced within a single persistence unit contain overlapping mapping information for any given class. The below XML fragment illustrates the usage.</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;persistence-unit name=&quot;Tutorial&quot; transaction-type=&quot;RESOURCE_LOCAL&quot;&gt;
&lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
&lt;non-jta-data-source&gt;ProductDS-nonJTA&lt;/non-jta-data-source&gt;
&lt;mapping-file&gt;object_mappings.xml&lt;/mapping-file&gt;
     ...
     ...
&lt;/persistence-unit&gt;
]]></script>
</div></div>
<p>The object_mappings.xml file must be in the classpath of the application.</p></div></div>

<h4 id="persistence.xml-&lt;jar-file&gt;">&lt;jar-file&gt;</h4>
<p>One or more JAR files may be specified using the <strong>jar-file</strong> elements instead of, or in addition to the mapping files specified in the <strong>mapping-file</strong> elements. If specified, JPA processes these jar files as follows.</p>

<ul><li>These JAR files will be searched for managed persistence classes, and any mapping metadata annotations found on them will be processed.</li></ul>


<ul><li>They will be mapped using the mapping annotation defaults defined by the JPA specification. JAR files are specified relative to the root of the persistence unit.</li></ul>


<ul><li>A list of named managed persistence classes may also be specified instead of, or in addition to, the JAR files and mapping files (using <strong>class</strong> xml element explained below). Any mapping metadata annotations found on these classes will be processed, or they will be mapped using the mapping annotation defaults. The following XML fragment illustrates the usage.
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;persistence-unit name=&quot;Tutorial&quot; transaction-type=&quot;RESOURCE_LOCAL&quot;&gt;
 &lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
 &lt;jta-data-source&gt;AccountDS&lt;/jta-data-source&gt;
 &lt;mapping-file&gt;account_mappings.xml&lt;/mapping-file&gt;
 &lt;jar-file&gt;account-entities.jar&lt;/jar-file&gt;
  ...
  ...
&lt;/persistence-unit&gt;
]]></script>
</div></div>
<p>The <strong>account-entities.jar</strong> is placed at the root of the persistence unit.</p></div></div></li></ul>


<h4 id="persistence.xml-&lt;Class&gt;">&lt;Class&gt;</h4>
<p>The following classes must be implicitly or explicitly denoted as managed persistence classes to be<br clear="none">
included within a persistence unit.</p>
<ul><li>Entity classes</li><li>Embeddable classes</li><li>Mapped superclasses.</li></ul>


<p>The set of managed persistence classes that are managed by a persistence unit is defined by using one or<br clear="none">
more of the following:</p>
<ul><li>One or more object/relational mapping XML files (explained in <strong>mapping-file</strong> section above).</li><li>One or more jar files that will be searched for classes explained in <strong>jar-file</strong> section above).</li><li>An explicit list of the classes (using <strong>class</strong> element).</li><li>The annotated managed persistence classes contained in the root of the persistence unit<br clear="none">
  (unless the <strong>exclude-unlisted-classes</strong> element is specified)</li></ul>


<p>In the Java SE environment, the following rules and recommendations are required to be followed.</p>
<ul><li>The <strong>class</strong> element is used to list a managed persistence class. A list of all named managed persistence classes must be specified in Java SE environments to insure portability.</li><li>Portable Java SE applications should not rely on the other mechanisms described here to specify the managed persistence classes of a persistence unit.</li><li>Persistence providers may also require that the set of entity classes that are to be managed must be fully enumerated in <strong>persistence.xml</strong>.</li></ul>


<p>The following procedure explains how managed persistence classes are searched.</p>
<ul><li>All classes contained in the root of the persistence unit are also searched for annotated managed persistence classes and any mapping metadata annotations found on them will be processed, or they will be mapped using the mapping annotation defaults.</li><li>If it is not intended that the annotated persistence classes contained in the root of the persistence unit be included in the persistence unit, the <strong>exclude-unlisted-classes</strong> element should be used.</li></ul>


<ul><li>The <strong>exclude-unlisted-classes</strong> element is not intended for use in Java SE environments.</li></ul>


<ul><li>The resulting set of entities managed by the persistence unit is the union of these sources, with the mapping metadata annotations (or annotation defaults) for any given class being overridden by the XML mapping information file if there are both annotations as well as XML mappings for that class.</li></ul>


<ul><li>The minimum portable level of overriding is at the level of the persistent field or property.</li></ul>


<ul><li>The classes and/or jars that are named as part of a persistence unit must be on the classpath. Referencing them from the <strong>persistence.xml</strong> file does not cause them to be placed on the classpath.</li></ul>


<ul><li>All classes must be on the classpath to ensure that entity managers from different persistence units that map the same class will be accessing the same identical class.</li></ul>


<p>The following XML fragment illustrate the use of <strong>class</strong> element.</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;persistence-unit name=&quot;AccountUnit&quot; transaction-type=&quot;JTA&quot;&gt;
  &lt;description&gt;ContainerManagedJPA&lt;/description&gt;
  &lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
  &lt;jta-data-source&gt;AccountDS&lt;/jta-data-source&gt;
  &lt;class&gt;sample.jpa.Account&lt;/class&gt;
  &lt;class&gt;sample.jpa.Person&lt;/class&gt;
  ...
  ...
&lt;/persistence-unit&gt; 
]]></script>
</div></div>
<p>The <strong>sample.jpa.Account</strong> and <strong>sample.jpa.Person</strong> are explicitly mentioned as managed persistence classes in the <strong>persistence.xml</strong>.</p></div></div>

<h4 id="persistence.xml-&lt;exclude-unlisted-classes&gt;">&lt;exclude-unlisted-classes&gt;</h4>
<p>When set to true, only listed classes and jars will be scanned for persistent classes. Otherwise the enclosing                     jar or directory will also be scanned. This is not applicable to Java SE persistence units. The following XML fragment illustrate the use of <strong>exclude-unlisted-classes</strong> element.</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;persistence-unit name=&quot;AccountUnit&quot; transaction-type=&quot;JTA&quot;&gt;
  &lt;description&gt;ContainerManagedJPA&lt;/description&gt;
  &lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
  &lt;jta-data-source&gt;AccountDS&lt;/jta-data-source&gt;
  &lt;jar-file&gt;account-entities.jar&lt;/jar-file&gt;
  &lt;class&gt;sample.jpa.Account&lt;/class&gt;
  &lt;class&gt;sample.jpa.Person&lt;/class&gt;
  &lt;exclude-unlisted-classes&gt;true&lt;/exclude-unlisted-classes&gt;
  ...
  ...
 &lt;/persistence-unit&gt; 
]]></script>
</div></div>
<p> Only <strong>account-entities.jar</strong>, <strong>sample.jpa.Account</strong> and <strong>sample.jpa.Person</strong> are scanned for managed persistence classes.</p></div></div>

<h4 id="persistence.xml-&lt;properties&gt;">&lt;properties&gt;</h4>
<ul><li>The <strong>properties</strong> element is used to specify vendor-specific properties that apply to the persistence unit and its entity manager factory configuration.</li><li>If a persistence provider does not recognize properties (other than those defined by this specification), the provider will ignore those properties.</li><li>Vendors will use vendor namespaces for properties.</li></ul>


<p>The following XML fragment illustrate the use of <strong>properties</strong> element. The specified properties and the values enable JPA to connect to <strong>VehicleDB</strong> database created in the embedded derby of geronimo server.</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;persistence-unit name=&quot;Inheritence&quot;&gt;
 &lt;description&gt;Single Table Inheritence example&lt;/description&gt;
 &lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
 &lt;class&gt;com.jpa.RoadVehicle&lt;/class&gt;
 &lt;class&gt;com.jpa.Car&lt;/class&gt;
 &lt;class&gt;com.jpa.Coupe&lt;/class&gt;
 &lt;class&gt;com.jpa.Motorcycle&lt;/class&gt;
 &lt;class&gt;com.jpa.Roadster&lt;/class&gt;
 &lt;properties&gt;
   &lt;property name=&quot;openjpa.ConnectionURL&quot; value=&quot;jdbc:derby:VehicleDB&quot; /&gt;
   &lt;property name=&quot;openjpa.ConnectionDriverName&quot; value=&quot;org.apache.derby.jdbc.EmbeddedDriver&quot; /&gt;
   &lt;property name=&quot;ConnectionUserName&quot; value=&quot;app&quot; /&gt;
   &lt;property name=&quot;openjpa.jdbc.SynchronizeMappings&quot; value=&quot;false&quot; /&gt;
 &lt;/properties&gt;
&lt;/persistence-unit&gt;
]]></script>
</div></div>
<p>The above properties are specific to OpenJPA provider. The OpenJPA provider reads these properties and creates appropriate <strong>EntityManagerFactory</strong>. The properties supported by OpenJPA is at this <a shape="rect" class="external-link" href="http://openjpa.apache.org/builds/1.1.0/apache-openjpa-1.1.0/docs/manual/manual.html#ref_guide_conf_openjpa">link</a></p></div></div>

<h1 id="persistence.xml-JPAconfigurationandgeronimoplans">JPA configuration and geronimo plans</h1>
<p>The <strong>persistence.xml</strong> file can declare more than one <strong>persistence-units</strong>. A <strong>persistence-unit</strong> declaration in the <strong>persistence.xml</strong> can be overridden in geronimo plans (<strong>geronimo-web.xml</strong> or <strong>openejb-jar.xml</strong>) as follows. </p>

<ul><li>If a <strong>persistence-unit</strong> is declared in both in <strong>persistence.xml</strong> as well as in a geronimo plan<br clear="none">
 (<strong>geronimo-web.xml</strong> or <strong>openejb-jar.xml</strong>), the declaration in the geronimo plan will override the declaration <br clear="none">
 in the <strong>persistence.xml</strong></li></ul>


<ul><li>The below example illustrate the overriding feature in geronimo.</li></ul>


<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot;
 xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; version=&quot;1.0&quot;
 xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/persistence  
 http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd&quot;&gt;

 &lt;persistence-unit name=&quot;AccountUnit&quot; transaction-type=&quot;JTA&quot;&gt;
  &lt;description&gt;ContainerManagedJPA&lt;/description&gt;
  &lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
  &lt;jta-data-source&gt;AccountDS&lt;/jta-data-source&gt;
  &lt;class&gt;sample.jpa.Account&lt;/class&gt;
  &lt;class&gt;sample.jpa.Person&lt;/class&gt;
 &lt;/persistence-unit&gt;

&lt;/persistence&gt;
]]></script>
</div></div>

<p>The <strong>AccountUnit</strong> can be overridden in <strong>openejb-jar.xml</strong> as follows.</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;openejb-jar xmlns=&quot;http://openejb.apache.org/xml/ns/openejb-jar-2.2&quot; 
 xmlns:naming=&quot;http://geronimo.apache.org/xml/ns/naming-1.2&quot; 
 xmlns:sec=&quot;http://geronimo.apache.org/xml/ns/security-2.0&quot; 
 xmlns:sys=&quot;http://geronimo.apache.org/xml/ns/deployment-1.2&quot;&gt;
 
 &lt;sys:environment&gt;

  &lt;sys:moduleId&gt;
   &lt;sys:groupId&gt;ContainerManagedJPA&lt;/sys:groupId&gt;
   &lt;sys:artifactId&gt;EJB&lt;/sys:artifactId&gt;
   &lt;sys:version&gt;1.0&lt;/sys:version&gt;
   &lt;sys:type&gt;car&lt;/sys:type&gt;
  &lt;/sys:moduleId&gt;

 &lt;dependencies&gt;
  &lt;dependency&gt;
   &lt;groupId&gt;console.dbpool&lt;/groupId&gt;
   &lt;artifactId&gt;AccountDS1&lt;/artifactId&gt;
  &lt;/dependency&gt;
 &lt;/dependencies&gt;

 &lt;/sys:environment&gt;

 &lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot;&gt;
  &lt;persistence-unit name=&quot;AccountUnit&quot; transaction-type=&quot;JTA&quot;&gt;
   &lt;description&gt;ContainerManagedJPA&lt;/description&gt;
   &lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
   &lt;jta-data-source&gt;AccountDS1&lt;/jta-data-source&gt;
   &lt;class&gt;sample.jpa.Account&lt;/class&gt;
   &lt;class&gt;sample.jpa.Person&lt;/class&gt;
  &lt;/persistence-unit&gt;
 &lt;/persistence&gt;
 
 &lt;enterprise-beans/&gt;

&lt;/openejb-jar&gt;
]]></script>
</div></div>

<p>The <strong>AccountUnit</strong> is overridden in <strong>openejb-jar.xml</strong> to use the JTA datasource <strong>AccountDS1</strong>. In the <strong>persistence.xml</strong>, it was declared to use the JTA datasource <strong>AccountDS</strong>.</p>

<p>Similarly, the <strong>persistence-units</strong> can be overridden in <strong>geronimo-web.xml</strong> right after the <strong>&lt;sys:environment&gt;</strong> declaration.</p>
</div></div></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : persistence.xml';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
