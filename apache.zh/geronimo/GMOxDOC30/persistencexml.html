<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=0">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="persistence.xml">
    <meta name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi persistence.xml">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2010-05-11">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0文档：persistence.xml</title>
  </head>

  <body  onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">主页</a> > <a href="documentation.html">文档</a> > <a href="creating-deployment-plans.html">创建部署计划</a> > <a href="understanding-deployment-plans.html">了解部署计划</a> > <a href="persistencexml.html">persistence.xml</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo v3.0</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">persistence.xml</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645410"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645410">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645410"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645410">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645410"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645410">新增新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><div class="toc-macro client-side-toc-macro" data-headerelements="H1,H2,H3,H4,H5,H6,H7"></div>
<h1 id="persistence.xml-Overview">总览</h1>
<p><strong>persistence.xml</strong>文件描述了持久性单元。它是使用Java Persistence API（JPA）进行持久化的部署描述符文件。用于声明以下内容。</p>

<ul><li>托管持久性类。<br clear="none">被管理的类，例如，那些使用<strong><strong>@Entity，@Embeddable</strong></strong>或注释的<br clear="none">
  <strong>@MappedSuperclass</strong> 。</li><li>指定对象/关系映射。<br clear="none">JPA提供了几种将Java类映射到关系数据库中的表的机制。</li><li>实体管理器和实体管理器工厂类的配置信息。</li></ul>


<p><strong>persistence.xml</strong>文件位于持久性单元根目录的<strong>META-INF</strong>目录中。通过以下方式提供对象/关系映射信息。</p>

<ul><li>托管持久性类的注释</li><li>持久性单元根目录中包含一个或多个XML文件</li><li>在类路径上持久性单元根之外的一个或多个XML文件，并从<br clear="none">
  <strong>persistence.xml</strong>或这些的组合。</li></ul>


<p>在Java EE中，持久性单元的根可以是以下之一</p>

<ul><li>EJB-JAR文件</li><li>WAR文件的<strong>WEB-INF / classes</strong>目录</li><li>WAR文件的<strong>WEB-INF / lib</strong>目录中的jar文件</li><li>EAR根目录中的jar文件</li><li>EAR库目录中的jar文件</li><li>应用程序客户端jar文件</li></ul>


<p>托管持久性类的位置可以如下。</p>

<ul><li>在持久性单元的根目录内。</li><li>可以通过在<strong>persistence.xml中</strong>通过命名类，归档文件或映射XML文件来指定<br clear="none">可以在应用程序类路径上访问。</li><li>以上方法的一些组合。</li></ul>


<h2 id="persistence.xml-Packaging">打包</h2>
<p><strong>persistence.xml</strong>文件位于持久性单元根目录的<strong>META-INF</strong>目录中。</p>

<h1 id="persistence.xml-Schema">架构图</h1>
<p><strong>persistence.xml</strong>的模式位于此<a shape="rect" class="external-link" href="http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd" rel="nofollow">链接</a> 。Apache geronimo使用<a shape="rect" class="external-link" href="http://openjpa.apache.org/">OpenJPA</a>作为JPA提供程序。</p>

<h2 id="persistence.xml-Schematoplevelelements">架构顶层元素</h2>
<p><strong>persistence.xml</strong>的顶级元素是<strong><persistence></persistence></strong> 。以下各节说明了<strong><persistence></persistence></strong>元件。典型的<strong>persistence.xml</strong>如下所示。</p>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>persistence.xml</b></div><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot;
 xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; version=&quot;1.0&quot;
 xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/persistence 
 http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd&quot;&gt;
 ...
 ...
&lt;/persistence&gt;
]]></script>
</div></div>

<h3 id="persistence.xml-<persistence-unit>"><persistence-unit></persistence-unit></h3>
<p>的<strong><persistence></persistence></strong>元素可以包含多个<strong><persistence-unit></persistence-unit></strong>元素，每个元素描述一个持久性单元。<strong>持久性单元</strong>元素由以下属性组成。</p>

<h4 id="persistence.xml-Attribute:name">属性：名称</h4>
<p>此属性是必需的。<strong>name</strong>属性定义持久性单元的名称。它唯一地标识一个持久性上下文。此名称用于标识<strong>PersistenceContext</strong>和<strong>PersistenceUnit</strong>批注所引用的持久性单元。创建实体管理器工厂对象时也会引用它。以下注释说明了应用程序中的用法。</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>1。下面的注释注入与<strong>Tutorial</strong>持久性单元相对应的<strong>EntityManager</strong>对象<br clear="none">到变量<strong>em</strong> 。</p>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
  @PersistenceContext(unitName=&quot;Tutorial&quot;)
  private EntityManager em; 
]]></script>
</div></div>
<p>2。下面的注释将注入与<strong>Account</strong>对应的<strong>EntityManagerFactory</strong>对象 <br clear="none">变量<strong>emf的</strong>持久性单元。从<strong>emf</strong>可以创建<strong>EntityManager</strong>对象。</p>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
@PersistenceUnit(unitName=&quot;Account&quot;)
private EntityManagerFactory emf;
]]></script>
</div></div></div></div>

<h4 id="persistence.xml-Attribute:transaction-type">属性：交易类型</h4>
<p>此属性可以具有以下值。</p>

<ul><li><strong>日本旅游协会</strong></li><li><strong>RESOURCE_LOCAL</strong></li></ul>


<p><strong>transaction-type</strong>属性用于指定实体管理器工厂为持久性单元提供的实体管理器必须是JTA实体管理器还是资源本地实体管理器。该元素的值为<strong>JTA</strong>或<strong>RESOURCE_LOCAL</strong> 。 JTA的<strong>事务类型</strong>假定将提供JTA数据源。它可以由<strong>jta-data-source</strong>元素指定，也可以由容器提供。通常，在Java EE环境中， <strong>事务类型</strong> <strong>RESOURCE_LOCAL</strong>假定将提供非JTA数据源。在Java EE环境中，如果未指定此元素，则默认值为<strong>JTA</strong> 。在Java SE环境中，如果未指定此元素，则可以采用默认值<strong>RESOURCE_LOCAL</strong> 。</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>1。以下声明适用于名为<strong>Account</strong>的持久性单元，事务类型为<strong>JTA</strong> 。</p>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;persistence-unit name=&quot;Account&quot; transaction-type=&quot;JTA&quot;&gt;
...
...
&lt;/persistence-unit&gt;
]]></script>
</div></div>
<p>2。以下声明适用于名为<strong>Account</strong>的持久性单元，事务类型为<br clear="none">
    <strong>RESOURCE_LOCAL</strong> 。</p>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[ 
&lt;persistence-unit name=&quot;Account&quot; transaction-type=&quot;RESOURCE_LOCAL&quot;&gt;
...
...
&lt;/persistence-unit&gt;
]]></script>
</div></div>

<p>请注意，有两种类型的实体管理器和相应的持久性上下文。这些是容器管理的实体管理器和应用程序管理的实体管理器。</p>

<p>容器管理的实体管理器是其持久性上下文由容器管理的管理器。持久性上下文沿活动事务传播。容器管理的实体管理器的持久性范围默认为事务。实体管理器的事务类型始终为<strong>JTA</strong> 。 <strong>EntityManager</strong>对象由容器注入到应用程序中。</p>

<p>应用程序管理的实体管理器是其持久性上下文由应用程序管理的管理器。持久性上下文不会沿事务传播。即使当前事务完成后，持久性上下文也将处于活动状态。实体管理器的事务类型默认为<strong>RESOURCE_LOCAL</strong> 。<strong>EntityManager</strong>对象应在应用程序中使用<strong>EntityManagerFactory的</strong>对象被创建。</p></div></div>

<h4 id="persistence.xml-<description>"><description></description></h4>
<p>description元素提供有关持久性单元的可选描述性信息。</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>1。以下XML内容说明了该元素的用法。</p>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[ 
&lt;persistence-unit name=&quot;Account&quot; transaction-type=&quot;JTA&quot;&gt;
 &lt;description&gt;Entities related to bank accounts&lt;/description&gt;
 ...                 
 ...
&lt;/persistence-unit&gt;
]]></script>
</div></div></div></div>

<h4 id="persistence.xml-<provider>"><provider></provider></h4>
<p>provider元素指定持久性提供者的名称<code>javax.persistence.spi.PersistenceProvider</code>类。如果应用程序依赖于所使用的特定持久性提供程序，则必须指定provider元素。提供者类为此持久性单元提供EntityManagers。</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>1。以下XML内容说明了该元素的用法。</p>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;persistence-unit name=&quot;Account&quot; transaction-type=&quot;JTA&quot;&gt;
&lt;description&gt;Entities related to bank accounts&lt;/description&gt;
&lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
...
...
&lt;/persistence-unit&gt;
]]></script>
</div></div>
<p>对于OpenJPA，提供程序的值为<strong>org.apache.openjpa.persistence。PersistenceProviderImpl</strong> 。</p></div></div>

<h4 id="persistence.xml-<jta-data-source>,<non-jta-data-source>"><jta-data-source>，<non-jta-data-source></non-jta-data-source></jta-data-source></h4>
<p>在Java EE环境中，jta-data-source和non-jta-data-source元素用于分别指定持久性提供程序将使用的JTA和非JTA数据源的全局JNDI名称。如果未指定，则部署者必须在部署时指定JTA数据源，或者必须由容器提供JTA数据源，并且将创建一个JTA EntityManagerFactory与其对应。这些元素在本地环境中命名数据源。这些名称的格式/语法以及指定名称的能力是特定于产品的。在Java SE环境中，可以使用这些元素，也可以通过其他方式指定数据源信息。取决于提供者的要求。</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>在geronimo服务器中，用户可以在来自各种供应商（如DB2，Oracle，MySQL，MS-SQLServer等）的数据库上部署数据源（数据库连接池）。创建数据源时，用户必须在部署计划中指定数据源名称。给数据源的名称将在<strong>jta-data-source</strong>和<strong>non-jta-data-source</strong>元素中提供。下面的XML片段说明了用法。</p>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;persistence-unit name=&quot;Account&quot; transaction-type=&quot;JTA&quot;&gt;
  &lt;description&gt;ContainerManagedJPA&lt;/description&gt;
  &lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
  &lt;jta-data-source&gt;AccountDB2DataSource&lt;/jta-data-source&gt;
  ...
  ...
&lt;/persistence-unit&gt;
]]></script>
</div></div></div></div>

<p><strong>非jta数据源</strong>必须是不支持事务的数据源。可以使用以下命令将其部署在geronimo服务器上。 <strong><no-transaction></no-transaction></strong>元素代替<strong><local-transaction></local-transaction></strong>要么<strong><xa-transaction></xa-transaction></strong>如下图所示。</p>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;connector xmlns=&quot;http://geronimo.apache.org/xml/ns/j2ee/connector-1.2&quot;&gt;
...
...
 &lt;resourceadapter&gt;
 ...
 ...
  &lt;connectionmanager&gt;
   &lt;local-transaction/&gt;
    &lt;no-transaction/&gt;
     &lt;max-size&gt;10&lt;/max-size&gt;
     &lt;min-size&gt;0&lt;/min-size&gt;
     &lt;match-one/&gt;
    &lt;/single-pool&gt;
  &lt;/connectionmanager&gt;
 ...
 ...
 &lt;/resourceadapter&gt;
...
...
&lt;/connector&gt;
]]></script>
</div></div>

<h4 id="persistence.xml-<mapping-file>"><mapping-file></mapping-file></h4>
<p>对象/关系映射XML文件包含其中列出的类的映射信息。可以按如下方式提供映射文件。</p>

<ul><li>可以在<strong>META-INF</strong>目录的根目录中指定名为<strong>orm.xml的</strong>对象/关系映射XML文件。<br clear="none">持久性单元。</li></ul>


<ul><li>可以在任何jar文件的<strong>META-INF</strong>目录中指定名为<strong>orm.xml的</strong>对象/关系映射XML文件<br clear="none">由<strong>persistence.xml</strong>引用。</li></ul>


<ul><li>另外，持久性单元的映射文件元素可以引用其他映射文件。<br clear="none">元素，并且可以出现在类路径上的任何位置。</li></ul>


<p>持久性提供程序<strong>会将orm.xml</strong>文件或其他映射文件作为资源加载。如果指定了映射文件，则将使用在映射文件中指定的类和映射信息。如果指定了多个映射文件（可能包括一个或多个<strong>orm.xml</strong>文件），则通过组合来自所有文件的映射来获得结果映射。如果在单个持久性单元中引用的多个映射文件（包括任何<strong>orm.xml</strong>文件）包含任何给定类的重叠映射信息，则结果是不确定的。下面的XML片段说明了用法。</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;persistence-unit name=&quot;Tutorial&quot; transaction-type=&quot;RESOURCE_LOCAL&quot;&gt;
&lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
&lt;non-jta-data-source&gt;ProductDS-nonJTA&lt;/non-jta-data-source&gt;
&lt;mapping-file&gt;object_mappings.xml&lt;/mapping-file&gt;
     ...
     ...
&lt;/persistence-unit&gt;
]]></script>
</div></div>
<p>object_mappings.xml文件必须位于应用程序的类路径中。</p></div></div>

<h4 id="persistence.xml-<jar-file>"><jar-file></jar-file></h4>
<p>除了在<strong>映射文件</strong>元素中指定的映射文件之外，还可以使用<strong>jar文件</strong>元素来指定一个或多个JAR文件。如果指定，JPA将按以下方式处理这些jar文件。</p>

<ul><li>将在这些JAR文件中搜索托管的持久性类，并将处理在它们上找到的所有映射元数据注释。</li></ul>


<ul><li>它们将使用JPA规范定义的映射注释默认值进行映射。JAR文件是相对于持久性单元的根目录指定的。</li></ul>


<ul><li>除了JAR文件和映射文件外，还可以指定一个命名的托管持久性类列表（使用下面说明的<strong>类</strong> xml元素）。在这些类上找到的任何映射元数据注释都将被处理，或者将使用映射注释默认值进行映射。以下XML片段说明了用法。
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;persistence-unit name=&quot;Tutorial&quot; transaction-type=&quot;RESOURCE_LOCAL&quot;&gt;
 &lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
 &lt;jta-data-source&gt;AccountDS&lt;/jta-data-source&gt;
 &lt;mapping-file&gt;account_mappings.xml&lt;/mapping-file&gt;
 &lt;jar-file&gt;account-entities.jar&lt;/jar-file&gt;
  ...
  ...
&lt;/persistence-unit&gt;
]]></script>
</div></div>
<p><strong>account-entities.jar</strong>位于持久性单元的根目录。</p></div></div></li></ul>


<h4 id="persistence.xml-<Class>"><class></class></h4>
<p>以下类必须隐式或显式表示为托管持久性类<br clear="none">包含在一个持久性单元中。</p>
<ul><li>实体类</li><li>可嵌入类</li><li>映射的超类。</li></ul>


<p>由持久性单元管理的一组托管持久性类是通过使用一个或多个定义的<br clear="none">以下更多：</p>
<ul><li>一个或多个对象/关系映射XML文件（在上面的“ <strong>映射文件”</strong>部分中说明）。</li><li>一个或多个jar文件，将在上面的<strong>jar文件</strong>一节中解释的类中进行搜索。</li><li>类的显式列表（使用<strong>class</strong>元素）。</li><li>包含在持久性单元根中的带注释的托管持久性类<br clear="none">（除非指定了<strong>exclude-unlist-classes</strong>元素）</li></ul>


<p>在Java SE环境中，需要遵循以下规则和建议。</p>
<ul><li><strong>class</strong>元素用于列出托管的持久性类。必须在Java SE环境中指定所有命名的托管持久性类的列表，以确保可移植性。</li><li>可移植Java SE应用程序不应依赖此处描述的其他机制来指定持久性单元的托管持久性类。</li><li>持久性提供程序还可能要求必须在<strong>persistence.xml中</strong>完全枚举要管理的实体类集。</li></ul>


<p>以下过程说明了如何搜索托管持久性类。</p>
<ul><li>还将在持久性单元根目录中包含的所有类中搜索带注释的托管持久性类，并且将处理在它们上找到的任何映射元数据注释，或者将使用映射注释缺省值对其进行映射。</li><li>如果不打算将包含在持久性单元根中的带注释的持久性类包括在持久性单元中，则应使用<strong>exclude-unlisted-classes</strong>元素。</li></ul>


<ul><li><strong>exclude-unlisted-classes</strong>元素不适用于Java SE环境。</li></ul>


<ul><li>持久性单元管理的结果实体集是这些源的联合，如果同时存在针对XML的注释和XML映射，则任何给定类的映射元数据注释（或注释默认值）都将被XML映射信息文件覆盖。那堂课</li></ul>


<ul><li>覆盖的最小可移植级别是持久字段或属性的级别。</li></ul>


<ul><li>命名为持久性单元一部分的类和/或jar必须在类路径上。从<strong>persistence.xml</strong>文件中引用它们不会导致将它们放置在类路径上。</li></ul>


<ul><li>所有类都必须在类路径上，以确保来自映射同一类的不同持久性单元的实体管理器将访问同一相同类。</li></ul>


<p>以下XML片段说明了<strong>class</strong>元素的用法。</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;persistence-unit name=&quot;AccountUnit&quot; transaction-type=&quot;JTA&quot;&gt;
  &lt;description&gt;ContainerManagedJPA&lt;/description&gt;
  &lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
  &lt;jta-data-source&gt;AccountDS&lt;/jta-data-source&gt;
  &lt;class&gt;sample.jpa.Account&lt;/class&gt;
  &lt;class&gt;sample.jpa.Person&lt;/class&gt;
  ...
  ...
&lt;/persistence-unit&gt; 
]]></script>
</div></div>
<p><strong>sample.jpa。帐户</strong>和<strong>sample.jpa。在<strong>persistence.xml</strong>中明确将Person</strong>称为托管持久性类。</p></div></div>

<h4 id="persistence.xml-<exclude-unlisted-classes>"><exclude-unlisted-classes></exclude-unlisted-classes></h4>
<p>设置为true时，将仅扫描列出的类和jar中的持久类。否则，还将扫描封闭的jar或目录。这不适用于Java SE持久性单元。以下XML片段说明了<strong>exclude-unlisted-classes</strong>元素的用法。</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;persistence-unit name=&quot;AccountUnit&quot; transaction-type=&quot;JTA&quot;&gt;
  &lt;description&gt;ContainerManagedJPA&lt;/description&gt;
  &lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
  &lt;jta-data-source&gt;AccountDS&lt;/jta-data-source&gt;
  &lt;jar-file&gt;account-entities.jar&lt;/jar-file&gt;
  &lt;class&gt;sample.jpa.Account&lt;/class&gt;
  &lt;class&gt;sample.jpa.Person&lt;/class&gt;
  &lt;exclude-unlisted-classes&gt;true&lt;/exclude-unlisted-classes&gt;
  ...
  ...
 &lt;/persistence-unit&gt; 
]]></script>
</div></div>
<p>仅<strong>account-entities.jar</strong>和<strong>sample.jpa。帐户</strong>和<strong>sample.jpa。人</strong>被扫描管理的持久化类。</p></div></div>

<h4 id="persistence.xml-<properties>"><properties></properties></h4>
<ul><li><strong>properties</strong>元素用于指定适用于持久性单元及其实体管理器工厂配置的特定于供应商的属性。</li><li>如果持久性提供程序无法识别属性（本规范定义的属性除外），则提供程序将忽略这些属性。</li><li>供应商将使用供应商名称空间作为属性。</li></ul>


<p>以下XML片段说明了<strong>properties</strong>元素的用法。指定的属性和值使JPA可以连接到在<strong>Geronimo</strong>服务器的嵌入式derby中创建的<strong>VehicleDB</strong>数据库。</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;persistence-unit name=&quot;Inheritence&quot;&gt;
 &lt;description&gt;Single Table Inheritence example&lt;/description&gt;
 &lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
 &lt;class&gt;com.jpa.RoadVehicle&lt;/class&gt;
 &lt;class&gt;com.jpa.Car&lt;/class&gt;
 &lt;class&gt;com.jpa.Coupe&lt;/class&gt;
 &lt;class&gt;com.jpa.Motorcycle&lt;/class&gt;
 &lt;class&gt;com.jpa.Roadster&lt;/class&gt;
 &lt;properties&gt;
   &lt;property name=&quot;openjpa.ConnectionURL&quot; value=&quot;jdbc:derby:VehicleDB&quot; /&gt;
   &lt;property name=&quot;openjpa.ConnectionDriverName&quot; value=&quot;org.apache.derby.jdbc.EmbeddedDriver&quot; /&gt;
   &lt;property name=&quot;ConnectionUserName&quot; value=&quot;app&quot; /&gt;
   &lt;property name=&quot;openjpa.jdbc.SynchronizeMappings&quot; value=&quot;false&quot; /&gt;
 &lt;/properties&gt;
&lt;/persistence-unit&gt;
]]></script>
</div></div>
<p>以上属性特定于OpenJPA提供程序。OpenJPA提供程序读取这些属性并创建适当的<strong>EntityManagerFactory</strong> 。OpenJPA支持的属性在此<a shape="rect" class="external-link" href="http://openjpa.apache.org/builds/1.1.0/apache-openjpa-1.1.0/docs/manual/manual.html#ref_guide_conf_openjpa">链接上</a></p></div></div>

<h1 id="persistence.xml-JPAconfigurationandgeronimoplans">JPA配置和geronimo计划</h1>
<p><strong>persistence.xml</strong>文件可以声明多个<strong>persistence-units</strong> 。可以在geronimo计划（ <strong>geronimo-web.xml</strong>或<strong>openejb-jar.xml</strong> ）中覆盖<strong>persistence.xml</strong>中的<strong>持久</strong> <strong>性单元</strong>声明。</p>

<ul><li>如果在<strong>persistence.xml</strong>和geronimo计划中都声明了<strong>持久性单元</strong><br clear="none">（ <strong>geronimo-web.xml</strong>或<strong>openejb-jar.xml</strong> ），geronimo计划中的声明将覆盖该声明<br clear="none">在<strong>persistence.xml中</strong></li></ul>


<ul><li>以下示例说明了geronimo中的重写功能。</li></ul>


<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot;
 xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; version=&quot;1.0&quot;
 xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/persistence  
 http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd&quot;&gt;

 &lt;persistence-unit name=&quot;AccountUnit&quot; transaction-type=&quot;JTA&quot;&gt;
  &lt;description&gt;ContainerManagedJPA&lt;/description&gt;
  &lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
  &lt;jta-data-source&gt;AccountDS&lt;/jta-data-source&gt;
  &lt;class&gt;sample.jpa.Account&lt;/class&gt;
  &lt;class&gt;sample.jpa.Person&lt;/class&gt;
 &lt;/persistence-unit&gt;

&lt;/persistence&gt;
]]></script>
</div></div>

<p>可以如下在<strong>openejb-jar.xml中</strong>覆盖<strong>AccountUnit</strong> 。</p>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;openejb-jar xmlns=&quot;http://openejb.apache.org/xml/ns/openejb-jar-2.2&quot; 
 xmlns:naming=&quot;http://geronimo.apache.org/xml/ns/naming-1.2&quot; 
 xmlns:sec=&quot;http://geronimo.apache.org/xml/ns/security-2.0&quot; 
 xmlns:sys=&quot;http://geronimo.apache.org/xml/ns/deployment-1.2&quot;&gt;
 
 &lt;sys:environment&gt;

  &lt;sys:moduleId&gt;
   &lt;sys:groupId&gt;ContainerManagedJPA&lt;/sys:groupId&gt;
   &lt;sys:artifactId&gt;EJB&lt;/sys:artifactId&gt;
   &lt;sys:version&gt;1.0&lt;/sys:version&gt;
   &lt;sys:type&gt;car&lt;/sys:type&gt;
  &lt;/sys:moduleId&gt;

 &lt;dependencies&gt;
  &lt;dependency&gt;
   &lt;groupId&gt;console.dbpool&lt;/groupId&gt;
   &lt;artifactId&gt;AccountDS1&lt;/artifactId&gt;
  &lt;/dependency&gt;
 &lt;/dependencies&gt;

 &lt;/sys:environment&gt;

 &lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot;&gt;
  &lt;persistence-unit name=&quot;AccountUnit&quot; transaction-type=&quot;JTA&quot;&gt;
   &lt;description&gt;ContainerManagedJPA&lt;/description&gt;
   &lt;provider&gt;org.apache.openjpa.persistence.PersistenceProviderImpl&lt;/provider&gt;
   &lt;jta-data-source&gt;AccountDS1&lt;/jta-data-source&gt;
   &lt;class&gt;sample.jpa.Account&lt;/class&gt;
   &lt;class&gt;sample.jpa.Person&lt;/class&gt;
  &lt;/persistence-unit&gt;
 &lt;/persistence&gt;
 
 &lt;enterprise-beans/&gt;

&lt;/openejb-jar&gt;
]]></script>
</div></div>

<p>在<strong>openejb-jar.xml中</strong>重写<strong>AccountUnit</strong>以使用JTA数据源<strong>AccountDS1</strong> 。在<strong>persistence.xml中</strong> ，声明使用JTA数据源<strong>AccountDS</strong> 。</p>

<p>同样，可以在<strong>geronimo-web.xml中</strong>覆盖<strong>持久性单元</strong> ， <strong><sys:environment></sys:environment></strong>宣言。</p>
</div></div></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : persistence.xml';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2013，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  

</body></html>