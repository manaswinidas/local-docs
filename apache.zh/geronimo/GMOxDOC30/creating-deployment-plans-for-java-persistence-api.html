<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Creating deployment plans for Java Persistence API" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Creating deployment plans for Java Persistence API" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>

  <link href='http://geronimo.apache.org/resources/highlighter/styles/shCoreGeronimo.css' rel='stylesheet' type='text/css' />
  <link href='http://geronimo.apache.org/resources/highlighter/styles/shThemeGeronimo.css' rel='stylesheet' type='text/css' />
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shCore.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushJava.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushXml.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushPlain.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushBash.js' type='text/javascript'></script>
  
  <script type="text/javascript">
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
  </script>

    <title>Apache Geronimo v3.0 Documentation: Creating deployment plans for Java Persistence API</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="creating-deployment-plans.html">Creating deployment plans</a>&nbsp;&gt;&nbsp;<a href="creating-deployment-plans-for-applications.html">Creating deployment plans for applications</a>&nbsp;&gt;&nbsp;<a href="creating-deployment-plans-for-java-persistence-api.html">Creating deployment plans for Java Persistence API</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Creating deployment plans for Java Persistence API</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645411">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645411">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645411">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645411">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645411">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645411">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent">

<h1 id="CreatingdeploymentplansforJavaPersistenceAPI-JavaPersistenceAPI">Java Persistence API </h1>
<p>The Java Persistence API is a new programming model under EJB3.0 specification (JSR220) for the management of persistence and object/relational mapping with Java EE and Java SE. With JPA, developers can easily develop java applications that perform operations on relational database management systems using Java objects and mapping. In that way, java applications developed using JPA are not only portable across different platforms, but also applications can be easily developed using simple yet powerful programming model provided by JPA. This greatly improves application maintainability against ever changing database world. JPA insulates applications from all the complexity and non-portable boilerplate code involved in database connectivity and operations. Apache geronimo uses <a shape="rect" class="external-link" href="http://openjpa.apache.org/">OpenJPA</a> for providing Java Persistence API to Java EE applications deployed in the server. Below sections illustrate developing applications using JPA and how to write various deployment descriptors and plans for Apache Geronimo.</p>

<p>The document is organized as follows.</p>
<style type="text/css">/*<![CDATA[*/
div.rbtoc1572612979696 {padding: 0px;}
div.rbtoc1572612979696 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1572612979696 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class="toc-macro rbtoc1572612979696">
<ul class="toc-indentation"><li><a shape="rect" href="#CreatingdeploymentplansforJavaPersistenceAPI-JavaPersistenceAPI">Java Persistence API</a>
<ul class="toc-indentation"><li><a shape="rect" href="#CreatingdeploymentplansforJavaPersistenceAPI-ShareAccountsample">ShareAccount sample</a></li><li><a shape="rect" href="#CreatingdeploymentplansforJavaPersistenceAPI-Inheritancerelationshipinentities">Inheritance relationship in entities</a>
<ul class="toc-indentation"><li><a shape="rect" href="#CreatingdeploymentplansforJavaPersistenceAPI-Singledatabasetableperclasshierarchy">Single database table per class hierarchy</a></li></ul>
</li></ul>
</li></ul>
</div>

<h2 id="CreatingdeploymentplansforJavaPersistenceAPI-ShareAccountsample">ShareAccount sample</h2>
<p>This example illustrates developing an enterprise application that uses JPA for persistence. The database used is the embedded derby shipped with apache geronimo. Here, we present a persistence deployment descriptor (<code>persistence.xml</code>) that contains database connectivity and other information for the application. The <code>persistence.xml</code> is placed under META-INF/ directory of the application archive. The application contains an ejb module and a web module. EJB module uses a stateless session bean ShareHolderBean that uses JPA to perform database operations on the table SHAREACCOUNT in the ShareDB derby database. The SHAREACCOUNT table contains information about each shareholder along with the information regarding number shares he or she possesses currently in the account. The ShareHolderBean has methods that retrieve shareholder information, buy/sell shares of a particular shareholder, close the shareholder account etc. The web application has a servlet that looks up the ShareHolderBean and trigger the operations on it. The deployment descriptor information for the EJB module is provided using Java EE annotations in the respective bean classes. However, the persistence deployment descriptor information is provided using <code>META-INF/persistence.xml</code> file.</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>sample.jpa.ShareAccount.java</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package sample.jpa;
import java.io.Serializable;
import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.NamedQuery;
import javax.persistence.PostLoad;
import javax.persistence.PostUpdate;
import javax.persistence.PrePersist;
import javax.persistence.PreUpdate;
import javax.persistence.Version;
import javax.persistence.Table;

@Entity
@Table(name = "SHAREACCOUNT")
@NamedQuery(name="findThem", query="SELECT a FROM ShareAccount a")
public class ShareAccount implements Serializable {

   
    @Id
    private int shareAccountNo;
    private String ownerName;
    private int numberOfShares;
    @Version
    private int version;

    public ShareAccount(int shareAccountNo, 
                        String ownerName, 
                        int numberOfShares) {

      this.shareAccountNo = shareAccountNo;
      this.ownerName = ownerName;
      this.numberOfShares = numberOfShares;
        
    }

    public String toString() {
        return "Acc.# " + shareAccountNo +
               ", owner" + ownerName + 
               ", numberOfShares: " + 
                  numberOfShares + " $";
    }

    @PrePersist
    void prepersist() {
        System.out.println("pre persist!!");
    }
    
    @PreUpdate
    void preupdate() {
        System.out.println("pre update!!");
    }
    
    @PostUpdate
    void postupdate() {
        System.out.println("post update!!");
    }
    
    @PostLoad
    void postload() {
        System.out.println("post load!!");
    }

	public int getShareAccountNo() {
		return shareAccountNo;
	}

	public void setShareAccountNo(int shareAccountNo) {
		this.shareAccountNo = shareAccountNo;
	}

	public String getOwnerName() {
		return ownerName;
	}

	public void setOwnerName(String ownerName) {
		this.ownerName = ownerName;
	}

	public int getNumberOfShares() {
		return numberOfShares;
	}

	public void setNumberOfShares(int numberOfShares) {
		this.numberOfShares = numberOfShares;
	}

	public int getVersion() {
		return version;
	}

	public void setVersion(int version) {
		this.version = version;
	}
  
}

</pre>
</div></div>
<p>Observe various annotations that represent various aspects of the entity in the class.</p>

<p><strong>@Entity</strong> : Marks the ShareAccount class as an entity that can be persisted entirely in the database.<br clear="none">
<strong>@Table(name = "SHAREACCOUNT")</strong> : Designates the database table SHAREACCOUNT to the entity. The columns in the database table map to the attributes of ShareAccount entity. <br clear="none">
<strong>@Id</strong> : This annotation designates primary key to the entity. In this case, it is the shareAccountNo attribute of the entity class.<br clear="none">
<strong>@NamedQuery(name="findAccounts", query="SELECT a FROM ShareAccount a")</strong> : This annotation declares a named query by name <strong>findAccounts</strong>. This query retrieves all the share accounts from the database. Later in the ShareHolderBean, the NamedQuery is executed by using the name findAccounts.<br clear="none">
<strong>@Version</strong> : The version attribute of the ShareAccount entity. </p>

<p>The annotations placed around some of the methods of the ShareAccount class are @PrePersist, @PreUpdate, @PostUpdate and @PostLoad. These are the callback methods called by persistence container when corresponding database operations are performed on the entity.</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>sample.jpa.ShareHolder.java</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package sample.jpa;
import java.util.List;

public interface ShareHolder {

    public ShareAccount openShareAccount(int shareHolderNo, String ownerName, int numberOfShares);
    public ShareAccount findShareAccount(int shareHolderNo);
    public ShareAccount close(int shareHolderNo);
    public List&lt;ShareAccount&gt; listAccounts();
    public ShareAccount buyShares(int shareHolderNo, int numberOfShares);
    public int sellShares(int shareHolderNo, int numberOfShares);   
    public ShareAccount updateShareAccount(ShareAccount sa);
}
</pre>
</div></div>
<p>The <code>ShareHolder.java</code> is the remote interface of the stateless session bean.  </p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>sample.jpa.ShareHolderBean.java</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package sample.jpa;
import java.util.List;
import javax.ejb.Stateless;
import javax.ejb.Remote;
import javax.persistence.*;
import javax.ejb.TransactionManagement;
import javax.ejb.TransactionManagementType;

@Stateless
@TransactionManagement(TransactionManagementType.CONTAINER) 
@Remote(ShareHolder.class)
public class ShareHolderBean implements ShareHolder { 
  
    @PersistenceContext
    private EntityManager manager;

    public ShareAccount openShareAccount(int shareHolderNo, 
                                         String ownerName, 
                                         int numberOfShares){
    	
    	if (findShareAccount(shareHolderNo) == null){
    		ShareAccount sa = new ShareAccount
                                 (shareHolderNo,
                                  ownerName,
                                  numberOfShares);
        	manager.persist(sa);
        	return sa;
    	}
    	return null;
    }

    public ShareAccount findShareAccount(int shareHolderNo){
    	ShareAccount sa = manager.find(ShareAccount.class, 
                                       shareHolderNo);
    	return sa;
    }
    
    public ShareAccount close(int shareHolderNo){
    	ShareAccount sa = manager.find(ShareAccount.class, 
                                       shareHolderNo);   
    	if (sa != null)manager.remove(sa);
    	return sa;

    }
    
    public List&lt;ShareAccount&gt; listAccounts(){
        Query query = manager.createNamedQuery("findThem");
        return query.getResultList();
    }
    
    public ShareAccount buyShares(int shareHolderNo, 
                                  int numberOfShares){
    	ShareAccount sa = manager.find(ShareAccount.class, 
                                       shareHolderNo);
    	if(sa != null){
    		int new_balance = sa.getNumberOfShares() 
                                  + numberOfShares; 
    	    sa.setNumberOfShares(new_balance);  
    	}
    	return sa;
    }
    
    public int sellShares(int shareHolderNo, 
                          int numberOfShares){
        ShareAccount sa = manager.find(ShareAccount.class, 
                                       shareHolderNo);
        if(sa != null){
            if (numberOfShares &gt; sa.getNumberOfShares()){
            	return -2;
            }else{
            	int new_balance = sa.getNumberOfShares() 
                                  - numberOfShares;
            	sa.setNumberOfShares(new_balance);
            	manager.flush();
            	return numberOfShares;
            }
        }else{
        	return -1;
        }
    }
    
    public ShareAccount updateShareAccount(ShareAccount sa){
    	ShareAccount sa1 = 
                   findShareAccount(sa.getShareAccountNo());
    	if (sa1 != null){
    		manager.merge(sa1);
    		return sa1;
    	}
    	else return null;
    	 
    }

    
}
</pre>
</div></div>
<p>The <code>ShareHolderBean.java</code> is the stateless session bean that uses JPA to perform database operations using ShareAccount entity.</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>Persistence.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence xmlns="http://java.sun.com/xml/ns/persistence"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.0"
  xsi:schemaLocation="http://java.sun.com/xml/ns/persistence 
  http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"&gt;

 &lt;persistence-unit name="PersistencePU"&gt;
 &lt;description&gt;ShareHolder&lt;/description&gt;
 &lt;provider&gt;
  org.apache.openjpa.persistence.PersistenceProviderImpl
 &lt;/provider&gt;
 &lt;class&gt;sample.jpa.ShareAccount&lt;/class&gt;
 &lt;properties&gt;
  &lt;property name="openjpa.ConnectionURL" 
           value="jdbc:derby:ShareDB" /&gt;
  &lt;property name="openjpa.ConnectionDriverName" 
           value="org.apache.derby.jdbc.EmbeddedDriver" /&gt;
  &lt;property name="ConnectionUserName" value="app" /&gt;
  &lt;property name="openjpa.jdbc.SynchronizeMappings" value="false" /&gt;
 &lt;/properties&gt;
 &lt;/persistence-unit&gt;
 &lt;!--
 &lt;jta-data-source&gt;PhoneBookPool&lt;/jta-data-source&gt;
 &lt;non-jta-data-source&gt;PhoneBookPool&lt;/non-jta-data-source&gt;
 --&gt;
&lt;/persistence&gt;
</pre>
</div></div>
<p>The <code>Persistence.xml</code> is the persistence deployment descriptor for the ejb module. It provides database connection information and declares entity classes among other things. </p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>The default namespace of the above XML document is <a shape="rect" class="external-link" href="http://java.sun.com/xml/ns/persistence" rel="nofollow">http://java.sun.com/xml/ns/persistence</a>. The XML elements that do not have a namespace prefix belong to the default namespace.</p></div></div>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>sample.jpa.Test.java</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package sample.jpa;

import java.io.IOException;
import java.io.PrintWriter;
import java.util.List;

import javax.naming.Context;
import javax.naming.InitialContext;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class Test extends 
  javax.servlet.http.HttpServlet 
  implements javax.servlet.Servlet {
  
  static final long serialVersionUID = 1L;
   
   public Test() {
	super();
   }   	
	
   protected void doGet(HttpServletRequest request,
                  HttpServletResponse response) 
                  throws ServletException, 
                  IOException {
				
    PrintWriter out = response.getWriter();
	        
    try {
     java.util.Properties env = 
       new java.util.Properties();

     env.put(Context.INITIAL_CONTEXT_FACTORY
       ,"org.apache.openejb.client.RemoteInitialContextFactory"); 
     env.put(Context.PROVIDER_URL, 
             "ejbd://127.0.0.1:4201");
	    		
     Context ctx = new InitialContext(env);
     out.println("Looking up ShareHolderBean");

     ShareHolder shareHolder = (ShareHolder)
            ctx.lookup("ShareHolderBeanRemote");
	            
     out.println("Creating ShareAccount 1, 
                   Phani, 10");
	            
     ShareAccount sa = 
         shareHolder.openShareAccount(1,"phani", 10);
     if(sa == null){
	out.println("account could not be created.");
	out.println("May be, account already 
                            exists. Check the database.");
           	
     }
     else {
        out.println("Account is successfully created");
     }
     out.println("Looking up the ShareAccountNumber 1");
     sa = shareHolder.findShareAccount(1);
     out.println("Printing the details of ShareAccountNumber 1");
     printShareAccount(sa,out);
     out.println("");

     out.println("buying shares 100");
     sa = shareHolder.buyShares(1, 100);
	            
     out.println("Printing the details of ShareAccountNumber 1");
     printShareAccount(sa,out);
     out.println("");

     out.println("selling 50 shares of ShareAccountNumber 1");
     int numberShares = shareHolder.sellShares(1, 50);
     if(numberShares == 50){
       out.println("Printing the details of ShareAccountNumber 1");
       sa = shareHolder.findShareAccount(1);
       printShareAccount(sa,out);
     }
     else if(numberShares == -1){
       out.println("ShareAccountNo can not be found");
     }else {
       out.println("The number shares available are less than 50");
     }
     out.println("");

     List&lt;ShareAccount&gt; saList = shareHolder.listAccounts();
     out.println("Printing all the available accounts");
     for (int i = 0; i &lt; saList.size(); i++){
		out.println("*******");
		printShareAccount(saList.get(i),out);
		out.println("*******");
		out.println("");
	}
     out.println("");

     out.println("Setting the ShareAccount 1 with 500 shares 
                  and updating the database");
     sa = new ShareAccount(1,"phani",0);
     sa.setNumberOfShares(500);
     shareHolder.updateShareAccount(sa);
     out.println("Printing the details of ShareAccountNumber 1");
     printShareAccount(sa,out);
     out.println("");

     out.println("Closing ShareAccountNumber 1");
     sa = shareHolder.close(1);
     if(sa == null){
        out.println("Account is not found="+1);
     }else{
        out.println("Printing the details of ShareAccountNumber 1");
	printShareAccount(sa,out);
     }

   }
   catch(Exception e){
     e.printStackTrace();
     throw new ServletException(e);
   }
}  	

 protected void doPost(HttpServletRequest request, 
                      HttpServletResponse response) 
                  throws ServletException, IOException {
		
 }  
 private void printShareAccount(ShareAccount sa, PrintWriter out){
    if(sa != null){
    out.println("Account Number = "+sa.getShareAccountNo());
    out.println("Owner Name = "+sa.getOwnerName());
    out.println("number of shares "+sa.getNumberOfShares());
    out.println("version="+sa.getVersion());
    }else{
     out.println("ShareAccountNo can not be found");
    }
 }
}
</pre>
</div></div>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>web.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;!--
The deployment descriptor of the web client.
--&gt;
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
         xmlns="http://java.sun.com/xml/ns/javaee" 
         xmlns:web="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" 
         xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
         http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" 
         id="WebApp_ID" version="2.5"&gt;

  &lt;display-name&gt;ShareHolderWEB&lt;/display-name&gt;
   &lt;servlet&gt;
    &lt;description&gt;&lt;/description&gt;
    &lt;display-name&gt;Test&lt;/display-name&gt;
    &lt;servlet-name&gt;Test&lt;/servlet-name&gt;
    &lt;servlet-class&gt;sample.jpa.Test&lt;/servlet-class&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;Test&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/Test&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</pre>
</div></div>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>geronimo-web.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;!--
The geronimo deployment plan of the web client.
--&gt;

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns="http://geronimo.apache.org/xml/ns/j2ee/web-2.0.1" 
         xmlns:naming="http://geronimo.apache.org/xml/ns/naming-1.2" 
         xmlns:sec="http://geronimo.apache.org/xml/ns/security-2.0" 
         xmlns:sys="http://geronimo.apache.org/xml/ns/deployment-1.2"&gt;
  &lt;sys:environment&gt;
    &lt;sys:moduleId&gt;
      &lt;sys:groupId&gt;JPA&lt;/sys:groupId&gt;
      &lt;sys:artifactId&gt;ShareHolderWEB&lt;/sys:artifactId&gt;
      &lt;sys:version&gt;1.0&lt;/sys:version&gt;
      &lt;sys:type&gt;car&lt;/sys:type&gt;
    &lt;/sys:moduleId&gt;
  &lt;/sys:environment&gt;
  &lt;context-root&gt;/ShareHolderWEB&lt;/context-root&gt;
&lt;/web-app&gt;
</pre>
</div></div>

<p>The Servlet client <code>Test.java</code>, looks up the ShareHolderBean and executes various methods on the ShareAccount entity. When the url <a shape="rect" class="external-link" href="http://localhost:8080/ShareHolderWEB/Test" rel="nofollow">http://localhost:8080/ShareHolderWEB/Test</a> is hit on a browser window, the following output is displayed.</p>


<div class="preformatted panel" style="border-style: solid;border-width: 1px;"><div class="preformattedHeader panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;"><b><a shape="rect" class="external-link" href="http://localhost:8080/ShareHolderWEB/Test" rel="nofollow">http://localhost:8080/ShareHolderWEB/Test</a></b></div><div class="preformattedContent panelContent">
<pre>_________________________________________
Looking up ShareHolderBean
Creating ShareAccount 1, Phani, 10
Account is successfully created
Looking up the ShareAccountNumber 1
Printing the details of ShareAccountNumber 1
Account Number = 1
Owner Name = phani
number of shares 10
version=1
_________________________________________

_________________________________________

buying shares 100
Printing the details of ShareAccountNumber 1
Account Number = 1
Owner Name = phani
number of shares 110
version=2
_________________________________________

_________________________________________
selling 50 shares of ShareAccountNumber 1
Printing the details of ShareAccountNumber 1
Account Number = 1
Owner Name = phani
number of shares 60
version=3
_________________________________________

_________________________________________
Printing all the available accounts
*******
Account Number = 1
Owner Name = phani
number of shares 60
version=3
*******
_________________________________________

_________________________________________
Setting the ShareAccount 1 with 500 shares and updating the database
Printing the details of ShareAccountNumber 1
Account Number = 1
Owner Name = phani
number of shares 500
version=0
_________________________________________

_________________________________________
Closing ShareAccountNumber 1
Printing the details of ShareAccountNumber 1
Account Number = 1
Owner Name = null
number of shares 0
version=0
_________________________________________
</pre>
</div></div>
<h2 id="CreatingdeploymentplansforJavaPersistenceAPI-Inheritancerelationshipinentities">Inheritance relationship in entities</h2>

<p>Entities can exhibit inheritance relationship among themselves. The entities involved in inheritance relationship can be persisted/updated/retrieved independently. There are several ways of realizing inheritance relationship among entities. There are as follows.</p>

<ul><li>Single database table per class hierarchy</li><li>Separate database table per subclass</li><li>Single database table per concrete entity class</li></ul>


<h3 id="CreatingdeploymentplansforJavaPersistenceAPI-Singledatabasetableperclasshierarchy">Single database table per class hierarchy</h3>

<p>In this technique, a single database table is designated for entire entity class hierarchy exhibiting inheritance relationship. For example, if entity C extends entity B which extends entity A, the fields of all the entities are stored in a single table. The entities A, B and C can be persisted/updated/deleted/retrieved independently. This technique requires all the columns except for primary columns and columns of parent most entity A, should be nullable. This is because, suppose take the case when an entity B is being inserted. The entity B will have the values for the fields of A and itself but no values for fields of C. Since entire hierarchy uses a single table, the columns pertaining to entity C must be nullable. The same case arises when inserting entity A.</p>

<p>The below example illustrates the use this technique. The enterprise application has 3 entities and uses a single database table to store these entities. A stateless session bean uses JPA to perform DML operations on these entities. The web client looks up the SLSB trigger the operations.</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>Account</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package com.sample.jpa;

import java.io.Serializable;

import javax.persistence.DiscriminatorColumn;
import javax.persistence.DiscriminatorType;
import javax.persistence.DiscriminatorValue;
import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.Inheritance;
import javax.persistence.InheritanceType;
import javax.persistence.Table;

@Entity
@Table(name="Account")
@Inheritance(strategy=InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn(name="ACCOUNTTYPE", 
 discriminatorType=DiscriminatorType.STRING)
@DiscriminatorValue("ACCOUNT")
public abstract class Account 
       implements Serializable{
	
 @Id
 private int accountNo;
 private String name;
 private String address;
 private int branchCode;
	
 public Account(){
  this.accountNo = 0;
  this.name = "DUMMY";
  this.address = "DUMMY";
  this.branchCode = 0;
 }
	
 public int getAccountNo() {
  return accountNo;
 }
 public void setAccountNo(int accountNo) {
  this.accountNo = accountNo;
 }
 public String getName() {
  return name;
 }
 public void setName(String name) {
  this.name = name;
 }
 public String getAddress() {
  return address;
 }
 public void setAddress(String address) {
  this.address = address;
 }
 public int getBranchCode() {
  return branchCode;
 }
 public void setBranchCode(int branchCode) {
  this.branchCode = branchCode;
 }

}
</pre>
</div></div>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p><strong>@DiscriminatorColumn</strong> annotation designates table column to be used to discriminate rows that correspond to different entities in the class hierarchy.  @DiscriminatorValue annotation provides value that corresponds to the Account entity for the DiscriminatorColumn. The value is Account. Note that the Account entity class is declared as an abstract class. This is to prevent applications from instantiating Account objects. The intention is, to allow instantiating only sub entities SavingsAccount and CurrentAccount as given below. </p></div></div>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>SavingsAccount</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package com.sample.jpa;

import javax.persistence.DiscriminatorColumn;
import javax.persistence.DiscriminatorType;
import javax.persistence.DiscriminatorValue;
import javax.persistence.Entity;
import javax.persistence.Inheritance;
import javax.persistence.InheritanceType;
import javax.persistence.Table;

@Entity
@Table(name="Account")
@Inheritance(strategy=InheritanceType.SINGLE_TABLE)
@DiscriminatorValue("SAVINGSACCOUNT")
public class SavingsAccount extends Account {
 private double interestRate;
 private double minBalance;
 private double balance;
 private String savingsAccountRules;
	
 public SavingsAccount(){
  super();
  this.interestRate = 0;
  this.minBalance = 0;
  this.balance = 0;
  this.savingsAccountRules = null;
 }
	
 public double getInterestRate() {
  return interestRate;
 }
 public void setInterestRate(double interestRate) {
  this.interestRate = interestRate;
 }
 public double getMinBalance() {
  return minBalance;
 }
 public void setMinBalance(double minBalance) {
  this.minBalance = minBalance;
 }
 public double getBalance() {
  return balance;
 }
 public void setBalance(double balance) {
  this.balance = balance;
 }
 public String getSavingAccountRules() {
  return savingsAccountRules;
 }
 public void setSavingAccountRules(String savingAccountRules) {
  this.savingsAccountRules = savingAccountRules;
 }
}
</pre>
</div></div>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p><strong>@DiscriminatorValue</strong> annotation provides value that corresponds to the SavingsAccount entity for the DiscriminatorColumn. The value is SAVINGSACCOUNT</p></div></div>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>CurrentAccount</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package com.sample.jpa;

import javax.persistence.DiscriminatorColumn;
import javax.persistence.DiscriminatorType;
import javax.persistence.DiscriminatorValue;
import javax.persistence.Entity;
import javax.persistence.Inheritance;
import javax.persistence.InheritanceType;
import javax.persistence.Table;

@Entity
@Table(name="Account")
@Inheritance(strategy=InheritanceType.SINGLE_TABLE)
@DiscriminatorValue("CURRENTACCOUNT")
public class CurrentAccount extends Account {
 private double interestRate;
 private double minBalance;
 private double balance;
 private String currentAccountRules;
	
 public CurrentAccount(){
  super();
  this.interestRate = 0;
  this.minBalance = 0;
  this.balance = 0;
  this.currentAccountRules = null;
 }
 public double getInterestRate() {
  return interestRate;
 }
 public void setInterestRate(double interestRate) {
  this.interestRate = interestRate;
 }
 public double getMinBalance() {
  return minBalance;
 }
 public void setMinBalance(double minBalance) {
  this.minBalance = minBalance;
 }
 public double getBalance() {
  return balance;
 }
 public void setBalance(double balance) {
  this.balance = balance;
 }
 public String getCurrentAccountRules() {
  return currentAccountRules;
 }
 public void setCurrentAccountRules
          (String currentAccountRules) {
  this.currentAccountRules = currentAccountRules;
 }
}
</pre>
</div></div>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p><strong>@DiscriminatorValue</strong> annotation provides value that corresponds to the SavingsAccount entity for the DiscriminatorColumn. The value is CURRENTACCOUNT. <br clear="none">
The CurrentAccount entity has currentAccountRules field and SavingsAccount has SavingsAccountRules field. Both inherit fields from the parent entity Account</p></div></div>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>AccessAccountStateless</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package com.sample.jpa;
import java.util.List;
public interface AccessAccountStateless {
 public SavingsAccount createSavingsAccount
        (int accNo, String name, 
         String address, int branchCode,
	 double interestRate,
         double minBalance,
	 double balance, 
         String savingsAccountRules);
	
 public CurrentAccount createCurrentAccount
       (int accNo, String name,
	String address, int branchCode,
        double interestRate, 
        double minBalance,
	double balance, 
        String currentAccountRules);
 public List listAccounts();
 public SavingsAccount 
        updateSavingsAccountBalance
       (int accNo, 
        double newBalance);
 public CurrentAccount 
        updateCurrentAccountBalance
       (int accNo, 
        double newBalance);
 public void deleteSavingsAccount(int accNo);
 public void deleteCurrentAccount(int accNo);
}
</pre>
</div></div>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>AccessAccountStatelessBean</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package com.sample.jpa;
import java.util.ArrayList;
import java.util.List;
import javax.ejb.Remote;
import javax.ejb.Stateless;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;


@Stateless
@Remote
public class AccessAccountStatelessBean 
             implements AccessAccountStateless{
 @PersistenceContext(unitName="SingleTableInheritance")
  EntityManager em;
	
 public SavingsAccount createSavingsAccount
       (int accNo, String name, 
	String address, int branchCode,
	double interestRate, 
        double minBalance,
	double balance, 
        String savingsAccountRules){
		
  SavingsAccount sa = new SavingsAccount();
  sa.setAccountNo(accNo);
  sa.setAddress(address);
  sa.setBalance(balance);
  sa.setBranchCode(branchCode);
  sa.setMinBalance(minBalance);
  sa.setName(name);
  sa.setSavingAccountRules(savingsAccountRules);
  sa.setInterestRate(interestRate);
  em.persist(sa);
  return sa;
 }

 public CurrentAccount createCurrentAccount
       (int accNo, String name, 
	String address, int branchCode,
        double interestRate, 
        double minBalance,
	double balance, 
        String currentAccountRules){

  CurrentAccount ca = new CurrentAccount();
  ca.setAccountNo(accNo);
  ca.setAddress(address);
  ca.setBalance(balance);
  ca.setCurrentAccountRules(currentAccountRules);
  ca.setInterestRate(interestRate);
  ca.setMinBalance(minBalance);
  ca.setName(name);
  ca.setBranchCode(branchCode);
  em.persist(ca);
  return ca;
 }

 public List listAccounts(){
  List allList = new ArrayList();
  Query q1 = em.createQuery("SELECT sa FROM SavingsAccount sa");
  List currList1 = q1.getResultList();
  allList.addAll(currList1);
  Query q2 = em.createQuery("SELECT ca FROM CurrentAccount ca");
  List currList2 = q2.getResultList();
  allList.addAll(currList2);
  return allList;
 }

 public SavingsAccount updateSavingsAccountBalance
         (int accNo, double newBalance){
  SavingsAccount sa = 
   em.find(SavingsAccount.class, accNo);
  if (sa == null) 
     throw new IllegalStateException
          ("Account number not found");
  Query q = em.createQuery
       ("UPDATE SavingsAccount sa SET 
         sa.balance = "+newBalance);
  q.executeUpdate();
  return sa;
	
 }
 public CurrentAccount updateCurrentAccountBalance
                      (int accNo, double newBalance){
  CurrentAccount ca = em.find(CurrentAccount.class, accNo);
  if (ca == null) throw new IllegalStateException
                 ("Account number not found");
  Query q = em.createQuery("UPDATE CurrentAccount 
                        ca SET ca.balance = "+newBalance);
  q.executeUpdate();
  return ca;
 }

 public void deleteSavingsAccount(int accNo){
  SavingsAccount sa = 
   em.find(SavingsAccount.class, accNo);
  if(sa == null) 
     throw new 
      IllegalStateException("Account number not found");
  em.remove(sa);
 }
 public void deleteCurrentAccount(int accNo){
  CurrentAccount ca = 
   em.find(CurrentAccount.class, accNo);
  if(ca == null) 
   throw new IllegalStateException
    ("Account number not found");
  em.remove(ca);
 }
}
</pre>
</div></div>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>com.sample.jpa.Test</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package com.sample.jpa;
import java.io.IOException;
import java.io.PrintWriter;
import java.util.List;
import javax.ejb.EJB;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class Test extends 
 javax.servlet.http.HttpServlet 
 implements javax.servlet.Servlet {

 static final long serialVersionUID = 1L;
 @EJB AccessAccountStateless aas;

 public Test() {
  super();
 }   	
 protected void doGet(HttpServletRequest request, 
                      HttpServletResponse response) 
                      throws ServletException, 
                      IOException {
  PrintWriter out = response.getWriter();
  int accNo = Integer.parseInt(request.getParameter("accNo"));
  String name = request.getParameter("name");

  aas.createCurrentAccount(accNo, name, 
      name+"' address", 10, 20, 200, 5000, 
      "Current Account!!");

  aas.createSavingsAccount(accNo+1, name, 
      name+"' address",	12, 234, 4534, 13323, 
      "Savings Account!!");

  out.println("Created a Savings account 
               and a Current Account");
  List accList = aas.listAccounts();
  out.println("&lt;table&gt;");
  out.println("&lt;tr&gt;");
  out.println("&lt;th&gt;AccountNumber&lt;/th&gt;");
  out.println("&lt;th&gt;Name&lt;/th&gt;");
  out.println("&lt;th&gt;Address&lt;/th&gt;");
  out.println("&lt;th&gt;Branch Code&lt;/th&gt;");
  out.println("&lt;th&gt;Interest Rate&lt;/th&gt;");
  out.println("&lt;th&gt;Minimum Balance&lt;/th&gt;");
  out.println("&lt;th&gt;Balance&lt;/th&gt;");
  out.println("&lt;th&gt;Current Account Rules&lt;/th&gt;");
  out.println("&lt;th&gt;Savings Account Rules&lt;/th&gt;");
  out.println("&lt;/tr&gt;");

  for(int i = 0; i &lt; accList.size(); i++){
   Account a = (Account)accList.get(i);
   if (a instanceof SavingsAccount){
    SavingsAccount sa = (SavingsAccount)a;
    out.println("&lt;tr&gt;");
    out.println("&lt;td&gt;"+sa.getAccountNo()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+sa.getName()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+sa.getAddress()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+sa.getBranchCode()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+sa.getInterestRate()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+sa.getMinBalance()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+sa.getBalance()+"&lt;/td&gt;");
    out.println("&lt;td&gt;&lt;/td&gt;");
    out.println("&lt;td&gt;"+sa.getSavingAccountRules()+"&lt;/td&gt;");
    out.println("&lt;/tr&gt;");
   }else if (a instanceof CurrentAccount){
    CurrentAccount ca = (CurrentAccount)a;
    out.println("&lt;tr&gt;");
    out.println("&lt;td&gt;"+ca.getAccountNo()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+ca.getName()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+ca.getAddress()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+ca.getBranchCode()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+ca.getInterestRate()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+ca.getMinBalance()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+ca.getBalance()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+ca.getCurrentAccountRules()+"&lt;/td&gt;");
    out.println("&lt;td&gt;&lt;/td&gt;");
    out.println("&lt;/tr&gt;");
   }
  }
  out.println("&lt;/table&gt;");
  out.println("Deleting both the accounts "+accNo+" and "+(accNo+1));
  //aas.deleteCurrentAccount(accNo);
  //aas.deleteSavingsAccount(accNo+1);
  //out.println("Accounts successfully deleted..!!");
 }  	

 protected void doPost(HttpServletRequest request, 
                       HttpServletResponse response) 
                       throws ServletException, 
                              IOException {
 }  
}
</pre>
</div></div>
<p>The above servlet client only inserts entities in the table ACCOUNT. The code that deletes entities is commented out. We can write variety of clients that lookup the EJB and perform operations on the entities.</p>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>persistence.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence 
 xmlns="http://java.sun.com/xml/ns/persistence"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
 version="1.0"
 xsi:schemaLocation="http://java.sun.com/xml/ns/persistence
 http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"&gt;
 
 &lt;persistence-unit name="SingleTableInheritance"&gt;
 &lt;description&gt;
   Single Table Inheritance example
 &lt;/description&gt;
 &lt;provider&gt;
  org.apache.openjpa.persistence.PersistenceProviderImpl
 &lt;/provider&gt;
 &lt;class&gt;com.sample.jpa.Account&lt;/class&gt;
 &lt;class&gt;com.sample.jpa.SavingsAccount&lt;/class&gt;
 &lt;class&gt;com.sample.jpa.CurrentAccount&lt;/class&gt;
 &lt;properties&gt;
  &lt;property 
   name="openjpa.ConnectionURL" 
   value="jdbc:derby:AccountDB" /&gt;
  &lt;property 
   name="openjpa.ConnectionDriverName" 
   value="org.apache.derby.jdbc.EmbeddedDriver" /&gt;
   &lt;property name="ConnectionUserName" value="app" /&gt;
   &lt;property name="openjpa.jdbc.SynchronizeMappings" 
    value="false" /&gt;
  &lt;/properties&gt;
 &lt;/persistence-unit&gt;
 &lt;!--
 &lt;jta-data-source&gt;PhoneBookPool&lt;/jta-data-source&gt;
 &lt;non-jta-data-source&gt;PhoneBookPool&lt;/non-jta-data-source&gt;
 --&gt;
&lt;/persistence&gt;
</pre>
</div></div>
<p>The persistence schema uses AccountDB derby database. It declares the entities in the persistence unit as well. The following procedure explains how to deploy/run the sample.</p>

<ul><li>Create an EAR application that contains an EJB application packaging all entity classes, ejb classes and META-INF/persistence.xml</li><li>Create META-INF/ejb-jar.xml. Since we have used annotations, we do not have to provide any declarations in it.</li><li>Create a WEB application in the EAR and add the above servlet.</li><li>Create a derby database by name AccountDB using admin console.</li><li>Create a table by name ACCOUNT as following.
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>ACCOUNT table</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
create table ACCOUNT(ACCOUNTNO integer, 
             ACCOUNTTYPE varchar(50), 
             NAME varchar(50), 
             ADDRESS varchar(225),
             BRANCHCODE integer, 
             INTERESTRATE decimal(15,2), 
             MINBALANCE decimal(15,2), 
             BALANCE decimal(15,2), 
             CURRENTACCOUNTRULES varchar(225), 
             SAVINGSACCOUNTRULES varchar(225))
</pre>
</div></div></li></ul>


<ul><li>Run the servlet with the following input<br clear="none">
  <code><a shape="rect" class="external-link" href="http://localhost:8080/" rel="nofollow">http://localhost:8080/</a>&lt;web-context&gt;/Test?accNo=1&amp;name=Joe</code><br clear="none">
  <code><a shape="rect" class="external-link" href="http://localhost:8080/" rel="nofollow">http://localhost:8080/</a>&lt;web-context&gt;/Test?accNo=3&amp;name=John</code></li></ul>


<ul><li>The following data will be inserted into ACCOUNT table.
<div class="preformatted panel" style="border-style: solid;border-width: 1px;"><div class="preformattedHeader panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>ACCOUNT table</b></div><div class="preformattedContent panelContent">
<pre>ACCOUNTNO ACCOUNTTYPE NAME ADDRESS BRANCHCODE INTERESTRATE MINBALANCE BALANCE CURRENTACCOUNTRULES SAVINGSACCOUNTRULES 
1 CURRENTACCOUNT Joe Joe's address 10 20.00 200.00 5000.00 Current Account!!  
2 SAVINGSACCOUNT Joe Joe's address 12 234.00 4534.00 13323.00  Savings Account!! 
3 CURRENTACCOUNT John John's address 10 20.00 200.00 5000.00 Current Account!!  
4 SAVINGSACCOUNT John John's address 12 234.00 4534.00 13323.00  Savings Account!!
</pre>
</div></div></li></ul>


<p>Note that JPA has inserted the value CURRENTACCOUNT in the column ACCOUNTTYPE for CurrentAccount entities and inserted the value SAVINGSACCOUNT for SavingsAccount entites.</p></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Creating deployment plans for Java Persistence API';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
