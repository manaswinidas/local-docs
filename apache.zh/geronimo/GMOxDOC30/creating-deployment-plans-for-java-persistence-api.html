<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=0">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="Creating deployment plans for Java Persistence API">
    <meta name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Creating deployment plans for Java Persistence API">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2010-05-11">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>

  <link href="asset?aid=1" rel="stylesheet" type="text/css">
  <link href="asset?aid=2" rel="stylesheet" type="text/css">
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shCore.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushJava.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushXml.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushPlain.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushBash.js' type='text/javascript'></script>
  
  <script type="text/javascript">
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
  </script>

    <title>Apache Geronimo v3.0文档：为Java Persistence API创建部署计划</title>
  </head>

  <body  onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">主页</a> > <a href="documentation.html">文档</a> > <a href="creating-deployment-plans.html">创建部署计划</a> > <a href="creating-deployment-plans-for-applications.html">为应用程序</a> <a href="creating-deployment-plans-for-java-persistence-api.html">创建部署计划</a> > <a href="creating-deployment-plans-for-java-persistence-api.html">为Java Persistence API创建部署计划</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo v3.0</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">为Java Persistence API创建部署计划</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645411"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645411">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645411"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645411">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645411"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645411">添加新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent">

<h1 id="CreatingdeploymentplansforJavaPersistenceAPI-JavaPersistenceAPI">Java持久性API</h1>
<p>Java Persistence API是EJB3.0规范（JSR220）下的新编程模型，用于使用Java EE和Java SE管理持久性和对象/关系映射。借助JPA，开发人员可以轻松开发Java应用程序，这些应用程序使用Java对象和映射在关系数据库管理系统上执行操作。这样，使用JPA开发的Java应用程序不仅可以跨不同平台移植，而且可以使用JPA提供的简单而强大的编程模型轻松开发应用程序。这极大地提高了应用程序在不断变化的数据库世界中的可维护性。JPA使应用程序与数据库连接和操作中涉及的所有复杂性和不可移植的样板代码隔离。Apache geronimo使用<a shape="rect" class="external-link" href="http://openjpa.apache.org/">OpenJPA</a>向服务器中部署的Java EE应用程序提供Java Persistence API。以下各节说明了使用JPA开发应用程序以及如何为Apache Geronimo编写各种部署描述符和计划。</p>

<p>该文档的组织如下。</p>
<style type="text/css">/*<![CDATA[*/
div.rbtoc1572612979696 {padding: 0px;}
div.rbtoc1572612979696 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1572612979696 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class="toc-macro rbtoc1572612979696">
<ul class="toc-indentation"><li><a shape="rect" href="#CreatingdeploymentplansforJavaPersistenceAPI-JavaPersistenceAPI">Java持久性API</a>
<ul class="toc-indentation"><li><a shape="rect" href="#CreatingdeploymentplansforJavaPersistenceAPI-ShareAccountsample">ShareAccount示例</a></li><li><a shape="rect" href="#CreatingdeploymentplansforJavaPersistenceAPI-Inheritancerelationshipinentities">实体中的继承关系</a>
<ul class="toc-indentation"><li><a shape="rect" href="#CreatingdeploymentplansforJavaPersistenceAPI-Singledatabasetableperclasshierarchy">每个类层次结构一个数据库表</a></li></ul>
</li></ul>
</li></ul>
</div>

<h2 id="CreatingdeploymentplansforJavaPersistenceAPI-ShareAccountsample">ShareAccount示例</h2>
<p>此示例说明了开发使用JPA进行持久化的企业应用程序。使用的数据库是apache geronimo附带的嵌入式derby。在这里，我们介绍一个持久性部署描述符（ <code>persistence.xml</code> ），其中包含应用程序的数据库连接性和其他信息。的<code>persistence.xml</code>放在应用程序归档文件的META-INF /目录下。该应用程序包含一个ejb模块和一个Web模块。EJB模块使用无状态会话bean ShareHolderBean，后者使用JPA对ShareDB derby数据库中的表SHAREACCOUNT执行数据库操作。SHAREACCOUNT表包含有关每个股东的信息以及有关他或她当前在帐户中拥有的股份数量的信息。ShareHolderBean具有检索股东信息，购买/出售特定股东的股份，关闭股东帐户等的方法。Web应用程序具有一个Servlet，用于查找ShareHolderBean并触发对其的操作。EJB模块的部署描述符信息是使用各个bean类中的Java EE注释提供的。但是，使用以下命令提供持久性部署描述符信息<code>META-INF/persistence.xml</code>文件。</p>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>sample.jpa。ShareAccount.java</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package sample.jpa;
import java.io.Serializable;
import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.NamedQuery;
import javax.persistence.PostLoad;
import javax.persistence.PostUpdate;
import javax.persistence.PrePersist;
import javax.persistence.PreUpdate;
import javax.persistence.Version;
import javax.persistence.Table;

@Entity
@Table(name = "SHAREACCOUNT")
@NamedQuery(name="findThem", query="SELECT a FROM ShareAccount a")
public class ShareAccount implements Serializable {

   
    @Id
    private int shareAccountNo;
    private String ownerName;
    private int numberOfShares;
    @Version
    private int version;

    public ShareAccount(int shareAccountNo, 
                        String ownerName, 
                        int numberOfShares) {

      this.shareAccountNo = shareAccountNo;
      this.ownerName = ownerName;
      this.numberOfShares = numberOfShares;
        
    }

    public String toString() {
        return "Acc.# " + shareAccountNo +
               ", owner" + ownerName + 
               ", numberOfShares: " + 
                  numberOfShares + " $";
    }

    @PrePersist
    void prepersist() {
        System.out.println("pre persist!!");
    }
    
    @PreUpdate
    void preupdate() {
        System.out.println("pre update!!");
    }
    
    @PostUpdate
    void postupdate() {
        System.out.println("post update!!");
    }
    
    @PostLoad
    void postload() {
        System.out.println("post load!!");
    }

	public int getShareAccountNo() {
		return shareAccountNo;
	}

	public void setShareAccountNo(int shareAccountNo) {
		this.shareAccountNo = shareAccountNo;
	}

	public String getOwnerName() {
		return ownerName;
	}

	public void setOwnerName(String ownerName) {
		this.ownerName = ownerName;
	}

	public int getNumberOfShares() {
		return numberOfShares;
	}

	public void setNumberOfShares(int numberOfShares) {
		this.numberOfShares = numberOfShares;
	}

	public int getVersion() {
		return version;
	}

	public void setVersion(int version) {
		this.version = version;
	}
  
}

</pre>
</div></div>
<p>观察表示类中实体各个方面的各种注释。</p>

<p><strong>@Entity</strong> ：将ShareAccount类标记为可以完全保留在数据库中的实体。<br clear="none">
<strong>@Table（name =“ SHAREACCOUNT”）</strong> ：将数据库表SHAREACCOUNT指定给实体。数据库表中的列映射到ShareAccount实体的属性。<br clear="none">
<strong>@Id</strong> ：此批注指定实体的主键。在这种情况下，它是实体类的shareAccountNo属性。<br clear="none">
<strong>@NamedQuery（name =“ findAccounts”，query =“ SELECT a FROM ShareAccount a”）</strong> ：此注释通过名称<strong>findAccounts</strong>声明了一个命名查询。该查询从数据库中检索所有共享帐户。稍后在ShareHolderBean中，通过使用名称findAccounts执行NamedQuery。<br clear="none">
<strong>@Version</strong> ：ShareAccount实体的版本属性。</p>

<p>放在ShareAccount类的某些方法周围的注释是@ PrePersist，@ PreUpdate，@ PostUpdate和@PostLoad。这些是在实体上执行相应的数据库操作时，持久性容器调用的回调方法。</p>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>sample.jpa。ShareHolder.java</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package sample.jpa;
import java.util.List;

public interface ShareHolder {

    public ShareAccount openShareAccount(int shareHolderNo, String ownerName, int numberOfShares);
    public ShareAccount findShareAccount(int shareHolderNo);
    public ShareAccount close(int shareHolderNo);
    public List&lt;ShareAccount&gt; listAccounts();
    public ShareAccount buyShares(int shareHolderNo, int numberOfShares);
    public int sellShares(int shareHolderNo, int numberOfShares);   
    public ShareAccount updateShareAccount(ShareAccount sa);
}
</pre>
</div></div>
<p>的<code>ShareHolder.java</code>是无状态会话Bean的远程接口。</p>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>sample.jpa。ShareHolderBean.java</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package sample.jpa;
import java.util.List;
import javax.ejb.Stateless;
import javax.ejb.Remote;
import javax.persistence.*;
import javax.ejb.TransactionManagement;
import javax.ejb.TransactionManagementType;

@Stateless
@TransactionManagement(TransactionManagementType.CONTAINER) 
@Remote(ShareHolder.class)
public class ShareHolderBean implements ShareHolder { 
  
    @PersistenceContext
    private EntityManager manager;

    public ShareAccount openShareAccount(int shareHolderNo, 
                                         String ownerName, 
                                         int numberOfShares){
    	
    	if (findShareAccount(shareHolderNo) == null){
    		ShareAccount sa = new ShareAccount
                                 (shareHolderNo,
                                  ownerName,
                                  numberOfShares);
        	manager.persist(sa);
        	return sa;
    	}
    	return null;
    }

    public ShareAccount findShareAccount(int shareHolderNo){
    	ShareAccount sa = manager.find(ShareAccount.class, 
                                       shareHolderNo);
    	return sa;
    }
    
    public ShareAccount close(int shareHolderNo){
    	ShareAccount sa = manager.find(ShareAccount.class, 
                                       shareHolderNo);   
    	if (sa != null)manager.remove(sa);
    	return sa;

    }
    
    public List&lt;ShareAccount&gt; listAccounts(){
        Query query = manager.createNamedQuery("findThem");
        return query.getResultList();
    }
    
    public ShareAccount buyShares(int shareHolderNo, 
                                  int numberOfShares){
    	ShareAccount sa = manager.find(ShareAccount.class, 
                                       shareHolderNo);
    	if(sa != null){
    		int new_balance = sa.getNumberOfShares() 
                                  + numberOfShares; 
    	    sa.setNumberOfShares(new_balance);  
    	}
    	return sa;
    }
    
    public int sellShares(int shareHolderNo, 
                          int numberOfShares){
        ShareAccount sa = manager.find(ShareAccount.class, 
                                       shareHolderNo);
        if(sa != null){
            if (numberOfShares &gt; sa.getNumberOfShares()){
            	return -2;
            }else{
            	int new_balance = sa.getNumberOfShares() 
                                  - numberOfShares;
            	sa.setNumberOfShares(new_balance);
            	manager.flush();
            	return numberOfShares;
            }
        }else{
        	return -1;
        }
    }
    
    public ShareAccount updateShareAccount(ShareAccount sa){
    	ShareAccount sa1 = 
                   findShareAccount(sa.getShareAccountNo());
    	if (sa1 != null){
    		manager.merge(sa1);
    		return sa1;
    	}
    	else return null;
    	 
    }

    
}
</pre>
</div></div>
<p>的<code>ShareHolderBean.java</code>是使用JPA通过ShareAccount实体执行数据库操作的无状态会话bean。</p>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>Persistence.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence xmlns="http://java.sun.com/xml/ns/persistence"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.0"
  xsi:schemaLocation="http://java.sun.com/xml/ns/persistence 
  http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"&gt;

 &lt;persistence-unit name="PersistencePU"&gt;
 &lt;description&gt;ShareHolder&lt;/description&gt;
 &lt;provider&gt;
  org.apache.openjpa.persistence.PersistenceProviderImpl
 &lt;/provider&gt;
 &lt;class&gt;sample.jpa.ShareAccount&lt;/class&gt;
 &lt;properties&gt;
  &lt;property name="openjpa.ConnectionURL" 
           value="jdbc:derby:ShareDB" /&gt;
  &lt;property name="openjpa.ConnectionDriverName" 
           value="org.apache.derby.jdbc.EmbeddedDriver" /&gt;
  &lt;property name="ConnectionUserName" value="app" /&gt;
  &lt;property name="openjpa.jdbc.SynchronizeMappings" value="false" /&gt;
 &lt;/properties&gt;
 &lt;/persistence-unit&gt;
 &lt;!--
 &lt;jta-data-source&gt;PhoneBookPool&lt;/jta-data-source&gt;
 &lt;non-jta-data-source&gt;PhoneBookPool&lt;/non-jta-data-source&gt;
 --&gt;
&lt;/persistence&gt;
</pre>
</div></div>
<p>的<code>Persistence.xml</code>是ejb模块的持久性部署描述符。它提供数据库连接信息，并声明实体类。</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>上述XML文档的默认名称空间为<a shape="rect" class="external-link" href="http://java.sun.com/xml/ns/persistence" rel="nofollow">http://java.sun.com/xml/ns/persistence</a> 。没有名称空间前缀的XML元素属于默认名称空间。</p></div></div>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>sample.jpa。Test.java</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package sample.jpa;

import java.io.IOException;
import java.io.PrintWriter;
import java.util.List;

import javax.naming.Context;
import javax.naming.InitialContext;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class Test extends 
  javax.servlet.http.HttpServlet 
  implements javax.servlet.Servlet {
  
  static final long serialVersionUID = 1L;
   
   public Test() {
	super();
   }   	
	
   protected void doGet(HttpServletRequest request,
                  HttpServletResponse response) 
                  throws ServletException, 
                  IOException {
				
    PrintWriter out = response.getWriter();
	        
    try {
     java.util.Properties env = 
       new java.util.Properties();

     env.put(Context.INITIAL_CONTEXT_FACTORY
       ,"org.apache.openejb.client.RemoteInitialContextFactory"); 
     env.put(Context.PROVIDER_URL, 
             "ejbd://127.0.0.1:4201");
	    		
     Context ctx = new InitialContext(env);
     out.println("Looking up ShareHolderBean");

     ShareHolder shareHolder = (ShareHolder)
            ctx.lookup("ShareHolderBeanRemote");
	            
     out.println("Creating ShareAccount 1, 
                   Phani, 10");
	            
     ShareAccount sa = 
         shareHolder.openShareAccount(1,"phani", 10);
     if(sa == null){
	out.println("account could not be created.");
	out.println("May be, account already 
                            exists. Check the database.");
           	
     }
     else {
        out.println("Account is successfully created");
     }
     out.println("Looking up the ShareAccountNumber 1");
     sa = shareHolder.findShareAccount(1);
     out.println("Printing the details of ShareAccountNumber 1");
     printShareAccount(sa,out);
     out.println("");

     out.println("buying shares 100");
     sa = shareHolder.buyShares(1, 100);
	            
     out.println("Printing the details of ShareAccountNumber 1");
     printShareAccount(sa,out);
     out.println("");

     out.println("selling 50 shares of ShareAccountNumber 1");
     int numberShares = shareHolder.sellShares(1, 50);
     if(numberShares == 50){
       out.println("Printing the details of ShareAccountNumber 1");
       sa = shareHolder.findShareAccount(1);
       printShareAccount(sa,out);
     }
     else if(numberShares == -1){
       out.println("ShareAccountNo can not be found");
     }else {
       out.println("The number shares available are less than 50");
     }
     out.println("");

     List&lt;ShareAccount&gt; saList = shareHolder.listAccounts();
     out.println("Printing all the available accounts");
     for (int i = 0; i &lt; saList.size(); i++){
		out.println("*******");
		printShareAccount(saList.get(i),out);
		out.println("*******");
		out.println("");
	}
     out.println("");

     out.println("Setting the ShareAccount 1 with 500 shares 
                  and updating the database");
     sa = new ShareAccount(1,"phani",0);
     sa.setNumberOfShares(500);
     shareHolder.updateShareAccount(sa);
     out.println("Printing the details of ShareAccountNumber 1");
     printShareAccount(sa,out);
     out.println("");

     out.println("Closing ShareAccountNumber 1");
     sa = shareHolder.close(1);
     if(sa == null){
        out.println("Account is not found="+1);
     }else{
        out.println("Printing the details of ShareAccountNumber 1");
	printShareAccount(sa,out);
     }

   }
   catch(Exception e){
     e.printStackTrace();
     throw new ServletException(e);
   }
}  	

 protected void doPost(HttpServletRequest request, 
                      HttpServletResponse response) 
                  throws ServletException, IOException {
		
 }  
 private void printShareAccount(ShareAccount sa, PrintWriter out){
    if(sa != null){
    out.println("Account Number = "+sa.getShareAccountNo());
    out.println("Owner Name = "+sa.getOwnerName());
    out.println("number of shares "+sa.getNumberOfShares());
    out.println("version="+sa.getVersion());
    }else{
     out.println("ShareAccountNo can not be found");
    }
 }
}
</pre>
</div></div>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>web.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;!--
The deployment descriptor of the web client.
--&gt;
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
         xmlns="http://java.sun.com/xml/ns/javaee" 
         xmlns:web="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" 
         xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
         http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" 
         id="WebApp_ID" version="2.5"&gt;

  &lt;display-name&gt;ShareHolderWEB&lt;/display-name&gt;
   &lt;servlet&gt;
    &lt;description&gt;&lt;/description&gt;
    &lt;display-name&gt;Test&lt;/display-name&gt;
    &lt;servlet-name&gt;Test&lt;/servlet-name&gt;
    &lt;servlet-class&gt;sample.jpa.Test&lt;/servlet-class&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;Test&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/Test&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</pre>
</div></div>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>geronimo-web.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;!--
The geronimo deployment plan of the web client.
--&gt;

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns="http://geronimo.apache.org/xml/ns/j2ee/web-2.0.1" 
         xmlns:naming="http://geronimo.apache.org/xml/ns/naming-1.2" 
         xmlns:sec="http://geronimo.apache.org/xml/ns/security-2.0" 
         xmlns:sys="http://geronimo.apache.org/xml/ns/deployment-1.2"&gt;
  &lt;sys:environment&gt;
    &lt;sys:moduleId&gt;
      &lt;sys:groupId&gt;JPA&lt;/sys:groupId&gt;
      &lt;sys:artifactId&gt;ShareHolderWEB&lt;/sys:artifactId&gt;
      &lt;sys:version&gt;1.0&lt;/sys:version&gt;
      &lt;sys:type&gt;car&lt;/sys:type&gt;
    &lt;/sys:moduleId&gt;
  &lt;/sys:environment&gt;
  &lt;context-root&gt;/ShareHolderWEB&lt;/context-root&gt;
&lt;/web-app&gt;
</pre>
</div></div>

<p>Servlet客户端<code>Test.java</code> ，查找ShareHolderBean并在ShareAccount实体上执行各种方法。在浏览器窗口中单击URL <a shape="rect" class="external-link" href="http://localhost:8080/ShareHolderWEB/Test" rel="nofollow">http：// localhost：8080 / ShareHolderWEB / Test时</a> ，将显示以下输出。</p>


<div class="preformatted panel" style="border-style:solid;border-width:1px"><div class="preformattedHeader panelHeader" style="border-bottom-width:1px;border-bottom-style:solid"><b><a shape="rect" class="external-link" href="http://localhost:8080/ShareHolderWEB/Test" rel="nofollow">http：// localhost：8080 / ShareHolderWEB / Test</a></b></div><div class="preformattedContent panelContent">
<pre>_________________________________________
Looking up ShareHolderBean
Creating ShareAccount 1, Phani, 10
Account is successfully created
Looking up the ShareAccountNumber 1
Printing the details of ShareAccountNumber 1
Account Number = 1
Owner Name = phani
number of shares 10
version=1
_________________________________________

_________________________________________

buying shares 100
Printing the details of ShareAccountNumber 1
Account Number = 1
Owner Name = phani
number of shares 110
version=2
_________________________________________

_________________________________________
selling 50 shares of ShareAccountNumber 1
Printing the details of ShareAccountNumber 1
Account Number = 1
Owner Name = phani
number of shares 60
version=3
_________________________________________

_________________________________________
Printing all the available accounts
*******
Account Number = 1
Owner Name = phani
number of shares 60
version=3
*******
_________________________________________

_________________________________________
Setting the ShareAccount 1 with 500 shares and updating the database
Printing the details of ShareAccountNumber 1
Account Number = 1
Owner Name = phani
number of shares 500
version=0
_________________________________________

_________________________________________
Closing ShareAccountNumber 1
Printing the details of ShareAccountNumber 1
Account Number = 1
Owner Name = null
number of shares 0
version=0
_________________________________________
</pre>
</div></div>
<h2 id="CreatingdeploymentplansforJavaPersistenceAPI-Inheritancerelationshipinentities">实体中的继承关系</h2>

<p>实体之间可以表现出继承关系。继承关系中涉及的实体可以独立保存/更新/检索。实现实体之间的继承关系的方法有几种。如下。</p>

<ul><li>每个类层次结构一个数据库表</li><li>每个子类单独的数据库表</li><li>每个具体实体类一个数据库表</li></ul>


<h3 id="CreatingdeploymentplansforJavaPersistenceAPI-Singledatabasetableperclasshierarchy">每个类层次结构一个数据库表</h3>

<p>在这种技术中，为表现出继承关系的整个实体类层次结构指定一个数据库表。例如，如果实体C扩展了实体B，后者又扩展了实体A，则所有实体的字段都存储在单个表中。实体A，B和C可以独立保存/更新/删除/检索。此技术要求除主列和父级大多数实体A的列之外的所有列都应为可空。这是因为，假设插入实体B的情况。实体B将具有A字段及其自身的值，但没有C字段的值。由于整个层次结构使用单个表，因此与实体C有关的列必须为可空。插入实体A时也会出现相同的情况。</p>

<p>下面的示例说明了此技术的使用。企业应用程序具有3个实体，并使用一个数据库表存储这些实体。无状态会话Bean使用JPA对这些实体执行DML操作。Web客户端查找SLSB触发操作。</p>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>帐户</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package com.sample.jpa;

import java.io.Serializable;

import javax.persistence.DiscriminatorColumn;
import javax.persistence.DiscriminatorType;
import javax.persistence.DiscriminatorValue;
import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.Inheritance;
import javax.persistence.InheritanceType;
import javax.persistence.Table;

@Entity
@Table(name="Account")
@Inheritance(strategy=InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn(name="ACCOUNTTYPE", 
 discriminatorType=DiscriminatorType.STRING)
@DiscriminatorValue("ACCOUNT")
public abstract class Account 
       implements Serializable{
	
 @Id
 private int accountNo;
 private String name;
 private String address;
 private int branchCode;
	
 public Account(){
  this.accountNo = 0;
  this.name = "DUMMY";
  this.address = "DUMMY";
  this.branchCode = 0;
 }
	
 public int getAccountNo() {
  return accountNo;
 }
 public void setAccountNo(int accountNo) {
  this.accountNo = accountNo;
 }
 public String getName() {
  return name;
 }
 public void setName(String name) {
  this.name = name;
 }
 public String getAddress() {
  return address;
 }
 public void setAddress(String address) {
  this.address = address;
 }
 public int getBranchCode() {
  return branchCode;
 }
 public void setBranchCode(int branchCode) {
  this.branchCode = branchCode;
 }

}
</pre>
</div></div>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p><strong>@DiscriminatorColumn</strong>注释指定表列，该表列用于区分与类层次结构中不同实体相对应的行。@DiscriminatorValue批注提供与DiscriminatorColumn的Account实体相对应的值。该值为Account。请注意，Account实体类被声明为抽象类。这是为了防止应用程序实例化Account对象。目的是允许仅实例化如下所示的子实体SavingsAccount和CurrentAccount。</p></div></div>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>储蓄账户</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package com.sample.jpa;

import javax.persistence.DiscriminatorColumn;
import javax.persistence.DiscriminatorType;
import javax.persistence.DiscriminatorValue;
import javax.persistence.Entity;
import javax.persistence.Inheritance;
import javax.persistence.InheritanceType;
import javax.persistence.Table;

@Entity
@Table(name="Account")
@Inheritance(strategy=InheritanceType.SINGLE_TABLE)
@DiscriminatorValue("SAVINGSACCOUNT")
public class SavingsAccount extends Account {
 private double interestRate;
 private double minBalance;
 private double balance;
 private String savingsAccountRules;
	
 public SavingsAccount(){
  super();
  this.interestRate = 0;
  this.minBalance = 0;
  this.balance = 0;
  this.savingsAccountRules = null;
 }
	
 public double getInterestRate() {
  return interestRate;
 }
 public void setInterestRate(double interestRate) {
  this.interestRate = interestRate;
 }
 public double getMinBalance() {
  return minBalance;
 }
 public void setMinBalance(double minBalance) {
  this.minBalance = minBalance;
 }
 public double getBalance() {
  return balance;
 }
 public void setBalance(double balance) {
  this.balance = balance;
 }
 public String getSavingAccountRules() {
  return savingsAccountRules;
 }
 public void setSavingAccountRules(String savingAccountRules) {
  this.savingsAccountRules = savingAccountRules;
 }
}
</pre>
</div></div>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p><strong>@DiscriminatorValue</strong>注释提供与DiscriminatorColumn的SavingsAccount实体相对应的值。值是SAVINGSACCOUNT</p></div></div>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>经常账户</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package com.sample.jpa;

import javax.persistence.DiscriminatorColumn;
import javax.persistence.DiscriminatorType;
import javax.persistence.DiscriminatorValue;
import javax.persistence.Entity;
import javax.persistence.Inheritance;
import javax.persistence.InheritanceType;
import javax.persistence.Table;

@Entity
@Table(name="Account")
@Inheritance(strategy=InheritanceType.SINGLE_TABLE)
@DiscriminatorValue("CURRENTACCOUNT")
public class CurrentAccount extends Account {
 private double interestRate;
 private double minBalance;
 private double balance;
 private String currentAccountRules;
	
 public CurrentAccount(){
  super();
  this.interestRate = 0;
  this.minBalance = 0;
  this.balance = 0;
  this.currentAccountRules = null;
 }
 public double getInterestRate() {
  return interestRate;
 }
 public void setInterestRate(double interestRate) {
  this.interestRate = interestRate;
 }
 public double getMinBalance() {
  return minBalance;
 }
 public void setMinBalance(double minBalance) {
  this.minBalance = minBalance;
 }
 public double getBalance() {
  return balance;
 }
 public void setBalance(double balance) {
  this.balance = balance;
 }
 public String getCurrentAccountRules() {
  return currentAccountRules;
 }
 public void setCurrentAccountRules
          (String currentAccountRules) {
  this.currentAccountRules = currentAccountRules;
 }
}
</pre>
</div></div>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p><strong>@DiscriminatorValue</strong>注释提供与DiscriminatorColumn的SavingsAccount实体相对应的值。该值为CURRENTACCOUNT。<br clear="none">CurrentAccount实体具有currentAccountRules字段，而SavingsAccount具有SavingsAccountRules字段。两者都从父实体帐户继承字段</p></div></div>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>AccessAccountStateless</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package com.sample.jpa;
import java.util.List;
public interface AccessAccountStateless {
 public SavingsAccount createSavingsAccount
        (int accNo, String name, 
         String address, int branchCode,
	 double interestRate,
         double minBalance,
	 double balance, 
         String savingsAccountRules);
	
 public CurrentAccount createCurrentAccount
       (int accNo, String name,
	String address, int branchCode,
        double interestRate, 
        double minBalance,
	double balance, 
        String currentAccountRules);
 public List listAccounts();
 public SavingsAccount 
        updateSavingsAccountBalance
       (int accNo, 
        double newBalance);
 public CurrentAccount 
        updateCurrentAccountBalance
       (int accNo, 
        double newBalance);
 public void deleteSavingsAccount(int accNo);
 public void deleteCurrentAccount(int accNo);
}
</pre>
</div></div>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>AccessAccountStatelessBean</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package com.sample.jpa;
import java.util.ArrayList;
import java.util.List;
import javax.ejb.Remote;
import javax.ejb.Stateless;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;


@Stateless
@Remote
public class AccessAccountStatelessBean 
             implements AccessAccountStateless{
 @PersistenceContext(unitName="SingleTableInheritance")
  EntityManager em;
	
 public SavingsAccount createSavingsAccount
       (int accNo, String name, 
	String address, int branchCode,
	double interestRate, 
        double minBalance,
	double balance, 
        String savingsAccountRules){
		
  SavingsAccount sa = new SavingsAccount();
  sa.setAccountNo(accNo);
  sa.setAddress(address);
  sa.setBalance(balance);
  sa.setBranchCode(branchCode);
  sa.setMinBalance(minBalance);
  sa.setName(name);
  sa.setSavingAccountRules(savingsAccountRules);
  sa.setInterestRate(interestRate);
  em.persist(sa);
  return sa;
 }

 public CurrentAccount createCurrentAccount
       (int accNo, String name, 
	String address, int branchCode,
        double interestRate, 
        double minBalance,
	double balance, 
        String currentAccountRules){

  CurrentAccount ca = new CurrentAccount();
  ca.setAccountNo(accNo);
  ca.setAddress(address);
  ca.setBalance(balance);
  ca.setCurrentAccountRules(currentAccountRules);
  ca.setInterestRate(interestRate);
  ca.setMinBalance(minBalance);
  ca.setName(name);
  ca.setBranchCode(branchCode);
  em.persist(ca);
  return ca;
 }

 public List listAccounts(){
  List allList = new ArrayList();
  Query q1 = em.createQuery("SELECT sa FROM SavingsAccount sa");
  List currList1 = q1.getResultList();
  allList.addAll(currList1);
  Query q2 = em.createQuery("SELECT ca FROM CurrentAccount ca");
  List currList2 = q2.getResultList();
  allList.addAll(currList2);
  return allList;
 }

 public SavingsAccount updateSavingsAccountBalance
         (int accNo, double newBalance){
  SavingsAccount sa = 
   em.find(SavingsAccount.class, accNo);
  if (sa == null) 
     throw new IllegalStateException
          ("Account number not found");
  Query q = em.createQuery
       ("UPDATE SavingsAccount sa SET 
         sa.balance = "+newBalance);
  q.executeUpdate();
  return sa;
	
 }
 public CurrentAccount updateCurrentAccountBalance
                      (int accNo, double newBalance){
  CurrentAccount ca = em.find(CurrentAccount.class, accNo);
  if (ca == null) throw new IllegalStateException
                 ("Account number not found");
  Query q = em.createQuery("UPDATE CurrentAccount 
                        ca SET ca.balance = "+newBalance);
  q.executeUpdate();
  return ca;
 }

 public void deleteSavingsAccount(int accNo){
  SavingsAccount sa = 
   em.find(SavingsAccount.class, accNo);
  if(sa == null) 
     throw new 
      IllegalStateException("Account number not found");
  em.remove(sa);
 }
 public void deleteCurrentAccount(int accNo){
  CurrentAccount ca = 
   em.find(CurrentAccount.class, accNo);
  if(ca == null) 
   throw new IllegalStateException
    ("Account number not found");
  em.remove(ca);
 }
}
</pre>
</div></div>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>com.sample.jpa。测试</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package com.sample.jpa;
import java.io.IOException;
import java.io.PrintWriter;
import java.util.List;
import javax.ejb.EJB;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class Test extends 
 javax.servlet.http.HttpServlet 
 implements javax.servlet.Servlet {

 static final long serialVersionUID = 1L;
 @EJB AccessAccountStateless aas;

 public Test() {
  super();
 }   	
 protected void doGet(HttpServletRequest request, 
                      HttpServletResponse response) 
                      throws ServletException, 
                      IOException {
  PrintWriter out = response.getWriter();
  int accNo = Integer.parseInt(request.getParameter("accNo"));
  String name = request.getParameter("name");

  aas.createCurrentAccount(accNo, name, 
      name+"' address", 10, 20, 200, 5000, 
      "Current Account!!");

  aas.createSavingsAccount(accNo+1, name, 
      name+"' address",	12, 234, 4534, 13323, 
      "Savings Account!!");

  out.println("Created a Savings account 
               and a Current Account");
  List accList = aas.listAccounts();
  out.println("&lt;table&gt;");
  out.println("&lt;tr&gt;");
  out.println("&lt;th&gt;AccountNumber&lt;/th&gt;");
  out.println("&lt;th&gt;Name&lt;/th&gt;");
  out.println("&lt;th&gt;Address&lt;/th&gt;");
  out.println("&lt;th&gt;Branch Code&lt;/th&gt;");
  out.println("&lt;th&gt;Interest Rate&lt;/th&gt;");
  out.println("&lt;th&gt;Minimum Balance&lt;/th&gt;");
  out.println("&lt;th&gt;Balance&lt;/th&gt;");
  out.println("&lt;th&gt;Current Account Rules&lt;/th&gt;");
  out.println("&lt;th&gt;Savings Account Rules&lt;/th&gt;");
  out.println("&lt;/tr&gt;");

  for(int i = 0; i &lt; accList.size(); i++){
   Account a = (Account)accList.get(i);
   if (a instanceof SavingsAccount){
    SavingsAccount sa = (SavingsAccount)a;
    out.println("&lt;tr&gt;");
    out.println("&lt;td&gt;"+sa.getAccountNo()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+sa.getName()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+sa.getAddress()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+sa.getBranchCode()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+sa.getInterestRate()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+sa.getMinBalance()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+sa.getBalance()+"&lt;/td&gt;");
    out.println("&lt;td&gt;&lt;/td&gt;");
    out.println("&lt;td&gt;"+sa.getSavingAccountRules()+"&lt;/td&gt;");
    out.println("&lt;/tr&gt;");
   }else if (a instanceof CurrentAccount){
    CurrentAccount ca = (CurrentAccount)a;
    out.println("&lt;tr&gt;");
    out.println("&lt;td&gt;"+ca.getAccountNo()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+ca.getName()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+ca.getAddress()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+ca.getBranchCode()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+ca.getInterestRate()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+ca.getMinBalance()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+ca.getBalance()+"&lt;/td&gt;");
    out.println("&lt;td&gt;"+ca.getCurrentAccountRules()+"&lt;/td&gt;");
    out.println("&lt;td&gt;&lt;/td&gt;");
    out.println("&lt;/tr&gt;");
   }
  }
  out.println("&lt;/table&gt;");
  out.println("Deleting both the accounts "+accNo+" and "+(accNo+1));
  //aas.deleteCurrentAccount(accNo);
  //aas.deleteSavingsAccount(accNo+1);
  //out.println("Accounts successfully deleted..!!");
 }  	

 protected void doPost(HttpServletRequest request, 
                       HttpServletResponse response) 
                       throws ServletException, 
                              IOException {
 }  
}
</pre>
</div></div>
<p>上面的Servlet客户端仅在表ACCOUNT中插入实体。删除实体的代码已被注释掉。我们可以编写各种客户端来查找EJB并在实体上执行操作。</p>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>persistence.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence 
 xmlns="http://java.sun.com/xml/ns/persistence"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
 version="1.0"
 xsi:schemaLocation="http://java.sun.com/xml/ns/persistence
 http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"&gt;
 
 &lt;persistence-unit name="SingleTableInheritance"&gt;
 &lt;description&gt;
   Single Table Inheritance example
 &lt;/description&gt;
 &lt;provider&gt;
  org.apache.openjpa.persistence.PersistenceProviderImpl
 &lt;/provider&gt;
 &lt;class&gt;com.sample.jpa.Account&lt;/class&gt;
 &lt;class&gt;com.sample.jpa.SavingsAccount&lt;/class&gt;
 &lt;class&gt;com.sample.jpa.CurrentAccount&lt;/class&gt;
 &lt;properties&gt;
  &lt;property 
   name="openjpa.ConnectionURL" 
   value="jdbc:derby:AccountDB" /&gt;
  &lt;property 
   name="openjpa.ConnectionDriverName" 
   value="org.apache.derby.jdbc.EmbeddedDriver" /&gt;
   &lt;property name="ConnectionUserName" value="app" /&gt;
   &lt;property name="openjpa.jdbc.SynchronizeMappings" 
    value="false" /&gt;
  &lt;/properties&gt;
 &lt;/persistence-unit&gt;
 &lt;!--
 &lt;jta-data-source&gt;PhoneBookPool&lt;/jta-data-source&gt;
 &lt;non-jta-data-source&gt;PhoneBookPool&lt;/non-jta-data-source&gt;
 --&gt;
&lt;/persistence&gt;
</pre>
</div></div>
<p>持久性架构使用AccountDB derby数据库。它还在持久性单元中声明实体。以下过程说明了如何部署/运行示例。</p>

<ul><li>创建一个包含包含所有实体类，ejb类和META-INF / persistence.xml的EJB应用程序的EAR应用程序</li><li>创建META-INF / ejb-jar.xml。由于我们使用了注释，因此不必在其中提供任何声明。</li><li>在EAR中创建一个WEB应用程序，并添加上述servlet。</li><li>使用管理控制台通过名称AccountDB创建一个derby数据库。</li><li>如下创建一个名为ACCOUNT的表。
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>帐户表</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
create table ACCOUNT(ACCOUNTNO integer, 
             ACCOUNTTYPE varchar(50), 
             NAME varchar(50), 
             ADDRESS varchar(225),
             BRANCHCODE integer, 
             INTERESTRATE decimal(15,2), 
             MINBALANCE decimal(15,2), 
             BALANCE decimal(15,2), 
             CURRENTACCOUNTRULES varchar(225), 
             SAVINGSACCOUNTRULES varchar(225))
</pre>
</div></div></li></ul>


<ul><li>使用以下输入运行servlet<br clear="none">
  <code><a shape="rect" class="external-link" href="http://localhost:8080/" rel="nofollow">http://localhost:8080/</a><web-context>/Test?accNo=1&name=Joe</code><br clear="none">
  <code><a shape="rect" class="external-link" href="http://localhost:8080/" rel="nofollow">http://localhost:8080/</a><web-context>/Test?accNo=3&name=John</code></li></ul>


<ul><li>以下数据将被插入到ACCOUNT表中。
<div class="preformatted panel" style="border-style:solid;border-width:1px"><div class="preformattedHeader panelHeader" style="border-bottom-width:1px;border-bottom-style:solid"><b>帐户表</b></div><div class="preformattedContent panelContent">
<pre>ACCOUNTNO ACCOUNTTYPE NAME ADDRESS BRANCHCODE INTERESTRATE MINBALANCE BALANCE CURRENTACCOUNTRULES SAVINGSACCOUNTRULES 
1 CURRENTACCOUNT Joe Joe's address 10 20.00 200.00 5000.00 Current Account!!  
2 SAVINGSACCOUNT Joe Joe's address 12 234.00 4534.00 13323.00  Savings Account!! 
3 CURRENTACCOUNT John John's address 10 20.00 200.00 5000.00 Current Account!!  
4 SAVINGSACCOUNT John John's address 12 234.00 4534.00 13323.00  Savings Account!!
</pre>
</div></div></li></ul>


<p>请注意，JPA已在CurrentAccount实体的ACCOUNTTYPE列中插入了CURRENTACCOUNT值，并为SavingsAccount实体插入了SAVINGSACCOUNT值。</p></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Creating deployment plans for Java Persistence API';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2013，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  

</body></html>