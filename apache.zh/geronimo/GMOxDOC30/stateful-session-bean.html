<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=2">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="Stateful Session Bean">
    <meta name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Stateful Session Bean">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2010-05-11">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0文档：有状态会话Bean</title>
  </head>

  <body  onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">主页</a> > <a href="documentation.html">文档</a> > <a href="developing.html">开发</a> > <a href="tutorials.html">教程</a> > <a href="developing-ejb-applications.html">开发EJB应用程序</a> > <a href="stateful-session-bean.html">有状态会话Bean</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo v3.0</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">有状态会话Bean</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645235"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645235">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645235"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645235">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645235"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645235">新增新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>

<p>该应用程序将带您了解有状态会话Bean的基础。该应用程序将演示如何在EJB3应用程序中使用@ Stateful，@ Resource，@ PostConstruct，@ PreDestroy，@ PrePassivate，@ PostActivate，@ Remove等注释。</p>

<p>基本上，只要需要维护会话，就使用有状态会话EJB。该示例是用户注册过程，其中注册过程是两步过程。第一页提示输入您的个人凭据，第二页提示输入您的帐单和信用卡信息。会话一直保持到用户填满两个jsp页面为止。之后，将完整的信息填充到数据库中。该应用程序具有一个Controller Servlet，它将从jsp客户端收到的调用路由到Bean类，setter方法和jsp页面。</p>

<p>要运行本教程，至少需要您安装以下必备软件。</p>

<ul><li>Sun JDK 5.0+（J2SE 1.5）</li><li>Eclipse 3.3.1.1（Europa发行版的Eclipse Classic软件包），特定于平台</li><li>Web工具平台（WTP）2.0.1</li><li>数据工具平台（DTP）1.5.1</li><li>Eclipse建模框架（EMF）2.3.1</li><li>图形编辑框架（GEF）3.3.1</li></ul>


<p><a shape="rect" href="development-environment.html">开发环境</a>部分中提供了有关安装Eclipse的详细信息。<br clear="none">本教程分为以下几节：</p>

<h1 id="StatefulSessionBean-CreatinganEJBproject">创建一个EJB项目</h1>
<p>本节分为以下几个部分：</p>
<h2 id="StatefulSessionBean-Settinguptheprojectenvironment">设置项目环境</h2>
<ol><li>右键单击<em>Project Explorer，</em>然后选择<strong>New-> EJB Project</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb1.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>将项目命名为<em>StatefulBean</em> 。选择<strong>下一步</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb2.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>按照屏幕快照中的建议标记字段，然后选择“ <strong>下一步”</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb3.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>取消选中“ <strong>生成部署描述符”</strong> 。这是因为我们在应用程序中使用注释，因此部署描述符是冗余实体。选择<strong>下一步</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb4.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>在下一个屏幕上，选择所有默认值，然后选择“ <strong>完成”</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb5.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none">这将为EJB项目创建一个框架。下一步是添加bean类，bean接口和setter / getter方法。</li><li>右键单击StatefulBean项目中的<strong>ejbModule</strong> ，然后选择<strong>New-> class</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb6.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>将类命名为<em>PersonalInfo，</em>并将包<em>命名</em>为<em>ejb.stateful</em> 。选择<strong>完成</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb7.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li></ol>


<h2 id="StatefulSessionBean-AddingJavaclassesandinterfaces">添加Java类和接口</h2>
<ol><li>将以下代码添加到<code>PersonalInfo.java</code> 。
<parameter ac:name="borderStyle">坚实的</parameter> <parameter ac:name="title">PersonalInfo.java</parameter> <plain-text-body>软件包ejb.stateful;公共类PersonalInfo实现java.io。可序列化{私有静态最终长serialVersionUID = 1L;私有字符串名字；私有字符串姓氏；私有字符串用户名；私有字符串密码；私人弦乐国籍； public void setFirstName（String FirstName）{此。FirstName = FirstName; } public void setLastName（String LastName）{此。LastName =姓氏； } public void setUserName（String UserName）{此。UserName = UserName; } public void setPassword（String Password）{此。密码=密码； } public void setNationality（String Nationality）{。国籍=国籍； } public String getFirstName（）{return FirstName; } public String getLastName（）{return LastName; } public String getUserName（）{return UserName; } public String getPassword（）{返回密码； } public String getNationality（）{返回国籍； }}</plain-text-body>
<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>同样创建一个类<code>BillingInfo.java</code>并添加以下代码。
<parameter ac:name="borderStyle">坚固的</parameter> <parameter ac:name="title">BillingInfo.java</parameter> <plain-text-body>软件包ejb.stateful;公共类BillingInfo实现java.io。可序列化{私有静态最终长serialVersionUID = 1L;私人弦屋私人弦街；私人弦城市；私有字符串密码私有String国家；私人弦乐银行；私人String cardno; public void setBank（String bank）{this.bank = bank; } public void setCardno（String cardno）{this.cardno = cardno; } public void setHouseNo（String houseNo）{this.houseNo = houseNo; } public void setStreet（String street）{this.street = street; } public void setCity（String city）{this.city = city; } public void setPincode（String pincode）{this.pincode = pincode; } public void setCountry（String country）{this.country = country; } public String getBank（）{返回银行； } public String getCardno（）{return cardno; } public String getHouseNo（）{return houseNo; } public String getStreet（）{return street; } public String getCity（）{返回城市； } public String getPincode（）{返回密码； } public String getCountry（）{返回国家； }}</plain-text-body> <code>PersonalInfo.java</code>和<code>BillingInfo.java</code>是用于设置和获取用户信息的类。</li><li>现在，我们将添加业务接口或bean接口。右键单击ejb.stateful软件包，然后选择<strong>New-> Interface</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb8.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>将接口命名为<em>AccountCreator</em>并选择<strong>Finish</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb9.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>将以下代码添加到<strong>AccountCreator</strong>界面。
<parameter ac:name="borderStyle">坚实的</parameter> <parameter ac:name="title">AccountCreator.java</parameter> <plain-text-body>软件包ejb.stateful;导入javax.ejb。远程; @远程公共接口AccountCreator {void addPersonalInfo（PersonalInfo personalinfo）; void addBillingInfo（BillingInfo billinginfo）; void createAccount（）; }</plain-text-body> <strong>注</strong> ：输入此代码后，您可能会看到可以解决@EJB之类的错误。当前，geronimo eclipse插件有一些限制，很快就会解决。我们很快会建议您如何摆脱这些错误。</li><li>下一步是将实现添加到接口。右键单击<strong>ejb.stateful</strong>接口，然后选择<strong>New-> class</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb10.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>将bean类命名为<em>AccountCreatorBean</em>并选择<strong>Finish</strong> 。<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb11.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>将以下代码添加到<strong>AccountCreatorBean中</strong> 。
<parameter ac:name="borderStyle">坚实的</parameter> <parameter ac:name="title">AccountCreatorBean.java</parameter> <plain-text-body>软件包ejb.stateful;导入java.sql。连接;导入java.sql。声明;导入javax.annotation。PostConstruct;导入javax.annotation。预销毁；导入javax.annotation。资源；导入javax.ejb。PostActivate;导入javax.ejb。预钝化；导入javax.ejb。去掉;导入javax.ejb。有状态导入javax.sql。数据源; @Stateful公共类AccountCreatorBean实现AccountCreator {@Resource（name =“ jdbc / userds”）私有DataSource数据源；专用连接连接；私人PersonalInfo personalinfo = new PersonalInfo（）;私人BillingInfo billinginfo = new BillingInfo（）; public AccountCreatorBean（）{super（）; } @PostConstruct @PostActivate public void openConnection（）{试试{connection = datasource.getConnection（）; } catch（Exception e）{e.printStackTrace（）; }} @PreDestroy @PrePassivate public void closeConnection（）{connection = null; } public void addPersonalInfo（PersonalInfo personalinfo）{this.personalinfo = personalinfo; } public void addBillingInfo（BillingInfo billinginfo）{this.billinginfo = billinginfo; } @删除公共无效的createAccount（）{试试{System.out.println（personalinfo.getFirstName（））;语句语句= connection.createStatement（）;字符串sql =“ INSERT INTO USERINFO（” +“ FIRSTNAME，” +“ LASTNAME，” +“ USERNAME”，+“ PASSWORD，” +“ PINCODE，” +“ CARDNO）值（” +“'” + personalinfo.getFirstName（ ）+“'，” +“'” + personalinfo.getLastName（）+“'，” +“'” + personalinfo.getUserName（）+“'，” +“'+ + personalinfo.getPassword（）+”'， “ +”'“ + billinginfo.getPincode（）+”'，“ +”'“ + billinginfo.getCardno（）+”'“ +”）“; statement.execute（sql）; statement.close（）; } catch（Exception e）{e.printStackTrace（）; }}}</plain-text-body>一旦你添加的代码，你会看到很多的错误，但是这很容易解决，在接下来的步骤中。代码中的错误是由于服务器运行时缺少类。</li></ol>


<h2 id="StatefulSessionBean-Makingadditionalconfigurations">进行其他配置</h2>
<p>解决以下错误。</p>
<ol><li>右键单击<strong>StatefulBean</strong>项目，然后选择<strong>Properties</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb12.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>在下一个屏幕上，选择<strong>Java Build Path-> Libraries-> Add External Jars</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb13.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>浏览到<code><GERONIMO_HOME>/repository/org/apache/geronimo/specs/geronimo-ejb_3.0_spec/1.0.1</code>并选择<strong>geronimo-ejb_3.0_spec-1.0.1.jar</strong> 。选择<strong>打开</strong> 。<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb14.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>类似地，浏览到<strong><geronimo_home>/repository/org/apache/geronimo/specs/geronimo-annotation_1.0_spec/1.1.1</geronimo_home></strong>并添加<code>geronimo-annotation_1.0_spec-1.1.1.jar</code> 。<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb15.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>完成后，您可以看到两个罐子。选择<strong>确定</strong> 。<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/ejb16.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li></ol>


<p>让我们遍历EJB bean类代码。</p>
<ul><li>@Stateful公共类AccountCreatorBean实现AccountCreator- @ Stateful注释将Bean类声明为Stateful类。</li><li>@Resource（name =“ jdbc / userds”）DataSource数据源；这是在使用@Resource批注注入数据源的情况下，将资源注入到Bean类中。我们很快将看到如何在geronimo中创建数据源。
	<ul><li>public AccountCreatorBean *-这是bean类的构造函数，每当收到来自新客户端连接的请求时，它将用于创建bean实例。</li></ul>
	</li><li>@ PostConstruct，@ PostActivate public void openConnection（）-@PostConstruct和@PostActivate是注释，它们基本上被称为生命周期回调注释。这些注释的生命周期如下<ul><li>使用默认构造函数创建新的bean实例。</li><li>资源注入</li><li>现在调用<strong>PostConstruct</strong>方法，在我们的例子中是打开数据库连接。</li><li>在已钝化并需要重新激活的bean实例上调用<strong>PostActivate</strong> 。它与PostConstruct遵循的周期相同。</li><li>@PreDestroy @PrePassivate public void closeConnection（）-同样，@ PreDestroy和@PrePassivate是Lifecycle回调注释。这些注释的生命周期如下</li><li>使用池中的Bean实例，并调用业务方法。</li><li>一旦客户端空闲一段时间，容器就会钝化bean实例。在容器钝化bean之前，将调用closeConnection函数。</li><li>如果客户端在一段时间内未调用钝化的Bean，则会将其销毁。</li></ul>
	</li><li>public void addPersonalInfo（PersonalInfo personalinfo）和public void addBillingInfo（BillingInfo billinginfo）-调用这两个函数来存储各种调用中的客户端数据。
	<ul><li>@Remove public void createAccount（）-销毁bean有两种方法，因此，在客户端会话以有状态bean结束的情况下，销毁销毁bean。一种是当bean被钝化并且未被客户端重新调用时，因此bean实例被破坏了。另一种方法是使用@Remove批注。客户端确认并提交所有必需的信息后，数据将填充到数据库中，会话即在此结束。</li></ul>
	</li></ul>


<h1 id="StatefulSessionBean-Creatingadatabaseusingtheadministrativeconsole">使用管理控制台创建数据库</h1>
<ol><li>启动服务器，并使用URL <a shape="rect" class="external-link" href="http://localhost:8080/console" rel="nofollow">http：// localhost：8080 / console</a>在管理控制台中<a shape="rect" class="external-link" href="http://localhost:8080/console" rel="nofollow">进餐</a> 。</li><li>输入默认的用户名和密码。</li><li>在欢迎页面的“ <em>嵌入式数据库”下</em> ，选择“ <strong>数据库管理器”</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDB1.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>在下一页上，创建一个名为<em>userdbs</em>的数据库，然后选择<strong>Create</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDB2.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>完成后，您可以在“数据库”下的“数据库查看器” portlet中看到<strong>userdbs</strong>数据库。这确认数据库已成功创建。<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDB3.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>如图“ <em>使用数据库”</em>下的图所示，从下拉框中选择<strong>userdbs</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDB4.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>跑过<code>userinfo.sql</code>脚本。选择<strong>Run Sql</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDB5.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none">
<parameter ac:name="borderStyle">坚固的</parameter> <parameter ac:name="title">userinfo.sql</parameter> <plain-text-body>创建表userinfo（firstname varchar（20），lastname varchar（20），username varchar（20），password varchar（20），pincode varchar（20），cardno varchar（20））</plain-text-body></li><li>验证表创建是否成功。选择“ <strong>应用程序”</strong> ，如图所示。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDB6.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>下一个屏幕提示该表已成功创建。要查看表的内容，请选择“ <strong>查看目录”</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDB7.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>该表当前为空，如图所示。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDB8.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li></ol>


<h1 id="StatefulSessionBean-Creatingadatasourceusingtheadministrativeconsole">使用管理控制台创建数据源</h1>
<ol><li>启动服务器并使用URL <a shape="rect" class="external-link" href="http://localhost:8080/console" rel="nofollow">http：// localhost：8080 / console</a>启动管理<a shape="rect" class="external-link" href="http://localhost:8080/console" rel="nofollow">控制台</a> 。</li><li>输入默认的用户名和密码。</li><li>进入欢迎页面。在控制台导航中，在“ <em>服务”下</em> ，选择“ <strong>数据库池”</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDS.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>在下一个屏幕上，使用Geronimo数据库池向导创建一个新的数据库池。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDS2.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>在下一个屏幕上，输入图中建议的名称。这将启动创建Derby Embedded XA数据源的过程。<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDS3.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>选择驱动程序jar，并将数据库名称命名为<em>userdbs</em> （请记住，这是我们在上一步中创建的数据库）。其余所有字段都可以设置为默认值。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDS4.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>选择<strong>部署</strong>以部署连接器计划。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDS5.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>完成后，您可以在可用数据库池中看到数据库池<strong>jdbc / userds</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/createDS6.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li></ol>


<h1 id="StatefulSessionBean-CreatingaWebbasedapplicationclient">创建基于Web的应用程序客户端</h1>
<ol><li>右键单击<em>Project Explorer下的，</em>然后选择<strong>New-> Dynamic Web Project。</strong><br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web1.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>将项目命名为<em>StatefulClient</em>并选择<strong>Next</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web2.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>保持默认设置，如图所示。选择<strong>下一步</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web3.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>在下一个屏幕上，保留默认值。选择<strong>下一步</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web4.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>该屏幕上的默认值也是如此。选择<strong>完成</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web5.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>右键单击<strong>StatefulClient</strong>项目，然后选择<strong>New-> Servlet</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web6.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>将包命名为<em>ejb.stateful，</em>并将Servlet <em>命名</em>为<em>Controller</em> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web7.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>保留默认值，然后选择<strong>下一步</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web8.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>保留默认值，然后选择<strong>完成</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web9.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>一旦创建了servlet，它就会显示错误。这是由于运行时缺少Servlet API。这很容易解决。右键单击<strong>StatefulClient</strong>项目，然后选择“ <strong>属性”</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web10.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>在下一个屏幕上，选择<strong>Java构建路径，</strong>然后选择<strong>库</strong> 。<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web11.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>选择<strong>添加外部罐子</strong> 。<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web12.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>浏览到您的<code><GERONIMO_HOME>\repository\org\apache\geronimo\specs\geronimo-servlet_2.5_spec\1.1.2</code>并选择<strong>geronimo-servlet_2.5_spec-1.1.2.jar</strong>并选择<strong>打开</strong> 。<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web13.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>在下一个屏幕上选择<strong>确定</strong> ，这将删除所有错误。<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web14.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>将以下代码添加到<code>Controller.java</code> servlet。
<parameter ac:name="borderStyle">坚实的</parameter> <parameter ac:name="title">Controller.java</parameter> <plain-text-body>软件包ejb.stateful;导入java.io。IOException;导入java.util。属性；导入javax.naming。上下文；导入javax.naming。InitialContext;导入javax.servlet。RequestDispatcher;导入javax.servlet。ServletException;导入javax.servlet.http。HttpServletRequest;导入javax.servlet.http。HttpServletResponse;导入javax.servlet.http。HttpSession; / ** * Servlet的Servlet实现类：Controller * * /公共类Controller扩展了javax.servlet.http。HttpServlet实现javax.servlet。Servlet {静态最终长serialVersionUID = 1L; AccountCreator ac; / *（非Java-doc）* @see javax.servlet.http。HttpServlet＃HttpServlet（）* / public Controller（）{super（）; } / *（非Java-doc）* @请参阅javax.servlet.http。HttpServlet＃doGet（HttpServletRequest请求，HttpServletResponse响应）* /受保护的无效doProcess（HttpServletRequest请求，HttpServletResponse响应）抛出ServletException，IOException {/ * PrintWriter out = response.getWriter（）; out.println（request.getRequestURI（））; * / try {属性prop = new Properties（）; prop.put（上下文INITIAL_CONTEXT_FACTORY，“ org.apache.openejb.client。RemoteInitialContextFactory“）; prop.put（” java.naming.provider.url“，” ejbd：// localhost：4201“）;上下文上下文=新的InitialContext（prop）; ac =（AccountCreator）context.lookup（” AccountCreatorBeanRemote“ ）;} catch（Exception e）{e.printStackTrace（）;} if（（request.getRequestURI（））。equals（“ / StatefulClient / Controller”））{PersonalInfo personalinfo = new PersonalInfo（）; personalinfo.setFirstName（request .getParameter（“ FirstName”））; personalinfo.setLastName（request.getParameter（“ LastName”））; personalinfo.setNationality（request.getParameter（“ Nationality”））; personalinfo.setUserName（request.getParameter（“ UserName”）） ; personalinfo.setPassword（request.getParameter（“ Password”）））; ac.addPersonalInfo（personalinfo）; HttpSession hs = request.getSession（true）; hs.setAttribute（“ handle”，ac）; RequestDispatcher rd = request.getRequestDispatcher（ “” BillingInfo.jsp“）; rd.forward（request，response）;}其他{BillingInfo billingInfo = new BillingInfo（）; billingInfo.setBank（request.getParameter（” Bank“）））; billingInfo.setCa rdno（request.getParameter（“ CardNo”））; billingInfo.setCity（request.getParameter（“ City”））;; billingInfo.setCountry（request.getParameter（“ Country”）））; billingInfo.setHouseNo（request.getParameter（“ HouseNo”））; billingInfo.setPincode（request.getParameter（“ PinCode”）））; billingInfo.setStreet（request.getParameter（“ Street”）））; HttpSession hs = request.getSession（true）; ac =（AccountCreator）hs.getAttribute（“ handle”）; ac.addBillingInfo（billingInfo）; ac.createAccount（）; PrintWriter out = response.getWriter（）; out.println（“帐户创建成功”）; }}受保护的void doGet（HttpServletRequest request，HttpServletResponse response）抛出ServletException，IOException {// TODO自动生成的方法stub doProcess（request，response）; } / *（非Java-doc）* @请参阅javax.servlet.http。HttpServlet＃doPost（HttpServletRequest请求，HttpServletResponse响应）* /受保护的void doPost（HttpServletRequest请求，HttpServletResponse响应）抛出ServletException，IOException {doProcess（request，response）; // TODO自动生成的方法存根}}</plain-text-body>
<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none">该servlet包含引用bean接口类以及PersonalInfo和BilllingInfo类的代码。我们需要将这些项目添加到构建路径中，以便可以编译类。</li><li>右键单击<strong>StatefulClient</strong>项目，然后选择<strong>Properties-> Java Build Path-> Projects</strong> 。选择<strong>添加</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web15.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>检查<strong>StatefulBean</strong>并选择<strong>OK</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web16.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>完成后，该项目将在构建路径中可见。选择<strong>确定</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web17.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>下一步是将jsp页面添加到我们的客户项目中。右键单击<strong>StatefulClient</strong>项目下的<strong>WebContent</strong> ，然后选择<strong>New-> jsp</strong> 。<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web18.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>将jsp命名为<code>PersonalInfo.jsp</code>然后选择<strong>下一步</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web19.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>在下一个屏幕上，选择<strong>完成</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/web20.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>将以下代码添加到<code>PersonalInfo.jsp</code> 。
<parameter ac:name="borderStyle">稳定的</parameter> <parameter ac:name="title">PersonalInfo.jsp</parameter> <plain-text-body><％@页面语言=“ java” contentType =“ text / html; charset = ISO-8859-1” pageEncoding =“ ISO-8859-1”％> 

<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>用户个人信息</title>


<form action="Controller">
<h1>输入您的个人信息</h1>
<table>
<tbody><tr>
<td><h3>名称</h3></td>
</tr>
<tr>
<td>名字</td>
<td><input type="text" name="FirstName"></td>
</tr>
<tr>
<td>姓</td>
<td><input type="text" name="LastName"></td>
</tr>
<tr><td><h3>国籍</h3></td></tr>
<tr>
<td>国籍</td>
<td><input type="text" name="Nationality"></td>
</tr>
<tr><td><h3>登录</h3></td></tr>
<tr>
<td>用户名</td>
<td><input type="text" name="UserName"></td>
</tr>
<tr>
<td>密码</td>
<td><input type="password" name="Password"></td>
</tr>
</tbody></table>
<input type="submit" name="Next">
</form>


</plain-text-body>
<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>类似地，添加另一个名称为<code>BillingInfo.jsp</code>并添加以下代码。<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none">
<parameter ac:name="borderStyle">固体</parameter> <parameter ac:name="title">BillingInfo.jsp</parameter> <plain-text-body><％@页面语言=“ java” contentType =“ text / html; charset = ISO-8859-1” pageEncoding =“ ISO-8859-1”％> 

<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>用户账单信息</title>



<form action="Controller1">
<h1>输入您的帐单信息</h1>
<table>
<tbody><tr>
<td><h3>地址</h3></td>
</tr>
<tr>
<td>门牌号</td>
<td><input type="text" name="HouseNo"></td>
</tr>
<tr>
<td>街</td>
<td><input type="text" name="Street"></td>
</tr>
<tr>
<td>市</td>
<td><input type="text" name="City"></td>
</tr>
<tr>
<td>PIN码</td>
<td><input type="text" name="PinCode"></td>
</tr>
<tr>
<td>国家</td>
<td><input type="text" name="Country"></td>
</tr>
<tr><td><h3>信用卡资料</h3></td></tr>
<tr>
<td>银行</td>
<td><input type="text" name="Bank"></td>
</tr>
<tr>
<td>卡号</td>
<td><input type="text" name="CardNo"></td>
</tr>
</tbody></table>
<input type="submit" name="Submit">
</form>


</plain-text-body></li></ol>


<p>让我们来看一下servlet和jsp代码。首先通过Controller Servlet代码。</p>
<ol><li>
	<ul><li><strong>if（（request.getRequestURI（））。equals（“ / StatefulClient / Controller”））</strong> -此代码充当发出请求的jsp的控制器。仅当jsp调用具有不同名称的servlet时，这才可能。下一部分将说明如何完成此操作。</li><li><strong>HttpSession hs = request.getSession（true）; hs.setAttribute（“ handle”，ac）;</strong>这部分代码保存了远程接口句柄，稍后在第二个调用中，使用同一句柄再次调用bean方法。</li><li><strong>RequestDispatcher rd = request.getRequestDispatcher（“ BillingInfo.jsp”）</strong> -此代码节和下一行将控件转发到下一个jsp，即<strong>BillingInfo.jsp</strong> 。</li><li>其余的servlet处理调用setter方法，然后设置对象，以便在不同的调用之间保留数据。</li></ul>
	</li><li>下一步演练jsp代码。
	<ul><li>PersonalInfo.jsp具有<strong><form action="Controller"></form></strong>而BillingInfo.jsp具有<strong><form action="Controller1"></form></strong>作为操作元素，但两者都内部调用相同的servlet。通过修改<strong>web.xml</strong>可以很容易地做到这一点，这将在下一部分中显示。</li></ul>
	</li></ol>


<h1 id="StatefulSessionBean-Modifyingopenejb-jar.xml,web.xmlandgeronimo-web.xml">修改openejb-jar.xml，web.xml和geronimo-web.xml</h1>
<ol><li>在<strong>StatefulBean</strong>项目中，选择<strong>META-INF / openejb-jar.xml</strong>并将现有代码替换为以下代码<parameter ac:name="borderStyle">固体</parameter> <parameter ac:name="title">openejb-jar.xml</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" standalone="yes" ?=""--><openejb-jar xmlns="http://www.openejb.org/xml/ns/openejb-jar-2.2" xmlns:nam="http://geronimo.apache.org/xml/ns/naming-1.2" xmlns:pkgen="http://www.openejb.org/xml/ns/pkgen-2.0" xmlns:sec="http://geronimo.apache.org/xml/ns/security-1.2" xmlns:sys="http://geronimo.apache.org/xml/ns/deployment-1.2"><environment><moduleid><groupid>默认</groupid> <artifactid>StatefulBean</artifactid> <version>1.0</version> <type>car</type></moduleid> <sys:dependencies><sys:dependency><sys:groupid>console.dbpool</sys:groupid> <sys:artifactid>jdbc / userds</sys:artifactid></sys:dependency></sys:dependencies></environment></openejb-jar><!--?xml--></plain-text-body>上面的部署计划与上面的部署计划不同：道路<ul><li>geronimo eclipse插件生成的名称空间不是AG 2.1级别。这是由于某些限制，很快就会解决。</li><li>由于ejb bean类引用jdbc / userds数据源<strong><dependency></dependency></strong>元素必须在EJB部署计划中添加。</li></ul>
	</li><li>在<strong>StatefulClient</strong>项目中，选择<strong>WEB-INF / web.xml</strong>并将现有代码替换为以下<parameter ac:name="borderStyle">固体</parameter> <parameter ac:name="title">web.xml</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><web-app id="WebApp_ID" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee" xmlns:web="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" xsi:schemalocation="http://java.sun.com/xml/ns/javaee 
http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" version="2.5"><display-name>StatefulClient</display-name> <welcome-file-list><welcome-file>index.html</welcome-file> <welcome-file>index.htm</welcome-file> <welcome-file>index.jsp</welcome-file> <welcome-file>default.html</welcome-file> <welcome-file>default.htm</welcome-file> <welcome-file>default.jsp</welcome-file></welcome-file-list> <servlet><description></description> <display-name>控制器</display-name> <servlet-name>控制器</servlet-name> <servlet-class>ejb.stateful。控制者</servlet-class></servlet> <servlet><description></description> <display-name>Controller1</display-name> <servlet-name>Controller1</servlet-name> <servlet-class>ejb。有状态。控制器</servlet-class></servlet> <servlet-mapping><servlet-name>控制器</servlet-name> <url-pattern>/控制器</url-pattern></servlet-mapping> <servlet-mapping><servlet-name>控制器1</servlet-name> <url-pattern>/控制器1</url-pattern></servlet-mapping>
</web-app>
<!--?xml--></plain-text-body></li><li>在<strong>StatefulClient</strong>项目中，选择<strong>WEB-INF / geronimo-web.xml</strong>并为StatefulBean EJB项目添加一个依赖项元素。最终的Web部署计划如下所示： <parameter ac:name="borderStyle">坚实的</parameter> <parameter ac:name="title">geronimo-web.xml</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" standalone="yes" ?=""--><ns8:web-app xmlns="http://geronimo.apache.org/xml/ns/deployment-1.2" xmlns:ns2="http://geronimo.apache.org/xml/ns/j2ee/connector-1.2" xmlns:ns3="http://geronimo.apache.org/xml/ns/naming-1.2" xmlns:ns4="http://geronimo.apache.org/xml/ns/j2ee/ejb/openejb-2.0" xmlns:ns5="http://geronimo.apache.org/xml/ns/j2ee/application-2.0" xmlns:ns6="http://geronimo.apache.org/xml/ns/security-2.0" xmlns:ns7="http://java.sun.com/xml/ns/persistence" xmlns:ns8="http://geronimo.apache.org/xml/ns/j2ee/web-2.0.1" xmlns:ns9="http://geronimo.apache.org/xml/ns/j2ee/application-client-2.0"><environment><moduleid><groupid>默认的</groupid> <artifactid>StatefulClient</artifactid> <version>1.0</version> <type>汽车</type></moduleid> <dependencies><dependency><groupid>默认的</groupid> <artifactid>StatefulBean</artifactid> <version>1.0</version> <type>汽车</type></dependency></dependencies></environment> <ns8:context-root>/ StatefulClient</ns8:context-root></ns8:web-app><!--?xml--></plain-text-body></li></ol>


<p>上面的代码与原始代码有所不同，因为我们添加了另一个代码<strong><servlet></servlet></strong>映射到同一Servlet类的Controller1。同样添加一个<strong><servlet-mapping></servlet-mapping></strong> Controller1 servlet的元素。此功能基本上是使用同一个servlet类映射多个servlet。这有助于路由来自Controller servlet中jsp的每个调用。</p>

<h1 id="StatefulSessionBean-DeployandRun">部署并运行</h1>
<ol><li>在项目浏览器下，右键单击<strong>StatefulBean</strong>项目，然后选择<strong>Export-> EJB jar文件</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/run1.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>浏览到目的地，然后选择<strong>完成</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/run2.png"></span></li><li>同样，导出<strong>StatefulClient</strong>项目。</li><li>使用<a shape="rect" class="external-link" href="http://localhost:8080/console" rel="nofollow">http：// localhost：8080 / console</a>启动管理<a shape="rect" class="external-link" href="http://localhost:8080/console" rel="nofollow">控制台</a> 。在应用程序下，选择<strong>Deploy New</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/run3.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>浏览到StatefulBean项目，然后选择<strong>Install</strong> 。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/run4.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>类似地，部署StatefulClient项目。</li><li>使用链接<a shape="rect" class="external-link" href="http://localhost:8080/StatefulClient/PersonalInfo.jsp" rel="nofollow">http：// localhost：8080 / StatefulClient / PersonalInfo.jsp</a>启动应用程序。填写表格，然后选择SubmitQuery。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/run5.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>提交当前页面后，将显示下一页，您需要在其中输入您的帐单信息。完成后，选择SubmitQuery。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/run6.png"></span><br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>稍后，您可以验证填充有用户数据的数据库。<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="stateful-session-bean.data/run7.png"></span></li></ol></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Stateful Session Bean';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2013，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  

</body></html>