<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=0">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="timereport - Web Application Security Sample">
    <meta name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi timereport - Web Application Security Sample">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2010-05-11">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0文档：timereport-Web应用程序安全性样本</title>
  </head>

  <body  onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">Home</a> > <a href="documentation.html">文档</a> > <a href="reference.html">参考</a> > <a href="samples.html">示例</a> > <a href="java-ee-sample-applications.html">Java EE示例应用程序</a> > <a href="timereport-web-application-security-sample.html">timereport-Web应用程序安全性示例</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo v3.0</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">timereport-Web应用程序安全性示例</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645368"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645368">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645368"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645368">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645368"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645368">新增新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>

<p>本文重点介绍Apache Geronimo服务器与Web应用程序安全性相关的功能。本文介绍的示例应用程序是一个基本的时间报告系统，该系统使用geronimo SQLLoginModule和derby数据库使用Servlet，JSP和J2EE声明式安全性。<br clear="none">阅读本文之后，您应该能够为具有声明性安全功能的Web应用程序配置Geronimo应用服务器。</p>

<rich-text-body>
<p>注意：在执行经理功能时，该示例实际上并未添加新员工。将来可能会添加此功能。但是，该示例确实演示了一种使用预定义用户实现Web应用程序安全性的方法。</p></rich-text-body>

<p>本文分为以下几节。</p>


<h1 id="timereport-WebApplicationSecuritySample-WebApplicationsinGeronimo">Geronimo中的Web应用程序</h1>

<p>Apache Geronimo包含一个支持J2EE Web应用程序的Web应用程序容器。Web容器本身支持基本配置，例如网络端口和SSL选项，并且每个Web应用程序也可能包含Geronimo特定的配置信息。Web应用程序参与了Geronimo安全基础结构，因此，通过对Web应用程序进行身份验证，还可以访问安全的EJB和连接器。</p>

<p>Apache Geronimo支持两个Web容器：Jetty和Tomcat。</p>

<h2 id="timereport-WebApplicationSecuritySample-Jetty">码头</h2>
<p>Jetty是100％的Java HTTP Server和Servlet容器。这意味着您无需配置和运行单独的Web服务器即可使用Servlet和JSP生成动态内容。Jetty是用于静态和动态内容的功能齐全的Web服务器。</p>

<p>与单独的服务器/容器解决方案不同，Jetty的Web服务器和Web应用程序在同一过程中运行，而没有互连开销和复杂性。此外，作为一个纯Java组件，Jetty可以轻松地包含在您的应用程序中以进行演示，分发或部署。所有Java支持的平台上都可以使用Jetty。<br clear="none">
<a shape="rect" class="external-link" href="http://jetty.mortbay.org/jetty/index.html" rel="nofollow">http://jetty.mortbay.org/jetty/index.html</a></p>

<parameter ac:name="title">信息</parameter> <rich-text-body>
<p>3.0或更高版本不支持Jetty组装。</p></rich-text-body>


<h2 id="timereport-WebApplicationSecuritySample-Tomcat">雄猫</h2>
<p>Apache Tomcat是由Apache Software Foundation开发的servlet容器。<br clear="none">
<a shape="rect" class="external-link" href="http://tomcat.apache.org/">http://tomcat.apache.org/</a></p>

<h1 id="timereport-WebApplicationSecuritySample-Applicationoverview">应用概述</h1>

<p>时间报告应用程序有助于报告不同项目的工作时间。尽管这不是一个完整的时间报告应用程序，但它涵盖了Apache Geronimo中大多数与显示和安全相关的功能。</p>

<p>此示例应用程序使用两个安全角色，即经理和雇员。两种类型的用户都必须在报告时间任务之前提供其凭据。</p>

<p>员工角色允许用户报告时间。<br clear="none">经理角色允许用户添加员工。<br clear="none">此应用程序的配置说明了基于分层角色的访问控制的一种简单形式，其中javaee角色具有不相交的权限，并且从组主体到应用程序角色的映射为经理组中的用户提供了雇员角色。</p>

<p>时间报告应用程序具有以下页面列表。</p>
<ul><li>欢迎</li><li>登录</li><li>时间报告</li><li>新增员工</li><li>登出</li></ul>


<p>下图说明了应用程序流程的概述：</p>

<p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="timereport-web-application-security-sample.data/time_report_flow.gif"></span></p>

<p>默认情况下，给定的示例应用程序被定向到带有“时间报告”功能的链接的“欢迎”页面。用户可以通过在“登录”页面上提供有效的用户名和密码来访问“时间报告”页面。如果提供的那些用户凭据来自管理员角色，则“时间报告”页面还将显示指向“添加员工”功能的附加链接。</p>

<h2 id="timereport-WebApplicationSecuritySample-Applicationcontents">申请内容</h2>
<p>以下是“时间报告”应用程序的主文件夹层次结构。它显示应用程序中使用的JSP和配置文件。</p>

<parameter ac:name="borderColor">#FFFFFF</parameter> <parameter ac:name="bgColor">#FFFFFF</parameter> <parameter ac:name="borderStyle">固定</parameter> <plain-text-body>|-员工+-index.jsp |-登录+-login.jsp +-login_error.jsp +-logout.jsp |-经理+-index.jsp |-WEB_INF +-web.xml |-索引.jsp</plain-text-body>

<p>除了上述JSP和配置之外，还需要两个其他servlet来实现应用程序的业务逻辑。</p>
<ul><li>AddTimeRecordServlet-从“时间报告”页面读取输入数据</li><li>AddEmployeeServlet-从“添加员工”页面捕获输入信息</li></ul>


<p>时间报告应用程序的安全性配置由Geronimo部署计划<strong>plan.xml</strong>和<strong>web.xml</strong>文件处理。</p>

<p><strong>web.xml</strong>包括将用户角色与Web应用程序中的资源相关联的标准安全约束。</p>

<parameter ac:name="">xml</parameter> <parameter ac:name="title">web.xml</parameter> <parameter ac:name="borderStyle">solid</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><!--
    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements. See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership. The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License. You may obtain a copy of the License at
    
    http://www.apache.org/licenses/LICENSE-2.0
    
    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied. See the License for the
    specific language governing permissions and limitations
    under the License.
--> <web-app xmlns="http://java.sun.com/xml/ns/j2ee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://java.sun.com/xml/ns/j2ee
	 http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd" version="2.4"><welcome-file-list><welcome-file>index.html</welcome-file></welcome-file-list> <security-constraint><web-resource-collection><web-resource-name>员工</web-resource-name> <url-pattern>/ employee / *</url-pattern></web-resource-collection> <auth-constraint><role-name>员工</role-name></auth-constraint></security-constraint> <security-constraint><web-resource-collection><web-resource-name>经理</web-resource-name> <url-pattern>/ manager / *</url-pattern></web-resource-collection> <auth-constraint><role-name>经理</role-name></auth-constraint></security-constraint> <login-config><auth-method>FORM</auth-method> <realm-name>TimeReportRealm</realm-name> <form-login-config><form-login-page>/login/login.jsp</form-login-page> <form-error-page>/login/login_error.jsp</form-error-page></form-login-config></login-config> <security-role><role-name>员工</role-name></security-role> <security-role><role-name>经理</role-name></security-role> <servlet><display-name>AddTimeRecordServlet</display-name> <servlet-name>AddTimeRecordServlet</servlet-name> <servlet-class>org.apache.geronimo.samples.timereport.web 。AddTimeRecordServlet</servlet-class></servlet> <servlet><display-name>AddEmployeeServlet</display-name> <servlet-name>AddEmployeeServlet</servlet-name> <servlet-class>org.apache.geronimo.samples.timereport.web。AddEmployeeServlet</servlet-class></servlet> <servlet-mapping><servlet-name>AddTimeRecordServlet</servlet-name> <url-pattern>/ employee / add_timerecord</url-pattern></servlet-mapping> <servlet-mapping><servlet-name>AddEmployeeServlet</servlet-name> <url-pattern>/ manager / add_employee</url-pattern></servlet-mapping>

</web-app>
<!--?xml--></plain-text-body>

<p>Geronimo部署计划包含特定于Geronimo的安全配置，包括安全领域的配置和相关的主要角色映射<strong>（plan.xml中</strong>在timereport / timereport-tomcat的/目标/资源/ META-INF / plan.xml的建设项目后发现）从安全领域到上面在<strong>web.xml中</strong>定义的应用程序角色的主体这个项目使用两个角色，经理和雇员。有一个业务规则，即每个经理都是雇员。这是通过主体角色映射实施的：EmployeeGroup和ManagerGroup都暗含应用程序特定的员工角色。</p>


<parameter ac:name="">xml</parameter> <parameter ac:name="title">plan.xml</parameter> <parameter ac:name="borderStyle">solid</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><!--Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at
    
     http://www.apache.org/licenses/LICENSE-2.0
    
    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.--> <!--$Rev: 497879 $ $Date: 2007-01-19 12:11:01 -0500 (Fri, 19 Jan 2007) $--> <web-app xmlns="http://geronimo.apache.org/xml/ns/j2ee/web-2.0.1"><dep:environment xmlns:dep="http://geronimo.apache.org/xml/ns/deployment-1.2"><dep:moduleid><dep:groupid>org.apache.geronimo.samples.javaee5</dep:groupid> <dep:artifactid>timereport-tomcat</dep:artifactid> <dep:version>3.0-beta-1</dep:version> <dep:type>car</dep:type></dep:moduleid> <dep:dependencies><dep:dependency><dep:groupid>org.apache.geronimo.samples</dep:groupid> <dep:artifactid>sample-datasource</dep:artifactid> <dep:version>3.0-beta-1</dep:version> <dep:type>car</dep:type></dep:dependency> <dep:dependency><dep:groupid>org.apache.geronimo.configs</dep:groupid> <dep:artifactid>jasper</dep:artifactid> <dep:version>3.0 -beta-1</dep:version> <dep:type>汽车</dep:type></dep:dependency> <dep:dependency><dep:groupid>org.apache.geronimo.configs</dep:groupid> <dep:artifactid>tomcat7</dep:artifactid> <dep:version>3.0-beta-1</dep:version> <dep:type>汽车</dep:type></dep:dependency></dep:dependencies> <dep:hidden-classes></dep:hidden-classes><dep:non-overridable-classes></dep:non-overridable-classes><dep:private-classes></dep:private-classes></dep:environment> <security-realm-name>timereport</security-realm-name> <context-root>-tomcat</context-root> <security-realm-name>TimeReportRealm</security-realm-name> <security><default-principal realm-name="TimeReportRealm"><principal name="anonymous" class="org.apache.geronimo.security.realm.providers.GeronimoUserPrincipal"></principal></default-principal> <role-mappings><role role-name="employee"><realm realm-name="TimeReportRealm"><principal name="EmployeeGroup" class="org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal"></principal></realm> <realm realm-name="TimeReportRealm"><principal name="ManagerGroup" class="org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal"></principal></realm></role> <role role-name="manager"><realm realm-name="TimeReportRealm"><principal name="ManagerGroup" class="org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal"></principal></realm></role></role-mappings></security> <gbean name="DBInitialization" class="org.apache.geronimo.connector.wrapper.DatabaseInitializationGBean"><!--<attribute name="testSQL">select * from users</attribute>--> <attribute name="path">TimeReportDB.sql</attribute> <reference name="DataSource"><name>SampleTxDatasource</name></reference></gbean> <gbean name="TimeReportRealm" class="org.apache.geronimo.security.realm.GenericSecurityRealm"><attribute name="realmName">TimeReportRealm</attribute> <reference name="ServerInfo"><name>ServerInfo</name></reference> <xml-reference name="LoginModuleConfiguration"><log:login-config xmlns:log="http://geronimo.apache.org/xml/ns/loginconfig-1.1"><log:login-module control-flag="REQUIRED" wrap-principals="false"><log:login-domain-name>TimeReportRealm</log:login-domain-name> <log:login-module-class>org.apache.geronimo.security.realm.providers。SQLLoginModule</log:login-module-class> <log:option name="dataSourceName">SampleNoTxDatasource</log:option> <log:option name="userSelect">选择用户ID，来自用户的密码，其中用户ID =？</log:option>
                    <log:option name="groupSelect">从usergroups中选择userid，groupname，其中userid =？</log:option>
                </log:login-module>
            </log:login-config>
        </xml-reference>
    </gbean>
</web-app>
<!--?xml--></plain-text-body> 


<p>为了限制从“时间报告”页面访问“添加员工”功能，已使用编程身份验证，如下所示。</p>

<parameter ac:name="">java</parameter> <parameter ac:name="title">employee / index.jsp</parameter> <parameter ac:name="borderStyle">实</parameter> <plain-text-body>...
<br><％if（request.isUserInRole（“ manager”））{％> <a href="../manager/">添加员工</a>
<br>...
</plain-text-body>


<h1 id="timereport-WebApplicationSecuritySample-TestingoftheSampleApplication">样本应用程序的测试</h1>

<p>要测试示例应用程序，请打开浏览器，然后输入<a shape="rect" class="external-link" href="http://localhost:8080/timereport" rel="nofollow">http：// localhost：8080 / timereport</a> 。它将转发到应用程序的“欢迎”页面。</p>

<p>用户可以访问“时间报告”页面，提供用户名<strong>emp1</strong>和密码<strong>pass1</strong> 。要以Manager身份登录到该应用程序，请提供<strong>mgm1</strong>和<strong>pass3</strong>凭据。</p>

<p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="timereport-web-application-security-sample.data/timereport_app.png"></span></p>

<h1 id="timereport-WebApplicationSecuritySample-Summary">摘要</h1>

<p>本文向您展示了如何使用J2EE声明性安全功能将Web应用程序部署到Geronimo Application Server中。您按照分步说明构建，部署和测试示例应用程序。</p>

<p>本文的重点内容如下：</p>
<ul><li>Apache Geronimo提供了两个不同的Web容器，即Jetty和Tomcat。</li><li>创建一个数据库，以使用内置Derby保存安全数据。</li><li>在Geronimo Web应用程序中定义安全角色。</li><li>使用Geronimo Console部署部署计划和Web归档。</li></ul></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : timereport - Web Application Security Sample';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2013，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  

</body></html>