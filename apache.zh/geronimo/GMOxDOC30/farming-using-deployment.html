<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Farming using Deployment" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Farming using Deployment" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0 Documentation: Farming using Deployment</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="configuring-and-administering.html">Configuring and administering</a>&nbsp;&gt;&nbsp;<a href="configuring-and-administering-the-apache-geronimo-server.html">Configuring and administering the Apache Geronimo Server</a>&nbsp;&gt;&nbsp;<a href="clustering-and-farming.html">Clustering and farming</a>&nbsp;&gt;&nbsp;<a href="farming-using-deployment.html">Farming using Deployment</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Farming using Deployment</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645452">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645452">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645452">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645452">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645452">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645452">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>

<p><parameter ac:name="atlassian-macro-output-type">INLINE</parameter><rich-text-body><p>A configuration can be deployed to a cluster of Geronimo servers by using a single logical deployment step.</p></rich-text-body> After a configuration is deployed to a cluster, this configuration can be transparently started, stopped, or undeployed across all the cluster members.<br clear="none">
These two features greatly streamline the maintenance of applications that are running on a cluster because Geronimo takes care of cluster-wide application distribution and management for you.</p>

<h2 id="FarmingusingDeployment-ConfigurationofClusterMembers">Configuration of Cluster Members</h2>
<ol><li>A specific name should be given to your Geronimo instance. This can be achieved by updating the <code>clusterNodeName</code> property defined within <code>&lt;geronimo_home&gt;/var/config/config-substitutions.properties</code>:
<parameter ac:name="borderStyle">dashed</parameter><rich-text-body>
<p>clusterNodeName=<em>NODE1</em><br clear="none">
RemoteDeployHostname=<em>NODE1_IP</em></p></rich-text-body></li><li>Cluster members are configured on a Geronimo server, which can, but is not required to, be a member of the cluster.  This is achieved by adding a <strong>org.apache.geronimo.farm.config.BasicNodeInfo</strong> GBean for each cluster member to the <strong>farming</strong> configuration of <code>config.xml</code>. This GBean looks like this:
<plain-text-body>
&lt;gbean name="org.apache.geronimo.configs/farming/2.2/car?ServiceModule=org.apache.geronimo.configs/farming/2.2/car,
       j2eeType=NodeInfo,name=Node2_description"
    gbeanInfo="org.apache.geronimo.farm.config.BasicNodeInfo"&gt;
    &lt;attribute name="name"&gt;NODE2&lt;/attribute&gt; 
    &lt;attribute propertyEditor="org.apache.geronimo.farm.config.BasicExtendedJMXConnectorInfoEditor" name="extendedJMXConnectorInfo"&gt;
        &lt;ns:javabean class="org.apache.geronimo.farm.config.BasicExtendedJMXConnectorInfo"
            xmlns:ns4="http://geronimo.apache.org/xml/ns/attributes-1.2"
            xmlns:ns="http://geronimo.apache.org/xml/ns/deployment/javabean-1.0"
            xmlns=""&gt;
            &lt;ns:property name="username"&gt;system&lt;/ns:property&gt;
            &lt;ns:property name="password"&gt;manager&lt;/ns:property&gt;                    
            &lt;ns:property name="protocol"&gt;rmi&lt;/ns:property&gt;
            &lt;ns:property name="host"&gt;NODE2_IP&lt;/ns:property&gt;
            &lt;ns:property name="port"&gt;1100&lt;/ns:property&gt;
            &lt;ns:property name="urlPath"&gt;JMXConnector&lt;/ns:property&gt;
            &lt;ns:property name="local"&gt;false&lt;/ns:property&gt;
          &lt;/ns:javabean&gt;
    &lt;/attribute&gt;
&lt;/gbean&gt;
</plain-text-body>
It defines the network address (host, port, urlPath) and the credentials  (username and password) to be used to connect to the cluster member via JMX. Such declarations are to be included within the <code>config.xml</code> file, <strong>farming</strong> module of your Geronimo server.<br clear="none">
By default, the farming configuration defines the local server as a cluster member. To exclude it, you can prevent the GBean <strong>NodeInfo</strong> to start.</li></ol>


<h2 id="FarmingusingDeployment-FarmDeployment">Farm Deployment</h2>
<p>To deploy a configuration to configure members, you simply deploy it to the MasterConfigurationStore repository defined by the farming configuration. This configuration being stopped out-of-the-box, you might have to start it the first time by using this GShell command:</p>
<plain-text-body>
deploy/start org.apache.geronimo.configs/farming//car
</plain-text-body>
<p><strong>farming</strong> adds two new repositories to the server: <strong>MasterConfigurationStore</strong> and <strong>ClusterStore</strong>. <strong>MasterConfigurationStore</strong> is the repository you should use most of the time if not always. <strong>ClusterStore</strong> is a repository you might have to use in specific and infrequent scenarios.<br clear="none">
To deploy to MasterConfigurationStore, pass the --targets flag to the <strong>distribute</strong> or <strong>deploy</strong> commands like this:</p>
<plain-text-body>
deploy/distribute  --targets XXX,name=MasterConfigurationStore &lt;your module&gt;
</plain-text-body>
<p>Following this deployment,</p>
<ul><li><em>MasterConfigurationStore</em> contains a kind of virtual configuration under an altered name, a '_G_MASTER' is appended to the configuration name, and</li><li><em>ClusterStore</em> contains the actual configuration that has the same name as your deployment and defines GBeans controlling the remote start and stop of the actual configuration cluster-wide;</li></ul>


<h2 id="FarmingusingDeployment-Cluster-wideManagementofConfigurations">Cluster-wide Management of Configurations</h2>
<p>To undeploy across the farm, users need to execute the undeploy command on the same node that they used to deploy/distribute their application across the farm. Note that this node acts as a kind of Administration Server, whereby it is the only node whose farming configuration needs to be maintained to reflect farm members and any lifecycle operations against farmed modules (e.g. start/stop) are propagated to the other nodes. To start, stop, or undeploy configurations across a cluster, perform the relevant deployment task against the virtual configuration.</p>
<plain-text-body>
deploy/undeploy &lt;your module&gt;_G_MASTER
</plain-text-body> 

<p>All the cluster members configured at the time of the initial deployment must be running. Otherwise, these operations are partially executed. For instance, if three members were configured and only two of them are running when the virtual configuration is undeployed, then the configuration is removed from the ClusterStore of the two running servers. The ClusterStore of the third server still contains the configuration and will have to be manually undeployed on this server.</p></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Farming using Deployment';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
