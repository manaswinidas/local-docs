<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Migrating from G 2.x to G 3.x" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Migrating from G 2.x to G 3.x" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0 Documentation: Migrating from G 2.x to G 3.x</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="migrating-to-apache-geronimo.html">Migrating to Apache Geronimo</a>&nbsp;&gt;&nbsp;<a href="migrating-from-g-2x-to-g-3x.html">Migrating from G 2.x to G 3.x</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Migrating from G 2.x to G 3.x</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645424">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645424">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645424">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645424">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645424">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645424">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><p>CE 3.0 provides backward compatibility to Java EE 5 compliant applications. If you have applications running on Geronimo 2.x successfully, you can easily port them to Geronimo 3.0. However, there are a few updates you need to consider as followed.</p>
<div class="toc-macro client-side-toc-macro" data-headerelements="H1,H2,H3,H4,H5,H6,H7"></div>

<h1 id="MigratingfromG2.xtoG3.x-Classloadingoptionsinthedeploymentplan">Classloading options in the deployment plan</h1>
<ul><li><strong>hidden-classes</strong> The deployment codes in Geronimo 3.0 will covert hidden-classes configuration to import-package style. For exmaple, <code>&lt;hidden-classes&gt;javax.faces&lt;/hidden-classes&gt;</code> should be <code>&lt;import-package&gt;!javax.faces&lt;/import-package&gt;</code>.</li><li><strong>non-overridable-classes</strong> Geronimo 3.0 does not support the element in the deployment plan.</li><li><strong>private-classes</strong>  Geronimo 3.0 does not support the element in the deployment plan.</li><li><strong>inverse-classloading</strong> Geronimo 3.0 does not support the element in the deployment plan.</li></ul>


<h1 id="MigratingfromG2.xtoG3.x-DBinitializationatdeploymenttime">DB initialization at deployment time</h1>
<p>To initialize a database using deployment plan file, <code>org.apache.geronimo.connector.DatabaseInitializationGBean</code> in 2.X should be changed to <code>org.apache.geronimo.connector.wrapper.DatabaseInitializationGBean</code>.</p>

<h1 id="MigratingfromG2.xtoG3.x-JavaMailsessiongenerationandresourcelookup">JavaMail session generation and resource lookup</h1>
<p>There are following changes regarding Java Mail configuration in Geronimo 3.0.</p>
<ul><li>To generate JavaMaill sessions using deployment plan file, <code>org.apache.geronimo.mail.MailGBean</code> in 2.X should be changed to <code>org.apache.geronimo.resource.mail.MailGBean</code>.</li><li>To configure JavaMail SMTP transport protocal using deployment plan file, <code>org.apache.geronimo.mail.SMTPTransportGBean</code> in 2.X should be changed to <code>org.apache.geronimo.resource.mail.SMTPTransportGBean</code>.</li><li>JNDI names of mailGBean should start with <code>ger:</code>, <code>jca:</code> or <code>java:</code> prefix. For example:
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
   &lt;attribute name=&quot;jndiName&quot;&gt;mail/PlantsByWebSphere&lt;/attribute&gt; 
]]></script>
</div></div>
should be changed to 
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
   &lt;attribute name=&quot;jndiName&quot;&gt;ger:mail/PlantsByWebSphere&lt;/attribute&gt;
]]></script>
</div></div></li></ul>


<h1 id="MigratingfromG2.xtoG3.x-Dependencieschanges">Dependencies changes</h1>
<p>The following table lists the changes of some components name from Geronimo 2.x to 3.0.</p>
<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p> groupId </p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> In 2.X</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p> In 3.0 </p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> org.apache.geronimo.configs </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> client-transaction </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> client-transaction-1_6 </p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> org.apache.geronimo.configs </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> connector-deployer </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> connector-deployer-1_6 </p></td></tr></tbody></table></div>


<h1 id="MigratingfromG2.xtoG3.x-Servletsexpectingmultipartrequest">Servlets expecting multipart request</h1>
<p>In Servlet 3.0, an annotation @MultiPartConfig has been introduced to indicate that the servlet expects request of type multipart. You need to enable the feature in your deployment plan file as followed:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>geronimo-web.xml</b></div><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
...
   &lt;context allowCasualMultipartParsing=&quot;true&quot;&gt;&lt;/context&gt;
...
]]></script>
</div></div>

<h1 id="MigratingfromG2.xtoG3.x-ChangesregardingEJBcomponent">Changes regarding EJB component</h1>
<p>In Geronimo 3.0, resources are imported and exported using different elements in deployment plan.</p>
<h2 id="MigratingfromG2.xtoG3.x-ForastandaloneEJBmodule">For a standalone EJB module</h2>
<p>If your EJB application is a standalone module, you need to export its package in the deployment plan file under name space of  <code><a shape="rect" class="external-link" href="http://geronimo.apache.org/xml/ns/deployment-1.2">http://geronimo.apache.org/xml/ns/deployment-1.2</a></code>. For example:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
...
   &lt;dep:export-package&gt;ejb.stateful&lt;/dep:export-package&gt;
...
]]></script>
</div></div>
<p>While for any modules which call the deployed EJB, you need to import the EJB package in the deployment plan using the same name space. For example:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
...
   &lt;dep:import-package&gt;ejb.stateful&lt;/dep:import-package&gt;
...
]]></script>
</div></div>

<h2 id="MigratingfromG2.xtoG3.x-ForawebapplicationreferringEJBinterfaces">For a web application referring EJB interfaces</h2>
<p>If your web application refers to a standalone EJB module, you need to specify the artifact id of the EJB module in the deployment plan file of you web application. For example:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
...
    &lt;nam:ejb-ref&gt;
        &lt;nam:ref-name&gt;ejb/CustomerHome&lt;/nam:ref-name&gt;
        &lt;nam:pattern&gt;
            &lt;nam:groupId&gt;wasce-samples&lt;/nam:groupId&gt;
            &lt;!--specific 3.0.0.0 standalone ejb configuration: ejb jar file name--&gt;
            &lt;nam:artifactId&gt;mdb-ejb-3.0.0.0.jar&lt;/nam:artifactId&gt;
            &lt;nam:name&gt;CustomerEJB&lt;/nam:name&gt;
        &lt;/nam:pattern&gt;
    &lt;/nam:ejb-ref&gt;
]]></script>
</div></div>

<h2 id="MigratingfromG2.xtoG3.x-ForanEJBmoduleembeddedinEAR">For an EJB module embedded in EAR</h2>
<p>If an EAR application contains an application client module, an EJB module and web application module. If the application client refers to one of ejb interfaces using following code:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
  @EJB
  private static TradeSLSBRemote tradeSLSBRemote;
]]></script>
</div></div>
<p>Although the ejb.jar is defined in its class-path using <code>manifest.mf</code> file,  the EJB interface is not in its class path. You need to package the ejb module into the EAR using the following structure:</p>
<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>  my-ear-3.0.0.0/lib/ejbinterface.jar
</pre>
</div></div>

<h1 id="MigratingfromG2.xtoG3.x-Sharedlibraries">Shared libraries</h1>
<p>If you want to use shared libraries, make sure you specifies the value of <code>baseDir</code> attribute for gbean reference class. See <a shape="rect" href="using-shared-libraries-in-your-applications.html">Using shared libraries in your applications</a> for more details.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script class="brush: xml; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;gbean name=&quot;SharedLib&quot; class=&quot;org.apache.geronimo.system.sharedlib.SharedLib&quot;&gt;
        &lt;attribute name=&quot;baseDir&quot;&gt;var/shared&lt;/attribute&gt;
        &lt;attribute name=&quot;classesDirs&quot;&gt;classes&lt;/attribute&gt;
        &lt;attribute name=&quot;libDirs&quot;&gt;lib&lt;/attribute&gt;
        &lt;reference name=&quot;ServerInfo&quot;&gt;
            &lt;name&gt;ServerInfo&lt;/name&gt;
        &lt;/reference&gt;
    &lt;/gbean&gt;

]]></script>
</div></div></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Migrating from G 2.x to G 3.x';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
