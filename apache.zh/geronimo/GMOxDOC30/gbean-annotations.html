<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=1">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="GBean Annotations">
    <meta name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi GBean Annotations">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2010-05-11">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>

  <link href="asset?aid=2" rel="stylesheet" type="text/css">
  <link href="asset?aid=3" rel="stylesheet" type="text/css">
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shCore.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushJava.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushXml.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushPlain.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushBash.js' type='text/javascript'></script>
  
  <script type="text/javascript">
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
  </script>

    <title>Apache Geronimo v3.0文档：GBean注释</title>
  </head>

  <body  onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">Home</a> > <a href="documentation.html">文档</a> > <a href="reference.html">参考</a> > <a href="geronimo-architecture.html">Geronimo体系结构</a> > <a href="gbeans.html">GBeans</a> > <a href="gbean-annotations.html">GBean注释</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo v3.0</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">GBean注释</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645475"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645475">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645475"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645475">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645475"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645475">添加新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent">
<p>批注的定义简化了<strong>GBeanInfo</strong>的定义。借助GBean批注，您将无需再在GBeanInfo中添加属性，操作和引用。</p>

<p>GBean的注释定义如下，并在包中定义<code>org.apache.geronimo.gbean.annotation</code> 。</p>

<div class="table-wrap"><table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>@GBean</strong> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>定义GBean的名称和j2eeType的可选注释。如果未指定此批注，则假定默认名称为类（简单）名称，默认j2eeType为GBean。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>@优先</strong> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>定义GBean优先级的可选注释。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>@ParamSpecial</strong> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>定义要注入的GBean特殊属性的注释。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>@ParamAttribute</strong> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>定义要注入的GBean属性的注释。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>@ParamReference</strong> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>定义要注入的GBean参考的注释。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>@持久</strong> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>setter方法的注释将相应的GBean属性转换为持久属性。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p> <strong>@参考</strong> </p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>使用setter方法的注释将相应的GBean属性转换为GBean引用。</p></td></tr></tbody></table></div>


<p>请注意，最多一个构造函数必须使用@ ParamSpecial，@ ParamAttribute或@ParamReference进行注释。</p>

<h1 id="GBeanAnnotations-DevelopingaGBeanusingAnnotations">使用注释开发GBean</h1>
<p>为了开发带有注释的GBean，您至少必须执行以下步骤：</p>
<ol><li>编写一个POJO类</li><li>实现GbeanLifecycle接口以使用Gbean内核生命周期回调（可选）。</li></ol>


<h2 id="GBeanAnnotations-AsampleGBean">GBean示例</h2>
<p>在这里，我们重写了在<a shape="rect" href="developing-and-deploying-a-geronimo-gbean.html">开发和部署Geronimo GBean中</a>提供的示例<em>simpleServerGBean</em> ，该示例引用了另一个名为<em>EchoMessageGBean的</em> GBean。</p>
<ul><li>SimpleServerGBean引用另一个GBean <strong>EchoMessageInterface</strong> ，这在<a shape="rect" href="developing-and-deploying-a-geronimo-gbean.html">引用另一个GBean中进行了</a>描述。</li><li>普通旧Java对象（POJO）代码带有不同的构造函数，该构造函数带有<strong>@ParamSpecial</strong> ， <strong>@ParamAttribute</strong>或<strong>@ParamReference注释</strong> 。</li><li>使用注释和不使用注释实现的LifeCycle代码之间没有区别。</li><li>由于Geronimo内核将识别并调用通过注释定义的属性，操作，引用和构造函数，因此我们删除了GBeanInfo实现。
<br class="atl-forced-newline" clear="none">
<div class="code panel pdl" style="border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px"><b>SimpleServerGBean</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
public class SimpleServerGBean implements GBeanLifecycle, InterfaceNamed {
    private final String gbeanName;
    private EchoMessageInterface echo;
    private int port;

    private boolean started = false;
    private ServerSocket serversocket;

   /* Different contructor */ 
   public SimpleServerGBean(@ParamAttribute(name = "gbeanName") String gbeanName, 
			    @ParamAttribute(name = "port") int port,
			    @ParamReference(name = "EchoMessageInterface") EchoMessageInterface echomsg){
			                 
        this.gbeanName = gbeanName;
	this.port = port;
	this.echo= echomsg;
    }

    public String getName() {
        return this.gbeanName;
    }

    public boolean isStarted() {
        return started;
    }

    private void printConsoleLog(String log) {
        System.out.println(" LOG : " + log);
    }


    public void doFail() {
        started = false;
        printConsoleLog("GBean " + gbeanName + " failed");
    }

    public void doStart() throws Exception {

	 serversocket = new ServerSocket(port);
	 started = true;

	 Thread simpleServerThread = new Thread(new Runnable() {

	 Socket socket;
	 InputStream is;
	 OutputStream os;

	 public void run() {

	     while (started) {
		 try {
	             socket = serversocket.accept();
		     is = socket.getInputStream();
		     os = socket.getOutputStream();

		     BufferedReader bufferedReader = new BufferedReader(
		     new InputStreamReader(is));

		     String appendMessage=echo.getEchoMessage();
		     String responseMessage = appendMessage + bufferedReader.readLine();

		     os.write(responseMessage.getBytes());

		     bufferedReader.close();
		     if (os != null) {
		         os.close();
		     }
			
                     if (socket != null &amp;&amp; !socket.isClosed()) {
			 socket.close();
		     }

		 } catch (Exception e) {

		     //ingore

		    }
	       }

	 }

    });

     simpleServerThread.start();

     printConsoleLog("GBean " + gbeanName
				+ " started and it's listening on port:" + port);

     }

     public void doStop() throws Exception {

	 started = false;
	 serversocket.close();
	 printConsoleLog("GBean " + gbeanName + " stopped");
     }

}
</pre>
</div></div></li></ul>


<p>必须修改SimpleServerGBean的部署计划。</p>
<div class="code panel pdl" style="border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px"><b>摘自simpleServer_deployment_plan.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;gbean name="echoserver" class="org.apache.geronimo.sample.SimpleServerGBean"&gt;
    &lt;attribute name="port"&gt;7777&lt;/attribute&gt;
    &lt;attribute name="gbeanName"&gt;simpleServer&lt;/attribute&gt;
    &lt;reference name="EchoMessageInterface"&gt;
        &lt;name&gt;msgAppender&lt;/name&gt;
    &lt;/reference&gt;
&lt;/gbean&gt;
	
&lt;gbean name="msgAppender" class="org.apache.geronimo.sample.EchoMessageGBean"&gt;
    &lt;attribute name="msg"&gt;[Echo from server 1]:&lt;/attribute&gt;
&lt;/gbean&gt;
</pre>
</div></div>
<p><strong>注意</strong> ：如果你定义EchoMessageInterface的GBean的<strong>j2eeType</strong>属性，你必须指定在此属性<strong><reference></reference></strong>部署计划部分，以便Geronimo可以识别GBean。</p>

<h2 id="GBeanAnnotations-FurtherReference">进一步参考</h2>
<p>这里提供了从Geronimo来源中提取的两个示例，以供您参考。</p>
<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
@GBean
public class AuthConfigProviderGBean implements GBeanLifecycle {

    private final String registrationID;

    public AuthConfigProviderGBean(@ParamAttribute(name = "config") String config, 
                                   @ParamSpecial(type = SpecialAttributeType.classLoader) ClassLoader classLoader) 
    throws AuthException, JAXBException, IOException, ParserConfigurationException, SAXException, XMLStreamException {

        ClassLoaderLookup classLoaderLookup = new ConstantClassLoaderLookup(classLoader);

        String messageLayer = null;
        String appContext = null;

        AuthConfigFactory authConfigFactory = AuthConfigFactory.getFactory();
        ConfigProviderType configProviderType = JaspiXmlUtil.loadConfigProvider(new StringReader(config));
        AuthConfigProvider authConfigProvider = JaspiUtil.wraptAuthConfigProvider(configProviderType, classLoaderLookup);
        registrationID = authConfigFactory.registerConfigProvider(authConfigProvider, messageLayer, appContext, null);
    }

    public void doStart() throws Exception {
    }

    public void doStop() throws Exception {
        AuthConfigFactory authConfigFactory = AuthConfigFactory.getFactory();
        authConfigFactory.removeRegistration(registrationID);
    }

    /**
     * Fails the GBean.  This informs the GBean that it is about to transition to the failed state.
     */
    public void doFail() {
    }
}
</pre>
</div></div>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
@GBean
public class JmxDiscoveryPublisher implements GBeanLifecycle {

    private final URI service;
    private final DiscoveryAgent discoveryAgent;

    public JmxDiscoveryPublisher(@ParamAttribute(name = "nodeName")String nodeName,
                                 @ParamAttribute(name = "clusterName")String clusterName,
                                 @ParamAttribute(name = "protocol")String protocol,
                                 @ParamAttribute(name = "urlPath")String urlPath,
                                 @ParamAttribute(name = "discoveryType")String discoveryType,
                                 @ParamReference(name = "DiscoveryAgent")DiscoveryAgent discoveryAgent,
                                 @ParamReference(name = "RMIRegistryService")RMIRegistryService rmiRegistryService
    ) throws URISyntaxException, IOException {
        this.discoveryAgent = discoveryAgent;
        String query = null;
        if (nodeName != null &amp;&amp; nodeName.length() &gt; 0) {
            query = "node=" + nodeName;
        }
        if (clusterName != null) {
            query = (query == null? "": query + "&amp;") + "cluster=" + clusterName;
        }
        service = new URI(discoveryType + ":" + protocol, null,  rmiRegistryService.getHost(),
                          rmiRegistryService.getPort(), "/" + urlPath , query, null);
        discoveryAgent.registerService(service);
    }

    public void doStart() throws Exception {
    }

    public void doStop() throws Exception {
        discoveryAgent.unregisterService(service);
    }

    public void doFail() {
        try {
            doStop();
        } catch (Exception e) {
            //ignore
        }
    }
}
</pre>
</div></div></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : GBean Annotations';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2013，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  

</body></html>