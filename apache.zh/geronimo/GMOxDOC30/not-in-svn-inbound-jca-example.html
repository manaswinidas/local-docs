<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=0">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="not-in-svn - Inbound JCA example">
    <meta name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi not-in-svn - Inbound JCA example">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2010-05-11">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0文档：not-in-svn-入站JCA示例</title>
  </head>

  <body  onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">Home</a> > <a href="documentation.html">文档</a> > <a href="reference.html">参考</a> > <a href="samples.html">示例</a> > <a href="java-ee-sample-applications.html">Java EE示例应用程序</a> > <a href="not-in-svn-inbound-jca-example.html">not-in-svn-入站JCA示例</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo v3.0</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">not-in-svn-入站JCA示例</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645503"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645503">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645503"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645503">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645503"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645503">添加新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>
<p><parameter ac:name="">最佳</parameter><br clear="none">J2EE连接器体系结构（JCA）提供了Java技术解决方案，以解决许多应用程序容器与当今企业信息系统（EIS）之间的连接问题。在JCA规范的1.5版本中，该体系结构定义了入站通信模型，EIS借此启动到EJB应用程序的所有通信。该机制允许入站资源适配器调用企业Java Bean（EJB）。</p>

<h1 id="not-in-svn-InboundJCAexample-Overviewoverview">概述<parameter ac:name="">概述</parameter></h1>

<p>本文档将描述如何部署EJB应用程序，以便它可以从JCA适配器接收入站事件。首先将描述与入站通信模型有关的资源适配器的关键部分，以及将独立部署资源适配器的特定于Geronimo的计划。然后，它将通过入站通信机制描述将由EIS执行的企业应用程序。</p>

<h1 id="not-in-svn-InboundJCAexample-ResourceAdapteradapter">资源适配器<parameter ac:name="">适配器</parameter></h1>

<p>本节中描述的代码是将作为资源适配器的一部分部署的类。在大多数情况下，这些文件没有Geronimo特有的。但是，本节结尾将讨论如何将资源适配器部署到Geronimo容器中。</p>

<p>在JCA 1.5规范中，入站适配器可以支持自定义消息格式。这允许消息驱动Bean（MDB）实施入站资源适配器已定义的任何接口。在JCA规范的先前版本中，Java消息服务（JMS）消息是入站通信的唯一机制，要求MDB实现接口javax.jms。MessageListener。但是，在JCA 1.5中，MDB可以使用任何接口定义来处理入站请求。</p>

<h2 id="not-in-svn-InboundJCAexample-InterfaceDefinition">接口定义</h2>

<p>对于此示例，接口<strong>com.sample.connector。已经定义了EventListener</strong>接口。此接口将由入站资源适配器将调用的任何MDB实施。</p>
<parameter ac:name="border">固定的</parameter> <parameter ac:name="title">EventListener.java</parameter> <plain-text-body>包com.sample.connector;导入java.util。清单;导入javax.resource。ResourceException; / ** *一个允许处理事件的接口。消息驱动的Bean实现此接口，以便通过JCA适配器从EIS接收入站事件。* /公共接口EventListener {/ ** *处理事件时要调用的方法。* * @param eventName事件的名称* @param paramList发送给事件的参数* * @如果发生错误，则抛出ResourceException * / void handleEvent（String eventName，List paramList）抛出ResourceException; }</plain-text-body>

<h2 id="not-in-svn-InboundJCAexample-ActivationSpecimplementation">ActivationSpec实施</h2>

<p>入站资源适配器使用接口<strong>javax.resource.spi的实现。ActivationSpec</strong> 。接口本身没有方法，但是实现接口的类</p>
<ul><li>必须是JavaBean，为bean的字段提供getter和setter方法</li><li>必须可序列化</li></ul>


<p>根据API文档，“ ActivationSpec实现将保存消息端点的激活配置信息”。在这种情况下，消息端点将是我们企业应用程序中的MDB。我们的ActivationSpec实现是<strong>com.sample.connector类<strong>。EventActivationSpec。</strong>我们示例的ActivationSpec将存储所需的所有数据，以便可以打开连接，以便远程EIS系统调用应用程序容器（machineName，端口，用户名，用户密码和事件模式）。</strong></p><strong>
<parameter ac:name="border">固定的</parameter> <parameter ac:name="title">EventActivationSpec.java</parameter> <plain-text-body>/ * * EventActivationSpec.java * / com.sample.connector包；导入java.io。可序列化；导入javax.resource.spi。ActivationSpec;导入javax.resource.spi。InvalidPropertyException;导入javax.resource.spi。ResourceAdapter; / ** * <code>ActivationSpec</code>接口的实现，该接口允许EIS事件*暴露给消息驱动器Bean。该<code>ActivationSpec</code>用于*支持从我们的EIS到消息驱动bean的入站连接。这将打开EIS连接，并使用EIS特定连接类提供的事件机制。当包含*消息驱动bean的应用程序可用时，与EIS的连接将保持打开状态。* /公共类EventActivationSpec实现了ActivationSpec，可序列化{private ResourceAdapter resourceAdapter;私有字符串serverName;私有Integer portNumber;私有字符串userName;私有字符串密码；私有String eventPatterns; //以逗号分隔的模式字符串/ ** *创建EventActivationSpec类的新实例。* / public EventActivationSpec（）{} / ** *不执行验证* / public void validate（）抛出InvalidPropertyException {} // javadoc继承了public ResourceAdapter getResourceAdapter（）{return resourceAdapter; } // javadoc继承了public void setResourceAdapter（ResourceAdapter resourceAdapter）{this.resourceAdapter = resourceAdapter; } / ** * ServerName属性的Getter方法。这允许服务器名称*向抵靠连接池来限定返回：一个<code>String</code>包含服务器名称值* /公共字符串getServerName（）{返回SERVERNAME; } / ** * ServerName属性的Setter方法。这允许根据连接池/来定义服务器名称。* * @param serverName将针对此属性定义的<code>String</code> * / public void setServerName（String serverName）{this.serverName = serverName; } / ** * PortNumber属性的Getter方法。这允许端口号*到针对一个连接池来定义* * @返回一个<code>Integer</code>包含服务器端口值* /公共整数getPortNumber（）{返回PORTNUMBER; } / ** * PortNumber属性的Setter方法。这允许根据连接池/来定义服务器端口。* * @param portNumber将针对此属性定义的<code>Integer</code> * / public void setPortNumber（Integer portNumber）{this.portNumber = portNumber; } / ** * UserName属性的Getter方法。这允许*到针对一个连接池来定义用户名返回：一个<code>String</code>包含的用户名值* /公共字符串getUserName（）{返回用户名; } / ** * UserName属性的Setter方法。这允许根据连接池/来*定义用户名。* * @param userName将针对此属性定义的<code>String</code> * / public void setUserName（String userName）{this.userName = userName; } / ** *密码属性的Getter方法。这允许针对连接池定义密码* * @返回包含密码值的<code>String</code> * / public String getPassword（）{return password; } / ** *密码属性的设置方法。这允许针对连接池/定义密码。* * @param password将为此属性定义的<code>String</code> * / public void setPassword（String password）{this.password = password; } / ** *返回订阅事件时将使用的事件模式。该字符串可以包含*以逗号分隔的值，以便订阅多个事件。* * @返回一个包含将要订阅的事件模式的<code>String</code> * / public String getEventPatterns（）{return eventPatterns; } / ** *定义消息驱动Bean将订阅的事件模式。该值可以*包含逗号分隔的模式，以便可以在单个bean中预订多个事件。* * @参数eventPatterns一个<code>String</code>包含单个图案或逗号分隔的型态* /公共无效setEventPatterns（字符串eventPatterns）{this.eventPatterns = eventPatterns; }}</plain-text-body>

<h2 id="not-in-svn-InboundJCAexample-CommonDeploymentDescriptor">通用部署描述符</h2>

<p>在JCA部署描述符（ra.xml）中，有一个部分允许适配器将接口与ActivationSpec实现相关联。这是必需的，以便应用程序容器可以确保在MDB中定义强制属性，该属性将由适配器调用。</p>
<parameter ac:name="border">坚固的</parameter> <parameter ac:name="title">ra.xml</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><connector xmlns="http://java.sun.com/xml/ns/j2ee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:schemalocation="http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/connector_1_5.xsd" version="1.5"><display-name>EIS连接器</display-name> <vendor-name>我的组件</vendor-name> <eis-type>我的远程服务器</eis-type> <resourceadapter-version>1.0</resourceadapter-version> <resourceadapter><resourceadapter-class>com.sample.connector。MyResourceAdapter</resourceadapter-class> <!-- snip --> <inbound-resourceadapter><messageadapter><messagelistener><messagelistener-type>com.sample.connector。EventListener</messagelistener-type> <activationspec><activationspec-class>com.sample.connector。EventActivationSpec</activationspec-class> <required-config-property><config-property-name>ServerName</config-property-name></required-config-property> <required-config-property><config-property-name>PortNumber</config-property-name></required-config-property> <required-config-property><config-property-name>用户名</config-property-name></required-config-property> <required-config-property><config-property-name>密码</config-property-name></required-config-property> <required-config-property><config-property-name>EventPatterns</config-property-name></required-config-property></activationspec></messagelistener></messageadapter></inbound-resourceadapter> <security-permission><description>EIS连接器允许的权限</description> <security-permission-spec></security-permission-spec></security-permission>
    </resourceadapter>
</connector>
<!--?xml--></plain-text-body>
<p>一旦实现了ActivationSpec，就可以更新资源适配器的<strong>endpointActivation</strong>方法。当MDB部署到环境中时，应用程序容器将在资源适配器上调用此方法。这允许入站适配器打开任何连接。该方法的签名是</p>
<plain-text-body>公共无效endpointActivation（MessageEndpointFactory EndpointFactory，ActivationSpec规范）抛出ResourceException</plain-text-body>
<p>endpointFactory提供了创建MDB新实例的功能，并且该规范将是ActivationSpec的实现，该规范将包含所有必需的属性。此方法的实现将特定于EIS用于支持消息传递的机制。通常，资源适配器将定义<strong>javax.resource.spi.work的实现<strong>。工作</strong>界面，将为入站请求提供服务，而无需直接创建新线程。</strong></p><strong>

<p>同样重要的是实现<strong>endpointDeactivation</strong>方法。这允许适配器释放在激活端点时创建的任何资源。</p>

<h2 id="not-in-svn-InboundJCAexample-GeronimoDeploymentDescriptor">Geronimo部署描述符</h2>

<p>最后，我们到达了Geronimo特定的细节。Geronimo部署描述符提供了一个部分，用于定义特定的入站资源适配器。</p>
<parameter ac:name="border">固态</parameter> <parameter ac:name="title">geronimo-ra.xml</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><connector xmlns="http://geronimo.apache.org/xml/ns/j2ee/connector-1.2"><dep:environment xmlns:dep="http://geronimo.apache.org/xml/ns/deployment-1.2"><dep:moduleid><dep:groupid>com.sample</dep:groupid> <dep:artifactid>myConnector</dep:artifactid> <dep:version>1.0</dep:version> <dep:type>rar</dep:type></dep:moduleid> <dep:dependencies></dep:dependencies><dep:hidden-classes></dep:hidden-classes><dep:non-overridable-classes></dep:non-overridable-classes></dep:environment> <resourceadapter><resourceadapter-instance><resourceadapter-name>MyInboundEvents</resourceadapter-name> <workmanager><gbean-link>DefaultWorkManager</gbean-link></workmanager></resourceadapter-instance></resourceadapter></connector><!--?xml--></plain-text-body>
<p>使用上述部署计划部署适配器的RAR文件时，将创建一个名为<strong>MyInboundEvents</strong>的单个入站适配器。</p>

<h1 id="not-in-svn-InboundJCAexample-EJBApplicationapplication">EJB应用<parameter ac:name="">程序</parameter></h1>

<p>至此，我们已经定义了资源适配器并将其部署到Geronimo服务器实例中。现在，可以编写和部署包含消息驱动Bean的EJB应用程序，当它从远程EIS接收到消息时，入站资源适配器将调用它。</p>

<p>在此示例中，消息驱动Bean实现了由资源适配器定义的EventListener接口。</p>
<parameter ac:name="border">固定的</parameter> <parameter ac:name="title">EventBean.java</parameter> <plain-text-body>包com.sample.eventDemo.message;导入com.sample.connector。EventListener;导入java.util。清单;导入javax.ejb。ActivationConfigProperty;导入javax.ejb。MessageDriven;导入javax.resource。ResourceException; / ** *消息驱动的Bean，侦听事件* / @MessageDriven（name =“ EventBean”，messageListenerInterface = EventListener.class，activationConfig = {@ActivationConfigProperty（propertyName =“ ServerName”，propertyValue =“ fozzie”），@ActivationConfigProperty （propertyName =“ PortNumber”，propertyValue =“ 40100”），@ActivationConfigProperty（propertyName =“ UserName”，propertyValue =“ user”），@ActivationConfigProperty（propertyName =“ Password”，propertyValue =“ pwd”），@ActivationConfigProperty（propertyName =“ EventPatterns”，propertyValue =“ myPattern”）}））公共类EventBean实现EventListener {/ ** *入站事件处理程序将调用的方法* / public void handleEvent（String eventName，List paramList）抛出ResourceException {系统。 out.println（“在MDB中：” + eventName +“，带有参数” + paramList.toString（））； }}</plain-text-body>
<p>该bean并没有做很多事，但是它将显示该bean正在执行。但是，它使用ActivationConfigProperty批注定义入站资源适配器所需的属性。这些值将根据适当的ActivationSpec（在这种情况下为EventActivationSpec）定义，并将其传递给资源适配器的endpointActivation方法。</p>

<h2 id="not-in-svn-InboundJCAexample-GeronimoDeploymentDescriptor.1">Geronimo部署描述符</h2>

<p>最后一步是将MDB与入站资源适配器MyInboundEvents关联，该资源是在将资源适配器部署到Geronimo容器中时定义的。这是在EJB的Geronimo部署描述符<strong>openejb-jar.xml中完成的</strong> 。</p>
<parameter ac:name="border">固体</parameter> <parameter ac:name="title">openejb-jar.xml</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><openejb-jar xmlns="http://www.openejb.org/xml/ns/openejb-jar-2.1" xmlns:naming="http://geronimo.apache.org/xml/ns/naming-1.1" xmlns:security="http://geronimo.apache.org/xml/ns/security-1.1" xmlns:sys="http://geronimo.apache.org/xml/ns/deployment-1.2"><sys:environment><sys:moduleid><sys:groupid>com.sample.connectorDemo</sys:groupid> <sys:artifactid>SampleEventHandler</sys:artifactid> <sys:version>1.1</sys:version> <sys:type>汽车</sys:type></sys:moduleid> <sys:dependencies><sys:dependency><sys:groupid>com.sample</sys:groupid> <sys:artifactid>myConnector</sys:artifactid> <sys:version>1.0</sys:version> <sys:type>rar</sys:type></sys:dependency></sys:dependencies> <sys:hidden-classes></sys:hidden-classes><sys:non-overridable-classes></sys:non-overridable-classes></sys:environment> <enterprise-beans><message-driven><ejb-name>EventBean</ejb-name> <resource-adapter><resource-link>MyInboundEvents</resource-link></resource-adapter></message-driven></enterprise-beans></openejb-jar><!--?xml--></plain-text-body>
<p>在此文件中，我们将EventBean与MyInboundEvents适配器相关联。</p></strong></strong></div><strong><strong>
        </strong></strong></div><strong><strong>

              </strong></strong></div><strong><strong>
    </strong></strong></div><strong><strong>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : not-in-svn - Inbound JCA example';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2013，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  

</strong></strong></body></html>