<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=1">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="Assembling a server using Maven">
    <meta name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Assembling a server using Maven">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2010-05-11">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0文档：使用Maven组装服务器</title>
  </head>

  <body  onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">Home</a> > <a href="documentation.html">文档</a> > <a href="configuring-and-administering.html">配置和管理</a> > <a href="configuring-and-administering-the-apache-geronimo-server.html">配置和管理Apache Geronimo Server</a> > <a href="customizing-server-assemblies.html">定制服务器程序集</a> > <a href="assembling-a-server-using-maven.html">使用Maven组装服务器</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo v3.0</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">使用Maven组装服务器</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645311"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645311">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645311"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645311">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645311"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645311">添加新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><p>使用命令行部署程序或通过管理控制台部署应用程序适合进行实验，但不适用于自动化开发工作流程。使用Geronimo插件系统，您可以使用maven设置工作流程，该maven可以构建应用程序，将它们预先部署为Geronimo插件，并组装一个服务器，其中包含运行应用程序所需的插件。进一步的工作流程步骤可以包括通过启动自定义服务器并对其运行硒测试来进行自动化测试。</p>

<p>为了简化这种自动化工作流程的设置，您可以使用Maven原型，它可以帮助设置Maven项目以构建插件和组装服务器。例如，本主题描述为liferay 4.4.1门户设置这种工作流程。请注意，这是从如何在geronimo上部署liferay的描述中删除了两个步骤，而从如何为liferay门户构建插件的描述中删除了一个步骤。有关此类工作流程的完整示例，请参见<a shape="rect" class="external-link" href="https://svn.apache.org/repos/asf/geronimo/plugins/roller/trunk">https://svn.apache.org/repos/asf/geronimo/plugins/roller/trunk上</a>的Roller插件。</p>

<p>笔记：</p>
<ol><li>由于car-maven-plugin中的maven生命周期得到了改进，所以组装工件仅生成可与Geronimo 2.1.1-SNAPSHOT或更高版本一起使用的pom。目前，原型仅可用作来自Branch / 2.1和Trunk的快照。</li><li>Maven倾向于从新的pom.xml中删除所有注释。因此，其中包含一个pom.sample.xml，其中包含有关如何在常见情况下设置pom.xml的更多注释。</li><li>原型在存在时会使用父项目的某些属性（groupId，版本）。说明使用此：独立使用时，您可能需要提供更多命令行选项。</li><li>考虑到最初使用maven构建的项目，其中的某些步骤是不必要的</li><li>在撰写本文时，服务器已启动（具有足够的内存），但liferay门户未显示。希望我们能找出原因。</li></ol>


<h1 id="AssemblingaserverusingMaven-Processoverview.">流程概述。</h1>
<ol><li>如果必需的工件尚不可用，请将它们放入本地Maven存储库中</li><li>构造基础Maven项目</li><li>使用maven war原型来构建项目以根据需要修改工件，例如使用maven-war-plugin覆盖从WEB-INF / lib中删除依赖项，以便可以使用geronimo的存储库中的副本</li><li>使用geronimo-plugin-archetype构建项目以构建组件的插件</li><li>使用geronimo-assembly-archetype构建用于组装服务器的项目。</li></ol>


<h2 id="AssemblingaserverusingMaven-Preparation–findtheartifacts">准备–查找文物</h2>

<p>Liferay不会将其代码发布到任何Maven存储库。首先下载：</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
wget http://downloads.sourceforge.net/lportal/liferay-portal-4.4.1.war?modtime=1202491348&amp;big_mirror=1

wget http://downloads.sourceforge.net/lportal/liferay-portal-dependencies-4.4.1.zip?modtime=1202491352&amp;big_mirror=1
]]></script>
</div></div>

<p>开箱：</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
unzip liferay-portal-dependencies-4.4.1.zip
]]></script>
</div></div>

<p>并安装到本地仓库：</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
mvn install:install-file \
  -Dfile=liferay-portal-4.4.1.war \
  -DgroupId=com.liferay \
  -DartifactId=liferay-portal \
  -Dversion=4.4.1 \
  -Dpackaging=war

mvn install:install-file \
  -Dfile=liferay-portal-dependencies-4.4.1/portal-kernel.jar \
  -DgroupId=com.liferay \
  -DartifactId=portal-kernel \
  -Dversion=4.4.1 \
  -Dpackaging=jar

mvn install:install-file \
  -Dfile=liferay-portal-dependencies-4.4.1/portal-service.jar \
  -DgroupId=com.liferay \
  -DartifactId=portal-service \
  -Dversion=4.4.1 \
  -Dpackaging=jar
]]></script>
</div></div>

<h2 id="AssemblingaserverusingMaven-Setupaparentmavenproject">设置一个父Maven项目</h2>


<p>我找不到创建空的“父”项目的原型。所以...<br clear="none">找到合适的位置并运行</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
mvn archetype:create \
  -DarchetypeGroupId=org.apache.maven.archetypes \
  -DarchetypeArtifactId=maven-archetype-quickstart \
  -DarchetypeVersion=1.0 \
  -DgroupId=org.apache.geronimo.plugins \
  -DartifactId=liferay-parent \
  -Dversion=1.0-SNAPSHOT

cd liferay-parent
rm -rf src

]]></script>
</div></div>
<p>编辑pom.xml以将包装更改为pom并删除依赖项。</p>

<p>另外，在我们发布原型的非快照版本之前，请包括此版本，以便可以自动下载原型：</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    &lt;pluginRepositories&gt;
        &lt;pluginRepository&gt;
            &lt;id&gt;apache-snapshots&lt;/id&gt;
            &lt;name&gt;Apache Snapshots Repository&lt;/name&gt;
            &lt;url&gt;http://people.apache.org/repo/m2-snapshot-repository&lt;/url&gt;
            &lt;layout&gt;default&lt;/layout&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;true&lt;/enabled&gt;
                &lt;updatePolicy&gt;daily&lt;/updatePolicy&gt;
                &lt;checksumPolicy&gt;ignore&lt;/checksumPolicy&gt;
            &lt;/snapshots&gt;
            &lt;releases&gt;
                &lt;enabled&gt;false&lt;/enabled&gt;
            &lt;/releases&gt;
        &lt;/pluginRepository&gt;
    &lt;/pluginRepositories &gt;
]]></script>
</div></div>

<div class="confluence-information-macro confluence-information-macro-note"><p class="title">关于Geronimo版本的说明</p><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>除非您使用的发布原型与所用的geronimo版本一起使用，否则必须<geronimoversion>将生成的poms中的<geronimoversion>属性更新<geronimoversion>为正确的版本。例如，在撰写本文时，生成的poms具有<geronimoversion>2.2-SNAPSHOT，</geronimoversion>并且要与geronimo 2.1一起使用，您可以将其更新为<geronimoversion>2.1</geronimoversion></geronimoversion></geronimoversion></geronimoversion></p></div></div>

<h2 id="AssemblingaserverusingMaven-Repackagetheliferaywar">重新包装Liferay战争</h2>
<p>JEE规范告诉我们将应用程序使用的jar打包到WEB-INF / lib或lib目录中。这看起来可能会使应用程序更加独立，但是由于很难确定这些目录中的内容，所使用的版本等，因此可能产生跟踪梦night，更不用说促进多个应用程序重复使用代码了。项目。相反，Geronimo允许您将jar放入Maven结构的geronimo存储库中，并为应用程序指定类加载器结构，以在必要时包括这些jar。如果要将现有的war项目转换为基于此存储库的类加载器解决方案，则可能需要从现有的war中删除一些jar。您可以使用Maven战争叠加轻松地做到这一点。对于要从geronimo存储库中使用的每个jar，在覆盖配置中指定一个排除项，然后将该jar作为依赖项添加到构建geronimo插件的maven项目中。此示例仅排除了几个jar，其中大多数jar已存在于父类加载器中。</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
mvn archetype:create \
  -DarchetypeGroupId=org.apache.maven.archetypes \
  -DarchetypeArtifactId=maven-archetype-webapp \
  -DarchetypeVersion=1.0 \
  -DgroupId=com.liferay \
  -DartifactId=liferay-portal-lesslibs \
  -Dversion=4.4.1-SNAPSHOT
cd liferay-portal-lesslibs
rm -rf src
]]></script>
</div></div>

<p>修改pom.xml以包括liferay war依赖项</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        &lt;dependency&gt;
            &lt;groupId&gt;com.liferay&lt;/groupId&gt;
            &lt;artifactId&gt;liferay-portal&lt;/artifactId&gt;
            &lt;version&gt;4.4.1&lt;/version&gt;
            &lt;type&gt;war&lt;/type&gt;
	&lt;/dependency&gt;
]]></script>
</div></div>

<p>并使用覆盖描述符配置war插件：</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.1-alpha-1&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;overlays&gt;
                        &lt;overlay&gt;
                            &lt;id&gt;liferay&lt;/id&gt;
                            &lt;groupId&gt;com.liferay&lt;/groupId&gt;
                            &lt;artifactId&gt;liferay-portal&lt;/artifactId&gt;
                            &lt;excludes&gt;
                                &lt;exclude&gt;WEB-INF/classes/log4j.properties&lt;/exclude&gt;
                                &lt;exclude&gt;WEB-INF/geronimo-web.xml&lt;/exclude&gt;
                                &lt;exclude&gt;WEB-INF/jboss-web.xml&lt;/exclude&gt;
                                &lt;exclude&gt;WEB-INF/jonas-web.xml&lt;/exclude&gt;
                                &lt;exclude&gt;WEB-INF/jrun-web.xml&lt;/exclude&gt;
                                &lt;exclude&gt;WEB-INF/resin-web.xml&lt;/exclude&gt;
                                &lt;exclude&gt;WEB-INF/sun-web.xml&lt;/exclude&gt;

                                &lt;!-- use geronimo dependencies rather than inclusion for published artifacts --&gt;
                                &lt;exclude&gt;WEB-INF/lib/activemq.jar&lt;/exclude&gt;
                                &lt;exclude&gt;WEB-INF/lib/commons-digester.jar&lt;/exclude&gt;
                                &lt;!-- other excludes are supplied by geronimo anyway --&gt;
                                &lt;exclude&gt;WEB-INF/lib/cglib.jar&lt;/exclude&gt;
                                &lt;exclude&gt;WEB-INF/lib/commons-logging..jar&lt;/exclude&gt;
                                &lt;exclude&gt;WEB-INF/lib/j2ee-management.jar&lt;/exclude&gt;
                                &lt;exclude&gt;WEB-INF/lib/jmx-remote.jar&lt;/exclude&gt;
                                &lt;exclude&gt;WEB-INF/lib/jmx-ri.jar&lt;/exclude&gt;
                                &lt;exclude&gt;WEB-INF/lib/log4j.jar&lt;/exclude&gt;
                                &lt;exclude&gt;WEB-INF/lib/mx4j.jar&lt;/exclude&gt;
                            &lt;/excludes&gt;
                        &lt;/overlay&gt;
                    &lt;/overlays&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;

    &lt;/build&gt;
]]></script>
</div></div>

<h2 id="AssemblingaserverusingMaven-Buildadatabaseplugin">建立一个数据库插件</h2>

<p>在生命射线父母的奔跑中</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
mvn archetype:create \
  -DarchetypeGroupId=org.apache.geronimo.buildsupport \
  -DarchetypeArtifactId=geronimo-plugin-archetype \
  -DarchetypeVersion=2.2-SNAPSHOT \
  -DartifactId=liferay-derby
]]></script>
</div></div>

<p>更改计划，使其如下所示：</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;connector xmlns=&quot;http://geronimo.apache.org/xml/ns/j2ee/connector-1.2&quot;&gt;
    &lt;resourceadapter&gt;
        &lt;outbound-resourceadapter&gt;
            &lt;connection-definition&gt;
                &lt;connectionfactory-interface&gt;javax.sql.DataSource&lt;/connectionfactory-interface&gt;
                &lt;connectiondefinition-instance&gt;
                    &lt;name&gt;jdbc/LiferayPool&lt;/name&gt;
                    &lt;config-property-setting name=&quot;Password&quot;&gt;liferay&lt;/config-property-setting&gt;
                    &lt;config-property-setting name=&quot;UserName&quot;&gt;liferay&lt;/config-property-setting&gt;
                    &lt;config-property-setting name=&quot;DatabaseName&quot;&gt;liferay&lt;/config-property-setting&gt;
                    &lt;connectionmanager&gt;
                        &lt;local-transaction/&gt;
                        &lt;single-pool&gt;
                            &lt;max-size&gt;10&lt;/max-size&gt;
                            &lt;min-size&gt;0&lt;/min-size&gt;
                            &lt;match-one/&gt;
                        &lt;/single-pool&gt;
                    &lt;/connectionmanager&gt;
                &lt;/connectiondefinition-instance&gt;
&lt;!-- Leave until we figure out if non-jta datasource is needed --&gt;
&lt;!--
                &lt;connectiondefinition-instance&gt;
                    &lt;name&gt;jdbc/NoTxrollerdb&lt;/name&gt;
                    &lt;config-property-setting name=&quot;Password&quot;&gt;roller&lt;/config-property-setting&gt;
                    &lt;config-property-setting name=&quot;UserName&quot;&gt;roller&lt;/config-property-setting&gt;
                    &lt;config-property-setting name=&quot;DatabaseName&quot;&gt;roller&lt;/config-property-setting&gt;
                    &lt;connectionmanager&gt;
                        &lt;no-transaction/&gt;
                        &lt;single-pool&gt;
                            &lt;max-size&gt;10&lt;/max-size&gt;
                            &lt;min-size&gt;0&lt;/min-size&gt;
                            &lt;match-one/&gt;
                        &lt;/single-pool&gt;
                    &lt;/connectionmanager&gt;
                &lt;/connectiondefinition-instance&gt;
--&gt;
            &lt;/connection-definition&gt;
        &lt;/outbound-resourceadapter&gt;
    &lt;/resourceadapter&gt;

&lt;/connector&gt;

]]></script>
</div></div>

<p>并修改pom将geronimoVersion设置为2.1并使用</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    &lt;dependencies&gt;
        &lt;!-- if you are deploying a jee application, use scope provided --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.tranql&lt;/groupId&gt;
            &lt;artifactId&gt;tranql-connector-derby-embed-local&lt;/artifactId&gt;
            &lt;version&gt;1.4&lt;/version&gt;
            &lt;type&gt;rar&lt;/type&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;

        &lt;!-- other dependencies will normally end up as dependencies in the plan and geronimo-plugin.xml --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.geronimo.configs&lt;/groupId&gt;
            &lt;artifactId&gt;system-database&lt;/artifactId&gt;
            &lt;type&gt;car&lt;/type&gt;
            &lt;version&gt;${geronimoVersion}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- include dependencies on all deployer modules needed, with scope provided --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.geronimo.configs&lt;/groupId&gt;
            &lt;artifactId&gt;connector-deployer&lt;/artifactId&gt;
            &lt;type&gt;car&lt;/type&gt;
            &lt;version&gt;${geronimoVersion}&lt;/version&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;
]]></script>
</div></div>

<p>和</p>
<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.geronimo.buildsupport&lt;/groupId&gt;
                &lt;artifactId&gt;car-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;deploymentConfigs&gt;
                        &lt;!-- gbean deployer is default.  For jee apps include all deployers your app needs, see properties --&gt;
                        &lt;deploymentConfig&gt;${gbeanDeployer}&lt;/deploymentConfig&gt;
                        &lt;deploymentConfig&gt;${connectorDeployer}&lt;/deploymentConfig&gt;
                    &lt;/deploymentConfigs&gt;
                    &lt;!-- if you are deploying a jee app specify it here --&gt;
                    &lt;module&gt;
                        &lt;groupId&gt;org.tranql&lt;/groupId&gt;
                        &lt;artifactId&gt;tranql-connector-derby-embed-local&lt;/artifactId&gt;
                        &lt;type&gt;rar&lt;/type&gt;
                    &lt;/module&gt;
                    &lt;!-- Normally you can use the maven dependencies unaltered.  If you need to specify import scope
                     you can list the dependencies here as you want them in the plan.xml --&gt;
                    &lt;useMavenDependencies&gt;
                        &lt;value&gt;true&lt;/value&gt;
                        &lt;includeVersion&gt;true&lt;/includeVersion&gt;
                    &lt;/useMavenDependencies&gt;
                    &lt;!-- the instance sets up most of the optional geronimo-plugin.xml content --&gt;
                    &lt;instance&gt;
                        &lt;plugin-artifact&gt;
                        &lt;/plugin-artifact&gt;
                    &lt;/instance&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;

]]></script>
</div></div>


<h2 id="AssemblingaserverusingMaven-Buildtheliferaywarplugin">构建Liferay War插件</h2>

<p>跑</p>
<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
mvn archetype:create \
  -DarchetypeGroupId=org.apache.geronimo.buildsupport \
  -DarchetypeArtifactId=geronimo-plugin-archetype \
  -DarchetypeVersion=2.2-SNAPSHOT \
  -DartifactId=liferay-jetty
]]></script>
</div></div>

<p>编辑计划，使其看起来像：<br clear="none">注意：这是从liferay计划获得的，并且受liferay（MIT）许可</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
&lt;?xml version=&quot;1.0&quot;?&gt;

&lt;web-app xmlns=&quot;http://geronimo.apache.org/xml/ns/j2ee/web-2.0.1&quot;&gt;

    &lt;environment&gt;
        &lt;inverse-classloading/&gt;
    &lt;/environment&gt;

	&lt;context-root&gt;${LiferayContextPath}&lt;/context-root&gt;
	&lt;security-realm-name&gt;PortalRealm&lt;/security-realm-name&gt;
      &lt;security use-context-handler=&quot;false&quot; xmlns=&quot;http://geronimo.apache.org/xml/ns/security-2.0&quot;&gt;
&lt;!-- requires security to be set up for default subject
        &lt;default-subject&gt;
          &lt;realm&gt;PortalRealm&lt;/realm&gt;
          &lt;id&gt;default&lt;/id&gt;
        &lt;/default-subject&gt;
--&gt;
        &lt;role-mappings&gt;
          &lt;role role-name=&quot;users&quot;&gt;
              &lt;principal class=&quot;com.liferay.portal.security.jaas.PortalRole&quot; name=&quot;users&quot; /&gt;
          &lt;/role&gt;
        &lt;/role-mappings&gt;
      &lt;/security&gt;

    &lt;gbean name=&quot;CredentialStore&quot; class=&quot;org.apache.geronimo.security.credentialstore.SimpleCredentialStoreImpl&quot;&gt;
        &lt;xml-attribute name=&quot;credentialStore&quot;&gt;
            &lt;credential-store xmlns=&quot;http://geronimo.apache.org/xml/ns/credentialstore-1.0&quot;&gt;
                &lt;realm name=&quot;PortalRealm&quot;&gt;
                    &lt;subject&gt;
                        &lt;id&gt;default&lt;/id&gt;
&lt;!-- you will have so set up the backing store appropriately --&gt;
                        &lt;credential&gt;
                            &lt;type&gt;org.apache.geronimo.security.credentialstore.NameCallbackHandler&lt;/type&gt;
                            &lt;value&gt;anonymous&lt;/value&gt;
                        &lt;/credential&gt;
                        &lt;credential&gt;
                            &lt;type&gt;org.apache.geronimo.security.credentialstore.PasswordCallbackHandler&lt;/type&gt;
                            &lt;value&gt;anonymous&lt;/value&gt;
                        &lt;/credential&gt;
                    &lt;/subject&gt;
                &lt;/realm&gt;
            &lt;/credential-store&gt;
        &lt;/xml-attribute&gt;
        &lt;dependency&gt;
            &lt;name&gt;PortalRealm&lt;/name&gt;
        &lt;/dependency&gt;
    &lt;/gbean&gt;



	&lt;gbean name=&quot;PortalRealm&quot; class=&quot;org.apache.geronimo.security.realm.GenericSecurityRealm&quot;&gt;
		&lt;attribute name=&quot;realmName&quot;&gt;PortalRealm&lt;/attribute&gt;
		&lt;reference name=&quot;ServerInfo&quot;&gt;
			&lt;name&gt;ServerInfo&lt;/name&gt;
		&lt;/reference&gt;
		&lt;xml-reference name=&quot;LoginModuleConfiguration&quot;&gt;
			&lt;log:login-config xmlns:log=&quot;http://geronimo.apache.org/xml/ns/loginconfig-2.0&quot;&gt;
				&lt;log:login-module control-flag=&quot;REQUIRED&quot; wrap-principals=&quot;false&quot;&gt;
					&lt;log:login-domain-name&gt;PortalDomain&lt;/log:login-domain-name&gt;
					&lt;log:login-module-class&gt;com.liferay.portal.security.jaas.ext.tomcat.PortalLoginModule&lt;/log:login-module-class&gt;
				&lt;/log:login-module&gt;
			&lt;/log:login-config&gt;
		&lt;/xml-reference&gt;
	&lt;/gbean&gt;
&lt;/web-app&gt;
]]></script>
</div></div>

<p>和pom具有geronimoVersion 2.1，liferayVersion 4.4.1并包括</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
    &lt;dependencies&gt;
        &lt;!-- if you are deploying a jee application, use scope provided --&gt;
        &lt;!-- other dependencies will normally end up as dependencies in the plan and geronimo-plugin.xml --&gt;
        &lt;!-- include dependencies on all deployer modules needed, with scope provided --&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.liferay&lt;/groupId&gt;
            &lt;artifactId&gt;liferay-portal-lesslibs&lt;/artifactId&gt;
            &lt;version&gt;${liferayVersion}-SNAPSHOT&lt;/version&gt;
            &lt;type&gt;war&lt;/type&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
	&lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.geronimo.configs&lt;/groupId&gt;
            &lt;artifactId&gt;javamail&lt;/artifactId&gt;
            &lt;type&gt;car&lt;/type&gt;
            &lt;version&gt;${geronimoVersion}&lt;/version&gt;
        &lt;/dependency&gt;
&lt;!-- replaces activemq jar in lib dir --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;
            &lt;artifactId&gt;activemq-core&lt;/artifactId&gt;
            &lt;type&gt;jar&lt;/type&gt;
            &lt;version&gt;4.1.1&lt;/version&gt;
        &lt;/dependency&gt;
&lt;!-- activemq car does not work because liferay wants to use spring to configure activemq. If we can eliminate the spring 
files in portal-impl.jar perhaps this would work.
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.geronimo.configs&lt;/groupId&gt;
            &lt;artifactId&gt;activemq-ra&lt;/artifactId&gt;
            &lt;type&gt;car&lt;/type&gt;
            &lt;version&gt;${geronimoVersion}&lt;/version&gt;
        &lt;/dependency&gt;
--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.geronimo.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;liferay-derby&lt;/artifactId&gt;
            &lt;type&gt;car&lt;/type&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;portlet-api&lt;/groupId&gt;
            &lt;artifactId&gt;portlet-api&lt;/artifactId&gt;
            &lt;version&gt;1.0&lt;/version&gt;
	&lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.liferay&lt;/groupId&gt;
            &lt;artifactId&gt;portal-kernel&lt;/artifactId&gt;
            &lt;version&gt;${liferayVersion}&lt;/version&gt;
	&lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.liferay&lt;/groupId&gt;
            &lt;artifactId&gt;portal-service&lt;/artifactId&gt;
            &lt;version&gt;${liferayVersion}&lt;/version&gt;
	&lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;xerces&lt;/groupId&gt;
            &lt;artifactId&gt;xercesImpl&lt;/artifactId&gt;
            &lt;version&gt;2.8.1&lt;/version&gt;
	&lt;/dependency&gt;

       &lt;dependency&gt;
            &lt;groupId&gt;saxpath&lt;/groupId&gt;
            &lt;artifactId&gt;saxpath&lt;/artifactId&gt;
            &lt;version&gt;1.0-FCS&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;commons-digester&lt;/groupId&gt;
            &lt;artifactId&gt;commons-digester&lt;/artifactId&gt;
            &lt;version&gt;1.8&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.geronimo.framework&lt;/groupId&gt;
            &lt;artifactId&gt;geronimo-gbean-deployer&lt;/artifactId&gt;
            &lt;type&gt;car&lt;/type&gt;
            &lt;version&gt;${geronimoVersion}&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.geronimo.configs&lt;/groupId&gt;
            &lt;artifactId&gt;jetty6-deployer&lt;/artifactId&gt;
            &lt;type&gt;car&lt;/type&gt;
            &lt;version&gt;${geronimoVersion}&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.geronimo.configs&lt;/groupId&gt;
            &lt;artifactId&gt;jasper-deployer&lt;/artifactId&gt;
            &lt;type&gt;car&lt;/type&gt;
            &lt;version&gt;${geronimoVersion}&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.geronimo.configs&lt;/groupId&gt;
            &lt;artifactId&gt;persistence-jpa10-deployer&lt;/artifactId&gt;
            &lt;type&gt;car&lt;/type&gt;
            &lt;version&gt;${geronimoVersion}&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;
]]></script>
</div></div>

<p>和</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.geronimo.buildsupport&lt;/groupId&gt;
                &lt;artifactId&gt;car-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;deploymentConfigs&gt;
                        &lt;!-- gbean deployer is default.  For jee apps include all deployers your app needs, see properties --&gt;
                        &lt;deploymentConfig&gt;${gbeanDeployer}&lt;/deploymentConfig&gt;
                        &lt;deploymentConfig&gt;${j2eeDeployer}&lt;/deploymentConfig&gt;
                        &lt;deploymentConfig&gt;${jetty6Deployer}&lt;/deploymentConfig&gt;
                        &lt;deploymentConfig&gt;${jasperDeployer}&lt;/deploymentConfig&gt;
                        &lt;!--&lt;deploymentConfig&gt;${jpaDeployer}&lt;/deploymentConfig&gt;--&gt;
                    &lt;/deploymentConfigs&gt;
                    &lt;!-- if you are deploying a jee app specify it here --&gt;

                                        &lt;module&gt;
            &lt;groupId&gt;com.liferay&lt;/groupId&gt;
            &lt;artifactId&gt;liferay-portal-lesslibs&lt;/artifactId&gt;
            &lt;version&gt;${liferayVersion}&lt;/version&gt;
            &lt;type&gt;war&lt;/type&gt;
                                        &lt;/module&gt;

                    &lt;!-- Normally you can use the maven dependencies unaltered. If you need to specify import scope
                     you can list the dependencies here as you want them in the plan.xml --&gt;
                    &lt;useMavenDependencies&gt;
                        &lt;value&gt;true&lt;/value&gt;
                        &lt;includeVersion&gt;true&lt;/includeVersion&gt;
                    &lt;/useMavenDependencies&gt;
                    &lt;!-- the instance sets up most of the optional geronimo-plugin.xml content --&gt;
                    &lt;instance&gt;
                        &lt;plugin-artifact&gt;
                            &lt;!-- extract stuff from the car to the specified location (good for config info --&gt;
                            &lt;!--&lt;copy-file relative-to=&quot;server&quot; dest-dir=&quot;var/roller-data&quot;&gt;themes&lt;/copy-file&gt;--&gt;
                            &lt;!-- content that should go into var/config/config.xml for module customization --&gt;
                            &lt;!-- note the variable ${LiferayContextPath} which is further specified in var/config/config-substitutions.properties --&gt;

                                                        &lt;config-xml-content server=&quot;default&quot;&gt;
                                                            &lt;gbean name=&quot;org.apache.geronimo.plugins/liferay-jetty/${liferayPluginVersion}/car&quot;&gt;
                                                                &lt;attribute name=&quot;contextPath&quot;&gt;${LiferayContextPath}&lt;/attribute&gt;
                                                            &lt;/gbean&gt;
                                                        &lt;/config-xml-content&gt;

                            &lt;!-- a user-tweakable variable to go into var/config/config-substitutions.properties --&gt;
                            &lt;config-substitution key=&quot;LiferayContextPath&quot;&gt;/liferay&lt;/config-substitution&gt;
                        &lt;/plugin-artifact&gt;
                    &lt;/instance&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;

]]></script>
</div></div>

<h2 id="AssemblingaserverusingMaven-Buildanassembly">建立装配体</h2>
<p>在生命射线父母的奔跑中</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
mvn archetype:create \
  -DarchetypeGroupId=org.apache.geronimo.buildsupport \
  -DarchetypeArtifactId=geronimo-assembly-archetype \
  -DarchetypeVersion=2.2-SNAPSHOT \
  -DgroupId=org.apache.geronimo.plugins \
  -DartifactId=geronimo-jetty-liferay \
  -Dversion=1.0-SNAPSHOT
]]></script>
</div></div>

<p>编辑geronimo-jetty-liferay pom，将geronimoVersion设置为2.1，并在服务器中包含所需的顶级模块（控制台可选）</p>

<p>注意：请勿卸下样板！</p>

<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
        &lt;!-- List the plugins you want in your server --&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.geronimo.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;liferay-jetty&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
            &lt;type&gt;car&lt;/type&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.geronimo.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;console-jetty&lt;/artifactId&gt;
            &lt;version&gt;${geronimoVersion}&lt;/version&gt;
            &lt;type&gt;car&lt;/type&gt;
        &lt;/dependency&gt;

]]></script>
</div></div>

<h2 id="AssemblingaserverusingMaven-Runtheproject!">运行项目！</h2>
<p>Maven项目现已完成。运行它并尝试生成的服务器！</p>

<p>在生命射线父母的奔跑中</p>
<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
mvn clean install
]]></script>
</div></div>

<p>要试用生成的服务器，可以在.m2 / repository / org / apache / geronimo / plugins / geronimo-jetty-liferay / 1.0-SNAPSHOT / geronimo-jetty-liferay-1.0-SNAPSHOT-bin下的本地Maven存储库中找到它。 .tar.gz或geronimo-jetty-liferay / target中的构建。</p>

<p>解压并运行</p>
<div class="code panel pdl" style="border-width:1px"><div class="codeContent panelContent pdl">
<script class="brush: java; gutter: false; theme: Default" type="syntaxhighlighter"><![CDATA[
cd geronimo-jetty-liferay/target
tar xzf geronimo-jetty-liferay-1.0-SNAPSHOT-bin.tar.gz
cd geronimo-jetty-liferay-1.0-SNAPSHOT
#edit etc/rc.d/start-server,default.groovy
#insert line 
#command.javaFlags &lt;&lt; &#39;-XX:MaxPermSize=1024m&#39;
#and update -Xmx1024m
./bin/gsh geronimo/start-server
]]></script>
</div></div>

<p>在撰写本文时，服务器将启动，但是访问<a shape="rect" class="external-link" href="http://localhost:8080/liferay" rel="nofollow">http：// localhost：8080 / liferay会</a>重定向到<a shape="rect" class="external-link" href="http://localhost:8080/c" rel="nofollow">http：// localhost：8080 / c</a> ，并显示404错误。</p></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Assembling a server using Maven';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2013，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  

</body></html>