<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=0">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="ldap-sample-app - LDAP Sample Application">
    <meta name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi ldap-sample-app - LDAP Sample Application">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2010-05-11">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0文档：ldap-sample-app-LDAP示例应用程序</title>
  </head>

  <body  onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">主页</a> > <a href="documentation.html">文档</a> > <a href="reference.html">参考</a> > <a href="samples.html">示例</a> > <a href="java-ee-sample-applications.html">Java EE示例应用程序</a> > <a href="ldap-sample-app-ldap-sample-application.html">ldap-sample-app-LDAP示例应用程序</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo v3.0</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">ldap-sample-app-LDAP示例应用程序</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645372"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645372">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645372"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645372">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645372"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645372">新增新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>
<p><parameter ac:name="">最佳</parameter></p>

<p>此样本说明如何使用轻型目录访问协议（LDAP）服务器来配置和控制对Geronimo服务器上资源的访问。</p>

<p>有两个运行此示例的途径。您可以将Apache Geronimo插件（1.0版）用于Apache Directory Service 1.5.1，也可以使用外部LDAP服务器。</p>

<p>安装Apache Geronimo-Apache Directory Server插件的一种方法是在Geronimo管理控制台中导航至<strong>Applications-</strong> > <strong>Plugins</strong> 。进入视图后，更新存储库列表（如果尚未包含已安装的Geronimo版本的存储库，则应添加一个存储库），选择引用的存储库，然后选择“ <strong>显示所选存储库中的插件”</strong>以显示此目录中所有可能的插件的列表。 。找到<strong>Apache Geronimo-Apache目录服务器插件</strong> ，然后安装它。可在<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/geronimo/plugins/directory/branches/1.0/">Geromino目录插件源中</a>找到此插件的<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/geronimo/plugins/directory/branches/1.0/">源</a> 。</p>
<rich-text-body>
<p>注：无法在Geronimo 2.1.2中安装Apache Geronimo-Apache Directory插件。如果将Geronimo 2.1.2与该示例一起使用，则必须使用外部LDAP服务器。但是，可以在Geronimo 2.1.3中安装Apache Geronimo-Apache Directory插件，并且该示例与Geronimo 2.1.3同样有效。</p></rich-text-body>


<p>Geronimo将Apache Directory Server用于其目录服务，这是<a shape="rect" class="external-link" href="http://directory.apache.org">Apache Directory Project的一部分</a> 。Geronimo从ApacheDS项目实现了以下两个项目。</p>

<ul><li><strong>ApacheDS核心</strong><br clear="none">服务器的核心包含所有后端子系统。它取决于协议，并与seda一起使用以服务轻型目录访问协议（LDAP）请求。核心包含JNDI提供程序，拦截器框架，拦截器服务，模式子系统和数据库子系统。因此，核心是服务器的心脏。</li></ul>


<ul><li><strong>共享ApacheDS</strong><br clear="none">创建以消除内核和Maven插件之间的循环项目依赖关系。只要不依赖于其他模块，通常跨模块共享的任何代码都可以放在此处。</li></ul>


<p>有关这两个项目的更多信息，请参见ApacheDS项目URL：<br clear="none">
<a shape="rect" class="external-link" href="http://directory.apache.org/subprojects/apacheds/projects/index.html">http://directory.apache.org/subprojects/apacheds/projects/index.html</a></p>

<p>目前，Geronimo插件仅提供LDAP查看功能，尚不提供编辑功能，但是计划在下一版Geronimo中添加此功能。您将必须使用ldapbrowser / editor，jxplorer或gq之类的外部LDAP客户端在Geronimo中编辑Directory Server的配置。</p>

<p>另一种选择是将Geronimo与外部LDAP服务器一起使用。例如，您可以下载Apache Directory Service二进制文件，启动ldap服务器并使用ldap-sample.ldif给定加载它，并遵循其余示例说明。</p>


<p>本文分为以下几节：</p>
<parameter ac:name="maxLevel">3</parameter>

<h1 id="ldap-sample-app-LDAPSampleApplication-StartingtheLDAPserver">启动LDAP服务器</h1>
<p>如果您安装了Apache Geronimo-Apache Directory插件，则应在安装过程中启动它。您可以使用部署程序工具或通过Geronimo管理控制台来验证它是从命令行启动的。</p>

<p>使用管理控制台，从左侧导航菜单上单击“ <strong>系统模块”</strong> ，然后在“ <strong>已安装的系统模块”</strong> portlet中查找组件名称<strong>org.apache.geronimo.plugins / directory</strong> 。您将看到此特定组件的当前状态和可用命令。</p>

<p>或者，如果您使用的是外部LDAP服务器，请以正常方式启动该服务器，然后按照此处的其余说明进行操作。</p>

<p><a shape="rect" href="ldap-sample-app-ldap-sample-application.html">回到顶部</a></p>

<h1 id="ldap-sample-app-LDAPSampleApplication-SourceCodeforSample">样本源代码</h1>

<p>请参考<a shape="rect" href="../GMOxDOC21/sample-applications.html">样本常规信息，</a>以获取有关获取和构建此样本以及其他样本的源的信息。</p>


<p>此时，您可以选择安装LDAP客户端并导入/导出<strong><code>.ldif</code></strong>文件到目录服务器。但是，这不是必需的。如果选择不安装LDAP客户端，则会提供说明。</p>

<p><a shape="rect" href="ldap-sample-app-ldap-sample-application.html">回到顶部</a></p>

<h1 id="ldap-sample-app-LDAPSampleApplication-AddLDAPentries">添加LDAP条目</h1>
<p>确保Geronimo已启动并正在运行，并且目录服务已启动。</p>

<h2 id="ldap-sample-app-LDAPSampleApplication-Toaddentriesmanually">手动添加条目</h2>
<p>安装<strong>Apache Geronimo-Apache Directory插件时，</strong>您可能会在控制台上注意到一条类似于以下内容的消息：</p>

<parameter ac:name="borderStyle">固定的</parameter> <plain-text-body>WARN [ServerContextFactory] LDIF加载目录'/Users/user1/geronimo-tomcat6-javaee5-2.1/var/ldif'不存在。不会加载任何LDIF文件。
</plain-text-body>

<p>这是因为目录服务器尚无任何内容。您可以通过以下方式手动添加示例所需的内容：在消息（ <geronimo-home>/ var / ldif /）中</geronimo-home>指定示例位置中包含示例源中的<strong>ldap-sample.ldif</strong> ， <geronimo-home>然后重新启动Geronimo服务器或仅在服务器中重新配置目录配置。</geronimo-home></p>

<h2 id="ldap-sample-app-LDAPSampleApplication-ToaddentriesusinganLDAPclient">使用LDAP客户端添加条目</h2>
<p>启动您的LDAP客户端，并使用以下值创建一个新的连接配置文件：</p>

<div class="table-wrap"><table class="confluenceTable"><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>主办：</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p> <localhost> </localhost></p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>港口：</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>10389</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>基本DN：</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>ou =系统</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>用户DN：</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>uid = admin，ou = system</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>密码：</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>秘密</p></td></tr></tbody></table></div>


<p>连接到Geronimo Directory服务器后，您将看到初始配置，此配置可以作为备份导出到ldif文件中。根据您使用的LDAP客户端，导出/导入步骤将有所不同。例如，要使用<strong>ldapsearch</strong>工具导出初始配置，请执行以下命令：</p>

<p><code><strong>ldapsearch -h localhost -p 10389 -b "ou=system" -D "uid=admin,ou=system" -w secret -x "(objectclass=*)"</strong></code></p>

<p>导出初始配置时，您将得到一个ldif文件，其内容类似于以下示例中所示。</p>
<parameter ac:name="title">export.ldif</parameter> <parameter ac:name="borderStyle">固定</parameter> <plain-text-body>dn：ou = system ou：系统objectClass：organizationalUnit objectClass：top dn：uid = admin，ou = system displayName：目录超级用户uid：admin userPassword :: c2VjcmV0 objectClass：inetOrgPerson objectClass：organizationalPerson objectClass：person objectClass：top sn：管理员cn：系统管理员dn：ou =用户，ou =系统ou：用户objectClass：organizationalUnit objectClass：顶级dn：ou = groups，ou = system ou：groups objectClass：organizationalUnit objectClass：top dn：ou = configuration，ou =系统ou：配置objectClass：organizationalUnit objectClass：顶级dn：ou =分区，ou =配置，ou =系统ou：分区objectClass：organizationalUnit objectClass：顶级dn：ou =服务，ou =配置，ou =系统ou：服务objectClass ：organizationalUnit objectClass：顶部dn：ou =拦截器，ou = configuration，ou =系统ou：拦截器objectClass：organizationalUnit objectClass：顶部dn：prefNodeName = sysPrefRoot，ou =系统objectClass：extensibleObject pref节点名称：sysPrefRoot</plain-text-body>

<p>现在，您需要导入运行示例应用程序所需的条目。与示例应用程序打包在一起的是一个示例<strong><code>.ldif</code></strong>文件，其中包含运行LDAP示例应用程序所需的所有条目，该文件位于<strong><ldap_home>/ldap-sample.ldif中</ldap_home></strong> 。要使用<strong>ldapmodify</strong>工具导入数据， <strong>请</strong>执行以下命令：</p>

<p><code><strong>ldapmodify -h localhost -p 10389 -D "uid=admin,ou=system" -w secret -x -a -f <ldap_home>/ldap-sample.ldif</strong></code></p>

<p>以下示例显示了<strong><code>ldap-sample.ldif</code></strong>文件。</p>
<parameter ac:name="title">ldap-sample.ldif</parameter> <parameter ac:name="borderStyle">solid</parameter> <plain-text-body>＃用户：system dn：uid = system，ou = users，ou = system cn：John Doe sn：Doe给定名称：John对象类：top对象类：person对象类：OrganizationalPerson对象类：inetOrgPerson ou：人力资源ou ：人员l：拉斯维加斯uid：系统邮件：system@apachecon.comm电话号码：+1 408 555 5555 facsimiletelephone电话号码：+1 408 555 5556房间号：4613 userPassword：管理员＃用户名：user1 dn：uid = user1，ou = users， ou = system cn：用户sn：一个给定名称：User1对象类：顶级对象类：person对象类：OrganizationalPerson对象类：inetOrgPerson ou：人力资源ou：人员l：拉斯维加斯uid：user1邮件：user1@apachecon.comm电话号码：+1 408 555 5555 facsimiletelephone号：+1 408 555 5556房间号：4613 userPassword：p1＃用户：user2 dn：uid = user2，ou = users，ou = system cn：User sn：两个给定名称：User2对象类：顶级对象类：人员对象类：OrganizationalPerson对象类：inetOrgPerson ou：人力资源ou：人l：拉斯维加斯ui d：user2邮件：user2@apachecon.comm电话号码：+1 408 555 5555 facsimiletelephone电话号码：+1 408 555 5556房间号：4613 userPassword：p2＃组：admin dn：cn = admin，ou = groups，ou = system objectClass：groupOfUniqueNames uniqueMember：uid = system，ou = users，ou = system uniqueMember：uid = user2，ou = users，ou = system cn：admin＃Group：guest dn：cn = guest，ou = groups，ou = system objectClass：groupOfUniqueNames uniqueMember ：uid = user1，ou = users，ou = system cn：guest</plain-text-body>

<p>导入文件后，您将获得确认已成功导入五个条目的确认。</p>

<p><a shape="rect" href="ldap-sample-app-ldap-sample-application.html">回到顶部</a></p>

<h1 id="ldap-sample-app-LDAPSampleApplication-DeploytheLDAPrealm">部署LDAP领域</h1>

<p>安装该示例的LDAP领域的一种方法是安装为此目的创建的Geronimo插件。您可以通过在Geronimo管理控制台中导航到<strong>Applications-</strong> > <strong>Plugins来实现</strong> 。进入视图后，更新存储库列表（应添加<a shape="rect" class="external-link" href="http://geronimo.apache.org/plugins/geronimo-2.1/">http://geronimo.apache.org/plugins/geronimo-2.1/（</a>如果尚未包含），选择引用的存储库，然后选择<strong>“在所选存储库</strong>中显示<strong>插件”</strong>以显示此目录中所有可能的插件的列表。找到<strong>Geronimo Samples :: ldap-sample-app ::安全领域</strong> ，然后安装它。但是，此过程隐藏了创建和安装领域的许多细节。有关这些详细信息，请参阅下一节。</p>

<h2 id="ldap-sample-app-LDAPSampleApplication-LDAPrealmdeploymentdetails">LDAP领域部署详细信息</h2>

<p>LDAP示例应用程序提供了一个安全领域，需要在部署应用程序本身之前对其进行部署。该领域位于<strong><ldap_home>/ldap-realm.xml中</ldap_home></strong> ，其内容在以下示例中进行了说明。</p>

<parameter ac:name="">xml</parameter> <parameter ac:name="title">ldap-realm.xml</parameter> <parameter ac:name="borderStyle">solid</parameter> <plain-text-body><module xmlns="http://geronimo.apache.org/xml/ns/deployment-1.2"><environment><moduleid><groupid>console.realm</groupid> <artifactid>LDAP_Sample_Realm</artifactid> <version>1.0</version> <type>汽车</type></moduleid></environment> <gbean name="LDAP_Sample_Realm" class="org.apache.geronimo.security.realm.GenericSecurityRealm" xsi:type="dep:gbeanType" xmlns:dep="http://geronimo.apache.org/xml/ns/deployment-1.2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><attribute name="realmName">LDAP_Sample_Realm</attribute> <reference name="ServerInfo"><name>ServerInfo</name></reference> <xml-reference name="LoginModuleConfiguration"><log:login-config xmlns:log="http://geronimo.apache.org/xml/ns/loginconfig-1.2"><log:login-module control-flag="REQUIRED" wrap-principals="false"><log:login-domain-name>LDAP_Sample_Realm</log:login-domain-name> <log:login-module-class>org.apache.geronimo.security.realm.providers。LDAPLoginModule</log:login-module-class> <log:option name="initialContextFactory">com.sun.jndi.ldap。LdapCtxFactory</log:option> <log:option name="connectionURL">LDAP：//本地主机：10389</log:option> <log:option name="connectionUsername">UID =管理员，OU =系统</log:option> <log:option name="connectionPassword">秘密</log:option> <log:option name="authentication">简单</log:option> <log:option name="userBase">OU =用户，OU =系统</log:option> <log:option name="userSearchMatching">的uid = {0}</log:option> <log:option name="userSearchSubtree">假</log:option> <log:option name="roleBase">OU =基团，OU =系统</log:option> <log:option name="roleSearchMatching"><log:option name="roleName">CN（uniqueMember</log:option> = {0}）</log:option> <log:option name="roleSearchSubtree">假</log:option></log:login-module> <log:login-module control-flag="OPTIONAL" wrap-principals="false"><log:login-domain-name>LDAP_Sample_Realm-审计</log:login-domain-name> <log:login-module-class>组织.apache.geronimo.security.realm.providers。FileAuditLoginModule</log:login-module-class> <log:option name="file">var / log / login-attempts.log</log:option>
                </log:login-module>
            </log:login-config>
        </xml-reference>
    </gbean>
</module>
</plain-text-body>

<p>该部署计划将针对LDAP数据库的所有连接和搜索参数告知Geronimo。该计划还指定将每次登录尝试记录到<code>login-attempts.log</code>日志文件。</p>

<p>要部署ldap-realm.xml，请从<geronimo_home>/ bin目录</geronimo_home>运行以下命令<geronimo_home>：</geronimo_home></p>

<p><code><strong>java -jar deployer.jar --user system --password manager deploy <ldap_home>/ldap-realm.xml</strong></code></p>

<p>部署后，您将看到类似于以下示例的确认消息：</p>
<parameter ac:name="borderStyle">固态</parameter> <plain-text-body>D：\ geronimo-tomcat6-jee5-2.0 \ bin>部署使用GERONIMO_BASE部署\ samples \ 2.0 \ ldap-sample-app \ ldap-realm.xml：D：\ geronimo-tomcat6-javaee5-2.1.2使用GERONIMO_HOME： D：\ geronimo-tomcat6-javaee5-2.1.2使用GERONIMO_TMPDIR：D：\ geronimo-tomcat6-javaee5-2.1.2 \ var \ temp使用JRE_HOME：C：\ Java \ jdk1.5.0_06 \\ jre部署console.realm /LDAP_Sample_Realm/1.0/汽车</plain-text-body>
<p><a shape="rect" href="ldap-sample-app-ldap-sample-application.html">回到顶部</a></p>

<p>有关更多详细信息，请参阅<a shape="rect" href="ldap-realm.html">LDAP领域</a>部分。</p>

<h1 id="ldap-sample-app-LDAPSampleApplication-CreatingandInstallingtheLDAPSampleApplication">创建和安装LDAP示例应用程序</h1>
<p>安装LDAP示例应用程序的一种方法是安装为此目的创建的Geronimo插件。您可以通过在Geronimo管理控制台中导航到<strong>Applications-</strong> > <strong>Plugins来实现</strong> 。进入视图后，更新存储库列表（应添加<a shape="rect" class="external-link" href="http://geronimo.apache.org/plugins/geronimo-2.1.2/">http://geronimo.apache.org/plugins/geronimo-2.1.2/（</a>如果尚未包含），选择引用的存储库，然后选择<strong>“在所选存储库中显示插件”。</strong>以显示此目录中所有可能的插件的列表。找到<strong>适用于Tomcat的</strong> <strong>Geronimo Configs :: LDAP样本或适用于Jetty的Geronimo Configs :: LDAP样本</strong> （取决于您的Geronimo服务选择），然后安装它。但是，此过程隐藏了创建和安装示例的许多细节。有关这些详细信息，请参阅下一节。</p>

<h2 id="ldap-sample-app-LDAPSampleApplication-Deploymentplans">部署计划</h2>

<p>该示例有一个通用的部署计划。该计划的未处理版本位于ldap-sample-app / ldap-sample-app-jetty / src / main / plan / plan.xml。构建项目后，可以在ldap-sample-app / ldap-sample-app-jetty / target / resources / META-INF / plan.xml中找到此处显示的具有插件名称和所有依赖项的已处理版本。</p>

<parameter ac:name="">xml</parameter> <parameter ac:name="title">plan.xml</parameter> <parameter ac:name="borderStyle">solid</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><web-app xmlns="http://geronimo.apache.org/xml/ns/j2ee/web-1.2"><dep:environment xmlns:dep="http://geronimo.apache.org/xml/ns/deployment-1.2"><dep:moduleid><dep:groupid>org.apache.geronimo.samples</dep:groupid> <dep:artifactid>ldap-sample-app-jetty</dep:artifactid> <dep:version>2.1.2</dep:version> <dep:type>car</dep:type></dep:moduleid> <dep:dependencies><dep:dependency><dep:groupid>org.apache.geronimo.samples</dep:groupid> <dep:artifactid>ldap-sample-app-realm</dep:artifactid> <dep:version>2.1.2</dep:version> <dep:type>car</dep:type></dep:dependency> <dep:dependency><dep:groupid>org.apache.geronimo.configs</dep:groupid> <dep:artifactid>jasper</dep:artifactid> <dep:version>2.1 .2</dep:version> <dep:type>汽车</dep:type></dep:dependency> <dep:dependency><dep:groupid>org.apache.geronimo.configs</dep:groupid> <dep:artifactid>jetty6</dep:artifactid> <dep:version>2.1.2</dep:version> <dep:type>汽车</dep:type></dep:dependency></dep:dependencies> <dep:hidden-classes></dep:hidden-classes><dep:non-overridable-classes></dep:non-overridable-classes></dep:environment> <context-root>/ LDAP_Sample</context-root> <security-realm-name>LDAP_Sample_Realm</security-realm-name> <security><default-principal realm-name="LDAP_Sample_Realm"><principal class="org.apache.geronimo.security.realm.providers.GeronimoUserPrincipal" name="system"></principal></default-principal> <role-mappings><role role-name="content-administrator"><realm realm-name="LDAP_Sample_Realm"><principal class="org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal" name="admin" designated-run-as="true"></principal><principal class="org.apache.geronimo.security.realm.providers.GeronimoUserPrincipal" name="system"></principal></realm></role> <role role-name="guest"><realm realm-name="LDAP_Sample_Realm"><principal class="org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal" name="guest" designated-run-as="true"></principal><principal class="org.apache.geronimo.security.realm.providers.GeronimoUserPrincipal" name="user1"></principal></realm></role></role-mappings></security></web-app><!--?xml--></plain-text-body>

<p>大多数部署计划都是直接的。但是，安全配置很棘手。<security-realm-name><security>通过在每个<realm>元素中</realm>的一系列声明在<realm>元素中描述。</realm></security></security-realm-name></p>

<p>尽管web.xml指定了安全角色，但是plan.xml映射了它们所属的Geronimo安全领域中的特定用户或组。如果存在未登录的用户，则默认为该<default-principal>元素中</default-principal>定义的用户<default-principal>。</default-principal></p>

<p>该项目中有两个角色：content-administrator和guest。它们各自拥有两个主体：GeronimoGroupPrincipal和GeronimoUserPrincipal。由于某些主体打开了“指定运行方式”标志，因此如果可部署对象在web.xml中设置了运行方式角色，则将使用它们。</p>

<p>请注意，这些角色映射将被LDAP服务器中定义的实际角色（哪些用户属于哪些组）覆盖。最终，确定验证方法的是应用程序部署计划中定义的领域。但是，对于此特定示例，您仍然需要定义<a shape="rect" class="external-link" href="http://geronimo.apache.org/xml-schemas.html">XML模式中</a>确定的主体和角色映射</p>

<p><a shape="rect" href="ldap-sample-app-ldap-sample-application.html">回到顶部</a></p>

<p>下例中显示的<strong>web.xml</strong>部署描述符（也位于<strong><ldap_home>/ WEB-INF</ldap_home></strong>目录中）基于文件的位置添加了安全约束。</p>

<parameter ac:name="">xml</parameter> <parameter ac:name="title">web.xml</parameter> <parameter ac:name="borderStyle">solid</parameter> <plain-text-body><!--?xml version="1.0" encoding="ISO-8859-1" ?=""--><web-app xmlns="http://java.sun.com/xml/ns/j2ee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd" version="2.4"><welcome-file-list><welcome-file>index.html</welcome-file></welcome-file-list> <security-constraint><web-resource-collection><web-resource-name>管理员角色</web-resource-name> <url-pattern>/ protect / *</url-pattern></web-resource-collection> <auth-constraint><role-name>content-administrator</role-name></auth-constraint></security-constraint> <security-constraint><web-resource-collection><web-resource-name>禁止访问</web-resource-name> <url-pattern>/ forbidden / *</url-pattern></web-resource-collection> <auth-constraint></auth-constraint></security-constraint> <login-config><auth-method>格式</auth-method> <realm-name>ldap-realm-1</realm-name> <form-login-config><form-login-page>/auth/logon.html？param = test</form-login-page> <form-error-page>/auth/logonError.html？param =测试</form-error-page></form-login-config></login-config> <security-role><role-name>内容管理员</role-name></security-role>

</web-app>
<!--?xml--></plain-text-body>
<p><a shape="rect" href="ldap-sample-app-ldap-sample-application.html">回到顶部</a></p>

<h2 id="ldap-sample-app-LDAPSampleApplication-Packagethesampleapplication">打包示例应用程序</h2>

<p>您可以从ldap-sample-app-war目录中单独构建战争，并发出以下命令：</p>

<p><strong><code>mvn clean install</code></strong></p>

<p>此命令会将所有现有文件和目录打包在其中<strong><ldap_home></ldap_home></strong> 。尽管.war文件中不需要这些文件，但还将包含ldap-realm.xml和ldap-sample.ldif文件。</p>

<p><a shape="rect" href="ldap-sample-app-ldap-sample-application.html">回到顶部</a></p>

<h2 id="ldap-sample-app-LDAPSampleApplication-Deploythesampleapplication">部署样本应用程序</h2>

<p>为特定的服务器映像（tomcat或jetty）部署适当的Geronimo插件是最容易的。这将按照指定的Geronimo部署计划部署样本应用程序。但是，您可以选择使用适当的部署计划来部署战争。要以这种方式部署LDAP示例应用程序，请确保Geronimo服务器已启动并正在运行。打开命令行窗口，将目录更改为<geronimo_home>/ bin并运行以下命令：</geronimo_home></p>

<p><code><strong>java -jar deployer.jar --user system --password manager deploy <ldap_home>/ldap-demo.war</strong> <deployment_plan_home>/plan.xml</code></p>


<h1 id="ldap-sample-app-LDAPSampleApplication-Testingthesampleapplication">测试示例应用程序</h1>

<p>成功部署Web应用程序后，您将看到一条确认消息，类似于以下示例中所示：</p>

<parameter ac:name="borderStyle">固态</parameter> <plain-text-body>D：\ geronimo-tomcat6-jee5-2.0 \ bin>部署使用GERONIMO_BASE部署\ samples \ 2.0 \ ldap-sample-app \ ldap-demo.war：D：\ geronimo-tomcat6-javaee5-2.1.2使用GERONIMO_HOME： D：\ geronimo-tomcat6-javaee5-2.1.2使用GERONIMO_TMPDIR：D：\ geronimo-tomcat6-javaee5-2.1.2 \ var \ temp使用JRE_HOME：C：\ Java \ jdk1.5.0_06 \\ jre部署的样本/ LDAP_Sample /1.2/war @ http：// localhost：8080 / LDAP_Sample</plain-text-body>

<p>要测试LDAP应用程序，请打开Web浏览器并访问以下URL：</p>

<p><a shape="rect" class="external-link" href="http://localhost:8080/LDAP_Sample" rel="nofollow">http：// localhost：8080 / LDAP_Sample</a></p>

<p>下图显示了LDAP示例应用程序的欢迎页面。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="ldap-sample-app-ldap-sample-application.data/ldap_1.jpg"></span></p>

<p>单击<a shape="rect" class="external-link" href="http://localhost:8080/LDAP_Sample/protect/" rel="nofollow">保护</a>以针对LDAP目录服务器进行验证。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="ldap-sample-app-ldap-sample-application.data/ldap_2.jpg"></span></p>

<p>输入<strong>system</strong>作为用户名，并输入<strong>manager</strong>作为密码，然后单击<strong>Login</strong> 。您在此处提供的用户名和密码与用于访问Geronimo Web控制台的用户名和密码相同，并且存储在Directory Server数据库中。登录后，您将看到以下屏幕。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="ldap-sample-app-ldap-sample-application.data/ldap_3.jpg"></span></p>

<p>此时，您有一个应用程序，该应用程序将根据您先前在LDAP领域中提供的安全配置，针对LDAP Directory Server数据库验证用户名和密码。现在，如果返回欢迎页面并单击“ <a shape="rect" class="external-link" href="http://localhost:8080/LDAP_Sample/forbidden/" rel="nofollow">禁止”，</a>您将收到一个403-禁止HTTP错误，类似于下图所示。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="ldap-sample-app-ldap-sample-application.data/ldap_4.jpg"></span></p>

<p>根据您使用的Web容器（即Jetty或Tomcat）的不同，该屏幕的显示可能会略有不同。</p>

<p>为了进一步测试该示例，您现在可以尝试使用<strong><code>ldap-sample.ldif</code></strong> ，请使用您的LDAP客户端并从不同组添加/删除用户。您会立即注意到更改（您可能需要关闭Web浏览器）。</p>

<p><a shape="rect" href="ldap-sample-app-ldap-sample-application.html">回到顶部</a></p></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : ldap-sample-app - LDAP Sample Application';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2013，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  

</body></html>