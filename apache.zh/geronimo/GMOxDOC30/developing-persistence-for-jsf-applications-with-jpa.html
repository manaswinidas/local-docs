<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Developing persistence for JSF applications with JPA" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Developing persistence for JSF applications with JPA" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>

  <link href='http://geronimo.apache.org/resources/highlighter/styles/shCoreGeronimo.css' rel='stylesheet' type='text/css' />
  <link href='http://geronimo.apache.org/resources/highlighter/styles/shThemeGeronimo.css' rel='stylesheet' type='text/css' />
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shCore.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushJava.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushXml.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushPlain.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushBash.js' type='text/javascript'></script>
  
  <script type="text/javascript">
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
  </script>

    <title>Apache Geronimo v3.0 Documentation: Developing persistence for JSF applications with JPA</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="developing.html">Developing</a>&nbsp;&gt;&nbsp;<a href="tutorials.html">Tutorials</a>&nbsp;&gt;&nbsp;<a href="developing-jpa-applications.html">Developing JPA applications</a>&nbsp;&gt;&nbsp;<a href="developing-persistence-for-jsf-applications-with-jpa.html">Developing persistence for JSF applications with JPA</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Developing persistence for JSF applications with JPA</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645260">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645260">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645260">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645260">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645260">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645260">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent">
<p>The Java Persistence API is a new programming model under EJB3.0 specification (JSR220) for the management of persistence and object/relational mapping with Java EE and Java SE. With JPA, developers can easily develop java applications that perform operations on relational databases using java objects and mapping. In that way, java applications developed using JPA are not only portable across different platforms, but also applications can be easily developed using simple yet powerful programming model provided by JPA. This greatly improves application maintainability against ever changing database world. JPA insulates applications from all the complexity and non-portable boilerplate code involved in database connectivity and operations.</p>

<p>Apache geronimo uses <a shape="rect" class="external-link" href="http://openjpa.apache.org/">OpenJPA</a> for providing Java Persistence API to Java EE applications deployed in the server. Even though JPA is a part of EJB3.0 spec, it is independent of it. Hence, JPA can be used in JavaSE, web and ejb applications in the same uniform way. </p>

<p>Below tutorial explains developing a JSF (JavaServerFaces) application using JPA for persistence. The application has an ejb application and a web application. The ejb application uses JPA to manipulate entities in the database. The web application uses JSF to look up ejbs that trigger operations on the entities. The database being used is the embedded derby database shipped with geronimo. The web application displays a list of currencies of various countries along with the corresponding USD conversion rate. The web interface allows user to add a new currency, edit the existing currency and delete a currency etc. </p>

<p>The application can be downloaded from this <a shape="rect" href="developing-persistence-for-jsf-applications-with-jpa.data/JPA-JSFApp.ear?version=1&amp;modificationDate=1212445244000&amp;api=v2" data-linked-resource-id="20873757" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="JPA-JSFApp.ear" data-nice-type="Java Archive" data-linked-resource-content-type="application/octet-stream" data-linked-resource-container-id="20645260" data-linked-resource-container-version="48">link</a>.</p>

<p>In order to develop, deploy and run the application, the following environment is required.</p>

<ul><li>Sun JDK 5.0+ (J2SE 1.5)</li><li>Eclipse 3.3.1.1 (Eclipse Classic package of Europa distribution), which is platform specific</li><li>Web Tools Platform (WTP) 2.0.1</li><li>Data Tools Platform (DTP) 1.5.1</li><li>Eclipse Modeling Framework (EMF) 2.3.1</li><li>Graphical Editing Framework (GEF) 3.3.1</li><li>Apache Geronimo 2.1</li></ul>


<p>The tutorial covers following topics.</p>

<ul><li>Setting the Eclipse environment</li><li>Creating ejb application with entities</li><li>Creating web application with JSF configuration</li><li>Deploying the (ear) application</li><li>Setting up the database tables</li><li>Running the application</li></ul>


<h2 id="DevelopingpersistenceforJSFapplicationswithJPA-SettingtheEclipseenvironment">Setting the Eclipse environment</h2>

<p>1. Download the geronimo v2.1 and install it in your system. Look into the geronimo documentation for <br clear="none">
   instructions to install the server.</p>

<p>2 Install the eclipse IDE and download geronimo eclipse plugin and install it on top of eclipse. Look into the<br clear="none">
  geronimo eclipse plugin documentation for instructions.</p>

<p>3. Create a runtime environment for geronimo v2.1 in the eclipse. Look into the geronimo eclipse plugin <br clear="none">
   documentation for instructions to install a runtime environment for geronimo.</p>

<h2 id="DevelopingpersistenceforJSFapplicationswithJPA-Creatingejbapplicationwithentities">Creating ejb application with entities</h2>

<p>1. Open the eclipse IDE and change the perspective to <em>Java EE</em> by clicking on <em>Windows =&gt; Open Perspective =&gt; Other</em>. It will open up <em>Open Perspective</em> wizard as shown in the screen shot below. Select <em>Java EE</em> from the list and click <em>OK</em> button.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/1.jpg"></span></p>

<p>2. Right click on the <em>Package Explorer</em> and select <em>EJB Project</em>. </p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/2.jpg"></span></p>

<p>3. This will open up the <em>New EJB Project</em> wizard. Provide the values for <em>Project Name</em>, <em>Target Runtime</em> as shown in the below screen shot.</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>If target runtime is not setup, create a new target runtime pointing to geronimo installation directory. For more information, look at the geronimo documentation that explains setting up eclipse plugin for geronimo and setting up runtime environment. This setup is required to resolve class dependencies during compilation.</p></div></div>
<p>Click on the <em>Next</em> button.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/3.jpg"></span></p>

<p>4. Select the checkboxes as given in the below screen shot and click on the <em>Next</em> button.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/4.jpg"></span></p>

<p>5. Select the checkboxes as given in the below screen shot and click on the <em>Next</em> button.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/5.jpg"></span></p>

<p>6. Provide the following values in the textboxes as shown in the below screen shot and click on the <em>Finish</em> button.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/6.jpg"></span></p>

<p>7. Right click on the <em>CurrencyEJB</em> project and navigate to <em>New =&gt; Class</em> option. Provide the following values in the <em>New Java Class</em> wizard and click on <em>Finish</em> button.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/7.jpg"></span></p>

<p>8. Copy the following contents into <code>Currency.java</code>. The <code>Currency.java</code> uses various JPA annotations to mark the class as an entity and designates database table to persist the attribute values.</p>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>Currency.java</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package sample.jpa.currency;

import java.io.Serializable;
import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.Table;


@Entity
@Table(name="CurrencyRateTable")
public class Currency implements Serializable {
	
 @Id
  public String currencyName;
  public String countryName;
  public double rateAgstUSD;

  public Currency(){
  }

  public String getCurrencyName() {
   return currencyName;
  }

  public void setCurrencyName(String currencyName) {
   this.currencyName = currencyName;
  }

  public String getCountryName() {
   return countryName;
  }

  public void setCountryName(String countryName) {
   this.countryName = countryName;
  }

  public double getRateAgstUSD() {
   return rateAgstUSD;
  }

  public void setRateAgstUSD(double rateAgstUSD) {
   this.rateAgstUSD = rateAgstUSD;
  }
}
</pre>
</div></div>

<p>9. Similarly, create the interface <code>CurrencyInterface.java</code> and copy the following contents. This is the  <br clear="none">
   stateless session bean interface.</p>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>CurrencyInterface.java</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package sample.jpa.currency;
import java.util.List;
public interface CurrencyInterface {
 public Currency createCurrency(String currencyName, 
                                String countryName, 
                                double rateAgstUSD);
	
 public List listCurrencies();
	
 public Currency updateCurrency(String currencyName, 
                                double rateAgstUSD);
	
 public void deleteCurrency(String currencyName);
	
 public Currency retrieveCurrency(String currencyName);
	
}
</pre>
</div></div>

<p>10. Similarly, create <code>CurrencyBean.java</code> and copy the following contents. This class is the bean class that implements <code>CurrencyInterface.java</code> interface.</p>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>CurrencyBean.java</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package sample.jpa.currency;

import java.util.List;
import javax.ejb.Local;
import javax.ejb.Remote;
import javax.ejb.Stateless;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;

@Stateless
@Local
public class CurrencyBean implements CurrencyInterface{

 @PersistenceContext(unitName="CurrencyRateUnit")
 private EntityManager em;
	
 public Currency createCurrency(String currencyName, 
                                String countryName, 
			        double rateAgstUSD){
		
  Currency crt1 = em.find(Currency.class, currencyName);

  if(crt1 != null) 
   throw new IllegalArgumentException
   ("Currency already exists: Currency Name ("+currencyName+")");

  Currency crt = new Currency();
		
  crt.setCountryName(countryName);
  crt.setCurrencyName(currencyName);
  crt.setRateAgstUSD(rateAgstUSD);
		

  System.out.println("Persisting Currency Rate entity: 
   (Currency = "+currencyName+")");

  em.persist(crt);

  System.out.println("Persisted successfully Currency entity: 
   (Currency = "+currencyName+")");
  return crt;
	
 }
	
 public List listCurrencies(){
  if(em == null) System.out.println("em is null!!!");

  Query q = em.createQuery("SELECT crt FROM Currency crt");

  List currList = q.getResultList();

  return currList;
 }
	
 public Currency updateCurrency(String currencyName, 
                                double rateAgstUSD){
  if(em == null) System.out.println("em is null!!!");
		
  Currency crt1 = em.find(Currency.class, currencyName);

  if(crt1 == null) throw new IllegalArgumentException
   ("Currency not found: Currency Name ("+currencyName+")");

  crt1.setRateAgstUSD(rateAgstUSD);

  return crt1;
		 
 }
	
 public void deleteCurrency(String currencyName){
  if(em == null) System.out.println("em is null!!!");

  Currency crt1 = em.find(Currency.class, currencyName);

  if(crt1 == null) throw new 
   IllegalArgumentException
   ("Currency not found: Currency Name ("+currencyName+")");

  em.remove(crt1);
 }

 public Currency retrieveCurrency(String currencyName){
  Currency crt1 = em.find(Currency.class, currencyName);
  return crt1;
 }
	
}
</pre>
</div></div>

<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>@PersistenceContext(unitName="CurrencyRateUnit") annotation is used to inject the EntityManager object by container. In this case, the EntityManager object injected is Container Managed EntityManager object. The transaction type is <code>JTA</code> and the persistence scope is <code>Transaction</code>.<br clear="none">
Since we have not declared any transactional attributes in the <code>CurrencyBean</code>, the default is Container Managed Transaction with transaction attribute being <code>REQUIRED</code> for the bean methods. So, the EntityManager object will join the EJB transaction whenever a method is called on the bean.</p></div></div>

<p>11. As outlined above, right click on the <code>META-INF</code> directory of <em>CurrencyEJB</em> project and create <code>persistence.xml</code>. Copy the following contents into <code>persistence.xml</code>.</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>persistence.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence xmlns="http://java.sun.com/xml/ns/persistence"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.0"
 xsi:schemaLocation="http://java.sun.com/xml/ns/persistence 
 http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"&gt;

 &lt;persistence-unit name="CurrencyRateUnit"&gt;
 &lt;description&gt;JPA JSF Sample&lt;/description&gt;
 &lt;provider&gt;
  org.apache.openjpa.persistence.PersistenceProviderImpl
 &lt;/provider&gt;
 &lt;class&gt;
  sample.jpa.currency.Currency
 &lt;/class&gt;

 &lt;properties&gt;
  &lt;property name="openjpa.ConnectionURL" 
   value="jdbc:derby:CurrencyDB" /&gt;
  &lt;property name="openjpa.ConnectionDriverName" 
   value="org.apache.derby.jdbc.EmbeddedDriver" /&gt;
  &lt;property name="ConnectionUserName" value="app" /&gt;
  &lt;property name="openjpa.jdbc.SynchronizeMappings" value="false" /&gt;
 &lt;/properties&gt;
 &lt;/persistence-unit&gt;
&lt;/persistence&gt;
</pre>
</div></div>

<p>12. Since we are going to use EJB annotations, the <code>META-INF/ejb-jar.xml</code> will not have any declarations. The contents of the <code>META-INF/openejb-jar.xml</code> file should be as below. Otherwise, modify it accordingly.</p>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>openejb-jar.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;openejb-jar xmlns="http://openejb.apache.org/xml/ns/openejb-jar-2.2" 
 xmlns:naming="http://geronimo.apache.org/xml/ns/naming-1.2" 
 xmlns:sec="http://geronimo.apache.org/xml/ns/security-2.0" 
 xmlns:sys="http://geronimo.apache.org/xml/ns/deployment-1.2"&gt;
  &lt;sys:environment&gt;
    &lt;sys:moduleId&gt;
      &lt;sys:groupId&gt;Currency&lt;/sys:groupId&gt;
      &lt;sys:artifactId&gt;JPA-EJB&lt;/sys:artifactId&gt;
      &lt;sys:version&gt;1.0&lt;/sys:version&gt;
      &lt;sys:type&gt;car&lt;/sys:type&gt;
    &lt;/sys:moduleId&gt;
  &lt;/sys:environment&gt;
  &lt;enterprise-beans/&gt;
  &lt;/openejb-jar&gt;
</pre>
</div></div>

<p>13. Finally the project <em>CurrencyEJB</em> should like as below.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/8.jpg"></span></p>

<h2 id="DevelopingpersistenceforJSFapplicationswithJPA-CreatingwebapplicationwithJSFconfiguration">Creating web application with JSF configuration</h2>

<p>1. Right click on the <em>Project Explorer</em> and select <em>New =&gt; Project</em>. This will open <em>New Project</em> wizard as below. Select <em>Dynamic Web Project</em> under option <em>Web</em>. Click on the <em>Next</em> button.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/9.jpg"></span></p>

<p>2. Provide the values as given in the below screen shot on the <em>New Dynamic Web Project</em> wizard. Please note that <em>Add project to an EAR</em> checkbox is check to add this web project to <em>CurrencyEAR</em> created earlier.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/10.jpg"></span></p>


<p>3. In the next screen, select the <em>Version</em> values as given in the below screen shot and click on the <em>Next</em> button. Please note that the <em>Java Server Faces</em> check box is checked and the version values should be 1.2.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/11.jpg"></span></p>


<p>4. Check on the <em>Generate Deployment Descriptor</em> checkbox and click on the <em>Next</em> button. On the next screen, configure the deployment plan as follows. After this click on the <em>Next</em> button.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/12.jpg"></span></p>


<p>5. On the <em>JSF Capabilities</em> window, select the second radio button and click on the <em>new</em> button.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/13.jpg"></span></p>


<p>6. The next wizard <em>Create JSF Implementation Library</em> suggests to create JSF Implementation library. Give the library name as <em>JSFCustomLibrary</em> and add the following jars. Click on the <em>Finish</em> button once done. See the screen shot below.</p>

<ul><li>&lt;geronimo_home&gt;\repository\commons-beanutils\commons-beanutils\1.6.1\commons-beanutils-1.6.1.jar</li><li>&lt;geronimo_home&gt;\repository\commons-collections\commons-collections\3.1\commons-collections-3.1.jar</li><li>&lt;geronimo_home&gt;\repository\commons-digester\commons-digester\1.8\commons-digester-1.8.jar</li><li>&lt;geronimo_home&gt;\repository\commons-logging\commons-logging\1.0.4\commons-logging-1.0.4.jar</li><li>&lt;geronimo_home&gt;\repository\org\apache\myfaces\core\myfaces-api\1.2.2\myfaces-api-1.2.2.jar</li><li>&lt;geronimo_home&gt;\repository\org\apache\myfaces\core\myfaces-impl\1.2.2\myfaces-impl-1.2.2.jar</li></ul>


<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/14.jpg"></span></p>


<p>7. On the <em>JSF Capabilities</em> window change the value of <em>URL Mapping Patterns</em> to <em>*.jsf</em> and click on the <em>Finish</em> button.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/15.jpg"></span></p>

<p> Right click on the <em>WEB-INF</em> folder and create a <em>tld</em> folder and copy the following files into it.</p>

<ul><li>&lt;geronimo_home&gt;\repository\org\apache\myfaces\core\myfaces-impl\1.2.2\myfaces-impl-1.2.2.jar\META-INF\<br clear="none">
   myfaces-html.tld </li><li>&lt;geronimo_home&gt;\repository\org\apache\myfaces\core\myfaces-impl\1.2.2\myfaces-impl-1.2.2.jar\META-INF\<br clear="none">
   myfaces_core.tld</li></ul>



<p>8. The above steps create a new web project with JSF capabilities. Now we can create the required JSPs, JSF managed beans and configure the navigation rules in the <code>WEB_INF/faces-config.xml</code>. Right click on the _CurrencyWEB  =&gt; WebContent_and create the following JSPs as given in the below screen shot. The contents of the JSPs are also provided below.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/16.jpg"></span></p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>index.jsp</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html&gt;
  &lt;body&gt;
    &lt;jsp:forward page="/listCurrencies.jsf" /&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
</div></div> 
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>listCurrencies.jsp</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;%@ page language="java" %&gt;

&lt;%@ taglib uri="/WEB-INF/tld/myfaces-html.tld" prefix="h" %&gt;
&lt;%@ taglib uri="/WEB-INF/tld/myfaces_core.tld" prefix="f" %&gt;  

&lt;%
String path = request.getContextPath();
String basePath = request.getScheme()+
 "://"+request.getServerName()+
 ":"+request.getServerPort()+path+"/";
%&gt;

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html&gt;
&lt;head&gt;
 &lt;base href="&lt;%=basePath%&gt;"&gt;
  &lt;title&gt;List of currencies&lt;/title&gt;
&lt;/head&gt;
  
&lt;body&gt;
 &lt;f:view&gt;
  &lt;h:form id="currencyList"&gt;
  &lt;h:dataTable id="currencies" 
   value="#{CurrencyListJSFBean.currencies}" 
   var="currency" 
   border="1"&gt;   
   &lt;h:column&gt;
    &lt;f:facet name="header"&gt;
     &lt;h:outputText  value="Currency Name"/&gt;
    &lt;/f:facet&gt;
    &lt;h:outputText value="#{currency.currencyName}" /&gt;
   &lt;/h:column&gt;
   &lt;h:column&gt;
    &lt;f:facet name="header"&gt;
     &lt;h:outputText  value="Country Name"/&gt;
    &lt;/f:facet&gt;
    &lt;h:outputText value="#{currency.countryName}" /&gt;
   &lt;/h:column&gt;
   &lt;h:column&gt;
    &lt;f:facet name="header"&gt;
     &lt;h:outputText  value="Rate Against USD"/&gt;
    &lt;/f:facet&gt;
    &lt;h:outputText value="#{currency.rateAgstUSD}" /&gt;
   &lt;/h:column&gt;
   &lt;h:column&gt;
    &lt;f:facet name="header"&gt;
     &lt;h:outputText  value="Edit"/&gt;
    &lt;/f:facet&gt;
    &lt;h:commandLink id="Edit" 
     action="editCurrency" 
     actionListener="#{CurrencyJSFBean.selectCurrency}"&gt;
      &lt;h:outputText value="Edit" /&gt;
      &lt;f:param id="editCurrency" 
       name="currencyName" 
       value="#{currency.currencyName}" /&gt;
    &lt;/h:commandLink&gt;
   &lt;/h:column&gt;
   &lt;h:column&gt;
    &lt;f:facet name="header"&gt;
     &lt;h:outputText  value="Delete"/&gt;
    &lt;/f:facet&gt;
    &lt;h:commandLink id="Delete" 
     action="deleteCurrency" 
     actionListener="#{CurrencyListJSFBean.deleteCurrency}"&gt;
     &lt;h:outputText value="Delete" /&gt;
     &lt;f:param id="deleteCurrency" 
      name="currencyName" 
      value="#{currency.currencyName}" /&gt;
    &lt;/h:commandLink&gt;
   &lt;/h:column&gt;
  &lt;/h:dataTable&gt; 
  &lt;h:commandLink id="Add" 
   action="insertCurrency" 
   actionListener="#{CurrencyJSFBean.initCurrency}"&gt;
   &lt;h:outputText value="Add a Currency" /&gt;
   &lt;/h:commandLink&gt;
  &lt;/h:form&gt;
  &lt;/f:view&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
</div></div> 
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>insertCurrencyjsp</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;%@ page language="java" %&gt;
&lt;%@ taglib uri="/WEB-INF/tld/myfaces-html.tld" prefix="h" %&gt;
&lt;%@ taglib uri="/WEB-INF/tld/myfaces_core.tld" prefix="f" %&gt; 
&lt;%
String path = request.getContextPath();
String basePath = request.getScheme()+
 "://"+request.getServerName()+
 ":"+request.getServerPort()+path+"/";
%&gt;

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html&gt;
&lt;head&gt;
 &lt;base href="&lt;%=basePath%&gt;"&gt;
 &lt;title&gt;Add Currency&lt;/title&gt;
&lt;/head&gt;
  
&lt;body&gt;
 &lt;f:view&gt;
  &lt;h:form&gt;
   &lt;h:inputHidden id="id" value="#{CurrencyJSFBean.currencyName}"/&gt;
    &lt;h:panelGrid columns="2" border="1"&gt;
     &lt;h:outputText value="Currency Name :" /&gt;
     &lt;h:inputText id="currencyName" 
      value="#{CurrencyJSFBean.currencyName}"&gt;
     &lt;/h:inputText&gt;
     &lt;h:outputText value="Country Name :" /&gt;
     &lt;h:inputText id="countryName" 
      value="#{CurrencyJSFBean.countryName}"&gt;
     &lt;/h:inputText&gt;
     &lt;h:outputText value="Rate Against USD :" /&gt;
     &lt;h:inputText id="rateAgstUSD" 
      value="#{CurrencyJSFBean.rateAgstUSD}"&gt;
     &lt;/h:inputText&gt;
    &lt;/h:panelGrid&gt;
		
  &lt;h:messages id="errors" 
   style="color:red;font-weight:bold" 
   layout="table" /&gt;
   &lt;h:commandButton value="Save" 
    action="listCurrencies" 
    actionListener="#{CurrencyJSFBean.insertCurrency}" /&gt;

  &lt;/h:form&gt;
 &lt;/f:view&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
</div></div> 
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>editCurrency.jsp</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">

&lt;%@ page language="java" %&gt;
&lt;%@ taglib uri="/WEB-INF/tld/myfaces-html.tld" prefix="h" %&gt;
&lt;%@ taglib uri="/WEB-INF/tld/myfaces_core.tld" prefix="f" %&gt; 
&lt;%
String path = request.getContextPath();
String basePath = request.getScheme()+
 "://"+request.getServerName()+
 ":"+request.getServerPort()+path+"/";
%&gt;

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html&gt;
&lt;head&gt;
 &lt;base href="&lt;%=basePath%&gt;"&gt;
 &lt;title&gt;Edit Currency&lt;/title&gt;
&lt;/head&gt;
  
&lt;body&gt;
 &lt;f:view&gt;
  &lt;h:form&gt;
   &lt;h:inputHidden id="id" value="#{CurrencyJSFBean.currencyName}"/&gt;
   &lt;h:panelGrid columns="2" border="1"&gt;
    &lt;h:outputText value="Currency Name :" /&gt;
    &lt;h:outputText value="#{CurrencyJSFBean.currencyName}" /&gt;
    &lt;h:outputText value="Country Name :" /&gt;
    &lt;h:outputText value="#{CurrencyJSFBean.countryName}" /&gt;
    &lt;h:outputText value="Rate Against USD :" /&gt;
    &lt;h:inputText id="rateAgstUSD" 
     value="#{CurrencyJSFBean.rateAgstUSD}"&gt;
    &lt;/h:inputText&gt;
   &lt;/h:panelGrid&gt;
		
   &lt;h:messages id="errors" 
    style="color:red;font-weight:bold" 
    layout="table" /&gt;
   
   &lt;h:commandButton value="Save" 
    action="listCurrencies" 
    actionListener="#{CurrencyJSFBean.saveCurrency}" /&gt;

   &lt;/h:form&gt;
  &lt;/f:view&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
</div></div> 


<p>9. Create two JSF managed beans <code>CurrencyJSFBean.java</code> and <code>CurrencyListJSFBean.java</code> as follows. Right click on the <em>CurrencyWEB</em> and select  <em>CurrencyWEB =&gt; New =&gt; Class</em>. See the below screen shot.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/17.jpg"></span></p>

<p>In the <em>New Java Class</em> wizard, provide the values as given in the screen shot and click on the <em>Finish</em> button.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/18.jpg"></span></p>

<p>Copy the below contents into <code>CurrencyListJSFBean.java</code></p>
<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>CurrencyListJSFBean.java</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package sample.jsf;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import javax.ejb.EJB;
import javax.faces.component.UIParameter;
import javax.faces.event.ActionEvent;
import javax.naming.Context;
import javax.naming.InitialContext;
import javax.naming.LinkRef;

import sample.jpa.currency.Currency;
import sample.jpa.currency.CurrencyInterface;



public class CurrencyListJSFBean {
 private CurrencyInterface ci;
 private Collection currencies;

 public CurrencyListJSFBean() throws Exception{
  Context ctx  = new InitialContext();
  System.out.println("Instantiating bean...");
  Object obj = ctx.lookup("java:comp/env/ejb/CurrencyInterface");
  System.out.println((obj instanceof LinkRef));
  ci = (CurrencyInterface)obj;
  System.out.println("Got the  bean...");
  init();
 }

 public Collection getCurrencies() {
  return currencies;
 }

 public void setCurrencies(Collection currencies) {
  this.currencies = currencies;
 }
	
 public void loadCurrencies()throws Exception{
  init();
 }
	
 private void init()throws Exception{
  List list  = ci.listCurrencies();
  Iterator it  = list.iterator();
  this.currencies = new ArrayList();
  while (it.hasNext()){
   Currency currency = (Currency)it.next();
   CurrencyJSFBean cjb = new CurrencyJSFBean();
   cjb.setCountryName(currency.getCountryName());
   cjb.setCurrencyName(currency.getCurrencyName());
   cjb.setRateAgstUSD(currency.getRateAgstUSD());

   System.out.println(currency.getCountryName()+ 
    " : " +currency.getCurrencyName()+ " : "+ 
    currency.getRateAgstUSD());;
			
   currencies.add(cjb);
  }
 }
	
 public void deleteCurrency (ActionEvent event){
  UIParameter component = (UIParameter) event.getComponent().findComponent("deleteCurrency");
  String curencyNameDel = (String) component.getValue();
  System.out.println("Currency Name to be deleted = "+curencyNameDel);
  ci.deleteCurrency(curencyNameDel);
		
  Iterator it = this.getCurrencies().iterator();
  while (it.hasNext()){
   CurrencyJSFBean cjb = (CurrencyJSFBean)it.next();
   if(cjb.getCurrencyName().equals(curencyNameDel)){
    it.remove();
   }
  }
 }
}
</pre>
</div></div>

<p>Similarly, create <code>CurrencyJSFBean.java</code> in the same package and copy the following contents into it.</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>CurrencyJSFBean.java</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package sample.jsf;

import java.util.Iterator;
import java.util.Map;

import javax.faces.component.UIParameter;
import javax.faces.context.FacesContext;
import javax.faces.event.ActionEvent;
import javax.naming.Context;
import javax.naming.InitialContext;
import javax.naming.LinkRef;

import sample.jpa.currency.Currency;
import sample.jpa.currency.CurrencyInterface;


public class CurrencyJSFBean {

 private CurrencyInterface ci;

 private String currencyName;
 private String countryName;
 private double rateAgstUSD;

 public CurrencyJSFBean()throws Exception{
  Context ctx  = new InitialContext();
  System.out.println("Instantiating bean...");
  Object obj = ctx.lookup("java:comp/env/ejb/CurrencyInterface");
  System.out.println((obj instanceof LinkRef));
  ci = (CurrencyInterface)obj;
  System.out.println("Got the  bean...");
 }


 public String getCurrencyName() {
  return currencyName;
 }

 public void setCurrencyName(String currencyName) {
  System.out.println("Set currencyName="+currencyName);
  this.currencyName = currencyName;
 }

 public String getCountryName() {
 return countryName;
 }

 public void setCountryName(String countryName) {
  System.out.println("Set countryName="+countryName);
  this.countryName = countryName;
 }

 public double getRateAgstUSD() {
  return rateAgstUSD;
 }

 public void setRateAgstUSD(double rateAgstUSD) {
  System.out.println("Set rateAgstUSD="+rateAgstUSD);
  this.rateAgstUSD = rateAgstUSD;
 }

 public void selectCurrency(ActionEvent event){

  UIParameter component = (UIParameter) 
              event.getComponent().findComponent("editCurrency");
  String curencyName = (String) component.getValue();

  Currency c = ci.retrieveCurrency(curencyName);

  this.setCountryName(c.getCountryName());
  this.setCurrencyName(c.getCurrencyName());
  this.setRateAgstUSD(c.getRateAgstUSD());
 }

 public void saveCurrency(ActionEvent event){
  ci.updateCurrency(this.getCurrencyName(), this.getRateAgstUSD());

 }

 public void initCurrency(ActionEvent event){
  this.setCountryName("");
  this.setCurrencyName("");
  this.setRateAgstUSD(0.0);
 }

 public void insertCurrency(ActionEvent event){
  ci.createCurrency(this.currencyName, countryName, rateAgstUSD);
 }

}
</pre>
</div></div>

<p>10. Open the <code>WEB-INF/faces-config.xml</code> and copy the below contents to it.</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>The <code>faces-config.xml</code> can also be configured using JSF wizards. In this case, we have copied the already prepared JSF configuration in to the <code>faces-config.xml</code> file. </p></div></div>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>faces-config.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;faces-config
 xmlns="http://java.sun.com/xml/ns/javaee"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://java.sun.com/xml/ns/javaee  
 http://java.sun.com/xml/ns/javaee/web-facesconfig_1_2.xsd"
 version="1.2"&gt;

 &lt;navigation-rule&gt;
  &lt;description&gt;List Currencies&lt;/description&gt;
  &lt;from-view-id&gt;/listCurrencies.jsp&lt;/from-view-id&gt;
  &lt;navigation-case&gt;
   &lt;from-outcome&gt;editCurrency&lt;/from-outcome&gt;
   &lt;to-view-id&gt;/editCurrency.jsp&lt;/to-view-id&gt;
  &lt;/navigation-case&gt;
 &lt;/navigation-rule&gt;

 &lt;navigation-rule&gt;
  &lt;description&gt;Edit Currency&lt;/description&gt;
  &lt;from-view-id&gt;/editCurrency.jsp&lt;/from-view-id&gt;
  &lt;navigation-case&gt;
   &lt;from-outcome&gt;listCurrencies&lt;/from-outcome&gt;
   &lt;to-view-id&gt;/listCurrencies.jsp&lt;/to-view-id&gt;
  &lt;/navigation-case&gt;
 &lt;/navigation-rule&gt;

 &lt;navigation-rule&gt;
  &lt;description&gt;List Currencies&lt;/description&gt;
  &lt;from-view-id&gt;/listCurrencies.jsp&lt;/from-view-id&gt;
  &lt;navigation-case&gt;
   &lt;from-outcome&gt;insertCurrency&lt;/from-outcome&gt;
   &lt;to-view-id&gt;/insertCurrency.jsp&lt;/to-view-id&gt;
  &lt;/navigation-case&gt;
 &lt;/navigation-rule&gt;

 &lt;navigation-rule&gt;
  &lt;description&gt;Insert Currencies&lt;/description&gt;
  &lt;from-view-id&gt;/insertCurrency.jsp&lt;/from-view-id&gt;
  &lt;navigation-case&gt;
   &lt;from-outcome&gt;listCurrencies&lt;/from-outcome&gt;
   &lt;to-view-id&gt;/listCurrencies.jsp&lt;/to-view-id&gt;
  &lt;/navigation-case&gt;
 &lt;/navigation-rule&gt;

 &lt;navigation-rule&gt;
  &lt;description&gt;List Currencies&lt;/description&gt;
  &lt;from-view-id&gt;/listCurrencies.jsp&lt;/from-view-id&gt;
  &lt;navigation-case&gt;
   &lt;from-outcome&gt;deleteCurrency&lt;/from-outcome&gt;
  &lt;to-view-id&gt;/listCurrencies.jsp&lt;/to-view-id&gt;
  &lt;/navigation-case&gt;
 &lt;/navigation-rule&gt;


 &lt;managed-bean&gt;
  &lt;description&gt;
   Currency List Bean
  &lt;/description&gt;
  &lt;managed-bean-name&gt;
   CurrencyListJSFBean
  &lt;/managed-bean-name&gt;
  &lt;managed-bean-class&gt;
   sample.jsf.CurrencyListJSFBean
  &lt;/managed-bean-class&gt;
  &lt;managed-bean-scope&gt;request&lt;/managed-bean-scope&gt; 
 &lt;/managed-bean&gt;

 &lt;managed-bean&gt;
  &lt;description&gt;
   Currency Bean
  &lt;/description&gt;
  &lt;managed-bean-name&gt;CurrencyJSFBean&lt;/managed-bean-name&gt;
  &lt;managed-bean-class&gt;
   sample.jsf.CurrencyJSFBean
  &lt;/managed-bean-class&gt;
  &lt;managed-bean-scope&gt;request&lt;/managed-bean-scope&gt; 
 &lt;/managed-bean&gt;

&lt;/faces-config&gt;

</pre>
</div></div>

<p>11. The <code>web.xml</code> and the <code>geronimo-web.xml</code> files are as follows. In the <code>web.xml</code> the ejb reference <code>ejb/CurrencyInterface</code> is mapped to the <code>CurrencyBean</code>.</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>web.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
 xmlns="http://java.sun.com/xml/ns/javaee" 
 xmlns:web="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
 xsi:schemaLocation="http://java.sun.com/xml/ns/javaee 
 http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" 
 id="WebApp_ID" version="2.5"&gt;

 &lt;display-name&gt;CurrencyWEB&lt;/display-name&gt;
 &lt;welcome-file-list&gt;
  &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
  &lt;welcome-file&gt;index.htm&lt;/welcome-file&gt;
  &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
  &lt;welcome-file&gt;default.html&lt;/welcome-file&gt;
  &lt;welcome-file&gt;default.htm&lt;/welcome-file&gt;
  &lt;welcome-file&gt;default.jsp&lt;/welcome-file&gt;
 &lt;/welcome-file-list&gt;

 &lt;servlet&gt;
  &lt;servlet-name&gt;Faces Servlet&lt;/servlet-name&gt;
  &lt;servlet-class&gt;
   javax.faces.webapp.FacesServlet
  &lt;/servlet-class&gt;
  &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
 &lt;/servlet&gt;

 &lt;ejb-local-ref&gt;
  &lt;ejb-ref-name&gt;ejb/CurrencyInterface&lt;/ejb-ref-name&gt;
  &lt;ejb-ref-type&gt;Session&lt;/ejb-ref-type&gt;
  &lt;local&gt;
   sample.jpa.currency.CurrencyInterface
  &lt;/local&gt;
  &lt;ejb-link&gt;CurrencyBean&lt;/ejb-link&gt;
 &lt;/ejb-local-ref&gt;

 &lt;servlet-mapping&gt;
  &lt;servlet-name&gt;Faces Servlet&lt;/servlet-name&gt;
  &lt;url-pattern&gt;*.jsf&lt;/url-pattern&gt;
 &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</pre>
</div></div>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>geronimo-web.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns="http://geronimo.apache.org/xml/ns/j2ee/web-2.0.1" 
 xmlns:naming="http://geronimo.apache.org/xml/ns/naming-1.2" 
 xmlns:sec="http://geronimo.apache.org/xml/ns/security-2.0" 
 xmlns:sys="http://geronimo.apache.org/xml/ns/deployment-1.2"&gt;
 
 &lt;sys:environment&gt;
  &lt;sys:moduleId&gt;
   &lt;sys:groupId&gt;Currency&lt;/sys:groupId&gt;
   &lt;sys:artifactId&gt;JPA-WEB&lt;/sys:artifactId&gt;
   &lt;sys:version&gt;1.0&lt;/sys:version&gt;
   &lt;sys:type&gt;car&lt;/sys:type&gt;
  &lt;/sys:moduleId&gt;
 &lt;/sys:environment&gt;

 &lt;context-root&gt;/CurrencyWEB&lt;/context-root&gt;
&lt;/web-app&gt;
</pre>
</div></div>


<p>11. Right click on the <em>CurrencyWEB</em> project and click on <em>Properties</em> to open <em>Properties for CurrencyWEB</em> wizard. Click on the <em>Java Build Path</em> and <em>Projects</em> tab. Click on the <em>Add</em> button and add <em>CurrencyEJB</em> project. Finally, click on the <em>OK</em> button on <em>Properties for CurrencyWEB</em> wizard. This is required because, <em>CurrencyWEB</em> projects looks up <code>CurrencyInterface</code> ejb in the <em>CurrencyEJB</em> project. To resolve the dependency during compilation, the EJB project has to be added to the build path of the WEB project.</p>

<p>12. Finally export the <em>CurrencyEAR</em> file. </p>

<h2 id="DevelopingpersistenceforJSFapplicationswithJPA-Deployingthe(ear)application">Deploying the (ear) application</h2>

<p>1. Start the geronimo server and open a command window. Deploy the EAR file as follows.</p>
<div class="preformatted panel" style="border-style: solid;border-width: 1px;"><div class="preformattedContent panelContent">
<pre>C:\Geronimo-2.1\bin&gt;deploy.bat --user system --password manager deploy c:\temp\CurrencyEAR.ear
Using GERONIMO_BASE:   C:\Geronimo-2.1
Using GERONIMO_HOME:   C:\Geronimo-2.1
Using GERONIMO_TMPDIR: var\temp
Using JRE_HOME:        C:\SDK-May-31-2007\jre
    Deployed default/CurrencyEAR/1.0/car
      `-&gt; CurrencyWEB.war @ /CurrencyWEB
      `-&gt; CurrencyEJB.jar </pre>
</div></div>

<h2 id="DevelopingpersistenceforJSFapplicationswithJPA-Settingupthedatabasetables">Setting up the database tables</h2>

<p>1. Open a browser window and hit the URL <a shape="rect" class="external-link" href="http://localhost:8080/console" rel="nofollow">http://localhost:8080/console</a> to open admin console. Click on <em>Console Navigation =&gt; DB Manager</em>. This will open up <em>DB Viewer</em> and <em>Run SQL</em> portlets on the right side. Enter <em>CurrencyDB</em> in the <em>Create DB</em> textbox and click on the <em>Create</em> button. This will create a database by name <em>CurrencyDB</em>.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/21.jpg"></span></p>

<p>2. On the <em>Run SQL</em> portlet, enter the below SQL command in the <em>SQL Command/s</em> textarea to create <code>CURRENCYRATETABLE</code> table. Select <em>CurrencyDB</em> in the <em>Use DB</em> combo box and click on the <em>Run SQL</em> button. Please see the screen shot below.  </p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
create table CURRENCYRATETABLE (CURRENCYNAME varchar(50), COUNTRYNAME varchar(100), RATEAGSTUSD decimal (15,2));
</pre>
</div></div>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/22.jpg"></span></p>

<p>Enter some sample rows in the table to list the currencies later while running the application.</p>

<h2 id="DevelopingpersistenceforJSFapplicationswithJPA-Runningtheapplication">Running the application</h2>
<p>1. Open a browser window and hit the URL as <a shape="rect" class="external-link" href="http://localhost:8080/CurrencyWEB/" rel="nofollow">http://localhost:8080/CurrencyWEB/</a></p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/19.jpg"></span></p>

<p>This page displays the list of currencies currently in the database. For each currency, the page displays <em>Currency Name</em>, <em>Country Name</em> and <em>Rate Against USD</em> values. It also provides link to <em>Edit</em> and <em>Delete</em> a particular currency. </p>

<p>2. Click on the <em>Add a Currency</em> link at the bottom of the table. It will open up the following screen. Enter the values and click on the <em>Save</em> button. This will take back to the list of currencies with the new entry in the list.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/20.jpg"></span></p>

<p>Similarly, the <em>Edit</em> and <em>Delete</em> operations can also be performed.</p>

</div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Developing persistence for JSF applications with JPA';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
