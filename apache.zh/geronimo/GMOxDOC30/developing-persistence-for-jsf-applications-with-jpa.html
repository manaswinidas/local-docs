<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=0">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="Developing persistence for JSF applications with JPA">
    <meta name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Developing persistence for JSF applications with JPA">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2010-05-11">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>

  <link href="asset?aid=6" rel="stylesheet" type="text/css">
  <link href="asset?aid=7" rel="stylesheet" type="text/css">
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shCore.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushJava.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushXml.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushPlain.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushBash.js' type='text/javascript'></script>
  
  <script type="text/javascript">
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
  </script>

    <title>Apache Geronimo v3.0文档：使用JPA开发JSF应用程序的持久性</title>
  </head>

  <body  onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">主页</a> > <a href="documentation.html">文档</a> > <a href="developing.html">开发</a> > <a href="tutorials.html">教程</a> > <a href="developing-jpa-applications.html">开发JPA应用程序</a> > <a href="developing-persistence-for-jsf-applications-with-jpa.html">使用JPA开发JSF应用程序的持久性</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo v3.0</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">使用JPA开发JSF应用程序的持久性</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645260"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645260">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645260"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645260">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645260"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645260">新增新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent">
<p>Java Persistence API是EJB3.0规范（JSR220）下的新编程模型，用于使用Java EE和Java SE管理持久性和对象/关系映射。借助JPA，开发人员可以轻松开发使用Java对象和映射对关系数据库执行操作的Java应用程序。这样，使用JPA开发的Java应用程序不仅可以跨不同平台移植，而且可以使用JPA提供的简单而强大的编程模型轻松开发应用程序。这极大地提高了应用程序在不断变化的数据库世界中的可维护性。JPA使应用程序与数据库连接和操作中涉及的所有复杂性和不可移植的样板代码隔离。</p>

<p>Apache geronimo使用<a shape="rect" class="external-link" href="http://openjpa.apache.org/">OpenJPA</a>向服务器中部署的Java EE应用程序提供Java Persistence API。即使JPA是EJB3.0规范的一部分，它也独立于JPA。因此，JPA可以以相同的统一方式用于JavaSE，Web和ejb应用程序。</p>

<p>下面的教程说明了使用JPA进行持久性开发JSF（JavaServerFaces）应用程序。该应用程序具有ejb应用程序和Web应用程序。ejb应用程序使用JPA来操纵数据库中的实体。该Web应用程序使用JSF查找触发实体上操作的ejb。使用的数据库是geronimo附带的嵌入式derby数据库。Web应用程序显示各个国家/地区的货币列表以及相应的USD转换率。Web界面允许用户添加新货币，编辑现有货币和删除货币等。</p>

<p>可以从此<a shape="rect" href="developing-persistence-for-jsf-applications-with-jpa.data/JPA-JSFApp.ear?version=1&modificationDate=1212445244000&api=v2" data-linked-resource-id="20873757" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="JPA-JSFApp.ear" data-nice-type="Java Archive" data-linked-resource-content-type="application/octet-stream" data-linked-resource-container-id="20645260" data-linked-resource-container-version="48">链接</a>下载该应用程序。</p>

<p>为了开发，部署和运行该应用程序，需要以下环境。</p>

<ul><li>Sun JDK 5.0+（J2SE 1.5）</li><li>Eclipse 3.3.1.1（Europa发行版的Eclipse Classic软件包），特定于平台</li><li>Web工具平台（WTP）2.0.1</li><li>数据工具平台（DTP）1.5.1</li><li>Eclipse建模框架（EMF）2.3.1</li><li>图形编辑框架（GEF）3.3.1</li><li>Apache Geronimo 2.1</li></ul>


<p>本教程涵盖以下主题。</p>

<ul><li>设置Eclipse环境</li><li>使用实体创建ejb应用程序</li><li>使用JSF配置创建Web应用程序</li><li>部署（耳朵）应用程序</li><li>设置数据库表</li><li>运行应用程序</li></ul>


<h2 id="DevelopingpersistenceforJSFapplicationswithJPA-SettingtheEclipseenvironment">设置Eclipse环境</h2>

<p>1。下载geronimo v2.1并将其安装在系统中。查看geronimo文档以了解<br clear="none">安装服务器的说明。</p>

<p>2安装eclipse IDE，然后下载geronimo eclipse插件并将其安装在eclipse之上。看看<br clear="none">geronimo eclipse插件文档以获取指导。</p>

<p>3。在Eclipse中为geronimo v2.1创建运行时环境。查看geronimo eclipse插件<br clear="none">有关为geronimo安装运行时环境的说明的文档。</p>

<h2 id="DevelopingpersistenceforJSFapplicationswithJPA-Creatingejbapplicationwithentities">使用实体创建ejb应用程序</h2>

<p>1。打开Eclipse IDE，然后通过单击<em>Windows => Open Perspective => Other</em>将透视图更改为<em>Java EE</em> 。它将打开“ <em>打开透视图”</em>向导，如下图所示。从列表中选择<em>Java EE</em> ，然后单击“ <em>确定”</em>按钮。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/1.jpg"></span></p>

<p>2。右键单击<em>Package Explorer，</em>然后选择<em>EJB Project</em> 。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/2.jpg"></span></p>

<p>3。这将打开“ <em>新建EJB项目”</em>向导。提供“ <em>项目名称”</em> ，“ <em>目标运行时”</em>的值，如以下屏幕快照所示。</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>如果未设置目标运行时，请创建一个指向geronimo安装目录的新目标运行时。有关更多信息，请参阅geronimo文档，该文档说明了为geronimo设置eclipse插件和设置运行时环境。需要此设置来解决编译期间的类依赖关系。</p></div></div>
<p>单击<em>下一步</em>按钮。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/3.jpg"></span></p>

<p>4。选中以下屏幕截图中给出的复选框，然后单击<em>下一步</em>按钮。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/4.jpg"></span></p>

<p>5，选中以下屏幕截图中给出的复选框，然后单击<em>下一步</em>按钮。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/5.jpg"></span></p>

<p>6。如以下屏幕截图所示，在文本框中提供以下值，然后单击“ <em>完成”</em>按钮。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/6.jpg"></span></p>

<p>7。右键单击<em>CurrencyEJB</em>项目，然后导航到<em>New => Class</em>选项。在“ <em>新建Java类”</em>向导中提供以下值，然后单击“ <em>完成”</em>按钮。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/7.jpg"></span></p>

<p>8。将以下内容复制到<code>Currency.java</code> 。的<code>Currency.java</code>使用各种JPA注释将类标记为实体，并指定数据库表以保留属性值。</p>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>Currency.java</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package sample.jpa.currency;

import java.io.Serializable;
import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.Table;


@Entity
@Table(name="CurrencyRateTable")
public class Currency implements Serializable {
	
 @Id
  public String currencyName;
  public String countryName;
  public double rateAgstUSD;

  public Currency(){
  }

  public String getCurrencyName() {
   return currencyName;
  }

  public void setCurrencyName(String currencyName) {
   this.currencyName = currencyName;
  }

  public String getCountryName() {
   return countryName;
  }

  public void setCountryName(String countryName) {
   this.countryName = countryName;
  }

  public double getRateAgstUSD() {
   return rateAgstUSD;
  }

  public void setRateAgstUSD(double rateAgstUSD) {
   this.rateAgstUSD = rateAgstUSD;
  }
}
</pre>
</div></div>

<p>9。同样，创建界面<code>CurrencyInterface.java</code>并复制以下内容。这是<br clear="none">无状态会话Bean接口。</p>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>CurrencyInterface.java</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package sample.jpa.currency;
import java.util.List;
public interface CurrencyInterface {
 public Currency createCurrency(String currencyName, 
                                String countryName, 
                                double rateAgstUSD);
	
 public List listCurrencies();
	
 public Currency updateCurrency(String currencyName, 
                                double rateAgstUSD);
	
 public void deleteCurrency(String currencyName);
	
 public Currency retrieveCurrency(String currencyName);
	
}
</pre>
</div></div>

<p>10。同样，创建<code>CurrencyBean.java</code>并复制以下内容。此类是实现的bean类<code>CurrencyInterface.java</code>接口。</p>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>CurrencyBean.java</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package sample.jpa.currency;

import java.util.List;
import javax.ejb.Local;
import javax.ejb.Remote;
import javax.ejb.Stateless;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;

@Stateless
@Local
public class CurrencyBean implements CurrencyInterface{

 @PersistenceContext(unitName="CurrencyRateUnit")
 private EntityManager em;
	
 public Currency createCurrency(String currencyName, 
                                String countryName, 
			        double rateAgstUSD){
		
  Currency crt1 = em.find(Currency.class, currencyName);

  if(crt1 != null) 
   throw new IllegalArgumentException
   ("Currency already exists: Currency Name ("+currencyName+")");

  Currency crt = new Currency();
		
  crt.setCountryName(countryName);
  crt.setCurrencyName(currencyName);
  crt.setRateAgstUSD(rateAgstUSD);
		

  System.out.println("Persisting Currency Rate entity: 
   (Currency = "+currencyName+")");

  em.persist(crt);

  System.out.println("Persisted successfully Currency entity: 
   (Currency = "+currencyName+")");
  return crt;
	
 }
	
 public List listCurrencies(){
  if(em == null) System.out.println("em is null!!!");

  Query q = em.createQuery("SELECT crt FROM Currency crt");

  List currList = q.getResultList();

  return currList;
 }
	
 public Currency updateCurrency(String currencyName, 
                                double rateAgstUSD){
  if(em == null) System.out.println("em is null!!!");
		
  Currency crt1 = em.find(Currency.class, currencyName);

  if(crt1 == null) throw new IllegalArgumentException
   ("Currency not found: Currency Name ("+currencyName+")");

  crt1.setRateAgstUSD(rateAgstUSD);

  return crt1;
		 
 }
	
 public void deleteCurrency(String currencyName){
  if(em == null) System.out.println("em is null!!!");

  Currency crt1 = em.find(Currency.class, currencyName);

  if(crt1 == null) throw new 
   IllegalArgumentException
   ("Currency not found: Currency Name ("+currencyName+")");

  em.remove(crt1);
 }

 public Currency retrieveCurrency(String currencyName){
  Currency crt1 = em.find(Currency.class, currencyName);
  return crt1;
 }
	
}
</pre>
</div></div>

<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>@PersistenceContext（unitName =“ CurrencyRateUnit”）批注用于按容器注入EntityManager对象。在这种情况下，注入的EntityManager对象是容器管理的EntityManager对象。交易类型为<code>JTA</code>持久性范围是<code>Transaction</code> 。<br clear="none">由于我们尚未在中声明任何交易属性<code>CurrencyBean</code> ，默认值为容器托管交易，交易属性为<code>REQUIRED</code>对于bean方法。因此，每当在bean上调用方法时，EntityManager对象都将加入EJB事务。</p></div></div>

<p>11。如上所述，右键单击<code>META-INF</code> <em>CurrencyEJB</em>项目的目录并创建<code>persistence.xml</code> 。将以下内容复制到<code>persistence.xml</code> 。</p>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>persistence.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence xmlns="http://java.sun.com/xml/ns/persistence"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.0"
 xsi:schemaLocation="http://java.sun.com/xml/ns/persistence 
 http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"&gt;

 &lt;persistence-unit name="CurrencyRateUnit"&gt;
 &lt;description&gt;JPA JSF Sample&lt;/description&gt;
 &lt;provider&gt;
  org.apache.openjpa.persistence.PersistenceProviderImpl
 &lt;/provider&gt;
 &lt;class&gt;
  sample.jpa.currency.Currency
 &lt;/class&gt;

 &lt;properties&gt;
  &lt;property name="openjpa.ConnectionURL" 
   value="jdbc:derby:CurrencyDB" /&gt;
  &lt;property name="openjpa.ConnectionDriverName" 
   value="org.apache.derby.jdbc.EmbeddedDriver" /&gt;
  &lt;property name="ConnectionUserName" value="app" /&gt;
  &lt;property name="openjpa.jdbc.SynchronizeMappings" value="false" /&gt;
 &lt;/properties&gt;
 &lt;/persistence-unit&gt;
&lt;/persistence&gt;
</pre>
</div></div>

<p>12由于我们将使用EJB注释，因此<code>META-INF/ejb-jar.xml</code>将没有任何声明。的内容<code>META-INF/openejb-jar.xml</code>文件应如下所示。否则，请进行相应的修改。</p>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>openejb-jar.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;openejb-jar xmlns="http://openejb.apache.org/xml/ns/openejb-jar-2.2" 
 xmlns:naming="http://geronimo.apache.org/xml/ns/naming-1.2" 
 xmlns:sec="http://geronimo.apache.org/xml/ns/security-2.0" 
 xmlns:sys="http://geronimo.apache.org/xml/ns/deployment-1.2"&gt;
  &lt;sys:environment&gt;
    &lt;sys:moduleId&gt;
      &lt;sys:groupId&gt;Currency&lt;/sys:groupId&gt;
      &lt;sys:artifactId&gt;JPA-EJB&lt;/sys:artifactId&gt;
      &lt;sys:version&gt;1.0&lt;/sys:version&gt;
      &lt;sys:type&gt;car&lt;/sys:type&gt;
    &lt;/sys:moduleId&gt;
  &lt;/sys:environment&gt;
  &lt;enterprise-beans/&gt;
  &lt;/openejb-jar&gt;
</pre>
</div></div>

<p>13最后，项目<em>CurrencyEJB</em>应该如下所示。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/8.jpg"></span></p>

<h2 id="DevelopingpersistenceforJSFapplicationswithJPA-CreatingwebapplicationwithJSFconfiguration">使用JSF配置创建Web应用程序</h2>

<p>1。右键单击<em>Project Explorer，</em>然后选择<em>New => Project</em> 。这将打开“ <em>新建项目”</em>向导，如下所示。选择选项<em>Web</em>下的<em>Dynamic Web Project</em> 。单击<em>下一步</em>按钮。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/9.jpg"></span></p>

<p>2。提供以下“ <em>新建动态Web项目”</em>向导中的屏幕快照中给出的值。请注意， <em>将项目添加到EAR</em>复选框已选中，以将此Web项目添加到之前创建的<em>CurrencyEAR</em> 。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/10.jpg"></span></p>


<p>3。在下一个屏幕中，选择以下屏幕截图中给出的<em>Version</em>值，然后单击<em>Next</em>按钮。请注意，“ <em>Java Server Faces”</em>复选框已选中，版本值应为1.2。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/11.jpg"></span></p>


<p>4。选中<em>Generate Deployment Descriptor</em>复选框，然后单击<em>Next</em>按钮。在下一个屏幕上，如下配置部署计划。之后，单击<em>下一步</em>按钮。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/12.jpg"></span></p>


<p>5，在“ <em>JSF功能”</em>窗口上，选择第二个单选按钮，然后单击<em>新</em>按钮。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/13.jpg"></span></p>


<p>6。下一个向导“ <em>创建JSF实现库”</em>建议创建JSF实现库。将库名称命名为<em>JSFCustomLibrary</em>并添加以下jar。<em>完成后，</em>单击“ <em>完成”</em>按钮。请参见下面的屏幕截图。</p>

<ul><li><geronimo_home>\ repository \ commons-beanutils \ commons-beanutils \ 1.6.1 \ commons-beanutils-1.6.1.jar</geronimo_home></li><li><geronimo_home>\ repository \ commons-collections \ commons-collections \ 3.1 \ commons-collections-3.1.jar</geronimo_home></li><li><geronimo_home>\ repository \ commons-digester \ commons-digester \ 1.8 \ commons-digester-1.8.jar</geronimo_home></li><li><geronimo_home>\ repository \ commons-logging \ commons-logging \ 1.0.4 \ commons-logging-1.0.4.jar</geronimo_home></li><li><geronimo_home>\ repository \ org \ apache \ myfaces \ core \ myfaces-api \ 1.2.2 \ myfaces-api-1.2.2.jar</geronimo_home></li><li><geronimo_home>\ repository \ org \ apache \ myfaces \ core \ myfaces-impl \ 1.2.2 \ myfaces-impl-1.2.2.jar</geronimo_home></li></ul>


<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/14.jpg"></span></p>


<p>7。在“ <em>JSF功能”</em>窗口上，将“ <em>URL映射模式”</em>的值更改为<em>* .jsf</em> ，然后单击“ <em>完成”</em>按钮。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/15.jpg"></span></p>

<p>右键单击<em>WEB-INF</em>文件夹并创建一个<em>tld</em>文件夹，然后将以下文件复制到其中。</p>

<ul><li><geronimo_home>\ repository \ org \ apache \ myfaces \ core \ myfaces-impl \ 1.2.2 \ myfaces-impl-1.2.2.jar \ META-INF \<br clear="none">myfaces-html.tld</geronimo_home></li><li><geronimo_home>\ repository \ org \ apache \ myfaces \ core \ myfaces-impl \ 1.2.2 \ myfaces-impl-1.2.2.jar \ META-INF \<br clear="none">myfaces_core.tld</geronimo_home></li></ul>



<p>8。以上步骤创建了一个具有JSF功能的新Web项目。现在，我们可以创建所需的JSP，JSF托管Bean，并在<code>WEB_INF/faces-config.xml</code> 。右键单击_CurrencyWEB => WebContent_，然后创建以下屏幕截图中给出的以下JSP。以下还提供了JSP的内容。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/16.jpg"></span></p>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>index.jsp</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html&gt;
  &lt;body&gt;
    &lt;jsp:forward page="/listCurrencies.jsf" /&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
</div></div> 
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>listCurrencies.jsp</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;%@ page language="java" %&gt;

&lt;%@ taglib uri="/WEB-INF/tld/myfaces-html.tld" prefix="h" %&gt;
&lt;%@ taglib uri="/WEB-INF/tld/myfaces_core.tld" prefix="f" %&gt;  

&lt;%
String path = request.getContextPath();
String basePath = request.getScheme()+
 "://"+request.getServerName()+
 ":"+request.getServerPort()+path+"/";
%&gt;

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html&gt;
&lt;head&gt;
 &lt;base href="&lt;%=basePath%&gt;"&gt;
  &lt;title&gt;List of currencies&lt;/title&gt;
&lt;/head&gt;
  
&lt;body&gt;
 &lt;f:view&gt;
  &lt;h:form id="currencyList"&gt;
  &lt;h:dataTable id="currencies" 
   value="#{CurrencyListJSFBean.currencies}" 
   var="currency" 
   border="1"&gt;   
   &lt;h:column&gt;
    &lt;f:facet name="header"&gt;
     &lt;h:outputText  value="Currency Name"/&gt;
    &lt;/f:facet&gt;
    &lt;h:outputText value="#{currency.currencyName}" /&gt;
   &lt;/h:column&gt;
   &lt;h:column&gt;
    &lt;f:facet name="header"&gt;
     &lt;h:outputText  value="Country Name"/&gt;
    &lt;/f:facet&gt;
    &lt;h:outputText value="#{currency.countryName}" /&gt;
   &lt;/h:column&gt;
   &lt;h:column&gt;
    &lt;f:facet name="header"&gt;
     &lt;h:outputText  value="Rate Against USD"/&gt;
    &lt;/f:facet&gt;
    &lt;h:outputText value="#{currency.rateAgstUSD}" /&gt;
   &lt;/h:column&gt;
   &lt;h:column&gt;
    &lt;f:facet name="header"&gt;
     &lt;h:outputText  value="Edit"/&gt;
    &lt;/f:facet&gt;
    &lt;h:commandLink id="Edit" 
     action="editCurrency" 
     actionListener="#{CurrencyJSFBean.selectCurrency}"&gt;
      &lt;h:outputText value="Edit" /&gt;
      &lt;f:param id="editCurrency" 
       name="currencyName" 
       value="#{currency.currencyName}" /&gt;
    &lt;/h:commandLink&gt;
   &lt;/h:column&gt;
   &lt;h:column&gt;
    &lt;f:facet name="header"&gt;
     &lt;h:outputText  value="Delete"/&gt;
    &lt;/f:facet&gt;
    &lt;h:commandLink id="Delete" 
     action="deleteCurrency" 
     actionListener="#{CurrencyListJSFBean.deleteCurrency}"&gt;
     &lt;h:outputText value="Delete" /&gt;
     &lt;f:param id="deleteCurrency" 
      name="currencyName" 
      value="#{currency.currencyName}" /&gt;
    &lt;/h:commandLink&gt;
   &lt;/h:column&gt;
  &lt;/h:dataTable&gt; 
  &lt;h:commandLink id="Add" 
   action="insertCurrency" 
   actionListener="#{CurrencyJSFBean.initCurrency}"&gt;
   &lt;h:outputText value="Add a Currency" /&gt;
   &lt;/h:commandLink&gt;
  &lt;/h:form&gt;
  &lt;/f:view&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
</div></div> 
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>insertCurrency.jsp</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;%@ page language="java" %&gt;
&lt;%@ taglib uri="/WEB-INF/tld/myfaces-html.tld" prefix="h" %&gt;
&lt;%@ taglib uri="/WEB-INF/tld/myfaces_core.tld" prefix="f" %&gt; 
&lt;%
String path = request.getContextPath();
String basePath = request.getScheme()+
 "://"+request.getServerName()+
 ":"+request.getServerPort()+path+"/";
%&gt;

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html&gt;
&lt;head&gt;
 &lt;base href="&lt;%=basePath%&gt;"&gt;
 &lt;title&gt;Add Currency&lt;/title&gt;
&lt;/head&gt;
  
&lt;body&gt;
 &lt;f:view&gt;
  &lt;h:form&gt;
   &lt;h:inputHidden id="id" value="#{CurrencyJSFBean.currencyName}"/&gt;
    &lt;h:panelGrid columns="2" border="1"&gt;
     &lt;h:outputText value="Currency Name :" /&gt;
     &lt;h:inputText id="currencyName" 
      value="#{CurrencyJSFBean.currencyName}"&gt;
     &lt;/h:inputText&gt;
     &lt;h:outputText value="Country Name :" /&gt;
     &lt;h:inputText id="countryName" 
      value="#{CurrencyJSFBean.countryName}"&gt;
     &lt;/h:inputText&gt;
     &lt;h:outputText value="Rate Against USD :" /&gt;
     &lt;h:inputText id="rateAgstUSD" 
      value="#{CurrencyJSFBean.rateAgstUSD}"&gt;
     &lt;/h:inputText&gt;
    &lt;/h:panelGrid&gt;
		
  &lt;h:messages id="errors" 
   style="color:red;font-weight:bold" 
   layout="table" /&gt;
   &lt;h:commandButton value="Save" 
    action="listCurrencies" 
    actionListener="#{CurrencyJSFBean.insertCurrency}" /&gt;

  &lt;/h:form&gt;
 &lt;/f:view&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
</div></div> 
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>editCurrency.jsp</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">

&lt;%@ page language="java" %&gt;
&lt;%@ taglib uri="/WEB-INF/tld/myfaces-html.tld" prefix="h" %&gt;
&lt;%@ taglib uri="/WEB-INF/tld/myfaces_core.tld" prefix="f" %&gt; 
&lt;%
String path = request.getContextPath();
String basePath = request.getScheme()+
 "://"+request.getServerName()+
 ":"+request.getServerPort()+path+"/";
%&gt;

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;html&gt;
&lt;head&gt;
 &lt;base href="&lt;%=basePath%&gt;"&gt;
 &lt;title&gt;Edit Currency&lt;/title&gt;
&lt;/head&gt;
  
&lt;body&gt;
 &lt;f:view&gt;
  &lt;h:form&gt;
   &lt;h:inputHidden id="id" value="#{CurrencyJSFBean.currencyName}"/&gt;
   &lt;h:panelGrid columns="2" border="1"&gt;
    &lt;h:outputText value="Currency Name :" /&gt;
    &lt;h:outputText value="#{CurrencyJSFBean.currencyName}" /&gt;
    &lt;h:outputText value="Country Name :" /&gt;
    &lt;h:outputText value="#{CurrencyJSFBean.countryName}" /&gt;
    &lt;h:outputText value="Rate Against USD :" /&gt;
    &lt;h:inputText id="rateAgstUSD" 
     value="#{CurrencyJSFBean.rateAgstUSD}"&gt;
    &lt;/h:inputText&gt;
   &lt;/h:panelGrid&gt;
		
   &lt;h:messages id="errors" 
    style="color:red;font-weight:bold" 
    layout="table" /&gt;
   
   &lt;h:commandButton value="Save" 
    action="listCurrencies" 
    actionListener="#{CurrencyJSFBean.saveCurrency}" /&gt;

   &lt;/h:form&gt;
  &lt;/f:view&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
</div></div> 


<p>9。创建两个JSF托管bean <code>CurrencyJSFBean.java</code>和<code>CurrencyListJSFBean.java</code>如下。右键单击<em>CurrencyWEB</em>并选择<em>CurrencyWEB => New => Class</em> 。请参见下面的屏幕截图。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/17.jpg"></span></p>

<p>在“ <em>新建Java类”</em>向导中，提供如屏幕快照中给出的值，然后单击“ <em>完成”</em>按钮。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/18.jpg"></span></p>

<p>将以下内容复制到<code>CurrencyListJSFBean.java</code></p>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>CurrencyListJSFBean.java</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package sample.jsf;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import javax.ejb.EJB;
import javax.faces.component.UIParameter;
import javax.faces.event.ActionEvent;
import javax.naming.Context;
import javax.naming.InitialContext;
import javax.naming.LinkRef;

import sample.jpa.currency.Currency;
import sample.jpa.currency.CurrencyInterface;



public class CurrencyListJSFBean {
 private CurrencyInterface ci;
 private Collection currencies;

 public CurrencyListJSFBean() throws Exception{
  Context ctx  = new InitialContext();
  System.out.println("Instantiating bean...");
  Object obj = ctx.lookup("java:comp/env/ejb/CurrencyInterface");
  System.out.println((obj instanceof LinkRef));
  ci = (CurrencyInterface)obj;
  System.out.println("Got the  bean...");
  init();
 }

 public Collection getCurrencies() {
  return currencies;
 }

 public void setCurrencies(Collection currencies) {
  this.currencies = currencies;
 }
	
 public void loadCurrencies()throws Exception{
  init();
 }
	
 private void init()throws Exception{
  List list  = ci.listCurrencies();
  Iterator it  = list.iterator();
  this.currencies = new ArrayList();
  while (it.hasNext()){
   Currency currency = (Currency)it.next();
   CurrencyJSFBean cjb = new CurrencyJSFBean();
   cjb.setCountryName(currency.getCountryName());
   cjb.setCurrencyName(currency.getCurrencyName());
   cjb.setRateAgstUSD(currency.getRateAgstUSD());

   System.out.println(currency.getCountryName()+ 
    " : " +currency.getCurrencyName()+ " : "+ 
    currency.getRateAgstUSD());;
			
   currencies.add(cjb);
  }
 }
	
 public void deleteCurrency (ActionEvent event){
  UIParameter component = (UIParameter) event.getComponent().findComponent("deleteCurrency");
  String curencyNameDel = (String) component.getValue();
  System.out.println("Currency Name to be deleted = "+curencyNameDel);
  ci.deleteCurrency(curencyNameDel);
		
  Iterator it = this.getCurrencies().iterator();
  while (it.hasNext()){
   CurrencyJSFBean cjb = (CurrencyJSFBean)it.next();
   if(cjb.getCurrencyName().equals(curencyNameDel)){
    it.remove();
   }
  }
 }
}
</pre>
</div></div>

<p>同样，创建<code>CurrencyJSFBean.java</code>在同一包中，并将以下内容复制到其中。</p>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>CurrencyJSFBean.java</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
package sample.jsf;

import java.util.Iterator;
import java.util.Map;

import javax.faces.component.UIParameter;
import javax.faces.context.FacesContext;
import javax.faces.event.ActionEvent;
import javax.naming.Context;
import javax.naming.InitialContext;
import javax.naming.LinkRef;

import sample.jpa.currency.Currency;
import sample.jpa.currency.CurrencyInterface;


public class CurrencyJSFBean {

 private CurrencyInterface ci;

 private String currencyName;
 private String countryName;
 private double rateAgstUSD;

 public CurrencyJSFBean()throws Exception{
  Context ctx  = new InitialContext();
  System.out.println("Instantiating bean...");
  Object obj = ctx.lookup("java:comp/env/ejb/CurrencyInterface");
  System.out.println((obj instanceof LinkRef));
  ci = (CurrencyInterface)obj;
  System.out.println("Got the  bean...");
 }


 public String getCurrencyName() {
  return currencyName;
 }

 public void setCurrencyName(String currencyName) {
  System.out.println("Set currencyName="+currencyName);
  this.currencyName = currencyName;
 }

 public String getCountryName() {
 return countryName;
 }

 public void setCountryName(String countryName) {
  System.out.println("Set countryName="+countryName);
  this.countryName = countryName;
 }

 public double getRateAgstUSD() {
  return rateAgstUSD;
 }

 public void setRateAgstUSD(double rateAgstUSD) {
  System.out.println("Set rateAgstUSD="+rateAgstUSD);
  this.rateAgstUSD = rateAgstUSD;
 }

 public void selectCurrency(ActionEvent event){

  UIParameter component = (UIParameter) 
              event.getComponent().findComponent("editCurrency");
  String curencyName = (String) component.getValue();

  Currency c = ci.retrieveCurrency(curencyName);

  this.setCountryName(c.getCountryName());
  this.setCurrencyName(c.getCurrencyName());
  this.setRateAgstUSD(c.getRateAgstUSD());
 }

 public void saveCurrency(ActionEvent event){
  ci.updateCurrency(this.getCurrencyName(), this.getRateAgstUSD());

 }

 public void initCurrency(ActionEvent event){
  this.setCountryName("");
  this.setCurrencyName("");
  this.setRateAgstUSD(0.0);
 }

 public void insertCurrency(ActionEvent event){
  ci.createCurrency(this.currencyName, countryName, rateAgstUSD);
 }

}
</pre>
</div></div>

<p>10。打开<code>WEB-INF/faces-config.xml</code>并将以下内容复制到其中。</p>
<div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body">
<p>的<code>faces-config.xml</code>也可以使用JSF向导进行配置。在这种情况下，我们已经将已经准备好的JSF配置复制到了<code>faces-config.xml</code>文件。</p></div></div>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>faces-config.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;faces-config
 xmlns="http://java.sun.com/xml/ns/javaee"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://java.sun.com/xml/ns/javaee  
 http://java.sun.com/xml/ns/javaee/web-facesconfig_1_2.xsd"
 version="1.2"&gt;

 &lt;navigation-rule&gt;
  &lt;description&gt;List Currencies&lt;/description&gt;
  &lt;from-view-id&gt;/listCurrencies.jsp&lt;/from-view-id&gt;
  &lt;navigation-case&gt;
   &lt;from-outcome&gt;editCurrency&lt;/from-outcome&gt;
   &lt;to-view-id&gt;/editCurrency.jsp&lt;/to-view-id&gt;
  &lt;/navigation-case&gt;
 &lt;/navigation-rule&gt;

 &lt;navigation-rule&gt;
  &lt;description&gt;Edit Currency&lt;/description&gt;
  &lt;from-view-id&gt;/editCurrency.jsp&lt;/from-view-id&gt;
  &lt;navigation-case&gt;
   &lt;from-outcome&gt;listCurrencies&lt;/from-outcome&gt;
   &lt;to-view-id&gt;/listCurrencies.jsp&lt;/to-view-id&gt;
  &lt;/navigation-case&gt;
 &lt;/navigation-rule&gt;

 &lt;navigation-rule&gt;
  &lt;description&gt;List Currencies&lt;/description&gt;
  &lt;from-view-id&gt;/listCurrencies.jsp&lt;/from-view-id&gt;
  &lt;navigation-case&gt;
   &lt;from-outcome&gt;insertCurrency&lt;/from-outcome&gt;
   &lt;to-view-id&gt;/insertCurrency.jsp&lt;/to-view-id&gt;
  &lt;/navigation-case&gt;
 &lt;/navigation-rule&gt;

 &lt;navigation-rule&gt;
  &lt;description&gt;Insert Currencies&lt;/description&gt;
  &lt;from-view-id&gt;/insertCurrency.jsp&lt;/from-view-id&gt;
  &lt;navigation-case&gt;
   &lt;from-outcome&gt;listCurrencies&lt;/from-outcome&gt;
   &lt;to-view-id&gt;/listCurrencies.jsp&lt;/to-view-id&gt;
  &lt;/navigation-case&gt;
 &lt;/navigation-rule&gt;

 &lt;navigation-rule&gt;
  &lt;description&gt;List Currencies&lt;/description&gt;
  &lt;from-view-id&gt;/listCurrencies.jsp&lt;/from-view-id&gt;
  &lt;navigation-case&gt;
   &lt;from-outcome&gt;deleteCurrency&lt;/from-outcome&gt;
  &lt;to-view-id&gt;/listCurrencies.jsp&lt;/to-view-id&gt;
  &lt;/navigation-case&gt;
 &lt;/navigation-rule&gt;


 &lt;managed-bean&gt;
  &lt;description&gt;
   Currency List Bean
  &lt;/description&gt;
  &lt;managed-bean-name&gt;
   CurrencyListJSFBean
  &lt;/managed-bean-name&gt;
  &lt;managed-bean-class&gt;
   sample.jsf.CurrencyListJSFBean
  &lt;/managed-bean-class&gt;
  &lt;managed-bean-scope&gt;request&lt;/managed-bean-scope&gt; 
 &lt;/managed-bean&gt;

 &lt;managed-bean&gt;
  &lt;description&gt;
   Currency Bean
  &lt;/description&gt;
  &lt;managed-bean-name&gt;CurrencyJSFBean&lt;/managed-bean-name&gt;
  &lt;managed-bean-class&gt;
   sample.jsf.CurrencyJSFBean
  &lt;/managed-bean-class&gt;
  &lt;managed-bean-scope&gt;request&lt;/managed-bean-scope&gt; 
 &lt;/managed-bean&gt;

&lt;/faces-config&gt;

</pre>
</div></div>

<p>11。的<code>web.xml</code>和<code>geronimo-web.xml</code>文件如下。在里面<code>web.xml</code> ejb参考<code>ejb/CurrencyInterface</code>映射到<code>CurrencyBean</code> 。</p>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>web.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
 xmlns="http://java.sun.com/xml/ns/javaee" 
 xmlns:web="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
 xsi:schemaLocation="http://java.sun.com/xml/ns/javaee 
 http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" 
 id="WebApp_ID" version="2.5"&gt;

 &lt;display-name&gt;CurrencyWEB&lt;/display-name&gt;
 &lt;welcome-file-list&gt;
  &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
  &lt;welcome-file&gt;index.htm&lt;/welcome-file&gt;
  &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
  &lt;welcome-file&gt;default.html&lt;/welcome-file&gt;
  &lt;welcome-file&gt;default.htm&lt;/welcome-file&gt;
  &lt;welcome-file&gt;default.jsp&lt;/welcome-file&gt;
 &lt;/welcome-file-list&gt;

 &lt;servlet&gt;
  &lt;servlet-name&gt;Faces Servlet&lt;/servlet-name&gt;
  &lt;servlet-class&gt;
   javax.faces.webapp.FacesServlet
  &lt;/servlet-class&gt;
  &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
 &lt;/servlet&gt;

 &lt;ejb-local-ref&gt;
  &lt;ejb-ref-name&gt;ejb/CurrencyInterface&lt;/ejb-ref-name&gt;
  &lt;ejb-ref-type&gt;Session&lt;/ejb-ref-type&gt;
  &lt;local&gt;
   sample.jpa.currency.CurrencyInterface
  &lt;/local&gt;
  &lt;ejb-link&gt;CurrencyBean&lt;/ejb-link&gt;
 &lt;/ejb-local-ref&gt;

 &lt;servlet-mapping&gt;
  &lt;servlet-name&gt;Faces Servlet&lt;/servlet-name&gt;
  &lt;url-pattern&gt;*.jsf&lt;/url-pattern&gt;
 &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
</pre>
</div></div>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>geronimo-web.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns="http://geronimo.apache.org/xml/ns/j2ee/web-2.0.1" 
 xmlns:naming="http://geronimo.apache.org/xml/ns/naming-1.2" 
 xmlns:sec="http://geronimo.apache.org/xml/ns/security-2.0" 
 xmlns:sys="http://geronimo.apache.org/xml/ns/deployment-1.2"&gt;
 
 &lt;sys:environment&gt;
  &lt;sys:moduleId&gt;
   &lt;sys:groupId&gt;Currency&lt;/sys:groupId&gt;
   &lt;sys:artifactId&gt;JPA-WEB&lt;/sys:artifactId&gt;
   &lt;sys:version&gt;1.0&lt;/sys:version&gt;
   &lt;sys:type&gt;car&lt;/sys:type&gt;
  &lt;/sys:moduleId&gt;
 &lt;/sys:environment&gt;

 &lt;context-root&gt;/CurrencyWEB&lt;/context-root&gt;
&lt;/web-app&gt;
</pre>
</div></div>


<p>11。右键单击<em>CurrencyWEB</em>项目，然后单击“ <em>属性”</em>以打开<em>CurrencyWEB</em>向导的<em>属性</em> 。单击<em>Java构建路径</em>和<em>项目</em>选项卡。单击<em>添加</em>按钮，然后添加<em>CurrencyEJB</em>项目。最后，在<em>CurrencyWeb</em>向导的<em>属性</em>上单击“ <em>确定”</em>按钮。这是必需的，因为会查找<em>CurrencyWEB</em>项目<code>CurrencyInterface</code> <em>CurrencyEJB</em>项目中的ejb。为了解决编译期间的依赖性，必须将EJB项目添加到WEB项目的构建路径。</p>

<p>12最后导出<em>CurrencyEAR</em>文件。</p>

<h2 id="DevelopingpersistenceforJSFapplicationswithJPA-Deployingthe(ear)application">部署（耳朵）应用程序</h2>

<p>1。启动geronimo服务器并打开命令窗口。如下部署EAR文件。</p>
<div class="preformatted panel" style="border-style:solid;border-width:1px"><div class="preformattedContent panelContent">
<pre>C:\Geronimo-2.1\bin&gt;deploy.bat --user system --password manager deploy c:\temp\CurrencyEAR.ear
Using GERONIMO_BASE:   C:\Geronimo-2.1
Using GERONIMO_HOME:   C:\Geronimo-2.1
Using GERONIMO_TMPDIR: var\temp
Using JRE_HOME:        C:\SDK-May-31-2007\jre
    Deployed default/CurrencyEAR/1.0/car
      `-&gt; CurrencyWEB.war @ /CurrencyWEB
      `-&gt; CurrencyEJB.jar </pre>
</div></div>

<h2 id="DevelopingpersistenceforJSFapplicationswithJPA-Settingupthedatabasetables">设置数据库表</h2>

<p>1。打开浏览器窗口，然后单击URL <a shape="rect" class="external-link" href="http://localhost:8080/console" rel="nofollow">http：// localhost：8080 / console</a>以打开管理控制台。单击<em>控制台导航=> DB管理器</em> 。这将打开<em>DB Viewer</em>并在右侧<em>运行SQL</em> portlet。在“ <em>创建数据库”</em>文本框中输入<em>CurrencyDB</em> ，然后单击“ <em>创建”</em>按钮。这将创建一个名为<em>CurrencyDB</em>的数据库。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/21.jpg"></span></p>

<p>2。在“ <em>运行SQL”</em> Portlet上，在“ <em>SQL命令”</em>文本区域中输入以下SQL命令以创建<code>CURRENCYRATETABLE</code>表。在“ <em>使用数据库”</em>组合框中选择<em>CurrencyDB</em> ，然后单击“ <em>运行SQL”</em>按钮。请查看下面的屏幕截图。</p>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
create table CURRENCYRATETABLE (CURRENCYNAME varchar(50), COUNTRYNAME varchar(100), RATEAGSTUSD decimal (15,2));
</pre>
</div></div>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/22.jpg"></span></p>

<p>在表中输入一些示例行，以在以后运行应用程序时列出货币。</p>

<h2 id="DevelopingpersistenceforJSFapplicationswithJPA-Runningtheapplication">运行应用程序</h2>
<p>1。打开浏览器窗口，然后按<a shape="rect" class="external-link" href="http://localhost:8080/CurrencyWEB/" rel="nofollow">http：// localhost：8080 / CurrencyWEB /</a></p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/19.jpg"></span></p>

<p>此页面显示数据库中当前的货币列表。对于每种货币，页面都会显示“ <em>货币名称”</em> ，“ <em>国家名称”</em>和<em>“兑美元汇率”</em>值。它还提供了“ <em>编辑</em>和<em>删除</em>特定货币”的链接。</p>

<p>2。单击表格底部的“ <em>添加货币”</em>链接。它将打开以下屏幕。输入值，然后单击“ <em>保存”</em>按钮。这将返回到货币列表，并在列表中添加新条目。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-persistence-for-jsf-applications-with-jpa.data/20.jpg"></span></p>

<p>同样，也可以执行<em>编辑</em>和<em>删除</em>操作。</p>

</div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Developing persistence for JSF applications with JPA';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2013，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  

</body></html>