<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=2">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="inventory - Simple Database Access Application">
    <meta name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi inventory - Simple Database Access Application">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2010-05-11">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>

  <link href="asset?aid=3" rel="stylesheet" type="text/css">
  <link href="asset?aid=4" rel="stylesheet" type="text/css">
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shCore.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushJava.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushXml.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushPlain.js' type='text/javascript'></script>
  
  <script type="text/javascript">
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
  </script>

    <title>Apache Geronimo v3.0文档：清单-简单的数据库访问应用程序</title>
  </head>

  <body  onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">主页</a> > <a href="documentation.html">文档</a> > <a href="reference.html">参考</a> > <a href="samples.html">示例</a> > <a href="java-ee-sample-applications.html">Java EE示例应用程序</a> > <a href="inventory-simple-database-access-application.html">库存-简单数据库访问应用程序</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo v3.0</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">库存-简单的数据库访问应用程序</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645369"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645369">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645369"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645369">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645369"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645369">添加新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent">

<p>该示例说明了如何直接使用servlet的JDBC连接。有关出站连接支持的详细信息，请参阅<a shape="rect" href="connectors-and-transaction-management.html">连接器和事务管理</a> 。通常不建议直接使用JDBC，除非您有性能限制或需要动态的jdbc（例如在数据库浏览器中），而这使得JPA的使用不切实际。</p>

<p>本文分为以下部分。</p>
<style type="text/css">/*<![CDATA[*/
div.rbtoc1572612975829 {padding: 0px;}
div.rbtoc1572612975829 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1572612975829 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class="toc-macro rbtoc1572612975829">
<ul class="toc-indentation"><li><a shape="rect" href="#inventory-SimpleDatabaseAccessApplication-ApplicationOverview">应用概述</a>
<ul class="toc-indentation"><li><a shape="rect" href="#inventory-SimpleDatabaseAccessApplication-Applicationcontents">申请内容</a>
<ul class="toc-indentation"><li><a shape="rect" href="#inventory-SimpleDatabaseAccessApplication-SampleDatabase">样本数据库</a></li></ul>
</li></ul>
</li><li><a shape="rect" href="#inventory-SimpleDatabaseAccessApplication-TestingoftheSampleApplication">样本应用程序的测试</a></li></ul>
</div>
<h1 id="inventory-SimpleDatabaseAccessApplication-ApplicationOverview">应用概述</h1>

<p>本文中的清单应用程序仅支持此类应用程序的三个基本用例。</p>
<ol><li>将项目添加到库存</li><li>接收物品</li><li>发行项目<br clear="none">应用程序工作流程首先将项目信息添加到库存中。然后，它允许输入收货和发货信息。默认情况下，所有这些更新的信息都存储在示例数据库中（Derby）。</li></ol>


<p>库存Web应用程序具有以下页面列表</p>
<ul><li>欢迎</li><li>添加项目</li><li>收货</li><li>发行商品</li></ul>


<p>下图说明了应用程序流程。<br clear="none">
<span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="inventory-simple-database-access-application.data/inventory_flow.gif"></span></p>

<p>该应用程序的欢迎页面充当公告板，显示每个项目的当前库存。通过“欢迎”页面，用户可以访问“添加项目”，“接收商品”或“发货”页面。成功完成每个活动后，页面将被重定向回带有更新的库存信息的“欢迎”页面。“添加项目”有助于定义库存中的项目，然后将0个项目添加到库存中。收货和发货页面分别代表应用程序的收货和发货活动。</p>

<h2 id="inventory-SimpleDatabaseAccessApplication-Applicationcontents">申请内容</h2>
<p>库存应用程序由以下软件包和类列表组成。</p>
<ul><li>org.apache.geronimo.samples.inventory<ul><li>物料-代表库存中的物料。</li></ul>
	</li><li>org.apache.geronimo.samples.inventory.services<ul><li>InventoryManager-代表库存提供的服务列表。</li></ul>
	</li><li>org.apache.geronimo.samples.inventory.dao<ul><li>ItemDAO-包含所有数据库访问方法。</li></ul>
	</li><li>org.apache.geronimo.samples.inventory.exception<ul><li>DuplicateItemIdException-处理重复项ID方案的自定义异常。</li><li>ItemException-包装数据访问异常（NamingException，SQLException）。</li><li>NotSufficientQuantityException-用于处理数量不足情况的自定义异常。</li></ul>
	</li><li>org.apache.geronimo.samples.inventory.web<ul><li>AddItemServlet-将项目信息添加到服务层。</li><li>IssueingServlet-将发布项目信息分发到服务层。</li><li>ReceivingServlet-将接收项目信息调度到服务层。</li></ul>
	</li></ul>


<p>应用程序中的Web应用程序文件列表如下所示。</p>

<div class="preformatted panel" style="background-color:#ffffff;border-color:#ffffff;border-style:solid;border-width:1px"><div class="preformattedContent panelContent" style="background-color:#ffffff">
<pre>|- jsp
    +- add.jsp
    +- error.jsp
    +- issue.jsp
    +- recv.jsp
|- WEB-INF
    +- geronimo-web.xml
    +- web.xml
|- welcome.jsp
</pre>
</div></div>

<p>该应用程序在geronimo计划和<strong>web.xml</strong>部署计划的帮助下定义了一个数据源。库存清单或库存清单猫的Geronimo计划将内部JNDI名称“ java：comp / env / jdbc / InventoryDS”链接到样本数据库。</p>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>geronimo-web.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns="http://geronimo.apache.org/xml/ns/j2ee/web-2.0.1"&gt;
  &lt;dep:environment xmlns:dep="http://geronimo.apache.org/xml/ns/deployment-1.2"&gt;
    &lt;dep:moduleId&gt;
      &lt;dep:groupId&gt;org.apache.geronimo.samples&lt;/dep:groupId&gt;
      &lt;dep:artifactId&gt;inventory-jetty&lt;/dep:artifactId&gt;
      &lt;dep:version&gt;2.2-SNAPSHOT&lt;/dep:version&gt;
      &lt;dep:type&gt;car&lt;/dep:type&gt;
    &lt;/dep:moduleId&gt;
    &lt;dep:dependencies&gt;
      &lt;dep:dependency&gt;
        &lt;dep:groupId&gt;org.apache.geronimo.configs&lt;/dep:groupId&gt;
        &lt;dep:artifactId&gt;jasper&lt;/dep:artifactId&gt;
        &lt;dep:version&gt;2.2-SNAPSHOT&lt;/dep:version&gt;
        &lt;dep:type&gt;car&lt;/dep:type&gt;
      &lt;/dep:dependency&gt;
      &lt;dep:dependency&gt;
        &lt;dep:groupId&gt;org.apache.geronimo.configs&lt;/dep:groupId&gt;
        &lt;dep:artifactId&gt;jetty6&lt;/dep:artifactId&gt;
        &lt;dep:version&gt;2.2-SNAPSHOT&lt;/dep:version&gt;
        &lt;dep:type&gt;car&lt;/dep:type&gt;
      &lt;/dep:dependency&gt;
      &lt;dep:dependency&gt;
        &lt;dep:groupId&gt;org.apache.geronimo.samples&lt;/dep:groupId&gt;
        &lt;dep:artifactId&gt;sample-datasource&lt;/dep:artifactId&gt;
        &lt;dep:version&gt;2.2-SNAPSHOT&lt;/dep:version&gt;
        &lt;dep:type&gt;car&lt;/dep:type&gt;
      &lt;/dep:dependency&gt;
    &lt;/dep:dependencies&gt;
    &lt;dep:hidden-classes/&gt;
    &lt;dep:non-overridable-classes/&gt;
  &lt;/dep:environment&gt;
  &lt;context-root&gt;/inventory&lt;/context-root&gt;
  &lt;!--define a reference name to the db pool--&gt;
  &lt;resource-ref&gt;
    &lt;ref-name&gt;jdbc/InventoryDS&lt;/ref-name&gt;
    &lt;resource-link&gt;SampleTxDatasource&lt;/resource-link&gt;
  &lt;/resource-ref&gt;
&lt;/web-app&gt;
</pre>
</div></div>

<p>以下是清单应用程序的<strong>web.xml</strong> 。它声明在ItemDAO中用于查找数据源的名称“ java：comp / env / jdbc / InventoryDS”。</p>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>web.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns="http://java.sun.com/xml/ns/j2ee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee
	 http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"
         version="2.4"&gt;

    &lt;welcome-file-list&gt;
        &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
    &lt;/welcome-file-list&gt;

    &lt;servlet&gt;
        &lt;display-name&gt;AddItemServlet&lt;/display-name&gt;
        &lt;servlet-name&gt;AddItemServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.apache.geronimo.samples.inventory.web.AddItemServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
    &lt;servlet&gt;
        &lt;display-name&gt;IssueingServlet&lt;/display-name&gt;
        &lt;servlet-name&gt;IssueingServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.apache.geronimo.samples.inventory.web.IssueingServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
    &lt;servlet&gt;
        &lt;display-name&gt;ReceivingServlet&lt;/display-name&gt;
        &lt;servlet-name&gt;ReceivingServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.apache.geronimo.samples.inventory.web.ReceivingServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;AddItemServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/add_item&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;IssueingServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/issue&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;ReceivingServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/recv&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

    &lt;!-- reference name exposed as a datasource --&gt;
    &lt;resource-ref&gt;
        &lt;res-ref-name&gt;jdbc/InventoryDS&lt;/res-ref-name&gt;
        &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
        &lt;res-auth&gt;Container&lt;/res-auth&gt;
        &lt;res-sharing-scope&gt;Shareable&lt;/res-sharing-scope&gt;
    &lt;/resource-ref&gt;

&lt;/web-app&gt;
</pre>
</div></div>


<h3 id="inventory-SimpleDatabaseAccessApplication-SampleDatabase">样本数据库</h3>
<p>用于演示此应用程序的示例数据库是内置Derby数据库。示例数据库的名称为<strong>InventoryDB</strong> ，它由两个表组成，即ITEM和ITEM_MASTER。这些表中的每个字段的说明如下。</p>

<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>表名</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>领域</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>项目</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>ITEM_ID（主键）<br class="atl-forced-newline" clear="none">项目名<br class="atl-forced-newline" clear="none">描述</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>ITEM_MASTER</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>ITEM_ID（主键）<br class="atl-forced-newline" clear="none">数量</p></td></tr></tbody></table></div>


<p><strong>ITEM</strong>表存储与项目相关的数据，而<strong>ITEM_MASTER</strong>存储每个项目的现有数量。</p>


<h1 id="inventory-SimpleDatabaseAccessApplication-TestingoftheSampleApplication">样本应用程序的测试</h1>

<p>要测试示例应用程序，请打开浏览器，然后输入<a shape="rect" class="external-link" href="http://localhost:8080/inventory" rel="nofollow">http：// localhost：8080 / inventory</a> 。将加载充当公告板的Inventory应用程序的“欢迎”页面。</p>

<p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" src="inventory-simple-database-access-application.data/inventory_app.png"></span></p>

<p>用户可以从“欢迎”页面直接访问“添加项目”，“接收货物”和“发货”功能。</p></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : inventory - Simple Database Access Application';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2013，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  

</body></html>