<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Certificate Properties File Realm" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Certificate Properties File Realm" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0 Documentation: Certificate Properties File Realm</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="configuring-and-administering.html">Configuring and administering</a>&nbsp;&gt;&nbsp;<a href="administering-security.html">Administering Security</a>&nbsp;&gt;&nbsp;<a href="administering-security-realms.html">Administering security realms</a>&nbsp;&gt;&nbsp;<a href="certificate-properties-file-realm.html">Certificate Properties File Realm</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Certificate Properties File Realm</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645337">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645337">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645337">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645337">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645337">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645337">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>

<p>This realm type allows you to configure Web applications to authenticate users against it. To get to that point, you will need to first configure Geronimo to use a custom SSL port listener and to get to that point you will need to configure SSL keys and keystore. The following sections describe step-by-step how to configure each of these modules.</p>

<ul><li><a shape="rect" href="certificate-properties-file-realm.html">#Create keystore and certificate</a></li><li><a shape="rect" href="certificate-properties-file-realm.html">#Create a Certificate Signing Request (CSR) and import CA reply</a></li><li><a shape="rect" href="certificate-properties-file-realm.html">#Import trusted certificates</a></li><li><a shape="rect" href="certificate-properties-file-realm.html">#Add an HTTPS listener with client authentication</a></li></ul>



<h1 id="CertificatePropertiesFileRealm-Createkeystoreandcertificate">Create keystore and certificate</h1>
<p>For this configuration we will create a new keystore, a new private key, a CSR and will import the CA reply</p>

<p>We already mentioned in the <a shape="rect" href="administering-certificates.html">Administering Certificates</a> section how to create a keystore and a private key, in this section we will complete the picture by generating a CSR and importing the CA's reply.</p>

<p>The keystores in Geronimo are stored in the <strong>&lt;geronimo_home&gt;\var\security\keystores</strong> directory, the default keystore already provided with the installation is <strong>geronimo-default</strong>. For this exercise we will create a new keystore.</p>

<p>From the Geronimo Administration Console click on <strong>Keystores</strong> to access the <strong>Keystore Configuration</strong> portlet.</p>

<p>Click on <strong>New Keystore</strong>, specify a new keystore name and password and then click on <strong>Create Keystore</strong>. For this example we used <code>My_Keystore</code> and <code>password</code> respectively.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/consoleKeystoreConfig.png"></span></p>

<p>Click on the keystore file you just created, and create a private key by clicking on the appropriate link.</p>

<p>Fill in with the appropriate data and click on <strong>Review Key Data</strong>.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/consolePrivateKeyAdd.png"></span></p>

<p>Once you verified the values are correct click on <strong>Generate Key</strong>.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/consoleKeystoreContents.png"></span></p>

<p>Right after you created a new private key, this key is automatically locked. That means that you can only view it or delete it, to create a Certificate Signing Request (CSR) you will have to unlock the key. To do that click on <strong>Return to keystore list</strong>.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/consoleKeystoreContentsLocked.png"></span></p>

<p>Click on the <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/keystoreLockOn.png"></span> to unlock the private key. You will be prompted with the password for the keystore and for the private key.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/consoleKeystoreUnlock.png"></span></p>

<p>Click on <strong>Unlock Keystore</strong>.</p>

<h1 id="CertificatePropertiesFileRealm-CreateaCertificateSigningRequest(CSR)andimportCAreply">Create a Certificate Signing Request (CSR) and import CA reply</h1>
<p>Now that you have the private key unlocked you may now continue to create a CSR. From the <strong>Keystore Configuration</strong> portlet click on the keystore file you created to display the current content.  In this example we only have one private key. Click on either <strong>view</strong> or the alias links for the current private key to display the details and additional actions.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/consoleCertInfo.png"></span></p>

<p>Click on <strong>Generate CSR</strong>, the certificate request should be displayed as illustrated in the following figure.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/consoleCertCSR.png"></span></p>

<p>This is a <strong>PKCS10</strong> certification request, you should copy this text and paste it into a flat txt file so it can be sent to a CA.</p>

<parameter ac:name="title">csr.txt</parameter><parameter ac:name="borderStyle">solid</parameter><plain-text-body>
-----BEGIN CERTIFICATE REQUEST-----
MIIBqDCCARECAQAwajESMBAGA1UEAxMJbG9jYWxob3N0MREwDwYDVQQLEwhHZXJvbmltbz
EPMA0GA1UEChMGQXBhY2hlMRAwDgYDVQQHDAdNeV9DaXR5MREwDwYDVQQIDAhNeV9TdGF0
ZTELMAkGA1UEBhMCQ0MwgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAMfqprJ/aMbVzm
EjDimnMQuVN/CaO7Yb89KP6ed3VQf+/Ea2i+p0dRskM8oNg+3kZeKuOplwq5KGEUnp+xbf
q7M6tLGrWqQ8qL3EZUFE2nizH5VzV093vKu5jgnR2RfbTc2AplcldCPofUVuMUbDLPsmE1
YQQr+OcHtcNspZL5tdAgMBAAEwDQYJKoZIhvcNAQEEBQADgYEAZFuPz0gzKqMZNA0bYLm0
aPFLbR9a19NA0EbgJL2SYzoKnuKyplG2JzMVQ6myaez0J8t+iWtuthz70kBihRzU2vqOWp
B4oqh+zbPwn4f87l4l8PjJh3SkiDIYdMcL5U1rxwFNAaIEpfjft/uJLY/Bv7DZQG7UPsGz
+SPdn+DbdBo=
-----END CERTIFICATE REQUEST-----
</plain-text-body>

<p>You can now click <strong>Back</strong> to return to the private key details portlet.</p>

<p>For this example we used a custom, home made CA so we could sign our own certificates for this test without altering the standard procedure. Assuming that you sent you CSR to a CA, the CA should respond back with another similar file containing the CA signed certificate.</p>

<parameter ac:name="title">csr_ca_reply.txt</parameter><parameter ac:name="borderStyle">solid</parameter><plain-text-body>
-----BEGIN CERTIFICATE-----
MIICQjCCAa2gAwIBAgIBAjALBgkqhkiG9w0BAQQwaDEWMBQGA1UEAxMNR2Vyb25pbW8ncyBDQTER
MA8GA1UECxMIR2Vyb25pbW8xDzANBgNVBAoTBkFwYWNoZTENMAsGA1UEBxMEQ2l0eTEOMAwGA1UE
CBMFU3RhdGUxCzAJBgNVBAYTAlVTMB4XDTA4MDIyMDA2MDAwMFoXDTA5MDIyMTA2MDAwMFowajES
MBAGA1UEAxMJbG9jYWxob3N0MREwDwYDVQQLEwhHZXJvbmltbzEPMA0GA1UEChMGQXBhY2hlMRAw
DgYDVQQHDAdNeV9DaXR5MREwDwYDVQQIDAhNeV9TdGF0ZTELMAkGA1UEBhMCQ0MwgZ8wDQYJKoZI
hvcNAQEBBQADgY0AMIGJAoGBAMfqprJ/aMbVzmEjDimnMQuVN/CaO7Yb89KP6ed3VQf+/Ea2i+p0
dRskM8oNg+3kZeKuOplwq5KGEUnp+xbfq7M6tLGrWqQ8qL3EZUFE2nizH5VzV093vKu5jgnR2Rfb
Tc2AplcldCPofUVuMUbDLPsmE1YQQr+OcHtcNspZL5tdAgMBAAEwCwYJKoZIhvcNAQEEA4GBAB9s
1QuMD+dNe6H6XcizZSxNPOh1EocjGp05Z4VOpgFnB4gVRqJqyxiuNqCBPvEo30IuHNJZOm6jFhGs
YWKGlzL1zw0yXWAVRnI7Cs8C7Ibeoo+I4yBA93w3XyGiBlSb03yHOiCN06bf7BhCN6Z45NMhBGbP
pCpnP+uM9VI2gn9H
-----END CERTIFICATE-----
</plain-text-body>

<p>From the private key details portlet click on <strong>Import CA reply</strong>. Remove any pre-filled text in the certificate reply window and paste the text from the CA reply file and click on <strong>Save</strong>.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/consoleCertReply.png"></span></p>

<p>After saving the CA reply you should now notice that the certificate now shows a different <strong>Issuer</strong>. Click on <strong>Back to keystore</strong> and then on <strong>Return to keystore list</strong>.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/consoleCertIssuer.png"></span></p>

<h1 id="CertificatePropertiesFileRealm-Importtrustedcertificates">Import trusted certificates</h1>
<p>In order to enable client authentication you will need to import the CA who signed your CSR as a trusted certificate, this process has to be only once. The CA should provide along with the signed CSR a separate certificate for the CA itself. For this example we are using our own CA so we generated the following CA certificate.</p>

<parameter ac:name="title">My_Own_CA_Certificate.txt</parameter><parameter ac:name="borderStyle">solid</parameter><plain-text-body>
-----BEGIN CERTIFICATE-----
MIICJTCCAZCgAwIBAgICK2cwCwYJKoZIhvcNAQEEMFoxDTALBgNVBAMTBFRlc3QxDzANBgNVBAsT
BkFwYWNoZTERMA8GA1UEChMIR2Vyb25pbW8xCzAJBgNVBAcTAkxMMQswCQYDVQQIEwJTVDELMAkG
A1UEBhMCTEswHhcNMDcwMjAyMTgwMDAwWhcNMDgwMjAyMTgwMDAwWjBaMQ0wCwYDVQQDEwRUZXN0
MQ8wDQYDVQQLEwZBcGFjaGUxETAPBgNVBAoTCEdlcm9uaW1vMQswCQYDVQQHEwJMTDELMAkGA1UE
CBMCU1QxCzAJBgNVBAYTAkxLMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCUZl1e1eTKLoh0
15vfYqqvhk6Iviva7BWQxZ6mOV9Ye2mii37Btmxajnngz0jKfiwHKqWRQBp6CUzbd9gfZrz2go9g
TwsUBWQwSf6iVypKX1q0Y4WhtTwLcEx78Lx5XN1YCqk34pn4by26SJiHdugs7/ClOiIlcpCt9QVa
Q9BH7wIDAQABMAsGCSqGSIb3DQEBBAOBgQAnmoT/dLvJa7jGstvZJLrsWtMwWQNVJ1ZQmbrDGq9u
oFnkAH1mGHIDbaz2avy/wotHJUIysGBlDP0btk5GVskl45EG/feWHLgCVmqwf3NkdRdLl+CznBBJ
KCC5tINbcI6GqXsbO8hhjIrOGweNyV1653WEvZiQVuMYaHTnGNx+RA==
-----END CERTIFICATE-----
</plain-text-body>

<p>While in the Keystore Configuration portlet click on the keystore file you created and then click on <strong>Add Trust Certificate</strong>. Delete any pre-filled content from <strong>Trusted Certificate</strong> window and paste the content from the CA certificate and add an alias to this certificate.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/keystore_10.gif"></span></p>

<p>Click on <strong>Review Certificate</strong> and then click on <strong>Import Certificate</strong>. You should now see the trusted certificate you just imported.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/keystore_11.gif"></span></p>

<h1 id="CertificatePropertiesFileRealm-AddanHTTPSlistenerwithclientauthentication">Add an HTTPS listener with client authentication</h1>
<p>Apache Geronimo comes with a predefined HTTPS listener on port 8443 but this listener is not configured for client authentication. In this example we will add a new HTTPS listener and configure it to request client authentication using the certificates we created and imported in the previous steps.</p>

<p>Note that in this example we are using the Tomcat distribution of Geronimo, although the process is the same some names and links may vary slightly if you are using the Jetty distribution.</p>

<p>From the Geronimo Administration Console click on <strong>Web Server</strong> to access the Network Listener portlet.</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/network_listener_1.gif"></span></p>

<p>From the Network Listener portlet click on <strong>Add new HTTPS listener for Tomcat</strong></p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/network_listener_2.gif"></span></p>

<p>Fill in the fields with the appropriate data and click <strong>Save</strong>. For this example we only specified the keystore and not a trustore. When specifying the keystore file path you should add something similar to <strong>var/security/keystores/&lt;your_keystore&gt;</strong>, this path is relative to Geronimo's installation home directory.</p>

<p>Select the <strong>ClientAuth</strong> check box, this tells the HTTPS listener to only establish an encrypted connection with a client that provides a valid client certificate. The client certificates are verified against the CA certificates stored in any of these locations (in order):</p>

<ol><li>The trust store configured above</li><li>A keystore file specified by the javax.net.ssl.trustStore system property</li><li>java-home/lib/security/jssecacerts</li><li>java-home/lib/security/cacerts</li></ol>


<p>Once you saved this HTTPS network listener configuration it will get started automatically as you can see in the status displayed. If you try to access this port with your browser it should fail because at this point you have not configured your client with a valid certificate.</p></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Certificate Properties File Realm';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
