<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=0">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="Certificate Properties File Realm">
    <meta name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Certificate Properties File Realm">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2010-05-11">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0文档：证书属性文件领域</title>
  </head>

  <body  onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">Home</a> > <a href="documentation.html">文档</a> > <a href="configuring-and-administering.html">配置和管理</a> > <a href="administering-security.html">管理安全</a> > <a href="administering-security-realms.html">管理安全领域</a> > <a href="certificate-properties-file-realm.html">证书属性文件领域</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo v3.0</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">证书属性文件领域</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645337"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645337">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645337"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645337">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645337"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645337">添加新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>

<p>此领域类型使您可以配置Web应用程序以对其进行身份验证。为此，您首先需要配置Geronimo以使用自定义SSL端口侦听器，然后，需要配置SSL密钥和密钥库。以下各节逐步介绍了如何配置这些模块中的每个模块。</p>

<ul><li><a shape="rect" href="certificate-properties-file-realm.html">＃创建密钥库和证书</a></li><li><a shape="rect" href="certificate-properties-file-realm.html">＃创建证书签名请求（CSR）并导入CA回复</a></li><li><a shape="rect" href="certificate-properties-file-realm.html">＃导入受信任的证书</a></li><li><a shape="rect" href="certificate-properties-file-realm.html">＃添加具有客户端身份验证的HTTPS侦听器</a></li></ul>



<h1 id="CertificatePropertiesFileRealm-Createkeystoreandcertificate">创建密钥库和证书</h1>
<p>对于此配置，我们将创建一个新的密钥库，一个新的私钥，一个CSR并将导入CA答复</p>

<p>我们已经在“ <a shape="rect" href="administering-certificates.html">管理证书”</a>部分中提到了如何创建密钥库和私钥，在这一部分中，我们将通过生成CSR并导入CA的答复来完成操作。</p>

<p>Geronimo中的密钥库存储在<strong><geronimo_home>\ var \ security \ keystores</geronimo_home></strong>目录中，安装随附的默认密钥库为<strong>geronimo-default</strong> 。在本练习中，我们将创建一个新的密钥库。</p>

<p>在Geronimo管理控制台中，单击<strong>密钥库</strong>以访问<strong>密钥库配置</strong> portlet。</p>

<p>单击“ <strong>新建密钥库”</strong> ，指定新的密钥库名称和密码，然后单击“ <strong>创建密钥库”</strong> 。在此示例中，我们使用了<code>My_Keystore</code>和<code>password</code>分别。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/consoleKeystoreConfig.png"></span></p>

<p>单击刚刚创建的密钥库文件，然后通过单击相应的链接来创建私钥。</p>

<p>填写适当的数据，然后单击<strong>Review Key Data</strong> 。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/consolePrivateKeyAdd.png"></span></p>

<p>验证值正确后，请单击<strong>生成密钥</strong> 。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/consoleKeystoreContents.png"></span></p>

<p>创建新私钥后，此私钥会立即自动锁定。这意味着您只能查看或删除它，才能创建证书签名请求（CSR），您将必须解锁密钥。为此，请单击“ <strong>返回到密钥库列表”</strong> 。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/consoleKeystoreContentsLocked.png"></span></p>

<p>点击<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/keystoreLockOn.png"></span>解锁私钥。系统将提示您输入密钥库和私钥的密码。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/consoleKeystoreUnlock.png"></span></p>

<p>单击<strong>解锁密钥库</strong> 。</p>

<h1 id="CertificatePropertiesFileRealm-CreateaCertificateSigningRequest(CSR)andimportCAreply">创建证书签名请求（CSR）并导入CA答复</h1>
<p>现在您已经解锁了私钥，现在可以继续创建CSR。在“ <strong>密钥库配置”</strong> portlet中，单击您创建的密钥库文件以显示当前内容。在此示例中，我们只有一个私钥。单击<strong>视图</strong>或当前私钥的别名链接以显示详细信息和其他操作。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/consoleCertInfo.png"></span></p>

<p>单击<strong>Generate CSR</strong> ，将显示证书请求，如下图所示。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/consoleCertCSR.png"></span></p>

<p>这是<strong>PKCS10</strong>认证请求，您应该复制此文本并将其粘贴到平面txt文件中，以便可以将其发送到CA。</p>

<parameter ac:name="title">csr.txt</parameter> <parameter ac:name="borderStyle">固体</parameter> <plain-text-body>----- BEGIN CERTIFICATE REQUEST ----- MIIBqDCCARECAQAwajESMBAGA1UEAxMJbG9jYWxob3N0MREwDwYDVQQLEwhHZXJvbmltbz EPMA0GA1UEChMGQXBhY2hlMRAwDgYDVQQHDAdNeV9DaXR5MREwDwYDVQQIDAhNeV9TdGF0 ZTELMAkGA1UEBhMCQ0MwgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAMfqprJ / aMbVzm EjDimnMQuVN / CaO7Yb89KP6ed3VQf + / + Ea2i + p0dRskM8oNg + 3kZeKuOplwq5KGEUnp XBF q7M6tLGrWqQ8qL3EZUFE2nizH5VzV093vKu5jgnR2RfbTc2AplcldCPofUVuMUbDLPsmE1 YQQr + OcHtcNspZL5tdAgMBAAEwDQYJKoZIhvcNAQEEBQADgYEAZFuPz0gzKqMZNA0bYLm0 aPFLbR9a19NA0EbgJL2SYzoKnuKyplG2JzMVQ6myaez0J8t + iWtuthz70kBihRzU2vqOWp B4oqh + zbPwn4f87l4l8PjJh3SkiDIYdMcL5U1rxwFNAaIEpfjft / uJLY / Bv7DZQG7UPsGz + SPDN + DbdBo = -----结束证书请求-----</plain-text-body>

<p>现在，您可以单击<strong>返回</strong>以返回到私钥详细信息portlet。</p>

<p>在此示例中，我们使用了定制的自制CA，因此我们可以在不更改标准程序的情况下为此测试签署自己的证书。假设您已将CSR发送给CA，则CA应该以包含CA签名证书的另一个类似文件作为响应。</p>

<parameter ac:name="title">csr_ca_reply.txt</parameter> <parameter ac:name="borderStyle">固体</parameter> <plain-text-body>----- BEGIN CERTIFICATE ----- MIICQjCCAa2gAwIBAgIBAjALBgkqhkiG9w0BAQQwaDEWMBQGA1UEAxMNR2Vyb25pbW8ncyBDQTER MA8GA1UECxMIR2Vyb25pbW8xDzANBgNVBAoTBkFwYWNoZTENMAsGA1UEBxMEQ2l0eTEOMAwGA1UE CBMFU3RhdGUxCzAJBgNVBAYTAlVTMB4XDTA4MDIyMDA2MDAwMFoXDTA5MDIyMTA2MDAwMFowajES MBAGA1UEAxMJbG9jYWxob3N0MREwDwYDVQQLEwhHZXJvbmltbzEPMA0GA1UEChMGQXBhY2hlMRAw DgYDVQQHDAdNeV9DaXR5MREwDwYDVQQIDAhNeV9TdGF0ZTELMAkGA1UEBhMCQ0MwgZ8wDQYJKoZI hvcNAQEBBQADgY0AMIGJAoGBAMfqprJ / aMbVzmEjDimnMQuVN / CaO7Yb89KP6ed3VQf + / + Ea2i P0 dRskM8oNg + 3kZeKuOplwq5KGEUnp + xbfq7M6tLGrWqQ8qL3EZUFE2nizH5VzV093vKu5jgnR2Rfb Tc2AplcldCPofUVuMUbDLPsmE1YQQr + OcHtcNspZL5tdAgMBAAEwCwYJKoZIhvcNAQEEA4GBAB9s 1QuMD + dNe6H6XcizZSxNPOh1EocjGp05Z4VOpgFnB4gVRqJqyxiuNqCBPvEo30IuHNJZOm6jFhGs YWKGlzL1zw0yXWAVRnI7Cs8C7Ibeoo + I4yBA93w3XyGiBlSb03yHOiCN06bf7BhCN6Z45NMhBGbP pCpnP + uM9VI2gn9H --- -结束证书-----</plain-text-body>

<p>从私钥详细信息portlet中，单击“ <strong>导入CA答复”</strong> 。在证书回复窗口中删除所有预填充的文本，然后从CA回复文件中粘贴该文本，然后单击<strong>保存</strong> 。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/consoleCertReply.png"></span></p>

<p>保存CA答复后，您现在应该注意到证书现在显示了不同的<strong>Issuer</strong> 。单击<strong>返回到密钥库</strong> ，然后单击<strong>返回到密钥</strong> <strong>库列表</strong> 。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/consoleCertIssuer.png"></span></p>

<h1 id="CertificatePropertiesFileRealm-Importtrustedcertificates">导入受信任的证书</h1>
<p>为了启用客户端身份验证，您将需要导入将您的CSR签名为可信证书的CA，此过程只需一次。CA应当与签名的CSR一起为CA本身提供单独的证书。在此示例中，我们使用自己的CA，因此我们生成了以下CA证书。</p>

<parameter ac:name="title">My_Own_CA_Certificate.txt</parameter> <parameter ac:name="borderStyle">固体</parameter> <plain-text-body>----- BEGIN CERTIFICATE ----- MIICJTCCAZCgAwIBAgICK2cwCwYJKoZIhvcNAQEEMFoxDTALBgNVBAMTBFRlc3QxDzANBgNVBAsT BkFwYWNoZTERMA8GA1UEChMIR2Vyb25pbW8xCzAJBgNVBAcTAkxMMQswCQYDVQQIEwJTVDELMAkG A1UEBhMCTEswHhcNMDcwMjAyMTgwMDAwWhcNMDgwMjAyMTgwMDAwWjBaMQ0wCwYDVQQDEwRUZXN0 MQ8wDQYDVQQLEwZBcGFjaGUxETAPBgNVBAoTCEdlcm9uaW1vMQswCQYDVQQHEwJMTDELMAkGA1UE CBMCU1QxCzAJBgNVBAYTAkxLMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCUZl1e1eTKLoh0 15vfYqqvhk6Iviva7BWQxZ6mOV9Ye2mii37Btmxajnngz0jKfiwHKqWRQBp6CUzbd9gfZrz2go9g TwsUBWQwSf6iVypKX1q0Y4WhtTwLcEx78Lx5XN1YCqk34pn4by26SJiHdugs7 / ClOiIlcpCt9QVa Q9BH7wIDAQABMAsGCSqGSIb3DQEBBAOBgQAnmoT / dLvJa7jGstvZJLrsWtMwWQNVJ1ZQmbrDGq9u oFnkAH1mGHIDbaz2avy / wotHJUIysGBlDP0btk5GVskl45EG / feWHLgCVmqwf3NkdRdLl + CznBBJ KCC5tINbcI6GqXsbO8hhjIrOGweNyV1653WEvZiQVuMYaHTnGNx + RA == ----- END CERTIFICATE --- -</plain-text-body>

<p>在“密钥库配置” portlet中，单击您创建的密钥库文件，然后单击“ <strong>添加信任证书”</strong> 。从“ <strong>受信任的证书”</strong>窗口中删除任何预填充的内容，然后从CA证书中粘贴该内容，并为此证书添加别名。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/keystore_10.gif"></span></p>

<p>单击<strong>查看证书</strong> ，然后单击<strong>导入证书</strong> 。现在，您应该看到刚导入的受信任证书。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/keystore_11.gif"></span></p>

<h1 id="CertificatePropertiesFileRealm-AddanHTTPSlistenerwithclientauthentication">添加具有客户端身份验证的HTTPS侦听器</h1>
<p>Apache Geronimo在端口8443上附带了预定义的HTTPS侦听器，但未为客户端身份验证配置此侦听器。在此示例中，我们将添加一个新的HTTPS侦听器，并将其配置为使用在前面的步骤中创建和导入的证书来请求客户端身份验证。</p>

<p>请注意，在此示例中，我们使用的是Geronimo的Tomcat发行版，尽管过程相同，但是如果使用Jetty发行版，则某些名称和链接可能会略有不同。</p>

<p>在Geronimo管理控制台中，单击<strong>Web服务器</strong>以访问网络侦听器portlet。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/network_listener_1.gif"></span></p>

<p>从网络侦听器portlet中，单击“ <strong>为Tomcat添加新的HTTPS侦听器”</strong></p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="certificate-properties-file-realm.data/network_listener_2.gif"></span></p>

<p>在字段中填写适当的数据，然后单击“ <strong>保存”</strong> 。在此示例中，我们仅指定了密钥库，而不指定了托管区。指定密钥库文件路径时，应添加类似于<strong>var / security / keystores /的内容。 <your_keystore></your_keystore></strong> ，此路径相对于Geronimo的安装主目录。</p>

<p>选中<strong>ClientAuth</strong>复选框，它告诉HTTPS侦听器仅与提供有效客户端证书的客户端建立加密连接。对照存储在以下任意位置的CA证书来验证客户端证书：</p>

<ol><li>上面配置的信任库</li><li>javax.net.ssl.trustStore系统属性指定的密钥库文件</li><li>java-home / lib / security / jssecacerts</li><li>java-home / lib / security / cacerts</li></ol>


<p>保存此HTTPS网络侦听器配置后，它将自动启动，如显示状态所示。如果尝试使用浏览器访问此端口，则该端口将失败，因为此时您尚未为客户端配置有效的证书。</p></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Certificate Properties File Realm';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2013，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  

</body></html>