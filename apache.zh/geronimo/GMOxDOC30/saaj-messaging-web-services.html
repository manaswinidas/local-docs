<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=0">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="SAAJ Messaging Web Services">
    <meta name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi SAAJ Messaging Web Services">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2010-05-11">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0文档：SAAJ消息传递Web服务</title>
  </head>

  <body  onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">主页</a> > <a href="documentation.html">文档</a> > <a href="developing.html">开发</a> > <a href="tutorials.html">教程</a> > <a href="developing-web-services.html">开发Web服务</a> > <a href="saaj-messaging-web-services.html">SAAJ消息传递Web服务</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo v3.0</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">SAAJ消息传递Web服务</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645254"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645254">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645254"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645254">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645254"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645254">新增新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>
<p>本文为您介绍了<strong>SAAJ Messaging中</strong>涉及的一些基本概念。本教程的目的是简要概述SOAP（或SAAJ）消息所涉及的术语。</p>

<p>我们还将开发一个基本的SAAJ客户端，该客户端通过发送SOAP消息来访问已部署的Web服务。通过使用SAAJ，我们将在<strong>XML消息级别上</strong>工作，这意味着我们需要创建<strong>SOAP请求</strong>消息并解析<strong>SOAP响应</strong>消息以获取结果。</p>

<p>要运行本教程，至少需要您安装以下必备软件。</p>

<ol><li>Sun JDK 6.0+（J2SE 1.6）</li><li>面向特定平台的Java EE开发人员的Eclipse IDE</li><li>Apache Geronimo Eclipse插件2.1.x</li><li>Apache Geronimo服务器2.1.x <rich-text-body>
<p>在本教程中使用了Geronimo 2.1.x版，Java 1.5运行时和Eclipse Ganymede，但是可以使用其他版本（例如Geronimo 2.2版，Java 1.6，Eclipse Europa）</p></rich-text-body></li></ol>


<p>在本教程的适当时候我们遵循的步骤是：</p>
<parameter ac:name="maxLevel">2</parameter> <parameter ac:name="type">清单</parameter> <parameter ac:name="separator">管</parameter>

<h1 id="SAAJMessagingWebServices-WhatisSAAJ?">什么是SAAJ？</h1>
<p><strong>SAAJ</strong>代表<strong>带有Java附件API的SOAP</strong> 。SAAJ消息遵循SOAP标准，该标准规定了消息的格式。使用<strong>SAAJ API，</strong>可以通过简单地进行Java API调用来创建符合SOAP 1.1或1.2规范的XML消息。</p>

<h1 id="SAAJMessagingWebServices-SAAJMessagesandConnections">SAAJ消息和连接</h1>
<h2 id="SAAJMessagingWebServices-Messages">留言内容</h2>
<p>SOAP消息的两种主要类型是具有附件的和不具有附件的。使用SAAJ API <strong>发送的</strong>消息称为<strong>请求响应</strong>消息</p>

<parameter ac:name="title">SOAP消息概述</parameter> <rich-text-body>
<p>以下概述显示了SOAP消息的非常高级的结构。</p>
<ul><li>SOAP消息<ul><li>SOAP部分<ul><li>SOAP信封<ul><li>SOAP标头（可选）</li><li>香体</li></ul>
			</li></ul>
		</li><li>附件部分<ul><li>MIME标头</li><li>内容</li></ul>
		</li></ul>
	</li></ul>
</rich-text-body> 

<h2 id="SAAJMessagingWebServices-Connections">连接数</h2>
<p>所有SOAP消息都是通过连接发送和接收的。使用SAAJ API，该连接由<strong>SOAPConnection</strong>对象表示，该对象从发送方直接到达其目的地。它们通过具有<strong>call</strong>方法的SOAPConnection对象发送，该对象发送消息（请求），然后阻塞直到接收到答复（响应）。</p>

<h1 id="SAAJMessagingWebServices-DevelpoingaSAAJClient">开发SAAJ客户</h1>

<parameter ac:name="title">部署Web服务</parameter> <rich-text-body>
<p>我们将要开发的SAAJ客户端针对在“ <a shape="rect" href="developing-a-jax-ws-pojo-web-service.html">开发JAX-WS POJO Web服务”中</a>部署的<a shape="rect" href="developing-a-jax-ws-pojo-web-service.html">Web服务</a> 。尽管如果我们根据已部署服务的<strong>WSDL文件</strong>更改请求消息，则该模型将可用于任何Web服务。</p></rich-text-body>

<h2 id="SAAJMessagingWebServices-CreatingaDynamicWebProject">创建一个动态Web项目</h2>
<ul><li>创建一个动态Web项目<ul><li>选择<strong>文件->新建->项目</strong> （或Ctrl + N）<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>在弹出窗口中，选择“ <strong>Web”->“ Dynamic Web Project”</strong>类别（或在“向导”的输入字段中键入<em>dynamic</em> ，使其不受影响），然后单击“ <strong>下一步”。</strong>
<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="saaj-messaging-web-services.data/newproject.gif"></span> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>键入<strong>jaxws-saaj-converterclient</strong>作为<strong>项目名称</strong> ，然后单击两次<strong>Next</strong> 。
<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="saaj-messaging-web-services.data/projectname.gif"></span> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>将<strong>组ID</strong>修改为<strong>org.apache.geronimo.samples.jaxws.saaj</strong> ，并将<strong>工件ID修改</strong>为<strong>jaxws-saaj-converterclient</strong> 。
<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="saaj-messaging-web-services.data/deploymentplan.gif"></span> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>点击<strong>完成</strong></li></ul>
	</li></ul>


<h2 id="SAAJMessagingWebServices-AddingcodetosendandreceiveSOAPmessages">添加代码以发送和接收SOAP消息</h2>
<ul><li>右键单击<strong>jaxws-saaj-converterclient</strong> ，然后选择<strong>New-> JSP。</strong>
<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> </li><li>将jsp命名为<strong>index.jsp</strong> ，然后单击<strong>Finish。</strong>
<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="saaj-messaging-web-services.data/indexjsp.gif"></span> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>将以下代码添加到<strong>index.jsp</strong></li></ul>


<parameter ac:name="borderStyle">稳定的</parameter> <parameter ac:name="title">index.jsp</parameter> <plain-text-body><％@页面语言=“ java” contentType =“ text / html; charset = ISO-8859-1” pageEncoding =“ ISO-8859-1”％>

<title>转换器</title>
<meta content="text/html; CHARSET=iso-8859-1" http-equiv="Content-Type">



<center>
<h3>这从调用Web服务。</h3>
<br>请输入金额，然后单击提交以查看结果。<br>
<form action="index.jsp">量：<input type="text" name="amount">
<input type="submit" value="提交"></form>
<br>
<jsp:include page="ConverterHandler"></jsp:include></center>



</plain-text-body>

<ul><li>再次右键单击并添加一个名为<strong>ConverterHandler</strong>的<strong>Servlet。</strong>
<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="saaj-messaging-web-services.data/servlet.gif"></span> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>将以下代码添加到<strong>ConverterHandler.java</strong></li></ul>


<parameter ac:name="borderStyle">固态</parameter> <parameter ac:name="title">ConverterHandler.java</parameter> <plain-text-body>包abc;导入java.io。IOException;导入java.io。PrintWriter;导入java.util。迭代器；导入javax.servlet。ServletException;导入javax.servlet.http。HttpServletRequest;导入javax.servlet.http。HttpServletResponse;导入javax.xml.soap。MessageFactory;导入javax.xml.soap。SOAPBody;导入javax.xml.soap。SOAPConnection;导入javax.xml.soap。SOAPConnectionFactory;导入javax.xml.soap。SOAPElement;导入javax.xml.soap。SOAPEnvelope;导入javax.xml.soap。SOAPException;导入javax.xml.soap。SOAPMessage;导入javax.xml.soap。SOAPPart;导入org.w3c.dom。节点;公共类ConverterHandler扩展了javax.servlet.http。HttpServlet实现javax.servlet。Servlet {静态最终长serialVersionUID = 1L;公共ConverterHandler（）{super（）; }受保护的void doGet（HttpServletRequest请求，HttpServletResponse响应）抛出ServletException，IOException {字符串= request.getParameter（“ amount”）;如果（美元！= null && dollars.trim（）。length（）> 0）{字符串卢比= null，欧元= null;试试{卢比= returnResult（createSOAPMessage（“ dollarToRupees”，美元））;欧元= returnResult（createSOAPMessage（“ rupeesToEuro”，卢比））; } catch（SOAPException e）{// TODO自动生成的catch块e.printStackTrace（）; } PrintWriter out = response.getWriter（）; out.println（“<br><br><br>“）; out.println（”美元+“美元等于” +卢比+“卢比”）; out.println（“<br>“）; out.println（卢比+”卢比等于“ +欧元+”欧元“）;}}受保护的void doPost（HttpServletRequest请求，HttpServletResponse响应）抛出ServletException，IOException {doGet（request，response）;}公共SOAPMessage createSOAPMessage （字符串操作，字符串arg）抛出SOAPException {字符串urn =“ http://jaxws.samples.geronimo.apache.org”; MessageFactory messageFactory; SOAPMessage message = null; messageFactory = MessageFactory.newInstance（）; message = messageFactory.createMessage （）; SOAPPart soapPart = message.getSOAPPart（）; SOAPEnvelope信封= soapPart.getEnvelope（）; SOAPBody body =信封.getBody（）; SOAPElement bodyElement = body.addChildElement（envelope.createName（operation，“ ns1”，“缸： “ + urn））; bodyElement.addChildElement（” arg0“）。addTextNode（arg）; message.saveChanges（）;返回消息；} public String returnResult（SOAPMessage message）抛出SOAPException {String destination =” http：// localhost： 8080 / jaxws-converter / converter“; SOAPConnectionFactor y soapConnFactory = SOAPConnectionFactory .newInstance（）; SOAPConnection连接= soapConnFactory.createConnection（）; SOAPMessage回复= connection.call（消息，目的地）; SOAPPart soapPart = Reply.getSOAPPart（）; SOAPEnvelope信封= soapPart.getEnvelope（）; SOAPBody主体= wallet.getBody（）;迭代器iter = body.getChildElements（）;节点resultOuter =（（（Node）iter.next（））。getFirstChild（）;节点result = resultOuter.getFirstChild（）; connection.close（）;返回result.getNodeValue（）; }}</plain-text-body>

<ul><li>让我们简要地看一下我们在<strong>ConverterHandler.java中</strong>添加的代码
	<ul><li><strong>createSOAPMessage（）</strong> -在这里，我们将从<strong>MessageFactory</strong>实例创建一个新的SOAP消息，并根据WSDL文件所需的请求和格式设置消息的SOAP正文。<br clear="none">createSOAPMessage针对操作（“ dollarToRupees”）和参数（“ 23”）返回的<parameter ac:name="title">SOAP请求消息</parameter>如下所示： <parameter ac:name="title">SOAP请求消息</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><soapenv:envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"><soapenv:body><ns1:dollartorupees xmlns:ns1="urn:http://jaxws.samples.geronimo.apache.org"><arg0>23</arg0></ns1:dollartorupees></soapenv:body></soapenv:envelope><!--?xml--></plain-text-body></li><li><strong>returnResult（）</strong> -此函数处理Web服务发送的SOAP响应消息并返回结果。该函数通过<strong>SOAP连接</strong>使用<strong>调用</strong>方法来发送请求和接收响应。<br clear="none">Web服务针对上述SOAP Request消息返回的<parameter ac:name="title">SOAP响应消息</parameter>如下所示： <parameter ac:name="title">SOAP响应消息</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><soapenv:envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"><soapenv:header></soapenv:header> <soapenv:body><dlwmin:dollartorupeesresponse xmlns:dlwmin="http://jaxws.samples.geronimo.apache.org"><axis2ns1:return>933.34</axis2ns1:return></dlwmin:dollartorupeesresponse></soapenv:body></soapenv:envelope><!--?xml--></plain-text-body></li><li>在这里，通过使用SAAJ API中提供的功能来解析SOAP响应。还要注意，该<strong>呼叫</strong>是阻塞呼叫，这意味着它将继续等待直到收到响应。</li></ul>
	</li></ul>


<p>到此结束我们基于Web的客户端的开发部分。</p>

<h2 id="SAAJMessagingWebServices-DeployingandTestingtheWebClient">部署和测试Web客户端</h2>
<h3 id="SAAJMessagingWebServices-Deploy">部署</h3>
<ul><li>右键单击服务器视图中存在的<strong>Apache Geronimo</strong> Server Runtime，然后选择“ <strong>添加和删除项目”</strong>
<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>将<strong>jaxws-saaj-converterclient</strong>添加到已配置的项目列表中，然后单击“ <strong>完成”。</strong>
<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="saaj-messaging-web-services.data/deployproject.gif"></span> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>等待一段时间，直到服务器状态更改为“已<strong>同步”</strong></li></ul>


<h3 id="SAAJMessagingWebServices-Testing">测试中</h3>
<ul><li>右键单击存在于我们项目的WebContent目录下的<strong>index.jsp</strong> ，然后选择<strong>“运行方式”->“在服务器上运行”</strong>
<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>在弹出窗口中，选中复选框“ <strong>在运行项目时始终使用此服务器”</strong> ，然后单击“ <strong>完成”。</strong>
<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>现在，Eclipse将尝试在Web浏览器中打开jsp，该浏览器向您显示一个表格，以美元为单位输入金额。
<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li><li>输入任何金额，然后按<strong>Submit</strong> ，jsp将显示Web服务返回的结果。
<br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"> <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="saaj-messaging-web-services.data/output.gif"></span> <br class="atl-forced-newline" clear="none"> <br class="atl-forced-newline" clear="none"></li></ul>


<p>通过将SOAP请求消息发送到已部署的Web服务，从而完成了我们在XML级别工作的基本SAAJ客户端的开发和部署。</p></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : SAAJ Messaging Web Services';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2013，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  

</body></html>