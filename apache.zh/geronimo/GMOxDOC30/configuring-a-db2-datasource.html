<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Configuring a DB2 datasource" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Configuring a DB2 datasource" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>

  <link href='http://geronimo.apache.org/resources/highlighter/styles/shCoreGeronimo.css' rel='stylesheet' type='text/css' />
  <link href='http://geronimo.apache.org/resources/highlighter/styles/shThemeGeronimo.css' rel='stylesheet' type='text/css' />
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shCore.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushJava.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushXml.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushPlain.js' type='text/javascript'></script>
  
  <script type="text/javascript">
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
  </script>

    <title>Apache Geronimo v3.0 Documentation: Configuring a DB2 datasource</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="configuring-and-administering.html">Configuring and administering</a>&nbsp;&gt;&nbsp;<a href="configuring-services.html">Configuring services</a>&nbsp;&gt;&nbsp;<a href="configuring-datasources.html">Configuring datasources</a>&nbsp;&gt;&nbsp;<a href="configuring-a-db2-datasource.html">Configuring a DB2 datasource</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Configuring a DB2 datasource</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645322">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645322">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645322">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645322">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645322">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645322">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent">
<p><span class="confluence-anchor-link" id="ConfiguringaDB2datasource-top"></span></p>

<p>This article shows you how to configure a DB2 datasource in Apache Geronimo.</p>

<p>In this scenario, you will create a connection pool for a DB2 database, to connect to that database you are required to define at least two driver jar files. They include the JDBC driver itself and the respective license files. Depending on your implementation you will need different license files.</p>

<p>The steps described in this article are valid for deploying any other datasource when you do not have the drivers installed on the server, require multiple driver files, or both.</p>

<p>This article provides two alternatives to deploy the connection pool: using the Geronimo Administration Console and using the command line option.</p>

<h1 id="ConfiguringaDB2datasource-AddingDB2driverstotherepository">Adding DB2 drivers to the repository</h1>
<p>To add the DB2 drivers and license to the Geronimo repository, you are required to place the files in a particular directory structure. You will normally have two or three files to add to the repository. These files are:</p>

<ul><li><strong>db2jcc.jar</strong> - This is the actual DB2 Universal JDBC Driver jar file.</li><li><strong>db2jcc_license_cu.jar</strong> - This is the standard DB2 Universal JDBC driver license file that allows access to the DB2 Universal database for Linux, UNIX and Windows servers.</li><li><strong>db2jcc_license_cisuz.jar</strong> - This is the DB2 (DB2 ESE and DB2 Connect) JDBC Driver license for z/OS and iSeries that should be used in addition to the standard license for these servers.</li></ul>


<p>These files are available in the <code>&lt;sqllib_home&gt;\java</code> directory. For additional information about the DB2 JDBC drivers and licenses, visit the DB2 Information Center available at the following URL:</p>

<p><a shape="rect" class="external-link" href="http://publib.boulder.ibm.com/infocenter/db2luw/v9/index.jsp?topic=/com.ibm.db2.udb.doc/ad/t0010264.htm" rel="nofollow">http://publib.boulder.ibm.com/infocenter/db2luw/v9/index.jsp?topic=/com.ibm.db2.udb.doc/ad/t0010264.htm</a></p>

<p>To use these files in Geronimo, rename (copy and rename) the files according to the following table. In this case, you will not use <strong>db2jcc_license_cisuz.jar</strong> because it is for Z/OS and iSeries.</p>

<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>Original name</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>Renamed</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>db2jcc.jar</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>db2jcc-9.5.jar</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>db2jcc_license_cu.jar</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>db2jcc_license_cu-9.5.jar</p></td></tr></tbody></table></div>


<p>This means that for this particular case, DB2 v9.5 is used.</p>

<p>At this point, you are ready to add those files to the Geronimo repository in two ways. You can either use any graphical or command line tool to copy the files and create the necessary directories, or use the Geronimo Administration Console and add the driver and licenses to the common libraries. See the following details.</p>

<h3 id="ConfiguringaDB2datasource-Usingcommandline">Using command line</h3>
<p>Create the following directory structures under the <strong><code>&lt;geronimo_home&gt;\repository</code></strong> directory and copy the appropriate files to the respective directories.</p>

<ul><li><strong><code>com/ibm/db2/db2jcc/9.5</code></strong><br clear="none">
and copy the <strong>db2jcc-9.5.jar</strong> file into that directory.</li></ul>


<ul><li><strong><code>com/ibm/db2/db2jcc_license_cu/9.5</code></strong><br clear="none">
and copy the <strong>db2jcc_license_cisuz-9.5.jar</strong> file into that directory.</li></ul>


<h3 id="ConfiguringaDB2datasource-UsingtheGeronimoAdministrationConsole">Using the Geronimo Administration Console</h3>
<p>To use the administration console, Apache Geronimo must be running. Access the Geronimo Administration Console by pointing your browser to the following URL:</p>

<p><a shape="rect" class="external-link" href="http://localhost:8080/console" rel="nofollow">http://localhost:8080/console</a></p>

<ol><li>Enter <strong>system</strong> as the user name and <strong>manager</strong> as the password and click <strong>Login</strong>.</li><li>Click <strong>Services-&gt;Repository</strong> portlet.</li><li>Click <strong>Browse</strong> and select the first file to install. In this case, you can install <strong>db2jcc-9.5.jar</strong> first.</li><li>A set of values will be proposed by default, set the <strong>Group:</strong> to <strong>com.ibm.db2</strong>, leave the rest by default and click <strong>Install</strong>.</li><li>Repeat the previous two steps for <strong>db2jcc_license_cisuz-9.5.jar</strong>.</li></ol>


<p>With the drivers and license files installed, you can now create a new database connection pool.</p>

<h1 id="ConfiguringaDB2datasource-CreatingadatabaseconnectionpoolusingthewizardfromtheGeronimoAdministrationConsole">Creating a database connection pool using the wizard from the Geronimo Administration Console</h1>
<p>From the Geronimo Administration Console, select <strong>Database Pools</strong> and create a new pool by clicking <strong>Using the Geronimo database pool wizard</strong>.</p>

<ol><li>Enter the pool name <strong>DB2_ds</strong> and database type <strong>DB2(DataDirect)</strong> in the database pool wizard and then click <strong>Next</strong>. See illustration in the following figure.<br clear="none" class="atl-forced-newline">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="configuring-a-db2-datasource.data/databasePoolCreate.jpg"></span> <br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline"></li><li>Select <code>com/ibm/db2/db2jcc/9.5/jar</code> and <code>com.ibm/db2/db2jcc_license_cu/9.5/jar</code> for the <strong>Driver JAR</strong> from the list by pressing <strong>Ctrl</strong> on the keyboard. Then enter the remaining connection information as shown in the following figure. For this example, the default <strong>db2admin</strong> user name and password are used and a <strong>SAMPLE</strong> database is created via the DB2 Control Center. Set <code>localhost</code> as the <strong>Server Name</strong>. <br clear="none" class="atl-forced-newline">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="configuring-a-db2-datasource.data/DB2_2.jpg"></span> <br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline"></li><li>Click <strong>Deploy</strong>. You will have <strong>DB2_ds</strong> listed in the <strong>Database Pools</strong> portlet.<br clear="none" class="atl-forced-newline">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="configuring-a-db2-datasource.data/DB2_5.jpg"></span> <br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline"></li></ol>


<h1 id="ConfiguringaDB2datasource-Deployingadatabaseconnectionpoolusingthecommandline">Deploying a database connection pool using the command line</h1>
<p>As an alternative to the wizard, you can create a deployment plan manually and deploy it by using the command line based deployer tool. To use this option, create a <strong>db2-plan.xml</strong> file and copy the content of the following example to the file.</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>db2-plan.xml deployment plan</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;connector xmlns="http://geronimo.apache.org/xml/ns/j2ee/connector-1.2"&gt;
    &lt;dep:environment xmlns:dep="http://geronimo.apache.org/xml/ns/deployment-1.2"&gt;
        &lt;dep:moduleId&gt;
            &lt;dep:groupId&gt;console.dbpool&lt;/dep:groupId&gt;
            &lt;dep:artifactId&gt;DB2_ds&lt;/dep:artifactId&gt;
            &lt;dep:version&gt;1.0&lt;/dep:version&gt;
            &lt;dep:type&gt;car&lt;/dep:type&gt;
        &lt;/dep:moduleId&gt;
        &lt;dep:dependencies&gt;
            &lt;dep:dependency&gt;
                &lt;dep:groupId&gt;com.ibm.db2&lt;/dep:groupId&gt;
                &lt;dep:artifactId&gt;db2jcc&lt;/dep:artifactId&gt;
                &lt;dep:version&gt;9.5&lt;/dep:version&gt;
                &lt;dep:type&gt;jar&lt;/dep:type&gt;
            &lt;/dep:dependency&gt;
            &lt;dep:dependency&gt;
                &lt;dep:groupId&gt;com.ibm.db2&lt;/dep:groupId&gt;
                &lt;dep:artifactId&gt;db2jcc_license_cu&lt;/dep:artifactId&gt;
                &lt;dep:version&gt;9.5&lt;/dep:version&gt;
                &lt;dep:type&gt;jar&lt;/dep:type&gt;
            &lt;/dep:dependency&gt;
        &lt;/dep:dependencies&gt;
    &lt;/dep:environment&gt;
    &lt;resourceadapter&gt;
        &lt;outbound-resourceadapter&gt;
            &lt;connection-definition&gt;
                &lt;connectionfactory-interface&gt;javax.sql.DataSource&lt;/connectionfactory-interface&gt;
                &lt;connectiondefinition-instance&gt;
                    &lt;name&gt;DB2_ds&lt;/name&gt;
                    &lt;config-property-setting name="TraceFile"/&gt;
                    &lt;config-property-setting name="UserName"&gt;db2admin&lt;/config-property-setting&gt;
                    &lt;config-property-setting name="DatabaseName"&gt;sample&lt;/config-property-setting&gt;
                    &lt;config-property-setting name="Password"&gt;db2admin&lt;/config-property-setting&gt;
                    &lt;config-property-setting name="ServerName"&gt;localhost&lt;/config-property-setting&gt;
                    &lt;connectionmanager&gt;
                        &lt;local-transaction/&gt;
                        &lt;single-pool&gt;
                            &lt;max-size&gt;10&lt;/max-size&gt;
                            &lt;min-size&gt;0&lt;/min-size&gt;
                            &lt;match-one/&gt;
                        &lt;/single-pool&gt;
                    &lt;/connectionmanager&gt;
                &lt;/connectiondefinition-instance&gt;
            &lt;/connection-definition&gt;
        &lt;/outbound-resourceadapter&gt;
    &lt;/resourceadapter&gt;
&lt;/connector&gt;
</pre>
</div></div>

<p>In the <strong><code>&lt;dep:environment&gt;</code></strong> section, you can find the <code>moduleId</code> that identifies the resource or component being deployed; in the Administration Console the <code>moduleId</code> is displayed in the <strong>Component Name</strong> column on the <strong>Database Pools</strong> portlet.</p>

<p>Right after the <code>moduleId</code> is the definition of the dependencies. In this particular case, you can find three <strong><code>&lt;dep:dependency&gt;</code></strong> blocks pertaining to the DB2 JDBC driver and the license jar. The last "big" block in this plan is the <strong><code>&lt;resourceadapter&gt;</code></strong> where the connection parameters such as driver, user and password, connection URL, and so on are defined.</p>

<h3 id="ConfiguringaDB2datasource-Deployingthedatasource">Deploying the datasource</h3>
<p>To the deploy the DB2 datasource you just created, run the following command from the &lt;geronimo_home&gt;\bin directory.</p>

<p><strong><code>deploy --user system --password manager deploy &lt;dep_plan_home&gt;\db2-plan.xml ..\repository\org\tranql\tranql-connector-db2-xa\1.4\tranql-connector-db2-xa-1.4.rar</code></strong></p>

<p>You will receive the following message:</p>

<div class="preformatted panel" style="border-style: solid;border-width: 1px;"><div class="preformattedContent panelContent">
<pre>D:\geronimo-tomcat6-jee5-2.2\bin&gt;deploy --user system --password manager deploy \tmp\db2-plan.xml ..\repository\org\tranql\tranql-connector-db2-xa\1.4\tranql-connector-db2-xa-1.4.rar
Using GERONIMO_BASE:   D:\geronimo-tomcat6-jee5-2.2
Using GERONIMO_HOME:   D:\geronimo-tomcat6-jee5-2.2
Using GERONIMO_TMPDIR: D:\geronimo-tomcat6-jee5-2.2\var\temp
Using JRE_HOME:        C:\Java\jdk1.6.0\jre
    Deployed console.dbpool/DB2_ds/1.0/car
</pre>
</div></div>

<p><a shape="rect" href="configuring-a-db2-datasource.html">Back to Top</a></p></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Configuring a DB2 datasource';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
