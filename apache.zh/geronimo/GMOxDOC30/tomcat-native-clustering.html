<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=0">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="Tomcat Native Clustering">
    <meta name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Tomcat Native Clustering">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2010-05-11">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>

  <link href="asset?aid=1" rel="stylesheet" type="text/css">
  <link href="asset?aid=2" rel="stylesheet" type="text/css">
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shCore.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushJava.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushXml.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushPlain.js' type='text/javascript'></script>
  
  <script type="text/javascript">
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
  </script>

    <title>Apache Geronimo v3.0文档：Tomcat本机集群</title>
  </head>

  <body  onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">Home</a> > <a href="documentation.html">文档</a> > <a href="configuring-and-administering.html">配置和管理</a> > <a href="configuring-and-administering-the-apache-geronimo-server.html">配置和管理Apache Geronimo Server</a> > <a href="clustering-and-farming.html">集群和</a> <a href="configuring-and-administering-the-apache-geronimo-server.html">服务器场</a> > <a href="tomcat-native-clustering.html">Tomcat本机集群</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo v3.0</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">Tomcat本机集群</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645454"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645454">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645454"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645454">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645454"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645454">新增新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent">

<p>Tomcat Web容器提供了本机集群解决方案，可以通过使用Geronimo中的gbean定义来配置它<code>config.xml</code>或使用<code>server.xml</code>从v2.2开始，就像对独立的Tomcat服务器所做的一样。本文档将介绍可用的GBean，以及如何配置它们以便在具有tomcat Web容器的Geronimo服务器中进行集群。</p>

<style type="text/css">/*<![CDATA[*/
div.rbtoc1572612986319 {padding: 0px;}
div.rbtoc1572612986319 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1572612986319 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class="toc-macro rbtoc1572612986319">
<ul class="toc-indentation"><li><a shape="rect" href="#TomcatNativeClustering-ClusterConfigurationElements">集群配置元素</a></li><li><a shape="rect" href="#TomcatNativeClustering-Settingupaclusteringenvironment">设置集群环境</a>
<ul class="toc-indentation"><li><a shape="rect" href="#TomcatNativeClustering-Planningyourcluster">规划集群</a></li><li><a shape="rect" href="#TomcatNativeClustering-PreparingyourWebapplication">准备您的Web应用程序</a>
<ul class="toc-indentation"><li><a shape="rect" href="#TomcatNativeClustering-Enablingsessionaffinity">启用会话关联</a></li></ul>
</li><li><a shape="rect" href="#TomcatNativeClustering-Engagingloadbalancingandfailover">进行负载平衡和故障转移</a></li></ul>
</li><li><a shape="rect" href="#TomcatNativeClustering-Configuringtheclusteratapplicationlevel">在应用程序级别配置集群</a>
<ul class="toc-indentation"><li><a shape="rect" href="#TomcatNativeClustering-SampleTomcatclusteringwithmulticastConfiguration">具有多播配置的示例Tomcat集群</a></li><li><a shape="rect" href="#TomcatNativeClustering-SampleTomcatclusteringwithunicastconfiguration">具有单播配置的示例Tomcat集群</a></li></ul>
</li><li><a shape="rect" href="#TomcatNativeClustering-ConfiguringtheclusteratEngineorHostlevel">在引擎或主机级别配置集群</a>
<ul class="toc-indentation"><li><a shape="rect" href="#TomcatNativeClustering-Samplemulticastconfigurationcode">样本多播配置代码</a></li><li><a shape="rect" href="#TomcatNativeClustering-Sampleunicastconfigurationcode">示例单播配置代码</a></li></ul>
</li></ul>
</div>

<h1 id="TomcatNativeClustering-ClusterConfigurationElements">集群配置元素</h1>

<p>以下是您需要为Tomcat本机集群配置的参数或属性。</p>

<ul><li>簇<ul><li>集群监听链</li><li>雄猫阀门链</li><li>渠道<ul><li>会员资格</li><li>接收者</li><li>发件人</li><li>通道拦截器<ul><li>静态成员</li></ul>
			</li></ul>
		</li><li>集群管理器</li></ul>
	</li></ul>


<p>尽管对于许多应用程序来说已经足够了，但是Tomcat集群有一些限制：</p>
<ul><li>此功能不复制有状态会话Enterprise JavaBean（EJB）。不要在分布式应用程序中使用有状态会话EJB。</li><li>此功能不会将动态更新复制到Java命名和目录接口（JNDI）。您将必须配置群集的每个节点中的分布式应用程序使用的所有JNDI名称。</li><li>此功能不会将可分发的Web应用程序复制到群集中的其他节点。您将必须将可分发的Web应用程序部署到每个节点。</li></ul>


<p>考虑使用群集配置来提高Web应用程序的可伸缩性和可用性。以下各节提供有关如何设置群集节点的详细说明。</p>


<h1 id="TomcatNativeClustering-Settingupaclusteringenvironment">设置集群环境</h1>
<p>要设置小型集群，至少需要2个节点和1个HTTP服务器。HTTP服务器用于处理来自客户端的请求，并确保不同节点之间的流量负载均衡。同样，每个节点都配置为使用相同的逻辑Tomcat引擎并启用会话亲缘关系。</p>

<h2 id="TomcatNativeClustering-Planningyourcluster">规划集群</h2>

<p>Tomcat群集通过内存到内存的多播通信复制HTTP会话数据。</p>

<p>每个节点都将其会话数据传输到群集中的每个其他节点。该算法仅在簇很小时才有效。如果群集太大，则存储利用率和网络流量的开销将变得过多。为了避免过多的开销，请考虑将节点分成几个较小的群集。</p>

<p>通过使用多播广播，可以在群集中的节点之间复制HTTP会话数据。群集中的所有节点必须位于同一物理子网上，并且该子网上必须支持多播广播。</p>

<h2 id="TomcatNativeClustering-PreparingyourWebapplication">准备您的Web应用程序</h2>

<p>要参与集群配置，您的Web应用程序必须正确实现。</p>
<ul><li>确保放置在HTTP会话中的每个对象都实现java.io。可序列化。群集功能在将对象分发到群集中的其他节点时将其序列化。</li><li>Web应用程序的部署描述符，即<code>web.xml</code> Web存档中的文件，必须指示您的Web应用程序是可分发的。为此，请将可<strong>分发</strong>元素插入部署描述符中。
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>来自web.xml的摘录</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;!DOCTYPE web-app
    PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
    "http://java.sun.com/dtd/web-app_2_3.dtd"&gt;

&lt;web-app&gt;
    &lt;display-name&gt; ... &lt;/display-name&gt;
    &lt;description&gt; ... &lt;/description&gt;
    &lt;distributable&gt; &lt;distributable/&gt;
  ...
&lt;/web-app&gt;
</pre>
</div></div></li><li>不要使用有状态会话Enterprise JavaBean（EJB）。集群功能不会在集群中的节点之间复制有状态的EJB。</li><li>如果您的Web应用程序使用数据库，则集群中的每个节点都可以访问该数据库。确保在每个节点上都安装了JDBC驱动程序，并且在每个节点上都正确定义了数据源对象。</li><li>不要依赖于Java命名和目录接口（JNDI）的动态更新。您需要在集群的每个节点中配置应用程序使用的所有JNDI名称。群集功能不会在群集中的节点之间复制JNDI更改。</li></ul>


<h3 id="TomcatNativeClustering-Enablingsessionaffinity">启用会话关联</h3>

<p>对<em>会话亲缘关系的</em>支持（也称为<em>粘性会话</em>支持）允许负载平衡服务将HTTP请求路由回创建与该请求关联的HTTP会话的同一节点，直到该节点发生故障。如果配置会话复制的异步类型，则必须使用会话关联。对于异步复制，将在复制HTTP会话之前返回答复，并且使用该会话的下一个请求可能在复制完成之前到达。在这种情况下，将请求路由到发送对最后一个请求的答复并发起复制的节点，以确保使用正确的会话数据处理该请求。</p>

<p>在Geronimo服务器中，用户可以具有与Tomcat Web容器相同的体验来配置会话关联。要启用会话关联，您必须修改<code>servel.xml</code>在下面<code><GERONIMO_HOME>/var/catalina</code>目录并配置<strong><engine></engine></strong>其<strong>jvmRoute</strong>属性值对于集群中的每个节点都是唯一的。负载平衡器将在会话cookie或返回到浏览器的编码URL中返回此值。当相关请求到达时，它可以使用该值将请求路由到正确的节点。请参见以下示例：</p>

<ol><li>对于集群中的每个节点，更新<code>server.xml</code>服务器停止后，如下所示：<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>摘录自server.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
 ...
 &lt;Engine name="Catalina" defaultHost="${ServerHostname}" jvmRoute="nodeId"&gt;
 ...
</pre>
</div></div>哪里<ul><li><em>nodeId</em>是一个节点标识符，在集群中的所有节点中都是唯一的。如果您使用的是mod_jk，请确保jvmRoute属性值与您在其中的工作程序名称匹配<code>workers.properties</code> 。</li></ul>
	</li><li>重新启动服务器以启用新配置。</li></ol>


<h2 id="TomcatNativeClustering-Engagingloadbalancingandfailover">进行负载平衡和故障转移</h2>

<p>最初，服务器配置包括适用于与负载平衡服务交换消息的<em>AJP连接器</em> 。有关HTTP服务器配置的更多信息，请参阅<a shape="rect" href="configuring-a-remote-apache-http-server.html">配置远程Apache HTTP服务器</a> 。</p>


<h1 id="TomcatNativeClustering-Configuringtheclusteratapplicationlevel">在应用程序级别配置集群</h1>

<p>要配置应用程序级集群，必须在部署计划中输入所有相关的GBean设置，以确保成功复制HTTP会话。此外，必须在部署计划中使用gbean定义来配置Tomcat Web容器的集群配置元素。如果要将Web应用程序部署到群集，请将WAR文件安装到适当的群集成员，以确保对每个成员使用正确的部署计划。</p>

<h2 id="TomcatNativeClustering-SampleTomcatclusteringwithmulticastConfiguration">具有多播配置的示例Tomcat集群</h2>
<p>Web应用程序部署计划的模板如下所示。有关参数的更多信息，请参见<a shape="rect" href="creating-deployment-plans-for-web-applications.html">为Web应用程序创建部署计划</a> 。</p>
<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>geronimo-web.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;web-app xmlns="http://geronimo.apache.org/xml/ns/j2ee/web/tomcat-1.2"
         xmlns:dep="http://geronimo.apache.org/xml/ns/deployment-1.2"&gt;

    &lt;dep:environment&gt;
      &lt;dep:moduleId&gt;
        &lt;dep:groupId&gt;org.mygroup&lt;/dep:groupId&gt;
        &lt;dep:artifactId&gt;web-cluster-server1&lt;/dep:artifactId&gt;
        &lt;dep:version&gt;2.2&lt;/dep:version&gt;
        &lt;dep:type&gt;war&lt;/dep:type&gt;
      &lt;/dep:moduleId&gt;
      &lt;dep:dependencies&gt;
      	&lt;dep:dependency&gt;
      	&lt;dep:groupId&gt;console.realm&lt;/dep:groupId&gt;
        &lt;dep:artifactId&gt;geronimo-properties-realm&lt;/dep:artifactId&gt;
        &lt;dep:version&gt;1.0&lt;/dep:version&gt;
        &lt;dep:type&gt;car&lt;/dep:type&gt;
        &lt;/dep:dependency&gt;
      &lt;/dep:dependencies&gt;
      &lt;dep:hidden-classes/&gt;
      &lt;dep:non-overridable-classes/&gt;
    &lt;/dep:environment&gt;

    &lt;context-root&gt;/servlet-examples-cluster&lt;/context-root&gt;

    &lt;security-realm-name&gt;geronimo-properties-realm&lt;/security-realm-name&gt;
    &lt;security&gt;
      &lt;default-principal&gt;
        &lt;principal name="anonymous" class="org.apache.geronimo.security.realm.providers.GeronimoUserPrincipal"/&gt;
      &lt;/default-principal&gt;
      &lt;role-mappings&gt;
        &lt;role role-name="tomcat"&gt;
          &lt;principal name="admin" class="org.apache.geronimo.security.realm.providers.GeronimoGroupPrincipal"/&gt;
        &lt;/role&gt;
      &lt;/role-mappings&gt;
    &lt;/security&gt;

    &lt;cluster&gt;TomcatCluster&lt;/cluster&gt;
    &lt;gbean class="org.apache.geronimo.tomcat.cluster.CatalinaClusterGBean" name="TomcatCluster"&gt;
        &lt;attribute name="className"&gt;org.apache.catalina.ha.tcp.SimpleTcpCluster&lt;/attribute&gt;
        &lt;attribute name="initParams"/&gt;
        &lt;reference name="ClusterManager"&gt;          
            &lt;name&gt;TomcatClusterManager&lt;/name&gt;                
        &lt;/reference&gt;
        &lt;reference name="TomcatValveChain"&gt;
            &lt;name&gt;ReplicationValve&lt;/name&gt;
        &lt;/reference&gt;
        &lt;reference name="ClusterListenerChain"&gt;
            &lt;name&gt;ClusterSessionListener&lt;/name&gt;
        &lt;/reference&gt;
        &lt;reference name="Channel"&gt;
            &lt;name&gt;TomcatGroupChannel&lt;/name&gt;
        &lt;/reference&gt;
    &lt;/gbean&gt;
  &lt;!-- Cluster Manager --&gt;
    &lt;gbean name="TomcatClusterManager" class="org.apache.geronimo.tomcat.cluster.ClusterManagerGBean"&gt;
        &lt;attribute name="className"&gt;org.apache.catalina.ha.session.DeltaManager&lt;/attribute&gt;
        &lt;attribute name="initParams"&gt;name=${clusterName}
           channelSendOptions=6
           expireSessionsOnShutdown=false
           notifyListenersOnReplication=true
           mapSendOptions=6&lt;/attribute&gt;
    &lt;/gbean&gt;
  &lt;!-- Cluster Channel --&gt;
    &lt;gbean class="org.apache.geronimo.tomcat.cluster.ChannelGBean" name="TomcatGroupChannel"&gt;
        &lt;attribute name="className"&gt;org.apache.catalina.tribes.group.GroupChannel&lt;/attribute&gt;
        &lt;attribute name="initParams"/&gt;
        &lt;reference name="Membership"&gt;
            &lt;name&gt;TomcatMembership&lt;/name&gt;
        &lt;/reference&gt;
        &lt;reference name="Receiver"&gt;
            &lt;name&gt;TomcatReceiver&lt;/name&gt;
        &lt;/reference&gt;
        &lt;reference name="Sender"&gt;
            &lt;name&gt;TomcatSender&lt;/name&gt;
        &lt;/reference&gt;
        &lt;reference name="ChannelInterceptor"&gt;
            &lt;name&gt;TomcatChannelInterceptor&lt;/name&gt;
        &lt;/reference&gt;
    &lt;/gbean&gt;
  &lt;!-- Cluster Membership --&gt;
    &lt;gbean class="org.apache.geronimo.tomcat.cluster.MembershipServiceGBean" name="TomcatMembership"&gt;
        &lt;attribute name="className"&gt;org.apache.catalina.tribes.membership.McastService&lt;/attribute&gt;
        &lt;attribute name="initParams"&gt;
            mcastAddr=228.0.0.4
            mcastPort=45564
            mcastFrequency=500
            mcastDropTime=3000
        &lt;/attribute&gt;
    &lt;/gbean&gt;
  &lt;!-- Cluster Receiver --&gt;
    &lt;gbean class="org.apache.geronimo.tomcat.cluster.ReceiverGBean" name="TomcatReceiver"&gt;
        &lt;attribute name="className"&gt;org.apache.catalina.tribes.transport.nio.NioReceiver&lt;/attribute&gt;
        &lt;attribute name="initParams"&gt;
            tcpListenAddress=auto
            tcpListenPort=4001
            tcpSelectorTimeout=100
            tcpThreadCount=6
        &lt;/attribute&gt;
    &lt;/gbean&gt;
  &lt;!-- Cluster Sender --&gt;
    &lt;gbean class="org.apache.geronimo.tomcat.cluster.SenderGBean" name="TomcatSender"&gt;
        &lt;attribute name="className"&gt;org.apache.catalina.tribes.transport.ReplicationTransmitter&lt;/attribute&gt;
        &lt;attribute name="initParams"&gt;
            replicationMode=pooled
            waitForAck=true
        &lt;/attribute&gt;
    &lt;/gbean&gt;
  &lt;!-- Cluster Valves--&gt;
    &lt;gbean class="org.apache.geronimo.tomcat.ValveGBean" name="ReplicationValve"&gt;
        &lt;attribute name="className"&gt;org.apache.catalina.ha.tcp.ReplicationValve&lt;/attribute&gt;
        &lt;attribute name="initParams"&gt;filter=.*\.gif;.*\.js;.*\.css;.*\.png;.*\.jpeg;.*\.jpg;.*\.htm;.*\.html;.*\.txt;&lt;/attribute&gt;
        &lt;reference name="NextValve"&gt;
        	&lt;name&gt;JvmRouteBinderValve&lt;/name&gt;
        &lt;/reference&gt;
    &lt;/gbean&gt;
  &lt;!-- Cluster Route Binder --&gt;
    &lt;gbean class="org.apache.geronimo.tomcat.ValveGBean" name="JvmRouteBinderValve"&gt;
        &lt;attribute name="className"&gt;org.apache.catalina.ha.session.JvmRouteBinderValve&lt;/attribute&gt;
        &lt;attribute name="initParams"&gt;enabled=true&lt;/attribute&gt;
    &lt;/gbean&gt;
  &lt;!-- Cluster Listener --&gt;
    &lt;gbean class="org.apache.geronimo.tomcat.cluster.ClusterListenerGBean" name="ClusterSessionListener"&gt;
        &lt;attribute name="className"&gt;org.apache.catalina.ha.session.ClusterSessionListener&lt;/attribute&gt;
        &lt;reference name="NextListener"&gt;
            &lt;name&gt;JvmRouteSessionIDBinderListener&lt;/name&gt;
        &lt;/reference&gt;
    &lt;/gbean&gt;
  &lt;!-- Cluster Binder Listener--&gt;
    &lt;gbean class="org.apache.geronimo.tomcat.cluster.ClusterListenerGBean" name="JvmRouteSessionIDBinderListener"&gt;
        &lt;attribute name="className"&gt;org.apache.catalina.ha.session.JvmRouteSessionIDBinderListener&lt;/attribute&gt;
    &lt;/gbean&gt;
  &lt;!-- Cluster Channel Interceptor --&gt;
    &lt;gbean class="org.apache.geronimo.tomcat.cluster.ChannelInterceptorGBean" name="TomcatChannelInterceptor"&gt;
        &lt;attribute name="className"&gt;org.apache.catalina.tribes.group.interceptors.TcpFailureDetector&lt;/attribute&gt;
    &lt;/gbean&gt;
&lt;/web-app&gt;
</pre>
</div></div>
<p>哪里</p>
<ul><li><em>web-cluster-server1</em>应该与WAR文件名匹配。对于群集中的每个节点，它可以不同。</li></ul>


<p>在每个节点上，按照以下语法，通过使用管理控制台或<strong>deploy</strong>命令来部署Web应用程序：</p>
<div class="panel" style="border-style:solid;border-width:1px"><div class="panelContent">
<p><code>deploy --user <em>name</em> --password <em>word</em> deploy <em>archive</em> <em>plan</em></code></p>
</div></div>
<p>哪里</p>
<ul><li><em>名称</em>被授权为管理服务器的用户名替换。如果忽略此选项，将提示您输入用户名。</li><li><em>word</em>替换为用于验证用户身份的密码。如果忽略此选项，将提示您输入密码。</li><li><em>归档文件</em>已替换为Web应用程序WAR文件的文件规范。</li><li><em>计划</em>已替换为部署计划的文件规范。</li></ul>


<p>注意：安装服务器后，默认用户名为<strong>system</strong> ，默认密码为<strong>manager</strong> 。</p>

<h2 id="TomcatNativeClustering-SampleTomcatclusteringwithunicastconfiguration">具有单播配置的示例Tomcat集群</h2>

<p>以下代码段是使用单播配置的群集示例的一部分。静态成员是使用以下方式定义的<code>org.apache.geronimo.tomcat.cluster.StaticMemberGBean</code> 。您必须在部署计划中定义每个静态成员，以确保应用程序成功集群，并确保在每个节点上一致地定义了用于会话复制的TCP端口。</p>

<div class="code panel pdl" style="border-style:solid;border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px;border-bottom-style:solid"><b>摘录自geronimo-web.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
...
    &lt;cluster&gt;TomcatCluster&lt;/cluster&gt;
        &lt;gbean name="TomcatCluster" class="org.apache.geronimo.tomcat.cluster.CatalinaClusterGBean"&gt;
            &lt;attribute name="className"&gt;org.apache.catalina.ha.tcp.SimpleTcpCluster&lt;/attribute&gt;
            &lt;attribute name="initParams"/&gt;
            &lt;reference name="ClusterListenerChain"&gt; 
                    &lt;name&gt;TomcatClusterListenerChain&lt;/name&gt;
            &lt;/reference&gt;
            &lt;reference name="TomcatValveChain"&gt;
                    &lt;name&gt;ReplicationValve&lt;/name&gt;  
            &lt;/reference&gt;
            &lt;reference name="Channel"&gt;
                    &lt;name&gt;TomcatChannel&lt;/name&gt;
            &lt;/reference&gt;
            &lt;reference name="ClusterManager"&gt; 
                    &lt;name&gt;TomcatClusterManager&lt;/name&gt;
            &lt;/reference&gt;
        &lt;/gbean&gt;

        &lt;gbean name="TomcatClusterListenerChain" class="org.apache.geronimo.tomcat.cluster.ClusterListenerGBean"&gt;
            &lt;attribute name="className"&gt;org.apache.catalina.ha.session.ClusterSessionListener&lt;/attribute&gt;
            &lt;attribute name="initParams"/&gt;
        &lt;/gbean&gt;

        &lt;gbean name="ReplicationValve" class="org.apache.geronimo.tomcat.ValveGBean"&gt;
            &lt;attribute name="className"&gt;org.apache.catalina.ha.tcp.ReplicationValve&lt;/attribute&gt;
            &lt;attribute name="initParams"&gt;.*\.gif;.*\.js;.*\.jpg;.*\.png;.*\.htm;.*\.html;.*\.css;.*\.txt;&lt;/attribute&gt;
            &lt;reference name="NextValve"&gt;
        			&lt;type&gt;TomcatValve&lt;/type&gt;
            	                &lt;name&gt;JvmRouteBinderValve&lt;/name&gt;
            &lt;/reference&gt;
        &lt;/gbean&gt;

        &lt;gbean name="JvmRouteBinderValve" class="org.apache.geronimo.tomcat.ValveGBean"&gt;
            &lt;attribute name="className"&gt;org.apache.catalina.ha.session.JvmRouteBinderValve&lt;/attribute&gt;
            &lt;attribute name="initParams"&gt;enabled=true&lt;/attribute&gt;
        &lt;/gbean&gt;

        &lt;gbean name="TomcatClusterManager" class="org.apache.geronimo.tomcat.cluster.ClusterManagerGBean"&gt;
            &lt;attribute name="className"&gt;org.apache.catalina.ha.session.DeltaManager&lt;/attribute&gt;
            &lt;attribute name="initParams"&gt;name=${clusterName}
                                         channelSendOptions=6
                                         expireSessionsOnShutdown=false
                                         notifyListenersOnReplication=true
                                         mapSendOptions=6
            &lt;/attribute&gt;
        &lt;/gbean&gt;

        &lt;gbean name="TomcatChannel" class="org.apache.geronimo.tomcat.cluster.ChannelGBean"&gt;
            &lt;attribute name="className"&gt;org.apache.catalina.tribes.group.GroupChannel&lt;/attribute&gt;
            &lt;attribute name="initParams"/&gt;
            &lt;reference name="Membership"&gt; 
                    &lt;name&gt;ClusterMembership&lt;/name&gt;
            &lt;/reference&gt;
            &lt;reference name="Receiver"&gt;
                    &lt;name&gt;ClusterReceiver&lt;/name&gt;                
            &lt;/reference&gt;
            &lt;reference name="Sender"&gt;                
                    &lt;name&gt;ClusterSender&lt;/name&gt;
            &lt;/reference&gt;
            &lt;reference name="ChannelInterceptor"&gt;
                    &lt;name&gt;DisableMcastInterceptor&lt;/name&gt;                
            &lt;/reference&gt;
        &lt;/gbean&gt;

        &lt;gbean name="ClusterMembership" class="org.apache.geronimo.tomcat.cluster.MembershipServiceGBean"&gt;
            &lt;attribute name="className"&gt;org.apache.catalina.tribes.membership.McastService&lt;/attribute&gt;
            &lt;attribute name="initParams"&gt;address=228.0.0.4
                                         port=45564
                                         frequency=500
                                         dropTime=3000
            &lt;/attribute&gt;
        &lt;/gbean&gt;

        &lt;gbean name="ClusterReceiver" class="org.apache.geronimo.tomcat.cluster.ReceiverGBean"&gt;
            &lt;attribute name="className"&gt;org.apache.catalina.tribes.transport.nio.NioReceiver&lt;/attribute&gt;
            &lt;attribute name="initParams"&gt;address=IPAddress1
                                         port=TCP_port1
                                         selectorTimeout=100
                                         maxThreads=6
            &lt;/attribute&gt;
        &lt;/gbean&gt;

        &lt;gbean name="ClusterSender" class="org.apache.geronimo.tomcat.cluster.SenderGBean"&gt;
            &lt;attribute name="className"&gt;org.apache.catalina.tribes.transport.ReplicationTransmitter&lt;/attribute&gt;
        &lt;/gbean&gt;

        &lt;gbean name="DisableMcastInterceptor" class="org.apache.geronimo.tomcat.cluster.ChannelInterceptorGBean"&gt;
            &lt;attribute name="className"&gt;org.apache.geronimo.tomcat.interceptor.DisableMcastInterceptor&lt;/attribute&gt;
            &lt;attribute name="initParams"/&gt;
            &lt;reference name="NextInterceptor"&gt;
                    &lt;name&gt;TcpPingInterceptor&lt;/name&gt;                
            &lt;/reference&gt;
        &lt;/gbean&gt;

        &lt;gbean name="TcpPingInterceptor" class="org.apache.geronimo.tomcat.cluster.ChannelInterceptorGBean"&gt;
            &lt;attribute name="className"&gt;org.apache.catalina.tribes.group.interceptors.TcpPingInterceptor&lt;/attribute&gt;
            &lt;attribute name="initParams"&gt;Interval=60&lt;/attribute&gt;
            &lt;reference name="NextInterceptor"&gt;
                    &lt;name&gt;TcpFailureDetector&lt;/name&gt;                
            &lt;/reference&gt;
        &lt;/gbean&gt;

        &lt;gbean name="TcpFailureDetector" class="org.apache.geronimo.tomcat.cluster.ChannelInterceptorGBean"&gt;
            &lt;attribute name="className"&gt;org.apache.catalina.tribes.group.interceptors.TcpFailureDetector&lt;/attribute&gt;
            &lt;attribute name="initParams"/&gt;
            &lt;reference name="NextInterceptor"&gt;                
                    &lt;name&gt;StaticMember1Interceptor&lt;/name&gt;                
            &lt;/reference&gt;
        &lt;/gbean&gt;

        &lt;gbean name="StaticMember1Interceptor" class="org.apache.geronimo.tomcat.cluster.ChannelInterceptorGBean"&gt;
            &lt;attribute name="className"&gt;org.apache.catalina.tribes.group.interceptors.StaticMembershipInterceptor&lt;/attribute&gt;
            &lt;attribute name="initParams"/&gt;
            &lt;reference name="StaticMember"&gt;
                    &lt;name&gt;StaticMember2&lt;/name&gt;                
            &lt;/reference&gt;
            &lt;reference name="NextInterceptor"&gt;                
                    &lt;name&gt;MessageDispatch15Interceptor&lt;/name&gt; 
            &lt;/reference&gt;
        &lt;/gbean&gt;

        &lt;gbean name="MessageDispatch15Interceptor" class="org.apache.geronimo.tomcat.cluster.ChannelInterceptorGBean"&gt;
            &lt;attribute name="className"&gt;org.apache.catalina.tribes.group.interceptors.MessageDispatch15Interceptor&lt;/attribute&gt;
            &lt;attribute name="initParams"/&gt;
            &lt;reference name="NextInterceptor"&gt;
                    &lt;name&gt;ThroughputInterceptor&lt;/name&gt;                
            &lt;/reference&gt;
        &lt;/gbean&gt;

        &lt;gbean name="ThroughputInterceptor" class="org.apache.geronimo.tomcat.cluster.ChannelInterceptorGBean"&gt;
            &lt;attribute name="className"&gt;org.apache.catalina.tribes.group.interceptors.ThroughputInterceptor&lt;/attribute&gt;
            &lt;attribute name="initParams"/&gt;
        &lt;/gbean&gt;

        &lt;gbean name="StaticMember2" class="org.apache.geronimo.tomcat.cluster.StaticMemberGBean"&gt;
            &lt;attribute name="className"&gt;org.apache.catalina.tribes.membership.StaticMember&lt;/attribute&gt;
            &lt;attribute name="initParams"&gt;port=TCP_port2
                                         securePort=-1
                                         host=IPAddress2
                                         domain=test-domain
                                         UniqueId={2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}
            &lt;/attribute&gt;
        &lt;/gbean&gt;
...
</pre>
</div></div>

<p>哪里</p>
<ul><li><em>IPAddress1</em>是当前静态成员的IP地址或主机名。</li><li><em>TCP_port1</em>是当前节点上的TCP端口，用于侦听来自其他静态成员的会话复制数据。</li><li><em>IPAddress2</em>是第二个静态成员的IP地址或主机名。</li><li><em>TCP_port2</em>是第二个静态成员上的TCP端口，用于侦听其他静态成员的会话复制数据</li></ul>


<p>要将本示例转换为多播配置，请删除DisableMCastInterceptor，StaticMemberInterceptor和StaticMember定义。另外，将TomcatReceiver定义的“地址”属性的值更改为“自动”。</p>

<h1 id="TomcatNativeClustering-ConfiguringtheclusteratEngineorHostlevel">在引擎或主机级别配置集群</h1>
<p>您可以像配置独立的Tomcat Web容器一样配置集群。将所有集群配置输入到<code>var/catalina/server.xml</code>文件根据您在Geronimo中的要求。多播和unicat均受支持。当您要配置引擎或主机级别的群集时，请参阅以下示例代码。确保将这些段括在<strong><engine></engine></strong>要么<strong><host></host></strong>元素在<code>server.xml</code> 。 <em>$ {clusterName}</em>来自<code>var/config/config-substitutions.properties</code> ，在集群中的所有节点内应该相同。</p>

<p>可以在<a shape="rect" class="external-link" href="http://tomcat.apache.org/tomcat-6.0-doc/cluster-howto.html" title="Tomcat6集群">Tomcat6集群</a>的tomcat文档中找到有关集群每个组件和配置选项的详细信息。</p>

<h2 id="TomcatNativeClustering-Samplemulticastconfigurationcode">样本多播配置代码</h2>
<div class="code panel pdl" style="border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px"><b>server.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
...
     &lt;Cluster className="org.apache.catalina.ha.tcp.SimpleTcpCluster" channelSendOptions="8"&gt;
                    &lt;Manager className="org.apache.catalina.ha.session.DeltaManager" expireSessionsOnShutdown="false" notifyListenersOnReplication="true" name="${clusterName}" channelSendOptions="6" mapSendOptions="6"/&gt;
                    &lt;Channel className="org.apache.catalina.tribes.group.GroupChannel"&gt;
                        &lt;Membership className="org.apache.catalina.tribes.membership.McastService" address="228.0.0.4" port="45564" frequency="500" dropTime="3000" /&gt;
                        &lt;Receiver className="org.apache.catalina.tribes.transport.nio.NioReceiver" address="auto" port="4000" autoBind="100" selectorTimeout="5000" maxThreads="6" /&gt;
                        &lt;Sender className="org.apache.catalina.tribes.transport.ReplicationTransmitter"&gt;
                            &lt;Transport className="org.apache.catalina.tribes.transport.nio.PooledParallelSender" /&gt;
                        &lt;/Sender&gt;                        
                        &lt;Interceptor className="org.apache.catalina.tribes.group.interceptors.TcpFailureDetector" interval="60"/&gt;                        
                        
                        &lt;Interceptor className="org.apache.catalina.tribes.group.interceptors.MessageDispatch15Interceptor" /&gt;
                        &lt;Interceptor className="org.apache.catalina.tribes.group.interceptors.ThroughputInterceptor" /&gt;                        
                    &lt;/Channel&gt;
                    &lt;Valve className="org.apache.catalina.ha.tcp.ReplicationValve" filter=".*\.gif;.*\.js;.*\.jpg;.*\.png;.*\.htm;.*\.html;.*\.css;.*\.txt;" /&gt;
                    &lt;Valve className="org.apache.catalina.ha.session.JvmRouteBinderValve" /&gt;
                    &lt;ClusterListener className="org.apache.catalina.ha.session.JvmRouteSessionIDBinderListener" /&gt;
                    &lt;ClusterListener className="org.apache.catalina.ha.session.ClusterSessionListener" /&gt;
      &lt;/Cluster&gt;
...
</pre>
</div></div>

<h2 id="TomcatNativeClustering-Sampleunicastconfigurationcode">示例单播配置代码</h2>
<div class="code panel pdl" style="border-width:1px"><div class="codeHeader panelHeader pdl" style="border-bottom-width:1px"><b>server.xml</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
...
    &lt;Cluster className="org.apache.catalina.ha.tcp.SimpleTcpCluster" channelSendOptions="8"&gt;
                    &lt;Manager className="org.apache.catalina.ha.session.DeltaManager" expireSessionsOnShutdown="false" notifyListenersOnReplication="true" name="${clusterName}" channelSendOptions="6" mapSendOptions="6"/&gt;
                    &lt;Channel className="org.apache.catalina.tribes.group.GroupChannel"&gt;
                        &lt;Membership className="org.apache.catalina.tribes.membership.McastService" address="228.0.0.4" port="45564" frequency="500" dropTime="3000" /&gt;
                        &lt;Receiver className="org.apache.catalina.tribes.transport.nio.NioReceiver" address="auto" port="4000" autoBind="100" selectorTimeout="5000" maxThreads="6" /&gt;
                        &lt;Sender className="org.apache.catalina.tribes.transport.ReplicationTransmitter"&gt;
                            &lt;Transport className="org.apache.catalina.tribes.transport.nio.PooledParallelSender" /&gt;
                        &lt;/Sender&gt;
                        &lt;Interceptor className="org.apache.geronimo.tomcat.interceptor.DisableMcastInterceptor" /&gt;
                        &lt;Interceptor className="org.apache.catalina.tribes.group.interceptors.TcpFailureDetector" interval="60"/&gt;                        
                        &lt;Interceptor className="org.apache.catalina.tribes.group.interceptors.StaticMembershipInterceptor"&gt;
                            &lt;Member port="TCP_port" securePort="-1" host="IPAddress" domain="test-domain" UniqueId="{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}" /&gt;
                        &lt;/Interceptor&gt;
                        &lt;Interceptor className="org.apache.catalina.tribes.group.interceptors.MessageDispatch15Interceptor" /&gt;
                        &lt;Interceptor className="org.apache.catalina.tribes.group.interceptors.ThroughputInterceptor" /&gt;                        
                    &lt;/Channel&gt;
                    &lt;Valve className="org.apache.catalina.ha.tcp.ReplicationValve" filter=".*\.gif;.*\.js;.*\.jpg;.*\.png;.*\.htm;.*\.html;.*\.css;.*\.txt;" /&gt;
                    &lt;Valve className="org.apache.catalina.ha.session.JvmRouteBinderValve" /&gt;
                    &lt;ClusterListener className="org.apache.catalina.ha.session.JvmRouteSessionIDBinderListener" /&gt;
                    &lt;ClusterListener className="org.apache.catalina.ha.session.ClusterSessionListener" /&gt;
      &lt;/Cluster&gt;
...
</pre>
</div></div>

<p>哪里</p>
<ul><li><em>IPAddress</em>是第二个静态成员的IP地址或主机名。</li><li><em>TCP_port</em>是第二个静态成员上的TCP端口，用于侦听来自其他静态成员的会话复制数据。</li></ul></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Tomcat Native Clustering';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2013，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  

</body></html>