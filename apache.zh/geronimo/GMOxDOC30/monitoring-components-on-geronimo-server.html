<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Monitoring components on Geronimo Server" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Monitoring components on Geronimo Server" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0 Documentation: Monitoring components on Geronimo Server</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="configuring-and-administering.html">Configuring and administering</a>&nbsp;&gt;&nbsp;<a href="monitoring-the-health-of-the-apache-geronimo-server.html">Monitoring the health of the Apache Geronimo server</a>&nbsp;&gt;&nbsp;<a href="monitoring-components-on-geronimo-server.html">Monitoring components on Geronimo Server</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Monitoring components on Geronimo Server</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645348">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645348">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645348">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645348">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645348">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645348">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>

<p><rich-text-body><p>The Geronimo monitoring plug-in is broken down between server and client plug-ins, referred to as the 'Agent' and 'Console' respectively. When properly setup, these plug-ins provide both local and remote real-time JSR77 compliant statistic monitoring, as well as historical tracking of any exposed statistic with visual representations drawn in the form of graphs through the Dojo Toolkit's dojoX Charting packages.</p></rich-text-body></p>

<p><strong>Agent (Server)</strong>  The Agent plug-in can be deployed headless on an instance of Geronimo requiring no administrative console able to be polled by the console plug-in from any instance of Geronimo that can communicate with it. There are two flavors of the Agent plug-in available; the first allowing for EJB connections, and the second allowing for JMX connections between the Console and Agent.</p>

<p>While the EJB Agent is the default plug-in installed with the full JEE5 assembly of Geronimo, the JMX is recommended for those that otherwise would require no form of EJB in their assembly but still require monitoring ability.</p>

<p><strong>Console (Client)</strong> The console plug-in, which requires the Geronimo administrative console, can connect to multiple Agent plug-ins across multiple instances of Geronimo, allowing centralized monitoring of statistics on a multitude of machines. The same console is able to connect to either the EJB or the JMX flavor of the Agent plug-in, or even connect to both types on different instances of Geronimo.</p>

<h2 id="MonitoringcomponentsonGeronimoServer-WhatcanImonitor?">What can I monitor?</h2>

<p>From within the Agent plug-in in the administrative console, it is possible to define a connection to any instance of Geronimo that has the Monitoring Agent plug-in deployed. Furthermore, any MBean deployed on the Geronimo instance with the Monitoring Agent that provides statistics can be historically tracked, allowing for graph generation from any statistic element exactly as defined.</p>

<p>Standard behavior of the Monitoring Agent is to take snapshots of the JSR77 defined JVM statistics, as well as the web container statistics for the web container being used (either Jetty or Tomcat). Additional MBeans can be added, or these defaults can be easily removed through the Monitoring Console plug-in.</p>

<p>Currently available statistics:</p>
<ul><li>TransactionManager Statistics</li><li>JVM Statistics</li><li>AJP/Web/WebSSL Connector Statistics</li><li>ThreadPool Statistics</li><li>Web Application Statistics</li></ul>


<h2 id="MonitoringcomponentsonGeronimoServer-Whatistheimpactonperformance?">What is the impact on performance?</h2>

<p>Generally speaking, the more monitoring that is enabled, the greater impact on overall performance. Following this rule, the more MBeans being tracked by the monitoring plug-in on a given server, the greater the impact. It is generally good practice to limit enabled MBeans to only those that are necessary as opposed to having everything enabled.</p>

<p>Additionally, the monitoring plug-in is in a dormant state when not collecting snapshots. On a default deployment, it will only consume cycles once every 5 minutes.</p>

<h2 id="MonitoringcomponentsonGeronimoServer-Installation">Installation</h2>

<p>Both Agent(Server) and Console(Client) plug-ins are pre-installed on the full JEE distributions. If you are using a little-G distribution or customized server assembly and want to leverage Monitoring Plug-ins, you might need to read this section to learn how to install them. </p>

<p>There are two methods for installing the necessary Monitoring Plug-ins. The first (and easiest), is to log into the Geronimo administrative console for the instance of Geronimo onto which the plug-in(s) will be installed, and select 'Plugins' from the left navigation menu.</p>

<p>In the Plugins portlet:</p>
<ul><li>Click <strong>Update repository list</strong></li><li>Select a valid Geronimo repository from the list available</li><li>Click <strong>Show Plugins in selected repository</strong></li><li>To install the Monitoring Agent, select the appropriate plug-in from the list shown
	<ul><li>If the OpenEJB component is not already present on the assembly, it may be beneficial to use the JMX flavor of the Monitoring Agent</li></ul>
	</li><li>To install the Monitoring Console, select the plugin appropriate for the web container in use from the list shown</li><li>If the goal is to both view and record statistics from the same instance of Geronimo, both the Agent and Console plugins must be installed</li></ul>


<p>The second method is required if starting from a minimal assembly, or if the Geronimo administrative console is otherwise unavailable.</p>

<p>In terminal:</p>
<ul><li>Go to the Geronimo bin directory</li><li>Execute: <code>java -jar deployer.jar search-plugins</code></li><li>At the prompt, enter the appropriate number(s) for the desired plugins</li></ul>


<h2 id="MonitoringcomponentsonGeronimoServer-Customization">Customization</h2>

<p>One of the primary goals in developing the monitoring and management plugin was to allow an administrator to monitor any exposed component on any Geronimo server.</p>

<h3 id="MonitoringcomponentsonGeronimoServer-Datasources">Datasources</h3>

<p>The datasources used to communicate to the DB on the server and client side are all packaged into separate plugins. By default, the provided datasources are used to connect an Apache Derby database (the reason for this is because the default DB that Geronimo uses is also Derby). However, since these datasources are packaged as plugins, anyone is able to write their own datasource deployment descriptor, package it into a plugin, and use it instead of the one provided by default. Check the <a shape="rect" href="configuring-your-own-monitoring-plugin-datasource.html">Configuring your own Monitoring Plugin DataSource</a> section for further details.</p>

<h3 id="MonitoringcomponentsonGeronimoServer-Monitoring">Monitoring</h3>
<p>For monitoring the Web server performance the <strong>Monitoring</strong> portlet is available by selecting <strong>Monitoring</strong> on the <strong>Console Navigation</strong> menu on the left hand side. This feature will allow you to view a number of server statistics on the system JVM, web servers, and information via the AJP protocol. The graph information is provided by the data exposed by the connector MBean. You can use predefined graphs and views in Geronimo already. See <a shape="rect" href="monitoring-the-server-with-predefined-graphs-and-views.html">Monitoring the server with predefined graphs and views</a> for the details.</p>

<p>In this example, we attempt to determine if there is a correlation between the server JVM heap space and the web containers number of bytes downloaded. In other words, this monitoring session will show if the server is releasing heap memory after client downloads.</p>

<p>First, select the <strong>Monitoring</strong> link on the <strong>Console Navigation</strong> menu. If this is your first monitoring session, you should see an empty set of Servers, Views, and Graphs as shown in this figure.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="monitoring-components-on-geronimo-server.data/consoleMonitoringStart.png"></span></p>

<h4 id="MonitoringcomponentsonGeronimoServer-AddingaServer">Adding a Server</h4>
<p>Select a server to monitor by providing a host name or IP address. Select the protocol for communication and any security credentials. Save this server definition by pressing <strong>Save</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="monitoring-components-on-geronimo-server.data/consoleMonitoringServerAdd.png"></span></p>

<p>Fill in the fields, and click <strong>Add</strong>. For example:</p>
<ol><li>Name=GeronimoServer</li><li>IP/Hostname=localhost</li><li>Protocol=[default=EJB]</li><li>Port=[default=4201]</li><li>Username=system</li><li>Password=manager</li><li>Password(verify)=manager</li></ol>


<p>Note that if you change the default protocol from <strong>EJB</strong> to <strong>JMX</strong>, the default port will be 1099. You need to install agent-car-jmx plugin first.<br clear="none">
Alternatively, it is possible to test the connection using the information provided via the <strong>Test these settings</strong> link on the right navigation pane.</p>

<p>After a server is successfully added, the browser will be redirected to the main monitoring console page, again listing all <strong>Views</strong>, <strong>Servers</strong>, and <strong>Graphs</strong> configured on the console.</p>

<p>If configuring monitoring on a freshly deployed instance of the monitoring agent, you need to click the <strong>Enable Query</strong> link associated with the added server. This will enable snapshot collection on the default duration of 5 minutes.</p>


<h4 id="MonitoringcomponentsonGeronimoServer-AddingaGraph">Adding a Graph</h4>

<p>Select information to display by adding a graph. Select the server you are monitoring, and then choose an MBean that publishes server information by choosing an MBean from the MBean drop down control. Once you have selected an MBean, you can see what information is available by selecting data from the Data series drop down control. When you have described the data, save this graph by pressing <strong>Save</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="monitoring-components-on-geronimo-server.data/consoleMonitoringGraphAddJVM.png"></span></p>

<p>Select more information to display by adding a second graph. As the two data series scroll in time, we will be able to detect any correlation between the data. Once again, choose a server and an MBean to monitor. Select data from the Data series drop down control. Since data sent increases over time, also select <strong>delta</strong> for the Data series, so we see the rise and fall of the data over time. Save this graph by pressing <strong>Save</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="monitoring-components-on-geronimo-server.data/consoleMonitoringGraphAddBytes.png"></span></p>

<p>After the graph is added, the browser is redirected to the main monitoring console page, where selecting the name of the graph will open a window that displays the graph.</p>

<h4 id="MonitoringcomponentsonGeronimoServer-AddingaView">Adding a View</h4>
<p>Now group one or more graphs into a view. Here we add a view for "JVM vs Bytes Sent" by selecting two of the graphs we created in earlier steps. Save the view by pressing <strong>Save</strong>.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="monitoring-components-on-geronimo-server.data/consoleMonitoringViewAdd.png"></span></p>

<p>This figure shows the console monitoring portlet after we have added the server, graphs, and views.<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="monitoring-components-on-geronimo-server.data/consoleMonitoringReady.png"></span></p>

<h4 id="MonitoringcomponentsonGeronimoServer-TheMonitoringGraphView">The Monitoring Graph View</h4>
<p>Click on a view to start monitoring server information over time. This view shows the JVM heap and web server bytes sent over a one hour period. As you see in the example, the JVM heap memory goes up and down over time with little correlation to the number of bytes users request from the web server. <br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="monitoring-components-on-geronimo-server.data/consoleMonitoringView.png"></span></p></div>
        </div>

                  <div class="tabletitle">
            Children
            <span class="smalltext" id="show" style="display: inline;">
              <a href="javascript:showChildren()">Show Children</a></span>
            <span class="smalltext" id="hide" style="display: none;">
              <a href="javascript:hideChildren()">Hide Children</a></span>
          </div>
          <div class="greybox" id="children" style="display: none;">
                                      <a href="https://cwiki.apache.org/confluence/display/GMOxDOC30/Monitoring+the+server+with+predefined+graphs+and+views" title="Monitoring the server with predefined graphs and views">Monitoring the server with predefined graphs and views</a>
              <span class="smalltext">(Apache Geronimo v3.0)</span>
              <br>
                          <a href="https://cwiki.apache.org/confluence/display/GMOxDOC30/Configuring+your+own+Monitoring+Plugin+DataSource" title="Configuring your own Monitoring Plugin DataSource">Configuring your own Monitoring Plugin DataSource</a>
              <span class="smalltext">(Apache Geronimo v3.0)</span>
              <br>
                      </div>
              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Monitoring components on Geronimo Server';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
