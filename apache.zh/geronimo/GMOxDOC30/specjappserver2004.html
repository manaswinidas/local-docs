<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="SPECjAppServer2004" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi SPECjAppServer2004" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0 Documentation: SPECjAppServer2004</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="specjappserver2004.html">SPECjAppServer2004</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">SPECjAppServer2004</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645287">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645287">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645287">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645287">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645287">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645287">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>
<p><parameter ac:name="">top</parameter></p>
<h1 id="SPECjAppServer2004-RunningSPECjAppServer2004benchmarkonGeronimo">Running SPECjAppServer2004 benchmark on Geronimo</h1>

<h2 id="SPECjAppServer2004-Stillnotasuccess,yourhelpneeded!">Still not a success, your help needed!</h2>

<p><strong>This article shows how to measure the performance of the <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> application server using the industry standard <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> benchmark.</strong></p>

<rich-text-body><p>Issues still exist that prevent <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> from running on <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a>.</p>

<p>This article is not a success story, but a collection of notes on the progress that has been made in this direction.</p>

<p>Current issue that requires your help is: <a shape="rect" href="specjappserver2004.html">#Running the benchmark</a></p></rich-text-body>

<rich-text-body><p><strong>Disclaimer:</strong> This article is created to write down the existing experience and to make it reproducible. It is not targeted to be a comprehensive guide on either product or on merging them together. It's not also a replacement to the products' documentation, but just a step-by-step guide on how to make things work in a simple configuration, as it worked for me. Make sure you at least look through the documentation on both products before you proceed.</p></rich-text-body>

<rich-text-body><p><strong>SPECjAppServer</strong> is a trademark of the <strong>Standard Performance Evaluation Corp.</strong> (<a shape="rect" class="external-link" href="http://www.spec.org" rel="nofollow">SPEC</a>). The official web site for <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> is located at <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">http://www.spec.org/jAppServer2004/</a>.</p>

<p><strong>SPECjAppServer2004</strong> version <strong>1.08</strong> introduces a reduced workload called <strong>EAStress2004</strong> that relaxes run and reporting rules, enabling informal results to be shared more easily in open-source research and development projects.</p>

<p>The <strong>EAStress2004</strong> workload in <strong>SPECjAppServer2004 v1.08</strong> can be used as a tool to optimize performance of products under development and to share results in public forums.  Unlike <strong>SPECjAppServer2004</strong> results, testing results from the <strong>EAStress2004</strong> workload do not need to be reviewed by <strong>SPEC</strong> prior to being made public.</p>

<p>Results from the <strong>EAStress2004</strong> workload cannot be used for marketing purposes, and comparisons to other <strong>SPECjAppServer2004</strong> results are not permitted.</p>

<p>See full press release on <strong>SPECjAppServer2004/EAStress2004 v1.08</strong> here: <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/jAppServer2004v108.html" rel="nofollow">http://www.spec.org/jAppServer2004/jAppServer2004v108.html</a>.</p>

<p>All logs, stacks and result files in this article are extracted from <strong>EAStress2004 v1.08</strong> runs.</p></rich-text-body>

<p>This article is written for <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/jAppServer2004v108.html" rel="nofollow">v1.08</a> and <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> <a shape="rect" class="external-link" href="http://geronimo.apache.org/apache-geronimo-v21-release.html">v2.1</a>. For other versions some stages may be different. Older versions of this article for <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> v1.05 and older versions of <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> can be found here: <a shape="rect" class="external-link" href="http://cwiki.apache.org/confluence/display/GMOxDOC10/SPECjAppServer2004">v1.0</a>, <a shape="rect" class="external-link" href="http://cwiki.apache.org/confluence/display/GMOxDOC11/SPECjAppServer2004">v1.1</a>, <a shape="rect" class="external-link" href="http://cwiki.apache.org/confluence/display/GMOxDOC12/SPECjAppServer2004">v1.2</a>, <a shape="rect" class="external-link" href="http://cwiki.apache.org/confluence/display/GMOxDOC20/SPECjAppServer2004">v2.0.2</a>.</p>

<p>The described configuration uses as many <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> components as possible, including the built-in <a shape="rect" class="external-link" href="http://db.apache.org/derby/">Derby</a> database and the built-in <a shape="rect" class="external-link" href="http://jetty.mortbay.com" rel="nofollow">Jetty</a> or <a shape="rect" class="external-link" href="http://tomcat.apache.org">Tomcat</a> servlet container. In fact, the configuration only uses <a shape="rect" class="external-link" href="http://java.sun.com" rel="nofollow">Java</a>, <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a>, an external servlet container (e. g. <a shape="rect" class="external-link" href="http://tomcat.apache.org">Tomcat</a>) and <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a>. To plug external components (most probably, a database), you have to change your configuration accordingly.</p>

<p>This configuration also assumes that all the components (except, possibly, the <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> Driver and the <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> Supplier Emulator and its servlet container) are run on the same machine. If you want to run the Distributed workload, your configuration will be different.</p>

<p>This configuration uses the <a shape="rect" class="external-link" href="http://www.microsoft.com" rel="nofollow">Microsoft</a> <a shape="rect" class="external-link" href="http://www.microsoft.com/windows/products/windowsxp/" rel="nofollow">Windows XP Professional</a> <a shape="rect" class="external-link" href="http://www.microsoft.com/technet/prodtechnol/winxppro/maintain/winxpsp2.mspx" rel="nofollow">Service Pack 2</a> operating system, <a shape="rect" class="external-link" href="http://cygwin.com" rel="nofollow">Cygwin</a> shell, <a shape="rect" class="external-link" href="http://www.sun.com" rel="nofollow">Sun</a> <a shape="rect" class="external-link" href="http://java.sun.com" rel="nofollow">Java</a> <a shape="rect" class="external-link" href="http://java.sun.com/javase/" rel="nofollow">SE</a> <a shape="rect" class="external-link" href="http://java.sun.com/javase/downloads/index_jdk5.jsp" rel="nofollow">5.0</a> Update 11 and <a shape="rect" class="external-link" href="http://tomcat.apache.org">Tomcat</a> v5.0.30 to write this article. If you use another OS, Java or servlet container, some stages may be different.</p>

<p>This article uses forward slashes ( / ) for command lines, adjust to backslashes ( \ ) accordingly if you use <a shape="rect" class="external-link" href="http://www.microsoft.com/windows/" rel="nofollow">Windows</a> command prompt.</p>

<hr>

<p>This article has the following structure:</p>

<ul><li><a shape="rect" href="specjappserver2004.html">#General information</a>
	<ul><li><a shape="rect" href="specjappserver2004.html">#About Geronimo</a></li><li><a shape="rect" href="specjappserver2004.html">#About SPECjAppServer2004/EAStress2004</a></li></ul>
	</li><li><a shape="rect" href="specjappserver2004.html">#Obtaining products</a>
	<ul><li><a shape="rect" href="specjappserver2004.html">#Obtaining Geronimo</a></li><li><a shape="rect" href="specjappserver2004.html">#Obtaining SPECjAppServer2004</a></li></ul>
	</li><li><a shape="rect" href="specjappserver2004.html">#Conventions and environment</a>
	<ul><li><a shape="rect" href="specjappserver2004.html">#Hosts</a></li><li><a shape="rect" href="specjappserver2004.html">#Directories</a></li></ul>
	</li><li><a shape="rect" href="specjappserver2004.html">#Installing products</a>
	<ul><li><a shape="rect" href="specjappserver2004.html">#Installing Geronimo</a></li><li><a shape="rect" href="specjappserver2004.html">#Installing SPECjAppServer2004</a></li></ul>
	</li><li><a shape="rect" href="specjappserver2004.html">#Configuring Geronimo</a>
	<ul><li><a shape="rect" href="specjappserver2004.html">#Adjusting configuration</a></li><li><a shape="rect" href="specjappserver2004.html">#Starting Geronimo</a></li><li><a shape="rect" href="specjappserver2004.html">#Accessing the console</a></li><li><a shape="rect" href="specjappserver2004.html">#Creating the database</a></li><li><a shape="rect" href="specjappserver2004.html">#Locating the SQL files</a></li><li><a shape="rect" href="specjappserver2004.html">#Creating the tables</a></li></ul>
	</li><li><a shape="rect" href="specjappserver2004.html">#Configuring SPECjAppServer2004</a>
	<ul><li><a shape="rect" href="specjappserver2004.html">#Basic configuration</a></li><li><a shape="rect" href="specjappserver2004.html">#Building the application</a></li><li><a shape="rect" href="specjappserver2004.html">#Preparing database configuration</a></li><li><a shape="rect" href="specjappserver2004.html">#Loading the tables</a></li></ul>
	</li><li><a shape="rect" href="specjappserver2004.html">#Deploying components</a>
	<ul><li><a shape="rect" href="specjappserver2004.html">#Logging in</a></li><li><a shape="rect" href="specjappserver2004.html">#Deploying database connector</a></li><li><a shape="rect" href="specjappserver2004.html">#Deploying JMS connector</a></li><li><a shape="rect" href="specjappserver2004.html">#Deploying the main application</a></li><li><a shape="rect" href="specjappserver2004.html">#Verifying the deployment</a></li></ul>
	</li><li><a shape="rect" href="specjappserver2004.html">#Deploying the Supplier Emulator</a>
	<ul><li><a shape="rect" href="specjappserver2004.html">#Using the Geronimo servlet container</a></li><li><a shape="rect" href="specjappserver2004.html">#Using a stand-alone servlet container</a></li><li><a shape="rect" href="specjappserver2004.html">#Verifying the deployment</a></li></ul>
	</li><li><a shape="rect" href="specjappserver2004.html">#Running the benchmark</a></li><li><a shape="rect" href="specjappserver2004.html">#Processing results</a></li></ul>


<h1 id="SPECjAppServer2004-Generalinformation">General information</h1>

<h2 id="SPECjAppServer2004-AboutGeronimo">About Geronimo</h2>

<p><a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> is the <a shape="rect" class="external-link" href="http://www.apache.org">Apache Software Foundation</a> <a shape="rect" class="external-link" href="http://java.sun.com" rel="nofollow">Java</a> <a shape="rect" class="external-link" href="http://java.sun.com/javaee/" rel="nofollow">EE</a> 5 certified application server. It is developed under <a shape="rect" class="external-link" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License</a> and can be downloaded freely.</p>

<p>Apache site: <a shape="rect" class="external-link" href="http://apache.org">http://apache.org</a></p>

<p>Product site: <a shape="rect" class="external-link" href="http://geronimo.apache.org">http://geronimo.apache.org</a></p>

<p>Latest version, 2.1: <a shape="rect" class="external-link" href="http://geronimo.apache.org/apache-geronimo-v21-release.html">http://geronimo.apache.org/apache-geronimo-v21-release.html</a></p>

<p>Release notes: <a shape="rect" class="external-link" href="http://cwiki.apache.org/GMOxDOC22/release-notes-21txt.html">http://cwiki.apache.org/GMOxDOC22/release-notes-21txt.html</a></p>

<p>Documentation page: <a shape="rect" class="external-link" href="http://geronimo.apache.org/documentation.html">http://geronimo.apache.org/documentation.html</a></p>

<p>The best document available is <strong>"Apache Geronimo: J2EE Development and Deployment"</strong> book by <a shape="rect" class="external-link" href="mailto:ammulder@apache.org" rel="nofollow">Aaron Mulder</a>: <a shape="rect" class="external-link" href="http://chariotsolutions.com/geronimo/" rel="nofollow">http://chariotsolutions.com/geronimo/</a></p>

<p>Other important resources are FAQ: <a shape="rect" class="external-link" href="http://cwiki.apache.org/GMOxKB">http://cwiki.apache.org/GMOxKB</a> and Wiki: <a shape="rect" class="external-link" href="http://cwiki.apache.org/geronimo">http://cwiki.apache.org/geronimo</a></p>

<h2 id="SPECjAppServer2004-AboutSPECjAppServer2004/EAStress2004">About SPECjAppServer2004/EAStress2004</h2>

<p><a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> is a commercial benchmark for measuring the performance of <a shape="rect" class="external-link" href="http://java.sun.com" rel="nofollow">Java</a> <a shape="rect" class="external-link" href="http://java.sun.com/javaee/" rel="nofollow">EE</a> application servers.</p>

<p><a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/jAppServer2004v108.html" rel="nofollow">EAStress2004</a> is a reduced workload that is a part of <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/jAppServer2004v108.html" rel="nofollow">v1.08</a>, it relaxes run and reporting rules, enabling informal results to be shared more easily in open-source research and development projects.</p>

<p>SPEC site: <a shape="rect" class="external-link" href="http://www.spec.org" rel="nofollow">http://www.spec.org</a></p>

<p>Product site: <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">http://www.spec.org/jAppServer2004/</a></p>

<p>Press release on v1.08 and EAStress2004: <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/jAppServer2004v108.html" rel="nofollow">http://www.spec.org/jAppServer2004/jAppServer2004v108.html</a></p>

<p>FAQ: <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/docs/FAQ.html" rel="nofollow">http://www.spec.org/jAppServer2004/docs/FAQ.html</a></p>

<p>User's Guide: <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/docs/UserGuide.html" rel="nofollow">http://www.spec.org/jAppServer2004/docs/UserGuide.html</a></p>

<p>Run and Reporting Rules: <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/docs/RunRules.html" rel="nofollow">http://www.spec.org/jAppServer2004/docs/RunRules.html</a></p>

<p><a shape="rect" href="specjappserver2004.html">Back to Top</a></p>

<h1 id="SPECjAppServer2004-Obtainingproducts">Obtaining products</h1>

<h2 id="SPECjAppServer2004-ObtainingGeronimo">Obtaining Geronimo</h2>

<p>The latest <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> version for now is <a shape="rect" class="external-link" href="http://geronimo.apache.org/apache-geronimo-v21-release.html">2.1</a>.</p>

<p>General download page: <a shape="rect" class="external-link" href="http://geronimo.apache.org/downloads.html">http://geronimo.apache.org/downloads.html</a></p>

<p>Two builds of <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> exist, with <a shape="rect" class="external-link" href="http://jetty.mortbay.com" rel="nofollow">Jetty</a> or <a shape="rect" class="external-link" href="http://tomcat.apache.org">Tomcat</a> servlet container enabled by default. You can download either one at <a shape="rect" class="external-link" href="http://geronimo.apache.org/downloads.html">http://geronimo.apache.org/downloads.html</a>, they are around 80 MB in size each. This document was written primarily using <a shape="rect" class="external-link" href="http://jetty.mortbay.com" rel="nofollow">Jetty</a> version, but <a shape="rect" class="external-link" href="http://tomcat.apache.org">Tomcat</a> version works fine also.</p>

<h2 id="SPECjAppServer2004-ObtainingSPECjAppServer2004">Obtaining SPECjAppServer2004</h2>

<p><a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> costs $2000 ($250 for non-profit/educational purposes), you can order it online. See <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/docs/FAQ.html#Q10" rel="nofollow">FAQ</a> for details.</p>

<p>The latest version is <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/jAppServer2004v108.html" rel="nofollow">1.08</a>, coming as the <code>SPECjAppServer2004-Kit-v1.08.jar</code> file, 12 MB in size.</p>

<p><a shape="rect" href="specjappserver2004.html">Back to Top</a></p>

<h1 id="SPECjAppServer2004-Conventionsandenvironment">Conventions and environment</h1>

<p>This section contains important notions that mark the important hosts and directories.</p>

<h2 id="SPECjAppServer2004-Hosts">Hosts</h2>

<p>This article is written in terms of the following machines:</p>

<ul><li><code><strong>geronimo.host</strong></code> &#8211; the machine where <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> is run, with <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> deployed.</li></ul>


<ul><li><code><strong>emulator.host</strong></code> &#8211; the machine where the <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> Supplier Emulator is deployed.</li></ul>


<ul><li><code><strong>driver.host</strong></code> &#8211; the machine where the <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> Driver is run. If you use configuration with multiple Drivers, you have to repeat all the operations for this host on all Driver hosts.</li></ul>


<ul><li><code><strong>master.host</strong></code> &#8211; the main, Master <code><strong>driver.host</strong></code> in configurations with multiple Drivers.</li></ul>


<p>The <code><strong>emulator.host</strong></code> and the <code><strong>driver.host</strong></code> may be the same machine.</p>

<p>The <code><strong>geronimo.host</strong></code> and the <code><strong>emulator.host</strong></code> may be the same machine, moreover, the <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> Supplier Emulator may be deployed into a <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> built-in servlet container (<a shape="rect" class="external-link" href="http://jetty.mortbay.com" rel="nofollow">Jetty</a> or <a shape="rect" class="external-link" href="http://tomcat.apache.org">Tomcat</a>).</p>

<p>The <code><strong>geronimo.host</strong></code> and the <code><strong>driver.host</strong></code> may be the same machine, but you have to <a shape="rect" href="specjappserver2004.html">adjust</a> the <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> configuration, as both <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> and the <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> Driver create <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/guide/rmi/" rel="nofollow">RMI</a> Registry on the default port (1099) and would conflict on that.</p>

<rich-text-body><p>Sharing <code><strong>geronimo.host</strong></code> with <code><strong>emulator.host</strong></code> or <code><strong>driver.host</strong></code> is contradicting with the <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> documentation and would impact the performance severely and invalidate the benchmark results. However technically this is possible.</p></rich-text-body>

<h2 id="SPECjAppServer2004-Directories">Directories</h2>

<p>This section lists important directories that are further addressed in this article. They can be chosen arbitrary, but should not overlap.</p>

<ul><li><code><strong>&lt;GERONIMO&gt;</strong></code> &#8211; directory at the <code><strong>geronimo.host</strong></code> where <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> is installed.</li></ul>


<ul><li><code><strong>&lt;SPEC&gt;</strong></code> &#8211; directory at the <code><strong>geronimo.host</strong></code> where <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> is installed.</li></ul>


<ul><li><code><strong>&lt;KIT&gt;</strong></code> &#8211; directory at the <code><strong>geronimo.host</strong></code> containing the files attached to this article.</li></ul>


<ul><li><code><strong>&lt;TOMCAT&gt;</strong></code> &#8211; directory at the <code><strong>emulator.host</strong></code> where <a shape="rect" class="external-link" href="http://tomcat.apache.org">Tomcat</a> is installed.</li></ul>


<ul><li><code><strong>&lt;DRIVER&gt;</strong></code> &#8211; directory at the <code><strong>driver.host</strong></code> that is a copy of the <code><strong>&lt;SPEC&gt;</strong></code> directory.</li></ul>


<ul><li><code><strong>&lt;DRIVER_GERONIMO&gt;</strong></code> &#8211; directory at the <code><strong>driver.host</strong></code> that is a copy of the <code><strong>&lt;GERONIMO&gt;</strong></code> directory.</li></ul>


<ul><li><code><strong>&lt;JAVA_HOME&gt;</strong></code> &#8211; <code>JAVA_HOME</code> location at the <code><strong>driver.host</strong></code>.</li></ul>


<ul><li><code><strong>&lt;OUTPUT&gt;</strong></code> &#8211; directory at the <code><strong>driver.host</strong></code> where the <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> Driver will store its output.</li></ul>


<ul><li><code><strong>&lt;DUMP&gt;</strong></code> &#8211; directory at the <code><strong>driver.host</strong></code> where the <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> Driver will store its temporal files.
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline">
<rich-text-body><p><strong>On Windows</strong> some components may work incorrectly if working paths are too long or contain spaces. So it's recommended that you avoid long paths and spaces in them.</p></rich-text-body></li></ul>


<p><a shape="rect" href="specjappserver2004.html">Back to Top</a></p>

<h1 id="SPECjAppServer2004-Installingproducts">Installing products</h1>

<p>First, save the files attached to this article to a local directory. This will be your <code><strong>&lt;KIT&gt;</strong></code> directory.</p>

<h2 id="SPECjAppServer2004-InstallingGeronimo">Installing Geronimo</h2>

<p>You can easily install <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> using the <code>.zip</code> or <code>.tar.gz</code> archive.</p>

<p>Extract the downloaded archive to a local directory. The <code>geronimo-jetty6-javaee5-2.1</code> or <code>geronimo-tomcat6-javaee5-2.1</code> directory is created, that is your <code><strong>&lt;GERONIMO&gt;</strong></code> directory.</p>

<h2 id="SPECjAppServer2004-InstallingSPECjAppServer2004">Installing SPECjAppServer2004</h2>

<p>Run:</p>

<parameter ac:name="borderStyle">solid</parameter><rich-text-body><p><code>java -jar SPECjAppServer2004-Kit-v1.08.jar</code></p></rich-text-body>

<p>Click <strong>Next</strong>, read and accept the license agreement, and type in the directory you want the <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> to be installed to. This directory will be your <code><strong>&lt;SPEC&gt;</strong></code> directory.</p>

<p>Click <strong>Install</strong>. </p>

<p>Wait until the installation completes, then click <strong>Ready</strong>.</p>

<p><a shape="rect" href="specjappserver2004.html">Back to Top</a></p>

<h1 id="SPECjAppServer2004-ConfiguringGeronimo">Configuring Geronimo</h1>

<h2 id="SPECjAppServer2004-Adjustingconfiguration">Adjusting configuration</h2>

<p>If your <code><strong>geronimo.host</strong></code> and your <code><strong>driver.host</strong></code> are the same machine, you have to adjust the port number of the <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/guide/rmi/" rel="nofollow">RMI</a> Registry (to e. g. 1199), otherwise it would conflict with the <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> Driver that uses the default port of 1099. Edit the <code><strong>&lt;GERONIMO&gt;</strong>/var/config/config-substitutions.properties</code> file and change the <code>NamingPort</code> variable value.</p>

<h2 id="SPECjAppServer2004-StartingGeronimo">Starting Geronimo</h2>

<p>Go to your <code><strong>&lt;GERONIMO&gt;</strong></code> directory.</p>

<p>Start <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> by typing:</p>

<parameter ac:name="borderStyle">solid</parameter><rich-text-body><p><code>java -Djava.endorsed.dirs=lib/endorsed -javaagent:bin/jpa.jar -Dopenejb.jndiname.failoncollision=true -Dopenejb.jndiname.format={ejbName} -jar bin/server.jar</code></p></rich-text-body>

<rich-text-body><p>Please note the two <a shape="rect" class="external-link" href="http://openejb.apache.org">OpenEJB</a> settings, they're necessary to tune <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> to the simple format of EJB JNDI names <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> uses.</p>

<p>See details at <a shape="rect" class="external-link" href="http://cwiki.apache.org/GMOxDOC22/client-jndi-names.html">http://cwiki.apache.org/GMOxDOC22/client-jndi-names.html</a> and <a shape="rect" class="external-link" href="http://cwiki.apache.org/OPENEJB/service-locator.html">http://cwiki.apache.org/OPENEJB/service-locator.html</a>.</p></rich-text-body>

<p>You may also use <code><strong>&lt;GERONIMO&gt;</strong>/bin/geronimo.sh</code> or <code><strong>&lt;GERONIMO&gt;</strong>/bin/geronimo.bat</code> scripts instead, after appropriate adjustments.</p>

<rich-text-body><p><a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> <a shape="rect" class="external-link" href="http://geronimo.apache.org/apache-geronimo-v21-release.html">v2.1</a> needs access to Internet for <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> application to be deployed &#8211; it tries to fetch XML schemas from <a shape="rect" class="external-link" href="http://java.sun.com" rel="nofollow">http://java.sun.com</a> site.</p>

<p>So if you're behind a firewall, add the appropriate proxy options to the <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> startup line:</p>

<p><code>-Dhttp.proxyHost=PROXY_HOST -Dhttp.proxyPort=PROXY_PORT -Dhttp.nonProxyHosts="127.0.0.1|localhost|<strong>geronimo.host</strong>|<strong>emulator.host</strong>"</code></p>

<p>This problem is caused by <a shape="rect" class="external-link" href="http://issues.apache.org/jira/browse/OPENEJB-700">OPENEJB-700</a> bug which is already fixed and the fix should make it to <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> v2.1.1.</p>

<p>If your installation of <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> has no access to Internet at all, or your proxy requires authentication, you may use the following workarounds (thanks to <a shape="rect" class="external-link" href="mailto:soap_man@mail.ru" rel="nofollow">Konstantin Malynkin</a> for describing them). You may download the necessary DTDs to your local drive and specify the local path to them in your deployment descriptors (see <code><strong>&lt;SPEC&gt;</strong>/src/deploy/geronimo</code> directory). For example, you could use <code>&lt;!DOCTYPE ejb-jar SYSTEM "C:/DTD/ejb-jar_2_0.dtd"&gt;</code> instead of <code>&lt;!DOCTYPE ejb-jar PUBLIC '-//Sun Microsystems, Inc.//DTD Enterprise JavaBeans 2.0//EN' 'http://java.sun.com/dtd/ejb-jar_2_0.dtd'&gt;</code>. Another way is to omit verification at all by deleting or commenting out the references to DTDs in the deployment descriptors. Note that in both cases you would have to <a shape="rect" href="specjappserver2004.html">rebuild</a> and <a shape="rect" href="specjappserver2004.html">redeploy</a> the <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> application for the changes to take effect.</p></rich-text-body>

<p>It will take some time to start. After that, you will see:</p>

<p><span style="color: white;"><parameter ac:name="bgColor">black</parameter><parameter ac:name="borderStyle">solid</parameter><plain-text-body>
Booting Geronimo Kernel (in Java 1.5.0_11)...
Starting Geronimo Application Server v2.1
[****************************************] 100%  25s Startup complete
  Listening on Ports:
       0 0.0.0.0   Derby Connector
    1050 127.0.0.1 CORBA Naming Service
    1099 0.0.0.0   RMI Naming
    2001 127.0.0.1 OpenEJB ORB Adapter
    4201 0.0.0.0   OpenEJB Daemon
    6882 127.0.0.1 OpenEJB ORB Adapter
    8009 0.0.0.0   Jetty Connector AJP13
    8080 0.0.0.0   Jetty SelectChannel Connector HTTP
    8443 0.0.0.0   Jetty SelectChannel Connector HTTPS
    9999 0.0.0.0   JMX Remoting Connector
   61613 0.0.0.0   ActiveMQ Transport Connector
   61616 0.0.0.0   ActiveMQ Transport Connector

  Started Application Modules:
    EAR: org.apache.geronimo.configs/uddi-jetty6/2.1/car
    EAR: org.apache.geronimo.plugins/agent/2.1/car
    EAR: org.apache.geronimo.plugins/console-jetty/2.1/car
    EAR: org.apache.geronimo.plugins/mconsole-jetty/2.1/car
    JAR: org.apache.geronimo.configs/mejb/2.1/car
    RAR: org.apache.geronimo.configs/activemq-ra/2.1/car
    RAR: org.apache.geronimo.configs/system-database/2.1/car
    RAR: org.apache.geronimo.plugins/agent-ds/2.1/car
    RAR: org.apache.geronimo.plugins/mconsole-ds/2.1/car
    WAR: org.apache.geronimo.configs/ca-helper-jetty/2.1/car
    WAR: org.apache.geronimo.configs/dojo-jetty6/2.1/car
    WAR: org.apache.geronimo.configs/dojo-legacy-jetty6/2.1/car
    WAR: org.apache.geronimo.configs/remote-deploy-jetty/2.1/car
    WAR: org.apache.geronimo.configs/welcome-jetty/2.1/car
    WAR: org.apache.geronimo.plugins/activemq-console-jetty/2.1/car
    WAR: org.apache.geronimo.plugins/debugviews-console-jetty/2.1/car
    WAR: org.apache.geronimo.plugins/plancreator-console-jetty/2.1/car
    WAR: org.apache.geronimo.plugins/plugin-console-jetty/2.1/car
    WAR: org.apache.geronimo.plugins/sysdb-console-jetty/2.1/car

  Web Applications:
    /
    /CAHelper
    /activemq
    /console
    /console-base
    /debug-views
    /dojo
    /dojo/0.4
    /juddi
    /monitoring
    /plan-creator
    /plugin
    /remote-deploy
    /system-database

Geronimo Application Server started
</plain-text-body></span></p>

<p>If you get a different result, particularly, if network errors show up, then something has gone wrong.</p>

<rich-text-body><p>Sometimes, the startup fails because some local network addresses are inaccessible. This could happen, for example, if you have used a VPN interface that is disconnected now. By default, <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> uses the first local address it comes across to access its components, and may try to use a stale address, causing startup errors.</p>

<p>You may try disabling and then re-enabling the unused network interfaces to resolve such issues.</p></rich-text-body>

<h2 id="SPECjAppServer2004-Accessingtheconsole">Accessing the console</h2>

<p>Open your web browser and connect to the <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> Console at <code><strong>http:/</strong><strong>/geronimo.host:8080/console/</strong></code></p>

<p>Log in using the user name and password (<strong>system</strong> and <strong>manager</strong> by default).</p>

<p>Now you may investigate the console if you wish.</p>

<h2 id="SPECjAppServer2004-Creatingthedatabase">Creating the database</h2>

<p>Go to the <strong>Embedded DB - DB Manager</strong> in the Console Navigation.</p>

<p>Create the benchmark database by typing its name (<strong>SPECDB</strong>) in the <strong>Create DB</strong> field and clicking <strong>Create</strong>.</p>

<h2 id="SPECjAppServer2004-LocatingtheSQLfiles">Locating the SQL files</h2>

<p>To create database tables, you can use the default SQL scripts provided in the <code><strong>&lt;SPEC&gt;</strong>/schema/sql</code> directory. However, the directory includes five scripts, and they contain <code>DROP TABLE</code> commands that would fail if you try to execute them in the console when tables are not yet created.</p>

<p>Instead, it is recommended that you use the <a shape="rect" href="specjappserver2004.data/allTablesNoDrop.sql?version=1&amp;modificationDate=1204189826000&amp;api=v2" data-linked-resource-id="20874038" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="allTablesNoDrop.sql" data-nice-type="Text File" data-linked-resource-content-type="text/plain" data-linked-resource-container-id="20645287" data-linked-resource-container-version="20">allTablesNoDrop.sql</a> file, if you are creating the tables from scratch, or <a shape="rect" href="specjappserver2004.data/allTables.sql?version=1&amp;modificationDate=1204189826000&amp;api=v2" data-linked-resource-id="20874037" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="allTables.sql" data-nice-type="Text File" data-linked-resource-content-type="text/plain" data-linked-resource-container-id="20645287" data-linked-resource-container-version="20">allTables.sql</a> file if you want to drop and recreate the tables. Both files were created from the <code><strong>&lt;SPEC&gt;</strong>/schema/sql</code> files by simple concatenation, <a shape="rect" href="specjappserver2004.data/allTablesNoDrop.sql?version=1&amp;modificationDate=1204189826000&amp;api=v2" data-linked-resource-id="20874038" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="allTablesNoDrop.sql" data-nice-type="Text File" data-linked-resource-content-type="text/plain" data-linked-resource-container-id="20645287" data-linked-resource-container-version="20">allTablesNoDrop.sql</a> also has <code>DROP TABLE</code> commands removed.</p>

<h2 id="SPECjAppServer2004-Creatingthetables">Creating the tables</h2>

<p>Make sure <strong>SPECDB</strong> is selected in <strong>Use DB</strong> field and then copy-paste the SQL code to <strong>SQL Command/s</strong> frame. Click <strong>Run SQL</strong> button above it.</p>

<p>After a short delay, the frame will clear and the <strong>Result</strong> field below it will say <strong>SQL command/s successful</strong>. If not &#8211; check what you did wrong and try again.</p>

<p>If you use multiple SQL scripts, repeat the operations above for each of them.</p>

<p><a shape="rect" href="specjappserver2004.html">Back to Top</a></p>

<h1 id="SPECjAppServer2004-ConfiguringSPECjAppServer2004">Configuring SPECjAppServer2004</h1>

<h2 id="SPECjAppServer2004-Basicconfiguration">Basic configuration</h2>

<h3 id="SPECjAppServer2004-deploydirectory"><code>deploy</code> directory</h3>

<p>Go to the <code><strong>&lt;SPEC&gt;</strong>/src/deploy</code> directory and copy the <code>reference</code> subdirectory with its contents with the name <code>geronimo</code>.</p>

<h3 id="SPECjAppServer2004-geronimo.envfile"><code>geronimo.env</code> file</h3>

<p>Go to the <code><strong>&lt;SPEC&gt;</strong>/config</code> directory.</p>

<p>Put the attached <a shape="rect" href="specjappserver2004.data/geronimo.env?version=1&amp;modificationDate=1205865997000&amp;api=v2" data-linked-resource-id="20874039" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="geronimo.env" data-linked-resource-content-type="application/octet-stream" data-linked-resource-container-id="20645287" data-linked-resource-container-version="20">geronimo.env</a> template file there. Edit it, make sure you set the values for the following variables:</p>

<p><code>JAS_HOME=<strong>&lt;SPEC&gt;</strong></code><br clear="none">
<code>JAVA_HOME=<strong>&lt;JAVA_HOME&gt;</strong></code><br clear="none">
<code>J2EE_HOME=<strong>&lt;GERONIMO&gt;</strong></code><br clear="none">
<code>JAS_HOST=<strong>geronimo.host</strong></code><br clear="none">
<code>EMULATOR_HOST=<strong>emulator.host</strong></code></p>

<rich-text-body><p>Use forward slashes ( / ) as directory separators!</p></rich-text-body>

<p>You may leave the other variables intact.</p>

<h3 id="SPECjAppServer2004-appsserverfile"><code>appsserver</code> file</h3>

<p>Edit the <code><strong>&lt;SPEC&gt;</strong>/config/appsserver</code> file &#8211; replace the word <strong>default</strong> there with the word <strong>geronimo</strong>.</p>

<h3 id="SPECjAppServer2004-run.propertiesfile"><code>run.properties</code> file</h3>

<p>Edit the <code><strong>&lt;SPEC&gt;</strong>/config/run.properties</code> file. Note that it will be used on the <code><strong>driver.host</strong></code> and make sure the following variables have correct values:</p>

<p><code>researchMode = true  # Turns EAStress mode on</code><br clear="none">
<code>Url = http:/</code><code>/<strong>geronimo.host</strong>:8080/SPECjAppServer/app?</code><br clear="none">
<code>outDir = <strong>&lt;OUTPUT&gt;</strong></code><br clear="none">
<code>dumpDir = <strong>&lt;DUMP&gt;</strong></code></p>

<h3 id="SPECjAppServer2004-setenv.batfile"><code>setenv.bat</code> file</h3>

<p>Edit the <code><strong>&lt;SPEC&gt;</strong>/bin/setenv.bat</code> file, make sure you set the values for the following variables:</p>

<p><code>JAVA_HOME=<strong>&lt;JAVA_HOME&gt;</strong></code><br clear="none">
<code>JAS_HOME=<strong>&lt;DRIVER&gt;</strong></code><br clear="none">
<code>APPSSERVER=geronimo</code></p>

<h2 id="SPECjAppServer2004-Buildingtheapplication">Building the application</h2>

<p>Go to the <code><strong>&lt;SPEC&gt;</strong></code> directory.</p>

<p>Clean-up your installation:</p>

<parameter ac:name="borderStyle">solid</parameter><rich-text-body><p><code>ant/bin/ant clean</code></p></rich-text-body>

<p>Build the application and configure it for <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a>:</p>

<parameter ac:name="borderStyle">solid</parameter><rich-text-body><p><code>ant/bin/ant -Dappserver=geronimo</code></p></rich-text-body>

<p>You will get the <strong>BUILD SUCCESSFUL</strong> diagnostic.</p>

<p>Make sure the files <code>SPECjAppServer.ear</code> and <code>emulator.war</code> are created in the <code><strong>&lt;SPEC&gt;</strong>/jars</code> directory.</p>

<p>Rename <code>emulator.war</code> to <code>Emulator.war</code>.</p>

<h2 id="SPECjAppServer2004-Preparingdatabaseconfiguration">Preparing database configuration</h2>

<p>In the described configuration, the same database is used for all tables.</p>

<p>Go to the <code><strong>&lt;SPEC&gt;</strong>/config</code> directory. Replace the content of each of the <code>*db.properties</code> files you find there with the contents of the attached <a shape="rect" href="specjappserver2004.data/db.properties?version=1&amp;modificationDate=1204189826000&amp;api=v2" data-linked-resource-id="20874036" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="db.properties" data-linked-resource-content-type="application/octet-stream" data-linked-resource-container-id="20645287" data-linked-resource-container-version="20">db.properties</a> template file. Make sure the <code>pipeDir</code> variable there points to a valid temporary directory, adjust if necessary.</p>

<h2 id="SPECjAppServer2004-Loadingthetables">Loading the tables</h2>

<p>Run:</p>

<parameter ac:name="borderStyle">solid</parameter><rich-text-body><p><code>ant/bin/ant -Dappserver=geronimo loaddb</code></p></rich-text-body>

<p>After some time, you will get the <strong>BUILD SUCCESSFUL</strong> diagnostic.</p>

<p><a shape="rect" href="specjappserver2004.html">Back to Top</a></p>

<h1 id="SPECjAppServer2004-Deployingcomponents">Deploying components</h1>

<p>At this stage you need to deploy the configured components to <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a>.</p>

<rich-text-body><p>Note that if your <code><strong>geronimo.host</strong></code> and your <code><strong>driver.host</strong></code> are the same machine, and you <a shape="rect" href="specjappserver2004.html">changed</a> the port number of the <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> <a shape="rect" class="external-link" href="http://java.sun.com/j2se/1.5.0/docs/guide/rmi/" rel="nofollow">RMI</a> Registry, you should specify that port number in all deployer commands, like this:
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline"></p>
<parameter ac:name="borderStyle">solid</parameter><rich-text-body><p><code>java -jar bin/deployer.jar -port 1199 ...</code></p></rich-text-body></rich-text-body> 

<h2 id="SPECjAppServer2004-Loggingin">Logging in</h2>

<p>To avoid specifying login credentials on any call to deployer, you can login first:</p>

<parameter ac:name="borderStyle">solid</parameter><rich-text-body><p><code>java -jar bin/deployer.jar -u system -p manager login</code></p></rich-text-body>

<h2 id="SPECjAppServer2004-Deployingdatabaseconnector">Deploying database connector</h2>

<p>To deploy a connector to the <a shape="rect" class="external-link" href="http://db.apache.org/derby/">Derby</a> <strong>SPECDB</strong> database you created earlier, go to the <code><strong>&lt;GERONIMO&gt;</strong></code> directory and run:</p>

<parameter ac:name="borderStyle">solid</parameter><rich-text-body><p><code>java -jar bin/deployer.jar deploy repository/org/tranql/tranql-connector-derby-embed-xa/1.3/tranql-connector-derby-embed-xa-1.3.rar <strong>&lt;KIT&gt;</strong>/sjas-db.xml</code></p></rich-text-body>

<p>You will get the <strong>SPECjAppServer2004/DB/1.08/rar</strong> diagnostic.</p>

<h2 id="SPECjAppServer2004-DeployingJMSconnector">Deploying JMS connector</h2>

<p>To deploy an <a shape="rect" class="external-link" href="http://www.activemq.org" rel="nofollow">ActiveMQ</a> JMS connector for <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a>, go to the <code><strong>&lt;GERONIMO&gt;</strong></code> directory and run:</p>

<parameter ac:name="borderStyle">solid</parameter><rich-text-body><p><code>java -jar bin/deployer.jar deploy repository/org/apache/geronimo/modules/geronimo-activemq-ra/2.1/geronimo-activemq-ra-2.1.rar <strong>&lt;KIT&gt;</strong>/sjas-jms.xml</code></p></rich-text-body>

<p>You will get the <strong>SPECjAppServer2004/JMS/1.08/rar</strong> diagnostic.</p>

<h2 id="SPECjAppServer2004-Deployingthemainapplication">Deploying the main application</h2>

<p>To deploy <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> on <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a>, this configuration uses the deployment plan that was originally found in <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> sources at <a shape="rect" class="external-link" href="http://svn.apache.org/viewcvs.cgi/geronimo/sandbox/specjappserver2004/specj2004-deployment-plan.xml">http://svn.apache.org</a>, modified and updated for <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> version 2.1.</p>

<p>Go to the <code><strong>&lt;GERONIMO&gt;</strong></code> directory and run:</p>

<parameter ac:name="borderStyle">solid</parameter><rich-text-body><p><code>java -jar bin/deployer.jar deploy <strong>&lt;SPEC&gt;</strong>/jars/SPECjAppServer.ear <strong>&lt;KIT&gt;</strong>/sjas-app.xml</code></p></rich-text-body>

<p>You will get the <strong>SPECjAppServer2004/Application/1.08/ear</strong> diagnostic.</p>

<h2 id="SPECjAppServer2004-Verifyingthedeployment">Verifying the deployment</h2>

<p>At this stage you may check that the deployment has been done correctly and that <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> is operational.</p>

<h3 id="SPECjAppServer2004-Deliveryservlet">Delivery servlet</h3>

<p>Go to the page <code><strong>http:/</strong><strong>/geronimo.host:8080/Supplier/</strong></code>. It should load normally and contain a single directory, <code>dtd</code>, with two files inside, <code>delivery.dtd</code> and <code>po.dtd</code>.</p>

<p>Go to the page <code><strong>http:/</strong><strong>/geronimo.host:8080/Supplier/DeliveryServlet</strong></code>. You should see a page with text like this:</p>

<parameter ac:name="bgColor">white</parameter><parameter ac:name="borderStyle">solid</parameter><rich-text-body>
<p><strong>Servlet seems to work OK</strong><br clear="none">
<strong>Number of Transactions : 0</strong><br clear="none">
<sup><strong>Servlet invoked without command specified</strong></sup></p></rich-text-body>

<h3 id="SPECjAppServer2004-Manualtransactions">Manual transactions</h3>

<p>Open the deployed <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> page: <code><strong>http:/</strong><strong>/geronimo.host:8080/SPECjAppServer/</strong></code></p>

<p>In the left-hand menu, click the <strong>Go Trade Autos!</strong> or <strong>Go Build Cars!</strong> link.</p>

<p>Log in with the default credentials (<code><strong>1</strong></code>) by clicking <strong>Log in</strong>.</p>

<p>You should see the program interface and be able to perform transactions.</p>

<h3 id="SPECjAppServer2004-Atomicitytests">Atomicity tests</h3>

<p>Open the deployed <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> page: <code><strong>http:/</strong><strong>/geronimo.host:8080/SPECjAppServer/</strong></code></p>

<p>In the left-hand menu, click the <strong>Atomicity Tests</strong> link.</p>

<p>You will see the results of three atomicity tests' runs. If all three of them are marked as <span style="color: red;"><strong>PASSED</strong></span>, your deployment is correct.</p>

<p><a shape="rect" href="specjappserver2004.html">Back to Top</a></p>

<h1 id="SPECjAppServer2004-DeployingtheSupplierEmulator">Deploying the Supplier Emulator</h1>

<p>To deploy the <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> Supplier Emulator at the <code><strong>emulator.host</strong></code>, use one of the following:</p>

<p>The <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> built-in servlet container (in case the <code><strong>emulator.host</strong></code> and the <code><strong>geronimo.host</strong></code> are the same machine); or a stand-alone servlet container on the <code><strong>emulator.host</strong></code>.</p>

<rich-text-body><p>Note that <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/" rel="nofollow">SPECjAppServer2004</a> <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/docs/UserGuide.html#Section3" rel="nofollow">documentation</a> requires that the Supplier Emulator servlet container should have the <code>keep-alive</code> option turned off. You can ignore this requirement, but that would impact the performance severely.</p></rich-text-body>

<h2 id="SPECjAppServer2004-UsingtheGeronimoservletcontainer">Using the Geronimo servlet container</h2>

<p>Go to the <code><strong>&lt;GERONIMO&gt;</strong></code> directory and run:</p>

<parameter ac:name="borderStyle">solid</parameter><rich-text-body><p><code>java -jar bin/deployer.jar deploy <strong>&lt;SPEC&gt;</strong>/jars/Emulator.war <strong>&lt;KIT&gt;</strong>/sjas-emulator.xml</code></p></rich-text-body>

<p>You will get the <strong>SPECjAppServer2004/Emulator/1.08/war @ /Emulator</strong> diagnostic.</p>

<h2 id="SPECjAppServer2004-Usingastand-aloneservletcontainer">Using a stand-alone servlet container</h2>

<p>This configuration assumes that your stand-alone servlet container on the <code><strong>emulator.host</strong></code> is <a shape="rect" class="external-link" href="http://tomcat.apache.org">Tomcat</a> running on the default port (8080).</p>

<p>Install <a shape="rect" class="external-link" href="http://tomcat.apache.org">Tomcat</a> to your <code><strong>&lt;TOMCAT&gt;</strong></code> directory on the <code><strong>emulator.host</strong></code>.</p>

<rich-text-body><p><strong>Do not bother</strong> editing <code><strong>&lt;SPEC&gt;</strong>/config/tomcat.env</code> file or running <code>ant/bin/ant -f tomcat.xml</code>.</p>

<p>Both files are obsolete, they generate the <code>Emulator.war</code> file, which has already been created at <a shape="rect" href="specjappserver2004.html">#Building the application</a> phase.</p></rich-text-body>

<p>Copy the <code><strong>&lt;SPEC&gt;</strong>/jars/Emulator.war</code> file to the <code><strong>&lt;TOMCAT&gt;</strong>/webapps</code> directory and remove the <code><strong>&lt;TOMCAT&gt;</strong>/webapps/Emulator</code> directory if it exists.</p>

<p>Go to the <code><strong>&lt;TOMCAT&gt;</strong></code> directory on the <code><strong>emulator.host</strong></code> and start <a shape="rect" class="external-link" href="http://tomcat.apache.org">Tomcat</a>:</p>

<parameter ac:name="borderStyle">solid</parameter><rich-text-body><p><code>bin/catalina run</code></p></rich-text-body>

<h2 id="SPECjAppServer2004-Veryfyingthedeployment">Veryfying the deployment</h2>

<p>Go to the page <code><strong>http:/</strong><strong>/emulator.host:8080/Emulator/</strong></code>. It should load normally and contain a single directory, <code>dtd</code>, with two files inside, <code>delivery.dtd</code> and <code>po.dtd</code>.</p>

<p>Go to the page <code><strong>http:/</strong><strong>/emulator.host:8080/Emulator/EmulatorServlet</strong></code>. You should see a page with text like this:</p>

<parameter ac:name="bgColor">white</parameter><parameter ac:name="borderStyle">solid</parameter><rich-text-body>
<p><strong>Emulator Servlet seems to work OK</strong><br clear="none">
<strong>JAS_HOST : geronimo.host</strong><br clear="none">
<strong>JAS_PORT : 8080</strong><br clear="none">
<strong>Servlet URL : Supplier/DeliveryServlet</strong></p>

<p><strong>Number of Transactions : 0</strong><br clear="none">
<sup><strong>Servlet invoked without command specified</strong></sup></p></rich-text-body>

<p><a shape="rect" href="specjappserver2004.html">Back to Top</a></p>

<h1 id="SPECjAppServer2004-Runningthebenchmark">Running the benchmark</h1>

<p>Copy the <code><strong>&lt;GERONIMO&gt;</strong></code> directory to the <code><strong>driver.host</strong></code>, the copy will be your <code><strong>&lt;DRIVER_GERONIMO&gt;</strong></code> directory (in fact you only need some jars from it).</p>

<p>Copy the <code><strong>&lt;SPEC&gt;</strong></code> directory to the <code><strong>driver.host</strong></code>, the copy will be your <code><strong>&lt;DRIVER&gt;</strong></code> directory.</p>

<p>In the <code><strong>&lt;DRIVER&gt;</strong>/config/geronimo.env</code> file adjust the <code>JAS_HOME</code> variable to the <code><strong>&lt;DRIVER&gt;</strong></code> directory and <code>J2EE_HOME</code> variable to the <code><strong>&lt;DRIVER_GERONIMO&gt;</strong></code> directory.</p>

<p>Go to the <code><strong>&lt;DRIVER&gt;</strong></code> directory on the <code><strong>driver.host</strong></code> and run:</p>

<parameter ac:name="borderStyle">solid</parameter><rich-text-body><p><code>bin/setenv.bat</code></p></rich-text-body>

<p>This configures the environment to run the Driver.</p>

<p>To start the Driver itself, run:</p>

<parameter ac:name="borderStyle">solid</parameter><rich-text-body><p><code>bin/driver.bat</code></p></rich-text-body>

<p>If you wish to run a distributed load with multiple Drivers, then after the Driver is started on the first host (the <code><strong>master.host</strong></code>), start the Driver on other driver hosts like this:</p>

<parameter ac:name="borderStyle">solid</parameter><rich-text-body><p><code>bin/driver.bat <strong>master.host</strong></code></p></rich-text-body>

<p>After starting the Driver, you should see the output like this:</p>

<p><span style="color: white;"><parameter ac:name="bgColor">black</parameter><parameter ac:name="borderStyle">solid</parameter><plain-text-body>
The following environment settings are in effect:
* ========================= *
   JAVA_HOME=&lt;JAVA_HOME&gt;
    JAS_HOME=&lt;DRIVER&gt;
  CONFIG_DIR=&lt;DRIVER&gt;\config
  APPSSERVER=geronimo
     ENVFILE=&lt;DRIVER&gt;\config\geronimo.env
* ========================= *
Driver Host: &lt;driver.host&gt;

This result was created using EAStress2004, a research workload
utilizing a subset of the SPECjAppServer2004 benchmark with a unique
metric. It is provided only as a tool for research testing and
experimentation in situations where the benchmark run rules cannot be
met due to technical reasons (e. g., usage of projects under development,
usage of experimental platforms). EAStress2004 results are not reviewed
by SPEC and can in no way be compared with SPECjAppServer2004 results.
Because EAStress results are not compliant with the benchmark run rules,
the use of EAStress results in competitive comparisons between vendors
is prohibited.

Public use of SPECjAppServer2004 benchmark results, including the
EAStress workload, are bound by the SPEC OSSC Fair Use Guidelines
and the SPECjAppServer2004 specific Run and Reporting Rules. All
publications must clearly state that these results have not been
reviewed or accepted by SPEC using text equivalent to this:

   SPECjAppServer is a trademark of the Standard Performance Evaluation
   Corp. (SPEC). The EAStress workload results or findings in this
   publication have not been reviewed or accepted by SPEC, therefore no
   comparison nor performance inference can be made against any published
   SPEC result. The official web site for SPECjAppServer2004 is located at
   http://www.spec.org/osg/jAppServer2004.

Binding controller to //&lt;driver.host&gt;/Controller
DriverDebug: DealerAgent &lt;propsFile&gt; &lt;agentName&gt; &lt;masterMachine&gt;
Controller: Registering M1 on machine &lt;driver.host IP address&gt;
Controller: Registering O1 on machine &lt;driver.host IP address&gt;
Controller: Registering L1 on machine &lt;driver.host IP address&gt;
Calling switchLog as master
RunID for this run is : 75
Output directory for this run is : &lt;OUTPUT&gt;\75
TTF1 = 93
ttf = 93
Configuring 1 DealerAgent(s)...
DealerAgent O1, Thread 0 started
DealerAgent O1, Thread 1 started
DealerAgent O1, Thread 2 started
DealerAgent O1, Thread 3 started
DealerAgent O1, Thread 4 started
DealerAgent O1, Thread 5 started
DealerAgent O1, Thread 6 started
DealerAgent O1, Thread 7 started
DealerAgent O1, Thread 8 started
DealerAgent O1, Thread 9 started
Configuring 1 MfgAgent(s)...
MfgAgent M1, Thread 0 started
MfgAgent M1, Thread 1 started
MfgAgent M1, Thread 2 started
Configuring 1 LargeOLAgent(s)...


MfgAgent L1, Thread 0 started
Rampup      = Fri May 12 20:49:51 MSD 2006
SteadyState = Fri May 12 20:59:51 MSD 2006
Rampdown    = Fri May 12 21:59:51 MSD 2006
Finish      = Fri May 12 22:04:51 MSD 2006

sleeptime is 28417 note this is time in excess needed for trigger
Starting Ramp Up...
</plain-text-body></span></p>

<p>This means the Driver started normally.</p>

<p>Note the times for <strong>Rampup</strong>, <strong>SteadyState</strong>, <strong>Rampdown</strong> and <strong>Finish</strong> to figure out the time needed for the benchmark to complete.</p>

<rich-text-body><p>You can interrupt the run at any time with <code>Ctrl-C</code>.</p></rich-text-body>

<p>Sometimes binding exceptions or other problems may occur at the Driver startup. In such a case, interrupt the test run with <code>Ctrl-C</code> and rerun it again. Sometimes it helps.</p>

<rich-text-body><p>It's recommended to <a shape="rect" href="specjappserver2004.html">reload</a> the database tables before each run, particularly if previous run was not finished correctly. Otherwise, errors like this may occur:</p>

<p><span style="color: white;"><parameter ac:name="bgColor">black</parameter><parameter ac:name="borderStyle">solid</parameter><plain-text-body>
java.rmi.RemoteException: Failure in calling validateInitialValues() java.rmi.RemoteException: Invalid initial Order DB State
        at org.spec.jappserver.driver.Auditor.validateInitialValues(Auditor.java:201)
        at org.spec.jappserver.driver.Driver.configure(Driver.java:330)
        at org.spec.jappserver.driver.Driver.&lt;init&gt;(Driver.java:160)
        at org.spec.jappserver.driver.Driver.main(Driver.java:1137)
</plain-text-body></span></p></rich-text-body>

<p>During the run, the diagnostics like these may appear in the Driver output and <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> shell:</p>

<p><span style="color: white;"><parameter ac:name="bgColor">black</parameter><parameter ac:name="borderStyle">solid</parameter><plain-text-body>
AbstractSJASLoad&gt; Application error have already been sold

wrong format in chunk size field b=70

The transaction has been marked rollback only because the bean encountered a non-application exception:

A lock could not be obtained due to a deadlock, cycle of locks and waiters is:
</plain-text-body></span></p>

<rich-text-body><p>These diagnostics are probably caused by the fact that <a shape="rect" class="external-link" href="http://tranql.codehaus.org" rel="nofollow">TranQL</a> version 1.3 used in <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> <a shape="rect" class="external-link" href="http://geronimo.apache.org/apache-geronimo-v21-release.html">v2.1</a> does not provide the necessary transaction isolation level. Hopefully, this problem will be fixed in future versions.</p></rich-text-body>

<p>After the run has completed successfuly, you will see the output like this:</p>

<p><span style="color: white;"><parameter ac:name="bgColor">black</parameter><parameter ac:name="borderStyle">solid</parameter><plain-text-body>
Gathering DealerStats ...
Gathering MfgStats ...
summary file is &lt;OUTPUT&gt;\75\EAStress.summary
EAStress2004 v1.08 Results
EAStress2004 HASOPM: 0.574
Dealer Response Times
     Purchase...2.3000000000000003
     Manage.....10.0
     Browse.....4.0
Manufacturing Response Times
     Mfg........0.25
Calling getLog as master
</plain-text-body></span></p>

<p>The number of <strong>HASOPM</strong> is a final EAStress benchmark metric. You would get a <strong>JOPS</strong> result instead if you attempt a full <strong>SPECjAppServer2004</strong> run.</p>

<rich-text-body><p>For now these values for <a shape="rect" class="external-link" href="http://geronimo.apache.org">Geronimo</a> are terribly low, and don't depend on the hardware being used. Probably this is due to some configuration issues that still exist or due to the <a shape="rect" class="external-link" href="http://tranql.codehaus.org" rel="nofollow">TranQL</a> issue mentioned above.</p></rich-text-body>

<p><a shape="rect" href="specjappserver2004.html">Back to Top</a></p>

<h1 id="SPECjAppServer2004-Processingresults">Processing results</h1>

<p>When driver is run, a subdirectory with a numerical name is created in the <code><strong>&lt;OUTPUT&gt;</strong></code> directory. The subdirectory with the largest number corresponds to the latest run. After the Driver run is complete, the <code>result.props</code> file is created there, it contains the raw results from the benchmark.</p>

<p>Go to the <code><strong>&lt;DRIVER&gt;</strong>/reporter</code> directory, copy the file <code>Sample_Submission.txt</code> under arbitraty name (e. g. <code>Your_Submission.txt</code>) and edit the copy, as described in <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/docs/UserGuide.html#Section5" rel="nofollow">SPECjAppServer2004 User's Guide :: Section 5 &#8211; Results</a>, add the raw data from the <code>result.props</code> file.</p>

<p>Run the following command to generate an HTML benchmark report, it would be named <code>Your_Submission.report.html</code>:</p>

<parameter ac:name="borderStyle">solid</parameter><rich-text-body><p><code>java -cp reporter.jar reporter Your_Submission.txt</code></p></rich-text-body>

<p>Run the following command to generate a text-only benchmark report, it would be named <code>Your_Submission.report.txt</code>:</p>

<parameter ac:name="borderStyle">solid</parameter><rich-text-body><p><code>java -cp reporter.jar reporter -a Your_Submission.txt</code></p></rich-text-body>

<p>For the details on how yo submit your results, see <a shape="rect" class="external-link" href="http://www.spec.org/jAppServer2004/docs/UserGuide.html#S53" rel="nofollow">SPECjAppServer2004 User's Guide :: Section 5.3 &#8211; Submitting the Results</a></p>

<p><a shape="rect" href="specjappserver2004.html">Back to Top</a></p></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : SPECjAppServer2004';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
