<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=0">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="JBoss to Geronimo - JDBC Migration">
    <meta name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi JBoss to Geronimo - JDBC Migration">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2010-05-11">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0文档：从JBoss到Geronimo-JDBC迁移</title>
  </head>

  <body  onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">Home</a> > <a href="documentation.html">文档</a> > <a href="migrating-to-apache-geronimo.html">迁移到Apache Geronimo</a> > <a href="migrating-from-jboss-to-geronimo.html">从JBoss</a> <a href="migrating-to-apache-geronimo.html">迁移到Geronimo</a> > <a href="migrating-from-jboss-to-geronimo.html">从</a> <a href="jboss-to-geronimo-jdbc-migration.html">JBoss到Geronimo-JDBC迁移</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo v3.0</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">从JBoss到Geronimo-JDBC迁移</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645281"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645281">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645281"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645281">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645281"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645281">新增新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>
<p><parameter ac:name="">最佳</parameter><br clear="none">本文将帮助您将为JBoss v4开发的JDBC应用程序迁移到Apache Geronimo。本文是一系列迁移文章的一部分，涵盖了不同类型的应用程序迁移。</p>

<p>本文提供了有关这两个应用程序服务器之间JDBC实现差异的详细信息，以及将JDBC应用程序从JBoss v4移植到Apache Geronimo的详细分步迁移过程。为了定义一个共同的起点（源环境），本文提供了将<a shape="rect" href="jboss-to-geronimo-jdbc-migration.data/brokerage.zip?version=1&modificationDate=1204181195000&api=v2" data-linked-resource-id="20874013" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="brokerage.zip" data-nice-type="Zip Archive" data-linked-resource-content-type="application/zip" data-linked-resource-container-id="20645281" data-linked-resource-container-version="20">Online Brokerage</a>示例应用程序部署到JBoss源环境中的步骤。然后，将指导您完成Apache Geronimo中的应用程序迁移和部署过程。</p>

<p>本文分为以下几节：</p>
<ul><li><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">JDBC实现分析</a></li><li><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">样品申请</a></li><li><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">JBoss环境</a></li><li><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">Geronimo环境</a></li><li><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">分步迁移</a></li><li><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">摘要</a></li></ul>


<h1 id="JBosstoGeronimo-JDBCMigration-JDBCimplementationanalysisimplementation">JDBC实现分析<parameter ac:name="">实现</parameter></h1>

<p>JDBC实现可能因一家供应商而异。本部分的目的是在JBoss和Apache Geronimo之间提供JDBC特定功能之间的比较，以便您可以清楚地识别差异并在迁移之前进行相应的计划。</p>

<p>鉴于JBoss和Geronimo都使用J2CA连接器来访问JDBC资源，因此在比较特定于平台的JDBC功能时，某些J2CA功能会重叠。</p>

<p><strong>注意：</strong>由于Geronimo仍处于起步阶段，因此JBoss提供的某些功能可能尚未在Geronimo中实现。</p>
<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>特征</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>阿帕奇·杰罗尼莫</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>JBoss v4</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>JDBC访问</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Geronimo与JDBC没有任何直接集成，但是支持通过通用J2CA框架进行访问。TranQL项目具有用于各种数据库的J2CA适配器。</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>JBoss中的JDBC访问是通过基于JCA规范的JDBC连接器进行的。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>JCA实施</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Geronimo支持JCA 1.5规范，并且向后兼容JCA 1.0规范。</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>JBoss AS 4.0实现了JCA（Java连接器体系结构）1.5规范，而不是JBoss AS 3.2中的JCA 1.0。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>支持数据源</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>TranQL具有用于数据源，ConnectionPoolDatasource和XADataSource的通用包装。</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>支持5种类型的数据源：</p>
<ul class="alternate"><li>no-tx数据源</li><li>本地TX数据源</li><li>xa数据源</li><li>ha-local-tx-datasource</li><li>ha-xa-datasource</li></ul>
</td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>数据源故障转移</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>TranQL具有用于某些数据库（包括Apache Derby，Oracle，MySQL，DB2和SQL Server）的专用驱动程序，这些驱动程序与驱动程序的高级功能提供了更紧密的集成。<br class="atl-forced-newline" clear="none">在此级别上，将提供负载平衡和故障转移等功能。您还可以使用C-JDBC包装器提供数据库集群和故障转移。</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>JBoss具有通过两个数据源实现的数据源故障转移功能。<br class="atl-forced-newline" clear="none">1）ha-local-tx-datasource-用于本地交易。<br class="atl-forced-newline" clear="none">2）ha-xa-datasource-用于分布式事务</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>XA支持</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>支持XA交易，本地交易和无交易。</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>支持XA交易，本地交易和无交易。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>连接管理器可配置性</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>J2CA框架基于拦截器，它允许插入连接框架的不同部分。<br class="atl-forced-newline" clear="none">尽管您现在不能插入自定义连接管理器，但是可以轻松添加此功能。</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>如果需要，您可以插入自己的自定义连接管理器。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>JTA实施</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>交易支持通过JOTM和HOWL提供。</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>通过JBossJTA全面支持JTA。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>连接池和管理</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>定制Geronimo代码和TranQL用于连接池和管理。</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>用于连接池和管理的JBossCX框架。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>旧版驱动程序支持</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Geronimo还通过Geronimo中的JCA包装器通过TranQL-连接器JDBC提供了此功能。支持JDBC 3.0和2.1。</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>JBoss通过用于JDBC驱动程序的JCA包装器提供了与尚未实现JCA-JDBC驱动程序的RDBMS的连接。</p></td></tr></tbody></table></div>

<p><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">回到顶部</a></p>

<h1 id="JBosstoGeronimo-JDBCMigration-SampleapplicationsampleApp">示例应用程序<parameter ac:name="">sampleApp</parameter></h1>

<p>本文包含一个示例应用程序，以演示从JBoss迁移到Geronimo的应用程序，称为<a shape="rect" href="jboss-to-geronimo-jdbc-migration.data/brokerage.zip?version=1&modificationDate=1204181195000&api=v2" data-linked-resource-id="20874013" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="brokerage.zip" data-nice-type="Zip Archive" data-linked-resource-content-type="application/zip" data-linked-resource-container-id="20645281" data-linked-resource-container-version="20">Online Brokerage</a> 。它代表一种在线交易场景，用户可以在其中买卖股票。该应用程序具有以下五个页面：</p>
<ul><li>登录页面</li><li>注册页面</li><li>用户信息页面</li><li>可用库存页面</li><li>用户组合页面</li></ul>


<p>下图说明了应用程序流程：<br clear="none">
<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="jboss-to-geronimo-jdbc-migration.data/JSP_flow.jpg"></span></p>

<p>首先，您访问“登录”页面。在“登录”页面中，输入用户名和密码。如果用户名或密码无效，则应用程序将引发错误消息并拒绝您的登录尝试。如果用户名和密码正确，则将转到“ <strong>可用库存”</strong>页面，您可以在该页面查看当时所有待售的库存。</p>

<p>通过单击“ <strong>购买”</strong>按钮，可以根据帐户中的可用资金选择购买所需数量的股票。</p>

<p>交易成功完成后，您将返回到“ <strong>可用库存”</strong>页面，在该页面中可以根据需要购买更多股票。</p>

<p>如果您没有足够的资金购买股票，则该应用程序将引发错误，并且不会处理交易。错误消息显示在“ <strong>可用库存”</strong>页面的顶部。此页面上有一个“用户信息”按钮。单击此按钮后，您将转到“用户信息”页面并显示用户详细信息。</p>

<p>在“ <strong>可用股票”</strong>页面上，有一个“ <strong>查看您的投资组合”</strong>链接，其中显示了您拥有的所有股票。在该页面中，您可以选择要出售的库存和数量。此页面还在“ <strong>用户现金”</strong>字段中显示您的可用现金。如果您尝试出售的股票多于现有股票，则应用程序将引发错误。错误消息将显示在同一页面上。对于每次成功的销售，销售金额都会添加到用户的现金余额中。</p>

<p>数量文本框显示您拥有的特定公司的股票数量。“要<strong>出售</strong>的数量”字段允许您输入要出售给特定公司的库存数量。对于买卖，应检查单选按钮。输入值后即可完成。如果未填满要售数量文本框或未选中选择框，然后按销售，则将触发JavaScript警报，提示必填字段为空。输入非数字字符表示数量时，将触发另一个警报。对于“可用库存”页面，此行为也类似。</p>

<p>如果您是新用户，则可以通过单击登录页面中的“ <strong>注册”</strong>按钮进行注册。在“注册”页面中，您将输入用户ID，用户名，密码，地址和可用现金。</p>

<p><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">回到顶部</a></p>

<h2 id="JBosstoGeronimo-JDBCMigration-ApplicationclassesandJSPpages">应用程序类和JSP页面</h2>

<p>Online Brokerage示例应用程序包含以下软件包：</p>
<ul><li>com.dev.trade.bo<ul><li>股票-代表公司的股票。</li><li>用户-代表用户。</li></ul>
	</li></ul>


<ul><li>com.dev.trade.dao<ul><li>TradeDAO-包含所有数据库访问方法。</li></ul>
	</li></ul>


<ul><li>com.dev.trade.exception<ul><li>DBException-为所有数据库异常引发的定制异常类。</li></ul>
	</li></ul>


<ul><li>com.dev.trade.servlet<ul><li>TradeDispatcherServlet-执行所需的数据库功能后，将所有请求分派到JSP。</li></ul>
	</li></ul>


<p>在线经纪业务还包括以下JSP页面：</p>
<ul><li>login.jsp-应用程序的登录页面。</li><li>error.jsp-应用程序的默认错误页面。</li><li>register.jsp-用户注册页面。</li><li>stocks.jsp-用户可以从中购买股票的“可用股票”页面。</li><li>userstocks.jsp-用户投资组合页面，显示用户的股票。用户可以从该页面出售股票。</li></ul>


<p><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">回到顶部</a></p>

<h2 id="JBosstoGeronimo-JDBCMigration-Toolsused">使用的工具</h2>

<p>用于开发和构建在线经纪应用程序的工具是：</p>

<h3 id="JBosstoGeronimo-JDBCMigration-Eclipse">日食</h3>

<p>Eclipse IDE用于示例应用程序的开发。这是一个非常强大且流行的开源开发工具。集成插件可用于JBoss和Geronimo。可以从以下URL下载Eclipse：<br clear="none">
<a shape="rect" class="external-link" href="http://www.eclipse.org" rel="nofollow">http://www.eclipse.org</a></p>

<h3 id="JBosstoGeronimo-JDBCMigration-ApacheAnt">阿帕奇蚂蚁</h3>

<p>Ant是一个纯Java构建工具。它用于构建war文件并为Online Brokerage应用程序填充数据库。可以从以下URL下载Ant：<br clear="none">
<a shape="rect" class="external-link" href="http://ant.apache.org">http://ant.apache.org</a></p>

<p><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">回到顶部</a></p>

<h2 id="JBosstoGeronimo-JDBCMigration-Sampledatabase">样本数据库</h2>

<p>用于降级该应用程序的数据库是MySQL。示例数据库的名称为<strong>tradedb</strong> ，它由以下三个表STOCKS，USERS和TRADINGACCOUNT组成。这些表中的每个字段的说明如下。</p>
<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>表名</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>领域</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>股票</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>ID（主键）<br class="atl-forced-newline" clear="none">名称<br class="atl-forced-newline" clear="none">价钱</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>用户</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>USERID（主密钥）<br class="atl-forced-newline" clear="none">名称<br class="atl-forced-newline" clear="none">密码<br class="atl-forced-newline" clear="none">地址<br class="atl-forced-newline" clear="none">现金</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>交易账户</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>用户身份<br class="atl-forced-newline" clear="none">股票<br class="atl-forced-newline" clear="none">数量</p></td></tr></tbody></table></div>

<p><strong>TRADINGACCOUNT</strong>表用于存储每个用户拥有的股票。<strong>USERS</strong>和<strong>STOCKS</strong>表用于存储用户和库存详细信息。因为这只是一个示例应用程序，所以在用户注册期间，用户自己输入了用户所拥有的金额。</p>

<p>用于填充此数据库的DDL文件是db.sql，它位于brokerage / sql目录中。</p>

<p><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">回到顶部</a></p>

<h1 id="JBosstoGeronimo-JDBCMigration-TheJBossenvironmentJBoss">JBoss环境<parameter ac:name="">JBoss</parameter></h1>

<p>本节向您展示示例JBoss参考环境的安装方式和安装位置，以便您可以将这种情况映射到您自己的实现中。</p>

<p>产品文档中提供了有关安装，配置和管理JBoss的详细说明。在产品网站上查看最新文档。</p>

<p>以下列表突出显示了您需要完成的一般任务，以完成安装和配置初始环境作为部署示例应用程序的起点。</p>
<ol><li>按照产品文档指南中的说明下载并安装JBoss v4。从现在开始，安装目录将被称为<code><jboss_home></code></li><li>创建默认的JBoss v4应用程序服务器的副本。递归复制<code><jboss_home>\server\default</code>至<code><jboss_home>\server\<your_server_name></code></li><li>通过运行以下命令启动新服务器<code>run.sh -c <your_server_name></code>来自的命令<code><jboss_home>\bin</code>目录。</li><li>服务器启动后，可以通过打开Web浏览器并将其指向以下URL来验证它是否正在运行： <a shape="rect" class="external-link" href="http://localhost:8080" rel="nofollow">http：// localhost：8080</a> 。您将看到“ JBoss欢迎”窗口，并能够访问JBoss控制台。</li><li>一旦应用程序服务器启动并运行，下一步就是安装和配置示例应用程序所需的所有其余必备软件。下一节将介绍此步骤。</li></ol>


<p><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">回到顶部</a></p>

<h2 id="JBosstoGeronimo-JDBCMigration-Installandconfigureprerequisitesoftware">安装和配置必备软件</h2>

<p>为了构建和运行本文中包含的Online Brokerage应用程序，您必须安装和配置构建工具以及该应用程序使用的数据库。</p>

<h3 id="JBosstoGeronimo-JDBCMigration-Installthedatabase">安装数据库</h3>

<p>如本文前面所述，此应用程序正在使用可从以下URL下载的MySQL数据库：<br clear="none">
<a shape="rect" class="external-link" href="http://www.mysql.com" rel="nofollow">http://www.mysql.com</a><br clear="none">MySQL的安装和配置非常直观，并且在以下URL的《 MySQL参考手册》中有详细记录：</p>

<p><a shape="rect" class="external-link" href="http://dev.mysql.com/doc/mysql/en" rel="nofollow">http://dev.mysql.com/doc/mysql/zh</a></p>

<p><strong>注意：</strong>在实例配置期间，修改了安全设置并指定了<strong>密码</strong>作为root用户的密码。此用户ID和密码以后将用于从示例应用程序访问数据库。</p>

<h3 id="JBosstoGeronimo-JDBCMigration-Createsampledatabase">创建样本数据库</h3>

<p>配置MySQL实例后，您需要创建示例数据库，该数据库将由Online Brokerage应用程序使用。在命令行中，键入以下命令以启动MySQL监视器：</p>

<p><code><strong>mysql -u root -ppassword</strong></code></p>

<p>请注意，标志<strong>-p</strong>和密码之间没有空格。</p>

<p>这将打开MySQL命令界面，如以下示例所示：</p>
<parameter ac:name="title">MySQL监视器界面</parameter> <parameter ac:name="borderStyle">稳定</parameter> <plain-text-body>欢迎使用MySQL监视器。命令以*; *或* \ g *结尾。您与服务器版本的MySQL连接ID为7：4.1.14-nt输入* help; *或* \ h *获取帮助。键入* \ c *清除缓冲区。mysql></plain-text-body>
<p>在MySQL命令界面中，通过键入以下命令来创建tradedb示例数据库：</p>

<p><code><strong>mysql> create database tradedb;</strong></code></p>

<h3 id="JBosstoGeronimo-JDBCMigration-ConfigureAnt">配置蚂蚁</h3>

<p>如前所述，Apache Ant用于构建Online Brokerage应用程序的二进制文件。如果您没有安装Ant，那么这是个不错的时机，并确保将<strong><ant_home>\ bin</ant_home></strong>目录添加到系统的path变量中。</p>

<p>可以从以下URL下载Apache Ant：</p>

<p><a shape="rect" class="external-link" href="http://ant.apache.org">http://ant.apache.org</a></p>

<p><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">回到顶部</a></p>

<h2 id="JBosstoGeronimo-JDBCMigration-Configureresources">配置资源</h2>

<p>为了成功构建和部署Online Brokerage应用程序和数据库，您将首先配置一些资源。本节介绍如何在JBoss中配置MySQL数据源。</p>

<h3 id="JBosstoGeronimo-JDBCMigration-Datasource">数据源</h3>

<p>Online Brokerage应用程序是一个Web应用程序，它使用数据源连接到MySQL数据库。要将JBoss与MySQL一起使用，必须将MySQL驱动程序复制到JBoss服务器的类路径中。数据库供应商提供的驱动程序称为Connector / J 3.0，可以从以下URL下载：<br clear="none">
<a shape="rect" class="external-link" href="http://dev.mysql.com/downloads/connector/j/3.1.html" rel="nofollow">http://dev.mysql.com/downloads/connector/j/3.1.html</a></p>

<p>下载并解压缩驱动程序后，复制<code>mysql-connector-java-3.1.14.jar</code>归档到<code><jboss_home>\server\<your_server_name>\lib</code>目录。</p>

<p>JBoss中的数据源配置是通过XML配置文件完成的。JBoss安装包含用于许多流行数据库（包括MySQL）的示例配置文件。</p>

<p>MySQL的示例数据源配置文件是<code>mysql-ds.xml</code>它位于<code><jboss_home>\docs\examples\jca</code>目录：</p>

<p>将mysql-ds.xml文件复制到JBoss服务器的deploy目录（ <code><jboss_home>\server\<your_server_name>\deploy</code> ）并按以下示例所示进行编辑：</p>
<parameter ac:name="">xml</parameter> <parameter ac:name="title">更新mysql-ds.xml文件</parameter> <parameter ac:name="borderStyle">固体</parameter> <plain-text-body><jndi-name>jdbc / TradeDB</jndi-name> <connection-url>jdbc：mysql：// localhost：3306 / tradedb</connection-url> <driver-class>com.mysql.jdbc。驱动程序</driver-class> <user-name>根</user-name> <password>密码</password> <exception-sorter-class-name>org.jboss.resource.adapter.jdbc.vendor。MySQLExceptionSorter</exception-sorter-class-name>
</plain-text-body>
<p>删除内部的所有其他标签<strong><local-tx-datasource></local-tx-datasource></strong>标记并保存文件。JBoss将自动部署数据源。</p>

<p><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">回到顶部</a></p>

<h2 id="JBosstoGeronimo-JDBCMigration-Buildthesampleapplication">构建示例应用程序</h2>

<p>本文随附的Online Brokerage应用程序提供了一个Ant脚本，您可以使用该脚本来构建该应用程序并填充数据库。从以下链接下载在线经纪应用程序：</p>

<p><a shape="rect" href="jboss-to-geronimo-jdbc-migration.data/brokerage.zip?version=1&modificationDate=1204181195000&api=v2" data-linked-resource-id="20874013" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="brokerage.zip" data-nice-type="Zip Archive" data-linked-resource-content-type="application/zip" data-linked-resource-container-id="20645281" data-linked-resource-container-version="20">网上经纪</a></p>

<p>解压缩zip文件后，将创建一个代理目录。在该目录中，打开<strong>build.properties</strong>文件，然后编辑属性以匹配您的环境，如以下示例所示：</p>
<parameter ac:name="title">更新build.properties文件</parameter> <parameter ac:name="borderStyle">固体</parameter> <plain-text-body>＃与JBoss的任意更换server.name或Geronimo的取决于部署的服务器。server.name = jboss＃替换<java_home>为您的JDK主目录java.home = <java_home>＃ <jboss_home>替换为您的特定JBoss服务器的根目录<jboss_home>\ servers \ <server_name>jboss.home = <jboss_home>＃ <geronimo_home>替换为Geronimo的根目录geronimo.home = <geronimo_home>＃完全限定的名称JDBC驱动程序类db.driver = com.mysql.jdbc。驱动程序＃数据库URL db.url = jdbc：mysql：// localhost：3306 / tradedb＃数据库userId db.userid = root＃数据库密码db.password =密码＃用于创建表sql.file = sql / db的脚本文件。 sql＃jdbc驱动程序jar的位置。driver.classpath = <jboss_home>/服务器/ <your_server_name>/lib/mysql-connector-java-3.1.14-bin.jar</your_server_name></jboss_home></geronimo_home></geronimo_home></jboss_home></server_name></jboss_home></jboss_home></java_home></java_home></plain-text-body>
<rich-text-body><p>在build.properties文件中指定driver.classpath时，请确保仅使用正斜杠“ /”，否则构建将找不到jar文件。</p></rich-text-body>
<p>从命令提示符或shell转到Brokerage目录并运行<strong>ant</strong> 。这将构建war文件并将其直接放置在代理目录中。ant构建所产生的战争包含JBoss特定的部署描述符，即<code>jboss-web.xml</code>下例显示了WAR的WEB-INF目录中的文件。</p>
<parameter ac:name="">xml</parameter> <parameter ac:name="title">JBoss部署描述符</parameter> <parameter ac:name="borderStyle">固体</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><jboss-web><context-root>/ brokerage</context-root> <resource-ref><res-ref-name>jdbc / TradeDB</res-ref-name> <res-type>javax.sql。数据源</res-type> <jndi-name>java：jdbc / TradeDB</jndi-name>
  </resource-ref>
</jboss-web>
<!--?xml--></plain-text-body>
<p>resource-ref元素用于映射名称为jdbc / TradeDB的资源。 <code>web.xml</code>文件到具有JNDI名称java：jdbc / TradeDB的资源，即MySQL数据源。</p>

<p><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">回到顶部</a></p>

<h2 id="JBosstoGeronimo-JDBCMigration-Deploythesampleapplication">部署样本应用程序</h2>

<p>要在JBoss中部署Online Brokerage应用程序，请将您刚刚用Ant构建的<strong>brokerage.war</strong>文件复制到以下目录：</p>

<p><code><jboss_home>\server\<your_server_name>\deploy</code></p>

<p>如果JBoss已经启动，它将自动部署并启动应用程序；否则，该应用程序将被部署并在下次启动时启动。</p>

<p><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">回到顶部</a></p>

<h2 id="JBosstoGeronimo-JDBCMigration-Testthesampleapplication">测试示例应用程序</h2>

<p>要测试该应用程序，请打开Web浏览器并访问以下URL：</p>

<p><a shape="rect" class="external-link" href="http://localhost:8080/brokerage" rel="nofollow">http：// localhost：8080 / brokerage</a></p>

<p>这将打开Online Brokerage应用程序的登录屏幕。输入<strong>j2ee</strong>作为用户名，输入<strong>password</strong>作为密码，然后单击<strong>login</strong> 。这将带您到下图所示的可用库存页面。现在，该应用程序已配置并正在运行。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="jboss-to-geronimo-jdbc-migration.data/availableStocks.jpg"></span></p>
<parameter ac:name="title">专家提示</parameter><rich-text-body><p>如果要使用另一个root密码数据库，与所需的密码更换<strong>密码</strong>的发生。必须在以下三个地方进行更改：</p>
<ol><li>MySQL实例配置。</li><li>数据源配置文件。</li><li>Ant构建脚本使用的build.properties文件。</li></ol>
</rich-text-body>
<p><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">回到顶部</a></p>

<h1 id="JBosstoGeronimo-JDBCMigration-TheGeronimoenvironmentGeronimo">Geronimo环境<parameter ac:name="">Geronimo</parameter></h1>

<p>从以下URL下载并安装Geronimo：</p>

<p><a shape="rect" class="external-link" href="http://geronimo.apache.org/downloads.html">http://geronimo.apache.org/downloads.html</a></p>

<p>那里提供的发行说明提供了有关系统要求以及如何安装和启动Geronimo的明确说明。在本文的其余部分中，我们将Geronimo安装目录称为<strong><geronimo_home></geronimo_home></strong> 。</p>
<parameter ac:name="title">TCP / IP端口冲突</parameter><rich-text-body><p>如果您打算在同一台机器上运行JBoss和Geronimo，请考虑至少更改其中一台服务器上的默认服务端口。</p></rich-text-body>
<p><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">回到顶部</a></p>

<h2 id="JBosstoGeronimo-JDBCMigration-Configureresources.1">配置资源</h2>

<p>在Geronimo中，JDBC资源是使用J2EE连接器实现的。因此，您需要编写Geronimo特定的部署计划来部署JDBC数据源。此外，在进行部署时，您需要为部署者提供<strong>tranql-connector-ra-1.3.rar</strong>文件。该RAR文件包含Geronimo的连接池管理逻辑。</p>

<p>为了在Geronimo中运行Online Brokerage应用程序，您将使用与JBoss一起使用的相同MySQL数据库。因此，要准备Geronimo环境，您要做的唯一任务就是配置数据源。</p>

<h3 id="JBosstoGeronimo-JDBCMigration-Configurethedatasource">配置数据源</h3>

<p>您要做的第一件事是将MySQL数据库驱动程序复制到Geronimo存储库中，以便您可以在数据源部署计划中引用它。</p>

<p>Geronimo存储库位于<code><geronimo_home>/repository</code> 。在此目录中，创建一个名为<strong>mysql / mysql-connector-java / 3.1.14-bin的目录，</strong>然后复制<code>mysql-connector-java-3.1.14-bin.jar</code>归档进去。现在，您创建数据源部署计划。</p>
<parameter ac:name="title">不同类型的数据源</parameter><rich-text-body><p>Geronimo支持三种类型的数据源：</p>
<ul><li>全局数据源-对Geronimo实例上的所有应用程序可见。</li><li>应用程序范围的数据源-在定义该数据源的单个应用程序中可见。</li><li>模块范围的数据源-在定义它的单个模块中可见。</li></ul>


<p>对于此迁移练习，您将使用全局数据源。有关配置和使用其他两种类型的数据源的说明，请参见以下developerWorks文章：</p>

<p><a shape="rect" class="external-link" href="http://www.ibm.com/developerworks/opensource/library/os-ag-jdbc/" rel="nofollow">http://www.ibm.com/developerworks/opensource/library/os-ag-jdbc/</a></p></rich-text-body>
<p><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">回到顶部</a></p>

<h4 id="JBosstoGeronimo-JDBCMigration-Createthedatasourcedeploymentplan">创建数据源部署计划</h4>

<p>首先，创建一个名为<strong>mysql-geronimo-plan.xml</strong>的xml文件。复制以下示例中显示的计划，并将其粘贴到xml文件中。</p>
<parameter ac:name="">xml</parameter> <parameter ac:name="title">数据源部署计划</parameter> <parameter ac:name="borderStyle">固定</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><connector xmlns="http://geronimo.apache.org/xml/ns/j2ee/connector-1.2"><dep:environment xmlns:dep="http://geronimo.apache.org/xml/ns/deployment-1.1"><dep:moduleid><dep:groupid>用户</dep:groupid> <dep:artifactid>jdbcdatasource</dep:artifactid> <dep:version>2.0</dep:version> <dep:type>汽车</dep:type></dep:moduleid> <dep:dependencies><dep:dependency><dep:groupid>mysql</dep:groupid> <dep:artifactid>mysql-connector-java</dep:artifactid> <dep:version>3.1.14-bin</dep:version> <dep:type>jar</dep:type></dep:dependency></dep:dependencies></dep:environment> <resourceadapter><outbound-resourceadapter><connection-definition><connectionfactory-interface>javax.sql。数据源</connectionfactory-interface> <connectiondefinition-instance><name>TradeDS</name> <config-property-setting name="UserName">根</config-property-setting> <config-property-setting name="Password">密码</config-property-setting> <config-property-setting name="Driver">com.mysql.jdbc。驱动程序</config-property-setting> <config-property-setting name="ConnectionURL">jdbc：mysql：// localhost：3306 / tradedb</config-property-setting> <config-property-setting name="CommitBeforeAutocommit">false</config-property-setting> <config-property-setting name="ExceptionSorterClass">org.tranql.connector。NoExceptionsAreFatalSorter</config-property-setting> <connectionmanager><local-transaction></local-transaction> <single-pool><max-size>10</max-size> <min-size>0</min-size> <blocking-timeout-milliseconds>5000</blocking-timeout-milliseconds> <idle-timeout-minutes>30</idle-timeout-minutes> <match-one></match-one></single-pool></connectionmanager>
      </connectiondefinition-instance>
    </connection-definition>
  </outbound-resourceadapter>
</resourceadapter>
</connector>
<!--?xml--></plain-text-body>
<p>上面的清单显示了部署J2EE连接器的计划，该连接器将提供对数据库的JDBC访问。根元素是<connector>元素。该元素具有以下四个属性：</connector></p>
<ul><li>xmlns-指定XML名称空间。</li><li>configId-指定Geronimo用来在内部引用连接器的名称。</li><li>parentId-指定此配置的父级。</li></ul>


<p>其他重要元素和属性是：</p>
<ul><li>connectionfactory-interface-必须为javax.sql。数据源。</li><li>connectiondefinition-instance-包含连接到数据库所需的配置属性。</li><li>connectionmanager-包含geronimo连接管理器的配置设置。</li><li>config-property-setting-指定连接器的单个配置属性的值。</li><li>name-数据源的名称。</li><li>local-transaction-此元素的存在使资源适配器能够支持本地事务。如果存在<strong>no-transaction</strong>元素而不是<strong>local-transaction</strong> ，那么资源适配器将不支持事务。如果存在<strong>xa-transaction</strong>元素而不是<strong>local-transaction</strong> ，那么资源适配器将支持xa-transactions。</li><li>单池-包含连接池配置属性，例如单个池的最大大小和最小大小。如果存在<strong>no-pool</strong>元素而不是<strong>single-pool</strong> ，那么将不会合并连接。如果存在<strong>partitioned-pool</strong>元素而不是<strong>single-pool</strong> ，则根据分区类型将有许多连接池。</li><li>max-size-同时允许的最大连接数。</li><li>min-size-连接池的最小大小。</li><li>阻塞超时毫秒-如果池中的所有连接当前都在使用，则在引发异常之前，将使调用者等待连接的时间。</li><li>idle-timeout-minutes-以分钟为单位的时间，如果连接空闲，连接将超时。</li></ul>


<p>下表显示了由config-property-setting元素指定的配置属性。</p>
<div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" rowspan="1" class="confluenceTh"><p>配置属性</p></th><th colspan="1" rowspan="1" class="confluenceTh"><p>含义</p></th></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>司机</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>JDBC驱动程序的全限定类名。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>连接网址</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>JDBC连接URL。驱动程序支持时可以包含参数。例如，要让MySQL使用命名管道而不是TCP / IP，您可以附加<code>?socketFactory=com.mysql.jdbc.NamedPipeSocketFactory</code> JDBC连接URL。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>用户名</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>连接到数据库所需的用户名。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>密码</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>连接数据库所需的密码。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>提交前自动提交</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>如果JDBC驱动程序不提交挂起的数据更改， <code>setAutoCommit</code> （true）被调用。</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>ExceptionSorterClass</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>向池提供信息，以确认发生的异常是否致命。</p></td></tr></tbody></table></div>

<p>创建MySQL部署计划后，我们需要通过运行部署器工具来部署连接池数据源。</p>

<p>启动Geronimo Instance，因为部署程序工具要求服务器已启动并正在运行。</p>

<p>从命令行将目录更改为<geronimo_home>/ bin并运行以下命令：</geronimo_home></p>

<p><strong><code>deploy --user system --password manager deploy <brokerage_home>\plan\mysql-geronimo-plan.xml <geronimo_home>\repository\org\tranql\tranql-connector-ra\1.3\tranql-connector-ra-1.3.rar</code></strong></p>

<p>其中brokerage_home是代理目录的路径。这将部署数据源。<br clear="none">现在，您可以继续进行迁移了。</p>

<p><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">回到顶部</a></p>

<h1 id="JBosstoGeronimo-JDBCMigration-Step-by-stepmigrationmigration">分步迁移<parameter ac:name="">迁移</parameter></h1>

<p>Geronimo不支持通过在运行时设置JNDI属性来访问外部资源（JDBC数据源），如以下示例所示：</p>
<parameter ac:name="borderStyle">实体</parameter> <plain-text-body>上下文ctx = null; Hashtable env = new Hashtable（）; env.put（上下文INITIAL_CONTEXT_FACTORY，“ Geronimo特定工厂”）； env.put（上下文PROVIDER_URL，“ geronimo的提供者URL”）； ctx =新的InitialContext（env）</plain-text-body>
<p>这是因为参考解析是在部署时完成的，并且基于目标组件的JSR-77对象名称。为了将Online Brokerage应用程序迁移到Geronimo，您首先要替换<code>jboss-web.xml</code>带有一个文件<code>geronimo-web.xml</code>该文件是Geronimo特定的描述符文件。</p>

<p>的<code>geronimo-web.xml</code>文件位于<code><brokerage_home>\web\descriptors\geronimo</code>目录，如下例所示。</p>
<parameter ac:name="">xml</parameter> <parameter ac:name="title">geronimo-web.xml</parameter> <parameter ac:name="borderStyle">solid</parameter> <plain-text-body><!--?xml version="1.0" encoding="ISO-8859-1" ?=""--><web-app xmlns="http://geronimo.apache.org/xml/ns/j2ee/web-1.1" xmlns:naming="http://geronimo.apache.org/xml/ns/naming-1.1"><dep:environment xmlns:dep="http://geronimo.apache.org/xml/ns/deployment-1.1"><dep:moduleid><dep:groupid>BrokerageApp</dep:groupid> <dep:artifactid>MySqlDS</dep:artifactid> <dep:version>2.0</dep:version> <dep:type>汽车</dep:type></dep:moduleid> <dep:dependencies><dep:dependency><dep:groupid>用户</dep:groupid> <dep:artifactid>jdbcdatasource</dep:artifactid> <dep:version>2.0</dep:version> <dep:type>汽车</dep:type></dep:dependency></dep:dependencies></dep:environment> <context-root>/经纪人</context-root> <resource-ref><ref-name>jdbc / TradeDB</ref-name> <resource-link>TradeDS</resource-link></resource-ref></web-app><!--?xml--></plain-text-body>
<p>如示例所示，此配置的父级是MySQL J2EE连接器。naming：resource-ref元素将TradeDS数据源映射到名称jdbc / TradeDB。context-root元素提供应用程序的上下文根。</p>


<p>这些是在Geronimo上运行该应用程序所需的唯一更改。</p>

<p>为了为Geronimo构建.war文件，您可以修改示例应用程序随附的build.properties文件，以删除jboss-web.xml并包括geronimo-web.xml。这是通过改变<strong>server.name</strong>属性到Geronimo完成。另外，您还必须在构建脚本中指定属性<strong>geronimo.home</strong> 。</p>

<p>您需要修改的两个值是：</p>

<p><code>server.name=geronimo</code><br clear="none">
<code>geronimo.home=<geronimo_home></code></p>

<p>构建脚本使用build.properties来选择Geronimo的J2EE规范。如果您的<strong>jboss.home</strong>属性仍然有效，则不需要设置此属性。如果未设置此属性，并且jboss.home也无效，则将出现编译错误。您必须将<strong>driver.classpath</strong>设置为指向新的驱动程序jar。现在，从命令提示符转到代理目录并运行ant。这将生成war文件并将其直接放置在代理目录中。</p>

<p><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">回到顶部</a></p>

<h2 id="JBosstoGeronimo-JDBCMigration-Deploythemigratedsampleapplication">部署迁移的样本应用程序</h2>

<p>要部署迁移的Online Brokerage应用程序，请确保Geronimo服务器已启动并正在运行。</p>

<p>在命令行中，将目录更改为<code><geronimo_home>\bin</code>并键入以下命令：</p>

<p><strong><code>deploy --user system --password manager deploy <brokerage_home>/brokerage.war</code></strong></p>

<p>部署应用程序后，打开Web浏览器并访问以下URL：</p>

<p><a shape="rect" class="external-link" href="http://localhost:8080/brokerage" rel="nofollow">http：// localhost：8080 / brokerage</a></p>

<p>使用在JBoss中测试应用程序时使用的用户名和密码登录。</p>

<p><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">回到顶部</a></p>

<h1 id="JBosstoGeronimo-JDBCMigration-Summarysummary">摘要<parameter ac:name="">摘要</parameter></h1>

<p>本文向您展示了如何将示例应用程序从JBoss迁移到Apache Geronimo应用程序服务器。您按照分步说明构建了应用程序，对其进行了部署和运行，然后将其迁移到Geronimo环境中。</p>

<p>下表总结了在此示例应用程序迁移期间发现的主要差异。</p>
<ol><li>在Geronimo特定的部署描述符中，资源引用名称被映射到数据源的名称，这与JBoss特定的部署描述符中将资源名称映射到数据源的JNDI名称不同。</li><li>为了在JBoss中部署数据源，您可以仅将配置文件复制到deploy目录，但是在Geronimo中，您必须使用deployer工具。</li><li>目前，Geronimo不支持通过在运行时设置JNDI属性来访问外部资源（即：JDBC数据源）。必须在部署时指定此资源。</li></ol>


<p><a shape="rect" href="jboss-to-geronimo-jdbc-migration.html">回到顶部</a></p></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : JBoss to Geronimo - JDBC Migration';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2013，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  

</body></html>