<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="LDAP Realm" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi LDAP Realm" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>

  <link href='http://geronimo.apache.org/resources/highlighter/styles/shCoreGeronimo.css' rel='stylesheet' type='text/css' />
  <link href='http://geronimo.apache.org/resources/highlighter/styles/shThemeGeronimo.css' rel='stylesheet' type='text/css' />
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shCore.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushJava.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushXml.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushPlain.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushBash.js' type='text/javascript'></script>
  
  <script type="text/javascript">
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
  </script>

    <title>Apache Geronimo v3.0 Documentation: LDAP Realm</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="configuring-and-administering.html">Configuring and administering</a>&nbsp;&gt;&nbsp;<a href="administering-security.html">Administering Security</a>&nbsp;&gt;&nbsp;<a href="administering-security-realms.html">Administering security realms</a>&nbsp;&gt;&nbsp;<a href="ldap-realm.html">LDAP Realm</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">LDAP Realm</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645469">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645469">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645469">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645469">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645469">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645469">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent">

<p>This document covers some of the alternatives for configuring LDAP Realms in Apache Geronimo v2.1. In previous version of Apache Geronimo, ApacheDS was shipped along with Geronimo.  To reduce the server footprint and exploit the Geronimo plugin architecture the LDAP server is currently available as an optional plugin install rather then being bundled with the Geronimo server for 2.1. Having said this, ApacheDS is not a requirement for configuring an LDAP Realm.  However it will be practical for the purposes of this document to use a local LDAP server.</p>

<p>This document is organized in the following sections:</p>

<style type="text/css">/*<![CDATA[*/
div.rbtoc1572612987315 {padding: 0px;}
div.rbtoc1572612987315 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1572612987315 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class="toc-macro rbtoc1572612987315">
<ul class="toc-indentation"><li><a shape="rect" href="#LDAPRealm-InstallingApacheDSplugin(optional)">Installing ApacheDS plugin (optional)</a>
<ul class="toc-indentation"><li><a shape="rect" href="#LDAPRealm-InstallthepluginfromtheGeronimoAdministrationConsole">Install the plugin from the Geronimo Administration Console</a></li><li><a shape="rect" href="#LDAPRealm-Installthepluginfromthecommandline">Install the plugin from the command line</a></li></ul>
</li><li><a shape="rect" href="#LDAPRealm-DeployingLDAPRealms">Deploying LDAP Realms</a>
<ul class="toc-indentation"><li><a shape="rect" href="#LDAPRealm-UsingtheGeronimoAdministrationConsole">Using the Geronimo Administration Console</a></li><li><a shape="rect" href="#LDAPRealm-Usingthecommandlinedeployer">Using the command line deployer</a>
<ul class="toc-indentation"><li><a shape="rect" href="#LDAPRealm-LDAPRealmdeploymentplan">LDAP Realm deployment plan</a></li></ul>
</li></ul>
</li></ul>
</div>

<h1 id="LDAPRealm-InstallingApacheDSplugin(optional)">Installing ApacheDS plugin (optional)</h1>
<p>If you choose to have your LDAP service provided by ApacheDS and running from within Geronimo you can install it very quickly by installing the plugin. ApacheDS 1.0 plugin for Geronimo is based on Apache Directory v1.5.1 and can be installed from either the command line or the Administration Console.</p>

<h2 id="LDAPRealm-InstallthepluginfromtheGeronimoAdministrationConsole">Install the plugin from the Geronimo Administration Console</h2>

<ul><li>Login into the Geronimo Administration Console.</li><li>Click on <strong>Plugins</strong>.</li><li>Click on <strong>Update Repository List</strong> (optional if you are already pointing to <a shape="rect" class="external-link" href="http://geronimo.apache.org/plugins/geronimo-2.1">http://geronimo.apache.org/plugins/geronimo-2.1</a>).</li><li>Click on <strong>Show Plugins in selected repository</strong>.</li><li>Click on <strong>Apache Geronimo-Apache Directory Server Plugin 1.0 LDAP</strong> link , it should show up as installable.</li><li>Scroll all the way to the bottom of the page and click <strong>Install</strong>.</li></ul>


<p>The plugin will start automatically after the installation.</p>

<h2 id="LDAPRealm-Installthepluginfromthecommandline">Install the plugin from the command line</h2>

<p>From a command line window change directory to <strong>&lt;geronimo_home&gt;/bin</strong> and run the following comamnds:</p>

<ul><li><strong><code>deploy search-plugins</code></strong>.</li><li>Select the appropriate repository from the list, for this example select <strong><code>1. <a shape="rect" class="external-link" href="http://geronimo.apache.org/plugins/geronimo-2.1/">http://geronimo.apache.org/plugins/geronimo-2.1/</a></code></strong>.</li><li>From the following list identify <strong><code>Apache Geronimo-Apache Directory Server Plugin (1.0)</code></strong>, this option will be presented under the <strong><code>LDAP</code></strong> category with an ID number.</li><li>Enter that ID number for the LDAP plugin (e.g.<strong><code>78</code></strong>) and hit <strong>Enter</strong>.</li></ul>


<p>The plugin will start automatically after the installation.</p>

<h1 id="LDAPRealm-DeployingLDAPRealms">Deploying LDAP Realms</h1>
<p>As always, you can choose to deploy assets like the security realm in this case from the Administration Console or the command line.</p>

<h2 id="LDAPRealm-UsingtheGeronimoAdministrationConsole">Using the Geronimo Administration Console</h2>

<ul><li>Login into the Geronimo Administration Console.</li><li>Click on <strong>Security Realms</strong> portlet.</li><li>Click on <strong>Add new security realm</strong>.</li><li>Enter a value for the <strong>Name of Security Realm:</strong>.</li><li>Select <strong>LDAP Realm</strong> from the <strong>Realm Type:</strong> pull-down menu and click <strong>Next</strong>.</li><li>Enter settings corresponding to your LDAP configuration and click <strong>Next</strong>.</li><li>Select Advanced Settings as desired.</li><li>To verify the settings are correct click <strong>Test a Login</strong>.</li><li>Enter a known username and password then click <strong>Next</strong>.</li><li>You should receive a confirmation message the connection succeded <strong>Login succeeded with 1 principals</strong></li><li>Click on <strong>Deploy Realm</strong>.</li></ul>


<p>The LDAP Realm will deploy and you should be able to see it from the <strong>Security Realms</strong> portlet. From there you will be able to further edit the realm.</p>

<p>Note that in order to successfully connect and test this realm your LDAP server must be already configured/pre-loaded with the appropriate data. In other words, what you enter here matches with the one in the server. The LDAP server does not come with any preloaded sample data.</p>

<h2 id="LDAPRealm-Usingthecommandlinedeployer">Using the command line deployer</h2>
<p>As we mentioned, another way to deploy this configuration is via the <a shape="rect" href="tools-and-commands.html">Deployer tool</a> from a command line. By deploying this way you will have to provide a deployment plan with all the configuraton information already there, there will not be an interactive menu this time.</p>

<p>The deployment itself is fairly simple, once you have the deployment plan sorted out run the following command from the <strong>&lt;geronimo_home&gt;/bin</strong> directory:</p>

<p><strong><code>deploy --user system --password manager deploy &lt;deployment_plan_home&gt;/ldap_realm_plan.xml</code></strong></p>

<h3 id="LDAPRealm-LDAPRealmdeploymentplan">LDAP Realm deployment plan</h3>
<p>We mentioned that when using the command line deployer you will need to provide a deployment plan. The purpose of this section is to show you a sample deployment plan, for additional details refer to the <a shape="rect" href="ldap-sample-app-ldap-sample-application.html">ldap-sample-app - LDAP Sample Application</a> section.</p>

<div class="code panel pdl" style="border-style: solid;border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>Sample LDAP Realm deployment plan</b></div><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
&lt;module xmlns="http://geronimo.apache.org/xml/ns/deployment-1.2"&gt;
    &lt;environment&gt;
        &lt;moduleId&gt;
            &lt;groupId&gt;console.realm&lt;/groupId&gt;
            &lt;artifactId&gt;LDAP_Test_Realm&lt;/artifactId&gt;
            &lt;version&gt;1.0&lt;/version&gt;
            &lt;type&gt;car&lt;/type&gt;
        &lt;/moduleId&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.apache.geronimo.framework&lt;/groupId&gt;
                &lt;artifactId&gt;j2ee-security&lt;/artifactId&gt;
                &lt;type&gt;car&lt;/type&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/environment&gt;
    &lt;gbean name="LDAP_Test_Realm" class="org.apache.geronimo.security.realm.GenericSecurityRealm" 
				xsi:type="dep:gbeanType" xmlns:dep="http://geronimo.apache.org/xml/ns/deployment-1.2" 
				xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
        &lt;attribute name="realmName"&gt;LDAP_Test_Realm&lt;/attribute&gt;
        &lt;reference name="ServerInfo"&gt;
            &lt;name&gt;ServerInfo&lt;/name&gt;
        &lt;/reference&gt;
        &lt;xml-reference name="LoginModuleConfiguration"&gt;
            &lt;log:login-config xmlns:log="http://geronimo.apache.org/xml/ns/loginconfig-2.0"&gt;
                &lt;log:login-module control-flag="REQUIRED" wrap-principals="false"&gt;
                    &lt;log:login-domain-name&gt;LDAP_Test_Realm&lt;/log:login-domain-name&gt;
                    &lt;log:login-module-class&gt;org.apache.geronimo.security.realm.providers.LDAPLoginModule&lt;/log:login-module-class&gt;
                    &lt;log:option name="connectionUsername"&gt;uid=admin,ou=system&lt;/log:option&gt;
                    &lt;log:option name="userSearchSubtree"&gt;false&lt;/log:option&gt;
                    &lt;log:option name="roleSearchMatching"&gt;uniqueMember={0}&lt;/log:option&gt;
                    &lt;log:option name="roleBase"&gt;ou=users,ou=system&lt;/log:option&gt;
                    &lt;log:option name="connectionPassword"&gt;secret&lt;/log:option&gt;
                    &lt;log:option name="roleName"&gt;cn&lt;/log:option&gt;
                    &lt;log:option name="initialContextFactory"&gt;com.sun.jndi.ldap.LdapCtxFactory&lt;/log:option&gt;
                    &lt;log:option name="roleSearchSubtree"&gt;false&lt;/log:option&gt;
                    &lt;log:option name="connectionURL"&gt;ldap://localhost:10389&lt;/log:option&gt;
                    &lt;log:option name="userBase"&gt;ou=users,ou=system&lt;/log:option&gt;
                    &lt;log:option name="userSearchMatching"&gt;uid={0}&lt;/log:option&gt;
                    &lt;log:option name="authentication"&gt;simple&lt;/log:option&gt;
                &lt;/log:login-module&gt;
            &lt;/log:login-config&gt;
        &lt;/xml-reference&gt;
    &lt;/gbean&gt;
&lt;/module&gt;
</pre>
</div></div></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : LDAP Realm';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
