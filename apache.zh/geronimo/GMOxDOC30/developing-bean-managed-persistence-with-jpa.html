<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=2">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="Developing bean managed persistence with JPA">
    <meta name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Developing bean managed persistence with JPA">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2010-05-11">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0文档：使用JPA开发bean管理的持久性</title>
  </head>

  <body  onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">主页</a> > <a href="documentation.html">文档</a> > <a href="developing.html">开发</a> > <a href="tutorials.html">教程</a> > <a href="developing-jpa-applications.html">开发JPA应用程序</a> > <a href="developing-bean-managed-persistence-with-jpa.html">使用JPA开发bean管理的持久性</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo v3.0</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">使用JPA开发bean管理的持久性</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645263"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645263">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645263"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645263">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645263"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645263">新增新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>
<p>Java Persistence API是EJB3.0规范（JSR220）下的新编程模型，用于使用Java EE和Java SE管理持久性和对象/关系映射。使用JPA，开发人员可以轻松地开发Java应用程序，这些应用程序使用Java对象和映射在关系数据库管理系统上执行操作。这样，使用JPA开发的Java应用程序不仅可以跨不同平台移植，而且可以使用JPA提供的简单而强大的编程模型轻松开发应用程序。这极大地提高了应用程序在不断变化的数据库世界中的可维护性。JPA使应用程序与数据库连接和操作中涉及的所有复杂性和不可移植的样板代码隔离。</p>

<p>Apache geronimo使用<a shape="rect" class="external-link" href="http://openjpa.apache.org/">OpenJPA</a>向服务器中部署的Java EE应用程序提供Java Persistence API。即使JPA是EJB3.0规范的一部分，它也独立于JPA。因此，JPA可以以相同的统一方式用于JavaSE，Web和ejb应用程序。</p>

<p>下面的教程说明了应用程序管理的实体管理器对象的用法。的<code>EntityManager</code>从创建对象<code>EntityManagerFactory</code> 。的<code>EntityManagerFactory</code>当容器注入对象时<code>@PersistenceUnit(unitName="<PersistentUnitName>")</code>使用注释。实体管理器的持久性上下文不会与任何当前活动的事务一起传播。如果事务跨组件，则指向同一持久性单元的所有实体管理器对象引用将具有不同的持久性上下文。因此，通过其他实体管理器引用看不到通过任何实体管理器引用对实体所做的任何更改。应用程序管理的实体管理器的持久性范围是<code>Extended</code>默认。的<code>transaction-type</code>可以是<code>JTA</code>要么<code>RESOURCE_LOCAL</code> 。如果<code>transaction-type</code>是<code>JTA</code>的<code>EntityManager</code>可以通过致电加入交易<code>joinTransaction()</code>方法。的<code>transaction-type</code>的<code>RESOURCE_LOCAL</code>用于<code>EntityManager</code>对加入全球交易不感兴趣。通常在非JEE环境中使用。总而言之，不对容器管理实体管理器和关联的持久性上下文的生命周期。关闭窗口是应用程序的责任<code>EntityManager</code>明确地反对。持久性上下文默认情况下不限于事务。</p>

<p>本教程将创建一个具有ejb模块和Web模块的企业应用程序。ejb模块的用途<code>Account</code>实体和<code>Person</code>实体。的<code>Account</code>实体有<code>accountNumber</code> ， <code>personId</code>和<code>balance</code>属性。的<code>Person</code>实体有<code>personId</code> ， <code>personName</code>和<code>address</code>属性。的<code>personId</code>在<code>Account</code>实体指<code>personId</code>在<code>Person</code>实体。的<code>AccountBean</code>注入<code>EntityManagerFactory</code>从中创建<code>EntityManager</code>宾语。这是一个有状态会话Bean，具有<code>Account</code>实体对象，对应<code>Person</code>实体对象<code>EntityManager</code>对象和<code>EntityManagerFactory</code>对象作为状态字段。豆有<code>updateAllValues(String address, String personName, double balance)</code>更新方法<code>Account</code>和<code>Person</code>实体属性。它也有<code>deposit(double amount)</code>和<code>withdraw(double amount)</code>提取和存入帐户的方法。在上述所有方法中， <code>EntityManager</code>对象使用以下方式加入活动交易<code>joinTransaction()</code>作为其方法<code>transaction-type</code>是<code>JTA</code> bean的事务由容器管理。的<code>initialize(integer accountNumber)</code>用初始化Bean <code>Account</code>和<code>Person</code>对应于<code>accountNumber</code>作为参数发送。最后， <code>EntityManager</code>对象在中关闭<code>destroy()</code>方法。</p>

<p>网络模块允许用户更新<code>Account</code>实体和<code>Person</code>实体属性和使用一个帐户到另一个帐户的转账金额<code>AccountBean</code> 。的<code>RetrieveAccount.jsp</code>执行更新， <code>TransferAmount.jsp</code>在JTA交易中执行金额转移。</p>

<p>为了开发，部署和运行该应用程序，需要以下环境。</p>

<ul><li>Sun JDK 5.0+（J2SE 1.5）</li><li>Eclipse 3.3.1.1（Europa发行版的Eclipse Classic软件包），特定于平台</li><li>Web工具平台（WTP）2.0.1</li><li>数据工具平台（DTP）1.5.1</li><li>Eclipse建模框架（EMF）2.3.1</li><li>图形编辑框架（GEF）3.3.1</li></ul>


<p>本教程分为以下几节。</p>

<ul><li>设置Eclipse环境</li><li>使用实体创建ejb应用程序</li><li>创建Web应用程序</li><li>设置数据库表和数据源。</li><li>部署（耳朵）应用程序</li><li>运行应用程序</li></ul>


<p>可以从此<a shape="rect" href="developing-bean-managed-persistence-with-jpa.data/BeanManagedJPA-EAR.ear?version=1&modificationDate=1213679496000&api=v2" data-linked-resource-id="20873807" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="BeanManagedJPA-EAR.ear" data-nice-type="Java Archive" data-linked-resource-content-type="application/octet-stream" data-linked-resource-container-id="20645263" data-linked-resource-container-version="22">链接</a>下载整个应用程序。</p>

<h2 id="DevelopingbeanmanagedpersistencewithJPA-SettingtheEclipseenvironment">设置Eclipse环境</h2>

<p>1。下载Apache Geronimo2.1并将其安装在服务器上。查看geronimo文档以了解<br clear="none">说明。</p>

<p>2。安装eclipse IDE，下载geronimo eclipse插件并将其安装在eclipse之上。看看<br clear="none">geronimo eclipse插件文档以获取指导。</p>

<p>3。在Eclipse中为Apache Geronimo2.1创建运行时环境。查看geronimo eclipse插件<br clear="none">有关为Apache Geronimo2.1安装运行时的说明的文档。</p>

<h2 id="DevelopingbeanmanagedpersistencewithJPA-Creatingejbapplicationwithentities">使用实体创建ejb应用程序</h2>

<p>1。打开eclipse工具，然后通过单击将透视图更改为<em>Java EE</em> 。<br clear="none">
  <em>Windows =>打开透视图=>其他</em> 。它将打开“ <em>打开透视图”</em>向导。从中选择<em>Java EE</em><br clear="none">列表，然后单击<em>确定</em>按钮。</p>

<p>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/1.jpg"></span></p>

<p>2。右键单击<em>Package Explorer，</em>然后选择<em>EJB Project</em> 。</p>

<p>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/2.jpg"></span></p>

<p>3。这将打开“ <em>新建EJB项目”</em>向导。提供以下屏幕快照中给出的<em>Project Name</em> ， <em>Target Runtime</em>的值。单击<em>下一步</em>按钮。</p>
<rich-text-body>
<p>如果未设置目标运行时，请创建一个指向geronimo安装目录的新目标运行时。有关更多信息，请参阅geronimo文档，该文档说明了为geronimo设置eclipse插件和设置运行时环境。需要此设置来解决编译期间的类依赖关系。</p></rich-text-body>

<p>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/3.jpg"></span></p>

<p>4。选中下面的屏幕截图中给出的复选框，然后单击<em>下一步</em>按钮。</p>

<p>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/4.jpg"></span></p>

<p>5，选中以下屏幕截图中给出的复选框，然后单击<em>下一步</em>按钮。</p>

<p>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/5.jpg"></span></p>


<p>6。在文本框中提供以下值，然后单击“ <em>完成”</em>按钮。</p>

<p>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/6.jpg"></span></p>

<p>7。右键单击<em>BeanManagedJPA-EJB</em>项目，然后导航到<em>New => Class</em>选项。提供<br clear="none">在<em>New Java Class</em>向导中输入以下值，然后单击<em>Finish</em>按钮。</p>

<p>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/7.jpg"></span></p>


<p>8。将以下内容复制到<code>Account.java</code> 。</p>
<parameter ac:name="">JAVA</parameter> <parameter ac:name="title">Account.java</parameter> <parameter ac:name="borderStyle">固定</parameter> <plain-text-body>包sample.jpa;导入java.io。可序列化；导入javax.persistence。实体;导入javax.persistence。ID;导入javax.persistence。PostLoad;导入javax.persistence。更新后；导入javax.persistence。坚持导入javax.persistence。预更新；导入javax.persistence。表; @Entity @Table（name =“ ACCOUNTBME”）公共类Account实现可序列化的{@Id public int accountNumber; public int personId;公共双重平衡； public Account（）{} public int getAccountNumber（）{return accountNumber; } public void setAccountNumber（int accountNumber）{this.accountNumber = accountNumber; } public int getPersonId（）{return personId; } public void setPersonId（int personId）{this.personId = personId; } public double getBalance（）{返回余额； } public void setBalance（double balance）{this.balance = balance; }}</plain-text-body>

<p>9。同样，如上一步中所述，创建<code>Person.java</code>并添加以下内容。</p>
<parameter ac:name="">JAVA</parameter> <parameter ac:name="title">Person.java</parameter> <parameter ac:name="borderStyle">固定</parameter> <plain-text-body>包sample.jpa;导入java.io。可序列化；导入javax.persistence。实体;导入javax.persistence。ID;导入javax.persistence。表; @Entity @Table（name =“ PERSONBME”）公共类Person实现可序列化的{@Id public int personId; public String personName;公共字符串地址； public Person（）{} public int getPersonId（）{return personId; } public void setPersonId（int personId）{this.personId = personId; } public String getPersonName（）{return personName; } public void setPersonName（String personName）{this.personName = personName; } public String getAddress（）{返回地址； } public void setAddress（String address）{System.out.println（“ Address =” + address）; this.address =地址； }}</plain-text-body>

<p>9。同样，创建<code>AccountInterface.java</code>并复制以下内容。</p>

<parameter ac:name="">JAVA</parameter> <parameter ac:name="title">AccountInterface.java</parameter> <parameter ac:name="borderStyle">固定</parameter> <plain-text-body>包sample.jpa;导入java.util。采集;公共接口AccountInterface {public void initialize（int accountNumber）;公共字符串getPersonName（）;公共无效setPersonName（String personName）;公共字符串getAddress（）;公共无效setAddress（字符串地址）; public double getBalance（）; public void setBalance（double balance）;公共无效updateAllValues（字符串地址，字符串personName，双余额）；公共无效提款（双倍金额）；公共无效存款（双倍金额）； }</plain-text-body>

<p>10。同样，创建<code>AccountBean.java.java</code>并复制以下内容。请注意，几行已被截断以显示。</p>
<parameter ac:name="">JAVA</parameter> <parameter ac:name="title">AccountBean.java</parameter> <parameter ac:name="borderStyle">固定</parameter> <plain-text-body>包sample.jpa;导入javax.annotation。PostConstruct;导入javax.ejb。本地;导入javax.ejb。去掉;导入javax.ejb。有状态导入javax.ejb。交易管理；导入javax.ejb。TransactionManagementType；导入javax.persistence。EntityManager;导入javax.persistence。EntityManagerFactory;导入javax.persistence。PersistenceUnit; @Stateful @TransactionManagement（TransactionManagementType。CONTAINER）@Local（AccountInterface.class）公共类AccountBean实现AccountInterface {@PersistenceUnit（unitName =“ AccountUnit”）私有EntityManagerFactory emf;私有EntityManager em;帐户帐户；人@PostConstruct public void init（）{em = emf.createEntityManager（）; } public void initialize（int accountNumber）{account = em.find（Account.class，accountNumber）; if（account == null）抛出新的IllegalStateException（“未找到帐号（” + accountNumber +“）”）;人= em.find（Person.class，account.getPersonId（））; if（person == null）抛出新的IllegalStateException（“ Person Id（” + account.getPersonId（）+“）找不到。数据库中没有关于帐号（“ + accountNumber +”）“的描述；}公用字符串getPersonName（）{return person.getPersonName（）;} public void setPersonName（String personName）{person.setPersonName（personName）;} public String getAddress（）{return person.getAddress（）;} public void setAddress（String address）{person.setAddress（address）;} public void updateAllValues（String address，String personName，double balance）{em.joinTransaction（）; setAddress（address）; setPersonName（personName）; setBalance（balance）;} public double getBalance（）{return account.getBalance（）;} public void setBalance（double balance）{account.setBalance（balance）;} public void withdraw（双倍金额）{如果（金额> getBalance（））抛出新的IllegalStateException（“要提取的金额（” +金额+“）大于可用余额（” + getBalance（）+“）”））; em.joinTransaction（ ）; setBalance（getBalance（）-金额）;}公共无效存款（双倍金额）{em.joinTransaction（）; setBalance（getBalance（）+金额）; } @删除公共void destroy（）{em.close（）; }}</plain-text-body>

<p>11。如上所述，右键单击<code>META_INF</code>目录<code>BeanManagedJPA-EJB</code>项目和<br clear="none">创建<code>persistence.xml</code> 。将以下内容复制到<code>persistence.xml</code> 。</p>

<parameter ac:name="title">persistence.xml</parameter> <parameter ac:name="borderStyle">固定的</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><persistence xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.0" xsi:schemalocation="http://java.sun.com/xml/ns/persistence   
 http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"><persistence-unit name="AccountUnit" transaction-type="JTA"><description>ContainerManagedJPA</description> <provider>org.apache.openjpa.persistence。PersistenceProviderImpl</provider> <jta-data-source>AccountDS</jta-data-source> <class>sample.jpa。帐户</class> <class>sample.jpa。人</class>
 </persistence-unit>
</persistence>
<!--?xml--></plain-text-body>

<p>12由于我们将使用EJB注释，因此<code>META-INF/ejb-jar.xml</code>将没有任何声明。的内容<code>META-INF/openejb-jar.xml</code>文件应如下所示。否则，请进行相应的修改。</p>

<parameter ac:name="title">openejb-jar.xml</parameter> <parameter ac:name="borderStyle">固态</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><openejb-jar xmlns="http://openejb.apache.org/xml/ns/openejb-jar-2.2" xmlns:naming="http://geronimo.apache.org/xml/ns/naming-1.2" xmlns:sec="http://geronimo.apache.org/xml/ns/security-2.0" xmlns:sys="http://geronimo.apache.org/xml/ns/deployment-1.2"><sys:environment><sys:moduleid><sys:groupid>BeanManagedJPA</sys:groupid> <sys:artifactid>EJB</sys:artifactid> <sys:version>1.0</sys:version> <sys:type>汽车</sys:type></sys:moduleid> <dependencies><dependency><groupid>console.dbpool</groupid> <artifactid>AccountDS</artifactid></dependency></dependencies></sys:environment> <enterprise-beans></enterprise-beans></openejb-jar><!--?xml--></plain-text-body>

<p>13最后的项目<code>BeanManagedJPA-EJB</code>应该如下。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/8.jpg"></span></p>

<h2 id="DevelopingbeanmanagedpersistencewithJPA-Creatingwebapplication">创建Web应用程序</h2>

<p>1。右键单击<em>Project Explorer，</em>然后选择<em>New => Project</em> 。这将弹出“ <em>新建项目”</em>向导。<br clear="none">选择选项<em>Web</em>下的<em>Dynamic Web Project</em> 。单击<em>下一步</em>按钮。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/9.jpg"></span></p>

<p>2。提供下面的“ <em>新建动态Web项目”</em>向导中的屏幕快照中给出的值。请注意， <em>将项目添加到EAR</em>复选框已选中，以将此Web项目添加到在创建<em>BeanManagedJPA-EJB</em>项目期间创建的<em>BeanManagedJPA-</em> <em>EAR</em> 。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/10.jpg"></span></p>

<p>3。在下一个屏幕中，选择下图所示的“ <em>版本”</em>值，然后单击“ <em>下一步”</em>按钮。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/11.jpg"></span></p>

<p>4。选中<em>Generate Deployment Descriptor</em>复选框，然后单击<em>Next</em>按钮。在下一个屏幕上，如下配置部署计划。之后，单击“ <em>完成”</em>按钮以完成创建Web项目。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/12.jpg"></span></p>


<p>5，右键单击Web项目的<em>WebContent</em>文件夹，然后导航到<em>New => HTML</em>以创建如屏幕快照中所示的index.html文件。单击<em>下一步</em>按钮，然后在下一个屏幕上单击<em>完成</em>按钮。屏幕截图下方提供了index.html的内容。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/13.jpg"></span></p>

<parameter ac:name="title">index.html</parameter> <parameter ac:name="borderStyle">实体</parameter> <plain-text-body>
 
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>Bean管理的JPA</title>
 



 <font size="4">
   <a href="/BeanManagedJPA-WEB/ViewAccount.html">查看账户明细</a>
 </font><br>

 <font size="4">
  <a href="/BeanManagedJPA-WEB/TransferAmount.jsp">转账金额</a>
 </font>




</plain-text-body>

<p>6。右键单击Web项目的<em>WebContent</em>文件夹，然后导航到<em>New => HTML</em>以创建如屏幕快照中所示的ViewAccount.html文件。单击<em>下一步</em>按钮，然后在下一个屏幕上单击<em>完成</em>按钮。屏幕截图下方提供了ViewAccount.html的内容。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/14.jpg"></span></p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/15.jpg"></span></p>

<parameter ac:name="title">ViewAccount.html</parameter> <parameter ac:name="borderStyle">实体</parameter> <plain-text-body>

<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Bean管理的JPA</title>



<form name="input" action="/BeanManagedJPA-WEB/RetrieveAccount.jsp" method="get">

<table border="0">
<tbody><tr>
<td align="right"><font color="black" size="4">账号</font></td>
<td align="left"><input type="text" name="accountNumber"></td>
</tr>
<tr>
<td align="right"><input type="submit" value="提交"></td>
<td></td>
</tr>
</tbody></table>

</form>


</plain-text-body>

<p>9。同样，如前面的步骤所示，创建<code>RetrieveAccount.jsp</code> 。jsp的内容如下。</p>
<parameter ac:name="title">RetrieveAccount.jsp</parameter> <parameter ac:name="borderStyle">固体</parameter> <plain-text-body><％@页面语言=“ java” contentType =“ text / html; charset = ISO-8859-1” pageEncoding =“ ISO-8859-1”％> <％@页面import =“ sample.jpa。AccountInterface“％> <％@页面import =” javax.naming。上下文“％> <％@页面import =” javax.naming。InitialContext“％> 


<meta http-equiv="Content-Type" content="text/html; 
 charset=ISO-8859-1">
<title>检索和更新帐户</title>

<％字符串更新= request.getParameter（“ Update”）;字符串cancel = request.getParameter（“ Cancel”）; System.out.println（“ update value =” + update）; System.out.println（“ cancel value =” + cancel）;字符串SubmitValue = null;如果（更新！= null）SubmitValue = update;如果（取消！= null）SubmitValue = cancel; System.out.println（“ 1 Submit value =” + submitValue）;如果（submitValue！= null）{System.out.println（“ 2 Submit value =” + submitValue）; if（submitValue.equals（“ Cancel”））{System.out.println（“ 3 Submit value =” + submitValue）; response.sendRedirect（“ / BeanManagedJPA-WEB /”）; } else if（submitValue.equals（“ Update”））{System.out.println（“ 4 Submit value =” + submitValue）; System.out.println（“更新帐户实体已启动”）；上下文ctx = new InitialContext（）; System.out.println（“ Instantiating beans ...”）; AccountInterface accountBean =（AccountInterface）ctx.lookup（“ java：comp / env / ejb / AccountInterface”）; int accountNumber = Integer.parseInt（request.getParameter（“ accountNumber”））; accountBean.initialize（accountNumber）; accountBean.updateAllValues（request.getParameter（“ address”），request.getParameter（“ personName”），Double.parseDouble（request.getParameter（“ balance”））））; System.out.println（“更新已结束的帐户实体”）; response.sendRedirect（“ / BeanManagedJPA-WEB / RetrieveAccount.jsp？accountNumber =“ + accountNumber）;}} else {上下文ctx = new InitialContext（）; System.out.println（” Instantiating beans ...“）; AccountInterface accountBean =（AccountInterface）ctx.lookup（” java：comp / env / ejb / AccountInterface“）; int accountNumber = Integer.parseInt（request.getParameter（” accountNumber“））; accountBean.initialize（accountNumber）;％> <form name="input" action="/BeanManagedJPA-WEB/RetrieveAccount.jsp">
<table border="0"> 
<tbody><tr>
<td align="right"><font color="black" size="4">账号 ：</font></td>
<td align="left"><font color="red" size="4"><％= accountNumber％></font>
<input type="hidden" name="accountNumber" value="<%=accountNumber%>">
</td>
</tr>
<tr>
<td align="right"><font color="black" size="4">人名：</font></td>
<td align="left"><font color="red" size="4"><％= accountBean.getPersonName（）％></font></td>
</tr>
<tr>
<td align="right"><font color="black" size="4">更新人员名称：</font></td>
<td align="left"><input type="text" name="personName"></td>
</tr>
<tr>
<td align="right"><font color="black" size="4">地址 ：</font></td>
<td align="left"><font color="red" size="4"><％= accountBean.getAddress（）％></font></td>
</tr>
<tr>
<td align="right"><font color="black" size="4">更新地址：</font></td>
<td align="left"><input type="text" name="address"></td>
</tr>
<tr>
<td align="right"><font color="black" size="4">余额：</font></td>
<td align="left"><font color="red" size="4"><％= accountBean.getBalance（）％></font></td>
</tr>
<tr>
<td align="right"><font color="black" size="4">更新余额：</font></td>
<td align="left"><input type="text" name="balance"></td>
</tr>
<tr>
<td align="right"><input type="submit" name="Update" value="更新资料"></td>
<td align="left"><input type="submit" name="Cancel" value="取消"></td>
</tr>
</tbody></table>
</form> <％}％>

</plain-text-body>


<p>10。同样，如前面的步骤所示，创建<code>TransferAmount.jsp</code> 。jsp的内容如下。</p>
<parameter ac:name="title">TransferAmount.jsp</parameter> <parameter ac:name="borderStyle">固体</parameter> <plain-text-body><％@页面语言=“ java” contentType =“ text / html; charset = ISO-8859-1” pageEncoding =“ ISO-8859-1”％> <％@页面import =“ sample.jpa。AccountInterface“％> <％@页面import =” javax.naming。上下文“％> <％@页面import =” javax.naming。InitialContext“％> <％@页面import =” javax.transaction。UserTransaction“％> 


<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>转账金额</title>

<％字符串SubmitValue = request.getParameter（“ Transfer”）;如果（提交值！= null）{int debitAccount = Integer.parseInt（request.getParameter（“ accountNumber1”））; int creditAccount = Integer.parseInt（request.getParameter（“ accountNumber2”））;双倍金额= Double.parseDouble（request.getParameter（“ amount”）））;上下文ctx = new InitialContext（）; AccountInterface debitAccountBean =（AccountInterface）ctx.lookup（“ java：comp / env / ejb / AccountInterface”）; debitAccountBean.initialize（debitAccount）; AccountInterface creditAccountBean =（AccountInterface）ctx.lookup（“ java：comp / env / ejb / AccountInterface”）; creditAccountBean.initialize（creditAccount）; UserTransaction ut =（UserTransaction）ctx.lookup（“ java：comp / UserTransaction”）; ut.begin（）; debitAccountBean.withdraw（amount）; creditAccountBean.deposit（amount）; ut.commit（）; response.sendRedirect（“ / BeanManagedJPA-WEB /”）; }其他{％> <form name="input" action="/BeanManagedJPA-WEB/TransferAmount.jsp" method="get">
<table border="0">
<tbody><tr>
<td align="right"><font color="black" size="4">借方帐号：</font></td>
<td align="left"><input type="text" name="accountNumber1">
 </td>
</tr>
<tr>
<td align="right"><font color="black" size="4">贷方帐号：</font></td>
<td align="left"><input type="text" name="accountNumber2"></td>
</tr>
<tr>
<td align="right"><font color="black" size="4">转账金额：</font></td>
<td align="left"><input type="text" name="amount"></td>
</tr>
<tr>
<td align="right"><input type="submit" name="Transfer" value="传递"></td>
<td></td>
</tr>
</tbody></table>
</form> <％}％>

</plain-text-body>

<p>11。右键点击<code>BeanManagedJPA-WEB</code>项目，然后单击<em>属性</em>以打开<em>BeanManagedJPA-WEB</em>向导的<em>属性</em> 。单击<em>Java构建路径</em>和<em>项目</em>选项卡。单击<em>添加</em>按钮并添加<code>BeanManagedJPA-EJB</code>项目。最后，在<em>BeanManagedJPA-WEB</em>向导的<em>Properties</em>上单击<em>OK</em>按钮。这是必需的，因为， <code>BeanManagedJPA-WEB</code>项目查找<code>AccountInterface</code> ejb在<code>BeanManagedJPA-EJB</code>项目。为了解决编译期间的依赖性，必须将EJB项目添加到WEB项目的构建路径。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/16.jpg"></span></p>


<h2 id="DevelopingbeanmanagedpersistencewithJPA-SettingupthedatabasetablesandtheDatasource">设置数据库表和数据源</h2>

<p>1。启动geronimo服务器，并在带有url的浏览器窗口中打开管理控制台<br clear="none">
   <a shape="rect" class="external-link" href="http://localhost:8080/console" rel="nofollow">http：// localhost：8080 / console</a> 。</p>

<p>2。单击<em>控制台导航</em> portlet上的<em>Embedded DB => DB Manager</em> 。</p>

<p>3。在右侧的<em>Run SQL</em> portlet上，在<em>Create DB</em>文本框中输入<em>AccountDB</em> ，然后单击<br clear="none">
  <em>创建</em>按钮。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/17.jpg"></span></p>

<p>4。上面的步骤将创建<code>AccountDB</code>数据库。在同一屏幕上，在“ <em>SQL命令”</em>文本区域中输入以下SQL命令，然后在“ <em>使用数据库”</em>组合框中选择<em>AccountDB</em> ，然后单击“ <em>运行SQL”</em>按钮。这将在<em>AccountDB</em>数据库中创建<em>ACCOUNTCME</em>表。</p>

<parameter ac:name="borderStyle">实体</parameter> <plain-text-body>创建表ACCOUNTBME（ACCOUNTNUMBER整数，PERSONID整数，余额小数（15,2））；</plain-text-body>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/18.jpg"></span></p>

<p>5，同样，在“ <em>SQL命令”</em>文本区域中输入以下SQL命令，然后在“ <em>使用数据库”</em>组合框中选择<em>AccountDB</em> ，然后单击“ <em>运行SQL”</em>按钮。这将在<em>AccountDB</em>数据库中创建<em>PERSONBME</em>表。</p>

<parameter ac:name="borderStyle">实体</parameter> <plain-text-body>创建表PERSONBME（PERSONID整数，PERSONNAME varchar（255），ADDRESS varchar（255））；</plain-text-body>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/19.jpg"></span></p>


<p>6。使用以下SQL命令插入两行。</p>

<parameter ac:name="borderStyle">牢固</parameter> <plain-text-body>插入PERSONBME值（1，Shane Gibson，XXXX）；插入PERSONBME值（2，“ Rameez Raza”，“ YYYY”）；插入ACCOUNTBME值（10,1,6500）;插入ACCOUNTBME值（11,2,9000）;</plain-text-body>
<p>插入行后，表格将如下图所示。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/20.jpg"></span></p>


<p>7。我们需要通过AccountDB数据库为JPA部署数据源。 JPA将使用此数据源连接到数据库并执行DML操作。管理控制台可用于通过AccountDB部署数据源。单击<em>控制台=>导航</em> portlet中的<em>服务=>数据库池</em> 。这将显示服务器中当前正在运行的数据库池的列表。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/21.jpg"></span></p>


<p>8。单击<em>使用Geronimo数据库池向导</em>链接。这将打开<em>数据库池</em> portlet，如下所示。将<em>“数据库池的名称”</em>的值提供为<em>AccountDS，</em>然后按如下所示选择“ <em>嵌入式Derby”</em> ，然后单击“ <em>下一步”</em>按钮。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/22.jpg"></span></p>


<p>9。在下一个屏幕上，选择“ <em>驱动程序JAR”</em>选择框中列出的JAR文件，并提供<em>AccountDB</em>作为“数据库名称”的值，然后单击底部的“ <em>部署”</em>按钮。这将部署数据源并显示服务器上当前部署的数据源列表。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/23.jpg"></span></p>

<p>10。在月食中，打开<code>openejb-jar.xml</code>并提供对<code>AccountDS</code> 。最后， <code>openejb-jar.xml</code>应该如下。<em>使用</em>上面的<em>实体创建ejb应用程序</em>的步骤12中已经完成了此配置。</p>

<h2 id="DevelopingbeanmanagedpersistencewithJPA-Deployingthe(ear)application">部署（耳朵）应用程序</h2>

<p>1。如下部署EAR文件</p>
<parameter ac:name="borderStyle">固态</parameter> <plain-text-body>C：\ Geronimo-2.1 \ bin> deploy.bat-用户系统-密码管理器部署c：\ temp \ BeanManagedJPA-EAR.ear使用GERONIMO_BASE：C：\ Geronimo-2.1使用GERONIMO_HOME：C：\ Geronimo-2.1使用GERONIMO_TMPDIR：var \ temp使用JRE_HOME：C：\ SDK-May-31-2007 \ jre部署了default / BeanManagedJPA-EAR / 1.0 / car`-> BeanManagedJPA-WEB.war @ / BeanManagedJPA-WEB`-> BeanManagedJPA-EJB 。罐</plain-text-body>



<h2 id="DevelopingbeanmanagedpersistencewithJPA-Runningtheapplication">运行应用程序</h2>

<p>1。打开浏览器窗口，然后单击<a shape="rect" class="external-link" href="http://localhost:8080/BeanManagedJPA-WEB/" rel="nofollow">http：// localhost：8080 / BeanManagedJPA-WEB /</a> 。这将显示以下屏幕截图。点击<em>查看帐户详细信息</em>链接。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/24.jpg"></span></p>

<p>2。在此页面上，如下所示在“ <em>帐号”</em>文本框中输入<em>10</em> ，然后单击按钮</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/25.jpg"></span></p>

<p>3。这将显示以下屏幕截图。您可以更新“ <em>人员姓名”</em> ，“ <em>地址”</em>和“ <em>余额”</em>值。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/26.jpg"></span></p>

<p>4。输入以下屏幕截图中给出的值，然后单击“ <em>更新”</em>按钮。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/27.jpg"></span></p>

<p>5，按下“ <em>更新”</em>按钮后，将显示以下屏幕截图以及更新后的值。单击<em>取消</em>按钮返回到主页。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/28.jpg"></span></p>

<p>6。单击主页上的<em>转账金额</em>链接。如下面的屏幕截图所示，将打开该页面。输入屏幕快照中给出的<em>借方帐号</em> ， <em>贷方帐号</em>和<em>要转帐的</em>值，然后单击<em>转帐</em>按钮。这会将指定的金额从借方帐户转入贷方帐户。您可以在数据库中进行验证，也可以使用前面显示的“ <em>查看帐户详细信息”</em>链接。</p>

<p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="developing-bean-managed-persistence-with-jpa.data/29.jpg"></span></p></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Developing bean managed persistence with JPA';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2013，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  

</body></html>