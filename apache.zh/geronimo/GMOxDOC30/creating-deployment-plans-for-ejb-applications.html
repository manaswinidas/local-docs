<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=1">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="Creating deployment plans for EJB applications">
    <meta name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Creating deployment plans for EJB applications">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2010-05-11">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0文档：为EJB应用程序创建部署计划</title>
  </head>

  <body  onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">主页</a> > <a href="documentation.html">文档</a> > <a href="creating-deployment-plans.html">创建部署计划</a> > <a href="creating-deployment-plans-for-applications.html">为应用程序</a> <a href="creating-deployment-plans-for-ejb-applications.html">创建部署计划</a> > <a href="creating-deployment-plans-for-ejb-applications.html">为EJB应用程序创建部署计划</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo v3.0</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">为EJB应用程序创建部署计划</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645421"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645421">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645421"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645421">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645421"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645421">添加新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>

<p><parameter ac:name="atlassian-macro-output-type">排队</parameter><rich-text-body></rich-text-body></p><p>Geronimo使用OpenEJB容器提供ejb服务。EJB应用程序需要<code>ejb-jar.xml</code>作为部署描述符，并且<code>openejb-jar.xml</code>作为部署计划。</p>随着Java EE 5的到来，可以使用注释在ejb类本身中声明ejb容器服务，例如事务管理，安全性，生命周期管理。但是，仍然可以通过以下方式提供ejb部署描述符<code>ejb-jar.xml</code>文件。当两个注解和<code>ejb-jar.xml</code>提供文件， <code>ejb-jar.xml</code>文件优先于注释。<p></p>

<p>的<code>openejb-jar.xml</code>该文件包含ejb模块的部署计划。在里面<code>openejb-jar.xml</code>文件，应用程序部署者将映射在以下位置声明的安全角色，ejb名称，数据库资源，JMS资源等。 <code>ejb-jar.xml</code>文件到服务器中部署的相应实体。除此之外，如果要完成任何ejb容器特定的配置，则在此也配置所需的设置。如果ejb模块依赖于服务器中运行的任何第三方库或其他服务，则所有这些第三方库和服务均在服务器中指定<code>openejb-jar.xml</code>文件。某些ejb应用程序要求的类加载要求不同于默认的类加载行为。的<code>openejb-jar.xml</code>文件允许应用程序部署者也进行配置。还有许多其他配置可以通过<code>openejb-jar.xml</code>文件取决于ejb应用程序的需求。以下各节简要说明了<code>openejb-jar.xml</code>该文件可用于配置ejb容器和ejb应用程序。</p>


<h1 id="CreatingdeploymentplansforEJBapplications-SampleplanforaSSBapplication">SSB应用程序的样本计划</h1>
<p>例如，以下XML内容是部署描述符（ <code>ejb-jar.xml</code> ）连接到后端DB2数据库的无状态会话Bean）。</p>

<parameter ac:name="borderStyle">实体</parameter> <parameter ac:name="title">ejb-jar.xml</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><ejb-jar xmlns="http://java.sun.com/xml/ns/javaee" version="3.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://java.sun.com/xml/ns/javaee 
         http://java.sun.com/xml/ns/javaee/ejb-jar_3_0.xsd"><description>无状态会话Bean示例</description> <display-name>无状态会话Bean示例</display-name> <enterprise-beans><session><ejb-name>RetrieveEmployeeInfoBean</ejb-name> <business-remote>examples.session.stateless_dd。检索EmployeeInfo</business-remote> <ejb-class>examples.session.stateless_dd。RetrieveEmployeeInfoBean</ejb-class> <session-type>无状态</session-type> <transaction-type>容器</transaction-type> <resource-ref><res-ref-name>jdbc / DataSource</res-ref-name> <res-type>javax.sql。数据源</res-type> <res-auth>容器</res-auth> <res-sharing-scope>可共享的</res-sharing-scope></resource-ref></session></enterprise-beans> <interceptors><interceptor><interceptor-class>examples.session.stateless_dd。RetrieveEmployeeInfoCallbacks</interceptor-class> <post-construct><lifecycle-callback-method>构造可</lifecycle-callback-method></post-construct> <post-activate><lifecycle-callback-method>激活</lifecycle-callback-method></post-activate> <pre-passivate><lifecycle-callback-method>钝化</lifecycle-callback-method></pre-passivate></interceptor></interceptors> <assembly-descriptor><interceptor-binding><ejb-name>RetrieveEmployeeInfoBean</ejb-name> <interceptor-class>examples.session.stateless_dd。检索EmployeeInfoCallbacks</interceptor-class></interceptor-binding></assembly-descriptor></ejb-jar><!--?xml--></plain-text-body> <rich-text-body>
<p>上面的XML文档的默认名称空间是<code><a shape="rect" class="external-link" href="http://java.sun.com/xml/ns/javaee" rel="nofollow">http://java.sun.com/xml/ns/javaee</a></code> 。没有名称空间前缀的XML元素属于默认名称空间。</p>

<p>在EJB3.0中，大多数部署描述符声明可以通过bean类中的相应注释来完成。但是，如果提供了部署描述符（ <code>ejb-jar.xml</code> ），部署描述符中的声明将覆盖注释。</p></rich-text-body>

<p>ejb模块使用其JNDI名称连接到后端数据源<code>jdbc/DataSource</code>如在声明<code>ejb-jar.xml</code> 。它还声明ejb是无状态会话bean，并为bean提供了一个拦截器类。拦截器类将具有回调方法，当在bean的生命周期中发生相应的事件时，容器将调用这些方法。</p>

<p>对于上述部署描述符，我们将必须提供相应的部署计划文件（ <code>openejb-jar.xml</code> ），将声明的数据源映射到服务器中部署的实际数据源。以下是部署计划。</p>

<parameter ac:name="borderStyle">固体</parameter> <parameter ac:name="title">openejb-jar.xml</parameter> <plain-text-body><openejb-jar xmlns="http://openejb.apache.org/xml/ns/openejb-jar-2.2" xmlns:naming="http://geronimo.apache.org/xml/ns/naming-1.2" xmlns:sec="http://geronimo.apache.org/xml/ns/security-2.0" xmlns:sys="http://geronimo.apache.org/xml/ns/deployment-1.2"><sys:environment><sys:moduleid><sys:groupid>示例</sys:groupid> <sys:artifactid>EmployeeDemo-ejb-dd</sys:artifactid> <sys:version>3.0</sys:version> <sys:type>jar</sys:type></sys:moduleid> <sys:dependencies><sys:dependency><sys:groupid>console.dbpool</sys:groupid> <sys:artifactid>jdbc / FEmployeeDatasource</sys:artifactid> <sys:version>1.0</sys:version> <sys:type>rar</sys:type></sys:dependency></sys:dependencies></sys:environment> <enterprise-beans><session><ejb-name>RetrieveEmployeeInfoBean</ejb-name> <naming:resource-ref><naming:ref-name>jdbc / DataSource</naming:ref-name> <naming:resource-link>jdbc / EmployeeDatasource</naming:resource-link></naming:resource-ref></session></enterprise-beans></openejb-jar></plain-text-body>  
<rich-text-body><p>上面的XML文档的默认名称空间是<code><a shape="rect" class="external-link" href="http://openejb.apache.org/xml/ns/openejb-jar-2.2">http://openejb.apache.org/xml/ns/openejb-jar-2.2</a></code> 。没有名称空间前缀的XML元素属于默认名称空间。</p></rich-text-body>
<p>观察部署计划中出于各种目的使用的各种XML标记和相应的名称空间。</p>

<p><strong><code><sys:environment> .. </sys:environment></code></strong> ：这些元素提供moduleId配置和依赖关系。moduleId元素提供ejb模块的配置名称。因此，在部署ejb模块时，将为其指定配置名称<code>samples/EmployeeDemo-ejb-dd/3.0/jar</code> 。依赖项元素提供ejb模块所依赖的配置和第三方库。这些配置和库将通过类加载器层次结构提供给ejb模块。在这种情况下，ejb模块取决于<code>console.dbpool/jdbc/FEmployeeDatasource/1.0/jar</code>这是连接到后端DB2数据库的已部署数据源的配置。数据源部署数据库连接池（ <code>javax.sql.Datasource</code> ）的名字<code>jdbc/EmployeeDatasource</code> 。</p>

<p><strong><code><enterprise-beans> .. </enterprise-beans></code></strong> ：这些元素可帮助我们配置企业bean。在这种情况下，数据源参考<code>jdbc/DataSource</code>映射到<code>jdbc/EmployeeDatasource</code> 。</p>

<p>在ejb bean类中，以下Java代码用于从数据源获取连接。</p>

<parameter ac:name="borderStyle">可靠的</parameter> <parameter ac:name="title">examples.session.stateless_dd。RetrieveEmployeeInfoBean.java</parameter> <plain-text-body>........上下文initContext = new InitialContext（）;上下文envContext =（Context）initContext.lookup（“ java：comp / env”）;数据源ds =（DataSource）envContext.lookup（“ jdbc / DataSource”）;连接con = ds.getConnection（）; ........
</plain-text-body>

<p>上面的描述符和计划是用于说明如何为Apache Geronimo开发和组装ejb模块的简单说明。同样，许多其他配置也可以在<code>openejb-jar.xml</code> 。该计划的模式为<a shape="rect" class="external-link" href="http://svn.apache.org/repos/asf/geronimo/site/tags/pre-confluence/docs/schemas-1.1/openejb-jar-2.1.xsd">openejb-jar-2.1.xsd</a></p>

<h1 id="CreatingdeploymentplansforEJBapplications-SampleplanforaMDBapplication">MDB应用程序的样本计划</h1>
<p>Apache geronimo随附<a shape="rect" class="external-link" href="http://activemq.apache.org">ActiveMQ</a>消息代理以及<a shape="rect" class="external-link" href="http://activemq.apache.org">ActiveMQ</a>代理的入站和出站JMS资源适配器。此示例说明了如何部署和运行两个侦听jms主题的MDB。 <code>TextTopic</code> 。当Web客户端将消息发布到该主题时，两个MDB将接收到该消息并进行处理。因为消息已发布到主题，所以所有已配置的侦听器（在本例中为两个MDB）都将收到消息的副本。除此之外，我们还将说明如何在应用程序范围内部署JMS资源适配器。通常，资源适配器部署在服务器范围内，并且也可以由所有其他应用程序使用。在此示例中，将JMS资源计划嵌入到应用程序部署计划中<code>geronimo-application.xml</code>并在部署应用程序存档时进行了部署。</p>


<parameter ac:name="title">ejb-jar.xml</parameter> <parameter ac:name="borderStyle">固体</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><ejb-jar><enterprise-beans><message-driven><ejb-name>TextMessageBean1</ejb-name> <ejb-class>sample.mdb。TextMessageBean1</ejb-class> <messaging-type>javax.jms。MessageListener</messaging-type> <transaction-type>Bean</transaction-type> <message-destination-type>javax.jms。主题</message-destination-type> <activation-config><activation-config-property><activation-config-property-name>destinationType</activation-config-property-name> <activation-config-property-value>javax.jms。主题</activation-config-property-value></activation-config-property></activation-config></message-driven> <message-driven><ejb-name>TextMessageBean2</ejb-name> <ejb-class>sample.mdb。TextMessageBean2</ejb-class> <messaging-type>javax.jms。MessageListener</messaging-type> <transaction-type>Bean</transaction-type> <message-destination-type>javax.jms。主题</message-destination-type> <activation-config><activation-config-property><activation-config-property-name>destinationType</activation-config-property-name> <activation-config-property-value>javax.jms。话题</activation-config-property-value>
   </activation-config-property>
  </activation-config>
 </message-driven>

</enterprise-beans>
</ejb-jar>
<!--?xml--></plain-text-body>

<p>的<code>ejb-jar.xml</code>声明两个MDB <code>sample.mdb.TextMessageBean1</code>和<code>sample.mdb.TextMessageBean2</code>都听一个javax.jms。主题目的地。</p>

<parameter ac:name="title">openejb-jar.xml</parameter> <parameter ac:name="borderStyle">固体</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><openejb-jar xmlns="http://openejb.apache.org/xml/ns/openejb-jar-2.2" xmlns:nam="http://geronimo.apache.org/xml/ns/naming-1.2" xmlns:sec="http://geronimo.apache.org/xml/ns/security-2.0" xmlns:sys="http://geronimo.apache.org/xml/ns/deployment-1.2"><sys:environment><sys:moduleid><sys:groupid>示例</sys:groupid> <sys:artifactid>MDB-EJB</sys:artifactid> <sys:version>1.0</sys:version> <sys:type>汽车</sys:type></sys:moduleid></sys:environment> <enterprise-beans><message-driven><ejb-name>TextMessageBean1</ejb-name> <nam:resource-adapter><nam:resource-link>TradeJMSResources</nam:resource-link></nam:resource-adapter> <activation-config><activation-config-property><activation-config-property-name>目标</activation-config-property-name> <activation-config-property-value>TextMessageTopic</activation-config-property-value></activation-config-property> <activation-config-property><activation-config-property-name>destinationType</activation-config-property-name> <activation-config-property-value>javax.jms。主题</activation-config-property-value></activation-config-property></activation-config></message-driven> <message-driven><ejb-name>TextMessageBean2</ejb-name> <nam:resource-adapter><nam:resource-link>TradeJMSResources</nam:resource-link></nam:resource-adapter> <activation-config><activation-config-property><activation-config-property-name>目标</activation-config-property-name> <activation-config-property-value>TextMessageTopic</activation-config-property-value></activation-config-property> <activation-config-property><activation-config-property-name>destinationType</activation-config-property-name> <activation-config-property-value>javax.jms。话题</activation-config-property-value>
        </activation-config-property>

      </activation-config>
    </message-driven> 
 
  </enterprise-beans>
</openejb-jar>
<!--?xml--></plain-text-body>

<p>在部署计划中<code>openejb-jar.xml</code> ，这两个MDB被配置为jms主题的端点侦听器<code>TextMessageTopic</code> 。</p>

<p>两个MDB的代码如下。</p>

<parameter ac:name="">JAVA</parameter> <parameter ac:name="title">TextMessageBean1.java</parameter> <parameter ac:name="borderStyle">固体</parameter> <plain-text-body>包装sample.mdb;导入javax.jms。JMSException;导入javax.jms。信息;导入javax.jms。TextMessage;公共类TextMessageBean1 {public TextMessageBean1（）{} public void onMessage（Message msg）{if（TextMessage的instanceg）{TextMessage tm =（TextMessage）msg;尝试{字符串文本= tm.getText（）; System.out.println（“在TextMessageBean1中收到新消息：” +文本）； System.out.println（“ CustomerId：” + tm.getIntProperty（“ CustomerId”）））; System.out.println（“ CustomerName：” + tm.getStringProperty（“ CustomerName”））; } catch（JMSException e）{e.printStackTrace（）; }}}}</plain-text-body> <parameter ac:name="">JAVA</parameter> <parameter ac:name="title">TextMessageBean2.java</parameter> <parameter ac:name="borderStyle">固定</parameter> <plain-text-body>包sample.mdb;导入javax.jms。JMSException;导入javax.jms。信息;导入javax.jms。TextMessage;公共类TextMessageBean2 {public TextMessageBean2（）{} public void onMessage（Message msg）{if（TextMessage的instanceg）{TextMessage tm =（TextMessage）msg;尝试{字符串文本= tm.getText（）; System.out.println（“在TextMessageBean2中收到新消息：” +文本）； System.out.println（“ CustomerId：” + tm.getIntProperty（“ CustomerId”）））; System.out.println（“ CustomerName：” + tm.getStringProperty（“ CustomerName”））; } catch（JMSException e）{e.printStackTrace（）; }}}}</plain-text-body>

<p>收到消息后，MDB仅打印消息的内容。</p>

<p>该应用程序的Web客户端如下。</p>
<parameter ac:name="title">web.xml</parameter> <parameter ac:name="borderStyle">固定</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><web-app id="WebApp_ID" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee" xmlns:web="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" xsi:schemalocation="http://java.sun.com/xml/ns/javaee 
 http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" version="2.5"><display-name>MDBSampleWEB</display-name> <welcome-file-list><welcome-file>index.html</welcome-file> <welcome-file>index.htm</welcome-file> <welcome-file>index.jsp</welcome-file></welcome-file-list> <servlet><description></description> <display-name>测试</display-name> <servlet-name>测试</servlet-name> <servlet-class>sample.mdb。测试</servlet-class></servlet> <resource-ref><description>jms代理</description> <res-ref-name>jms / broker</res-ref-name> <res-type>javax.jms。TopicConnectionFactory</res-type> <res-auth>容器</res-auth></resource-ref> <resource-env-ref><description>预定义主题</description> <resource-env-ref-name>jms / Topic / TextTopic</resource-env-ref-name> <resource-env-ref-type>javax.jms。主题</resource-env-ref-type></resource-env-ref> <servlet-mapping><servlet-name>测试</servlet-name> <url-pattern>/测试</url-pattern></servlet-mapping>
  </web-app>
<!--?xml--></plain-text-body>

<p>Web客户端声明<code>javax.jms.TopicConnectionFactory</code>以及servlet将消息发布到的主题。此处声明的名称将映射到<code>geronimo-web.xml</code>如下。</p>

<parameter ac:name="title">geronimo-web.xml</parameter> <parameter ac:name="borderStyle">固体</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><web-app xmlns="http://geronimo.apache.org/xml/ns/j2ee/web-2.0.1" xmlns:nam="http://geronimo.apache.org/xml/ns/naming-1.2" xmlns:sec="http://geronimo.apache.org/xml/ns/security-2.0" xmlns:sys="http://geronimo.apache.org/xml/ns/deployment-1.2"><sys:environment><sys:moduleid><sys:groupid>样本</sys:groupid> <sys:artifactid>MDB-Web</sys:artifactid> <sys:version>1.0</sys:version> <sys:type>汽车</sys:type></sys:moduleid></sys:environment> <context-root>/ MDBSampleWEB</context-root> <nam:resource-ref><nam:ref-name>jms / broker</nam:ref-name> <nam:resource-link>jms / TopicConnectionFactory</nam:resource-link></nam:resource-ref> <nam:resource-env-ref><nam:ref-name>jms / Topic / TextTopic</nam:ref-name> <nam:message-destination-link>TextMessageTopic</nam:message-destination-link></nam:resource-env-ref></web-app><!--?xml--></plain-text-body>



<p>请注意<code>jms/TopicConnectionFactory</code>和<code>jms/Topic/TextTopic</code>是实际的连接工厂和jms主题的名称。这些由嵌入在EAR的部署计划中的jms资源计划进行部署，如下所示。</p>

<parameter ac:name="title">application.xml中</parameter> <parameter ac:name="borderStyle">固体</parameter> <plain-text-body><!--?xml version="1.0" encoding="ASCII" ?=""--><application xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee" xmlns:app="http://java.sun.com/xml/ns/javaee/application_5.xsd" xsi:schemalocation="http://java.sun.com/xml/ns/javaee
  http://java.sun.com/xml/ns/javaee/application_5.xsd" version="5"><display-name>MDBSampleEAR</display-name> <module><ejb>MDBSampleEJB.jar</ejb></module> <module><web><web-uri>MDBSampleWEB.war</web-uri> <context-root>MDBSampleWEB</context-root></web></module></application><!--?xml--></plain-text-body> <parameter ac:name="">XML</parameter> <parameter ac:name="title">Geronimo的application.xml中</parameter> <parameter ac:name="borderStyle">固体</parameter> <plain-text-body><!--?xml version="1.0" encoding="UTF-8" ?=""--><application xmlns="http://geronimo.apache.org/xml/ns/j2ee/application-2.0" xmlns:sys="http://geronimo.apache.org/xml/ns/deployment-1.2" application-name="MDBSampleEAR"><sys:environment><sys:moduleid><sys:groupid>默认</sys:groupid> <sys:artifactid>MDBSampleEAR</sys:artifactid></sys:moduleid></sys:environment> <ext-module><connector>TopicJMSSample</connector> <external-path><sys:groupid>org.apache.geronimo.modules</sys:groupid></external-path> <sys:environment><sys:moduleid><sys:version>1.0</sys:version> <sys:type>汽车</sys:type></sys:moduleid></sys:environment> <ext-module><external-path><sys:artifactid>Geronimo的ActiveMQ的-RA</sys:artifactid> <sys:version>2.1</sys:version></external-path> <connector xmlns="http://geronimo.apache.org/xml/ns/j2ee/connector-1.2"><resourceadapter><!--how to connect to the JMS Server--> <resourceadapter-instance><resourceadapter-name>TradeJMSResources</resourceadapter-name> <config-property-setting name="ServerUrl">TCP：//本地主机：61616</config-property-setting> <config-property-setting name="UserName">不需要</config-property-setting> <config-property-setting name="Password">不需要</config-property-setting> <workmanager><gbean-link>DefaultWorkManager</gbean-link></workmanager></resourceadapter-instance> <!--defines a ConnectionFactory--> <outbound-resourceadapter><connection-definition><connectionfactory-interface>javax.jms。ConnectionFactory</connectionfactory-interface> <connectiondefinition-instance><name>jms / TopicConnectionFactory</name> <implemented-interface>javax.jms。TopicConnectionFactory</implemented-interface> <connectionmanager><xa-transaction><transaction-caching></transaction-caching></xa-transaction> <single-pool><max-size>10</max-size> <min-size>0</min-size> <blocking-timeout-milliseconds>5000</blocking-timeout-milliseconds> <idle-timeout-minutes>0</idle-timeout-minutes> <match-one></match-one></single-pool></connectionmanager></connectiondefinition-instance></connection-definition></outbound-resourceadapter></resourceadapter> <adminobject><adminobject-interface>javax.jms。主题</adminobject-interface> <adminobject-class>org.activemq.message。ActiveMQTopic</adminobject-class> <adminobject-instance><message-destination-name>TextMessageTopic</message-destination-name> <config-property-setting name="PhysicalName">TextMessageTopic</config-property-setting></adminobject-instance>
      </adminobject>
     </connector>
    </ext-module>
</ext-module></application>
<!--?xml--></plain-text-body>

<p>下提供了资源适配器的计划<code><ext-module></code> xml元素。另外，资源适配器档案<code>(rar)</code>使用提及用于部署计划的文件<code>external-path</code> xml元素；资源适配器计划遵循以下元素。该计划部署{{jms / TopicConnectionFactory}}并<code>TextTopic</code> 。</p>

<rich-text-body>
<p>在上述计划中，使用以下xml元素提供了对资源归档文件的引用。</p>
<parameter ac:name="">JAVA</parameter> <parameter ac:name="title">引用库</parameter> <parameter ac:name="borderStyle">solid</parameter> <plain-text-body><external-path><sys:groupid>org.apache.geronimo.modules</sys:groupid> <sys:artifactid>geronimo-activemq-ra</sys:artifactid> <sys:version>2.1</sys:version></external-path></plain-text-body>
<p>上面的模式是geronimo引用服务器存储库中可用的各种库的方式。也可以使用管理控制台Portlet将任何外部库上载到服务器存储库。启动服务器后，单击<code>Console Navigation => Services => Repository</code>显示<code>Repository Viewer</code> Portlet。在此portlet中，用户可以通过提供适当的<code>groupId, artifactId and version</code>上载的库的值。仓库中还提供了activeMQ rar文件，如下所示： <code>org.apache.geronimo.modules/geronimo-activemq-ra/2.1/rar</code> 。单击此链接以获取有关如何在其他模块中引用此库的使用说明。</p></rich-text-body>

<p>查找连接工厂和主题并发送消息的Web客户端如下。</p>
<parameter ac:name="">JAVA</parameter> <parameter ac:name="title">Test.java</parameter> <parameter ac:name="borderStyle">固定</parameter> <plain-text-body>包sample.mdb;导入java.io。IOException;导入java.io。PrintWriter;导入javax.jms。DeliveryMode;导入javax.jms。会议；导入javax.jms。TextMessage;导入javax.jms。话题;导入javax.jms。TopicConnection;导入javax.jms。TopicConnectionFactory;导入javax.jms。TopicPublisher；导入javax.jms。TopicSession;导入javax.naming。InitialContext;导入javax.servlet。ServletException;导入javax.servlet.http。HttpServletRequest;导入javax.servlet.http。HttpServletResponse;导入javax.jms。连接;公共类Test扩展了javax.servlet.http。HttpServlet实现javax.servlet。Servlet {静态最终长serialVersionUID = 1L;私有TopicConnection连接；私人主题主题；公共Test（）{super（）; } public void init（）抛出ServletException {字符串connectionFactoryName =“ java：comp / env / jms / broker”;字符串topicName =“ java：comp / env / jms / Topic / TextTopic”;尝试{InitialContext命名= new InitialContext（）; TopicConnectionFactory connectionFactory =（TopicConnectionFactory）naming.lookup（connectionFactoryName）;连接= connectionFactory.createTopicConnection（）; topic =（Topic）naming.lookup（topicName）; } catch（Exception e）{e.printStackTrace（）;抛出新的ServletException（e）; }} public void doGet（HttpServletRequest request，HttpServletResponse response）抛出ServletException，IOException {TopicSession publishSession = null; PrintWriter out = response.getWriter（）;尝试{布尔交易=假; publishSession = connection.createTopicSession（已处理，会话。AUTO_ACKNOWLEDGE）; TopicPublisher发送者= publishSession.createPublisher（topic）; sender.setDeliveryMode（DeliveryMode。持久）; TextMessage消息= publishSession.createTextMessage（“客户信息”）; message.setIntProperty（“ CustomerId”，Integer.parseInt（request.getParameter（“ CustomerId”））））; message.setStringProperty（“ CustomerName”，request.getParameter（“ CustomerName”））; sender.send（message）; out.println（“消息已成功发送...！“）;} catch（Exception e）{抛出新的ServletException（e）;}最终{尝试{如果（publishSession！= null）{publishSession.close（）; }} catch（Exception e）{}}}受保护的void doPost（HttpServletRequest请求，HttpServletResponse响应）抛出ServletException，IOException {} public void destroy（）{if（connection！= null）{试试{如果（连接！= null）{connection.close（）; }} catch（Exception e）{}}}}</plain-text-body>

<p>当在浏览器窗口中访问上述servlet时， <code><a shape="rect" class="external-link" href="http://localhost:8080/MDBSampleWEB/Test?CustomerId=10&CustomerName=Phani" rel="nofollow">http://localhost:8080/MDBSampleWEB/Test?CustomerId=10&CustomerName=Phani</a></code> ，服务器控制台中将显示以下输出。<br clear="none">
<span style="color:white">
<parameter ac:name="borderStyle">稳定</parameter> <plain-text-body>-------------------------------------------在TextMessageBean1中收到新消息：客户信息CustomerId：10 CustomerName：Phani ------------------------------------------ --------------------------------------------在TextMessageBean2中收到新消息：客户信息CustomerId：10 CustomerName：Phani ------------------------------------------ --</plain-text-body></span></p></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Creating deployment plans for EJB applications';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2013，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  

</body></html>