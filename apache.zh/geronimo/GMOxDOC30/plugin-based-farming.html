<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Plugin based Farming" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Plugin based Farming" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>

  <link href='http://geronimo.apache.org/resources/highlighter/styles/shCoreGeronimo.css' rel='stylesheet' type='text/css' />
  <link href='http://geronimo.apache.org/resources/highlighter/styles/shThemeGeronimo.css' rel='stylesheet' type='text/css' />
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shCore.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushJava.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushXml.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushPlain.js' type='text/javascript'></script>
  <script src='http://geronimo.apache.org/resources/highlighter/scripts/shBrushBash.js' type='text/javascript'></script>
  
  <script type="text/javascript">
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all();
  </script>

    <title>Apache Geronimo v3.0 Documentation: Plugin based Farming</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="configuring-and-administering.html">Configuring and administering</a>&nbsp;&gt;&nbsp;<a href="configuring-and-administering-the-apache-geronimo-server.html">Configuring and administering the Apache Geronimo Server</a>&nbsp;&gt;&nbsp;<a href="clustering-and-farming.html">Clustering and farming</a>&nbsp;&gt;&nbsp;<a href="plugin-based-farming.html">Plugin based Farming</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Plugin based Farming</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645455">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645455">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645455">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645455">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645455">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645455">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent">

<p>This farming system uses plugins directly and is thus decoupled from the deployment system. It enables the plugin based farming administration for different servers or machines. Farming information is stored in a database using jps. The data model allows a single administration server to manage:</p>

<ul><li>multiple farms, also termed clusters</li><li>multiple lists of plugins per farm in an M X N relationship</li><li>multiple plugins per plugin list</li></ul>


<p>When a node starts up, it broadcasts a service advertisement including an optional node name and a farm name. When the administration server detects this as new, it instructs the new node to install all the plugin lists associated with that farm. If the plugins are already installed, the system provides no further operation; otherwise the plugins are downloaded and installed from the plugin repository specified in the plugin list.</p>

<p>Farming administrative operations include:</p>

<ul><li>Add a plugin list to a farm</li><li>Add a plugin to a plugin list</li><li>Add a plugin to a plugin list and the list to a farm</li><li>Remove a plugin list from a farm</li><li>Remove a plugin from a plugin list</li></ul>


<p>These operations are available through the GShell <a shape="rect" href="geronimo-gshell-commands.html">cluster/deploy</a> command and are discussed in details in the <a shape="rect" href="plugin-based-farming.html">#Add and remove plugins and plugin lists</a> section.</p>

<h3 id="PluginbasedFarming-ArchitecturalConsiderations">Architectural Considerations</h3>
<p>Plugin based farming requires two separate sets of functionality:</p>

<ul><li>A plugin farm controller that tracks the farms node, plugin lists, and plugins and issues instructions to the nodes.</li><li>A geronimo plugin repository accessible to all farm nodes. This can be a geronimo server running the geronimo-as-maven servlet, the local file system maven repository, a file based repository served by httpd, or a maven repository manager such as nexus. If a geronimo server is used, it can be the same server as the plugin farm controller or a separate server.</li></ul>


<p>The farming information is stored in the PluginFarmDatatabase database on the farm controller.</p>


<h3 id="PluginbasedFarming-Supportingpluginsandassemblies">Supporting plugins and assemblies</h3>
<ul><li><code>org.apache.geronimo.configs/plugin-farm-member//car</code> (plugins/clustering/plugin-farm-member) plugin turns a server into a plugin farm node. You can configure the multicast address and port, cluster name, and node name in <code>&lt;WASCE_HOME&gt;/var/config/config-substitutions.properties</code>.</li><li><code>org.apache.geronimo.assemblies/geronimo-plugin-farm-node//car</code> (plugins/clustering/geronimo-plugin-farm-node) extends the framework assembly with the plugin-farm-member plugin. This is all you need to start up a farm node.</li><li><code>org.apache.geronimo.configs/plugin-farm//car</code> (plugins/clustering/plugin-farm) is the administration plugin for plugin-based farms. Currently it is only accessible through the Gshell <a shape="rect" href="geronimo-gshell-commands.html">cluster/deploy</a> command.</li><li><code>org.apache.geronimo.configs/plugin-farm-datasource//car</code> (plugins/clustering/plugin-farm-datasource) is a derby datasource used by the plugin farm. It is intended to be replaced in production with a remote datasource. As always, the replacement plugin should use an &lt;artifact-alias&gt; element to redirect dependencies on plugin-farm-datasource to itself.</li></ul>


<p>Make sure that the version of the plugins comply with your server. </p>

<h3 id="PluginbasedFarming-Setupsteps">Setup steps</h3>
<p>The following steps demonstrates the plugin based farming using nodes that all share the same geronimo installation. The admin server acts as the farm controller, application deployment server, and plugin repository. The setup steps for plugin based farming includes:</p>
<ol><li><a shape="rect" href="plugin-based-farming.html">#Set up farm controller</a></li><li><a shape="rect" href="plugin-based-farming.html">#Set up farm node</a></li><li><a shape="rect" href="plugin-based-farming.html">#Deploy a sample plugin to the farm</a></li><li><a shape="rect" href="plugin-based-farming.html">#Add and remove plugins and plugin lists</a></li></ol>


<h4 id="PluginbasedFarming-Setupfarmcontroller">Set up farm controller</h4>
<p>1. Start the controller server and install the following plugins in the server repository. For example, for a version 2.2 server, the plugins are stored in the <a shape="rect" class="external-link" href="http://geronimo/apache/org/plugins/geronimo-2.2" rel="nofollow">http://geronimo/apache/org/plugins/geronimo-2.2</a> repository:</p>
<ul><li><code>org.apache.geronimo.configs/plugin-farm//car</code></li><li><code>org.apache.geronimo.configs/plugin-farm-datasource//car</code></li><li><code>org.apache.geronimo.configs/plugin-farm-member//car</code>
<br clear="none" class="atl-forced-newline">
2. Open the <code>config-substitutions.properties</code> file and set the following attributes:
<div class="panel" style="border-style: solid;border-width: 1px;"><div class="panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>Excerpt from config-substitutions.properties</b></div><div class="panelContent">
<p>ClusterName=<em>farm name</em><br clear="none">
NodeName=<em>name</em> <br clear="none">
ServerHostname=<em>Node_IP</em><br clear="none">
DefaultPluginRepository=<em>share install plugin repository</em></p>
</div></div>
where</li><li><code>ClusterName</code>: defines the name of the farm that the server works in.</li><li><code>NodeName</code>: is optional and defaults to <code>host:jndi-port</code>. For example, if the host IP for this server is 9.186.10.157 and the jndi-port is 1099, the default <code>Nodename=9.186.10.157:1099</code>.</li><li><code>ServerHostname</code>:sets the node IP of this server.</li><li><code>DefaultPluginRepository</code>: defines the plugin repository accessible to all farm nodes.  For example, you can use the maven repository as the share install plugin repository by defining <code>DefaultPluginRepository=http\://9.186.10.157\:8080/plugin/maven-repo</code>.
<br clear="none" class="atl-forced-newline">
3. Restart the server.</li></ul>


<h4 id="PluginbasedFarming-Setupfarmnode">Set up farm node </h4>
<p>Use the following steps to set up every node server in the farm:<br clear="none">
1. Start the node server and install the <code>org.apache.geronimo.configs/plugin-farm-member//car</code> plugin in the server repository. For example, for a version 2.2 server, the plugin is stored in the <a shape="rect" class="external-link" href="http://geronimo/apache/org/plugins/geronimo-2.2" rel="nofollow">http://geronimo/apache/org/plugins/geronimo-2.2</a> repository.<br clear="none">
2. Open the <code>config-substitutions.properties</code> file and set the following attributes:</p>
<div class="panel" style="border-style: solid;border-width: 1px;"><div class="panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>Excerpt from config-substitutions.properties</b></div><div class="panelContent">
<p>ClusterName=<em>farm name</em><br clear="none">
ServerHostname=<em>Node_IP</em></p>
</div></div>

<p>3. Add the share install plugin repository to the <code>plugin-repositories.properties</code> file under <code>&lt;WASCE_HOME&gt;/var/config/</code> for each farm node, including access username and password. For example:</p>
<div class="panel" style="border-style: solid;border-width: 1px;"><div class="panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>Excerpt from plugin-repositories.properties</b></div><div class="panelContent">
<p>http\://9.186.10.157\:8080/plugin/maven-repo/=system\=manager</p>
</div></div>
<p>where</p>
<ul><li>the password <code>manger</code> in this example is in plain text. However, it is recommended to encrypt your password with the <a shape="rect" href="deploy.html">deploy encrypt command</a>.</li></ul>


<p>4. Restart the server.</p>

<h4 id="PluginbasedFarming-Deployasampleplugintothefarm">Deploy a sample plugin to the farm</h4>
<p>Install a plugin to the farm controller with command. For example, use the <a shape="rect" href="geronimo-gshell-commands.html">Gshell command</a> as follows to install a HelloWorld.car plugin:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">
deploy/install-plugin D:/HelloWorld.car -s 9.186.10.157
</pre>
</div></div>

<ul><li><code>-s</code>: is a command option that indicates the hostname of the server. For this example, the hostname is 9.186.10.157.</li></ul>


<h4 id="PluginbasedFarming-Addandremovepluginsandpluginlists">Add and remove plugins and plugin lists</h4>
<p>Use the <a shape="rect" href="geronimo-gshell-commands.html">cluster/deploy</a> Gshell command to verify the farm that you set up. For example, add and remove plugins and plugin lists with the following commands:<br clear="none">
Use this command to add a plugin list p1 to farm cluster1:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">cluster/deploy add -c cluster1 -l p1 -s 9.186.10.157 </pre>
</div></div>

<p>Use this command to add the <code>org.apache.geronimo.samples/HelloWorld/1.0/car</code> plugin to plugin list p1:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">cluster/deploy add -l p1 -a org.apache.geronimo.samples/HelloWorld/1.0/car -s 9.186.10.157</pre>
</div></div>

<p>Use this command to add the <code>org.apache.geronimo.samples/HelloWorld/1.0/car</code> plugin to plugin list p1 and add p1 to farm cluster1:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">cluster/deploy add -c cluster1 -l p1 -a org.apache.geronimo.samples/HelloWorld/1.0/car -s 9.186.10.157</pre>
</div></div>

<p>Use this command to remove a plugin list p1 from farm cluster1:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">cluster/deploy remove -c cluster1 -l p1</pre>
</div></div>

<p>Use this command to remove the <code>org.apache.geronimo.samples/HelloWorld/1.0/car</code> plugin from plugin list p1:</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Default">cluster/deploy remove -l p1 -a org.apache.geronimo.samples/HelloWorld/1.0/car -s 9.186.10.157</pre>
</div></div>

<p>Access the <strong>Plugin</strong> portlet form the <strong>Administration console</strong> to verify the installation result for all farm members.</p>


<h3 id="PluginbasedFarming-Futurework">Future work</h3>
<p>The following features could be added in the future:</p>
<ul><li>Provide <strong>Administration console</strong> support for the administrative operations.</li><li>Enhance the monitoring console to find nodes using multicast discovery.</li><li>Provide better support for setting up and starting multiple servers on one geronimo installation.</li><li>Enhance the car-maven-plugin to assemble servers with multiple instance support in the assembly.</li></ul></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Plugin based Farming';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
