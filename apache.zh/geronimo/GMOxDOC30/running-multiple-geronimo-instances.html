<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<html lang="en">
  <head>
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <link type="text/css" rel="stylesheet" href="http://geronimo.apache.org/style/default.css">
    <LINK rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <META name="Description" content="Running multiple Geronimo instances" />
    <META name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Running multiple Geronimo instances" />
    <META name="Owner" content="dev@geronimo.apache.org" />
    <META name="Robots" content="index, follow" />
    <META name="Security" content="Public" />
    <META name="Source" content="wiki template" />
    <META name="DC.Date" scheme="iso8601" content="2010-05-11" />
    <META name="DC.Language" scheme="rfc1766" content="en" />
    <META name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation" />
    <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0 Documentation: Running multiple Geronimo instances</title>
  </head>

  <body onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tr>
        <td valing="top" align="left">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" align="left" nowrap>
          <a href="/geronimo"> Home</a> >&nbsp;<a href="documentation.html">Documentation</a>&nbsp;&gt;&nbsp;<a href="installing-and-running.html">Installing and running</a>&nbsp;&gt;&nbsp;<a href="running-geronimo.html">Running Geronimo</a>&nbsp;&gt;&nbsp;<a href="running-multiple-geronimo-instances.html">Running multiple Geronimo instances</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8" />
            <input type="hidden" name="oe" value="UTF-8" />
            <input type="hidden" name="domains" value="" />
            <input type="hidden" name="sitesearch" value="" />
            <input type="text" name="q" maxlength="255" value="" />        
            <input type="submit" name="btnG" value="Google Search" />
          </form>
        </td>
      </tr> 
    </table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div style="margin: 0px 10px 0px 10px" class="smalltext">Apache Geronimo v3.0</div>
        <div style="margin: 0px 10px 8px 10px"  class="pagetitle">Running multiple Geronimo instances</div>

        <div class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
<!-- -->         
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645442">
            <img src="http://geronimo.apache.org/images/icons/notep_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Edit Page"></a>
            <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645442">Edit Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">
            <img src="http://geronimo.apache.org/images/icons/browse_space.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>
            <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">Browse Space</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645442">
            <img src="http://geronimo.apache.org/images/icons/add_page_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add Page"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645442">Add Page</a>
          &nbsp;
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645442">
            <img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif"
                 height="16" width="16" border="0" align="absmiddle" title="Add News"></a>
          <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645442">Add News</a>
<!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body>


<rich-text-body>
<p>Regarding both Geronimo javaee6 and minimal release bundles. Full support for multiple instances was completed in <a shape="rect" class="external-link" href="https://issues.apache.org/jira/browse/GERONIMO-6270">GERONIMO-6270</a> and its sub-tasks. This support is available in the latest snapshots after March 1, 2012, and will be in the 3.0-beta-2 standard release. This documents how to run multiple instances after applying the changes from GERONIMO-6270.</p>

<p>For prior releases, multiple installations can safely run side-by-side by completely copying the server folder to another, and start the 2nd server installation after changing its portOffset value.</p></rich-text-body>

<h1 id="RunningmultipleGeronimoinstances-GERONIMO_HOMEversusGERONIMO_SERVER"><code>GERONIMO_HOME</code> versus <code>GERONIMO_SERVER</code></h1>

<p>Simply put, <code>GERONIMO_HOME</code> is the path to the server binary installation and <code>GERONIMO_SERVER</code> is the path to the server run-time configuration. <code>GERONIMO_HOME</code> is the path to where Geronimo was installed which every instance references, and every Geronimo instance defines its own <code>GERONIMO_SERVER</code> as the path to the configuration for the instance.</p>

<p>We define <code>GERONIMO_SERVER</code> in order to have the Geronimo start procedures startup an instance.</p>

<h2 id="RunningmultipleGeronimoinstances-PathResolution">Path Resolution</h2>

<p><code>GERONIMO_HOME</code> is obtained during startup relative to the directory Geronimo is installed in. By default, if the user does not define <code>GERONIMO_SERVER</code> it is set to <code>GERONIMO_HOME</code>. If the user defines <code>GERONIMO_SERVER</code> it is attempted to be resolved to an absolute path in the following ways:</p>
<ol><li>First, as an absolute path IFF <code>GERONIMO_SERVER</code> is absolute
	<ul><li><code>GERONIMO_SERVER</code></li></ul>
	</li><li>Second, as a relative path to <code>GERONIMO_HOME</code> IFF <code>GERONIMO_SERVER</code> is not absolute
	<ul><li><code>GERONIMO_HOME</code>/<code>GERONIMO_SERVER</code></li></ul>
	</li></ol>


<h2 id="RunningmultipleGeronimoinstances-TechnicalTerms">Technical Terms</h2>

<p><em>Skip this sub-section if you do not care about the technical internals of Geronimo's use of</em> <code><em>GERONIMO_HOME</em></code> <em>versus</em> <code><em>GERONIMO_SERVER</em></code></p>

<p>Inside Geronimo there is a concept of <code>home</code>, <code>base</code>, and <code>server</code>, with corresponding java properties <code>org.apache.geronimo.home.dir</code> and <code>org.apache.geronimo.server.dir</code>. <code>base</code> and <code>server</code> are the same, but Geronimo references <code>base</code> in general to reference the location for run-time configuration. The definition of <code>server</code> is user provided, and redefines <code>base</code>.</p>

<p>When Geronimo runs, <code>home</code> and <code>base</code> properties are defined relative to the installation directory of Geronimo. When a user starts up a Geronimo instance, the user defines the <code>server</code> property. Defining the <code>server</code> property triggers Geronimo to change its <code>base</code> from <code>home</code> to <code>server</code> thus starting up a Geronimo instance.</p>

<p>Several internal libraries used by Geronimo define two categories of properties as <code>home</code> and <code>base</code>, and Geronimo defines these further when <code>server</code> is defined. Outside of running multiple Geronimo instances <code>base</code> properties can be used to separate the binary installation from the user-modifiable configuration for a single server installation when that is desirable in some disk layout strategies.</p>


<h1 id="RunningmultipleGeronimoinstances-ThelayoutofaGeronimoinstance">The layout of a Geronimo instance</h1>

<p><rich-text-body><p>It is possible to run multiple instances of Geronimo on the same machine.</p></rich-text-body><br clear="none">
Currently multiple instances of Geronimo share the following directories in <code>&lt;geronimo_home&gt;</code>, the directory where you installed Geronimo. These are read-only.</p>
<ul><li>&lt;GERONIMO_HOME&gt;/
	<ul><li>bin</li><li>jsr88</li><li>lib</li><li>schema</li></ul>
	</li></ul>


<p>The repository is shared, and contains lots of basic and important libraries are required to bootstrap server. It is recommended to configure second repositories, one for each instance. See <a shape="rect" href="configuring-multiple-repositories.html">Configuring multiple Repositories</a>.</p>
<ul><li>&lt;GERONIMO_HOME&gt;/
	<ul><li>repository  (This is the primary shared repository for bootstrapping Geronimo instances)</li></ul>
	</li></ul>


<parameter ac:name="title">suggestion</parameter><rich-text-body>
<p>When running multiple instances, do not run a server from GERONIMO_HOME but only from GERONIMO_SERVER roots. Also set the <code>GERONIMO_HOME/repository</code> to be read-only to help prevent accidentally deploying to it when instead the intention is to deploy to the local repository for each Geronimo instance at <code>GERONIMO_SERVER/repository</code>.</p></rich-text-body>


<p>Each instance gets its own copy of the following at <code>&lt;geronimo_home&gt;/&lt;instance_name&gt;</code> . <code>etc</code> is read-only and <code>var</code> is read-write. Both are necessary for each Geronimo instance.</p>
<ul><li>&lt;GERONIMO_SERVER&gt;/
	<ul><li>etc</li><li>var</li></ul>
	</li></ul>


<p>These are also read-write but are not part of the minimally necessary directories and files for running a Geronimo instance, but may be desired. The <code>deploy</code> and <code>repository</code> directories will be automatically created when you start Geronimo if they do not already exist.</p>
<ul><li>&lt;GERONIMO_SERVER&gt;/
	<ul><li>repository  (This is the local repository under <code>&lt;geronimo_home&gt;/&lt;instance_name&gt;</code>, and is not the same as the primary shared repository)</li><li>deploy</li><li>hotbundles</li></ul>
	</li></ul>


<p>The bin, lib and schema directories are read-only, and thus are shared between instances. The repository is also shared, which means that an application deployed in one instance will show up in the list of deployed modules for all instances. Thus creating the second repository for each instance is recommended to keep deployments local to the Geronimo instances. See <a shape="rect" href="configuring-multiple-repositories.html">Configuring multiple Repositories</a>.</p>

<p>Here is an example layout of what it would look like to have installed one Geronimo instance named "foo-server".</p>
<parameter ac:name="borderStyle">solid</parameter><plain-text-body>
/opt/geronimo3    - GERONIMO_HOME
|-- bin           - read-only
|-- foo-server    - GERONIMO_SERVER
|   |-- etc           - read-only for the instance
|   |-- repository    - read-write (The instance's local repository you do want to deploy to)
|   `-- var           - read-write
|-- jsr88         - read-only
|-- lib           - read-only
|-- repository    - read-write (The primary shared repository you don't want to deploy to)
`-- schema        - read-only
</plain-text-body>


<h1 id="RunningmultipleGeronimoinstances-Creatinganewserverinstance">Creating a new server instance</h1>

<p>Start with a fresh image of Geronimo. Do not use an image that has been used to run the default instance.</p>

<p>To create an instance named <code>foo-server</code> do the following. All your instance data will be put in <code>&lt;geronimo_home&gt;/foo-server</code>. All the directories named below are relative to <code>&lt;geronimo_home&gt;</code>.<br clear="none">
Follow the procedures as below:</p>
<ol><li>Create a directory <code>foo-server</code> under <code>&lt;geronimo_home&gt;</code>.</li><li>Copy <code>var</code> and <code>etc</code> directories to <code>foo-server</code>. <span style="text-decoration: line-through;">You can use the command</span> <span style="text-decoration: line-through;"><a shape="rect" href="gogo-commands-for-geronimo.html">deploy:new-server-instance</a></span> <span style="text-decoration: line-through;">to help you with this step. &lt;&#160;GERONIMO-6287</span></li><li>Recommended: create <code>foo-server/repository</code> and set it up as a second repository for the Geronimo instance. See <a shape="rect" href="configuring-multiple-repositories.html">Configuring multiple Repositories</a></li><li>Edit <code>foo-server/var/config/config-substitutions.properties</code> and change the portOffset. Try using any integers such as 1, 2, 10, 20, 30.. for various instances.</li></ol>



<h1 id="RunningmultipleGeronimoinstances-Runninganinstance">Running an instance</h1>

<ol><li>Set the <code>GERONIMO_SERVER</code>&#160;environment variable to define the server instance directory before you start the server. This variable will be set to <code>GERONIMO_HOME</code> as default if not defined. Set <code>GERONIMO_SERVER=foo-server</code> to change the server name to an instance named <code>foo-server</code> located at <code>&lt;GERONIMO_HOME&gt;/foo-server</code>, or <code>GERONIMO_SERVER=/opt/geronimo/foo-server</code> to set the absolute path.</li></ol>


<ul><li>On a Windows system: <code>set GERONIMO_SERVER=foo-server</code></li><li>On a Unix-like system: <code>export GERONIMO_SERVER="foo-server"</code></li></ul>


<ol><li>Start the server using startup
<parameter ac:name="borderStyle">solid</parameter><plain-text-body>
&lt;geronimo_home&gt;/bin/startup
</plain-text-body></li><li>To shutdown this instance, use the port number of RMI Naming port (default 1099). For the new instance <code>foo-server</code>, the port number should be 1099 plus portOffset specified in <code>foo-server/var/config/config-substitutions.properties</code>.
<parameter ac:name="borderStyle">solid</parameter><plain-text-body>
&lt;geronimo_home&gt;/bin/shutdown --port &lt;RMI_port_num&gt;
</plain-text-body></li><li>To deploy applications to this instance use the port number of RMI Naming port</li></ol>


<ul class="alternate"><li>This deploys to the primary Geronimo repository
<parameter ac:name="borderStyle">solid</parameter><plain-text-body>
&lt;geronimo_home&gt;/bin/deploy --port &lt;RMI_port_num&gt; deploy &lt;applications&gt;
</plain-text-body></li><li>This deploys to a secondary Geronimo repository exclusive to the Geronimo server defined as <code>GERONIMO_SERVER=foo-server</code>. See <a shape="rect" href="configuring-multiple-repositories.html">Configuring multiple Repositories</a> for more detailed instructions.
<parameter ac:name="borderStyle">solid</parameter><plain-text-body>
&lt;geronimo_home&gt;/bin/deploy --port &lt;RMI_port_num&gt; deploy --targets &lt;foo_repo_name&gt; &lt;applications&gt;
</plain-text-body></li></ul>



<p>The Administrative Console can also be used for all these operations. Connect to an instance by using the right HTTP port (default 8080).</p>

<h2 id="RunningmultipleGeronimoinstances-Exampleruntimeformultipleinstances">Example runtime for multiple instances</h2>

<ul><li>First download the Geronimo bundle distribution</li><li>Determine what you want <code>GERONIMO_HOME</code> to be. We will use <code>/opt/geronimo3</code> for this example.</li><li>Unpack the Geronimo bundle, and move the unpacked directory to <code>/opt/geronimo3</code></li><li>We'll create two Geronimo instances named gserv1 and gserv2
	<ul><li>Create the Geronimo instance directories as <code>/opt/geronimo3/gserv1</code> and <code>/opt/geronimo3/gserv2</code></li><li>Copy the directories <code>var</code> and <code>etc</code> to each instance directory</li><li>Create a <code>repository</code> directory within each instance directory and set it up as a second repository for the corresponding Geronimo instance. See <a shape="rect" href="configuring-multiple-repositories.html">Configuring multiple Repositories</a></li><li>Modify the <code>gserv(1|2)/var/config/config-substitutions.properties</code> file for each Geronimo instance changing the <code>PortOffset</code>. We'll set the <code>PortOffset</code> for <code>gserv1</code> to 100 and the <code>PortOffset</code> for <code>gserv2</code> to 200 for our example.</li><li>Create a start script in each Geronimo instance directory to make it easier to start each instance
		<ul><li><code>/opt/geronimo3/gserv1/start.sh</code>
<parameter ac:name="borderStyle">solid</parameter><plain-text-body>
#!/bin/bash
# Geronimo start script
# instance: gserv1

# Uncomment this to explicitly set Geronimo's runtime Java
#JAVA_HOME=/usr/jdk1.6.0_25
#PATH=${JAVA_HOME}/bin:${PATH}

export GERONIMO_HOME=/opt/geronimo3
export GERONIMO_SERVER=gserv1
cd ${GERONIMO_SERVER}

# Normal startup
${GERONIMO_HOME}/bin/startup
# Interactive startup
#${GERONIMO_HOME}/bin/geronimo run
</plain-text-body></li><li><code>/opt/geronimo3/gserv2/start.sh</code>
<parameter ac:name="borderStyle">solid</parameter><plain-text-body>
#!/bin/bash
# Geronimo start script
# instance: gserv2

# Uncomment this to explicitly set Geronimo's runtime Java
#JAVA_HOME=/usr/jdk1.6.0_25
#PATH=${JAVA_HOME}/bin:${PATH}

export GERONIMO_HOME=/opt/geronimo3
export GERONIMO_SERVER=gserv2
cd ${GERONIMO_SERVER}

# Normal startuo
${GERONIMO_HOME}/bin/startup
# Interactive startup
#${GERONIMO_HOME}/bin/geronimo run
</plain-text-body></li></ul>
		</li><li>On linux, make the start script is executable with chmod: chmod 755 start.sh</li></ul>
	</li><li>Your Geronimo installation file structure should look something similar to this:
<parameter ac:name="borderStyle">solid</parameter><plain-text-body>
/opt/geronimo3
|-- LICENSE
|-- NOTICE
|-- README.txt
|-- RELEASE_NOTES-3.0-SNAPSHOT.txt
|-- bin
|-- -etc-
|-- gserv1
|   |-- etc
|   |-- repository
|   |-- start.sh
|   `-- var
|-- gserv2
|   |-- etc
|   |-- repository
|   |-- start.sh
|   `-- var
|-- jsr88
|-- lib
|-- +repository+
|-- schema
`-- -var-
</plain-text-body>
<em>It is suggested that in</em> <code><em>GERONIMO_HOME/etc</em></code> <em>and</em> <code><em>GERONIMO_HOME/var</em></code> <em>are removed and</em> <code><em>GERONIMO_HOME/repository</em></code> <em>is made read-only</em></li><li>Finally you can start up each instance by executing their associated start script you just created in the previous step</li></ul>



<h1 id="RunningmultipleGeronimoinstances-Furtherreadings">Further readings</h1>

<p>To use multiple repositories see <a shape="rect" href="configuring-multiple-repositories.html">Configuring multiple Repositories</a>.</p></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tr>
          <td align="left" valign="middle" class="footer">
            &nbsp;&nbsp;
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Delicious" />
            <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">Bookmark this on Delicious</a>
            &nbsp;&nbsp;
            <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="Digg!" />
            <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title)+'&amp;topic=programming');">Digg this</a>
            <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Running multiple Geronimo instances';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
            &nbsp;&nbsp;
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">Privacy Policy</a>&nbsp;&nbsp;-&nbsp;&nbsp;
            Copyright &#169; 2003-2013, The Apache Software Foundation, Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0.</a>&nbsp;&nbsp;
          </td>
        </tr>
    </table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  </body>
</html>
