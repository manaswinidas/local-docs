<html lang="zh-Hans" ><head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link type="text/css" rel="stylesheet" href="asset?aid=0">
    <link rel="SHORTCUT ICON" href="http://geronimo.apache.org/images/favicon.ico">
    <link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
    <meta name="Description" content="Running multiple Geronimo instances">
    <meta name="Keywords" content="Apache Geronimo 3.0 Documentation JavaEE6 OSGi Running multiple Geronimo instances">
    <meta name="Owner" content="dev@geronimo.apache.org">
    <meta name="Robots" content="index, follow">
    <meta name="Security" content="Public">
    <meta name="Source" content="wiki template">
    <meta name="DC.Date" scheme="iso8601" content="2010-05-11">
    <meta name="DC.Language" scheme="rfc1766" content="en">
    <meta name="DC.Rights" content="Copyright Â© 2003-2013, The Apache Software Foundation">
    <meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">

    <script src="http://geronimo.apache.org/functions.js" type="text/javascript"></script>


    <title>Apache Geronimo v3.0文档：运行多个Geronimo实例</title>
  </head>

  <body  onload="init()">

        <!-- banner -->
    <table valign="top" border="0" cellspacing="0" cellpadding="0" width="100%" background="http://geronimo.apache.org/images/top_bgstretch_1x64.gif">
      <tbody><tr>
        <td align="left" valing="top">
          <img src="http://geronimo.apache.org/images/topleft_logo_437x64.gif" border="0">
        </td>
      </tr>
    </tbody></table>

        <!-- topNav -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
      <tbody><tr class="topBar">
        <td align="left" valign="middle" class="topBarDiv" nowrap>
          <a href="/geronimo">Home</a> > <a href="documentation.html">文档</a> > <a href="installing-and-running.html">安装和运行</a> > <a href="running-geronimo.html">运行Geronimo</a> > <a href="running-multiple-geronimo-instances.html">运行多个Geronimo实例</a>
        </td>
        <td align="right" valign="middle" nowrap>
          <form name="search" action="http://www.google.com/search" method="get">
            <input type="hidden" name="ie" value="UTF-8">
            <input type="hidden" name="oe" value="UTF-8">
            <input type="hidden" name="domains" value="">
            <input type="hidden" name="sitesearch" value="">
            <input type="text" name="q" value="" maxlength="255">        
            <input type="submit" name="btnG" value="谷歌搜索">
          </form>
        </td>
      </tr> 
    </tbody></table>

        <!-- pageContent -->
    <div id="PageContent">
      <div class="pageheader" style="padding:6px 0px 0px 0px">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="http://geronimo.apache.org/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <div class="smalltext" style="margin:0px 10px 0px 10px">Apache Geronimo v3.0</div>
        <div class="pagetitle" style="margin:0px 10px 8px 10px">运行多个Geronimo实例</div>

        <div class="greynavbar" align="right" style="padding:2px 10px;margin:0px">
<!-- --> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645442"><img src="http://geronimo.apache.org/images/icons/notep_16.gif" height="16" width="16" border="0" title="编辑页面"></a> <a href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=20645442">编辑页面</a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30"><img src="http://geronimo.apache.org/images/icons/browse_space.gif" height="16" width="16" border="0" title="浏览空间"></a> <a href="https://cwiki.apache.org/confluence/pages/listpages.action?key=GMOxDOC30">浏览空间</a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645442"><img src="http://geronimo.apache.org/images/icons/add_page_16.gif" height="16" width="16" border="0" title="添加页面"></a> <a href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=GMOxDOC30&fromPageId=20645442">添加页面</a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645442"><img src="http://geronimo.apache.org/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" title="新增新闻"></a> <a href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=GMOxDOC30&fromPageId=20645442">新增新闻</a> <!-- -->	 
        </div>
      </div>

      <div class="pagecontent">
        <div class="wiki-content">
          <div class="wiki-content maincontent"><plain-text-body>{scrollbar}</plain-text-body> <rich-text-body>
<p>关于Geronimo javaee6和最低发行版捆绑包。<a shape="rect" class="external-link" href="https://issues.apache.org/jira/browse/GERONIMO-6270">GERONIMO-6270</a>及其子任务完成了对多个实例的完全支持。此支持在2012年3月1日之后的最新快照中提供，并将在3.0-beta-2标准版本中提供。本文档介绍了应用GERONIMO-6270的更改后如何运行多个实例。</p>

<p>对于以前的版本，可以通过将服务器文件夹完全复制到另一个文件夹来安全地并行运行多个安装，并在更改其portOffset值后开始第二个服务器安装。</p></rich-text-body>

<h1 id="RunningmultipleGeronimoinstances-GERONIMO_HOMEversusGERONIMO_SERVER"><code>GERONIMO_HOME</code>与<code>GERONIMO_SERVER</code></h1>

<p>简单的说， <code>GERONIMO_HOME</code>是服务器二进制安装的路径，并且<code>GERONIMO_SERVER</code>是服务器运行时配置的路径。 <code>GERONIMO_HOME</code>是每个实例引用的Geronimo的安装路径，每个Geronimo实例都定义了自己的路径<code>GERONIMO_SERVER</code>作为实例配置的路径。</p>

<p>我们定义<code>GERONIMO_SERVER</code>为了让Geronimo启动程序启动一个实例。</p>

<h2 id="RunningmultipleGeronimoinstances-PathResolution">路径解析度</h2>

<p><code>GERONIMO_HOME</code>是在启动期间相对于Geronimo所在的目录获得的。默认情况下，如果用户未定义<code>GERONIMO_SERVER</code>它设置为<code>GERONIMO_HOME</code> 。如果用户定义<code>GERONIMO_SERVER</code>尝试通过以下方式将其解析为绝对路径：</p>
<ol><li>首先，作为绝对路径IFF <code>GERONIMO_SERVER</code>是绝对的<ul><li><code>GERONIMO_SERVER</code></li></ul>
	</li><li>第二，作为通往的相对路径<code>GERONIMO_HOME</code>森林论坛<code>GERONIMO_SERVER</code>不是绝对的<ul><li><code>GERONIMO_HOME</code> /<code>GERONIMO_SERVER</code></li></ul>
	</li></ol>


<h2 id="RunningmultipleGeronimoinstances-TechnicalTerms">技术用语</h2>

<p><em>如果您不关心Geronimo使用Java的技术内部知识，请跳过此小节。</em> <code><em>GERONIMO_HOME</em></code> <em>与</em> <code><em>GERONIMO_SERVER</em></code></p>

<p>Geronimo内部有一个概念<code>home</code> ， <code>base</code>和<code>server</code> ，具有相应的java属性<code>org.apache.geronimo.home.dir</code>和<code>org.apache.geronimo.server.dir</code> 。 <code>base</code>和<code>server</code>一样，但是Geronimo参考<code>base</code>通常参考运行时配置的位置。的定义<code>server</code>由用户提供，并重新定义<code>base</code> 。</p>

<p>Geronimo运行时<code>home</code>和<code>base</code>属性是相对于Geronimo的安装目录定义的。用户启动Geronimo实例时，用户定义了<code>server</code>属性。定义<code>server</code>属性触发Geronimo更改其<code>base</code>从<code>home</code>至<code>server</code>因此启动了Geronimo实例。</p>

<p>Geronimo使用的几个内部库将两类属性定义为<code>home</code>和<code>base</code> ，而Geronimo在何时进一步定义这些<code>server</code>被定义为。在运行多个Geronimo实例之外<code>base</code>在某些磁盘布局策略中需要时，可以使用属性将二进制安装与用户可修改的配置分开以进行单个服务器安装。</p>


<h1 id="RunningmultipleGeronimoinstances-ThelayoutofaGeronimoinstance">Geronimo实例的布局</h1>

<p><rich-text-body></rich-text-body></p><p>可以在同一台机器上运行Geronimo的多个实例。</p><br clear="none">当前，Geronimo的多个实例在以下位置共享以下目录： <code><geronimo_home></code> ，即安装Geronimo的目录。这些是只读的。<p></p>
<ul><li><geronimo_home>/<ul><li>箱子</li><li>jsr88</li><li>LIB</li><li>图式</li></ul>
	</geronimo_home></li></ul>


<p>该存储库是共享的，并且包含许多引导服务器所需的基本和重要库。建议配置第二个存储库，每个实例一个。请参阅<a shape="rect" href="configuring-multiple-repositories.html">配置多个存储库</a> 。</p>
<ul><li><geronimo_home>/<ul><li>存储库（这是引导Geronimo实例的主要共享存储库）</li></ul>
	</geronimo_home></li></ul>


<parameter ac:name="title">建议</parameter> <rich-text-body>
<p>当运行多个实例时，不要从GERONIMO_HOME运行服务器，而只能从GERONIMO_SERVER根目录运行服务器。同时设置<code>GERONIMO_HOME/repository</code>为只读，以帮助防止意外部署到它，而目的是将每个Geronimo实例部署到本地存储库<code>GERONIMO_SERVER/repository</code> 。</p></rich-text-body>


<p>每个实例在以下位置获得自己的以下副本： <code><geronimo_home>/<instance_name></code> 。 <code>etc</code>是只读的<code>var</code>是可读写的。这对于每个Geronimo实例都是必需的。</p>
<ul><li><geronimo_server>/<ul><li>等等</li><li>变种</li></ul>
	</geronimo_server></li></ul>


<p>这些也是可读写的，但不是运行Geronimo实例的最低必需目录和文件的一部分，但可能是需要的。的<code>deploy</code>和<code>repository</code>如果您不启动目录，则在启动Geronimo时将自动创建目录。</p>
<ul><li><geronimo_server>/<ul><li>存储库（这是本地存储库<code><geronimo_home>/<instance_name></code> ，并且与主要的共享存储库不同）</li><li>部署</li><li>捆绑包</li></ul>
	</geronimo_server></li></ul>


<p>bin，lib和schema目录是只读的，因此在实例之间共享。该存储库也是共享的，这意味着在一个实例中部署的应用程序将显示在所有实例的已部署模块列表中。因此，建议为每个实例创建第二个存储库，以将部署保持在Geronimo实例本地。请参阅<a shape="rect" href="configuring-multiple-repositories.html">配置多个存储库</a> 。</p>

<p>这是安装一个名为“ foo-server”的Geronimo实例的外观的示例布局。</p>
<parameter ac:name="borderStyle">固体</parameter> <plain-text-body>/ opt / geronimo3-GERONIMO_HOME |-bin-只读|-foo服务器-GERONIMO_SERVER | |-等-实例的只读| |-信息库-读写（您确实要部署到的实例的本地信息库）| `-var-读写|-jsr88-只读|-lib-只读|-存储库-读写（您不想部署到的主要共享存储库） - 只读</plain-text-body>


<h1 id="RunningmultipleGeronimoinstances-Creatinganewserverinstance">创建一个新的服务器实例</h1>

<p>从全新的Geronimo图像开始。不要使用已用于运行默认实例的映像。</p>

<p>创建一个名为的实例<code>foo-server</code>请执行下列操作。您所有的实例数据将被放入<code><geronimo_home>/foo-server</code> 。下面命名的所有目录都是相对于<code><geronimo_home></code> 。<br clear="none">请按照以下步骤操作：</p>
<ol><li>建立目录<code>foo-server</code>下<code><geronimo_home></code> 。</li><li>复制<code>var</code>和<code>etc</code>目录到<code>foo-server</code> 。<span style="text-decoration:line-through">您可以使用命令</span> <span style="text-decoration:line-through"><a shape="rect" href="gogo-commands-for-geronimo.html">deploy：new-server-instance</a></span> <span style="text-decoration:line-through">来帮助您完成此步骤。 <GERONIMO-6287</span></li><li>推荐：创建<code>foo-server/repository</code>并将其设置为Geronimo实例的第二个存储库。请参阅<a shape="rect" href="configuring-multiple-repositories.html">配置多个存储库</a></li><li>编辑<code>foo-server/var/config/config-substitutions.properties</code>并更改portOffset。对于各种实例，请尝试使用任何整数，例如1、2、10、20、30..。</li></ol>



<h1 id="RunningmultipleGeronimoinstances-Runninganinstance">运行实例</h1>

<ol><li>设置<code>GERONIMO_SERVER</code>环境变量，以在启动服务器之前定义服务器实例目录。此变量将设置为<code>GERONIMO_HOME</code>如果未定义，则为默认值。组<code>GERONIMO_SERVER=foo-server</code>将服务器名称更改为名为的实例<code>foo-server</code>位于<code><GERONIMO_HOME>/foo-server</code> ， 要么<code>GERONIMO_SERVER=/opt/geronimo/foo-server</code>设置绝对路径。</li></ol>


<ul><li>在Windows系统上：<code>set GERONIMO_SERVER=foo-server</code></li><li>在类似Unix的系统上：<code>export GERONIMO_SERVER="foo-server"</code></li></ul>


<ol><li>使用启动<parameter ac:name="borderStyle">实体</parameter> <plain-text-body><geronimo_home>/ bin / startup启动</geronimo_home></plain-text-body>服务器</li><li>要关闭该实例，请使用RMI命名端口的端口号（默认为1099）。对于新实例<code>foo-server</code> ，端口号应为1099加上在中指定的portOffset <code>foo-server/var/config/config-substitutions.properties</code> 。
<parameter ac:name="borderStyle">固定</parameter> <plain-text-body><geronimo_home>/ bin / shutdown --port <rmi_port_num>
</rmi_port_num></geronimo_home></plain-text-body></li><li>要将应用程序部署到此实例，请使用RMI命名端口的端口号</li></ol>


<ul class="alternate"><li>这将部署到主要Geronimo存储库<parameter ac:name="borderStyle">固</parameter> <plain-text-body><geronimo_home>/斌/部署--port <rmi_port_num>部署<applications>
</applications></rmi_port_num></geronimo_home></plain-text-body></li><li>这将部署到Geronimo服务器专有的辅助Geronimo存储库，该存储库定义为<code>GERONIMO_SERVER=foo-server</code> 。有关更多详细说明，请参阅<a shape="rect" href="configuring-multiple-repositories.html">配置多个存储库</a> 。
<parameter ac:name="borderStyle">稳定的</parameter> <plain-text-body><geronimo_home>/ bin / deploy --port <rmi_port_num>部署--targets <foo_repo_name><applications>
</applications></foo_repo_name></rmi_port_num></geronimo_home></plain-text-body></li></ul>



<p>管理控制台也可以用于所有这些操作。使用正确的HTTP端口（默认为8080）连接到实例。</p>

<h2 id="RunningmultipleGeronimoinstances-Exampleruntimeformultipleinstances">多个实例的示例运行时</h2>

<ul><li>首先下载Geronimo捆绑包发行版</li><li>确定你想要什么<code>GERONIMO_HOME</code>成为。我们将使用<code>/opt/geronimo3</code>对于这个例子。</li><li>解压缩Geronimo软件包，然后将解压缩的目录移动到<code>/opt/geronimo3</code></li><li>我们将创建两个名为gserv1和gserv2的Geronimo实例。<ul><li>将Geronimo实例目录创建为<code>/opt/geronimo3/gserv1</code>和<code>/opt/geronimo3/gserv2</code></li><li>复制目录<code>var</code>和<code>etc</code>到每个实例目录</li><li>创建一个<code>repository</code>目录，然后将其设置为相应Geronimo实例的第二个存储库。请参阅<a shape="rect" href="configuring-multiple-repositories.html">配置多个存储库</a></li><li>修改<code>gserv(1|2)/var/config/config-substitutions.properties</code>每个Geronimo实例的文件，更改<code>PortOffset</code> 。我们将设置<code>PortOffset</code>对于<code>gserv1</code>到100和<code>PortOffset</code>对于<code>gserv2</code>以200为例。</li><li>在每个Geronimo实例目录中创建一个启动脚本，以使启动每个实例更加容易<ul><li><code>/opt/geronimo3/gserv1/start.sh</code> <parameter ac:name="borderStyle">固</parameter> <plain-text-body>＃！/ bin / bash＃Geronimo启动脚本＃实例：gserv1＃取消注释以明确设置Geronimo的运行时Java＃JAVA_HOME = / usr / jdk1.6.0_25 #PATH = $ {JAVA_HOME} / bin：$ {PATH} export GERONIMO_HOME = / opt / geronimo3 export GERONIMO_SERVER = gserv1 cd $ {GERONIMO_SERVER}＃正常启动$ {GERONIMO_HOME} / bin / startup＃交互式启动＃$ {GERONIMO_HOME} / bin / geronimo run</plain-text-body></li><li><code>/opt/geronimo3/gserv2/start.sh</code> <parameter ac:name="borderStyle">固</parameter> <plain-text-body>＃！/ bin / bash＃Geronimo启动脚本＃实例：gserv2＃取消注释以显式设置Geronimo的运行时Java＃JAVA_HOME = / usr / jdk1.6.0_25 #PATH = $ {JAVA_HOME} / bin：$ {PATH} export GERONIMO_HOME = / opt / geronimo3 export GERONIMO_SERVER = gserv2 cd $ {GERONIMO_SERVER}＃正常启动$$ {GERONIMO_HOME} / bin / startup＃交互式启动＃$ {GERONIMO_HOME} / bin / geronimo run</plain-text-body></li></ul>
		</li><li>在Linux上，使用chmod使启动脚本可执行：chmod 755 start.sh</li></ul>
	</li><li>您的Geronimo安装文件结构应类似于以下内容： <parameter ac:name="borderStyle">稳定的</parameter> <plain-text-body>/ opt / geronimo3 |-许可|-注意|-README.txt |-RELEASE_NOTES-3.0-SNAPSHOT.txt |-bin |--etc -|-gserv1 | |-等| |-储存库| |-start.sh | `-var |-gserv2 | |-等| |-储存库| |-start.sh | `--var |-jsr88 |-lib |-+ repository + |-schema`--var-</plain-text-body> <em>建议在</em> <code><em>GERONIMO_HOME/etc</em></code> <em>和</em> <code><em>GERONIMO_HOME/var</em></code> <em>被删除并</em> <code><em>GERONIMO_HOME/repository</em></code> <em>设为只读</em></li><li>最后，您可以通过执行您在上一步中创建的关联启动脚本来启动每个实例</li></ul>



<h1 id="RunningmultipleGeronimoinstances-Furtherreadings">进一步阅读</h1>

<p>要使用多个存储库，请参阅<a shape="rect" href="configuring-multiple-repositories.html">配置多个存储库</a> 。</p></div>
        </div>

              </div>
    </div>

        <!-- footer -->
    <table border="0" cellpadding="2" cellspacing="0" width="100%">
        <tbody><tr>
          <td align="left" valign="middle" class="footer">
              
            <img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="美味的"> <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=550,height=550'); return false;">在Delicious上添加书签</a> <img src="http://digg.com/img/badges/16x16-digg-guy.gif" width="16" height="16" alt="掘客！"> <a href="" onclick="window.open('http://digg.com/submit?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title)+'&topic=programming');">挖这个</a> <!-- Slicker, but no text
            <script type="text/javascript">
              digg_skin = 'icon';
              digg_window = 'new';
              digg_title = 'Apache Geronimo v3.0 Documentation : Running multiple Geronimo instances';
              digg_topic = 'programming';
            </script>
            <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
            -->
              
          </td>
          <td align="right" valign="middle" class="footer">
            <a href="http://cwiki.apache.org/GMOxPMGT/geronimo-privacy-policy.html">隐私权政策</a> -版权所有©2003-2013，Apache软件基金会，根据<a href="http://www.apache.org/licenses/LICENSE-2.0">ASL 2.0</a>许可<a href="http://www.apache.org/licenses/LICENSE-2.0">。</a>  
          </td>
        </tr>
    </tbody></table> 

        <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      var pageTracker = _gat._getTracker("UA-4380560-1");
      pageTracker._initData();
      pageTracker._trackPageview();
    </script>

  

</body></html>