<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Activity 4: Create and run a JDBC program using the client driver and Network Server">
<meta name="abstract" content="This activity demonstrates the ease with which a program that embeds Derby can be modified for a client/server implementation that uses the Derby Network Server.">
<meta name="description" content="This activity demonstrates the ease with which a program that embeds Derby can be modified for a client/server implementation that uses the Derby Network Server.">
<meta name="DC.subject" content="WwdClient.java program, org.apache.derby.jdbc.ClientDriver">
<meta name="keywords" content="WwdClient.java program, org.apache.derby.jdbc.ClientDriver">
<meta name="DC.Relation" scheme="URI" content="cgstutorialintro.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="tgsactivity4">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>活动4：使用客户端驱动程序和网络服务器创建并运行JDBC程序</title>
</head>
<body id="tgsactivity4" ><a name="tgsactivity4"><!-- --></a>


<h1 class="topictitle1">活动4：使用客户端驱动程序和网络服务器创建并运行JDBC程序</h1>



<div><p>此活动演示了针对使用<span>Derby</span> Network Server的客户端/服务器实现，可以轻松修改嵌入<span>Derby</span>的程序。</p>

<div class="p">此活动假定您已经执行了前面的活动，并且有一个名为<samp class="codeph">DERBYTUTOR</samp> ，并从<samp class="codeph">$<span>DERBY_HOME</span>/demo/programs/workingwithderby/</samp>目录。基本知识<samp class="codeph">WwdEmbedded.java</samp>程序以及启动和连接到网络服务器的经验会有所帮助。您将需要使用文本编辑器来创建<samp class="codeph">WwdClient.java</samp>程序。</div>

<div class="section"><div class="note"><span class="notetitle">注意：</span>为方便起见， <samp class="codeph">workingwithderby</samp>目录包含一个程序， <samp class="codeph">WwdClientExample.java</samp> ，已经以适当的方式对其进行了编辑。您可以直接使用此程序，也可以将其内容与<samp class="codeph">WwdClient.java</samp>您将在此活动中构造的程序，以了解如何进行更改。</div>您将创建一个<span>Derby</span>客户端程序， <samp class="codeph">WwdClient.java</samp> ，通过更改几行<samp class="codeph">WwdEmbedded.java</samp>程序。您可以在多个命令外壳中运行客户端程序，从而允许同时从两个或多个源进行更新。<p>在此活动中，您将使用两个命令窗口（Server-Shell和Client-Shell）。您可以使用Server-Shell启动<span>Derby</span> Network Server并显示Network Server消息。您使用Client-Shell编辑，编译和运行新创建的<samp class="codeph">WwdClient.java</samp>程序。您设置<samp class="codeph">CLASSPATH</samp> Client-Shell中的环境变量以支持客户端JDBC程序。</p>
</div>

<ol>
<li class="stepexpand"><span>创建<samp class="codeph">WwdClient</samp>程序使用以下步骤：</span>
<ol type="a">
<li class="substepexpand"><span>打开命令窗口（客户端外壳程序）。</span></li>

<li class="substepexpand"><span>更改为<samp class="codeph">DERBYTUTOR</samp>目录。</span>
</li>

<li class="substepexpand"><span>制作一份<samp class="codeph">WwdEmbedded.java</samp>程序调用<samp class="codeph">WwdClient.java</samp> ，如下表所示。</span> 

<div class="tablenoborder"><table cellspacing="0" cellpadding="4" border="1" summary="This table lists the commands to copy the WwdEmbedded.java program on UNIX and Windows systems." frame="border" rules="all"><caption>表格1。复制程序的命令</caption>


<thead align="left">
<tr valign="bottom">
<th valign="bottom" width="25%" id="N10137">操作系统</th>

<th valign="bottom" width="75%" id="N1013E">命令</th>

</tr>

</thead>

<tbody>
<tr>
<td valign="top" width="25%" headers="N10137">UNIX（Korn Shell）</td>

<td valign="top" width="75%" headers="N1013E"><pre><strong><kbd class="userinput">cp WwdEmbedded.java WwdClient.java</kbd></strong></pre>
</td>

</tr>

<tr>
<td valign="top" width="25%" headers="N10137">视窗</td>

<td valign="top" width="75%" headers="N1013E"><pre><strong><kbd class="userinput">copy WwdEmbedded.java WwdClient.java</kbd></strong></pre>
</td>

</tr>

</tbody>

</table>
</div>

</li>

<li class="substepexpand"><span>打开<samp class="codeph">WwdClient.java</samp>在文本编辑器中添加文件，并更新类名以反映新的文件名：</span> <pre><strong>Original declaration</strong>
     public class WwdEmbedded

<strong>New declaration</strong>
     public class <strong>WwdClient</strong>
</pre>
</li>

<li class="substepexpand"><span>编辑程序的<cite>DEFINE VARIABLES SECTION</cite> ，以便<samp class="codeph">driver</samp>变量包含<span>Derby</span>客户端驱动程序类的名称和<samp class="codeph">connectionURL</samp>变量包含网络服务器的主机名和端口号。</span> <pre><strong>Original definitions</strong>
     String driver = "org.apache.derby.jdbc.EmbeddedDriver";
     String dbName="jdbcDemoDB";
     String connectionURL = "jdbc:derby:" + dbName + ";create=true";

<strong>New definitions</strong>
     String driver = <strong>"org.apache.derby.jdbc.ClientDriver"</strong>;
     ...
     String connectionURL = <strong>"jdbc:derby://localhost:1527/"</strong> + dbName + ";create=true";
</pre>
</li>

<li class="substepexpand"><span>编译应用程序。</span> <pre><strong><kbd class="userinput">javac WwdClient.java</kbd></strong>
</pre>如果编译成功，将出现命令提示符。二进制文件<samp class="codeph">WwdClient.class</samp>被建造。如果出现错误消息，请修改指示的行，使其与示例相同。（如上所述，您可以比较您的内容<samp class="codeph">WwdClient.java</samp>反对这<samp class="codeph">WwdClientExample.java</samp>程序中提供的<samp class="codeph">workingwithderby</samp>目录以确认您的编辑已成功执行。）</li>

</ol>

</li>

<li class="stepexpand"><span>使用以下步骤设置客户端/服务器环境：</span>
<ol type="a">
<li class="substepexpand"><span>打开命令窗口（服务器外壳）。</span></li>

<li class="substepexpand"><span>更改为<samp class="codeph">DERBYTUTOR</samp>目录。</span>
</li>

<li class="substepexpand"><span>如下表所示，启动网络服务器。</span> 

<div class="tablenoborder"><table cellspacing="0" cellpadding="4" border="1" summary="This table lists the commands to start the Network Server on UNIX and Windows systems." frame="border" rules="all"><caption>表格1。启动网络服务器的命令</caption>


<thead align="left">
<tr valign="bottom">
<th valign="bottom" width="25%" id="N102A9">操作系统</th>

<th valign="bottom" width="75%" id="N102B0">命令</th>

</tr>

</thead>

<tbody>
<tr>
<td valign="top" width="25%" headers="N102A9">UNIX（Korn Shell）</td>

<td valign="top" width="75%" headers="N102B0"><pre><strong><kbd class="userinput">java -jar $DERBY_HOME/lib/derbyrun.jar server start</kbd></strong>
Wed Nov 28 13:21:31 PST 2018 : Security manager installed using the Basic server security policy.
Wed Nov 28 13:21:39 PST 2018 : Apache Derby Network Server - 10.15.0.0 alpha - (1847657M) started and ready to accept connections on port 1527</pre>
</td>

</tr>

<tr>
<td valign="top" width="25%" headers="N102A9">视窗</td>

<td valign="top" width="75%" headers="N102B0"><pre><strong><kbd class="userinput">java -jar %DERBY_HOME%\lib\derbyrun.jar server start</kbd></strong>
Wed Nov 28 13:21:31 PST 2018 : Security manager installed using the Basic server security policy.
Wed Nov 28 13:21:39 PST 2018 : Apache Derby Network Server - 10.15.0.0 alpha - (1847657M) started and ready to accept connections on port 1527</pre>
</td>

</tr>

</tbody>

</table>
</div>

</li>

</ol>

</li>

<li class="stepexpand"><span>使用以下步骤运行客户端程序：</span>
<ol type="a">
<li class="substepexpand"><span>返回到Client-Shell窗口。</span></li>

<li class="substepexpand"><span>设置<samp class="codeph">CLASSPATH</samp>环境变量以包含文件的位置<samp class="codeph">derbyclient.jar</samp> （不<samp class="codeph">derby.jar</samp>如下表所示。</span>
 

<div class="tablenoborder"><table cellspacing="0" cellpadding="4" border="1" summary="This table lists the commands to set the CLASSPATH environment variable on UNIX and Windows systems." frame="border" rules="all"><caption>表格1。命令设置<samp class="codeph">CLASSPATH</samp>环境变量</caption>


<thead align="left">
<tr valign="bottom">
<th valign="bottom" width="25%" id="N10382">操作系统</th>

<th valign="bottom" width="75%" id="N10389">命令</th>

</tr>

</thead>

<tbody>
<tr>
<td valign="top" width="25%" headers="N10382">UNIX（Korn Shell）</td>

<td valign="top" width="75%" headers="N10389"><pre><strong><kbd class="userinput">export CLASSPATH=$DERBY_HOME/lib/derbyclient.jar:$DERBY_HOME/lib/derbyshared.jar:.</kbd></strong></pre>

</td>

</tr>

<tr>
<td valign="top" width="25%" headers="N10382">视窗</td>

<td valign="top" width="75%" headers="N10389"><pre><strong><kbd class="userinput">set CLASSPATH=%DERBY_HOME%\lib\derbyclient.jar;%DERBY_HOME%\lib\derbyshared.jar;.</kbd></strong></pre>

</td>

</tr>

</tbody>

</table>
</div>

<div class="important"><span class="importanttitle">重要提示：请</span>添加点号（ <samp class="codeph">.</samp> ）放在命令末尾，这样您的当前工作目录将包含在classpath中。</div>
 </li>

<li class="substepexpand"><span>运行程序：</span>  <pre><strong><kbd class="userinput">java WwdClient</kbd></strong>
<tt class="sysout">org.apache.derby.jdbc.ClientDriver loaded.
Connected to database jdbcDemoDB
Enter wish-list item (enter exit to end):</tt>
<strong><kbd class="userinput">a sunny day</kbd></strong>
<tt class="sysout">  __________________________________________________
On 2012-09-14 09:46:37.77 I wished for a peppermint stick
On 2012-09-14 09:46:51.654 I wished for a long vacation
On 2012-09-14 09:56:36.6 I wished for a sunny day
  __________________________________________________
Enter wish-list item (enter exit to end):</tt>
<strong><kbd class="userinput">a new car</kbd></strong>
<tt class="sysout">  __________________________________________________
On 2012-09-14 09:46:37.77 I wished for a peppermint stick
On 2012-09-14 09:46:51.654 I wished for a long vacation
On 2012-09-14 09:56:36.6 I wished for a sunny day
On 2012-09-14 09:56:48.367 I wished for a new car
  __________________________________________________
Enter wish-list item (enter exit to end):</tt>
<strong><kbd class="userinput">exit</kbd></strong>
<tt class="sysout">Closed connection
Getting Started With Derby JDBC program ending.</tt></pre>
 
</li>

</ol>

</li>

<li class="stepexpand"><span>关闭网络服务器，如下表所示。</span>
 

<div class="tablenoborder"><table cellspacing="0" cellpadding="4" border="1" summary="This table lists the commands to shut down the Network Server on UNIX and Windows systems." frame="border" rules="all"><caption>表格1。关闭网络服务器的命令</caption>


<thead align="left">
<tr valign="bottom">
<th valign="bottom" width="25%" id="N10486">操作系统</th>

<th valign="bottom" width="75%" id="N1048D">命令</th>

</tr>

</thead>

<tbody>
<tr>
<td valign="top" width="25%" headers="N10486">UNIX（Korn Shell）</td>

<td valign="top" width="75%" headers="N1048D"><pre><strong><kbd class="userinput">java -jar $DERBY_HOME/lib/derbyrun.jar server shutdown</kbd></strong>
<tt class="sysout">Wed Nov 28 13:28:12 PST 2018 : Apache Derby Network Server - 10.15.0.0 alpha - (1847657M) shutdown</tt></pre>
</td>

</tr>

<tr>
<td valign="top" width="25%" headers="N10486">视窗</td>

<td valign="top" width="75%" headers="N1048D"><pre><strong><kbd class="userinput">java -jar %DERBY_HOME%\lib\derbyrun.jar server shutdown</kbd></strong>
<tt class="sysout">Wed Nov 28 13:28:12 PST 2018 : Apache Derby Network Server - 10.15.0.0 alpha - (1847657M) shutdown</tt></pre>
</td>

</tr>

</tbody>

</table>
</div>服务器关闭确认出现在两个命令窗口中。</li>

</ol>

<div class="section"><strong>活动笔记</strong> <p>在客户端/服务器环境中，通常在网络上的其他计算机上使用客户端程序。只要系统接受来自其他计算机的连接，就有可能被滥用。为了维护安全性， <span>Derby</span> Network Server默认将仅接受来自本地计算机上运行的客户端的连接（ <samp class="codeph">localhost</samp> ）。在此或任何其他<span>Derby</span>客户端程序可以从另一台机器访问网络服务器之前，应采取其他步骤来保护网络服务器环境。一旦获得安全保护，就可以将网络服务器安全地配置为接受来自其他计算机的连接。有关保护网络服务器和启用网络连接的重要信息，请参阅《 <span><em>Derby安全指南》</em></span> 。</p>
<p>网络服务器启动后，您可以在多个窗口中同时运行客户端程序。为了证明这一点，请打开两个命令窗口，并在每个窗口中执行“运行客户端程序”步骤的子步骤。两个客户端都可以正常运行。相反，使用嵌入式驱动程序的程序是不可能的（例如， <samp class="codeph">WwdEmbedded.java</samp> ）访问数据库，直到数据库或网络服务器关闭。</p>
<p>您可能已经注意到，客户端程序没有关闭数据库。这是因为数据库是客户端/服务器环境中的共享资源，并且在大多数情况下，仅应在网络服务器关闭时才关闭数据库。如果多个客户端正在访问数据库，并且一个客户端关闭数据库，则其余的客户端在下次尝试使用SQL命令时将遇到故障。</p>
<p><span>Derby</span>的两种体系结构使一些新的<span>Derby</span>用户感到困惑，他们错误地认为嵌入式是单用户配置。这不是真的。嵌入式驱动程序支持多个同时连接，执行锁定，并提供性能，完整性和可恢复性。使用嵌入式驱动程序的任何应用程序都可以打开多个<span>Derby</span>连接，然后为多个用户提供一种在每个连接上与数据库进行交互的方式。<span>Derby</span> Network Server是此类应用程序的示例。</p>
</div>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="cgstutorialintro.html" title="为了帮助您尽快起步并使用Derby，本自学指南重点介绍了Derby的一些更重要的功能。">针对Derby新手的自学教程</a></div>
</div>
</div>



</body></html>