<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="reference">
<meta name="DC.Title" content="Using the simpleJson optional tool">
<meta name="abstract" content="The simpleJson optional tool creates functions and a user-defined type, which can be used to integrate relational data with data represented in the popular JSON format.">
<meta name="description" content="The simpleJson optional tool creates functions and a user-defined type, which can be used to integrate relational data with data represented in the popular JSON format.">
<meta name="DC.subject" content="optional tools, simpleJson, simpleJson optional tool, tools">
<meta name="keywords" content="optional tools, simpleJson, simpleJson optional tool, tools">
<meta name="DC.Relation" scheme="URI" content="ctoolsopttools.html">
<meta name="DC.Relation" scheme="URI" content="rtoolsoptdbmetadata.html">
<meta name="DC.Relation" scheme="URI" content="rtoolsoptforeignviews.html">
<meta name="DC.Relation" scheme="URI" content="rtoolsoptlucene.html">
<meta name="DC.Relation" scheme="URI" content="rtoolsoptdbreader.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="rtoolsoptsimplejson">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>使用simpleJson可选工具</title>
</head>
<body id="rtoolsoptsimplejson" ><a name="rtoolsoptsimplejson"><!-- --></a>


<h1 class="topictitle1">使用simpleJson可选工具</h1>



<div><p>的<samp class="codeph">simpleJson</samp>可选工具创建函数和用户定义的类型，可用于将关系数据与流行的JSON格式表示的数据集成在一起。</p>

<div class="section">

<p>的<samp class="codeph">simpleJson</samp>可选工具依赖于第三方JSON.simple jar文件提供的支持类。该jar文件可以从<a href="http://code.google.com/p/json-simple/" target="_blank">http://code.google.com/p/json-simple/</a>获得。在加载之前<samp class="codeph">simpleJson</samp>工具，请确保您的类路径包含此第三方jar文件以及<samp class="codeph">derby.jar</samp>和<samp class="codeph">derbyoptionaltools.jar</samp> 。的<samp class="codeph">simpleJson</samp>该工具已经过JSON.simple 1.1版（json_simple-1.1.jar）的测试。</p>


<p>您可以加载和卸载<samp class="codeph">simpleJson</samp>通过使用工具<samp class="codeph">SYSCS_UTIL.SYSCS_REGISTER_TOOL</samp>系统过程。有关此过程的信息，请参见《 <span><em>Derby参考手册</em></span> 》。</p>


<p>加载<samp class="codeph">simpleJson</samp>工具，使用以下语句：</p>


<pre><strong>call syscs_util.syscs_register_tool( 'simpleJson', true )</strong></pre>


<p>此命令在当前架构中创建JSONArray用户定义的类型。该类型绑定到JSON.simple（ <samp class="codeph">org.json.simple.JSONArray</samp> ）。注册命令还在当前模式中创建以下功能。这些功能的Javadoc可以在<em>org.apache.derby.optional.api的公共API中找到<em>。SimpleJsonUtils</em> ：</em></p><em>


<ul>
<li><strong>readArrayFromString（）</strong> -此函数将JSON文档字符串转换为JSONArray值。</li>

<li><strong>readArrayFromFile（）</strong> -此函数读取存储在文件中的JSON文档，并将该文档转换为JSONArray值。</li>

<li><strong>readArrayFromURL（）</strong> -此函数从URL读取JSON文档，并将该文档转换为JSONArray值。</li>

<li><strong>arrayToClob（）</strong> -此函数将JSONArray值转换为Clob，以便可以将其插入文本列中。</li>

</ul>


<p>这些功能具有以下签名：</p>


<pre><strong>
create function readArrayFromString( document varchar( 32672 ) )
returns JSONArray
language java parameter style java contains sql
external name 'org.apache.derby.optional.api.SimpleJsonUtils.readArrayFromString'

create function readArrayFromFile
( fileName varchar( 32672 ), characterSetName varchar( 100 ) )
returns JSONArray
language java parameter style java contains sql
external name 'org.apache.derby.optional.api.SimpleJsonUtils.readArrayFromFile'

create function readArrayFromURL
( urlString varchar( 32672 ), characterSetName varchar( 100 ) )
returns JSONArray
language java parameter style java contains sql
external name 'org.apache.derby.optional.api.SimpleJsonUtils.readArrayFromURL'

create function arrayToClob( jsonDocument JSONArray ) returns clob
language java parameter style java no sql
external name 'org.apache.derby.optional.api.SimpleJsonUtils.arrayToClob'
</strong></pre>


<p>然后，可以使用<em>org.apache.derby.optional.api将前三个函数用于将JSON文档转换为表格数据集<em>。SimpleJsonVTI</em> 。该类也记录在Derby的公共api中。使用此技术，您可以将JSON数据与其他关系数据结合在一起。您还可以利用此技术将JSON数据导入Derby表。这是如何使用这些功能导入数据的示例：</em></p><em>


<pre><strong>
create function thermostatReadings( jsonDocument JSONArray )
returns table
(
  "id" int,
  "temperature" float,
  "fanOn" boolean
)
language java parameter style derby_jdbc_result_set contains sql
external name 'org.apache.derby.optional.api.SimpleJsonVTI.readArray';

insert into thermostatReadings
 select * from table
 (
    thermostatReadings
    (
       readArrayFromURL( 'https://thermostat.feed.org', 'UTF-8' )
    )
 ) t;
</strong></pre>


<p>运行该查询后，目标表的内容可能类似于以下内容：</p>


<pre><strong>
 id         |temperature             |fanOn
 ------------------------------------------
 1          |70.3                    |true 
 2          |65.5                    |false
</strong></pre>


<p>的<samp class="codeph">simpleJson</samp>该工具声明了另一个功能：</p>


<ul>
<li><strong>toJSON（）</strong> -此函数将查询结果转换为JSONArray值。</li>

</ul>


<p>此功能具有以下签名：</p>


<pre><strong>
create function toJSON
(
    queryString varchar( 32672 ),
    queryArgs varchar( 32672 ) ...
)
returns JSONArray
language java parameter style derby reads sql data
external name 'org.apache.derby.optional.json.SimpleJsonTool.toJSON
</strong></pre>


<p>
<strong>toJSON（）</strong>准备查询，将可选的queryArgs插入查询的？中。参数，执行查询，并返回打包到JSONArray中的结果。这是如何使用此功能的示例：</p>


<pre><strong>
values( toJSON( 'select * from thermostatReadings where "id" = ?', '1' ) );
</strong></pre>


<p>该语句返回一个类似于以下内容的JSONArray：</p>


<pre><strong>
[
    { "id": 1, "temperature": 70.3, "fanOn": true }
]
</strong></pre>


<p>可以通过以下命令卸载该工具。此命令删除JSONArray类型和上面讨论的所有功能：</p>


<pre><strong>call syscs_util.syscs_register_tool( 'simpleJson', false )</strong></pre>


</em></em></div><em><em>

</em></em></div><em><em>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="ctoolsopttools.html" title="">可选工具</a></div>
</div>
<div class="relref"><strong>相关参考</strong><br>
<div><a href="rtoolsoptdbmetadata.html" title="databaseMetaData可选工具创建与java.sql中的大多数方法相对应的函数和表函数。DatabaseMetaData接口。">使用databaseMetaData可选工具</a></div>
<div><a href="rtoolsoptforeignviews.html" title="foreignViews可选工具为外部数据库中的所有用户表创建架构，表函数和便利视图。这对于批量导入外部数据很有用。">使用foreignViews可选工具</a></div>
<div><a href="rtoolsoptlucene.html" title="luceneSupport插件是一个可选工具，可让您使用Apache Lucene进行全文索引和搜索Derby文本列的内容。">使用luceneSupport可选工具</a></div>
<div><a href="rtoolsoptdbreader.html" title="rawDBReader可选工具创建函数和视图，可用于将数据从损坏或无法引导的数据库中提取到新的正常数据库中。">使用rawDBReader可选工具</a></div>
</div>
</div>



</em></em></body></html>