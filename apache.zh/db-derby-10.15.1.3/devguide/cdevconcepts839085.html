<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Explicitly closing Statements, ResultSets, and Connections">
<meta name="abstract" content="You should explicitly close Statements, ResultSets, and Connections when you no longer need them, unless you declare them in a try-with-resources statement.">
<meta name="description" content="You should explicitly close Statements, ResultSets, and Connections when you no longer need them, unless you declare them in a try-with-resources statement.">
<meta name="DC.subject" content="Explicit close of JDBC objects">
<meta name="keywords" content="Explicit close of JDBC objects">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts838850.html">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts29416.html">
<meta name="DC.Relation" scheme="URI" content="tdevconcepts839040.html">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts14433.html">
<meta name="DC.Relation" scheme="URI" content="cdevconceptssavepoints.html">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts19173.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="cdevconcepts839085">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>明确关闭语句，结果集和连接</title>
</head>
<body id="cdevconcepts839085" ><a name="cdevconcepts839085"><!-- --></a>


<h1 class="topictitle1">明确关闭语句，结果集和连接</h1>



<div><p>您应该明确关闭<samp class="codeph"><em>Statements</em></samp> ， <samp class="codeph"><em>ResultSets</em></samp>和<samp class="codeph"><em>Connections</em></samp>当您不再需要它们时，除非您在<samp class="codeph"><em>try</em></samp> -with-resources语句。</p>

<p>与<span>Derby的</span>连接是应用程序外部的资源，并且垃圾收集器不会自动关闭它们。</p>

<p>关闭一个<samp class="codeph"><em>Statement</em></samp> ， <samp class="codeph"><em>ResultSet</em></samp> ， 要么<samp class="codeph"><em>Connection</em></samp>未在中声明的对象<samp class="codeph"><em>try</em></samp> -with-resources语句，使用其<samp class="codeph"><em>close</em></samp>方法。如果禁用了自动提交，则必须在关闭连接之前显式提交或回滚活动事务。</p>

<p>语句，结果集和连接扩展<samp class="codeph"><em>AutoCloseable</em></samp> 。如果您在<samp class="codeph"><em>try</em></samp> -with-resources语句，并且有一个代码无法捕获的错误，JRE将尝试自动关闭连接。</p>

<p>请注意，事务严重性或更高的异常会导致<span>Derby</span>中止进行中的事务。但是，语句严重性异常不会回滚事务。另请注意，如果尝试关闭正在进行的事务的连接，则<span>Derby</span>会引发异常。现在假设<samp class="codeph"><em>Connection</em></samp>在<samp class="codeph"><em>try</em></samp> -with-resources语句，正在进行事务处理，并且在内部发生未处理的语句严重性错误<samp class="codeph"><em>try</em></samp> -with-resources块。在这种情况下，当JRE退出<em>try</em> -with-resources块时， <span>Derby</span>将引发后续异常。（有关错误严重性级别的详细信息，请参见<samp class="codeph"><em>derby.stream.error.logSeverityLevel</em></samp> <span><em>Derby参考手册</em></span>中的属性。）</p>

<p>因此，总是最好在内部捕获错误。 <samp class="codeph"><em>try</em></samp> -with-resources块，并进行适当的回滚或提交，以确保在离开时没有挂起的事务<samp class="codeph"><em>try</em></samp> -with-resources块。此操作还提高了应用程序的可移植性，因为在尝试关闭与未决事务的连接时DBMS的语义不同。</p>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="cdevconcepts19173.html" title="事务是一组一个或多个SQL语句的集合，它们构成一个逻辑工作单元，您可以提交或回滚该逻辑工作单元，并且在系统发生故障时可以将其恢复。">事务</a></div>
</div>
<div class="relconcepts"><strong>相关概念</strong><br>
<div><a href="cdevconcepts838850.html" title="禁用自动提交后，可以使用Connection对象的commit和rollback方法来提交或回滚事务。">禁用自动提交时的事务</a></div>
<div><a href="cdevconcepts29416.html" title="默认情况下，JDBC标准指定，与Derby数据库的新连接处于自动提交模式。">使用自动提交</a></div>
<div><a href="cdevconcepts14433.html" title="当SQL语句生成异常时，此异常导致运行时回滚。运行时回滚是Derby生成的系统对语句或事务的回滚，与应用程序中的显式回滚调用不同。">语句与事务运行时回滚</a></div>
<div><a href="cdevconceptssavepoints.html" title="Savepoint接口包含用于将事务设置，释放或回滚到指定保存点的方法。设置保存点后，可以将事务回滚到该保存点，而不会影响之前的工作。保存点通过标记事务中的中间点来提供更细粒度的事务控制。">使用保存点</a></div>
</div>
<div class="reltasks"><strong>相关任务</strong><br>
<div><a href="tdevconcepts839040.html" title="您可以使用Connection类的setAutoCommit方法禁用自动提交。">关闭自动提交</a></div>
</div>
</div>



</body></html>