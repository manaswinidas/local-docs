<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us">
<!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 &quot;http://www.icra.org/ratingsv02.html&quot; l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) &quot;http://www.rsac.org/ratingsv01.html&quot; l gen true r (n 0 s 0 v 0 l 0) &quot;http://www.classify.org/safesurf/&quot; l gen true r (SS~~000 1))">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Working with database threads in an embedded environment">
<meta name="abstract" content="As a rule, do not use Thread.interrupt() calls to signal possibly waiting threads that are also accessing a database, because Derby may catch the interrupt and close the connection to the database. Use wait and notify calls instead.">
<meta name="description" content="As a rule, do not use Thread.interrupt() calls to signal possibly waiting threads that are also accessing a database, because Derby may catch the interrupt and close the connection to the database. Use wait and notify calls instead.">
<meta name="DC.subject" content="threads, interrupt calls, notifying, caught by Derby">
<meta name="keywords" content="threads, interrupt calls, notifying, caught by Derby">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts38375.html">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts41275.html">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts30291.html">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts34828.html">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts23499.html">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts24927.html">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts19524.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="cdevdvlp22619">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>在嵌入式环境中使用数据库线程</title>
</head>
<body id="cdevdvlp22619" ><a name="cdevdvlp22619"><!-- --></a>


<h1 class="topictitle1">在嵌入式环境中使用数据库线程</h1>



<div><p>通常，请勿使用<em>Thread.interrupt（）</em>信号来通知可能正在等待访问数据库的线程，因为<span>Derby</span>可能会捕获该中断并关闭与数据库的连接。改用<em>等待</em> <em>通知</em>电话。</p>

<p>当在一个应用程序中<a href="cdevconcepts23499.html#cdevconcepts23499">使用多个</a>数据库线程时，还需要特别考虑，如<a href="cdevconcepts23499.html#cdevconcepts23499">使用多个线程共享一个连接中所述</a> 。</p>

<p>当等待数据库锁定的查询，批处理和语句的运行时间超出预期时，您可以使用中断来停止它们。如果这样做，将关闭连接并引发异常。</p>

<p>如果您设计的数据库线程可能会看到中断的应用程序，则应计划以下行为：</p>

<ul>
<li>如果在进入<span>Derby</span> JDBC调用之前线程被中断并且未清除中断状态标志，或者如果线程在<span>Derby</span> JDBC调用内部时被中断，则遇到中断的连接将在以下情况下终止：<ul>
<li>如果查询在中断发生后从数据库表中获取行</li>

<li>如果在中断发生后尝试在批处理语句中执行新元素</li>

<li>如果在事务等待锁时收到中断</li>

</ul>

<p>如果连接终止，则应用程序线程将遇到以下后果：</p>

<ul>
<li>JDBC调用将引发状态为“ 08000”（“连接被未知中断关闭”）的<em>SQLException</em> 。</li>

<li>该连接上未完成的事务工作将被回滚，并且其所有锁将被释放。</li>

<li>该连接不能用于执行任何其他JDBC调用。</li>

</ul>

<p>从JDBC调用返回时， <em>线程的Thread.isInterrupted（）</em>方法将返回<em>true</em> ，无论是否引发了终止连接的异常。也就是说，即使<span>Derby</span>不注意中断，该标志在JDBC调用退出时也将保持设置状态。</p>
</li>

<li>所有其他连接将保持打开状态。这包括被中断的线程可能正在使用的其他连接。这些连接将至少在线程尝试使用其其他连接之一之前保持打开状态。如果thead已忽略清除其中断状态标志，则如上所述，此连接也将终止。</li>

<li>应用程序通常应该准备捕获08000异常，丢弃死连接，清除线程的中断状态，然后在新连接中重新启动事务。</li>

</ul>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="cdevconcepts19524.html" title="本节介绍一些高级Derby应用程序概念。">控制Derby应用程序行为</a></div>
</div>
<div class="relconcepts"><strong>相关概念</strong><br>
<div><a href="cdevconcepts38375.html" title="SQL的会话和事务功能是通过JDBC例程而不是通过SQL命令处理的。">JDBC连接和事务模型</a></div>
<div><a href="cdevconcepts41275.html" title="结果集维护一个游标，该游标指向其当前数据行。它可以用来一步一步地处理行。">结果集和游标机制</a></div>
<div><a href="cdevconcepts30291.html" title="本节讨论与多用户系统相关的主题，在这些主题中，并发很重要。">锁定，并发和隔离</a></div>
<div><a href="cdevconcepts34828.html" title="本节讨论如何部署Derby，以便可以在一个数据库中存在许多连接。">使用多个连接到单个数据库</a></div>
<div><a href="cdevconcepts23499.html" title="JDBC允许您在多个线程之间共享一个连接。">使用共享单个连接的多个线程</a></div>
<div><a href="cdevconcepts24927.html" title="JDBC生成的异常是类型java.sql的精炼子类型。SQLException。">在应用程序中使用Derby SQLExceptions</a></div>
</div>
</div>

</body>
</html>