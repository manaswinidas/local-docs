<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us">
<!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 &quot;http://www.icra.org/ratingsv02.html&quot; l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) &quot;http://www.rsac.org/ratingsv01.html&quot; l gen true r (n 0 s 0 v 0 l 0) &quot;http://www.classify.org/safesurf/&quot; l gen true r (SS~~000 1))">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Optimizer support for Derby-style table functions">
<meta name="abstract" content="This topic explains how to fine-tune the Derby optimizer&#39;s decision about where to place a table function in the join order.">
<meta name="description" content="This topic explains how to fine-tune the Derby optimizer&#39;s decision about where to place a table function in the join order.">
<meta name="DC.subject" content="functions, costing table functions, Optimizer">
<meta name="keywords" content="functions, costing table functions, Optimizer">
<meta name="DC.Relation" scheme="URI" content="cdevspecialtabfuncs.html">
<meta name="DC.Relation" scheme="URI" content="cdevspecialtfopttune.html">
<meta name="DC.Relation" scheme="URI" content="cdevspecialtfoptexample.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="cdevspecialtfoptimizer">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>优化程序对Derby样式表功能的支持</title>
</head>
<body id="cdevspecialtfoptimizer" ><a name="cdevspecialtfoptimizer"><!-- --></a>


<h1 class="topictitle1">优化程序对<span>Derby</span>样式表功能的支持</h1>



<div><p>本主题说明如何微调<span>Derby</span>优化器关于在联接顺序中放置表函数的位置的决策。</p>


<p>默认情况下， <span>Derby</span>优化器对表函数进行以下假设：</p>


<ul>
<li><strong>昂贵</strong> -创建和遍历表函数的行非常昂贵。这使得优化器很可能会将表函数放置在连接顺序的外部插槽中，从而使其不会经常循环通过。</li>

<li><strong>可重复</strong> -可以多次实例化表函数，并且结果相同。对于大多数表函数来说，这可能都是正确的。但是，某些表函数可能会打开一次读取流。如果优化器知道表函数是可重复的，则优化器可以将表函数放在内部插槽中，在该内部插槽中可以多次调用该函数。如果表函数不可重复，则优化器必须将其放在最外面的插槽中或调用一次函数并将其内容存储在临时表中。</li>

</ul>


<p>用户可以通过为优化器提供更多信息来覆盖此优化器行为。这样做的方法如下：</p>


<ul>
<li><strong>No-arg构造函数</strong> -表函数的类必须具有一个公共构造函数，其签名没有参数。</li>

<li><strong>VTICosting-</strong>该类还必须实现<em>org.apache.derby.vti。VTICosting</em> 。这涉及实现以下方法，如<a href="cdevspecialtfopttune.html#cdevspecialtfopttune">测量Derby样式表函数的成本</a>和<a href="cdevspecialtfoptexample.html#cdevspecialtfoptexample">示例VTICosting实现中所述</a> ：<ul>
  <li><em>getEstimatedCostPerInstantiation（）</em> -此方法估计调用表函数并遍历其行的开销。返回值将两个估算值相加：<ul>
    <li>空表-这是调用表函数的成本，即使它包含0行也是如此。请参阅“ <a href="cdevspecialtfopttune.html#cdevspecialtfopttune">衡量Derby样式表函数的成本”中</a>对变量<strong>E</strong>的描述。</li>

    <li>扫描-这是循环遍历表函数返回的所有行的成本。请参阅“ <a href="cdevspecialtfopttune.html#cdevspecialtfopttune">测量Derby样式表函数的成本”中</a>的<strong>P * N</strong>的计算。</li>

    </ul>

  </li>

  <li><em>getEstimatedRowCount（）</em> -这将猜测通过调用表函数返回的行数。</li>

  <li><em>supportMultipleInstantiations（）</em> -如果表函数被多次调用时返回不同的结果，则返回false。
  </li>

  </ul>

</li>

</ul>


</div>

<div>
<ul class="ullinks">
<li class="ulchildlink"><strong><a href="cdevspecialtfopttune.html">衡量Derby样式表功能的成本</a></strong><br>本主题显示如何衡量Derby样式表函数的成本。</li>
<li class="ulchildlink"><strong><a href="cdevspecialtfoptexample.html">VTICosting实现示例</a></strong><br>一旦测量了表函数的成本，就可以编写VTICosting方法。</li>
</ul>

<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="cdevspecialtabfuncs.html" title="Derby使您可以创建表函数。表函数是将外部数据打包成类似于Derby表的函数。外部数据可以是XML文件，外部数据库中的表，实时数据源-简而言之，任何可以表示为JDBC ResultSet的信息源。">Derby样式表函数编程</a></div>
</div>
</div>

</body>
</html>