<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Writing context-aware table functions">
<meta name="abstract" content="A context-aware table function is able to access context information that is passed in to it from Derby.">
<meta name="description" content="A context-aware table function is able to access context information that is passed in to it from Derby.">
<meta name="DC.subject" content="functions, context-aware table functions">
<meta name="keywords" content="functions, context-aware table functions">
<meta name="DC.Relation" scheme="URI" content="cdevspecialtabfuncs.html">
<meta name="DC.Relation" scheme="URI" content="cdevspecialtfarchivevti.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="cdevspecialtfcontext">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>编写上下文感知表功能</title>
</head>
<body id="cdevspecialtfcontext" ><a name="cdevspecialtfcontext"><!-- --></a>


<h1 class="topictitle1">编写上下文感知表功能</h1>



<div><p>上下文感知表功能能够访问从<span>Derby</span>传递给它的上下文信息。</p>

<div class="p">满足以下两种情况时，上下文感知表功能将非常有用：<ul>
<li>您想将一个Java方法绑定到许多表函数，每个表函数具有不同的行形状。</li>

<li>您可以在运行时从正在调用的表函数的模式限定名称中确定行的形状。</li>

</ul>
</div>

<p>上下文感知表功能使用<em>org.apache.derby.vti。AwareVTI</em>接口和<em>org.apache.derby.vti。VTIContext</em>类。可以通过<em>AwareVTI</em>接口访问的<em>VTIContext</em>类提供了一些方法，这些方法返回不合格的表函数名称，保存该表函数的模式的名称以及调用该表函数的语句的文本。有关<em>AwareVTI</em>和<em>VTIContext的</em>更多信息，请参见<span>Derby</span>公共API文档。</p>

<p>例如， <em>ArchiveVTI</em>表功能执行一项许多用户认为有用的任务：它提供主表与一组存档表的联合。存档表是定期创建的。创建新的存档表时，主表中最旧的行将移至存档表。</p>

<p>要使用<em>ArchiveVTI</em>表功能，您需要在类路径中包括<em>derbyTesting.jar</em>以及其他<span>Derby</span> jar文件。</p>

<p>以下一系列命令显示了如何使用<em>archiveVTI</em>方法，该方法包含在<span>Derby</span>测试代码中。下一个主题提供了<em>ArchiveVTI</em>类的源代码。
</p>

<p>在此示例中，该方法绑定到两个表函数；一个函数返回一个三列表，另一个函数返回一个两列表。</p>

<pre><strong>java org.apache.derby.tools.ij</strong>
ij version 10.11
ij&gt; <strong>connect 'jdbc:derby:memory:db;create=true';</strong>
ij&gt; <strong>create table t1
(
    keyCol int,
    aCol int,
    bCol int
);</strong>
0 rows inserted/updated/deleted
ij&gt; <strong>create table t1_archive_001 as select * from t1 with no data;</strong>
0 rows inserted/updated/deleted
ij&gt; <strong>create table t1_archive_002 as select * from t1 with no data;</strong>
0 rows inserted/updated/deleted
ij&gt; <strong>insert into t1_archive_002 values ( 1, 100, 1000 ), ( 2, 200, 2000 ),
    ( 3, 300, 3000 );</strong>
3 rows inserted/updated/deleted
ij&gt; <strong>insert into t1_archive_001 values ( 4, 400, 4000 ), ( 5, 500, 5000 ),
    ( 6, 600, 6000 );</strong>
3 rows inserted/updated/deleted
ij&gt; <strong>insert into t1 values ( 7, 700, 7000 ), ( 8, 800, 8000 ), 
    ( 9, 900, 9000 );</strong>
3 rows inserted/updated/deleted
ij&gt; <strong>create table t2
(
    keyCol int,
    aCol int
);</strong>
0 rows inserted/updated/deleted
ij&gt; <strong>create table t2_arc_001 as select * from t2 with no data;</strong>
0 rows inserted/updated/deleted
ij&gt; <strong>create table t2_arc_002 as select * from t2 with no data;</strong>
0 rows inserted/updated/deleted
ij&gt; <strong>insert into t2_arc_002 values ( 1, 100 ), ( 2, 200 ),  ( 3, 300 );</strong>
3 rows inserted/updated/deleted
ij&gt; <strong>insert into t2_arc_001 values ( 4, 400 ), ( 5, 500 ),  ( 6, 600 );</strong>
3 rows inserted/updated/deleted
ij&gt; <strong>insert into t2 values ( 7, 700 ), ( 8, 800 ), ( 9, 900 );</strong>
3 rows inserted/updated/deleted
ij&gt; <strong>create function t1( archiveSuffix varchar( 32672 ) ) returns table
(
    keyCol int,
    aCol int,
    bCol int
)
language java parameter style derby_jdbc_result_set reads sql data
external name 
'org.apache.derbyTesting.functionTests.tests.lang.ArchiveVTI.archiveVTI';</strong>
0 rows inserted/updated/deleted
ij&gt; <strong>create function t2( archiveSuffix varchar( 32672 ) ) returns table
(
    keyCol int,
    aCol int
)
language java parameter style derby_jdbc_result_set reads sql data
external name 
'org.apache.derbyTesting.functionTests.tests.lang.ArchiveVTI.archiveVTI';</strong>
0 rows inserted/updated/deleted
ij&gt; <strong>select * from table( t1( '_ARCHIVE_' ) ) s
where keyCol between 3 and 7
order by keyCol;</strong>
KEYCOL     |ACOL       |BCOL       
-----------------------------------
3          |300        |3000       
4          |400        |4000       
5          |500        |5000       
6          |600        |6000       
7          |700        |7000       
      
5 rows selected
ij&gt; <strong>select * from table( t2( '_ARC_' ) ) s
where keyCol between 3 and 7
order by keyCol;</strong>
KEYCOL     |ACOL       
-----------------------
3          |300        
4          |400        
5          |500        
6          |600        
7          |700        

5 rows selected</pre>

</div>

<div>
<ul class="ullinks">
<li class="ulchildlink"><strong><a href="cdevspecialtfarchivevti.html">ArchiveVTI源代码</a></strong><br>定义archiveVTI表功能的代码如下。</li>
</ul>

<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="cdevspecialtabfuncs.html" title="Derby使您可以创建表函数。表函数是将外部数据打包成类似于Derby表的函数。外部数据可以是XML文件，外部数据库中的表，实时数据源-简而言之，任何可以表示为JDBC ResultSet的信息源。">Derby样式表函数编程</a></div>
</div>
</div>



</body></html>