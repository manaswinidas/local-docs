<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Scrollable updatable result sets">
<meta name="abstract" content="A scrollable updatable result set maintains a cursor which can both scroll and update rows.">
<meta name="description" content="A scrollable updatable result set maintains a cursor which can both scroll and update rows.">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts28351.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="rdevconceptssur">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>可滚动更新的结果集</title>
</head>
<body id="rdevconceptssur" ><a name="rdevconceptssur"><!-- --></a>


<h1 class="topictitle1">可滚动更新的结果集</h1>



<div><p>可滚动的可更新结果集维护着一个可以滚动和更新行的游标。
</p>


<div class="section">
<p>
<span>Derby</span>仅支持<a href="cdevconcepts22641.html">可滚动的不敏感结果集。</a>要创建可更新的可滚动不敏感结果集，必须使用并发模式创建该语句<samp class="codeph">ResultSet.CONCUR_UPDATABLE</samp>和类型<samp class="codeph">ResultSet.TYPE_SCROLL_INSENSITIVE</samp> 。
</p>


<p>使用结果集更新方法更新行的示例：</p>


<pre>
  Statement stmt = conn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, 
                                        ResultSet.CONCUR_UPDATABLE);
  ResultSet uprs = stmt.executeQuery(
    "SELECT FIRSTNAME, LASTNAME, WORKDEPT, BONUS " +
    "FROM EMPLOYEE");

  uprs.absolute(5); // update the fifth row
  int newBonus = uprs.getInt("BONUS") + 100;
  uprs.updateInt("BONUS", newBonus);
  uprs.updateRow();
</pre>


<p>使用例<samp class="codeph">ResultSet.deleteRow()</samp>删除一行：</p>


<pre>
  Statement stmt = conn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, 
                                        ResultSet.CONCUR_UPDATABLE);
  ResultSet uprs = stmt.executeQuery(
    "SELECT FIRSTNAME, LASTNAME, WORKDEPT, BONUS " +
    "FROM EMPLOYEE");
  
  uprs.last();
  uprs.relative(-5); // moves to the 5th from the last row
  uprs.deleteRow(); 
</pre>

</div>


<div class="section" id="rdevconceptssur__visibility"><a name="rdevconceptssur__visibility"><!-- --></a><h2 class="sectiontitle">变化的可见性</h2>

<ul>
<li>由其他语句，触发器和其他事务（其他）引起的更改被视为其他更改，并且在可滚动的不敏感结果集中不可见。</li>

<li>自己的更新和删除在Derby的可滚动不敏感结果集中可见。<div class="note"><span class="notetitle">注意：</span> <span>Derby</span>将使用定位的更新和删除进行的更改作为自己的更改进行处理，因此，通过结果集的光标进行更改时，这些更改也将在该结果集中可见。
</div>
 
</li>

<li>插入到表中的行可能在结果集中可见。</li>


<li><samp class="codeph">ResultSet.rowDeleted()</samp>如果使用游标或结果集删除了该行，则返回true。它不检测其他语句或事务所做的删除。请注意，如果基础结果集为FOR UPDATE并且使用游标删除了该行，则该方法也适用于并发性CONCUR_READ_ONLY的结果集。
</li>

<li><samp class="codeph">ResultSet.rowUpdated()</samp>如果已使用游标或结果集更新了该行，则返回true。它不会检测其他语句或事务所做的更新。请注意，如果基础结果集为FOR UPDATE并且使用游标更新了该行，则该方法也适用于并发性CONCUR_READ_ONLY的结果集。
</li>

<li> <div class="note"><span class="notetitle">注意：</span>两者<samp class="codeph">ResultSet.rowUpdated()</samp>和<samp class="codeph">ResultSet.rowDeleted()</samp>如果首先更新该行，然后再删除该行，则返回true。</div>
 </li>

</ul>请注意，即使在结果集中看不到其他因素引起的更改，访问当前行的SQL操作（包括定位的更新）也将读取并使用数据库中的行数据，而不是在数据库中反映行数据。结果集。

</div>


<div class="section"><h2 class="sectiontitle">作业冲突</h2>

<p>如果一行被另一个提交的事务更新/删除，或者一行被同一事务中的另一条语句更新，则可滚动的不敏感结果集中可能会发生冲突。光标所在的行被锁定，但是一旦移动到另一行，则可以根据事务隔离级别释放该锁定。这意味着可滚动不敏感结果集中的行在获取后可能已被其他事务更新/删除。</p>


<p>由于结果集<strong>不敏感</strong> ，因此它将无法检测到其他人所做的更改。使用结果集进行更新时，被更改的列上发生冲突的更改将被覆盖。</p>某些冲突可能会阻止结果集进行更新/删除：<ul>
<li>该行被读入结果集后已被删除：可滚动的不敏感结果集将显示警告<samp class="codeph"><em>SQLState</em> 01001</samp> 。</li>

<li>该表已被压缩：可滚动的不敏感结果集将给出警告<samp class="codeph"><em>SQLState</em> 01001</samp> 。如果将游标保留在提交上，则可能发生压缩冲突。这是因为表意图锁在提交时释放，并且直到游标移至另一行才被回收。
</li>

</ul>为避免与其他事务冲突，可以将事务隔离级别提高为可重复读取或可序列化。这将使事务对已提交的行保持锁定状态。

<div class="note"><span class="notetitle">注意：</span>使用可保留结果集时，请注意，锁将在提交时释放，并且无论隔离级别如何，都可能发生冲突。如果您的应用程序依赖于结果集的事务性行为，则应该避免使用可保留的结果集。
</div>


</div>


</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="cdevconcepts28351.html" title="可以使用结果集更新方法（updateRow（），deleteRow（）和insertRow（））或使用定位的更新或删除查询来更新Derby中的可更新结果集。">可更新的结果集</a></div>
</div>
</div>



</body></html>