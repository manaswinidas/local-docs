<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Forward only updatable result sets">
<meta name="abstract" content="A forward only updatable result set maintains a cursor which can only move in one direction (forward), and also update rows.">
<meta name="description" content="A forward only updatable result set maintains a cursor which can only move in one direction (forward), and also update rows.">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts28351.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="rdevconceptsfor">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>仅转发可更新的结果集</title>
</head>
<body id="rdevconceptsfor" ><a name="rdevconceptsfor"><!-- --></a>


<h1 class="topictitle1">仅转发可更新的结果集</h1>



<div><p>仅向前可更新的结果集维护着一个游标，该游标只能沿一个方向（向前）移动，并且还可以更新行。
</p>

<div class="section">
<div class="p">要创建仅转发的可更新结果集，必须使用并发模式创建该语句<samp class="codeph">ResultSet.CONCUR_UPDATABLE</samp>和类型<samp class="codeph">ResultSet.TYPE_FORWARD_ONLY</samp> 。
<div class="note"><span class="notetitle">注意：</span>默认类型是<samp class="codeph">ResultSet.TYPE_FORWARD_ONLY</samp> 。</div>

</div>


<p>使用范例<samp class="codeph">ResultSet.updateXXX() + ResultSet.updateRow()</samp>更新一行：</p>


<pre>
  Statement stmt = conn.createStatement(ResultSet.TYPE_FORWARD_ONLY, 
                                        ResultSet.CONCUR_UPDATABLE);
  ResultSet uprs = stmt.executeQuery(
    "SELECT FIRSTNAME, LASTNAME, WORKDEPT, BONUS " +
    "FROM EMPLOYEE");

  while (uprs.next()) {
      int newBonus = uprs.getInt("BONUS") + 100;
      uprs.updateInt("BONUS", newBonus);
      uprs.updateRow();
  }
</pre>


<p>使用范例<samp class="codeph">ResultSet.deleteRow()</samp>删除一行：</p>


<pre>
  Statement stmt = conn.createStatement(ResultSet.TYPE_FORWARD_ONLY, 
                                        ResultSet.CONCUR_UPDATABLE);
  ResultSet uprs = stmt.executeQuery(
    "SELECT FIRSTNAME, LASTNAME, WORKDEPT, BONUS " +
    "FROM EMPLOYEE");

  while (uprs.next()) {
      if (uprs.getInt("WORKDEPT")==300) {
         uprs.deleteRow();
      }
  }
</pre>


</div>


<div class="section"><h2 class="sectiontitle">变化的可见性</h2>


<ul>
<li>在仅转发结果集上进行更新或删除后，结果集的游标不再位于刚更新或删除的行上，而是紧接在结果集的下一行之前（有必要移至下一行）允许任何其他的行操作）。这意味着<samp class="codeph">ResultSet.updateRow()</samp>和<samp class="codeph">ResultSet.deleteRow()</samp>永远不可见。
</li>

<li>如果已插入一行，即使用<samp class="codeph">ResultSet.insertRow()</samp>它可能在仅转发结果集中可见。</li>

</ul>

</div>


<div class="section"><h2 class="sectiontitle">作业冲突</h2>

<p>结果集的当前行不能被其他事务更改，因为它将被更新锁锁定。提交后保持打开状态的结果集必须移至下一行，然后才能对其进行任何操作。</p>某些冲突可能会阻止结果集进行更新/删除：<ul>
<li>如果当前行被同一事务中的语句删除，则调用<samp class="codeph">ResultSet.updateRow()</samp>将导致异常，因为光标不再位于有效行上。</li>

</ul>

</div>


</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="cdevconcepts28351.html" title="可以使用结果集更新方法（updateRow（），deleteRow（）和insertRow（））或使用定位的更新或删除查询来更新Derby中的可更新结果集。">可更新的结果集</a></div>
</div>
</div>



</body></html>