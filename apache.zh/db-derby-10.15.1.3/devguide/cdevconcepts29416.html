<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Using auto-commit">
<meta name="abstract" content="A new connection to a Derby database is in auto-commit mode by default, as specified by the JDBC standard.">
<meta name="description" content="A new connection to a Derby database is in auto-commit mode by default, as specified by the JDBC standard.">
<meta name="DC.subject" content="Auto-commit, using">
<meta name="keywords" content="Auto-commit, using">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts838850.html">
<meta name="DC.Relation" scheme="URI" content="tdevconcepts839040.html">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts839085.html">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts14433.html">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts41275.html">
<meta name="DC.Relation" scheme="URI" content="cdevconceptssavepoints.html">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts19173.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="cdevconcepts29416">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>使用自动提交</title>
</head>
<body id="cdevconcepts29416" ><a name="cdevconcepts29416"><!-- --></a>


<h1 class="topictitle1">使用自动提交</h1>



<div><p>默认情况下，JDBC标准指定，与<span>Derby</span>数据库的新连接处于自动提交模式。</p>

<p>自动提交模式意味着语句完成后，将自动在该语句上调用方法<em>提交</em> 。自动提交实际上使每个SQL语句成为一个事务。当语句完成或执行下一条语句时（以先到者为准），将进行提交。如果语句仅返回转发<samp class="codeph"><em>ResultSet</em></samp> ，则该语句将在最后一行<samp class="codeph"><em>ResultSet</em></samp>已被检索或<samp class="codeph"><em>ResultSet</em></samp>已明确关闭。如果语句返回一个可滚动的<samp class="codeph"><em>ResultSet</em></samp> ，该语句仅在<samp class="codeph"><em>ResultSet</em></samp>已明确关闭。</p>

<p>某些应用程序可能更喜欢在自动提交模式下使用<span>Derby</span> 。有些人可能更喜欢关闭自动提交功能。您应该知道使用任何一种模型的含义。</p>

<p>使用自动提交时，应注意以下几点：</p>

<ul>
<li><em>游标</em>   <p>如果对具有以下内容的游标进行任何定位的更新或删除（即带有WHERE CURRENT OF子句的update或delete语句），则不能使用自动提交。 <samp class="codeph"><em>ResultSet.CLOSE_CURSORS_AT_COMMIT</em></samp>可保持性值集。</p>
<p>自动提交会自动关闭使用显式打开的游标<samp class="codeph"><em>ResultSet.CLOSE_CURSORS_AT_COMMIT</em></samp>值，当您执行就地更新或删除时。</p>
<p>声明要在提交期间保留的可更新游标（这是默认值）可以在关闭游标之前执行更新并发出多个提交。在显式或隐式提交之后，必须通过调用来重新定位可保留的仅向前游标。 <samp class="codeph"><em>next</em></samp>方法，然后才能再次访问。在这种状态下，除了调用<samp class="codeph"><em>next</em></samp>正在打电话<samp class="codeph"><em>close</em></samp> 。</p>
</li>

<li><em>数据库端JDBC例程（使用嵌套连接的例程）</em> 
<p>如果这些函数在当前连接上执行提交或回滚，则无法在SQL语句中执行函数。由于在自动提交模式下，所有SQL语句都是隐式提交的，因此<span>Derby</span>在执行数据库端例程期间将关闭自动提交，并在语句完成后将其重新打开。</p>
<p>使用嵌套连接的例程不允许打开或关闭自动提交。</p>
</li>

<li><em>表级锁定和SERIALIZABLE隔离级别</em>   <p>当应用程序使用表级锁定和SERIALIZABLE隔离级时，所有访问表的语句至少都拥有共享表锁。共享锁可防止其他更新数据的事务访问该表。事务在表上保持锁，直到事务提交。<em>因此，即使是SELECT语句，也要在表上持有共享锁，直到其连接提交并开始新的事务为止。</em></p>
</li>

</ul>

<p>下表总结了启用或禁用自动提交时应用程序的行为。</p>


<div class="tablenoborder"><table cellspacing="0" cellpadding="4" border="1" summary="This table lists several kinds of applicaton behavior and shows what happens with auto-commit on and with auto-commit off." frame="border" rules="all"><caption>表格1。启用或禁用自动提交的应用程序行为</caption>



<thead align="left">
<tr valign="bottom">
<th valign="bottom" width="40%" id="N10152">话题</th>

<th valign="bottom" width="30%" id="N10159">自动提交</th>

<th valign="bottom" width="30%" id="N10160">自动关闭</th>

</tr>

</thead>

<tbody>
<tr>
<td valign="top" width="40%" headers="N10152">交易次数</td>

<td valign="top" width="30%" headers="N10159">每个语句都是一个单独的事务。</td>

<td valign="top" width="30%" headers="N10160">Commit（）或rollback（）完成事务。</td>

</tr>

<tr>
<td valign="top" width="40%" headers="N10152">数据库端JDBC例程（使用嵌套连接的例程）</td>

<td valign="top" width="30%" headers="N10159">自动提交已关闭。</td>

<td valign="top" width="30%" headers="N10160">有效（不允许显式提交或回滚）。</td>

</tr>

<tr>
<td valign="top" width="40%" headers="N10152">可更新的游标</td>

<td valign="top" width="30%" headers="N10159">适用于可保持的游标；不适用于不可保留的游标。</td>

<td valign="top" width="30%" headers="N10160">作品。</td>

</tr>

<tr>
<td valign="top" width="40%" headers="N10152">多个连接访问同一数据</td>

<td valign="top" width="30%" headers="N10159">作品。</td>

<td valign="top" width="30%" headers="N10160">作品。当应用程序使用SERIALIZABLE隔离模式和表级锁定时，并发性较低。</td>

</tr>

<tr>
<td valign="top" width="40%" headers="N10152">可更新结果集</td>

<td valign="top" width="30%" headers="N10159">作品。</td>

<td valign="top" width="30%" headers="N10160">作品。</td>

</tr>

<tr>
<td valign="top" width="40%" headers="N10152">保存点</td>

<td valign="top" width="30%" headers="N10159">不起作用。</td>

<td valign="top" width="30%" headers="N10160">作品。</td>

</tr>

</tbody>

</table>
</div>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="cdevconcepts19173.html" title="事务是一组一个或多个SQL语句的集合，它们构成一个逻辑工作单元，您可以提交或回滚该逻辑工作单元，并且在系统发生故障时可以将其恢复。">事务</a></div>
</div>
<div class="relconcepts"><strong>相关概念</strong><br>
<div><a href="cdevconcepts838850.html" title="禁用自动提交后，可以使用Connection对象的commit和rollback方法来提交或回滚事务。">禁用自动提交时的事务</a></div>
<div><a href="cdevconcepts839085.html" title="除非不再在try-with-resources语句中声明它们，否则应不再需要它们时显式关闭Statements，ResultSets和Connections。">明确关闭语句，结果集和连接</a></div>
<div><a href="cdevconcepts14433.html" title="当SQL语句生成异常时，此异常导致运行时回滚。运行时回滚是Derby生成的系统对语句或事务的回滚，与应用程序中的显式回滚调用不同。">语句与事务运行时回滚</a></div>
<div><a href="cdevconcepts41275.html" title="结果集维护一个游标，该游标指向其当前数据行。它可以用来一步一步地处理行。">结果集和游标机制</a></div>
<div><a href="cdevconceptssavepoints.html" title="Savepoint接口包含用于将事务设置，释放或回滚到指定保存点的方法。设置保存点后，可以将事务回滚到该保存点，而不会影响之前的工作。保存点通过标记事务中的中间点来提供更细粒度的事务控制。">使用保存点</a></div>
</div>
<div class="reltasks"><strong>相关任务</strong><br>
<div><a href="tdevconcepts839040.html" title="您可以使用Connection类的setAutoCommit方法禁用自动提交。">关闭自动提交</a></div>
</div>
</div>



</body></html>