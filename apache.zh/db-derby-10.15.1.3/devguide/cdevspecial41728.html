<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Database-side JDBC routines and SQLExceptions">
<meta name="abstract" content="It is possible to code database-side routines, like application-side methods, to catch SQLExceptions. SQLExceptions that are caught within a routine are hidden from the calling application code.">
<meta name="description" content="It is possible to code database-side routines, like application-side methods, to catch SQLExceptions. SQLExceptions that are caught within a routine are hidden from the calling application code.">
<meta name="DC.subject" content="SQLExceptions, importance of not catching within database-side routines, Database-side JDBC routines, and SQLExceptions">
<meta name="keywords" content="SQLExceptions, importance of not catching within database-side routines, Database-side JDBC routines, and SQLExceptions">
<meta name="DC.Relation" scheme="URI" content="cdevspecial29620.html">
<meta name="DC.Relation" scheme="URI" content="cdevspecial16181.html">
<meta name="DC.Relation" scheme="URI" content="cdevspecial45786.html">
<meta name="DC.Relation" scheme="URI" content="cdevspecial42117.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="cdevspecial41728">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>数据库端JDBC例程和SQLException</title>
</head>
<body id="cdevspecial41728" ><a name="cdevspecial41728"><!-- --></a>


<h1 class="topictitle1">数据库端JDBC例程和SQLException</h1>



<div><p>可以对数据库端例程（如应用程序端方法）进行编码，以捕获<em>SQLExceptions</em> 。例程中捕获的SQLException从调用应用程序代码中隐藏。</p>

<p>当此类<em>SQLExceptions</em>具有事务严重性（例如死锁）时，这种“隐藏”异常会导致意外问题。</p>

<p>这是因为事务严重性的错误会回滚事务已经完成的工作（而不仅仅是调用方法执行的部分），并且静默地开始新的事务。方法执行完成后， <span>Derby</span>会检测到外部语句因死锁而无效，并且还会回滚<em>在新事务中</em>完成的所有工作。这是预期的行为，因为在显式提交之间的所有语句都应被原子处理。由<span>Derby</span>回滚隐式启动的新事务不是应用程序设计人员想要的。</p>

<p>但是，如果在应用程序中调用该方法，则会发生不同的行为。在这种情况下， <span>Derby</span>将回滚该事务完成的工作，并以静默方式开始新事务。该方法返回时，新事务中的工作不会回滚。但是，以这种方式对应用程序进行编码意味着事务未在您期望的位置结束，并且可能是编程错误。不建议以这种方式进行编码。</p>

<p>捕获死锁异常然后继续执行的方法可能会出错。事务严重性错误不应由嵌套代码捕获，而应仅由最外部的应用程序代码捕获。这是确保交易在您期望的位置开始和结束的唯一方法。</p>

<p>并非所有的数据库供应商都以相同的方式处理嵌套死锁。由于这个和其他原因，不可能编写可移植的SQL调用方法。但是，可以编写行为相同的SQL调用方法， <em>而不管是在应用程序中调用它们还是在数据库中作为例程调用它们</em> 。</p>

<p>为了确保在应用程序端和数据库端对嵌套错误的处理相同，请对try-catch块进行编码，以检查异常的严重性，如下所示：</p>

<pre>try {
    preparedStatement.execute();
} catch (SQLException se ) {
    String SQLState = se.getSQLState();
    if ( SQLState.equals( "23505" ) ) {
        correctDuplicateKey();
    } else if ( SQLState.equals( "22003" ) ) {    
        correctArithmeticOverflow();
    } else {
        throw se;
    }
}</pre>

<p>当然，用户也可以选择不将SQL语句包装在方法内的try-catch块中。在这种情况下， <em>SQLExceptions</em>在其应用程序中处于较高的位置，这是所需的行为。</p>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：对</strong> <a href="cdevspecial42117.html" title="在应用程序内调用的方法称为应用程序端方法。在Derby中调用的方法称为数据库端例程。">数据库端JDBC例程进行编程</a></div>
</div>
<div class="relconcepts"><strong>相关概念</strong><br>
<div><a href="cdevspecial29620.html" title="大多数数据库端JDBC例程需要与调用它们的语句共享相同的事务空间。">数据库端JDBC例程和嵌套连接</a></div>
<div><a href="cdevspecial16181.html" title="数据库端JDBC例程可以创建一个新连接，而不是使用嵌套连接。在例程中执行的语句将是不同事务的一部分，因此可以发出提交和回滚。">使用非嵌套连接的数据库端JDBC例程</a></div>
<div><a href="cdevspecial45786.html" title="当数据库端方法的执行引发错误时，Derby将该异常包装在SQLState为38000的SQLException中。">用户定义的SQLException</a></div>
</div>
</div>



</body></html>