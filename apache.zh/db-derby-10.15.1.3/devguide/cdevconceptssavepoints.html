<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Using savepoints">
<meta name="abstract" content="The Savepoint interface contains methods to set, release, or roll back a transaction to designated savepoints. Once a savepoint has been set, the transaction can be rolled back to that savepoint without affecting preceding work. Savepoints provide finer-grained control of transactions by marking intermediate points within a transaction.">
<meta name="description" content="The Savepoint interface contains methods to set, release, or roll back a transaction to designated savepoints. Once a savepoint has been set, the transaction can be rolled back to that savepoint without affecting preceding work. Savepoints provide finer-grained control of transactions by marking intermediate points within a transaction.">
<meta name="DC.subject" content="java.sql.Savepoint, Savepoints (JDBC), Savepoints, setting and rollong back, releasing">
<meta name="keywords" content="java.sql.Savepoint, Savepoints (JDBC), Savepoints, setting and rollong back, releasing">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts838850.html">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts29416.html">
<meta name="DC.Relation" scheme="URI" content="tdevconcepts839040.html">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts839085.html">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts14433.html">
<meta name="DC.Relation" scheme="URI" content="cdevconcepts19173.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="cdevconceptssavepoints">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>使用保存点</title>
</head>
<body id="cdevconceptssavepoints" ><a name="cdevconceptssavepoints"><!-- --></a>


<h1 class="topictitle1">使用保存点</h1>



<div><p><em>Savepoint</em>接口包含用于将事务设置，释放或回滚到指定保存点的方法。设置保存点后，可以将事务回滚到该保存点，而不会影响之前的工作。保存点通过标记事务中的中间点来提供更细粒度的事务控制。
</p>

<div class="section"><h2 class="sectiontitle">设置并回滚到保存点</h2>
<p><em>Connection.setSavepoint</em>方法在当前事务中设置一个保存点。<em>Connection.rollback</em>方法被重载以采用保存点参数。</p>

<div class="p">下面的代码示例在表中插入一行，设置保存点<samp class="codeph">svpt1</samp> ，然后插入第二行。以后将事务回滚到<samp class="codeph">svpt1</samp> ，第二次插入被撤消，但第一次插入保持不变。换句话说，提交事务时，仅将包含'1'的行添加到TABLE1中。
<pre><strong>conn.setAutoCommit(false); // Autocommit must be off to use savepoints.
Statement stmt = conn.createStatement();
int rows = stmt.executeUpdate("INSERT INTO TABLE1 (COL1) VALUES(1)");
// set savepoint
Savepoint svpt1 = conn.setSavepoint("S1");
rows = stmt.executeUpdate("INSERT INTO TABLE1 (COL1) VALUES (2)");
...
conn.rollback(svpt1);
...
conn.commit();</strong></pre>
</div>

</div>

<div class="section"><h2 class="sectiontitle">释放保存点</h2>
<p><em>Connection.releaseSavepoint</em>方法将<em>Savepoint</em>对象作为参数，并将其从当前事务中删除。释放保存点后，尝试在回滚操作中引用该保存点将引发<em>SQLException</em> 。</p>

<p>在提交事务或回滚整个事务时，将自动释放在事务中创建的所有保存点，并使其无效。</p>

<p>将事务回滚到保存点会自动释放，并使在该保存点之后创建的任何其他保存点无效。</p>

</div>

<div class="section"><h2 class="sectiontitle">保存点规则</h2>
<p>无法在一批语句中设置保存点以启用部分恢复。如果在调用<em>executeBatch</em>方法之前的任何时间设置了保存点，则在执行已添加到该批处理中的任何语句之前将其设置为保存点。</p>

<p>保存点可以在显式释放（通过发布保存点）或隐式（通过向该保存点或早于该保存点声明的保存点发出连接提交/回滚）后重新使用。</p>

<p>可以嵌套保存点，但只能在嵌入式环境中。</p>

</div>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="cdevconcepts19173.html" title="事务是一组一个或多个SQL语句的集合，它们构成一个逻辑工作单元，您可以提交或回滚该逻辑工作单元，并且在系统发生故障时可以将其恢复。">事务</a></div>
</div>
<div class="relconcepts"><strong>相关概念</strong><br>
<div><a href="cdevconcepts838850.html" title="禁用自动提交后，可以使用Connection对象的commit和rollback方法来提交或回滚事务。">禁用自动提交时的事务</a></div>
<div><a href="cdevconcepts29416.html" title="默认情况下，JDBC标准指定，与Derby数据库的新连接处于自动提交模式。">使用自动提交</a></div>
<div><a href="cdevconcepts839085.html" title="除非不再在try-with-resources语句中声明它们，否则应不再需要它们时显式关闭Statements，ResultSets和Connections。">明确关闭语句，结果集和连接</a></div>
<div><a href="cdevconcepts14433.html" title="当SQL语句生成异常时，此异常导致运行时回滚。运行时回滚是Derby生成的系统对语句或事务的回滚，与应用程序中的显式回滚调用不同。">语句与事务运行时回滚</a></div>
</div>
<div class="reltasks"><strong>相关任务</strong><br>
<div><a href="tdevconcepts839040.html" title="您可以使用Connection类的setAutoCommit方法禁用自动提交。">关闭自动提交</a></div>
</div>
</div>



</body></html>