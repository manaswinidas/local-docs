<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Reclaiming unused space">
<meta name="abstract" content="A Derby table or index (sometimes called a conglomerate) can contain unused space after large amounts of data have been deleted or updated.">
<meta name="description" content="A Derby table or index (sometimes called a conglomerate) can contain unused space after large amounts of data have been deleted or updated.">
<meta name="DC.subject" content="Compressing tables and indexes, conglomerate, description">
<meta name="keywords" content="Compressing tables and indexes, conglomerate, description">
<meta name="DC.Relation" scheme="URI" content="cadminparttwo.html">
<meta name="DC.Relation" scheme="URI" content="cadmindbintegrity.html">
<meta name="DC.Relation" scheme="URI" content="cadminconsist01.html">
<meta name="DC.Relation" scheme="URI" content="cadminhubbkup98797.html">
<meta name="DC.Relation" scheme="URI" content="cadminimport16245.html">
<meta name="DC.Relation" scheme="URI" content="cadminreplication.html">
<meta name="DC.Relation" scheme="URI" content="cadminlog98.html">
<meta name="DC.Relation" scheme="URI" content="cadminlockvti42553.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="cadminspace21579">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>回收未使用的空间</title>
</head>
<body id="cadminspace21579" ><a name="cadminspace21579"><!-- --></a>


<h1 class="topictitle1">回收未使用的空间</h1>



<div><p>在删除或更新了大量数据之后， <span>Derby</span>表或索引（有时称为<em>集团</em> ）可以包含未使用的空间。</p>

<p>发生这种情况的原因是，默认情况下， <span>Derby</span>不会将未使用的空间返回给操作系统。在将页面分配给表或索引之后，即使不再需要该空间， <span>Derby</span>也不会自动将该页面返回操作系统，直到删除表或索引为止。但是， <span>Derby</span>确实提供了一种回收表和关联索引中未使用空间的方法。</p>

<p>如果确定表及其索引具有大量未使用空间，请使用<samp class="codeph">SYSCS_UTIL.SYSCS_COMPRESS_TABLE</samp>要么<samp class="codeph">SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE</samp>回收空间的程序。 <samp class="codeph">SYSCS_UTIL.SYSCS_COMPRESS_TABLE</samp>确保以语句提交之前临时创建新表和索引为代价，恢复最大可用空间。
<samp class="codeph">SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE</samp>尝试回收同一表中的空间，但不能保证它将恢复所有可用空间。两种程序之间的区别在于<samp class="codeph">SYSCS_UTIL.SYSCS_COMPRESS_TABLE</samp> ， <samp class="codeph">SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE</samp>该过程不使用临时文件，而是在同一集团内四处移动行。</p>

<p>您可以使用<samp class="codeph">SYSCS_DIAG.SPACE_TABLE</samp>诊断表，通过特别检查NUMFREEPAGES和ESTIMSPACESAVING列的值来估计表或索引中未使用空间的数量。例如：</p>

<pre><strong>SELECT * FROM TABLE(SYSCS_DIAG.SPACE_TABLE('APP', 'FLIGHTAVAILABILITY')) AS T</strong></pre>

<p>有关更多信息<samp class="codeph">SYSCS_DIAG.SPACE_TABLE</samp>请参阅《 <span><em>Derby参考手册</em></span> 》中的“ SYSCS_DIAG诊断表和功能”。</p>

<div class="example">
<p>举例来说，在您确定<samp class="codeph">FlightAvailability</samp>表及其相关索引的未使用空间过多，您可以使用以下命令回收该空间：</p>

<pre><strong>call SYSCS_UTIL.SYSCS_COMPRESS_TABLE('APP', 'FLIGHTAVAILABILITY', 0);</strong></pre>

<p>中的第三个参数<samp class="codeph">SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE</samp>过程确定操作将以顺序模式还是非顺序模式运行。如果指定<samp class="codeph">0</samp>对于过程中的第三个参数，该操作将以非顺序模式运行。在顺序模式下， <span>Derby</span>压缩表并顺序索引，一次压缩一个。顺序压缩使用较少的内存和磁盘空间，但速度较慢。要强制操作以顺序模式运行，请用非零的SMALLINT值替换第三个参数。以下示例显示如何强制该过程以顺序模式运行：</p>

<pre><strong>call SYSCS_UTIL.SYSCS_COMPRESS_TABLE('APP', 'FLIGHTAVAILABILITY', 1);</strong></pre>

</div>

<div class="section">有关此命令的更多信息，请参见《 <span><em>Derby参考手册》</em></span> 。</div>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="cadminparttwo.html" title="">第二部分：Derby管理指南</a></div>
</div>
<div class="relconcepts"><strong>相关概念</strong><br>
<div><a href="cadmindbintegrity.html" title="数据库管理员最重要的职责之一就是维护数据库的完整性并防止其损坏。">维护数据库完整性</a></div>
<div><a href="cadminconsist01.html" title="执行备份后，或者如果遇到硬件或操作系统故障，则可以使用SYSCS_UTIL.SYSCS_CHECK_TABLE系统函数来验证数据库是否仍然一致。">检查数据库一致性</a></div>
<div><a href="cadminhubbkup98797.html" title="Derby提供了一种在脱机或联机时备份数据库的方法。您也可以从指定位置还原完整备份。">备份和还原数据库</a></div>
<div><a href="cadminimport16245.html" title="您可以在文件和Derby数据库之间导入和导出大量数据。您不必使用INSERT和SELECT语句，而可以使用Derby系统过程将数据直接从文件导入表中，以及将数据从表导出到文件中。">导入和导出数据</a></div>
<div><a href="cadminreplication.html" title="复制是强大的数据库管理系统的重要功能。在Derby中，使用连接URL属性启动数据库复制。">复制数据库</a></div>
<div><a href="cadminlog98.html" title="通过将数据库的日志放在单独的设备上，可以提高更新密集型大型数据库的性能，从而减少I / O争用。">在单独的设备上登录</a></div>
<div><a href="cadminlockvti42553.html" title="Derby提供了一种监视和显示锁定信息的工具。">获取锁定信息</a></div>
</div>
</div>



</body></html>