<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Starting and running replication">
<meta name="abstract" content="Each replicated database is replicated from a master to a slave version of that database.">
<meta name="description" content="Each replicated database is replicated from a master to a slave version of that database.">
<meta name="DC.subject" content="replicating databases, starting and running, database replication">
<meta name="keywords" content="replicating databases, starting and running, database replication">
<meta name="DC.Relation" scheme="URI" content="cadminreplication.html">
<meta name="DC.Relation" scheme="URI" content="cadminreplicstop.html">
<meta name="DC.Relation" scheme="URI" content="cadminreplicfailover.html">
<meta name="DC.Relation" scheme="URI" content="cadminreplicsecurity.html">
<meta name="DC.Relation" scheme="URI" content="cadminreplicfailures.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="cadminreplicstartrun">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>启动和运行复制</title>
</head>
<body id="cadminreplicstartrun" ><a name="cadminreplicstartrun"><!-- --></a>


<h1 class="topictitle1">启动和运行复制</h1>



<div><p>每个复制的数据库都从该数据库的主版本复制到从版本。</p>

<p>最初没有复制；必须先创建一个主数据库，然后才能对其进行复制。复制开始时，数据库当然可以为空。另一方面，无需在创建数据库后立即指定复制；创建数据库后，可以随时启动它。</p>

<p>开始复制之前，必须关闭主数据库，然后将数据库复制到从属位置。请按照以下步骤开始复制：</p>

<ol>
<li>确保主系统上的数据库已完全关闭。</li>

<li>将数据库复制到从属位置。</li>

<li>在充当数据库从属的<span>Derby</span>实例上启动从属复制模式。要启动从属复制，请使用<samp class="codeph">startSlave=true</samp>属性以及（可选） <samp class="codeph">slaveHost=<em>hostname</em></samp>和<samp class="codeph">slavePort=<em>portValue</em></samp>属性。例如，对于一个名为<samp class="codeph">wombat</samp> ，您可以使用以下连接URL：<pre>jdbc:derby:wombat;startSlave=true</pre>
</li>

<li>在充当数据库主服务器的<span>Derby</span>实例上启动主复制模式。要开始复制，请使用以下命令连接到主系统上的数据库： <samp class="codeph">startMaster=true</samp>属性与<samp class="codeph">slaveHost=<em>hostname</em></samp>属性（以及（可选） <samp class="codeph">slavePort=<em>portValue</em></samp>属性）。例如，您可以使用以下连接URL：<pre>jdbc:derby:wombat;startMaster=true;slaveHost=myremotesystem</pre>成功使用<samp class="codeph">startMaster=true</samp>属性也会启动数据库。</li>

</ol>

<p>有关这些属性的详细信息，请参见《 <span><em>Derby参考手册</em></span> 》。</p>

<p>复制开始后，从服务器准备好从主服务器接收记录的操作。主机现在可以继续处理事务。从这一点开始，主机将所有记录的操作分批转发给从机。从服务器通过应用<span>Derby</span>事务日志的内容来重复这些操作，但是不处理任何其他操作。尝试连接到从属数据库的尝试被拒绝。万一发生故障，从服务器可以恢复到发送事务日志的最后一块时主机的状态。</p>

<p>复制正在运行时，不允许关闭从数据库或主数据库。必须先停止复制，然后才能关闭从数据库或主数据库。此规则有一个例外：如果关闭了整个系统，则关闭的对等方会通知另一个复制对等方复制已停止。</p>

<p>如果在复制运行时在主系统上安装jar文件，则不会自动在从属服务器上安装相同的jar。但是，因为发送到从属系统的事务日志信息包括jar文件安装，所以从属数据库具有jar文件的记录，即使它们实际上并不存在。因此，您必须在故障转移后通过调用以下命令之一将jar文件安装在以前的从属服务器上： <samp class="codeph">SQLJ.remove_jar</samp>其次是<samp class="codeph">SQLJ.install_jar</samp> ， 要么<samp class="codeph">SQLJ.replace_jar</samp> 。（有关安装jar文件的信息，请参阅《 <span><em>Derby开发人员指南</em></span> 》中的“从数据库加载类<span><em>”</em></span>和《 <span><em>Derby参考手册</em></span> 》中的“在数据库中存储jar文件的系统过程”。）</p>

<p>如果jar文件必须在故障转移后立即可供客户端使用，则必须停止复制，然后从头开始重新开始复制，以便从数据库与主数据库具有相同的jar文件。</p>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="cadminreplication.html" title="复制是强大的数据库管理系统的重要功能。在Derby中，使用连接URL属性启动数据库复制。">复制数据库</a></div>
</div>
<div class="relconcepts"><strong>相关概念</strong><br>
<div><a href="cadminreplicstop.html" title="要停止数据库复制，请使用stopMaster = true连接URL属性连接到master数据库。">停止复制</a></div>
<div><a href="cadminreplicfailover.html" title="您可以随时将具有从属角色的Derby数据库转换为可以处理事务的普通Derby数据库。从从服务器转变为活动Derby数据库的这种转换称为故障转移。">强制故障转移</a></div>
<div><a href="cadminreplicsecurity.html" title="如果要在启用安全管理器的情况下执行复制，则必须在主系统和从系统上都修改安全策略文件，以允许主从网络连接。">复制和安全性</a></div>
<div><a href="cadminreplicfailures.html" title="复制可能会遇到几种故障情况。下表列出了这些情况，并描述了Derby所采取的措施。">复制失败处理</a></div>
</div>
</div>



</body></html>