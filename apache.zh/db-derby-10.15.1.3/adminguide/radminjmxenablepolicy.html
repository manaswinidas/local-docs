<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="reference">
<meta name="DC.Title" content="Fine-grained authorization using a security policy">
<meta name="abstract" content="When you start the Network Server from the command line, it installs a security manager and a basic security policy by default.">
<meta name="description" content="When you start the Network Server from the command line, it installs a security manager and a basic security policy by default.">
<meta name="DC.subject" content="Java Management Extensions (JMX) technology, JMX, using a security policy">
<meta name="keywords" content="Java Management Extensions (JMX) technology, JMX, using a security policy">
<meta name="DC.Relation" scheme="URI" content="radminjmxenabledisable.html">
<meta name="DC.Relation" scheme="URI" content="radminjmxenablenoauth.html">
<meta name="DC.Relation" scheme="URI" content="radminjmxenablepwd.html">
<meta name="DC.Relation" scheme="URI" content="radminjmxenablepwdssl.html">
<meta name="DC.Relation" scheme="URI" content="radminjmxenablesimpleauth.html">
<meta name="DC.Relation" scheme="URI" content="radminjmxdisable.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="radminjmxenablepolicy">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>使用安全策略的细粒度授权</title>
</head>
<body id="radminjmxenablepolicy" ><a name="radminjmxenablepolicy"><!-- --></a>


<h1 class="topictitle1">使用安全策略的细粒度授权</h1>



<div><p>当您从命令行启动网络服务器时，默认情况下它将安装安全管理器和基本安全策略。</p>

<div class="section">
<p>该策略包括必需的权限，如果禁用了JMX用户身份验证，则允许JMX用户访问<span>Derby</span> MBean。如果启用了JMX用户身份验证，则可能需要向特定用户（JMXPrincipals）授予其他权限。</p>

<p>的<samp class="codeph">NetworkServerMBean</samp>的<samp class="codeph">ping</samp>操作需要<samp class="codeph">derbynet.jar</samp>文件将被授予默认安全策略中未包括的其他权限：</p>

<pre>// If the server is listening on the loopback interface only (default)
permission java.net.SocketPermission "localhost", "connect,resolve";

// If the server's network interface setting (-h or derby.drda.host) is
//   non-default
// Note: Allows outbound connections to any host!
permission java.net.SocketPermission "*", "connect,resolve";</pre>

<p>如果您使用的是自定义安全策略，请参阅<span>Derby</span> MBean的公共API文档和<span>Derby</span>安全策略文件模板（ <samp class="codeph">$DERBY_HOME/demo/templates/server.policy</samp> ），以获取有关可能需要设置的权限的详细信息，以允许或限制特定的JMX访问。如果您正在运行安装了安全管理器的嵌入式<span>Derby，</span>则此建议也适用。</p>

<p>有关安全策略文件的更多信息，请参见《 <span><em>Derby安全指南</em></span> 》中的“配置Java安全性”。</p>

<p>以下代码中包含一些示例权限。这些权限不一定适用于任何特定的应用程序或环境。可能需要一些定制。该代码仅包含与<span>Derby</span> JMX功能有关的权限。使用<span>Derby</span>需要其他权限。</p>

<pre>//
// permissions for the user/principal "controlRole", for all codebases:
//
grant principal javax.management.remote.JMXPrincipal "controlRole" {

  // <span>Derby</span> system permissions (what is the user allowed to do?)
  //  See API docs for SystemPermission and the specific MBeans for 
  //  details.
  permission org.apache.derby.security.SystemPermission "jmx", "control";
  permission org.apache.derby.security.SystemPermission "engine", 
      "monitor";
  permission org.apache.derby.security.SystemPermission "server", 
      "monitor,control";

  // MBean permissions (which mbeans and associated actions should be
  //  allowed for this user?)
  //  Target name format is: className#member[objectName], where
  //   objectName is: domain:keyProperties
  //  Asterisk (*) means "all". See MBeanPermission API docs for details.
  permission javax.management.MBeanPermission 
      "org.apache.derby.mbeans.*#*[org.apache.derby:*]", "getAttribute";
  permission javax.management.MBeanPermission 
      "org.apache.derby.mbeans.JDBCMBean#acceptsURL[org.apache.derby:*]",
      "invoke";
  permission javax.management.MBeanPermission 
"org.apache.derby.mbeans.drda.NetworkServerMBean#ping[org.apache.derby:*]",
      "invoke";
  permission javax.management.MBeanPermission 
      "org.apache.derby.mbeans.ManagementMBean#*[org.apache.derby:*]", 
      "invoke";

  // Extra permissions for application controlled ManagementMBean:
  //   Not needed if you do not intend to create/register your own
  //   <span>Derby</span> Management MBean.
  //   Wildcards (*) allow all domains, key properties and MBean members.
  //   You may want to be more specific here.
  permission javax.management.MBeanPermission 
      "org.apache.derby.mbeans.Management#-[*:*]", 
      "instantiate,registerMBean,unregisterMBean";
  permission javax.management.MBeanPermission 
      "org.apache.derby.mbeans.Management#*[*:*]", "invoke";

  //
  // jconsole:
  //  - most of these permissions are needed to let JConsole query the 
  //    MBean server and display information about <span>Derby</span>'s mbeans as well
  //    as some default platform MBeans/MXBeans.
  //  - if you don't use JConsole, but query the MBean server from your
  //    JMX client app, some of these permissions may be needed.
  permission javax.management.MBeanPermission 
      "org.apache.derby.mbeans.*#-[org.apache.derby:*]", 
      "getMBeanInfo,queryNames,isInstanceOf";
  permission javax.management.MBeanPermission 
      "sun.management.*#-[java.*:*]", 
      "getMBeanInfo,isInstanceOf,queryNames";
  permission javax.management.MBeanPermission 
      "sun.management.*#*[java.*:*]", "getAttribute,invoke";
  permission javax.management.MBeanPermission 
      "sun.management.*#-[com.sun.management*:*]", 
      "getMBeanInfo,isInstanceOf,queryNames";
  permission javax.management.MBeanPermission 
      "com.sun.management.*#-[java.*:*]", 
      "getMBeanInfo,isInstanceOf,queryNames";
  permission javax.management.MBeanPermission 
      "com.sun.management.*#*[java.*:*]", "getAttribute,invoke";
  permission javax.management.MBeanPermission "java.*#-[java.*:*]", 
      "getMBeanInfo,isInstanceOf,queryNames";
  permission javax.management.MBeanPermission 
"javax.management.MBeanServerDelegate#-[JMImplementation:type=MBeanServerDelegate]", 
      "getMBeanInfo,isInstanceOf,queryNames,addNotificationListener";
  permission java.net.SocketPermission "*", "resolve";
  permission java.util.PropertyPermission "java.class.path", "read";
  permission java.util.PropertyPermission "java.library.path", "read";
  permission java.lang.management.ManagementPermission "monitor";
  // end jconsole
};


grant codeBase "${derby.install.url}derby.jar"
{
  // Allows <span>Derby</span> to create an MBeanServer:
  //
  permission javax.management.MBeanServerPermission "createMBeanServer";

  // Allows access to <span>Derby</span>'s built-in MBeans, within the domain 
  //  org.apache.derby. <span>Derby</span> must be allowed to register and unregister
  //  these MBeans.
  // It is possible to allow access only to specific MBeans, attributes,
  //  or operations. To fine-tune this permission, see the API doc of 
  //  javax.management.MBeanPermission or the JMX Instrumentation and
  //  Agent Specification. 
  //
  permission javax.management.MBeanPermission 
      "org.apache.derby.*#[org.apache.derby:*]", 
      "registerMBean,unregisterMBean";

  // Trusts <span>Derby</span> code to be a source of MBeans and to register these in
  // the MBean server.
  //
  permission javax.management.MBeanTrustPermission "register";

  // Gives permission for JMX to be used against <span>Derby</span>.
  // If JMX user authentication is being used, a whole set of
  //  fine-grained permissions needs to be granted to allow specific
  //  users access to MBeans and actions they perform (see JMXPrincipal
  //  permissions above).
  // Needed to allow access to all actions related to MBeans in the
  // org.apache.derby.mbeans package.
  //
  permission org.apache.derby.security.SystemPermission "jmx", "control";
  permission org.apache.derby.security.SystemPermission "engine", 
      "monitor";
  permission org.apache.derby.security.SystemPermission "server", 
      "monitor";

  // add additonal derby.jar related permissions here...
};


grant codeBase "${derby.install.url}derbynet.jar"
{
  // Accept connections from any host (only localhost access is required
  //  for JMX).
  //
  permission java.net.SocketPermission "*", "accept"; 

  // For outbound MBean operations such as NetworkServerMBean's ping:
  // The wildcard "*" is to allow pings to both localhost and any other
  //  server host.
  //
  permission java.net.SocketPermission "*", "connect,resolve"; 

  // Gives permission for JMX to be used against <span>Derby</span>.
  // If JMX user authentication is being used, a whole set of
  //  fine-grained permissions need to be granted to allow specific users
  //  access to MBeans and actions they perform (see JMXPrincipal
  //  permissions above).
  // Needed to allow access to all actions related to the 
  //  NetworkServerMBean.
  //
  permission org.apache.derby.security.SystemPermission "server", 
      "control,monitor";

  // add additonal derbynet.jar related permissions here...</pre>

<p>在上面的示例中，系统属性<samp class="codeph">derby.install.url</samp>用于告诉安全管理器/策略实现在哪里找到代码库<samp class="codeph">derby.jar</samp>和<samp class="codeph">derbynet.jar</samp> 。使用属性可提供灵活性；但是，可以通过直接在策略文件中指定完整的代码库URL来避免使用此类属性。可以在命令行上指定此属性的值，如下所示：</p>

<pre>-Dderby.install.url=file:/home/user/derby/10.9.1/lib/</pre>

<p>要么</p>

<pre>-Dderby.install.url=file:/C:/derby/10.9.1/lib/</pre>

<p>有关策略文件，授予权限和属性扩展的更多信息，请参见<a href="http://docs.oracle.com/javase/7/docs/technotes/guides/security/PolicyFiles.html" target="_blank">http://docs.oracle.com/javase/7/docs/technotes/guides/security/PolicyFiles.html上的</a> “默认策略实现和策略文件语法”。以及<a href="http://docs.oracle.com/javase/7/docs/technotes/guides/security/PolicyGuide.html" target="_blank">http://docs.oracle.com/javase/7/docs/technotes/guides/security/PolicyGuide.html上的</a> “策略文件创建和管理”。</p>

</div>

<div class="section"><h2 class="sectiontitle">调试权限问题</h2>
<p>与安全管理器，策略文件和权限打交道并不总是那么容易。有时由于某些您不了解的安全性或权限问题，您要执行的操作失败。以下提示可能会有所帮助。</p>

<p>启动受安全管理器保护的JVM时，添加一个<samp class="codeph">java.security.debug</samp>标志以查看与安全策略和权限使用相关的详细输出。有关有效选项的列表，请使用以下命令：</p>

<pre><strong>java -Djava.security.debug=help</strong></pre>

<p>例如，从命令行启动网络服务器时，可以使用以下选项：</p>

<pre>-Djava.security.debug=access:failure</pre>

<p>此选项会将信息打印到控制台，使您可以专门了解发生故障时授予的权限和丢失的权限。由于设置调试标志时会生成大量输出，因此明智的做法是将输出存储在文件中，然后进行搜索。</p>

<p>例如，要查找有关缺少的权限的详细信息，请在输出中搜索文本“拒绝访问”，您将看到类似以下内容：</p>

<pre>access: access denied 
    (org.apache.derby.security.SystemPermission engine monitor)
java.lang.Exception: Stack trace
   at java.lang.Thread.dumpStack(Thread.java:1158)
   ...
   at org.apache.derby.iapi.services.info.Version.getVersionString
       (Unknown Source)
...</pre>

<p>上面的示例输出显示<samp class="codeph">derby.jar</samp>由于JMX客户端正在访问以下代码，因此代码库缺少以下权限<samp class="codeph">VersionString</samp>的属性<samp class="codeph">VersionMBean</samp>对于<samp class="codeph">derby.jar</samp> ：</p>

<pre>org.apache.derby.security.SystemPermission "engine", "monitor";</pre>

<p></p>

</div>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="radminjmxenabledisable.html" title="您可以在本地和远程使用JMX管理和监视。">启用和禁用JMX</a></div>
</div>
<div class="relref"><strong>相关参考</strong><br>
<div><a href="radminjmxenablenoauth.html" title="以下简单示例使用Oracle JDK JVM在命令行上启动了启用了不安全的远程JMX管理和监视的Derby Network Server。">在没有身份验证或SSL的情况下启用远程JMX</a></div>
<div><a href="radminjmxenablepwd.html" title="一些JVM包含对JMX密码身份验证的内置支持。">仅使用密码身份验证启用远程JMX</a></div>
<div><a href="radminjmxenablepwdssl.html" title="本示例说明如何如下启动网络服务器。">使用密码验证和SSL启用远程JMX</a></div>
<div><a href="radminjmxenablesimpleauth.html" title="一些JVM支持用于控制JMX访问的简单访问文件系统。">使用访问文件进行简单授权</a></div>
<div><a href="radminjmxdisable.html" title="您可能希望在注重安全性的环境中禁用或限制对MBean的访问。您可以使用以下两种技术之一来执行此操作。">禁用对MBean的访问</a></div>
</div>
</div>



</body></html>