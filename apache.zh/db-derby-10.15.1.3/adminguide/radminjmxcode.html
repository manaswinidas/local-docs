<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="reference">
<meta name="DC.Title" content="Using custom Java code to access the Derby MBeans">
<meta name="abstract" content="In addition to using a tool like JConsole, you can also access the Derby MBeans from a Java application.">
<meta name="description" content="In addition to using a tool like JConsole, you can also access the Derby MBeans from a Java application.">
<meta name="DC.subject" content="Java Management Extensions (JMX) technology, JMX, using custom Java code">
<meta name="keywords" content="Java Management Extensions (JMX) technology, JMX, using custom Java code">
<meta name="DC.Relation" scheme="URI" content="cadminjmxoverview.html">
<meta name="DC.Relation" scheme="URI" content="radminjmxintro.html">
<meta name="DC.Relation" scheme="URI" content="radminjmxenabledisable.html">
<meta name="DC.Relation" scheme="URI" content="radminjmxjconsole.html">
<meta name="DC.Relation" scheme="URI" content="radminjmxtroubleshoot.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="radminjmxcode">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>使用自定义Java代码访问Derby MBean</title>
</head>
<body id="radminjmxcode" ><a name="radminjmxcode"><!-- --></a>


<h1 class="topictitle1">使用自定义Java代码访问<span>Derby</span> MBean</h1>



<div><p>除了使用JConsole之类的工具外，您还可以从Java应用程序访问<span>Derby</span> MBean。</p>

<div class="section">
<p>如何执行此操作可能取决于您如何配置运行<span>Derby</span>的JVM，如何配置用户身份验证和授权或要从其访问MBean的主机。</p>

<p>本节提供了一些示例代码来帮助您入门。您将在软件包中找到所需的JMX类<samp class="codeph">javax.management</samp>和<samp class="codeph">javax.management.remote</samp> 。</p>

<p>JMX客户端应用程序的类路径中不需要任何<span>Derby</span>库（除非使用了MBean代理）。</p>

</div>

<div class="section" id="radminjmxcode__connmbeanserver"><a name="radminjmxcode__connmbeanserver"><!-- --></a><h2 class="sectiontitle">连接到MBean服务器</h2>
<p><span>Derby</span>将尝试向运行<span>Derby</span>系统的JVM的平台MBean服务器（嵌入式或网络服务器）注册其MBean。以下示例假定您已将<span>Derby</span> JVM配置为启用远程JMX，这意味着您已经设置了端口号（ <samp class="codeph">com.sun.management.jmxremote.port</samp> ），供JMX服务器连接器使用。</p>

<p>下面的示例假定为远程JMX配置的端口是9999，运行<span>Derby</span>的主机的主机名是<samp class="codeph">example.com</samp> ，并且可以从客户端主机访问此主机。（此主机名是虚构的，仅用于示例目的。）</p>

<p>以下示例代码显示了禁用JMX安全性后如何连接到MBean服务器：</p>

<pre>    JMXServiceURL url = new JMXServiceURL(
            "service:jmx:rmi:///jndi/rmi://example.com:9999/jmxrmi");
    JMXConnector jmxc = JMXConnectorFactory.connect(url, null);
    MBeanServerConnection mbeanServerConn = 
        jmxc.getMBeanServerConnection();</pre>

<p>以下代码显示了启用JMX密码身份验证（默认设置）时如何连接到MBean服务器：</p>

<pre>    JMXServiceURL url = new JMXServiceURL(
            "service:jmx:rmi:///jndi/rmi://example.com:9999/jmxrmi");
    // Assuming the following JMX credentials: 
    //  username=controlRole, password=derby
    String[] credentials = new String[] { "controlRole" , "derby" };
    HashMap&lt;String,Object&gt; env = new HashMap&lt;String,Object&gt;();
    // Set credentials (jmx.remote.credentials, 
    //  see JMX Remote API 1.0 spec section 3.4)
    env.put(JMXConnector.CREDENTIALS, credentials);
    // if the server's RMI registry is protected with SSL/TLS
    //  (com.sun.management.jmxremote.registry.ssl=true), the following
    //  entry must be included:
    //env.put("com.sun.jndi.rmi.factory.socket", 
    //    new SslRMIClientSocketFactory());  // uncomment if needed

    // Connect to the server
    JMXConnector jmxc = JMXConnectorFactory.connect(url, env);
    MBeanServerConnection mbeanServerConn = 
        jmxc.getMBeanServerConnection();</pre>

<div class="p"><div class="note"><span class="notetitle">注意：</span>未指定<samp class="codeph">SslRMIClientSocketFactory</samp>需要时可能会导致错误消息<samp class="codeph">java.rmi.ConnectIOException: non-JRMP server at remote endpoint</samp> 。</div>
</div>

</div>

<div class="section"><h2 class="sectiontitle">创建一个ManagementMBean</h2>
<p>JMX客户端可以创建的唯一<span>Derby</span> MBean是<samp class="codeph">ManagementMBean</samp> 。该MBean可用于控制<span>Derby</span>管理（例如，启用和禁用管理或MBean），以及获取诸如系统标识符之类的信息（以后可能需要指定MBean）。</p>

<p>如果您从应用程序中创建了这样的MBean，并且<span>Derby</span>已经注册了一个<samp class="codeph">ManagementMBean</samp>实例，新MBean的对象名称不能与<samp class="codeph">ManagementMBean</samp>已经在服务器上注册。因此，建议使用不同的对象名称域（即，与<samp class="codeph">example.com</samp> ）和/或其他<samp class="codeph">type</samp>关键属性值（与<samp class="codeph">Management</samp> ）。</p>

<p>以下示例代码显示了如何创建和注册新的<samp class="codeph">ManagementMBean</samp>使用MBean服务器：</p>

<pre>    ObjectName mgmtObjName = new ObjectName("com.example.app", 
                   "type", "DerbyManagement");
    try {
        ObjectInstance mgmtObj = 
            mbeanServerConn.createMBean("example.com.mbeans.Management", 
                mgmtObjName);
    } catch (InstanceAlreadyExistsException e) {
        // A management MBean with this object name already exists!
    }</pre>

</div>

<div class="section"><h2 class="sectiontitle">激活<span>Derby</span>管理</h2>
<p><span>Derby</span>默认情况下会尝试激活其JMX管理服务，因此除非您明确禁用它，否则<span>Derby</span>通常将处于活动状态，前提是<span>Derby</span>有权执行激活。如果<span>Derby</span>管理处于非活动状态，则您将无法访问任何MBean，除了<samp class="codeph">ManagementMBean</samp> 。</p>

<p>通过访问<samp class="codeph">ManagementActive</samp>的属性<samp class="codeph">ManagementMBean</samp> ，您可以检查<span>Derby</span> JMX管理服务是否处于活动状态。以下示例代码执行此检查并激活<span>Derby</span>管理服务（如果尚未激活）：</p>

<pre>    // assuming we already have a reference to the
    //  ManagementMBean's object name
    Boolean active = (Boolean) 
        mbeanServerConn.getAttribute(mgmtObjName, "ManagementActive");
    if (!active.booleanValue()) {
        // start management
        mbeanServerConn.invoke(mgmtObjName, "startManagement", 
            new Object[0], new String[0]);
    }</pre>

</div>

<div class="section"><h2 class="sectiontitle">获取系统标识</h2>
<p>系统标识符是唯一的<samp class="codeph">String</samp>可以将一个正在运行的<span>Derby</span>系统与另一个系统区分开来。由<span>Derby</span>实例化的所有MBean均在其对象名称中包含系统标识符。</p>

<p>访问MBean的一种方法是在联系MBean服务器时完全指定其对象名称。为此，您需要知道当前的系统标识符。（访问MBean的替代方法包括查询MBean服务器中的所有MBean或对象名称与特定模式匹配的MBean。）</p>

<p>以下示例显示了如何通过访问<samp class="codeph">ManagementMBean</samp> ：</p>

<pre>    // assuming we already have a reference to the 
    //  ManagementMBean's object name
    String systemID = (String) mbeanServerConn.getAttribute(mgmtObjName, 
        "SystemIdentifier");</pre>

<p>以下示例显示了如何从<span>Derby</span> MBean的对象名获取系统标识符：</p>

<pre>    // assuming we already have a reference to the ObjectName
    //  of an MBean registered by <span>Derby</span>, for example the
    //  <span>Derby</span>-registered ManagementMBean
    String systemID = derbyMgmtObjectName.getKeyProperty("system");</pre>

</div>

<div class="section"><h2 class="sectiontitle">访问特定的<span>Derby注册的</span> MBean</h2>
<p>在前面的示例中，您已经了解了如何读取单个MBean属性以及如何调用MBean操作。为此，通常需要引用MBean的<samp class="codeph">ObjectName</samp> 。</p>

<p>如果您查阅<span>Derby</span> MBean的公共API文档并获得通过JMX访问的<span>Derby</span>系统的系统标识符，那么您将具有实例化一个A所需的所有信息。 <samp class="codeph">javax.management.ObjectName</samp>通过完全指定其直接对象<samp class="codeph">String</samp>表示形式（请参阅<samp class="codeph">ObjectName</samp> API文档以了解详细信息）。</p>

<p>以下示例代码显示了如何获取对<samp class="codeph">VersionMBean</samp>对于<samp class="codeph">derby.jar</samp> ：</p>

<pre>    // Assuming we already know the system identifier 
    // (see examples above), systemID.
    // A list of key properties is available is each MBean's Javadoc API.
    Hashtable&lt;String, String&gt; keyProps = new Hashtable&lt;String, String&gt;();
    keyProps.put("type", "Version");
    keyProps.put("jar", "derby.jar");
    keyProps.put("system", systemID);
    // MBeans registered by <span>Derby</span> always belong to the 
    //  "org.apache.derby" domain
    ObjectName versionObjectName = 
        new ObjectName("org.apache.derby", keyProps);

    // we can now use the object name to read an attribute
    String versionString = 
        (String) mbeanServerConn.getAttribute(versionObjectName, 
            "VersionString");
    System.out.println("VersionString: " + versionString);</pre>

<p>输出看起来像这样：</p>

<pre>VersionString: 10.9.1.1 - (1305115)</pre>

</div>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="cadminjmxoverview.html" title="Derby包括一组MBean（受管Bean）及其属性和操作，提供监视和管理功能。">使用Java管理扩展（JMX）技术</a></div>
</div>
<div class="relref"><strong>相关参考</strong><br>
<div><a href="radminjmxintro.html" title="Derby提供了本节中描述的MBean。">Derby MBeans简介</a></div>
<div><a href="radminjmxenabledisable.html" title="您可以在本地和远程使用JMX管理和监视。">启用和禁用JMX</a></div>
<div><a href="radminjmxjconsole.html" title="JConsole是图形JMX兼容工具，在Oracle JDK的最新版本中可用。JConsole使您可以监视和管理本地或远程计算机上的Java应用程序和虚拟机。">使用JConsole访问Derby MBean</a></div>
<div><a href="radminjmxtroubleshoot.html" title="如果您在使用JMX远程连接到MBean服务器时遇到问题，获取一些跟踪信息可能会有所帮助。">对JMX连接问题进行故障排除</a></div>
</div>
</div>



</body></html>