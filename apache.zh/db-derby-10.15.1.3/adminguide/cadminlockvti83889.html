<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Monitoring deadlocks">
<meta name="abstract" content="The derby.stream.error.logSeverityLevel property determines the level of error that you are informed about.">
<meta name="description" content="The derby.stream.error.logSeverityLevel property determines the level of error that you are informed about.">
<meta name="DC.subject" content="derby.locks.deadlockTrace, derby.locks.monitor, derby.stream.error.logSeverityLevel">
<meta name="keywords" content="derby.locks.deadlockTrace, derby.locks.monitor, derby.stream.error.logSeverityLevel">
<meta name="DC.Relation" scheme="URI" content="cadminlockvti42553.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="cadminlockvti83889">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>监控死锁</title>
</head>
<body id="cadminlockvti83889" ><a name="cadminlockvti83889"><!-- --></a>


<h1 class="topictitle1">监控死锁</h1>



<div><p>的<samp class="codeph">derby.stream.error.logSeverityLevel</samp>属性确定所通知的错误级别。</p>

<p>默认， <samp class="codeph">derby.stream.error.logSeverityLevel</samp>设置为40000。如果<samp class="codeph">derby.stream.error.logSeverityLevel</samp>设置为显示事务级别错误（即，如果将其设置为小于40000的值），则死锁错误将记录到<samp class="codeph">derby.log</samp>文件。如果将其设置为40000或更高的值，则死锁错误不会记录到<samp class="codeph">derby.log</samp>文件。</p>

<p>的<samp class="codeph">derby.locks.monitor</samp>属性可确保记录死锁错误，无论<samp class="codeph">derby.stream.error.logSeverityLevel</samp> 。什么时候<samp class="codeph">derby.locks.monitor</samp>设置为true，则将死锁中涉及的所有锁都写入<samp class="codeph">derby.log</samp>以及标识锁的唯一数字。</p>

<p>要在请求锁定时查看线程的堆栈跟踪，请设置<samp class="codeph">derby.locks.deadlockTrace</samp>至<samp class="codeph">true</samp> 。如果此属性被忽略，则<samp class="codeph">derby.locks.monitor</samp>设置为false。</p>

<div class="note"><span class="notetitle">注意：</span>使用<samp class="codeph">derby.locks.deadlockTrace</samp>小心。设置此属性可能会更改应用程序的时间，严重影响性能并产生很大的<samp class="codeph">derby.log</samp>文件。</div>

<p>有关使用属性的信息，请参见《 <span><em>Derby开发人员指南》</em></span> 。有关本主题中提到的特定属性的信息，请参见《 <span><em>Derby参考手册》</em></span> 。</p>

<p>这是当<span>Derby</span>由于死锁而中止事务时的错误消息示例：</p>

<pre>--SQLException Caught--

SQLState: 40001 =
Error Code: 30000 
Message: A lock could not be obtained due to a deadlock,
cycle of locks and waiters is: Lock : ROW, DEPARTMENT, (1,14)
Waiting XID : {752, X} , APP, update department set location='Boise'
	where deptno='E21'
Granted XID : {758, X} Lock : ROW, EMPLOYEE, (2,8)
Waiting XID : {758, U} , APP, update employee set bonus=150 where salary=23840
Granted XID : {752, X} The selected victim is XID : 752</pre>

<div class="note"><span class="notetitle">注意：</span>您可以使用<samp class="codeph">derby.locks.waitTimeout</samp>和<samp class="codeph">derby.locks.deadlockTimeout</samp>属性配置<span>Derby</span>等待释放锁的时间，或何时开始进行死锁检查。有关这些属性的更多信息，请参见《 <em><span><em>Derby开发人员指南</em></span></em> 》中的“控制<span>Derby</span>应用程序行为”。</div>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="cadminlockvti42553.html" title="Derby提供了一种监视和显示锁定信息的工具。">获取锁定信息</a></div>
</div>
</div>



</body></html>