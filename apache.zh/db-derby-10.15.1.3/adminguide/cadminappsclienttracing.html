<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="reference">
<meta name="DC.Title" content="Network client tracing">
<meta name="abstract" content="The Derby Network client provides a tracing facility to collect JDBC trace information and view protocol flows.">
<meta name="description" content="The Derby Network client provides a tracing facility to collect JDBC trace information and view protocol flows.">
<meta name="DC.subject" content="Network Client tracing">
<meta name="keywords" content="Network Client tracing">
<meta name="DC.Relation" scheme="URI" content="cadminappsclient.html">
<meta name="DC.Relation" scheme="URI" content="radminappsclientxmp.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="cadminappsclienttracing">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>网络客户端跟踪</title>
</head>
<body id="cadminappsclienttracing" ><a name="cadminappsclienttracing"><!-- --></a>


<h1 class="topictitle1">网络客户端跟踪</h1>



<div><p><span>Derby</span> Network客户端提供了一种跟踪工具，可以收集JDBC跟踪信息并查看协议流。</p>

<div class="section"><p>有多种获取跟踪输出的方法。但是，获取跟踪输出的最简单方法是使用<samp class="codeph">traceFile=<em>path</em></samp> URL中的属性<samp class="codeph">ij</samp> 。下例显示了所有跟踪到文件的信息<samp class="codeph">trace.out</samp>从<samp class="codeph">ij</samp>会议。</p>

<pre>ij&gt;<strong>connect 'jdbc:derby://localhost:1527/mydb;
create=true;traceFile=trace.out;user=user1;password=secret4me';</strong></pre>

<p>要将跟踪信息附加到指定文件，请使用<samp class="codeph">traceFileAppend=true</samp> URL属性<samp class="codeph">traceFile=<em>path</em></samp> 。</p>

<p>有关更多信息，请参见《 <span><em>Derby参考手册</em></span> 》中的“ traceFile = path属性”和“ traceFileAppend = true属性”。</p>
</div>

<div class="section"><h2 class="sectiontitle">实施ClientDataSource跟踪</h2>
<div class="p">您可以使用以下三种方法之一来收集跟踪数据，同时从<samp class="codeph">ClientDataSource</samp> ：<ul>
<li>使用<samp class="codeph">setLogWriter(java.io.PrintWriter)</samp>的方法<samp class="codeph">ClientDataSource</samp>并设置<samp class="codeph">PrintWriter</samp>设置为非null值。</li>

<li>使用<samp class="codeph">setTraceFile(String filename)</samp>的方法<samp class="codeph">ClientDataSource</samp> 。</li>

<li>使用<samp class="codeph">setTraceDirectory(String dirname)</samp>的方法<samp class="codeph">ClientDataSource</samp>为具有多个连接的程序在其自己的文件中跟踪每个连接流。</li>

</ul>
</div>

<p><span>Derby</span>提供了两种ClientDataSource实现。您可以使用<samp class="codeph">org.apache.derby.jdbc.ClientDataSource</samp>除Java SE 8 Compact Profile 2以外的所有受支持Java SE版本上的类。在Java SE 8 Compact Profile 2上，您必须使用<samp class="codeph">org.apache.derby.jdbc.BasicClientDataSource40</samp>类。有关更多信息，请参阅《 <span><em>Derby参考手册</em></span> 》中的“ Java SE 8 Compact Profile的JDBC支持”。</p>

</div>

<div class="section"><h2 class="sectiontitle">实施DriverManager跟踪</h2>
<div class="p">使用以下两个选项之一来启用和收集跟踪信息，同时使用以下方法获取连接： <samp class="codeph">DriverManager</samp> ：<ul>
<li>使用<samp class="codeph">setLogWriter(java.io.PrintWriter)</samp>的方法<samp class="codeph">DriverManager</samp>并设置<samp class="codeph">PrintWriter</samp>到非空值。</li>

<li>使用<samp class="codeph">traceFile=<em>path</em></samp>要么<samp class="codeph">traceDirectory=<em>path</em></samp>在使用以下方式创建连接之前先设置这些属性的网址属性<samp class="codeph">DriverManager.getConnection()</samp>方法。有关更多信息，请参见《 <span><em>Derby参考手册</em></span> 》中的“ traceFile = path属性”和“ traceDirectory = path属性”。</li>

</ul>
</div>
</div>

<div class="section"><h2 class="sectiontitle">更改默认跟踪级别</h2>
<p>默认跟踪级别是<samp class="codeph">ClientDataSource.TRACE_ALL</samp> 。您可以通过以下方式选择跟踪级别： <samp class="codeph">setTraceLevel(int level)</samp>方法或通过设置<samp class="codeph">traceLevel=<em>value</em></samp>网址属性：</p>

<pre>String url = "jdbc:derby://samplehost.example.com:1528/mydb" +
 ";traceFile=/u/user1/trace.out" +
 ";traceLevel=" +
 org.apache.derby.jdbc.ClientDataSource.TRACE_PROTOCOL_FLOWS;
DriverManager.getConnection(url,"user1","secret4me");</pre>

<p>下表显示了可以设置的跟踪级别。</p>


<div class="tablenoborder"><table cellspacing="0" cellpadding="4" border="1" summary="This table lists the network client tracing levels and their values." frame="border" rules="all"><caption>表格1。可用的跟踪级别和值</caption>


<thead align="left">
<tr valign="bottom">
<th valign="bottom" width="84.6938775510204%" id="N101D2">痕量水平</th>

<th valign="bottom" width="15.306122448979592%" id="N101D9">值</th>

</tr>

</thead>

<tbody>
<tr>
<td valign="top" width="84.6938775510204%" headers="N101D2">org.apache.derby.jdbc。ClientDataSource。TRACE_NONE</td>

<td valign="top" width="15.306122448979592%" headers="N101D9">0x0</td>

</tr>

<tr>
<td valign="top" width="84.6938775510204%" headers="N101D2">org.apache.derby.jdbc。ClientDataSource。TRACE_CONNECTION_CALLS</td>

<td valign="top" width="15.306122448979592%" headers="N101D9">0x1</td>

</tr>

<tr>
<td valign="top" width="84.6938775510204%" headers="N101D2">org.apache.derby.jdbc。ClientDataSource。TRACE_STATEMENT_CALLS</td>

<td valign="top" width="15.306122448979592%" headers="N101D9">0x2</td>

</tr>

<tr>
<td valign="top" width="84.6938775510204%" headers="N101D2">org.apache.derby.jdbc。ClientDataSource。TRACE_RESULT_SET_CALLS</td>

<td valign="top" width="15.306122448979592%" headers="N101D9">0x4</td>

</tr>

<tr>
<td valign="top" width="84.6938775510204%" headers="N101D2">org.apache.derby.jdbc。ClientDataSource。TRACE_DRIVER_CONFIGURATION</td>

<td valign="top" width="15.306122448979592%" headers="N101D9">0x10</td>

</tr>

<tr>
<td valign="top" width="84.6938775510204%" headers="N101D2">org.apache.derby.jdbc。ClientDataSource。TRACE_CONNECTS</td>

<td valign="top" width="15.306122448979592%" headers="N101D9">0x20</td>

</tr>

<tr>
<td valign="top" width="84.6938775510204%" headers="N101D2">org.apache.derby.jdbc。ClientDataSource。TRACE_PROTOCOL_FLOWS</td>

<td valign="top" width="15.306122448979592%" headers="N101D9">0x40</td>

</tr>

<tr>
<td valign="top" width="84.6938775510204%" headers="N101D2">org.apache.derby.jdbc。ClientDataSource。跟踪_RESULT_SET_META_DATA</td>

<td valign="top" width="15.306122448979592%" headers="N101D9">0x80</td>

</tr>

<tr>
<td valign="top" width="84.6938775510204%" headers="N101D2">org.apache.derby.jdbc。ClientDataSource。跟踪_PARAMETER_META_DATA</td>

<td valign="top" width="15.306122448979592%" headers="N101D9">0x100</td>

</tr>

<tr>
<td valign="top" width="84.6938775510204%" headers="N101D2">org.apache.derby.jdbc。ClientDataSource。TRACE_DIAGNOSTICS</td>

<td valign="top" width="15.306122448979592%" headers="N101D9">0x200</td>

</tr>

<tr>
<td valign="top" width="84.6938775510204%" headers="N101D2">org.apache.derby.jdbc。ClientDataSource。TRACE_XA_CALLS</td>

<td valign="top" width="15.306122448979592%" headers="N101D9">0x800</td>

</tr>

<tr>
<td valign="top" width="84.6938775510204%" headers="N101D2">org.apache.derby.jdbc。ClientDataSource。TRACE_ALL</td>

<td valign="top" width="15.306122448979592%" headers="N101D9">0xFFFFFFFF</td>

</tr>

</tbody>

</table>
</div>

<p>要指定多个跟踪级别，请使用以下技术之一：</p>

<ul>
<li>对两个或多个跟踪值使用按位OR运算符（|）。例如，要跟踪PROTOCOL流和连接调用，请为<samp class="codeph">traceLevel</samp> ：<pre>TRACE_PROTOCOL_FLOWS | TRACE_CONNECTION_CALLS</pre>
</li>

<li>使用带跟踪值的按位补运算符（〜）可以指定除特定跟踪以外的所有其他值。例如，要跟踪除PROTOCOL流以外的所有内容，请为<samp class="codeph">traceLevel</samp> ：<pre>~TRACE_PROTOCOL_FLOWS</pre>
</li>

</ul>

<p>有关更多信息，请参见《 <span><em>Derby参考手册</em></span> 》中的“ traceLevel = value属性”。</p>
</div>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="cadminappsclient.html" title="连接到网络服务器时，您的应用程序需要加载特定于网络服务器的驱动程序和连接URL。此外，如果使用身份验证，则必须指定用户名和密码。">使用网络客户端驱动程序访问网络服务器</a></div>
</div>
<div class="relref"><strong>相关参考</strong><br>
<div><a href="radminappsclientxmp.html" title="以下示例指定用户和密码URL属性。">网络客户端驱动程序示例</a></div>
</div>
</div>



</body></html>