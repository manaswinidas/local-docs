<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Using the backup procedures to perform an online backup">
<meta name="abstract" content="Use the SYSCS_UTIL.SYSCS_BACKUP_DATABASE procedure or one of the other system backup procedures to perform an online backup of a database to a specified location.">
<meta name="description" content="Use the SYSCS_UTIL.SYSCS_BACKUP_DATABASE procedure or one of the other system backup procedures to perform an online backup of a database to a specified location.">
<meta name="DC.subject" content="Backup procedure, SYSCS_BACKUP_DATABASE() system procedure">
<meta name="keywords" content="Backup procedure, SYSCS_BACKUP_DATABASE() system procedure">
<meta name="DC.Relation" scheme="URI" content="cadminhubbkup63476.html">
<meta name="DC.Relation" scheme="URI" content="cadminhubbkup75469.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="cadminhubbkup01">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>使用备份过程执行在线备份</title>
</head>
<body id="cadminhubbkup01" ><a name="cadminhubbkup01"><!-- --></a>


<h1 class="topictitle1">使用备份过程执行在线备份</h1>



<div><p>使用<samp class="codeph">SYSCS_UTIL.SYSCS_BACKUP_DATABASE</samp>过程或其他系统备份过程之一，以将数据库联机备份到指定位置。</p>

<p>备份步骤如下：</p>

<ul>
<li><samp class="codeph">SYSCS_UTIL.SYSCS_BACKUP_DATABASE</samp></li>

<li><samp class="codeph">SYSCS_UTIL.SYSCS_BACKUP_DATABASE_NOWAIT</samp></li>

<li><samp class="codeph">SYSCS_UTIL.SYSCS_BACKUP_DATABASE_AND_ENABLE_LOG_ARCHIVE_MODE</samp></li>

<li><samp class="codeph">SYSCS_UTIL.SYSCS_BACKUP_DATABASE_AND_ENABLE_LOG_ARCHIVE_MODE_NOWAIT</samp></li>

</ul>

<p>使用<samp class="codeph">SYSCS_UTIL.SYSCS_BACKUP_DATABASE_AND_ENABLE_LOG_ARCHIVE_MODE</samp>要么<samp class="codeph">SYSCS_UTIL.SYSCS_BACKUP_DATABASE_AND_ENABLE_LOG_ARCHIVE_MODE_NOWAIT</samp>如果要使其能够对损坏的数据库执行前滚恢复，请执行以下步骤。有关详细信息，请参见前<a href="cadminrollforward.html#cadminrollforward">滚恢复</a> 。</p>

<p>的<samp class="codeph">NOWAIT</samp>过程的版本不等待进行未记录操作的事务完成后再继续备份；而是，它们立即返回错误。</p>

<p>有关这些系统过程的详细信息，请参见《 <span><em>Derby参考手册</em></span> 》。</p>

<p>所有这四个系统过程都使用一个字符串参数，该参数表示备份数据库的位置。通常，您提供备份目录的完整路径。（相对路径被解释为相对于当前目录，而不是相对于当前目录。 <samp class="codeph">derby.system.home</samp>目录。）</p>

<p>例如，指定的备份位置<samp class="codeph">c:/mybackups/2012-04-01</samp>对于当前打开的数据库，请使用以下语句（正斜杠在SQL命令中用作路径分隔符）：</p>

<pre><strong>CALL SYSCS_UTIL.SYSCS_BACKUP_DATABASE('c:/mybackups/2012-04-01')</strong></pre>

<p>的<samp class="codeph">SYSCS_UTIL.SYSCS_BACKUP_DATABASE</samp>要么<samp class="codeph">SYSCS_UTIL.SYSCS_BACKUP_DATABASE_NOWAIT</samp>过程将数据库置于可以安全复制的状态。然后，该过程将整个原始数据库目录（包括数据文件，联机事务日志文件和jar文件）复制到指定的备份目录。不在原始数据库目录中的文件（例如， <samp class="codeph">derby.properties</samp> ） <em>不会被</em>复制。除“未<a href="cadminhubbkup01.html#cadminhubbkup01__hubbkupunlogged">记录的操作”中</a>提到的少数情况<a href="cadminhubbkup01.html#cadminhubbkup01__hubbkupunlogged">外</a> ，该过程不会随时阻止并发事务。</p>

<p>使用<samp class="codeph">SYSCS_UTIL.SYSCS_BACKUP_DATABASE_AND_ENABLE_LOG_ARCHIVE_MODE</samp>要么<samp class="codeph">SYSCS_UTIL.SYSCS_BACKUP_DATABASE_AND_ENABLE_LOG_ARCHIVE_MODE_NOWAIT</samp>该过程不是数据库的完整副本，而是取决于自备份以来在数据库中创建的日志文件。尝试直接访问备份将使备份无效。结果可能包括数据库损坏，数据丢失，在随后尝试还原数据库时出错，或者仅在使用还原的数据库后才遇到数据库损坏错误。访问这种备份的唯一受支持的方法是按照<a href="cadminrollforward.html#cadminrollforward">前滚</a>恢复中的说明还原数据库。</p>

<p>下面的示例显示如何将数据库备份到名称能够反映当前日期的目录：</p>

<pre>public static void backUpDatabase(Connection conn) 
        throws SQLException {
    <strong>// Get today's date as a string:</strong>
    java.text.SimpleDateFormat todaysDate = 
        new java.text.SimpleDateFormat("yyyy-MM-dd");
    String backupdirectory = "c:/mybackups/" +
        todaysDate.format((java.util.Calendar.getInstance()).getTime());

    CallableStatement cs =
        conn.prepareCall("CALL SYSCS_UTIL.SYSCS_BACKUP_DATABASE(?)"); 
    cs.setString(1, backupdirectory);
    cs.execute(); 
    cs.close();
    System.out.println("backed up database to " + backupdirectory);
}</pre>

<p>对于2012年1月1日备份的数据库，以前的命令将当前数据库复制到以下目录中的同名目录中<samp class="codeph">c:/mybackups/2012-04-01</samp> 。</p>

<p>未提交的事务不会出现在备份的数据库中。</p>

<div class="note"><span class="notetitle">注意：</span>不要将具有相同名称的不同数据库备份到同一备份目录。如果备份目录中已经存在相同名称的数据库，则认为该数据库是较旧的版本并被覆盖。</div>

<div class="section" id="cadminhubbkup01__hubbkupunlogged"><a name="cadminhubbkup01__hubbkupunlogged"><!-- --></a><h2 class="sectiontitle">未记录的操作</h2>
<p>对于某些操作， <span>Derby</span>不记录日志，因为它可以保持数据库一致而不记录数据。</p>

<p>的<samp class="codeph">SYSCS_UTIL.SYSCS_BACKUP_DATABASE</samp>如果与备份过程相同的事务中有任何未记录的操作，则该过程将发出错误。</p>

<p>如果开始备份时系统中其他事务中正在进行任何未记录的操作，则此过程将阻塞，直到这些事务完成后再执行备份。</p>

<p>如果未备份的操作在备份进行过程中启动，则<span>Derby会</span>自动将它们转换为已记录模式（在数据库中维护应用程序jar文件的操作除外）。在备份过程中，将阻止安装，替换和删除数据库中的jar文件的过程。</p>

<p>如果您不希望备份在其他事务中未记录的操作完成之前阻塞，请使用<samp class="codeph">SYSCS_UTIL.SYSCS_BACKUP_DATABASE_NOWAIT</samp>程序。如果有任何事务正在执行未记录的操作，则此过程会在备份开始时立即发出错误，而不是等待这些事务完成。</p>

<p>未记录的操作包括：</p>

<ul>
<li>索引创建。
<p>仅记录CREATE INDEX，而不是所有数据都插入到索引中。未记录插入索引的原因是，如果发生故障，它将仅删除索引。</p>

<p>如果在进行备份时创建索引，则索引速度会变慢，因为必须将其记录下来。</p>

<p>外键和主键创建后备索引。将这些键添加到带有数据的现有表中的过程也会变慢。</p>

</li>

<li>导入到空表或替换表中的所有数据。
<p>同样在这种情况下，不会记录插入表中的数据。在内部， <span>Derby</span>为导入创建一个新表，将目录更改为指向新表，并在导入完成后删除原始表。</p>

<p>如果在进行备份时执行这样的导入操作，则会慢一些，因为会记录数据。</p>

</li>

</ul>

</div>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="cadminhubbkup63476.html" title="使用联机备份可以在数据库运行时备份数据库，而不会阻止事务。">在线备份</a></div>
</div>
<div class="relconcepts"><strong>相关概念</strong><br>
<div><a href="cadminhubbkup75469.html" title="通常，这些过程用于加快联机备份中涉及的复制操作。">在冻结和取消冻结系统过程中使用操作系统命令来执行在线备份</a></div>
</div>
</div>



</body></html>