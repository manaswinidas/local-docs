<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Booting the server and connecting to it">
<meta name="abstract" content="Finally, boot the server and start the client.">
<meta name="description" content="Finally, boot the server and start the client.">
<meta name="DC.Relation" scheme="URI" content="csecssl.html">
<meta name="DC.Relation" scheme="URI" content="tsecsslclientkeycert.html">
<meta name="DC.Relation" scheme="URI" content="tsecsslserverkeycert.html">
<meta name="DC.Relation" scheme="URI" content="tsecsslimportcerts.html">
<meta name="DC.Relation" scheme="URI" content="csecsslkeys.html">
<meta name="DC.Relation" scheme="URI" content="csecsslserver.html">
<meta name="DC.Relation" scheme="URI" content="csecsslclient.html">
<meta name="DC.Relation" scheme="URI" content="csecssladmin.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="csecsslbootconn">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>引导服务器并连接到它</title>
</head>
<body id="csecsslbootconn" ><a name="csecsslbootconn"><!-- --></a>


<h1 class="topictitle1">引导服务器并连接到它</h1>



<div><p>最后，启动服务器并启动客户端。</p>

<p>前面的三个主题涵盖了<a href="csecssl.html">配置SSL / TLS</a> ，创建客户端证书和创建服务器证书，然后导入证书中介绍的前两个设置步骤。本主题描述了剩下的两个步骤，服务器启动和客户端启动。</p>

<p>每次启动服务器时，我们都必须记住要打开网络加密。我们必须设置四个VM属性，以声明服务器的密钥存储区和信任存储区的位置和密码：</p>

<ul>
<li><samp class="codeph">javax.net.ssl.keyStore</samp></li>

<li><samp class="codeph">javax.net.ssl.keyStorePassword</samp></li>

<li><samp class="codeph">javax.net.ssl.trustStore</samp></li>

<li><samp class="codeph">javax.net.ssl.trustStorePassword</samp></li>

</ul>

<p>另外，我们指定<samp class="codeph">-ssl peerAuthentication</samp>启动选项。因此，启动服务器的命令如下所示：</p>

<pre><strong>java -Djavax.net.ssl.keyStore=/Users/me/vault/ServerKeyStore \
-Djavax.net.ssl.keyStorePassword=secretServerPassword \
-Djavax.net.ssl.trustStore=/Users/me/vault/ServerTrustStore \
-Djavax.net.ssl.trustStorePassword=secretServerTrustStorePassword \
org.apache.derby.drda.NetworkServerControl start -p 8246 \
-ssl peerAuthentication</strong></pre>

<p>的<samp class="codeph">-p 8246</samp>选项在非默认端口（而不是默认端口1527）上启动服务器。</p>

<p>最后一步是培养客户。与服务器启动一样，我们必须告诉VM本地密钥库和信任库的位置和密码。这个例子很简单<samp class="codeph">ij</samp>脚本。注意额外的<samp class="codeph">ssl</samp>连接URL上的属性。该属性告诉客户端使用证书对服务器的身份进行身份验证，并告诉客户端必须对网络通信进行加密：</p>

<pre><strong>java -Djavax.net.ssl.trustStore=/Users/me/vault/ClientTrustStore \
-Djavax.net.ssl.trustStorePassword=secretClientTrustStorePassword \
-Djavax.net.ssl.keyStore=/Users/me/vault/ClientKeyStore \
-Djavax.net.ssl.keyStorePassword=secretClientPassword \
org.apache.derby.tools.ij</strong>
ij version 10.11
ij&gt; <strong>connect 'jdbc:derby://localhost:8246/testdb;create=true;ssl=peerAuthentication';</strong>
ij&gt; <strong>select schemaName, authorizationID from sys.sysschemas;</strong></pre>

<p>您将从以下地方得到错误<samp class="codeph">ij</samp>如果您未指定额外的VM属性和/或未指定<samp class="codeph">ssl</samp>连接URL上的属性。例如，这里是运行的输出<samp class="codeph">ij</samp>没有VM属性和<samp class="codeph">ssl</samp>属性：</p>

<pre><strong>java org.apache.derby.tools.ij</strong>
ij version 10.11
ij&gt; <strong>connect 'jdbc:derby://localhost:8246/testdb;create=true';</strong>
ERROR 08006: A network protocol error was encountered and the connection has been
terminated: A PROTOCOL Data Stream Syntax Error was detected. Reason: 0x3. 
Plaintext connection attempt to an SSL enabled server?</pre>

<p>当您要管理服务器时（例如，将其关闭），您将需要指定有效密钥库和信任库的位置和密码，以及其他<samp class="codeph">ssl</samp>服务器命令行上的选项：</p>

<pre><strong>java -Djavax.net.ssl.trustStore=/Users/me/vault/ClientTrustStore \
-Djavax.net.ssl.trustStorePassword=secretClientTrustStorePassword \
-Djavax.net.ssl.keyStore=/Users/me/vault/ClientKeyStore \
-Djavax.net.ssl.keyStorePassword=secretClientPassword \
org.apache.derby.drda.NetworkServerControl shutdown -p 8246 \
-ssl peerAuthentication</strong></pre>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="csecssl.html" title="默认情况下，网络流量以明文形式在Derby客户端和服务器之间传输。">配置SSL / TLS</a></div>
</div>
<div class="relconcepts"><strong>相关概念</strong><br>
<div><a href="csecsslkeys.html" title="对于SSL操作，服务器始终需要一个密钥对。如果服务器以对等身份验证模式运行（服务器对客户端进行身份验证），则每个客户端都需要自己的密钥对。通常，如果通信的一端要验证其伙伴，则第一端需要安装由伙伴生成的证书。">密钥和证书处理</a></div>
<div><a href="csecsslserver.html" title="对于服务器SSL / TLS，需要生成服务器密钥对。如果服务器要进行客户端身份验证，则需要在信任存储区中安装客户端证书。">使用SSL / TLS启动服务器</a></div>
<div><a href="csecsslclient.html" title="客户端上的基本SSL加密是通过URL属性ssl，属性ssl或设置为basic的数据源属性ssl启用的。">使用SSL / TLS运行客户端</a></div>
<div><a href="csecssladmin.html" title="其他服务器命令（关闭，ping，sysinfo，runtimeinfo，logconnections，maxthreads，timelice，trace和tracedirectory）均作为客户端实现，并且就SSL而言，它们的行为与客户端完全相同。">其他服务器命令</a></div>
</div>
<div class="reltasks"><strong>相关任务</strong><br>
<div><a href="tsecsslclientkeycert.html" title="请按照以下步骤创建客户端密钥对和客户端证书。">创建客户端密钥对和证书</a></div>
<div><a href="tsecsslserverkeycert.html" title="请按照以下步骤创建服务器密钥对和服务器证书。">创建服务器密钥对和证书</a></div>
<div><a href="tsecsslimportcerts.html" title="请按照以下步骤将每个证书导入到另一个的信任库中。">导入证书</a></div>
</div>
</div>



</body></html>