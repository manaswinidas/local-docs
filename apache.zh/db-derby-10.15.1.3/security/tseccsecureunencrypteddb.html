<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="task">
<meta name="DC.Title" content="Encrypting an existing unencrypted database">
<meta name="abstract" content="You can encrypt an unencrypted Derby database by specifying attributes on the connection URL when you boot the database. The attributes that you specify depend on how you want the database encrypted.">
<meta name="description" content="You can encrypt an unencrypted Derby database by specifying attributes on the connection URL when you boot the database. The attributes that you specify depend on how you want the database encrypted.">
<meta name="DC.subject" content="encrypting databases, existing unencrypted databases, databases, encrypting, existing unencrypted">
<meta name="keywords" content="encrypting databases, existing unencrypted databases, databases, encrypting, existing unencrypted">
<meta name="DC.Relation" scheme="URI" content="cseccsecure97760.html">
<meta name="DC.Relation" scheme="URI" content="cseccsecure88690.html">
<meta name="DC.Relation" scheme="URI" content="cseccsecure866716.html">
<meta name="DC.Relation" scheme="URI" content="tseccsecurenewkeyoverview.html">
<meta name="DC.Relation" scheme="URI" content="cseccsecure60146.html">
<meta name="DC.Relation" scheme="URI" content="cseccsecuredecryptdb.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="tseccsecureunencrypteddb">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>加密现有的未加密数据库</title>
</head>
<body id="tseccsecureunencrypteddb" ><a name="tseccsecureunencrypteddb"><!-- --></a>


<h1 class="topictitle1">加密现有的未加密数据库</h1>



<div><p>您可以通过在启动数据库时在连接URL上指定属性来对未加密的<span>Derby</span>数据库进行加密。您指定的属性取决于您希望数据库如何加密。</p>

<div class="p"><ul>
<li>如果数据库配置了日志归档，则必须先禁用日志归档并执行关闭操作，然后才能加密数据库。</li>

<li>恢复后，如果任何全局事务处于准备状态，则无法加密数据库。</li>

</ul>
</div>

<div class="section"><p>对现有的未加密数据库进行加密时，可以指定是否应使用启动密码对数据库进行加密（ <samp class="codeph">bootPassword=<em>key</em></samp> ）或外部加密密钥（ <samp class="codeph">encryptionKey=<em>key</em></samp> ）。您还可以指定<samp class="codeph">encryptionProvider=<em>providerName</em></samp>属性和<samp class="codeph">encryptionAlgorithm=<em>algorithm</em></samp>连接URL上的属性。该数据库配置有指定的加密属性，并且数据库中所有现有数据均已加密。</p>

<p>有关连接URL属性的详细信息，请参见《 <span><em>Derby参考手册</em></span> 》。</p>

<p>加密数据库是一个耗时的过程，因为它涉及到加密数据库中的所有现有数据。如果该过程在完成之前被中断，则所有更改将在下次引导数据库时回滚。如果在加密数据库之后但在将连接返回给应用程序之前立即发生中断，则可能没有引导密码或外部加密密钥就无法引导数据库。在这种罕见的情况下，您应该尝试使用启动密码或外部加密密钥来启动数据库。</p>

<div class="note"><span class="notetitle">建议：</span>在加密数据库之前，请确保您有足够的可用磁盘空间。除了当前数据库大小所需的磁盘空间之外，还需要临时磁盘空间来存储数据的旧版本，以便在加密中断或返回错误时将数据库恢复到其原始状态。加密数据库后，所有临时磁盘空间都释放回操作系统。</div>

<p>要加密现有的未加密数据库：</p>
</div>


<div class="p">
<span>指定<samp class="codeph">dataEncryption=true</samp>属性和<samp class="codeph">encryptionKey=<em>key</em></samp>属性或<samp class="codeph">bootPassword=<em>key</em></samp>连接URL中的“属性”并启动数据库。</span>例如，要加密<samp class="codeph">salesdb</samp>具有启动密码的数据库<samp class="codeph">abc1234xyz</samp> ，在URL中指定以下属性：<pre>jdbc:derby:salesdb;dataEncryption=true;bootPassword=abc1234xyz</pre>

 <p>如果同时启用<a href="cseccsecure42374.html">身份验证</a>和<a href="csecauthorfine.html#csecauthorfine">SQL授权</a> ，则还必须提供<a href="cseccsecuredbowner.html">数据库所有者</a>的凭据，因为加密是受限制的操作。</p>

<p>加密现有的未加密数据库后，请确保检查<samp class="codeph">SQLWarning</samp> s。仅当没有加密时加密成功<samp class="codeph">SQLWarning</samp> s或<samp class="codeph">SQLException</samp> s。</p>

<p>如果在加密数据库之前禁用了日志归档，请在加密数据库后创建数据库的新备份。有关更多信息，请参阅《 <span><em>Derby服务器和管理指南</em></span> 》中的“备份和还原数据库”部分，尤其是“前滚恢复”。</p>

</div>


</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="cseccsecure97760.html" title="本节介绍在Derby中使用加密。">使用加密</a></div>
</div>
<div class="relconcepts"><strong>相关概念</strong><br>
<div><a href="cseccsecure88690.html" title="通过在连接URL上指定属性来创建数据库时，可以为加密配置Derby数据库。">创建时加密数据库</a></div>
<div><a href="cseccsecure866716.html" title="对数据库进行加密时，通常会指定启动密码，该密码是用于生成加密密钥的字母数字字符串。（您也可以直接指定加密密钥。）">创建启动密码</a></div>
<div><a href="cseccsecure60146.html" title="如果使用bootPassword = key属性创建加密的数据库，则必须指定启动密码才能重新启动数据库。如果使用encryptionKey = key属性创建加密的数据库，则必须指定加密密钥以重新启动数据库。">引导加密的数据库</a></div>
<div><a href="cseccsecuredecryptdb.html" title="您可以通过在连接URL上指定属性来使加密的数据库返回未加密状态。">解密加密的数据库</a></div>
</div>
<div class="reltasks"><strong>相关任务</strong><br>
<div><a href="tseccsecurenewkeyoverview.html" title="您可以通过指定新的启动密码或新的外部密钥，将新的加密密钥应用于Derby数据库。">用新密钥加密数据库</a></div>
</div>
</div>



</body></html>