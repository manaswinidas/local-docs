<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="reference">
<meta name="DC.Title" content="CONSTRAINT clause">
<meta name="abstract" content="A CONSTRAINT clause is an optional part of a CREATE TABLE statement or an ALTER TABLE statement. A constraint is a rule to which data must conform. Constraint names are optional.">
<meta name="description" content="A CONSTRAINT clause is an optional part of a CREATE TABLE statement or an ALTER TABLE statement. A constraint is a rule to which data must conform. Constraint names are optional.">
<meta name="DC.subject" content="CONSTRAINT clause, Constraints, Storage properties, for indexes backing constraints, Backing indexes, specifying storage properties for, Tables, specifying page size for, specifying properties for">
<meta name="keywords" content="CONSTRAINT clause, Constraints, Storage properties, for indexes backing constraints, Backing indexes, specifying storage properties for, Tables, specifying page size for, specifying properties for">
<meta name="DC.Relation" scheme="URI" content="rrefclauses.html">
<meta name="DC.Relation" scheme="URI" content="rrefsqlj16095.html">
<meta name="DC.Relation" scheme="URI" content="rrefsqlj42154.html">
<meta name="DC.Relation" scheme="URI" content="rrefsqlj16357.html">
<meta name="DC.Relation" scheme="URI" content="rrefsqljconstrchar.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="rrefsqlj13590">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>CONSTRAINT子句</title>
</head>
<body id="rrefsqlj13590" ><a name="rrefsqlj13590"><!-- --></a>


<h1 class="topictitle1">CONSTRAINT子句</h1>



<div><p>CONSTRAINT子句是CREATE TABLE语句或ALTER TABLE语句的可选部分。约束是数据必须符合的规则。约束名称是可选的。</p>

<div class="section">
<p>有关这些语句的详细信息，请参见<a href="rrefsqlj24513.html">CREATE TABLE语句</a>和<a href="rrefsqlj81859.html#">rrefsqlj81859.html＃</a> 。</p>
 
<div class="p">约束可以是以下之一：<ul>
<li><em><a href="rrefsqlj16095.html#rrefsqlj16095">columnLevelConstraint</a></em>
<p>列级约束引用表中的单个列，并且不指定列名（检查约束除外）。他们指的是他们跟随的专栏。</p>
</li>

<li>一个<em><a href="rrefsqlj42154.html#rrefsqlj42154">tableLevelConstraint</a></em>
<p>表级约束引用表中的一列或多列。表级约束指定它们要应用到的列的名称。表级CHECK约束可以引用表中的0列或更多列。</p>
</li>

</ul>
</div>
 <div class="p">列约束包括：<ul>
<li>非空<p>指定此列不能包含NULL值（此类型的约束不可命名）。</p>
</li>

<li>首要的关键<p>指定唯一标识表中行的列。标识的列必须定义为NOT NULL。</p>
 <div class="note"><span class="notetitle">注意：</span>如果尝试使用ALTER TABLE添加主键，并且主键中包含的任何列都包含空值，则会生成错误，并且不会添加主键。有关更多信息，请参见<a href="rrefsqlj81859.html#rrefsqlj81859">ALTER TABLE语句</a> 。</div>
</li>

<li>独特<p>指定该列中的值必须唯一。</p>
</li>

<li>外键<p>指定该列中的值必须对应于引用的主键或唯一键列中的值，或者它们为NULL。</p>
</li>

<li>校验<p>指定列中值的规则。</p>
</li>

</ul>
</div>
 <div class="p">表约束包括：<ul>
<li>首要的关键<p>指定唯一标识表中一行的一个或多个列。不允许使用NULL值。</p>
</li>

<li>独特<p>指定列中的值必须唯一。</p>
</li>

<li>外键<p>指定列中的值必须对应于引用的主键或唯一列中的值，或者它们为NULL。</p>
 <div class="note"><span class="notetitle">注意：</span>如果外键由多个列组成，并且<em>任何</em>列为NULL，则整个键都被视为NULL。无论非null列上的内容如何，都允许插入。</div>
</li>

<li>校验<p>为表中的值指定各种规则。</p>
</li>

</ul>
</div>
 <p>列约束和表约束具有相同的功能；区别在于您指定它们的位置。表约束允许您在PRIMARY KEY，UNIQUE，CHECK或FOREIGN KEY约束定义中指定多个列。列级约束（检查约束除外）仅引用一列。</p>

<p>约束以约束所有者的特权运行。有关详细信息，请参见《 <span><em>Derby开发人员指南</em></span> 》中的“使用SQL标准授权”和“视图，触发器和约束的特权”。</p>

</div>

<div class="section" id="rrefsqlj13590__deferrableconstraints"><a name="rrefsqlj13590__deferrableconstraints"><!-- --></a><h2 class="sectiontitle">可延迟约束</h2>
<p>可以<em>推迟</em>约束，这意味着<span>Derby</span>不会立即检查约束。默认情况下，语句完成后立即检查约束。可延迟约束允许临时违反约束，以实现更灵活的插入和更新操作。</p>

<div class="note"><span class="notetitle">注意：</span>只有将数据库完全升级到<span>Derby</span> Release 10.11或更高版本后，可延迟约束才可用。（有关更多信息，请参阅《 <span><em>Derby开发人员指南</em></span> 》中的“升级数据库”。）它们不能在10.10或更低版本的数据库中使用。</div>

<p>当在语句开始执行之前将可延迟约束的约束模式设为DEFERRED时，约束检查不会像通常一样在语句执行结束时进行，而是仅在使用以下一种机制来显式或隐式请求时：</p>

<ul>
<li>事务结束（发生提交操作）</li>

<li>执行将约束模式设置为IMMEDIATE的<a href="rrefsqljsetconstr.html">SET CONSTRAINTS语句</a></li>

<li>从存储过程或函数返回时，将约束模式恢复为IMMEDIATE</li>

</ul>

<p>检查可<em>延期</em>约束的点称为<em>延迟检查时间</em> 。</p>

<p>如果在调用存储过程或函数之前约束的约束模式为IMMEDIATE，并且存储过程或函数将该约束的约束模式设置为DEFERRED，则从存储过程返回时，约束模式将隐式重置为IMMEDIATE。发生这种情况的原因是，当我们输入存储过程或函数时（其他会话状态变量，如当前角色），约束模式被压入堆栈。如果结果违反约束，则事务将回滚并引发异常。</p>

<p>有关可延迟外键的行为的信息，请参见<a href="rrefsqlj13590.html#rrefsqlj13590__referactions">引用操作</a> 。</p>

</div>

<div class="section"><h2 class="sectiontitle">主键约束</h2> <p>主键定义了一组唯一标识表中行的列。</p>
 <p>创建主键约束时，主键中包含的所有列都不能具有NULL约束；也就是说，它们必须不允许NULL值。</p>
 <p>ALTER TABLE ADD PRIMARY KEY如果您将现有列首先定义为NOT NULL，则可以将它们包含在主键中。不允许使用NULL值。如果列包含NULL值，则系统不会添加主键约束。有关更多信息，请参见<a href="rrefsqlj81859.html#rrefsqlj81859">ALTER TABLE语句</a> 。</p>
 <p>一个表最多可以有一个PRIMARY KEY约束。</p>
 </div>

<div class="section"><h2 class="sectiontitle">独特的约束</h2><p>UNIQUE约束定义一组列，这些列仅在所有键值都不为NULL的情况下唯一标识表中的行。如果一个或多个键部分为NULL，则允许重复的键。</p>

<p>例如，如果在<samp class="codeph">col1</samp>和<samp class="codeph">col2</samp>表的值，由<samp class="codeph">col1</samp>和<samp class="codeph">col2</samp>只要这些值不为NULL，它将是唯一的。如果其中之一<samp class="codeph">col1</samp>和<samp class="codeph">col2</samp>拥有NULL值，表中可以有另一个相同的行。</p>

<p>一个表可以具有多个UNIQUE约束。</p>

</div>

<div class="section"><h2 class="sectiontitle">外键约束</h2> <p>外键提供了一种加强数据库参照完整性的方法。外键是表中的一个列或一组列，它们引用某个其他表（或有时（尽管很少见）同一表）中的键。外键必须始终包含其类型与引用的主键或唯一约束中的类型完全匹配的列。</p>
 <p>对于在其中指定组成约束的表中的列的表级外键约束，您不能多次使用同一列。</p>
 <p>如果<em>ReferencesSpecification中</em>有一个列列表（被引用表中的列列表），则它必须对应于被引用表中的唯一约束或主键约束。如果引用表具有声明的主键，则<em>ReferencesSpecification</em>可以省略该表的列列表。</p>
 <p>如果<em>ReferencesSpecification中</em>没有列列表，并且被引用的表中没有主键，则将引发语句异常。（这意味着，如果引用的表仅具有唯一键，则必须在<em>ReferencesSpecification中</em>包括一个列列表<em>。</em> ）</p>

<p>如果REFERENCES子句包含CASCADE或SET NULL引用动作，则引用的主键或唯一键必须不可延迟。</p>

<div class="p">如果在引用的唯一键或主键列中存在匹配值，则满足外键约束。如果外键由多个列组成，则外键值中的任何列都包含NULL时，则将其视为NULL。<div class="note"><span class="notetitle">注意：</span>根据SQL标准，由多个列组成的外键有可能允许这些列之一包含一个值，而该值在引用的列中没有匹配的值。为了避免这种情况，请在所有外键的列上创建NOT NULL约束。</div>
</div>
 </div>

<div class="section"><h2 class="sectiontitle">外键约束和DML</h2> <p>当您插入或更新具有启用的外键约束的表时， <span>Derby</span>通过在引用表中查找对应的被引用键来检查该行是否违反外键约束。如果不满足该约束，则<span>Derby</span>拒绝插入或更新，并声明异常。</p>
 <p>当您使用引用的键（由外键引用的主约束或唯一约束）更新或删除表中的行时， <span>Derby会</span>检查每个引用该键的外键约束，以确保不删除或修改该行导致约束冲突。如果删除或修改该行会导致约束冲突，则不允许进行更新或删除，并且<span>Derby</span>引发语句异常。</p>

<p>如果约束模式为IMMEDIATE（默认），则<span>Derby</span>在执行语句时执行约束检查。如果约束模式为DEFERRED，则检查通常在提交时稍后进行。有关更多信息，请参见<a href="rrefsqlj13590.html#rrefsqlj13590__deferrableconstraints">Deferrable约束</a> 。</p>
 </div>

<div class="section"><h2 class="sectiontitle">支持索引</h2> <p>UNIQUE，PRIMARY KEY和FOREIGN KEY约束生成强制或“约束”约束的<em>索引</em> （有时也称为<em>backing index</em> ）。PRIMARY KEY约束生成唯一索引。FOREIGN KEY约束会生成非唯一索引。如果所有列都不为空，则UNIQUE约束将生成唯一索引；如果一个或多个列为可为空，则UNIQUE约束将生成非唯一索引。因此，如果一列或一组列具有UNIQUE，PRIMARY KEY或FOREIGN KEY约束，则无需在这些列上创建索引以提高性能。<span>Derby</span>已经为您创建了它。请参阅<a href="rrefsqlj20937.html#rrefsqlj20937__sqlj27363">索引和约束</a> 。</p>

<p>这些索引可供优化器用于查询优化（请参阅<a href="rrefsqlj20937.html#rrefsqlj20937">CREATE INDEX语句</a> ），并具有系统生成的名称。</p>
 <p>您不能使用DROP INDEX语句删除后备索引；您必须删除约束或表。</p>
 </div>

<div class="section"><h2 class="sectiontitle">检查约束</h2> <p>检查约束可用于为表的内容指定各种规则。为检查约束条件指定了搜索条件（布尔表达式）。表中的所有行都必须满足此搜索条件。搜索条件应用于行修改时在INSERT或UPDATE上修改的每一行。如果违反任何检查约束，则整个语句将中止。</p>
 </div>

<div class="section" id="rrefsqlj13590__sqlj57077"><a name="rrefsqlj13590__sqlj57077"><!-- --></a><h2 class="sectiontitle">搜索条件要求</h2> <p>如果将检查约束指定为<em><a href="rrefsqlj30540.html#rrefsqlj30540">columnDefinition的</a></em>一部分，则只能对同一列进行列引用。指定为表定义一部分的检查约束可以具有列引用，这些列引用标识先前在CREATE TABLE语句中定义的列。</p>
 <div class="p">如果将搜索条件应用于相同的值，则必须始终返回相同的值。因此，它不能包含以下任何内容：<ul>
<li>动态参数（？）</li>

<li>日期/时间函数（CURRENT_DATE，CURRENT_TIME，CURRENT_TIMESTAMP）</li>

<li>子查询</li>

<li>用户功能（例如USER，SESSION_USER，CURRENT_USER）</li>

</ul>
</div>
 </div>

<div class="section" id="rrefsqlj13590__referactions"><a name="rrefsqlj13590__referactions"><!-- --></a><h2 class="sectiontitle">参照动作</h2>


<p>定义外键时，可以指定ON DELETE子句和/或ON UPDATE子句，后跟适当的操作（CASCADE，RESTRICT，SET NULL或NO ACTION）。这些子句指定在更新主键值或从表中删除主键值时， <span>Derby是</span>应修改相应的外键值还是不允许该操作以保持外键关系完整。</p>
 <p>定义参照约束时，可以指定参照约束的更新和删除规则。</p>
 <p>当更新父表或从属表的行时，将应用更新规则。选择是“不采取行动”和“限制”。</p>
 
<ul>
<li>当父表的主键的列中的值被更新并且更新规则已指定为RESTRICT时， <span>Derby会</span>检查从属表中的外键约束。如果从属表中的任何行违反外键约束，则该语句将回滚。</li>

<li>如果更新规则为NO ACTION，则<span>Derby</span>在执行所有更新和BEFORE触发器<em>之后</em> ，但<em>在</em>执行AFTER触发器<em>之前</em> ，检查依赖表中的外键约束。如果从属表中的任何行违反了外键约束，则该语句将被拒绝。</li>

</ul>

<p>当从属表的列中的值被更新，并且该值是外键的一部分时，NO ACTION是隐式更新规则。NO ACTION表示如果用非空值更新外键，则在更新语句完成时，更新值必须与父表的主键中的值匹配。如果更新与父表的主键中的值不匹配，则该语句被拒绝。</p>
 <p>当删除父表的一行并且该行在引用约束的依赖表中具有依赖项时，将应用删除规则。如果从属表的行作为父表上CASCADE的一部分被删除，则称父表上的删除操作将<em>传播</em>到从属表。如果从属表也是父表，则指定的操作将依次应用于其从属表。</p>
 <p>选择为“无操作”，“限制”，“级联”或“设置为空”。仅当外键的某些列允许空值时，才可以指定SET NULL。如果删除规则为：</p>
 
<ul>
<li>如果不执行任何操作，则在执行所有删除操作和BEFORE触发器<em>之后</em> ，但<em>在</em>执行AFTER触发器<em>之前</em> ， <span>Derby将</span>检查依赖表中的外键约束。如果从属表中的任何行违反了外键约束，则该语句将被拒绝。</li>

<li>RESTRICT， <span>Derby</span>检查从属表是否存在外键约束。如果从属表中的任何行违反外键约束，则该语句将回滚。</li>

<li>CASCADE，删除操作将传播到相关表（以及该表的相关表，如果适用）。</li>

<li>SET NULL，则依赖表的外键的每个可空列都设置为null。</li>

</ul>

<p>如果未指定ON DELETE，则NO ACTION是隐式删除规则。</p>

<p>在表是父级的每个引用约束中，都有自己的删除规则。所有适用的删除规则均用于确定删除操作的结果。因此，如果行在引用约束中具有从属关系且具有RESTRICT或NO ACTION的删除规则，则不能删除该行。同样，如果删除级联到依赖引用约束（具有RESTRICT或NO ACTION的删除规则）的后代，则该行也无法删除。</p>
 <div class="p">从父表删除一行会涉及其他表。父表的删除操作中涉及的任何表都被称为删除连接到父表。删除可以通过以下方式影响这些表的行：<ul>
<li>如果删除规则是RESTRICT或NO ACTION，则该操作涉及一个从属表，但不受该操作的影响。（也就是说， <span>Derby会</span>检查表中的值，但不会删除任何值。）</li>

<li>如果删除规则为SET NULL，则当父表的一行是删除或传播的删除操作的对象时，可以更新从属表的行。</li>

<li>如果删除规则是CASCADE，则当父表是删除对象时，可以删除从属表的行。</li>

<li>如果从属表也是父表，则此列表中描述的操作将依次应用于其从属表。</li>

</ul>
</div>
 
<p>如果外键的约束模式为DEFERRED，则尽管有ON DELETE或ON UPDATE引用操作规范，也会在推迟的检查时间检查子表中的插入（或更改外键的行的更新）。如果删除（或更新了父表中的一行，以便修改引用的键），则行为取决于ON DELETE或ON UPDATE的规范。仅当未指定任何操作时，才推迟检查。如果还推迟了主表引用的主键或唯一键约束，则对父行的任何删除都可能立即导致外键冲突（或在延迟的检查时间，如果还推迟了外键，视情况而定）所引用密钥的多个密钥副本中的最后一个密钥副本将被删除或更新。</p>

</div>

<div class="section"><h2 class="sectiontitle">语句依赖系统</h2> <p>INSERT和UPDATE语句取决于目标表上的所有约束。删除取决于唯一，主键和外键约束。如果将约束添加到目标表或从目标表删除约束，这些语句将无效。</p>
 </div>

<div class="example" id="rrefsqlj13590__sqljidx6080"><a name="rrefsqlj13590__sqljidx6080"><!-- --></a><h2 class="sectiontitle">例子</h2> <pre><strong>-- column-level primary key constraint named OUT_TRAY_PK:
CREATE TABLE SAMP.OUT_TRAY
	(
	SENT TIMESTAMP,
	DESTINATION CHAR(8),
	SUBJECT CHAR(64) NOT NULL CONSTRAINT OUT_TRAY_PK PRIMARY KEY,
	NOTE_TEXT VARCHAR(3000) 
   );

-- the table-level primary key definition allows you to
-- include two columns in the primary key definition:
CREATE TABLE SAMP.SCHED 
	(
	CLASS_CODE CHAR(7) NOT NULL, 
	DAY SMALLINT NOT NULL, 
	STARTING TIME, 
	ENDING TIME,
	PRIMARY KEY (CLASS_CODE, DAY)
	);

-- Use a column-level constraint for an arithmetic check
-- Use a table-level constraint
-- to make sure that a employee's taxes does not 
-- exceed the bonus
CREATE TABLE SAMP.EMP 
	(
	EMPNO CHAR(6) NOT NULL CONSTRAINT EMP_PK PRIMARY KEY,
	FIRSTNME CHAR(12) NOT NULL,
	MIDINIT VARCHAR(12) NOT NULL,
	LASTNAME VARCHAR(15) NOT NULL,
	SALARY DECIMAL(9,2) CONSTRAINT SAL_CK CHECK (SALARY &gt;= 10000),
	BONUS DECIMAL(9,2), 
	TAX DECIMAL(9,2),
	CONSTRAINT BONUS_CK CHECK (BONUS &gt; TAX)
	);

-- use a check constraint to allow only appropriate
-- abbreviations for the meals
CREATE TABLE FLIGHTS
	(
	FLIGHT_ID CHAR(6) NOT NULL ,
	SEGMENT_NUMBER INTEGER NOT NULL ,
	ORIG_AIRPORT CHAR(3),
	DEPART_TIME TIME,
	DEST_AIRPORT CHAR(3),
	ARRIVE_TIME TIME,
	MEAL CHAR(1) CONSTRAINT MEAL_CONSTRAINT 
	CHECK (MEAL IN ('B', 'L', 'D', 'S')),
	PRIMARY KEY (FLIGHT_ID, SEGMENT_NUMBER)
	);

-- use the same check constraint, but
-- make the MEAL_CONSTRAINT deferrable
CREATE TABLE FLIGHTS
	(
	FLIGHT_ID CHAR(6) NOT NULL,
	SEGMENT_NUMBER INTEGER NOT NULL,
	ORIG_AIRPORT CHAR(3),
	DEPART_TIME TIME,
	DEST_AIRPORT CHAR(3),
	ARRIVE_TIME TIME,
	MEAL CHAR(1) CONSTRAINT MEAL_CONSTRAINT 
	    CHECK (MEAL IN ('B', 'L', 'D', 'S'))
	    DEFERRABLE INITIALLY DEFERRED,
	PRIMARY KEY (FLIGHT_ID, SEGMENT_NUMBER)
	);

CREATE TABLE METROPOLITAN
	(
	HOTEL_ID INT NOT NULL CONSTRAINT HOTELS_PK PRIMARY KEY,
	HOTEL_NAME VARCHAR(40) NOT NULL,
	CITY_ID INT CONSTRAINT METRO_FK REFERENCES CITIES
	);

-- create a table with a table-level primary key constraint
-- and a table-level foreign key constraint 
CREATE TABLE FLTAVAIL
	(
	FLIGHT_ID CHAR(6) NOT NULL, 
	SEGMENT_NUMBER INT NOT NULL, 
	FLIGHT_DATE DATE NOT NULL, 
	ECONOMY_SEATS_TAKEN INT,
	BUSINESS_SEATS_TAKEN INT,
	FIRSTCLASS_SEATS_TAKEN INT, 
	CONSTRAINT FLTAVAIL_PK PRIMARY KEY (FLIGHT_ID, SEGMENT_NUMBER), 
	CONSTRAINT FLTS_FK
	FOREIGN KEY (FLIGHT_ID, SEGMENT_NUMBER)
	REFERENCES Flights (FLIGHT_ID, SEGMENT_NUMBER)
	);
<span>-- add a unique constraint to a column</span>
ALTER TABLE SAMP.PROJECT 
ADD CONSTRAINT P_UC UNIQUE (PROJNAME);

-- create a table whose city_id column references the
-- primary key in the Cities table
-- using a column-level foreign key constraint  
CREATE TABLE CONDOS
	(
	CONDO_ID INT NOT NULL CONSTRAINT hotels_PK PRIMARY KEY,
	CONDO_NAME VARCHAR(40) NOT NULL,
	CITY_ID INT CONSTRAINT city_foreign_key
	REFERENCES Cities ON DELETE CASCADE ON UPDATE RESTRICT
	);</strong></pre>
 </div>

</div>

<div>
<ul class="ullinks">
<li class="ulchildlink"><strong><a href="rrefsqlj16095.html">columnLevelConstraint</a></strong><br>
</li>
<li class="ulchildlink"><strong><a href="rrefsqlj42154.html">tableLevelConstraint</a></strong><br>
</li>
<li class="ulchildlink"><strong><a href="rrefsqlj16357.html">REFERENCES子句</a></strong><br>
</li>
<li class="ulchildlink"><strong><a href="rrefsqljconstrchar.html">约束特征</a></strong><br>
</li>
</ul>

<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="rrefclauses.html" title="">SQL子句</a></div>
</div>
</div>



</body></html>