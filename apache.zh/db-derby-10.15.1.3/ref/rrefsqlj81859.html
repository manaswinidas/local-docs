<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="reference">
<meta name="DC.Title" content="ALTER TABLE statement">
<meta name="abstract" content="The ALTER TABLE statement modifies a table.">
<meta name="description" content="The ALTER TABLE statement modifies a table.">
<meta name="DC.subject" content="ALTER TABLE statement, Compressing tables, Tables, altering, compressing, Columns, adding, Constraints, dropping, Defaults, Adding Columns, Adding Constraints, Dropping Constraints, setting, changing lock granularity for, Data types, modifying">
<meta name="keywords" content="ALTER TABLE statement, Compressing tables, Tables, altering, compressing, Columns, adding, Constraints, dropping, Defaults, Adding Columns, Adding Constraints, Dropping Constraints, setting, changing lock granularity for, Data types, modifying">
<meta name="DC.Relation" scheme="URI" content="crefsqlj39374.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="rrefsqlj81859">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>ALTER TABLE语句</title>
</head>
<body id="rrefsqlj81859" ><a name="rrefsqlj81859"><!-- --></a>


<h1 class="topictitle1">ALTER TABLE语句</h1>



<div><p>ALTER TABLE语句修改表。</p>

<div class="section"><div class="p">ALTER TABLE语句使您能够：<ul>
<li>向表添加列</li>

<li>向表添加约束</li>

<li>从表格中删除一列</li>

<li>从表中删除现有约束</li>

<li>增加BLOB，CLOB，VARCHAR或VARCHAR FOR BIT DATA列的宽度</li>

<li>覆盖表的行级锁定（或删除覆盖）</li>

<li>通过以下任意一种方式更改标识列：<ul>
<li>更改标识列的增量值和起始值</li>

<li>将生成条件从ALWAYS更改为DEFAULT BY行为，反之亦然</li>

<li>将溢出处理方式从“周期”更改为“无周期”行为，反之亦然</li>

</ul>
</li>

<li>更改列的可空性约束</li>

<li>更改列的默认值</li>

</ul>
</div>
</div>

<div class="section"><h2 class="sectiontitle">句法</h2><pre><strong>ALTER TABLE <em><a href="rreftablename.html#rreftablename">tableName</a></em>
{
    ADD COLUMN <em><a href="rrefsqlj30540.html#rrefsqlj30540">columnDefinition</a></em> |
    ADD <em><a href="rrefsqlj13590.html#rrefsqlj13590">CONSTRAINT clause</a></em> |
    DROP [ COLUMN ] <em><a href="rrefcolumnname.html#rrefcolumnname">columnName</a></em> [ CASCADE | RESTRICT ] |
    DROP { PRIMARY KEY |
           FOREIGN KEY <em><a href="rrefconstraintname.html#rrefconstraintname">constraintName</a></em> |
           UNIQUE <em><a href="rrefconstraintname.html#rrefconstraintname">constraintName</a></em> |
           CHECK <em><a href="rrefconstraintname.html#rrefconstraintname">constraintName</a></em> |
           CONSTRAINT <em><a href="rrefconstraintname.html#rrefconstraintname">constraintName</a></em> } |
    ALTER [ COLUMN ] <em><a href="rrefsqlj81859.html#rrefsqlj81859__rrefsqlj37860">columnAlteration</a></em> |
    LOCKSIZE { ROW | TABLE }
}</strong></pre>
</div>

<div class="example" id="rrefsqlj81859__rrefsqlj37860"><a name="rrefsqlj81859__rrefsqlj37860"><!-- --></a><h2 class="sectiontitle">columnAlteration</h2>
<pre><strong><em>columnName</em> SET DATA TYPE BLOB( <em>integer</em> ) |
<em>columnName</em> SET DATA TYPE CLOB( <em>integer</em> ) |
<em>columnName</em> SET DATA TYPE VARCHAR( <em>integer</em> ) |
<em>columnName</em> SET DATA TYPE VARCHAR( <em>integer</em> ) FOR BIT DATA |
<em>columnName</em> SET INCREMENT BY <em>integerConstant</em> |
<em>columnName</em> RESTART WITH <em>integerConstant</em> |
<em>columnName</em> SET GENERATED { ALWAYS | BY DEFAULT } |
<em>columnName</em> { SET | DROP } NOT NULL |
<em>columnName</em> [ NOT ] NULL |
<em>columnName</em> [ WITH | SET ] DEFAULT <em>defaultValue</em> |
<em>columnName</em> SET [ NO ] CYCLE |
<em>columnName</em> DROP DEFAULT</strong> </pre>
</div>

<div class="section"><p>在<em>columnAlteration中</em> ，SET INCREMENT BY <em>integerConstant</em>指定标识列的连续值之间的间隔。标识列的下一个要生成的值将根据上一次分配的值确定，并应用增量。该列必须已经使用IDENTITY属性定义。</p>
<div class="p">重新启动<em>integerConstant</em>指定要为标识列生成的下一个值。RESTART WITH对于具有标识列定义为GENERATED BY DEFAULT且在该标识列上定义了唯一键的表很有用。由于GENERATED BY DEFAULT允许手动插入和系统生成的值，因此手动插入的值可能与系统生成的值冲突。要解决此类冲突，请使用RESTART WITH语法指定将为标识列生成的下一个值。考虑以下示例，该示例包含自动生成的数据和手动插入的数据的组合：<pre><strong>CREATE TABLE tauto(i INT GENERATED BY DEFAULT AS IDENTITY, k INT)
CREATE UNIQUE INDEX tautoInd ON tauto(i)
INSERT INTO tauto(k) values 1,2</strong></pre>
</div>
<div class="p">系统将自动为标识列生成值。但是，现在您需要手动将一些数据插入“身份”列：<pre><strong>INSERT INTO tauto VALUES (3,3)
INSERT INTO tauto VALUES (4,4)
INSERT INTO tauto VALUES (5,5)</strong></pre>
</div>
<div class="p">此时，标识列已使用值1到5。如果现在希望系统生成一个值，则系统将生成3，这将导致唯一的键异常，因为已经手动插入了值3。为了补偿手动插入，请使用RESTART WITH 6对Identity列发出ALTER TABLE语句：<pre><strong>ALTER TABLE tauto ALTER COLUMN i RESTART WITH 6</strong></pre>
</div>


<p>插入或更新行时，SET GENERATED ALWAYS导致Derby不接受标识列的替代值。SET GENERATED BY DEFAULT使Derby允许这些替代。
</p>


<p>CYCLE子句控制标识列耗尽其范围并回绕（CYCLE）或引发异常（NO CYCLE）时将发生的情况。
</p>


<p>ALTER TABLE不会影响引用已更改表的任何视图。这包括其SELECT列表中带有“ *”的视图。如果希望它们返回新的列，则必须删除并重新创建这些视图。</p>

<p>如果您尝试将生成的列的<em>DataType</em>更改为<em>generationClause</em>的类型不能分配的类型，则<span>Derby</span>会引发错误。
如果尝试将DEFAULT子句添加到生成的列， <span>Derby</span>也会引发错误。</p>
</div>

<div class="section"><h2 class="sectiontitle">添加列</h2><p>新列的<em><a href="rrefsqlj30540.html#rrefsqlj30540">columnDefinition</a></em>语法与CREATE TABLE语句中的列相同。此语法允许将列约束放置在ALTER TABLE ADD COLUMN语句内的新列上。但是，如果提供默认值，则可以将具有NOT NULL约束的列添加到现有表中。否则，执行ALTER TABLE语句时将引发异常。</p>
<p>就像在CREATE TABLE中一样，如果列定义包括主键约束，则该列不能包含空值，因此还必须指定NOT NULL属性（SQLSTATE 42831）。</p>
<div class="note"><span class="notetitle">注意：</span>如果表具有不带显式列列表的UPDATE触发器，则实际上在该表中添加列会将该列添加到定义触发器的隐式更新列列表中，并且对转换变量的所有引用均无效，因此它们拿起新的专栏。</div>

<p>如果将生成的列添加到表中，则<span>Derby会</span>计算表中所有现有行的生成值。</p>

<p>ALTER TABLE ADD COLUMN将新列添加到表行的末尾。如果您需要以ALTER TABLE ALTER COLUMN不允许的方式更改列（例如，如果您需要更改其数据类型），那么唯一的方法是删除该列并添加一个新列，这更改列的顺序。</p>
</div>

<div class="section"><h2 class="sectiontitle">增加约束</h2><div class="p">ALTER TABLE ADD CONSTRAINT将表级约束添加到现有表。可以通过ALTER TABLE添加任何受支持的表级别约束类型。在向现有表添加约束时存在以下限制：<ul>
<li>将外键或检查约束添加到现有表时， <span>Derby会</span>检查表以确保现有行满足约束。如果任何行无效，则<span>Derby</span>引发语句异常，并且不添加约束。</li>

<li>主键中包含的所有列都必须包含非null数据并且是唯一的。<p>ALTER TABLE ADD UNIQUE或PRIMARY KEY提供了一种定义由单列组成的主键的简便方法。如果在列C的定义中指定了PRIMARY KEY，则其效果与将PRIMARY KEY（C）子句指定为单独的子句的效果相同。该列不能包含空值，因此还必须指定NOT NULL属性。</p>
</li>

</ul>
</div>
<p>有关约束语法的信息，请参见<a href="rrefsqlj13590.html#rrefsqlj13590">CONSTRAINT子句</a> 。当使用ADD TABLE ADD CONSTRAINT语法添加约束时，请将该语法用于表级约束。</p>
</div>

<div class="section"><h2 class="sectiontitle">删除列</h2><p>ALTER TABLE DROP COLUMN允许您从表中删除列。</p>

<p>关键字COLUMN是可选的。</p>

<p>关键字CASCADE和RESTRICT也是可选的。如果您既未指定CASCADE也未指定RESTRICT，则默认值为CASCADE。</p>

<p>如果指定RESTRICT，则如果列放置会导致从属架构对象变为无效，则该列放置将被拒绝。</p>

<p>如果指定CASCADE，则列放置还应该删除其他已变为无效的模式对象。</p>

<p>可能导致拒绝DROP COLUMN RESTRICT的架构对象包括：视图，触发器，主键约束，外键约束，唯一键约束，检查约束和列特权。如果这些类型的对象之一取决于要删除的列，则DROP COLUMN RESTRICT将拒绝该语句。</p>

<p>
如果在删除生成的列的<em>generationClause</em>引用的列时指定RESTRICT，则<span>Derby</span>也会引发错误。但是，如果指定CASCADE，则也会使用CASCADE语义删除生成的列。</p>

<p>您不能删除表中的最后（唯一）列。</p>

<p>CASCADE / RESTRICT不考虑在任何索引中是否使用了被删除的列。删除列时，会将其从包含该列的所有索引中删除。如果该列是索引中的唯一列，则会删除整个索引。</p>

</div>

<div class="section"><h2 class="sectiontitle">放下约束</h2><p>ALTER TABLE DROP CONSTRAINT删除对现有表的约束。要删除未命名的约束，必须将存储在<em>SYS.SYSCONSTRAINTS中</em>的生成的约束名称指定为带分隔符的标识符。</p>
<p>删除主键，唯一键或外键约束会删除实施该约束的物理索引（也称为<em>后备索引</em> ）。</p>
</div>

<div class="section"><h2 class="sectiontitle">修改列</h2><div class="p"><em><a href="rrefsqlj81859.html#rrefsqlj81859__rrefsqlj37860">columnAlteration</a></em>允许您通过以下方式更改命名列：<ul>
<li>增加现有VARCHAR或VARCHAR FOR BIT DATA列的宽度。CHARACTER VARYING或CHAR VARYING可用作VARCHAR关键字的同义词。<p>要增加这些类型的列的宽度，请在列名称后指定数据类型和新大小。</p>
<p>不允许您减小宽度或更改数据类型。不允许增加作为外键约束引用的主键或唯一键的一部分或外键约束的一部分的列的宽度。</p>
</li>


<li>指定标识列的连续值之间的间隔。<p>要在identity列的连续值之间设置间隔，请指定<em>integerConstant</em> 。您先前必须使用IDENTITY属性定义该列（SQLSTATE 42837）。如果表中存在行，则添加SET INCREMENT默认值的列中的值不会更改。</p>
</li>

<li>修改列的可空性约束。
    <p>您可以将NOT NULL约束添加到现有列。为此，表中的列必须没有现有的NULL值。</p>

    <p>您可以从现有列中删除NOT NULL约束。为此，不得在PRIMARY KEY约束中使用该列。</p>
</li>


<li>将标识列从“始终生成”更改为“默认生成”，反之亦然。
<p>SET GENERATED子句只能应用于标识列。它不能用于将非标识列转换为标识列。如果在从快照或导出的转储批量加载表时需要保留键值，则此子句很有用。
</p>

</li>


<li>将标识列从CYCLE更改为NO CYCLE行为，反之亦然。
<p>CYCLE子句控制标识列耗尽其范围并回绕（CYCLE）或引发异常（NO CYCLE）时将发生的情况。
</p>

</li>


<li>更改列的默认值。
<p>您可以使用DEFAULT <em>默认值</em>更改列的默认值。要禁用先前设置的默认值，请使用DROP DEFAULT（或者，您可以将NULL指定为<em>default-value</em> ）。</p>
</li>

</ul>
</div>
</div>

<div class="section"><h2 class="sectiontitle">设置默认值</h2><p>您可以为新列指定默认值。如果未指定其他值，则默认值为插入列中的值。如果未明确指定，则列的默认值为NULL。如果将默认值添加到新列，则表中的现有行将在新列中获得默认值。</p>
<p>有关默认值的更多信息，请参见<a href="rrefsqlj24513.html#rrefsqlj24513">CREATE TABLE语句</a> 。</p>
</div>

<div class="section"><h2 class="sectiontitle">更改表的锁定粒度</h2><p>如果您的系统使用行级锁定的默认设置，则LOCKSIZE子句允许您覆盖特定表的行级锁定。（如果将系统设置为表级锁定，则无法将锁定粒度更改为行级锁定，尽管<span>Derby</span>允许您在这种情况下使用LOCKSIZE子句而不会引发异常。）要覆盖特定表的行级锁定，请将表的锁定设置为TABLE。如果创建的表具有表级锁定粒度，则可以使用ALTER TABLE STATEMENT中的LOCKSIZE子句将锁定更改回ROW。有关为何有时有用的信息，请参见“ <cite><span><em>调整Derby”</em></span></cite> 。</p>
</div>

<div class="section"><h2 class="sectiontitle">例子</h2><pre><strong><span>-- Add a new column with a column-level constraint
-- to an existing table
-- An exception will be thrown if the table
-- contains any rows
-- since the newcol will be initialized to NULL
-- in all existing rows in the table</span>
ALTER TABLE CITIES ADD COLUMN REGION VARCHAR(26)
CONSTRAINT NEW_CONSTRAINT CHECK (REGION IS NOT NULL);

<span>-- Add a new unique constraint to an existing table
-- An exception will be thrown if duplicate keys are found</span>
ALTER TABLE SAMP.DEPARTMENT
ADD CONSTRAINT NEW_UNIQUE UNIQUE (DEPTNO);

<span>-- add a new foreign key constraint to the
-- Cities table. Each row in Cities is checked
-- to make sure it satisfied the constraints.
-- if any rows don't satisfy the constraint, the
-- constraint is not added</span>
ALTER TABLE CITIES ADD CONSTRAINT COUNTRY_FK
Foreign Key (COUNTRY) REFERENCES COUNTRIES (COUNTRY);

<span>-- Add a primary key constraint to a table
-- First, create a new table</span>
CREATE TABLE ACTIVITIES (CITY_ID INT NOT NULL,
SEASON CHAR(2), ACTIVITY VARCHAR(32) NOT NULL);
<span>-- You will not be able to add this constraint if the
-- columns you are including in the primary key have
-- null data or duplicate values.</span>
ALTER TABLE Activities ADD PRIMARY KEY (city_id, activity);

<span>-- Drop the city_id column if there are no dependent objects:</span>
ALTER TABLE Cities DROP COLUMN city_id RESTRICT;
<span>-- Drop the city_id column, also dropping all dependent objects:</span>
ALTER TABLE Cities DROP COLUMN city_id CASCADE;

<span>-- Drop a primary key constraint from the CITIES table
</span>
ALTER TABLE Cities DROP CONSTRAINT Cities_PK;
<span>-- Drop a foreign key constraint from the CITIES table</span>
ALTER TABLE Cities DROP CONSTRAINT COUNTRIES_FK;
<span>-- add a DEPTNO column with a default value of 1</span>
ALTER TABLE SAMP.EMP_ACT ADD COLUMN DEPTNO INT DEFAULT 1;
<span>-- increase the width of a VARCHAR column</span>
ALTER TABLE SAMP.EMP_PHOTO ALTER PHOTO_FORMAT SET DATA TYPE VARCHAR(30);
<span>-- change the lock granularity of a table</span>
ALTER TABLE SAMP.SALES LOCKSIZE TABLE;

<span>-- Remove the NOT NULL constraint from the MANAGER column</span>
ALTER TABLE Employees ALTER COLUMN Manager NULL;
<span>-- Add the NOT NULL constraint to the SSN column</span>
ALTER TABLE Employees ALTER COLUMN ssn NOT NULL;

<span>-- Change the default value for the SALARY column</span>
ALTER TABLE Employees ALTER COLUMN Salary DEFAULT 1000.0
ALTER TABLE Employees ALTER COLUMN Salary DROP DEFAULT

<span>-- Enable CYCLE behavior for the message_id column</span>
ALTER TABLE messages ALTER COLUMN message_id SET CYCLE

<span>-- Bulk load a table by temporarily changing a GENERATED ALWAYS identity column
-- into a GENERATED BY default column.
-- After loading the table, reset the identity column to be GENERATED ALWAYS
-- and move its sequence number forward past the last inserted key.</span>
ALTER TABLE targetTable ALTER COLUMN keyCol SET GENERATED BY DEFAULT;
INSERT INTO targetTable SELECT * FROM sourceTable;
ALTER TABLE targetTable ALTER COLUMN keyCol SET GENERATED ALWAYS;
ALTER TABLE targetTable ALTER COLUMN keyCol RESTART WITH 1234567;
</strong></pre>
</div>

<div class="section"><h2 class="sectiontitle">结果</h2><p>ALTER TABLE语句使依赖于被更改表的所有语句在下一次执行之前重新编译。如果有任何打开的游标引用正在更改的表，则不允许使用ALTER TABLE。</p>
</div>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="crefsqlj39374.html" title="">语句</a></div>
</div>
</div>



</body></html>