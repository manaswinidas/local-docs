<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="reference">
<meta name="DC.Title" content="LOCK TABLE statement">
<meta name="abstract" content="The LOCK TABLE statement explicitly acquires a shared or exclusive table lock on the specified table.">
<meta name="description" content="The LOCK TABLE statement explicitly acquires a shared or exclusive table lock on the specified table.">
<meta name="DC.subject" content="LOCK TABLE statement, LOCK TABLE, SQL statements, tables, locking, lock escalation, by user">
<meta name="keywords" content="LOCK TABLE statement, LOCK TABLE, SQL statements, tables, locking, lock escalation, by user">
<meta name="DC.Relation" scheme="URI" content="crefsqlj39374.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="rrefsqlj40506">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>LOCK TABLE语句</title>
</head>
<body id="rrefsqlj40506" ><a name="rrefsqlj40506"><!-- --></a>


<h1 class="topictitle1">LOCK TABLE语句</h1>



<div><p>LOCK TABLE语句显式获取指定表上的共享或互斥表锁。</p>

<div class="section">
<p>表锁将持续到当前事务结束为止。</p>

<p>要锁定表，您必须是<a href="rrefattrib26867.html#rrefattrib26867">数据库所有者</a>或表所有者。</p>
<div class="p">显式锁定表可用于：<ul>
<li>避免在表上使用多个行锁的开销（换句话说，由用户启动的锁升级）</li>

<li>避免死锁</li>

</ul>
</div>
<p>您不能使用此语句锁定系统表。</p>
</div>

<div class="section"><h2 class="sectiontitle">句法</h2> <pre><strong>LOCK TABLE <em><a href="rreftablename.html#rreftablename">tableName</a></em> IN { SHARE | EXCLUSIVE } MODE</strong></pre>
<p>在以任何一种模式锁定表之后，事务不会获取表上的任何后续行级锁。例如，如果交易锁定了整个<samp class="codeph">Flights</samp>为了以共享方式读取表中的数据，特定语句可能需要以独占方式锁定特定行以更新该行。但是，之前的表级锁<samp class="codeph">Flights</samp> table还将排他锁也强制为表级。</p>
<p>如果由于另一个连接已经在该表上持有锁而无法获取指定的锁，则在死锁超时时间段后会引发语句级异常（ <em>SQLState</em> X0X02）。</p>
 </div>

<div class="example"><h2 class="sectiontitle">例子</h2><div class="p">锁定整个<samp class="codeph">Flights</samp>共享模式下的表避免大量的行锁，请使用以下语句：<pre>LOCK TABLE Flights IN SHARE MODE;
SELECT *
FROM Flights
WHERE orig_airport &gt; 'OOO';
</pre>
</div>
<div class="p">您有一个包含多个UPDATE语句的事务。由于每个单独的语句仅获取几个行级锁，因此事务将不会自动将锁升级为表级锁。但是，UPDATE语句共同获取并释放大量锁，这可能会导致死锁。对于这种类型的事务，您可以在事务开始时获取独占表级锁。例如：<pre>LOCK TABLE FlightAvailability IN EXCLUSIVE MODE;
UPDATE FlightAvailability
SET economy_seats_taken = (economy_seats_taken + 2)
WHERE flight_id = 'AA1265' AND flight_date = DATE('2004-03-31');

UPDATE FlightAvailability
SET economy_seats_taken = (economy_seats_taken + 2)
WHERE flight_id = 'AA1265' AND flight_date = DATE('2004-04-11'); 

UPDATE FlightAvailability
SET economy_seats_taken = (economy_seats_taken + 2)
WHERE flight_id = 'AA1265' AND flight_date = DATE('2004-04-12');

UPDATE FlightAvailability
SET economy_seats_taken = (economy_seats_taken + 2)
WHERE flight_id = 'AA1265' AND flight_date = DATE('2004-04-15');
</pre>
</div>
<div class="p">如果事务需要在更新表之前查看表，请在选择避免死锁之前获取排他锁。例如：<pre>LOCK TABLE Maps IN EXCLUSIVE MODE;
SELECT MAX(map_id) + 1 FROM Maps;
-- INSERT INTO Maps . . .</pre>
</div>
 </div>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="crefsqlj39374.html" title="">语句</a></div>
</div>
</div>



</body></html>