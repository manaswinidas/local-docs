<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="reference">
<meta name="DC.Title" content="CREATE TRIGGER statement">
<meta name="abstract" content="The CREATE TRIGGER statement creates a trigger, which defines a set of actions that are executed when a database event occurs on a specified table.">
<meta name="description" content="The CREATE TRIGGER statement creates a trigger, which defines a set of actions that are executed when a database event occurs on a specified table.">
<meta name="DC.subject" content="CREATE TRIGGER statement, SQL statements, CREATE TRIGGER, triggers, creating, defining when they fire, database events, referencing clause, referencing old and new values, statement versus row triggers, triggeredSQLStatement, order of execution, recursion">
<meta name="keywords" content="CREATE TRIGGER statement, SQL statements, CREATE TRIGGER, triggers, creating, defining when they fire, database events, referencing clause, referencing old and new values, statement versus row triggers, triggeredSQLStatement, order of execution, recursion">
<meta name="DC.Relation" scheme="URI" content="crefsqlj95081.html">
<meta name="DC.Relation" scheme="URI" content="rrefsqljcreateaggregate.html">
<meta name="DC.Relation" scheme="URI" content="rrefcreatefunctionstatement.html">
<meta name="DC.Relation" scheme="URI" content="rrefsqlj20937.html">
<meta name="DC.Relation" scheme="URI" content="rrefcreateprocedurestatement.html">
<meta name="DC.Relation" scheme="URI" content="rrefcreaterole.html">
<meta name="DC.Relation" scheme="URI" content="rrefsqlj31580.html">
<meta name="DC.Relation" scheme="URI" content="rrefsqljcreatesequence.html">
<meta name="DC.Relation" scheme="URI" content="rrefsqljcreatesynonym.html">
<meta name="DC.Relation" scheme="URI" content="rrefsqlj24513.html">
<meta name="DC.Relation" scheme="URI" content="rrefsqljcreatetype.html">
<meta name="DC.Relation" scheme="URI" content="rrefsqlj15446.html">
<meta name="DC.Relation" scheme="URI" content="rrefsqlj89752.html">
<meta name="DC.Relation" scheme="URI" content="rrefsqljwhenclause.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="rrefsqlj43125">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>CREATE TRIGGER语句</title>
</head>
<body id="rrefsqlj43125" ><a name="rrefsqlj43125"><!-- --></a>


<h1 class="topictitle1">CREATE TRIGGER语句</h1>



<div><p>CREATE TRIGGER语句创建一个触发器，该触发器定义了在指定表上发生数据库事件时执行的一组操作。</p>

<div class="section"> <p><em>数据库事件</em>是删除，插入或更新操作。例如，如果您为特定表上的删除定义触发器，则只要有人从表中删除一行或多行，触发器的动作就会发生。</p>
<p>除约束外，触发器还可以通过级联删除或更新等操作来帮助实施数据完整性规则。触发器还可以执行各种功能，例如发出警报，更新其他表，发送电子邮件和其他有用的操作。</p>
<p>您可以为单个表定义任意数量的触发器，包括为同一事件在同一表上的多个触发器。</p>
<p>您可以在您是架构所有者的任何架构中创建触发器。要在您不拥有的表上创建触发器，必须为该表授予TRIGGER特权。<a href="rrefattrib26867.html#rrefattrib26867">数据库所有者</a>还可以在任何模式中的任何表上创建触发器。</p>

<p>触发器以触发器所有者的特权进行操作。有关详细信息，请参见《 <span><em>Derby安全指南</em></span> 》中的“配置细粒度的用户授权”和“视图，触发器，约束和生成的列的特权”。</p>

<p>触发器不需要与定义触发器的表位于相同的架构中。</p>
<p>如果指定了合格的触发器名称，则架构名称不能以<em>SYS</em>开头。</p>
</div>

<div class="section" id="rrefsqlj43125__syn001"><a name="rrefsqlj43125__syn001"><!-- --></a><h2 class="sectiontitle">句法</h2><pre><strong>CREATE TRIGGER <em><a href="rreftriggername.html#rreftriggername">triggerName</a></em>
{ AFTER | NO CASCADE BEFORE } 
{ INSERT | DELETE | UPDATE [ OF <em><a href="rrefcolumnname.html#rrefcolumnname">columnName</a></em> [ , <em><a href="rrefcolumnname.html#rrefcolumnname">columnName</a></em> ]* ] }
ON <em><a href="rreftablename.html#rreftablename">tableName</a></em>
[ <em><a href="rrefsqlj89752.html#rrefsqlj89752">referencingClause</a></em> ]
[ FOR EACH { ROW | STATEMENT } ] [ MODE DB2SQL ] 
[ <a href="rrefsqljwhenclause.html#rrefsqljwhenclause">WHEN ( <em>booleanExpression</em> )</a> ]
<em><a href="rrefsqlj43125.html#rrefsqlj43125__i1149821">triggeredSQLStatement</a></em></strong></pre>
 </div>

<div class="section"><h2 class="sectiontitle">之前或之后：何时触发</h2> <div class="p">触发器定义为<em>之前</em>或<em>之后</em>触发器。<ul>
<li><em>在</em>应用语句的更改之前和应用任何约束之前， <em>Before</em>触发器会触发。在触发器可以是行触发器或语句触发器之前（请参阅<a href="rrefsqlj43125.html#rrefsqlj43125__sqlj54276">语句与行触发器</a> ）。</li>

<li><em>在</em>满足所有约束且将更改应用于目标表<em>之后，</em>触发触发器。<em>after</em>触发器可以是行触发器或语句触发器（请参阅<a href="rrefsqlj43125.html#rrefsqlj43125__sqlj54276">语句vs行触发器</a> ）。</li>

</ul>
</div>
 </div>

<div class="section"><h2 class="sectiontitle">插入，删除或更新：触发触发器的原因</h2> <div class="p">根据定义的方式，以下数据库事件之一触发触发器（请参见上面的<a href="rrefsqlj43125.html#rrefsqlj43125__syn001">语法</a> ）：<ul>
<li>插入</li>

<li>更新</li>

<li>删除</li>

</ul>
</div>
 <p>您可以在给定表上为给定事件定义任意数量的触发器。要进行更新，您可以指定列。</p>
 </div>

<div class="section" id="rrefsqlj43125__sqlj67748"><a name="rrefsqlj43125__sqlj67748"><!-- --></a><h2 class="sectiontitle">引用新旧值：REFERENCING子句</h2> <p>许多<em>TriggeredSQLStatement</em>需要引用<em>导致事件触发</em>的数据库事件当前正在更改的数据。<em>TriggeredSQLStatement</em>可能需要引用新的值（更改后或“更改后”）。</p>
 <p><span>Derby</span>为您提供了多种方法来引用导致触发器触发的数据库事件当前正在更改的数据。可以使用<em>转换变量</em>或<em>转换表</em>在<em>TriggeredSQLStatement中</em>引用更改的数据。在引用子句允许指定新/旧AS <em>correlationName</em>这些过渡变量提供的相关名称或别名。</p>
 <div class="p">例如，如果将以下子句添加到触发器定义中：<pre><strong>REFERENCING OLD AS DELETEDROW</strong></pre>
</div>
 <div class="p">然后，您可以在<em>triggeredSQLStatement中</em>引用此相关名称：<pre><strong>DELETE FROM HotelAvailability WHERE hotel_id = DELETEDROW.hotel_id</strong></pre>
</div>
 <div class="p">OLD和NEW转换变量映射到<em>java.sql。ResultSet</em>有一行。<div class="note"><span class="notetitle">注意：</span>只有行触发器（请参阅<a href="rrefsqlj43125.html#rrefsqlj43125__sqlj54276">语句与行触发器</a> ）可以使用过渡变量。INSERT行触发器不能引用OLD行。DELETE行触发器不能引用NEW行。</div>
</div>
 <p>对于语句触发器，过渡<em>表</em>用作<em>TriggeredSQLStatement</em>或触发器限定条件的表标识符。REFERENCING子句允许您通过指定OLD_TABLE / NEW_TABLE AS relatedName为这些转换表提供相关名称或别名。</p>
 <div class="p">例如：<pre><strong>REFERENCING OLD_TABLE AS DeletedHotels</strong></pre>
</div>
 <div class="p">允许您使用新的标识符<em>（DeletedHotels）</em>在<em>triggeredSQLStatement：</em><pre><strong>DELETE FROM HotelAvailability WHERE hotel_id IN
    (SELECT hotel_id FROM DeletedHotels)</strong></pre>
</div>
 <div class="p">新旧过渡表映射到<em>java.sql。基数等于受触发事件影响的行数的ResultSet</em> 。<div class="note"><span class="notetitle">注意：</span>只有语句触发器（请参阅语句触发器<a href="rrefsqlj43125.html#rrefsqlj43125__sqlj54276">和行触发器</a> ）可以使用过渡表。INSERT语句触发器不能引用OLD表。DELETE语句触发器无法引用NEW表。</div>
</div>
 <p>REFERENCING子句只能指定一个新的相关性或标识符，并且只能指定一个旧的相关性或标识符。行触发器不能为过渡表指定标识符，语句触发器不能为过渡变量指定关联。</p>

<p>可以从WHEN子句中引用REFERENCING子句中定义的转换表或转换变量。</p>

</div>

<div class="section" id="rrefsqlj43125__sqlj54276"><a name="rrefsqlj43125__sqlj54276"><!-- --></a><h2 class="sectiontitle">语句与行触发器</h2> <div class="p">您可以选择指定触发器是<em>语句触发器</em>还是<em>行触发器</em> 。如果未通过FOR EACH子句在CREATE TRIGGER语句中指定该触发器，则默认情况下该触发器为<em>语句触发器</em> 。
  <ul>
<li><em>陈述触发</em>   <p>语句触发器在每个触发事件中触发一次，无论插入，更新或删除事件是否修改了任何行。</p>
</li>

<li><em>行触发器</em>   <p>行触发器为受触发事件影响的每一行触发一次。如果没有受影响的行，则触发器不会触发。</p>
</li>

</ul>
 <div class="note"><span class="notetitle">注意：</span>将列值设置为其最初包含的值的更新（例如，UPDATE T SET C = C）将导致触发行触发器，即使该列的值与之前的值相同。触发事件。</div>
</div>
 </div>

<div class="section" id="rrefsqlj43125__i1149821"><a name="rrefsqlj43125__i1149821"><!-- --></a><h2 class="sectiontitle">触发SQL语句</h2> <div class="p">触发器定义的操作称为<em>TriggeredSQLStatement</em> （在上面的<a href="rrefsqlj43125.html#rrefsqlj43125__syn001">语法中</a> ，请参阅最后一行）。它具有以下限制：<ul>
<li>它不能包含任何动态参数（？）。</li>

<li>它不得创建，更改或删除在其上定义触发器的表。</li>

<li>它一定不能在定义触发器的表中添加索引或从中删除索引。</li>

<li>不得在定义了触发器的表中添加触发器或从中删除触发器。</li>

<li>它不得提交或回滚当前事务或更改隔离级别。</li>

<li>它不能引用SESSION模式中的表（例如临时表；请参阅<a href="rrefdeclaretemptable.html#rrefdeclaretemptable">DECLARE GLOBAL TEMPORARY TABLE语句</a> ）。</li>

<li>在触发器之前，不能将INSERT，UPDATE或DELETE语句作为其动作。</li>

<li>触发器不能调用将修改SQL数据作为其操作的过程。</li>

<li>Before触发器的NEW变量无法引用生成的列。
</li>

</ul>
</div>

<p>有关<em>triggerSQLStatement</em>的更多信息，请参见《 <span><em>Derby开发人员指南</em></span> 》中的“对触发器动作进行编程<span><em>”</em></span> 。</p>

</div>

<div class="section"><h2 class="sectiontitle">执行顺序</h2> <div class="p">当发生数据库事件并触发触发器时， <span>Derby</span>将按以下顺序执行操作：<ul>
<li>它<em>不</em>触发<em>级联</em>触发。</li>

<li>它执行约束检查（主键，唯一键，外键，检查）。</li>

<li>它执行插入，更新或删除。</li>

<li>触发<em>后</em>触发。</li>

</ul>
</div>
 <p>如果为同一表的同一数据库事件在相同的触发时间内（之前或之后）定义了多个触发器，则将按照创建它们的顺序触发触发器。</p>
 </div>

<div class="example"><h2 class="sectiontitle">例子</h2>
<pre><strong><span>-- Statements and triggers:
</span>
CREATE TRIGGER t1 NO CASCADE BEFORE UPDATE ON x
  FOR EACH ROW MODE DB2SQL
  values app.notifyEmail('Jerry', 'Table x is about to be updated'); 

CREATE TRIGGER FLIGHTSDELETE
  AFTER DELETE ON FLIGHTS
  REFERENCING OLD_TABLE AS DELETEDFLIGHTS
  FOR EACH STATEMENT 
  DELETE FROM FLIGHTAVAILABILITY WHERE FLIGHT_ID IN
  (SELECT FLIGHT_ID FROM DELETEDFLIGHTS);

CREATE TRIGGER FLIGHTSDELETE3
  AFTER DELETE ON FLIGHTS
  REFERENCING OLD AS OLD
  FOR EACH ROW 
  DELETE FROM FLIGHTAVAILABILITY WHERE FLIGHT_ID = OLD.FLIGHT_ID;
</strong></pre>
 <div class="note"><span class="notetitle">注意：</span>您可以在《 <cite><span><em>Derby开发人员指南》中</em></span></cite>找到更多示例。</div>
 </div>

<div class="section"><h2 class="sectiontitle">触发递归</h2> <p>最大触发器递归深度为16。</p>
 </div>

<div class="section"><h2 class="sectiontitle">相关信息</h2> <div class="p">会在触发触发器时（而不是在创建触发器时）评估返回当前时间或当前用户信息的特殊系统功能。这些功能包括：<ul>
<li><a href="rrefsqlj34177.html#rrefsqlj34177">CURRENT_DATE函数</a></li>

<li><a href="rrefsqlj33772.html#rrefsqlj33772">CURRENT_TIME函数</a></li>

<li><a href="rrefsqlj15866.html#rrefsqlj15866">CURRENT_TIMESTAMP函数</a></li>

<li><a href="rrefsqlj42324.html#rrefsqlj42324">CURRENT_USER函数</a></li>

<li><a href="rrefsqlj25228.html#rrefsqlj25228">SESSION_USER函数</a></li>

<li><a href="rrefsqlj42476.html#rrefsqlj42476">USER功能</a></li>

</ul>
</div>
 </div>

</div>

<div>
<ul class="ullinks">
<li class="ulchildlink"><strong><a href="rrefsqlj89752.html">引用条款</a></strong><br>
</li>
<li class="ulchildlink"><strong><a href="rrefsqljwhenclause.html">WHEN子句</a></strong><br>WHEN子句是CREATE TRIGGER语句的可选部分。</li>
</ul>

<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="crefsqlj95081.html" title="">CREATE语句</a></div>
</div>
<div class="relref"><strong>相关参考</strong><br>
<div><a href="rrefsqljcreateaggregate.html" title="CREATE DERBY AGGREGATE语句创建用户定义的聚合（UDA）。UDA是自定义聚合运算符。">CREATE DERBY AGGREGATE语句</a></div>
<div><a href="rrefcreatefunctionstatement.html" title="CREATE FUNCTION语句创建一个Java函数，然后可以在表达式中使用它。">CREATE FUNCTION语句</a></div>
<div><a href="rrefsqlj20937.html" title="CREATE INDEX语句在表上创建索引。索引可以在表中的一列或多列上。">CREATE INDEX语句</a></div>
<div><a href="rrefcreateprocedurestatement.html" title="CREATE PROCEDURE语句创建一个Java存储过程，然后可以使用CALL PROCEDURE语句调用它。">CREATE PROCEDURE语句</a></div>
<div><a href="rrefcreaterole.html" title="CREATE ROLE语句创建一个SQL角色。当数据库有许多用户时，角色对于管理特权很有用。">CREATE ROLE语句</a></div>
<div><a href="rrefsqlj31580.html" title="CREATE SCHEMA语句创建一个模式，该模式是在单个集合中对对象进行逻辑分组并为对象提供唯一名称空间的一种方式。">CREATE SCHEMA语句</a></div>
<div><a href="rrefsqljcreatesequence.html" title="CREATE SEQUENCE语句创建一个序列生成器，该生成器是一种用于一次生成一个精确数值的机制。">CREATE SEQUENCE语句</a></div>
<div><a href="rrefsqljcreatesynonym.html" title="CREATE SYNONYM语句为同一模式或其他模式中存在的表或视图提供了备用名称。">创建SYNONYM语句</a></div>
<div><a href="rrefsqlj24513.html" title="CREATE TABLE语句创建一个表。表包含列和约束，以及数据必须遵循的规则。">CREATE TABLE语句</a></div>
<div><a href="rrefsqljcreatetype.html" title="CREATE TYPE语句创建用户定义的类型（UDT）。UDT是可序列化的Java类，其实例存储在列中。">CREATE TYPE语句</a></div>
<div><a href="rrefsqlj15446.html" title="CREATE VIEW语句创建一个视图，该视图是由查询形成的虚拟表。">CREATE VIEW语句</a></div>
</div>
</div>



</body></html>