<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="reference">
<meta name="DC.Title" content="Aggregates (set functions)">
<meta name="abstract" content="This section describes aggregates (also described as set functions in ANSI SQL and as column functions in some database literature).">
<meta name="description" content="This section describes aggregates (also described as set functions in ANSI SQL and as column functions in some database literature).">
<meta name="DC.subject" content="Aggregates, and data types, requirements for">
<meta name="keywords" content="Aggregates, and data types, requirements for">
<meta name="DC.Relation" scheme="URI" content="rrefsqlj29026.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="rrefsqlj33923">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>集合（设置函数）</title>
</head>
<body id="rrefsqlj33923" ><a name="rrefsqlj33923"><!-- --></a>


<h1 class="topictitle1">集合（设置函数）</h1>



<div><p>本节介绍了聚合（在ANSI SQL中也称为<em>集合函数</em> ，在某些数据库资料中也称为<em>列函数</em> ）。</p>

<div class="section"><p>聚集提供了一种评估一组行上的表达式的方法。其他内置函数在单个表达式上运行，而聚合在一组值上运行并将它们缩减为单个标量值。内置聚合可以对行进行计数，还可以计算一组值上表达式的最小值，最大值，总和，计数，平均值，方差和标准偏差。</p>
</div>

<div class="section"><p>除了内置的聚合之外， <span>Derby还</span>允许您创建自定义聚合运算符，称为用户定义的聚合（UDA）。有关创建和删除UDA的信息，请参见<a href="rrefsqljcreateaggregate.html#rrefsqljcreateaggregate">CREATE DERBY AGGREGATE语句</a>和<a href="rrefsqljdropaggregate.html#rrefsqljdropaggregate">DROP DERBY AGGREGATE语句</a> 。有关UDA的使用特权的信息，请参见<a href="rrefsqljgrant.html#rrefsqljgrant">GRANT语句</a>和<a href="rrefsqljrevoke.html#rrefsqljrevoke">REVOKE语句</a> 。</p>

<p>有关编写实现UDA的Java类的信息，请参阅《 <span><em>Derby开发人员指南</em></span> 》中的“对用户定义的聚合进行编程<span><em>”</em></span> 。</p>

</div>

<div class="section"><p>内置聚合可以对表达式进行运算，这些表达式的计算结果如下表所示。</p>


<div class="tablenoborder"><table cellspacing="0" cellpadding="4" border="1" summary="This table lists the data types that are valid for each of the built-in aggregates." frame="border" rules="all"><caption>表格1。内置聚合的允许数据类型</caption>


<thead align="left">
<tr valign="bottom">
<th valign="bottom" width="33%" id="N100DA">功能名称</th>

<th valign="bottom" width="67%" id="N100E1">允许的数据类型</th>

</tr>

</thead>

<tbody>
<tr>
<td valign="top" width="33%" headers="N100DA"><a href="rrefsqlj32693.html#rrefsqlj32693">AVG</a></td>

<td valign="top" width="67%" headers="N100E1">数值内置数据类型</td>

</tr>

<tr>
<td valign="top" width="33%" headers="N100DA"><a href="rrefsqlj38716.html#rrefsqlj38716">计数</a></td>

<td valign="top" width="67%" headers="N100E1">所有类型</td>

</tr>

<tr>
<td valign="top" width="33%" headers="N100DA"><a href="rrefsqlj27781.html#rrefsqlj27781">最大值</a></td>

<td valign="top" width="67%" headers="N100E1">可以建立索引的数据类型</td>

</tr>

<tr>
<td valign="top" width="33%" headers="N100DA"><a href="rrefsqlj33520.html#rrefsqlj33520">最小</a></td>

<td valign="top" width="67%" headers="N100E1">可以建立索引的数据类型</td>

</tr>

<tr>
<td valign="top" width="33%" headers="N100DA"><a href="rrefsqljstddevpop.html#rrefsqljstddevpop">STDDEV_POP</a></td>

<td valign="top" width="67%" headers="N100E1">数值内置数据类型</td>

</tr>

<tr>
<td valign="top" width="33%" headers="N100DA"><a href="rrefsqljstddevsamp.html#rrefsqljstddevsamp">STDDEV_SAMP</a></td>

<td valign="top" width="67%" headers="N100E1">数值内置数据类型</td>

</tr>

<tr>
<td valign="top" width="33%" headers="N100DA"><a href="rrefsqlj13083.html#rrefsqlj13083">和</a></td>

<td valign="top" width="67%" headers="N100E1">数值内置数据类型</td>

</tr>

<tr>
<td valign="top" width="33%" headers="N100DA"><a href="rrefsqljvarpop.html#rrefsqljvarpop">VAR_POP</a></td>

<td valign="top" width="67%" headers="N100E1">数值内置数据类型</td>

</tr>

<tr>
<td valign="top" width="33%" headers="N100DA"><a href="rrefsqljvarsamp.html#rrefsqljvarsamp">VAR_SAMP</a></td>

<td valign="top" width="67%" headers="N100E1">数值内置数据类型</td>

</tr>

</tbody>

</table>
</div>
</div>

<div class="section"><div class="p">仅允许在以下情况下进行汇总：<ul>
<li><em><a href="rrefselectexpression.html#rrefselectexpression">selectExpression中</a></em>的<em>selectItem</em> <em>。</em></li>

<li><a href="rrefsqlj14854.html#rrefsqlj14854">HAVING子句</a> 。</li>

<li>如果聚合出现在相关查询块的结果中，则为<a href="rrefsqlj13658.html#rrefsqlj13658">ORDER BY子句</a> （使用别名）。也就是说，当且仅当聚合出现在<em><a href="rrefselectexpression.html#rrefselectexpression">selectExpression</a></em>的<em>selectItem</em>中时，才允许在<a href="rrefsqlj13658.html#rrefsqlj13658">ORDER BY子句中</a>使用聚合的<em><a href="rrefselectexpression.html#rrefselectexpression">别名</a> 。</em></li>

</ul>
</div>
</div>

<div class="section"><div class="p"><em><a href="rrefselectexpression.html#rrefselectexpression">selectExpression</a></em>中<em>selectItems</em>中的所有表达式<em><a href="rrefselectexpression.html#rrefselectexpression">都</a></em>必须是聚合列或分组列（请参见<a href="rrefsqlj32654.html#rrefsqlj32654">GROUP BY子句</a> ）。（如果存在没有GROUP BY子句的HAVING子句，则同样如此。）这是因为<em><a href="rrefselectexpression.html#rrefselectexpression">selectExpression</a></em>的<em>ResultSet</em>必须是标量（单个值）或向量（多个值），但不能是两者的混合。（聚合计算为标量值，对列的引用可以计算为向量。）例如，以下查询混合了标量和矢量值，因此无效：<pre><strong><span>-- not valid</span>
SELECT MIN(flying_time), flight_id
FROM Flights</strong></pre>
</div>
</div>

<div class="section"><div class="p">外部参考（关联）上不允许聚合。这意味着，如果子查询包含聚合，则该聚合无法评估包含对外部查询块中列的引用的表达式。例如，以下查询无效，因为SUM对外部查询中的列进行操作：<pre><strong>SELECT c1
FROM t1
GROUP BY c1
HAVING c2 &gt;
    (SELECT t2.x
    FROM t2
    WHERE t2.y = SUM(t1.c3)) </strong></pre>
</div>
</div>

<div class="section"><p>在<em>ResultSet</em>上声明的游标不可更新，该游标在外部查询块中包含聚合。</p>
</div>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="rrefsqlj29026.html" title="内置函数是一个表达式，其中SQL关键字或特殊运算符执行某些操作。">内置函数</a></div>
</div>
</div>



</body></html>