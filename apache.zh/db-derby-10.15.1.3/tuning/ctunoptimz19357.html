<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="About the system's selection of lock granularity">
<meta name="abstract" content="When a system is configured for row-level locking, it decides whether to use table-level locking or row-level locking for each table in each DML statement.">
<meta name="description" content="When a system is configured for row-level locking, it decides whether to use table-level locking or row-level locking for each table in each DML statement.">
<meta name="DC.subject" content="Lock granularity, how optimizer chooses, Lock escalation, chosen by optimizer, Table-level locking, forcing for a specific table at creation time">
<meta name="keywords" content="Lock granularity, how optimizer chooses, Lock escalation, chosen by optimizer, Table-level locking, forcing for a specific table at creation time">
<meta name="DC.Relation" scheme="URI" content="ctunoptimz42425.html">
<meta name="DC.Relation" scheme="URI" content="ctunoptimz32184.html">
<meta name="DC.Relation" scheme="URI" content="ctunoptimz20327.html">
<meta name="DC.Relation" scheme="URI" content="ctunoptimz11941.html">
<meta name="DC.Relation" scheme="URI" content="ctunoptimz27036.html">
<meta name="DC.Relation" scheme="URI" content="ctunoptimz29384.html">
<meta name="DC.Relation" scheme="URI" content="ctunoptimz1008884.html">
<meta name="DC.Relation" scheme="URI" content="ctunoptimz26019.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="ctunoptimz19357">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>关于系统的锁定粒度选择</title>
</head>
<body id="ctunoptimz19357" ><a name="ctunoptimz19357"><!-- --></a>


<h1 class="topictitle1">关于系统的锁定粒度选择</h1>



<div><p>当系统配置为行级锁定时，它将决定是对每个DML语句中的每个表使用表级锁定还是行级锁定。</p>

<p>系统基于对每个表读取或写入的行数以及是否对每个表进行完整的企业合并扫描来做出此决定。</p>
   
<div class="p"><div class="note"><span class="notetitle">注意：</span>关闭系统的行级锁定后， <span>Derby</span>始终使用表级锁定。</div>
</div>

<p>系统决策的首要目标是并发。系统将尽可能选择行级锁定。但是，行级锁定使用大量资源，可能会对性能产生负面影响。有时，行级锁定不能提供比表级锁定更多的并发性。在那些情况下，系统可能会选择将锁定方案从行级锁定升级到表级锁定，以提高性能。例如，如果为TRANSACTION_SERIALIZABLE隔离配置了连接，则系统为以下语句选择表级锁定：</p>

<pre><strong>SELECT *
FROM FlightAvailability AS fa, Flights AS fts
WHERE fts.flight_id = fa.flight_id
AND fts.segment_number = fa.segment_number</strong></pre>

<p>为了满足隔离要求， <span>Derby</span>必须锁定两个目录中的所有行。 <samp class="codeph">FlightAvailability</samp>和<samp class="codeph">Flights</samp>表。锁定两个表将更便宜，将提供相同的隔离，并允许相同的并发性。</p>

<div class="p"><div class="note"><span class="notetitle">注意：</span>使用LOCKSIZE子句更改特定表时，可以强制对特定表进行锁升级。对于这些表， <span>Derby</span>始终选择表级锁定。有关更多信息，请参见《 <span><em>Derby参考手册》</em></span> 。</div>
</div>

</div>
<div>
<ul class="ullinks">
<li class="ulchildlink"><strong><a href="ctunoptimz1008884.html">如果有选择，系统如何做出决定</a></strong><br>如果用户未强制执行锁定粒度（无论是锁定行还是锁定整个表），则系统将使用以下规则进行决策。</li>
<li class="ulchildlink"><strong><a href="ctunoptimz26019.html">锁定升级阈值</a></strong><br>系统属性derby.locks.escalationThreshold确定特定表触摸的行数的阈值，超过该阈值系统将升级为表级锁定。</li>
</ul>

<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="ctunoptimz42425.html" title="查询优化器做出许多基于成本的决策。">Derby基于成本的优化</a></div>
</div>
<div class="relconcepts"><strong>相关概念</strong><br>
<div><a href="ctunoptimz32184.html" title="优化器对访问路径的选择取决于其必须读取的行数。它尝试选择需要读取的行数最少的路径。">关于优化器的访问路径选择</a></div>
<div><a href="ctunoptimz20327.html" title="优化器为每个表选择最佳的连接顺序以及最佳的索引。">关于优化器对连接顺序的选择</a></div>
<div><a href="ctunoptimz11941.html" title="优化程序将选择散列连接的成本（如果可以进行散列连接）与选择嵌套循环连接的成本进行比较，然后选择更便宜的策略。">关于优化器的联接策略选择</a></div>
<div><a href="ctunoptimz27036.html" title="一些SQL语句要求对数据进行排序，包括那些使用ORDER BY，GROUP BY和DISTINCT的数据。 MIN（）和MAX（）聚合也需要对数据进行排序。">关于优化程序选择避免排序</a></div>
<div><a href="ctunoptimz29384.html" title="当Derby从一家企业集团检索数据时，它一次可以获取多行。一次获取多行称为批量获取。">关于优化程序的批量提取选择</a></div>
</div>
</div>



</body></html>