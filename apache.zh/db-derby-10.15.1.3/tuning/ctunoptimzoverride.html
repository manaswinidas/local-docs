<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Overriding the default optimizer behavior">
<meta name="abstract" content="You can override the default behavior of the Derby query optimizer by including a --DERBY-PROPERTIES clause and an associated property as a comment within an SQL statement.">
<meta name="description" content="You can override the default behavior of the Derby query optimizer by including a --DERBY-PROPERTIES clause and an associated property as a comment within an SQL statement.">
<meta name="DC.Relation" scheme="URI" content="ctunoptimz39739.html">
<meta name="DC.Relation" scheme="URI" content="ctunoptimz23977.html">
<meta name="DC.Relation" scheme="URI" content="ctunoptimz27975.html">
<meta name="DC.Relation" scheme="URI" content="ctunoptimz860097.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="ctunoptimzoverride">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>覆盖默认的优化器行为</title>
</head>
<body id="ctunoptimzoverride" ><a name="ctunoptimzoverride"><!-- --></a>


<h1 class="topictitle1">覆盖默认的优化器行为</h1>


<div><p>您可以通过添加一个来覆盖<span>Derby</span>查询优化器的默认行为。 <samp class="codeph">--DERBY-PROPERTIES</samp>子句和关联的属性作为SQL语句中的注释。</p>

<p>由于优化器替代表示为注释，因此必须将其包括在行尾。您可以为整个FROM子句，FROM子句中的表或为两者指定优化器替代属性。</p>

<p>FROM子句属性的语法如下：</p>

<pre><strong>FROM [ -- DERBY-PROPERTIES <a href="ctunoptimzoverride.html#ctunoptimzoverride__joinorder">joinOrder</a> = { FIXED | UNFIXED } ]
     <em>tableExpression</em> [,<em>tableExpression</em>]*</strong></pre>

<p>表优化器覆盖属性的语法必须包含在<em>tableExpression</em>的末尾，如下所示：</p>

<pre><strong>{<em>tableName</em> | <em>viewName</em> }
     [ [ AS ] <em>correlationName</em>
     [ (<em>simpleColumnName</em> [ , <em>simpleColumnName</em> ]* ) ] ]
     [ -- DERBY-PROPERTIES { <a href="ctunoptimzoverride.html#ctunoptimzoverride__constraint">constraint</a> = <em>constraintName</em> | <a href="ctunoptimzoverride.html#ctunoptimzoverride__index">index</a> = <em>indexName</em> | <a href="ctunoptimzoverride.html#ctunoptimzoverride__joinstrat">joinStrategy</a> = { NESTEDLOOP | HASH } } ]</strong></pre>

<p>之间的空间<samp class="codeph">--</samp>和<samp class="codeph">DERBY-PROPERTIES</samp>是可选的。</p>

<div class="p"><div class="important"><span class="importanttitle">重要提示：使用以下命令时，</span>请确保遵循正确的语法<samp class="codeph">--DERBY-PROPERTIES</samp>条款。否则可能导致解析器将其解释为注释并忽略它。若要验证解析器正确解释了覆盖，可以使用RunTimeStatistics。有关更多信息，请参见<a href="ctundepthoptover.html">优化器替代</a> 。</div>
</div>

<p>以下四个属性可用于<samp class="codeph">--DERBY-PROPERTIES</samp>条款：</p>

<dl>
<dt class="dlterm" id="ctunoptimzoverride__constraint"><a name="ctunoptimzoverride__constraint"><!-- --></a>约束</dt>

<dd>要强制使用强制执行主键，外键或唯一约束的索引，请使用<samp class="codeph">constraint</samp>属性，并指定约束的非限定名称。的<samp class="codeph">constraint</samp>属性只能在<em>tableExpression中使用</em> ，并且只能在基表上指定；它不能在视图或派生表上指定。</dd>


<dt class="dlterm" id="ctunoptimzoverride__index"><a name="ctunoptimzoverride__index"><!-- --></a>索引</dt>

<dd>的<samp class="codeph">index</samp>属性类似于<samp class="codeph">constraint</samp>属性。要强制使用特定索引，请指定不合格的索引名称。要强制进行表扫描，请为索引名称指定null。的<samp class="codeph">index</samp>属性只能在<em>tableExpression中使用</em> ，并且只能在基表上指定；它不能在视图或派生表上指定。</dd>


<dt class="dlterm" id="ctunoptimzoverride__joinorder"><a name="ctunoptimzoverride__joinorder"><!-- --></a> joinOrder</dt>

<dd>使用<samp class="codeph">joinOrder</samp>属性，以覆盖优化程序对两个表的连接顺序的选择。当指定值FIXED时，优化器将选择表的顺序，它们在FROM子句中显示为连接顺序。的有效值<samp class="codeph">joinOrder</samp>属性包括FIXED和UNFIXED。的<samp class="codeph">joinOrder</samp>该属性可以与FROM子句一起使用。</dd>


<dt class="dlterm" id="ctunoptimzoverride__joinstrat"><a name="ctunoptimzoverride__joinstrat"><!-- --></a>加入策略</dt>

<dd>使用<samp class="codeph">joinStrategy</samp>属性以覆盖优化程序对联接策略的选择。联接策略的两种类型称为<em>嵌套循环</em>和<em>哈希</em> 。在嵌套循环联接策略中，对于外部表中的每个合格行， <span>Derby</span>使用适当的访问路径（索引或表扫描）在内部表中查找匹配的行。在哈希联接策略中， <span>Derby</span>构造一个代表内部表的哈希表。对于外部表中的每个合格行， <span>Derby</span>会对哈希表进行快速查找以在内部表中找到匹配的行。
<span>Derby仅</span>需要扫描内部表或索引一次即可创建哈希表。的<samp class="codeph">--DERBY-PROPERTIES</samp>参数必须紧随内部表之后。
<p>通常，您将使用<samp class="codeph">joinStrategy</samp>属性仅与<samp class="codeph">joinOrder</samp>属性。在不知道连接顺序的情况下指定连接策略可能会导致性能不佳。</p>

<p>有效值包括HASH和NESTEDLOOP。的<samp class="codeph">joinStrategy</samp>属性只能在<em>tableExpression中使用</em> 。</p>
</dd>

</dl>

<div class="p">以下示例说明了<samp class="codeph">--DERBY-PROPERTIES</samp>条款：<dl>

<dt class="dlterm">约束</dt>

<dd><pre><strong>CREATE TABLE t1 (c1 int, c2 int, c3 int, CONSTRAINT cons1 PRIMARY KEY (c1, c2))
INSERT INTO t1 VALUES (1, 1, 1), (2, 2, 2), (3, 3, 3), (4, 4, 4)
SELECT * FROM t1 --DERBY-PROPERTIES constraint=cons1
FOR UPDATE</strong></pre>
</dd>


<dt class="dlterm">指数</dt>

<dd><pre><strong>CREATE TABLE t1 (c1 int, c2 int, c3 int, CONSTRAINT cons1 PRIMARY KEY (c1, c2))
INSERT INTO t1 VALUES (1, 1, 1), (2, 2, 2), (3, 3, 3), (4, 4, 4)
CREATE INDEX t1_c1 ON t1(c1)
SELECT * FROM t1 --DERBY-PROPERTIES index=t1_c1
WHERE c1=1</strong></pre>
</dd>


<dt class="dlterm">joinOrder</dt>

<dd><pre><strong>CREATE TABLE t1 (c1 int, c2 int, c3 int, CONSTRAINT cons1 PRIMARY KEY (c1, c2))
CREATE TABLE t2 (c1 int not null, c2 int not null, c3 int, CONSTRAINT cons2 UNIQUE (c1, c2))
INSERT INTO t1 VALUES (1, 1, 1), (2, 2, 2), (3, 3, 3), (4, 4, 4)
INSERT INTO t2 VALUES (1, 1, 1), (2, 2, 2), (3, 3, 3), (4, 4, 4)
SELECT * FROM --DERBY-PROPERTIES joinOrder=FIXED
t1, t2
WHERE t1.c1=t2.c1</strong></pre>
</dd>


<dt class="dlterm">加入策略</dt>

<dd><pre><strong>CREATE TABLE t1 (c1 int, c2 int, c3 int, CONSTRAINT cons1 PRIMARY KEY (c1, c2))
CREATE TABLE t2 (c1 int not null, c2 int not null, c3 int, CONSTRAINT cons2 UNIQUE (c1, c2))
INSERT INTO t1 VALUES (1, 1, 1), (2, 2, 2), (3, 3, 3), (4, 4, 4)
INSERT INTO t2 VALUES (1, 1, 1), (2, 2, 2), (3, 3, 3), (4, 4, 4)
SELECT * FROM --DERBY-PROPERTIES joinOrder=FIXED 
t1 a, t1 b --DERBY-PROPERTIES joinStrategy=NESTEDLOOP
WHERE a.c1=b.c1</strong></pre>
</dd>

</dl>
</div>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="ctunoptimz39739.html" title="本节提供有关Derby如何执行查询，优化器如何工作以及如何调整查询执行的更深入的信息。">DML语句和性能</a></div>
</div>
<div class="relconcepts"><strong>相关概念</strong><br>
<div><a href="ctunoptimz23977.html" title="优化意味着DBMS可以对访问路径，连接顺序和连接策略做出最佳（最佳）选择。">性能与优化</a></div>
<div><a href="ctunoptimz27975.html" title="行级锁定提高了多用户系统中的并发性。但是，大量的行锁会降低性能。">锁定和性能</a></div>
<div><a href="ctunoptimz860097.html" title="优化器进行一些非基于成本的优化，这意味着在确定访问路径和连接顺序时不会考虑它们。">非基于成本的优化</a></div>
</div>
</div>



</body></html>