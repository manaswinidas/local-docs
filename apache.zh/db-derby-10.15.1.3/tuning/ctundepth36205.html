<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Prevent the user from issuing expensive queries">
<meta name="abstract" content="Some applications have complete control over the queries that they issue; the queries are built into the applications. Other applications allow users to construct queries by filling in fields on a form.">
<meta name="description" content="Some applications have complete control over the queries that they issue; the queries are built into the applications. Other applications allow users to construct queries by filling in fields on a form.">
<meta name="DC.subject" content="Expensive queries, importance of avoiding, how to avoid">
<meta name="keywords" content="Expensive queries, importance of avoiding, how to avoid">
<meta name="DC.Relation" scheme="URI" content="ctundepth10525.html">
<meta name="DC.Relation" scheme="URI" content="ctundepth23033.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="ctundepth36205">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>防止用户发出昂贵的查询</title>
</head>
<body id="ctundepth36205" ><a name="ctundepth36205"><!-- --></a>


<h1 class="topictitle1">防止用户发出昂贵的查询</h1>



<div><p>某些应用程序可以完全控制它们发出的查询。查询将内置到应用程序中。其他应用程序允许用户通过填写表单上的字段来构造查询。</p>

<p>每当您让用户构造临时查询时，您就冒着用户构造查询的可能性，如下所示：</p>

<pre><strong>SELECT * FROM ExtremelyHugeTable
ORDER BY unIndexedColumn</strong></pre>

<p>该语句没有WHERE子句。它将需要全表扫描。更糟的是， <span>Derby</span>将不得不订购数据。用户很可能不想浏览所有100,000行，并且不关心行是否全部按顺序排列。</p>

<p>尽一切可能避免表格扫描和对大型结果进行排序（例如表格扫描）。</p>

<p>您可以执行以下操作来防止此类失控的查询：</p>
 
<ul>
<li>使用客户端检查来确保始终填写一些最小字段。消除或禁止无法使用索引并且无法优化的查询。换句话说，通过确保查询的WHERE子句中包含建立索引的列来强制使用可优化的WHERE子句。在大表上减少或禁止使用DISTINCT子句（通常需要排序）。</li>

<li>对于结果较大的查询，请勿让数据库进行排序。检索数据块（如果需要，提供“下一步”按钮以允许用户检索下一个数据块），并在应用程序中对数据进行排序。</li>

<li>不要使用SELECT DISTINCT来填充列表。而是维护一个单独的表，其中包含唯一项。</li>

</ul>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="ctundepth10525.html" title="Derby是快速而高效的，但是当表很大时，扫描表所花费的时间可能比用户期望的要长。如果您随后要求Derby对数据进行排序，那就更糟了。">避免对大表进行表扫描</a></div>
</div>
<div class="relconcepts"><strong>相关概念</strong><br>
<div><a href="ctundepth23033.html" title="有用的索引使Derby不必读取整个表来检索所需的数据。">一律建立索引</a></div>
</div>
</div>



</body></html>