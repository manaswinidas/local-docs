<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Cost-based ORDER BY sort avoidance">
<meta name="abstract" content="Usually, sorting requires an extra step to put the data into the right order. This extra step can be avoided for data that are already in the right order.">
<meta name="description" content="Usually, sorting requires an extra step to put the data into the right order. This extra step can be avoided for data that are already in the right order.">
<meta name="DC.subject" content="ORDER BY, cost-based avoidance of">
<meta name="keywords" content="ORDER BY, cost-based avoidance of">
<meta name="DC.Relation" scheme="URI" content="ctunoptimz27036.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="ctunoptimz56859">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>基于成本的ORDER BY排序避免</title>
</head>
<body id="ctunoptimz56859" ><a name="ctunoptimz56859"><!-- --></a>


<h1 class="topictitle1">基于成本的ORDER BY排序避免</h1>



<div><p>通常，排序需要一个额外的步骤才能将数据放入正确的顺序。对于已经按正确顺序排列的数据，可以避免执行此额外步骤。</p>

<p>例如，如果单表查询在单列上有一个ORDER BY，并且在该列上有一个索引，则如果<span>Derby</span>使用索引作为访问路径，则可以避免排序。</p>

<p>在可能的情况下， <span>Derby</span>的查询编译器会在内部将一条SQL语句转换为一条避免执行此额外步骤的语句。有关内部转换的信息，请参见<a href="ctuntransform16033.html">避免排序</a> 。这种转换（如果发生）发生在优化之前。完成任何此类转换后，优化器可以通过选择已排序的访问路径来帮助避免单独的排序步骤。它将使用该路径的成本与排序的成本进行了比较。在以下情况下， <span>Derby</span>会对使用ORDER BY子句的语句执行此操作：</p>

<ul>
<li>语句包含索引顺序正确的表。</li>

<li>该语句涉及唯一索引的扫描，保证每次扫描仅返回一行。</li>

</ul>

<p>ORDER BY指定结果集中列排序的优先级。例如， <samp class="codeph">ORDER BY X, Y</samp>表示该列<samp class="codeph">X</samp>具有比列更重要的排序<samp class="codeph">Y</samp> 。</p>

<p>使<span>Derby</span>避免为带有ORDER BY子句的语句避免单独的排序步骤的情况是：</p>

<ul>
<li>索引扫描，提供正确的顺序。
<pre><strong><span>-- covering index</span>
SELECT flight_id FROM Flights ORDER BY flight_id</strong></pre>
</li>

<li>通过索引扫描获取表中的行。
<pre><strong><span>-- if <span>Derby</span>  uses the index on orig_airport
-- to access the data, it can avoid the sort
-- required by the final ORDER BY</span>
SELECT orig_airport, miles
FROM FLIGHTS
WHERE orig_airport &lt; 'DDD'
ORDER BY orig_airport</strong></pre>
</li>

<li>按外部表中的一个或多个索引列排序的联接中的行。
<pre><strong><span>-- if <span>Derby</span> chooses Cities as the outer table, it
-- can avoid a separate sorting step</span>
SELECT * FROM cities, countries
WHERE cities.country_ISO_code = countries.country_ISO_code
AND cities.country_ISO_code &lt; 'DD'
ORDER BY cities.country_ISO_code</strong></pre>
</li>

<li>保证返回单行的结果集。它们在其<em>所有</em>列上都是有序的（例如，如果唯一索引中的所有列都具有相等条件，则可以将该表返回的所有列都视为有序的，并且具有列排序的优先级）。
<pre><strong><span>-- query will only return one row, so that row is
-- "in order" for ANY column</span>
SELECT miles
FROM Flights
WHERE flight_id = 'US1381' AND segment_number = 2
ORDER BY miles</strong></pre>
</li>

<li>结果集中的任何与常量进行相等比较的列。该列被认为是已排序的，其优先级不高。
<pre><strong><span>-- The comparison of segment_number
-- to a constant means that it is always correctly
-- ordered. Using the index on (flight_id, segment_number)
-- as the access path means
-- that the ordering will be correct for the ORDER BY
-- clause in this query. The same thing would be true if
-- flight_id were compared to a constant instead.</span>
SELECT segment_number, flight_id
FROM Flights
WHERE segment_number=2
ORDER BY segment_number, flight_id</strong></pre>

<p>而且由于传递闭包，这意味着即使是更复杂的语句也可以避免排序。例如：</p>

<pre><strong><span>-- transitive closure means that <span>Derby</span> will
-- add this clause:
-- AND countries.country_ISO_code = 'CL', which means
-- that the ordering column is now compared to a constant,
-- and sorting can be avoided.</span>
SELECT * FROM cities, countries
WHERE cities.country_ISO_code = 'CL'
AND cities.country_ISO_code = countries.country_ISO_code
ORDER BY countries.country_ISO_code</strong></pre>

<p>有关传递闭包和其他语句转换的更多信息，请参见<a href="ctuntransform13966.html">内部语言转换</a> 。</p>
</li>

</ul>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="ctunoptimz27036.html" title="一些SQL语句要求对数据进行排序，包括那些使用ORDER BY，GROUP BY和DISTINCT的数据。 MIN（）和MAX（）聚合也需要对数据进行排序。">关于优化器选择避免排序</a></div>
</div>
</div>



</body></html>