<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="DISTINCT elimination based on a uniqueness condition">
<meta name="abstract" content="A DISTINCT (and the corresponding sort) can be eliminated from a query if a uniqueness condition exists that ensures that no duplicate values will be returned.">
<meta name="description" content="A DISTINCT (and the corresponding sort) can be eliminated from a query if a uniqueness condition exists that ensures that no duplicate values will be returned.">
<meta name="DC.subject" content="DISTINCT, eliminated for uniqueness condition">
<meta name="keywords" content="DISTINCT, eliminated for uniqueness condition">
<meta name="DC.Relation" scheme="URI" content="ctuntransform16033.html">
<meta name="DC.Relation" scheme="URI" content="ctuntransform21780.html">
<meta name="DC.Relation" scheme="URI" content="ctuntransform14044.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="ctuntransform16279">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>基于唯一性条件的DISTINCT消除</title>
</head>
<body id="ctuntransform16279" ><a name="ctuntransform16279"><!-- --></a>


<h1 class="topictitle1">基于唯一性条件的DISTINCT消除</h1>



<div><p>如果存在唯一性条件（可确保不返回任何重复值），则可以从查询中消除DISTINCT（和相应的排序）。</p>

<p>如果没有返回重复的值，则DISTINCT节点是多余的，并且<span>Derby</span>将语句内部转换为不带DISTINCT关键字的语句。</p>

<p>要求如下：</p>

<ul>
<li>没有GROUP BY列表。</li>

<li>SELECT列表至少包含一个<a href="ctuntransform13966.html#ctuntransform13966__rtuntransform13785">简单的列引用</a> 。</li>

<li>每个简单的列引用都来自同一张表。</li>

<li>FROM列表中的每个表都是<a href="ctuntransform13966.html#ctuntransform13966__rtuntransform41494">基表</a> 。</li>

<li id="ctuntransform16279__rtuntransform29680"><a name="ctuntransform16279__rtuntransform29680"><!-- --></a> <em>主表</em>
<p>在FROM列表中的一个表上至少有一个唯一索引， <em>所有</em>列<em>均以</em>下列之一出现：</p>

<ul>
<li>具有不包含任何列引用的表达式的<a href="ctuntransform13966.html#ctuntransform13966__rtuntransform24389">相等谓词</a></li>

<li>SELECT列表中的简单列引用</li>

</ul>
</li>

<li id="ctuntransform16279__rtuntransform16930"><a name="ctuntransform16279__rtuntransform16930"><!-- --></a> <em>辅助表</em>
<p>FROM列表中的所有其他表也至少具有一个唯一索引，其所有列均以下列之一出现：</p>

<ul>
<li>等于谓词的表达式不包含同一表中的列</li>

<li>SELECT列表中的简单列引用</li>

</ul>
</li>

</ul>

<p>例如：</p>

<pre><strong>CREATE TABLE tab1 (c1 INT NOT NULL, 
    c2 INT NOT NULL, 
    c3 INT NOT NULL, 
    c4 CHAR(2), 
    PRIMARY KEY (c1, c2, c3))
CREATE TABLE tab2 (c1 INT NOT NULL,  
    c2 INT NOT NULL, 
    PRIMARY KEY (c1, c2))
INSERT INTO tab1 VALUES (1, 2, 3, 'WA'), 
    (1, 2, 5, 'WA'), 
    (1, 2, 4, 'CA'), 
    (1, 3, 5, 'CA'), 
    (2, 3, 1, 'CA')
INSERT INTO tab2 VALUES (1, 2), 
    (1, 3), 
    (2, 2), 
    (2, 3)
-- all the columns in the index on the only table (tab1) appear
-- in the way required for the <a href="ctuntransform16279.html#ctuntransform16279__rtuntransform29680">Primary table</a> (simple column references)
SELECT DISTINCT c1, c2, c3, c4
FROM tab1
-- all the columns in the index on the only table (tab1) appear
-- in the way required for the <a href="ctuntransform16279.html#ctuntransform16279__rtuntransform29680">Primary table</a> (equality predicates)
SELECT DISTINCT c3, c4
FROM tab1
WHERE c1 = 1
AND c2 = 2
AND c4 = 'WA'
-- all the columns in the index on tab1 appear
-- in the way required for the <a href="ctuntransform16279.html#ctuntransform16279__rtuntransform29680">Primary table</a>,
-- and all the columns in the
-- other tables appear in the way required
-- for a <a href="ctuntransform16279.html#ctuntransform16279__rtuntransform16930">Secondary table</a>
SELECT DISTINCT tab1.c1, tab1.c3, tab1.c4
FROM tab1, tab2
WHERE tab1.c2 = 2
AND tab2.c2 = tab1.c2
AND tab2.c1 = tab1.c1</strong></pre>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="ctuntransform16033.html" title="排序是一个昂贵的过程。Derby尝试在可能的情况下消除不必要的排序步骤。">避免排序</a></div>
</div>
<div class="relconcepts"><strong>相关概念</strong><br>
<div><a href="ctuntransform21780.html" title="如果不进行转换，则同时包含DISTINCT和ORDER BY的语句将需要两个单独的排序步骤-一个满足DISTINCT，一个满足ORDER BY。 （当前，Derby使用排序来评估DISTINCT。从理论上讲，还有其他方法可以完成此操作。）">结合ORDER BY和DISTINCT</a></div>
<div><a href="ctuntransform14044.html" title="如果不进行转换，则同时包含ORDER BY和UNION的语句将需要两个单独的排序步骤-一个满足ORDER BY，一个满足UNION。">结合ORDER BY和UNION</a></div>
</div>
</div>



</body></html>