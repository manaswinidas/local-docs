<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Materialization">
<meta name="abstract" content="Materialization means that a subquery is evaluated only once. Several types of subqueries can be materialized.">
<meta name="description" content="Materialization means that a subquery is evaluated only once. Several types of subqueries can be materialized.">
<meta name="DC.subject" content="subqueries, materialization">
<meta name="keywords" content="subqueries, materialization">
<meta name="DC.Relation" scheme="URI" content="ctuntransform13699.html">
<meta name="DC.Relation" scheme="URI" content="ctuntransform36368.html">
<meta name="DC.Relation" scheme="URI" content="ctuntransform25868.html">
<meta name="DC.Relation" scheme="URI" content="ctuntransform47182.html">
<meta name="DC.Relation" scheme="URI" content="ctuntransform867165.html">
<meta name="DC.Relation" scheme="URI" content="ctuntransform867201.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="ctuntransform25857">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>物化</title>
</head>
<body id="ctuntransform25857" ><a name="ctuntransform25857"><!-- --></a>


<h1 class="topictitle1">物化</h1>



<div><p><dfn class="term">实现</dfn>意味着子查询仅评估一次。可以实现几种类型的子查询。</p>

<div class="section"><h2 class="sectiontitle">不相关的表达式子查询</h2>
<p>如果子查询是不相关的表达式子查询，则可以实现。相关子查询是引用外部查询中的列的子查询，因此必须为外部查询中的每一行进行评估。</p>

<p>例如：</p>

<pre><strong>SELECT * FROM Staff
WHERE id = (SELECT MAX(manager) FROM Org)</strong></pre>

<p>在此语句中，子查询仅需要评估一次。</p>

<p>这种类型的子查询必须仅返回一行。如果评估子查询导致基数冲突（如果返回多个行），则在运行子查询时将引发异常。</p>

<p>在优化之前检测到子查询的实现，这使<span>Derby</span>优化器可以将实现的子查询视为未知的常量值。因此，比较是可优化的。</p>

<p>原始语句转换为以下两个语句：</p>

<pre><strong><em>constant</em> = SELECT MAX(manager) FROM Org
SELECT * FROM Staff
WHERE id = <em>constant</em></strong></pre>

<p>第二个陈述是可乐观的。</p>

</div>

<div class="section"><h2 class="sectiontitle">无法展平的子查询</h2>
<p>当子查询不可展平并且子查询与查询中的另一个FROM表之间存在等价联接时，也会发生子查询的实现。</p>

<p>例如：</p>

<pre><strong>SELECT i, a FROM t1, 
   (SELECT DISTINCT a FROM T2) x1  
WHERE t1.i = x1.a AND t1.i in (1, 3, 5, 7)</strong></pre>

<p>在此示例中，子查询<samp class="codeph">x1</samp>是不相关的，因为它没有引用外部查询中的任何列。子查询由于DISTINCT关键字而无法扩展。
<span>Derby</span>不会展平DISTINCT子查询。该子查询可以实现。由于子查询之间存在<a href="ctuntransform13966.html#ctuntransform13966__rtuntransform36163">等分谓词</a> <samp class="codeph">x1</samp>和桌子<samp class="codeph">t1</samp> （即， <samp class="codeph">t1.i = x1.a</samp> ）， <span>Derby</span>优化器将考虑在<samp class="codeph">t1</samp>和<samp class="codeph">x1</samp> （与<samp class="codeph">x1</samp>作为内部操作数）。如果该方法产生了最佳成本，则<span>Derby</span>实现子查询<samp class="codeph">x1</samp>执行哈希联接。子查询只评估一次，结果存储在内存中的哈希表中。
然后， <span>Derby</span>使用内存结果集执行联接<samp class="codeph">x1</samp> 。</p>

</div>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="ctuntransform13699.html" title="众所周知，子查询的评估成本很高。本节描述了Derby内部进行的一些转换，以减少评估它们的成本。">子查询处理和转换</a></div>
</div>
<div class="relconcepts"><strong>相关概念</strong><br>
<div><a href="ctuntransform36368.html" title="与IN，EXISTS和ANY一起使用时，允许子查询返回多行。但是，对于外部行中返回的每一行，Derby都会评估子查询，直到它返回一行；它不会评估返回的所有行的子查询。">将子查询展平为普通联接</a></div>
<div><a href="ctuntransform25868.html" title="EXISTS联接是其中联接的右侧仅需要为每个外部行探测一次的联接。">将子查询展平为EXISTS联接</a></div>
<div><a href="ctuntransform47182.html" title="Derby展平VALUES子查询以提高性能。">展平VALUES子查询</a></div>
<div><a href="ctuntransform867165.html" title="如果至少有一行导致子查询的结果为true，则IN，ANY或EXISTS子查询的结果为true。这些语义使得在IN，ANY或EXISTS子查询中不需要DISTINCT。">在IN，ANY和EXISTS子查询中进行DISTINCT消除</a></div>
<div><a href="ctuntransform867201.html" title="可以保证最多返回一行的IN或ANY子查询可以转换为等效表达式子查询（不带IN或ANY的标量子查询）。子查询必须不相关。">IN / ANY子查询转换</a></div>
</div>
</div>



</body></html>