<html lang="en-us"  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us"><!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--><head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="copyright" content="(C) Copyright 2005">
<meta name="DC.rights.owner" content="(C) Copyright 2005">
<meta name="security" content="public">
<meta name="Robots" content="index,follow">
<meta http-equiv="PICS-Label" content="(PICS-1.1 " http:="" ="" www.icra.org="" ratingsv02.htm="=" www.rsac.org="" ratingsv01.htm="=" (ss~~000="" 1)="=">
<meta name="DC.Type" content="concept">
<meta name="DC.Title" content="Using the statement cache">
<meta name="abstract" content="The statement cache is enabled by default. You can use it to avoid extra compilation overhead.">
<meta name="description" content="The statement cache is enabled by default. You can use it to avoid extra compilation overhead.">
<meta name="DC.subject" content="Compilation, avoiding by using PreparedStatements, Prepared statements, performance benefits of, Statement cache">
<meta name="keywords" content="Compilation, avoiding by using PreparedStatements, Prepared statements, performance benefits of, Statement cache">
<meta name="DC.Relation" scheme="URI" content="ctundepth29804.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="ctundepth32379">
<meta name="DC.Language" content="en-us">
<link href="commonltr.css" type="text/css" rel="stylesheet">
<title>使用语句缓存</title>
</head>
<body id="ctundepth32379" ><a name="ctundepth32379"><!-- --></a>


<h1 class="topictitle1">使用语句缓存</h1>



<div><p>默认情况下，语句高速缓存处于启用状态。您可以使用它来避免额外的编译开销。</p>

<ul>
<li>您的应用程序可以使用<em>PreparedStatements</em>而不是<em>Statements</em> 。
<p><em>PreparedStatement</em>是您准备（编译）一次并执行多次的JDBC对象。参见下图。如果您的应用程序执行几乎但不完全相同的语句，请使用<em>PreparedStatements</em> ，其中可以包含动态或IN参数。不要使用文字来更改参数，而应使用问号（ <samp class="codeph">?</samp> ）作为此类参数的占位符。执行语句时提供值。</p>

<p><span>Derby</span>支持<em>ParameterMetaData</em>接口。该接口描述了准备好的语句参数的数量，类型和属性。有关更多信息，请参见《 <span><em>Derby开发人员指南》</em></span> 。</p>

<p>连接只需编译一次<em>PreparedStatement</em> 。即使参数值不同，后续执行也可以使用相同的语句执行计划，如下图所示。（ <em>PreparedStatement</em>不在连接之间共享。）</p>

<div class="fignone" id="ctundepth32379__ctundepth42475"><a name="ctundepth32379__ctundepth42475"><!-- --></a> <span class="figcap">图1。准备好的语句和语句缓存</span>
<br><img src="pstmt_os.gif" alt="此图显示了通过单个连接对同一PreparedStatement的多次执行。单个PreparedStatement对象使用相同的语句执行计划和语句缓存。"><br>
</div>
</li>

<li>即使您的语句使用<em>Statements</em>而不是<em>PreparedStatements</em> ， <span>Derby</span>也可以为语句高速缓存中的语句重用语句执行计划。通过使用单语句缓存，来自任何连接的语句都可以共享相同的语句执行计划，从而避免了编译。语句缓存维护跨连接的语句计划。但是，它不会在重新启动后对其进行维护。参见下图。
<p>当应用程序在同一数据库中提交与缓存中已有的SQL <em>语句</em>完全匹配的SQL <em>语句时</em> ，即使该<em>语句</em>已被应用程序关闭， <span>Derby</span>也会从缓存中获取该<em>语句</em> 。</p>

<p>为了与高速缓存中已存在的语句完全匹配，SQL <em>语句</em>必须满足以下要求：</p>

<ul>
<li>文字必须完全匹配</li>

<li>当前架构必须匹配</li>

<li>语句在其下编译的Unicode标志必须与当前连接的标志匹配</li>

</ul>
</li>

</ul>

<div class="p"><div class="remember"><span class="remembertitle">请记住：</span>如果您的应用程序执行几乎但不完全相同的语句，则使用带有动态或IN参数的<em>PreparedStatements</em>效率更高。</div>
</div>

<p>下图显示了当SQL文本与先前的语句<em>完全</em>匹配时， <span>Derby</span>如何重用已经在语句高速缓存中的语句执行计划，即使该语句是从其他连接执行的。<em>但是，PreparedStatement</em>效率更高。</p>

<div class="fignone" id="ctundepth32379__ctundepth12523"><a name="ctundepth32379__ctundepth12523"><!-- --></a> <span class="figcap">图1。语句和语句缓存</span>
<br><img src="stmt_os.gif" alt="该图显示了Derby如何重用已经在语句高速缓存中的语句执行计划，即使从另一个连接执行了该语句也是如此。该图显示了在两个不同的数据库连接上两个相似的语句的三个执行。每个数据库连接都有其自己的语句缓存。一种说法是" id="?"." select="" *="" from="" mytable="" where="" the="" other="" statement="" is="" =""><br>
</div>

<p><em>derby.language.statementCacheSize</em>属性控制<span>Derby</span>保留在其语句高速缓存中的预编译语句的数量。如果语句准备花费太多时间，请考虑增加此数字。有关此属性的更多信息，请参见《 <span><em>Derby参考手册</em></span> 》。</p>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="ctundepth29804.html" title="当您向Derby提交SQL语句时，Derby会编译并执行该语句。编译是一个耗时的过程，涉及多个步骤，包括优化（Derby制定语句执行计划的阶段）。语句执行计划包括是否使用索引，连接顺序等。">避免编译SQL语句</a></div>
</div>
</div>



</body></html>