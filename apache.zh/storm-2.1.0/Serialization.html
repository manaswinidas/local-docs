<html ><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <title>序列化</title>

    <!-- Bootstrap core CSS -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="/assets/css/bootstrap-theme.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link rel="stylesheet" href="asset?aid=7">
    <link href="/css/style.css" rel="stylesheet">
    <link href="/assets/css/owl.theme.css" rel="stylesheet">
    <link href="/assets/css/owl.carousel.css" rel="stylesheet">
    <script type="text/javascript" src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/js/owl.carousel.min.js"></script>
    <script type="text/javascript" src="/assets/js/storm.js"></script>
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>


  <body >
    <header>
  <div class="container-fluid">
     <div class="row">
          <div class="col-md-5">
            <a href="/index.html"><img src="/images/logo.png" class="logo"></a>
          </div>
          <div class="col-md-5">
            
              <h1>版本：2.1.0</h1>
            
          </div>
          <div class="col-md-2">
            <a href="/downloads.html" class="btn-std btn-block btn-download">下载</a>
          </div>
        </div>
    </div>
</header>
<!--Header End-->
<!--Navigation Begin-->
<div class="navbar" role="banner">
  <div class="container-fluid">
      <div class="navbar-header">
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse"></button>
        </div>
        <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
          <ul class="nav navbar-nav">
              <li><a href="/index.html" id="home">家</a></li>
                <li><a href="/getting-help.html" id="getting-help">获得帮助</a></li>
                <li><a href="/about/integrates.html" id="project-info">项目信息</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" id="documentation" data-toggle="dropdown">文献资料<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                      
                        
                          <li><a href="/releases/2.1.0/index.html">2.1.0</a></li>
                        
                      
                        
                          <li><a href="/releases/2.0.0/index.html">2.0.0</a></li>
                        
                      
                        
                          <li><a href="/releases/1.2.3/index.html">1.2.3</a></li>
                        
                      
                    </ul>
                </li>
                <li><a href="/talksAndVideos.html">讲座和幻灯片</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" id="contribute" data-toggle="dropdown">社区<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="/contribute/Contributing-to-Storm.html">贡献</a></li>
                        <li><a href="/contribute/People.html">人</a></li>
                        <li><a href="/contribute/BYLAWS.html">按照法律规定</a></li>
                    </ul>
                </li>
                <li><a href="/2019/10/31/storm210-released.html" id="news">新闻</a></li>
            </ul>
        </nav>
    </div>
</div>



    <div class="container-fluid">
    <h1 class="page-title">序列化</h1>
          <div class="row">
           	<div class="col-md-12">
	             <!-- Documentation -->

<p class="post-meta"></p>

<div class="documentation-content"><p>此页面介绍了Storm在0.6.0及更高版本中的序列化系统的工作方式。Storm在0.6.0之前使用了不同的序列化系统，该<a href="Serialization-(prior-to-0.6.0).html">序列化</a>已在<a href="Serialization-(prior-to-0.6.0).html">序列化中记录（0.6.0之前）</a> 。</p>

<p>元组可以由任何类型的对象组成。由于Storm是一个分布式系统，因此当任务之间传递对象时，它需要知道如何序列化和反序列化对象。</p>

<p>Storm使用<a href="https://github.com/EsotericSoftware/kryo">Kryo</a>进行序列化。Kryo是一个灵活且快速的序列化库，可产生小的序列化。</p>

<p>默认情况下，Storm可以序列化基本类型，字符串，字节数组，ArrayList，HashMap和HashSet。如果要在元组中使用其他类型，则需要注册一个自定义序列化器。</p>

<h3 id="dynamic-typing">动态打字</h3>

<p>元组中没有字段的类型声明。您将对象放在字段中，Storm会动态计算出序列化。在进入序列化接口之前，让我们花点时间来理解为什么Storm的元组是动态类型的。</p>

<p>将静态类型添加到元组字段将为Storm的API增加大量复杂性。例如，Hadoop静态地键入其键和值，但用户方面需要大量注释。Hadoop的API使用负担重，“类型安全”是不值得的。动态类型简单易用。</p>

<p>除此之外，不可能以任何合理的方式静态地键入Storm的元组。假设一个Bolt订阅了多个流。所有这些流中的元组在字段之间可能具有不同的类型。当螺栓收到<code>Tuple</code>在<code>execute</code> ，该元组可能来自任何流，因此可以具有任何类型的组合。对于螺栓所订阅的每个元组流，可能有一些反射魔术可以声明一个不同的方法，但是Storm选择了更简单，直接的动态类型化方法。</p>

<p>最后，使用动态类型的另一个原因是，可以从Clojure和JRuby之类的动态类型语言中直接使用Storm。</p>

<h3 id="custom-serialization">自定义序列化</h3>

<p>如前所述，Storm使用Kryo进行序列化。要实现自定义序列化程序，您需要在Kryo中注册新的序列化程序。强烈建议您阅读<a href="https://github.com/EsotericSoftware/kryo">Kryo的主页，</a>以了解其如何处理自定义序列化。</p>

<p>通过自定义拓扑配置中的“ topology.kryo.register”属性或通过稍后描述的ServiceLoader，可以添加自定义序列化程序。该配置采用注册列表，其中每个注册可以采用以下两种形式之一：</p>

<ol>
<li>要注册的类的名称。在这种情况下，Storm将使用Kryo的<code>FieldsSerializer</code>序列化类。这对于该课程可能不是最佳选择-有关更多详细信息，请参见Kryo文档。</li>
<li>从要注册的类名称到<a href="https://github.com/EsotericSoftware/kryo/blob/master/src/com/esotericsoftware/kryo/Serializer.java">com.esotericsoftware.kryo实现的</a><a href="https://github.com/EsotericSoftware/kryo/blob/master/src/com/esotericsoftware/kryo/Serializer.java">映射。序列化器</a> 。</li>
</ol>

<p>让我们看一个例子。</p>
<div class="highlight"><pre><code class="language-" data-lang="">topology.kryo.register:
  - com.mycompany.CustomType1
  - com.mycompany.CustomType2: com.mycompany.serializer.CustomType2Serializer
  - com.mycompany.CustomType3
</code></pre></div>
<p><code>com.mycompany.CustomType1</code>和<code>com.mycompany.CustomType3</code>将使用<code>FieldsSerializer</code> ，而<code>com.mycompany.CustomType2</code>将使用<code>com.mycompany.serializer.CustomType2Serializer</code>用于序列化。</p>

<p>Storm提供了用于在拓扑配置中注册序列化程序的助手。<a href="javadocs/org/apache/storm/Config.html">Config</a>类有一个称为<code>registerSerialization</code>需要注册才能添加到配置中。</p>

<p>有一个高级配置称为<code>Config.TOPOLOGY_SKIP_MISSING_KRYO_REGISTRATIONS</code> 。如果将其设置为true，Storm将忽略所有已注册但在类路径中没有可用代码的序列化。否则，Storm在找不到序列号时将引发错误。如果您在一个群集上运行许多拓扑，并且每个拓扑都有不同的序列化，但是您想在该拓扑中的所有拓扑之间声明所有序列化，这将很有用。 <code>storm.yaml</code>文件。</p>

<h4 id="serializationregister-service-loader">序列化注册服务加载程序</h4>

<p>如果您想提供风暴的语言绑定，拥有一个想要与风暴进行干净交互的库，或者有其他原因提供序列化绑定，并且不想强迫用户更新其配置，则可以使用org.apache风暴序列化。序列化注册服务加载器。</p>

<p>您可以像使用其他任何服务加载程序一样使用此命令，并且storm将注册绑定而不会强迫用户更新其配置。Storm-clojure软件包使用此软件包为clojure类型提供透明支持。</p>

<h3 id="java-serialization">Java序列化</h3>

<p>如果Storm遇到未注册序列化的类型，则将在可能的情况下使用Java序列化。如果无法使用Java序列化对对象进行序列化，那么Storm将引发错误。</p>

<p>当心Java序列化在CPU成本以及序列化对象的大小方面都非常昂贵。强烈建议您在将拓扑投入生产时注册自定义序列化程序。Java序列化行为在那里，因此可以很容易地对新拓扑进行原型设计。</p>

<p>您可以通过设置以下选项来关闭行为以依赖Java序列化<code>Config.TOPOLOGY_FALL_BACK_ON_JAVA_SERIALIZATION</code>配置为false。</p>

<h3 id="component-specific-serialization-registrations">特定于组件的序列化注册</h3>

<p>Storm 0.7.0允许您设置特定于组件的配置（有关更多信息，请参见<a href="Configuration.html">Configuration</a> ）。当然，如果一个组件定义了序列化，则该序列化将需要其他螺栓使用-否则它们将无法从该组件接收消息！</p>

<p>提交拓扑后，将选择一组序列化以供拓扑中的所有组件用于发送消息。这是通过将特定于组件的序列化程序注册与常规的序列化注册集合并来完成的。如果两个组件为同一类定义了串行器，则可以任意选择一个串行器。</p>

<p>如果两个特定于组件的注册之间存在冲突，则要为特定类强制使用序列化器，只需定义要在拓扑特定的配置中使用的序列化器即可。对于序列化注册，特定于拓扑的配置优先于特定于组件的配置。</p>
</div>


	          </div>
	       </div>
	  </div>
<footer>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>聚会</h5>
                    <ul class="latest-news">
                        
                        <li><a href="http://www.meetup.com/Apache-Storm-Apache-Kafka/">Apache Storm和Apache Kafka</a> <span class="small">（加利福尼亚州桑尼维尔）</span></li>
                        
                        <li><a href="http://www.meetup.com/Apache-Storm-Kafka-Users/">Apache Storm和Kafka用户</a> <span class="small">（华盛顿州西雅图）</span></li>
                        
                        <li><a href="http://www.meetup.com/New-York-City-Storm-User-Group/">NYC Storm用户组</a> <span class="small">（纽约州纽约）</span></li>
                        
                        <li><a href="http://www.meetup.com/Bay-Area-Stream-Processing">湾区流处理</a> <span class="small">（加利福尼亚州埃默里维尔）</span></li>
                        
                        <li><a href="http://www.meetup.com/Boston-Storm-Users/">波士顿实时数据</a> <span class="small">（马萨诸塞州波士顿）</span></li>
                        
                        <li><a href="http://www.meetup.com/storm-london">伦敦风暴用户组</a> <span class="small">（英国伦敦）</span></li>
                        
                        <!-- <li><a href="http://www.meetup.com/Apache-Storm-Kafka-Users/">Seatle, WA</a> <span class="small">(27 Jun 2015)</span></li> -->
                    </ul>
                </div>
            </div>
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>关于Apache Storm</h5>
                    <p>Apache Storm与任何排队系统和任何数据库系统集成。Apache Storm的喷口抽象使集成新排队系统变得容易。同样，将Apache Storm与数据库系统集成很容易。</p>
               </div>
            </div>
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>第一眼</h5>
                    <ul class="footer-list">
                        <li><a href="/releases/current/Rationale.html">基本原理</a></li>
                        <li><a href="/releases/current/Tutorial.html">讲解</a></li>
                        <li><a href="/releases/current/Setting-up-development-environment.html">搭建开发环境</a></li>
                        <li><a href="/releases/current/Creating-a-new-Storm-project.html">创建一个新的Apache Storm项目</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>文献资料</h5>
                    <ul class="footer-list">
                        <li><a href="/releases/current/index.html">指数</a></li>
                        <li><a href="/releases/current/javadocs/index.html">Java文档</a></li>
                        <li><a href="/releases/current/FAQ.html">常问问题</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <hr>
        <div class="row">   
            <div class="col-md-12">
                <p align="center">版权所有©2019 <a href="http://www.apache.org">Apache Software Foundation</a> 。版权所有。
                    <br>Apache Storm，Apache，Apache Feather徽标和Apache Storm项目徽标是The Apache Software Foundation的商标。
                    <br>提及的所有其他商标可能是其各自所有者的商标或注册商标。</p>
            </div>
        </div>
    </div>
</footer>
<!--Footer End-->
<!-- Scroll to top -->
<span class="totop"><a href="#"><i class="fa fa-angle-up"></i></a></span> 





</body></html>