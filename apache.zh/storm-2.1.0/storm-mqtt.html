<html ><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <title>Storm MQTT集成</title>

    <!-- Bootstrap core CSS -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="/assets/css/bootstrap-theme.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link rel="stylesheet" href="asset?aid=5">
    <link href="/css/style.css" rel="stylesheet">
    <link href="/assets/css/owl.theme.css" rel="stylesheet">
    <link href="/assets/css/owl.carousel.css" rel="stylesheet">
    <script type="text/javascript" src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/js/owl.carousel.min.js"></script>
    <script type="text/javascript" src="/assets/js/storm.js"></script>
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>


  <body >
    <header>
  <div class="container-fluid">
     <div class="row">
          <div class="col-md-5">
            <a href="/index.html"><img src="/images/logo.png" class="logo"></a>
          </div>
          <div class="col-md-5">
            
              <h1>版本：2.1.0</h1>
            
          </div>
          <div class="col-md-2">
            <a href="/downloads.html" class="btn-std btn-block btn-download">下载</a>
          </div>
        </div>
    </div>
</header>
<!--Header End-->
<!--Navigation Begin-->
<div class="navbar" role="banner">
  <div class="container-fluid">
      <div class="navbar-header">
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse"></button>
        </div>
        <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
          <ul class="nav navbar-nav">
              <li><a href="/index.html" id="home">家</a></li>
                <li><a href="/getting-help.html" id="getting-help">获得帮助</a></li>
                <li><a href="/about/integrates.html" id="project-info">项目信息</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" id="documentation" data-toggle="dropdown">文献资料<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                      
                        
                          <li><a href="/releases/2.1.0/index.html">2.1.0</a></li>
                        
                      
                        
                          <li><a href="/releases/2.0.0/index.html">2.0.0</a></li>
                        
                      
                        
                          <li><a href="/releases/1.2.3/index.html">1.2.3</a></li>
                        
                      
                    </ul>
                </li>
                <li><a href="/talksAndVideos.html">讲座和幻灯片</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" id="contribute" data-toggle="dropdown">社区<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="/contribute/Contributing-to-Storm.html">贡献</a></li>
                        <li><a href="/contribute/People.html">人</a></li>
                        <li><a href="/contribute/BYLAWS.html">按照法律规定</a></li>
                    </ul>
                </li>
                <li><a href="/2019/10/31/storm210-released.html" id="news">新闻</a></li>
            </ul>
        </nav>
    </div>
</div>



    <div class="container-fluid">
    <h1 class="page-title">Storm MQTT集成</h1>
          <div class="row">
           	<div class="col-md-12">
	             <!-- Documentation -->

<p class="post-meta"></p>

<div class="documentation-content"><h2 id="about">关于</h2>

<p>MQTT是一种轻量级的发布/订阅协议，经常在物联网应用程序中使用。</p>

<p>有关更多信息，请访问<a href="http://mqtt.org">http://mqtt.org</a> 。 HiveMQ网站上有一系列有关<a href="http://www.hivemq.com/mqtt-essentials/">MQTT Essentials的文章</a> 。</p>

<p>功能包括：</p>

<ul>
<li>全面的MQTT支持（例如，最后的遗嘱，QoS 0-2，保留等）</li>
<li>订阅MQTT主题的Spout实现</li>
<li>用于发布MQTT消息的螺栓实现</li>
<li>用于发布MQTT消息的三叉戟函数实现</li>
<li>身份验证和TLS / SSL支持</li>
<li>用户定义的“映射器”，用于将MQTT消息转换为元组（订户）</li>
<li>用户定义的“映射器”，用于将元组转换为MQTT消息（发布者）</li>
</ul>

<h2 id="quick-start">快速开始</h2>

<p>要快速查看实际的MQTT集成，请按照以下说明进行操作。</p>

<p><strong>启动MQTT经纪人和发布者</strong></p>

<p>下面的命令将在端口1883上创建一个MQTT代理，并启动发布器，该发布器将向MQTT主题发布随机的温度/湿度值。</p>

<p>打开一个终端并执行以下命令（根据需要更改路径）：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">java <span class="nt">-cp</span> examples/target/storm-mqtt-examples-<span class="k">*</span><span class="nt">-SNAPSHOT</span>.jar org.apache.storm.mqtt.examples.MqttBrokerPublisher
</code></pre></div>
<p><strong>运行示例拓扑</strong></p>

<p>使用Flux运行示例拓扑。这将启动一个本地模式集群和拓扑，该集群和拓扑由MQTT Spout发布到一个螺栓上，该螺栓简单地记录它接收到的信息。</p>

<p>在单独的终端中，运行以下命令（请注意， <code>storm</code>可执行文件必须在您的PATH上）：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">storm jar ./examples/target/storm-mqtt-examples-<span class="k">*</span><span class="nt">-SNAPSHOT</span>.jar org.apache.storm.flux.Flux ./examples/src/main/flux/sample.yaml <span class="nt">--local</span>
</code></pre></div>
<p>您应该看到螺栓记录了来自MQTT的数据：</p>
<div class="highlight"><pre><code class="language-" data-lang="">27020 [Thread-17-log-executor[3 3]] INFO  o.a.s.f.w.b.LogInfoBolt - {user=tgoetz, deviceId=1234, location=office, temperature=67.0, humidity=65.0}
27030 [Thread-17-log-executor[3 3]] INFO  o.a.s.f.w.b.LogInfoBolt - {user=tgoetz, deviceId=1234, location=office, temperature=47.0, humidity=85.0}
27040 [Thread-17-log-executor[3 3]] INFO  o.a.s.f.w.b.LogInfoBolt - {user=tgoetz, deviceId=1234, location=office, temperature=69.0, humidity=94.0}
27049 [Thread-17-log-executor[3 3]] INFO  o.a.s.f.w.b.LogInfoBolt - {user=tgoetz, deviceId=1234, location=office, temperature=4.0, humidity=98.0}
27059 [Thread-17-log-executor[3 3]] INFO  o.a.s.f.w.b.LogInfoBolt - {user=tgoetz, deviceId=1234, location=office, temperature=51.0, humidity=12.0}
27069 [Thread-17-log-executor[3 3]] INFO  o.a.s.f.w.b.LogInfoBolt - {user=tgoetz, deviceId=1234, location=office, temperature=27.0, humidity=65.0}
</code></pre></div>
<p>允许本地群集退出，或者通过键入Cntrl-C停止它。</p>

<p><strong>实施MQTT容错</strong></p>

<p>关闭拓扑后，由MQTT喷口创建的MQTT订阅将与代理一起保留，并且它将继续接收消息并排队（只要代理正在运行）。</p>

<p>如果再次运行拓扑（当代理仍在运行时），则当喷口最初连接到MQTT代理时，它将接收到它在关闭时丢失的所有消息。您应该看到这是一阵消息，然后是每秒大约两条消息的速率。</p>

<p>发生这种情况是因为，默认情况下，MQTT Spout在订阅时会创建一个<em>会话</em> -这意味着它请求代理保留并重新传递脱机时丢失的任何消息。另一个重要因素是<code>MqttBrokerPublisher</code>发布消息的MQTT QoS为<code>1</code> ，意味着<em>至少一次交货</em> 。</p>

<p>有关MQTT容错的更多信息，请参见下面的“ <strong>交付保证”</strong>部分。</p>

<h2 id="delivery-guarantees">交货保证</h2>

<p>用Storm术语， <strong><em>MQTT Spout提供至少一次交付</em></strong> ，具体取决于发布者和<strong><em>MQTT Spout</em></strong>的配置。</p>

<p>MQTT协议定义以下QoS级别：</p>

<ul>
<li><code>0</code> -最多一次（又称“忘了火”）</li>
<li><code>1</code> - 至少一次</li>
<li><code>2</code> -恰好一次</li>
</ul>

<p>这可能有点令人困惑，因为MQTT协议规范并未真正解决节点被彻底性事件彻底焚化的概念。这与Storm的可靠性模型形成了鲜明的对比，该模型期望并接受节点故障的概念。</p>

<p>因此，弹性最终取决于底层的MQTT实现和基础架构。</p>

<h3 id="recommendations">推荐建议</h3>

<p><em>使用此喷口处理后，您将一无所获。它可以与Trident一起使用，但不会提供翻译语义。您将至少获得一次担保。</em></p>

<p>如果需要可靠性保证（即<em>至少处理一次</em> ）：</p>

<ol>
<li>对于MQTT发布者（在Storm之外），发布QoS为<code>1</code>因此，如果喷嘴处于脱机状态，则代理将保存消息。</li>
<li>使用喷口默认值（ <code>cleanSession = false</code>和<code>qos = 1</code> ）</li>
<li>如果可以，请确保接收和MQTT消息的任何结果都是幂等的。</li>
<li>确保您的MQTT经纪人不会因网络分区而死亡或隔离。为自然和人为灾难以及网络分区做好准备。发生焚化和破坏。</li>
</ol>

<h2 id="configuration">组态</h2>

<p>有关所有配置选项的信息，请参阅JavaDoc。 <code>org.apache.storm.mqtt.common.MqttOptions</code> 。</p>

<h3 id="message-mappers">消息映射器</h3>

<p>要定义如何将MQTT消息映射到Storm元组，请使用<code>org.apache.storm.mqtt.MqttMessageMapper</code>界面，如下所示：</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MqttMessageMapper</span> <span class="kd">extends</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="n">Values</span> <span class="nf">toValues</span><span class="o">(</span><span class="n">MqttMessage</span> <span class="n">message</span><span class="o">);</span>

    <span class="n">Fields</span> <span class="nf">outputFields</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>
<p>的<code>MqttMessage</code>类包含消息发布到的主题（ <code>String</code> ）和消息有效负载（ <code>byte[]</code> ）。例如，这是一个<code>MqttMessageMapper</code>基于消息主题和有效负载的内容生成元组的实现：</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="cm">/**
 * Given a topic name: "users/{user}/{location}/{deviceId}"
 * and a payload of "{temperature}/{humidity}"
 * emits a tuple containing user(String), deviceId(String), location(String), temperature(float), humidity(float)
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomMessageMapper</span> <span class="kd">implements</span> <span class="n">MqttMessageMapper</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">LOG</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">CustomMessageMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>


    <span class="kd">public</span> <span class="n">Values</span> <span class="nf">toValues</span><span class="o">(</span><span class="n">MqttMessage</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">topic</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="na">getTopic</span><span class="o">();</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">topicElements</span> <span class="o">=</span> <span class="n">topic</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"/"</span><span class="o">);</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">payloadElements</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getMessage</span><span class="o">()).</span><span class="na">split</span><span class="o">(</span><span class="s">"/"</span><span class="o">);</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nf">Values</span><span class="o">(</span><span class="n">topicElements</span><span class="o">[</span><span class="mi">2</span><span class="o">],</span> <span class="n">topicElements</span><span class="o">[</span><span class="mi">4</span><span class="o">],</span> <span class="n">topicElements</span><span class="o">[</span><span class="mi">3</span><span class="o">],</span> <span class="n">Float</span><span class="o">.</span><span class="na">parseFloat</span><span class="o">(</span><span class="n">payloadElements</span><span class="o">[</span><span class="mi">0</span><span class="o">]),</span> 
                <span class="n">Float</span><span class="o">.</span><span class="na">parseFloat</span><span class="o">(</span><span class="n">payloadElements</span><span class="o">[</span><span class="mi">1</span><span class="o">]));</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Fields</span> <span class="nf">outputFields</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Fields</span><span class="o">(</span><span class="s">"user"</span><span class="o">,</span> <span class="s">"deviceId"</span><span class="o">,</span> <span class="s">"location"</span><span class="o">,</span> <span class="s">"temperature"</span><span class="o">,</span> <span class="s">"humidity"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<h3 id="tuple-mappers">元组映射器</h3>

<p>使用MQTT螺栓或Trident函数发布MQTT消息时，需要将Storm元组数据映射到MQTT消息（主题/有效负载）。这是通过实施<code>org.apache.storm.mqtt.MqttTupleMapper</code>接口：</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MqttTupleMapper</span> <span class="kd">extends</span> <span class="n">Serializable</span><span class="o">{</span>

    <span class="n">MqttMessage</span> <span class="nf">toMessage</span><span class="o">(</span><span class="n">ITuple</span> <span class="n">tuple</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></div>
<p>例如，一个简单的<code>MqttTupleMapper</code>实现可能如下所示：</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyTupleMapper</span> <span class="kd">implements</span> <span class="n">MqttTupleMapper</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">MqttMessage</span> <span class="nf">toMessage</span><span class="o">(</span><span class="n">ITuple</span> <span class="n">tuple</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">topic</span> <span class="o">=</span> <span class="s">"users/"</span> <span class="o">+</span> <span class="n">tuple</span><span class="o">.</span><span class="na">getStringByField</span><span class="o">(</span><span class="s">"userId"</span><span class="o">)</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">tuple</span><span class="o">.</span><span class="na">getStringByField</span><span class="o">(</span><span class="s">"device"</span><span class="o">);</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">payload</span> <span class="o">=</span> <span class="n">tuple</span><span class="o">.</span><span class="na">getStringByField</span><span class="o">(</span><span class="s">"message"</span><span class="o">).</span><span class="na">getBytes</span><span class="o">();</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">MqttMessage</span><span class="o">(</span><span class="n">topic</span><span class="o">,</span> <span class="n">payload</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<h3 id="mqtt-spout-parallelism">MQTT喷口平行度</h3>

<p>建议对MQTT喷口使用1的并行度，否则最终将导致喷口的多个实例订阅同一主题，从而导致消息重复。</p>

<p>如果要并行化喷口，建议您在拓扑中使用喷口的多个实例，并使用MQTT主题选择器对数据进行分区。实施分区策略的方式最终取决于MQTT主题结构。例如，如果您按地区（例如东西方）划分了主题，则可以执行以下操作：</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">String</span> <span class="n">spout1Topic</span> <span class="o">=</span> <span class="s">"users/east/#"</span><span class="o">;</span>
<span class="n">String</span> <span class="n">spout2Topic</span> <span class="o">=</span> <span class="s">"users/west/#"</span><span class="o">;</span>
</code></pre></div>
<p>然后通过为每个流订阅一个螺栓将结果流连接在一起。</p>

<h3 id="using-flux">使用助焊剂</h3>

<p>以下Flux YAML配置创建示例中使用的策略：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mqtt-topology"</span>

<span class="na">components</span><span class="pi">:</span>
   <span class="c1">########## MQTT Spout Config ############</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mqtt-type"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.mqtt.examples.CustomMessageMapper"</span>

  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mqtt-options"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.mqtt.common.MqttOptions"</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">url"</span>
        <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">tcp://localhost:1883"</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">topics"</span>
        <span class="na">value</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">/users/tgoetz/#"</span>

<span class="c1"># topology configuration</span>
<span class="na">config</span><span class="pi">:</span>
  <span class="s">topology.workers</span><span class="pi">:</span> <span class="s">1</span>
  <span class="s">topology.max.spout.pending</span><span class="pi">:</span> <span class="s">1000</span>

<span class="c1"># spout definitions</span>
<span class="na">spouts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mqtt-spout"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.mqtt.spout.MqttSpout"</span>
    <span class="na">constructorArgs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">ref</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mqtt-type"</span>
      <span class="pi">-</span> <span class="na">ref</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mqtt-options"</span>
    <span class="na">parallelism</span><span class="pi">:</span> <span class="s">1</span>

<span class="c1"># bolt definitions</span>
<span class="na">bolts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">log"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.flux.wrappers.bolts.LogInfoBolt"</span>
    <span class="na">parallelism</span><span class="pi">:</span> <span class="s">1</span>


<span class="na">streams</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">from</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mqtt-spout"</span>
    <span class="na">to</span><span class="pi">:</span> <span class="s2">"</span><span class="s">log"</span>
    <span class="na">grouping</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">SHUFFLE</span>

</code></pre></div>
<h3 id="using-java">使用Java</h3>

<p>同样，您可以使用Storm Core Java API创建相同的拓扑：</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">TopologyBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TopologyBuilder</span><span class="o">();</span>
<span class="n">MqttOptions</span> <span class="n">options</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MqttOptions</span><span class="o">();</span>
<span class="n">options</span><span class="o">.</span><span class="na">setTopics</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"/users/tgoetz/#"</span><span class="o">));</span>
<span class="n">options</span><span class="o">.</span><span class="na">setCleanConnection</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
<span class="n">MqttSpout</span> <span class="n">spout</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MqttSpout</span><span class="o">(</span><span class="k">new</span> <span class="n">StringMessageMapper</span><span class="o">(),</span> <span class="n">options</span><span class="o">);</span>

<span class="n">MqttBolt</span> <span class="n">bolt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LogInfoBolt</span><span class="o">();</span>

<span class="n">builder</span><span class="o">.</span><span class="na">setSpout</span><span class="o">(</span><span class="s">"mqtt-spout"</span><span class="o">,</span> <span class="n">spout</span><span class="o">);</span>
<span class="n">builder</span><span class="o">.</span><span class="na">setBolt</span><span class="o">(</span><span class="s">"log-bolt"</span><span class="o">,</span> <span class="n">bolt</span><span class="o">).</span><span class="na">shuffleGrouping</span><span class="o">(</span><span class="s">"mqtt-spout"</span><span class="o">);</span>

<span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">createTopology</span><span class="o">();</span>
</code></pre></div>
<h2 id="ssl-tls">SSL / TLS</h2>

<p>如果要连接的MQTT代理需要SSL或SSL客户端身份验证，则需要使用适当的URI和包含必要证书的密钥库/信任库文件的位置来配置喷口。</p>

<h3 id="ssl-tls-uris">SSL / TLS URI</h3>

<p>要通过SSL / TLS连接，请使用前缀为的URI <code>ssl://</code>要么<code>tls://</code>代替<code>tcp://</code> 。为了进一步控制算法，您可以指定特定的协议：</p>

<ul>
<li><code>ssl://</code>使用SSL协议的JVM默认版本。</li>
<li><code>sslv*://</code>使用特定版本的SSL协议，其中<code>*</code>被版本取代（例如<code>sslv3://</code> ）</li>
<li><code>tls://</code>使用TLS协议的JVM默认版本。</li>
<li><code>tlsv*://</code>使用特定版本的TLS协议，其中<code>*</code>被版本取代（例如<code>tlsv1.1://</code> ）</li>
</ul>

<h3 id="specifying-keystore-truststore-locations">指定密钥库/信任库位置</h3>

<p>的<code>MqttSpout</code> ， <code>MqttBolt</code>和<code>MqttPublishFunction</code>都有构造函数<code>KeyStoreLoader</code>实例，用于加载TLS / SSL连接所需的证书。例如：</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"> <span class="kd">public</span> <span class="nf">MqttSpout</span><span class="o">(</span><span class="n">MqttMessageMapper</span> <span class="n">type</span><span class="o">,</span> <span class="n">MqttOptions</span> <span class="n">options</span><span class="o">,</span> <span class="n">KeyStoreLoader</span> <span class="n">keyStoreLoader</span><span class="o">)</span>
</code></pre></div>
<p>的<code>DefaultKeyStoreLoader</code>该类可用于从本地文件系统加载证书。请注意，密钥库/信任库必须在可能执行喷口/螺栓的所有辅助节点上都可用。使用<code>DefaultKeyStoreLoader</code>您指定密钥库/信任库文件的位置，并设置必要的密码：</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">DefaultKeyStoreLoader</span> <span class="n">ksl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultKeyStoreLoader</span><span class="o">(</span><span class="s">"/path/to/keystore.jks"</span><span class="o">,</span> <span class="s">"/path/to/truststore.jks"</span><span class="o">);</span>
<span class="n">ksl</span><span class="o">.</span><span class="na">setKeyStorePassword</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span>
<span class="n">ksl</span><span class="o">.</span><span class="na">setTrustStorePassword</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span>
<span class="c1">//...</span>
</code></pre></div>
<p>如果密钥库/信任库证书存储在单个文件中，则可以使用单参数构造函数：</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">DefaultKeyStoreLoader</span> <span class="n">ksl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultKeyStoreLoader</span><span class="o">(</span><span class="s">"/path/to/keystore.jks"</span><span class="o">);</span>
<span class="n">ksl</span><span class="o">.</span><span class="na">setKeyStorePassword</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span>
<span class="c1">//...</span>
</code></pre></div>
<p>还可以使用Flux配置SSL / TLS：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mqtt-topology"</span>

<span class="na">components</span><span class="pi">:</span>
   <span class="c1">########## MQTT Spout Config ############</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mqtt-type"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.mqtt.examples.CustomMessageMapper"</span>

  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">keystore-loader"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.mqtt.ssl.DefaultKeyStoreLoader"</span>
    <span class="na">constructorArgs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">keystore.jks"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">truststore.jks"</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">keyPassword"</span>
        <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">password"</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">keyStorePassword"</span>
        <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">password"</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">trustStorePassword"</span>
        <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">password"</span>

  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mqtt-options"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.mqtt.common.MqttOptions"</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">url"</span>
        <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ssl://raspberrypi.local:8883"</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">topics"</span>
        <span class="na">value</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">/users/tgoetz/#"</span>

<span class="c1"># topology configuration</span>
<span class="na">config</span><span class="pi">:</span>
  <span class="s">topology.workers</span><span class="pi">:</span> <span class="s">1</span>
  <span class="s">topology.max.spout.pending</span><span class="pi">:</span> <span class="s">1000</span>

<span class="c1"># spout definitions</span>
<span class="na">spouts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mqtt-spout"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.mqtt.spout.MqttSpout"</span>
    <span class="na">constructorArgs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">ref</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mqtt-type"</span>
      <span class="pi">-</span> <span class="na">ref</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mqtt-options"</span>
      <span class="pi">-</span> <span class="na">ref</span><span class="pi">:</span> <span class="s2">"</span><span class="s">keystore-loader"</span>
    <span class="na">parallelism</span><span class="pi">:</span> <span class="s">1</span>

<span class="c1"># bolt definitions</span>
<span class="na">bolts</span><span class="pi">:</span>

  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">log"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.flux.wrappers.bolts.LogInfoBolt"</span>
    <span class="na">parallelism</span><span class="pi">:</span> <span class="s">1</span>


<span class="na">streams</span><span class="pi">:</span>

  <span class="pi">-</span> <span class="na">from</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mqtt-spout"</span>
    <span class="na">to</span><span class="pi">:</span> <span class="s2">"</span><span class="s">log"</span>
    <span class="na">grouping</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">SHUFFLE</span>

</code></pre></div>
<h2 id="committer-sponsors">发起人赞助商</h2>

<ul>
<li>泰勒·格茨（ <a href="mailto:ptgoetz@apache.org">P.Taylor</a> Goetz）（ <a href="mailto:ptgoetz@apache.org">ptgoetz@apache.org</a> ）</li>
</ul>
</div>


	          </div>
	       </div>
	  </div>
<footer>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>聚会</h5>
                    <ul class="latest-news">
                        
                        <li><a href="http://www.meetup.com/Apache-Storm-Apache-Kafka/">Apache Storm和Apache Kafka</a> <span class="small">（加利福尼亚州桑尼维尔）</span></li>
                        
                        <li><a href="http://www.meetup.com/Apache-Storm-Kafka-Users/">Apache Storm和Kafka用户</a> <span class="small">（华盛顿州西雅图）</span></li>
                        
                        <li><a href="http://www.meetup.com/New-York-City-Storm-User-Group/">NYC Storm用户组</a> <span class="small">（纽约州纽约）</span></li>
                        
                        <li><a href="http://www.meetup.com/Bay-Area-Stream-Processing">湾区流处理</a> <span class="small">（加利福尼亚州埃默里维尔）</span></li>
                        
                        <li><a href="http://www.meetup.com/Boston-Storm-Users/">波士顿实时数据</a> <span class="small">（马萨诸塞州波士顿）</span></li>
                        
                        <li><a href="http://www.meetup.com/storm-london">伦敦风暴用户组</a> <span class="small">（英国伦敦）</span></li>
                        
                        <!-- <li><a href="http://www.meetup.com/Apache-Storm-Kafka-Users/">Seatle, WA</a> <span class="small">(27 Jun 2015)</span></li> -->
                    </ul>
                </div>
            </div>
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>关于Apache Storm</h5>
                    <p>Apache Storm与任何排队系统和任何数据库系统集成。Apache Storm的喷口抽象使集成新排队系统变得容易。同样，将Apache Storm与数据库系统集成很容易。</p>
               </div>
            </div>
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>第一眼</h5>
                    <ul class="footer-list">
                        <li><a href="/releases/current/Rationale.html">基本原理</a></li>
                        <li><a href="/releases/current/Tutorial.html">讲解</a></li>
                        <li><a href="/releases/current/Setting-up-development-environment.html">搭建开发环境</a></li>
                        <li><a href="/releases/current/Creating-a-new-Storm-project.html">创建一个新的Apache Storm项目</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>文献资料</h5>
                    <ul class="footer-list">
                        <li><a href="/releases/current/index.html">指数</a></li>
                        <li><a href="/releases/current/javadocs/index.html">Java文档</a></li>
                        <li><a href="/releases/current/FAQ.html">常问问题</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <hr>
        <div class="row">   
            <div class="col-md-12">
                <p align="center">版权所有©2019 <a href="http://www.apache.org">Apache Software Foundation</a> 。版权所有。
                    <br>Apache Storm，Apache，Apache Feather徽标和Apache Storm项目徽标是The Apache Software Foundation的商标。
                    <br>提及的所有其他商标可能是其各自所有者的商标或注册商标。</p>
            </div>
        </div>
    </div>
</footer>
<!--Footer End-->
<!-- Scroll to top -->
<span class="totop"><a href="#"><i class="fa fa-angle-up"></i></a></span> 





</body></html>