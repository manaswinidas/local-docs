<html ><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <title>Storm Solr集成</title>

    <!-- Bootstrap core CSS -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="/assets/css/bootstrap-theme.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link rel="stylesheet" href="asset?aid=5">
    <link href="/css/style.css" rel="stylesheet">
    <link href="/assets/css/owl.theme.css" rel="stylesheet">
    <link href="/assets/css/owl.carousel.css" rel="stylesheet">
    <script type="text/javascript" src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/js/owl.carousel.min.js"></script>
    <script type="text/javascript" src="/assets/js/storm.js"></script>
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>


  <body >
    <header>
  <div class="container-fluid">
     <div class="row">
          <div class="col-md-5">
            <a href="/index.html"><img src="/images/logo.png" class="logo"></a>
          </div>
          <div class="col-md-5">
            
              <h1>版本：2.1.0</h1>
            
          </div>
          <div class="col-md-2">
            <a href="/downloads.html" class="btn-std btn-block btn-download">下载</a>
          </div>
        </div>
    </div>
</header>
<!--Header End-->
<!--Navigation Begin-->
<div class="navbar" role="banner">
  <div class="container-fluid">
      <div class="navbar-header">
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse"></button>
        </div>
        <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
          <ul class="nav navbar-nav">
              <li><a href="/index.html" id="home">家</a></li>
                <li><a href="/getting-help.html" id="getting-help">获得帮助</a></li>
                <li><a href="/about/integrates.html" id="project-info">项目信息</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" id="documentation" data-toggle="dropdown">文献资料<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                      
                        
                          <li><a href="/releases/2.1.0/index.html">2.1.0</a></li>
                        
                      
                        
                          <li><a href="/releases/2.0.0/index.html">2.0.0</a></li>
                        
                      
                        
                          <li><a href="/releases/1.2.3/index.html">1.2.3</a></li>
                        
                      
                    </ul>
                </li>
                <li><a href="/talksAndVideos.html">讲座和幻灯片</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" id="contribute" data-toggle="dropdown">社区<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="/contribute/Contributing-to-Storm.html">贡献</a></li>
                        <li><a href="/contribute/People.html">人</a></li>
                        <li><a href="/contribute/BYLAWS.html">按照法律规定</a></li>
                    </ul>
                </li>
                <li><a href="/2019/10/31/storm210-released.html" id="news">新闻</a></li>
            </ul>
        </nav>
    </div>
</div>



    <div class="container-fluid">
    <h1 class="page-title">Storm Solr集成</h1>
          <div class="row">
           	<div class="col-md-12">
	             <!-- Documentation -->

<p class="post-meta"></p>

<div class="documentation-content"><p>Apache Solr的Storm和Trident集成。该软件包包括一个螺栓和一个三叉戟状态，这些状态使Storm拓扑可以将风暴元组的内容流化以索引Solr集合。</p>

<h1 id="index-storm-tuples-into-a-solr-collection">将Storm元组索引到Solr集合中</h1>

<p>提供的“螺栓”和“三叉戟”状态使用提供的映射器之一来构建<code>SolrRequest</code>负责对Solr进行更新调用的对象，从而更新指定集合的索引。</p>

<h1 id="usage-examples">使用范例</h1>

<p>在本节中，我们提供一些简单的代码片段，介绍如何构建Storm和Trident拓扑以索引Solr。在接下来的部分中，我们将详细介绍Storm Solr集成的两个关键组成部分，即<code>SolrUpdateBolt</code>和<code>Mappers</code> ， <code>SolrFieldsMapper</code>和<code>SolrJsonMapper</code> 。</p>

<h2 id="storm-bolt-with-json-mapper-and-count-based-commit-strategy">带有JSON映射器和基于计数的提交策略的Storm Bolt</h2>
<div class="highlight"><pre><code class="language-java" data-lang="java">    <span class="k">new</span> <span class="n">SolrUpdateBolt</span><span class="o">(</span><span class="n">solrConfig</span><span class="o">,</span> <span class="n">solrMapper</span><span class="o">,</span> <span class="n">solrCommitStgy</span><span class="o">)</span>

    <span class="c1">// zkHostString for Solr 'gettingstarted' example</span>
    <span class="n">SolrConfig</span> <span class="n">solrConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SolrConfig</span><span class="o">(</span><span class="s">"127.0.0.1:9983"</span><span class="o">);</span>

    <span class="c1">// JSON Mapper used to generate 'SolrRequest' requests to update the "gettingstarted" Solr collection with JSON content declared the tuple field with name "JSON"</span>
    <span class="n">SolrMapper</span> <span class="n">solrMapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SolrJsonMapper</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="s">"gettingstarted"</span><span class="o">,</span> <span class="s">"JSON"</span><span class="o">).</span><span class="na">build</span><span class="o">();</span> 

    <span class="c1">// Acks every other five tuples. Setting to null acks every tuple</span>
    <span class="n">SolrCommitStrategy</span> <span class="n">solrCommitStgy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CountBasedCommit</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>          
</code></pre></div>
<h2 id="trident-topology-with-fields-mapper">三叉戟拓扑与字段映射器</h2>
<div class="highlight"><pre><code class="language-java" data-lang="java">    <span class="k">new</span> <span class="n">SolrStateFactory</span><span class="o">(</span><span class="n">solrConfig</span><span class="o">,</span> <span class="n">solrMapper</span><span class="o">);</span>

    <span class="c1">// zkHostString for Solr 'gettingstarted' example</span>
    <span class="n">SolrConfig</span> <span class="n">solrConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SolrConfig</span><span class="o">(</span><span class="s">"127.0.0.1:9983"</span><span class="o">);</span>

    <span class="cm">/* Solr Fields Mapper used to generate 'SolrRequest' requests to update the "gettingstarted" Solr collection. The Solr index is updated using the field values of the tuple fields that match static or dynamic fields declared in the schema object build using schemaBuilder */</span> 
    <span class="n">SolrMapper</span> <span class="n">solrMapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SolrFieldsMapper</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">schemaBuilder</span><span class="o">,</span> <span class="s">"gettingstarted"</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

    <span class="c1">// builds the Schema object from the JSON representation of the schema as returned by the URL http://localhost:8983/solr/gettingstarted/schema/ </span>
    <span class="n">SchemaBuilder</span> <span class="n">schemaBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RestJsonSchemaBuilder</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="s">"8983"</span><span class="o">,</span> <span class="s">"gettingstarted"</span><span class="o">)</span>
</code></pre></div>
<h2 id="solrupdatebolt">SolrUpdateBolt</h2>

<p><code>SolrUpdateBolt</code>将元组直接流到Apache Solr。Solr索引使用更新<code>SolrRequest</code>要求。的<code>SolrUpdateBolt</code>可以使用以下实现进行配置<code>SolrConfig</code> ， <code>SolrMapper</code> ，以及可选<code>SolrCommitStrategy</code> 。</p>

<p>流中使用Solve中定义的策略从元组中提取要流到Solr的数据。 <code>SolrMapper</code>实施。</p>

<p>的<code>SolrRquest</code>可以每个元组发送，也可以根据<code>SolrCommitStrategy</code>实现。如果一个<code>SolrCommitStrategy</code>到位，并且批处理中的一个元组发生故障，该批处理未提交，并且该批处理中的所有元组都标记为Fail，然后重试。另一方面，如果所有元组都成功，则<code>SolrRequest</code>已提交，并且所有元组都已成功确认。</p>

<p><code>SolrConfig</code>是包含要用于Storm Solr螺栓的Solr配置的类。螺栓所需的任何配置都应放在此类中。</p>

<h2 id="solrmapper">SolrMapper</h2>

<p><code>SorlMapper</code>实现定义了从元组中提取信息的策略。公开方式<code>toSolrRequest</code>接收一个元组或一个元组列表并返回一个<code>SolrRequest</code>用于更新Solr索引的对象。</p>

<h3 id="solrjsonmapper">SolrJsonMapper</h3>

<p>的<code>SolrJsonMapper</code>创建一个Solr更新请求，该请求将发送到Solr定义的URL端点，作为JSON格式请求的资源目的地。</p>

<p>创建一个<code>SolrJsonMapper</code>客户端必须指定要更新的集合的名称以及包含用于更新Solr索引的JSON对象的元组字段。如果元组不包含指定的字段，则<code>SolrMapperException</code>该方法将被抛出时<code>toSolrRequest</code>叫做。如果该字段存在，则其值可以是具有JSON格式内容的字符串，也可以是将序列化为JSON的Java对象。</p>

<p>程式码片段，说明如何建立<code>SolrJsonMapper</code>对象来更新<code>gettingstarted</code> Solr集合具有在元组字段中声明的名称为“ JSON”的JSON内容</p>
<div class="highlight"><pre><code class="language-java" data-lang="java">    <span class="n">SolrMapper</span> <span class="n">solrMapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SolrJsonMapper</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="s">"gettingstarted"</span><span class="o">,</span> <span class="s">"JSON"</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
</code></pre></div>
<h3 id="solrfieldsmapper">SolrFieldsMapper</h3>

<p>的<code>SolrFieldsMapper</code>创建一个Solr更新请求，该请求发送到处理以下项更新的Solr URL端点<code>SolrInputDocument</code>对象。</p>

<p>创建一个<code>SolrFieldsMapper</code>客户端必须指定要更新的集合的名称以及<code>SolrSchemaBuilder</code> 。索尔<code>Schema</code>用于提取有关Solr架构字段和相应类型的信息。该元数据用于从元组获取信息。仅将与静态或动态Solr字段匹配的元组字段添加到文档中。与架构不匹配的元组字段不会添加到<code>SolrInputDocument</code>正在准备建立索引。为与模式不匹配并因此未建立索引的元组字段打印调试日志消息。</p>

<p>的<code>SolrFieldsMapper</code>支持多值字段。多值元组字段必须被标记。默认标记为|。可以通过调用方法指定任意令牌<code>org.apache.storm.solr.mapper.SolrFieldsMapper.Builder.setMultiValueFieldToken</code>那是<code>SolrFieldsMapper.Builder</code>建造者类。</p>

<p>程式码片段，说明如何建立<code>SolrFieldsMapper</code>对象来更新<code>gettingstarted</code> Solr集合。“多值”字段将每个值都用标记％代替，而不是默认值|。 。要使用默认令牌，您可以省略对方法的调用<code>setMultiValueFieldToken</code> 。</p>
<div class="highlight"><pre><code class="language-java" data-lang="java">    <span class="k">new</span> <span class="n">SolrFieldsMapper</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span>
            <span class="k">new</span> <span class="nf">RestJsonSchemaBuilder</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="s">"8983"</span><span class="o">,</span> <span class="s">"gettingstarted"</span><span class="o">),</span> <span class="s">"gettingstarted"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setMultiValueFieldToken</span><span class="o">(</span><span class="s">"%"</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
</code></pre></div>
<h1 id="build-and-run-bundled-examples">建立并运行捆绑示例</h1>

<p>为了能够运行示例，您必须首先在包中构建Java代码。 <code>storm-solr</code> ，然后生成具有所有依赖项的uber jar。</p>

<h2 id="build-the-storm-apache-solr-integration-code">构建Storm Apache Solr集成代码</h2>

<p><code>mvn clean install -f REPO_HOME/storm/external/storm-solr/pom.xml</code></p>

<h2 id="use-the-maven-shade-plugin-to-build-the-uber-jar">使用Maven Shade插件构建Uber Jar</h2>

<p>将以下内容添加到<code>REPO_HOME/storm/external/storm-solr/pom.xml</code></p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;plugin&gt;</span>
     <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
     <span class="nt">&lt;artifactId&gt;</span>maven-shade-plugin<span class="nt">&lt;/artifactId&gt;</span>
     <span class="nt">&lt;version&gt;</span>2.4.1<span class="nt">&lt;/version&gt;</span>
     <span class="nt">&lt;executions&gt;</span>
         <span class="nt">&lt;execution&gt;</span>
             <span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
             <span class="nt">&lt;goals&gt;</span>
                 <span class="nt">&lt;goal&gt;</span>shade<span class="nt">&lt;/goal&gt;</span>
             <span class="nt">&lt;/goals&gt;</span>
             <span class="nt">&lt;configuration&gt;</span>
                 <span class="nt">&lt;transformers&gt;</span>
                     <span class="nt">&lt;transformer</span> <span class="na">implementation=</span><span class="s">"org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"</span><span class="nt">&gt;</span>
                         <span class="nt">&lt;mainClass&gt;</span>org.apache.storm.solr.topology.SolrJsonTopology<span class="nt">&lt;/mainClass&gt;</span>
                     <span class="nt">&lt;/transformer&gt;</span>
                 <span class="nt">&lt;/transformers&gt;</span>
             <span class="nt">&lt;/configuration&gt;</span>
         <span class="nt">&lt;/execution&gt;</span>
     <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></div>
<p>通过运行命令创建uber jar：</p>
<div class="highlight"><pre><code class="language-" data-lang="">mvn package -f REPO_HOME/storm/external/storm-solr/pom.xml
</code></pre></div>
<p>这将创建名称和位置与以下模式匹配的uber jar文件：</p>
<div class="highlight"><pre><code class="language-" data-lang="">REPO_HOME/storm/external/storm/target/storm-solr-0.11.0-SNAPSHOT.jar
</code></pre></div>
<h2 id="run-examples">运行示例</h2>

<p>复制文件<code>REPO_HOME/storm/external/storm-solr/target/storm-solr-0.11.0-SNAPSHOT.jar</code>至<code>STORM_HOME/extlib</code></p>

<p><strong>提供的代码示例要求您首先运行<a href="http://lucene.apache.org/solr/quickstart.html">Solr Getting Started</a>示例</strong> </p>

<h3 id="run-storm-topology">运行风暴拓扑</h3>

<p>STORM_HOME / bin / storm jar REPO_HOME / storm / external / storm-solr / target / storm-solr-0.11.0-SNAPSHOT-tests.jar org.apache.storm.solr.topology。SolrFields拓扑</p>

<p>STORM_HOME / bin / storm jar REPO_HOME / storm / external / storm-solr / target / storm-solr-0.11.0-SNAPSHOT-tests.jar org.apache.storm.solr.topology。SolrJson拓扑</p>

<h3 id="run-trident-topology">运行三叉戟拓扑</h3>

<p>STORM_HOME / bin / storm jar REPO_HOME / storm / external / storm-solr / target / storm-solr-0.11.0-SNAPSHOT-tests.jar org.apache.storm.solr.trident。SolrFieldsTridentTopology</p>

<p>STORM_HOME / bin / storm jar REPO_HOME / storm / external / storm-solr / target / storm-solr-0.11.0-SNAPSHOT-tests.jar org.apache.storm.solr.trident。SolrJsonTrident拓扑</p>

<h3 id="verify-results">验证结果</h3>

<p>前面提到的Storm和Trident拓扑索引了Solr <code>gettingstarted</code>具有以下内容的对象的集合<code>id</code>图案：</p>

<p>* id_fields_test_val * <code>SolrFieldsTopology</code>和<code>SolrFieldsTridentTopology</code></p>

<p>* json_test_val *用于<code>SolrJsonTopology</code>和<code>SolrJsonTridentTopology</code></p>

<p>在Solr中查询这些模式，您将看到已由Storm Apache Solr集成索引的值：</p>

<p>curl -X GET -H“内容类型：应用程序/ json” -H“接受：应用程序/ json” <a href="http://localhost:8983/solr/gettingstarted_shard1_replica2/select?q=*id_fields_test_val*&wt=json&indent=true">http：// localhost：8983 / solr / gettingstarted_shard1_replica2 / select？q = * id_fields_test_val *＆wt = json＆indent = true</a></p>

<p>curl -X GET -H“内容类型：application / json” -H“接受：application / json” <a href="http://localhost:8983/solr/gettingstarted_shard1_replica2/select?q=*id_fields_test_val*&wt=json&indent=true">http：// localhost：8983 / solr / gettingstarted_shard1_replica2 / select？q = * id_fields_test_val *＆wt = json＆indent = true</a></p>

<p>您还可以通过打开Apache Solr UI并粘贴以下内容来查看结果<code>id</code>中的模式<code>q</code>查询页面中的文本框</p>

<p><a href="http://localhost:8983/solr/#/gettingstarted_shard1_replica2/query">http：// localhost：8983 / solr /＃/ gettingstarted_shard1_replica2 / query</a></p>
</div>


	          </div>
	       </div>
	  </div>
<footer>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>聚会</h5>
                    <ul class="latest-news">
                        
                        <li><a href="http://www.meetup.com/Apache-Storm-Apache-Kafka/">Apache Storm和Apache Kafka</a> <span class="small">（加利福尼亚州桑尼维尔）</span></li>
                        
                        <li><a href="http://www.meetup.com/Apache-Storm-Kafka-Users/">Apache Storm和Kafka用户</a> <span class="small">（华盛顿州西雅图）</span></li>
                        
                        <li><a href="http://www.meetup.com/New-York-City-Storm-User-Group/">NYC Storm用户组</a> <span class="small">（纽约州纽约）</span></li>
                        
                        <li><a href="http://www.meetup.com/Bay-Area-Stream-Processing">湾区流处理</a> <span class="small">（加利福尼亚州埃默里维尔）</span></li>
                        
                        <li><a href="http://www.meetup.com/Boston-Storm-Users/">波士顿实时数据</a> <span class="small">（马萨诸塞州波士顿）</span></li>
                        
                        <li><a href="http://www.meetup.com/storm-london">伦敦风暴用户组</a> <span class="small">（英国伦敦）</span></li>
                        
                        <!-- <li><a href="http://www.meetup.com/Apache-Storm-Kafka-Users/">Seatle, WA</a> <span class="small">(27 Jun 2015)</span></li> -->
                    </ul>
                </div>
            </div>
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>关于Apache Storm</h5>
                    <p>Apache Storm与任何排队系统和任何数据库系统集成。Apache Storm的喷口抽象使集成新排队系统变得容易。同样，将Apache Storm与数据库系统集成很容易。</p>
               </div>
            </div>
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>第一眼</h5>
                    <ul class="footer-list">
                        <li><a href="/releases/current/Rationale.html">基本原理</a></li>
                        <li><a href="/releases/current/Tutorial.html">讲解</a></li>
                        <li><a href="/releases/current/Setting-up-development-environment.html">搭建开发环境</a></li>
                        <li><a href="/releases/current/Creating-a-new-Storm-project.html">创建一个新的Apache Storm项目</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>文献资料</h5>
                    <ul class="footer-list">
                        <li><a href="/releases/current/index.html">指数</a></li>
                        <li><a href="/releases/current/javadocs/index.html">Java文档</a></li>
                        <li><a href="/releases/current/FAQ.html">常问问题</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <hr>
        <div class="row">   
            <div class="col-md-12">
                <p align="center">版权所有©2019 <a href="http://www.apache.org">Apache Software Foundation</a> 。版权所有。
                    <br>Apache Storm，Apache，Apache Feather徽标和Apache Storm项目徽标是The Apache Software Foundation的商标。
                    <br>提及的所有其他商标可能是其各自所有者的商标或注册商标。</p>
            </div>
        </div>
    </div>
</footer>
<!--Footer End-->
<!-- Scroll to top -->
<span class="totop"><a href="#"><i class="fa fa-angle-up"></i></a></span> 





</body></html>