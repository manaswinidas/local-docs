<html ><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <title>代码库的结构</title>

    <!-- Bootstrap core CSS -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="/assets/css/bootstrap-theme.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link rel="stylesheet" href="asset?aid=1">
    <link href="/css/style.css" rel="stylesheet">
    <link href="/assets/css/owl.theme.css" rel="stylesheet">
    <link href="/assets/css/owl.carousel.css" rel="stylesheet">
    <script type="text/javascript" src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/js/owl.carousel.min.js"></script>
    <script type="text/javascript" src="/assets/js/storm.js"></script>
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>


  <body >
    <header>
  <div class="container-fluid">
     <div class="row">
          <div class="col-md-5">
            <a href="/index.html"><img src="/images/logo.png" class="logo"></a>
          </div>
          <div class="col-md-5">
            
              <h1>版本：2.1.0</h1>
            
          </div>
          <div class="col-md-2">
            <a href="/downloads.html" class="btn-std btn-block btn-download">下载</a>
          </div>
        </div>
    </div>
</header>
<!--Header End-->
<!--Navigation Begin-->
<div class="navbar" role="banner">
  <div class="container-fluid">
      <div class="navbar-header">
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse"></button>
        </div>
        <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
          <ul class="nav navbar-nav">
              <li><a href="/index.html" id="home">家</a></li>
                <li><a href="/getting-help.html" id="getting-help">获得帮助</a></li>
                <li><a href="/about/integrates.html" id="project-info">项目信息</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" id="documentation" data-toggle="dropdown">文献资料<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                      
                        
                          <li><a href="/releases/2.1.0/index.html">2.1.0</a></li>
                        
                      
                        
                          <li><a href="/releases/2.0.0/index.html">2.0.0</a></li>
                        
                      
                        
                          <li><a href="/releases/1.2.3/index.html">1.2.3</a></li>
                        
                      
                    </ul>
                </li>
                <li><a href="/talksAndVideos.html">讲座和幻灯片</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" id="contribute" data-toggle="dropdown">社区<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="/contribute/Contributing-to-Storm.html">贡献</a></li>
                        <li><a href="/contribute/People.html">人</a></li>
                        <li><a href="/contribute/BYLAWS.html">按照法律规定</a></li>
                    </ul>
                </li>
                <li><a href="/2019/10/31/storm210-released.html" id="news">新闻</a></li>
            </ul>
        </nav>
    </div>
</div>



    <div class="container-fluid">
    <h1 class="page-title">代码库的结构</h1>
          <div class="row">
           	<div class="col-md-12">
	             <!-- Documentation -->

<p class="post-meta"></p>

<div class="documentation-content"><p>Storm的代码库分为三个不同的层。</p>

<p>首先，Storm从一开始就被设计为与多种语言兼容。Nimbus是Thrift服务，拓扑被定义为Thrift结构。使用Thrift可以从任何语言使用Storm。</p>

<p>其次，将所有Storm的接口都指定为Java接口。这意味着Storm的每个功能始终可以通过Java使用。</p>

<p>以下各节将更详细地解释这些层。</p>

<h3 id="storm-thrift">风暴节俭</h3>

<p>要了解Storm代码库的结构的第一个地方是<a href="http://github.com/apache/storm/blob/v2.1.0/storm-client/src/storm.thrift">storm.thrift</a>文件。</p>

<p>拓扑中的每个喷嘴或螺栓都有一个用户指定的标识符，称为“组件ID”。组件ID用于指定从螺栓到其他喷嘴或螺栓的输出流的预订。<a href="http://github.com/apache/storm/blob/v2.1.0/storm-client/src/storm.thrift">StormTopology</a>结构包含每种类型的组件（喷嘴和螺栓）从组件ID到组件的映射。</p>

<p>喷口和螺栓具有相同的Thrift定义，因此让我们来看一下<a href="http://github.com/apache/storm/blob/v2.1.0/storm-client/src/storm.thrift">bolt的Thrift定义</a> 。它包含一个<code>ComponentObject</code>结构和<code>ComponentCommon</code>结构。</p>

<p>的<code>ComponentObject</code>定义螺栓的实现。它可以是以下三种类型之一：</p>

<ol>
<li>序列化的Java对象（实现<a href="http://github.com/apache/storm/blob/v2.1.0/storm-client/src/jvm/org/apache/storm/task/IBolt.java">IBolt</a> ）</li>
<li>一种<code>ShellComponent</code>指示实现使用另一种语言的对象。通过这种方式指定一个螺栓将使Storm实例化一个<a href="http://github.com/apache/storm/blob/v2.1.0/storm-client/src/jvm/org/apache/storm/task/ShellBolt.java">ShellBolt</a>对象，以处理基于JVM的工作进程与该组件的非基于JVM的实现之间的通信。</li>
<li>一种<code>JavaObject</code>告诉Storm用于实例化螺栓的类名和构造函数参数的结构。如果要使用非JVM语言定义拓扑，这将很有用。这样，您可以利用基于JVM的喷嘴和螺栓，而不必自己创建和序列化Java对象。</li>
</ol>

<p><code>ComponentCommon</code>定义此组件的其他所有内容。这包括：</p>

<ol>
<li>该组件发出什么流以及每个流的元数据（无论是直接流还是字段声明）</li>
<li>该组件消耗的流（指定为从component_id：stream_id到要使用的流分组的映射）</li>
<li>该组件的并行性</li>
<li>该组件的特定于组件的<a href="Configuration.html">配置</a></li>
</ol>

<p>请注意，结构喷嘴还具有一个<code>ComponentCommon</code>字段，因此喷口也可以具有声明以使用其他输入流。但是，Storm Java API并未提供让Spout使用其他流的方法，并且如果在其中放置任何针对Spout的输入声明，则在尝试提交拓扑时会收到错误消息。喷口具有输入声明字段的原因不是供用户使用，而是供Storm本身使用。Storm将隐式流和螺栓添加到拓扑中以建立<a href="Acking-framework-implementation.html">acking框架</a> ，其中两个隐式流是从acker螺栓到拓扑中的每个喷口。每当检测到元组树完成或失败时，acker就会沿着这些流发送“ ack”或“ fail”消息。将用户的拓扑转换为运行时拓扑的代码位于<a href="http://github.com/apache/storm/blob/v2.1.0/storm-client/src/jvm/org/apache/storm/daemon/StormCommon.java">此处</a> 。</p>

<h3 id="java-interfaces">Java接口</h3>

<p>通常将Storm的接口指定为Java接口。主要界面是：</p>

<ol>
<li><a href="javadocs/org/apache/storm/topology/IRichBolt.html">IRichBolt</a></li>
<li><a href="javadocs/org/apache/storm/topology/IRichSpout.html">IRichSpout</a></li>
<li><a href="javadocs/org/apache/storm/topology/TopologyBuilder.html">拓扑生成器</a></li>
</ol>

<p>大多数接口的策略是：</p>

<ol>
<li>使用Java接口指定接口</li>
<li>提供一个基类，该基类在适当的时候提供默认的实现</li>
</ol>

<p>您可以在使用<a href="javadocs/org/apache/storm/topology/base/BaseRichSpout.html">BaseRichSpout</a>类时看到此策略。</p>

<p>如上所述，喷嘴和螺栓被序列化为Thrift的拓扑定义。</p>

<p>接口的一个微妙方面是<code>IBolt</code>和<code>ISpout</code>与<code>IRichBolt</code>和<code>IRichSpout</code> 。它们之间的主要区别是添加了<code>declareOutputFields</code>接口的“ Rich”版本中的方法。拆分的原因是每个输出流的输出字段声明都必须是Thrift结构的一部分（因此可以从任何语言中指定），但是作为用户，您希望能够将流声明为以下内容的一部分你的班。什么<code>TopologyBuilder</code>在构造Thrift表示形式时会执行<code>declareOutputFields</code>获取声明并将其转换为Thrift结构。转换发生在<code>TopologyBuilder</code>码。</p>

<h3 id="implementation">实作</h3>

<p>通过Java接口指定所有功能可确保通过Java使用Storm的所有功能。此外，对Java接口的关注也确保了Java领域的用户体验也令人愉悦。</p>

<p>Storm最初是在Clojure中实现的，但此后大多数代码已移植到Java。</p>

<p>以下是主要Java包用途的摘要：</p>

<h4 id="java-packages">Java包</h4>

<p><a href="http://github.com/apache/storm/tree/v2.1.0/storm-client/src/jvm/org/apache/storm/coordination">org.apache.storm.coordination</a> ：在DRPC的Storm之上实现协调批处理所需的部分。 <code>CoordinatedBolt</code>是这里最重要的一类。</p>

<p><a href="http://github.com/apache/storm/tree/v2.1.0/storm-client/src/jvm/org/apache/storm/drpc">org.apache.storm.drpc</a> ：DRPC更高级别抽象的实现</p>

<p><a href="http://github.com/apache/storm/tree/v2.1.0/storm-client/src/jvm/org/apache/storm/generated">org.apache.storm.genic</a> ：为Storm生成的Thrift代码。</p>

<p><a href="http://github.com/apache/storm/tree/v2.1.0/storm-client/src/jvm/org/apache/storm/grouping">org.apache.storm.grouping</a> ：包含用于进行自定义流分组的接口</p>

<p><a href="http://github.com/apache/storm/tree/v2.1.0/storm-client/src/jvm/org/apache/storm/hooks">org.apache.storm.hooks</a> ：接口用于钩到风暴，各种事件，例如当任务发出元组，当元组被ACK等。用户指南关于钩是<a href="Hooks.html">这里</a> 。</p>

<p><a href="http://github.com/apache/storm/tree/v2.1.0/storm-client/src/jvm/org/apache/storm/serialization">org.apache.storm.serialization</a> ：实现Storm如何序列化/反序列化元组。建立在<a href="https://github.com/EsotericSoftware/kryo">Kryo</a>之上。</p>

<p><a href="http://github.com/apache/storm/tree/v2.1.0/storm-client/src/jvm/org/apache/storm/spout">org.apache.storm.spout</a> ：spout和相关接口的定义（例如<code>SpoutOutputCollector</code> ）。还包含<code>ShellSpout</code>它实现了使用非JVM语言定义喷口的协议。</p>

<p><a href="http://github.com/apache/storm/tree/v2.1.0/storm-client/src/jvm/org/apache/storm/task">org.apache.storm.task</a> ：螺栓和相关接口的定义（例如<code>OutputCollector</code> ）。还包含<code>ShellBolt</code>它实现了使用非JVM语言定义螺栓的协议。最后， <code>TopologyContext</code>此处也定义了，它提供给喷口和螺栓，以便它们可以在运行时获取有关拓扑及其执行的数据。</p>

<p><a href="http://github.com/apache/storm/tree/v2.1.0/storm-client/src/jvm/org/apache/storm/testing">org.apache.storm.testing</a> ：包含用于Storm单元测试的各种测试螺栓和实用程序。</p>

<p><a href="http://github.com/apache/storm/tree/v2.1.0/storm-client/src/jvm/org/apache/storm/topology">org.apache.storm.topology</a> ：底层Thrift结构上的Java层为Storm提供了一个干净的纯Java API（用户不必了解Thrift）。 <code>TopologyBuilder</code>在这里，以及针对各种喷嘴和螺栓的有用的基础类。较高的水平<code>IBasicBolt</code>界面在这里，这是编写某些类型螺栓的一种更简单的方法。</p>

<p><a href="http://github.com/apache/storm/tree/v2.1.0/storm-client/src/jvm/org/apache/storm/tuple">org.apache.storm.tuple</a> ：Storm的元组数据模型的实现。</p>

<p><a href="http://github.com/apache/storm/tree/v2.1.0/storm-client/src/jvm/org/apache/storm/utils">org.apache.storm.utils</a> ：整个代码库中使用的数据结构和其他实用程序。这包括用于时间仿真的实用程序。</p>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-core/src/jvm/org/apache/storm/command">org.apache.storm.command。*</a> ：这些实现了各种命令<code>storm</code>命令行客户端。这些实现非常简短。</p>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-client/src/jvm/org/apache/storm/cluster">org.apache.storm.cluster</a> ：此代码管理通常在Zookeeper中存储集群状态（例如，什么任务在何处运行，每个任务以什么喷口/螺栓运行）的存储方式。</p>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-client/src/jvm/org/apache/storm/daemon/Acker.java">org.apache.storm.daemon。Acker</a> ：实施“ acker”螺栓，这是Storm保证数据处理的关键部分。</p>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-webapp/src/jvm/org/apache/storm/daemon/DrpcServer.java">org.apache.storm.daemon。DrpcServer</a> ：用于DRPC拓扑的DRPC服务器的实现。</p>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-server/src/jvm/org/apache/storm/event">org.apache.storm.event</a> ：实现一个简单的异步函数执行器。在Nimbus和Supervisor中的各个地方使用，以使函数串行执行以避免任何竞争情况。</p>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-server/src/main/java/org/apache/storm/LocalCluster.java">org.apache.storm。LocalCluster</a> ：用于在现有Java进程中启动Storm的实用程序。经常与<code>Testing.java</code>实施集成测试。</p>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-client/src/jvm/org/apache/storm/messaging">org.apache.storm.messaging。*</a> ：定义一个更高级别的接口来实现点对点消息传递。在本地模式下，Storm使用内存中的Java队列来执行此操作。在群集上，它使用Netty，但可插拔。</p>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-client/src/jvm/org/apache/storm/stats">org.apache.storm.stats</a> ：实现统计汇总例程的实现，该汇总例程在将统计信息发送到ZK以供UI使用时使用。是否以多种粒度进行窗口聚合和滚动聚合之类的事情。</p>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-client/src/jvm/org/apache/storm/Thrift.java">org.apache.storm。Thrift</a> ：围绕生成的Thrift API进行包装，以使使用Thrift结构更轻松。</p>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-client/src/jvm/org/apache/storm/StormTimer.java">org.apache.storm。StormTimer</a> ：实现后台计时器以在将来或定期间隔执行功能。Storm无法使用<a href="http://docs.oracle.com/javase/1.4.2/docs/api/java/util/Timer.html">Timer</a>类，因为它需要与时间仿真集成，以便能够对Nimbus和Supervisor进行单元测试。</p>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-server/src/jvm/org/apache/storm/daemon/nimbus/Nimbus.java">org.apache.storm.daemon.nimbus</a> ：Nimbus的实现。</p>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-server/src/jvm/org/apache/storm/daemon/supervisor/Supervisor.java">org.apache.storm.daemon.supervisor</a> ：Supervisor的实现。</p>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-client/src/jvm/org/apache/storm/daemon/Task.java">org.apache.storm.daemon.task</a> ：喷口或螺栓的单个任务的实现。处理UI的消息路由，序列化，统计信息收集，以及特定于喷口和特定于螺栓的执行实施。</p>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-client/src/jvm/org/apache/storm/daemon/worker/Worker.java">org.apache.storm.daemon.worker</a> ：工作进程的实现（其中将包含许多任务）。实现消息传输和任务启动。</p>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-server/src/main/java/org/apache/storm/Testing.java">org.apache.storm。测试</a> ：在测试过程中用于处理本地集群的各种实用程序，例如<code>completeTopology</code>用于通过用于捕获输出的拓扑来运行一组固定的元组，用于对检测群集何时为“空闲”进行细粒度控制的跟踪器拓扑，以及其他实用程序。</p>

<h4 id="clojure-namespaces">Clojure名称空间</h4>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-clojure/src/clj/org/apache/storm/clojure.clj">org.apache.storm.clojure</a> ：Storm的Clojure DSL的实现。</p>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-clojure/src/clj/org/apache/storm/config.clj">org.apache.storm.config</a> ：在<a href="javadocs/org/apache/storm/Config.html">Config.java中</a>为配置名称创建clojure符号</p>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-clojure/src/clj/org/apache/storm/log.clj">org.apache.storm.log</a> ：定义用于将消息记录到log4j的功能。</p>

<p><a href="http://github.com/apache/storm/blob/v2.1.0/storm-core/src/clj/org/apache/storm/ui">org.apache.storm.ui。*</a> ：实施Storm UI。完全独立于其余代码库，并使用Nimbus Thrift API获取数据。</p>
</div>


	          </div>
	       </div>
	  </div>
<footer>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>聚会</h5>
                    <ul class="latest-news">
                        
                        <li><a href="http://www.meetup.com/Apache-Storm-Apache-Kafka/">Apache Storm和Apache Kafka</a> <span class="small">（加利福尼亚州桑尼维尔）</span></li>
                        
                        <li><a href="http://www.meetup.com/Apache-Storm-Kafka-Users/">Apache Storm和Kafka用户</a> <span class="small">（华盛顿州西雅图）</span></li>
                        
                        <li><a href="http://www.meetup.com/New-York-City-Storm-User-Group/">NYC Storm用户组</a> <span class="small">（纽约州纽约）</span></li>
                        
                        <li><a href="http://www.meetup.com/Bay-Area-Stream-Processing">湾区流处理</a> <span class="small">（加利福尼亚州埃默里维尔）</span></li>
                        
                        <li><a href="http://www.meetup.com/Boston-Storm-Users/">波士顿实时数据</a> <span class="small">（马萨诸塞州波士顿）</span></li>
                        
                        <li><a href="http://www.meetup.com/storm-london">伦敦风暴用户组</a> <span class="small">（英国伦敦）</span></li>
                        
                        <!-- <li><a href="http://www.meetup.com/Apache-Storm-Kafka-Users/">Seatle, WA</a> <span class="small">(27 Jun 2015)</span></li> -->
                    </ul>
                </div>
            </div>
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>关于Apache Storm</h5>
                    <p>Apache Storm与任何排队系统和任何数据库系统集成。Apache Storm的喷口抽象使集成新排队系统变得容易。同样，将Apache Storm与数据库系统集成很容易。</p>
               </div>
            </div>
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>第一眼</h5>
                    <ul class="footer-list">
                        <li><a href="/releases/current/Rationale.html">基本原理</a></li>
                        <li><a href="/releases/current/Tutorial.html">讲解</a></li>
                        <li><a href="/releases/current/Setting-up-development-environment.html">搭建开发环境</a></li>
                        <li><a href="/releases/current/Creating-a-new-Storm-project.html">创建一个新的Apache Storm项目</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>文献资料</h5>
                    <ul class="footer-list">
                        <li><a href="/releases/current/index.html">指数</a></li>
                        <li><a href="/releases/current/javadocs/index.html">Java文档</a></li>
                        <li><a href="/releases/current/FAQ.html">常问问题</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <hr>
        <div class="row">   
            <div class="col-md-12">
                <p align="center">版权所有©2019 <a href="http://www.apache.org">Apache Software Foundation</a> 。版权所有。
                    <br>Apache Storm，Apache，Apache Feather徽标和Apache Storm项目徽标是The Apache Software Foundation的商标。
                    <br>提及的所有其他商标可能是其各自所有者的商标或注册商标。</p>
            </div>
        </div>
    </div>
</footer>
<!--Footer End-->
<!-- Scroll to top -->
<span class="totop"><a href="#"><i class="fa fa-angle-up"></i></a></span> 





</body></html>