<html ><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <title>拓扑事件检查器</title>

    <!-- Bootstrap core CSS -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="/assets/css/bootstrap-theme.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link rel="stylesheet" href="asset?aid=1">
    <link href="/css/style.css" rel="stylesheet">
    <link href="/assets/css/owl.theme.css" rel="stylesheet">
    <link href="/assets/css/owl.carousel.css" rel="stylesheet">
    <script type="text/javascript" src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/js/owl.carousel.min.js"></script>
    <script type="text/javascript" src="/assets/js/storm.js"></script>
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>


  <body >
    <header>
  <div class="container-fluid">
     <div class="row">
          <div class="col-md-5">
            <a href="/index.html"><img src="/images/logo.png" class="logo"></a>
          </div>
          <div class="col-md-5">
            
              <h1>版本：2.1.0</h1>
            
          </div>
          <div class="col-md-2">
            <a href="/downloads.html" class="btn-std btn-block btn-download">下载</a>
          </div>
        </div>
    </div>
</header>
<!--Header End-->
<!--Navigation Begin-->
<div class="navbar" role="banner">
  <div class="container-fluid">
      <div class="navbar-header">
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse"></button>
        </div>
        <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
          <ul class="nav navbar-nav">
              <li><a href="/index.html" id="home">家</a></li>
                <li><a href="/getting-help.html" id="getting-help">获得帮助</a></li>
                <li><a href="/about/integrates.html" id="project-info">项目信息</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" id="documentation" data-toggle="dropdown">文献资料<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                      
                        
                          <li><a href="/releases/2.1.0/index.html">2.1.0</a></li>
                        
                      
                        
                          <li><a href="/releases/2.0.0/index.html">2.0.0</a></li>
                        
                      
                        
                          <li><a href="/releases/1.2.3/index.html">1.2.3</a></li>
                        
                      
                    </ul>
                </li>
                <li><a href="/talksAndVideos.html">讲座和幻灯片</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" id="contribute" data-toggle="dropdown">社区<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="/contribute/Contributing-to-Storm.html">贡献</a></li>
                        <li><a href="/contribute/People.html">人</a></li>
                        <li><a href="/contribute/BYLAWS.html">按照法律规定</a></li>
                    </ul>
                </li>
                <li><a href="/2019/10/31/storm210-released.html" id="news">新闻</a></li>
            </ul>
        </nav>
    </div>
</div>



    <div class="container-fluid">
    <h1 class="page-title">拓扑事件检查器</h1>
          <div class="row">
           	<div class="col-md-12">
	             <!-- Documentation -->

<p class="post-meta"></p>

<div class="documentation-content"><h1 id="introduction">介绍</h1>

<p>拓扑事件检查器提供查看元组的能力，当元组流过风暴拓扑中的不同阶段时。这对于在运行拓扑时检查拓扑结构管道中的喷口或螺栓发出的元组很有用，而无需停止或重新部署拓扑。从喷嘴到螺栓的元组的正常流动不受打开事件日志的影响。</p>

<h2 id="enabling-event-logging">启用事件记录</h2>

<p>注意：首先需要通过将风暴配置“ topology.eventlogger.executors”设置为非零值来启用事件日志记录。请参阅“ <a href="#config">配置”</a>部分以获取更多详细信息。</p>

<p>通过单击拓扑视图中拓扑操作下的“调试”按钮，可以记录事件。这将以指定的采样百分比记录拓扑中所有喷嘴和螺栓的元组。</p>

<div align="center">
<img title="启用事件记录" src="images/enable-event-logging-topology.png" style="max-width:80rem">

<p>图1：在拓扑级别启用事件日志记录。</p>
</div>

<p>您还可以通过转到相应的组件页面并在组件操作下单击“调试”来启用特定喷口或螺栓级别的事件记录。</p>

<div align="center">
<img title="在组件级别启用事件记录" src="images/enable-event-logging-spout.png" style="max-width:80rem">

<p>图2：在组件级别启用事件日志记录。</p>
</div>

<h2 id="viewing-the-event-logs">查看事件日志</h2>

<p>Storm“ logviewer”应该正在运行以查看记录的元组。如果尚未运行，则可以通过从安装目录中运行“ bin / storm logviewer”命令来启动日志查看器。要查看元组，请从Storm UI转到特定的喷嘴或螺栓组件页面，然后单击组件摘要下方的“事件”链接（如上面的图2所示）。</p>

<p>这将打开如下图所示的视图，您可以在其中浏览不同的页面并查看记录的元组。</p>

<div align="center">
<img title="查看记录的元组" src="images/event-logs-view.png" style="max-width:80rem">

<p>图3：查看记录的事件。</p>
</div>

<p>事件日志中的每一行都包含一个条目，该条目对应于以逗号分隔格式从特定喷嘴/螺栓发出的元组。</p>

<p><code>Timestamp, Component name, Component task-id, MessageId (in case of anchoring), List of emitted values</code></p>

<h2 id="disabling-the-event-logs">禁用事件日志</h2>

<p>通过单击Storm UI中拓扑或组件操作下的“停止调试”，可以在特定组件或拓扑级别禁用事件日志记录。</p>

<div align="center">
<img title="在拓扑级别禁用事件记录" src="images/disable-event-logging-topology.png" style="max-width:80rem">

<p>图4：在拓扑级别禁用事件日志记录。</p>
</div>

<h2 id="configuration"><a name="config"></a>组态</h2>

<p>通过将事件（元组）从每个组件发送到内部事件记录器螺栓，可以进行事件记录。默认情况下，Storm不启动任何事件记录器任务，但是可以在运行拓扑时通过设置以下参数（通过在storm.yaml中进行设置或通过命令行传递选项）来轻松更改此设置。</p>

<table><thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead><tbody>
<tr>
<td>“ topology.eventlogger.executors”：0</td>
<td>没有创建事件记录器任务（默认）。</td>
</tr>
<tr>
<td>“ topology.eventlogger.executors”：1</td>
<td>拓扑的一项事件记录器任务。</td>
</tr>
<tr>
<td>“ topology.eventlogger.executors”：无</td>
<td>每个工作者一个事件记录器任务。</td>
</tr>
</tbody></table>

<h2 id="extending-eventlogging">扩展事件记录</h2>

<p>风暴提供了<code>IEventLogger</code>事件记录器螺栓用于记录事件的接口。</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="cm">/**
 * EventLogger interface for logging the event info to a sink like log file or db
 * for inspecting the events via UI for debugging.
 */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IEventLogger</span> <span class="o">{</span>
    <span class="cm">/**
    * Invoked during eventlogger bolt prepare.
    */</span>
    <span class="kt">void</span> <span class="nf">prepare</span><span class="o">(</span><span class="n">Map</span> <span class="n">stormConf</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">arguments</span><span class="o">,</span> <span class="n">TopologyContext</span> <span class="n">context</span><span class="o">);</span>

    <span class="cm">/**
     * Invoked when the {@link EventLoggerBolt} receives a tuple from the spouts or bolts that has event logging enabled.
     *
     * @param e the event
     */</span>
    <span class="kt">void</span> <span class="nf">log</span><span class="o">(</span><span class="n">EventInfo</span> <span class="n">e</span><span class="o">);</span>

    <span class="cm">/**
    * Invoked when the event logger bolt is cleaned up
    */</span>
    <span class="kt">void</span> <span class="nf">close</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>
<p>默认的实现是FileBasedEventLogger，它将事件记录到events.log文件中（ <code>logs/workers-artifacts/<topology-id>/<worker-port>/events.log</code> ）。的替代实现<code>IEventLogger</code>可以添加界面以扩展事件记录功能（例如，建立搜索索引或将事件记录在数据库中等）</p>

<p>如果您只想使用FileBasedEventLogger但要更改日志格式，则可以通过扩展FileBasedEventLogger并覆盖来简单地实现自己的<code>buildLogMessage(EventInfo)</code>明确提供日志行。</p>

<p>要将事件记录器注册到您的拓扑，请添加到拓扑的配置中，如下所示：</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">conf</span><span class="o">.</span><span class="na">registerEventLogger</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">storm</span><span class="o">.</span><span class="na">metric</span><span class="o">.</span><span class="na">FileBasedEventLogger</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</code></pre></div>
<p>您可以从Javadoc引用<a href="javadocs/org/apache/storm/Config.html#registerEventLogger-java.lang.Class-">Config＃registerEventLogger</a>和重载方法。</p>

<p>否则，请编辑storm.yaml配置文件：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="s">topology.event.logger.register</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">class</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.metric.FileBasedEventLogger"</span>
  <span class="pi">-</span> <span class="na">class</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.mycompany.MyEventLogger"</span>
    <span class="na">arguments</span><span class="pi">:</span>
      <span class="na">endpoint</span><span class="pi">:</span> <span class="s2">"</span><span class="s">event-logger.mycompany.org"</span>
</code></pre></div>
<p>当您实现自己的事件记录器时， <code>arguments</code> <string, object="">调用<a href="javadocs/org/apache/storm/metric/IEventLogger.html#prepare-java.util.Map-java.lang.Map-org.apache.storm.task.TopologyContext-">IEventLogger＃prepare</a>时</string,>将传递给Map <string, object="">。</string,></p>

<p>请记住，EventLoggerBolt只是Bolt的一种，因此当注册的事件记录器无法继续处理传入事件时，拓扑的整体吞吐量将下降，因此您可能需要像普通的Bolt一样照顾Bolt。避免这种情况的一种方法是将IEventLogger实现为<code>non-blocking</code>时尚。</p>
</div>


	          </div>
	       </div>
	  </div>
<footer>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>聚会</h5>
                    <ul class="latest-news">
                        
                        <li><a href="http://www.meetup.com/Apache-Storm-Apache-Kafka/">Apache Storm和Apache Kafka</a> <span class="small">（加利福尼亚州桑尼维尔）</span></li>
                        
                        <li><a href="http://www.meetup.com/Apache-Storm-Kafka-Users/">Apache Storm和Kafka用户</a> <span class="small">（华盛顿州西雅图）</span></li>
                        
                        <li><a href="http://www.meetup.com/New-York-City-Storm-User-Group/">NYC Storm用户组</a> <span class="small">（纽约州纽约）</span></li>
                        
                        <li><a href="http://www.meetup.com/Bay-Area-Stream-Processing">湾区流处理</a> <span class="small">（加利福尼亚州埃默里维尔）</span></li>
                        
                        <li><a href="http://www.meetup.com/Boston-Storm-Users/">波士顿实时数据</a> <span class="small">（马萨诸塞州波士顿）</span></li>
                        
                        <li><a href="http://www.meetup.com/storm-london">伦敦风暴用户组</a> <span class="small">（英国伦敦）</span></li>
                        
                        <!-- <li><a href="http://www.meetup.com/Apache-Storm-Kafka-Users/">Seatle, WA</a> <span class="small">(27 Jun 2015)</span></li> -->
                    </ul>
                </div>
            </div>
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>关于Apache Storm</h5>
                    <p>Apache Storm与任何排队系统和任何数据库系统集成。Apache Storm的喷口抽象使集成新排队系统变得容易。同样，将Apache Storm与数据库系统集成很容易。</p>
               </div>
            </div>
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>第一眼</h5>
                    <ul class="footer-list">
                        <li><a href="/releases/current/Rationale.html">基本原理</a></li>
                        <li><a href="/releases/current/Tutorial.html">讲解</a></li>
                        <li><a href="/releases/current/Setting-up-development-environment.html">搭建开发环境</a></li>
                        <li><a href="/releases/current/Creating-a-new-Storm-project.html">创建一个新的Apache Storm项目</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>文献资料</h5>
                    <ul class="footer-list">
                        <li><a href="/releases/current/index.html">指数</a></li>
                        <li><a href="/releases/current/javadocs/index.html">Java文档</a></li>
                        <li><a href="/releases/current/FAQ.html">常问问题</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <hr>
        <div class="row">   
            <div class="col-md-12">
                <p align="center">版权所有©2019 <a href="http://www.apache.org">Apache Software Foundation</a> 。版权所有。
                    <br>Apache Storm，Apache，Apache Feather徽标和Apache Storm项目徽标是The Apache Software Foundation的商标。
                    <br>提及的所有其他商标可能是其各自所有者的商标或注册商标。</p>
            </div>
        </div>
    </div>
</footer>
<!--Footer End-->
<!-- Scroll to top -->
<span class="totop"><a href="#"><i class="fa fa-angle-up"></i></a></span> 





</body></html>