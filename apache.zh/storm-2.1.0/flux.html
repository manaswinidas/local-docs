<html ><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <title>助焊剂</title>

    <!-- Bootstrap core CSS -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="/assets/css/bootstrap-theme.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link rel="stylesheet" href="asset?aid=2">
    <link href="/css/style.css" rel="stylesheet">
    <link href="/assets/css/owl.theme.css" rel="stylesheet">
    <link href="/assets/css/owl.carousel.css" rel="stylesheet">
    <script type="text/javascript" src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/js/owl.carousel.min.js"></script>
    <script type="text/javascript" src="/assets/js/storm.js"></script>
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>


  <body >
    <header>
  <div class="container-fluid">
     <div class="row">
          <div class="col-md-5">
            <a href="/index.html"><img src="/images/logo.png" class="logo"></a>
          </div>
          <div class="col-md-5">
            
              <h1>版本：2.1.0</h1>
            
          </div>
          <div class="col-md-2">
            <a href="/downloads.html" class="btn-std btn-block btn-download">下载</a>
          </div>
        </div>
    </div>
</header>
<!--Header End-->
<!--Navigation Begin-->
<div class="navbar" role="banner">
  <div class="container-fluid">
      <div class="navbar-header">
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse"></button>
        </div>
        <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
          <ul class="nav navbar-nav">
              <li><a href="/index.html" id="home">家</a></li>
                <li><a href="/getting-help.html" id="getting-help">获得帮助</a></li>
                <li><a href="/about/integrates.html" id="project-info">项目信息</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" id="documentation" data-toggle="dropdown">文献资料<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                      
                        
                          <li><a href="/releases/2.1.0/index.html">2.1.0</a></li>
                        
                      
                        
                          <li><a href="/releases/2.0.0/index.html">2.0.0</a></li>
                        
                      
                        
                          <li><a href="/releases/1.2.3/index.html">1.2.3</a></li>
                        
                      
                    </ul>
                </li>
                <li><a href="/talksAndVideos.html">讲座和幻灯片</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" id="contribute" data-toggle="dropdown">社区<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="/contribute/Contributing-to-Storm.html">贡献</a></li>
                        <li><a href="/contribute/People.html">人</a></li>
                        <li><a href="/contribute/BYLAWS.html">按照法律规定</a></li>
                    </ul>
                </li>
                <li><a href="/2019/10/31/storm210-released.html" id="news">新闻</a></li>
            </ul>
        </nav>
    </div>
</div>



    <div class="container-fluid">
    <h1 class="page-title">助焊剂</h1>
          <div class="row">
           	<div class="col-md-12">
	             <!-- Documentation -->

<p class="post-meta"></p>

<div class="documentation-content"><p>一个用于创建和部署Apache Storm流计算的框架，以减少摩擦。</p>

<h2 id="definition">定义</h2>

<p><strong>助焊剂</strong> |fləks| <em>名词</em></p>

<ol>
<li>流出的动作或过程</li>
<li>持续变化</li>
<li>在物理学中，流体，辐射能或粒子在给定区域上的流速</li>
<li>与固体混合以降低其熔点的物质</li>
</ol>

<h2 id="rationale">基本原理</h2>

<p>硬编码配置时会发生不好的事情。无需任何人重新编译或重新打包应用程序即可更改配置。</p>

<h2 id="about">关于</h2>

<p>Flux是一个框架和一组实用程序，可让您轻松定义和部署Apache Storm拓扑，并且不会占用大量开发人员。经常提到的痛苦点之一是，拓扑图的布线通常用Java代码捆绑在一起，并且任何更改都需要重新编译和重新打包拓扑jar文件。Flux旨在通过允许您将所有Storm组件打包在一个jar中，并使用外部文本文件来定义拓扑的布局和配置，以减轻这种痛苦。</p>

<h2 id="features">特征</h2>

<ul>
<li>轻松配置和部署Storm拓扑（Storm核心和Microbatch API），而无需在拓扑代码中嵌入配置</li>
<li>支持现有的拓扑代码（请参见下文）</li>
<li>使用灵活的YAML DSL定义Storm Core API（喷口/螺栓）</li>
<li>对大多数Storm组件（storm-kafka-client，storm-hdfs，storm-hbase等）的YAML DSL支持</li>
<li>方便地支持多语言组件</li>
<li>外部属性替换/过滤，可轻松在配置/环境之间切换（类似于Maven风格<code>${variable.name}</code>替代）</li>
</ul>

<h2 id="usage">用法</h2>

<p>要使用Flux，请将其添加为依赖项并将所有Storm组件打包在一个胖子罐中，然后创建一个YAML文档来定义您的拓扑（有关YAML配置选项，请参见下文）。</p>

<h3 id="building-from-source">从源头建造</h3>

<p>使用Flux的最简单方法是，如下所述将其添加为项目中的Maven依赖项。</p>

<p>如果您想从源代码构建Flux并运行单元/集成测试，则需要在系统上安装以下组件：</p>

<ul>
<li>Python 2.6.x或更高版本</li>
<li>Node.js 0.10.x或更高版本</li>
</ul>

<h4 id="building-with-unit-tests-enabled">在启用单元测试的情况下进行构建：</h4>
<div class="highlight"><pre><code class="language-" data-lang="">mvn clean install
</code></pre></div>
<h4 id="building-with-unit-tests-disabled">在禁用单元测试的情况下进行构建：</h4>

<p>如果您想在不安装Python或Node.js的情况下构建Flux，则可以跳过单元测试：</p>
<div class="highlight"><pre><code class="language-" data-lang="">mvn clean install -DskipTests=true
</code></pre></div>
<p>请注意，如果您计划使用Flux将拓扑部署到远程集群，则仍然需要安装Python，因为Apache Storm需要它。</p>

<h4 id="building-with-integration-tests-enabled">在启用集成测试的情况下进行构建：</h4>
<div class="highlight"><pre><code class="language-" data-lang="">mvn clean install -DskipIntegration=false
</code></pre></div>
<h3 id="packaging-with-maven">用Maven包装</h3>

<p>要为您的Storm组件启用Flux，您需要将其添加为依赖项，以使其包含在Storm拓扑jar中。这可以通过Maven阴影插件（首选）或Maven组件插件（不推荐）来完成。</p>

<h4 id="flux-maven-dependency">助焊剂Maven依赖</h4>

<p>当前版本的Flux在Maven Central中的以下坐标处可用：<code>xml <dependency> <groupId>org.apache.storm</groupId> <artifactId>flux-core</artifactId> <version>${storm.version}</version> </dependency></code></p>

<p>使用壳体喷口和螺栓需要其他Flux Wrappers库：<code>xml <dependency> <groupId>org.apache.storm</groupId> <artifactId>flux-wrappers</artifactId> <version>${storm.version}</version> </dependency></code></p>

<h4 id="creating-a-flux-enabled-topology-jar">创建启用磁通的拓扑JAR</h4>

<p>下面的示例说明了Maven阴影插件对Flux的使用：</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- include Flux and user dependencies in the shaded jar --&gt;</span>
<span class="nt">&lt;dependencies&gt;</span>
    <span class="c">&lt;!-- Flux include --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.storm<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>flux-core<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${storm.version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="c">&lt;!-- Flux Wrappers include --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.storm<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>flux-wrappers<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${storm.version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="c">&lt;!-- add user dependencies here... --&gt;</span>

<span class="nt">&lt;/dependencies&gt;</span>
<span class="c">&lt;!-- create a fat jar that includes all dependencies --&gt;</span>
<span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
        <span class="nt">&lt;plugin&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>maven-shade-plugin<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.4<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
                <span class="nt">&lt;createDependencyReducedPom&gt;</span>true<span class="nt">&lt;/createDependencyReducedPom&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;executions&gt;</span>
                <span class="nt">&lt;execution&gt;</span>
                    <span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
                    <span class="nt">&lt;goals&gt;</span>
                        <span class="nt">&lt;goal&gt;</span>shade<span class="nt">&lt;/goal&gt;</span>
                    <span class="nt">&lt;/goals&gt;</span>
                    <span class="nt">&lt;configuration&gt;</span>
                        <span class="nt">&lt;transformers&gt;</span>
                            <span class="nt">&lt;transformer</span>
                                    <span class="na">implementation=</span><span class="s">"org.apache.maven.plugins.shade.resource.ServicesResourceTransformer"</span><span class="nt">/&gt;</span>
                            <span class="nt">&lt;transformer</span>
                                    <span class="na">implementation=</span><span class="s">"org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;mainClass&gt;</span>org.apache.storm.flux.Flux<span class="nt">&lt;/mainClass&gt;</span>
                            <span class="nt">&lt;/transformer&gt;</span>
                        <span class="nt">&lt;/transformers&gt;</span>
                    <span class="nt">&lt;/configuration&gt;</span>
                <span class="nt">&lt;/execution&gt;</span>
            <span class="nt">&lt;/executions&gt;</span>
        <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
<span class="nt">&lt;/build&gt;</span>
</code></pre></div>
<h3 id="deploying-and-running-a-flux-topology">部署和运行磁通拓扑</h3>

<p>将拓扑组件与Flux相关性打包在一起后，您可以使用以下命令在本地或远程运行不同的拓扑<code>storm jar</code>命令。例如，如果您的胖子罐命名为<code>myTopology-0.1.0-SNAPSHOT.jar</code>您可以使用以下命令在本地运行：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">storm jar myTopology-0.1.0-SNAPSHOT.jar org.apache.storm.flux.Flux <span class="nt">--local</span> my_config.yaml

</code></pre></div>
<h3 id="command-line-options">命令行选项</h3>
<div class="highlight"><pre><code class="language-" data-lang="">usage: storm jar &lt;my_topology_uber_jar.jar&gt; org.apache.storm.flux.Flux
             [options] &lt;topology-config.yaml&gt;
 -d,--dry-run                 Do not run or deploy the topology. Just
                              build, validate, and print information about
                              the topology.
 -e,--env-filter              Perform environment variable substitution.
                              Replace keys identified with `${ENV-[NAME]}`
                              will be replaced with the corresponding
                              `NAME` environment value
 -f,--filter &lt;file&gt;           Perform property substitution. Use the
                              specified file as a source of properties,
                              and replace keys identified with {$[property
                              name]} with the value defined in the
                              properties file.
 -i,--inactive                Deploy the topology, but do not activate it.
 -l,--local                   Run the topology in local mode.
 -n,--no-splash               Suppress the printing of the splash screen.
 -q,--no-detail               Suppress the printing of topology details.
 -r,--remote                  Deploy the topology to a remote cluster.
 -R,--resource                Treat the supplied path as a classpath
                              resource instead of a file.
 -s,--sleep &lt;ms&gt;              When running locally, the amount of time to
                              sleep (in ms.) before killing the topology
                              and shutting down the local cluster.
 -z,--zookeeper &lt;host:port&gt;   When running in local mode, use the
                              ZooKeeper at the specified &lt;host&gt;:&lt;port&gt;
                              instead of the in-process ZooKeeper.
                              (requires Storm 0.9.3 or later)
</code></pre></div>
<p><strong>注意：</strong> Flux试图避免命令行开关与<code>storm</code>命令，并允许其他任何命令行开关传递给<code>storm</code>命令。</p>

<p>例如，您可以使用<code>storm</code>命令开关<code>-c</code>覆盖拓扑配置属性。以下示例命令将运行Flux并覆盖<code>nimbus.seeds</code>组态：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">storm jar myTopology-0.1.0-SNAPSHOT.jar org.apache.storm.flux.Flux <span class="nt">--remote</span> my_config.yaml <span class="nt">-c</span> <span class="s1">'nimbus.seeds=["localhost"]'</span>
</code></pre></div>
<h3 id="sample-output">样品输出</h3>
<div class="highlight"><pre><code class="language-" data-lang="">███████╗██╗     ██╗   ██╗██╗  ██╗
██╔════╝██║     ██║   ██║╚██╗██╔╝
█████╗  ██║     ██║   ██║ ╚███╔╝
██╔══╝  ██║     ██║   ██║ ██╔██╗
██║     ███████╗╚██████╔╝██╔╝ ██╗
╚═╝     ╚══════╝ ╚═════╝ ╚═╝  ╚═╝
+-         Apache Storm        -+
+-  data FLow User eXperience  -+
Version: 0.3.0
Parsing file: /Users/hsimpson/Projects/donut_domination/storm/shell_test.yaml
---------- TOPOLOGY DETAILS ----------
Name: shell-topology
--------------- SPOUTS ---------------
sentence-spout[1](org.apache.storm.flux.wrappers.spouts.FluxShellSpout)
---------------- BOLTS ---------------
splitsentence[1](org.apache.storm.flux.wrappers.bolts.FluxShellBolt)
log[1](org.apache.storm.flux.wrappers.bolts.LogInfoBolt)
count[1](org.apache.storm.testing.TestWordCounter)
--------------- STREAMS ---------------
sentence-spout --SHUFFLE--&gt; splitsentence
splitsentence --FIELDS--&gt; count
count --SHUFFLE--&gt; log
--------------------------------------
Submitting topology: 'shell-topology' to remote cluster...
</code></pre></div>
<h2 id="yaml-configuration">YAML配置</h2>

<p>磁通拓扑在描述拓扑的YAML文件中定义。Flux拓扑定义包括以下内容：</p>

<ol>
<li>拓扑名称</li>
<li>拓扑“组件”（将在环境中提供的名为Java对象）的列表</li>
<li><strong>以太网</strong> （DSL拓扑定义）：<ul>
<li>喷口列表，每个喷口都由唯一的ID标识</li>
<li>螺栓列表，每个螺栓都有唯一的ID标识</li>
<li>“流”对象的列表，表示喷嘴和螺栓之间的元组流</li>
</ul></li>
<li><strong>或</strong> （可以产生<code>org.apache.storm.generated.StormTopology</code>实例：<ul>
<li>一种<code>topologySource</code>定义。</li>
</ul></li>
</ol>

<p>例如，这是使用YAML DSL的单词计数拓扑的简单定义：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">yaml-topology"</span>
<span class="na">config</span><span class="pi">:</span>
  <span class="s">topology.workers</span><span class="pi">:</span> <span class="s">1</span>

<span class="c1"># spout definitions</span>
<span class="na">spouts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">spout-1"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.testing.TestWordSpout"</span>
    <span class="na">parallelism</span><span class="pi">:</span> <span class="s">1</span>

<span class="c1"># bolt definitions</span>
<span class="na">bolts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bolt-1"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.testing.TestWordCounter"</span>
    <span class="na">parallelism</span><span class="pi">:</span> <span class="s">1</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bolt-2"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.flux.wrappers.bolts.LogInfoBolt"</span>
    <span class="na">parallelism</span><span class="pi">:</span> <span class="s">1</span>

<span class="c1">#stream definitions</span>
<span class="na">streams</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">spout-1</span><span class="nv"> </span><span class="s">--&gt;</span><span class="nv"> </span><span class="s">bolt-1"</span> <span class="c1"># name isn't used (placeholder for logging, UI, etc.)</span>
    <span class="na">from</span><span class="pi">:</span> <span class="s2">"</span><span class="s">spout-1"</span>
    <span class="na">to</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bolt-1"</span>
    <span class="na">grouping</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">FIELDS</span>
      <span class="na">args</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">word"</span><span class="pi">]</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bolt-1</span><span class="nv"> </span><span class="s">--&gt;</span><span class="nv"> </span><span class="s">bolt2"</span>
    <span class="na">from</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bolt-1"</span>
    <span class="na">to</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bolt-2"</span>
    <span class="na">grouping</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">SHUFFLE</span>


</code></pre></div>
<h2 id="property-substitution-filtering">财产替代/过滤</h2>

<p>开发人员通常希望在配置之间轻松切换，例如在开发环境和生产环境之间切换部署。这可以通过使用单独的YAML配置文件来完成，但是这种方法会导致不必要的重复，尤其是在Storm拓扑没有更改但配置设置（例如主机名，端口和并行参数）确实发生更改的情况下。</p>

<p>在这种情况下，Flux提供了属性过滤功能，允许您将两个值外部化为一个<code>.properties</code>文件并在替换之前将其替换<code>.yaml</code>文件被解析。</p>

<p>要启用属性过滤，请使用<code>--filter</code>命令行选项并指定一个<code>.properties</code>文件。例如，如果您这样调用flux：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">storm jar myTopology-0.1.0-SNAPSHOT.jar org.apache.storm.flux.Flux <span class="nt">--local</span> my_config.yaml <span class="nt">--filter</span> dev.properties
</code></pre></div>
<p>随着以下<code>dev.properties</code>文件：</p>
<div class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="py">kafka.zookeeper.hosts</span><span class="p">:</span> <span class="s">localhost:2181</span>
</code></pre></div>
<p>然后，您将可以通过键入以下内容来引用这些属性<code>.yaml</code>文件使用<code>${}</code>句法：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml">  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">zkHosts"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.kafka.ZkHosts"</span>
    <span class="na">constructorArgs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">${kafka.zookeeper.hosts}"</span>
</code></pre></div>
<p>在这种情况下，助焊剂将取代<code>${kafka.zookeeper.hosts}</code>与<code>localhost:2181</code>在解析YAML内容之前。</p>

<h3 id="environment-variable-substitution-filtering">环境变量替换/过滤</h3>

<p>助焊剂还允许替换环境变量。例如，如果一个环境变量名为<code>ZK_HOSTS</code>如果已定义，则可以使用以下语法在Flux YAML文件中引用它：</p>
<div class="highlight"><pre><code class="language-" data-lang="">${ENV-ZK_HOSTS}
</code></pre></div>
<h2 id="components">组件</h2>

<p>组件本质上是命名的对象实例，可作为喷嘴和螺栓的配置选项使用。如果您熟悉Spring框架，则组件与Spring bean大致相似。</p>

<p>每个组件至少由唯一标识符（字符串）和类名（字符串）标识。例如，以下将成为<code>org.apache.storm.kafka.StringScheme</code>该类可作为键下的参考<code>"stringScheme"</code> 。假设<code>org.apache.storm.kafka.StringScheme</code>有一个默认的构造函数。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">components</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">stringScheme"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.kafka.StringScheme"</span>
</code></pre></div>
<h3 id="static-factory-methods">静态工厂方法</h3>

<p>也可以使用Flux的静态工厂方法。给出以下Java代码：</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestBolt</span> <span class="kd">extends</span> <span class="n">BaseBasicBolt</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">TestBolt</span> <span class="nf">newInstance</span><span class="o">(</span><span class="n">Duration</span> <span class="n">triggerTime</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">TestBolt</span><span class="o">(</span><span class="n">triggerTime</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Duration</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Duration</span> <span class="nf">ofSeconds</span><span class="o">(</span><span class="kt">long</span> <span class="n">seconds</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Duration</span><span class="o">(</span><span class="n">seconds</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>可以使用以下工厂方法：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">components</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">time"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">java.time.Duration"</span>
    <span class="na">factory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ofSeconds"</span>

<span class="na">bolts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">testBolt"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.flux.test.TestBolt"</span>
    <span class="na">factory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">newInstance"</span>
    <span class="na">factoryArgs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">ref</span><span class="pi">:</span> <span class="s2">"</span><span class="s">time"</span>
</code></pre></div>
<h3 id="contructor-arguments-references-properties-and-configuration-methods">构造函数参数，参考，属性和配置方法</h3>

<h4 id="constructor-arguments">构造函数参数</h4>

<p>可以通过添加一个<code>contructorArgs</code>组件的元素。
<code>constructorArgs</code>是将传递给类的构造函数的对象列表。下面的示例通过调用以单个字符串作为参数的构造函数来创建对象：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml">  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">zkHosts"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.kafka.ZkHosts"</span>
    <span class="na">constructorArgs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">localhost:2181"</span>
</code></pre></div>
<h4 id="references">参考文献</h4>

<p>每个组件实例由唯一的ID标识，该ID允许其他组件使用/重用它。要引用现有组件，请使用<code>ref</code>标签。</p>

<p>在以下示例中，具有ID的组件<code>"stringScheme"</code>创建并稍后引用，作为另一个组件的构造函数的参数：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">components</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">stringScheme"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.kafka.StringScheme"</span>

  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">stringMultiScheme"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.spout.SchemeAsMultiScheme"</span>
    <span class="na">constructorArgs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">ref</span><span class="pi">:</span> <span class="s2">"</span><span class="s">stringScheme"</span> <span class="c1"># component with id "stringScheme" must be declared above.</span>
</code></pre></div>
<p><strong>注意：</strong>引用只能在它们所指向的对象之后（下方）被使用。</p>

<h4 id="properties">性质</h4>

<p>除了使用不同的参数调用构造函数外，Flux还允许您使用类似于JavaBean的setter方法和声明为<code>public</code> ：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml">  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">spoutConfig"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.kafka.SpoutConfig"</span>
    <span class="na">constructorArgs</span><span class="pi">:</span>
      <span class="c1"># brokerHosts</span>
      <span class="pi">-</span> <span class="na">ref</span><span class="pi">:</span> <span class="s2">"</span><span class="s">zkHosts"</span>
      <span class="c1"># topic</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">myKafkaTopic"</span>
      <span class="c1"># zkRoot</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">/kafkaSpout"</span>
      <span class="c1"># id</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">myId"</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ignoreZkOffsets"</span>
        <span class="na">value</span><span class="pi">:</span> <span class="no">true</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">scheme"</span>
        <span class="na">ref</span><span class="pi">:</span> <span class="s2">"</span><span class="s">stringMultiScheme"</span>
</code></pre></div>
<p>在上面的示例中， <code>properties</code>声明将导致Flux在<code>SpoutConfig</code>签名<code>setIgnoreZkOffsets(boolean b)</code>并尝试调用它。如果未找到setter方法，则Flux将查找名称为的公共实例变量<code>ignoreZkOffsets</code>并尝试设置其值。</p>

<p>引用也可以用作属性值。</p>

<h4 id="configuration-methods">配置方法</h4>

<p>从概念上讲，配置方法类似于“属性”和“构造函数Args”-它们使您可以在构造对象后调用对象上的任意方法。配置方法对于使用不公开JavaBean方法或具有可以完全配置对象的构造函数的类很有用。常见示例包括使用构建器模式进行配置/组合的类。</p>

<p>以下YAML示例创建螺栓并通过调用多种方法对其进行配置：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">bolts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bolt-1"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.flux.test.TestBolt"</span>
    <span class="na">parallelism</span><span class="pi">:</span> <span class="s">1</span>
    <span class="na">configMethods</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">withFoo"</span>
        <span class="na">args</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">foo"</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">withBar"</span>
        <span class="na">args</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">bar"</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">withFooBar"</span>
        <span class="na">args</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">foo"</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">bar"</span>
</code></pre></div>
<p>相应方法的签名如下：</p>
<div class="highlight"><pre><code class="language-java" data-lang="java">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">withFoo</span><span class="o">(</span><span class="n">String</span> <span class="n">foo</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">withBar</span><span class="o">(</span><span class="n">String</span> <span class="n">bar</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">withFooBar</span><span class="o">(</span><span class="n">String</span> <span class="n">foo</span><span class="o">,</span> <span class="n">String</span> <span class="n">bar</span><span class="o">);</span>
</code></pre></div>
<p>传递给配置方法的参数与构造函数参数的工作方式几乎相同，并且也支持引用。</p>

<h3 id="using-java-enums-in-contructor-arguments-references-properties-and-configuration-methods">使用Java <code>enum</code>构造函数参数，参考，属性和配置方法中的</h3>

<p>您可以轻松使用Java <code>enum</code>只需引用Flux YAML文件中的名称即可将这些值作为参数<code>enum</code> 。</p>

<p>例如， <a href="storm-hdfs.html">Storm的HDFS模块</a>包括以下内容<code>enum</code>定义（为简便起见简化）：</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">enum</span> <span class="n">Units</span> <span class="o">{</span>
    <span class="n">KB</span><span class="o">,</span> <span class="n">MB</span><span class="o">,</span> <span class="n">GB</span><span class="o">,</span> <span class="n">TB</span>
<span class="o">}</span>
</code></pre></div>
<p>和<code>org.apache.storm.hdfs.bolt.rotation.FileSizeRotationPolicy</code>类具有以下构造函数：</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="nf">FileSizeRotationPolicy</span><span class="o">(</span><span class="kt">float</span> <span class="n">count</span><span class="o">,</span> <span class="n">Units</span> <span class="n">units</span><span class="o">)</span>

</code></pre></div>
<p>以下助焊剂<code>component</code>定义可用于调用构造函数：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml">  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">rotationPolicy"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.hdfs.bolt.rotation.FileSizeRotationPolicy"</span>
    <span class="na">constructorArgs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">5.0</span>
      <span class="pi">-</span> <span class="s">MB</span>
</code></pre></div>
<p>上面的定义在功能上等同于以下Java代码：</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// rotate files when they reach 5MB</span>
<span class="n">FileRotationPolicy</span> <span class="n">rotationPolicy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileSizeRotationPolicy</span><span class="o">(</span><span class="mf">5.0f</span><span class="o">,</span> <span class="n">Units</span><span class="o">.</span><span class="na">MB</span><span class="o">);</span>
</code></pre></div>
<h2 id="topology-config">拓扑配置</h2>

<p>的<code>config</code>部分仅是将传递到<code>org.apache.storm.StormSubmitter</code>作为<code>org.apache.storm.Config</code>类：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">config</span><span class="pi">:</span>
  <span class="s">topology.workers</span><span class="pi">:</span> <span class="s">4</span>
  <span class="s">topology.max.spout.pending</span><span class="pi">:</span> <span class="s">1000</span>
  <span class="s">topology.message.timeout.secs</span><span class="pi">:</span> <span class="s">30</span>
</code></pre></div>
<h1 id="existing-topologies">现有拓扑</h1>

<p>如果您已有现有的Storm拓扑，则仍可以使用Flux部署/运行/测试它们。此功能使您可以将Flux构造函数参数，引用，属性和拓扑配置声明用于现有拓扑类。</p>

<p>使用现有拓扑类的最简单方法是定义一个<code>getTopology()</code>具有以下签名之一的实例方法：</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="n">StormTopology</span> <span class="nf">getTopology</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">config</span><span class="o">)</span>
</code></pre></div>
<p>要么：</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="n">StormTopology</span> <span class="nf">getTopology</span><span class="o">(</span><span class="n">Config</span> <span class="n">config</span><span class="o">)</span>
</code></pre></div>
<p>然后，您可以使用以下YAML配置拓扑：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">existing-topology"</span>
<span class="na">topologySource</span><span class="pi">:</span>
  <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.flux.test.SimpleTopology"</span>
</code></pre></div>
<p>如果您要用作拓扑源的类具有不同的方法名称（即<code>getTopology</code> ），您可以覆盖它：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">existing-topology"</span>
<span class="na">topologySource</span><span class="pi">:</span>
  <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.flux.test.SimpleTopology"</span>
  <span class="na">methodName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">getTopologyWithDifferentMethodName"</span>
</code></pre></div>
<p><strong>注意：</strong>指定的方法必须接受单个类型的参数<code>java.util.Map<String, Object></code>要么<code>org.apache.storm.Config</code> ，然后传回<code>org.apache.storm.generated.StormTopology</code>宾语。</p>

<h1 id="yaml-dsl">YAML DSL</h1>

<h2 id="spouts-and-bolts">喷嘴和螺栓</h2>

<p>喷口和螺栓在YAML配置的各自部分中配置。Spout和Bolt定义是对<code>component</code>添加一个定义<code>parallelism</code>用于在部署拓扑时为组件设置并行性的参数。</p>

<p>因为喷口和螺栓定义扩展了<code>component</code>它们也支持构造函数参数，引用和属性。</p>

<p>外壳喷口示例：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">spouts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">sentence-spout"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.flux.wrappers.spouts.FluxShellSpout"</span>
    <span class="c1"># shell spout constructor takes 2 arguments: String[], String[]</span>
    <span class="na">constructorArgs</span><span class="pi">:</span>
      <span class="c1"># command line</span>
      <span class="pi">-</span> <span class="pi">[</span><span class="s2">"</span><span class="s">node"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">randomsentence.js"</span><span class="pi">]</span>
      <span class="c1"># output fields</span>
      <span class="pi">-</span> <span class="pi">[</span><span class="s2">"</span><span class="s">word"</span><span class="pi">]</span>
    <span class="na">parallelism</span><span class="pi">:</span> <span class="s">1</span>
</code></pre></div>
<p>卡夫卡喷口示例：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">components</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">stringScheme"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.kafka.StringScheme"</span>

  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">stringMultiScheme"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.spout.SchemeAsMultiScheme"</span>
    <span class="na">constructorArgs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">ref</span><span class="pi">:</span> <span class="s2">"</span><span class="s">stringScheme"</span>

  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">zkHosts"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.kafka.ZkHosts"</span>
    <span class="na">constructorArgs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">localhost:2181"</span>

<span class="c1"># Alternative kafka config</span>
<span class="c1">#  - id: "kafkaConfig"</span>
<span class="c1">#    className: "org.apache.storm.kafka.KafkaConfig"</span>
<span class="c1">#    constructorArgs:</span>
<span class="c1">#      # brokerHosts</span>
<span class="c1">#      - ref: "zkHosts"</span>
<span class="c1">#      # topic</span>
<span class="c1">#      - "myKafkaTopic"</span>
<span class="c1">#      # clientId (optional)</span>
<span class="c1">#      - "myKafkaClientId"</span>

  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">spoutConfig"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.kafka.SpoutConfig"</span>
    <span class="na">constructorArgs</span><span class="pi">:</span>
      <span class="c1"># brokerHosts</span>
      <span class="pi">-</span> <span class="na">ref</span><span class="pi">:</span> <span class="s2">"</span><span class="s">zkHosts"</span>
      <span class="c1"># topic</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">myKafkaTopic"</span>
      <span class="c1"># zkRoot</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">/kafkaSpout"</span>
      <span class="c1"># id</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">myId"</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ignoreZkOffsets"</span>
        <span class="na">value</span><span class="pi">:</span> <span class="no">true</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">scheme"</span>
        <span class="na">ref</span><span class="pi">:</span> <span class="s2">"</span><span class="s">stringMultiScheme"</span>

<span class="na">config</span><span class="pi">:</span>
  <span class="s">topology.workers</span><span class="pi">:</span> <span class="s">1</span>

<span class="c1"># spout definitions</span>
<span class="na">spouts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">kafka-spout"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.kafka.KafkaSpout"</span>
    <span class="na">constructorArgs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">ref</span><span class="pi">:</span> <span class="s2">"</span><span class="s">spoutConfig"</span>

</code></pre></div>
<p>螺栓示例：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="c1"># bolt definitions</span>
<span class="na">bolts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">splitsentence"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.flux.wrappers.bolts.FluxShellBolt"</span>
    <span class="na">constructorArgs</span><span class="pi">:</span>
      <span class="c1"># command line</span>
      <span class="pi">-</span> <span class="pi">[</span><span class="s2">"</span><span class="s">python"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">splitsentence.py"</span><span class="pi">]</span>
      <span class="c1"># output fields</span>
      <span class="pi">-</span> <span class="pi">[</span><span class="s2">"</span><span class="s">word"</span><span class="pi">]</span>
    <span class="na">parallelism</span><span class="pi">:</span> <span class="s">1</span>
    <span class="c1"># ...</span>

  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">log"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.flux.wrappers.bolts.LogInfoBolt"</span>
    <span class="na">parallelism</span><span class="pi">:</span> <span class="s">1</span>
    <span class="c1"># ...</span>

  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">count"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.testing.TestWordCounter"</span>
    <span class="na">parallelism</span><span class="pi">:</span> <span class="s">1</span>
    <span class="c1"># ...</span>
</code></pre></div>
<h2 id="streams-and-stream-groupings">流和流分组</h2>

<p>Flux中的流表示为拓扑中喷口和螺栓之间的连接列表（图形边缘，数据流等），并带有关联的分组定义。</p>

<p>流定义具有以下属性：</p>

<p><strong><code>name</code> ：</strong>连接的名称（可选，当前未使用）</p>

<p><strong><code>from</code> ：</strong> <code>id</code>源（发布者）的喷口或螺栓的数量</p>

<p><strong><code>to</code> ：</strong> <code>id</code>作为目标（订户）的喷嘴或螺栓的数量</p>

<p><strong><code>grouping</code> ：</strong>流的流分组定义</p>

<p>分组定义具有以下属性：</p>

<p><strong><code>type</code> ：</strong>分组类型。之一<code>ALL</code> ， <code>CUSTOM</code> ， <code>DIRECT</code> ， <code>SHUFFLE</code> ， <code>LOCAL_OR_SHUFFLE</code> ， <code>FIELDS</code> ， <code>GLOBAL</code> ， 要么<code>NONE</code> 。</p>

<p><strong><code>streamId</code> ：</strong>风暴流ID（可选。如果未指定，将使用默认流）</p>

<p><strong><code>args</code> ：</strong>对于<code>FIELDS</code>分组，字段名称列表。</p>

<p><strong><code>customClass</code></strong>为了<code>CUSTOM</code>分组，自定义分组类实例的定义</p>

<p>的<code>streams</code>下面的定义示例使用以下布线设置拓扑：</p>
<div class="highlight"><pre><code class="language-" data-lang="">    kafka-spout --&gt; splitsentence --&gt; count --&gt; log
</code></pre></div><div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="c1">#stream definitions</span>
<span class="c1"># stream definitions define connections between spouts and bolts.</span>
<span class="c1"># note that such connections can be cyclical</span>
<span class="c1"># custom stream groupings are also supported</span>

<span class="na">streams</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">kafka</span><span class="nv"> </span><span class="s">--&gt;</span><span class="nv"> </span><span class="s">split"</span> <span class="c1"># name isn't used (placeholder for logging, UI, etc.)</span>
    <span class="na">from</span><span class="pi">:</span> <span class="s2">"</span><span class="s">kafka-spout"</span>
    <span class="na">to</span><span class="pi">:</span> <span class="s2">"</span><span class="s">splitsentence"</span>
    <span class="na">grouping</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">SHUFFLE</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">split</span><span class="nv"> </span><span class="s">--&gt;</span><span class="nv"> </span><span class="s">count"</span>
    <span class="na">from</span><span class="pi">:</span> <span class="s2">"</span><span class="s">splitsentence"</span>
    <span class="na">to</span><span class="pi">:</span> <span class="s2">"</span><span class="s">count"</span>
    <span class="na">grouping</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">FIELDS</span>
      <span class="na">args</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">word"</span><span class="pi">]</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">count</span><span class="nv"> </span><span class="s">--&gt;</span><span class="nv"> </span><span class="s">log"</span>
    <span class="na">from</span><span class="pi">:</span> <span class="s2">"</span><span class="s">count"</span>
    <span class="na">to</span><span class="pi">:</span> <span class="s2">"</span><span class="s">log"</span>
    <span class="na">grouping</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">SHUFFLE</span>
</code></pre></div>
<h3 id="custom-stream-groupings">自定义流分组</h3>

<p>通过将分组类型设置为来定义自定义流分组<code>CUSTOM</code>并定义一个<code>customClass</code>告诉Flux如何实例化自定义类的参数。的<code>customClass</code>定义扩展<code>component</code> ，因此它也支持构造函数参数，引用和属性。</p>

<p>下面的示例使用一个实例创建一个Stream <code>org.apache.storm.testing.NGrouping</code>自定义流分组类。</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml">  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bolt-1</span><span class="nv"> </span><span class="s">--&gt;</span><span class="nv"> </span><span class="s">bolt2"</span>
    <span class="na">from</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bolt-1"</span>
    <span class="na">to</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bolt-2"</span>
    <span class="na">grouping</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">CUSTOM</span>
      <span class="na">customClass</span><span class="pi">:</span>
        <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.testing.NGrouping"</span>
        <span class="na">constructorArgs</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">1</span>
</code></pre></div>
<h2 id="includes-and-overrides">包含和覆盖</h2>

<p>Flux允许您包含其他YAML文件的内容，并将它们视为在同一文件中定义。包括文件或类路径资源。</p>

<p>包含项指定为地图列表：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">includes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">resource</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">src/test/resources/configs/shell_test.yaml"</span>
    <span class="na">override</span><span class="pi">:</span> <span class="no">false</span>
</code></pre></div>
<p>如果<code>resource</code>属性设置为<code>true</code> ，则include将从的值作为类路径资源加载<code>file</code>属性，否则将被视为常规文件。</p>

<p>的<code>override</code>属性控制包含如何影响当前文件中定义的值。如果<code>override</code>被设定为<code>true</code> ，包含文件中的值将替换正在解析的当前文件中的值。如果<code>override</code>被设定为<code>false</code> ，当前文件中正在解析的值将具有优先权，而解析器将拒绝替换它们。</p>

<p><strong>注意：</strong>包含尚未递归。包含文件中的包含将被忽略。</p>

<h2 id="basic-word-count-example">基本字数示例</h2>

<p>本示例使用以JavaScript实现的喷口，以Python实现的螺栓和以Java实现的螺栓</p>

<p>拓扑YAML配置：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">shell-topology"</span>
<span class="na">config</span><span class="pi">:</span>
  <span class="s">topology.workers</span><span class="pi">:</span> <span class="s">1</span>

<span class="c1"># spout definitions</span>
<span class="na">spouts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">sentence-spout"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.flux.wrappers.spouts.FluxShellSpout"</span>
    <span class="c1"># shell spout constructor takes 2 arguments: String[], String[]</span>
    <span class="na">constructorArgs</span><span class="pi">:</span>
      <span class="c1"># command line</span>
      <span class="pi">-</span> <span class="pi">[</span><span class="s2">"</span><span class="s">node"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">randomsentence.js"</span><span class="pi">]</span>
      <span class="c1"># output fields</span>
      <span class="pi">-</span> <span class="pi">[</span><span class="s2">"</span><span class="s">word"</span><span class="pi">]</span>
    <span class="na">parallelism</span><span class="pi">:</span> <span class="s">1</span>

<span class="c1"># bolt definitions</span>
<span class="na">bolts</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">splitsentence"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.flux.wrappers.bolts.FluxShellBolt"</span>
    <span class="na">constructorArgs</span><span class="pi">:</span>
      <span class="c1"># command line</span>
      <span class="pi">-</span> <span class="pi">[</span><span class="s2">"</span><span class="s">python"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">splitsentence.py"</span><span class="pi">]</span>
      <span class="c1"># output fields</span>
      <span class="pi">-</span> <span class="pi">[</span><span class="s2">"</span><span class="s">word"</span><span class="pi">]</span>
    <span class="na">parallelism</span><span class="pi">:</span> <span class="s">1</span>

  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">log"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.flux.wrappers.bolts.LogInfoBolt"</span>
    <span class="na">parallelism</span><span class="pi">:</span> <span class="s">1</span>

  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">count"</span>
    <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.testing.TestWordCounter"</span>
    <span class="na">parallelism</span><span class="pi">:</span> <span class="s">1</span>

<span class="c1">#stream definitions</span>
<span class="c1"># stream definitions define connections between spouts and bolts.</span>
<span class="c1"># note that such connections can be cyclical</span>
<span class="c1"># custom stream groupings are also supported</span>

<span class="na">streams</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">spout</span><span class="nv"> </span><span class="s">--&gt;</span><span class="nv"> </span><span class="s">split"</span> <span class="c1"># name isn't used (placeholder for logging, UI, etc.)</span>
    <span class="na">from</span><span class="pi">:</span> <span class="s2">"</span><span class="s">sentence-spout"</span>
    <span class="na">to</span><span class="pi">:</span> <span class="s2">"</span><span class="s">splitsentence"</span>
    <span class="na">grouping</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">SHUFFLE</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">split</span><span class="nv"> </span><span class="s">--&gt;</span><span class="nv"> </span><span class="s">count"</span>
    <span class="na">from</span><span class="pi">:</span> <span class="s2">"</span><span class="s">splitsentence"</span>
    <span class="na">to</span><span class="pi">:</span> <span class="s2">"</span><span class="s">count"</span>
    <span class="na">grouping</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">FIELDS</span>
      <span class="na">args</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">word"</span><span class="pi">]</span>

  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">count</span><span class="nv"> </span><span class="s">--&gt;</span><span class="nv"> </span><span class="s">log"</span>
    <span class="na">from</span><span class="pi">:</span> <span class="s2">"</span><span class="s">count"</span>
    <span class="na">to</span><span class="pi">:</span> <span class="s2">"</span><span class="s">log"</span>
    <span class="na">grouping</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">SHUFFLE</span>
</code></pre></div>
<h2 id="micro-batching-trident-api-support">微批量（Trident）API支持</h2>

<p>当前，Flux YAML DSL仅支持Core Storm API，但计划支持Storm的微批处理API。</p>

<p>要将Flux与Trident拓扑一起使用，请定义拓扑获取方法并在YAML配置中引用它：</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">my-trident-topology"</span>

<span class="na">config</span><span class="pi">:</span>
  <span class="s">topology.workers</span><span class="pi">:</span> <span class="s">1</span>

<span class="na">topologySource</span><span class="pi">:</span>
  <span class="na">className</span><span class="pi">:</span> <span class="s2">"</span><span class="s">org.apache.storm.flux.test.TridentTopologySource"</span>
  <span class="c1"># Flux will look for "getTopology", this will override that.</span>
  <span class="na">methodName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">getTopologyWithDifferentMethodName"</span>
</code></pre></div></div>


	          </div>
	       </div>
	  </div>
<footer>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>聚会</h5>
                    <ul class="latest-news">
                        
                        <li><a href="http://www.meetup.com/Apache-Storm-Apache-Kafka/">Apache Storm和Apache Kafka</a> <span class="small">（加利福尼亚州桑尼维尔）</span></li>
                        
                        <li><a href="http://www.meetup.com/Apache-Storm-Kafka-Users/">Apache Storm和Kafka用户</a> <span class="small">（华盛顿州西雅图）</span></li>
                        
                        <li><a href="http://www.meetup.com/New-York-City-Storm-User-Group/">NYC Storm用户组</a> <span class="small">（纽约州纽约）</span></li>
                        
                        <li><a href="http://www.meetup.com/Bay-Area-Stream-Processing">湾区流处理</a> <span class="small">（加利福尼亚州埃默里维尔）</span></li>
                        
                        <li><a href="http://www.meetup.com/Boston-Storm-Users/">波士顿实时数据</a> <span class="small">（马萨诸塞州波士顿）</span></li>
                        
                        <li><a href="http://www.meetup.com/storm-london">伦敦风暴用户组</a> <span class="small">（英国伦敦）</span></li>
                        
                        <!-- <li><a href="http://www.meetup.com/Apache-Storm-Kafka-Users/">Seatle, WA</a> <span class="small">(27 Jun 2015)</span></li> -->
                    </ul>
                </div>
            </div>
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>关于Apache Storm</h5>
                    <p>Apache Storm与任何排队系统和任何数据库系统集成。Apache Storm的喷口抽象使集成新排队系统变得容易。同样，将Apache Storm与数据库系统集成很容易。</p>
               </div>
            </div>
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>第一眼</h5>
                    <ul class="footer-list">
                        <li><a href="/releases/current/Rationale.html">基本原理</a></li>
                        <li><a href="/releases/current/Tutorial.html">讲解</a></li>
                        <li><a href="/releases/current/Setting-up-development-environment.html">搭建开发环境</a></li>
                        <li><a href="/releases/current/Creating-a-new-Storm-project.html">创建一个新的Apache Storm项目</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-md-3">
                <div class="footer-widget">
                    <h5>文献资料</h5>
                    <ul class="footer-list">
                        <li><a href="/releases/current/index.html">指数</a></li>
                        <li><a href="/releases/current/javadocs/index.html">Java文档</a></li>
                        <li><a href="/releases/current/FAQ.html">常问问题</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <hr>
        <div class="row">   
            <div class="col-md-12">
                <p align="center">版权所有©2019 <a href="http://www.apache.org">Apache Software Foundation</a> 。版权所有。
                    <br>Apache Storm，Apache，Apache Feather徽标和Apache Storm项目徽标是The Apache Software Foundation的商标。
                    <br>提及的所有其他商标可能是其各自所有者的商标或注册商标。</p>
            </div>
        </div>
    </div>
</footer>
<!--Footer End-->
<!-- Scroll to top -->
<span class="totop"><a href="#"><i class="fa fa-angle-up"></i></a></span> 





</body></html>