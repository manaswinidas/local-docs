<html lang="zh-Hans" ><head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title><groovy> Ant任务</title>
<link rel="stylesheet" href="./assets/css/style.css">
<link rel="stylesheet" href="asset?aid=4">
</head>
<body class="book toc2 toc-left" >
<div id="header">
<h1><groovy>蚂蚁任务</groovy></h1>
<div class="details">
<span id="revnumber">版本2.5.8</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">目录</div>
<ul class="sectlevel1">
<li><a href="#_required_taskdef">1。必需的taskdef</a></li>
<li><a href="#_groovy_attributes">2. <groovy>属性</groovy></a></li>
<li><a href="#_parameters_specified_as_nested_elements">3。指定为嵌套元素的参数</a>
<ul class="sectlevel2">
<li><a href="#_classpath">3.1。<classpath></classpath></a></li>
<li><a href="#_arg">3.2。<arg></arg></a></li>
</ul>
</li>
<li><a href="#_available_bindings">4。可用绑定</a></li>
<li><a href="#_examples">5，例子</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>从<a href="http://ant.apache.org/">Apache Ant</a>执行一系列Groovy语句。可以使用文本从文本文件中读取语句<code>src</code>属性或来自封闭的Groovy标签之间。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_required_taskdef"><a class="anchor" href="#_required_taskdef"></a> 1。必需的taskdef</h2>
<div class="sectionbody">
<div class="paragraph">
<p>假设您需要的所有普通jar都在<em>my.classpath中</em> （这将是<code>groovy-VERSION.jar</code> ， <code>groovy-ant-VERSION.jar</code>加上您可能正在使用的所有模块和传递性依赖项），则需要在<code>build.xml</code>在...之前<code>groovy</code>任务被调用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;taskdef name="groovy"
         classname="org.codehaus.groovy.ant.Groovy"
         classpathref="my.classpath"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在使用如下任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;groovy src="..." otherAttributes="..."&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>或这个：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;groovy&gt;
...
&lt;/groovy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您的任何模块通过类路径加载服务，则可能需要使用<em>contextClassLoader</em>属性（请参见下文）。 <code>groovy-json</code> 。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_groovy_attributes"><a class="anchor" href="#_groovy_attributes"></a> 2. <groovy>属性</groovy></h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width:25%">
<col style="width:50%">
<col style="width:25%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需要</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">contextClassLoader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果启用，则将使用用于运行脚本的外壳程序的classLoader设置contextClassLoader。如果fork为true，则不使用。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">src</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">包含Groovy语句的文件。包含文件的目录将添加到类路径。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是的，除非标记中包含语句</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类路径</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要使用的类路径。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类路径引用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要使用的类路径，作为对在其他位置定义的PATH的引用。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">输出</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设置输出文件；默认为Ant日志。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">附加</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果启用并且输出到文件，请追加到现有文件而不是覆盖。默认为false。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">叉子</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果启用，则脚本将在派生的JVM进程中执行（默认情况下禁用）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptBaseClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">脚本基类的名称。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">印地</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果启用该脚本，将使用<code>invokedynamic</code> （默认情况下处于禁用状态）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">参数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成元数据以反映JDK 8及更高版本上的方法参数名称。默认为false。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useGroovyShell</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果启用，则使用新的GroovyShell运行脚本。特殊变量将不可用，但您无需在类路径中使用Ant。默认为false。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeAntRuntime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果启用，则在分叉时，系统类路径将包括在类路径中。默认为true。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">堆栈跟踪</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果启用，则在编译过程中发生错误时将报告堆栈跟踪。默认为false。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置脚本</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设置groovy编译器配置的配置脚本。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_parameters_specified_as_nested_elements"><a class="anchor" href="#_parameters_specified_as_nested_elements"></a> 3。指定为嵌套元素的参数</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_classpath"><a class="anchor" href="#_classpath"></a> 3.1。<classpath></classpath></h3>
<div class="paragraph">
<p>Groovy的classpath属性是类似PATH的结构，也可以通过嵌套的classpath元素进行设置。</p>
</div>
</div>
<div class="sect2">
<h3 id="_arg"><a class="anchor" href="#_arg"></a> 3.2。<arg></arg></h3>
<div class="paragraph">
<p>可以<arg>使用标准Ant <a href="http://ant.apache.org/manual/using.html#arg">命令行约定</a></arg>通过一个或多个嵌套<arg>元素</arg>来设置参数<arg>。</arg></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_available_bindings"><a class="anchor" href="#_available_bindings"></a> 4。可用绑定</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在Groovy语句中可以使用许多绑定。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width:16.6666%">
<col style="width:83.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">args</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">命令行参数（如果有）</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">蚂蚁</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">的实例<code>AntBuilder</code>了解当前的蚂蚁项目</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">项目</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当前的蚂蚁项目</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一种<code>Map</code>蚁属性</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">目标</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">调用该常规脚本的拥有目标</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">任务</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">包装任务，可以访问<code>org.apache.tools.ant.Task</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_examples"><a class="anchor" href="#_examples"></a> 5，例子</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hello world，版本1：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;groovy&gt;
println "Hello World"
&lt;/groovy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>世界，您好，版本2：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;groovy&gt;
ant.echo "Hello World"
&lt;/groovy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>列出当前目录中的所有xml文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;groovy&gt;
xmlfiles = new File(".").listFiles().findAll{ it =~ "\.xml$" }
xmlfiles.sort().each { println it.toString() }
&lt;/groovy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>列出jar中的所有xml文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;zipfileset id="found" src="foobar.jar"
            includes="**/*.xml"/&gt;
&lt;groovy&gt;
    project.references.found.each {
        println it.name
    }
&lt;/groovy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>运行脚本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;groovy src="/some/directory/some/file.groovy"&gt;
  &lt;classpath&gt;
    &lt;pathelement location="/my/groovy/classes/directory"/&gt;
  &lt;/classpath&gt;
&lt;/groovy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>找到所有<code>Builder</code>具有一个<code>org.*</code>打包在jar目录中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;property name="local.target" value="C:/Projects/GroovyExamples"/&gt;
&lt;groovy&gt;
import java.util.jar.JarFile
def classes = []
def resourceNamePattern = /org\/.*\/.*Builder.class/
def jarNamePattern = /.*(beta|commons).*jar$/

def libdir = new File("${properties['local.target']}/lib")
libdir.listFiles().grep(~jarNamePattern).each { candidate -&gt;
    new JarFile(candidate).entries().each { entry -&gt;
        if (entry.name ==~ resourceNamePattern) classes += entry.name
    }
}
properties["builder-classes"] = classes.join(' ')
&lt;/groovy&gt;
&lt;echo message='${builder-classes}'/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这可能会导致类似：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>org/apache/commons/cli/PatternOptionBuilder.class org/apache/commons/cli/OptionBuilder.class org/codehaus/groovy/tools/groovydoc/GroovyRootDocBuilder.class org/custommonkey/xmlunit/HTMLDocumentBuilder.class org/custommonkey/xmlunit/TolerantSaxDocumentBuilder.class</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的FileScanner版本（收集名称略有不同）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;groovy&gt;
import java.util.jar.JarFile
def resourceNamePattern = /org\/.*\/.*Builder.class/
def candidates = ant.fileScanner {
    fileset(dir: '${local.target}/lib') {
        include(name: '*beta*.jar')
        include(name: '*commons*.jar')
    }
}
def classes = candidates.collect {
    new JarFile(it).entries().collect { it.name }.findAll {
        it ==~ resourceNamePattern
    }
}.flatten()
properties["builder-classes"] = classes.join(' ')
&lt;/groovy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>从您的Ant脚本调出Web服务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project name="SOAP example" default="main" basedir="."&gt;
    &lt;property environment="env"/&gt;
    &lt;property name="celsius" value="0"/&gt;
    &lt;target name="main"&gt;
        &lt;taskdef name="groovy" classname="org.codehaus.groovy.ant.Groovy"&gt;
            &lt;classpath&gt;
                &lt;fileset dir="${env.GROOVY_HOME}" includes="lib/groovy-*.jar,lib/ivy*.jar"/&gt;
            &lt;/classpath&gt;
        &lt;/taskdef&gt;
        &lt;groovy&gt;
            @Grab('org.codehaus.groovy.modules:groovyws:0.5.1')
            import groovyx.net.ws.WSClient
            def url = 'http://www.w3schools.com/webservices/tempconvert.asmx?WSDL'
            def proxy = new WSClient(url, this.class.classLoader)
            proxy.initialize()
            ant.echo "I'm freezing at ${properties.celsius} degrees Celsius"
            properties.result = proxy.CelsiusToFahrenheit(properties.celsius)
        &lt;/groovy&gt;
        &lt;antcall target="results"/&gt;
    &lt;/target&gt;
    &lt;target name="results"&gt;
        &lt;echo message="I'm freezing at ${result} degrees Fahrenheit"/&gt;
    &lt;/target&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>它将输出以下内容（以及一些参考消息）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>main:
     ...
     [echo] I'm freezing at 0 degrees Celsius
results:
     [echo] I'm freezing at 32 degrees Fahrenheit

BUILD SUCCESSFUL</code></pre>
</div>
</div>
<div class="paragraph">
<p>设置参数：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;target name="run"&gt;
    &lt;groovy&gt;
        &lt;arg line="1 2 3"/&gt;
        &lt;arg value="4 5"/&gt;
        println args.size()
        println args[2]
        args.each{ ant.echo(message:it) }
    &lt;/groovy&gt;
&lt;/target&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>输出：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>Buildfile: build.xml

run:
   [groovy] 4
   [groovy] 3
     [echo] 1
     [echo] 2
     [echo] 3
     [echo] 4 5

BUILD SUCCESSFUL</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">版本2.5.8<br>最近更新时间2019-08-02 18:30:30 UTC</div>
</div>
<link rel="stylesheet" href="asset?aid=5">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>prettyPrint()</script>

</body></html>