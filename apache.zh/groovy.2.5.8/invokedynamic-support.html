<html lang="zh-Hans" ><head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>调用动态支持</title>
<link rel="stylesheet" href="./assets/css/style.css">
<link rel="stylesheet" href="asset?aid=2">
</head>
<body class="book toc2 toc-left" >
<div id="header">
<h1>调用动态支持</h1>
<div class="details">
<span id="revnumber">版本2.5.8</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">目录</div>
<ul class="sectlevel1">
<li><a href="#_foreword">1。前言</a></li>
<li><a href="#_the_distributions">2。分布</a>
<ul class="sectlevel2">
<li><a href="#_two_jars">2.1。两个罐子</a></li>
<li><a href="#_command_line_and_indy">2.2。命令行和印地</a></li>
</ul>
</li>
<li><a href="#_running_groovy_script_from_command_line">3。从命令行运行Groovy脚本</a></li>
<li><a href="#_the_compilation_flag">4。编译标志</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_foreword"><a class="anchor" href="#_foreword"></a> 1。前言</h2>
<div class="sectionbody">
<div class="paragraph">
<p>从Groovy 2.0开始，添加了对JVM <a href="http://docs.oracle.com/javase/7/docs/technotes/guides/vm/multiple-language-support.html#invokedynamic">invokedynamic</a>指令的支持。从Java 7开始就支持该指令，它是JVM中的新字节码指令，可简化动态语言的实现。该指令还将由JVM在内部用于Java 8中的lambda支持。</p>
</div>
<div class="paragraph">
<p>这意味着与API，AST转换或语法糖不同，此功能对开发人员或最终用户<strong>不可见</strong> 。它仅是编译和运行时功能。这意味着在给定两个用Groovy编写的程序的情况下，可以选择在有无调用动态支持的情况下对其进行编译。无论您选择什么，它都有优点和缺点：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>只要运行JDK 1.7+，就可以在同一项目中混合使用和不使用invokedynamic编译的类。</p>
</li>
<li>
<p>根据JVM（甚至是JVM的不同次要版本）的不同，您可以在激活了invokedynamic支持的情况下针对接近Java性能的动态Groovy</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_distributions"><a class="anchor" href="#_the_distributions"></a> 2。分布</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_two_jars"><a class="anchor" href="#_two_jars"></a> 2.1。两个罐子</h3>
<div class="paragraph">
<p>Groovy发行版附带<strong>两个</strong> jar：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>groovy-xyzjar：包含使用调用站点缓存编译的Groovy源</p>
</li>
<li>
<p>groovy-xyz-indy.jar：包含使用invokedynamic指令编译的Groovy源</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>由于Groovy核心和Groovy模块有时是用Groovy编写的，因此我们目前别无选择，只能分发两个不同的Groovy版本。这意味着，如果选择“普通” jar，则Groovy本身的Groovy类将使用调用站点缓存（1.6+）进行编译，而如果使用“ indy” jar，则Groovy本身的Groovy类将使用invokedynamic进行编译。</p>
</div>
<div class="paragraph">
<p>这两个jar都包含一个完全正常的Groovy实现，该实现能够使用invokedynamic或调用站点缓存来编译用户提供的Groovy源。Jar的集合是互斥的（不要同时放在类路径上），它们之间的主要区别与组成Groovy本身的Groovy源文件的编译方式有关。</p>
</div>
</div>
<div class="sect2">
<h3 id="_command_line_and_indy"><a class="anchor" href="#_command_line_and_indy"></a> 2.2。命令行和印地</h3>
<div class="paragraph">
<p>如果您下载发行版并使用命令行，则它总是Groovy的“普通”版本，它是在类路径中拾取的。这意味着无论您使用什么命令（ <code>groovy</code> ， <code>groovyc</code> ， <code>groovysh</code>要么<code>groovyConsole</code> ），则无法直接使用invokedynamic支持。要使用通过invokedynamic编译的Groovy发行版用于其Groovy源，必须手动切换jar。该发行版使用lib目录中的jar，而indy jar在indy目录中可用。您需要做三件事：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>删除或重命名lib目录中的groovy-*。jar文件</p>
</li>
<li>
<p>用indy目录中的indy版本替换它们</p>
</li>
<li>
<p>从jar名称中删除-indy分类器</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这是一个bash脚本，可以立即完成所有操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">$ for f in `ls lib/groovy*.jar | cut -d/ -f2`;do k=`basename $f .jar`; mv lib/$k.jar lib/$k.jar.old; cp indy/$k-indy.jar lib/$k.jar ; done</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_groovy_script_from_command_line"><a class="anchor" href="#_running_groovy_script_from_command_line"></a> 3。从命令行运行Groovy脚本</h2>
<div class="sectionbody">
<div class="paragraph">
<p>从命令行运行脚本的通常方法是<code>groovy foo.groovy</code> ，在哪里<code>foo.groovy</code>是源代码形式的Groovy程序。要为此使用indy，您必须使用indy编译标志， <code>groovy --indy foo.groovy</code> 。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_compilation_flag"><a class="anchor" href="#_the_compilation_flag"></a> 4。编译标志</h2>
<div class="sectionbody">
<div class="paragraph">
<p>与您使用的jar版本无关（并按照说明更换了jar之后），invokedynamic支持需要特定的编译标志（ <em>indy</em> ）。如果要在具有invokedynamic支持的情况下编译类，则必须在编译时设置此标志。下表显示了用户编译的类和Groovy核心类的情况，具体取决于您使用的jar和编译标志：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">表1.用户编译的类</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">印度国旗</th>
<th class="tableblock halign-left valign-top"><strong>关</strong></th>
<th class="tableblock halign-left valign-top"><strong>上</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">普通罐子</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">呼叫站点缓存</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">动态调用</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">印地坛</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">呼叫站点缓存</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">动态调用</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">表2.核心Groovy类</caption>
<colgroup>
<col style="width:33.3333%">
<col style="width:33.3333%">
<col style="width:33.3334%">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">印度国旗</th>
<th class="tableblock halign-left valign-top"><strong>关</strong></th>
<th class="tableblock halign-left valign-top"><strong>上</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">普通罐子</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">呼叫站点缓存</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">呼叫站点缓存</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">印地坛</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">动态调用</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">动态调用</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>因此，即使您使用Indy jar，如果在编译时不使用invokedynamic标志，则已编译的类将使用“旧”格式。</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">版本2.5.8<br>最近更新时间2019-08-02 18:30:30 UTC</div>
</div>
<link rel="stylesheet" href="asset?aid=3">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>prettyPrint()</script>

</body></html>