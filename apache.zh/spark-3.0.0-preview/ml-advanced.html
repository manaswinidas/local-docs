<html class="no-js" ><!--<![endif]--><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>高级主题-Spark 3.0.0-预览文档</title>
        

        

        <link rel="stylesheet" href="css/bootstrap.min.css">
        <style>
            body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
        </style>
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="css/bootstrap-responsive.min.css">
        <link rel="stylesheet" href="css/main.css">

        <script src="js/vendor/modernizr-2.6.1-respond-1.1.0.min.js"></script>

        <link rel="stylesheet" href="css/pygments-default.css">

        
        <!-- Google analytics script -->
        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-32518208-2']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>
        

    </head>
    <body >
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="https://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

        <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

        <div class="navbar navbar-fixed-top" id="topbar">
            <div class="navbar-inner">
                <div class="container">
                    <div class="brand"><a href="index.html"><img src="img/spark-logo-hd.png" style="height:50px"></a> <span class="version">3.0.0预览版</span>
                    </div>
                    <ul class="nav">
                        <!--TODO(andyk): Add class="active" attribute to li some how.-->
                        <li><a href="index.html">总览</a></li>

                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">编程指南<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="quick-start.html">快速开始</a></li>
                                <li><a href="rdd-programming-guide.html">RDD，累加器，广播变量</a></li>
                                <li><a href="sql-programming-guide.html">SQL，数据框和数据集</a></li>
                                <li><a href="structured-streaming-programming-guide.html">结构化流</a></li>
                                <li><a href="streaming-programming-guide.html">火花流（DStreams）</a></li>
                                <li><a href="ml-guide.html">MLlib（机器学习）</a></li>
                                <li><a href="graphx-programming-guide.html">GraphX（图形处理）</a></li>
                                <li><a href="sparkr.html">SparkR（Spark上的R）</a></li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">API文件<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="api/scala/index.html#org.apache.spark.package">斯卡拉</a></li>
                                <li><a href="api/java/index.html">爪哇</a></li>
                                <li><a href="api/python/index.html">蟒蛇</a></li>
                                <li><a href="api/R/index.html">[R</a></li>
                                <li><a href="api/sql/index.html">SQL，内置函数</a></li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">部署中<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="cluster-overview.html">总览</a></li>
                                <li><a href="submitting-applications.html">提交申请</a></li>
                                <li class="divider"></li>
                                <li><a href="spark-standalone.html">Spark独立</a></li>
                                <li><a href="running-on-mesos.html">梅索斯</a></li>
                                <li><a href="running-on-yarn.html">纱</a></li>
                                <li><a href="running-on-kubernetes.html">Kubernetes</a></li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a href="api.html" class="dropdown-toggle" data-toggle="dropdown">更多<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="configuration.html">组态</a></li>
                                <li><a href="monitoring.html">监控方式</a></li>
                                <li><a href="tuning.html">调音指南</a></li>
                                <li><a href="job-scheduling.html">作业调度</a></li>
                                <li><a href="security.html">安全</a></li>
                                <li><a href="hardware-provisioning.html">硬件配置</a></li>
                                <li><a href="migration-guide.html">迁移指南</a></li>
                                <li class="divider"></li>
                                <li><a href="building-spark.html">建筑火花</a></li>
                                <li><a href="https://spark.apache.org/contributing.html">为Spark贡献</a></li>
                                <li><a href="https://spark.apache.org/third-party-projects.html">第三方项目</a></li>
                            </ul>
                        </li>
                    </ul>
                    <!--<p class="navbar-text pull-right"><span class="version-text">v3.0.0-preview</span></p>-->
                </div>
            </div>
        </div>

        <div class="container-wrapper">

            
                
                    <div class="left-menu-wrapper">
    <div class="left-menu">
        <h3><a href="ml-guide.html">MLlib：主要指南</a></h3>
        
<ul>

    <li>
        <a href="ml-statistics.html">基本统计</a>
    </li>
    
    

    <li>
        <a href="ml-datasource.html">数据源</a>
    </li>
    
    

    <li>
        <a href="ml-pipeline.html">流水线</a>
    </li>
    
    

    <li>
        <a href="ml-features.html">提取，转换和选择特征</a>
    </li>
    
    

    <li>
        <a href="ml-classification-regression.html">分类与回归</a>
    </li>
    
    

    <li>
        <a href="ml-clustering.html">聚类</a>
    </li>
    
    

    <li>
        <a href="ml-collaborative-filtering.html">协同过滤</a>
    </li>
    
    

    <li>
        <a href="ml-frequent-pattern-mining.html">频繁模式挖掘</a>
    </li>
    
    

    <li>
        <a href="ml-tuning.html">模型选择和调整</a>
    </li>
    
    

    <li>
        <a href="ml-advanced.html">
            
                <b>进阶主题</b>
            
        </a>
    </li>
    
    

</ul>

        <h3><a href="mllib-guide.html">MLlib：基于RDD的API指南</a></h3>
        
<ul>

    <li>
        <a href="mllib-data-types.html">资料类型</a>
    </li>
    
    

    <li>
        <a href="mllib-statistics.html">基本统计</a>
    </li>
    
    

    <li>
        <a href="mllib-classification-regression.html">分类与回归</a>
    </li>
    
    

    <li>
        <a href="mllib-collaborative-filtering.html">协同过滤</a>
    </li>
    
    

    <li>
        <a href="mllib-clustering.html">聚类</a>
    </li>
    
    

    <li>
        <a href="mllib-dimensionality-reduction.html">降维</a>
    </li>
    
    

    <li>
        <a href="mllib-feature-extraction.html">特征提取和转换</a>
    </li>
    
    

    <li>
        <a href="mllib-frequent-pattern-mining.html">频繁模式挖掘</a>
    </li>
    
    

    <li>
        <a href="mllib-evaluation-metrics.html">评估指标</a>
    </li>
    
    

    <li>
        <a href="mllib-pmml-model-export.html">PMML模型导出</a>
    </li>
    
    

    <li>
        <a href="mllib-optimization.html">优化（开发人员）</a>
    </li>
    
    

</ul>

    </div>
</div>
                
                <input id="nav-trigger" class="nav-trigger" type="checkbox" checked>
                <label for="nav-trigger"></label>
                <div class="content-with-sidebar" id="content">
                    
                        <h1 class="title">进阶主题</h1>
                    

                    <ul id="markdown-toc">
  <li><a href="#optimization-of-linear-methods-developer" id="markdown-toc-optimization-of-linear-methods-developer">线性方法的优化（开发人员）</a>    <ul>
      <li><a href="#limited-memory-bfgs-l-bfgs" id="markdown-toc-limited-memory-bfgs-l-bfgs">内存有限的BFGS（L-BFGS）</a></li>
      <li><a href="#normal-equation-solver-for-weighted-least-squares" id="markdown-toc-normal-equation-solver-for-weighted-least-squares">加权最小二乘的法线方程求解器</a></li>
      <li><a href="#iteratively-reweighted-least-squares-irls" id="markdown-toc-iteratively-reweighted-least-squares-irls">迭代加权最小二乘法（IRLS）</a></li>
    </ul>
  </li>
</ul>

<p><code>\[ \newcommand{\R}{\mathbb{R}} \newcommand{\E}{\mathbb{E}} \newcommand{\x}{\mathbf{x}} \newcommand{\y}{\mathbf{y}} \newcommand{\wv}{\mathbf{w}} \newcommand{\av}{\mathbf{\alpha}} \newcommand{\bv}{\mathbf{b}} \newcommand{\N}{\mathbb{N}} \newcommand{\id}{\mathbf{I}} \newcommand{\ind}{\mathbf{1}} \newcommand{\0}{\mathbf{0}} \newcommand{\unit}{\mathbf{e}} \newcommand{\one}{\mathbf{1}} \newcommand{\zero}{\mathbf{0}} \]</code></p>

<h1 id="optimization-of-linear-methods-developer">线性方法的优化（开发人员）</h1>

<h2 id="limited-memory-bfgs-l-bfgs">内存有限的BFGS（L-BFGS）</h2>
<p><a href="http://en.wikipedia.org/wiki/Limited-memory_BFGS">L-BFGS</a>是拟牛顿方法族中的一种优化算法，用于解决形式的优化问题<code>$\min_{\wv \in\R^d} \; f(\wv)$</code> 。L-BFGS方法在不评估目标函数的二阶导数以构造Hessian矩阵的情况下，将目标函数局部近似为二次方。Hessian矩阵可通过以前的梯度评估来近似，因此与在牛顿方法中显式计算Hessian矩阵不同，不存在垂直可伸缩性问题（训练特征的数量）。结果，与其他一阶优化相比，L-BFGS通常可以实现更快的收敛。</p>

<p><a href="https://www.microsoft.com/en-us/research/wp-content/uploads/2007/01/andrew07scalable.pdf">Orthant-Wise有限内存拟牛顿</a> （OWL-QN）是L-BFGS的扩展，可以有效处理L1和弹性净正则化。</p>

<p>L-BFGS用作<a href="api/scala/index.html#org.apache.spark.ml.regression.LinearRegression">LinearRegression</a> ， <a href="api/scala/index.html#org.apache.spark.ml.classification.LogisticRegression">LogisticRegression</a> ， <a href="api/scala/index.html#org.apache.spark.ml.regression.AFTSurvivalRegression">AFTSurvivalRegression</a>和<a href="api/scala/index.html#org.apache.spark.ml.classification.MultilayerPerceptronClassifier">MultilayerPerceptronClassifier</a>的求解器。</p>

<p>MLlib L-BFGS求解器在<a href="https://github.com/scalanlp/breeze/blob/master/math/src/main/scala/breeze/optimize/LBFGS.scala">微风中</a>调用相应的实现。</p>

<h2 id="normal-equation-solver-for-weighted-least-squares">加权最小二乘的法线方程求解器</h2>

<p>MLlib通过<a href="https://github.com/apache/spark/blob/v3.0.0-preview/mllib/src/main/scala/org/apache/spark/ml/optim/WeightedLeastSquares.scala">WeightedLeastSquares</a>为<a href="https://en.wikipedia.org/wiki/Least_squares#Weighted_least_squares">加权最小二乘</a>实现法线方程求解器。</p>

<p>给定$ n $加权观测值$（w_i，a_i，b_i）$：</p>

<ul>
  <li>$ w_i $第i个观测值的权重</li>
  <li>$ a_i $第i个观测的特征向量</li>
  <li>$ b_i $第i个观测的标签</li>
</ul>

<p>每个观察的特征数量为$ m $。我们使用以下加权最小二乘公式： <code>\[ \min_{\mathbf{x}}\frac{1}{2} \sum_{i=1}^n \frac{w_i(\mathbf{a}_i^T \mathbf{x} -b_i)^2}{\sum_{k=1}^n w_k} + \frac{\lambda}{\delta}\left[\frac{1}{2}(1 - \alpha)\sum_{j=1}^m(\sigma_j x_j)^2 + \alpha\sum_{j=1}^m |\sigma_j x_j|\right] \]</code>其中$ \ lambda $是正则化参数，$ \ alpha $是弹性网混合参数，$ \ delta $是标签的总体标准偏差，$ \ sigma_j $是第j个特征的总体标准偏差柱。</p>

<p>该目标函数只需要对数据进行一次传递就可以收集解决该问题所需的统计信息。对于$ n×m的数据矩阵，这些统计信息仅需要$ O（m ^ 2）$的存储，因此当$ m $（要素数量）相对较小时，可以将它们存储在单台计算机上。然后，我们可以使用局部方法（例如直接Cholesky分解或迭代优化程序）在一台机器上求解正则方程。</p>

<p>Spark MLlib当前为正则方程式支持两种类型的求解器：Cholesky因式分解和拟牛顿法（L-BFGS / OWL-QN）。Cholesky分解取决于正定协方差矩阵（即，数据矩阵的列必须线性独立），并且如果违反此条件，将失败。即使协方差矩阵不是正定的，拟牛顿法仍然能够提供合理的解决方案，因此在这种情况下，正规方程求解器也可以退回到拟牛顿法。目前，始终为<code>LinearRegression</code>和<code>GeneralizedLinearRegression</code>估计量。</p>

<p><code>WeightedLeastSquares</code>支持L1，L2和弹性网正则化，并提供启用或禁用正则化和标准化的选项。在没有应用L1正则化的情况下（即$ \ alpha = 0 $），存在解析解，可以使用Cholesky或Quasi-Newton求解器。当$ \ alpha> 0 $时，不存在解析解，而是使用拟牛顿求解器迭代地找到系数。</p>

<p>为了使法线方程方法更有效， <code>WeightedLeastSquares</code>要求功能数量不超过4096。对于较大的问题，请改用L-BFGS。</p>

<h2 id="iteratively-reweighted-least-squares-irls">迭代加权最小二乘法（IRLS）</h2>

<p>MLlib通过<a href="https://github.com/apache/spark/blob/v3.0.0-preview/mllib/src/main/scala/org/apache/spark/ml/optim/IterativelyReweightedLeastSquares.scala">IterativelyReweightedLeastSquares</a>实现<a href="https://en.wikipedia.org/wiki/Iteratively_reweighted_least_squares">迭代加权最小二乘（IRLS）</a> 。它可以用来找到广义线性模型（GLM）的最大似然估计，在鲁棒回归和其他优化问题中找到M估计。<a href="http://www.jstor.org/stable/2345503">有关最大似然估计，</a>请参考<a href="http://www.jstor.org/stable/2345503">迭代加权最小二乘法，</a>有关更多信息<a href="http://www.jstor.org/stable/2345503">，</a>请参见<a href="http://www.jstor.org/stable/2345503">一些健壮和抗性的替代方案</a> 。</p>

<p>通过以下过程可以迭代地解决某些优化问题：</p>

<ul>
  <li>在当前解决方案中线性化目标并更新相应权重。</li>
  <li>通过WeightedLeastSquares解决加权最小二乘（WLS）问题。</li>
  <li>重复上述步骤，直到收敛为止。</li>
</ul>

<p>由于涉及解决加权最小二乘（WLS）问题，因此<code>WeightedLeastSquares</code>在每次迭代中，它还要求要素数量不超过4096。当前，IRLS被用作<a href="api/scala/index.html#org.apache.spark.ml.regression.GeneralizedLinearRegression">GeneralizedLinearRegression</a>的默认求解器。</p>


                </div>
            
             <!-- /container -->
        </div>

        <script src="js/vendor/jquery-3.4.1.min.js"></script>
        <script src="js/vendor/bootstrap.min.js"></script>
        <script src="js/vendor/anchor.min.js"></script>
        <script src="js/main.js"></script>

        <!-- MathJax Section -->
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
                TeX: { equationNumbers: { autoNumber: "AMS" } }
            });
        </script>
        <script>
            // Note that we load MathJax this way to work with local file (file://), HTTP and HTTPS.
            // We could use "//cdn.mathjax...", but that won't support "file://".
            (function(d, script) {
                script = d.createElement('script');
                script.type = 'text/javascript';
                script.async = true;
                script.onload = function(){
                    MathJax.Hub.Config({
                        tex2jax: {
                            inlineMath: [ ["$", "$"], ["\\\\(","\\\\)"] ],
                            displayMath: [ ["$$","$$"], ["\\[", "\\]"] ],
                            processEscapes: true,
                            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
                        }
                    });
                };
                script.src = ('https:' == document.location.protocol ? 'https://' : 'http://') +
                    'cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js' +
                    '?config=TeX-AMS-MML_HTMLorMML';
                d.getElementsByTagName('head')[0].appendChild(script);
            }(document));
        </script>
    

</body></html>